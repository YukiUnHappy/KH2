"use strict";!function(e){var i=e.kh||{},t=t||{};e.kh=i,e.khutil=t,i.di=i.di||{},i.Initializer=i.Initializer||{};var o=e._;i.createInstance=function(t,e){if(o.isString(t))return i.dictx.getObjectResolveDependency(t,e);function n(e){return t.apply(this,e)}return n.prototype=t.prototype,new n(e)},i.gVal={}}((this||0).self||global),function(e){(e.kh||{}).createNameSpaceIfNotExists=function(e){_.reduce(e.split("."),function(e,t){return e[t]=e[t]||{},e[t]},this)}}((this||0).self||global);var __extends=this&&this.__extends||function(){var i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};return function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}(),__values=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},BaseEntity=function(){function e(e,t,n){this.expiredDate=0,this.idVO=e,this.plainBody=t,this.purgeRule=n||this.makePurgeRule(),this.dirtyFlag={DELETE:!1,PURGE:!1,OLD:!1}}return e.prototype.getIdVO=function(){return this.idVO},e.prototype.purge=function(e){return!this.dirtyFlag.PURGE&&this.expiredDate instanceof Date&&this.expiredDate.getTime()<(new Date).getTime()&&(this.dirtyFlag.PURGE=!0),!this.dirtyFlag.PURGE&&this.purgeRule.isPurgeTiming(e)&&(this.dirtyFlag.PURGE=!0),this.dirtyFlag.PURGE},e.prototype.setDelete=function(){this.dirtyFlag.DELETE=!0},e.prototype.setOldFlag=function(){this.dirtyFlag.OLD=!0},e.prototype.getPlainBody=function(){return this.dirtyFlag.PURGE&&console.warn("get Purged Model: "+this.idVO.id),this.dirtyFlag.DELETE&&console.warn("get Deleted Model: "+this.idVO.id),this.dirtyFlag.OLD&&console.warn("get Old Model: "+this.idVO.id),this.plainBody},e.prototype.isDirty=function(){return Object.values(this.dirtyFlag).includes(!0)||0!=this.expiredDate&&this.expiredDate.getTime()<(new Date).getTime()},e.prototype.release=function(){},e}(),releaseUsedCount=10,CountCoefficient={0:0,1:0,2:1,3:3};CountCoefficient[4]=releaseUsedCount;var PurgeRule=function(){function t(e,t,n){void 0===t&&(t=3),void 0===n&&(n=3),this.timing=t,this.priority=e,this.sceneLevel=n}return t.prototype.isPurgeTiming=function(e){return 2===e.timing?this.sceneLevel<e.sceneLevel:!(2===this.timing&&this.sceneLevel>e.sceneLevel)&&this.timing<=e.timing},t.makeForce=function(){return new t(0,3)},t.makeToMypage=function(){return new t(1,1,0)},t.makeSceneChange=function(){return new t(1,0,2)},t.makeComponentChange=function(){return new t(1,1,1)},t.makeNavigationLevel=function(e){return new t(1,2,e)},t}();kh.createNameSpaceIfNotExists("core.repository"),kh.core.repository.PurgeRule=PurgeRule;var pathExp=/\//g,ResourceId=function(){function r(e,t,n){this.id=e,this.component=t,this.path=n}return r.prototype.getComponent=function(){return this.component},r.prototype.getPath=function(){return this.path},r.prototype.equal=function(e){return e instanceof r&&this.id===e.id},r.makeFromPath=function(e){if(e.startsWith(kh.env.scenarioRootBase))return new r("scenario-"+e.substring(kh.env.imgRootBase.length+1).replace(pathExp,"-"),"scenario",e);if(e.startsWith("http"))return new r("upload-"+e.substring(kh.env.imgRootBase.length+1).replace(pathExp,"-"),"upload",e);if(e.startsWith("res/")){var t=kh.createInstance("router").getCurrentComponent()||this.getComponentName();return new r(t+"-"+e.substring(4).replace(pathExp,"-"),t,"../"+t+"/"+e)}var n=khutil.resolvePath(e),i=n.lastIndexOf("/res/"),o=n.substring(n.lastIndexOf("/",i-1)+1,i);return new r(o+"-"+khutil.resolvePath(n.substring(i+5)).replace(pathExp,"-"),o,n)},r.getComponentName=function(){var e=location.pathname.split("/");return e[e.length-2]},r}(),coreResourcePurgeRule=new PurgeRule(0,4),noCachePurgeRule=new PurgeRule(4,0),uploadPurgeRule=new PurgeRule(2,3),defaultPurgeRule=new PurgeRule(1,3),Resource=function(r){function o(e,t,n,i){void 0===i&&(i=ResourceRepository.lastRecentlyUsedCount);var o=this;return Object.freeze(t),(o=r.call(this,e,t,n)||this)._lastRecentlyUsedCount=i,o}return __extends(o,r),o.prototype.makePurgeRule=function(){throw"Unexpected Call: makePurgeRule"},o.prototype.get=function(){return this._lastRecentlyUsedCount=ResourceRepository.lastRecentlyUsedCount,this.getPlainBody()},o.prototype.purge=function(e){if(this.dirtyFlag.PURGE)return this.dirtyFlag.PURGE;if(!r.prototype.purge.call(this,e)){if(Math.abs(ResourceRepository.lastRecentlyUsedCount-this._lastRecentlyUsedCount)*CountCoefficient[this.purgeRule.priority]<releaseUsedCount)return!1;this.dirtyFlag.PURGE=!0}return!0},o.make=function(e,t,n){var i=e instanceof ResourceId?e:ResourceId.makeFromPath(e);if(0===i.id.indexOf("mypage-loginbonus"))return new o(i,t,noCachePurgeRule);if(n instanceof PurgeRule)return new o(i,t,n);switch(i.getComponent()){case"core":return new o(i,t,coreResourcePurgeRule);case"upload":return new o(i,t,uploadPurgeRule);case"scenario":return new o(i,t,noCachePurgeRule);default:return new o(i,t,defaultPurgeRule)}},o.prototype.release=function(){r.prototype.release.call(this),cc.textureCache.removeTextureForKey(this.getIdVO());var e=this.getPlainBody(),t=this.getIdVO();return e instanceof cc.Audio&&e._element?void e._element.pause():e instanceof Image&&e.src&&e.src.startsWith("blob:")?void(URL.revokeObjectURL&&URL.revokeObjectURL(e.src)):t instanceof ResourceId&&t.getPath().indexOf(".ExportJson")?void ccs.armatureDataManager.removeArmatureFileInfo(t.getPath()):void 0},o}(BaseEntity),OnMemoryCache=function(){function e(){this.cache=new Map}return e.prototype.get=function(e){return this.cache.get(e.id)||null},e.prototype.purge=function(e){var t,n,i;try{for(var o=__values(this.cache.entries()),r=o.next();!r.done;r=o.next()){var a=(i=r.value)[1];a.purge(e),a.isDirty()&&(a.release(),this.cache.delete(i[0]))}}catch(e){t={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}},e.prototype.put=function(e,t){this.cache.set(e.id,t)},e.prototype.remove=function(e){this.cache.delete(e.id)},e.prototype.updateVersion=function(){this.cache=new Map},e}(),ResourceCache=function(){function e(){this.onMemory=new OnMemoryCache}return e.prototype.get=function(e){return this.onMemory.get(e)},e.prototype.purge=function(e){this.onMemory.purge(e)},e.prototype.put=function(e,t){this.onMemory.put(e,t)},e.prototype.remove=function(e){var t=this.get(e);this.onMemory.remove(e),t instanceof Resource&&t.release()},e.prototype.updateVersion=function(){this.onMemory.updateVersion()},e}(),CHANGE_VERSION_EVENT_NAME="REPOSITORY_CHANGE_VERSION",BaseRepository=function(){function o(e,t){this.fetchedVersion=kh.version.app,this.cache=e,this.fetcher=t,this.callbacks={},this.allRemoveEventListener(),this.updateEventListener=cc.eventManager.addCustomListener(CHANGE_VERSION_EVENT_NAME,this.updateVersion),this.registerPurgeOnSceneChange()}return o.checkVersion=function(){var n=this;fetch('/front/json/version.json?d="'+(new Date).getDate()).then(function(e){return e.json()}).then(function(e){var t=e.version;n.latestVersion!==t&&cc.eventManager.dispatchCustomEvent(CHANGE_VERSION_EVENT_NAME,{version:t}),n.latestVersion=t})},o.prototype.get=function(e,t,n){if(void 0===t&&(t=!1),!0===t||this.fetchedVersion!=o.latestVersion)return this.fetchWithCache(e,t,n);var i=this.cache.get(e);return i&&!i.isDirty()?Promise.resolve(i):this.fetchWithCache(e,t,n)},o.prototype.hasCache=function(e){return!!this.cache.get(e)},o.prototype.getCache=function(e){return this.cache.get(e)},o.prototype.fetchWithCache=function(n,e,t){var i=this;return this.fetcher.get(n,e).then(function(e){if(!e.ok)throw new Error("Http Error:"+e.status+" "+e.statusText+":"+e.url);return e}).then(function(e){return i.make(n,e,t)}).then(function(e){var t=i.cache.get(n);return null===t||t.isDirty()||t.purge(PurgeRule.makeForce()),i.cache.put(n,e),e})},o.prototype.registerPurgeOnSceneChange=function(){var t=this;kh.createInstance("router").registerPurgeOnSceneChange(function(e){return t.purge(e)})},o.prototype.addEventListener=function(e,t){this.callbacks[e].push(t)},o.prototype.removeEventListener=function(e,t){return t?void(this.callbacks[e]=this.callbacks[e].filter(function(e){return e!==t})):void(this.callbacks[e]=[])},o.prototype.allRemoveEventListener=function(){this.callbacks[0]=[],this.callbacks[1]=[]},o.prototype.dispatchEvent=function(t,n){this.callbacks[t]=this.callbacks[t].filter(function(e){return!0!==e(t,n)})},o.prototype.updateVersion=function(e){this.cache.updateVersion(e.version)},o.prototype.dispose=function(){cc.eventManager.removeListener(this.updateEventListener)},o.prototype.purge=function(e){this.cache.purge(e)},o.latestVersion=kh.version.app,o}(),ResourceRepository=function(i){function e(){var e=i.call(this,new ResourceCache,new ResourceFetcher)||this;return e._useImageBitMap="function"==typeof createImageBitmap,e}return __extends(e,i),e.prototype.putCache=function(e,t){this.cache.put(e,t)},e.prototype.fetchWithCache=function(t,e,n){return kh.LOAD_BLACKLIST.find(function(e){return-1<t.getPath().indexOf(e)})?Promise.resolve(Resource.make(t,new Image,PurgeRule.makeToMypage())):i.prototype.fetchWithCache.call(this,t,e,n)},e.prototype.registerPurgeOnSceneChange=function(){},e.prototype.make=function(t,e,n){if(!(e instanceof Response))return Promise.resolve(Resource.make(t,e.body,n));if(!e.ok)throw new Error("Http Error:"+e.status+" "+e.statusText+":"+e.url);if(0<e.url.indexOf("csb"))return e.arrayBuffer().then(function(e){return Resource.make(t,e,n)});var i=e.headers.get("Content-Type");if(0<e.url.indexOf(".ExportJson")||i&&0===i.indexOf("application/json"))return e.json().then(function(e){return Resource.make(t,e,n)});if(!i)return e.text().then(function(e){return Resource.make(t,e,n)});if(0===i.indexOf("image/"))return this._makeImageResource(t,e,n);if(0!==i.indexOf("audio/"))return e.text().then(function(e){return Resource.make(t,e,n)});var o=new cc.Audio,r=new Audio(e.url);return r.autoplay=!1,o.setElement(r),Promise.resolve(Resource.make(t,o))},e.prototype._makeImageResource=function(o,i,r){var a=this;return this._useImageBitMap&&!kh.env.isSp?i.blob().then(function(e){return createImageBitmap(e,{premultiplyAlpha:"premultiply"}).then(function(e){return Resource.make(o,e,r)})}):"upload"===o.getComponent()?new Promise(function(e,t){var n=new Image;return n.decode?(n.crossOrigin="Anonymous",n.src=i.url,void n.decode().then(e.bind(null,Resource.make(o,n,r)),t)):(a._addImageLoadEvent(n,Resource.make(o,n,r),e,t),n.crossOrigin="Anonymous",void(n.src=i.url))}):i.blob().then(function(i){return new Promise(function(e,t){var n=new Image;return n.decode?(n.src=URL.createObjectURL(i),void n.decode().then(e.bind(null,Resource.make(o,n,r)),t)):(a._addImageLoadEvent(n,Resource.make(o,n,r),e,t),void(n.src=URL.createObjectURL(i)))})})},e.prototype._addImageLoadEvent=function(t,e,n,i){var o=function(){n(e),t.removeEventListener("load",o),t.removeEventListener("error",r)},r=function(e){i(e),t.removeEventListener("load",o),t.removeEventListener("error",r)};t.addEventListener("load",o,!1),t.addEventListener("error",r,!1)},e.addRecentlyUsedCount=function(){this.lastRecentlyUsedCount>=Number.MAX_SAFE_INTEGER&&(this.lastRecentlyUsedCount=1),this.lastRecentlyUsedCount++},e.lastRecentlyUsedCount=1,e}(BaseRepository),ResourceFetcher=function(){function e(){}return e.prototype.get=function(e,t){var n=0===e.getPath().indexOf("blob:")||0===e.getPath().indexOf("data:")?e.getPath():kh.getAddVersionQueryString(e.getPath());return fetch(n,{mode:"cors",cache:t?"reload":"default"})},e}(),__awaiter=this&&this.__awaiter||function(r,a,s,c){return new(s||(s=Promise))(function(e,t){function n(e){try{o(c.next(e))}catch(e){t(e)}}function i(e){try{o(c.throw(e))}catch(e){t(e)}}function o(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(n,i)}o((c=c.apply(r,a||[])).next())})},__generator=this&&this.__generator||function(n,i){function e(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,r&&(a=2&t[0]?r.return:t[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,t[1])).done)return a;switch(r=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,r=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=i.call(n,s)}catch(e){t=[6,e],r=0}finally{o=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}var o,r,a,t,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return t={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t},__read=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,o,r=n.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(i=r.next()).done;)a.push(i.value)}catch(e){o={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return a},tempLoader;cc._urlRegExp=cc._urlRegExp||new RegExp("^(?:(?:https?|ftp)://)(?:\\S+(?::\\S*)?@)?(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))|(?:localhost))(?::\\d{2,5})?(?:/\\S*)?$","i"),function(e){var r=(t.purge=function(e){this.repository.purge(e)},t.isLoading=function(e){return this._queue.has(ResourceId.makeFromPath(e).id)},t.loadJs=function(e,t,n){var o=this,i=this._getArgs4Js(arguments),r=__read(i,3),a=r[0],s=r[1],c=r[2];cc.async.map(s,function(e,t,n){var i=cc.path.join(a,e);return o._jsCache.has(i)?void n(null):void o._createScript(i,!1,n)},c,this)},t.loadTxt=function(e,t){return void 0===t&&(t=function(){}),this.repository.get(ResourceId.makeFromPath(e)).then(function(e){return t(null,e.get()),e.get()})},t._loadTxtSync=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.loadTxt(t)];case 1:return[2,e.sent()]}})})},t.loadCsb=function(e,t){return this.repository.get(ResourceId.makeFromPath(e)).then(function(e){window.msg=e.get(),t(null,e.get())})},t.loadJson=function(e,t){return this.repository.get(ResourceId.makeFromPath(e)).then(function(e){t(null,e.get())})},t.loadJsWithImg=function(e,t,n){var i=this._loadJsImg(),o=this._getArgs4Js(arguments);this.loadJs(o[0],o[1],function(e){if(e)throw new Error(e);i.parentNode&&i.parentNode.removeChild(i),o[2]&&o[2]()})},t.loadImg=function(t,e,n){var i,o=this,r=function(){},a=!1;n&&(r=n),e instanceof Function&&(r=e),"object"==typeof e&&(e.purgeRule instanceof PurgeRule&&(i=e.purgeRule),a=!0===e.isForce);var s,c=ResourceId.makeFromPath(t);return this._queue.has(c.id)?s=this._queue.get(c.id):(s=this.repository.get(c,a,i),this._queue.set(c.id,s),s.then(function(){o._queue.delete(c.id)},function(){o._queue.delete(c.id)})),s.then(function(e){r(null,e.get())},function(e){r(null,null),kh.createInstance("smartBeat").sendImageErrorLog(e,t)}),s},t.getUrl=function(e,t){var n=cc.path;if(void 0!==e&&void 0===t){t=e;var i=n.extname(t);i=i?i.toLowerCase():"";var o=this._register.get(i);e=o&&o.getBasePath?o.getBasePath():this.resPath}if(0<(t=cc.path.join(e||"",t)).indexOf("lang")&&t.match(/[\/(\\\\)]lang[\/(\\\\)]/i)){if(this._langPathCache.has(t))return this._langPathCache.get(t);var r=n.extname(t)||"",a=t.substring(0,t.length-r.length)+"_"+cc.sys.language+r;return this._langPathCache.set(t,a),a}return t},t.load=function(e,n,t){var i=arguments.length;if(0===i)throw new Error("arguments error!");3===i?"function"==typeof n&&(n="function"==typeof t?{trigger:n,cb:t}:{cb:n,cbTarget:t}):2===i?"function"==typeof n&&(n={cb:n}):1===i&&(n={}),e instanceof Array||(e=[e]);var o=new cc.AsyncPool(e,kh.env.isSp?10:200,this._createLoadResIterator(n),function(e,t){null!=o&&(o._srcObj=null,o._onEnd=null,o._onEndTarget=null,o._iterator=null,o._iteratorTarget=null,o._result=null,o._errors=null,o=null,n.cb&&n.cb.call(n.cbTarget,e,t))},n.cbTarget);return o.flow(),o},t._createLoadResIterator=function(o){var r=this;return function(e,t,n,i){r._loadResIterator(e,t,r._createLoadResCallback(o,n,i))}},t._createLoadResCallback=function(n,i,o){return function(e){void 0===e&&(e=null);var t=Array.prototype.slice.call(arguments,1);n.trigger&&n.trigger.call(n.triggerTarget,t[0],o.size,o.finishedSize),i(e,t[0])}},t._loadResIterator=function(e,t,n){var i=null,o=e.type;if(o?(o="."+o.toLowerCase(),i=e.src?e.src:e.name+o):(i=e,o=cc.path.extname(i)),i){var r=this.getRes(i);if(r)return n(null,r);var a=null;if(o&&(a=this._register.get(o.toLowerCase())),!a)return cc.error("loader for ["+o+"] not exists!"),n();var s=i;if(null!==i&&!cc._urlRegExp.test(i)){var c=a.getBasePath?a.getBasePath():this.resPath;s=this.getUrl(c,i)}a.load(s,i,e,function(e,t){n(e,t)})}},t._getArgs4Js=function(e){var t=e[0],n=e[1],i=e[2],o=["",null,null];if(1===e.length)o[1]=t instanceof Array?t:[t];else if(2===e.length)"function"==typeof n?(o[1]=t instanceof Array?t:[t],o[2]=n):(o[0]=t||"",o[1]=n instanceof Array?n:[n]);else{if(3!==e.length)throw new Error("arguments error to load js!");o[0]=t||"",o[1]=n instanceof Array?n:[n],o[2]=i}return o},t._handleAliases=function(e,t){var n=[];for(var i in e){var o=e[i];this.setAliases(i,o),n.push(o)}this.load(n,{},t)},t.setAliases=function(e,t){this._aliases.set(e,t)},t._getAliase=function(e){return this._aliases.get(e)},t.loadAliases=function(e,n){var i=this,t=this.getRes(e);return t?void t.then(function(e){i._handleAliases(e.filenames,n)}):void this.load([e],{},function(e,t){i._handleAliases(t[0].filenames,n)})},t.register=function(e,t){if(e&&t){if("string"==typeof e)return this._register.set(e.trim().toLowerCase(),t),t;for(var n=0,i=e.length;n<i;n++)this._register.set("."+e[n].trim().toLowerCase(),t)}},t.getRes=function(e){var t=ResourceId.makeFromPath(e);return this.repository.hasCache(t)?this.repository.getCache(t).get():null},t.addCache=function(e){this.repository.putCache(e.getIdVO(),e)},t.release=function(e){if(e){var t=ResourceId.makeFromPath(e);this._aliases.delete(t.id);var n=this.repository.getCache(t);n instanceof Resource&&n.setDelete()}},t.releaseAll=function(){this._aliases.clear(),this.repository.purge(PurgeRule.makeForce())},t._checkIsImageURL=function(e){return null!=/(\.png)|(\.jpg)|(\.bmp)|(\.jpeg)|(\.gif)/.exec(e)},t._loadJsImg=function(){var e=document,t=e.getElementById("cocos2d_loadJsImg");if(t)return t;var n=document.createElement("img");cc._loadingImage&&(n.src=cc._loadingImage);var i=e.getElementById(cc.game.config.id);if(!(i instanceof Element&&i.parentNode))return n;i.style.backgroundColor="transparent",i.parentNode.appendChild(n);var o=getComputedStyle(i);return o||(o={width:i.clientWidth,height:i.clientHeight}),null===o.width&&(o.width=0),null===o.height&&(o.height=0),n.style.left=i.offsetLeft+(o.width-n.clientWidth)/2+"px",n.style.top=i.offsetTop+(o.height-n.clientHeight)/2+"px",n.style.position="absolute",n},t._createScript=function(e,t,n){var i=document,o=document.createElement("script");o.async=t,this._jsCache.set(e,!0),cc.game.config.noCache&&"string"==typeof e?this._noCacheRex.test(e)?o.src=e+"&_t="+(new Date).getTime():o.src=e+"?_t="+(new Date).getTime():o.src=kh.getAddVersionQueryString(e),o.addEventListener("load",function(){o.parentNode&&o.parentNode.removeChild(o),n()},!1),o.addEventListener("error",function(){o.parentNode&&o.parentNode.removeChild(o),n("Load "+e+" failed!")},!1),i.body.appendChild(o)},t.repository=new ResourceRepository,t._jsCache=new Map,t._aliases=new Map,t._queue=new Map,t._langPathCache=new Map,t._register=new Map,t._noCacheRex=/\?/,t.resPath="",t.audioPath="",t);function t(){}(e.loader=r).register(["txt","xml","vsh","fsh","atlas"],cc._txtLoader),r.register(["json","ExportJson"],cc._jsonLoader),r.register(["js"],cc._jsLoader),r.register(["png","jpg","bmp","jpeg","gif","ico","tiff","webp"],{load:function(e,n,t,i){var o;o=cc.loader.isLoading(e)?i:function(e,t){return e?i(e):(cc.textureCache.handleLoadedTexture(n),void i(null,t))},r.loadImg(e,o)}}),r.register(["fnt"],cc._fntLoader={INFO_EXP:/info [^\n]*(\n|$)/gi,COMMON_EXP:/common [^\n]*(\n|$)/gi,PAGE_EXP:/page [^\n]*(\n|$)/gi,CHAR_EXP:/char [^\n]*(\n|$)/gi,KERNING_EXP:/kerning [^\n]*(\n|$)/gi,ITEM_EXP:/\w+=[^ \r\n]+/gi,INT_EXP:/^[\-]?\d+$/,_parseStrToObj:function(e){var t=e.match(this.ITEM_EXP),n={};if(t)for(var i=0,o=t.length;i<o;i++){var r=t[i],a=r.indexOf("="),s=r.substring(0,a),c=r.substring(a+1);c.match(this.INT_EXP)?c=parseInt(c):'"'===c[0]&&(c=c.substring(1,c.length-1)),n[s]=c}return n},parseFnt:function(e,t){var n=this,i={},o=n._parseStrToObj((e.match(n.COMMON_EXP)||[])[0]);if(i.commonHeight=o.lineHeight,cc._renderType===cc.game.RENDER_TYPE_WEBGL){var r=cc.configuration.getMaxTextureSize();(o.scaleW>r.width||o.scaleH>r.height)&&cc.log("cc.LabelBMFont._parseCommonArguments(): page can't be larger than supported")}1!==o.pages&&cc.log("cc.LabelBMFont._parseCommonArguments(): only supports 1 page");var a=n._parseStrToObj((e.match(n.PAGE_EXP)||[])[0]);0!==a.id&&cc.log("cc.LabelBMFont._parseImageFileName() : file could not be found"),i.atlasName=cc.path.changeBasename(t,a.file);for(var s=e.match(n.CHAR_EXP),c=i.fontDefDictionary={},u=0,l=s.length;u<l;u++){var h=n._parseStrToObj(s[u]);c[h.id]={rect:{x:h.x,y:h.y,width:h.width,height:h.height},xOffset:h.xoffset,yOffset:h.yoffset,xAdvance:h.xadvance}}var _=i.kerningDict={},d=e.match(n.KERNING_EXP);if(d)for(u=0,l=d.length;u<l;u++){var p=n._parseStrToObj(d[u]);_[p.first<<16|65535&p.second]=p.amount}return i},load:function(e,i,t,o){var r=this;cc.loader.loadTxt(e,function(e,t){if(e)return o(e);var n=r.parseFnt(t,i);cc.loader.addCache(Resource.make(i,n)),o(null,n)})}}),r.register(["serverImg"],cc._serverImgLoader),r.register(["plist"],cc._plistLoader={load:function(r,e,t,a){var s=r.slice(0,r.lastIndexOf("/")+1);cc.loader.loadTxt(r,function(e,t){if(e)return a(e);var n=cc.plistParser.parse(t);"function"==typeof cc.spriteFrameCache._parseFrameConfig&&(n=cc.spriteFrameCache._parseFrameConfig(n));var i,o=Resource.make(r,n);return cc.loader.addCache(o),null!=n.metadata&&(i=n.metadata.realTextureFileName||n.metadata.textureFileName),null==i?void a(null,n):void cc.loader.loadImg(s+i,function(){a(null,n)})})}}),r.register(["font","eot","ttf","woff","svg","ttc"],cc._fontLoader),r.register(["csb"],cc._csbLoader),r.register(["tmx","tsx"],cc._txtLoader),r.register(["ccbi"],cc._binaryLoader),r.register(["json"],{load:function(e,u,t,l){return 0<u.indexOf("abi_0000.json")?l(null,null):void cc.loader.loadJson(e,function(e,t){var n=cc.path;if(t&&t.Content&&t.Content.Content.UsedResources){for(var i=t.Content.Content.UsedResources,o=n.dirname(u),r=[],a=void 0,s=void 0,c=0;c<i.length;c++)a=n.join(o,i[c]),s=n._normalize(a),ccs.load.validate[s]||(ccs.load.validate[s]=!0,r.push(a));cc.loader.load(r,function(){l(e,t)})}else l(e,t)})}});var u,l=window.__audioSupport.WEB_AUDIO,h=[".mp3"];try{l&&(u=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext))}catch(e){l=!1,cc.log("browser don't support webAudio")}function n(){}r.register(["mp3"],(n.load=function(e,t,n,i){if(kh.createInstance("playerGameConfig").isSoundOn()){if(0===h.length)return i("can not support audio!");var o,r=cc.path.extname(e),a=[r];for(o=0;o<h.length;o++)r!==h[o]&&a.push(h[o]);var s=cc.loader.getRes(t);if(s)return i(null,s);if(l){var c=u.createGain();c.gain.value=1,c.connect(u.destination),s=new cc.Audio(u,c,e)}else s=new cc.Audio(null,null,e);this.loadAudioFromExtList(e,a,s,i)}else i(null,null)},n.loadAudioFromExtList=function(e,t,n,i){var o;if(o=e.startsWith("res/")?"../"+kh.createInstance("router").getCurrentComponent()+"/"+e:e,0===t.length){var r="can not found the resource of audio! Last match url is : ";return r+=o.replace(/\.(.*)?$/,"("),h.forEach(function(e){r+=e+"|"}),r=r.replace(/\|$/,")"),i(r)}var a=new Audio(o);a.onerror=function(){var e="Audio Load Error:"+o;return console.warn(e),0===o.indexOf(kh.env.soundResourceURL)||0===o.indexOf(kh.env.battleResourceURL)?(kh.createInstance("smartBeat").sendError(e),void i(null,null)):void i(e,null)},n.setElement(a);var s=Resource.make(o,n);cc.loader.addCache(s),a.addEventListener("canplaythrough",function e(){i(null,n),a.removeEventListener("canplaythrough",e)}),a.load()},n))}(tempLoader||(tempLoader={})),cc.loader=tempLoader.loader;var __extends=this&&this.__extends||function(){var i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};return function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}(),__awaiter=this&&this.__awaiter||function(r,a,s,c){return new(s||(s=Promise))(function(e,t){function n(e){try{o(c.next(e))}catch(e){t(e)}}function i(e){try{o(c.throw(e))}catch(e){t(e)}}function o(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(n,i)}o((c=c.apply(r,a||[])).next())})},__generator=this&&this.__generator||function(n,i){function e(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,r&&(a=2&t[0]?r.return:t[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,t[1])).done)return a;switch(r=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,r=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=i.call(n,s)}catch(e){t=[6,e],r=0}finally{o=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}var o,r,a,t,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return t={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t},myself;!function(e){var r=(t.prototype.equal=function(e){return e instanceof t&&this.id===e.id},t.BASIC=new t(t.INFO_BASIC="APlayerBasic"),t.CURRENCIES=new t(t.INFO_CURRENCIES="Currencies"),t.QUEST_POINTS=new t(t.INFO_QUEST_POINTS="QuestPoints"),t.BATTLE_POWER=new t(t.INFO_BATTLE_POWER="BattlePower"),t);function t(e){this.id=e}e.MyselfInfoId=r;var n,a=(__extends(i,n=BaseEntity),i.prototype.makePurgeRule=function(){return new PurgeRule(0,4)},i.prototype.get=function(){return this.getPlainBody()},i.make=function(e,t){switch(e){case r.BASIC:return new h(e,t);case r.CURRENCIES:return new _(e,t);case r.QUEST_POINTS:return new d(e,t);case r.BATTLE_POWER:return new p(e,t)}return new i(e,t)},i.prototype.mimicResponse=function(){return{body:this.getPlainBody()}},i);function i(e,t){return Object.freeze(t),n.call(this,e,t)||this}e.MyselfInfo=a;var o,s,c,u,l,h=(__extends(b,l=a),b.prototype.makePurgeRule=function(){return new PurgeRule(1,0)},b.prototype.getRank=function(){return this.getPlainBody().rank},b.prototype.getRankPercentage=function(){var e=this.getPlainBody();return 0===e.next_exp?100:e.exp/(e.exp+e.next_exp)*100},b.prototype.getAPlayerIdString=function(){return"me"},b.prototype.getAPlayerId=function(){return this.getPlainBody().a_player_id},b.prototype.getAUnionId=function(){return this.getPlainBody().a_union_id},b),_=(__extends(y,u=a),y.prototype.getGemAmount=function(){return this.getPlainBody().gem},y.prototype.getJobPointAmount=function(){return this.getPlainBody().job_point},y.prototype.getStoneAmount=function(){return this.getPlainBody().stone},y.prototype.getPseudoCurrencyAmount=function(){return this.getPlainBody().pseudo_currency},y.prototype.getAccessoryPointAmount=function(){return this.getPlainBody().accessory_point},y.prototype.getSummonOrbAmount=function(){return this.getPlainBody().summon_orb},y),d=(__extends(v,c=a),v.prototype.getAsObject=function(){return this.getPlainBody().quest_points},v.prototype.getAP=function(){return this.getAsObject().ap},v.prototype.getBP=function(){return this.getAsObject().bp},v.prototype.getMaxAP=function(){return this.getAsObject().max_ap},v.prototype.getMaxBP=function(){return this.getAsObject().max_bp},v.prototype.getApRecoverTime=function(){return this.getAsObject().ap_recover_time},v.prototype.getBpRecoverTime=function(){return this.getAsObject().bp_recover_time},v),p=(__extends(m,s=a),m.prototype.getValue=function(){return this.getPlainBody().battle_power},m),g=(__extends(f,o=BaseRepository),f.prototype.clearCache=function(e){this.cache.remove(e)},f.prototype.make=function(i,o){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(e){if(!(o instanceof Response))switch(i){case r.BASIC:return[2,a.make(i,o.body)];case r.CURRENCIES:return[2,a.make(r.CURRENCIES,o.body)];case r.QUEST_POINTS:return[2,a.make(r.QUEST_POINTS,o.body)];case r.BATTLE_POWER:return[2,a.make(r.BATTLE_POWER,o.body)]}if(!o.ok)throw new Error("Http Error:"+o.status+" "+o.statusText+":"+o.url);if(t="a_players/me/",(n=o.url.indexOf(t))<0)throw new Error("Unknown url: "+o.url);switch(o.url.substr(n+t.length)){case"me":return[2,a.make(r.BASIC,o.body)];case"currency":return[2,a.make(r.CURRENCIES,o.body)];case"quest_points":return[2,a.make(r.QUEST_POINTS,o.body)];case"battle_power":return[2,a.make(r.BATTLE_POWER,o.body)]}throw new Error("Unknown url: "+o.url)})})},f.prototype.purge=function(e){this.cache.purge(e)},f);function f(){return o.call(this,new OnMemoryCache,new E)||this}function m(){return null!==s&&s.apply(this,arguments)||this}function v(e,t){var n=c.call(this,e,t)||this;return"FULL"===n.getApRecoverTime()&&"FULL"===n.getBpRecoverTime()||(n.expiredDate=new Date,n.expiredDate.setMinutes(n.expiredDate.getMinutes()+1,0,0)),n}function y(){return null!==u&&u.apply(this,arguments)||this}function b(e,t){var n=l.call(this,e,t)||this;return Object.defineProperty(n,"body",{value:t}),n}e.MyselfInfoRepository=g;var E=(C.prototype.get=function(e,t){switch(e){case r.BASIC:return kh.createInstance("apiAPlayers").getMeNumeric();case r.CURRENCIES:return kh.createInstance("apiAPlayers").getCurrency();case r.QUEST_POINTS:return kh.createInstance("apiAPlayers").getQuestPoints();case r.BATTLE_POWER:return kh.createInstance("apiAPlayers").getBattlePower()}throw new Error("Unknown ID: "+typeof e)},C);function C(){}}(myself||(myself={})),kh.core.myself=myself,myself=null,function(e){var t=e.kh,n=e.cc;e.console,t.MyselfInfoRepository=n.Class.extend({className:"MyselfInfoRepository",realRepository:null,ctor:function(){this.realRepository=new t.core.myself.MyselfInfoRepository},getMe:function(e){return!0===e&&this.realRepository.clearCache(t.core.myself.MyselfInfoId.BASIC),this.realRepository.get(t.core.myself.MyselfInfoId.BASIC)},getMyCurrency:function(e){return!0===e&&this.realRepository.clearCache(t.core.myself.MyselfInfoId.CURRENCIES),this.realRepository.get(t.core.myself.MyselfInfoId.CURRENCIES)},getQuestPoints:function(e){return!0===e&&this.realRepository.clearCache(t.core.myself.MyselfInfoId.QUEST_POINTS),this.realRepository.get(t.core.myself.MyselfInfoId.QUEST_POINTS)},getBattlePower:function(e){return!0===e&&this.realRepository.clearCache(t.core.myself.MyselfInfoId.BATTLE_POWER),this.realRepository.get(t.core.myself.MyselfInfoId.BATTLE_POWER).then(function(e){return e.getValue()})},allCacheClear:function(){this.realRepository.clearCache(t.core.myself.MyselfInfoId.BASIC),this.realRepository.clearCache(t.core.myself.MyselfInfoId.CURRENCIES),this.realRepository.clearCache(t.core.myself.MyselfInfoId.QUEST_POINTS),this.realRepository.clearCache(t.core.myself.MyselfInfoId.BATTLE_POWER)},clearQuestPointCache:function(){this.realRepository.clearCache(t.core.myself.MyselfInfoId.QUEST_POINTS)},purge:function(e){this.realRepository.purge(e)}})}((this||0).self||global);var __extends=this&&this.__extends||function(){var i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};return function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}(),__awaiter=this&&this.__awaiter||function(r,a,s,c){return new(s||(s=Promise))(function(e,t){function n(e){try{o(c.next(e))}catch(e){t(e)}}function i(e){try{o(c.throw(e))}catch(e){t(e)}}function o(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(n,i)}o((c=c.apply(r,a||[])).next())})},__generator=this&&this.__generator||function(n,i){function e(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,r&&(a=2&t[0]?r.return:t[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,t[1])).done)return a;switch(r=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,r=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=i.call(n,s)}catch(e){t=[6,e],r=0}finally{o=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}var o,r,a,t,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return t={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t},displayFilter;!function(e){var t=(n.prototype.equal=function(e){return e instanceof n&&this.id===e.id},n);function n(e){this.id=e}e.DisplayFilterId=t;var i,o=(__extends(r,i=BaseEntity),r.prototype.makePurgeRule=function(){return new PurgeRule(0,4)},r.prototype.get=function(){return this._getFilterConfig()},r.make=function(e,t){return new r(e,t)},r.prototype.isModified=function(){return this._modified},r.prototype.setModified=function(){this._modified=!0},r.prototype.isEnabled=function(){var e=this._getFilterConfig();for(var t in e)if(!_.isEmpty(e[t]))return!0;return!1},r.prototype.reset=function(){this._editable={},this.setModified()},r.prototype.cancelModifications=function(){this._modified&&(this._modified=!1,this._editable=Object.assign({},this.getPlainBody().filter_config))},r.prototype._getFilterConfig=function(){return this._editable},r.prototype.getPropertyOrDefault=function(e,t){_.isUndefined(t)&&(t=void 0);var n=this._getFilterConfig();return _.isArray(n[e])?n[e]:n[e]=t},r.prototype.toggleConfigProperty=function(e,t){var n=this.getPropertyOrDefault(e,[]);return _.contains(n,t)?_.pull(n,t):n.push(t),void this.setModified()},r);function r(e,t){var n=i.call(this,e,t)||this;return n._modified=!1,n._editable={},t.filter_config&&(n._editable=Object.assign({},t.filter_config)),n}e.DisplayFilter=o;var a,s=(__extends(c,a=BaseRepository),c.prototype.getAsOffline=function(e){var t=this.cache.get(e);return null===t&&(t=new o(e,{}),this.cache.put(e,t)),t},c.prototype.clearCache=function(e){this.cache.remove(e)},c.prototype.save=function(t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return(n=n||this.cache.get(t))instanceof o&&n.isModified()?(this.cache.remove(t),[4,kh.createInstance("apiAPlayers").updateDisplayFilterConfig(t.id,n.get())]):[2,null];case 1:return e.sent(),[2,this.get(t,!0)]}})})},c.prototype.make=function(t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){if(!(n instanceof Response))return[2,o.make(t,n.body)];if(!n.ok)throw new Error("Http Error:"+n.status+" "+n.statusText+":"+n.url);if(n.url.indexOf("a_players/me/display_filter/")<0)throw new Error("Unknown url: "+n.url);return[2,o.make(t,n.body)]})})},c);function c(){return a.call(this,new OnMemoryCache,new u)||this}e.DisplayFilterRepository=s;var u=(l.prototype.get=function(e,t){return kh.createInstance("apiAPlayers").getDisplayFilterConfig(e.id).then(function(e){if(e.body.error_reason)throw new Error(e.body.error_reason);return e})},l);function l(){}}(displayFilter||(displayFilter={})),kh.core.displayFilter=displayFilter,displayFilter=null,function(e){var i=e.kh,t=e.cc;e.console,i.DisplayFilterRepository=t.Class.extend({className:"DisplayFilterRepository",realRepository:null,ctor:function(){this.realRepository=new i.core.displayFilter.DisplayFilterRepository},get:function(e,t){var n=new i.core.displayFilter.DisplayFilterId(e);return!0===t&&this.realRepository.clearCache(n),this.realRepository.get(n)},getAsOffline:function(e){var t=new i.core.displayFilter.DisplayFilterId(e);return this.realRepository.getAsOffline(t)},save:function(e,t){var n=new i.core.displayFilter.DisplayFilterId(e);return this.realRepository.save(n,t)}})}((this||0).self||global),function(e){var t,n;_.isUndefined(Math.sign)&&(Math.sign=function(e){return 0==e?0:0<e?1:-1}),_.isUndefined(String.prototype.startsWith)&&(String.prototype.startsWith=function(e){return!this.indexOf(e)}),_.isUndefined(String.prototype.replaceFullWidthNumberToHalfWidth)&&(String.prototype.replaceFullWidthNumberToHalfWidth=(t="０".charCodeAt(0)-"0".charCodeAt(0),n=new RegExp("[０-９]","g"),function(){return this.replace(n,function(e){return String.fromCharCode(e.charCodeAt(0)-t)})}))}((this||0).self||global),function(e){function r(e,t,n){function i(e,t,n){var i=new RegExp("\\b"+t+" \\w+ (\\w+)","ig");e.replace(i,function(e,t){return n[t]=0,e})}function o(e,t,n){var i=e.createShader(n);return e.shaderSource(i,t),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS)?i:(console.log(e.getShaderInfoLog(i)),null)}this.uniform={},this.attribute={};var r=o(e,t,e.VERTEX_SHADER),a=o(e,n,e.FRAGMENT_SHADER);for(var s in this.id=e.createProgram(),e.attachShader(this.id,r),e.attachShader(this.id,a),e.linkProgram(this.id),e.getProgramParameter(this.id,e.LINK_STATUS)||console.log(e.getProgramInfoLog(this.id)),e.useProgram(this.id),i(t,"attribute",this.attribute),this.attribute)this.attribute[s]=e.getAttribLocation(this.id,s);for(var c in i(t,"uniform",this.uniform),i(n,"uniform",this.uniform),this.uniform)this.uniform[c]=e.getUniformLocation(this.id,c)}var t={gl:null,_sourceTexture:null,_tempFramebuffer:null,_width:-1,_height:-1,_vertexBuffer:null,_filterCache:null,_canvas:document.createElement("canvas"),initFilter:function(e){_.each(e,function(e,t){"sharpen"===t?0<e&&(this._filterCache={func:this._sharpen,args:[e]}):console.warn("Unknown shader parameter, key='"+t+"' val='"+e+"'")},this)},applyShader:function(e){if(this._filterCache){var t=e.canvas,n=this._canvas.getContext("webgl")||this._canvas.getContext("experimental-webgl");if(!n)throw"Couldn't get WebGL context";this.gl=n,this._resize(n,t.width,t.height),this._sourceTexture=this._createTexture(n,t);var i=[n].concat(this._filterCache.args||[]);this._filterCache.func.apply(this,i),this._drawBack(e)}},_createTexture:function(e,t){var n=e.createTexture();return e.bindTexture(e.TEXTURE_2D,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),n},_createVertexBuffer:function(e){var t=new Float32Array([-1,-1,0,1,1,-1,1,1,-1,1,0,0,-1,1,0,0,1,-1,1,1,1,1,1,0]),n=e.createBuffer();return e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),n},_drawBuffer:function(e,t,n,i,o){e.bindTexture(e.TEXTURE_2D,n),e.bindFramebuffer(e.FRAMEBUFFER,i),e.uniform1f(t.uniform.flipY,o?-1:1),e.drawArrays(e.TRIANGLES,0,6)},_drawBack:function(e){var t;image=e.canvas,t=this._createTexture(e,this._canvas),this._createVertexBuffer(e),e.viewport(0,0,image.width,image.height);var n=this._compileShader(this.SHADER.FRAGMENT_IDENTITY,e);this._drawBuffer(e,n,t,null,!1)},_resize:function(e,t,n){t==this._width&&n==this._height||(this._canvas.width=this._width=t,this._canvas.height=this._height=n,this._vertexBuffer||(this._vertexBuffer=this._createVertexBuffer(e)),e.viewport(0,0,this._width,this._height),this._tempFramebuffer=null)},_getTempFramebuffer:function(e){return this._tempFramebuffer=this._tempFramebuffer||this._createFramebufferTexture(e,this._width,this._height),this._tempFramebuffer},_createFramebufferTexture:function(e,t,n){var i=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,i);var o=e.createRenderbuffer();e.bindRenderbuffer(e.RENDERBUFFER,o);var r=e.createTexture();return e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t,n,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0),e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),{fbo:i,texture:r}},_draw:function(e,t){var n=this._sourceTexture;this._drawBuffer(e,e._currentProgram,n,null,!1)},_compileShader:function(e,t){if(e.__program)return t._currentProgram=e.__program,t.useProgram(t._currentProgram.id),t._currentProgram;var n=new r(t,this.SHADER.VERTEX_IDENTITY,e),i=Float32Array.BYTES_PER_ELEMENT,o=4*i;return t.enableVertexAttribArray(n.attribute.pos),t.vertexAttribPointer(n.attribute.pos,2,t.FLOAT,!1,o,0*i),t.enableVertexAttribArray(n.attribute.uv),t.vertexAttribPointer(n.attribute.uv,2,t.FLOAT,!1,o,2*i),e.__program=t._currentProgram=n,n},SHADER:{VERTEX_IDENTITY:["precision highp float;","attribute vec2 pos;","attribute vec2 uv;","varying vec2 vUv;","uniform float flipY;","void main(void) {","vUv = uv;","gl_Position = vec4(pos.x, pos.y*flipY, 0.0, 1.);","}"].join("\n"),FRAGMENT_IDENTITY:["precision highp float;","varying vec2 vUv;","uniform sampler2D texture;","void main(void) {","gl_FragColor = texture2D(texture, vUv);","}"].join("\n")},_sharpen:function(e,t){var n=t||1;this._convolution.call(this,e,[0,-1*n,0,-1*n,1+4*n,-1*n,0,-1*n,0])},_convolution:function(e,t){var n=new Float32Array(t),i=1/this._width,o=1/this._height,r=this._compileShader(this._convolution_SHADER,e);e.uniform1fv(r.uniform.m,n),e.uniform2f(r.uniform.px,i,o),this._draw(e)},_convolution_SHADER:["precision highp float;","varying vec2 vUv;","uniform sampler2D texture;","uniform vec2 px;","uniform float m[9];","void main(void) {","vec4 c11 = texture2D(texture, vUv - px);","vec4 c12 = texture2D(texture, vec2(vUv.x, vUv.y - px.y));","vec4 c13 = texture2D(texture, vec2(vUv.x + px.x, vUv.y - px.y));","vec4 c21 = texture2D(texture, vec2(vUv.x - px.x, vUv.y) );","vec4 c22 = texture2D(texture, vUv);","vec4 c23 = texture2D(texture, vec2(vUv.x + px.x, vUv.y) );","vec4 c31 = texture2D(texture, vec2(vUv.x - px.x, vUv.y + px.y) );","vec4 c32 = texture2D(texture, vec2(vUv.x, vUv.y + px.y) );","vec4 c33 = texture2D(texture, vUv + px );","gl_FragColor = ","c11 * m[0] + c12 * m[1] + c22 * m[2] +","c21 * m[3] + c22 * m[4] + c23 * m[5] +","c31 * m[6] + c32 * m[7] + c33 * m[8];","gl_FragColor.a = c22.a;","}"].join("\n")};window.WebGLImageFilter=function(){_.assign(this,t)}}((this||0).self||global),function(l){var i,n,e,t,o,r,h=l.cc,_=l._,d=l.console;h.Node.prototype.getFullPath=function(){if(!_.isUndefined(this)){for(var e=this,t=function(e){return e.getName()||"<"+e._className+">"},n=t(this);e.parent;)n=t(e=e.parent)+"."+n;return n}},h.Node.prototype.addChild=(o=h.Node.prototype.addChild,r=0,function(){r++,o.apply(this,arguments),1==r--&&h.eventManager._setDirtyForNode(arguments[0])}),ccui.Widget.prototype._onSizeChanged=(t=ccui.Widget.prototype._onSizeChanged,function(){this.__previousSize&&this.__previousSize.width==this.width&&this.__previousSize.height==this.height||(this.__previousSize={width:this.width,height:this.height},t.apply(this,arguments))}),h.Node.prototype.appendTo=function(e,t){e.addChild(this,t)},h.Node.prototype.__defineGetter__("disposed",function(){return 1==this.__disposed}),h.Node.prototype.onExit=(e=h.Node.prototype.onExit,function(){this.__disposed=!0,e.apply(this,arguments)}),h.Node.prototype.onEnter=(n=h.Node.prototype.onEnter,function(){if(!this.__entered)return this.__entered=!0,void n.apply(this,arguments);var e=h.director.getRunningScene();if(e.__pendingTasks){var t="oen"+this.__instanceId;e.__pendingTasks[t]||(e.__pendingTasks[t]=function(){n.apply(this,arguments)}.bind(this))}else n.apply(this,arguments)}),ccui.Scale9Sprite.prototype.setCapInsets=(i=ccui.Scale9Sprite.prototype.setCapInsets,function(e){var t=h.director.getRunningScene();if(t.__pendingTasks){var n="sci"+this.__instanceId;t.__pendingTasks[n]||(t.__pendingTasks[n]=function(){i.apply(this,[e])}.bind(this))}else i.apply(this,arguments)}),h.Node.prototype.adjustPropertyByTweenAction=function(e,t,n,i){var o=this[e+"TweenActionProgress"];return(o=null!=o?o.then(this._adjustPropertyByTweenAction.bind(this,e,t,n,i)):this._adjustPropertyByTweenAction(e,t,n,i)).then(function(){null!=this[e+"TweenActionProgress"]&&this[e+"TweenActionProgress"].isFulfilled()&&(this[e+"TweenActionProgress"]=null)}.bind(this)),this[e+"TweenActionProgress"]=o},h.Node.prototype._adjustPropertyByTweenAction=function(e,t,n,i){var o,r=Q.defer(),a=parseInt(this[e]);return o=_.isString(i)&&!_.isEmpty(i)?function(e,t){this[t]=Math.ceil(e)+i}:function(e,t){this[t]=Math.ceil(e)},this.updateTweenAction=o.bind(this),this.runAction(h.sequence(h.actionTween(n,e,a,t),h.callFunc(r.resolve))),r.promise},h.Node.prototype.seekWidgetByName=function(e){return ccui.helper.seekWidgetByName(this,e)},h.Node.prototype.bfsWidgetByName=function(e){var t=[];for(Array.prototype.push.apply(t,this.getChildren());0<t.length;){var n=t.shift();if(n.getName()===e)return n;Array.prototype.push.apply(t,n.getChildren())}},h.Node.prototype.seekWidgetByPath=function(e){return e.replace(/\*\/?/g,"").split(/\.+/).reduce(function(e,t){return""===t?e:null==e?e:e.seekWidgetByName(t)},this)},h.Node.prototype.seekWidgets=function(t,n){return n||(n=[]),t(this)&&n.push(this),_.each(this.children,function(e){e.seekWidgets(t,n)}),n},h.Node.prototype.setStrings=function(e){return _.each(e,function(e,t){try{this.seekWidgetByName(t).setString(e)}catch(e){l.console.error(e)}},this),this},h.Node.prototype.setHtmlStrings=function(s,c){var u=function(n){var e=n.shift();if(void 0===e)return d.warn("setHtmlStrings: nodename not properly passed"),Q.resolve();var i=Q.defer(),t=s[e];try{var o=this.seekWidgetByName(e);if(!o)return d.warn("setHtmlStrings: imageView not found"),Q.resolve();if(!o instanceof ccui.ImageView)return void l.console.error("node is not ImageView: ".nodeName);var r=o.getContentSize(),a='<div class="text_common" style="width: '+r.width+"px; height: "+r.height+'px">'+t+"</div>";kh.convertHTMLToTexture(a,r,c).then(function(e){var t=o.getVirtualRenderer();t.initWithTexture(e),t.setAnchorPoint(0,0),t.setVisible(!0),u(n).then(function(){i.resolve()})}).fail(function(e){d.error(error)})}catch(e){l.console.error(e)}return i.promise}.bind(this);return u(_.keys(s))},h.Node.prototype.loadTextures=function(e){return _.each(e,function(e,t){try{var n=this.seekWidgetByName(t);e=_.isArray(e)?e:[e],n.loadTexture.apply(n,e)}catch(e){l.console.error(e)}},this),this},ccui.LoadingBar.prototype.animateRecursive=function(o,r,a,s){var c=function(){},u=function(e,t,n,i){var o=Q.defer();this.updateTweenAction=function(e){this.percent=e}.bind(this);var r=h.actionTween(e,"percent",t,n),a=h.callFunc(function(){i(),o.resolve()}),s=h.sequence(r,a);return this.runAction(s),c=function(e){e||this.stopAction(s),o.reject(this._name+": animateRecursive interrupted")}.bind(this),o.promise}.bind(this),l=Math.ceil(o/100);return _.map(_.range(l),function(e){var t=100,n=0;0===e&&(t-=n=this.percent);var i=r;return l-1<=e&&(t=(o%100||100)-n),i*=Math.min(5,Math.max(1,l-e-2)),u.bind(this,Math.abs(t)/i,n,n+t,a.bind(s,e))},this).reduce(Q.when,Q()).fail(function(e){d.log(e)}),function(e){c(e)}}}((this||0).self||global),function(i){var o=i.cc,r=i.khutil;o.Node.prototype.getAction=function(){var e=this===o.director.getRunningScene()?this.resource.action:this.getActionManager().getActionByTag(this.tag,this);return e||(i.console.warn("action not found on node: ",this.getName()),{})},o.Node.prototype.getAnimInfo=function(e){var t=this.getAction();if(!t.animationInfo)return{};var n=t.animationInfo[e];return n?{animInfo:n,action:t}:(i.console.warn("animation not found: ",e),{})},o.Node.prototype.animate=function(e,t){var n=this.getAnimInfo(e);if(_.isEmpty(n.action))return Q.resolve();this===o.director.getRunningScene()&&this.resource&&this.resource.node&&void 0===this._currentlyPlayingAnimation&&this.resource.node.runAction(n.action),kh.createInstance("notificationCenter").dispatchEvent("startAnimation:"+e);var i=t?Q.resolve():r.getPromiseWhenAnimationEnd(n.action,n.animInfo.endIndex);return n.action.gotoFrameAndPlay(n.animInfo.startIndex,n.animInfo.endIndex,t),this._currentlyPlayingAnimation=e,i.then(function(){this._currentlyPlayingAnimation=null,kh.createInstance("notificationCenter").dispatchEvent("endAnimation:"+e)}.bind(this))},o.Node.prototype.skipCurrentlyPlayingAnimation=function(){var e=this._currentlyPlayingAnimation;null!=e&&this.changeFrameWithAnimInfo(e,"end",!0)},o.Node.prototype.getCurrentlyPlayingAnimation=function(){return null==this._currentlyPlayingAnimation?"":this._currentlyPlayingAnimation},o.Node.prototype.changeFrame=function(e){var t=this.getAction();t.gotoFrameAndPause&&t.gotoFrameAndPause(e)},o.Node.prototype.changeFrameWithAnimInfo=function(e,t,n){var i=this.getAnimInfo(e);if(i.action){var o=i.animInfo[t.toLowerCase()+"Index"];return n?void i.action.gotoFrameAndPlay(o,o,!1):void i.action.gotoFrameAndPause(o)}},o.Node.prototype.setAppearance=function(e){if("hide"===e)this.setVisible(!1);else if("show"===e)this.setVisible(!0);else{var t=e;this.changeFrameWithAnimInfo(t,"start")}}}((this||0).self||global),function(e){var n,i,o=e.cc;o.spriteFrameCache.searchSpriteFrame=function(e){if(this.getSpriteFrame(e))return this.getSpriteFrame(e);var n,i=e.replace(/^(?:\.\.\/)+/,"");return this.getSpriteFrame(i)?this.getSpriteFrame(i):(_.each(this._spriteFrames,function(e,t){if(-1!==t.search(i))return n=e,!1}),n)},i=o.spriteFrameCache.getSpriteFrame,o.spriteFrameCache.getSpriteFrame=function(e){var t=i.call(this,e);return t&&t._texture&&t._texture.url&&o.loader.getRes(t._texture.url),t},n=o.spriteFrameCache._getFrameConfig,o.spriteFrameCache._getFrameConfig=function(e){var t=o.loader.getRes(e);return o.assert(t,o._LogInfos.spriteFrameCache__getFrameConfig_2,e),t._inited?this._frameConfigCache[e]=t:n.call(this,e)}}((this||0).self||global),function(e){var n,t=e.kh,o=e.ccui;e.cc,e._,o.Widget.prototype._enableSound=!1,o.Widget.prototype.setSoundEnabled=function(e){this._enableSound=e},o.Widget.prototype.setSound=function(e){this._sound=e},o.Widget.prototype.playTouchSE=function(){(new t.SE).play(this._sound)},o.Widget.prototype.addTouchEventListener=(n=o.Widget.prototype.addTouchEventListener,function(e,t){e=function(n){if(null!=n){var i=this;return function(e,t){return t===o.Widget.TOUCH_BEGAN&&e._enableSound&&i.playTouchSE(),t!==o.Widget.TOUCH_ENDED?n.call(this,e,t):void n.call(this,e,t)}}}.bind(this)(e),n.call(this,e,t)})}((this||0).self||global),function(e){var t=(e.kh,e.ccui);e.cc,e._,t.Button.prototype._enableSound=!0}((this||0).self||global),function(e){var n,i=(e.kh,e.ccui),o=(e.cc,e._);i.Button.prototype.shrink=function(e){this._isShrinkEffectEnabled&&(this.ignoreShrinkEffect||(o.isUndefined(this._originalScale)&&(this._originalScale=this.getScale()||1),this.adjustAnchorPointAndPosition(),this.setScale(this._shrunk?this._originalScale:.9*this._originalScale),this._shrunk=e))},i.Button.prototype.adjustAnchorPointAndPosition=function(){var e=this.getAnchorPoint(),t=.5-e.x,n=.5-e.y;0==t&&0==n||(this.setAnchorPoint(.5,.5),this.setPosition(this.x+t*this.width,this.y+n*this.height))},o.each(["loadTextureNormal","loadTexturePressed"],function(e){var t;i.Button.prototype[e]=(t=i.Button.prototype[e],function(){t.apply(this,arguments),this._isShrinkEffectEnabled=this._normalFileName===this._clickedFileName})}),i.Button.prototype.addTouchEventListener=(n=i.Button.prototype.addTouchEventListener,function(e,t){e=o.isFunction(e)?function(n){return function(e,t){t===i.Widget.TOUCH_BEGAN&&e.shrink(!0),t!==i.Widget.TOUCH_ENDED&&t!==i.Widget.TOUCH_CANCELED||e.shrink(!1),n.call(this,e,t)}}.bind(this)(e):e,n.call(this,e,t)})}((this||0).self||global),function(e){var i=e.ccui;_.each(["Normal","Pressed","Disabled"],function(e){var n,t="loadTexture"+e;i.Button.prototype[t]=(n=i.Button.prototype[t],function(e,t){"core/res/btn/btn_clear.png"!==e&&n.apply(this,arguments)}),t=null})}((this||0).self||global),function(e){var t=e.ccs,n=e._;t.Tween.prototype._tweenColorTo=t.Tween.prototype.tweenColorTo,t.Tween.prototype.resumeColorAnimations=function(){this.tweenColorTo=this._tweenColorTo},t.Tween.prototype.pauseColorAnimations=function(){this.tweenColorTo=function(){}},t.ArmatureAnimation.prototype.pauseColorAnimations=function(){n.invoke(this._tweenList,"pauseColorAnimations")},t.ArmatureAnimation.prototype.resumeColorAnimations=function(){n.invoke(this._tweenList,"resumeColorAnimations")}}((this||0).self||global),function(e){var t=e.ccui;t.Widget.prototype.extractCurrentTouchEvent=function(){function e(e,t){n&&n(e,t),o&&i&&i.call(o,e,t)}var n=this._touchEventCallback,i=this._touchEventSelector,o=this._touchEventListener;return{emulateTouchBegan:function(){e(this,t.Widget.TOUCH_BEGAN)}.bind(this),emulateTouchEnded:function(){e(this,t.Widget.TOUCH_ENDED)}.bind(this),restore:function(){this._touchEventCallback=n,this._touchEventListener=o,this._touchEventSelector=i}.bind(this)}}}((this||0).self||global),function(n){var e,i=n.cc;n._,i.LoaderScene.prototype.init=function(){return!0},i.LoaderScene.prototype.onExit=function(){i.Node.prototype.onExit.call(this)},i.LoaderScene.prototype._startLoading=function(){var e=this;e.unschedule(e._startLoading);var t=e.resources;i.loader.load(t,function(e,t,n){},function(){e.cb&&e.cb(),e.resources=[],n.gResources=[]})},i.LoaderScene.preload=(e=i.LoaderScene.preload,function(){return kh.postMessage("deployLoading"),e.apply(i.LoaderScene,arguments)})}((this||0).self||global),function(e){function a(t,e,n){var i=new Image,o=Resource.make(t.path,i);c.loader.addCache(o),c.loader.setAliases(t.path,o.getIdVO().id);var r=URL.createObjectURL(e);if(i.decode)return i.src=r,void i.decode().then(null,function(e){return i.src=t.src,i.decode()}).then(function(){URL.revokeObjectURL&&URL.revokeObjectURL(r),n(null,i)},function(e){n(e.message+":"+t.src,null)});t=null;var a=function(){n(null,i),i.removeEventListener("load",a),i.removeEventListener("error",s),URL.revokeObjectURL&&URL.revokeObjectURL(r)},s=function(e){n(e,null),i.removeEventListener("load",a),i.removeEventListener("error",s),URL.revokeObjectURL&&URL.revokeObjectURL(r)};i.addEventListener("load",a,!1),i.addEventListener("error",s,!1),i.src=r}var c=e.cc;if(!0!==c.sys.isNative){c.loader.register(["inlinejson"],{load:function(e,t,n,i){if("object"==typeof n||"object"==typeof n.json){var o=Resource.make(n.src,n.json);c.loader.addCache(o),i(null,n.json)}else i("inlineJsonが解釈できません:"+t)}}),c.loader.register(["inlineplist"],{load:function(e,t,n,i){if("object"==typeof n||"object"==typeof n.plist){c.loader.setAliases(n.name,n.src);var o=n.plist;"function"==typeof c.spriteFrameCache._parseFrameConfig&&void 0===o.maxParticles&&(o=c.spriteFrameCache._parseFrameConfig(o));var r=Resource.make(n.src,o);c.loader.addCache(r),i(null,o)}else i("inlinePlistが解釈できません:"+t)}});var s=null!=window.createImageBitmap;c.loader.register(["inlinepng","inlinejpg"],{load:function(e,t,n,i){var o=i||console.error,r=function(e){for(var t=e.split(","),n=t[0].match(/:(.*?);/)[1],i=atob(t[1]),o=i.length,r=new Uint8Array(o);o--;)r[o]=i.charCodeAt(o);return new Blob([r],{type:n})}(n.src);return s&&!kh.env.isSp?void window.createImageBitmap(r,{premultiplyAlpha:"premultiply"}).then(function(e){var t=Resource.make(n.path,e);c.loader.addCache(t),c.loader.setAliases(n.path,t.getIdVO().id),o(null,e)},function(){a(n,r,o)}):void a(n,r,o)}}),c.loader.register(["resourcejson"],{load:function(e,t,n,i){c.loader.loadJson(e,function(e,t){err&&i(err),c.loader.load(t,i)})}}),c.loader.register(["inlinefnt"],{load:function(e,t,n,i){var o=n.fnt,r=Resource.make(t,o);c.loader.addCache(r),i(null,o)}})}}((this||0).self||global),function(e){e.$staticRes=function(){return arguments[0]},e.$dynamicRes=function(){return arguments[0]}}((this||0).self||global),function(e){var t=Q.defer;Q.defer=function(){var e=t.apply(Q,arguments);if(!_.isUndefined(e))return e.promise.fail(n).done(n),e};var n=function(){var e=Q.getUnhandledReasons();Q.resetUnhandledRejections(),e.forEach(function(e){if("Product"!==kh.env.mode&&console.assert&&"(no stack) override"!==String(e)&&console.assert(!1,e),e&&!(-1<String(e).indexOf("(no stack"))){if(e.stack)return void console.error(e);kh.createInstance("smartBeat").log(e),kh.createInstance("smartBeat").sendError(new Error(e.substring(0,e.indexOf("\n"))))}})};e.Promise&&!Promise.prototype.fail&&(Promise.prototype.fail=Promise.prototype.catch)}((this||0).self||global),(this||0).self||global,superagent&&(superagent.Request.prototype.crossDomainError=function(){var e=this.url.replace(/\?.*$/,"").replace(/htt(p|ps)\:\/\//,"$1#"),t=location.href.replace(/\?.*$/,"").replace(/htt(p|ps)\:\/\//,"$1#");if(e.replace(/\/.*$/,"")!==t.replace(/\/.*$/,"")&&null===e.match(/\/error\/(js|com)$/)){var n=new Error("Cross Domain Problem from= "+t+" to= "+e);n.crossDomain=!0,this.callback(n)}else console.debug("通信キャンセル？",e),this.emit("end")}),function(e){var t=e.ccs;t.Timeline.prototype._binarySearchKeyFrame=function(e){var t=null,n=null,i=this._frames.length,o=!1;this._fromIndex=0,this._toIndex=0;do{if(e<this._frames[0].getFrameIndex()){this._currentKeyFrameIndex>=this._frames[0].getFrameIndex()&&(o=!0,t=n=this._frames[0]),this._fromIndex=0,this._toIndex=0,this._currentKeyFrameIndex=0,this._betweenDuration=this._frames[0].getFrameIndex();break}if(e>=this._frames[i-1].getFrameIndex()){this._currentKeyFrameIndex!=this._frames[i-1].getFrameIndex()&&(o=!0),this._fromIndex=i-1,this._toIndex=0,t=n=this._frames[i-1],this._currentKeyFrameIndex=this._frames[i-1].getFrameIndex(),this._betweenDuration=0;break}for(var r=-1,a=0,s=i-1,c=0;a<=s;){if(c=Math.ceil((a+s)/2),e>=this._frames[c].getFrameIndex()&&e<this._frames[c+1].getFrameIndex()){r=c;break}this._frames[c].getFrameIndex()>e?s=c-1:a=c+1}this._fromIndex=r,this._toIndex=1<i?r+1|0:0|r,t=this._frames[this._fromIndex],n=this._frames[this._toIndex],t=this._frames[r],n=this._frames[r+1],0===r&&this._currentKeyFrameIndex<t.getFrameIndex()&&(o=!0),this._currentKeyFrameIndex=t.getFrameIndex(),this._betweenDuration=n.getFrameIndex()-t.getFrameIndex()}while(0);null==t||!o&&this._currentKeyFrame==t&&1!==this._betweenDuration&&t!==n||(this._fromIndex=this._frames.indexOf(t),this._toIndex=this._frames.indexOf(n),this._currentKeyFrame=t,this._currentKeyFrame.onEnter(n))},t.Timeline.prototype._updateCurrentKeyFrame=function(e){if(e<this._currentKeyFrameIndex||e>=this._currentKeyFrameIndex+this._betweenDuration){var t=null,n=null;do{var i=this._frames.length;if(e<this._frames[0].getFrameIndex()){t=n=this._frames[0],this._currentKeyFrameIndex=0,this._betweenDuration=this._frames[0].getFrameIndex();break}if(e>=this._frames[i-1].getFrameIndex()){var o=this._frames[i-1].getFrameIndex();if(this._currentKeyFrameIndex===o)return;e=o,this._betweenDuration=0}for(;(this._fromIndex=this._toIndex,t=this._frames[this._fromIndex],this._currentKeyFrameIndex=t.getFrameIndex(),this._toIndex=this._fromIndex+1,this._toIndex>=i&&(this._toIndex=0),n=this._frames[this._toIndex],e!==t.getFrameIndex())&&!(e>t.getFrameIndex()&&e<n.getFrameIndex());)t.isEnterWhenPassed()&&t.onEnter(n);this._betweenDuration=Math.max(n.getFrameIndex()-t.getFrameIndex(),0)}while(0);this._currentKeyFrame=t,this._currentKeyFrame.onEnter(n)}}}((this||0).self||global),function(e){var i,o=e.cc;e._,o.Color.prototype.toString=function(){return"rgba("+this.r+","+this.g+","+this.b+","+this.a+")"},o.LabelTTF.__getFontHeightByDiv=(i=o.LabelTTF.__getFontHeightByDiv,function(e,t){var n=o.LabelTTF.__labelHeightDiv;return n.style["line-height"]="1",n.style.padding="0.2em 0",i.call(this,e,t)})}((this||0).self||global),function(e){var a,t=e.cc;e._,t.LabelBMFont.prototype.initWithString=(a=t.LabelBMFont.prototype.initWithString,function(e,t,n,i,o){var r="number"==typeof e?String(e):e;return a.call(this,r,t,n,i,o)})}((this||0).self||global),function(e){var t=e.ccs;Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,value:function n(){var i=isNaN(arguments[0])?1:Number(arguments[0]);return i?Array.prototype.reduce.call(this,function(e,t){return Array.isArray(t)?e.push.apply(e,n.call(t,i-1)):e.push(t),e},[]):Array.prototype.slice.call(this)},writable:!0}),Array.prototype.flatMap||Object.defineProperty(Array.prototype,"flatMap",{configurable:!0,value:function(e){return Array.prototype.map.apply(this,arguments).flat()},writable:!0}),t.ActionTimeline=t.ActionTimeline.extend({ctor:function(){this._super.apply(this,arguments),this.animationInfo=this._animationInfos,this._eventInfo=null},hasFrameEvent:function(e){return this._eventInfo||(this._eventInfo=this._timelineList.flatMap(function(e){return e.getFrames()}).filter(function(e){return e instanceof t.EventFrame}).map(function(e){return e.getEvent()})),-1!==this._eventInfo.indexOf(e)},_stepToFrame:function(e){for(var t=this._timelineList.length,n=0;n<t;n++){var i=this._timelineList[n];null!=i&&i._stepToFrame(e)}},_gotoFrame:function(e){for(var t=this._timelineList.length,n=0;n<t;n++){var i=this._timelineList[n];null!=i&&i._gotoFrame(e)}}})}((this||0).self||global),(this||0).self||global,ccs.AnchorPointFrame.prototype.onEnter=function(e){this._node.setAnchorPoint(this._anchorPoint),this._tween&&(this._betweenX=e._anchorPoint.x-this._anchorPoint.x,this._betweenY=e._anchorPoint.y-this._anchorPoint.y)},ccs.AnchorPointFrame.prototype.apply=function(e){if(this._tween&&(0!=this._betweenX||0!=this._betweenY)){var t=cc.p(0,0);t.x=this._anchorPoint.x+this._betweenX*e,t.y=this._anchorPoint.y+this._betweenY*e,this._node.setAnchorPoint(t)}},(this||0).self||global,ccs.InnerActionFrame.prototype.onEnter=function(e){if(this._node){var t=this._node.getActionByTag(this._node.getTag());if(null!=t){if(ccs.InnerActionType.SingleFrame===this._innerActionType)return void t.gotoFrameAndPause(this._singleFrameIndex);var n=this._startFrameIndex,i=t.getDuration();if(this._enterWithName)if("-- ALL --"==this._animationName)n=0,i=t.getDuration();else if(t.isAnimationInfoExists(this._animationName)){var o=t.getAnimationInfo(this._animationName);n=o.startIndex,i=o.endIndex}else cc.log("Animation %s not exists!",this._animationName);ccs.InnerActionType.NoLoopAction==this._innerActionType?t.gotoFrameAndPlay(n,i,!1):ccs.InnerActionType.LoopAction==this._innerActionType&&t.gotoFrameAndPlay(n,i,!0)}}},function(e){var s=e.ccs,c=e.ccui,u=e.khutil,t=s._load.getParser(),l=t.timeline["2.*"];l._initProjectNodeDirect=(l.initProjectNode,function(e,t){var n=e.FileData;if(null!=n&&n.Path){var i=u.resolvePath(t+n.Path);if(cc.loader.getRes(i)){var o=s.load(i,t);if(l.generalAttributes(o.node,e),o.action&&o.node){o.action.tag=o.node.tag;var r=e.InnerActionSpeed;o.action.setTimeSpeed(void 0!==r?r:.5),o.node.runAction(o.action),o.action.gotoFrameAndPause(0)}return o.node}cc.log("%s need to be preloaded",i)}var a=new c.Widget;return this.generalAttributes(a,e),a});function n(e){var t=new c.Widget;return this.generalAttributes(t,e),t}function a(e){e.enableStroke(cc.color(60,60,60),1.6)}var o,h,r,i,_=(r=l.initButton,function(t,e){var n=r.apply(this,arguments);n.setTitleFontName(t.FontName||"GameFont"),n._titleRenderer.setVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_CENTER);var i=n.getTitleColor();"boolean"==typeof t.OutlineEnabled||i.g<60&&i.b<60||a(n.getTitleRenderer());var o=n._buttonNormalRenderer;return!o._textureLoaded&&t.Scale9Enable&&o.addEventListener("load",function(){n.scheduleOnce(function(){var e=cc.rect(t.Scale9OriginX||0,t.Scale9OriginY||0,t.Scale9Width||0,t.Scale9Height||0);n.setCapInsets(e)},.1)}),n});[{name:"SingleNodeObjectData",handle:function(e){return e.anchorPointX=e.anchorPointX||0,e.anchorPointY=e.anchorPointY||0,this.initSingleNode(e)}},{name:"ProjectNodeObjectData",handle:function(t,n){var e=t.FileData;if(null==e||!e.Path)return this._initProjectNodeDirect(t,n);var i=e.Path,o=cc.director.getRunningScene();if(!o._delegate)return this._initProjectNodeDirect(t,n);if((o._delegate._delayNodes||[]).indexOf(i)<0)return this._initProjectNodeDirect(t,n);var r=new c.Widget;return o.__pendingTasks=o.__pendingTasks||{},o.__pendingTasks[r.__instanceId]=function(){var e=r.parent;e.removeChild(r),r=this._initProjectNodeDirect(t,n),e.addChild(r),r.setVisible(!1)}.bind(this),r}},{name:"LayerObjectData",handle:n},{name:"NodeObjectData",handle:n},{name:"LayerObjectData",handle:n},{name:"GameNodeObjectData",handle:n},{name:"GameLayerObjectData",handle:n},{name:"TextObjectData",handle:(h=l.initText,function(e,t){var n=h.apply(this,arguments),i=e.FontSize;n.origFontSize=i,n.setFontName(e.FontName||"GameFont");var o=e.IsCustomSize;null!=o?n.ignoreContentAdaptWithSize(!o):n.ignoreContentAdaptWithSize(!0),n._isCustomSize=!1!==o;var r=n.getTextColor();return"boolean"==typeof e.OutlineEnabled||r.g<60&&r.b<60||(a(n._labelRenderer),n.setFontSize(i-1)),cc.sys.os===cc.sys.OS_WINDOWS&&(n._labelRenderer.setLineHeight(n._labelRenderer.getLineHeight()-Math.floor(.08*i)),n._labelRenderer._strokeEnabled||n.setFontSize(i-1)),n})},{name:"ButtonObjectData",handle:_},{name:"TextBMFontObjectData",handle:(o=l.initTextBMFont,function(e,t){var n=o.apply(this,arguments),i=e.IsCustomSize;return n.ignoreContentAdaptWithSize(!1!==i),n})},{name:"SimpleAudioObjectData",handle:function(e,t){var n=new s.ComAudio,i=e.Loop||!1;if(n.setLoop(i),e.FileData&&e.FileData.Path){var o=u.resolvePath(t+e.FileData.Path);n.setFile(o),n.preloadBackgroundMusic(o)}n.onExit=function(){this.unloadEffect(this.getFile())};var r=new c.Widget,a=new s.ComExtensionData;return a.setActionTag(e.ActionTag||0),r.addComponent(a),r.setTag(e.Tag||0),r.addComponent(n),r.setName(e.Name||"sound_data_"+r.getTag()),r}}].forEach(function(o){l.registerParser(o.name,function(e,t){var n=t;0===n.indexOf("res/")&&(n="../"+kh.createInstance("router").getCurrentComponent()+"/"+n);var i=o.handle.call(this,e,n);return this.parseChild(i,e.Children,n),i&&(i.__parserName=o.name),i})}),s._load.registerParser("timeline","2.*",l),s._load.registerParser("timeline","*",l),t.action["2.*"].parseNode=function(e,i,t){if(!e)return null;var o=this,r=new s.ActionTimeline;return r.setDuration(e.Duration),r.setTimeSpeed((e.Speed||1)/2),e.Timelines.forEach(function(e){var t,n=o.parsers[e.Property];n?t=n.call(o,e,i):cc.log("parser does not exist : %s",e.Property),t&&r.addTimeline(t)}),r},s.load=(i=s.load,function(e){var t=i.call(i,u.resolvePath(e));return t.node&&t.action&&t.node.runAction(t.action),t}),s.load.validate={},s.load.preload=!0}((this||0).self||global),function(e){var i,n,o=e.ccui;o.Button.prototype._copySpecialProperties=(n=o.Button.prototype._copySpecialProperties,function(e){if(n.call(this,e),e instanceof o.Button){var t=e.getTitleRenderer();t._strokeEnabled&&this.getTitleRenderer().enableStroke(t._strokeColor,t._strokeSize)}}),o.Button.prototype.setColor=(i=cc.Node.prototype.setColor,function(){var e=arguments[0];if(!(e instanceof cc.Color))return i.apply(this,arguments);var t=this.getColor();if(t.r===e.r&&t.g===e.g&&t.b===e.b)return i.apply(this,arguments);if(!(e.r<255&&e.r===e.g&&e.g===e.b))return i.apply(this,arguments);var n=e.r*e.r/255;return i.apply(this,[cc.color(n,n,n)])})}((this||0).self||global),function(e){var t,n=e.ccui;n.ImageView.prototype.loadTexture=(t=n.ImageView.prototype.loadTexture,function(){var e=arguments[0];this._imageRenderer&&(this._imageRenderer.setVisible(!!e),!e)||t.apply(this,arguments)})}((this||0).self||global),function(e){var c=e.cc,u=e._;c.eventManager._dispatchTouchEvent=function(e){this._sortEventListeners(c._EventListenerTouchOneByOne.LISTENER_ID),this._sortEventListeners(c._EventListenerTouchAllAtOnce.LISTENER_ID);var t=this._getListeners(c._EventListenerTouchOneByOne.LISTENER_ID),n=this._getListeners(c._EventListenerTouchAllAtOnce.LISTENER_ID);if(null!=t||null!=n){var i=e.getTouches(),o={event:e,needsMutableSet:t&&n,touches:c.copyArray(i),selTouch:null};if(t)for(var r=0;r<i.length;r++)if(o.selTouch=i[r],this._dispatchEventToListeners(t,this._onTouchEventCallback,o),e.isStopped())return;n&&0<i.length&&(this._dispatchEventToListeners(n,this._onTouchesEventCallback,{event:e,touches:i}),e.isStopped())||this._updateListeners(e)}},c.eventManager._sortListenersOfSceneGraphPriority=function(e,t){var n=this._getListeners(e);if(n){var i=n.getSceneGraphPriorityListeners();if(i&&0!==i.length){this._nodePriorityIndex=0,this._nodePriorityMap={},this._visitTarget(t,!0);var o=n.getSceneGraphPriorityListeners(),r=c.eventManager._nodePriorityMap,a=u.filter(o,function(e){var t;return!!e&&!!(t=e._getSceneGraphPriority())&&!!r[t.__instanceId]}),s=u.reject(o,function(e){var t;return!!e&&!!(t=e._getSceneGraphPriority())&&!!r[t.__instanceId]});a.sort(this._sortEventListenersOfSceneGraphPriorityDes),this._listenersMap[e]._sceneGraphListeners=a.concat(s)}}}}((this||0).self||global),function(e){var t,a,s=e.cc,n=e.ccui;n.Text.prototype._labelScaleChangedWithSize=(a=n.Text.prototype._labelScaleChangedWithSize,function(){a.apply(this,arguments);var e=this._contentSize,t=0,n=0;if(this.getTextVerticalAlignment()===s.VERTICAL_TEXT_ALIGNMENT_TOP){var i=Math.ceil(Math.max(0,Math.sqrt(this.getFontSize())));t=e.height-i-(this._labelRenderer._strokeEnabled?1:-2),n=1}else this.getTextVerticalAlignment()===s.VERTICAL_TEXT_ALIGNMENT_CENTER?(t=e.height/2,n=.5):t+=5+(this._labelRenderer._strokeEnabled?1:0);var o=0,r=0;this.getTextHorizontalAlignment()===s.TEXT_ALIGNMENT_RIGHT?(o=e.width,r=1):this.getTextVerticalAlignment()===s.TEXT_ALIGNMENT_CENTER?(o=e.width/2,r=.5):o=2,this._labelRenderer.setAnchorPoint(r,n),this._labelRenderer.setPosition(o,t)}),n.Text.prototype.onEnter=function(){n.Widget.prototype.onEnter.apply(this,arguments);var e=this.origFontSize||this.getFontSize();this.setFontSize(e)},n.Text.prototype._copySpecialProperties=(t=n.Text.prototype._copySpecialProperties,function(e){e instanceof n.Text&&(t.call(this,e),this.setFontSize(e.origFontSize||e.getFontSize()),this.origFontSize=this.fontSize,e._labelRenderer._strokeEnabled&&this._labelRenderer.enableStroke(e._labelRenderer._strokeColor,e._labelRenderer._strokeSize))})}((this||0).self||global),function(e){var a=e.ccs;a.ArmatureAnimation.prototype.update=function(e){for(var t=this._tweenList,n=0;n<t.length;n++)t[n].update(e);a.ProcessBase.prototype.update.call(this,e);for(var i,o=this._frameEventQueue;0<o.length;)i=o.shift(),this._ignoreFrameEvent=!0,this._frameEventCallFunc&&this._frameEventCallFunc.call(this._frameEventTarget,i.bone,i.frameEventName,i.originFrameIndex,i.currentFrameIndex),this._frameEventListener&&this._frameEventListener(i.bone,i.frameEventName,i.originFrameIndex,i.currentFrameIndex),this._ignoreFrameEvent=!1;for(var r=this._movementEventQueue;0<r.length;)i=r.shift(),this._movementEventCallFunc&&this._movementEventCallFunc.call(this._movementEventTarget,i.armature,i.movementType,i.movementID),this._movementEventListener&&this._movementEventListener(i.armature,i.movementType,i.movementID)}}((this||0).self||global),function(e){var l=e.ccs;l.Tween.prototype.updateFrameData=function(e){1<e&&0!=this._movementBoneData.delay&&(e=l.fmodf(e,1));var t,n,i=this._rawDuration*e,o=this._totalDuration,r=this._betweenDuration,a=this._toIndex;if(i<o||o+r<=i){var s=this._movementBoneData.frameList,c=s.length;if(i<s[0].frameID)return t=n=s[0],this.setBetween(t,n),this._currentPercent;if(i>=s[c-1].frameID){if(this._passLastFrame)return t=n=s[c-1],this.setBetween(t,n),this._currentPercent;this._passLastFrame=!0}else this._passLastFrame=!1;do{if(this._fromIndex=a,o=(t=s[this._fromIndex]).frameID,c<=(a=this._fromIndex+1)&&(a=0),n=s[a],t.strEvent&&!this._animation.isIgnoreFrameEvent()&&this._animation.frameEvent(this._bone,t.strEvent,t.frameID,i),i==t.frameID||this._passLastFrame&&this._fromIndex==c-1)break}while(i<t.frameID||i>=n.frameID);r=n.frameID-t.frameID,this._frameTweenEasing=t.tweenEasing,this.setBetween(t,n,!1),this._totalDuration=o,this._betweenDuration=r,this._toIndex=a}e=0==r?0:(i-this._totalDuration)/this._betweenDuration;var u=this._frameTweenEasing!=l.TweenType.linear?this._frameTweenEasing:this._tweenEasing;return u==l.TweenType.tweenEasingMax||u==l.TweenType.linear||this._passLastFrame||(e=l.TweenFunction.tweenTo(e,u,this._from.easingParams)),e}}((this||0).self||global),function(e){var n,i;ccui.Widget.prototype.onTouchBegan=function(e,t){if(this._hit=!1,this.isVisible()&&this.isEnabled()&&this._isAncestorsEnabled()&&this._isAncestorsVisible(this)){var n=e.getLocation();this._touchBeganPosition.x=n.x,this._touchBeganPosition.y=n.y,this.hitTest(this._touchBeganPosition)&&this.isClippingParentContainsPoint(this._touchBeganPosition)&&(this._hit=!0)}return!!this._hit&&(this._propagateTouchEvents&&this.propagateTouchEvent(ccui.Widget.TOUCH_BEGAN,this,e),!!this._temporaryLockTimeout||(this._temporarilyLocked=!1,this.setHighlighted(!0),this._pushDownEvent(),!0))},ccui.Widget.prototype.onTouchMoved=(i=ccui.Widget.prototype.onTouchMoved,function(e,t){return this._isTemporaryLocked()?void(this.propagateTouchEvent&&this.propagateTouchEvent(ccui.Widget.TOUCH_MOVED,this,e)):void i.apply(this,arguments)}),ccui.Widget.prototype.onTouchEnded=function(e,t){if(this._isTemporaryLocked())this.propagateTouchEvent&&this.propagateTouchEvent(ccui.Widget.TOUCH_ENDED,this,e);else{var n=e.getLocation();this._touchEndPosition.x=n.x,this._touchEndPosition.y=n.y,this._propagateTouchEvents&&this.propagateTouchEvent(ccui.Widget.TOUCH_ENDED,this,e);var i=this._highlight;this.setHighlighted(!1),i?(this._releaseUpEvent(),this._setTemporarilyLocked()):this._cancelUpEvent()}},ccui.Widget.prototype.onTouchCanceled=(n=ccui.Widget.prototype.onTouchCanceled,function(e,t){return this._isTemporaryLocked()?void(this.propagateTouchEvent&&this.propagateTouchEvent(ccui.Widget.TOUCH_CANCELED,this,e)):void n.apply(this,arguments)}),ccui.Widget.prototype._setTemporarilyLocked=function(){this._temporarilyLocked=!0,this._temporaryLockTimeout=setTimeout(function(){delete this._temporaryLockTimeout}.bind(this),null==this._abuseLockTimeout?1e3:this._abuseLockTimeout)},ccui.Widget.prototype._isTemporaryLocked=function(){return this._temporarilyLocked},ccui.Widget.prototype.setLockTimeout=function(e){this._abuseLockTimeout=e}}((this||0).self||global),function(e){var a=e.cc;a.ContainerStrategy.prototype._setupContainer=function(e,t,n){var i=a.game.canvas,o=a.game.container;o.style.width=i.style.width=t+"px",o.style.height=i.style.height=n+"px";var r=e._devicePixelRatio=1;e.isRetinaEnabled()&&(r=e._devicePixelRatio=Math.min(2,window.devicePixelRatio||1)),a.sys.os!==a.sys.OS_IOS&&a.sys.os!==a.sys.Android||1.5<r&&(r=e._devicePixelRatio=1.5),i.width=t*r,i.height=n*r,a._renderContext.resetCache&&a._renderContext.resetCache()}}((this||0).self||global),function(e){function u(e){return 0<e.toLowerCase().indexOf(".png")}function t(){var c=/^([a-zA-Z0-9\-\_]+\/res\/.+?)/,e=l.textureCache;e.handleLoadedTexture=function(e){var t=this.getTextureForKey(e);t||((t=new l.Texture2D).url=e,this.cacheImage(e,t)),t.handleLoadedTexture(u(e))},e.addImage=function(t,n,i){if(l.assert(t,l._LogInfos.Texture2D_addImage_2),!t||"string"!=typeof t||t.endsWith("/")||t.endsWith("Sprite.png")){var o=new l.Texture2D;return n&&n(i,o),o}var e=this._textures;!1!==l.game._rendererInitialized&&!1!==l._rendererInitialized||(e=this._loadedTexturesBefore);var r=ResourceId.makeFromPath(t);if(o=e[r.id]||e[l.loader._getAliase(t)])return o.isLoaded()?n&&n.call(i,o):n&&o.addEventListener("load",n.bind(i,o),i),o;(o=e[r.id]=new l.Texture2D).url=r.getPath();var a=l.loader.getBasePath?l.loader.getBasePath():l.loader.resPath;t.startsWith("res/")?a="../"+kh.createInstance("router").getCurrentComponent()+"/":c.test(t)&&(a="../");var s=l.path.join(a||"",t);return l.loader.load(s,function(e){return e?n&&n.call(i,e):(o.initWithElement(l.loader.getRes(s)),o.handleLoadedTexture(u(t)),void(n&&n.call(i,o)))}),o},e.addImageAsync=e.addImage,e=null}var l=e.cc;l.textureCache.getTextureForKey=function(e){var t=this._textures[e]||this._textures[l.loader._getAliase(e)];if(t)return t;var n=e;return"string"==typeof e&&(n=ResourceId.makeFromPath(e)),this._textures[n.id]||this._textures[l.loader._getAliase(n.id)]},l.textureCache.removeTextureForKey=function(e){if(null!=e){var t=e;"string"==typeof e&&(t=ResourceId.makeFromPath(e));var n=this._textures[t.id];n&&(l.spriteFrameCache.removeSpriteFramesFromTexture(n),n.releaseTexture(),delete this._textures[t.id])}},l.textureCache.cacheImage=function(e,t){var n=e;if("string"==typeof e&&(n=ResourceId.makeFromPath(e)),t instanceof l.Texture2D)this._textures[n.id]=t;else{var i=new l.Texture2D;i.initWithElement(t),i.handleLoadedTexture(u(e)),this._textures[n.id]=i}},l.textureCache.addUIImage=function(e,t){var n;return l.assert(e,l._LogInfos.textureCache_addUIImage_2),t&&(n=this.getTextureForKey(t))||((n=new l.Texture2D).initWithImage(e),null!=t?this.cacheImage(t,n):l.log(l._LogInfos.textureCache_addUIImage)),n},t(),l.game.EVENT_RENDERER_INITED&&l.game.addEventListener(l.game.EVENT_RENDERER_INITED,t)}((this||0).self||global),function(e){var t,r=e.cc,o=window.__audioSupport.ONLY_ONE;r.audioEngine.playMusic=function(e,t){var n=this._currMusic;n&&n.src!==e&&n.getPlaying()&&n.stop();var i=r.loader.getRes(e);i||((i=new r.Audio).setElement(new Audio(e)),r.loader.addCache(Resource.make(e,i)));var o=new r.Audio;o.setElement(i._element.cloneNode()),o.play(0,t),o.setVolume(this._musicVolume),this._currMusic=o},r.audioEngine.playEffect=function(e,t){if(o&&this._currMusic&&this._currMusic.getPlaying())return r.log("Browser is only allowed to play one audio"),null;var n=r.loader.getRes(e);n||((n=new r.Audio).setElement(new Audio(e)),r.loader.addCache(Resource.make(e,n)));var i=new r.Audio;return i.setElement(n._element.cloneNode()),i.setVolume(this._effectVolume),i.play(0,t),i},ccs.ComAudio.prototype.preloadEffect=(t=ccs.ComAudio.prototype.preloadEffect,function(e){r.loader.getRes(e)||(console.warn("Sound effect not preloaded, attempting to preload before use: "+e),kh.createInstance("playerGameConfig").isSoundOn()&&r.loader.load(e)),t.call(this,arguments)})}((this||0).self||global),function(e){e.kh=e.kh||{};var t=e.kh||{};t.env=t.env||{};var n=e.cc;t.env.platform="dmm",t.env.apiVersion="v1",t.env.isSp=void 0===n?-1===location.origin.indexOf(t.env.platform):640===n.game.config.designWidth,t.env.isIOS=void 0===n?/iPhone|iPad|iPod/.test(navigator.userAgent):!(!n||n.sys.os!==n.sys.OS_IOS);var i=window.navigator.userAgent.toLowerCase();t.env.isIE=!(!i.match(/(msie|MSIE)/)&&!i.match(/(T|t)rident/)),/Chrome/.test(navigator.userAgent)&&/Version/.test(navigator.userAgent),t.env.isAndroid=/Android/.test(navigator.userAgent);var o=!(!window.AudioContext&&!window.webkitAudioContext);t.env.needSoundTouchField=t.env.isIOS||t.env.isAndroid&&o;var r=(t.env.mode="Product")===t.env.mode,a=(t.env.mode,t.env.mode,"Localhost"===t.env.mode);t.env.urlRootBase=location.origin,t.env.imgRootBase="/resources",t.env.scenarioRootBase="/resources/scenarios",t.env.battleResourceURL="https://static-r.kamihimeproject.net/battle-resources",t.env.soundResourceURL="https://static-r.kamihimeproject.net/sound-resources/sp/normal",t.env.R18GameURL="/index.html",t.env.GeneralGameURL="/index.html",t.env.isR18=!0,t.env.smartBeat={pc:{enabled:0,apiKey:"ba792238-0631-4d8e-b810-34428283dcb3",appVersion:"KAMI-PROD-PC-R18",appName:"KAMI-PROD-PC-R18"},sp:{enabled:0,apiKey:"3dfd0189-b7a1-4447-9a04-e0a13b4c5854",appVersion:"KAMI-PROD-SP",appName:"KAMI-PROD-SP"}},t.env.loggingUrlRoot="https://log.haha.net",t.env.platformApiServer=r?"http://osapi.qmm.com":"http://sbx-osapi.qmm.com",t.env.urlRoot=a?location.href.replace(/^(https?:\/\/[^\/]+)\/.*$/,"$1"):t.env.urlRootBase+"/"+t.env.apiVersion,t.env.paymentRedirectURL=t.env.urlRoot.replace("https","http")+"/payment/transaction",r?(t.env.useApiMock=!1,t.env.usePubsubMock=!1,t.env.useResourcePathMock=!1,t.env.useUglifiedPathName=0,t.env.useBattleResourceUglifiedPathName=0,t.env.useSoundUglifiedPathName=0,t.env.sendErrorLog=!1,t.env.riseErrorOnRoutingValidation=!1):(t.env.useApiMock=!1,t.env.usePubsubMock=!1,t.env.useResourcePathMock=!1,t.env.useUglifiedPathName=0,t.env.useBattleResourceUglifiedPathName=0,t.env.useSoundUglifiedPathName=0,t.env.sendErrorLog=!1,t.env.riseErrorOnRoutingValidation=!0),Object.defineProperties(t.env,{imgRoot:{get:function(){return t.env.useUglifiedPathName?[t.env.imgRootBase||"",t.env.isSp?"sp":"pc",t.createInstance("playerGameConfig").getImageQuality()].join("/"):"/resources/normal"}},battleAnimationRoot:{get:function(){return t.env.useBattleResourceUglifiedPathName?[t.env.battleResourceURL,t.env.isSp?"sp":"pc","normal"].join("/"):"/resources/battle-resources"}},soundRoot:{get:function(){return t.env.useBattleResourceUglifiedPathName?t.env.soundResourceURL:"/resources/sound"}}}),t.env.scenarioRoot=t.env.useUglifiedPathName?t.env.scenarioRootBase:"/resources/scenarios",t.env.iframeId="game",t.env.gameUrl=t.env.urlRootBase,t.env.frontRootPath=a?"":"/front"}((this||0).self||global),function(e){e.kh.SoundMultiplyingFactor={BGM:.3,"SE/VOICE":.5}}((this||0).self||global),function(e){e.kh=e.kh||{};var t=e.kh,n=e._,i={JOB_MAX_LEVEL:20,POPUP_CSS:location.pathname.replace(/^(.+\/components-(?:pc|sp))\/.*$/,"$1")+"/core/css/popup.css",PULLDOWN_CSS:location.href.replace(/^(.+\/components(?:-pc)?)\/.*$/,"$1")+"/core/css/pulldown.css",PARTY_SETTINGS:{MAX_JOB_COUNT:1,MAX_CHARACTER_COUNT:4,MAX_AVATAR_COUNT:5,MAX_SUB_COUNT:2},BATTLE_SETTINGS:{MAX_ENEMY_COUNT:3,SOUND_SCALE:{CCS21EVENT:.6,CCS16EVENT:1,BGM:.8}},ANIMETION_WAIT_SETTINGS:{GACHA_MAIN_SLIDER_INTERVAL:7e3},PANEL_MISSIONS:{MIN_PANEL_ID:1,MAX_PANEL_ID:3},CORECARD_LIST_SCALE:{"5x3":.95,"6x3":.8,"5x4":.66},BUTTON_SCALE:{MIN_SCALE:.9,MAX_SCALE:1},UI_GREYOUT_COLOR:cc.color("#808080")},o={};Object.defineProperties(o,n.transform(i,function(e,t,n){e[n]={value:t,writable:!1}})),Object.defineProperty(t,"GameConfig",{__proto__:null,value:o})}((this||0).self||global),(this||0).self||global,function(e){var t=e.kh;t.WordBook=t.WordBook||{},t.WordBook.ELEMENT_TYPE_FILTER_CONDITION=[{value:void 0,text:"属性",selected:!0},{value:0,text:"火"},{value:1,text:"水"},{value:2,text:"風"},{value:3,text:"雷"},{value:4,text:"闇"},{value:5,text:"光"},{value:8,text:"幻"}],t.WordBook.WEAPON_TYPE_FILTER_CONDITION=[{value:void 0,text:"種類",selected:!0},{value:"sword",text:"剣"},{value:"special_sword",text:"特殊剣"},{value:"spear",text:"槍"},{value:"ax",text:"斧"},{value:"staff",text:"杖"},{value:"hammer",text:"ハンマー"},{value:"gun",text:"銃"},{value:"bow",text:"弓"},{value:"magic_item",text:"魔導具"}],t.WordBook.NUM_TYPE_BY_SORT_ORDER={attack_desc:"攻",attack_asc:"攻",total_desc:"総",total_asc:"総",overlimit_desc:"Lv",overlimit_asc:"Lv",level_desc:"Lv",level_asc:"Lv",hp_desc:"Ｈ",hp_asc:"Ｈ",weapon_skill_desc:"SL",weapon_skill_asc:"SL",rare_desc:"総",rare_asc:"総",new_date:"総",old_date:"総",weapon_kind:"総",element_type:"総"},t.WordBook.ELEMENT_TYPE_LIST={flame:{name:"火",num:0,color:"#d90000"},water:{name:"水",num:1,color:"#3399ff"},wind:{name:"風",num:2,color:"#00d948"},thunder:{name:"雷",num:3,color:"#fff133"},darkness:{name:"闇",num:4,color:"#b726ff"},light:{name:"光",num:5,color:"#fff4bf"},nonelemental:{name:"無",num:6,color:""},phantom:{name:"幻",num:8,color:""}},t.WordBook.ORDERD_RARELITIES=Array("N","R","SR","SSR"),t.WordBook.FRIEND_REQUEST_SEND="フレンド申請を行いました",t.WordBook.FRIEND_REQUEST_ERROR_MESSAGE={default:"申請ができませんでした。",toListFull:"相手のフレンド数が最大のため<br />申請できませんでした。",fromListFull:"フレンド数が最大のため<br />申請できませんでした。",requestAlreadyPending:"申請ができませんでした。",alreadyFriend:"申請ができませんでした。"},t.WordBook.UNION_SCOUNT_ERROR_TITLE={default:"スカウトできません",scoutPending:"スカウト不可",scoutedByOthers:"すでにスカウトされています",alreadyMember:"スカウト不可",alreadyJoinRequested:"スカウト不可",memberMaxReached:"スカウト不可"},t.WordBook.UNION_SCOUNT_ERROR_MESSAGE={default:"スカウトできませんでした。",scoutPending:"このプレイヤーはすでにスカウトされています。",scoutedByOthers:"このプレイヤーは他のユニオンにスカウトされているため、スカウトできません。",alreadyMember:"所属している隊員です。",alreadyJoinRequested:"入隊申請を出しているプレイヤーです。",memberMaxReached:"これ以上スカウトできません！"},t.WordBook.UNION_JOIN_ERROR_MESSAGE={default:"入隊申請ができませんでした。",request_pending:"他のユニオンに申請中のため<br />入隊申請を行う事が出来ません。",already_scouted:"ユニオン「$union_name$」から<br />スカウトを受けています。",already_union_member:"すでにユニオンに所属しているため<br />入隊申請を行う事が出来ません。",join_time_limited:"入隊申請を出しているプレイヤーです。",member_max_reached:"現在の隊員数が最大隊員数のため<br />入隊申請を行う事ができません。"},t.WordBook.SORT_CONDITION=[{value:"attack_desc",text:"攻撃力高い順",selected:!0},{value:"attack_asc",text:"攻撃力低い順"},{value:"total_desc",text:"総合力高い順"},{value:"total_asc",text:"総合力低い順"},{value:"overlimit_count_desc",text:"限界突破数(多)"},{value:"overlimit_count_asc",text:"限界突破数(少)"},{value:"level_desc",text:"レベル高い順"},{value:"level_asc",text:"レベル低い順"},{value:"hp_desc",text:"HP高い順"},{value:"hp_asc",text:"HP低い順"},{value:"rare_desc",text:"レア度高い順"},{value:"rare_asc",text:"レア度低い順"},{value:"new_date",text:"入手が新しい順"},{value:"old_date",text:"入手が古い順"},{value:"element_type",text:"属性順"}],t.WordBook.SORT_WEAPON_CONDITION=[{value:"weapon_kind",text:"ウェポン種類順"},{value:"weapon_skill_desc",text:"スキルLv高い順"},{value:"weapon_skill_asc",text:"スキルLv低い順"}],t.WordBook.SORT_EPI_CONDITION=[{value:"default_asc",text:"デフォルト順"},{value:"episode_rare_desc",text:"レア度高い順"},{value:"episode_rare_asc",text:"レア度低い順"},{value:"new_date",text:"入手が新しい順"},{value:"old_date",text:"入手が古い順"},{value:"element_type",text:"属性順"}],t.WordBook.UNION_ROLE_LIST=[{value:"sub_leader",text:"副隊長",selected:!0},{value:"officer",text:"参謀"},{value:"member",text:"隊員"}],t.WordBook.filterUnionRanks={non_specified:"Rankを指定しない",rank_10:"Rank10以上",rank_20:"Rank20以上",rank_30:"Rank30以上",rank_50:"Rank50以上"},t.WordBook.UNION_SEARCH_RANK=_.map(t.WordBook.filterUnionRanks,function(e,t){return{value:t,text:e}}),t.WordBook.UNION_SEARCH_RANK[0].selected=!0,t.WordBook.filterUnionPlaystyles={non_specified:"プレイスタイルを指定しない",fun:"楽しく",my_pace:"マイペース",quiet:"静かに",active_participate_event:"積極的にイベントに参加"},t.WordBook.UNION_SEARCH_PLAYSTYLE=_.map(t.WordBook.filterUnionPlaystyles,function(e,t){return{value:t,text:e}}),t.WordBook.UNION_SEARCH_PLAYSTYLE[0].selected=!0,t.WordBook.filterUnionAutoJoins={non_specified:"指定しない",auto_join_ng:"入隊申請を自動で承認しない",auto_join_ok:"入隊申請を自動で承認する"},t.WordBook.UNION_SEARCH_AUTOJOIN=_.map(t.WordBook.filterUnionAutoJoins,function(e,t){return{value:t,text:e}}),t.WordBook.UNION_SEARCH_AUTOJOIN[0].selected=!0,t.WordBook.settingUnionAutoJoins={auto_join_ng:"入隊申請を自動で承認しない",auto_join_ok:"入隊申請を自動で承認する"},t.WordBook.UNION_SETTING_AUTOJOIN=_.map(t.WordBook.settingUnionAutoJoins,function(e,t){return{value:t,text:e}}),t.WordBook.UNION_SETTING_AUTOJOIN[0].selected=!0,t.WordBook.WEAPON_AROUSE_CONDITION_UNSATISFIED_MESSAGE={materials:"最終限界突破に必要な素材がありません。",level:"LvMAXになっていません。",skill_level:"ウェポンスキルがLvMAXになっていません。",gem:"ジェムが足りません。"},t.WordBook.job="英霊",t.WordBook.chara=t.WordBook.character="神姫",t.WordBook.summon="幻獣",t.WordBook.weapon="ウェポン",t.WordBook.popupQuestRestartLabel="クエスト「#replace#」\nを進行中です。",t.WordBook.popupQuestMultiLimitResetTime="AM5&#58;00",t.WordBook.elixir="エリクサー",t.WordBook.elixirDescription="エリクサーの説明（仮！）",t.WordBook.elixirHalf="ハーフエリクサー",t.WordBook.energySeed="エナジーシード",t.WordBook.energyLeaf="エナジーリーフ",t.WordBook.episode="エピソード",t.WordBook.chapter="章",t.WordBook.quest_bp_half="現在消費BP1/2",t.WordBook.quest_ap_half="現在消費AP1/2",t.WordBook.quest_ap_free="現在消費APなし",t.WordBook.release="解放",t.WordBook.stone="魔宝石",t.WordBook.point="DMMポイント",t.WordBook.gem="ジェム",t.WordBook.accessory_point="アクセP",t.WordBook.summon_orb="幻獣オーブ",t.WordBook.ticket="チケット",t.WordBook.joinedUnion="入隊",t.WordBook.unionMember="隊員",t.WordBook.unionRoles={leader:"隊長",sub_leader:"副隊長",officer:"参謀",member:"隊員"},t.WordBook.WEAPON_LIST={nothing_mainWeapon:"編成中の英霊の得意ウェポンを所持していません。",nothing_subWeapon:"編成できるウェポンがありません。"},t.w=function(e){return t.WordBook[e]}}((this||0).self||global),function(e){var t=e.kh;t.IDList=t.IDList||{},t.IDList.ItemID={magic_stone:1,gem:2,job_point:3,cure_bottle:4,cure_medic:5,elixir:6,half_elixir:7,energy_leaf:8,energy_seed:9,premium_ticket:11,sr_ticket:12,charaweaponset_ticket:13,ssr_chara_ticket:14,ssr_summon_ticket:15},t.IDList.VOICES={MYPAGE:{LOWER:1,UPPER:4},JOIN_PARTY:{LOWER:4,UPPER:7},NOTE:{LOWER:7,UPPER:10},EVO:{LOWER:10,UPPER:11},ATTACK:{LOWER:11,UPPER:14},ABILITY:{LOWER:15,UPPER:19},BURST_FULL:{LOWER:19,UPPER:20},BURST:{LOWER:20,UPPER:22},PINCH:{LOWER:22,UPPER:23},DIE:{LOWER:23,UPPER:24},JOIN:{LOWER:24,UPPER:25},WIN:{LOWER:25,UPPER:26},PANEL_OPEN:{LOWER:26,UPPER:27}},t.IDList.SHOPITEM={extension_weapon:3,extension_summon:4}}((this||0).self||global),function(e){var r=e.kh,o=e.console,t={buttonTouchedDefault:r.env.frontRootPath+"/cocos2d-proj/components/core/se/se_001.mp3",buttonTouchedDecide:r.env.frontRootPath+"/cocos2d-proj/components/core/se/se_001.mp3",buttonTouchedCancel:r.env.frontRootPath+"/cocos2d-proj/components/core/se/se_002.mp3",buttonTouchedConfirmed:r.env.frontRootPath+"/cocos2d-proj/components/core/se/se_003.mp3",buttonTouchedSwitch:r.env.frontRootPath+"/cocos2d-proj/components/core/se/se_004.mp3",windowOpen:r.env.frontRootPath+"/cocos2d-proj/components/core/se/se_005.mp3",windowClose:r.env.frontRootPath+"/cocos2d-proj/components/core/se/se_006.mp3"},a={mp3:"audio/mp3"};r.SoundEffects=cc.Class.extend({loadingProgress:{},preload:function(){if(r.SoundEffects.prototype.__preloadPromise)return r.SoundEffects.prototype.__preloadPromise;var e=t;return r.env.isSp||(e=_.mapValues(t,function(e,t){return location.origin+e})),r.SoundEffects.prototype.__preloadPromise=Q.all(_.map(e,function(e,t){var n=Q.defer(),i=e.substr(e.lastIndexOf(".")+1),o=[{media:a[i],path:r.getAddVersionQueryString(e)}];return r.postMessage("loadSound",[t,o]),n.promise})),r.SoundEffects.prototype.__preloadPromise},load:function(e){return Q.all(_.map(e,function(t){var n=Q.defer();if(null!=this.loadingProgress[t])return this.loadingProgress[t].promise;this.loadingProgress[t]=n;var e=t.substring(t.lastIndexOf(".")+1,t.lastIndexOf("?")),i=[{media:a[e],path:t}];return r.postMessage("loadSound",[t,i]),Q.delay(5e3).then(function(){if(n.promise.isPending()){var e="kh.SoundEffects: loading of sound effect: "+t+" timed out";o.warn(e),n.reject(e)}}),n.promise},this))}}),r.SoundList=r.SoundList||{},r.SoundList.BUTTON_TOUCHED_DEFAULT="buttonTouchedDefault",r.SoundList.BUTTON_TOUCHED_DECIDE="buttonTouchedDecide",r.SoundList.BUTTON_TOUCHED_CANCEL="buttonTouchedCancel",r.SoundList.BUTTON_TOUCHED_CONFIRMED="buttonTouchedConfirmed",r.SoundList.BUTTON_TOUCHED_SWITCH="buttonTouchedSwitch",r.SoundList.WINDOW_OPEN="windowOpen",r.SoundList.WINDOW_CLOSE="windowClose",ccui.Widget.prototype._sound=r.SoundList.BUTTON_TOUCHED_DEFAULT}((this||0).self||global),function(e){var t=e.kh||{};t.animationResourcePaths={avatarAnimation:"ava/ava_####/ava_####.ExportJson",jobAnimation:"job/job_####/job_####.ExportJson",onhitSound:"sound/on_hit/se_hit_####.mp3"},t.imageResourcePaths={},t.soundResourcePaths={jobSound:"job/job_####/se_job_######.mp3",charaSound:"chara/chara_####/se_chara_######.mp3",avatarSound:"chara/chara_####/se_chara_######.mp3",bgmEvent:"bgm/bgm_event_####.mp3",bgmGacha:"bgm/bgm_gacha_####.mp3",bgmMain:"bgm/bgm_main_####.mp3",seLvlUp:"se/se_levelup_####.mp3",bgmPrizeHuntQuest:"bgm/bgm_quest_prizehunt.mp3",bgmPageHighjob:"bgm/bgm_page_exjob.mp3"},t.localResourcePaths={}}((this||0).self||global),function(e){var t=e.kh;t.BtnsPageListParams=t.BtnsPageListParams||{},t.BtnsPageListParams.ENH_EVO_007={panelName:"corecard_blank_5_4_ui",perPage:20},t.BtnsPageListParams.ENH_EVO_010={panelName:"corecard_blank_5_4_ui",perPage:20},t.BtnsPageListParams.GUILD_005={panelName:"corecard_blank_5_3_ui_91",perPage:15},t.BtnsPageListParams.ENH_EVO_ENTRY={panelName:"corecard_blank_6_3_ui",perPage:18},t.BtnsPageListParams.CHARACTER_LIST={panelName:"corecard_blank_5_4_ui",perPage:20},t.BtnsPageListParams.SELECTABLE_CHARACTER_LIST={panelName:"corecard_blank_5_4_ui",perPage:20},t.BtnsPageListParams.WEAPON_LIST={panelName:"corecard_blank_5_4_ui",perPage:20},t.BtnsPageListParams.SUMMON_LIST={panelName:"corecard_blank_5_4_ui",perPage:20},t.BtnsPageListParams.ACCESSORY_EQUIP_CHARACTER_LIST={panelName:"corecard_blank_6_3_ui",perPage:18},t.BtnsPageListParams.ACCESSORY_ENH_BASE_LIST={panelName:"corecard_blank_6_3_ui",perPage:18},t.BtnsPageListParams.SELLABLE_ACCESSORY_LIST={panelName:"corecard_blank_6_3_ui",perPage:18},t.BtnsPageListParams.EQUIP_ACCESSORY_LIST={panelName:"corecard_blank_5_4_ui",perPage:20},t.BtnsPageListParams.ACCESSORY_ENH_MATERIAL_LIST={panelName:"corecard_blank_5_4_ui",perPage:20},t.BtnsPageListParams.LIST_LIST={panelName:"corecard_blank_6_3_ui",perPage:18},t.BtnsPageListParams.NOTE_EVENTSTORY={panelName:"no_event_bannerlist_ui",perPage:3},t.BtnsPageListParams.NOTE_BTNS_LIST={panelName:"corecard_blank_5_3_ui_90",perPage:15},t.BtnsPageListParams.GUILD_MEMBER={panelName:"userlist_page_ui",perPage:4},t.BtnsPageListParams.GUILD_FRIEND_SCOUT_FRIEND={panelName:"userlist_page_ui",perPage:4},t.BtnsPageListParams.PRESENT={panelName:"prs_cardlist_ui",perPage:4},t.BtnsPageListParams.RAID_EVENT_REWARDS={panelName:"ra_003_receivedlist_page_ui",cardUiName:"corecard_ui_65",perPage:4},t.BtnsPageListParams.FRIEND_SEARCH={panelName:"userlist_page_ui",perPage:4},t.BtnsPageListParams.ITEM={panelName:"corecard_blank_5_3_ui",perPage:15},t.BtnsPageListParams.GUILD_NEWS={panelName:"newslist_ui_page",perPage:8},t.BtnsPageListParams.QUEST_RESULT_PRIZES={panelName:"corecard_blank_4_3_ui",perPage:12},t.BtnsPageListParams.EPI_CHARA_LIST={panelName:"corecard_blank_6_3_ui",perPage:18},t.BtnsPageListParams.EPI_MAINSTORY_LIST={panelName:"corecard_blank_6_3_ui",perPage:18},t.BtnsPageListParams.EPI_EX_LIST={panelName:"epi_new_ui",perPage:3},t.BtnsPageListParams.EPI_NEW_LIST={panelName:"epi_new_ui",perPage:3},t.BtnsPageListParams.UNION_RAID_REWARDS={panelName:"uniraid_005_receivedlist_page_ui",cardUiName:"corecard_ui_65",receiveUiName:"uniraid_005_receive_ui",perPage:3},t.BtnsPageListParams.UNION_RAID_RANKING_REWARDS={panelName:"uniraid_009_receivedlist_page_ui",cardUiName:"corecard_ui_65",receiveUiName:"uniraid_009_receive_ui",perPage:4},t.BtnsPageListParams.ELECTABLE_CHARACTER_LIST={panelName:"corecard_blank_4_3_ui",perPage:12},t.BtnsPageListParams.CHARACTER_RANKING_LIST={panelName:"poprank_ranklist_page_ui",perPage:4},t.BtnsPageListParams.POPRANK_REWARD_LIST={panelName:"poprank_004_receivedlist_page_ui",perPage:4},t.BtnsPageListParams.BOOK_001_LIST={panelName:"corecard_blank_6_3_ui",perPage:18},t.BtnsPageListParams.UNION_RANKING_LIST={panelName:"uniraid_008_ranklist_page_ui",perPage:4},t.BtnsPageListParams.GUILD_ORDER_MISSION_LIST={panelName:"hlbattle_missionlist_page_ui",perPage:3},t.BtnsPageListParams.GUILD_ORDER_REWARD_LIST={panelName:"hlbattle_rewardlist_page_ui",perPage:3},t.BtnsPageListParams.TOWER_RANKING_LIST={panelName:"tower_ranking_list_page_ui",perPage:4},t.BtnsPageListParams.TOWER_RANKING_REWARD={panelName:"tower_ranking_reward_list_page_ui",perPage:4},t.BtnsPageListParams.SCOREATTACK_RANKING_LIST={panelName:"scoreattack_ranking_list_page_ui",perPage:4},t.BtnsPageListParams.HIGHJOB_WEAPON_LIST={panelName:"corecard_blank_5_3_ui",perPage:18}}((this||0).self||global),function(e){var t=e.kh;t.PageListParams=t.PageListParams||{},t.PageListParams.EX_ABILITY_LIST={viewParent:"page_ex_ability_list",subPageRes:"core-introduce-introduce_statuslist_list_7_ui",perPage:7},t.PageListParams.JOB_LIST={viewParent:"page_job_list",subPageRes:"party-par_006_7-par_006_7_joblist_page_ui",perPage:4},t.PageListParams.QUEST_LIST={viewParent:"page_quest_list",subPageRes:"quest-q_001-q_001_questlist_page_ui",perPage:4},t.PageListParams.SP_QUEST_LIST={viewParent:"page_quest_panel",subPageRes:"quest-q_004-q_004_questlist_page_ui",perPage:4,dontClone:!0},t.PageListParams.MAIN_RAID_LIST={viewParent:"page_quest_list",subPageRes:"quest-q_011-q_011_questlist_page_ui",panelsPerPage:4},t.PageListParams.QUEST_SPECIAL_LIST={viewParent:"page_quest_panel",subPageRes:"quest-q_special_top-q_special_top_questlist_page_ui",panelsPerPage:4},t.PageListParams.CONQUEST_QUEST_LIST={viewParent:"page_quest_list",subPageRes:"conquest-con_005-con_005_questlist_page_ui",perPage:4},t.PageListParams.SCOREATTACK_QUEST_LIST={viewParent:"page_quest_list",subPageRes:"scoreattack-scoreattack_quest-scoreattack_quest_list_page_ui",perPage:3},t.PageListParams.EPIC_QUEST_LIST={viewParent:"page_quest_list",subPageRes:"epic-epic_quest_list-epic_quest_list_page_ui",perPage:4},t.PageListParams.SUPPORT_SUMMON_LIST={viewParent:"page_supportlist",subPageRes:"core-userlist-supportlist_page_ui",panelsPerPage:4},t.PageListParams.RAID_LIST={viewParent:"page_raid_list",perPage:4},t.PageListParams.RAID_REQUEST_LIST={subPageRes:"quest-q_006_7_8-q_006_raidlist_page_ui",viewParent:"q_006_raidlist_page_ui"},t.PageListParams.RAID_UNVERIFIED_LIST={subPageRes:"quest-q_006_7_8-q_007_8_raidendlist_page_ui",viewParent:"q_007_8_raidendlist_page_ui"},t.PageListParams.RAID_HISTORY_LIST={subPageRes:"quest-q_006_7_8-q_007_8_raidendlist_page_ui",viewParent:"q_007_8_raidendlist_page_ui"},t.PageListParams.RAID_EVENT_QUEST_LIST={subPageRes:"raidevent-ra_002-ra_002_questlist_page_ui",perPage:4},t.PageListParams.SHOP_LIST={viewParent:"page_scroll_panel",subPageRes:"shop-sh_001-sh_001_event_bannerlist_page_ui",perPage:4},t.PageListParams.SHOP_MATERIAL_PRODUCT_LIST={viewParent:"tab_material_node",panelName:"sh_materiallist_list_ui"},t.PageListParams.SHOP_CURRENCY_PRODUCT_LIST={viewParent:"tab_currency_node",panelName:"sh_currency_list_ui"},t.PageListParams.SHOP_GACHA_ARRIVAL={viewParent:"change_page_panel"},t.PageListParams.SHOP_GACHA_ARRIVAL_SUMMON={subPageRes:"core-corecard-corecard_blank_4_4_ui",perPage:16},t.PageListParams.NOTE_MAINSTORY={viewParent:"change_page_panel",subPageRes:"note-no_002-worldlist_page_ui",perPage:2},t.PageListParams.EVENT_BANNER={viewParent:"page_quest_panel",subPageRes:"event-ev_000-ev_000_eventlist_page_ui",perPage:4},t.PageListParams.GACHA_BANNER={viewParent:"page_gachabanner_list",subPageRes:"gacha-ga_000-ga_bannerlist_page_ui",perPage:3},t.PageListParams.GUILD_FRIEND_SCOUT_RECOMMEND={viewParent:"change_page_panel",subPageRes:"core-userlist-userlist_page_ui",perPage:4},t.PageListParams.GUILD_GUARDIAN_COMMON={viewParent:"change_page_panel",perPage:2},t.PageListParams.GUILD_GUARDIAN={subPageRes:"guild-gud_003-gud_guardianlist_1_page_ui"},t.PageListParams.GUILD_BUY_GUARDIAN={subPageRes:"guild-gud_003-gud_guardianlist_0_page_ui"},t.PageListParams.FRIEND_SEARCH={viewParent:"change_page_panel",subPageRes:"core-userlist-userlist_page_ui",perPage:4},t.PageListParams.HELP_LIST={viewParent:"change_page_panel",subPageRes:"help-he_002-helplist_ui_page",perPage:9},t.PageListParams.MISSION_LIST={viewParent:"change_page_panel",subPageRes:{daily:"mission-mission_001-mission_001_missionlist_daily_page_ui",weekly:"mission-mission_001-mission_001_missionlist_weekly_page_ui",event:"mission-mission_001-mission_001_missionlist_event_page_ui"},perPage:3},t.PageListParams.CHAT_LIST={viewParent:"page_scroll_panel",subPageRes:"core-userlist-balloonlist_ui_page",perPage:4},t.PageListParams.EPIC_SELECT_LIST={viewParent:"page_bannerlist",subPageRes:"epic-epic_select-epic_select_bannerlist_page_ui",perPage:3},t.PageListParams.BEGINNER_MISSION_LIST={viewParent:"change_page_panel",subPageRes:"beginner_mission-beginner_mission_main-beginner_mission_main_list_page_ui",perPage:3},t.PageListParams.PRIZE_HUNT_RESULT_ITEM_CHECK={subPageRes:"core-corecard-corecard_blank_4_4_ui",perPage:16},t.PageListParams.HIGHJOB_CHANGE_LIST={viewParent:"scroll_panel",subPageRes:"core-popup_layer-highjob_change_joblist_page_ui",perPage:4,panelsPerPage:4}}((this||0).self||global),function(e){e.kh.LOAD_BLACKLIST=["Default/Sprite","Default/ImageFile","Default/defaultParticle","Default/LoadingBarFile","Default/Button"]}((this||0).self||global),function(e){var t=e.kh;e._,t.EventSettings={}}((this||0).self||global),function(e){var s=e.kh,c=null;s.BGM=cc.Class.extend({play:function(e){var t=e?c:null;return this._play("normal",{path:t})},playGacha:function(){return this._play("gacha")},playEvent:function(e){var t=e?null:c;if(null!=e||null!=t)return this._play("event",{path:t,eventId:e})},playByComponents:function(e,t){if(e&&0!==e.indexOf("tu_"))switch(e){case"gacha":this.playGacha();break;case"conquest":this._playByConquest(t);break;case"raidevent":this._playForRaidevent(t);break;case"unionraid":this._playForUnionRaid(t);break;case"tower":this._playForTower(t);break;case"scoreattack":this._playForScoreattack(t);break;case"top":case"battle":case"scenario":this.stop();break;case"prizehunt":this._playForPrizeHunt(t);break;case"highjob":this._play("event",{path:s.generateResourcePath("bgmPageHighjob",0).mp3,eventId:4901});break;default:this.play(!1)}else this.stop()},_playByConquest:function(e){this.playEvent(1006)},_playForUnionRaid:function(e){this.playEvent(3001)},_playForRaidevent:function(e){this.playEvent(2001)},_playForTower:function(e){this.playEvent(5001)},_playForScoreattack:function(e){this.playEvent(6001)},_playForPrizeHunt:function(e){return"prizehunt_quest"!==e?void this.play(!1):void this._play("event",{path:s.generateResourcePath("bgmPrizeHuntQuest",0).mp3,eventId:7002})},_play:function(n,e){var t=(e=e||{}).path,i=e.eventId,o=_.camelize("getPath_"+n);if(this[o]){var r=s.createInstance("playerGameConfig");if(r.isSoundOn()&&r.isBgmOn()){var a=r.getVirtualBgmVolume();(t?Q.resolve(t):this[o](i)).then(function(e){c=e;var t="bgm_"+n;i&&(t+="_"+i),s.createInstance("soundPlayer").directPlayMusic(t,[{media:"audio/mp3",path:e}],a)}.bind(this))}}else console.warn("no such bgm type: ",n)},getPathNormal:function(){return Q.all([s.createInstance("apiBgm").getMain()]).spread(function(e){var t=e.body.id,n=s.generateResourcePath("bgmMain",t);if(n)return n.mp3;var i=Q.defer();return i.reject("path is undefined for MainBgmId:"+t),i.promise}).fail(function(e){console.warn(e)})},getPathGacha:function(){var e=Q.defer(),t=s.generateResourcePath("bgmGacha",1);return t?e.resolve(t.mp3):e.reject("path is undefined for gacha:1"),e.promise},getPathEvent:function(e){var t=Q.defer(),n=s.generateResourcePath("bgmEvent",e);return n?t.resolve(n.mp3):t.reject("path is undefined for event:"+e),t.promise},stop:function(){s.createInstance("soundPlayer").stopBgm()}})}((this||0).self||global),function(e){var i=e.kh;i.SE=cc.Class.extend({play:function(e){var t=i.createInstance("playerGameConfig");if(t.isSoundOn()&&t.isSeOn()){var n=t.getVirtualSeVolume();i.postMessage("playSE",[e,n])}}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e._,t.EventSubject=n.Class.extend({EVENT_PREFIX:"",EVENT_NAME:{},_uniqueEventPrefix:"",_notificationCenter:null,ctor:function(){this._uniqueEventPrefix=this.EVENT_PREFIX+":"+this.__instanceId,this._notificationCenter=t.createInstance("notificationCenter")},_getUniqueEventName:function(e){return void 0===this.EVENT_NAME[e]?(console.error("kh.EventSubject._getUniqueEventName() イベント名が設定されていません:"+e),""):this._uniqueEventPrefix+":"+this.EVENT_NAME[e]},addEventListener:function(e,t,n){var i=this._getUniqueEventName(e);return this._notificationCenter.addEventListener(i,t,n)},dispatchEvent:function(e,t){var n=this._getUniqueEventName(e);this._notificationCenter.dispatchEvent(n,t)},removeEventListener:function(e){this._notificationCenter.removeEventListener(e)},removeEventListenersByEventName:function(e){var t=this._getUniqueEventName(e);this._notificationCenter.removeEventListenersByEventName(t)},removeAllEventListeners:function(){Object.keys(this.EVENT_NAME).forEach(function(e){this.removeEventListenersByEventName(e)},this)}})}((this||0).self||global),function(t){var e=t.Cookies,n=location.hash.match(/session=([^&]+)/);if(n){n=decodeURIComponent(n[1]);try{var i=JSON.parse(n)}catch(e){return t.console.error("SessionParam is not valid JSON",e)}e.set("session",i.id,{expires:2/24})}}((this||0).self||global),function(e){kh.env.isSp||(e.cc.sys.isMobile=!1)}((this||0).self||global),function(r){var n=r.cc,o=r._;r.t=function(e,t,n){n=n||"  ",t=t||function(e,t){return t},r.console.log(n+JSON.stringify(t(e,[e._name,e.__instanceId]))),e.children.length<1||o.each(e.children,function(e){e.isVisible()&&r.t(e,t,n+"  ")})},r.tt=function(e,t,n){n=n||"  ",t=t||function(e,t){return t},r.console.log(n+JSON.stringify(t(e,[e.isVisible()?"■":"□",e._name,e.__instanceId]))),e.children.length<1||o.each(e.children,function(e){r.tt(e,t,n+"  ")})},r.tte=function(e,o){r.tt(e,function(e,t){var n=e._touchEventCallback||e._touchEventSelector,i=e._touchEnabled;return t.unshift(n&&i?"EL":n?"eL":i?"El":"el"),o&&o(e,t),t})},r.ttea=function(e,i){r.tte(e,function(e,t){var n;return(n=e===cc$()?e.resource.action:e.actionManager?e.actionManager.getActionByTag(e.tag,e):null)&&t.push([o.keys(n.animationInfo)]),i&&i(e,t),t})},r.pbs=function(e){var t=JSON.parse(e,"utf-8");t.scenario&&(t=t.scenario),Array.isArray(t)||(t=[t]),console.group("play battleScenario"),(n.director.getRunningScene().__instanceId,kh.createInstance("battleWorld"))._handleData({body:{scenario:t}}).then(function(){console.groupEnd()})};var s=function(e,t,n){if(t(e,n))return e;for(var i,o=e.children,r=o.length,a=0;a<r;a++)if(i=s(o[a],t,n))return i;return null};r.cc$=function(e){return e?/\D/.test(e)?n.director.getRunningScene().seekWidgetByName(e):s(n.director.getRunningScene(),function(e,t){return e.__instanceId===t},e):n.director.getRunningScene()},r.p=function(){var e=n.eventManager._getListeners("__cc_touch_one_by_one").getSceneGraphPriorityListeners();o(e).map(function(e){var t=e._node;return[t._name,t.__instanceId]}).each(function(e){r.console.log(JSON.stringify(e))})},r.u=function(e){return e=e||location.hash,o.zipObject(e.substr(e.indexOf("?")+1).split("&").map(function(e){return(e=e.split("="))[1]=JSON.parse(decodeURIComponent(e[1])),e}))}}((this||0).self||global),function(e){var t=e.cc,n=e.kh,i=e._;n.SessionStorage=t.Class.extend({set:function(e,t){if(!i.isUndefined(window.sessionStorage)&&i.isFunction(window.sessionStorage.setItem))try{console.debug("SessionStorage::set",e,t);var n=JSON.stringify(t);window.sessionStorage.setItem(e,n)}catch(e){console.warn(e.stack)}},get:function(e){if(i.isUndefined(window.sessionStorage)||!i.isFunction(window.sessionStorage.getItem))return null;try{var t=window.sessionStorage.getItem(e),n=JSON.parse(t);return console.debug("SessionStorage::get",e,n),n}catch(e){console.warn(e.stack)}return null}})}((this||0).self||global),function(e){var t=e.cc,a=e.kh,s=e._,n=/https?:\/\/.*\/cocos2d-proj/,i=/https?:\/\/.*\/cocos2d-proj\/((vendor|components-?)(pc|sp)?)?\/((.*)\/build\/js|(.*))\/([^\/]*).js(\?version=[^&:]*)?/,o="$3/$5$6/$7",c=Cookies,u=[1e4,1e3,500,200],l=s.max(u);a.HistoryStore=t.Class.extend({className:"KHHistoryStore",ctor:function(e){this._arr=new Array,this._size=e},add:function(e){this._arr.unshift(e),this._arr.length>this._size&&this._arr.pop()},clear:function(){this._arr=new Array},toArray:function(){return this._arr},restoreFromArray:function(e){s.isArray(e)&&(this._arr=e.concat(),this._arr.length>this._size&&(this._arr.length=this._size))}}),a.Logging=t.Class.extend({className:"KHLogging",_http:null,_statusStock:null,_histories:null,ctor:function(){this._http=a.createInstance("HttpLoggingConnection"),a.env.isIE?(this._minifyStack=this._minifyStackIE11,this._statusStock={location:this.__getCurrentLocationPathForIE},this._getCurrentHistory=this._getCurrentHistoryForIE,this._histories=new a.HistoryStore(2)):(this._statusStock={location:this.__getCurrentLocationPath,memory:this.__getCurrentMemoryInfo},this._histories=new a.HistoryStore(10));var e=a.createInstance("sessionStorage").get("logging_history");s.isArray(e)&&this._histories.restoreFromArray(e),window.addEventListener("unload",function(){var e=this._histories.toArray();a.createInstance("sessionStorage").set("logging_history",e)}.bind(this))},setStatusInfo:function(e,t){this._statusStock[e]=t},_removeStatusInfo:function(e){delete this._statusStock[e]},reportGlobalError:function(e){try{var t=escape(btoa(e.message.replace(/^.*Error:/,""))),n=JSON.parse(c.get(t)||'{"c":0,"t":0}');console.debug(t,n);var i=(new Date).getTime(),o=i-n.t,r=0===n.t&&0===n.c;if(n.t=i,n.c=(o<=6e5?n.c:0)+1,c.set(t,JSON.stringify(n)),r)return this.reportJsException(e);if(-1!==u.indexOf(n.c)||n.c%l==0)return this._sendErrorWithExtraInfo(e,n.c)}catch(e){console.warn("##Error##","Logging:reportGlobalError"),console.warn(e.stack)}},reportJsException:function(e){try{var t;if(t=s.isString(e)?e:e.stack,s.isUndefined(t))return;var n=t.split(/\r\n|\r|\n/);s.each(n,function(e,t){n[t]=this._minifyStack(e)},this),a.env.isIE&&5<n.length&&((n=n.splice(0,5))[5]="+"+(n.length-4)+" lines.");var i;return(i=1<=n.length&&null===/^ @.*\:[0-9]+:[0-9]+\)/.exec(n[0])?{text:n.shift(),stack:n}:{stack:n}).idstr=this._makeJsErrorIdString(i),this._sendErrorLog("/error/js",i)}catch(e){console.warn("##Error##","Logging:reportJsException"),console.warn(e.stack)}return 0},_minifyStack:function(e){return e.replace(/^    at /," @").replace(/<anonymous>/,"<anon.>").replace(i,o)},_minifyStackIE11:function(e){return e.replace(/^   at /," @").replace(/Anonymous function /,"<an>").replace(i,o).replace(/[0-9]+:[0-9]+:[0-9]+\)$/,"")},_makeJsErrorIdString:function(e){return s.reduce(e.stack||[],function(e,t){return e+t.replace(/[0-9:]*\)?$/,"")},"")},reportCommunicationError:function(e,t,n){if(!s.isUndefined(e)&&!s.isUndefined(t)){console.debug("reportCommunicationError",t,n);var o={};try{s.each(n,function(e,t){var n=t.split("At");if(2===n.length&&0==n[1].length){var i=new Date(e);o[s.snakeCase(t)]=this.__formatDate(i)}else o[t]=e},this);var i=t.req||{};if(a.env.isIE)var r={url:e.url,method:i.method||"N/A",status:t.status,body:t.body};else r={url:e.url,method:i.method||"N/A",data:i._data||"N/A",status:t.status,body:t.body,retry_info:o};return r.idstr=this._makeComErrorIdString(r),this._sendErrorLog("/error/com",r)}catch(e){console.warn("##Error##","Logging:reportCommunicationError"),console.warn(e.stack)}return 0}},_makeComErrorIdString:function(e){var t=((e.body||{}).errors||[{}])[0]||{},n=(e.url||"").replace(/^https?\:\/\/[^\/]*[\/]/,"");return n=n.replace(/(a_[a-z_]*_id=)([1-9]*)/g,"$1!").replace(/(\a_[a-z_]*\/)([1-9]*)/g,"$1!"),[e.method,n,e.status,t.code].join(" ")},reportWidgetUserOperation:function(e,t){if(!s.isUndefined(t)){var n=null;try{if(0<t.children.length){var i=t.children[0];"Text"===i._className&&(n=i.string)}if("Button"===t._className){var o=t.titleText||"";0<o.length&&(n=o)}}catch(e){console.warn("##Error##","Logging:reportWidgetUserOperation"),console.warn(e.stack)}try{this._addHistory("widget",e,{class:t._className,name:t.name,title:s.isNull(n)?"(N/A)":n})}catch(e){console.warn("##Error##","Logging:reportWidgetUserOperation"),console.warn(e.stack)}}},reportPopupTransition:function(e,t){if(!s.isUndefined(t))try{var n=t.getInfoForLogging(),i=t.titleNode;this._addHistory("popup",e,{caption:s.isUndefined(i)?"(N/A)":i.string,informations:n})}catch(e){console.warn("##Error##","Logging:reportPopupTransition"),console.warn(e.stack)}},reportPageTransition:function(e){if(!s.isUndefined(e))try{var t=decodeURIComponent(e.canonicalPath);this._addHistory("navigate",null,{path:t.replace(/\?option=[^&]*/,"?[omit]")})}catch(e){console.warn("##Error##","Logging","reportPageTransition"),console.warn(e.stack)}},reportPubsubEvent:function(e,t){if(!s.isUndefined(e))try{s.isString(t)&&/^\s*\{.*\}\s*$/.test(t)&&(t=JSON.parse(t)),this._addHistory("socket",e,{data:t})}catch(e){console.warn("##Error##","Logging","reportPubsubEvent"),console.warn(e.stack)}},reportBattleScenario:function(e,t){this._reportBattleData(e,t,"battle_scenario")},reportBattleStatus:function(e,t){this._reportBattleData(e,t,"battle_status")},reportBattleStart:function(e,t){this._reportBattleData(e,t,"battle_start")},reportBattleStatusEffects:function(e,t){this._reportBattleData(e,t,"battle_status_effects")},reportBattleActionRequest:function(e,t){this._reportBattleData(e,t,"battle_action_request")},reportBattleCharacterStatus:function(e,t){this._reportBattleData(e,t,"character_status")},reportBattleExit:function(e,t){this._reportBattleData(e,t,"battle_exit")},reportCustomBattleData:function(e,t,n){this._reportBattleData(e,t,n)},_reportBattleData:function(e,t,n){if(!s.isUndefined(t))try{s.isString(t)&&/^\s*\{.*\}\s*$/.test(t)&&(t=JSON.parse(t)),this._addHistory(n,"scene_instance: "+e,{data:t})}catch(e){console.warn("##Error##","Logging","_reportBattleData",n),console.warn(e.stack)}},_addHistory:function(e,t,n){var i=new Date,o={time:this.__formatDate(i),main_category:e,sub_category:t,detail_info:n};this._histories.add(o)},_sendErrorLog:function(e,t,n){try{var i=this._generateKeyCode(6),o=s.padZero(this._generateUniqKeyCode(t,10),10),r=[o,i].join("-");return a.createInstance("smartBeat").registCustomData("ERRORCODE",r),a.env.sendErrorLog&&this._http.log({url:e,json:{key:i,uniqkey:o,error:t,status:s.merge(this._getCurrentStatusInfo(),n||{}),history:this._getCurrentHistory()}}).fail(function(e){console.warn("##Error##","Logging","_http.log"),console.warn(e.stack)}),r}catch(e){console.warn("##Error##","Logging","_sendLog"),console.warn(e.stack)}return 0},_sendErrorWithExtraInfo:function(e,t){var n=Cookies.get("session"),i=function(){this.setStatusInfo("session",n),this.setStatusInfo("count",t),this.reportJsException(e),this._removeStatusInfo("count"),this._removeStatusInfo("session")}.bind(this);try{a.createInstance("apiAPlayers").getMeEx(t).then(function(){this.setStatusInfo("count",t),this.reportJsException(e),this._removeStatusInfo("count")}.bind(this)).fail(i)}catch(e){i()}},_getCurrentStatusInfo:function(){var n={};return s.each(this._statusStock,function(e,t){n[t]=s.isFunction(e)?e():e},this),n},_getCurrentHistory:function(){return this._histories.toArray()},_getCurrentHistoryForIE:function(){var i=this._histories.toArray().concat();return s.each(i,function(e,t){var n=e.detail_info;e=n.path?{path:n.path.replace(/\?.*$/,"")}:n.informations?{res:n.informations.resource_name}:n.name?{node:n.name}:{},i[t]=e},this),i},__getCurrentLocationPath:function(){return decodeURIComponent(location.href.replace(n,""))},__getCurrentLocationPathForIE:function(){return decodeURIComponent(location.href.replace(n,"").replace(/\?.*$/,""))},__getCurrentMemoryInfo:function(){try{if(s.isUndefined(window.performance)||s.isUndefined(window.performance.memory))return{fail:"(N/A)"};var e=window.performance.memory;return{total:e.totalJSHeapSize/1e6,used:e.usedJSHeapSize/1e6,limit:e.jsHeapSizeLimit/1e6}}catch(e){return{fail:e.toString()}}},_generateKeyCode:function(e){return(2147483647&(this.__getCurrentUserId()^parseInt((new Date).getTime()/10)))%Math.pow(10,e)},_generateUniqKeyCode:function(e,t){var n=CybozuLabs.SHA1.calc(e.idstr,CybozuLabs.SHA1.BY_UTF16).match(/(.{8}|.+$)/g);return s.reduce(n,function(e,t){return e+parseInt(t,16)},0)%Math.pow(10,t)},__getCurrentUserId:function(){var e=this._statusStock.player;return e&&e.dmm_id?parseInt(e.dmm_id):4294967295},__formatDate:function(e){return s.isFunction(e.toISOString)?e.toISOString():e.toLocaleString("ja")+" +"+e.getMilliseconds()}})}((this||0).self||global),function(e){var t=e._||require("lodash"),i=e.kh||{},n=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};i.env=i.env||{useApiMock:!0},i.env.urlRoot,i.Api=i.Api||{};var o="AUnions",r={get:function(e){return this._http.get({url:"/a_unions/"+e})},getMe:function(){return this.get("me")},getBurstTimeInfo:function(e){return t.isUndefined(e)&&(e="me"),this._http.get({url:"/a_unions/"+e+"/burst_time_info"})},getChats:function(){return this._http.get({url:"/a_unions/me/chats"})},getDonationInfo:function(){return this._http.get({url:"/a_unions/me/donation_info"})},getGuardianDonationMaterials:function(e,t,n){return this._http.get({url:"/a_unions/me/guardian_donation_materials",json:{display_filter_name:i.displayFilter.enums.FILTER_NAME.GUILD_WEAPON,sort:e,page:t,per_page:n}})},getGuardians:function(e){return this._http.get({url:"/a_unions/me/guardians",json:{have:!!t.isUndefined(e)||e}})},getSelectedGuardian:function(){return this._http.get({url:"/a_unions/me/guardians/selected"})},setSelectedGuardian:function(e){return this._http.put({url:"/a_unions/me/guardians/selected",json:{a_guardian_id:e}})},getMembersExternal:function(e,t,n){return n=n||"me",this._http.get({url:"/a_unions/"+n+"/members",json:{page:e,per_page:t}})},getMembers:function(e,t){return this._http.get({url:"/a_unions/me/members",json:{page:e,per_page:t}})},getMember:function(e){return this._http.get({url:"/a_unions/me/members/"+e})},getNewInfo:function(){return this._http.get({url:"/a_unions/me/new_info"})},getNews:function(e,t){return this._http.get({url:"/a_unions/me/news",json:{page:e,per_page:t}})},dissolution:function(){return this._http.del({url:"/a_unions/me"})},getMembersForFire:function(e,t){return this._http.get({url:"/a_unions/me/members",json:{filter:"member_dismissed",page:e,per_page:t}})},fireMember:function(e){return this._http.del({url:"/a_unions/me/members/"+e})},leave:function(){return this._http.del({url:"/a_unions/me/members/me"})},create:function(e){return this._http.post({url:"/a_unions",json:{a_union_id:"me",name:e}})},comment:function(t){return i.createInstance("inspectionApiDelegate").createInspection(t).then(function(e){return this._http.post({url:"/a_unions/me/chats",json:{message:t,text_id:e.getTextId()}})}.bind(this))},stamp:function(e){return this._http.post({url:"/a_unions/me/chats",json:{stamp_id:e}})},deleteChat:function(e){return this._http.del({url:"/a_unions/me/chats/"+e})},donation:function(e){return this._http.post({url:"/a_unions/me/donation",json:{gem:e}})},guardianBuy:function(e){return this._http.post({url:"/a_unions/me/guardians_buy",json:{guardian_id:e}})},guardianDonationGem:function(e){return this._http.post({url:"/a_unions/me/guardian_donation",json:{gem:e}})},confirmGuardianEnhanceMaterials:function(e){return this._http.get({url:"/a_unions/me/confirm_guardian_enhance_materials",json:{ids:e}})},guardianDonationWeapons:function(e){return this._http.post({url:"/a_unions/me/guardian_donation",json:{ids:e}})},changeUnionName:function(t,e){return i.createInstance("inspectionApiDelegate").createOrUpdateInspection(e,t).then(function(e){return this._http.put({url:"/a_unions/me",json:{name:t,text_id:e}})}.bind(this))},changeUnionComment:function(t,e){return i.createInstance("inspectionApiDelegate").createOrUpdateInspection(e,t).then(function(e){return this._http.put({url:"/a_unions/me",json:{comment:t,text_id:e}})}.bind(this))},changeBurstTimeInfo:function(e){return this._http.put({url:"/a_unions/me/burst_time_info",json:{burst_time_info:{reserved_burst_times:e}}})},changeMemberUnionPosition:function(e,t){return this._http.put({url:"/a_unions/me/members/"+e,json:{union_position:t}})},getMembersForLeader:function(e,t){return this._http.get({url:"/a_unions/me/members",json:{filter:"appointed_to_leader",page:e,per_page:t}})},changeLeader:function(e){return this._http.put({url:"/a_unions/me/members/"+e,json:{union_position:"leader"}})},accept:function(e){return this._http.post({url:"/a_unions",json:{a_player_id:e}})},acceptScout:function(e){return this._http.post({url:"/a_unions",json:{a_union_id:e}})}};if(i.Api[o]=n.Class.extend(t.assign({className:"KHApiAUnions",_http:null,ctor:function(){this._http=i.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=i.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},r)),i.env.useApiMock){i.MockApi=i.MockApi||{};var a={};t.each(r,function(e,t){a[t]=function(){if(!i.MockApi)throw"kh.MockApi is not defined";if(!i.MockApi[o][t+"JSON"])throw"not implemented: kh.MockApi."+o+"."+t;var e=Q.defer();return e.resolve({body:i.MockApi[o][t+"JSON"].apply(this,arguments)}),e.promise}}),i.MockApi[o]=n.Class.extend(t.assign({},a))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(r,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,o).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var o="Gacha",r={getAppearance:function(e,t){return this._http.get({url:"/gacha/"+e+"/appearance",json:{rare:t}})},getAppearanceByEventId:function(e,t){return this._http.get({url:"/gacha/event/"+e+"/appearance",json:{id:e,rare:t}})},getSliderDetail:function(e){return this._http.get({url:"/gacha/detail",json:{slider_id:e}})},getSummonRatios:function(e,t,n){return this._http.get({url:"/gacha/"+e+"/summon/ratios",json:{page:t,per_page:n}})},getWeaponRatios:function(e,t,n){return this._http.get({url:"/gacha/"+e+"/weapon/ratios",json:{page:t,per_page:n}})},getEventSummonRatios:function(e,t,n){return this._http.get({url:"/gacha/event/"+e+"/summon/ratios",json:{page:t,per_page:n}})},getEventWeaponRatios:function(e,t,n){return this._http.get({url:"/gacha/event/"+e+"/weapon/ratios",json:{page:t,per_page:n}})},getHaremEpisodeCharacter:function(e){return this._http.get({url:"/gacha/harem_episodes/characters/"+e})},getHaremEpisodesCharacters:function(e,t){return this._http.get({url:"/gacha/harem_episodes/characters",json:{page:e,per_page:t}})},getHaremEpisodeSummon:function(e){return this._http.get({url:"/gacha/harem_episodes/summons/"+e})},getHaremEpisodesSummons:function(e,t){return this._http.get({url:"/gacha/harem_episodes/summons",json:{page:e,per_page:t}})}};if(n.Api[o]=i.Class.extend(t.assign({className:"KHApiGacha",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},r)),n.env.useApiMock){n.MockApi=n.MockApi||{};var a={};t.each(r,function(e,t){a[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[o][t+"JSON"])throw"not implemented: kh.MockApi.Gacha."+t;var e=Q.defer();return e.resolve({body:n.MockApi[o][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[o]=i.Class.extend(t.assign({},a))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(r,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,o).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e._||require("lodash"),i=e.kh||{},o=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};i.env=i.env||{useApiMock:!0},i.env.urlRoot,i.Api=i.Api||{};var r="APlayers",n={getJobPoint:function(e){return this._http.get({url:"/a_players/"+e+"/job_point"})},get:function(e){return this._http.get({url:"/a_players/"+e})},getMe:function(){return this.get("me").then(this.__storeMeForLogging)},getMeEx:function(e){return this._http.get({url:"/a_players/me",json:{c:e}}).then(this.__storeMeForLogging)},__storeMeForLogging:function(e){var t=e.body,n={dmm_id:t.dmm_id,name:t.name};return i.createInstance("logger").setStatusInfo("player",n),o.sys.localStorage.setItem("KHUserId",null===t.dmm_id?"NULL":t.dmm_id),o.sys.localStorage.setItem("KHUserName",t.name),e},getMeNumeric:function(){return this._http.get({url:"/a_players/me",json:{id_numeric:!0}})},getCurrency:function(){return this._http.get({url:"/a_players/me/currency"})},getPlayerCurrency:function(e){return this._http.get({url:"/a_players/"+e+"/currency"})},getSelectedJobId:function(){return this._http.get({url:"/a_players/me/selected_job_id"})},getRecommended:function(){return this._http.get({url:"/a_players/",json:{recommended:!0}})},getListByRank:function(e){return this._http.get({url:"/a_players/",json:{rank:e}})},getQuestPoints:function(){return this._http.get({url:"/a_players/me/quest_points"})},getUnionJoinedLimitState:function(){return this._http.get({url:"/a_players/me/union_joined_limit_state"})},updateDescription:function(t,e){return i.createInstance("inspectionApiDelegate").createOrUpdateInspection(e,t).then(function(e){return this._http.put({url:"/a_players/me",json:{description:t,text_id:e}})}.bind(this))},getGameConfig:function(){return this._http.get({url:"/a_players/me/game_config"})},getSortConfig:function(){return this._http.get({url:"/a_players/me/sort_config"})},getAutoSpendConfig:function(e){return this._http.get({url:"/a_players/me/auto_spend_config",json:{type:e}})},getDisplayFilterConfig:function(e){return this._http.get({url:"/a_players/me/display_filter/"+e})},getMasterPoint:function(){return this._http.get({url:"/a_players/me/hero_master_point"})},updateGameConfig:function(e){return this._http.put({url:"/a_players/me/game_config",json:e})},updateAutoSpendConfig:function(e){return this._http.put({url:"/a_players/me/auto_spend_config",json:e})},updateGachaAnimationSkipFlag:function(e){return this._http.put({url:"/a_players/me/game_config",json:{gacha_animation_skip:e}})},updateSortConfig:function(e){return this._http.put({url:"/a_players/me/sort_config",json:e})},updateDisplayFilterConfig:function(e,t){return this._http.post({url:"/a_players/me/display_filter/"+e,json:t})},getSelectedPartyInfo:function(e){return this._http.get({url:"/a_players/"+e+"/selected_party_info"})},getBattlePower:function(){return this._http.get({url:"/a_players/me/battle_power"})},exchangeMasterPoint:function(e,t){return this._http.post({url:"/a_players/me/hero_master_point",json:{type:e,amount:t}})}};if(i.Api[r]=o.Class.extend(t.assign({className:"KHApiAPlayers",_http:null,ctor:function(){this._http=i.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=i.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},n)),i.env.useApiMock){i.MockApi=i.MockApi||{};var a={};t.each(n,function(e,t){a[t]=function(){if(!i.MockApi)throw"kh.MockApi is not defined";if(!i.MockApi[r][t+"JSON"])throw"not implemented: kh.MockApi."+r+"."+t;var e=Q.defer();return e.resolve({body:i.MockApi[r][t+"JSON"].apply(this,arguments)}),e.promise}}),i.MockApi[r]=o.Class.extend(t.assign({},a))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(n,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,r).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e.kh;e.Q,t.cssToRgb=function(e){var n;if(0===e.indexOf("#"))n=4===e.length?{r:e[1].repeat(2),g:e[2].repeat(2),b:e[3].repeat(2)}:{r:e.substr(1,2),g:e.substr(3,2),b:e.substr(5,2)},_.each(n,function(e,t){n[t]=parseInt(e,16)});else if(0===e.indexOf("rgb")){var t=e.match(/[0-9]+/g);n={r:parseInt(t[0]),g:parseInt(t[0]),b:parseInt(t[0])}}else n={red:{r:255,g:0,b:0},black:{r:0,g:0,b:0}}[e.toLowerCase()]||{r:255,g:255,b:255};return n}}((this||0).self||global),function(e){var t=e.kh;e.Q,t.cleanupProperties=function(e){_.isObject(e)&&_.each(e,function(e,t){if(_.isObject(e)){try{var n=e.dispose;_.isFunction(n)&&n.call(e)}catch(e){console.warn(e)}delete this[t]}},e)}}((this||0).self||global),function(i){var e,s=i.kh,o=i.Q,r=(e=0|998*Math.random(),function(){return++e}),a=_(["createInspection","updateInspection"]).map(function(e){return[e,!0]}).zipObject().value(),c={};s.postMessage=function(e,t){var n=o.defer();if(a[e]){var i=r();c[i]=function(e,t){return e?n.reject(e):void n.resolve(t)},t.push(i)}else n.resolve();return window.parent.postMessage(JSON.stringify([e,t]),"*"),n.promise},window.addEventListener("message",function(t){try{var e=JSON.parse(t.data)}catch(e){var n=t?t.data||t.toString():"N/A",i=new Error("Receive invalid postMessage : "+n);return void s.createInstance("logger").reportJsException(i)}try{var o=e[0],r=!1;if(s.env.isSp&&("navigate"!==o&&"postSeLoadFinished"!==o||(r=!0)),!r&&t.origin!==s.env.platformApiServer)return;var a=e[1];(s.rpc[o]||function(){}).apply(null,a)}catch(e){console.error(e)}}.bind(this),!1),s.rpc={paymentResponse:function(i){_.each({shop:{module:"apiShopBuyResult",method:"put"},gacha:{module:"apiAGachaResult",method:"putGachaResult"}},function(e,t){if(-1!==i.skuId.search(t)){var n=s.createInstance(e.module);n[e.method].apply(n,[i.paymentId]).then(function(e){s.createInstance("paymentRequest").returnPaymentResult(i.skuId,e.body)})}})},makeRequestResponse:function(e){s.createInstance("makeRequest").response(e)},usePcEdition:function(){s.env.isSp=!1},navigate:function(e){return"mypage"===e?void s.createInstance("router").navigate(new s.router.MyPageRedirect):void s.createInstance("router").navigate(e)},mute:function(e){s.createInstance("notificationCenter").dispatchEvent("mute",[e])},reload:function(){s.createInstance("sceneManager").reloadScene()},keepPromise:function(e,t,n){return c[e]?(c[e](t,n),void delete c[e]):void i.console.error(new Error("postMessage: callback already released"))},postSeLoadFinished:function(e){var t=s.createInstance("soundEffects");t.loadingProgress[e]&&!t.loadingProgress[e].promise.isRejected()&&(t.loadingProgress[e].resolve(),delete t.loadingProgress[e])}}}((this||0).self||global),function(e){var t=e.kh;t.boombox=t.boombox||{},t.boombox.power=function(e){null!=t.postMessage&&t.postMessage("boomBoxPower",[e])},t.boombox.setup=function(e){null!=t.postMessage&&t.postMessage("boomBoxSetup",[e])},t.boombox.khMakeTempPool=function(){null!=t.postMessage&&t.postMessage("boomBoxKhMakeTempPool")},t.boombox.khPurgeTempPool=function(){null!=t.postMessage&&t.postMessage("boomBoxKhPurgeTempPool")}}((this||0).self||global),function(e){var t=e.kh||{};t.WMAudioUtil=t.WMAudioUtil||{},t.WMAudioUtil.autoPlayEnabled=!1,t.WMAudioUtil.autoPlay=function(){null!=t.postMessage&&t.postMessage("WMAudioUtilAutoPlay")}}((this||0).self||global),function(e){var i=e._;e.khutil.getPromiseToDelayAnimation=function(e,t){if(i.isUndefined(e)&&(e=1e3),e<=0)return Q.resolve(t);var n=Q.defer();return cc.director.getRunningScene().scheduleOnce(function(){n.resolve(t)},e/1e3),n.promise}}((this||0).self||global),function(e){(e._,e.khutil).getPromiseWhenAnimationEnd=function(e,t){var i=new ccs.Timeline,n=new ccs.EventFrame;n.setEvent("endAnimation"),n.setFrameIndex(t),i.addFrame(n),e.addTimeline(i);var o=Q.defer();return e.setFrameEventCallFunc(function(e){var t=e.getFrameIndex(),n=e.getTimeline().getActionTimeline();n.getCurrentFrame()<t||"endAnimation"===e.getEvent()&&(o.resolve(n),n.removeTimeline(i),n.clearFrameEventCallFunc())}),o.promise}}((this||0).self||global),function(e){var t=e.khutil,i=new RegExp("[a-zA-Z0-9_-]+\\/\\.\\.\\/");t.resolvePath=function(e){if(e&&e.startsWith("res/")){var t=kh.createInstance("router");t.getCurrentComponent()!==t.getRawCurrentComponent()&&(e="../"+t.getCurrentComponent()+"/"+e)}if(!e||0===e.indexOf("data:")||-1===e.indexOf("/.."))return e;for(var n=e.replace(i,"");i.test(n);)n=n.replace(i,"");return n}}((this||0).self||global),function(e){var t=e.khutil,n=e.kh;t.convertPathForMainFrame=function(e){return t.resolvePath(n.env.frontRootPath+"/cocos2d-proj/components-"+(n.env.isSp?"sp":"pc")+"/"+n.createInstance("router").getRawCurrentComponent()+"/"+e)}}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.PositionGenerator=n.Class.extend({className:"kh.PositionGenerator",generateRandomPositionInRect:function(e){return n.p(~~(.5+e.width*Math.random()+e.x),~~(.5+e.height*Math.random()+e.y))}})}((this||0).self||global),function(e){var o=e.cc,t=e.kh,r=e._;t.NotificationCenter=o.Class.extend({className:"kh.NotificationCenter",addEventListener:function(e,t,n){if(!r.isString(e))throw"invalid argument: eventName is not String";if(!r.isFunction(t))throw"invalid argument: callback is not function";var i=o.EventListener.create({event:o.EventListener.CUSTOM,eventName:e,callback:function(e){t.apply(n,e.getUserData())}});return o.eventManager.addListener(i,1),i},dispatchEvent:function(e,t){var n=new o.EventCustom(e);n.setUserData(t),o.eventManager.dispatchEvent(n)},removeEventListener:function(e){o.eventManager.removeListener(e)},removeEventListenersByEventName:function(e){o.eventManager.removeCustomListeners(e)}})}((this||0).self||global),function(e){var t=e._;e.khutil.runSequence=function(e,n){return t.map(e,function(e,t){return function(){return n(e,t)}}).reduce(Q.when,Q()).fail(function(e){console.error(e)})}}((this||0).self||global),function(e){var t=(e._,e.khutil);t.fadeIn=function(e,t){var n=Q.defer();return e.runAction(cc.sequence(cc.fadeIn(t,255),cc.callFunc(n.resolve))),n.promise},t.fadeOut=function(e,t){var n=Q.defer();return e.runAction(cc.sequence(cc.fadeOut(t,0),cc.callFunc(n.resolve))),n.promise}}((this||0).self||global),function(a){var e=a.kh,s=a.Q,t=a.superagent,c=a.html2canvas;e.convertHTMLToTexture=function(o,n,i){var r=s.defer();return i?t.get(e.getAddVersionQueryString(i)).end(function(e,t){e?(a.console.warn("CSS fetch failed: "+i),r.resolve("")):r.resolve("<style>"+t.text+"\n*{line-height:0.9;}</style>")}):r.resolve(""),r.promise.then(function(e){var t=a.document.createElement("div");return t.style.width=n.width+"px",t.style.height=n.height+"px",t.style.position="absolute",t.style.left="0px",t.style.top="0px",t.style.zIndex="-1",t.style.fontFamily="GameFont",0<=o.indexOf("undefined")&&(console.warn("Wrong html string detected:\n"+o),o=o.replace(/width: ?undefinedpx;/g,"width:100%;").replace(/height: ?undefinedpx;/g,"height:auto;")),t.innerHTML=e+o,a.document.body.appendChild(t),document.fonts?document.fonts.load("22px GameFont").then(function(){return t}):t}).then(function(e){var i=s.defer(),t=document.createElement("canvas");return t.setAttribute("html2canvas",1),t.setAttribute("renderWidth",n.width),c(e,{letterRendering:!1,canvas:t,removeContainer:!0,width:n.width,height:n.height,onrendered:function(t){if(e.parentNode.removeChild(e),"function"==typeof a.createImageBitmap)return a.createImageBitmap(t).then(function(e){var t=new cc.Texture2D;t.initWithElement(e),t.handleLoadedTexture(!0),i.resolve(t),t=null},function(e){return console.warn(e,t,o),s.reject(e)}),void(t=null);var n=new Image;n.src=t.toDataURL("image/png"),n.addEventListener("load",function(){var e=new cc.Texture2D;e.initWithElement(n),e.handleLoadedTexture(),i.resolve(e),n=null}),t=null}}),i.promise})}}((this||0).self||global),function(c){c.kh=c.kh||{};var e=c.kh,u=c._,t=c.Q,s=c.ccui,r=c.cc;e.setTouchEventHandlers=function(i,e,a){return u.chain(e).transform(function(e,t,n){var i=n.split(/\s/),o=i[0],r=i[1];return e[r]=e[r]||{},u.has(s.Widget,o)?void(e[r][s.Widget[o]]=u.isFunction(t)?t:a[t]):void c.console.warn("invalid parameter: {"+n+": "+t+"}")}).map(function(n,e){var t=i.seekWidgetByPath(e);return t?(t.setTouchEnabled(!1),t.setTouchEnabled(!0),t.addTouchEventListener(function(e,t){u.has(n,t)&&n[t].call(this,e,t)},a),t):(c.console.warn("node not found: "+e),null)}).filter(function(e){return!u.isNull(e)}).each(function(e){var t=e.onExit;e.onExit=function(){e.setTouchEnabled(!1),t&&t.call(e),t=null}}),t.resolve()},e.setMouseEventHandlers=function(o,e,a){var s={MOUSE_ENTER:0,MOUSE_LEAVE:1};return u.chain(e).transform(function(e,t,n){var i=n.split(/\s/),o=i[0],r=i[1];return e[r]=e[r]||{},console.log(n),u.has(s,o)?void(e[r][s[o]]=u.isFunction(t)?t:a[t]):void c.console.warn("invalid parameter: {"+n+": "+t+"}")}).map(function(e,t){var n=o.seekWidgetByPath(t);if(!n)return c.console.warn("node not found: "+t),null;n._mouseEntered=!1;var i=r.EventListener.create({event:r.EventListener.MOUSE,onMouseMove:function(e){var t=e.getCurrentTarget(),n=t.convertToNodeSpace(e.getLocation()),i=r.rect(0,0,t.width,t.height);return r.rectContainsPoint(i,n)?(t._mouseEntered||(this.onMouseEnter.call(a,e),t._mouseEntered=!0),!0):(t._mouseEntered&&(this.onMouseLeave.call(a,e),t._mouseEntered=!1),!1)},onMouseEnter:e[0]||function(){},onMouseLeave:e[1]||function(){}});return n._mouseEventListener=i,r.eventManager.addListener(i,n),n}).filter(function(e){return!u.isNull(e)}).each(function(e){var t=e.onExit;console.log(e._name),e.onExit=function(){r.eventManager.removeListener(e._mouseEventListener),e._mouseEventListener=null,t&&t.call(e),t=null}}),t.resolve()}}((this||0).self||global),function(e){var r=e._,i=e.khutil,a=e.console;i.getWidget=function(e,t){var n=cc.director.getRunningScene();return i.getWidgetFromNode(n,e,t)},i.getWidgetFromNode=function(e,t,n){var i=e.seekWidgetByName(t);if(null!=i)return i;var o="Could not find widget {"+t+"} from node {"+e.getName()+"}!";return r.isFunction(n)?n(o):a.warn(o),null}}((this||0).self||global),function(e){var t=e.khutil;t.mergeMp3Resources=function(e,t,n){var i=e._config.sound_info;return i.sound_enabled&&i.se_enabled&&n&&n.length&&(t=t.concat(n),n.length=0),t},t.preloadSe=function(e){e.isSoundOn()&&e.isSeOn()&&(new kh.SoundEffects).preload()},t.playBGM=function(e){if(e.isSoundOn()&&e.isBgmOn()){var t=kh.createInstance("router"),n=t.getCurrentComponent(),i=t.getCurrentSceneName();(new kh.BGM).playByComponents(n,i)}else(new kh.BGM).stop(!0)}}((this||0).self||global),function(e){var t=e._;e.khutil.cloneWithAction=function(e){var t=i(e),n=e.clone();return o(n,t),n};var i=function(e){var t={};return e.seekWidgets(function(e){return e instanceof cc.Sprite&&console.warn("クローンできないノードが含まれています",e.getName()),e.getActionByTag(e.tag)}).forEach(function(e){return t[e.getTag()]=e.getAction()}),t},o=function(o,r){t.isEmpty(r)||o.seekWidgets(function(n){var e=n.getTag(),i=r[e];if(!i)return!1;var t=i.clone();return t.getTimelines().forEach(function(e){var t=ccui.helper.seekActionWidgetByActionTag(n,e.getActionTag());null===t&&(t=ccui.helper.seekActionWidgetByActionTag(o,e.getActionTag())),t||console.warn("アクションの対象ノードを特定できませんでした:"+n.getName(),i.animationInfo),e.setNode(t)}),t.setTag(e),n.runAction(t),!1})}}((this||0).self||global),function(e){var t=e.kh,a=e._;t._capitalize=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},t._camelize=function(e){return e.replace(/^[_-\s]+|[_-\s]+$/g,"").replace(/[-_\s](\w)/g,function(){return arguments[1].toUpperCase()}).replace(/^(\w)/g,function(){return arguments[1].toLowerCase()})},t._snakeCase=function(e){return e.replace(/[A-Z]/g,function(e){return"_"+e.charAt(0).toLowerCase()})},t._getExtension=function(e){var t=e.lastIndexOf(".");return-1===t?"":e.slice(t,e.length)},t._getFileNameFromPath=function(e){var t=e.lastIndexOf("/");return-1===t?"":e.slice(t+1,e.length)},t._getFileRootPath=function(e){var t=e.lastIndexOf("/");return-1===t?"":e.slice(0,t+1)},t._padZero=function(e,t){var n=a.isNumber(e)?e:parseInt(e);return isNaN(n)?"":t<n.toString().length?n.toString():(a.range(0,t).map(function(){return 0}).join("")+n.toString()).slice(0-t)},t._partition=function(e,i,t){i=a.iteratee(i,t);var o=[],r=[];return a.each(e,function(e,t,n){(i(e,t,n)?o:r).push(e)}),[o,r]},t._iteratee=function(e,t,n){return null==e?a.identity:a.isFunction(e)?function(o,r,e){if(void 0===r)return o;switch(null==e?3:e){case 1:return function(e){return o.call(r,e)};case 2:return function(e,t){return o.call(r,e,t)};case 3:return function(e,t,n){return o.call(r,e,t,n)};case 4:return function(e,t,n,i){return o.call(r,e,t,n,i)}}return function(){return o.apply(r,arguments)}}(e,t,n):a.isObject(e)?a.matches(e):a.property(e)},a.mixin({capitalize:t._capitalize}),a.mixin({camelize:t._camelize}),a.mixin({snakeCase:t._snakeCase}),a.mixin({getExtension:t._getExtension}),a.mixin({getFileNameFromPath:t._getFileNameFromPath}),a.mixin({getFileRootPath:t._getFileRootPath}),a.mixin({padZero:t._padZero}),a.mixin({partition:t._partition}),a.mixin({iteratee:t._iteratee})}((this||0).self||global),function(e){var t=e.cc,s=e.kh,c=(e.ccs,e._),n=e.console;s.PaymentRequest=t.Class.extend({name:"KHPaymentRequest",requestShopItem:function(e,t){var n=Q.defer();if(s.env.isSp){var i=c.assign({shop_item_id:e.itemId,amount:e.num},t||{});e.shop_event_id&&(i.shop_event_id=e.shop_event_id),i.t=Date.now();var o=s.createInstance("router").getCurrentFragment();o&&(i.route=o);var r=s.env.paymentRedirectURL+"?";r+=c.map(i,function(e,t){return t+"="+e}).join("&"),s.postMessage("redirectURL",[r])}else{var a={};a.sku_id="shop_item_"+e.itemId,a.price=e.price,a.count=e.num,a.name=e.name,a.description=e.description,a.image_url=s.Img("corecard",e.contentType,c.padZero(e.contentId,4)).jpg,s.postMessage("paymentRequest",[a]),this[a.sku_id]=n}return n.promise},requestGacha:function(e,t){var n=Q.defer();if(s.env.isSp){var i=c.assign({event_id:e.eventId,gacha_id:e.gachaId,amount:e.num},t||{});null==i.component&&null==i.route&&(i.component="gacha",i.route="ga_100"),i.t=Date.now();var o=s.env.paymentRedirectURL+"?";o+=c.map(i,function(e,t){return t+"="+e}).join("&"),s.postMessage("redirectURL",[o])}else{var r={};r.sku_id="gacha_"+e.gachaId,r.price=e.price,r.count=e.num,r.name=e.name,r.description=e.description,r.image_url=s.Img("corecard","gacha",c.padZero(e.gachaId,4)).jpg,s.postMessage("paymentRequest",[r]),this["gacha_"+e.gachaId]=n}return n.promise},returnPaymentResult:function(e,t){return null==this[e]?void n.warn("KHPaymentRequest.returnPaymentResult: result request could not be traced back."):(this[e].resolve(t),void(this[e]=null))}})}((this||0).self||global),function(e){var o=e.blowfish,r=e.kh||{};r.dirnameLast4Char=function(e){var t=e.lastIndexOf("."),n=-1<t?e.substr(0,t):e;return[[-4,2],[-2,2]].map(function(e){return String.prototype.substr.apply(n,e)}).join("/")+"/"+e},r.img=function(){var e,t=Array.prototype.slice.call(arguments);e=1===t.length?t[0]:Array.prototype.slice.call(arguments).join("_");var n=o.encrypt(e,"bLoWfIsH",{outputType:1,cipherMode:0}),i={};return Object.defineProperties(i,{png:{get:function(){return r.env.imgRoot+"/"+r.dirnameLast4Char(n+".png")}},jpg:{get:function(){return r.env.imgRoot+"/"+r.dirnameLast4Char(n+".jpg")}}}),i},r.itemImg=function(e){return r.Img("corecard","item",_.padZero(e,4)).jpg},r.imgMock=function(){var e,t=Array.prototype.slice.call(arguments);e=1===t.length?t[0]:Array.prototype.slice.call(arguments).join("_");var n={};return Object.defineProperties(n,{png:{get:function(){return r.env.imgRoot+"/"+e+".png"}},jpg:{get:function(){return r.env.imgRoot+"/"+e+".jpg"}}}),n}}((this||0).self||global),function(e){var t=e.cc,n=e.kh;e.ccs,e._,n.MakeRequest=t.Class.extend({name:"KHMakeRequest",defers:[],deferCount:0,response:function(e){this.defers[e.deferCount].resolve({body:e.data}),delete this.defers[e.deferCount]},request:function(e){return e.deferCount=this._createDefer(),n.postMessage("makeRequest",[e]),this.defers[e.deferCount].promise},_createDefer:function(){return this.deferCount++,this.defers[this.deferCount]=new Q.defer,this.deferCount}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.HtmlBuilder=n.Class.extend({className:"kh.HtmlBuilder",makeTable:function(e){var n='<div style="padding-top:10px;visibility:hidden;"></div>';return n+='<style type="text/css">table.t td.l{text-align:left;} table.t td.r{text-align:right;} table.t td.c{text-align:center;}</style>',n+='<table width="100%" class="t"><tbody>',_.each(e,function(e){if(n+="<tr>",1==e.length){var t=e[0];n+='<td class="c '+t[0]+'" colspan="2">'+t[1]+"</td>"}else 0==e.length?n+='<td class="c" colspan="2">&nbsp;</td>':(n+='<td width="50%" class="r '+e[0][0]+'">'+e[0][1]+"</td>",n+='<td width="50%" class="l '+e[1][0]+'">'+e[1][1]+"</td>",_.each(e,function(e){}));n+="</tr>"}),n+="</tbody></table>"},makeDivAndSpans:function(e){var t='<div style="padding-top:10px;visibility:hidden;"></div>';return t+='<style type="text/css">span.s{font-size:20px;display:inline-block;margin:6px 2px;letter-spacing:1px;}</style>',_.each(e,function(e){t+='<div class="text_common mini">',_.each(e,function(e){t+='<span class="s '+e[0]+'">'+e[1]+"</span>"}),t+="</div>"}),t},insertBrTagForText:function(e,r){var t=(e=e||"").split(/\r\n?|\n|<br\s*\/?>/),a=[];return _.each(t,function(e){var t=e.length;if(0<r&&r<t){var n=new RegExp(".{"+r+"}","g"),i=e.substr(t-t%r),o=e.match(n);0<i.length&&o.push(i),Array.prototype.push.apply(a,o)}else a.push(e)},this),a.join("<br/>")}})}((this||0).self||global),function(h){var d=h.blowfish,p=h.kh||{},g="bLoWfIsH",f=null;p.generateResourcePath=function(e,t,n){var i=function(t){return f||(f=[],p.env.useResourcePathMock&&f.push({root:"",uglifyType:"none",pathList:p.mockResourcePaths||{}}),f=f.concat([{root:p.env.battleAnimationRoot+"/",uglifyType:p.env.useBattleResourceUglifiedPathName?"folder":"none",pathList:p.animationResourcePaths||{}},{root:p.env.imgRoot+"/",uglifyType:p.env.useUglifiedPathName?"filename":"none",pathList:p.imageResourcePaths||{}},{root:p.env.soundRoot+"/",uglifyType:p.env.useSoundUglifiedPathName?"both":"none",pathList:p.soundResourcePaths||{}},{root:"",uglifyType:"none",pathList:p.localResourcePaths||{}}])),_.find(f,function(e){return!!e.pathList[t]})}(e);if(null==i)return h.console.warn("KHAnimationResourcePathGenerator failed to generate a path"),null;var o=i.pathList[e],r=i.root,a=-1===(o=(o=(o=(o=(o=o.replace(/######/g,_.padZero(t||0,4)+_.padZero(n||0,2))).replace(/#####/g,_.padZero(t||0,4)+(n||"0"))).replace(/####/g,_.padZero(t||0,4))).replace(/##/g,_.padZero(t||0,2))).replace("#",n||"0")).search(/\//)?o:_.getFileNameFromPath(o),s=o.split(a)[0],c=_.getExtension(a);a=a.replace(c,""),"folder"===i.uglifyType&&(s=s.replace(/\/$/,""),s=d.encrypt(s,g,{outputType:1,cipherMode:0}),s=p.dirnameLast4Char(s),s+="/"),"filename"===i.uglifyType&&(a=d.encrypt(a,g,{outputType:1,cipherMode:0}),a=p.dirnameLast4Char(a));var u=s+a;"both"===i.uglifyType&&(u=d.encrypt(u,g,{outputType:1,cipherMode:0}),u=p.dirnameLast4Char(u));var l={};return l[c.slice(1)]=r+u+c,l};var r=p.generateResourcePath;p.generateAvatarAnimationPaths=function(e,t,n){return r(t?"jobAnimation":"avatarAnimation",e,n)},p.generateAvatarSoundPaths=function(t,e,n,i){var o=e?"jobSound":"avatarSound";return _.map(_.range(i-n),function(e){return r(o,t,n+e).mp3})},p.generateLevelUpSoundPath=function(e){return null==e&&(e=1),r("seLvlUp",e)}}((this||0).self||global),function(e){var t=e.kh,n=e.cc,r=e._;t.FrameAnimationHelper=n.Class.extend({ctor:function(){this._lastTag=0},createAction:function(e,t,n){var i=new ccs.ActionTimeline,o=this._lastTag++;return i.setTag(o),r.each(t,function(e){e.setActionTag(o),e.setNode(n),i.addTimeline(e)}),this.setActionToNode(i,n),i.setDuration(e),i.setTimeSpeed(1),i},setActionToNode:function(e,t){null!=t&&t.setUserObject(new ccs.ActionTimelineData(e.getTag()))},createPositionTimeline:function(e){var t=new ccs.Timeline;return r.each(e,function(e){t.addFrame(this._createPositionFrame(e.fi,e.pos))},this),t},createScaleTimeline:function(e){var t=new ccs.Timeline;return r.each(e,function(e){t.addFrame(this._createScaleFrame(e.fi,e.scale))},this),t},createAlphaTimeline:function(e){var t=new ccs.Timeline;return r.each(e,function(e){t.addFrame(this._createAlphaFrame(e.fi,e.alpha))},this),t},createEventTimeline:function(e){var t=new ccs.Timeline;return r.each(e,function(e){t.addFrame(this._createEventFrame(e.fi,e.event))},this),t},_createPositionFrame:function(e,t){var n=new ccs.PositionFrame;return n.setFrameIndex(e),n.setPosition(t),n.setTween(!0),n},_createScaleFrame:function(e,t){var n=new ccs.ScaleFrame;return n.setFrameIndex(e),n.setScaleX(t.x||t),n.setScaleY(t.y||t),n.setTween(!0),n},_createEventFrame:function(e,t){var n=new ccs.EventFrame;return n.setFrameIndex(e),n.setEvent(t),n},_createAlphaFrame:function(e,t){var n=new ccs.AlphaFrame;return n.setFrameIndex(e),n.setAlpha(t),n.setTween(!0),n}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.ComponentCache=n.Class.extend({ctor:function(){this._cache={}},cache:function(e,t,n){this._cache[e]=this._createCacheEntry(t,n)},get:function(e){var t=this._cache[e];return t?this._isCacheEntryExpired(t)?(this.delete(e),null):t.data:null},delete:function(e){delete this._cache[e]},clear:function(){Object.keys(this._cache).forEach(function(e){delete this._cache[e]}.bind(this))},_createCacheEntry:function(e,t){var n={data:e};return _.isNumber(t)&&(n.expiresAt=Date.now()+t),n},_isCacheEntryExpired:function(e){return null!=e.expiresAt&&e.expiresAt<Date.now()}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,o=e._;t.QueryParameterDataConverter=n.Class.extend({className:"QueryParameterDataConverter",convertRecordCollection:function(e){var t=this._buildRecordKeyholder(o.sample(e)),n=o.map(e,function(e){return this._convertRecord(e,t)},this);return{keys:t,records:n}},_convertRecord:function(t,e){return o.map(e,function(e){return t[e]})},revertRecordCollection:function(e){var t=this._extractRecordKeyholder(e),n=this._extractConvertedRecords(e);return o.map(n,function(e){return this._revertRecord(e,t)},this)},_revertRecord:function(i,e){return o.reduce(e,function(e,t,n){return e[t]=i[n],e},{})},_buildRecordKeyholder:function(e){return o.keys(e)},_extractRecordKeyholder:function(e){return e.keys?e.keys:(console.warn("KHQueryParameterDataConverter._extractRecordKeyholder: cannot revert record collection, missing keys property."),[])},_extractConvertedRecords:function(e){return e.records?e.records:(console.warn("KHQueryParameterDataConverter._extractConvertedRecords: cannot revert record collection, missing records property."),[])}})}((this||0).self||global),function(e){var i=e.kh,o=e.cc;i.SmartBeat=o.Class.extend({config:null,ctor:function(){this.config=i.env.isSp?i.env.smartBeat.sp:i.env.smartBeat.pc},init:function(){this._isEnabled()&&SmartBeat.init(this.config.apiKey,this.config.appVersion,this.config.appName)},_isEnabled:function(){return"undefined"!=typeof SmartBeat&&this.config.enabled},registBreadcrumb:function(e){this._isEnabled()&&SmartBeat.leaveBreadcrumb(e)},registCustomData:function(e,t){this._isEnabled()&&SmartBeat.addExtraData(e,t)},registUserId:function(e){this._isEnabled()&&SmartBeat.setUser(e)},sendError:function(e){this._isEnabled()&&this._sendErrorLog(e)},_sendErrorLog:function(e){var t="UNDEFINED"|o.sys.localStorage.getItem("KHUserId"),n="UNDEFINED"|o.sys.localStorage.getItem("KHUserName");this.registUserId(t),this.registCustomData("USERNAME",n),o.sys.isNative||this.registCustomData("DEPLOY_VERSION",i.version.app),SmartBeat.handledException(e.message||"エラーメッセージが無い",e.fileName||"シーン名: "+i.createInstance("router").getCurrentSceneName(),e.lineNumber||0,e.columnNumber||0,e)},log:function(e){},sendImageErrorLog:function(e,t){this._isEnabled()&&this._shouldSendImageErrorLog(t)&&this._sendErrorLog(e)},_shouldSendImageErrorLog:function(e){if(-1!==e.indexOf("data:"))return!1;var t=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP");return t.open("GET",e,!1),t.send(null),404===t.status}})}((this||0).self||global),function(i){var t=i.cc,e=i.kh,r=i.khutil,s=i._,c=i.console;e.Loader=t.Class.extend({className:"KHLoader",load:function(e){var t=this._separateJsons(e);return Q.all([this._loadJsons(t.jsons),this._load(t.rest)]).then(function(){return e})},_separateJsons:function(e){var t=s.partition(e,function(e){return-1!=e.search(".json")||-1!=e.search(".ExportJson")});return{jsons:t[0],rest:t[1]}},_loadJsons:function(e){var o=this._filterPlists.bind(this),r=this._filterAudio.bind(this),a=this._load.bind(this);return Q.all(s.map(e,function(e){var n=Q.defer(),i=s.getFileRootPath(e);return t.loader.load(e,function(e,t){return null==t[0]?(c.warn("KHLoader._loadJsons: "+e),void n.resolve()):void a(o(t[0],i).concat(r(t[0],i))).then(n.resolve)}),n.promise}))},_load:function(e){var n=Q.defer();return t.loader.load(e,function(e,t){null!=e&&i.console.error(e),n.resolve(t)}),n.promise},_filterPlists:function(e,t){if(null!=e.config_file_path)return s.map(e.config_file_path,function(e){return t+e});var n=[],i=e.Content.Content,o=function(e){e.FileData&&null!=e.FileData.Plist&&""!==e.FileData.Plist&&n.push(t+e.FileData.Plist),null!=e.Children&&s.each(e.Children,o)};return null!=i.ObjectData&&o(i.ObjectData),o=null,s(i.Animation.TimeLines).filter({Property:"FileData"}).each(function(e){null!=e.Frames&&s.each(e.Frames,function(e){null!=e.TextureFile&&null!=e.TextureFile.Plist&&""!=e.TextureFile.Plist&&n.push(t+e.TextureFile.Plist)})}),s.uniq(n)},_filterAudio:function(e,n){if(!e.Content||!e.Content.Content)return[];var i=[],t=e.Content.Content,o=function(e){if("SimpleAudioObjectData"===e.ctype&&!s.isEmpty(e.FileData)){var t=r.resolvePath(n+e.FileData.Path);i.push(t)}e.Children&&e.Children.length&&s.each(e.Children,o)};return null!=t.ObjectData&&o(t.ObjectData),o=null,s.uniq(i)}})}((this||0).self||global),function(e){var t=e.cc,u=e.kh;u.HttpConnection=t.Class.extend({name:"KHHttpConnection",DEFAULT_RETRY_SETTINGS:{minWait:3e3,maxCount:2,deadline:1e4,ignoreCodes:[422,403,409,404,405,440,503,500],maintenanceCodes:[405,503],restartCodes:[440],retryCodes:[408]},ctor:function(){this._createConnection(),this.retrySettings=this._connect.retrySettings||this.DEFAULT_RETRY_SETTINGS,this._URLDelegate={process:function(e){return e}}},_createConnection:function(){this._connect=u.createInstance("HttpSuperAgentConnection")},setURLDelegate:function(e){this._URLDelegate=e},_connect:null,_wrapFireEvent:function(e,t){var n=Q.defer(),i={count:0,startAt:(new Date).getTime()};return t.urlOrg=t.url,this.__fireEventCore(e,t,n,i),n.promise},_maintenanceErrorHandler:function(e){if(null==e)return!1;if(this.retrySettings.maintenanceCodes.indexOf(e.status)<0)return!1;var t=u.env.isR18?u.env.R18GameURL:u.env.GeneralGameURL,n=document.createEvent("MouseEvent");n.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null);var i=document.createElement("a");return i.target="_top",i.href=t,i.dispatchEvent(n),!0},__reportComError:function(){u.createInstance("smartBeat").log("URL : "+arguments[0].url),u.createInstance("smartBeat").log("JSON : "+JSON.stringify(arguments[0].json)),u.createInstance("smartBeat").log("RESULT : "+arguments[2].result),console.error("reportCommunicationError-"+arguments[0].urlOrg)},__fireEventCore:function(e,t,n,i){u.createInstance("notificationCenter").dispatchEvent("connectionBegan",[t.url,i]);i.result="-";var o=Array.prototype.slice.apply(arguments);e.call(this,t).then(function(e){u.createInstance("componentCache").get("aborted_connection")?u.createInstance("notificationCenter").dispatchEvent("connectionEnded",[t.url,i]):this._processSucceededResponse(o,e)||"-"===i.result&&this._checkErrorAndRetryIfNeeded(o,e)}.bind(this)).fail(function(e){u.createInstance("componentCache").get("aborted_connection")?u.createInstance("notificationCenter").dispatchEvent("connectionEnded",[t.url,i]):this._checkErrorAndRetryIfNeeded(o,e)}.bind(this))},_checkErrorAndRetryIfNeeded:function(e,t){var n=(e[0],e[1],e[2],e[3]),i=(new Date).getTime();if(t){var o=[this._maintenanceErrorHandler.bind(this)];if(_.some(o,function(e){return e(t)}))return}if(0<=this.retrySettings.restartCodes.indexOf(t.status))this._processRestartResponse(e,t,i,"restart:"+t.status);else if(0<=this.retrySettings.retryCodes.indexOf(t.status))this._processRetryResponse(e,t,i,"retry:"+t.status);else if(0<=this.retrySettings.ignoreCodes.indexOf(t.status))this._processErrorTerminate(e,t,i,"ignored:"+t.status);else if(this.retrySettings.maxCount>n.count){var r=i-(n.lastRetryAt||n.startAt);r>this.retrySettings.deadline?this._processErrorTerminate(e,t,i,"giveup"):this._retryAfterMinWait(e,t,r)}else this._processErrorTerminate(e,t,i,"no_count")},_retryAfterMinWait:function(e,t,n){var i=e[0],o=e[1],r=e[2],a=e[3],s=function(){a.count++,a.lastRetryAt=(new Date).getTime(),o.url=o.urlOrg||o.url,this.__fireEventCore(i,o,r,a)}.bind(this);a.result="retrying",u.createInstance("notificationCenter").dispatchEvent("connectionFailed",[o,t,a]);var c=this.retrySettings.minWait-n;0<c?setTimeout(s,c):s()},_processErrorTerminate:function(e,t,n,i){var o=e[1],r=e[2],a=e[3];a.endAt=n,a.result=i,u.createInstance("notificationCenter").dispatchEvent("connectionFailed",[o,t,a]),r.reject(t)},_processSucceededResponse:function(e,t){if(_.isUndefined(t)||_.isUndefined(t.body))return!1;var n=e[1],i=e[2],o=e[3];return o.endAt=(new Date).getTime(),o.result="success",u.createInstance("notificationCenter").dispatchEvent("connectionEnded",[n.url,o]),i.resolve(t),!0},_processRestartResponse:function(e,t){if(_.isUndefined(t)||_.isUndefined(t.body))return!1;u.createInstance("componentCache").cache("aborted_connection",!0);var n=e[1],i=(e[2],e[3]);return i.endAt=(new Date).getTime(),i.result="restart",u.createInstance("notificationCenter").dispatchEvent("connectionEnded",[n.url,i]),u.postMessage("removeLoading"),this._openMessagePopup(),!0},_openMessagePopup:function(){var e=Q.defer(),t={title:"セッションエラー",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(){u.postMessage("reload")}}},n=u.createInstance("popupFactoryTextOnly").create(t);return n.open().then(function(){n.setContent("接続に失敗しました。<br />トップページに移動します。")}.bind(this)),e.promise},_processRetryResponse:function(e,t,n,i){if(_.isUndefined(t)||_.isUndefined(t.body))return!1;var o=e[1],r=e[3];r.endAt=n,r.result=i,u.createInstance("notificationCenter").dispatchEvent("connectionEnded",[o.url,r]),u.postMessage("removeLoading"),this._openRetryMessagePopup(e,t,this.retrySettings.minWait)},_openRetryMessagePopup:function(t,n){var e=u.createInstance("popupFactoryLockWaitTimeout").create();e.open({onBlueBtnCallback:function(){var e=t[3];this.retrySettings.maxCount>e.count?this._retryAfterMinWait(t,n,this.retrySettings.minWait):u.postMessage("reload")}.bind(this)}).then(function(){e.setContent("サーバーエラーが発生しました。<br/> 通信を再試行します。")}.bind(this))},_processUnknownEnd:function(e,t){var n=e[1],i=e[2],o=e[3];o.endAt=(new Date).getTime(),o.result="unknown_end",u.createInstance("notificationCenter").dispatchEvent("connectionEnded",[n.url,o]),this.__reportComError(n,{},o),i.reject(t)},_normalizeId:function(e){if(!this._normalizeIdFunc){var o=function(e){if(e instanceof Object)for(var t in e){var n=null;if(e.hasOwnProperty(t)&&"text_id"!==t)if(/_?id$/.test(t)&&(n=Number(e[t])))e[t]=n;else if(/_?ids$/.test(t)&&Array.isArray(e[t]))for(var i in e[t])(n=Number(e[t][i]))&&(e[t][i]=n);else e[t]instanceof Object&&o(e[t])}};this._normalizeIdFunc=o}return this._normalizeIdFunc(e),e},get:function(e){return this._wrapFireEvent(function(e){return e=this._normalizeId(e),this._connect.get(this._URLDelegate.process(e)).fail(function(e){throw e})},e)},post:function(e){return this._wrapFireEvent(function(e){return e=this._normalizeId(e),this._connect.post(this._URLDelegate.process(e)).then(function(e){return Q.delay(100).thenResolve(e)})},e)},put:function(e){return this._wrapFireEvent(function(e){return e=this._normalizeId(e),this._connect.put(this._URLDelegate.process(e)).then(function(e){return Q.delay(100).thenResolve(e)})},e)},del:function(e){return this._wrapFireEvent(function(e){return e=this._normalizeId(e),this._connect.del(this._URLDelegate.process(e)).then(function(e){return Q.delay(100).thenResolve(e)})},e)}})}((this||0).self||global),function(e){var t=e.cc,n=e.kh;n.HttpLoggingConnection=t.Class.extend({name:"KHHttpLoggingConnection",ctor:function(){this._createConnection(),this._URLDelegate={process:function(e){return e.url=n.env.loggingUrlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)}},_createConnection:function(){if(n.env.isIE)this._connect={get:this._httpReqForIE11};else{this._connect=n.createInstance("HttpSuperAgentConnection")}},_httpReqForIE11:function(e){var t=e.url,n=JSON.stringify(e.json).replace(/"/g,"'");return console.debug(n),t=t+"?json="+encodeURIComponent(n),(new Image).src=t,Q.resolve()},setURLDelegate:function(e){this._URLDelegate=e},_connect:null,log:function(e){return this._connect.get(this._URLDelegate.process(e))}})}((this||0).self||global),function(e){var t=e.cc,n=e.kh;n.HttpGadgetsConnection=t.Class.extend({name:"KHHttpGadgetsConnection",_makeRequest:function(e){return n.createInstance("makeRequest").request(e)},get:function(e){var t=e.url,n=e.json;return void 0!==n&&(t+=(-1===t.indexOf("?")?"?":"&")+"json="+JSON.stringify(n)),this._makeRequest({url:t,data:void 0,method:"GET"})},post:function(e){return this._makeRequest({url:e.url,data:e.json,method:"POST"})},put:function(e){return this._makeRequest({url:e.url,data:e.json,method:"PUT"})},del:function(e){return this._makeRequest({url:e.url,data:e.json,method:"DELETE"})}})}((this||0).self||global),function(e){var t=e.cc,n=e.kh,i=e.Cookies;n.HttpSuperAgentConnection=t.Class.extend({name:"KHHttpSuperAgentConnection",_csrfToken:null,_updateCsrfTokenIfExists:function(){var e=i.get("XSRF-TOKEN");void 0!==e&&(this._csrfToken=e)},_addCsrfTokenToClientHeader:function(e){return null===this._csrfToken||e.set("X-XSRF-TOKEN",this._csrfToken),e},_connect:function(e){var t=Q.defer();return e.withCredentials(),e.on("error",function(e){t.reject(e)}),e.end(function(e){e.ok?t.resolve(e):t.reject(e),this._updateCsrfTokenIfExists()}.bind(this)),t.promise},get:function(e){var t=e.url,n=e.json,i=superagent("GET",t);return void 0!==n&&i.query({json:JSON.stringify(n)}),this._connect(i)},post:function(e){var t=e.url,n=e.json,i=superagent("POST",t);return"object"==typeof n&&(i.set("Content-Type","application/json"),i.send(n)),i=this._addCsrfTokenToClientHeader(i),this._connect(i)},put:function(e){var t=e.url,n=e.json,i=superagent("PUT",t);return"object"==typeof n&&(i.set("Content-Type","application/json"),i.send(n)),i=this._addCsrfTokenToClientHeader(i),this._connect(i)},del:function(e){var t=e.url,n=e.json,i=superagent("DELETE",t);return void 0!==n&&(i.set("Content-Type","application/json"),i.send(n)),i=this._addCsrfTokenToClientHeader(i),this._connect(i)}})}((this||0).self||global),function(e){(e.kh||{}).InspectionObj=cc.Class.extend({ctor:function(e){console.debug(e),this._fields=e.fields_},getTextId:function(){return this._fields.textId},getData:function(){return this._fields.data}})}((this||0).self||global),function(e){var i=e.kh||{};i.InspectionApiDelegatePC=cc.Class.extend({createInspection:function(e){return i.postMessage("createInspection",[e]).then(function(e){return new i.InspectionObj(e)})},updateInspection:function(t,n){return i.postMessage("updateInspection",[t,n]).then(function(e){return new i.InspectionObj({fields_:{textId:t,data:n}})},function(e){console.error(e)})},createOrUpdateInspection:function(e,t){return e?this.updateInspection(e,t).then(function(){return e},function(e){console.error(e)}):this.createInspection(t).then(function(e){return e.getTextId()},function(e){console.error(e)})}})}((this||0).self||global),function(e){var n=e.kh||{};n.InspectionApiDelegateSP=cc.Class.extend({createInspection:function(e){return Q.resolve(new n.InspectionObj({fields_:{textId:null,data:e}}))},updateInspection:function(e,t){return Q.resolve(new n.InspectionObj({fields_:{textId:e,data:t}}))},createOrUpdateInspection:function(e,t){return e?this.updateInspection(e,t).then(function(){return e}):this.createInspection(t).then(function(e){return e.getTextId()})}})}((this||0).self||global),function(e){var t=e.kh,n=e.Q;t.MockInspectionApiDelegate=cc.Class.extend({createInspection:function(e){return console.warn("[!! WARN !!] : MockInspectionApiDelegate.createInspection called"),n.resolve({getTextId:function(){return"9999999"},getData:function(){return e}})},updateInspection:function(e,t){return console.warn("[!! WARN !!] : MockInspectionApiDelegate.updateInspection called"),n.resolve(e)},createOrUpdateInspection:function(e,t){return console.warn("[!! WARN !!] : MockInspectionApiDelegate.createOrUpdateInspection called"),e?this.updateInspection().then(function(){return e}):this.createInspection().then(function(e){return e.getTextId()})}})}((this||0).self||global),function(e){var t=e.cc,n=e.kh,i=e._;n.DisposableAnimationNode=t.Node.extend({dummyAction:t.blink,ctor:function(e){this._super(this,arguments),this._actionStrategy=e,this.setCascadeOpacityEnabled(!0),this.setCascadeColorEnabled(!0)},onEnter:function(){this._super(),this.runAction(t.sequence([i.isFunction(this._actionStrategy)?this._actionStrategy():this.dummyAction(1,2),t.callFunc(function(){this.stopAllActions(),this.removeFromParent(!0)}.bind(this))]))}})}((this||0).self||global),function(e){var t=e.kh;e.console,t.EventSettings=t.EventSettings||{};function r(e,t){return function(){return e&&e.getRegisteredPulldownMenus&&!e.disposed?void _.each(e.getRegisteredPulldownMenus(),function(e){e.setTouchEnabled(t)}):void(e=null)}}t.EventSettings.overlappedPulldownMenu=function(e,t,n){var i=r(n,!0),o=r(n,!1);n.getRegisteredPulldownMenus&&(e.addEventListener("menu_open",o),e.addEventListener("menu_close",i))}}((this||0).self||global),function(e){var i=e.kh;i.EventSettings=i.EventSettings||{},i.EventSettings.removeRouterParamPartyToQuest=function(e,t,n){(t.startsWith("party")||t.startsWith("detail"))&&n.routerParams&&n.routerParams.party&&(n=null,e.addEventListener("navigate",function(e,t){e.startsWith("detail")||e.startsWith("party")||delete t.party}))},i.EventSettings.navigateWithoutRaidEvent=function(e,t){(i.createInstance("router").getCurrentComponent()||"").startsWith("raidevent")&&e.addEventListener("navigate",function(e,t){e.startsWith("raidevent")||["eventGachaCategories","raidEvent","orm","questSceneCommonDelegate","burstTime"].forEach(function(e){i.dictx.has(e)&&i.dictx.entry(e).object(null)})})},i.EventSettings.navigateWithoutScoreAttack=function(e,t){t.startsWith("scoreattack")&&e.addEventListener("navigate",function(e,t){e.startsWith("scoreattack")||i.dictx.has("scoreAttackEventDetail")&&i.createInstance("scoreAttackEventDetail").dispose()})},i.EventSettings.navigateWithoutTower=function(e,t){if(t.startsWith("tower")||t.startsWith("quest/q_003_")||t.startsWith("quest/q_002")){var n=["ATowerFloorStateRepository","QuestBattleInfoDataRepository"].filter(function(e){return i.dictx.has(e)});0!==n.length&&e.addEventListener("navigate",function(e,t){e.startsWith("tower")||n.forEach(function(e){i.dictx.entry(e).object(null)})})}},i.EventSettings.consoleRestore=function(e){e.addEventListener("navigate",function(e,t){t.consoleOn?window.CCL.restore():"Product"===i.env.mode&&window.CCL.save()})},i.EventSettings.cleanCacheOnSceneChange=function(e,t){var n=t.substring(0,t.indexOf("/"));e.addEventListener("navigate",function(e,t){0!==e.indexOf(n)&&i.dictx.has("componentCache")&&i.createInstance("componentCache").clear()})},i.EventSettings.stopCharacterVoice=function(e,t,n){t.startsWith("mypage")&&e.addEventListener("navigate",function(){var e=n.headerDelegate;void 0!==e&&(e.stopCharacterVoice(),n=null)})}}((this||0).self||global),function(e){var n=e.kh;n.EventSettings=n.EventSettings||{},n.EventSettings.playBGMByComponent=function(e){e.addEventListener("scene:prepared",function(e,t){"battle"===e||-1<e.indexOf("_battle")?n.createInstance("soundPlayer").init(n.createInstance("playerGameConfig")):n.createInstance("playerGameConfig").isSoundOn()?(new n.BGM).playByComponents(e,t):n.createInstance("soundPlayer").stopBgm()})}}((this||0).self||global),function(e){var o=e.kh;e.cc,e._,e.Q,o.pc=o.pc||{},o.pc.status=o.pc.status||{},o.pc.status.roles=o.pc.status.roles||{},o.pc.status.roles.ShSummonInfoCommon={setData:function(e,t){this._setCorecard(e,t),this._setSummonName(e,t.name),this._setAttackInfo(e,t.attack),this._setSupportInfo(e,t.effect),this._setMaxLimitSupportInfo(e,t.max_overlimit_effect.description),this._setHpAndAttack(e,t)},clearData:function(e){this._setSummonName(e,""),this._setAttackInfo(e,{name:"",description:""}),this._setSupportInfo(e,{name:"",description:""}),this._setMaxLimitSupportInfo(e,""),this._clearCorecard(e),e.seekWidgetByName("status_labelimg").setVisible(!1)},_setCorecard:function(e,t){var n=e.seekWidgetByName("corecard_summon_ui"),i=o.createInstance("CoreCardSummonUI",[null,n]);i.setImg(t.summon_id,t.skin||0),i.setPlusNo(t.bonus?"+"+t.bonus:""),i.setIconElement(t.element_type),i.setIconRarity(t.rare),i.setVisible(!0)},_clearCorecard:function(e){e.seekWidgetByName("corecard_summon_ui").setVisible(!1)},_setSummonName:function(e,t){this._setLabel(e,"summon_name_label",t)},_setAttackInfo:function(e,t){this._setLabel(e,"summon_attack_name_label",t.name),this._setLabel(e,"summon_attack_label",t.description)},_setSupportInfo:function(e,t){this._setLabel(e,"summon_support_name_label",t.name),this._setLabel(e,"summon_support_label",t.description)},_setMaxLimitSupportInfo:function(e,t){this._setLabel(e,"summon_support_max_label",t)},_setHpAndAttack:function(e,t){var n="<div style='padding-bottom:10px;width:100%;height:100%'>                   <table width='100%' height='100%'>                   <tr class='cyan_shadow'>                     <td><span class='cyan_shadow_mini'>MIN </span>"+t.min_hp+"</td>                     <td>-</td>                     <td><span class='cyan_shadow_mini'>MAX </span>"+t.max_hp+"</td>                     <td>　&nbsp;</td>                   </tr>                   <tr class='pink_shadow'>                     <td><span class='pink_shadow_mini'>MIN </span>"+t.min_attack+"</td>                     <td>-</td>                     <td><span class='pink_shadow_mini'>MAX </span>"+t.max_attack+"</td>                     <td>　&nbsp;</td>                   </tr>                 </table></div>";e.setHtmlStrings({status_labelimg:n},o.GameConfig.POPUP_CSS).then(function(){e.seekWidgetByName("status_labelimg").setVisible(!0)}.bind(this))},_setLabel:function(e,t,n){e.seekWidgetByName(t).string=n}}}((this||0).self||global),function(e){var a=e.kh,n=e.cc,s=e._;e.Q,a.pc=a.pc||{},a.pc.status=a.pc.status||{},a.pc.status.roles=a.pc.status.roles||{},a.pc.status.roles.ShWeaponInfoCommon={setData:function(e,t){this._setCorecard(e,t),this._setWeaponName(e,t.name),this._setWeaponIcon(e,t.weapon_type),this._setHpAndAttack(e,t);var n=e.seekWidgetByName("node_before_final")||e;n.setVisible(!0),this._setBurstInfo(n,t.burst),this._setSkillInfo(n,t.skills),this._setArouseStatus(e,t)},_setArouseStatus:function(e,t){var i=khutil.getWidgetFromNode(e,"btn_evo_final_after_before_ui",function(e){console.warn("ShWeaponInfoCommon._setArouseStatus: "+e)});if(null!==i){var o=khutil.getWidgetFromNode(e,"node_before_final",function(e){console.warn("ShWeaponInfoCommon._setArouseStatus: "+e)}),r=khutil.getWidgetFromNode(e,"node_after_final",function(e){console.warn("ShWeaponInfoCommon._setArouseStatus: "+e)});if(!t.can_arouse)return i.setAppearance("btn_off"),r.setVisible(!1),void o.setVisible(!0);var n=t.aroused_status;this._setBurstInfo(r,n.burst),this._setSkillInfo(r,n.skills),a.setTouchEventHandlers(i,{"TOUCH_ENDED btn_evo_final_after":function(e,t){i.setAppearance("btn_before"),this._setCorecard(e,s.extend({},t,{is_aroused:!0})),o.setVisible(!1),r.setVisible(!0);var n=s.extend({},t,t.aroused_status);this._setHpAndAttack(e,n)}.bind(this,e,t),"TOUCH_ENDED btn_evo_final_before":function(e,t){i.setAppearance("btn_after"),this._setCorecard(e,t),r.setVisible(!1),o.setVisible(!0),this._setHpAndAttack(e,t)}.bind(this,e,t)}),i.setAppearance("btn_after")}},clearData:function(e){this._setWeaponName(e,""),s(["status_labelimg","skill_label_0","skill_name_label_0","skill_label_1","skill_name_label_1","burst_label","weapon_icon","node_after_final"]).map(e.seekWidgetByName.bind(e)).invoke("setVisible",!1),this._clearCorecard(e)},_setCorecard:function(e,t){var n=e.seekWidgetByName("corecard_weapon_ui"),i=a.createInstance("CoreCardWeaponUI",["e_r",n]);i.setImg(t.weapon_id,t.skin||0),i.setAroused(t.is_aroused||!1),i.setPlusNo(t.bonus?"+"+t.bonus:""),i.setIconElement(t.element_type),i.setIconRarity(t.rare),i.setVisible(!0)},_clearCorecard:function(e){e.seekWidgetByName("corecard_weapon_ui").setVisible(!1)},_setWeaponName:function(e,t){this._setLabel(e,"weapon_name_label",t)},_setWeaponIcon:function(e,t){var n=e.seekWidgetByName("weapon_icon");n.loadTexture("core/res/icon/weapontypeicon_"+t+".png",ccui.Widget.PLIST_TEXTURE),n.setVisible(!0)},_setBurstInfo:function(e,t){e.seekWidgetByName("burst_label").setTextVerticalAlignment(n.VERTICAL_TEXT_ALIGNMENT_TOP),this._setLabel(e,"burst_label",t.description)},_setSkillInfo:function(r,e){s.each(s.merge([{name:"なし",description:""},{name:"なし",description:""}],e),function(e,t){var n="_"+t,i="skill_name_label"+n,o="skill_label"+n;this._setLabel(r,i,e.name),this._setLabel(r,o,e.description)}.bind(this))},_setHpAndAttack:function(e,t){var n="<div style='padding-bottom:10px;width:100%;height:100%'>                   <table width='100%' height='100%' style='white-space:nowrap;'>                   <tr class='cyan_shadow'>                     <td><span class='cyan_shadow_mini'>MIN </span>"+t.min_hp+"</td>                     <td>-</td>                     <td><span class='cyan_shadow_mini'>MAX </span>"+t.max_hp+"</td>                     <td>　&nbsp;</td>                   </tr>                   <tr class='pink_shadow'>                     <td><span class='pink_shadow_mini'>MIN </span>"+t.min_attack+"</td>                     <td>-</td>                     <td><span class='pink_shadow_mini'>MAX </span>"+t.max_attack+"</td>                     <td>　&nbsp;</td>                   </tr>                 </table></div>";e.setHtmlStrings({status_labelimg:n},a.GameConfig.POPUP_CSS).then(function(){e.seekWidgetByName("status_labelimg").setVisible(!0)}.bind(this))},_setLabel:function(e,t,n){var i=e.seekWidgetByName(t);null!==i&&(i.string=n,i.setVisible(!0))}}}((this||0).self||global),function(e){var t=e.kh,o=e.cc,r=e._;e.Q,t.createNameSpaceIfNotExists("pc.roles"),t.pc.roles.UIUtility={_setEnableButton:function(e,t){var n=null;r.isObject(e)?n=e:n=o.director.getRunningScene().seekWidgetByName(e);n.setEnabled(t),n.setColor(t?o.color("#FFFFFF"):o.color("#808080"))},_setGrayOutButton:function(e,t){r.isUndefined(e._cascadeColorEnabled)||e.setCascadeColorEnabled(!0);(r.isObject(e)?e:this.seekWidgetByName(e)).setColor(t?o.color("#FFFFFF"):o.color("#808080"))},_showNothingLabel:function(e){if(!r.isUndefined(e)&&!r.isNull(e)){var t=e.seekWidgetByName("nothing_label");return null===t?void console.warn("[ERROR] Could not find noghing label."):void t.setVisible(!0)}console.warn("[ERROR] Could not access scene object.")},_setGrayShader:function(e,t,n){function i(e,t){var n=t?ccui.Scale9Sprite.WebGLRenderCmd._getGrayShaderProgram():o.shaderCache.programForKey(o.SHADER_SPRITE_POSITION_TEXTURECOLOR),i=function(){this.setShaderProgram(n),this.removeEventListener("load",i)};return e instanceof ccui.Button?(e._buttonClickedRenderer.addLoadedEventListener(i,e._buttonClickedRenderer),e._buttonDisableRenderer.addLoadedEventListener(i,e._buttonDisableRenderer),void e._buttonNormalRenderer.addLoadedEventListener(i,e._buttonNormalRenderer)):e.getVirtualRenderer?void e.getVirtualRenderer().addLoadedEventListener(i,e.getVirtualRenderer()):void(e.setShaderProgram&&e.addLoadedEventListener(i,e))}(i(e,t),n)&&e.seekWidgets(r.isFunction(n)?n:function(){return!0}).forEach(function(e){i(e,t)})}}}((this||0).self||global),function(e){var n=e.kh,t=e.cc,i=e._,o=e.ccui;n.PAGE_CONTROLLER_CONTROLS={NUMBER_DISPLAY:0,NEXT_BUTTON:1,PREVIOUS_BUTTON:2,LAST_BUTTON:3,FIRST_BUTTON:4,TOGGLE_PAGE_BUTTON:5},n.PageController=t.Class.extend({className:"KHPageController",CONTROLLER_INITIALIZERS:i.invert({NumberDisplay:n.PAGE_CONTROLLER_CONTROLS.NUMBER_DISPLAY,NextButton:n.PAGE_CONTROLLER_CONTROLS.NEXT_BUTTON,PreviousButton:n.PAGE_CONTROLLER_CONTROLS.PREVIOUS_BUTTON,LastButton:n.PAGE_CONTROLLER_CONTROLS.LAST_BUTTON,FirstButton:n.PAGE_CONTROLLER_CONTROLS.FIRST_BUTTON,TogglePageButton:n.PAGE_CONTROLLER_CONTROLS.TOGGLE_PAGE_BUTTON}),init:function(e,t,n){return this._widget=e,this._pageView=n,this._initControls(t),this._pageView.addOnPageChangeCallback(this._updateButtonState,this),this},removeCallbacks:function(e){i.each(e,function(e,t){null!=e&&this["_remove"+this.CONTROLLER_INITIALIZERS[t]](e)},this),this._pageView.removeOnPageChangeCallback(this._updateButtonState)},_removeNumberDisplay:function(e){},_removeNextButton:function(e){o.helper.seekWidgetByName(this._widget,e).cleanup(),this._nextButton=null},_removePreviousButton:function(e){o.helper.seekWidgetByName(this._widget,e).cleanup(),this._previousButton=null},_removeLastButton:function(e){this._lastButton=o.helper.seekWidgetByName(this._widget,e),this._lastButton.cleanup(),this._lastButton=null},_removeFirstButton:function(e){this._firstButton=o.helper.seekWidgetByName(this._widget,e),this._firstButton.cleanup(),this._firstButton=null},_removeTogglePageButton:function(e){this._toggleButton=o.helper.seekWidgetByName(this._widget,e),this._toggleButton.cleanup(),this._toggleButton=null},_initControls:function(e){i.each(e,function(e,t){null!=e&&this["_init"+this.CONTROLLER_INITIALIZERS[t]](e)},this)},_initNextButton:function(e){var t=o.helper.seekWidgetByName(this._widget,e);t.setLockTimeout(0),t.addTouchEventListener(function(e,t){return this._pageView.isEnabled()?void(t===o.Widget.TOUCH_ENDED&&this._pageView.gotoNextPage()):void e.setHighlighted(!1)},this),t.setSound(n.SoundList.BUTTON_TOUCHED_SWITCH),this._setButtonEnabled(t,this._pageView.isLoopContent()),this._nextButton=t},_initPreviousButton:function(e){var t=o.helper.seekWidgetByName(this._widget,e);t.setLockTimeout(0),t.addTouchEventListener(function(e,t){return this._pageView.isEnabled()?void(t===o.Widget.TOUCH_ENDED&&this._pageView.gotoPreviousPage()):void e.setHighlighted(!1)},this),t.setSound(n.SoundList.BUTTON_TOUCHED_SWITCH),this._setButtonEnabled(t,this._pageView.isLoopContent()),this._previousButton=t},_initNumberDisplay:function(e){this._numberDisplay=o.helper.seekWidgetByName(this._widget,e),this._numberDisplay.string="1/"+this._pageView.getTotalPageNumber(),this._pageView.addOnPageChangeCallback(function(e,t,n){this._numberDisplay.string=t+"/"+n.length}.bind(this))},_initLastButton:function(e){this._lastButton=o.helper.seekWidgetByName(this._widget,e),this._lastButton.addTouchEventListener(function(e,t){t===o.Widget.TOUCH_ENDED&&this._pageView.gotoLastPage()},this)},_initFirstButton:function(e){this._firstButton=o.helper.seekWidgetByName(this._widget,e),this._firstButton.addTouchEventListener(function(e,t){t===o.Widget.TOUCH_ENDED&&this._pageView.gotoFirstPage()},this)},_initTogglePageButton:function(e){this._toggleButton=o.helper.seekWidgetByName(this._widget,e),this._toggleButton.addTouchEventListener(function(e,t){if(t===o.Widget.TOUCH_ENDED){var n=this._pageView;null==n.getNextPage()?n.gotoPreviousPage():null==n.getPreviousPage()&&n.gotoNextPage()}},this)},_updateByPagerCallback:function(e,t,n,i){var o=i.getNextPage(),r=i.getPreviousPage();this._updatePageByPager(e,t).then(function(){this._updatePageByPager(o,t+1),this._updatePageByPager(r,t-1)}.bind(this))},_updatePageByPager:function(t,e){if(null!=t)return this._pager.getPage(e).then(function(e){null!=t.update&&null!=e&&t.update(e)})},_updateButtonState:function(e,t,n,i){var o=this._previousButton,r=this._nextButton;1!==t||null==o||i.isLoopContent()?null!=o&&this._setButtonEnabled(o,!0):this._setButtonEnabled(o,!1),t!==n.length||null==r||i.isLoopContent()?null!=r&&this._setButtonEnabled(r,!0):this._setButtonEnabled(r,!1)},_setButtonEnabled:function(e,t){e.setBright(t),e.setSoundEnabled(t)}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._,e.ccui);t.PageControllerEx=t.PageController.extend({className:"KHPageControllerEx",_initNumberDisplay:function(e){var t=e.split(".");return 2!=t.length?void console.debug("[ERROR] Invalid controls name. You should include '.' between current number and max number."):null===n.helper.seekWidgetByName(this._widget,t[0])||null===n.helper.seekWidgetByName(this._widget,t[1])?void console.debug("[ERROR] Could not find label widget."):(this._numberDisplay=n.helper.seekWidgetByName(this._widget,t[0]),this._numberDisplay.string=this._pageView.getTotalPageNumber(),this._maxNumberDisplay=n.helper.seekWidgetByName(this._widget,t[1]),this._maxNumberDisplay.string=this._pageView.getTotalPageNumber(),"0"===this._numberDisplay.string&&(this._numberDisplay.string=""),"0"===this._maxNumberDisplay.string&&(this._maxNumberDisplay.string=""),void this._pageView.addOnPageChangeCallback(function(e,t,n){this._numberDisplay.string=t,this._maxNumberDisplay.string=n.length}.bind(this)))}})}((this||0).self||global),function(a){var s=a.kh,o=a.cc,c=a._,u=a.ccui;s.Popup=u.Widget.extend({className:"KHPopup",backgroundColor:o.color(0,0,0),backgroundOpacity:178.5,_loggingInfo:{},ctor:function(e){this._super(),this._setup(e),this.dissmiss=this.dismiss},_setup:function(e){this.widget=e},open:function(){var e=Q.defer();this._openDfd=e;var t=o.director.getRunningScene();if(t.popupLayer&&(t=t.popupLayer),!s.env.isSp){var n=this.widget.width,i=this.widget.height;c.each(this.widget.getChildren(),function(e){null!=e&&(.7==e.scaleX&&.7==e.scaleY||(e.scale=.7,e.x=n/2+.7*(e.x-n/2),e.y=i/2+.7*(e.y-i/2)))})}return t.addChild(this),this.setVisible(!0),this._isOpened=!0,e.promise},openWithActions:function(e,t){if(!c.isUndefined(t)){var r=Q.defer();c.each(t,function(e,n){if(this[n]){var i,o=!0;i="function"==typeof e?(o=!1,e):"boolean"==typeof e?function(){e?r.resolve(n):r.reject(n)}:c.isUndefined(e.page)?function(){s.createInstance("router").navigate(""+e)}:function(){s.createInstance("router").navigate(e.page,e.params)},this[n].addTouchEventListener(function(e,t){if(t===u.Widget.TOUCH_ENDED){o?this.dismiss():(this._dismissOrg=this._dismissOrg||this.dismiss,this.dismiss=function(){this._dismissOrg(),r.resolve(n)});try{i.apply(this,[n])}catch(e){console.error(e)}o?r.resolve(n):this.dismiss=this._dismissOrg}},this)}else a.console.warn("btn not found: "+n)}.bind(this))}var n="function"==typeof e?e:function(){};return this.open().then(n),r.promise},dismiss:function(){var e=Q.defer();return this._dismissDfd=e,this.setVisible(!1),this.removeFromParent(),this._isOpened=!1,c.isFunction(this._clearContents)&&this._clearContents(),e.promise},_shield:function(){return!0},setCloseButton:function(e){this.__closeBtn=e},onEnter:function(){this._super(),this.setVisible(!1);var e=o.director.getRunningScene().getContentSize(),t=this.widget.getContentSize();this.setContentSize(e),this._container=this._createContainer(e,t),this._shade=this._createShade(e,e),this._closeBtn=this.__closeBtn||this._createCloseBtn(e,t),this._childRelations=this._addChildWithRelation([[this,this._shade],[this,this._container],[this._container,this._container.layout],[this._container.layout,this.widget],this.__closeBtn?[]:[this._container.layout,this._closeBtn]]),this._nodesEnabledTouchEvent=this._enableTouchEvent([this._closeBtn],"dismiss"),this._nodesEnabledTouchEvent=this._enableTouchEvent([this._shade],"_shield");var n=this.seekWidgets(function(e){return e.isVisible&&e._className instanceof u.Button});c.each(n,function(e){var t=e.parent;e.removeFromParent(),t.addChild(e)});var i=this.seekWidgets(function(e){return e.isVisible&&e instanceof u.Layout});o.director.getRunningScene().scheduleOnce(function(){c.each(i,function(e){e.setBackGroundImageCapInsets(e.getBackGroundImageCapInsets())})}.bind(this)),this._openDfd.resolve()},_enableTouchEvent:function(e,n,i){var t=function(e,t){if(t===u.Widget.TOUCH_ENDED)return this[n].apply(this,i)};e=c(e).compact().map(function(e){return e.addTouchEventListener(t,this),e.setTouchEnabled(!0),e},this).value();var o,r=(o=e,function(){c.each(o,function(e){e.setTouchEnabled(!1)})});return e=t=null,{disableAll:r}},_createShade:function(e,t){var n=new u.Layout;return n.setName("shade"),n.x=e.width-t.width/2,n.y=e.height-t.height/2,n.setContentSize(t),n.setPropagateTouchEvents(!1),n.setBackGroundColorType(u.Layout.BG_COLOR_SOLID),n.setBackGroundColor(this.backgroundColor),n.setBackGroundColorOpacity(this.backgroundOpacity),n},_createContainer:function(e,t){var n=new u.Widget,i=new u.Layout;return i.x=e.width-t.width/2,i.y=e.height-t.height/2,i.setContentSize(t),i.setBackGroundColorType(u.Layout.BG_COLOR_SOLID),i.setBackGroundColor(o.color(255,255,255)),i.setBackGroundColorOpacity(1),i.setTouchEnabled(!0),n.layout=i,n},_createCloseBtn:function(e,t){var n=new u.Button;n.setTitleText("[x]"),n.setName("closeBtn");var i=n.getContentSize();return n.x=t.width-i.width/2,n.y=t.height-i.height/2,n},_addChildWithRelation:function(e){var t=c(e).filter(function(e){return e[0]&&e[1]}).map(function(e){var t=e[0],n=e[1],i=e[2];return t.addChild(n,i),n},this).value();return{pruneAll:function(){c.each(t,function(e){e.removeFromParent()}),t=null}}},onExit:function(){this._super(),null!==this._childRelations&&c.isFunction(this._childRelations.pruneAll)?(this._childRelations.pruneAll(),this._childRelations=null):null===this._childRelations&&console.warn("ポップアップonExitの多重呼び出しです",this.getInfoForLogging()),null!==this._nodesEnabledTouchEvent&&c.isFunction(this._nodesEnabledTouchEvent.disableAll)&&(this._nodesEnabledTouchEvent.disableAll(),this._nodesEnabledTouchEvent=null),null!==this._container&&(this._container.layout=null,this._container=null),this._shade=null,this._closeBtn=null,this._dismissDfd&&this._dismissDfd.resolve(),this._scene=null,this.scene=null},getInfoForLogging:function(){return this._loggingInfo},setRotation:function(e){this._getBaseNode().setRotation(e)},_getBaseNode:function(){return this.widget.seekWidgetByName("popup_base")}})}((this||0).self||global),function(_){var d=_.kh,e=_.cc,p=_.ccs,g=_.ccui,f=_._;d.PopupFactory=e.Class.extend({resourceName:"",POPUP_PROPERTIES:{},configure:function(){_.console.warn("override me!!")},create:function(e,t){e=f.merge(e||{},this.POPUP_PROPERTIES);var n=_.res,i=p.load($dynamicRes(n[this.resourceName])),o=d.createInstance("Popup",[i.node]);o.resource=i;var r,a,s,c,u,l=new g.Widget;l.setVisible(!1),o.setCloseButton(l),r=this,s=(a=o).open,c=[this.onPopupOpened,e.onPopupOpened],u=f(c).filter(function(e){return!!e}).value(),a.open=function(t){return f.isFunction(a._hideContentNode)&&a._hideContentNode(),s.call(a).then(function(){return Q.all(f.map(u,function(e){try{e.apply(r,[a,t])}catch(e){_.console.error(e)}}))}).then(function(){d.createInstance("logger").reportPopupTransition("OPEN",a)}).then(function(){return f.isFunction(a._showContentNode)&&a._showContentNode(),a}).fail(function(e){console.warn(e)})},this.configure(o,e),this._prepareButtons(o,e,t);var h=this._getButtonType(e.buttonLabels);return this._showButtons(o,h),this._prepareInfoForLogging(o,e,t),o},_showButtons:function(e,t){var n=e.resource.node.seekWidgetByName("btn_node");if(n){var i=n.actionManager.getActionByTag(n.tag,n),o=i.animationInfo[t];return o?void i.gotoFrameAndPause(o.startIndex):void _.console.error("no such buttns: ",t)}},_getButtonType:function(e){if(this._buttonType)return this._buttonType;var t=f.invert(f.map(e,function(e,t){return t.substr(0,t.indexOf("Btn"))}));return t.black&&t.red?"black_red":t.black&&t.blue?"black_blue":t.red&&t.blue?"red_blue":t.black&&t.yellow?"black_yellow":t.black?"black":t.blue?"blue":(_.console.warn("[!! Popup Button Type !!]: not found. use default: 'black'"),"black")},_prepareButtons:function(i,e,o){f.each(e.buttonLabels,function(e,t){i[t]&&i[t].setTitleText(e||[t])}),i.blackBtn&&i.blackBtn.setSound(d.SoundList.BUTTON_TOUCHED_CANCEL),i.blueBtn&&i.blueBtn.setSound(d.SoundList.BUTTON_TOUCHED_CONFIRMED),i.yellowBtn&&i.yellowBtn.setSound(d.SoundList.BUTTON_TOUCHED_CONFIRMED),f.each(e.buttonSounds,function(e,t){i[t]&&i[t].setSound(e||d.SoundList.BUTTON_TOUCHED_DEFAULT)}),f.each(e.buttons,function(n,e){return i[e]?void i[e].addTouchEventListener(function(e,t){t===g.Widget.TOUCH_ENDED&&n.apply(this,o)},i):void _.console.warn("btn not found: "+e)})},_prepareInfoForLogging:function(e,t,n){e._loggingInfo={resourceName:this.resourceName},f.isFunction(e.getInfoForLogging)||(e.getInfoForLogging=function(){return e._loggingInfo})}})}((this||0).self||global),function(i){var e=i._,t=i.kh,o=i.ccui,r=i.cc;t.PopupFactoryPopupCommon=t.PopupFactory.extend({resourceName:"core-popup-popup_common",_configurePopupNodes:function(n){var i=n.resource;e.each({titleNode:"title_label",positionPanel:"position_panel",contentNode:"top_pin_node",backgroundNode:"popup_base",blackBtn:"black_btn",blueBtn:"blue_btn",redBtn:"red_btn",yellowBtn:"yellow_btn"},function(e,t){n[t]=o.helper.seekWidgetByName(i.node,e)})},_addMethodsToPopup:function(e){e.setTitle=function(e){this.titleNode.setText(e)},e.getInnerHeight=function(){return this._container?this._container.layout.children[0].children[0].height:void i.console.error("popup has not opened yet")},e.setInnerHeight=function(e){if(this._container){var t=this._container.layout.children[0].children[0],n=e-t.height;t.height=e,this.contentNode.y+=n,this.titleNode.y+=n}else i.console.error("popup has not opened yet")},e._showContentNode=function(){this.contentNode.setVisible(!0)},e._hideContentNode=function(){this.contentNode.setVisible(!1)}},_setupContentNode:function(e,t){var n=ccs.load($dynamicRes(i.res[t.resourceName||"__not_defined__"]));n.action&&n.node.runAction(n.action),e.contentNode.addChild(n.node),n.node.children[0].getLayoutType?(n.node.setPosition(r.p(-320,-n.node.height)),n.node.children[0].setLayoutType(o.Layout.LINEAR_VERTICAL)):n.node.setPosition(r.p(-320,-n.node.height)),e.backgroundNode.height=n.node.height+151,e.positionPanel.height=n.node.height+151,e.titleNode.y=n.node.height+151-30,e.contentNode.y=n.node.height+151-49},configure:function(e,t){this._configurePopupNodes(e),this._addMethodsToPopup(e),e.setTitle(t.title),this._setupContentNode(e,t)}})}((this||0).self||global),function(r){var e=r._,t=r.kh,o=r.ccui;t.PopupFactoryIllustUp=t.PopupFactory.extend({resourceName:"core-popup-com_illust_up",_configurePopupNodes:function(n){var i=n.resource;e.each({titleNode:"title_label",scrollView:"scroll_view",blackBtn:"black_btn",redBtn:"red_btn"},function(e,t){n[t]=o.helper.seekWidgetByName(i.node,e)})},_showButtons:function(e,t){var n=e.resource.node.seekWidgetByName("btn_node"),i=n.actionManager.getActionByTag(n.tag,n),o=i.animationInfo[t];return o?void i.gotoFrameAndPause(o.startIndex):void r.console.error("no such buttns: ",t)},_addMethodsToPopup:function(e){e.setTitle=function(e){this.titleNode.setString(e)},e.setImage=function(e){var t=new Image;t.crossOrigin="use-credentials";this.imageNode;var n=this.scrollView;t.onload=function(){var e=cc.size(this.width,n.height);n.setInnerContainerSize(e);var t=new o.ImageView(this.src);n.addChild(t),t.setPosition(e.width/2,e.height/2),n.jumpToPercentHorizontal(50),n=null},t.src=e}},configure:function(e,t){this._configurePopupNodes(e),this._showButtons(e,"black"),this._addMethodsToPopup(e),t.title&&e.setTitle(t.title),t.image&&e.setImage(t.image)}})}((this||0).self||global),function(e){var t=e._,r=e.kh,a=e.ccui;r.PopupFactoryTextOnly=r.PopupFactory.extend({resourceName:"core-popup-text_button_only",_configurePopupNodes:function(n){var i=n.resource;t.each({titleNode:"title_label",positionPanel:"position_panel",contentNode:"popup_labelimg",backgroundNode:"popup_base",blackBtn:"black_btn",blueBtn:"blue_btn",redBtn:"red_btn"},function(e,t){n[t]=a.helper.seekWidgetByName(i.node,e)})},_addMethodsToPopup:function(o){o.setTitle=function(e){o.titleNode.setText(e)},o.setContent=function(e){e.match(/(?:<br>|<br \/>)/)?o._largeFlag||(o.backgroundNode.height=o.backgroundNode.height+60,o.positionPanel.y=o.positionPanel.y+60,o.contentNode.y=o.contentNode.y+30,o._largeFlag=!0):o._largeFlag&&(o.backgroundNode.height=o.backgroundNode.height-60,o.positionPanel.y=o.positionPanel.y-60,o.contentNode.y=o.contentNode.y-30,o._largeFlag=!1);var n=o.contentNode;if(n instanceof a.ImageView){var t=cc.size(600,240),i='<table style="width: 600px;height: 240px;"><tr><td><div class="text_common">'+e+"</div></td></tr></table>";r.convertHTMLToTexture(i,t,r.GameConfig.POPUP_CSS).then(function(e){var t=n.getVirtualRenderer();t.initWithTexture(e),t.setAnchorPoint(0,0),t.setVisible(!0)})}},o._clearContents=function(){var e=o.contentNode;if(e instanceof a.ImageView&&e.getVirtualRenderer()){var t=e.getVirtualRenderer().getTexture();if(t)return t.releaseTexture?void t.releaseTexture():void(t.release&&t.release())}}},_adjustTitle:function(e){e.titleNode&&(e.titleNode.setTextVerticalAlignment(0),e.titleNode.setTextVerticalAlignment(1),e.titleNode.setTextVerticalAlignment(2),e.titleNode.setNodeDirty(),setTimeout(function(){e.titleNode._labelRenderer.setVerticalAlignment(0),e.titleNode._labelRenderer.setVerticalAlignment(2),e.titleNode._labelRenderer.setVerticalAlignment(1),e.titleNode.setNodeDirty()},1e3/cc.game.config.frameRate*4))},configure:function(e,t){this._configurePopupNodes(e),this._showButtons(e,this._buttonType||"black"),this._addMethodsToPopup(e),t.title&&e.setTitle(t.title);var n,i,o=function(){this._adjustTitle(e)}.bind(this);e.open=(n=e.open,i=t.content,function(){return i&&this.setContent(i),n.apply(this,arguments).then(o)})}})}((this||0).self||global),function(e){var a=(e._,e.kh);e.ccui,a.PopupFactoryTextOnlyVariableSize=a.PopupFactoryTextOnly.extend({_addMethodsToPopup:function(o){var r;this._super(o),o.setContent=(r=o.setContent,function(e,t){if(void 0===t||t.height<=180)return r.apply(this,arguments);var n=t.height-180;o.backgroundNode.height=264+n,o.contentNode.height=t.height,o.contentNode.y=t.height-75,o.titleNode.y=244+n;var i='<table style="width: '+t.width+"px;height: "+t.height+'px;"><tr><td><div class="text_common">'+e+"</div></td></tr></table>";a.convertHTMLToTexture(i,t,a.GameConfig.POPUP_CSS).then(function(e){var t=o.contentNode.getVirtualRenderer();t.initWithTexture(e),t.setAnchorPoint(0,0),t.setVisible(!0),o.contentNode.setAppearance("show")})}),o._clearContents=function(){o.contentNode.setAppearance("hide")}}})}((this||0).self||global),function(e){var t=e.kh;t.PopupFactoryBlackRed=t.PopupFactoryTextOnly.extend({_buttonType:"black_red"})}((this||0).self||global),function(e){var t=e.kh;t.PopupFactoryBlackBlue=t.PopupFactoryTextOnly.extend({_buttonType:"black_blue"})}((this||0).self||global),function(e){var t=e.kh;t.PopupFactoryBlack=t.PopupFactoryTextOnly.extend({_buttonType:"black"})}((this||0).self||global),function(e){var t=e.kh;t.PopupFactoryBlue=t.PopupFactoryTextOnly.extend({_buttonType:"blue"})}((this||0).self||global),function(i){var o=i._,r=i.kh;r.PopupFactoryComBackCheck=r.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-com_back_check",title:"リタイア確認",buttonLabels:{blackBtn:"キャンセル",redBtn:"リタイア"},buttons:{blackBtn:function(){this.dismiss().then(this.onCancel)},redBtn:function(){if("prizehunt"===this.questType&&"battle"===r.createInstance("router").getCurrentComponent())return r.createInstance("aQuestInfo").dispose(),r.createInstance("battleWorld").checkContinuePopupConditions()?void r.createInstance("questStateManager").gotoNextQuestState():void r.createInstance("router").navigate("prizehunt/prizehunt_quest",{},{a_quest_id:this.aQuestId,giveUp:!0});r.createInstance("apiAQuests").giveupQuest(this.aQuestId,this.questType).then(function(t){r.createInstance("aQuestInfo").dispose();var n=!o.isEmpty(t.body.scoreattack_result)&&0!==r.createInstance("router").getCurrentFragment().indexOf("battle/");this.dismiss().then(function(){if(!n)return this.needToOpenComBackResult?void r.createInstance("popupFactoryComBackResult").create({}).open({type:this.questType,sceneUpdateRequired:!0}):void r.core.router.navigateFromQuest(this.questType,this.preventNavigateBack,this.aQuestId,!1,t.body.event_id,t.body.epic_subject_id,this.questId,this.questCategory,this.questSubCategory);var e={data:t.body.scoreattack_result,shouldGoQuestTop:!1,eventId:null};r.ImplantedPopup.create(cc.director.getRunningScene(),"scoreattack_result").open(e).fin(function(){var e=(cc.director.getRunningScene()||{})._delegate||{};(e.clearOwnQuest||function(){}).apply(e)})}.bind(this)).fail(function(e){i.console.error(e)})}.bind(this)).fail(function(e){i.console.error(e)})}},buttonSounds:{redBtn:r.SoundList.BUTTON_TOUCHED_CONFIRMED}},typeDictionary:{coin:"gem",normal:"bronze",silver:"silver",gold:"gold",rainbow:"rainbow"},POPUP_METHODS:{},onPopupOpened:function(t,n){var e=n.type,i=n.questType||e;"raid"===e&&t.setStrings({confirm_label:t.seekWidgetByName("confirm_label").getString().replace("クエスト","レイドバトル")}),"prizehunt"===i&&t.setStrings({confirm_label:"迷宮踏破クエストをリタイアします。獲得した宝箱は\n入手できますが周回数・進行度はリセットされます。"}),o.each(o.keys(this.typeDictionary),function(e){t.seekWidgetByName("{{type}}_no_label".replace(/{{type}}/,this.typeDictionary[e])).setString((n[e]||0).toString())}.bind(this)),t.needToOpenComBackResult=n.needToOpenComBackResult||!1,t.aQuestId=n.aQuestId,t.questId=n.questId,t.questType=n.questType,t.type=e,t.onCancel=n.onCancel||function(){},t.preventNavigateBack=n.preventNavigateBack||!1,t.questCategory=n.questCategory,t.questSubCategory=n.questSubCategory},_addMethodsToPopup:function(e){r.PopupFactoryPopupCommon.prototype._addMethodsToPopup.call(this,e),o.assign(e,this.POPUP_METHODS)}})}((this||0).self||global),function(e){var o=e.kh;o.PopupFactoryNeedStone=o.PopupFactoryBlack.extend({POPUP_PROPERTIES:{title:o.w("stone")+"が足りません",buttonLabels:{blackBtn:"閉じる"},buttons:{blackBtn:function(e){this.dismiss().then(function(){this.onClose()}.bind(this))}}},onPopupOpened:function(e,t){e.onClose=t.onClose;var n=t.name||o.w("elixir"),i=o.w("stone")+"が足りないため、"+n+"を購入できません<br />所持"+o.w("stone")+"："+t.stone+"個</span><br />";e.setContent(i)}})}((this||0).self||global),function(e){var c=e._,u=e.kh;e.cc,e.ccui,u.PopupFactoryBuyCheck=u.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-sh_buy_check",title:"購入確認",buttonLabels:{blueBtn:"購入する",blackBtn:"キャンセル"},buttonSounds:{blueBtn:u.SoundList.BUTTON_TOUCHED_CONFIRMED,blackBtn:u.SoundList.BUTTON_TOUCHED_CANCEL},buttons:{blueBtn:function(e){this.factory.pulldown.releaseMenu(),this.factory._buy()},blackBtn:function(e){this.factory.pulldown.releaseMenu();var t=this.factory.onClose;this.factory=null,this.dismiss().then(t)}}},POPUP_METHODS:{},onPopupOpened:function(e,t){var n=(this.popup=e).seekWidgetByName("item_img"),i=e.seekWidgetByName("item_name_label"),o=e.seekWidgetByName("item_description_label"),r=e.seekWidgetByName("price_label");this.options=t.options,(e.factory=this).onClose=t.onClose||function(){};var a=u.Img("corecard","item",c.padZero(t.id,4)).jpg;n.loadTexture(a),i.setString(t.name),o.setString(t.description),r.setString(t.price+"ポイント"),this.selectedValue=1,this.selectedRecord=t,this.onBuy=t.onBuy;var s=this._getPulldownCondition(t);this.pulldown=new u.Pulldown({button:e.seekWidgetByName("btn_pulldown"),label:e.seekWidgetByName("amount_label"),menuBase:e.seekWidgetByName("gud_sh_sort"),choice:ccs.load(res["core-sort-sort_list_ui"]).node},s),this.pulldown.onChange(function(e){this.selectedValue=e.value,r.setString(t.price*this.selectedValue)}.bind(this))},_buy:function(){var e={};e.num=this.selectedValue,e.name=this.selectedRecord.name,e.description=this.selectedRecord.description,e.price=this.selectedRecord.price,e.itemId=this.selectedRecord.shop_item_id,e.contentId=this.selectedRecord.id,e.contentType=this.selectedRecord.kind,u.createInstance("paymentRequest").requestShopItem(e,this.options).then(function(e){return this.popup.dismiss().thenResolve(e)}.bind(this)).then(function(e){this._showResultPopup(e)}.bind(this))},_showResultPopup:function(e){var t={type:"point",buyResult:e,onClose:this.onBuy};u.createInstance("popupFactoryBuyResult").create({}).open(t)},_getPulldownCondition:function(e){var t=[];return c.each(c.range(e.buy_max_num),function(e){e++,t.push({value:e,text:e})}),t[0].selected=!0,t}})}((this||0).self||global),function(e){var i=e._,o=e.kh,r=e.cc;e.ccui,o.PopupFactoryBuyResult=o.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-sh_buy_result",title:"購入結果",buttonLabels:{blueBtn:"OK"},buttonSounds:{blueBtn:o.SoundList.BUTTON_TOUCHED_CONFIRMED},buttons:{blueBtn:function(e){this.params.onClose&&this.params.onClose(this.params.buyResult),this.dismiss()}}},POPUP_METHODS:{},onPopupOpened:function(e,t){var n=new r.Sprite(o.Img("corecard","shop-"+("point"===t.type?"point":"stone"),i.padZero(t.buyResult.shop_item_id,4)).jpg);n.setAnchorPoint(r.p(0,0)),e.seekWidgetByName("corecard_ui").addChild(n),e.seekWidgetByName("buy_result_label").string=t.buyResult.num+"個購入しました。",e.params=t}})}((this||0).self||global),function(e){var h=e._,_=e.kh,d=e.cc;e.ccui,_.PopupFactoryStoneCheck=_.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-sh_stone_check",title:"購入確認",buttonLabels:{blueBtn:"交換する",blackBtn:"キャンセル"},buttonSounds:{blueBtn:_.SoundList.BUTTON_TOUCHED_CONFIRMED,blackBtn:_.SoundList.BUTTON_TOUCHED_CANCEL},buttons:{blueBtn:function(e){this.factory.pulldown.releaseMenu(),this.factory._buy.call(this.factory),this.dismiss()},blackBtn:function(e){this.factory.pulldown.releaseMenu();var t=this.factory.onClose;this.factory=null,this.dismiss().then(t)}}},POPUP_METHODS:{},onPopupOpened:function(e,i){var t=e.seekWidgetByName("item_img"),n=e.seekWidgetByName("item_name_label"),o=e.seekWidgetByName("item_description_label"),r=e.seekWidgetByName("price_labelimg");(e.factory=this).onClose=i.onClose||function(){},this.onBuy=i.onBuy||function(){};var a=_.Img("corecard","item",h.padZero(i.id,4)).jpg;t.loadTexture(a),n.setString(i.name),o.setString(i.description),this.selectedValue=1,this.selectedRecord=i;var s=this._getPulldownCondition(i),c=e.seekWidgetByName("sort_ui");if(s&&s.length<10){var u=45*(10-s.length);c.setPositionY(24-u)}this.pulldown=new _.Pulldown({button:e.seekWidgetByName("btn_pulldown"),label:e.seekWidgetByName("amount_label"),menuBase:e.seekWidgetByName("gud_sh_sort"),choice:ccs.load(res["core-sort-sort_list_ui"]).node},s),this.pulldown.onChange(function(e){this.selectedRecord=i,this.selectedValue=e.value,l()}.bind(this));var l=function(){var e=this.selectedValue*i.stones,t=i.currency.stone-e,n='<table style="width: 400px;height: 60px;"><tr><td><div class="text_common">'+("<span class='orange'>必要数&nbsp;：&nbsp;</span><span class='white'>"+i.stones+_.w("stone")+"</span><br /><span class='orange'>所持"+_.w("stone")+"&nbsp;：&nbsp;</span><span class='white'>"+i.currency.stone+"&rarr;</span><span class='red'>"+t+"</span>")+"</div></td></tr></table>";_.convertHTMLToTexture(n,d.size(400,60),_.GameConfig.POPUP_CSS).then(function(e){var t=r.getVirtualRenderer();t.initWithTexture(e),t.setAnchorPoint(0,0),t.setVisible(!0)}.bind(this))}.bind(this);l()},_buy:function(){_.createInstance("apiShop").buy(this.selectedRecord.shop_item_id,this.selectedValue,"stone").then(function(e){if(!e.body.result)throw new Error(_.w("stone")+"での購入に失敗しました");var t=d.director.getRunningScene();null!=t.headerDelegate&&t.headerDelegate.updateCurrency(),this._showResultPopup({num:this.selectedValue,shop_item_id:this.selectedRecord.shop_item_id})}.bind(this)).fail(function(e){console.error(e)})},_getPulldownCondition:function(e){var t=Math.floor(e.currency.stone/e.stones);t=e.buy_max_num<t?e.buy_max_num:t;var n=h.map(h.range(t),function(e){return{value:++e,text:e}});return n[0].selected=!0,n},_showResultPopup:function(e){var t={type:"stone",buyResult:e,onClose:this.onBuy};_.createInstance("popupFactoryBuyResult").create({}).open(t)}})}((this||0).self||global),function(e){var i=(e._,e.kh);e.ccui,i.PopupFactoryMenu=i.PopupFactory.extend({resourceName:"core-menu-menu_ui",_banners:null,POPUP_PROPERTIES:{},_addMethodsToPopup:function(e){function t(){i.createInstance("notificationCenter").dispatchEvent("menu_close"),e.dismiss(),i.EditBox.setVisibleAll(!0)}e._setEventHandlers=function(){i.setTouchEventHandlers(this,{"TOUCH_ENDED btn_close":t,"TOUCH_ENDED btn_profile":function(){i.createInstance("router").navigate("serial")},"TOUCH_ENDED btn_harlem":function(){i.createInstance("router").navigate("epi")},"TOUCH_ENDED btn_setting":function(){i.createInstance("router").navigate("set")}})}},onPopupOpened:function(e,t){i.EditBox.setVisibleAll(!1),i.createInstance("notificationCenter").dispatchEvent("menu_open"),e._setEventHandlers.call(e);var n=e.seekWidgetByName("filter_black");null!=n&&n.setVisible(!1)},configure:function(e,t){this._addMethodsToPopup(e)}})}((this||0).self||global),function(e){var i=(e._,e.kh),o=e.ccui;i.PopupFactoryMenuBeginnerMission=i.PopupFactoryMenu.extend({resourceName:"core-menu-menu_ui_beginner_mission",_addMethodsToPopup:function(n){this._super.apply(this,arguments);var e=n._setEventHandlers;n._setEventHandlers=function(){e.apply(this,arguments),n.seekWidgetByName("beginner_mission_banner").addTouchEventListener(function(e,t){t===o.Widget.TOUCH_ENDED&&(i.createInstance("router").navigate("beginner_mission/beginner_mission_main"),n.dismiss())})}},onPopupOpened:function(e,t){var n=e.bfsWidgetByName("new_icon");n&&n.setVisible(!0===this._hasBeginnerGettableReward),this._super.apply(this,arguments)},configure:function(e,t){this._super.apply(this,arguments),this._hasBeginnerGettableReward=t.beginnerGettableReward}})}((this||0).self||global),function(e){var c=e._,u=e.kh,l=e.ccui;u.PopupFactoryEvBanner=u.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-my_ev_banner",title:"Event Information",buttonLabels:{blackBtn:"閉じる"},buttons:{blackBtn:function(e){this.dismiss()}}},_banners:null,POPUP_METHODS:{loadEventBanner:function(){return this._banners?void this._setEventBanner():void u.createInstance("apiABanners").getMypageBanners().then(function(e){var t=e.body||{};this._banners=t.data||[],this._setEventBanner()}.bind(this))},_setEventBanner:function(){var e=this.seekWidgetByName("my_banner_page"),t=this.seekWidgetByName("my_banner_page_ui");null!==t&&t.removeFromParent();var a=(Math.floor(this._banners.length/5),null),s=[];c.each(this._banners,function(o,e){var t=e%5;0==t&&(a=ccs.load(res["core-popup-my_banner_page_ui"]).node,s.push(a));var n=a.seekWidgetByName("my_banner_list_ui_"+t);n.setVisible(!0);var i=n.seekWidgetByName("eventimg_banner"),r=u.Img("eventimg","banner",c.padZero(o.banner_id,4)).png;i.loadTextures(r,r,r),i.addTouchEventListener(function(e,t){if(t===l.Widget.TOUCH_ENDED){if(o.external_page_url)return console.log("go to "+o.external_page_url),void window.open(o.external_page_url,"EVENT_BANNER");var n=o.navigate_page;if(/(q_accessories_top|q_material_top|q_element_type_top)/.test(n))return void u.createInstance("QuestListRouter").route(n);var i={};i[c.last(n.split("/"))]={id:o.banner_id,navigate_page:o.navigate_page,event_id:o.event_id,item_id:o.item_id,shop_id:o.shop_id},u.createInstance("router").navigate(n,i,{event_id:o.event_id,item_id:o.item_id,shop_id:o.shop_id})}}.bind(this)),i.setTouchEnabled(!0)},this);var n=new u.PageView;n.initialize(s,function(){},this),e.addChild(n);var i=[];i[u.PAGE_CONTROLLER_CONTROLS.NEXT_BUTTON]="btn_log_down",i[u.PAGE_CONTROLLER_CONTROLS.PREVIOUS_BUTTON]="btn_log_up",(new u.PageController).init(this,i,n),n.gotoFirstPage()}},onPopupOpened:function(e,t){e.seekWidgetByName("btn_node").setPositionY(-8),e.loadEventBanner()},_addMethodsToPopup:function(e){u.PopupFactoryTextOnly.prototype._addMethodsToPopup.call(this,e),c.assign(e,this.POPUP_METHODS)}})}((this||0).self||global),function(e){var s=e._,c=e.kh,o=e.ccui;c.PopupFactoryNewsA=c.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-my_001_news_a",title:"新着情報",buttonLabels:{blackBtn:"閉じる"},buttons:{blackBtn:function(e){this.dismiss()}}},_banners:null,POPUP_METHODS:{setMail:function(){this.page=this.page||0;s.each(s.range(3),function(e){var n=this._mail[3*this.page+e],t=this.seekWidgetByName("btn_new_list_"+e);return void 0===n?void t.setVisible(!1):(t.seekWidgetByName("news_label").setString(n.title),t.seekWidgetByName("btn_news").addTouchEventListener(function(e,t){t===o.Widget.TOUCH_ENDED&&this._routerNavigate(n)}.bind(this)),void t.setVisible(!0))}.bind(this))},_routerNavigate:function(i){var o={free_gacha:"gacha/ga_004",present:"present",friend_offer:"friend/fr_001",unverified_battle:"quest/q_007",harem_episode:"epi",start_up_gacha:"gacha/ga_001",union_scout:"guild/gud_001",union_chat:"guild/gud_008",greet:"profile/prf_005_myself",gacha_event:"gacha/ga_100",quest_event:"conquest/con_001",quest_story_event:"conquest/con_001",union_dismiss:"reload",union_fire:"guild/gud_000",union_cancel:"guild/gud_000",union_news:"guild/gud_009",exchange_ticket:"exchangeitem/exchit_001",join_union_request:"guild/gud_007_a"},r={gacha_event:"ga_100",quest_event:"con_001",quest_story_event:"con_001",start_up_gacha:"ga_100",union_scout:"temporaryRouterParams",exchange_ticket:"exchit_001"},a={friend_offer:{tab:"tab_2"},join_union_request:{gud_007:{selectedTab:"tab_1"}}},e=-1!==s.indexOf(["union_dismiss","union_fire","union_cancel"],i.type),t=Q.defer();t.promise.then(function(){if("reload"===o[i.type])c.createInstance("sceneManager").reloadScene();else if("free_gacha"===i.type)c.createInstance("router").navigate(o[i.type],{ga_100:{}});else{var e=void 0,t=void 0;if(a[i.type])e=a[i.type];else if(i.extended_info){var n=r[i.type];"temporaryRouterParams"===n?t=i.extended_info:(e={})[n]=i.extended_info}c.createInstance("router").navigate(o[i.type],e,t)}}),e?c.createInstance("apiAMail").read(i.a_mail_id).then(function(){t.resolve()}):t.resolve()},preparePagerBtn:function(){function n(e,t){i.seekWidgetByName(e).setEnabled(t),i.seekWidgetByName(e).setBright(t)}var i=this;this.page=0;var e=[{nodeName:"btn_prev_page",callback:function(e,t){t===o.Widget.TOUCH_ENDED&&(i.page--,i.page<=0?n("btn_prev_page",!1):n("btn_prev_page",!0),n("btn_next_page",!0),i.setMail())},enabled:!1},{nodeName:"btn_next_page",callback:function(e,t){t===o.Widget.TOUCH_ENDED&&(i.page++,i._mail.length<=3*(i.page+1)?(n("btn_prev_page",!0),n("btn_next_page",!1)):(n("btn_prev_page",!0),n("btn_next_page",!0)),i.setMail())},enabled:3<i._mail.length}];s.each(e,function(e,t){this.seekWidgetByName(e.nodeName).addTouchEventListener(e.callback),n(e.nodeName,e.enabled)}.bind(this))}},onPopupOpened:function(e,t){e._mail=t.mail,e.setMail(),e.preparePagerBtn()},_addMethodsToPopup:function(e){c.PopupFactoryTextOnly.prototype._addMethodsToPopup.call(this,e),s.assign(e,this.POPUP_METHODS)}})}((this||0).self||global),function(e){var n=(e._,e.kh);n.PopupFactoryMenuList=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-menu_list",title:"所持リスト",buttonLabels:{blackBtn:"キャンセル"},buttons:{blackBtn:function(){this.dismiss()}}},POPUP_METHODS:{},onPopupOpened:function(e,t){n.setTouchEventHandlers(e,{"TOUCH_ENDED btn_item":function(){n.createInstance("router").navigate("item")},"TOUCH_ENDED btn_member":function(){n.createInstance("router").navigate("list/li_001")},"TOUCH_ENDED btn_weapon":function(){n.createInstance("router").navigate("list/li_002")},"TOUCH_ENDED btn_summon":function(){n.createInstance("router").navigate("list/li_003")}})}})}((this||0).self||global),function(e){var t=e.kh,n=e.res;$staticRes(n["core-popup-sh_summon_info"]),t.PopupFactoryShSummonInfo=t.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-sh_summon_info",title:t.w("summon")+"詳細",buttonLabels:{blackBtn:"閉じる"},buttons:{blackBtn:function(e){this.clearData(this),this.dismiss()}}},POPUP_METHODS:t.pc.status.roles.ShSummonInfoCommon,onPopupOpened:function(e,t){null!=t&&e.setData(e,t)},_addMethodsToPopup:function(e){t.PopupFactoryPopupCommon.prototype._addMethodsToPopup.call(this,e),_.assign(e,this.POPUP_METHODS)}})}((this||0).self||global),function(e){var t=e.kh,n=(e.ccui,e.res);$staticRes(n["core-popup-sh_weapon_info"]),t.PopupFactoryShWeaponInfo=t.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-sh_weapon_info",title:t.w("weapon")+"詳細",buttonLabels:{blackBtn:"閉じる"},buttons:{blackBtn:function(e){this.clearData(this),this.dismiss()}}},POPUP_METHODS:t.pc.status.roles.ShWeaponInfoCommon,onPopupOpened:function(e,t){null!=t&&e.setData(e,t)},_addMethodsToPopup:function(e){t.PopupFactoryPopupCommon.prototype._addMethodsToPopup.call(this,e),_.assign(e,this.POPUP_METHODS)}})}((this||0).self||global),function(e){var o=e.kh;e.cc,o.createNameSpaceIfNotExists("shop.shop_item_list"),o.PopupFactoryShItemInfo=o.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-sh_item_info",title:"アイテム詳細",buttonLabels:{blackBtn:"閉じる"},buttons:{blackBtn:function(e){this.clearData(),this.dismiss()}}},POPUP_METHODS:{setData:function(e,t){t=e.kind||"item";this._setCorecard(e.id||e.item_id,t),this._setItemName(e.name),this._setItemDescription(e.description||e.item_description)},clearData:function(){this._setItemName(""),this._setItemDescription(""),this._clearCorecard()},_setCorecard:function(e,t){var n=o.Img("corecard",t,_.padZero(e,4)).jpg,i=this.seekWidgetByName("item_img");i.setVisible(!0),i.loadTexture(n)},_clearCorecard:function(){this.seekWidgetByName("item_img").setVisible(!1)},_setItemName:function(e){this._setLabel("item_name_label",e)},_setItemDescription:function(e){this._setLabel("item_description_label",e)},_setLabel:function(e,t){this.seekWidgetByName(e).string=t}},_addMethodsToPopup:function(e){o.PopupFactoryPopupCommon.prototype._addMethodsToPopup.call(this,e),_.assign(e,this.POPUP_METHODS)}})}((this||0).self||global),function(e){var o=e.kh;e.cc,o.createNameSpaceIfNotExists("shop.shop_item_list"),o.PopupFactoryShPackageInfo=o.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-sh_item_info",title:"パッケージ詳細",buttonLabels:{blackBtn:"閉じる"},buttons:{blackBtn:function(e){this.clearData(),this.dismiss()}}},POPUP_METHODS:{setData:function(e,t){this._setCorecard(e.shop_item_id||e.package_id,t),this._setItemName(e.name),this._setItemDescription(e.description||e.item_description)},clearData:function(){this._setItemName(""),this._setItemDescription(""),this._clearCorecard()},_setCorecard:function(e,t){var n;t==o.shop_item.Model.prototype.CURRENCY_TYPES.PSEUDO_CURRENCY&&(t=o.shop_item.Model.prototype.CURRENCY_TYPES.STONE),n=null==t?o.Img("corecard","package",_.padZero(e,4)).jpg:o.Img("corecard","shop-"+t,_.padZero(e,4)).jpg;var i=this.seekWidgetByName("item_img");i.setVisible(!0),i.loadTexture(n)},_clearCorecard:function(){this.seekWidgetByName("item_img").setVisible(!1)},_setItemName:function(e){this._setLabel("item_name_label",e)},_setItemDescription:function(e){this._setLabel("item_description_label",e)},_setLabel:function(e,t){this.seekWidgetByName(e).string=t}},_addMethodsToPopup:function(e){o.PopupFactoryPopupCommon.prototype._addMethodsToPopup.call(this,e),_.assign(e,this.POPUP_METHODS)}})}((this||0).self||global),function(e){var i=e._,o=e.kh;e.ccui,$staticRes(res["core-popup-ra_quest_appearance"]),o.PopupFactoryRaQuestAppearance=o.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-ra_quest_appearance",title:"クエスト出現",buttonLabels:{blueBtn:"OK"}},POPUP_METHODS:{setData:function(e){this._setQuestImage(e.quest_id),this._setRemainingTimeLabel(e.time_left)},_setQuestImage:function(e){var t=this.seekWidgetByName("questimg");if(null!==t){var n=o.Img("questimg","event-quest",i.padZero(e,4),1).jpg;t.loadTexture(n)}},_setRemainingTimeLabel:function(e){this.setHtmlStrings({limit_no_labelimg:"<span class='white'>残り時間：</span><span class='yellow'>"+e+"</span>"},o.GameConfig.POPUP_CSS)},clearData:function(){}},onPopupOpened:function(e,t){null!=t&&e.setData(t)},_addMethodsToPopup:function(e){o.PopupFactoryPopupCommon.prototype._addMethodsToPopup.call(this,e),i.assign(e,this.POPUP_METHODS)}})}((this||0).self||global),function(e){var t=(e._,e.kh);t.PopupFactoryLockWaitTimeout=t.PopupFactoryTextOnly.extend({POPUP_PROPERTIES:{title:"エラー",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(){this.onBlueBtnCallback(),this.dismiss()}}},onPopupOpened:function(e,t){e.onBlueBtnCallback=t.onBlueBtnCallback||function(){}}})}((this||0).self||global),function(e){var i=e._,o=e.kh,r=e.ccui;o.PopupFactorySelectQuestType=o.PopupFactory.extend({resourceName:"core-quest_select-quest_select_ui",_showButtons:function(e,t){},_setAppearRaidImg:function(e,t){var n=e.seekWidgetByName("raid_ui");return t?(n.setAppearance("raid_effect_start"),void n.setVisible(!0)):void n.setVisible(!1)},_setBtnTouchEvent:function(e){o.setTouchEventHandlers(e,{"TOUCH_ENDED btn_main_quest":function(){o.createInstance("router").navigate("quest/q_001")},"TOUCH_ENDED btn_sp_quest":function(){o.createInstance("router").navigate("quest/q_004")},"TOUCH_ENDED btn_epic_quest":this.epicQuestBtnTouchEvent,"TOUCH_ENDED btn_raid_quest":function(){o.createInstance("router").navigate("quest/q_011")},"TOUCH_ENDED btn_raid_01":function(){o.createInstance("router").navigate("quest/q_006")},"TOUCH_ENDED btn_close":function(){e.dismiss()}},this)},epicQuestBtnTouchEvent:function(t,e){var n=cc.director.getRunningScene();(!(!n.headerDelegate._playerInfo||!i.isNumber(n.headerDelegate._playerInfo.rank))?Q.resolve(n.headerDelegate._playerInfo):o.createInstance("apiAPlayers").getMeNumeric().then(function(e){return e.body}.bind(this))).then(function(e){return 20<=e.rank?void o.createInstance("router").navigate("epic/epic_select"):(this.openRankLimit(),void t.setTouchEventListener(function(e,t){t===r.Widget.TOUCH_ENDED&&this.openRankLimit()},this))}.bind(this))},onPopupOpened:function(e,t){this._setAppearRaidImg(e,t.appearRaid),this._setBtnTouchEvent(e)},openRankLimit:function(){o.createInstance("popupFactoryBlue").create({title:"注意",content:"<p>Rank20に達していないため<br />このクエストを開始することができません。</p><p class='red'>[開始条件]<br />Rank20以上</p>",buttonLabels:{blueBtn:"閉じる"},buttons:{blueBtn:function(){this.dismiss()}}}).open()}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._),i=e.ccui;t.ScrollViewAbstract=i.ScrollView.extend({className:"KHScrollViewAbstract",DEFAULT_VALUES:{DIRECTION:i.ScrollView.DIR_VERTICAL,DISTANCE_BEFORE_OVERRIDE_CHILD:50,INERTIA_SCROLL_ENABLED:!1},ON_TOUCH_EVENT_INTERCEPTORS:n.invert({_interceptOnTouchBegan:i.Widget.TOUCH_BEGAN,_interceptOnTouchMoved:i.Widget.TOUCH_MOVED,_interceptOnTouchEnded:i.Widget.TOUCH_ENDED,_interceptOnTouchCancelled:i.Widget.TOUCH_CANCELED}),ORIENTATION:{POS:n.invert({x:i.ScrollView.DIR_HORIZONTAL,y:i.ScrollView.DIR_VERTICAL}),SIZE:n.invert({width:i.ScrollView.DIR_HORIZONTAL,height:i.ScrollView.DIR_VERTICAL})},initialize:function(){return this._distanceBeforeOverrideChild=this.DEFAULT_VALUES.DISTANCE_BEFORE_OVERRIDE_CHILD,this._overrideChild=!1,this.direction=this.DEFAULT_VALUES.DIRECTION,this.orientationPos=this.ORIENTATION.POS[this.direction],this.orientationSize=this.ORIENTATION.SIZE[this.direction],this.setInertiaScrollEnabled(this.DEFAULT_VALUES.INERTIA_SCROLL_ENABLED),this.setTouchEnabled(!0),this.getParent()&&this.setContentSize(this.getParent().getContentSize()),this},onEnter:function(){return i.ScrollView.prototype.onEnter.call(this),this._doOnEnter(),!0},_doOnEnter:function(){var e=this.getInnerContainer();e.setTouchEnabled(!0),e.setPropagateTouchEvents(!0),this.getParent()&&(this.setContentSize(this.getParent().getContentSize()),e.updateSizeAndPosition(this.getParent().getContentSize()))},setDistanceBeforeOverrideChild:function(e){this._distanceBeforeOverrideChild=e},getScrollPosition:function(){return this._convertRealPositionToScrollPosition(this.getInnerContainer().getPosition()[this.orientationPos])},setDirection:function(e){this._direction=e,this.orientationPos=this.ORIENTATION.POS[e],this.orientationSize=this.ORIENTATION.SIZE[e]},interceptTouchEvent:function(e,t,n){null!=this.ON_TOUCH_EVENT_INTERCEPTORS[e]&&this[this.ON_TOUCH_EVENT_INTERCEPTORS[e]](t,n)},onTouchBegan:function(e,t){return!!i.ScrollView.prototype.onTouchBegan.apply(this,arguments)&&(this._touchStartingPoint=e.getLocation()[this.orientationPos],!0)},onTouchMoved:function(e,t){i.ScrollView.prototype.onTouchMoved.apply(this,arguments)},onTouchEnded:function(e,t){i.ScrollView.prototype.onTouchEnded.apply(this,arguments)},onTouchCancelled:function(e,t){i.ScrollView.prototype.onTouchCancelled.apply(this,arguments)},_interceptOnTouchBegan:function(e,t){this.onTouchBegan(t,i.Widget.TOUCH_BEGAN)},_interceptOnTouchMoved:function(e,t){var n=this._touchStartingPoint-t.getLocation()[this.orientationPos];(this._overrideChild||n>this._distanceBeforeOverrideChild||n<-this._distanceBeforeOverrideChild)&&(e.setHighlighted(!1),this._overrideChild=!0,this.onTouchMoved(t,i.Widget.TOUCH_MOVED))},_interceptOnTouchEnded:function(e,t){this._overrideChild=!1,this.onTouchEnded(t,i.Widget.TOUCH_ENDED)},_interceptOnTouchCancelled:function(e,t){this._overrideChild=!1,this.onTouchCancelled(t,i.Widget.TOUCH_CANCELED)},_convertRealPositionToScrollPosition:function(e){return this.direction===i.ScrollView.DIR_VERTICAL?e+this.getInnerContainerSize().height-this.height:this.direction===i.ScrollView.DIR_HORIZONTAL?-e:null},_convertScrollPositionToRealPosition:function(e){return this.direction===i.ScrollView.DIR_VERTICAL?e-this.getInnerContainerSize().height+this.height:this.direction===i.ScrollView.DIR_HORIZONTAL?-e:null}})}((this||0).self||global),function(e){var t=e.kh,o=e._,r=e.ccui;t.ListView=t.ScrollViewAbstract.extend({className:"KHListView",DEFAULT_VALUES:{DIRECTION:r.ScrollView.DIR_VERTICAL,DISTANCE_BEFORE_OVERRIDE_CHILD:50,INERTIA_SCROLL_ENABLED:!0},initialize:function(e){return t.ScrollViewAbstract.prototype.initialize.call(this),this._recordList=e,this},onEnter:function(){return this._recordList.forEach(function(e){null!=e.getParent()&&e.removeFromParent(),this.addChild(e)},this),this._updateInnerSize(),this._updateRecordPositions(),t.ScrollViewAbstract.prototype.onEnter.call(this)},getRecordByIndex:function(e){return this._recordList[e]},addRecord:function(e,t){null==t?this._recordList.push(e):this._recordList.splice(t,0,e),this.addChild(e),this._updateInnerSize(),this._updateRecordPositions()},removeRecord:function(e){var t=this._recordList.indexOf(e);return this.removeRecordByIndex(t)},removeRecordByIndex:function(e){if(e>=this._recordList.length||-1===e)return null;var t=this._recordList.splice(e,1)[0];return this.removeChild(t),this._updateInnerSize(),this._updateRecordPositions(),t},isContentOverflow:function(){return this["inner"+o.capitalize(this.orientationSize)]>this[this.orientationSize]},_updateRecordPositions:function(){function e(e,t){return(t[i]=e)+t[n]}var n=this.orientationSize,i=this.orientationPos;this.direction===r.ScrollView.DIR_VERTICAL?o.reduceRight(this._recordList,e,this._getVerticalStartingPos()):o.reduce(this._recordList,e,0)},_getVerticalStartingPos:function(){var e=o.reduce(this._recordList,function(e,t){return e+t.height}.bind(this),0),t=this.height||this.getParent()&&this.getParent().height||0;return e<t?t-e:0},_updateInnerSize:function(){this.innerWidth=this.width,this.innerHeight=this.height,this["inner"+o.capitalize(this.orientationSize)]=o.reduce(this._recordList,function(e,t){return e+t[this.orientationSize]}.bind(this),0)}})}((this||0).self||global),function(e){var i=e.kh,a=e.cc,s=e._,o=e.ccui;i.PageView=i.ScrollViewAbstract.extend({className:"KHPageView",DEFAULT_VALUES:{DIRECTION:o.ScrollView.DIR_VERTICAL,AUTO_SCROLL_SPEED:1,DISTANCE_BEFORE_OVERRIDE_CHILD:50,LOOP_CONTENT:!1,TOUCH_EVENT_BREAK_TIMEOUT:250,SWIPE_THRESHOLD_RATIO_TO_VIEW:10},initialize:function(e,t,n){return i.ScrollViewAbstract.prototype.initialize.call(this),this._pageList=e,this._pageSlots={},this._onPageChangeCallbacks=[],this._onPageVisibleChangeCallbacks=[],this._pageTurnThresholds={},this._touchEventHistory={},this._pageDrawUpdateThresholds={},s.isFunction(t)&&this.addOnPageChangeCallback(t,n),this._currentPageIndex=0,this._autoScrollSpeed=this.DEFAULT_VALUES.AUTO_SCROLL_SPEED,this._loopContent=this.DEFAULT_VALUES.LOOP_CONTENT,this._touchEventBreakTimeout=this.DEFAULT_VALUES.TOUCH_EVENT_BREAK_TIMEOUT,this._swipeThresholdRatio=this.DEFAULT_VALUES.SWIPE_THRESHOLD_RATIO_TO_VIEW,this._scrollEnabled=!0,this.__enabled=!0,this},onEnter:function(){if(null==this._pageList)return i.ScrollViewAbstract.prototype.onEnter.call(this);var e=i.ScrollViewAbstract.prototype.onEnter.call(this);return this._scrollEnabled=1<this._pageList.length,this._setupInnerSize(),this._setupThresholds(),this._setupPageList(),this._shiftToCurrentPage(),this.updateSizeAndPosition(),this.scheduleOnce(function(){this.gotoPageByIndex(this._currentPageIndex)}.bind(this)),e},update:function(e){i.ScrollViewAbstract.prototype.update.apply(this,arguments),this._updatePageVisibilityOnScroll(),this._checkScrollEvent()},setLoopContent:function(e){this._loopContent=e},isLoopContent:function(){return this._loopContent},setEnabled:function(e){this.__enabled=e},isEnabled:function(){return this.__enabled},gotoNextPage:function(){this._scrollEnabled&&this.__enabled&&(this._refreshCurrentState(),this._currentPageIndex===this._pageList.length-1&&!this._loopContent||(this._interruptAction(),this._drawNextPage(),this._incrementPageIndex(),this._fireOnPageVisibleChangeEvent(1),this._fireOnPageChangeEvent(this._currentPageIndex),this._autoScrollToCurrentPage()))},gotoPreviousPage:function(){this._scrollEnabled&&this.__enabled&&(this._refreshCurrentState(),0===this._currentPageIndex&&!this._loopContent||(this._interruptAction(),this._drawPreviousPage(),this._decrementPageIndex(),this._fireOnPageVisibleChangeEvent(-1),this._fireOnPageChangeEvent(this._currentPageIndex),this._autoScrollToCurrentPage()))},updatePage:function(){this._interruptAction(),this._autoScrollToCurrentPage(),this._fireOnPageChangeEvent(this._currentPageIndex)},gotoLastPage:function(){this.gotoPageByIndex(this._pageList.length-1)},gotoFirstPage:function(){this.gotoPageByIndex(0)},gotoPageByIndex:function(e){if(this.__enabled&&!(e>=this._pageList.length||e<0)){var t=0;e>this._currentPageIndex&&(t=1),e<this._currentPageIndex&&(t=-1),this._interruptAction(),this._currentPageIndex=e,this._shiftToCurrentPage(),this._fireOnPageChangeEvent(e),this._fireOnPageVisibleChangeEvent(t)}},gotoPageByPageNum:function(e){this.gotoPageByIndex(e-1)},getCurrentPage:function(){return this._pageList[this._currentPageIndex]},getNextPage:function(){return this._currentPageIndex>=this._pageList.length-1?this.isLoopContent()?this._pageList[0]:null:this._pageList[this._currentPageIndex+1]},getPreviousPage:function(){return this._currentPageIndex<=0?this.isLoopContent()?this._pageList[this._pageList.length-1]:null:this._pageList[this._currentPageIndex-1]},getTotalPageNumber:function(){return this._pageList.length},addPage:function(e,t){t<0||(null==t?this._pageList.push(e):this._pageList.splice(t,0,e),2===this._pageList.length&&(this._scrollEnabled=!0),t<=this._currentPageIndex&&this._currentPageIndex++,1===this._pageList.length&&(this._currentPageIndex=0),this.addChild(e),this._refreshCurrentState(),this._fireOnPageChangeEvent(this._currentPageIndex,0),this._getPageVisibilityByIndex(t)&&this._fireOnPageVisibleChangeEvent(-1))},removePage:function(e){var t=this._pageList.indexOf(e);return this.removePageByIndex(t)},removePageByIndex:function(e){if(e>=this._pageList.length||-1===e)return null;var t=this._pageList.splice(e,1)[0];this._pageList.length<=1&&(this._scrollEnabled=!1),t.removeFromParent();var n=1;return(e<this._currentPageIndex||0===this._pageList.length)&&(n=-1,this._currentPageIndex--),this._currentPageIndex===this._pageList.length&&(this._currentPageIndex=this.isLoopContent()?0:this._pageList.length-1),this._refreshCurrentState(),this._fireOnPageChangeEvent(this._currentPageIndex),this._getPageVisibilityByIndex(e)&&this._fireOnPageVisibleChangeEvent(n),t},setAutoScrollSpeed:function(e){this._autoScrollSpeed=e},addOnPageChangeCallback:function(e,t){this._onPageChangeCallbacks.push({callback:e,context:t})},removeOnPageChangeCallback:function(t){s.remove(this._onPageChangeCallbacks,function(e){return t===e.callback},this)},addOnPageVisibleChangeCallback:function(e,t){this._onPageVisibleChangeCallbacks.push({callback:e,context:t})},removeOnPageVisibleChangeCallback:function(n){s.each(this._onPageVisibleChangeCallbacks,function(e,t){n===e.callback&&this._onPageVisibleChangeCallbacks.splice(t,1)},this)},onTouchBegan:function(e,t){return!(!i.ScrollViewAbstract.prototype.onTouchBegan.apply(this,arguments)||!this._scrollEnabled||!this.__enabled||(this._refreshCurrentState(),this._interruptAction(),this._touchScrollStartingPoint=this.getScrollPosition(),this._changeScrollEventPoint=this._touchScrollStartingPoint,this._startTouchEventHistory(e),0))},onTouchMoved:function(e,t){this._scrollEnabled&&this.__enabled&&(this._updatePageVisibilityOnScroll(),i.ScrollViewAbstract.prototype.onTouchMoved.apply(this,arguments),this._updateTouchEventHistory(e))},onTouchEnded:function(e,t){this._scrollEnabled&&this.__enabled&&(this._checkScrollFinally(e),this._autoScrollToCurrentPage(),i.ScrollViewAbstract.prototype.onTouchEnded.apply(this,arguments))},onTouchCancelled:function(e,t){this._scrollEnabled&&this.__enabled&&(this._checkScrollFinally(e),this._autoScrollToCurrentPage(),i.ScrollViewAbstract.prototype.onTouchCancelled.apply(this,arguments))},_dumpTouchEvent:function(e,t){var n=function(e){try{return e.call(this)}catch(e){return"N/A"}}.bind(t);console.debug(e,n(t.getLocation),n(t.getDelta))},_startTouchEventHistory:function(e){this._touchEventHistory={start:{page:this._currentPageIndex,time:(new Date).getTime(),pos:e.getLocation()},middle:{delta:{x:0,y:0}}}},_updateTouchEventHistory:function(e){var t=this._touchEventHistory.start;if(s.isUndefined(t))this._startTouchEventHistory(e);else{var n=(this._touchEventHistory.last||t).time,i=e.getDelta(),o={time:(new Date).getTime(),pos:e.getLocation(),delta:i};if(o.time-n>this._touchEventBreakTimeout)console.log("touch sequence BREAK"),o.page=this._touchEventHistory.start.page,this._touchEventHistory={start:o,middle:{delta:{x:0,y:0}}};else{if(this._touchEventHistory.last){var r=this._touchEventHistory.middle.delta;this._touchEventHistory.middle=this._touchEventHistory.last,this._touchEventHistory.middle.delta.x+=r.x,this._touchEventHistory.middle.delta.y+=r.y}this._touchEventHistory.last=o}}},_checkScrollFinally:function(e){if(this._updateTouchEventHistory(e),this._touchEventHistory.last){var t=this._touchEventHistory.last.delta,n=this._touchEventHistory.middle.delta,i={x:-this.__getAbsLargerOrAdd(t.x,n.x),y:this.__getAbsLargerOrAdd(t.y,n.y)},o=i[this.orientationPos],r=i.x+i.y-o,a=Math.abs(o);if(a>Math.abs(r))if(100*a>this[this.orientationSize]*this._swipeThresholdRatio){var s=Math.sign(o),c=this._getPageDifference(s);this.__shiftPage(Math.sign(s-c))}this._touchEventHistory={}}},_getPageDifference:function(e){var t=this._currentPageIndex-this._touchEventHistory.start.page;return 0===t||Math.sign(t)!==e&&this.isLoopContent()&&(t=e*(this._pageList.length+e*t)),t},__getAbsLargerOrAdd:function(e,t){return e*t<0?Math.abs(e)>Math.abs(t)?e:t:e+t},__shiftPage:function(e){if(0!==e){var t=this._currentPageIndex+e,n=this._pageList.length;this._loopContent?(t%=n)<0&&(t+=n):t=Math.min(n-1,Math.max(0,t)),t!==this._currentPageIndex&&(this._interruptAction(),this._currentPageIndex=t,this._redrawVisiblePages())}},_setupInnerSize:function(){this.innerWidth=this.width,this.innerHeight=this.height,this["inner"+s.capitalize(this.orientationSize)]=3*this[this.orientationSize]},_setupThresholds:function(){var e=this[this.orientationSize];this._pageTurnThresholds=[.5*e,1.5*e,2.5*e],this._pageDrawUpdateThresholds=[0,e,2*e]},_setupPageList:function(){s.each(this._pageList,function(e){e.getParent()!==this&&(e.removeFromParent(),this.addChild(e)),this._setToSlotIndex(e,-1)},this)},_shiftToCurrentPage:function(){this._resetPagePositions(),this._shiftInnerContainerPosition(),this._redrawVisiblePages()},_hidePage:function(e){this._setToSlotIndex(e,-1)},_checkScrollEvent:function(){var i=this.getScrollPosition(),o=function(e){this._changeScrollEventPoint=i,this._currentPageIndex=e,this._fireOnPageChangeEvent(e)}.bind(this);s.each(this._pageTurnThresholds,function(e,t){var n;if(e>=this._changeScrollEventPoint&&e<i){if(-1===(n=this._pageList.indexOf(this._pageSlots[t+1])))return;o(n)}if(e<=this._changeScrollEventPoint&&i<e){if(-1===(n=this._pageList.indexOf(this._pageSlots[t])))return;o(n)}},this)},_updatePageVisibilityOnScroll:function(){var t=this.getScrollPosition();s.each(this._pageDrawUpdateThresholds,function(e){e>=this._changeScrollEventPoint&&e<t&&(this._drawNextPage(),this._redrawVisiblePages(),this._changeScrollEventPoint=t,this._fireOnPageVisibleChangeEvent(1)),e<=this._changeScrollEventPoint&&t<e&&(this._drawPreviousPage(),this._redrawVisiblePages(),this._changeScrollEventPoint=t,this._fireOnPageVisibleChangeEvent(-1))},this)},_autoScrollToCurrentPage:function(){var e=this._convertContentPosToContainerPos(this._pageList[this._currentPageIndex][this.orientationPos]),t=this._autoScrollSpeed,n=a.p(0,0);n[this.orientationPos]=e,this._currentAction=a.sequence(a.moveTo(t,n).easing(a.easeExponentialOut()),a.callFunc(function(){this._currentAction=null,delete this._changeScrollEventPoint,this._refreshCurrentState()}.bind(this))),this.getInnerContainer().runAction(this._currentAction)},_interruptAction:function(){null!=this._currentAction&&(this.getInnerContainer().stopAction(this._currentAction),this._currentAction=null,delete this._changeScrollEventPoint)},_getVisibleSlotIndices:function(){var e=this.getScrollPosition(),t=this[this.orientationSize],n=a.p(e,e+t),i=[a.p(0,t),a.p(t,2*t),a.p(2*t,3*t)],o=[],r=[];return s.each(i,function(e,t){return e.x>=n.x&&e.x<n.y?void o.push(t):e.y>n.x&&e.y<n.y?void o.push(t):void r.push(t)}),{visible:o,invisible:r}},_getCurrentSlotIndex:function(){var n=this.getScrollPosition(),e=this[this.orientationSize],t=[a.p(-.5*e,.5*e),a.p(.5*e,1.5*e),a.p(1.5*e,2.5*e)],i=-1;return s.each(t,function(e,t){n>=e.x&&n<e.y&&(i=t)}),i},_getPageVisibilityByIndex:function(e){return!(e>=this._pageList.length||e<0)&&this._pageList[e].isVisible()},_redrawVisiblePages:function(){var e=this._getVisibleSlotIndices();s.each(e.visible,function(e){var t=this._pageSlots[e];null==t?(0===e&&this._drawPreviousPage(),0<e&&this._drawNextPage()):t.setVisible(!0)},this),s.each(e.invisible,function(e){null!=this._pageSlots[e]&&this._pageSlots[e].setVisible(!1)},this)},_drawNextPage:function(){var e=this._getCurrentPageSlotIndex()+1,t=this.getNextPage();t&&(t.setVisible(!0),this._setToSlotIndex(t,e))},_drawPreviousPage:function(){var e=this._getCurrentPageSlotIndex()-1,t=this.getPreviousPage();t&&(t.setVisible(!0),this._setToSlotIndex(t,e))},_incrementPageIndex:function(){this._currentPageIndex++,this._currentPageIndex===this._pageList.length&&(this._currentPageIndex=0)},_decrementPageIndex:function(){this._currentPageIndex--,this._currentPageIndex<0&&(this._currentPageIndex=this._pageList.length-1)},_refreshCurrentPageIndex:function(){var e=this._pageList.indexOf(this._pageSlots[this._getCurrentSlotIndex()]);if(-1===e||e===this._currentPageIndex)return!1;var t=0;return e>this._currentPageIndex&&(t=1),e<this._currentPageIndex&&(t=-1),this._currentPageIndex=e,this._fireOnPageChangeEvent(e,t),!0},_resetPagePositions:function(){this.getCurrentPage(),this[this.orientationSize],0!==this._currentPageIndex||this.isLoopContent()?this._currentPageIndex!==this._pageList.length-1||this.isLoopContent()?(this._setToSlotIndex(this.getPreviousPage(),0),this._setToSlotIndex(this.getCurrentPage(),1),this._setToSlotIndex(this.getNextPage(),2)):(this._setToSlotIndex(this.getPreviousPage(),1),this._setToSlotIndex(this.getCurrentPage(),2)):(this._setToSlotIndex(this.getCurrentPage(),0),this._setToSlotIndex(this.getNextPage(),1))},_setToSlotIndex:function(t,e){if(null!=t){var n=this[this.orientationSize];if(e<0||2<e)return t[this.orientationPos]=-n,t.setVisible(!1),!1;if(this.direction===o.ScrollView.DIR_VERTICAL&&t.setPosition(a.p(0,(this.getInnerContainer()[this.orientationSize]/n-1-e)*n)),this.direction===o.ScrollView.DIR_HORIZONTAL&&t.setPosition(a.p(e*n,0)),this._pageSlots[e]===t)return void t.setVisible(!0);this._hidePage(this._pageSlots[e]);var i=s.findKey(this._pageSlots,function(e){return e===t});return null!=i&&(this._pageSlots[i]=null),this._pageSlots[e]=t,!0}},_getCurrentPageSlotIndex:function(){return parseInt(s.findKey(this._pageSlots,function(e){return e===this.getCurrentPage()},this))},_shiftInnerContainerPosition:function(){if(-1!==this._currentPageIndex){var e=this._getCurrentSlotIndex(),t=this._getCurrentPageSlotIndex()-e,n=this.getScrollPosition(),i=t*this[this.orientationSize];this.getInnerContainer()[this.orientationPos]=Math.round(this._convertScrollPositionToRealPosition(n+i))}else this.getInnerContainer()[this.orientationPos]=Math.round(this._convertScrollPositionToRealPosition(0))},_refreshCurrentState:function(){this._refreshCurrentPageIndex(),this._shiftToCurrentPage()},_convertContentPosToScrollPos:function(e){return this.direction===o.ScrollView.DIR_VERTICAL?this.getInnerContainer().height-this.height-e:this.direction===o.ScrollView.DIR_HORIZONTAL?e:void 0},_convertContentPosToContainerPos:function(e){return this._convertScrollPositionToRealPosition(this._convertContentPosToScrollPos(e))},_fireOnPageChangeEvent:function(t){s.each(this._onPageChangeCallbacks,function(e){e.callback.call(e.context,this._pageList[t],t+1,this._pageList,this)},this)},_fireOnPageVisibleChangeEvent:function(t){var n=s.map(this._getVisibleSlotIndices().visible,function(e){return this._pageSlots[e]},this),i=this.getCurrentPage();s.each(this._onPageVisibleChangeCallbacks,function(e){e.callback.call(e.context,n,i,t,this)},this)},cleanup:function(){i.ScrollViewAbstract.prototype.cleanup.call(this),s.each(this._onPageChangeCallbacks,function(e){e.callback=null,e.context=null}),s.each(this._onPageVisibleChangeCallbacks,function(e){e.callback=null,e.context=null}),s.each(this._pageList,function(e){e.getParent()&&e.removeFromParent(),e.cleanup()}),this._pageList=null,this._pageSlots=null,this._touchEventHistory=null}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,o=e.ccui,r=e.console;t.ScrollBar=i.Class.extend({_className:"ScrollBar",WIDGET_NAMES:{SLIDER:"scroll_bar",RAIL:"scroll_base"},ctor:function(e,t){this._slider=this._getWidget(t,this.WIDGET_NAMES.SLIDER),this._rail=this._getWidget(t,this.WIDGET_NAMES.RAIL),this._listView=e,this._axisType=e.getDirection()===o.DIR_HORIZONTAL?"x":"y",this._lengthType="x"===this._axisType?"width":"height",this._initializeSliderAnchor(),this._initializeSliderSize(),this._initializeSliderPosition(),this._initializeOnTouchEvents(),this._initializeOnListViewScrollEvent()},_getWidget:function(t,e){return n.getWidgetFromNode(t,e,function(e){r.warn("ScrollBar: "+e),t.setVisible(!1)})},_initializeSliderSize:function(){var e=this._getScaleOfScrollBarToContent(),t=this._listView[this._lengthType];this._slider[this._lengthType]=t/e},_initializeSliderAnchor:function(){this._slider["anchor"+this._axisType.toUpperCase()]=0},_initializeSliderPosition:function(){this._updateSliderPosition()},_initializeOnTouchEvents:function(){this._rail.addTouchEventListener(this._onTouchRail,this),this._rail.setTouchEnabled(!0),this._slider.addTouchEventListener(this._onTouchSlider,this),this._slider.setTouchEnabled(!0)},_initializeOnListViewScrollEvent:function(){this._listView.addEventListenerScrollView(this._onTouchListView,this)},_updateSliderPosition:function(){var e=-this._listView.getInnerContainer()[this._axisType]/this._getScaleOfScrollBarToContent();this._slider[this._axisType]=e,this._applySliderPositionLimits()},_applySliderPositionLimits:function(){var e=this._slider[this._axisType],t=this._slider[this._lengthType],n=this._rail[this._lengthType];n-t<e&&(e=n-t),e<0&&(e=0),this._slider[this._axisType]=e},_updateContentPosition:function(){var e=this._getScaleOfScrollBarToContent(),t=-this._slider[this._axisType]*e;this._listView.getInnerContainer()[this._axisType]=t},_getScaleOfScrollBarToContent:function(){var e=this._listView.getInnerContainer().getChildren();return _.reduce(e,function(e,t){return e+t[this._lengthType]}.bind(this),0)/this._rail[this._lengthType]},_onTouchRail:function(e,t){if(t===o.Widget.TOUCH_ENDED){var n=this._rail.getTouchEndPosition(),i=this._rail.convertToNodeSpace(n)[this._axisType]-this._slider[this._lengthType]/2;this._slider[this._axisType]=i,this._applySliderPositionLimits(),this._updateContentPosition()}},_onTouchSlider:function(e,t){t===o.Widget.TOUCH_MOVED&&this._onDragSlider(),t===o.Widget.TOUCH_BEGAN&&(this._startDragSliderPosition=e.getPosition()[this._axisType])},_onTouchListView:function(e,t){this._updateSliderPosition()},_onDragSlider:function(){var e=this._slider.getTouchBeganPosition()[this._axisType]-this._slider.getTouchMovePosition()[this._axisType],t=this._startDragSliderPosition-e;this._slider[this._axisType]=t,this._applySliderPositionLimits(),this._updateContentPosition()}})}((this||0).self||global),function(o){var r=o.kh,a=o.cc,s=o.ccui,c=o._;r.Pulldown=a.Class.extend({_nodeParams:{},ctor:function(n,e){var i=!1;if(c.each({button:"pulldownの本体(ccui.Button)",label:"選択されているものを表示するラベル(ccui.TextLabel)"},function(e,t){n[t]||(o.console.warn("ノード設定が不足しています: "+e+": "+t),i=!0)}),i)throw new Error("プルダウンの初期化に失敗しました");$("#pulldownCss").get(0)||$(document.body).append($('<link href="'+r.GameConfig.PULLDOWN_CSS+'" rel="stylesheet" id="pulldownCss" />')),this.$shield=this._createShield(),$(document.body).append(this.$shield),this.$menuBase=this._createMenuBase(),$(document.body).append(this.$menuBase),this._nodeParams=n,this._nodeParams.bottomMargin=c.isUndefined(n.bottomMargin)?80:n.bottomMargin,c.each(e,function(e){this.addChoice(this.$menuBase,e)},this),this._nodeParams.button.addTouchEventListener(function(e,t){t===s.Widget.TOUCH_ENDED&&this._toggleList()},this),this._nodeParams.button.onExit=function(e){return function(){this.cleanUp(),e.call(this._nodeParams.button)}.bind(this)}.bind(this)(this._nodeParams.button.onExit),this._startObserving();var t=a.director.getRunningScene();c.isFunction(t.registerPulldownMenu)&&t.registerPulldownMenu(this),r.env.isSp?this._showMenu():this._hideMenu()},cleanUp:function(){this._stopObserving(),this.$shield.off("click"),this.$shield.off("scroll"),this.$shield.remove(),this.$menuBase.off("change"),this.$menuBase.remove(),$(".pulldownMenuChoice",this.$menuBase).off("click"),$(".pulldownMenuChoice",this.$menuBase).remove(),this.$menuBase.remove();var e=a.director.getRunningScene();c.isFunction(e.unregisterPulldownMenu)&&e.unregisterPulldownMenu(this)},setTouchEnabled:function(e){r.env.isSp?e?this._menuIsVisible&&this.$menuBase.show():this.$menuBase.hide():this._nodeParams.button.setTouchEnabled(e)},_observeTimer:null,_startObserving:function(){r.env.isSp&&(this._observeTimer=setInterval(function(){for(var e=this._nodeParams.button,t=a.director.getRunningScene(),n=!0;e!=t;){if(!e||!e.isVisible()){n=!1;break}e=e.parent}n?this._showMenu():this._hideMenu()}.bind(this),10))},_stopObserving:function(){this._observeTimer&&(clearTimeout(this._observeTimer),this._observeTimer=null)},_createShield:function(){var t=$("<div>");return t.addClass("pulldownShield"),t.on("click",function(e){e.preventDefault(),this._hideMenu()}.bind(this)),t.on("scroll",function(){return e.stopPropergation(),e.preventDefault(),!1}),t},_createMenuBase:function(){return r.env.isSp?this._createMenuBaseSP():this._createMenuBasePC()},_createMenuBaseSP:function(){var t,e=$("<select>");return e.addClass("pulldownMenuBase"),e.on("change",(t=this,function(){var e;e=""==$(this).val()?t.cachedChoice[void 0]:t.cachedChoice[$(this).val()],t._nodeParams.label.setString(e.text),t.selected!==e&&t._onChangeCallback&&t._onChangeCallback.call(t._onChangeCallbackCtx||t,e),t.selected=e})),e},_createMenuBasePC:function(){var e=$("<ul>");return e.addClass("pulldownMenuBase"),e},addChoice:function(e,t){arguments.length<2&&(t=arguments[0],e=this.$menuBase),r.env.isSp?this.addChoiceSP.call(this,e,t):this.addChoicePC.call(this,e,t),this.cachedChoice=this.cachedChoice||{},this.cachedChoice[t.value]=t,c.isUndefined(t.selected)||(this._nodeParams.label.setString(t.text),this.selected=t)},addChoiceSP:function(e,t){var n=$("<option>");n.html(t.text),n.val(t.value),n.attr("choice",JSON.stringify(t)),e.append(n),c.isUndefined(t.selected)||n.attr("selected","selected")},addChoicePC:function(e,t){var n,i,o=$("<li>");o.addClass("pulldownMenuChoice"),o.html(t.text),e.append(o),o.on("click",(n=this,i=t,function(e){e.preventDefault(),n._nodeParams.label.setString(i.text),n.selected!==i&&n._onChangeCallback&&n._onChangeCallback.call(n._onChangeCallbackCtx||n,i),n.selected=i,n._hideMenu()}))},onChange:function(e,t){this._onChangeCallback=e,this._onChangeCallbackCtx=t},selectValue:function(e){var t=this.cachedChoice[e];this._nodeParams.label.setString(t.text),this.selected!==t&&this._onChangeCallback&&this._onChangeCallback.call(this._onChangeCallbackCtx||this,t),this.selected=t},_toggleList:function(){r.env.isSp||(this.$menuBase.is(":visible")?this._hideMenu():this._showMenu())},_menuIsVisible:!1,_hideMenu:function(){this.$menuBase.hide(),this.$shield.hide(),this._menuIsVisible=!1},_showMenu:function(){if(!this._menuIsVisible){var e=this._nodeParams.button,t=e.parent.convertToWorldSpace(e.getPosition()),n=r.env.isSp?{x:this._isOnPopup()?-78:-130,y:-22}:{x:-106,y:16};if(this._nodeParams.diffFromAnchorPoint){var i=e.getAnchorPointInPoints();n.x=-i.x,r.env.isSp||(n.y=i.y)}this.position={x:t.x+n.x,y:a.game.config.designHeight-t.y+n.y};var o=$("#"+a.game.config.id).height()/a.game.config.designHeight;this.$menuBase.css({position:"absolute",top:$("#"+a.game.config.id).parent().css("margin-top"),left:$("#"+a.game.config.id).parent().css("margin-left"),transformOrigin:"0 0",transform:"scale("+o+") translate("+[this.position.x+"px",this.position.y+"px"].join(",")+")",maxHeight:a.game.config.designHeight-this.position.y-this._nodeParams.bottomMargin+"px",minWidth:this._nodeParams.button.width+"px"}),r.env.isSp?this.$shield.css({display:"none"}):this.$shield.css({width:a.game.config.designWidth+"px",height:a.game.config.designHeight+"px",top:$("#"+a.game.config.id).parent().css("margin-top"),left:$("#"+a.game.config.id).parent().css("margin-left"),transformOrigin:"0 0",transform:"scale("+o+")"}),this.$shield.show(),this.$menuBase.show(),this._menuIsVisible=!0}},_isOnPopup:function(){for(var e=this._nodeParams.button,t=!1;e.parent;){if("popupLayer"===e.parent.getName()||"popup_ui"===e.parent.getName()){t=!0;break}e=e.parent}return t},releaseMenu:function(){this.$menuBase.remove(),this.$shield.remove(),this._stopObserving()}})}((this||0).self||global),function(t){var a=t.kh,e=t.cc,n=t.ccs,s=t._;a.StampList=e.Class.extend({className:"KHStampList",STAMPS_PER_PAGE:12,init:function(e,t,n){return e.removeAllChildren(),this._pageviewParent=e,this._buttonsWidget=t,this._onTouchStampCallback=n,this},loadStamps:function(){this._getStamps().then(this._showStamps.bind(this)).fail(function(e){t.console.error(e)})},_getStamps:function(){return a.createInstance("apiAStamps").get().then(function(e){return e.body.data})},_showStamps:function(i){var o=this.STAMPS_PER_PAGE,e=i.length;this._buttonsWidget.seekWidgetByName("btn_next_page").setVisible(o<e),this._buttonsWidget.seekWidgetByName("btn_back_page").setVisible(o<e);var r=[];s.each(s.range(Math.ceil(e/o)),function(e){var t=e*o,n=t+o;r.push(this._createStampPage(i.slice(t,n)))},this);var t=new a.PageView;t.initialize(r,function(){},this),t.setDirection(ccui.ScrollView.DIR_HORIZONTAL),t.setLoopContent(!0),this._pageviewParent.addChild(t);var n=[];n[a.PAGE_CONTROLLER_CONTROLS.NEXT_BUTTON]="btn_next_page",n[a.PAGE_CONTROLLER_CONTROLS.PREVIOUS_BUTTON]="btn_back_page",(new a.PageController).init(this._buttonsWidget,n,t),t.gotoFirstPage()},_createStampPage:function(e){var o=n.load(res["core-popup-com_edit_stamp_page_ui"]).node;return s.each(e,function(n,e){var t=o.seekWidgetByName("stamp_"+e),i=a.Img("coreimg","stamp",s.padZero(n.stamp_id,4)).png;t.loadTextures(i,i,i),t.addTouchEventListener(function(e,t){t===ccui.Widget.TOUCH_ENDED&&this._onTouchStampCallback(n.stamp_id)},this)},this),o}})}((this||0).self||global),function(e){var t=e.kh;t.ApGauge=cc.Class.extend({ctor:function(e){this._node=e},update:function(e,t,n){var i=this._node;return i.seekWidgetByName("gauge_ap").percent=e/t*100,i.setStrings({ap_label:e+"/"+t,time_ap_label:n}),i.seekWidgetByName("time_ap_base").setVisible(t!==e),i.setVisible(!0),{currentAP:e,maxAP:t}}}),t.BpGauge=cc.Class.extend({ctor:function(e){this._node=e},update:function(e,t,n){var i=this._node;return i.seekWidgetByName("gauge_bp").percent=e/t*100,i.setStrings({bp_label:e+"/"+t,time_bp_label:n}),i.seekWidgetByName("time_bp_base").setVisible(t!==e),i.setVisible(!0),{currentBP:e,maxBP:t}}})}((this||0).self||global),function(e){function r(e){var t=e.kind;return _.isString(t)||(t=e.treasure_type,_.isString(t)||(_.isNumber(e.weapon_id)&&(t="weapon"),_.isNumber(e.summon_id)&&(t="summon"),_.isNumber(e.character_id)&&(t="character"),_.isNumber(e.acce_id)&&(t="accessory"),_.isNumber(e.accessory_id)&&(t="accessory"),_.isNumber(e.package_id)&&(t="package"),_.isNumber(e.item_id)&&(t="item"),_.isNumber(e.job_id)&&(t="job"))),t}var o=e.kh,n=e.cc,i=e.ccs,t=e.khutil;t.getCoreCardDINameByKind=function(e){switch(e){case"job":return"CoreCardJobUI";case"weapon":return"CoreCardWeaponUI";case"summon":return"CoreCardSummonUI";case"chara":case"character":return"CoreCardCharacterUI";case"acce":case"accessory":return"CoreCardAccessoryUI";case"package":return"CoreCardPackageItemUI";case"npc":return"CoreCardOtherCharacterUI";case"misc":case"treasure":case"item":return"CoreCardItemUI";case"main":return"CoreCardMainQuestUI";default:throw{message:"getCoreCardDINameByRecord: Unknown kind:"+e}}},t.getCoreCardDINameByRecord=function(e){return t.getCoreCardDINameByKind(r(e))},o.CoreCardUI=n.Class.extend({className:"KHCoreCardUI",UI_JSON_NAME:"",IMG_NODE_NAME:"",IMG_ID_TYPE:"",_currentActionName:null,ctor:function(e,t){this.loadResource(e),this.initAction(t)},loadResource:function(e){var t=i.load($dynamicRes(res[e]));this.uiNode=t.node,this.uiAction=t.action},initWidget:function(e){this.uiNode=e,this.uiAction=e.getActionByTag(e.tag),null==this.uiAction&&console.warn("not corecard widget action: tag="+e.tag)},initAction:function(e){if(null!=e){if(null!=this.uiAction){var t=this.uiNode.runAction(this.uiAction);t.gotoFrameAndPause(t.animationInfo[e].startIndex)}this._currentActionName=e}},setImg:function(e,t){var n,i=this.uiNode.seekWidgetByName(this.IMG_NODE_NAME);i&&(n=null!=t?o.Img("corecard",this.IMG_ID_TYPE,_.padZero(e,4),t).jpg:o.Img("corecard",this.IMG_ID_TYPE,_.padZero(e,4)).jpg,i._imageRenderer&&(i._imageRenderer._textureLoaded=!1),i.loadTexture(n))},setScale:function(e){"number"!=typeof e||this.uiNode.setScale(e)},clearImg:function(){this.uiNode.seekWidgetByName(this.IMG_NODE_NAME).loadTexture("")},setPlusNo:function(e){var t=this.uiNode.seekWidgetByName("plus_no");t&&(t.setString(e),t.setVisible(_.isString(e)))},setPlusNoVisible:function(e){var t=this.uiNode.seekWidgetByName("plus_no");t&&t.setVisible(e)},setStarGauge:function(e,t){var n=this._getStarGaugeBlankNode();n?(n.setVisible(_.isNumber(e)),n.percent=e):console.warn("star gauge frame: not found");var i=this._getStarGaugeNode();i?(i.setVisible(_.isNumber(t)),i.percent=t):console.warn("star gauge: not found")},_getStarGaugeBlankNode:function(){return this.uiNode.seekWidgetByName("star_gauge_blank")},_getStarGaugeNode:function(){return this.uiNode.seekWidgetByName("star_gauge")},getTotalLabel:function(e,t){if("string"!=typeof t)return"";switch(t){case"attack_desc":case"attack_asc":case"overlimit_count_desc":case"overlimit_count_asc":return"攻 "+e.attack;case"level_desc":case"level_asc":return"Lv "+e.level;case"hp_desc":case"hp_asc":return"H "+e.hp;case"weapon_skill_desc":case"weapon_skill_asc":return"SL "+e.skill_level;case"total_desc":case"total_asc":case"rare_desc":case"rare_asc":case"new_date":case"old_date":case"element_type":default:return"総 "+(e.hp+e.attack)}},setTotalLabel:function(e){var t=this.uiNode.seekWidgetByName("total_label");t&&(t.setString(e),t.setVisible(!!e))},setIconOrganized:function(e){var t=this.uiNode.seekWidgetByName("icon_organization");t&&t.setVisible(e)},setIconProtected:function(e){var t=this.uiNode.seekWidgetByName("icon_protected");t&&t.setVisible(e)},setIconEquipped:function(e){var t=this.uiNode.seekWidgetByName("icon_equiping");t&&t.setVisible(e)},setIconElement:function(e){var t=this.uiNode.seekWidgetByName("icon_element");if(t){if(!_.isNumber(e))return void t.setVisible(!1);t.setVisible(!0),t.loadTexture("core/res/icon/elementicon_"+e+".png",ccui.Widget.PLIST_TEXTURE)}},setIconRarity:function(e){var t=this.uiNode.seekWidgetByName("icon_rarity");if(t){if(!_.isString(e))return void t.setVisible(!1);/rare/.test(e)&&(e=e.replace(/rare/,"r").toUpperCase()),t.setVisible(!0),t.loadTexture("core/res/icon/rarityicon_"+e+".png",ccui.Widget.PLIST_TEXTURE)}},setTreasureBox:function(e){var t=this.uiNode.seekWidgetByName("icon_treasure");if(null!==t){if(null==e||"none"===e)return void t.setVisible(!1);t.loadTexture("core/res/icon/treasureicon_"+e+".png",ccui.Widget.PLIST_TEXTURE),t.setVisible(!0)}},setIconSelected:function(e){var t=this.uiNode.seekWidgetByName("selected_label");null!==t&&(this.setGrayout(!0===e),t.setVisible(!0===e))},setSelectNumber:function(e){var t=this.uiNode.seekWidgetByName("count_label");if(null!==t){var n="number"==typeof e&&0<e;this.setGrayout(n),t.setVisible(n),t.setFontSize(t.origFontSize),t.setString(n?e:"")}else console.debug("[ERROR] Could not find count label node.")},isSelected:function(){var e=this.uiNode.seekWidgetByName("selected_label"),t=this.uiNode.seekWidgetByName("count_label");return e&&e.isVisible()||t&&t.isVisible()},setAmount:function(e,t){var n=this.uiNode.seekWidgetByName("amount_label"),i=this.uiNode.seekWidgetByName("amount_base");n&&i&&(n.string=e+(t?"":"個"))},setGetNumber:function(e){var t=this.uiNode.seekWidgetByName("get_num_label");t&&(t.string=e)},addTouchEventListener:function(e,t){this.uiNode.seekWidgetByName(this.IMG_NODE_NAME).addTouchEventListener(e,t)},setTouchEnabled:function(e){this.uiNode.bfsWidgetByName(this.IMG_NODE_NAME).setTouchEnabled(e)},setGrayout:function(e){var t=this.uiNode.seekWidgetByName(this.IMG_NODE_NAME);t&&(e?t.setColor(n.color("#808080")):t.setColor(n.color("#ffffff")))},getResult:function(){return this.uiNode},setData:function(e,t){var n=r(e),i=this._getCardId(e,n);if(_.isUndefined(i))this.clearImg();else{var o=e.skin||0;this.setImg(i,o)}"plain"!==this._currentActionName&&(_.isFunction(this.setAroused)&&this.setAroused(e.is_aroused||!1),"boolean"==typeof e.is_ready_to_evolve&&this.setGrayout(!e.is_ready_to_evolve),_.isUndefined(e.bonus)||this.setPlusNo(0<e.bonus?"+"+e.bonus:""),this.setPlusNoVisible(!1),this.setIconElement(e.element_type),this.setIconRarity(e.rare),this.setTotalLabel(this.getTotalLabel(e,t)))},setVisible:function(e){this.uiNode&&this.uiNode.setVisible(e)},showDetailButton:function(e){console.warn("showDetailButton is not supported")},_getCardId:function(e,t){return e[t+"_id"]||e.id}})}((this||0).self||global),function(e){var t=e.kh;e.cc,$staticRes(res["core-corecard-corecard_job_ui"]),t.CoreCardJobUI=t.CoreCardUI.extend({className:"KHCoreCardJobUI",UI_JSON_NAME:"core-corecard-corecard_job_ui",IMG_NODE_NAME:"job_img",IMG_ID_TYPE:"job",ctor:function(e,t){return null==t?void this._super(this.UI_JSON_NAME,e):(this.initWidget(t),void this.initAction(e))},setIconProtected:function(e){console.warn("setIconProtected is not supported")},setIconEquipped:function(e){console.warn("setIconEquipped is not supported")},setPlusNo:function(){console.warn("setPlusNo is not supported")},setPlusNoVisible:function(){console.warn("setPlusNoVisible is not supported")},setStarGauge:function(){console.warn("setStarGauge is not supported")},setTotalLabel:function(){console.warn("setTotalLabel is not supported")},setIconOrganized:function(){console.warn("setIconOrganized is not supported")},setIconRarity:function(){console.warn("setIconRarity is not supported")},_getCardId:function(e){return e.job_id||e.id}})}((this||0).self||global),function(e){var r=e.kh;e.cc,$staticRes(res["core-corecard-corecard_chara_ui"]),r.CoreCardCharacterUI=r.CoreCardUI.extend({className:"KHCoreCardCharacterUI",UI_JSON_NAME:"core-corecard-corecard_chara_ui",IMG_NODE_NAME:"chara_img",IMG_ID_TYPE:"chara",ACTION_NAME_PLAIN:"plain",ACTION_NAME_ELEMENT_AND_RARE:"e_r",ACTION_NAME_FULL:"full",ACTION_NAME_TREASURE:"treasure",ACTION_NAME_TREASURE_AMOUNT:"treasure_amount",ctor:function(e,t){return null==t?void this._super(this.UI_JSON_NAME,e):(this.initWidget(t),void this.initAction(e))},setIconProtected:function(e){console.warn("setIconProtected is not supported")},setData:function(e,t){this._super.apply(this,arguments);var n=!1;switch(!_.isBoolean(e.has_material_for_arouse)||e.can_arouse&&e.has_material_for_arouse||(n=!0),!1===e.has_material_for_evolve&&(n=!0),this.setGrayout(n),this._currentActionName){case this.ACTION_NAME_FULL:_.isUndefined(e.max_overlimit_count)||this.setStarGauge(20*e.max_overlimit_count,20*e.overlimit_count),this.setIconOrganized(!0===e.is_equipped),this.setPlusNoVisible(!0),this.setBattleType(e.character_type);break;case this.ACTION_NAME_ELEMENT_AND_RARE:this.setPlusNoVisible(!0);break;case this.ACTION_NAME_TREASURE_AMOUNT:_.isUndefined(e.num)||this.setAmount(e.num)}},setAroused:function(e){this._characterIsAroused=e},setStarGauge:function(e,t){this._characterIsAroused?this._setAppearanceStarGaugeAroused():this._setAppearanceStarGaugeNormal(),this._super(e,t)},_setAppearanceStarGaugeAroused:function(){var e=this._getStarGaugeFrameNode();e&&e.setAppearance("star_gauge_arousal")},_setAppearanceStarGaugeNormal:function(){var e=this._getStarGaugeFrameNode();e&&e.setAppearance("star_gauge")},_getStarGaugeFrameNode:function(){return this.uiNode.seekWidgetByName("mainparts_star_gauge_ui")},_getStarGaugeBlankNode:function(){return this._characterIsAroused?this.uiNode.seekWidgetByName("star_gauge_blank_arousal"):this.uiNode.seekWidgetByName("star_gauge_blank")},_getStarGaugeNode:function(){return this._characterIsAroused?this.uiNode.seekWidgetByName("star_gauge_arousal"):this.uiNode.seekWidgetByName("star_gauge")},setBattleType:function(e){var t=this.uiNode.seekWidgetByName("icon_battletype");if(_.isString(e)&&"all"!==e)if("defense"!==e){var n="core/res/icon/battletypeicon_"+e+".png";t.loadTexture(n,ccui.Widget.PLIST_TEXTURE)}else t.loadTexture("core/res/icon/battletypeicon_defence.png",ccui.Widget.PLIST_TEXTURE);else t.setVisible(!1)},setIconRarity:function(e){this._characterIsAroused?this._super(e+"_arousal"):this._super(e)},setAlreadyEntryLabel:function(e){var t=this.uiNode.seekWidgetByName("already_entry_label");return _.isEmpty(e)?(t.setVisible(!1),void this.setGrayout(!1)):(t.setString(e),t.setVisible(!0),t.setZOrder(10),void this.setGrayout(!0))},getAlreadyEntryLabel:function(){return this.uiNode.seekWidgetByName("already_entry_label").getString()},showDetailButton:function(e,t){var n=this.uiNode.seekWidgetByName("btn_detail");if(n){if(!(e instanceof r.core.model.ACharacter))return void n.setVisible(!1);var i=this.uiNode.seekWidgetByName("already_entry_label");if(i){var o=i.getZOrder();n.setZOrder(o+1)}n.setVisible(!0),r.setTouchEventHandlers(n.getParent(),{"TOUCH_ENDED btn_detail":e.openDetailPopup.bind(e,t)})}},_getCardId:function(e){var t=_.isNumber(e.aroused_character_id)&&-1<e.aroused_character_id?e.aroused_character_id:e.character_id||e.id;return _.isUndefined(e.appearance)?t:e.appearance.used_character_id||t}})}((this||0).self||global),function(e){var t=e.kh;e.cc,$staticRes(res["core-corecard-corecard_npc_ui"]),t.CoreCardOtherCharacterUI=t.CoreCardUI.extend({className:"KHCoreCardOtherCharacterUI",UI_JSON_NAME:"core-corecard-corecard_npc_ui",IMG_NODE_NAME:"npc_img",IMG_ID_TYPE:"npc",ctor:function(e,t){return null==t?void this._super(this.UI_JSON_NAME,e):(this.initWidget(t),void this.initAction(e))},setIconProtected:function(e){console.warn("setIconProtected is not supported")},setIconEquipped:function(e){console.warn("setIconEquipped is not supported")},_getCardId:function(e,t){return e.other_character_id}})}((this||0).self||global),function(e){var t=e.kh;e.cc,$staticRes(res["core-corecard-corecard_weapon_ui"]),t.CoreCardWeaponUI=t.CoreCardUI.extend({className:"KHCoreCardWeaponUI",UI_JSON_NAME:"core-corecard-corecard_weapon_ui",IMG_NODE_NAME:"weapon_img",IMG_ID_TYPE:"weapon",ACTION_NAME_PLAIN:"plain",ACTION_NAME_ELEMENT_AND_RARE:"e_r",ACTION_NAME_FULL:"full",ACTION_NAME_TREASURE:"treasure",ACTION_NAME_TREASURE_AMOUNT:"treasure_amount",ctor:function(e,t){return null==t?void this._super(this.UI_JSON_NAME,e):(this.initWidget(t),void this.initAction(e))},setData:function(e,t){switch(this._super.apply(this,arguments),this._currentActionName){case this.ACTION_NAME_FULL:_.isUndefined(e.is_equipped)||this.setIconEquipped(e.is_equipped),_.isUndefined(e.is_locked)||this.setIconProtected(e.is_locked),_.isUndefined(e.max_overlimit_count)||this.setStarGauge(20*e.max_overlimit_count,20*e.overlimit_count),this.setPlusNoVisible(!0);break;case this.ACTION_NAME_ELEMENT_AND_RARE:this.setPlusNoVisible(!0);break;case this.ACTION_NAME_TREASURE_AMOUNT:_.isUndefined(e.num)||this.setAmount(e.num)}},setAroused:function(e){this._isAroused=e},setStarGauge:function(e,t){this._isAroused?this._setAppearanceStarGaugeAroused():this._setAppearanceStarGaugeNormal(),this._super(e,t)},_setAppearanceStarGaugeAroused:function(){var e=this._getStarGaugeFrameNode();e&&e.setAppearance("star_gauge_arousal")},_setAppearanceStarGaugeNormal:function(){var e=this._getStarGaugeFrameNode();e&&e.setAppearance("star_gauge")},_getStarGaugeFrameNode:function(){return this.uiNode.seekWidgetByName("mainparts_star_gauge_ui")},_getStarGaugeBlankNode:function(){return this._isAroused?this.uiNode.seekWidgetByName("star_gauge_blank_arousal"):this.uiNode.seekWidgetByName("star_gauge_blank")},_getStarGaugeNode:function(){return this._isAroused?this.uiNode.seekWidgetByName("star_gauge_arousal"):this.uiNode.seekWidgetByName("star_gauge")},setIconRarity:function(e){this._isAroused?this._super(e+"_arousal"):this._super(e)}})}((this||0).self||global),function(e){var t=e.kh;e.cc,$staticRes(res["core-corecard-corecard_summon_ui"]),t.CoreCardSummonUI=t.CoreCardUI.extend({className:"KHCoreCardSummonUI",UI_JSON_NAME:"core-corecard-corecard_summon_ui",IMG_NODE_NAME:"summon_img",IMG_ID_TYPE:"summon",ACTION_NAME_PLAIN:"plain",ACTION_NAME_ELEMENT_AND_RARE:"e_r",ACTION_NAME_FULL:"full",ACTION_NAME_TREASURE:"treasure",ACTION_NAME_TREASURE_AMOUNT:"treasure_amount",ctor:function(e,t){return null==t?void this._super(this.UI_JSON_NAME,e):(this.initWidget(t),void this.initAction(e))},setData:function(e,t){switch(this._super.apply(this,arguments),this._currentActionName){case this.ACTION_NAME_FULL:_.isUndefined(e.is_equipped)||this.setIconEquipped(e.is_equipped),_.isUndefined(e.is_locked)||this.setIconProtected(e.is_locked),_.isUndefined(e.max_overlimit_count)||this.setStarGauge(20*e.max_overlimit_count,20*e.overlimit_count),this.setPlusNoVisible(!0);break;case this.ACTION_NAME_ELEMENT_AND_RARE:this.setPlusNoVisible(!0);break;case this.ACTION_NAME_TREASURE_AMOUNT:_.isUndefined(e.num)||this.setAmount(e.num)}}})}((this||0).self||global),function(e){var r=e.kh,o=e.cc;$staticRes(res["core-corecard-corecard_acce_ui"]),r.CoreCardAccessoryUI=r.CoreCardUI.extend({className:"KHCoreCardAccessoryUI",UI_JSON_NAME:"core-corecard-corecard_acce_ui",IMG_NODE_NAME:"acce_img",IMG_ID_TYPE:"acce",ACTION_NAME_PLAIN:"plain",ACTION_NAME_ELEMENT_AND_RARE:"e_r",ACTION_NAME_FULL:"full",ACTION_NAME_TREASURE:"treasure",ACTION_NAME_TREASURE_AMOUNT:"treasure_amount",GRAYOUT_NOTUSE_EFFECT:["CoreCardCommon"],ctor:function(e,t){return null==t?void this._super(this.UI_JSON_NAME,e):(this.initWidget(t),void this.initAction(e))},setData:function(e,t,n){switch(this._super.apply(this,arguments),this._currentActionName){case this.ACTION_NAME_FULL:_.isUndefined(e.is_equipped)||this.setIconEquipped(e.is_equipped),_.isUndefined(e.is_locked)||this.setIconProtected(e.is_locked),this.clearIconSubEffects(),_.isUndefined(e.sub_effects)||_.each(e.sub_effects,function(e,t){this.setIconSubEffect(t,e.icon_type),-1<this.GRAYOUT_NOTUSE_EFFECT.indexOf(n)?this.setGrayoutNotUseSubEffect(t,e.can_use_effect):this.setGrayoutNotUseSubEffect(t,!0)}.bind(this));break;case this.ACTION_NAME_ELEMENT_AND_RARE:break;case this.ACTION_NAME_TREASURE_AMOUNT:_.isUndefined(e.num)||this.setAmount(e.num)}},getTotalLabel:function(e,t){if("string"!=typeof t)return"";switch(t){case"acce_equipped":case"acce_not_equipped":return"Lv "+e.level;default:return this._super.apply(this,arguments)}},clearIconSubEffects:function(){var t=/^coreimg_statusicon_/;this.uiNode.seekWidgets(function(e){t.test(e.getName())&&(e.setVisible(!1),e.setColor(o.color("#FFFFFF")))})},setIconSubEffect:function(e,t){var n="coreimg_statusicon_"+e,i=this._getNodeByName(n);if(i){i.setVisible(!0);var o=r.Img("coreimg","statusicon",_.padZero(t,4)).png;i.loadTexture(o)}},setGrayoutNotUseSubEffect:function(e,t){var n="coreimg_statusicon_"+e,i=this._getNodeByName(n);return null===i?void console.debug("[ERROR] Could not find icon node: "+i):void i.setColor(!0===t?o.color("#FFFFFF"):o.color("#808080"))},_getNodeByName:function(e){var t=this.uiNode.seekWidgetByName(e);return t||console.warn("CoreCardAccessoryUI: node '"+e+"' not found."),t},setIconSelected:function(e){var t=this.uiNode.seekWidgetByName("count_label");null!==t&&(this.setGrayout(!0===e),t.setVisible(!0===e),t.setString("選択中"),t.setFontSize(24))},showDetailButton:function(e,t){var n=this.uiNode.seekWidgetByName("btn_detail");if(n){if(r.acce&&r.acce.model&&r.acce.model.Accessory||console.error("[Must] kh.acce.model.Accessory not Loaded"),!(e instanceof r.acce.model.Accessory))return void n.setVisible(!1);n.setVisible(!0),r.setTouchEventHandlers(n.getParent(),{"TOUCH_ENDED btn_detail":e.openDetailPopup.bind(e,t)})}},setImg:function(e,t){this._super(e)},_getCardId:function(e){return e.accessory_id||e.id}})}((this||0).self||global),function(e){var t=e.kh;e.cc,$staticRes(res["core-corecard-corecard_item_ui"]),t.CoreCardItemUI=t.CoreCardUI.extend({className:"KHCoreCardItemUI",UI_JSON_NAME:"core-corecard-corecard_item_ui",IMG_NODE_NAME:"item_img",IMG_ID_TYPE:"item",ACTION_NAME_PLAIN:"plain",ACTION_NAME_AMOUNT:"amount",ACTION_NAME_TREASURE:"treasure",ACTION_NAME_TREASURE_AMOUNT:"treasure_amount",ctor:function(e,t){return null==t?void this._super(this.UI_JSON_NAME,e):(this.initWidget(t),void this.initAction(e))},setData:function(e,t){var n=this._getCardId(e);_.isUndefined(n)?this.clearImg():this.setImg(n),_.isUndefined(e.num)||this._currentActionName!==this.ACTION_NAME_AMOUNT&&this._currentActionName!==this.ACTION_NAME_TREASURE_AMOUNT||this.setAmount(e.num)},setImg:function(e,t){this._super(e)},setAmount:function(e,t){var n=this.uiAction;if(n.animationInfo&&n.animationInfo.treasure_amount&&n.getCurrentFrame()===n.animationInfo.treasure_amount.startIndex)this.uiNode.seekWidgetByPath("amount_base_treasure.amount_label").string=e+(t?"":"個");else{var i=this.uiNode.seekWidgetByPath("amount_base.amount_label"),o=this.uiNode.seekWidgetByName("amount_base");i&&o&&(i.string=e+(t?"":"個"),o.setVisible(!0),i.setVisible(!0))}},setIconProtected:function(e){console.warn("setIconProtected is not supported")},setIconEquipped:function(e){console.warn("setIconEquipped is not supported")},setPlusNo:function(){console.warn("setPlusNo is not supported")},setPlusNoVisible:function(){console.warn("setPlusNoVisible is not supported")},setStarGauge:function(){console.warn("setStarGauge is not supported")},setTotalLabel:function(){console.warn("setTotalLabel is not supported")},setIconOrganized:function(){console.warn("setIconOrganized is not supported")},setIconRarity:function(){console.warn("setIconRarity is not supported")},_getCardId:function(e){return e.item_id||e.id}})}((this||0).self||global),function(e){var t=e.kh;e.cc,$staticRes(res["core-corecard-corecard_item_ui"]),t.CoreCardPackageItemUI=t.CoreCardUI.extend({className:"KHCoreCardPackageItemUI",UI_JSON_NAME:"core-corecard-corecard_item_ui",IMG_NODE_NAME:"item_img",IMG_ID_TYPE:"package",ACTION_NAME_PLAIN:"plain",ACTION_NAME_AMOUNT:"amount",ACTION_NAME_TREASURE:"treasure",ACTION_NAME_TREASURE_AMOUNT:"treasure_amount",ctor:function(e,t){return null==t?void this._super(this.UI_JSON_NAME,e):(this.initWidget(t),void this.initAction(e))},setData:function(e,t){this._super.apply(this,arguments),_.isUndefined(e.num)||this._currentActionName!==this.ACTION_NAME_AMOUNT&&this._currentActionName!==this.ACTION_NAME_TREASURE_AMOUNT||this.setAmount(e.num)},setImg:function(e,t){this._super(e)},setAmount:function(e,t){var n=this.uiAction;if(n.animationInfo&&n.animationInfo.treasure_amount&&n.getCurrentFrame()===n.animationInfo.treasure_amount.startIndex)this.uiNode.seekWidgetByPath("amount_base_treasure.amount_label").string=e+(t?"":"個");else{var i=this.uiNode.seekWidgetByPath("amount_base.amount_label"),o=this.uiNode.seekWidgetByName("amount_base");i&&o&&(i.string=e+(t?"":"個"),o.setVisible(!0),i.setVisible(!0))}},setIconProtected:function(e){console.warn("setIconProtected is not supported")},setIconEquipped:function(e){console.warn("setIconEquipped is not supported")},setPlusNo:function(){console.warn("setPlusNo is not supported")},setPlusNoVisible:function(){console.warn("setPlusNoVisible is not supported")},setStarGauge:function(){console.warn("setStarGauge is not supported")},setTotalLabel:function(){console.warn("setTotalLabel is not supported")},setIconOrganized:function(){console.warn("setIconOrganized is not supported")},setIconRarity:function(){console.warn("setIconRarity is not supported")}})}((this||0).self||global),function(e){var t=e.kh;e.cc,t.CoreCardShopItemUI=t.CoreCardItemUI.extend({className:"KHCoreCardShopItemUI",ctor:function(e){this._super(null,null),this.IMG_ID_TYPE=e}})}((this||0).self||global),function(e){e.kh.StarGauge=cc.Class.extend({init:function(e,t){var n={aroused:{appearance:"star_gauge_blank_arousal",blankNode:{show:"star_gauge_blank_arousal",hide:"star_gauge_blank"},gaugeNode:"star_gauge_arousal"},normal:{appearance:"star_gauge_blank",blankNode:{show:"star_gauge_blank",hide:"star_gauge_blank_arousal"},gaugeNode:"star_gauge"}}[t.isAroused?"aroused":"normal"];this._getFrameNode(e).then(function(e){this._setAppearance(e,n),this._setGauge(e,t,n)}.bind(this))},_getFrameNode:function(e){return this.__getNode(e,"mainparts_star_gauge_ui")},_setAppearance:function(e,t){_.isEmpty(e.getAction())?(this.__getNode(e,t.blankNode.show).then(function(e){e.setAppearance("show")}),this.__getNode(e,t.blankNode.hide).then(function(e){e.setAppearance("hide")})):e.setAppearance(t.appearance)},_setGauge:function(e,t,n){this.__getNode(e,n.blankNode.show).then(function(e){e.percent=20*t.blank}),this.__getNode(e,n.gaugeNode).then(function(e){e.percent=20*t.gauge})},__getNode:function(e,t){var n=e.seekWidgetByName(t);return n?Q.resolve(n):Q.reject(new Error("node not found: "+t))}})}((this||0).self||global),function(e){var h=e.kh,_=e.cc;_.EditBox&&(h.EditBox=_.EditBox.extend({DOM_CLASS_NAME:"kh_edit_box",ctor:function(e,t,n,i){_.ControlButton.prototype.ctor.call(this),this._textColor=_.color.BLACK,this._placeholderColor=_.color.GRAY,this.setContentSize(e);var o=this._domInputSprite=new _.Sprite;o.draw=function(){},this.addChild(o);var r=this._edTxt=document.createElement("textarea");r.style.fontSize=this._edFontSize+"px",r.style.color="#000000",r.style.border=0,r.style.background="transparent",r.style.width="100%",r.style.height="100%",r.style.active=0,r.style.outline="medium",r.style.padding="0",r.style.paddingLeft="1em",r.style.paddingRight="1em";this._onCanvasClick=function(){this._edTxt.blur()}.bind(this);this._inputEvent=function(){this._delegate&&this._delegate.editBoxTextChanged&&this._delegate.editBoxTextChanged(this,this._edTxt.value)}.bind(this);this._keyPressEvent=function(e){e.keyCode===_.KEY.enter&&(e.stopPropagation(),e.preventDefault(),this._delegate&&this._delegate.editBoxReturn&&this._delegate.editBoxReturn(this),_._canvas.focus())}.bind(this);this._focusEvent=function(){this._edTxt.value===this._placeholderText&&(this._edTxt.value="",this._edTxt.style.fontSize=this._edFontSize+"px",this._edTxt.style.color=_.colorToHex(this._textColor)),this._delegate&&this._delegate.editBoxEditingDidBegin&&this._delegate.editBoxEditingDidBegin(this),_._canvas.addEventListener("click",this._onCanvasClick)}.bind(this);this._blurEvent=function(){""===this._edTxt.value&&(this._edTxt.value=this._placeholderText,this._edTxt.style.fontSize=this._placeholderFontSize+"px",this._edTxt.style.color=_.colorToHex(this._placeholderColor)),this._delegate&&this._delegate.editBoxEditingDidEnd&&this._delegate.editBoxEditingDidEnd(this),_._canvas.removeEventListener("click",this._onCanvasClick)}.bind(this),r.addEventListener("input",this._inputEvent),r.addEventListener("keypress",this._keyPressEvent),r.addEventListener("focus",this._focusEvent),r.addEventListener("blur",this._blurEvent),_.DOM.convert(o),o.dom.appendChild(r),o.dom.showTooltipDiv=!1,o.dom.style.width=e.width-6+"px",o.dom.style.height=e.height-6+"px",o.canvas.remove(),this.initWithSizeAndBackgroundSprite(e,t)&&(n&&this.setBackgroundSpriteForState(n,_.CONTROL_STATE_HIGHLIGHTED),i&&this.setBackgroundSpriteForState(i,_.CONTROL_STATE_DISABLED)),this.setPosition(0,11)},getText:function(){return(this._super()||"").trim()},setTextAlign:function(e){this._edTxt.style.textAlign=e},setOnEditBoxReturnCallback:function(e,t){this._delegate=this._delegate||new _.EditBoxDelegate,this._delegate.editBoxReturn=e.bind(t||this)},setOnInputCallback:function(e,t){this._delegate=this._delegate||new _.EditBoxDelegate,this._delegate.editBoxTextChanged=e.bind(t)},removeOnInputCallback:function(){null!=this._delegate&&(this._delegate.editBoxTextChanged=null)},cleanup:function(){if(this.removeOnInputCallback(),this._delegate=null,_.EditBox.prototype.cleanup.apply(this),this._domInputSprite&&this._domInputSprite.cleanup(),this._edTxt)for(var e=document.getElementById("EGLViewDiv"),t=this._edTxt;t!=e;){var n=t.parentElement||e;t.remove(),t=n}}}),h.EditBox.setVisibleAll=function(e){var t=$("."+h.EditBox.prototype.DOM_CLASS_NAME);e?t.show():t.hide()},h.EditBox.createEditBox=function(e,t,n,i,o,r){r=r||{},o=o||"";var a,s=t+"_editBox";if(void 0!==s&&(s=r.internalName),s&&e[s])a=e[s];else{var c=e.seekWidgetByName(t),u=new _.Scale9Sprite,l=_.size(.9*c.width,.9*c.height);(a=new h.EditBox(l,u)).setFontColor(_.color.BLACK),a.setMaxLength(i),r.textAlign&&a.setTextAlign(r.textAlign),c.addChild(a),e[s]=a}return a.setText(o),a.setFontSize(r.fontSize||22),a})}((this||0).self||global),function(e){var p=e.kh,g=e.cc,f=e._;p.EnhEvoButtons=g.Class.extend({className:"KHEnhEvoButtons",_setWeaponEnhEvoButtonStates:function(e,t,n){return this._setEnhEvoButtonStates(e,"apiAWeapons",t,n)},_setSummonEnhEvoButtonStates:function(e,t,n){return this._setEnhEvoButtonStates(e,"apiASummons",t,n)},_setCharacterEnhEvoButtonStates:function(e,t,n){return this._setEnhEvoButtonStates(e,"apiACharacters",t,n)},_setEnhEvoButtonStates:function(_,e,t,d){return d=d||{},p.createInstance(e).getEnhanceEvolveInfo(t).then(function(e){var t=e.body.enhanceable,n=this.__selectExistingButtonName(_,["btn_enh","btn_continue_enh"]);if(null!==n){var i=n.name,o=d[i]||d.btn_enh,r="TOUCH_ENDED "+i;if(n.setEnabled(t),n.setColor(t?g.color("#FFFFFF"):g.color("#808080")),t&&!f.isUndefined(o))(c={})[r]=o,p.setTouchEventHandlers(_,c,_)}var a=this._getEvolvableWithArouseConditions(e.body),s=this.__selectExistingButtonName(_,["btn_evo","btn_continue_evo","btn_next_evo"]);if(null!==s){var c,u=s.name,l=d[u]||d.btn_evo,h="TOUCH_ENDED "+u;if(s.setEnabled(a),s.setColor(a?g.color("#FFFFFF"):g.color("#808080")),a&&!f.isUndefined(l))(c={})[h]=l,p.setTouchEventHandlers(_,c,_)}}.bind(this))},_getEvolvableWithArouseConditions:function(e){return!0!==e.arousable?e.evolvable:f.reduce(e.arouse_condition,function(e,t){return e&&t}.bind(this),!0)},__selectExistingButtonName:function(n,e){var i=null;return f.each(e,function(e){var t=n.seekWidgetByName(e);null!==t&&(i=t)}),i}})}((this||0).self||global),function(e){var o=e.kh,n=e.cc;o.SoundPlayer=n.Class.extend({className:"KHSoundPlayer",ctor:function(){this._effects={},this._voices={},this._playLockHandler=o.createInstance("SoundResourcePlayLockHandler")},init:function(e){return this.updateByPlayerGameConfig(e),this},updateByPlayerGameConfig:function(e){this.enableSound(e.isSoundOn()),this.enableBgm(e.isBgmOn()),this.enableSe(e.isSeOn()),this.enableVoice(e.isVoiceOn()),this.setBgmVolume(e.getVirtualBgmVolume()),this.setSeVolume(e.getVirtualSeVolume()),this.setVoiceVolume(e.getVirtualVoiceVolume()),this._masterVolume=1},playVoice:function(e,t){if(this._voiceEnabled&&this._enabled&&!this._playLockHandler.isLocked(e))return this._playLockHandler.lock(e),this._voices[e]=this._playEffect(e,!1),this._voices[e]?void this._voices[e].setVolume(this._voiceVolume*this._masterVolume*(t||1)):(delete this._voices[e],void console.warn("Voice not preloaded: "+e))},playMusic:function(e,t){if(this._bgmEnabled&&this._enabled){var n=this._extendPath(e),i=this._bgmVolume*this._masterVolume*(t||1);o.postMessage("changeBGM",[n,[{media:"audio/mp3",path:n}],i]),this._bgmResourceName=n}},directPlayMusic:function(e,t,n){this._bgmResourceName=null,o.postMessage("changeBGM",[e,t,n])},playSoundEffect:function(e,t,n){if(this._seEnabled&&this._enabled&&!this._playLockHandler.isLocked(e))return this._playLockHandler.lock(e),this._effects[e]=this._playEffect(e,t),this._effects[e]?void this._effects[e].setVolume(this._seVolume*this._masterVolume*(n||1)):(delete this._effects[e],void console.warn("Sound effect not preloaded: "+e))},stopVoice:function(e){var t=this._voices[e];null!=t&&n.audioEngine.stopEffect(t)},stopSoundEffect:function(e){null!=this._effects[e]&&n.audioEngine.stopEffect(this._effects[e])},stopBgm:function(){o.postMessage("stopBGM"),this._bgmResourceName=null},clearCache:function(){this.clearEffectCache(),this.clearVoiceCache(),this.clearBgmCache(),n.audioEngine.end()},clearEffectCache:function(){_.each(this._effects,function(e,t){e&&e.stop(),n.audioEngine.unloadEffect(t)}),this._effects={}},clearVoiceCache:function(){_.each(this._voices,function(e,t){e&&e.stop(),n.audioEngine.unloadEffect(t)}),this._voices={}},clearBgmCache:function(){},enableSound:function(e){(this._enabled=e)||this.clearCache()},enableSe:function(e){(this._seEnabled=e)?(new o.SoundEffects).preload():this.clearEffectCache()},enableVoice:function(e){(this._voiceEnabled=e)||this.clearVoiceCache()},enableBgm:function(e){(this._bgmEnabled=e)||this.stopBgm()},setMasterVolume:function(e){this._masterVolume=e},setSeVolume:function(e){this._seVolume=e},setVoiceVolume:function(e){this._voiceVolume=e},setBgmVolume:function(e){this._bgmVolume=e,this._bgmResourceName&&this.playMusic(this._bgmResourceName)},_playEffect:function(e,t){return n.audioEngine.playEffect(e,t)},_extendPath:function(e){return-1!==e.search(/^http/)?e:khutil.convertPathForMainFrame(e)}})}((this||0).self||global),function(e){var r=e.kh,t=e.cc;r.SoundPlayerIOS=t.Class.extend({className:"KHSoundPlayerIOS",ctor:function(){this._playLockHandler=r.createInstance("SoundResourcePlayLockHandler")},init:function(e){return this.updateByPlayerGameConfig(e),this},updateByPlayerGameConfig:function(e){this.enableSound(e.isSoundOn()),this.enableBgm(e.isBgmOn()),this.enableSe(e.isSeOn()),this.enableVoice(e.isVoiceOn()),this.setBgmVolume(e.getVirtualBgmVolume()),this.setSeVolume(e.getVirtualSeVolume()),this.setVoiceVolume(e.getVirtualVoiceVolume()),this._masterVolume=1},playVoice:function(e,t){if(this._voiceEnabled&&this._enabled&&!this._playLockHandler.isLocked(e)){this._playLockHandler.lock(e);var n=this._extendPath(e),i=this._voiceVolume*this._masterVolume*(t||1);r.postMessage("playVoice",[n,[{media:"audio/mp3",path:n}],i])}},playMusic:function(e,t){if(this._bgmEnabled&&this._enabled&&!this._playLockHandler.isLocked(e)){this._playLockHandler.lock(e);var n=this._extendPath(e),i=this._bgmVolume*this._masterVolume*(t||1);r.postMessage("changeBGM",[n,[{media:"audio/mp3",path:n}],i]),this._bgmResourceName=n}},directPlayMusic:function(e,t,n){this._bgmResourceName=null,r.postMessage("changeBGM",[e,t,n])},playSoundEffect:function(e,t,n){if(this._seEnabled&&this._enabled){var i=this._extendPath(e),o=this._seVolume*this._masterVolume*(n||1);r.postMessage("playSound",[i,[{media:"audio/mp3",path:i}],o])}},stopVoice:function(e){r.postMessage("stopVoice")},stopSoundEffect:function(e){null!=this._effects[e]&&r.postMessage("stopSound",[e])},stopBgm:function(){r.postMessage("stopBGM"),this._bgmResourceName=null},clearCache:function(){},clearEffectCache:function(){},clearVoiceCache:function(){},enableSound:function(e){this._enabled=e},enableSe:function(e){this._seEnabled=e},enableVoice:function(e){this._voiceEnabled=e},enableBgm:function(e){(this._bgmEnabled=e)||this.stopBgm()},setMasterVolume:function(e){this._masterVolume=e},setSeVolume:function(e){this._seVolume=e},setVoiceVolume:function(e){this._voiceVolume=e},setBgmVolume:function(e){this._bgmVolume=e,this._bgmResourceName&&this.playMusic(this._bgmResourceName)},_extendPath:function(e){return-1!==e.search(/^http/)?e:khutil.convertPathForMainFrame(e)}})}((this||0).self||global),function(e){var r=e.kh,a=e.cc,s=e._;r.VoiceLoader=a.Class.extend({className:"KHVoiceLoader",ctor:function(){r.createInstance("soundPlayer").init(r.createInstance("playerGameConfig"))},loadAvatarVoices:function(e,t,n,i){if(!r.createInstance("playerGameConfig").isVoiceOn())return Q.resolve([]);var o=r.generateAvatarSoundPaths(e,t,n,i);return Q.all(s.map(o,function(e){return a.loader.getRes(e)?Q.resolve(e):r.loader.load([e])})).thenResolve(o)},loadCharacterVoices:function(e,t,n){return this.loadAvatarVoices(e,!1,t,n)},loadJobVoices:function(e,t,n){return this.loadAvatarVoices(e,!0,t,n)},loadAvatarAttackVoices:function(e,t){var n=r.IDList.VOICES.ATTACK;return this.loadAvatarVoices(e,t,n.LOWER,n.UPPER)},loadCharacterAttackVoices:function(e){return this.loadAvatarAttackVoices(e,!1)},loadJobAttackVoices:function(e){return this.loadAvatarAttackVoices(e,!0)},unloadAvatarVoices:function(e,t,n,i){var o=r.generateAvatarSoundPaths(e,t,n,i);s.each(o,function(e){a.audioEngine.unloadEffect(e)})},unloadCharacterVoices:function(e,t,n){this.unloadAvatarVoices(e,!1,t,n)},unloadJobVoices:function(e,t,n){this.unloadAvatarVoices(e,!0,t,n)},unloadAvatarAttackVoices:function(e,t){var n=r.IDList.VOICES.ATTACK;this.unloadAvatarVoices(e,t,n.LOWER,n.UPPER)},unloadCharacterAttackVoices:function(e){this.unloadAvatarAttackVoices(e,!1)},unloadJobAttackVoices:function(e){this.unloadAvatarAttackVoices(e,!0)}})}((this||0).self||global),function(e){var i=e.kh,t=e.cc,o=e._;i.SeLoader=t.Class.extend({className:"KHSeLoader",loadLevelUpSe:function(e){if(!i.createInstance("playerGameConfig").isSeOn())return Q.resolve("");var t=i.generateLevelUpSoundPath(e);if(null==t||o.isEmpty(t))return Q.resolve("");var n=i.getAddVersionQueryString(t.mp3);return i.createInstance("soundEffects").load([n]).thenResolve(n)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.SoundResourcePlayLockHandler=n.Class.extend({PLAY_LOCK_TIME:50,ctor:function(){this._lockedResourceList={}},lock:function(e){this._lockedResourceList[e]=!0,this._startLockTimer(e)},isLocked:function(e){return!0===this._lockedResourceList[e]},_startLockTimer:function(e){Q.delay(this.PLAY_LOCK_TIME).then(this._releaseLockTimer.bind(this,e))},_releaseLockTimer:function(e){delete this._lockedResourceList[e]}})}((this||0).self||global),function(r){var i=r.cc,o=r.ccs,a=r.kh,s=r._;a.ArmatureVisualEffect=i.Class.extend({className:"KHArmatureVisualEffect",DEFAULT_Z_ORDER:100,init:function(e,t,n){var i=t,o=n;s.isObject(i)&&s.isUndefined(o)&&(o=i,i=null),s.isObject(o)&&(this._target=o);var r=this._loadArmature(e,i);return this._armature=r.armature,this._animation=r.armature.getAnimation(),this._disposeArmature=r.dispose,this._availableAnimations=this._animation.getAnimationData().movementNames,this._eventHandler=a.createInstance("AnimationEventHandlerCcs_1_6").init(this._animation),this},cleanUp:function(){s.isFunction(this._disposeArmature)&&this._disposeArmature(),this._disposeArmature=null,this._armature=null,this._animation=null,this._eventHandler&&s.isFunction(this._eventHandler.cleanUp)&&this._eventHandler.cleanUp(),this._eventHandler=null},play:function(e,t,n,i){if(!this._hasAnimation(e))return r.console.error("KHArmatureVisualEffect.js: armature visual effect does not have animation: "+e),!1;if(null==t)return r.console.warn("KHArmatureVisualEffect.js: no valid target passed while attempting to play: "+e),!1;null==n&&(r.console.warn("KHArmatureVisualEffect.js: no valid pos passed while attempting to play: "+e+"defaulting to the target node pos"),n=t.getPosition());var o=this._armature;return o.setPosition(n),t.addChild(o,null!=i?i:this.DEFAULT_Z_ORDER),this._animation.play(e),!0},_hasAnimation:function(e){return-1!==this._availableAnimations.indexOf(e)},stop:function(){this._animation.stop(),this._armature.removeFromParent()},pause:function(){this._animation.pause()},resume:function(){this._animation.resume()},getTarget:function(){return this._target},addAnimationEventCallback:function(e,t,n){this._eventHandler.addAnimationEventCallback(e,t,n)},removeAnimationEventCallback:function(e,t){this._eventHandler.removeAnimationEventCallback(e,t)},removeAnimationEventName:function(e){this._eventHandler.removeAnimationEventName(e)},removeAllAnimationEventCallbacks:function(){this._eventHandler.removeAllAnimationEventCallbacks()},_loadArmature:function(e,t){o.armatureDataManager.addArmatureFileInfo(e),s.isString(t)||(t=o.armatureDataManager.getRelativeData(e).armatures[0]);var n=o.Armature.create(t);return{armature:n,dispose:function(){i.spriteFrameCache.removeSpriteFramesFromFile(e),o.armatureDataManager.removeArmatureFileInfo(e),n.removeFromParent()}}}})}((this||0).self||global),function(o){var e=o.cc,i=o.ccs,r=o.ccui,a=o.kh,s=o._,c=o.console;a.WindowVisualEffect=e.Class.extend({className:"KHWindowVisualEffect",DEFAULT_Z_ORDER:100,DEFAULT_RELATIVE_DISPLAY_POSITION:e.p(.5,.5),DEFAULT_LOOP:!1,init:function(e,t){s.isObject(t)&&(this._target=t),this._loop=this.DEFAULT_LOOP;var n=i.load($dynamicRes(e));return this._node=n.node,null==this._node?(c.warn("KHWindowVisualEffect.init: ccs.load failed"),null):(this._action=n.action,n.node.runAction(n.action),this._eventHandler=a.createInstance("AnimationEventHandlerCcs_2_0").init(this._action),this._onCleanUpEventListeners=[],this)},getChildEffect:function(e){var t=r.helper.seekWidgetByName(this._node,e),n=t.getActionManager().getActionByTag(t.tag,t),i=a.createInstance("WindowVisualEffect");return i._target=t.getParent(),i._node=t,i._action=n,i._eventHandler=a.createInstance("AnimationEventHandlerCcs_2_0").init(n),i},getNode:function(){return this._node},cleanUp:function(){this.stop(),this._fireOnCleanUpEvent(),this.removeAllOnCleanUpEventListeners(),this._action=null,this._node=null,this._eventHandler.cleanUp(),this._eventHandler=null},play:function(e,t,n){if(null!=e){null==t&&(o.console.warn("KHWindowVisualEffect.js: no valid pos passed defaulting to the target node pos"),t=e.getPosition());var i=this._node;i.setPosition(t),i.getParent()!==e&&(i.removeFromParent(),e.addChild(i,null!=n?n:this.DEFAULT_Z_ORDER)),this._action.gotoFrameAndPlay(0,this._loop)}else o.console.warn("KHWindowVisualEffect.js: no valid target passed")},playByName:function(e,t,n,i,o){this._initPlay(t,n,i),this._action.gotoFrameAndPlay(this._action.animationInfo[e].startIndex,this._action.animationInfo[e].endIndex,null==o?this._loop:o)},stop:function(){var e=this._node;null!=e.getParent()&&(e.stopAction(this._action),e.removeFromParent())},pause:function(){this._action.pause()},resume:function(){this._action.resume()},setLoop:function(e){this._loop=e},getTarget:function(){return this._target},changeTexture:function(e,t,n){var i=r.helper.seekWidgetByName(this._node,e);if(i){s.some(["setTexture","loadTexture","setBackGroundImage"],function(e){return!!i[e]&&(i[e](t,n),!0)})}},changeString:function(e,t){var n=r.helper.seekWidgetByName(this._node,e);n&&n.setString(t)},setScale:function(e){this._node.scaleX=e.x,this._node.scaleY=e.y},showLastFrame:function(e,t,n){this._initPlay(e,t,n),this._node.runAction(this._action).gotoFrameAndPause(this._action.getDuration())},showAnimationLastFrame:function(e,t,n,i){this._initPlay(t,n,i),this._node.runAction(this._action).gotoFrameAndPause(this._action.animationInfo[e].endIndex)},setAnimationEndCallback:function(e,t){return this._eventHandler.getPromiseWhenAnimationEnd(this._action.getDuration()).then(e.bind(t))},removeAnimationEndCallback:function(){},setAnimationNameEndCallback:function(e,t,n){var i=this._action.animationInfo[e].endIndex;return this._eventHandler.getPromiseWhenAnimationEnd(i).then(t.bind(n))},removeAnimationNameEndCallback:function(){},_initPlay:function(e,t,n){var i=this._node;i.setPosition(t);var o=null==n?this.DEFAULT_Z_ORDER:n;i.getParent()!==e?(i.removeFromParent(),e.addChild(i,o)):i.setLocalZOrder(o)},hasFrameEvent:function(e){return!(!this._action||!this._action.hasFrameEvent)&&this._action.hasFrameEvent(e)},getPositionConfig:function(){return this._node.seekWidgetByName("position_config")},getRelativeDisplayPosition:function(){var e=this.getPositionConfig();return e?e.getAnchorPoint():this.DEFAULT_RELATIVE_DISPLAY_POSITION},addAnimationEventCallback:function(e,t,n){this._eventHandler.addAnimationEventCallback(e,t,n)},removeAnimationEventCallback:function(e,t){this._eventHandler.removeAnimationEventCallback(e,t)},removeAnimationEventName:function(e){this._eventHandler.removeAnimationEventName(e)},removeAllAnimationEventCallbacks:function(){this._eventHandler.removeAllAnimationEventCallbacks()},addOnCleanUpCallback:function(e,t){var n={callback:e,context:t};return this._onCleanUpEventListeners.push(n),n},removeOnCleanUpEventListener:function(e){s.pull(this._onCleanUpEventListeners,e)},removeAllOnCleanUpEventListeners:function(){this._onCleanUpEventListeners=[]},_fireOnCleanUpEvent:function(){s.each(this._onCleanUpEventListeners,function(e){e.callback.call(e.context,this)},this)}})}((this||0).self||global),function(e){var t=e.cc,r=e.ccs,n=e.kh;e._,n.AnimationEventHandler=n.AnimationEventHandler||{},n.AnimationEventHandler.Abstract=t.Class.extend({className:"KHAnimationEventHandlerAbstract",END_ANIMATION:"endAnimation",init:function(e){return this._eventObject=e,this._createCallbackCollectionObjects(),this._setEventCallbacks(),this._enabled=!0,this},addAnimationEventCallback:function(e,t,n){},getPromiseWhenAnimationEnd:function(e){var t=this.getEventObject(),i=new r.Timeline,n=new r.EventFrame;n.setEvent(this.END_ANIMATION),n.setFrameIndex(e),i.addFrame(n),t.addTimeline(i);var o=Q.defer();return this.addAnimationEventCallback(this.END_ANIMATION,function(e){var t=e.getFrameIndex();if(e.getEvent()===this.END_ANIMATION){var n=e.getTimeline().getActionTimeline()||this.getEventObject();n.getCurrentFrame()<t||(n.removeTimeline(i),o.resolve())}},this),o.promise},getEventObject:function(){return this._eventObject},removeAllAnimationEventCallbacks:function(){},removeAnimationEventCallback:function(e,t){},removeAnimationEventName:function(e){},enableEventListening:function(e){this._enabled=e},cleanUp:function(){this.removeAllAnimationEventCallbacks(),this._cleanUp()},_cleanUp:function(){},_createCallbackCollectionObjects:function(){},_setEventCallbacks:function(){},_addCallbackToCollection:function(e,t,n,i){var o=this[i];o[e]=o[e]||[];var r={callback:t,context:n};o[e].push(r)}})}((this||0).self||global),function(e){var i=(e.cc,e.ccs),t=e.kh,r=e._;t.AnimationEventHandler=t.AnimationEventHandler||{},t.AnimationEventHandler.Abstract=t.AnimationEventHandler.Abstract||{},t.AnimationEventHandler.Ccs_1_6=t.AnimationEventHandler.Abstract.extend({className:"KHAnimationEventHandlerCcs_1_6",addAnimationEventCallback:function(e,t,n){r(i.MovementEventType).has(e)?this._addCallbackToCollection(e,t,n,"_movementEventCallbackCollection"):this._addCallbackToCollection(e,t,n,"_frameEventCallbackCollection")},removeAllAnimationEventCallbacks:function(){this._movementEventCallbackCollection={},this._frameEventCallbackCollection={}},removeAnimationEventCallback:function(i,o){if(void 0===o)return this.removeAnimationEventName(i);var e=function(e){var t=this[e][i],n=t.findIndex(function(e){return e.callback===o});return-1<n?void t.splice(n,1):(console.warn("missing removeAnimationCallback",i,o),void delete this[e][i])}.bind(this);this._movementEventCallbackCollection&&this._movementEventCallbackCollection[i]&&e("_movementEventCallbackCollection"),this._frameEventCallbackCollection&&this._frameEventCallbackCollection[i]&&e("_frameEventCallbackCollection")},removeAnimationEventName:function(e){this._movementEventCallbackCollection&&this._movementEventCallbackCollection[e]&&delete this._movementEventCallbackCollection[e],this._frameEventCallbackCollection&&this._frameEventCallbackCollection[e]&&delete this._frameEventCallbackCollection[e]},_createCallbackCollectionObjects:function(){this._frameEventCallbackCollection={},this._movementEventCallbackCollection={}},_setEventCallbacks:function(){this._setFrameEventCallback(),this._setMovementEventCallback()},_setFrameEventCallback:function(){this.getEventObject().setFrameEventCallFunc(function(t,n,i,o){this._enabled&&this._frameEventCallbackCollection&&(this._frameEventCallbackCollection[n]||[]).forEach(function(e){e.callback.call(e.context,t,n,i,o)})},this)},_setMovementEventCallback:function(){var o=r.invert(i.MovementEventType);this.getEventObject().setMovementEventCallFunc(function(t,n,i){if(this._enabled&&this._movementEventCallbackCollection){var e=o[n];r.isEmpty(this._movementEventCallbackCollection[e])||this._movementEventCallbackCollection[e].forEach(function(e){e.callback.call(e.context,t,n,i)})}},this)},_cleanUp:function(){this.getEventObject().setMovementEventCallFunc(null,null),this.getEventObject().setFrameEventCallFunc(null,null)}})}((this||0).self||global),function(e){var t=(e.cc,e.ccs,e.kh),i=e._;t.AnimationEventHandler=t.AnimationEventHandler||{},t.AnimationEventHandler.Ccs_2_0=t.AnimationEventHandler.Abstract.extend({className:"KHAnimationEventHandlerCcs_2_0",addAnimationEventCallback:function(e,t,n){this._addCallbackToCollection(e,t,n,"_callbackCollection")},removeAllAnimationEventCallbacks:function(){this._callbackCollection={}},removeAnimationEventCallback:function(e,t){if(void 0===t)return this.removeAnimationEventName(e);if(i(this._callbackCollection).has(e)){var n=this._callbackCollection[e].findIndex(function(e){return e.callback===t});if(-1!==n)return void this._callbackCollection[e].splice(n,1);console.warn("missing removeAnimationCallback",e,t),this.removeAnimationEventName(e)}},removeAnimationEventName:function(e){this._callbackCollection[e]&&delete this._callbackCollection[e]},_createCallbackCollectionObjects:function(){this._callbackCollection={}},_setEventCallbacks:function(){this._setCallback()},_setCallback:function(){this.getEventObject().setFrameEventCallFunc(function(t){if(this._enabled){var e=this._getCurrentFrameIndex();if(!(-1<e&&e<t.getFrameIndex())){var n=t.getEvent();(this._callbackCollection[n]||[]).forEach(function(e){e.callback.call(e.context,t)})}}}.bind(this))},_getCurrentFrameIndex:function(){var e=-1,t=this.getEventObject();return t&&t.getCurrentFrame&&(e=t.getCurrentFrame()),t&&t.getCurrentFrameIndex&&(e=t.getCurrentFrameIndex()),e},_cleanUp:function(){this.getEventObject().setFrameEventCallFunc(null,null)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;e.console,t.AnimationEvents=t.AnimationEvents||{},t.AnimationEvents.FRAME_EVENT_NAMES={},t.AnimationEvents.Abstract=n.Class.extend({className:"KHAnimationEvents_Abstract",ctor:function(e){this._callbackList=[],this._eventObject=e},_fireEvent:function(){var t=[].slice.call(arguments);i.each(this._callbackList,function(e){e.callback.apply(e.context,t)})},_registerEvent:function(e){this._eventObject.addAnimationEventCallback(e,this._fireEvent,this)},_unregisterEvent:function(e){this._eventObject.removeAnimationEventCallback(e,this._fireEvent)},_addCallback:function(e,t){this._callbackList.push({callback:e,context:t})},_removeCallback:function(t){i.remove(this._callbackList,function(e){return t===e.callback})}})}((this||0).self||global),function(e){var t=e.kh;e._,t.AnimationEvents.SoundEventAbstract=t.AnimationEvents.Abstract.extend({className:"KHAnimationEvents_SoundEventAbstract",ctor:function(e){this._playing=[],this._soundPlayer=t.createInstance("soundPlayer"),this._dampener=1,this._loop=!1,this._isVoice=!1,this._super(e),this._registerSoundStartEvent(),this._registerSoundEndEvent()},setOptions:function(e){this._loop=null==e.loop?this._loop:e.loop,this._dampener=null==e.dampener?this._dampener:e.dampener,this._isVoice=null==e.isVoice?this._isVoice:e.isVoice,this._removeAfterPlay=null==e.removeAfterPlay?this._removeAfterPlay:e.removeAfterPlay},setLoop:function(e){this._loop=e},setDampener:function(e){this._dampener=e},setPlayAsVoice:function(){this._isVoice=!0},setPlayAsEffect:function(){this._isVoice=!1},setRemoveAfterPlay:function(){this._removeAfterPlay=!0}})}((this||0).self||global),function(e){var r=e.kh,n=e._;r.AnimationEvents=r.AnimationEvents||{},r.AnimationEvents.FRAME_EVENT_NAMES=n.assign(r.AnimationEvents.FRAME_EVENT_NAMES||{},{SOUND_START_CCS_16:"sound1_s",SOUND_END_CCS_16:"sound1_e"}),r.AnimationEvents.Sound1Event=r.AnimationEvents.SoundEventAbstract.extend({className:"KHAnimationEvents_Sound1Event",ctor:function(e){this._soundEffectList=[],this._super(e)},addSoundEffect:function(e){this._soundEffectList.push(e)},removeSoundEffect:function(t){n.remove(this._soundEffectList,function(e){return t===e})},unregisterEvent:function(){this._unregisterEvent(r.AnimationEvents.FRAME_EVENT_NAMES.SOUND_START_CCS_16),this._unregisterEvent(r.AnimationEvents.FRAME_EVENT_NAMES.SOUND_END_CCS_16)},_onSoundStartEvent:function(e,t,n,i){if(t===r.AnimationEvents.FRAME_EVENT_NAMES.SOUND_START_CCS_16&&0!==this._soundEffectList.length){var o=this._soundEffectList.shift();this._isVoice&&this._soundPlayer.playVoice(o,this._dampener||r.GameConfig.BATTLE_SETTINGS.SOUND_SCALE.CCS16EVENT),this._soundPlayer.playSoundEffect(o,this._loop,this._dampener||r.GameConfig.BATTLE_SETTINGS.SOUND_SCALE.CCS16EVENT),this._playing.push(o),this._removeAfterPlay||this._soundEffectList.push(o)}},_onSoundEndEvent:function(e,t,n,i){t===r.AnimationEvents.FRAME_EVENT_NAMES.SOUND_END_CCS_16&&0!==this._playing.length&&(this._isVoice&&this._soundPlayer.stopVoice(this._playing.shift()),this._soundPlayer.stopSoundEffect(this._playing.shift()))},_registerSoundStartEvent:function(){this._addCallback(this._onSoundStartEvent,this),this._registerEvent(r.AnimationEvents.FRAME_EVENT_NAMES.SOUND_START_CCS_16)},_registerSoundEndEvent:function(){this._addCallback(this._onSoundEndEvent,this),this._registerEvent(r.AnimationEvents.FRAME_EVENT_NAMES.SOUND_END_CCS_16)}})}((this||0).self||global),function(e){var r=e.kh,t=e._,a=e.console;r.AnimationEvents=r.AnimationEvents||{},r.AnimationEvents.FRAME_EVENT_NAMES=t.assign(r.AnimationEvents.FRAME_EVENT_NAMES||{},{SOUND_START_CCS_21:"sound2_s",SOUND_END_CCS_21:"sound2_e"}),r.AnimationEvents.Sound2Event=r.AnimationEvents.SoundEventAbstract.extend({className:"KHAnimationEvents_Sound2Event",_startEventName:"",_endEventName:"",ctor:function(e,t,n){this._startEventName=t||r.AnimationEvents.FRAME_EVENT_NAMES.SOUND_START_CCS_21,this._endEventName=n||r.AnimationEvents.FRAME_EVENT_NAMES.SOUND_END_CCS_21,this._super(e)},unregisterEvent:function(){this._unregisterEvent(this._startEventName),this._unregisterEvent(this._endEventName)},_onSoundStartEvent:function(e){if(e.getEvent()===this._startEventName){var t=this._getSoundEffect(e);null!=t&&(this._isVoice&&this._soundPlayer.playVoice(t,this._dampener||r.GameConfig.BATTLE_SETTINGS.SOUND_SCALE.CCS21EVENT),this._soundPlayer.playSoundEffect(t,this._loop,this._dampener||r.GameConfig.BATTLE_SETTINGS.SOUND_SCALE.CCS21EVENT))}},_onSoundEndEvent:function(e){e.getEvent()!==this._endEventName||null!=this._getSoundEffect(e)&&(this._isVoice&&this._soundPlayer.stopVoice(this._playing.shift()),this._soundPlayer.stopSoundEffect(this._playing.shift()))},_getSoundEffect:function(e){var t=e.getNode();if(null==t)return a.warn("KHAnimationEvents.Sound2Event._getSoundEffect: CocosStudio2.1 audio effect not properly loaded."),null;if(t.disposed)return null;var n=t.getComponent("Audio");if(null!=n)return n.getFile();var i=r.createInstance("logger"),o=new Error("Audio component not found in node:"+t.getFullPath());return i.reportJsException(o),a.warn("★★★効果音ファイル不正★★★"),a.debug(o.message,o.stack),null},_registerSoundStartEvent:function(){this._addCallback(this._onSoundStartEvent,this),this._registerEvent(this._startEventName)},_registerSoundEndEvent:function(){this._addCallback(this._onSoundEndEvent,this),this._registerEvent(this._endEventName)}})}((this||0).self||global),function(e){var r=e.kh;r.AnimationEvents.Sound2EventCustom=r.AnimationEvents.Sound2Event.extend({ctor:function(e,t,n,i){var o=[];Array.prototype.push.apply(o,arguments),_.isObject(o[o.length-1])&&(this._customOption=o.pop()),this._super.apply(this,o)},_getSoundEffect:function(e){if(!this._customOption)return this._super(e);var t=e.getEvent();if(this._customOption[t])return this._customOption[t];var n=e.getNode(),i=r.createInstance("logger"),o=new Error("Audio component not found in node:"+n.getFullPath());return i.reportJsException(o),console.warn("★★★効果音ファイル不正★★★"),console.debug(o.message,o.stack),null}})}((this||0).self||global);var __read=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,o,r=n.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(i=r.next()).done;)a.push(i.value)}catch(e){o={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return a},__spread=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(__read(arguments[t]));return e},AnimationEvents,QuestListRouter;kh.createNameSpaceIfNotExists("AnimationEvents"),function(e){var r="animation_end",t=(n.prototype.listen=function(){var n=this;return new Promise(function(e,t){return n.listeners=__spread([function(){return e()}],n.listeners)})},n);function n(e){var t=this,n=e.getEventObject(),i=new ccs.Timeline,o=new ccs.EventFrame;o.setEvent(r),o.setFrameIndex(n.getDuration()),i.addFrame(o),n.addTimeline(i),this.listeners=[],e.addAnimationEventCallback(r,function(){t.listeners.forEach(function(e){return e()}),t.listeners=[]},this)}e.AnimationEndEvent=t}(AnimationEvents||(AnimationEvents={})),kh.AnimationEvents.AnimationEndEvent=AnimationEvents.AnimationEndEvent,function(e){var t=e.kh||{};t.router=t.router||{},t.router.routes=t.router.routes||{},t.router.routes.battle={battle:"BattleScene","battle/:id":"BattleScene","battle/transition":"BattleScene","battle/transition/:id":"BattleScene"}}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.router=n.router||{},n.router.routes=n.router.routes||{},t.merge(n.router.routes,{acce:{acce:"acce_002_003_005","acce/acce_002":"acce_002_003_005","acce/acce_003":"acce_002_003_005","acce/acce_005":"acce_002_003_005","acce/acce_007":"acce_007_008","acce/acce_008":"acce_007_008","acce/acce_010":"acce_010","acce/detail/de_001":"de_001_002","acce/detail/de_003":"de_003","acce/detail/de_004":"de_004"}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.router=n.router||{},n.router.routes=n.router.routes||{},t.merge(n.router.routes,{book:{book:"book_001","book/book_001":"book_001","book/book_001_character":"book_001","book/book_001_weapon":"book_001","book/book_001_summon":"book_001","book/book_001_accessory":"book_001","book/detail/de_001":"de_001_002","book/detail/de_003":"de_003","book/detail/de_004":"de_004"}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.router=n.router||{},n.router.routes=n.router.routes||{},t.merge(n.router.routes,{party:{party:"par_001_002_003","party/par_001":"par_001_002_003","party/par_002":"par_001_002_003","party/par_003":"par_001_002_003","party/par_004":"par_004","party/par_005":"par_005","party/par_006":"par_006_007","party/par_006_a":"par_006_007","party/par_006_b":"par_006_007","party/par_006_c":"par_006_007","party/par_006_s":"par_006_007","party/par_007":"par_006_007","party/par_007_a":"par_006_007","party/par_007_b":"par_006_007","party/par_007_c":"par_006_007","party/par_007_s":"par_006_007","party/par_008":"par_008","party/par_009":"par_009","party/par_013":"par_013","party/par_015":"par_015","party/par_energy_release":"par_energy_release","party/par_pick_member_acce":"par_pick_member_acce"}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.router=n.router||{},n.router.routes=n.router.routes||{},t.merge(n.router.routes,{mypage:{mypage:"my_001","mypage/my_001":"my_001"}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.router=n.router||{},n.router.routes=n.router.routes||{},t.merge(n.router.routes,{enh_evo:{enh_evo:"enh_001_002_006_evo_001_002_003","enh_evo/enh_001":"enh_001_002_006_evo_001_002_003","enh_evo/enh_002":"enh_001_002_006_evo_001_002_003","enh_evo/enh_006":"enh_001_002_006_evo_001_002_003","enh_evo/enh_007":"enh_007","enh_evo/enh_008":"enh_008","enh_evo/enh_009":"enh_009","enh_evo/enh_013":"enh_013","enh_evo/enh_014":"enh_014","enh_evo/enh_015":"enh_015","enh_evo/evo_001":"enh_001_002_006_evo_001_002_003","enh_evo/evo_002":"enh_001_002_006_evo_001_002_003","enh_evo/evo_003":"enh_001_002_006_evo_001_002_003","enh_evo/evo_007":"evo_007","enh_evo/evo_008":"evo_008","enh_evo/evo_009":"evo_009","enh_evo/evo_010":"evo_010","enh_evo/evo_012":"evo_012","enh_evo/evo_013":"evo_013","enh_evo/evo_014":"evo_014","enh_evo/arousal_001":"enh_001_002_006_evo_001_002_003","enh_evo/arousal_002":"arousal_002","enh_evo/arousal_003":"arousal_003","enh_evo/detail/de_001":"de_001_002","enh_evo/detail/de_003":"de_003","enh_evo/detail/de_004":"de_004"}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.router=n.router||{},n.router.routes=n.router.routes||{},t.merge(n.router.routes,{quest:{quest:"q_001","quest/q_portal_top":"q_portal_top","quest/q_special_top":"q_special_top","quest/q_001":"q_001","quest/q_002":"q_002","quest/q_003_1":"q_003_001","quest/q_003_2":"q_003_002","quest/q_004":"q_004","quest/q_005":"q_005","quest/q_006":"q_006_007_008","quest/q_007":"q_006_007_008","quest/q_008":"q_006_007_008","quest/q_009":"q_009","quest/q_010":"q_010","quest/q_011":"q_011"}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.router=n.router||{},n.router.routes=n.router.routes||{},t.merge(n.router.routes,{epi:{epi:"epi_001","epi/epi_001":"epi_001","epi/epi_001_a":"epi_001","epi/epi_001_b":"epi_001","epi/epi_001_c":"epi_001","epi/epi_002":"epi_002","epi/epi_003":"epi_003","epi/epi_004":"epi_004"}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.router=n.router||{},n.router.routes=n.router.routes||{},t.merge(n.router.routes,{gacha:{gacha:"ga_000","gacha/ga_000":"ga_000","gacha/ga_001":"ga_000","gacha/ga_002":"ga_100","gacha/ga_003":"ga_100","gacha/ga_004":"ga_100","gacha/ga_100":"ga_100","gacha/ga_010":"ga_010","gacha/ga_contents_list":"ga_contents_list","gacha/ga_ani":"ga_ani"}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.router=n.router||{},n.router.routes=n.router.routes||{},t.merge(n.router.routes,{shop:{shop:"sh_001","shop/sh_001":"sh_001","shop/sh_002":"sh_002","shop/sh_003":"sh_003","shop/sh_004":"sh_004","shop/sh_005":"sh_005","shop/sh_006":"sh_006","shop/sh_007":"sh_007","shop/sh_008":"sh_008","shop/sh_009":"sh_009","shop/sh_010":"sh_010","shop/sh_011":"sh_011","shop/sh_101":"sh_101","shop/sh_102":"sh_102"}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.router=n.router||{},n.router.routes=n.router.routes||{},t.merge(n.router.routes,{present:{present:"prs_001_002_003","present/prs_001_2_3":"prs_001_002_003","present/prs_001":"prs_001_002_003","present/prs_002":"prs_001_002_003","present/prs_003":"prs_001_002_003"}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.router=n.router||{},n.router.routes=n.router.routes||{},t.merge(n.router.routes,{guild:{guild:"gud_001","guild/gud_000":"gud_000_a","guild/gud_000_a":"gud_000_a","guild/gud_000_b":"gud_000_b","guild/gud_000_c":"gud_000_c","guild/gud_001":"gud_001","guild/gud_001_a":"gud_001","guild/gud_001_b":"gud_001","guild/gud_001_c":"gud_001","guild/gud_001_d":"gud_001","guild/gud_002":"gud_002","guild/gud_003":"gud_003","guild/gud_005":"gud_005","guild/gud_006":"gud_006","guild/gud_007_a":"gud_007_leader","guild/gud_007_b":"gud_007_not_leader","guild/gud_008":"gud_008","guild/gud_009":"gud_009","guild/gud_010":"gud_010_011_012","guild/gud_011":"gud_010_011_012","guild/gud_012":"gud_010_011_012","guild/gud_013_a":"gud_013_a","guild/gud_013_b":"gud_013_b"}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.router=n.router||{},n.router.routes=n.router.routes||{},t.merge(n.router.routes,{detail:{detail:"de_001_002","detail/de_001":"de_001_002","detail/de_002":"de_001_002","detail/de_001_002":"de_001_002","detail/de_003":"de_003","detail/de_004":"de_004"}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.router=n.router||{},n.router.routes=n.router.routes||{},t.merge(n.router.routes,{mission:{mission:"mission_001","mission/mission_001":"mission_001","mission/mission_001_a":"mission_001","mission/mission_001_b":"mission_001","mission/mission_001_c":"mission_001"}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.router=n.router||{},n.router.routes=n.router.routes||{};t.merge(n.router.routes,{tu_04_sound:{tu_04_sound:"tu_04_sound","tu_04_sound/tu_04_sound":"tu_04_sound"}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.router=n.router||{},n.router.routes=n.router.routes||{};t.merge(n.router.routes,{tu_06_sound:{tu_06_sound:"tu_06_sound","tu_06_sound/tu_06_sound":"tu_06_sound"}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.router=n.router||{},n.router.routes=n.router.routes||{};t.merge(n.router.routes,{tu_scenario:{tu_scenario:"episodeScenario","tu_scenario/tu_scenario":"episodeScenario"}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.router=n.router||{},n.router.routes=n.router.routes||{},t.merge(n.router.routes,{poprank:{poprank:"poprank_000","poprank/poprank_000":"poprank_000","poprank/poprank_001":"poprank_001","poprank/poprank_002":"poprank_002","poprank/poprank_003":"poprank_003","poprank/poprank_004":"poprank_004","poprank/poprank_005":"poprank_005"}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.router=n.router||{},n.router.routes=n.router.routes||{},t.merge(n.router.routes,{hlbattle:{hlbattle:"hlbattle_001","hlbattle/hlbattle_001":"hlbattle_001"}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.router=n.router||{},n.router.routes=n.router.routes||{},t.merge(n.router.routes,{event:{event:"ev_000","event/ev_000":"ev_000"}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.router=n.router||{},n.router.routes=n.router.routes||{},t.merge(n.router.routes,{status:{"status/status_001":"status_001","status/status_002":"status_002","status/status_003":"status_003"}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.router=n.router||{},n.router.routes=n.router.routes||{};t.merge(n.router.routes,{tu_09_battle:{tu_09_battle:"BattleScene","tu_09_battle/tu_09_battle":"BattleScene"}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.router=n.router||{},n.router.routes=n.router.routes||{};t.merge(n.router.routes,{tu_11_battle:{tu_11_battle:"BattleScene","tu_11_battle/tu_11_battle":"BattleScene"}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.router=n.router||{},n.router.routes=n.router.routes||{};t.merge(n.router.routes,{tu_24_battle:{tu_24_battle:"BattleScene","tu_24_battle/tu_24_battle":"BattleScene"}})}((this||0).self||global),function(e){var i=e.kh;e.ccui,i.UnionRouter=i.UnionRouter||{},i.UnionRouter=cc.Class.extend({navigateToTopScene:function(e){if(null!=e&&""!==e){var t=this._getNavigateFrom(e);if("me"===e){var n={};i.createInstance("apiAUnions").getMe().then(function(e){n=e.body||{}}.bind(this)).fail(function(e){console.warn(e.stack)}).then(function(){i.createInstance("router").navigate(null!=n.a_union_id?"guild/gud_001":"guild/gud_000",{},t)})}else i.createInstance("router").navigate("guild/gud_001_b",{},t)}else console.warn("illegal argument: a_union_id")},_getNavigateFrom:function(e){var t=i.createInstance("routerParams").getCurrentScene(),n=t.tabDelegateList[0];return _.isEmpty(n)||_.isUndefined(n.selected)||(t.temporaryRouterParams.restoreParams={tabs:[n.selected]}),{id:e,routes:i.createInstance("router").getCurrentFragment(),temporaryRouterParams:t.temporaryRouterParams}}})}((this||0).self||global),kh.createNameSpaceIfNotExists("QuestListRouter"),function(e){var i={"quest/q_material_top":{route:"quest/q_special_top",category:"material"},"quest/q_accessories_top":{route:"quest/q_special_top",category:"accessory"},"quest/q_element_type_top":{route:"quest/q_special_top",category:"elemental"}},t=(n.prototype.route=function(e){var t=i[e],n={};null!=t.category&&(n={q_special_top:{category:t.category}}),kh.createInstance("router").navigate(t.route,n)},n);function n(){}e.QuestListRouter=t}(QuestListRouter||(QuestListRouter={})),kh.QuestListRouter.QuestListRouter=QuestListRouter.QuestListRouter;var __extends=this&&this.__extends||function(){var i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};return function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}(),KHRouter;!function(e){var t=(n.prototype.getComponentName=function(){var e=this.getFragment();return e.substring(0,e.indexOf("/"))},n.prototype.getSceneName=function(){var e=this.getFragment();return e.substring(e.indexOf("/")+1)},n.prototype.toURIHash=function(){return this.getFragment()},n.prototype.getDIName=function(){var e=kh.router.routes[this.getComponentName()];return e[this.getFragment()]||e[this.getComponentName()]},n.makeFromHistory=function(e){throw new Error("Please Implement makeFromHistory")},n.prototype.getRouterParams=function(){throw new Error("Unexpected Called")},n.prototype.getTemporaryRouterParams=function(){throw new Error("Unexpected Called")},n.prototype.removeCurrentTemporaryParamsFromHistory=function(){throw new Error("Unexpected Called")},n.prototype.permanentlyRemoveRouterParam=function(e){throw new Error("Unexpected Called")},n.prototype.permanentlyRemoveRouterParamByPath=function(e,t){throw new Error("Unexpected Called")},n.prototype.setRestoreParams=function(e){throw new Error("Unexpected Called")},n.prototype.getRestoreParams=function(){throw new Error("Unexpected Called")},n.prototype.dispatchNavigateEvent=function(){kh.createInstance("notificationCenter").dispatchEvent("navigate",[this.getFragment(),{}])},n.prototype.navigate=function(){kh.createInstance("router").navigate(this)},n);function n(){}e.SceneNavigate=t;var i,o=(__extends(r,i=t),r.prototype.canHistory=function(){return!0},r.prototype.getFragment=function(){return"mypage/my_001"},r.prototype.getRealComponentName=function(){return"game"},r.makeFromHistory=function(){return new this},r);function r(){var e=null!==i&&i.apply(this,arguments)||this;return e._sceneClassName="MyPageRedirect",e}e.MyPageRedirect=o;var a,s=(__extends(c,a=t),c.prototype.getFragment=function(){return this._fragment},c.prototype.getRouterParams=function(){return this._routerParams},c.prototype.getTemporaryRouterParams=function(){return this._temporaryRouterParams},c.prototype.setRestoreParams=function(e){this._restoreParams=Object.assign({},this._restoreParams,e),0===Object.keys(this._restoreParams).length&&(this._restoreParams=null)},c.prototype.getRestoreParams=function(){return this._restoreParams},c.prototype.canHistory=function(){return this._canHistory},c.makeFromHistory=function(e){return new this(e)},c.prototype.dispatchNavigateEvent=function(){kh.createInstance("notificationCenter").dispatchEvent("navigate",[this.getFragment(),this.getRouterParams()])},c.prototype.removeCurrentTemporaryParamsFromHistory=function(){var t=this;Object.keys(this._temporaryRouterParams).forEach(function(e){delete t._temporaryRouterParams[e]})},c.prototype.permanentlyRemoveRouterParam=function(e){e&&delete this._routerParams[e]},c.prototype.permanentlyRemoveRouterParamByPath=function(e,t){if(e)return!0!==t?void this._unset(this._routerParams,e):void this._unset(this._temporaryRouterParams,e)},c.prototype._unset=function(e,t){for(var n,i=t.split("."),o=i.pop()||"";n=i.shift();)if(void 0===(e=e[n]))return;void 0!==e[o]&&delete e[o]},c);function c(e,t,n,i){var o=a.call(this)||this;if(history.state&&history.state._routerParams){var r=Object.assign({},history.state._routerParams);t=Object.assign(r,t)}return o._restoreParams=null,o._sceneClassName="LegacyNavigate",o._routerParams=t||{},o._temporaryRouterParams=n||{},o._canHistory="boolean"==typeof i&&i,o._fragment="",e&&"string"!=typeof e?Object.assign(o,e):o._fragment=e,o}e.LegacyNavigate=s}(KHRouter||(KHRouter={})),Object.assign(kh.router=kh.router||{},KHRouter);var __read=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,o,r=n.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(i=r.next()).done;)a.push(i.value)}catch(e){o={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return a},__spread=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(__read(arguments[t]));return e},KHRouter;!function(i){var a="lastNavigate",r=["gacha/ga_ani","enh_evo/enh_007","enh_evo/enh_008","enh_evo/enh_009","enh_evo/enh_013","enh_evo/enh_014","enh_evo/enh_015","enh_evo/evo_007","enh_evo/evo_008","enh_evo/evo_009","enh_evo/evo_010","enh_evo/evo_012","enh_evo/evo_013","enh_evo/evo_014","enh_evo/arousal_002","enh_evo/arousal_003","tu_scenario/tu_scenario","scenario/scenario-play","scenario/harem-play","scenario/episode-play","quest/q_002","quest/q_009"],e=(t.prototype.setCurrentComponent=function(e,t){var n=this,i=this._createNavigate(e,t),o=this._currentComponent;Object.keys(kh.dictx.navigateInject).forEach(function(e){e!==o&&("battle"===e||-1<e.indexOf("_battle")||n.injectByComponent(e))}),this.injectByComponent(o),this._routing(i),window.addEventListener("popstate",function(e){return!e.state||"string"!=typeof e.state._sceneClassName||(e.preventDefault(),n._routing(kh.router[e.state._sceneClassName].makeFromHistory(e.state)),!1)})},t.prototype._createNavigate=function(e,t){if(cc.sys.isNative||!t||0<t.indexOf("session="))return this._currentComponent=e,this._currentScene=this._getStartSceneName(e),new kh.router.LegacyNavigate(this._currentComponent+"/"+this._currentScene);this._currentComponent=t.substring(2,t.indexOf("/"));var n={},i=t.indexOf("?option=");if(0<=i?(this._currentScene=t.substring(t.indexOf("/")+1,i),n=JSON.parse(decodeURIComponent(t.substring(i+8)))):this._currentScene=t.substring(t.indexOf("/")+1),"tutorial"===e)return new kh.router.TutorialNavigate(this._currentComponent+"/"+this._currentScene);if(!window.sessionStorage||0<=i)return new kh.router.LegacyNavigate(this._currentComponent+"/"+this._currentScene,n,n);var o=window.sessionStorage.getItem(a);if(!o||o.length<3)return new kh.router.LegacyNavigate(this._currentComponent+"/"+this._currentScene);var r=JSON.parse(o);return r._fragment!==this._currentComponent+"/"+this._currentScene?new kh.router.LegacyNavigate(this._currentComponent+"/"+this._currentScene):kh.router[r._sceneClassName].makeFromHistory(r)},t.prototype.injectByComponent=function(e){var t=kh.dictx.navigateInject[e];t&&t()},t.prototype.navigate=function(e,t,n,i){var o;if(void 0===t&&(t={}),void 0===n&&(n={}),void 0===i&&(i=!0),"object"==typeof e&&e instanceof kh.router.SceneNavigate)o=e;else{if("string"!=typeof e)throw kh.createInstance("smartBeat").log(e),kh.createInstance("smartBeat").log(JSON.stringify(t)),kh.createInstance("smartBeat").log(JSON.stringify(n)),"Invalid Fragment";i=i&&-1===r.indexOf(e),(o=new kh.router.LegacyNavigate(this._toFullFragment(e),t,n,i))&&"party"===o.getComponentName()&&(o=kh.router.PartyNavigate.makeFromLegacyNavigate(o))}return this._saveRestoreParams(),o.canHistory()&&!0===i&&(history.pushState(o,"","#!"+o.toURIHash()),!cc.sys.isNative&&window.sessionStorage&&window.sessionStorage.setItem(a,JSON.stringify(o))),void this._routing(o)},t.prototype.navigateAndPreventHistoryBack=function(e,t,n){void 0===t&&(t={}),void 0===n&&(n={}),this.navigate(e,t,n,!1)},t.prototype._routing=function(e){var n=this,t=kh.createInstance("smartBeat");t.log(JSON.stringify(e));var i=kh.router.routes[e.getComponentName()];if(!i)throw"Error: Undefined Scene Fragment:"+e.getFragment();if(cc.sys.isNative||"function"!=typeof e.getRealComponentName||-1!==location.href.indexOf("/"+e.getRealComponentName()+"/")){var o=this._currentComponent;window.requestAnimationFrame(function(){ResourceRepository.addRecentlyUsedCount();var t=n._createPurgeRule(e,o);cc.loader.purge(t),n._purgeEventListeners.forEach(function(e){return e(t)})});var r=i[e.getFragment()];if(kh.dictx.has(r))return e.dispatchNavigateEvent(),this._currentComponent=e.getComponentName(),this._currentScene=e.getSceneName(),t.registBreadcrumb(this._currentScene),kh.dictx.injectDependent(kh.di.singletonDependencyList,kh.di.protoStrategyDependencyList),this.injectByComponent(this._currentComponent),void kh.createInstance("sceneManager").changeScene(e);throw"Error: Undefined Scene Fragment:"+e.getFragment()}this._redirect(e)},t.prototype._createPurgeRule=function(e,t){return"mypage"===e.getComponentName()?PurgeRule.makeToMypage():e.getComponentName()!=t?PurgeRule.makeComponentChange():PurgeRule.makeSceneChange()},t.prototype._redirect=function(e){kh.postMessage("deployLoading"),e.dispatchNavigateEvent(),location.href="../"+e.getRealComponentName()+"/app.html#!"+e.toURIHash()},t.prototype.back=function(){history.back()},t.prototype.getCurrentComponent=function(){return this._currentComponent},t.prototype.getCurrentSceneName=function(){return this._currentScene},t.prototype._toFullFragment=function(e){var t=e;return-1===e.indexOf("/")&&(t=e+"/"+this._getStartSceneName(e)),t},t.prototype._getStartSceneName=function(e){var t=this._searchTopFragment(e),n=t.indexOf("/");return t.substring(n+1)},t.prototype._searchTopFragment=function(o){var e=kh.router.routes[o],r=e[o],t=Object.entries(e).find(function(e){var t=__read(e,2),n=t[0],i=t[1];return n!=o&&i===r}),n=__read(t,1)[0];return"string"==typeof n?n:o},t.prototype.getCurrentFragment=function(){return[this._currentComponent,this._currentScene].join("/")},t.prototype.getRawCurrentComponent=function(){return this._currentComponent},t.prototype.removeCurrentTemporaryParamsFromHistory=function(){this._historyReplace(function(e){return e instanceof kh.router.LegacyNavigate&&e.removeCurrentTemporaryParamsFromHistory(),e})},t.prototype.permanentlyRemoveRouterParam=function(t){this._historyReplace(function(e){return e instanceof kh.router.LegacyNavigate&&e.permanentlyRemoveRouterParam(t),e})},t.prototype.permanentlyRemoveRouterParamByPath=function(t,n){this._historyReplace(function(e){return e instanceof kh.router.LegacyNavigate&&e.permanentlyRemoveRouterParamByPath(t,n),e})},t.prototype.historyReplace=function(t,n,i){void 0===n&&(n={}),void 0===i&&(i={}),this._historyReplace(function(e){return new kh.router.LegacyNavigate(t,n,i)})},t.prototype._historyReplace=function(e){if(history.state&&history.state instanceof i.SceneNavigate){var t=history.state,n=e.call(this,t);history.replaceState(n,"","#!"+n.toURIHash())}},t.prototype.isIgnoredImplicitRoute=function(e){return!!e&&!0===e.ignoreImplicitRoute},t.prototype.registerPurgeOnSceneChange=function(e){this._purgeEventListeners=__spread([e],this._purgeEventListeners)},t.prototype._saveRestoreParams=function(){var e=cc.director.getRunningScene();if(e&&e.getRestoreParams&&history.state instanceof kh.router.LegacyNavigate){var t=e.getRestoreParams();0!==Object.keys(t).length&&this._historyReplace(function(e){return e instanceof kh.router.LegacyNavigate&&e.setRestoreParams(t),e})}},t);function t(){this.className="KHRouter",this._currentComponent="",this._currentScene="",this._purgeEventListeners=[]}i.Router=e}(KHRouter||(KHRouter={})),kh.Router=KHRouter.Router,function(e){var c=e.cc,u=e.kh;u.SceneManager=c.Class.extend({className:"KHSceneManager",_currentSceneName:"",reloadScene:function(){var n=c.director.getScheduler();n.unscheduleAll(),n.scheduleCallbackForTarget(this,function(){c.eventManager.removeAllListeners(),u.addConnectionEventListeners();var e=new c.ActionManager;c.director.setActionManager(e),n.scheduleUpdate(e,c.Scheduler.PRIORITY_SYSTEM,!1);var t=c.director.getRunningScene();c.director.runScene(t.renew())},0,0,0,!1),this._clearTextureCacheOnLoadCallbacks()},changeScene:function(e){var o=this,r=e,a=c.director.getRunningScene();if(a){var t=a.seekWidgetByName("contentLayer");t&&t.setVisible(!1)}var s=c.director.getScheduler();s.unscheduleAll(),s.scheduleCallbackForTarget(o,function(){c.eventManager.removeAllListeners(),u.addConnectionEventListeners(),o._currentSceneName=r.getSceneName();var e=r.getDIName(),t=u.createInstance(e,[r]),n=new c.ActionManager;c.director.setActionManager(n),s.scheduleUpdate(n,c.Scheduler.PRIORITY_SYSTEM,!1);var i=a.seekWidgetByName("contentLayer");i&&i.setVisible(!0),c.director.runScene(t)},0,0,0,!1),this._clearTextureCacheOnLoadCallbacks(),c.director.startAnimation(),c.director.resume()},getCurrentSceneName:function(){return this._currentSceneName},_clearTextureCacheOnLoadCallbacks:function(){_.each(c.textureCache._textures,function(e){null!=e._listeners&&null!=e._listeners.load&&(e._listeners.load=[])})}})}((this||0).self||global),function(o){var r=o.kh,e=o.cc,a=o._;r.ListManager=e.Class.extend({resource:null,ctor:function(e,t,n){var i=o.res;t&&(this.resource=ccs.load($dynamicRes(i[t])),null==this.resource.node&&console.error("resource.node is undefined: ",t)),this.listNodes=e,this.addedWidgetList=[],this.recordWidgetInitializeFunc=n},clear:function(t){a.each(this.addedWidgetList,function(e){t&&e.parent&&e.parent.setVisible(!1),e.removeFromParent()}),this.addedWidgetList=[],clearTimeout(this.listTimerId)},setRecords:function(e,t){this.clear(t),this._setRecord(e,0)},_setRecord:function(n,i){0===(i=i||0)&&r.createInstance("notificationCenter").dispatchEvent("listUpdate:Start",[a.clone(this.listNodes)]),this.listTimerId=a.delay(function(){var e=n[i];if(a.isUndefined(e))r.createInstance("notificationCenter").dispatchEvent("listUpdate:End",[a.clone(this.listNodes)]);else{var t=new ccui.Widget;this.resource&&t.addChild(this.resource.node.clone()),this.listNodes[i].addChild(t);try{this.recordWidgetInitializeFunc(t,e,i)}catch(e){console.error(e)}this.addedWidgetList.push(t),this._setRecord(n,i+1)}}.bind(this),5)}})}((this||0).self||global),function(a){var d=a.kh,o=a.cc,p=a.ccs,g=a._,l=a.Q,f=a.console;new RegExp("^viewpage"),d.BaseScene=o.Scene.extend({resourceName:"",resource:null,popups:{},popupLayer:null,contentLayer:null,_enableRestore:!0,enableRestore:function(e){this._enableRestore=e},ctor:function(e){this.pause(),this.__pendingTasks={},d.createInstance("smartBeat").init(),this.resourceName=this._getResourceName(this.resourceFileName),this.routerParams={},this.temporaryRouterParams={},this.restoreParams=null,e instanceof d.router.LegacyNavigate&&(this.routerParams=e.getRouterParams(),this.temporaryRouterParams=e.getTemporaryRouterParams(),this.restoreParams=e.getRestoreParams()),this._sceneNavigate=e,this.tabDelegateList=this.tabDelegateList||[],this.tabDelegate&&this.tabDelegateList.push(this.tabDelegate),this.tabDelegate2&&this.tabDelegateList.push(this.tabDelegate2),this._super(),this.tabDelegateList=this._initTabDelegateList(this)},_getResourceName:function(t){if(!t)return"";var e=g.findKey(res,function(e){return 0<e.indexOf(t)});return e||alert("該当するシーンリソースが見つかりませんでした: "+t),e||""},_initTabDelegateList:function(){return(this.tabDelegateConfig||[]).map(function(n,e){var i={},o="";return g.each(n,function(e,t){o=e["container-node"],e["content-node"]=e["content-node"]||e.node+"_node",i[e.node]=this.__tabDelegateCallback.bind(this,n,this.tabCallbackName(e),e,t)}.bind(this)),new d.TabDelegate(i,o)}.bind(this))},tabCallbackName:function(e){return g.camelize(["tab","callback",e.node,e["container-node"]||""].join("_"))},__tabDelegateCallback:function(e,t,n,i){var o=n["container-node"]?this.bfsWidgetByName(n["container-node"]):this;if(o){var r=o.bfsWidgetByName(n["content-node"]);return r?(g.each(e,function(e){var t=o.bfsWidgetByName(e["content-node"]);t&&t.setVisible(!1)}),r.setVisible(!0),void(this._delegate&&g.isFunction(this._delegate[t])&&this._delegate[t].call(this._delegate,this))):void alert("tab."+i+"のcontent-node("+n["content-node"]+")が見つかりません")}alert("tab."+i+"のcontainer-node("+n["container-node"]+")が見つかりません")},onEnter:function(){this._super(),this.pause(),o.director.pause(),o.director.stopAnimation(),this._setSceneDelegate();var e=l.defer();this.initSceneUILoadPromise=e.promise;var t=this._callOnSceneEnter();l.all([t,this._prepare().then(function(){return this.headerDelegate.fetch(this)}.bind(this))]).then(function(){return this._init(),e.resolve(),this.initScenePromise}.bind(this)).then(this._initializeDelegateUI.bind(this)).fail(function(e){e&&f.error(e)}).fin(function(){this.resume(),this.scheduleOnce(this._onEnterCompleted.bind(this)),this.__showLayers(),this.__hideNowLoading(),o.director.resume(),o.director.startAnimation()}.bind(this))},_onEnterCompleted:function(){var e=this.__pendingTasks;delete this.__pendingTasks,g.each(e,function(e){e()}),this._delegate&&this._delegate._delayedTaskDeferred.resolve()},onExit:function(){d.createInstance("notificationCenter").removeEventListenersByEventName("menu_open"),d.createInstance("notificationCenter").removeEventListenersByEventName("menu_close"),o.eventManager.removeListeners(this,!0),this._registeredPulldownMenus=null,this._eachDelegate(function(e){g.isFunction(e.onExit)&&e.onExit()}),this._super(),g.map(this._popupCache,function(e){return null!=e.resource&&null!=e.resource.node&&e.resource.node.cleanup(),g.isFunction(e.cleanup)&&e.cleanup(),e.dismiss()}),g.isArray(this.__references)&&(d.cleanupProperties(this.__references),this.__references=[]);var e="onSceneExit";return this._delegate&&g.isFunction(this._delegate[e])&&(this._delegate[e].call(this._delegate,this),this._delegate=null),void this.getActionManager().removeAllActions()},_init:function(){f.warn("override me!!",this.resource,this.popups)},_callOnSceneEnter:function(){var e="onSceneEnter";return this._delegate&&g.isFunction(this._delegate[e])?this._delegate[e].call(this._delegate,this):l.resolve()},_initializeDelegateUI:function(){return this._enableRestore&&this.restore(this.restoreParams),this._eachDelegate(function(e){return e.initializeUI()})},_initScene:function(i){this.initScenePromise=l.fcall(function(){var e="onSceneInit";return this._delegate&&g.isFunction(this._delegate[e])?this._delegate[e].call(this._delegate,this):l.resolve()}.bind(this)),this.initScenePromise.then(function(){var e="doPageInAnimation";if(this._delegate&&g.isFunction(this._delegate[e]))return this.promisePageInAnimationEnd=this._delegate[e].call(this._delegate,this),Object.values(o.director.getActionManager()._hashTargets).filter(function(e){return"Layer"===e.target._className}).map(function(e){var t=e.target;t.animate("layer_in",!1).then(function(){t.animate("default_view",!0)})}),this.promisePageInAnimationEnd;e="onPageInAnimationEnd";var t=null;if(this._delegate&&g.isFunction(this._delegate[e])&&(t=this._delegate[e].bind(this._delegate,this)),i){var n=l.defer();this.promisePageInAnimationEnd=n.promise,this.scheduleOnce(function(){this.animate(i,!1).then(this.animate.bind(this,"default_view",this.isLoopDefaultView)).then(t).then(n.resolve.bind(n))}.bind(this),.1)}else this.promisePageInAnimationEnd=this.animate("default_view",this.isLoopDefaultView).then(t);return this.promisePageInAnimationEnd}.bind(this)).fail(function(e){a.console.error(e)})},_initButtonEvent:function(e,t,n,i,o){var r={};r["TOUCH_ENDED "+t]=function(){var e=this._delegate&&g.isFunction(this._delegate[n])?l.fcall(this._delegate[n].bind(this._delegate,this)):l.resolve(),t=this._delegate&&this._delegate._override||void 0;e.then(o.bind(this)).fail(function(e){e!==t&&a.console.error(e)})},d.setTouchEventHandlers(e,r,this),"string"==typeof i&&e.seekWidgetByPath(t).setTitleText(i)},_initPulldown:function(e,t,n,i,o,r,a){var s=this.seekWidgetByPath(e),c=s.seekWidgetByPath(t),u=s.seekWidgetByPath(n),l=s.seekWidgetByPath(i),h=(p.load($dynamicRes(res[o]))||{}).node;if(h){var _=new d.Pulldown({button:c,label:u,menuBase:l,choice:h});(function(e){var t,n=r;t=this._delegate&&g.isFunction(this._delegate[n])?this._delegate[n].bind(this._delegate):function(e){f.log("選択された値: "+e.text)},e.onChange(t)}).call(this,_),function(t){var e,n=a;e=this._delegate&&g.isFunction(this._delegate[n])?this._delegate[n].call(this._delegate,this):[{value:1,text:"sample 1"},{value:2,text:"sample 2"},{value:3,text:"sample 3"},{value:4,text:"sample 4"}],g.each(e,function(e){t.addChoice(e)})}.call(this,_)}else alert("選択肢リソースが見つかりません: "+o)},_initMouseOver:function(e,t,n,i){var o={};o["MOUSE_ENTER "+t]=function(){e.seekWidgetByPath(n).animate(i,!0)},o["MOUSE_LEAVE "+t]=function(){e.seekWidgetByPath(n).changeFrame(0)},d.setMouseEventHandlers(e,o,this)},_callApis:function(e){var r=[];g.each(e,function(t,e){var n,i=d.createInstance(t.api),o=t.args||[];n=l.all([i[t.method].apply(i,o),this.initSceneUILoadPromise]).spread(function(e){this.disposed||t.callback.call(this,e.body)}.bind(this)).fail(function(e){f.error(e)}),r.push(n)},this);var t=this;l.all(r).then(function(){t.disposed||t._onCallApisFinished(t)})},_onCallApisFinished:function(){},_eachDelegate:function(t,n){return g.chain([].concat(this.tabDelegateList,this.footerDelegate?[this.footerDelegate]:[],this.headerDelegate?[this.headerDelegate]:[],this.mainMenuDelegate?[this.mainMenuDelegate]:[],this.subMenuDelegate?[this.subMenuDelegate]:[])).map(function(e){return t.call(n,e)})},_setSceneDelegate:function(){if(this.sceneName){var e=g.camelize(this.sceneName)+"Delegate";a.console.debug("[!! scene delegate DI name !!]: ",e),this._delegate=d.dictx.has(e)?d.createInstance(e):null,this._delegate&&(this._delegate._delayedTaskDeferred=l.defer())}},_prepare:function(){this._delegate&&(this.__proto__._popups=this._delegate._popups);var e=a.res;this.contentLayer=new o.Layer,this.addChild(this.contentLayer),this.contentLayer.setName("contentLayer"),this.popupLayer=new o.Layer,this.addChild(this.popupLayer),this.popupLayer.setName("popupLayer"),this.__hideLayers(),this.resourceName&&(this.resource=p.load($dynamicRes(e[this.resourceName])),this.contentLayer.addChild(this.resource.node)),this.footerDelegate=d.FooterDelegateFactory(this),this.headerDelegate=d.HeaderDelegateFactory(this),this.mainMenuDelegate=d.MainMenuDelegateFactory(this),this.subMenuDelegate=d.SubMenuDelegateFactory(this),this._eachDelegate(function(e){e.owner=this},this);var t=[this.__registerEventHandlers,this.__preparePopups];o.sys.platform===o.sys.DESKTOP_BROWSER&&t.push(this.__registerMouseEventHandlers);var n=g.map(t,function(e){return e.bind(this)},this).reduce(l.when,l.resolve());return n.then(function(){var e=this._sceneNavigate;d.createInstance("notificationCenter").dispatchEvent("scene:prepared",[e.getComponentName(),e.getSceneName()])}.bind(this),function(e){f.error(e)}),n},__registerEventHandlers:function(){var t=g.merge({},this.__proto__._events||{},this.__proto__.__proto__._events||{},this.footerDelegate?this.footerDelegate.getEvents():{},this.headerDelegate?this.headerDelegate.getEvents():{},this.mainMenuDelegate?this.mainMenuDelegate.getEvents():{},this.subMenuDelegate?this.subMenuDelegate.getEvents():{});g.each(this.tabDelegateList,function(e){t=g.merge(t,e.getEvents()||{})});var n=d.createInstance("notificationCenter"),i=d.createInstance("router").getCurrentFragment();return g.each(d.EventSettings,function(e){e(n,i,this)},this),d.setTouchEventHandlers(this.contentLayer,t,this)},__registerMouseEventHandlers:function(){var t=g.merge({},this.__proto__._mouseEvents||{},this.__proto__.__proto__._mouseEvents||{},this.footerDelegate?this.footerDelegate.getMouseEvents():{},this.headerDelegate?this.headerDelegate.getMouseEvents():{},this.mainMenuDelegate?this.mainMenuDelegate.getMouseEvents():{},this.subMenuDelegate?this.subMenuDelegate.getMouseEvents():{});return g.each(this.tabDelegateList,function(e){t=g.merge(t,e.getMouseEvents()||{})}),d.setMouseEventHandlers(this.contentLayer,t,this)},__preparePopups:function(){var e=g.merge({},this.__proto__._popups,this.__proto__.__proto__._popups);return this.popups={},this._popupCache={},Object.defineProperties(this.popups,g.transform(e,function(e,t,n){e[n]={enumerable:!0,get:function(e,t){if(!this._popupCache[t]){var n=[this],i=d.createInstance(e.factoryName).create(e,n);this._popupCache[t]=i}return this._popupCache[t]}.bind(this,t,n)}}.bind(this))),l.resolve()},navigate:function(e,t){d.createInstance("router").navigate(e,t)},_openMessagePopup:function(e){var t=e,n=t.factory||"popupFactoryTextOnly",i=d.createInstance(n),o=t.buttons||[["blackBtn","閉じる"]],r={},a={},s=l.defer();o.forEach(function(e){var t,n=e[2]||!1,i=e[0];t=function(){this.dismiss(),n?s.resolve(i):s.reject(i)},r[i]=e[1],a[i]=t});var c={title:e.title,buttonLabels:r,buttons:a},u=i.create(c);return u.open().then(function(){u.setContent(e.content)}.bind(this)),s.promise},_preparePulldown:function(e){var t=e.baseWidget||this,n=g.cloneDeep(d.WordBook[e.wbMenuItemsName]),i=e.selected;g.isUndefined(i)||(f.log(i),g.each(n,function(e){e.value===i?e.selected=!0:delete e.selected},this));var o,r,a=t.seekWidgetByName(e.widgetSelectorBody);if(o=g.isUndefined(e.widgetSelectedLabel)?a.children[0]:t.seekWidgetByName(e.widgetSelectedLabel),g.isUndefined(e.widgetPulldownPlaceholder))r=t.seekWidgetByName(e.widgetPulldownListView);else{var s=t.seekWidgetByName(e.widgetPulldownPlaceholder);r=g.isUndefined(e.widgetPulldownListView)?s.children[0]:s.seekWidgetByName(e.widgetPulldownListView)}var c=p.load($dynamicRes(res[e.listItemResource])).node,u=new d.Pulldown({button:a,label:o,menuBase:r,choice:c},n),l=e.callback;return g.isUndefined(l)||u.onChange(l.bind(this)),u},restore:function(e){try{this._restoreTabs(e.tabs||[])}catch(e){f.warn(e)}},_restoreTabs:function(e){g.each(e,function(e,t){var n=this.tabDelegateList[t];n&&n.selectTab(this.seekWidgetByPath(e))},this)},getRestoreParams:function(){var e=this.tabDelegateList||[];return{tabs:g(e).map(function(e){return e.selected}).value()}},getRegisteredPulldownMenus:function(){return g.clone(this._registeredPulldownMenus)||{}},registerPulldownMenu:function(e){return this._registeredPulldownMenus||(this._registeredPulldownMenus={}),!this._registeredPulldownMenus[e.__instanceId]&&(this._registeredPulldownMenus[e.__instanceId]=e,!0)},unregisterPulldownMenu:function(e){return this._registeredPulldownMenus||(this._registeredPulldownMenus={}),!!this._registeredPulldownMenus[e.__instanceId]&&(delete this._registeredPulldownMenus[e.__instanceId],!0)},__showNowLoading:function(){d.postMessage("deployLoading")},__hideNowLoading:function(){d.postMessage("removeLoading")},__showLayers:function(){this.contentLayer.setVisible(!0),this.popupLayer.setVisible(!0)},__hideLayers:function(){this.contentLayer.setVisible(!1),this.popupLayer.setVisible(!1)},invokePageInAnimation:function(){this.promisePageInAnimationEnd=l.delay(100).then(function(){return this.animate("page_in",!1)}.bind(this)).then(function(){this.animate("default_view",!0);var e="onPageInAnimationEnd";return this._delegate&&g.isFunction(this._delegate[e])?this._delegate[e].call(this._delegate,this):l.resolve()}.bind(this))},refresh:function(){return g.isFunction(this._delegate.refreshPage)?void this._delegate.refreshPage():void d.createInstance("sceneManager").reloadScene()},isRaid:function(){return!1},renew:function(){return new this.constructor(this._sceneNavigate)}}),d.assignRoles=function(e,t){e.prototype=e.prototype||{},e.prototype._popups=e.prototype._popups||{};var n=[e.prototype],i=[e.prototype._popups];g.each(t,function(e){var t=g.clone(e);i.push(t._popups),delete t._popups,n.push(t)}),g.assign.apply(g,n),g.assign.apply(g,i)}}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.SceneObject=cc.Class.extend({ready:function(){var e=cc.director.getRunningScene();e.__references=e.__references||[],e.__references.push(this)},_diposed:!1,dispose:function(){if(!this.isDisposed()){this._setDisposed();try{this._onDispose()}catch(e){console.warn(e)}t.cleanupProperties(this)}},isDisposed:function(){return this._disposed},_setDisposed:function(){this._disposed=!0},_onDispose:function(){}})}((this||0).self||global),function(e){var t=e.kh;t.pc=t.pc||{},t.pc.BaseSceneDelegate=cc.Class.extend({_override:"override",_delayedTaskDeferred:null,__waitForNodesLoaded:function(){return this._delayedTaskDeferred.promise},_setBackBtn:function(e){t.setTouchEventHandlers(e,{"TOUCH_ENDED mainmenu_ui.mainmenu_base.btn_back":this._touchEndedBackBtnProcess.bind(this,e)},this)},_touchEndedBackBtnProcess:function(e){}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e._,t.EmptyDelegate=n.Class.extend({ctor:function(){},initializeUI:function(){},getEvents:function(){return{}},getMouseEvents:function(){return{}},onExit:function(){},fetch:function(){},updateBattlePower:function(){return t.createInstance("myselfInfoRepository").getBattlePower(!0)},updateCurrency:function(){return t.createInstance("myselfInfoRepository").getMyCurrency(!0)},updateQuestPoints:function(){return t.createInstance("myselfInfoRepository").getQuestPoints(!0).then(function(e){return e.getAsObject()})},stopCharacterVoice:function(){},reload:function(){t.createInstance("myselfInfoRepository").allCacheClear()}})}((this||0).self||global),function(t){t.kh=t.kh||{};var i=t.kh,e=t.cc,o=t._;i.TabDelegate=e.Class.extend({ctor:function(e,t,n){this.tabSetting=e,this._containerNodeName=t,this._initialTab=n},initializeUI:function(){if(!this._initialized){var n=this._initialTab||void 0;o.each(o.keys(this.tabSetting),function(e,t){o.isUndefined(n)&&0===t&&(n=e)},this),this._preventInit||o.isUndefined(n)?this._setSE():this.selectTab(this._getContainerNode().seekWidgetByName(n))}},preventInitialization:function(){this._preventInit=!0,this._setSE()},_setSE:function(){var n=this._getContainerNode();n&&o.each(o.keys(this.tabSetting),function(e,t){n.seekWidgetByName(e).setSound(i.SoundList.BUTTON_TOUCHED_SWITCH)},this)},onExit:function(){this._initialized=!1},owner:null,selected:"",_initialized:!1,_changeUI:function(n){var i=this._getContainerNode();o.each(o.keys(this.tabSetting),function(e){var t=i.seekWidgetByName(e);t.setBright(n!==e),t.setEnabled(n!==e)},this)},selectTab:function(e){this.selected=this._getNodePath(e._name),this._initialized||(this._setSE(),this._initialized=!0),this._changeUI(e._name),this.tabSetting[e._name].apply(this.owner,arguments)},getEvents:function(){var n={};return o.each(this.tabSetting,function(e,t){n["TOUCH_ENDED "+this._getNodePath(t)]=this.selectTab.bind(this)},this),n},getMouseEvents:function(){return{}},_getContainerNode:function(){var e=this.owner;return this._containerNodeName&&(e=this.owner.seekWidgetByName(this._containerNodeName)),e||(e=this.owner),e},_getNodePath:function(e){return e?this._containerNodeName?[this._containerNodeName,e].join(".."):e:(t.console.warn("node name is undefined"),"")}})}((this||0).self||global),function(e){var i=e.kh,t=e.cc,n=e._;i.FooterDelegate=t.Class.extend({_events:null,_menuPopup:null,ctor:function(e){if(e){var t={btn_menu:this._menu};i.env.isSp&&n.extend(t,{footer_menu_1:this._navigate.bind(this,"mypage"),footer_menu_2:this._menu,"footer_menu_ui.btn_par_book":this._tooltip,"footer_menu_ui.btn_quest":this._navigate.bind(this,"quest/q_portal_top"),"footer_menu_ui.btn_gacha":this._navigate.bind(this,"gacha"),"footer_menu_tooltip_ui.btn_par":this._navigate.bind(this,"party"),"footer_menu_tooltip_ui.btn_book":this._navigate.bind(this,"book"),"footer_menu_ui.btn_gud":function(){i.createInstance("unionRouter").navigateToTopScene("me")}}),this._events=n.transform(t,function(e,t,n){return e["TOUCH_ENDED "+n]=t.bind(this)}.bind(this))}},initializeUI:function(){var e=t.director.getRunningScene();e&&this.updateMenuNewIcon(e)},updateMenuNewIcon:function(e){var t="mainmenu_ui";if(t=i.env.isSp?e.bfsWidgetByName("footer_menu_ui"):e.bfsWidgetByName("mainmenu_ui")){var n=t.bfsWidgetByName("menu_new_icon");if(n)return i.createInstance("beginnerMissionInformationModel").get().then(function(e){n.setVisible(e.hasGettableReward())})}},getEvents:function(){return this._events},getMouseEvents:function(){return{}},_reload:function(){i.createInstance("sceneManager").reloadScene()},_menu:function(){this._menuPopup&&this._menuPopup._isOpened?(this._menuPopup.dismiss(),this._menuPopup=null):(i.postMessage("deployTouchShield"),this._createAndOpenPopupMenu().fail(function(e){console.error(e)}).fin(function(){i.postMessage("removeTouchShield")}))},_createAndOpenPopupMenu:function(){return i.createInstance("beginnerMissionInformationModel").get().then(function(e){return e.hasMission()?i.createInstance("popupFactoryMenuBeginnerMission").create({beginnerGettableReward:e.hasGettableReward()}):i.createInstance("popupFactoryMenu").create({})}).then(function(e){return(this._menuPopup=e).open({})}.bind(this))},menu:function(){this._menu()},_tooltip:function(){var e=khutil.getWidget("footer_menu_tooltip_ui",function(e){console.warn("FooterDelegate: "+e)}.bind(this));e.setVisible(!0);var t=this._tooltipOpend?"page_out":"page_in";e.animate(t,!1).then(function(){this._tooltipOpend=!this._tooltipOpend,e.setVisible(this._tooltipOpend)}.bind(this))},_navigate:function(e){i.createInstance("router").navigate(e)},onExit:function(){this._menupopup&&(this._menupopup.dismiss(),this._menuPopup=null)}}),i.FooterDelegateFactory=function(e){return t.sys.isNative&&0===e.sceneName.indexOf("nativetop")?new i.EmptyDelegate(e):new i.FooterDelegate(e)}}((this||0).self||global),function(r){var a=r.kh,o=r.cc,s=r._;a.HeaderDelegate_apis=[{param:"_playerInfo",apiName:"myselfInfoRepository",method:"getMe",callback:"_getMeCallback"},{param:"_questPointInfo",apiName:"myselfInfoRepository",method:"getQuestPoints",callback:"_getQuestPointsCallback"},{param:"_playerCurrencyInfo",apiName:"myselfInfoRepository",method:"getMyCurrency",callback:"_getCurrencyCallback"},{param:"_battlePower",apiName:"myselfInfoRepository",method:"getBattlePower",callback:"_getBattlePowerCallback"}],a.HeaderDelegate=o.Class.extend({_events:null,_menuPopup:null,_reloadMs:3e4,ctor:function(){this._events=s.transform({"headerparts_ui.btn_sound":this._changeSound,"opacity_panel.btn_sound":this._changeSound},function(e,t,n){return e["TOUCH_ENDED "+n]=t.bind(this)}.bind(this))},_playerInfo:null,_playerCurrencyInfo:null,_battlePower:null,_getPlayerInfo:function(e){var t=s.map(e,function(t,e){var n=a.createInstance(t.apiName),i=t.args||[];return n[t.method].apply(n,i).then(function(e){this[t.callback].call(this,e)}.bind(this))},this);return Q.all(t)},_getMeCallback:function(e){this._playerInfo=e},_getQuestPointsCallback:function(e){this._questPointInfo=e.getAsObject()},_getCurrencyCallback:function(e){this._playerCurrencyInfo=e},_getBattlePowerCallback:function(e){this._battlePower=e},_setPower:function(){var e=o.director.getRunningScene().seekWidgetByName("power_no");e&&e.setString(this._battlePower)},_setRank:function(){var e=o.director.getRunningScene(),t=e.seekWidgetByPath("headerparts_ui.rank_no_label"),n=e.seekWidgetByPath("headerparts_ui.rank_gauge");if(t&&n){t.setString(this._playerInfo.getRank());var i=this._playerInfo.getRankPercentage();n.setPercent(i)}},_setPseudoCurrency:function(){var e=o.director.getRunningScene().seekWidgetByPath("headerparts_ui.coin_label");e&&e.setString(this._playerCurrencyInfo.getPseudoCurrencyAmount().toString())},_setStone:function(){var e=o.director.getRunningScene().seekWidgetByPath("headerparts_ui..stone_label");e&&e.setString(this._playerCurrencyInfo.getStoneAmount().toString())},_setGem:function(){var e=o.director.getRunningScene().seekWidgetByName("gem_label");e&&e.setString(this._playerCurrencyInfo.getGemAmount().toString())},_setApBp:function(){var c=this._questPointInfo,u=o.director.getRunningScene();s.each([{key:"ap",path:"headerparts_ap-bp_ui..ap_base"},{key:"bp",path:"headerparts_ap-bp_ui..bp_base"},{key:"ap",path:"headerparts_ap_ui..ap_base"}],function(e){var t=u.seekWidgetByPath(e.path);if(null!=t){var n=c[e.key],i=c["max_"+e.key],o=t.seekWidgetByName("gauge_"+e.key);if(o&&o.setPercent(100*n/i),"ap"===e.key)t.seekWidgetByName(e.key+"_label").setString(n+"/"+i);if("bp"==e.key)t.seekWidgetByName(e.key+"_label").setString(n+"/"+i);var r=t.seekWidgetByName("time_"+e.key+"_label"),a=t.seekWidgetByName("full_label"),s=i<=n;r.setVisible(!s),a.setVisible(s),s||r.setString(c[e.key+"_recover_time"])}},this)},initializeUI:function(){return this._setApBpLayout(),this._updateInfo()},onExit:function(){clearInterval(this._interval)},updateBattlePower:function(){return a.createInstance("myselfInfoRepository").getBattlePower(!0).then(function(e){this._getBattlePowerCallback(e),this._setPower()}.bind(this))},updateCurrency:function(){return a.createInstance("myselfInfoRepository").getMyCurrency(!0).then(function(e){return this._playerCurrencyInfo=e,this._setPseudoCurrency(),this._setStone(),this._setGem(),e}.bind(this))},updateQuestPoints:function(){return a.createInstance("myselfInfoRepository").getQuestPoints(!0).then(function(e){return this._getQuestPointsCallback(e),this._setApBp(),e.getAsObject()}.bind(this))},_setApBpLayout:function(){var e=o.director.getRunningScene().seekWidgetByName("headerparts_ap-bp_ui");if(!s.isNull(e)){var t="other";switch(a.createInstance("router").getCurrentFragment()){case"mypage/":case"mypage/my_001":t="mypage"}e.setAppearance(t)}},_updateInfo:function(){var e=o.director.getRunningScene();if(!e.disposed){var t=e.bfsWidgetByName("headerparts_ui"),n=e.bfsWidgetByName("headerparts_ap-bp_ui"),i=e.bfsWidgetByName("headerparts_ap_ui");t&&(this._setPseudoCurrency(),this._setStone(),this._setGem(),this._setRank(),this._setPower(),this._changeSoundBtn()),(n||i)&&this._setApBp()}},fetch:function(e){var t=e.bfsWidgetByName("headerparts_ui"),n=e.bfsWidgetByName("headerparts_ap-bp_ui"),i=e.bfsWidgetByName("headerparts_ap_ui");if(t&&(n||i))return this._getPlayerInfo(a.HeaderDelegate_apis).fail(function(e){r.console.error(e)});var o=s.partition(a.HeaderDelegate_apis,function(e){return"_questPointInfo"!==e.param});return t?this._getPlayerInfo(o[0]).fail(function(e){r.console.error(e)}):n||i?this._getPlayerInfo(o[1]).fail(function(e){r.console.error(e)}):Q.resolve()},_startReloadTimer:function(){null!=this._interval&&clearInterval(this._interval),this._interval=setInterval(this.reload.bind(this),this._reloadMs)},reload:function(){s.each(a.HeaderDelegate_apis,function(e){delete this[e.param]},this);var e=o.director.getRunningScene();this.fetch(e).then(this._updateInfo.bind(this))},getEvents:function(){return this._events},getMouseEvents:function(){return{}},_navigateToMypage:function(){a.createInstance("router").navigate("mypage")},_navigateToShop:function(){var e=a.createInstance("router"),t=e.getCurrentFragment();e.navigate("shop/sh_002",{},{sh_002:{returnPageRoute:t}})},_changeSoundBtn:function(){var e=o.director.getRunningScene(),t=a.env.isSp?"opacity_panel.btn_sound":"headerparts_ui.btn_sound",n=e.seekWidgetByPath(t);if(null!==n){var i=a.createInstance("playerGameConfig").isSoundOn();n.setBright(i)}},_playSoundIfNeed:function(){if(a.createInstance("playerGameConfig").isSoundOn()){var e=a.createInstance("router").getCurrentComponent(),t=a.createInstance("router").getCurrentSceneName();(new a.BGM).playByComponents(e,t)}else(new a.BGM).stop(),this.stopCharacterVoice()},stopCharacterVoice:function(){var e=a.createInstance("playerGameConfig"),t=o.director.getRunningScene()._delegate;s.isUndefined(t)||s.isUndefined(t._playingCurrentCharacterVoiceResource)||a.createInstance("soundPlayer").init(e).stopVoice(t._playingCurrentCharacterVoiceResource)},_changeSound:function(){var e=a.createInstance("playerGameConfig"),t=e.isSoundOn();e.setAllSoundOn(!t),e.updateGameConfig().then(function(){this._changeSoundBtn(),this._playSoundIfNeed(),a.createInstance("soundPlayer").updateByPlayerGameConfig(e)}.bind(this))}}),a.HeaderDelegateFactory=function(e){return o.sys.isNative&&0===e.sceneName.indexOf("nativetop")?new a.EmptyDelegate(e):e.contentLayer.bfsWidgetByName("headerparts_ui")||e.contentLayer.bfsWidgetByName("headerparts_ap-bp_ui")||e.contentLayer.bfsWidgetByName("headerparts_ap_ui")?new a.HeaderDelegate(e):new a.EmptyDelegate(e)}}((this||0).self||global),function(e){var n=e.kh,o=e.cc,t=e._;n.MainMenuDelegate=o.Class.extend({_events:null,_mouseEvents:null,_menuPopup:null,ctor:function(e){this._events=this.createEvent(e),this._mouseEvents=this.createMouseEvent(e),/my_001/.test(n.createInstance("router").getCurrentFragment())||this.setBackButtonVisible(!0)},createEvent:function(e){return t.transform({},function(e,t,n){return e["TOUCH_ENDED "+n]=t}.bind(this))},createMouseEvent:function(e){return{"MOUSE_ENTER mainmenu_ui.mainmenu_base.mainmenu_mypage_ui.btn_enhance":this._startQuakeAnim.bind(this,"mainmenu_mypage_ui","mo_enhance"),"MOUSE_LEAVE mainmenu_ui.mainmenu_base.mainmenu_mypage_ui.btn_enhance":this._stopQuakeAnim.bind(this,"mainmenu_mypage_ui"),"MOUSE_ENTER mainmenu_ui..btn_quest_normal":this._startQuakeAnim.bind(this,"mainmenu_quest_normal_ui","mo_quest"),"MOUSE_LEAVE mainmenu_ui..btn_quest_normal":this._stopQuakeAnim.bind(this,"mainmenu_quest_normal_ui"),"MOUSE_ENTER mainmenu_ui..btn_quest_raid":this._startQuakeAnim.bind(this,"mainmenu_quest_raid_ui","mo_raid"),"MOUSE_LEAVE mainmenu_ui..btn_quest_raid":this._stopQuakeAnim.bind(this,"mainmenu_quest_raid_ui"),"MOUSE_ENTER mainmenu_ui..btn_party":this._startQuakeAnim.bind(this,"mainmenu_party_ui","mo_party"),"MOUSE_LEAVE mainmenu_ui..btn_party":this._stopQuakeAnim.bind(this,"mainmenu_party_ui"),"MOUSE_ENTER mainmenu_ui..btn_gacha":this._startQuakeAnim.bind(this,"mainmenu_gacha_ui","mo_gacha"),"MOUSE_LEAVE mainmenu_ui..btn_gacha":this._stopQuakeAnim.bind(this,"mainmenu_gacha_ui"),"MOUSE_ENTER mainmenu_ui.mainmenu_base.mainmenu_enhance_ui.btn_enhance":this._startQuakeAnim.bind(this,"mainmenu_enhance_ui","mo_enhance"),"MOUSE_LEAVE mainmenu_ui.mainmenu_base.mainmenu_enhance_ui.btn_enhance":this._stopQuakeAnim.bind(this,"mainmenu_enhance_ui"),"MOUSE_ENTER mainmenu_ui..btn_union":this._startQuakeAnim.bind(this,"mainmenu_union_ui","mo_union"),"MOUSE_LEAVE mainmenu_ui..btn_union":this._stopQuakeAnim.bind(this,"mainmenu_union_ui"),"MOUSE_ENTER mainmenu_ui..btn_menu":this._startQuakeAnim.bind(this,"mainmenu_menu_ui","mo_party"),"MOUSE_LEAVE mainmenu_ui..btn_menu":this._stopQuakeAnim.bind(this,"mainmenu_menu_ui")}},initializeUI:function(){var e="aQuestInfo";if(n.dictx.has(e)){var t=o.director.getRunningScene();n.createInstance(e).getRaid().then(function(e){this._updateQuestBtn(t,e)}.bind(this))}},setBackButtonVisible:function(e){var t=o.director.getRunningScene().seekWidgetByPath("mainmenu_ui.btn_back");t&&t.setVisible(e)},_checkHasMainMenu:function(){var e=o.director.getRunningScene().seekWidgetByName("mainmenu_ui");if(e){var t=e.seekWidgetByName("mainmenu_quest_normal_ui");this._hasMainMenu=null!=t}else console.warn("[ERROR] Could not find the main menu node.")},_updateQuestBtn:function(e,t){if(!e.disposed){var n=e.seekWidgetByName("mainmenu_ui");if(!n)return void console.warn("[ERROR] Could not find the main menu node.");var i=n.seekWidgetByName("mainmenu_quest_normal_ui"),o=n.seekWidgetByName("mainmenu_quest_raid_ui"),r=t.hasNewRaidRequest();i.setVisible(!r),o.setVisible(r)}},getEvents:function(){return this._checkHasMainMenu(),this._hasMainMenu?this._events:{}},getMouseEvents:function(){return this._checkHasMainMenu(),this._hasMainMenu?this._mouseEvents:{}},_back:function(){n.createInstance("router").back()},_navigate:function(e){n.createInstance("router").navigate(e)},_startQuakeAnim:function(e,t){var n=o.director.getRunningScene().seekWidgetByName("mainmenu_ui");if(n){var i=n.seekWidgetByName(e).getAnimInfo(t);i.action.gotoFrameAndPlay(i.animInfo.startIndex,i.animInfo.endIndex,!0)}else console.warn("[ERROR] Could not find the main menu node.")},_stopQuakeAnim:function(e){var t=o.director.getRunningScene().seekWidgetByName("mainmenu_ui");t?t.seekWidgetByName(e).changeFrame(0):console.warn("[ERROR] Could not find the main menu node.")},_menu:function(){o.director.getRunningScene().footerDelegate.menu()}}),n.MainMenuDelegateFactory=function(e){var t=e.contentLayer.bfsWidgetByName("Scene");if(t&&t.bfsWidgetByName("mainmenu_ui"))return new n.MainMenuDelegate(e)}}((this||0).self||global),function(e){var n=e.kh,i=e.cc,t=e._;n.SubMenuDelegate=i.Class.extend({_events:null,_menuPopup:null,ctor:function(e){return e&&null===e.seekWidgetByName("submenu_ui")?this._events={}:this._events=t.transform({btn_profile:this._navigate.bind(this,"profile"),btn_present:this._navigate.bind(this,"present"),btn_shop:this._navigate.bind(this,"shop"),btn_friend:this._navigate.bind(this,"friend"),btn_library:this._navigate.bind(this,"note"),btn_list:this._navigate.bind(this,"item"),btn_harem:this._navigate.bind(this,"epi"),btn_raid_0:this._navigate.bind(this,"quest/q_006"),btn_raid_1:this._navigate.bind(this,"quest/q_006"),btn_open:this._openCallback.bind(this),btn_close:this._closeCallback.bind(this)},function(e,t,n){return e["TOUCH_ENDED submenu_ui.."+n]=t}.bind(this)),void(this._mouseEvents={})},initializeUI:function(){var t=i.director.getRunningScene();if(null!=t&&null!==t.seekWidgetByName("submenu_ui")){var e="aQuestInfo";n.dictx.has(e)&&n.createInstance(e).getRaid().then(function(e){this._updateRaidBtn(t,e)}.bind(this))}},_updateRaidBtn:function(e,t){if(!e.disposed){var n=e.seekWidgetByName("btn_raid_0"),i=e.seekWidgetByName("btn_raid_1"),o=t.hasNewRaidRequest();null!==n&&(n.setEnabled(!o),n.setVisible(!o)),null!==i&&(i.setEnabled(o),i.setVisible(o))}},_showMenuListPopup:function(){n.createInstance("popupFactoryMenuList").create({}).open({})},getEvents:function(){return this._events},getMouseEvents:function(){return this._mouseEvents},_navigate:function(e){n.createInstance("router").navigate(e)},_getAnimationNameToOpenMenu:function(){return"open"},_getAnimationNameToCloseMenu:function(){return"close"},_openCallback:function(){var e=i.director.getRunningScene().seekWidgetByName("submenu_ui").getAnimInfo(this._getAnimationNameToOpenMenu());e.action.gotoFrameAndPlay(e.animInfo.startIndex,e.animInfo.endIndex,!1)},_closeCallback:function(){var e=i.director.getRunningScene().seekWidgetByName("submenu_ui").getAnimInfo(this._getAnimationNameToCloseMenu());e.action.gotoFrameAndPlay(e.animInfo.startIndex,e.animInfo.endIndex,!1)}}),n.SubMenuDelegateFactory=function(e){if(i.sys.isNative&&0===e.sceneName.indexOf("nativetop"))return new n.EmptyDelegate(e);var t=e.contentLayer.bfsWidgetByName("Scene");return t&&t.bfsWidgetByName("submenu_ui")?new n.SubMenuDelegate(e):new n.EmptyDelegate(e)}}((this||0).self||global),function(e){var o=e.kh,i=e.cc,r=e.console;e.khutil,o.BasicAvatar=o.ArmatureVisualEffect.extend({className:"KHBasicAvatar",ANIMATION_NAMES:{IDLE:"avatar_normal",ATTACK:"avatar_attack",WIN:"avatar_win",STANDBY:"avatar_standby"},init:function(e,t,n){return this._id=e,this._isJob=t,Q.all([this._initAvatar(e,t,n),this._initSoundEffects(e,t)]).then(function(){if(this._cleanUpTouchEvent=this._initOnTouchCallback(),this._soundEvent=this._initSoundEvent(),o.env.isSp){if("poprank"===o.createInstance("router").getCurrentComponent())return this;var e=o.createInstance("notificationCenter");e.addEventListener("startAnimation:introduce_window_up",this._showAvatar,this),e.addEventListener("endAnimation:introduce_window_down",this._hideAvatar,this)}return this}.bind(this)).fail(function(e){r.error(e.stack||e)})},cleanup:function(){if(this._cleanUpTouchEvent(),o.createInstance("voiceLoader").unloadAvatarAttackVoices(this._id,this._isJob),o.ArmatureVisualEffect.prototype.cleanUp.call(this),o.env.isSp){if("poprank"===o.createInstance("router").getCurrentComponent())return;var e=o.createInstance("notificationCenter");e.removeEventListenersByEventName("startAnimation:introduce_window_up"),e.removeEventListenersByEventName("endAnimation:introduce_window_down"),this._ancestorNode.addChild(this._parentNode),this._ancestorNode=null,this._parentNode=null}},playAttackAnimation:function(){this._isPlaying=!0,this._initSoundEffects(this._id,this._isJob).then(function(e){var t=_.shuffle(e||[null])[0];null!=t&&this._soundEvent.addSoundEffect(t)}.bind(this)).fail(function(){r.warn("KHBasicAvatar.playAttackAnimation: failed to load sound effects.")}).finally(function(){var e=[this.ANIMATION_NAMES.ATTACK,this.ANIMATION_NAMES.STANDBY];this._verifyAnimationNames&&(this.addAnimationEventCallback("complete",this._resetAfterTransitionAnimation,this),this._animation.playWithNames(e))}.bind(this))},playWinAnimation:function(){var e=this.ANIMATION_NAMES.WIN;return!!this._verifyAnimationNames([e])&&(this._animation.play(e),!0)},playStandByAnimation:function(){var e=this.ANIMATION_NAMES.STANDBY;return!!this._verifyAnimationNames([e])&&(this._animation.play(e),!0)},playIdleByAnimation:function(){var e=this.ANIMATION_NAMES.IDLE;return!!this._verifyAnimationNames([e])&&(this._animation.play(e),!0)},appendTo:function(e){if(o.env.isSp){if("poprank"===o.createInstance("router").getCurrentComponent())return void e.addChild(this._armature);this._ancestorNode=e.parent,(this._parentNode=e).removeFromParent()}e.addChild(this._armature)},removeFromParent:function(){this._armature.removeFromParent()},disableTouchEvent:function(){this._cleanUpTouchEvent()},_initOnTouchCallback:function(){var e=this._onTouchCallback.bind(this),t={event:i.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!1,onTouchBegan:function(){return!0},onTouchEnded:e},n=i.eventManager.addListener(t,this._armature);return function(){i.eventManager.removeListener(n)}},_onTouchCallback:function(e){if(!this._isPlaying){var t=this._armature.convertToNodeSpace(e.getLocation());i.rectContainsPoint(this._armature.getBoundingBox(),t)&&this.playAttackAnimation()}},_verifyAnimationNames:function(e){var t=_.filter(e,function(e){return!this._hasAnimation(e)},this);return!(0<t.length&&(r.error("KHBasicAvatar._verifyAnimationNames: animations not found: "),_.each(t,r.warn),1))},_resetAfterTransitionAnimation:function(){this.removeAnimationEventCallback("complete",this._resetAfterTransitionAnimation),this._isPlaying=!1;var e=this._animation._movementList;return 0===e.length?void this.playStandByAnimation():(e.shift(),void(0===e.length&&this.playStandByAnimation()))},_initSoundEffects:function(e,t){return o.createInstance("voiceLoader").loadAvatarAttackVoices(e,t)},_initAvatar:function(e,t,n){var i=o.generateAvatarAnimationPaths(e,t,n);return null==i||null==i.ExportJson?Q.reject("KHBasicAvatar._initAvatar: resource not found"):o.loader.load([i.ExportJson]).then(function(){o.ArmatureVisualEffect.prototype.init.call(this,i.ExportJson),this._animation.play("avatar_normal")}.bind(this))},_initSoundEvent:function(){var e=o.createInstance("Sound1Event",this);return e.setOptions({isVoice:!0,removeAfterPlay:!0}),e},_showAvatar:function(){this._resetTouchEvent(),this._ancestorNode.addChild(this._parentNode)},_hideAvatar:function(){this._parentNode.removeFromParent()},_resetTouchEvent:function(){this._cleanUpTouchEvent(),this._cleanUpTouchEvent=this._initOnTouchCallback()}})}((this||0).self||global),function(e){var i=e.kh;i.BasicAvatarSceneObject=i.SceneObject.extend({className:"KHBasicAvatarSceneObject",init:function(e,t,n){return this._initProgress=i.createInstance("BasicAvatar").init(e,t,n).then(function(e){return this._avatar=e,this}.bind(this))},getAvatar:function(){return this._avatar},_onDispose:function(){var e=this._avatar;this._initProgress.then(function(){e.cleanup(),e=null}.bind(this))}})}((this||0).self||global),function(e){var c=e.kh,u=(e.cc,e._);e.Q,c.pc.roles=c.pc.roles||{},c.pc.roles.CoreCardCommon={_setProperCoreCardElementRarity:function(e,t,n){var i;switch(khutil.getCoreCardDINameByRecord(t)){case"CoreCardJobUI":i="e";break;case"CoreCardWeaponUI":case"CoreCardSummonUI":case"CoreCardCharacterUI":case"CoreCardAccessoryUI":i="e_r";break;default:i="plain"}return this._setProperCoreCard(e,t,n,i)},_setProperCoreCard:function(e,t,n,i){var o=khutil.getCoreCardDINameByRecord(t),r=e.seekWidgetByName(n||"corecard_ui"),a=r.getUserData()||{};u.invoke(a,"setVisible",!1);var s=a[o];return s instanceof c.CoreCardUI?(s.setData(t),s.setVisible(!0)):((s=c.createInstance(o,[i])).setData(t),r.addChild(s.getResult()),a[o]=s,r.setUserData(a)),s},_setCharacterCoreCard:function(e,t,n){return this._setupCoreCard(e,t,n,"plain","character")},_setCharacterCoreCardElementRarity:function(e,t,n){return this._setupCoreCard(e,t,n,"e_r","character")},_setCharacterCoreCardFull:function(e,t,n){return this._setupCoreCard(e,t,n,"full","character")},_setWeaponCoreCardElementRarity:function(e,t,n){return this._setupCoreCard(e,t,n,"e_r","weapon")},_setWeaponCoreCardFull:function(e,t,n){return this._setupCoreCard(e,t,n,"full","weapon")},_setJobCoreCard:function(e,t,n){return this._setupCoreCard(e,t,n,"e","job")},_setSummonCoreCardElementRarity:function(e,t,n){return this._setupCoreCard(e,t,n,"e_r","summon")},_setSummonCoreCardFull:function(e,t,n){return this._setupCoreCard(e,t,n,"full","summon")},_setAccessoryCoreCardElementRarity:function(e,t,n){return this._setupCoreCard(e,t,n,"e_r","accessory")},_setAccessoryCoreCardFull:function(e,t,n){var i=this._setupCoreCard(e,t,n,"full","accessory");return i.setTotalLabel("総 "+(t.hp+t.attack)),i},_setItemCoreCard:function(e,t,n){return this._setupCoreCard(e,t,n,"plain","item")},_setPackageItemCoreCard:function(e,t,n){return this._setupCoreCard(e,t,n,"plain","package")},_setItemCoreCardAmount:function(e,t,n){return this._setupCoreCard(e,t,n,"amount","item")},_setupCoreCard:function(e,t,n,i,o){var r=e.seekWidgetByName(n||"corecard_ui");if(null==r)throw new Error("_setupCoreCard: targetNode Not Found:"+n);var a=o?khutil.getCoreCardDINameByKind(o):khutil.getCoreCardDINameByRecord(t),s=this._createOrGetCoreCardUI(a,r,i);return s.setData(t,null,"CoreCardCommon"),s.setVisible(!0),r.setVisible(!0),s},_createOrGetCoreCardUI:function(e,t,n){var i=t.getUserData()||{};if(i instanceof c.CoreCardUI)return i;var o=t.getActionManager().getActionByTag(t.tag,t);if(o&&o.animationInfo&&o.animationInfo[n]){if(r=c.createInstance(e,[n,t]),t.setUserData(r),null!=t.seekWidgetByName(r.IMG_NODE_NAME))return r;t.removeAllChildrenWithCleanup(!0)}var r,a=u.find(t.getChildren(),function(e){return e.getActionByTag(e.tag)});return a?r=c.createInstance(e,[n,a]):(r=c.createInstance(e,[n]),t.addChild(r.getResult())),t.setUserData(r),r}}}((this||0).self||global),function(e){var o=e._||{},r=e.kh||{};r.ImplantedPopup=r.SceneObject.extend({_dismissAnimationName:null,ctor:function(e){return this.__initDefer=Q.defer(),this._getScene()._delegate?void this._getScene()._delegate.__waitForNodesLoaded().then(function(){this._init(e)}.bind(this)):void this._init(e)},_init:function(e){var t=this._getScene(),n=t.seekWidgetByName("popup_ui");if(null===n)return console.error("ImplantedPopup: The node 'popup_ui' not found. (name = "+e+").");this._uiNode=n;var i=t.seekWidgetByName(e);if(null===i)return console.error("ImplantedPopup: The node "+e+" not found.");var o=(this._node=i).getUserData();null!==o&&console.warn("★ImplantedPopup二重登録の可能性!　’"+e+"’ノードのUserDataが既に存在します。",o),this._node.setUserData(this),this._setGroupPanelNode(),this.__initDefer.resolve(!0)},_waitForInit:function(){return this.__initDefer.promise},_setGroupPanelNode:function(){if(r.env.isSp){var e=this._uiNode.seekWidgetByName("group_panel");null!==e&&(e.height=cc.game.config.designHeight,e.width=cc.game.config.designWidth)}},_getScene:function(){return cc.director.getRunningScene()},getNode:function(){return this._node},getName:function(){return this._node.getName()},setTitle:function(e){this.getNode().setStrings({title_label:e})},setButtonEvents:function(e){var n={};o.each(e,function(e,t){o.isBoolean(e)&&(e=this.dismiss.bind(this,e)),n["TOUCH_ENDED "+t]=e},this),this._waitForInit().then(function(){r.setTouchEventHandlers(this.getNode(),n,this)}.bind(this))},open:function(){this._dfd=Q.defer(),r.createInstance("notificationCenter").dispatchEvent("menu_open");var e=arguments;return this._waitForInit().then(function(){this._initContents.apply(this,e),this._openAnimation()}.bind(this)),this._dfd.promise},_openAnimation:function(){return this._uiNode.animate(this.getName(),!1).then(function(){this._uiNode.setVisible(!0)}.bind(this))},dismiss:function(e){this._uiNode.animate(this._dismissAnimationName||"default_view",!1).then(this._closeAnimationEndHandler.bind(this)),e?this._dfd.resolve(this):this._dfd.reject()},_closeAnimationEndHandler:function(){this._uiNode.setVisible(!1),r.createInstance("notificationCenter").dispatchEvent("menu_close")},_onDispose:function(){var e=this.getNode();!e||e.getUserData()===this&&e.setUserData(null)},_getNodeByName:function(e,t){o.isUndefined(t)&&(t=this.getNode());var n=t.seekWidgetByName(e);return n||console.warn("EnhUseItemsPopup._getNodeByName(): node '"+e+"' not found"),n},_initContents:function(e){}});r.ImplantedPopup.createOrGet=function(e,t,n){n=n||o.capitalize(o.camelize(t))+"Popup";var i=e.seekWidgetByName(t);return null!==i&&null!=i.getUserData()?i.getUserData():r.createInstance(n,[t])},r.ImplantedPopup.create=function(e,t,n){n=n||o.capitalize(o.camelize(t))+"Popup";var i=e.seekWidgetByName(t);return null!=i&&i.setUserData(null),r.createInstance(n,[t])}}((this||0).self||global),function(e){var t=e.kh;t.createNameSpaceIfNotExists("core.rarity"),t.core.rarity.RARITY_TYPE={N:0,R:1,SR:2,SSR:3}}((this||0).self||global),function(e){var t=e.kh;e.khutil,e.cc,e.ccui,e._,e.console,t.createNameSpaceIfNotExists("core.item"),t.core.item.ITEM_TYPE={ITEM:0,WEAPON:1,SUMMON:2,ACCE:3,PACKAGE:4}}((this||0).self||global),function(e){var i=e.cc,o=e._,r=e.kh;r.createNameSpaceIfNotExists("core.item"),r.core.item.ShItemInfoPopup=r.ImplantedPopup.extend({CORECARD_IMAGE_2ND_KEY:"item",_initContents:function(e){this.setButtonEvents({btn_popup_close:!0});var t=this.getNode();this._setCorecard(t,e.item_id),this._setItemName(t,e.name),this._setItemDescription(t,e.description||e.item_description)},_setCorecard:function(e,t){var n=e.seekWidgetByName("item_img");if(null!==n){var i=r.Img("corecard",this.CORECARD_IMAGE_2ND_KEY,o.padZero(t,4)).jpg;n.setVisible(!0),n.loadTexture(i)}},_setItemName:function(e,t){var n=e.seekWidgetByName("item_name_label");null!==n&&n.setString(t)},_setItemDescription:function(e,t){var n=e.seekWidgetByName("item_description_label");null!==n&&(n.setTextHorizontalAlignment(i.TEXT_ALIGNMENT_CENTER),n.setString(t))}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.createNameSpaceIfNotExists("core.item"),t.core.item.ShWeaponInfoPopup=t.ImplantedPopup.extend({_initContents:function(e){this.setButtonEvents({btn_popup_close:!0});var t=this.getNode();this.clearData(t),this.setData(t,e)}}),t.assignRoles(t.core.item.ShWeaponInfoPopup,[t.pc.roles.CoreCardCommon,t.pc.status.roles.ShWeaponInfoCommon])}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.createNameSpaceIfNotExists("core.item"),t.core.item.ShSummonInfoPopup=t.ImplantedPopup.extend({_initContents:function(e){this.setButtonEvents({btn_popup_close:!0});var t=this.getNode();this.clearData(t),this.setData(t,e)}}),t.assignRoles(t.core.item.ShSummonInfoPopup,[t.pc.roles.CoreCardCommon,t.pc.status.roles.ShSummonInfoCommon])}((this||0).self||global),function(e){var s=e.kh,c=e.cc;s.QuestStateManager=c.Class.extend({METHOD_NAMES_BY_STATE:{talk:"_gotoStory",battle:"_gotoBattle",battle_result:"_gotoResult",episode_result:"_gotoEpisodeResult","harem-character":"_gotoHaremEpisode","harem-job":"_gotoHaremEpisode","harem-summon":"_gotoHaremEpisode","harem-story":"_gotoHaremEpisode",finish:"_gotoTop"},startQuest:function(e,t){return this._questType=this._getQuestType(t),s.createInstance("aQuestInfo").dispose(),this._questId=e,this._questCategory=null,this._questSubCategory=null,s.createInstance("apiAQuests").startQuest(e,t).then(function(e){return s.createInstance("myselfInfoRepository").allCacheClear(),this._handleNextStateInfo(e)}.bind(this),function(e){console.error("KHQuestStateManager.startQuest API error: "+e.stack)})},gotoNextQuestState:function(t,n,i,e,o,r){var a=c.director.getRunningScene();return this._aQuestId=_.isUndefined(t)?a.getQuestId():t,this._questType=this._getQuestType(n),this._isOwnRaid="boolean"==typeof i?i:null,this._questId=e||this._questId,this._questCategory=o||this._questCategory,this._questSubCategory=r||this._questCategory,s.createInstance("apiAQuests").getNextState(this._aQuestId,this._questType).then(this._handleNextStateInfo.bind(this)).fail(function(e){e&&e.stack&&(s.createInstance("smartBeat").log("KHQuestStateManager.gotoNextQuestState error"),s.createInstance("smartBeat").log("aQuestId:"+t),s.createInstance("smartBeat").log("questType:"+n),s.createInstance("smartBeat").log("isOwnRaid:"+i),console.error(e))})},restartQuest:function(e,t,n,i,o){var r=c.director.getRunningScene();return this._aQuestId=_.isUndefined(e)?r.getQuestId():e,this._questType=this._getQuestType(t),this._questId=n,this._questCategory=i,this._questSubCategory=o,s.createInstance("apiAQuests").getCurrentState(this._aQuestId,this._questType).fail(function(e){console.error("KHQuestStateManager.restartQuest API error: "+e.stack)}).then(this._handleNextStateInfo.bind(this))},_handleNextStateInfo:function(e){s.createInstance("myselfInfoRepository").allCacheClear();var t=e.body;if(null!=t.cannot_progress_info)return Q.reject(t.cannot_progress_info);var n=t.next_info.next_kind;if(0===n.indexOf("prize_quest"))return this._gotoPrizehuntQuest(t.next_info);var i=this.METHOD_NAMES_BY_STATE[n];switch(n){case"battle":this[i](t.next_info.id,this._questType,t.a_quest_id,!!t.is_own_raid);break;default:this[i](t.next_info.id,this._questType,t.a_quest_id)}},_gotoStory:function(e,t,n){var i=this._getIsAutoFromTemporaryRouterParams();s.createInstance("router").navigate("scenario/scenario-play",{id:e,quest_type:t,a_quest_id:n},{id:e,quest_type:t,a_quest_id:n,ignoreImplicitRoute:!0,isAuto:i})},_gotoHaremEpisode:function(e,t,n){var i=this._getIsAutoFromTemporaryRouterParams();s.createInstance("router").navigate("scenario/harem-play",{id:e,quest_type:t,a_quest_id:n},{id:e,quest_type:t,a_quest_id:n,ignoreImplicitRoute:!0,isAuto:i})},_gotoBattle:function(e,t,n,i){s.createInstance("router").navigate("battle",{a_battle_id:e,quest_type:t,a_quest_id:n,quest_id:this._quest_id,quest_category:this._questCategory,quest_sub_category:this._questSubCategory,is_own_raid:i})},_gotoResult:function(e,t){var n=this._questCategory,i=this._questSubCategory;this._questCategory=null,this._questSubCategory=null,s.createInstance("router").navigateAndPreventHistoryBack("quest/q_003_1",{a_battle_id:e,quest_type:t,is_own_raid:this._isOwnRaid,quest_id:this._questId,quest_category:n,quest_sub_category:i},{ignoreImplicitRoute:!0})},_gotoEpisodeResult:function(e,t){return"raid"===t?s.createInstance("apiABattles").getBattleResult(e,t).fin(function(){s.createInstance("router").navigate("quest/q_011")}):void s.createInstance("router").navigateAndPreventHistoryBack("quest/q_003_2",{a_battle_id:e,quest_type:t},{ignoreImplicitRoute:!0})},_gotoPrizehuntQuest:function(e){if("prize_quest_event_end"===e.next_kind){var t=s.createInstance("popupFactoryTextOnly").create({title:"このイベントは終了しました。",content:"イベント期間が終了したためこのクエストは終了しました。",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(){this.dismiss(),s.createInstance("aQuestInfo").dispose();var e=(c.director.getRunningScene()||{})._delegate;return _.isUndefined(e)?void s.createInstance("router").navigate("mypage"):void e.clearOwnQuest()}}});s.createInstance("apiAQuests").giveupQuest(e.a_quest_id,this._questType).then(t.open.bind(t))}else s.createInstance("router").navigate("prizehunt/prizehunt_quest",{},e)},_gotoTop:function(e,t){if(_.isString(t)){if(-1!==t.search("harem"))return void s.createInstance("router").navigate("epi",{epi_001:{tab:"new"}});var n;if("event_main"===t)if((n=c.director.getRunningScene().routerParams.ra_002||{}).event_id)return void s.createInstance("router").navigate("raidevent/ra_002",{ra_002:{event_id:n.event_id}});if("event_quest_main"===t)if((n=c.director.getRunningScene().routerParams.con_005||{}).event_id)return void s.createInstance("router").navigate("conquest/con_005",{con_005:{event_id:n.event_id,tab:"tab_1"}});if("epic"===t){var i=c.director.getRunningScene().routerParams.epic_subject_id;if(i)return void s.createInstance("router").navigate("epic/epic_quest_list",{},{epic_quest_list:{epicId:i}});s.createInstance("router").navigate("epic/epic_select")}}s.createInstance("router").navigate("quest")},_getIsAutoFromTemporaryRouterParams:function(){var e=c.director.getRunningScene();return!!_.isObject(e.temporaryRouterParams)&&!_.isUndefined(e.temporaryRouterParams.isAuto)&&e.temporaryRouterParams.isAuto},_getQuestType:function(e){var t=_.isUndefined(e)?c.director.getRunningScene().getQuestType():e;return 0===t.indexOf("epic_")?"epic":t}})}((this||0).self||global),function(t){var n=t.kh,e=t.cc;n.copyLock=!1,n.copyTextToClipboard=function(e){t.$.post("/v1/copyTextToClipboard",{text:e})},n.PlayerGameConfig=e.Class.extend({className:"KHPlayerGameConfig",IMAGE_SCALE_SETTINGS:{low:1,normal:1,high:1},BATTLE_SPEED_SETTINGS:{normal:1,quick:1.7},ctor:function(){this._updateParameters={},this._originalParameters={},this._configPromise=null},init:function(){return this.getGameConfig().then(function(){return this}.bind(this))},getGameConfig:function(){return this._configPromise||(this._configPromise=n.createInstance("apiAPlayers").getGameConfig()),this._configPromise.then(function(e){this._config=Object.assign({},e.body.game_config),n._playerName=this._config.playerName,delete this._config.playerName,n._needCopy=this._config.needCopy,delete this._config.needCopy,this._updateParameters={},this._originalParameters=_.merge({},this._config),this._configPromise=null}.bind(this))},restoreSavedConfig:function(){return this._updateParameters={},this._config=_.merge({},this._originalParameters),this._configPromise||Q.resolve()},updateGameConfig:function(){var e=this._updateParameters;return this.isDirty()?(this._updateParameters={},this._originalParameters={},this._configPromise=n.createInstance("apiAPlayers").updateGameConfig(e).then(function(e){return this._config=Object.assign({},e.body.game_config),n._playerName=this._config.playerName,delete this._config.playerName,n._needCopy=this._config.needCopy,delete this._config.needCopy,this._originalParameters=_.merge({},this._config),e}.bind(this)),this._configPromise):this.getGameConfig()},isDirty:function(){return!_.isEmpty(this._getUpdateParams())},_getUpdateParams:function(){return this._updateParameters},isSoundOn:function(){return null==this._config||null==this._config.sound_info?(console.warn("KHPlayerGameConfig.isSoundOn: playerGameConfig is not properly initialized"),!1):this._config.sound_info.sound_enabled},setSoundOn:function(e){this._setSoundParameter("sound_enabled",e)},setAllSoundOn:function(e){this.setSoundOn(e),this.setBgmOn(e),this.setSeOn(e),this.setVoiceOn(e)},getMasterVolume:function(){return console.warn("KHPlayerGameConfig.setMasterVolume: master volume is currently not supported"),100},setMasterVolume:function(e){console.warn("KHPlayerGameConfig.setMasterVolume: master volume is currently not supported")},isBgmOn:function(){return null==this._config||null==this._config.sound_info?(console.warn("KHPlayerGameConfig.isBgmOn: playerGameConfig is not properly initialized"),!1):this._config.sound_info.bgm_enabled},setBgmOn:function(e){console.debug("[!! BGM !!]",e),this._setSoundParameter("bgm_enabled",e)},getBgmVolume:function(){return null==this._config||null==this._config.sound_info?(console.warn("KHPlayerGameConfig.getBgmVolume: playerGameConfig is not properly initialized"),0):this._config.sound_info.bgm_volume||0},getVirtualBgmVolume:function(){return.01*this.getBgmVolume()*this._getSoundMultiplyingFactor("BGM")},setBgmVolume:function(e){console.debug("[!! BGM VOLUME !!]",e),this._setSoundParameter("bgm_volume",e)},isSeOn:function(){return null==this._config||null==this._config.sound_info?(console.warn("KHPlayerGameConfig.isSeOn: playerGameConfig is not properly initialized"),!1):this._config.sound_info.se_enabled},setSeOn:function(e){console.debug("[!! SE !!]",e),this._setSoundParameter("se_enabled",e)},getSeVolume:function(){return null==this._config||null==this._config.sound_info?(console.warn("KHPlayerGameConfig.getSeVolume: playerGameConfig is not properly initialized"),0):this._config.sound_info.se_volume||0},getVirtualSeVolume:function(){return.01*this.getSeVolume()*this._getSoundMultiplyingFactor("SE/VOICE")},setSeVolume:function(e){console.debug("[!! SE VOLUME !!]",e),this._setSoundParameter("se_volume",e)},isVoiceOn:function(){return null==this._config||null==this._config.sound_info?(console.warn("KHPlayerGameConfig.isVoiceOn: playerGameConfig is not properly initialized"),!1):this._config.sound_info.voice_enabled},setVoiceOn:function(e){console.debug("[!! VOICE !!]",e),this._setSoundParameter("voice_enabled",e)},getVoiceVolume:function(){return null==this._config||null==this._config.sound_info?(console.warn("KHPlayerGameConfig.isVoiceOn: playerGameConfig is not properly initialized"),0):this._config.sound_info.voice_volume||0},getVirtualVoiceVolume:function(){return.01*this.getVoiceVolume()*this._getSoundMultiplyingFactor("SE/VOICE")},setVoiceVolume:function(e){console.debug("[!! VOICE VOLUME !!]",e),this._setSoundParameter("voice_volume",e)},isBattleSpeedFast:function(){return"quick"===this._config.battle_speed},setBattleSpeedFast:function(e){this._setParameter("battle_speed",e?"quick":"normal")},getBattleSpeedScale:function(){return this.BATTLE_SPEED_SETTINGS[this._config.battle_speed]||1},getImageQuality:function(){return n.env.isSp?"normal":this._config.image_quality||"normal"},setImageQuality:function(e){return this._setParameter("image_quality",e)},getImageScale:function(){return this.IMAGE_SCALE_SETTINGS[this.getImageQuality()]},setElementDiagramVisible:function(e){this._setParameter("element_diagram_visible",e)},getElementDiagramVisible:function(){return this._config.element_diagram_visible},setEnhanceMaterialsTarget:function(e){this._setParameter("enhance_materials_target",e)},getEnhanceMaterialsTarget:function(){return this._config.enhance_materials_target},setEpisodeEventSkip:function(e){this._setParameter("episode_event_skip",e)},getEpisodeEventSkip:function(){return this._config.episode_event_skip},setAbilityPopupSkip:function(e){this._setParameter("ability_popup_skip",e)},isAbilityPopupSkip:function(){return this._config.ability_popup_skip},setSummonEffectEnabled:function(e){this._setParameter("summon_effect_enabled",e)},isSummonEffectEnabled:function(){return this._config.summon_effect_enabled},setGachaSimpleAnimationEnabled:function(e){this._setParameter("gacha_simple_animation",e)},isGachaSimpleAnimationEnabled:function(){return this._config.gacha_simple_animation},setGachaAnimationSkipFlag:function(e){this._setParameter("gacha_animation_skip",!0===e)},isGachaAnimationSkip:function(){return this._config.gacha_animation_skip},_setParameter:function(e,t){this._originalParameters[e]===t?delete this._updateParameters[e]:this._updateParameters[e]=t,this._config[e]=t},_setSoundParameter:function(e,t){this._updateParameters.sound_info=this._updateParameters.sound_info||{},this._originalParameters.sound_info[e]===t?(delete this._updateParameters.sound_info[e],0===_.keys(this._updateParameters.sound_info).length&&delete this._updateParameters.sound_info):this._updateParameters.sound_info[e]=t,this._config.sound_info=this._config.sound_info||{},this._config.sound_info[e]=t},_getSoundMultiplyingFactor:function(e){return n.SoundMultiplyingFactor?n.SoundMultiplyingFactor[e]?n.SoundMultiplyingFactor[e]:(console.warn("kh.SoundMultiplyingFactor."+e+" is not defined: use default 1"),1):1},isInitialized:function(){return!_.isEmpty(this._config)}})}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var o="Bgm",r={get:function(){return this._http.get({url:"/bgm"})},getMain:function(){return{body:{id:13}}}};if(n.Api.Bgm=i.Class.extend(t.assign({className:"KHApiBgm",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},r)),n.env.useApiMock){n.MockApi=n.MockApi||{};var a={};t.each(r,function(e,t){a[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi.Bgm[t+"JSON"])throw"not implemented: kh.MockApi.Bgm."+t;var e=Q.defer();return e.resolve({body:n.MockApi.Bgm[t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi.Bgm=i.Class.extend(t.assign({},a))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(r,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,o).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var o="AQuestInfo",r={get:function(){return this._http.get({url:"/a_quest_info"})},getRaid:function(){return this._http.get({url:"/a_quest_info/raid"})},getRaidAndHarem:function(){return this._http.get({url:"/a_quest_info/raid_and_harem"})},moveArea:function(e){return this._http.put({url:"/a_quest_info/me",json:{current_a_area_id:e}})},confirmFollowUpPopup:function(){return this._http.put({url:"/a_quest_info/me",json:{has_follow_up_quest:!1}})},confirmUnlockedQuestPopup:function(){return this._http.put({url:"/a_quest_info/me",json:{has_unlocked_quest:!1}})},confirmUnlockedAreaPopup:function(){return this._http.put({url:"/a_quest_info/me",json:{has_unlocked_area:!1}})},confirmCompletedLastMainQuestPopup:function(){return this._http.put({url:"/a_quest_info/me",json:{has_completed_last_main_quest:!1}})}};if(n.Api[o]=i.Class.extend(t.assign({className:"KHApiAQuestInfo",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},r)),n.env.useApiMock){n.MockApi=n.MockApi||{};var a={};t.each(r,function(e,t){a[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[o][t+"JSON"])throw"not implemented: kh.MockApi."+o+"."+t;var e=Q.defer();return e.resolve({body:n.MockApi[o][t+"JSON"].apply(this,arguments)}),e.promise}},a),n.MockApi[o]=i.Class.extend(t.assign({},a))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(r,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,o).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var o="APanelMissions",r={get:function(){return this._http.get({url:"/a_panel_missions/current"})},getSummary:function(){return this._http.get({url:"/a_panel_missions/summary"})},postSummary:function(){return this._http.post({url:"/a_panel_missions/summary"})},receiveReward:function(e){return this._http.post({url:"/a_panel_missions/receive",json:{a_panel_mission_id:e}})}};if(n.Api[o]=i.Class.extend(t.assign({className:"KHApiAPanelMissions",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},r)),n.env.useApiMock){n.MockApi=n.MockApi||{};var a={};t.each(r,function(e,t){a[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[o][t+"JSON"])throw"not implemented: kh.MockApi."+o+"."+t;var e=Q.defer();return e.resolve({body:n.MockApi[o][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[o]=i.Class.extend(t.assign({},a))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(r,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,o).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e.cc,n=e.kh,i=e._;n.RouterParams=t.Class.extend({name:"KHRouterParams",getCurrentScene:function(){return t.director.getRunningScene()},getSceneName:function(){var e=n.createInstance("router").getCurrentFragment();return i.last(e.split("/"))},getRouterParams:function(){var e=this.getCurrentScene(),t=this.getSceneName();return e.routerParams[t]||{}},getTemporaryRouterParams:function(){var e=this.getCurrentScene(),t=this.getSceneName();return e.temporaryRouterParams[t]||{}}})}((this||0).self||global),function(e){var n=e.kh,i=e.cc,o=e._,r=e.console;n.createNameSpaceIfNotExists("tutorial"),n.tutorial.TutorialProgress=i.Class.extend({_tutorialInProgress:null,_step:0,LOCAL_STORAGE_KEY:"tutorialProgress",END:"end",get:function(){var t=i.sys.localStorage.getItem(this._getLocalStorageKey());if(o.isString(t))try{var e=JSON.parse(t);return this._step=e.step,this._tutorialInProgress=e.progress,this._checkPointInProgress=e.checkpoint,Q.resolve(this)}catch(e){r.warn("tutorialProgress: key:"+this._getLocalStorageKey()+"-"+t)}return this.prepare()},prepare:function(){return n.createInstance("apiATutorialInfo").get().then(function(e){return this._tutorialInProgress=e.body.in_progress,this._checkPointInProgress=e.body.in_progress,this._step=this._findStep(e.body.in_progress),this.save(),this}.bind(this)).fail(function(e){r.error(e.stack)})},_findStep:function(t){return"start"!==t&&t?"end"===t?n.tutorial.componentProgress.length:Math.max(o.findIndex(n.tutorial.componentProgress,function(e){return 0===t.indexOf(e.stepName)}),0):0},canPlayTutorial:function(){if("end"===this._tutorialInProgress)return!1;var e=n.createInstance("router").getCurrentFragment();e.endsWith("/")&&(e+=n.createInstance("sceneManager").getCurrentSceneName());var t=this.getCurrentStep();return 0===e.indexOf(t.fragment)},getCurrentStep:function(){return n.tutorial.componentProgress[this._step]},resetToLocalCheckPoint:function(){this._step=o.findLastIndex(n.tutorial.componentProgress,function(e,t){return this._step>=t&&!0!==e.canNotCheckPoint},this)},endSection:function(){if(!n.tutorial.componentProgress[this._step+1])return this._tutorialInProgress=this.END,this.save(),n.createInstance("apiATutorialInfo").update(this.END).thenResolve({fragment:"mypage"});this._step++;var e=n.tutorial.componentProgress[this._step],t=this._createStepKey(e.stepName,1);return this._tutorialInProgress=t,e.checkpoint?(this._checkPointInProgress=t,this.save(),n.createInstance("apiATutorialInfo").update(t).thenResolve(e).fail(function(e){e&&r.error(e)})):(this.save(),Q.resolve(e))},getCurrentStepKey:function(){var e=this._tutorialInProgress.split("-");return this._createStepKey(e[0],e[1])},loadStepNumber:function(){var e=this._tutorialInProgress.split("-");return Number(e[1])},setStepNumber:function(e){var t=this._tutorialInProgress.split("-");this._tutorialInProgress=this._createStepKey(t[0],e)},getCheckPointKey:function(){return this._checkPointInProgress},_createStepKey:function(e,t){return e+"-"+t},save:function(){i.sys.localStorage.setItem(this._getLocalStorageKey(),JSON.stringify({step:this._step,progress:this._tutorialInProgress,checkpoint:this._checkPointInProgress}))},_getLocalStorageKey:function(){return this.LOCAL_STORAGE_KEY},isFinish:function(){return"end"===this._tutorialInProgress}})}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var o="ATutorialInfo",r={get:function(){return this._http.get({url:"/a_tutorial_info"})},update:function(e){return this._http.put({url:"/a_tutorial_info",json:{in_progress:e}})}};if(n.Api[o]=i.Class.extend(t.assign({className:"KHApiATutorialInfo",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},r)),n.env.useApiMock){n.MockApi=n.MockApi||{};var a={};t.each(r,function(e,t){a[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[o][t+"JSON"])throw"not implemented: kh.MockApi."+o+"."+t;var e=Q.defer();return e.resolve({body:n.MockApi[o][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[o]=i.Class.extend(t.assign({},a))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(r,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,o).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var n=e.kh,o=(e.khutil,e.cc),i=e.ccui,r=e._;e.console,n.createNameSpaceIfNotExists("view"),n.view.AbilityIcon=n.SceneObject.extend({className:"AbilityIcon",_iconNode:null,_frameNode:null,_iconType:null,_categoryColor:null,_touchEnable:null,ctor:function(e,t,n,i){o.spriteFrameCache.addSpriteFrames(res["core-icon-abilityicon.plist"]),this._iconType=t,this._categoryColor=n,this._touchEnable=i,this._iconNode=e.seekWidgetByName("coreimg_abilityicon"),this._frameNode=e.seekWidgetByName("abilityicon_frame")},show:function(){this._iconNode.setTouchEnabled(this._touchEnable);var e=n.Img("coreimg","abilityicon",r.padZero(this._iconType,4)).png;this._iconNode.loadTextureNormal(e),this._iconNode.loadTexturePressed(e),this._iconNode.setVisible(!0),this._frameNode.setVisible(!0);var t="core/res/icon/abilityicon_frame_"+this._categoryColor+".png";this._frameNode.loadTexture(t,i.Widget.PLIST_TEXTURE)},getIconNode:function(){return this._iconNode},addTouchEventListener:function(e,t){this._iconNode.addTouchEventListener(e,t)},setVisible:function(e){this.getIconNode().getParent().setVisible(e)},_onDispose:function(){this._iconNode.addTouchEventListener(null,null),this._frameNode.addTouchEventListener(null,null),this._iconNode.removeAllChildrenWithCleanup(!0),this._frameNode.removeAllChildrenWithCleanup(!0),this._iconNode=null,this._frameNode=null}})}((this||0).self||global),function(e){var t=e._||{},r=e.kh||{};r.createNameSpaceIfNotExists("core.view"),r.core.view.ImplantedSubTutorialPopup=r.ImplantedPopup.extend({_initialized:!1,_initContents:function(e,t){if(this._components=e,this._initialized){this.seekWidgetByName("sub_tutorial_page").getChildByName("default").gotoFirstPage()}else{this.setButtonEvents({btn_popup_close:!0});var n=this.getNode().bfsWidgetByName("btn_popup_close");n.setSoundEnabled(!0),n.setSound(r.SoundList.BUTTON_TOUCHED_CANCEL),this._createPageView(this._createPageList(t)),this._initialized=!0}},_createPageList:function(e){return t.map(t.range(e),function(e){return this._createPage(r.Img("popupsub",this._components,t.padZero(e+1,4)).png)},this)},_createPage:function(e){var t=ccs.load(res["core-popup-sub_tutorial_page_ui"]).node;return t.seekWidgetByName("popupsub_img").loadTexture(e),t},_createPageView:function(e){var o=e.length,t=new r.PageView;t.initialize(e,function(e,t){this.getNode().getChildren().filter(function(e){return 0===e.getName().indexOf("current_base_")}).forEach(function(e){e.setVisible(e.getName()==="current_base_"+(o-1))});for(var n=this.seekWidgetByName("current_base_"+(o-1)),i=0;i<o;i++)n.seekWidgetByName("current_icon_"+i).setVisible(!1);n.seekWidgetByName("current_icon_"+(t-1)).setVisible(!0)},this),t.setDirection(ccui.ScrollView.DIR_HORIZONTAL);var n=this.seekWidgetByName("sub_tutorial_page");n.removeAllChildren(),n.addChild(t),this.seekWidgetByName("btn_next").setVisible(1<o),this.seekWidgetByName("btn_prev").setVisible(1<o);var i=[];i[r.PAGE_CONTROLLER_CONTROLS.NEXT_BUTTON]="btn_next",i[r.PAGE_CONTROLLER_CONTROLS.PREVIOUS_BUTTON]="btn_prev",(new r.PageController).init(this.getNode(),i,t),t.gotoFirstPage()},seekWidgetByName:function(e){return this.getNode().seekWidgetByName(e)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;t.createNameSpaceIfNotExists("core.model"),t.core.model.beginnerMissionInformation=n.Class.extend({_hasReward:!1,_hasMission:!1,_promise:null,_lastModifiedTime:0,_retrySeconds:60,get:function(){var e=(new Date).getTime();return this._promise&&(-1===this._retrySeconds||e<this._lastModifiedTime+1e3*this._retrySeconds)||(this._promise=t.createInstance("apiAPanelMissions").getSummary().then(this._updateModelFromResponse.bind(this)),this._lastModifiedTime=e),this._promise},update:function(){return this._promise=t.createInstance("apiAPanelMissions").postSummary().then(this._updateModelFromResponse.bind(this)),this._lastModifiedTime=(new Date).getTime(),this._promise},_updateModelFromResponse:function(e){return this._hasMission=e.body.has_mission,this._hasReward=e.body.has_gettable_reward,this._lastModifiedTime=(new Date).getTime(),this._retrySeconds=i.isNumber(e.body.max_age_second)?e.body.max_age_seconds:this._retrySeconds,this.hasMission()||(this._retrySeconds=-1),this},hasMission:function(){return this.hasGettableReward()||!0===this._hasMission},hasGettableReward:function(){return!0===this._hasReward},setGettableReward:function(e){this._hasReward=!0===e}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("core.model"),t.core.model.AQuestInfo=n.Class.extend({className:"AQuestInfo",_promise:null,_body:null,_hasUnverified:!1,_hasNewHarem:!1,_hasNewRaidRequest:null,get:function(e){return!e&&this._promise||(this._promise=t.createInstance("apiAQuestInfo").get().then(function(e){if(null===this._promise)return this;var t=e.body;return this._body=t,this._hasUnverified=t.has_unverified,this._hasNewHarem=t.has_new_harem,this._hasNewRaidRequest=t.has_new_raid_request,this}.bind(this)),this._raidPromise||(this._raidPromise=this._promise.then(function(){return Q.delay(200)}).then(function(){return this._raidPromise=null,this}.bind(this)))),this._promise},getRaid:function(e){return!e&&this._raidPromise||(this._raidPromise=t.createInstance("apiAQuestInfo").getRaid().then(function(e){return this._hasNewRaidRequest=e.body.has_new_raid_request,this._raidPromise=null,this}.bind(this))),this._raidPromise},getRawData:function(){if(!this._promise)throw"AQuestInfo Model: Not Fetched Model";return JSON.parse(JSON.stringify(this._body))},confirmInProgressQuest:function(){var e=this.getInProgressQuest();return e?Q.reject({type:"has_a_quest_in_progress",inProgress:e}):this.hasUnverified()?Q.reject({type:"has_unverified",inProgress:e}):Q.resolve(this)},getInProgressQuest:function(e){var t=e||this.getRawData();if(t&&t.in_progress){if(t.in_progress.is_unverified)return null;var n=t.in_progress.own_quest||t.in_progress.own_raid;if(n)return n.type=n.type||"raid",n}return null},hasUnverified:function(){return this._hasUnverified},hasNewHarem:function(){return this._hasNewHarem},hasNewRaidRequest:function(){return this._hasNewRaidRequest},inProgress:function(e){var t=this._body&&this._body.in_progress&&this._body.in_progress.own_quest;return"object"==typeof t&&"object"==typeof e&&e.a_quest_id===t.a_quest_id&&e.type===t.type},dispose:function(){this._raidPromise=null,this._promise=null,this._body=null,this._hasUnverified=!1,this._hasNewHarem=!1,this._hasNewRaidRequest=null}})}((this||0).self||global);var __extends=this&&this.__extends||function(){var i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};return function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}(),KHRouter;!function(e){var t,n=(t=kh.router.LegacyNavigate,__extends(i,t),i.prototype.getRealComponentName=function(){return"tutorial"},i.prototype.changeParty=function(e){},i);function i(){var e=null!==t&&t.apply(this,arguments)||this;return e._sceneClassName="TutorialNavigate",e}e.TutorialNavigate=n}(KHRouter||(KHRouter={})),Object.assign(kh.router=kh.router||{},KHRouter),function(i){var o=i.kh,r=i.cc,a=i._,s=i.console,c={"tutorial-tu_atlas":"../tutorial/res/tu_atlas.plist","tutorial-tu_arrow_blue_ui":"../tutorial/res/tu_arrow_blue_ui.json","tutorial-tu_arrow_red_ui":"../tutorial/res/tu_arrow_red_ui.json","tutorial-tu_window_arrow_ui":"../tutorial/res/tu_window_arrow_ui.json","core-popup-sub_tutorial":"../core/res/popup/sub_tutorial.json","core-popup-sub_tutorial_page_ui":"../core/res/popup/sub_tutorial_page_ui.json"};o.createNameSpaceIfNotExists("tutorial"),o.tutorial.loader=r.Class.extend({BASE_ZORDER:20,load:function(e,t){var n=Q.defer();return r.loader.load(a.values(c),function(){Object.assign(i.res,c),r.spriteFrameCache.addSpriteFrames(res["tutorial-tu_atlas"]),n.resolve()}),n.promise.then(function(){return new o.tutorial.TutorialSectionController(e,t)}.bind(this)).fail(function(e){e&&s.error(e)})}})}((this||0).self||global),function(e){function n(){return Q.Promise(function(){})}var s=e.kh,i=e.cc,o=e._,r=e.console;s.createNameSpaceIfNotExists("tutorial"),s.tutorial.TutorialSectionController=i.Class.extend({_command:null,_layerView:null,_currentNo:-1,_tutorialProgress:null,BASE_ZORDER:20,_scenarios:[],ctor:function(e,t){this._tutorialProgress=t,this._layerView=new s.tutorial.tutorialLayer(this.BASE_ZORDER,e);var n=this._layerView.getLayer(),i=new s.tutorial.messageWindow(n),o=new s.tutorial.highlightButton(n,this),r=new s.tutorial.mockSettingCommand,a=new s.tutorial.showSubutorial(this);this._command=[r,this._layerView,i,o,a]},startTutorial:function(e){this._currentNo=Math.max(this._tutorialProgress.loadStepNumber()-2,-1);var t=this._tutorialProgress.getCurrentStep().stepName;this.setScenario(e||s.tutorial.scenario[t]),this.nextStep(),this._layerView.getLayer().scheduleOnce(this._layerView.addTouchEventListener.bind(this._layerView,function(){var e=(this._scenarios[this._currentNo]||{}).kind;"subtutorial"!==e&&"wait"!==e&&this.nextStep()},this),1.5)},setScenario:function(e){this._scenarios=e},nextStep:function(e){this._currentNo++,!0===e&&(this._tutorialProgress.setStepNumber(this._currentNo+1),this._tutorialProgress.save());var t=this._scenarios[this._currentNo];return t?(o.isFunction(t.beforeCallback)&&t.beforeCallback(i.director.getRunningScene(),this),o.invoke(this._command,"showScenario",t),void(!0===t.skipTouch&&this.nextStep())):void this.nextSection()},nextSection:function(){return this._tutorialProgress.endSection()},getLayerView:function(){return this._layerView},dismiss:function(){this._command.forEach(function(e){o.isFunction(e.dismiss)&&e.dismiss()})}}),s.tutorial.startTutorialIfNeed=function(t){return s.createInstance("tutorialProgress").get().then(function(e){return e.isFinish()?Q.reject():e.canPlayTutorial()&&s.tutorial.helper?s.createInstance("TutorialLoader").load(t,e):(e.resetToLocalCheckPoint(),e.save(),s.createInstance("router").navigate(new s.router.TutorialNavigate(e.getCurrentStep().fragment)),n())}).then(function(e){e.startTutorial()}).fail(function(e){return e?(r.error(e),n()):Q.reject()})}}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e.Backbone;t.di.singletonDependencyList={sessionStorage:t.SessionStorage,logger:t.Logging,loader:t.Loader,soundPlayer:t.env.needSoundTouchField?t.SoundPlayerIOS:t.SoundPlayer,notificationCenter:t.NotificationCenter,sceneManager:t.SceneManager,router:t.Router,unionRouter:t.UnionRouter,routerParams:t.RouterParams,popupFactoryPopupCommon:t.PopupFactoryPopupCommon,popupFactoryTextOnly:t.PopupFactoryTextOnly,popupFactoryTextOnlyVariableSize:t.PopupFactoryTextOnlyVariableSize,popupFactoryIllustUp:t.PopupFactoryIllustUp,popupFactoryBlackRed:t.PopupFactoryBlackRed,popupFactoryBlackBlue:t.PopupFactoryBlackBlue,popupFactoryBlack:t.PopupFactoryBlack,popupFactoryBlue:t.PopupFactoryBlue,popupFactoryNeedStone:t.PopupFactoryNeedStone,popupFactoryBuyCheck:t.PopupFactoryBuyCheck,popupFactoryBuyResult:t.PopupFactoryBuyResult,popupFactoryStoneCheck:t.PopupFactoryStoneCheck,popupFactoryMenuList:t.PopupFactoryMenuList,popupFactoryMenu:t.PopupFactoryMenu,popupFactoryMenuBeginnerMission:t.PopupFactoryMenuBeginnerMission,popupFactoryEvBanner:t.PopupFactoryEvBanner,popupFactoryNewsA:t.PopupFactoryNewsA,popupFactoryShSummonInfo:t.PopupFactoryShSummonInfo,popupFactoryShWeaponInfo:t.PopupFactoryShWeaponInfo,popupFactoryShItemInfo:t.PopupFactoryShItemInfo,popupFactoryShPackageInfo:t.PopupFactoryShPackageInfo,popupFactoryRaQuestAppearance:t.PopupFactoryRaQuestAppearance,popupFactoryLockWaitTimeout:t.PopupFactoryLockWaitTimeout,questStateManager:t.QuestStateManager,makeRequest:t.MakeRequest,paymentRequest:t.PaymentRequest,playerGameConfig:t.PlayerGameConfig,HttpSuperAgentConnection:t.HttpSuperAgentConnection,inspectionApiDelegate:/^(?:Sandbox|Product)$/.test(t.env.mode)?t.env.isSp?t.InspectionApiDelegateSP:t.InspectionApiDelegatePC:t.MockInspectionApiDelegate,htmlBuilder:t.HtmlBuilder,voiceLoader:t.VoiceLoader,seLoader:t.SeLoader,soundEffects:t.SoundEffects,frameAnimationHelper:t.FrameAnimationHelper,enhEvoButtons:t.EnhEvoButtons,starGauge:t.StarGauge,componentCache:t.ComponentCache,tutorialProgress:t.tutorial.TutorialProgress,beginnerMissionInformationModel:t.core.model.beginnerMissionInformation,aQuestInfo:t.core.model.AQuestInfo,myselfInfoRepository:t.MyselfInfoRepository,smartBeat:t.SmartBeat,displayFilterRepository:t.DisplayFilterRepository},_.each(["Bgm","AQuestInfo","AUnions","ATutorialInfo","APanelMissions","APlayers"],function(e){t.di.singletonDependencyList["api"+e]=t.env.useApiMock?t.MockApi[e]:t.Api[e]}),t.di.protoStrategyDependencyList={Sprite:n.Sprite,LabelBMFont:n.LabelBMFont,LabelTTF:n.LabelTTF,AnimationEventHandlerCcs_1_6:t.AnimationEventHandler.Ccs_1_6,AnimationEventHandlerCcs_2_0:t.AnimationEventHandler.Ccs_2_0,SceneObject:t.SceneObject,Popup:t.Popup,ImplantedPopup:t.ImplantedPopup,PageController:t.PageController,PageControllerEx:t.PageControllerEx,ListView:t.ListView,PageView:t.PageView,ArmatureVisualEffect:t.ArmatureVisualEffect,WindowVisualEffect:t.WindowVisualEffect,DisposableAnimationNode:t.DisposableAnimationNode,HttpConnection:t.HttpConnection,HttpLoggingConnection:t.HttpLoggingConnection,HttpGadgetsConnection:t.HttpGadgetsConnection,ListManager:t.ListManager,ApGauge:t.ApGauge,CoreCardJobUI:t.CoreCardJobUI,CoreCardCharacterUI:t.CoreCardCharacterUI,CoreCardOtherCharacterUI:t.CoreCardOtherCharacterUI,CoreCardWeaponUI:t.CoreCardWeaponUI,CoreCardSummonUI:t.CoreCardSummonUI,CoreCardAccessoryUI:t.CoreCardAccessoryUI,CoreCardItemUI:t.CoreCardItemUI,CoreCardPackageItemUI:t.CoreCardPackageItemUI,CoreCardShopItemUI:t.CoreCardShopItemUI,Model:i.Model,StampList:t.StampList,Sound1Event:t.AnimationEvents.Sound1Event,Sound2Event:t.AnimationEvents.Sound2Event,Sound2EventCustom:t.AnimationEvents.Sound2EventCustom,AnimationEndEvent:t.AnimationEvents.AnimationEndEvent,BasicAvatar:t.BasicAvatar,BasicAvatarSceneObject:t.BasicAvatarSceneObject,QueryParameterDataConverter:t.QueryParameterDataConverter,SoundResourcePlayLockHandler:t.SoundResourcePlayLockHandler,ScrollBar:t.ScrollBar,ShItemInfoPopup:t.core.item.ShItemInfoPopup,ShWeaponInfoPopup:t.core.item.ShWeaponInfoPopup,ShSummonInfoPopup:t.core.item.ShSummonInfoPopup,AbilityIcon:t.view.AbilityIcon,ImplantedSubTutorialPopup:t.core.view.ImplantedSubTutorialPopup,TutorialLoader:t.tutorial.loader,QuestListRouter:t.QuestListRouter.QuestListRouter},t.Img=t.env.useUglifiedPathName?t.img:t.imgMock}((this||0).self||global),function(global){var kh=global.kh,di=global.di,cc=global.cc,_=global._,Backbone=global.Backbone;kh.dictx=di.createContext(),kh.dictx.registerWithProtoStrategy=function(e,t,n){return kh.dictx.register(e,t,n).strategy(di.strategy.proto)},kh.dictx.getObjectResolveDependency=function(e,t){return kh.dictx.has(e)?void 0===t?kh.dictx.get(e):kh.dictx.create(e,t):kh.dictx.tryCreateInstanceUnregisteredDependent(e,t)},kh.dictx.tryCreateInstanceUnregisteredDependent=function(name,args){try{var expectClass=eval(name)}catch(e){throw e}if(_.isFunction(expectClass))return kh.createInstance(expectClass,args);throw new Error("class not exist")},kh.dictx.injectDependent=function(e,t){_.each(e,function(e,t){if(void 0!==e){if(kh.dictx.has(t)){if(kh.dictx.entry(t).type()===e)return;delete kh.dictx.map[t]}kh.dictx.register(t,e)}else console.warn("[WARN] DI Singleton Class Not found: DIName= "+t)}),_.each(t,function(e,t){return void 0===e?void console.warn("[WARN] DI protoStrategy Class Not found: DIName= "+t):void(kh.dictx.has(t)&&kh.dictx.entry(t).type()===e||kh.dictx.registerWithProtoStrategy(t,e))})},kh.dictx.navigateInject={},kh.dictx.injectDependent(kh.di.singletonDependencyList,kh.di.protoStrategyDependencyList)}((this||0).self||global),function(e){var t=e.kh||{};t.tutorial=t.tutorial||{};var n={R18:[{fragment:"tu_04_sound/tu_04_sound",stepName:"tu_04_sound",checkpoint:!0},{fragment:"tu_scenario/tu_scenario",stepName:"tu_scenario_001"},{fragment:"tu_06_sound/tu_06_sound",stepName:"tu_06_sound"},{fragment:"tu_scenario/tu_scenario",stepName:"tu_scenario_002"},{fragment:"tu_scenario/tu_scenario",stepName:"tu_scenario_003",checkpoint:!0},{fragment:"tu_09_battle/tu_09_battle",stepName:"tu_09_battle"},{fragment:"tu_scenario/tu_scenario",stepName:"tu_scenario_004"},{fragment:"tu_11_battle/tu_11_battle",stepName:"tu_11_battle"},{fragment:"tu_scenario/tu_scenario",stepName:"tu_scenario_005",checkpoint:!0},{fragment:"tu_scenario/tu_scenario",stepName:"tu_scenario_006"},{fragment:"mypage/my_001",stepName:"tu_12_gacha"},{fragment:"gacha/ga_000",stepName:"tu_13_gacha"},{fragment:"gacha/ga_100",stepName:"tu_13_gacha_2",canNotCheckPoint:!0},{fragment:"gacha/ga_010",stepName:"tu_14_gacha_result",canNotCheckPoint:!0},{fragment:"party/par_001",stepName:"tu_18_party",checkpoint:!0},{fragment:"mypage/my_001",stepName:"tu_19_quest"},{fragment:"quest/q_001",stepName:"tu_20_quest"},{fragment:"quest/q_002",stepName:"tu_21_support",canNotCheckPoint:!0},{fragment:"tu_scenario/tu_scenario",stepName:"tu_scenario_007",checkpoint:!0},{fragment:"tu_24_battle/tu_24_battle",stepName:"tu_24_battle",canNotCheckPoint:!0},{fragment:"quest/q_003_1",stepName:"tu_25_result",canNotCheckPoint:!0},{fragment:"quest/q_003_2",stepName:"tu_26_result",canNotCheckPoint:!0},{fragment:"mypage/my_001",stepName:"tu_27_end"}],G:[{fragment:"tu_04_sound/tu_04_sound",stepName:"tu_04_sound",checkpoint:!0},{fragment:"tu_scenario/tu_scenario",stepName:"tu_scenario_003",checkpoint:!0},{fragment:"tu_09_battle/tu_09_battle",stepName:"tu_09_battle"},{fragment:"tu_scenario/tu_scenario",stepName:"tu_scenario_004"},{fragment:"tu_11_battle/tu_11_battle",stepName:"tu_11_battle"},{fragment:"tu_scenario/tu_scenario",stepName:"tu_scenario_005",checkpoint:!0},{fragment:"mypage/my_001",stepName:"tu_12_gacha"},{fragment:"gacha/ga_000",stepName:"tu_13_gacha"},{fragment:"gacha/ga_100",stepName:"tu_13_gacha_2",canNotCheckPoint:!0},{fragment:"gacha/ga_010",stepName:"tu_14_gacha_result",canNotCheckPoint:!0},{fragment:"party/par_001",stepName:"tu_18_party",checkpoint:!0},{fragment:"mypage/my_001",stepName:"tu_19_quest"},{fragment:"quest/q_001",stepName:"tu_20_quest"},{fragment:"quest/q_002",stepName:"tu_21_support",canNotCheckPoint:!0},{fragment:"tu_scenario/tu_scenario",stepName:"tu_scenario_007",checkpoint:!0},{fragment:"tu_24_battle/tu_24_battle",stepName:"tu_24_battle",canNotCheckPoint:!0},{fragment:"quest/q_003_1",stepName:"tu_25_result",canNotCheckPoint:!0},{fragment:"quest/q_003_2",stepName:"tu_26_result",canNotCheckPoint:!0},{fragment:"mypage/my_001",stepName:"tu_27_end"}]};t.tutorial.componentProgress=t.env.isR18?n.R18:n.G,_.each(t.tutorial.componentProgress,function(e){e.component=(e.fragment||"mypage").split("/")[0]}),t.tutorial.episodePlayList={tu_scenario_001:[{scene:"scenario",id:"100001_main"}],tu_scenario_002:[{scene:"harem",id:"100002_main"}],tu_scenario_003:[{scene:"scenario",id:"100003_main"}],tu_scenario_004:[{scene:"scenario",id:"100004_main"}],tu_scenario_005:[{scene:"scenario",id:"100005_main"}],tu_scenario_006:[{scene:"scenario",id:"100006_main"},{scene:"harem",id:"100007_main"}],tu_scenario_007:[{scene:"scenario",id:"8_main"}]}}((this||0).self||global),function(e){var t,n,i,o,r=e.kh,a=e._;function s(){}r.loader=r.createInstance("loader"),r.htmlBuilder=r.createInstance("htmlBuilder"),r.addConnectionEventListeners=function(){function e(e){return 0<e.count&&console.debug("Retry: count="+e.count+", result="+e.result),"retrying"===e.result}var t=0,n={connectionBegan:function(){console.debug("通信を開始します",arguments[0]),e(arguments[1])||(t<1&&r.postMessage("deployTouchShield"),t++)},connectionEnded:function(){console.debug("通信を終了します",arguments[0]),--t<1&&r.postMessage("removeTouchShield")},connectionFailed:function(){if(!e(arguments[2]))switch(r.createInstance("smartBeat").log("URL : "+arguments[0].url),r.createInstance("smartBeat").log("JSON : "+JSON.stringify(arguments[0].json)),r.createInstance("smartBeat").log("RESULT : "+arguments[2].result),arguments[2].result){case"giveup":console.error("reportCommunicationError-TimeOut");break;case"no_count":console.error("reportCommunicationError-RetryLimitReached");break;default:console.error("reportCommunicationError-"+arguments[0].urlOrg)}}},i=r.createInstance("notificationCenter");a.each(n,function(e,t){i.addEventListener(t,e,[])}),i=null},r.addConnectionEventListeners(),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),console.error=(o=console.error,function(e){if(void 0!==e){var t=function(e){return!a.isUndefined(e.stack)};if(!t(e)&&new RegExp(/^\[SmartBeat]/g).test(e))return;!t(e)&&a.isString(e)&&(e=new Error(e));try{t(e)?(r.createInstance("logger").reportJsException(e),t(n=e)&&r.createInstance("smartBeat").sendError(n),"Product"!==r.env.mode&&o.call(console,e)):o.call(console,e)}catch(e){console.warn("##Error##","overrided console.error"),console.warn(e.stack)}}var n}),window.onerror=function(e,t,n,i,o){return console.error(o),"Product"===r.env.mode},window.globalErrorHandler=function(e){console.warn(e.message),console.warn(e.stack),r.createInstance("logger").reportGlobalError(e)},window.CCL=(t=console,n=["lo1g","wa2rn","deb3ug","i3nfo"],i={},a.each(n,function(e){i[e]=t[e.replace(/\d+/,"")]}),{cMethods:i,c:t,save:function(){a.each(n,function(e){this.c[e.replace(/\d+/,"")]=s},this)},restore:function(){a.each(n,function(e){this.c[e.replace(/\d+/,"")]=i[e]},this)}}),"Product"!==r.env.mode||/\"consoleOn\":\s*true/.test(decodeURIComponent(location.hash))?window.CCL.restore():window.CCL.save()}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=(e.ccui,e._,e.console);t.createNameSpaceIfNotExists("core.pager.model"),t.core.pager.model.BaseList=n.Class.extend({className:"BaseList",_currentPageNumber:1,_fetchComplete:!1,_cachedModels:[],ctor:function(){},initialize:function(e){return this.changePage(1,e)},changePage:function(e,t){if("number"!=typeof e||e<1||1<e&&this.getMaxPageCount(t)<e)throw"pageNumber Invalid:"+e;return this._currentPageNumber=e,this.getPageData(e,t)},getMaxPageCount:function(e){return Math.ceil(this.getMaxRecordCount()/e)},getMaxRecordCount:function(){i.warn("MUST implement")},getExistsRecordCount:function(){return this.getMaxRecordCount()},getCurrentPageNumber:function(){return this._currentPageNumber},getCurrentPageData:function(e){return this.getPageData(this._currentPageNumber,e)},clearCache:function(){i.warn("MUST implement")},updateOption:function(e){},getPageData:function(e,t){return this._fetchComplete?this._sliceModels(e,t):void i.warn("MUST implement:Fetch処理を実装してください")},_sliceModels:function(e,t){var n=(e-1)*t;return Q.resolve(this._cachedModels.slice(n,n+t))},getAllContent:function(){return this._fetchComplete?Q.resolve(this._cachedModels.concat([])):void i.warn("MUST implement:Fetch処理を実装してください")},setSortValue:function(e){this._sortValue=e},setDisplayFilterConfig:function(e){this._filterConfig=e},dispose:function(){t.cleanupProperties(this)}})}((this||0).self||global),function(e){var o=e.kh,i=(e.khutil,e.cc,e.ccui,e._),r=e.console;o.createNameSpaceIfNotExists("core.pager.controller"),o.core.pager.controller.PagerController=o.SceneObject.extend({className:"PagerController",REFRESH_EVENT:"ListBtnsRefreshInVisible",NOTHING_NODE_NAME:"nothing_node",_pulldownEventListener:null,_refreshEventListener:null,_sortValue:null,_updateEventListeners:null,_rootWidget:null,_listParentNode:null,_pagerViews:null,_parPage:0,_initialized:!1,ctor:function(e,t,n,i){this._rootWidget=e,this._listModel=t,this._pagerViews=n||[],this._updateEventListeners=[],this._listParentNode=i},initialize:function(){return this.addUpdateEventListener(this._toggleNothingNode,this),this._refreshEventListener=o.createInstance("notificationCenter").addEventListener(this.REFRESH_EVENT,this._refreshEventHandler,this),this._parPage=this._calcParPage(),this._listModel.initialize(this._parPage).then(this._triggerUpdateEvent.bind(this)).then(function(){this._initialized=!0}.bind(this)).fail(this._errorHandling)},initialize_:function(e){return this.addUpdateEventListener(this._toggleNothingNode,this),this._refreshEventListener=o.createInstance("notificationCenter").addEventListener(this.REFRESH_EVENT,this._refreshEventHandler,this),this._parPage=this._calcParPage(),this._listModel.initialize_(this._parPage,e).then(this._triggerUpdateEvent.bind(this)).then(function(){this._initialized=!0}.bind(this)).fail(this._errorHandling)},_calcParPage:function(){return this._listParentNode.getChildren().length},getParPage:function(){return this._parPage},getMaxPageCount:function(){return this._listModel.getMaxPageCount(this.getParPage())},getCurrentPageNumber:function(){return this._listModel.getCurrentPageNumber()},setCurrentPageNumber:function(e,t){var n=this._listModel;!1===t&&n.clearCache(),n.changePage(e,this.getParPage()).then(this._triggerUpdateEvent.bind(this)).fail(this._errorHandling)},getDataList:function(){return this._listModel},setDataList:function(e){this._listModel=e},refresh:function(e){if(this._initialized){!1===e&&this.clearCache();var t=this.getParPage(),n=this._listModel;n.getCurrentPageData(t).then(function(e){return 0<e.length||1===n.getCurrentPageNumber()||0==n.getMaxPageCount(t)?e:n.changePage(n.getMaxPageCount(t),t)}).then(this._triggerUpdateEvent.bind(this)).fail(this._errorHandling)}else r.warn("refresh warn: must initialized")},clearCache:function(){this._listModel.clearCache()},restore:function(e){},show:function(){this._rootWidget.setVisible(!0)},hide:function(){this._rootWidget.setVisible(!1)},_toggleNothingNode:function(e,t){var n=this._rootWidget,i=t.getExistsRecordCount()<=0,o=n.seekWidgetByName(this.NOTHING_NODE_NAME),r=null===o||!i;this._listParentNode.getParent().setVisible(r),null!==o&&o.setVisible(i)},addUpdateEventListener:function(e,t){var n=e;n instanceof o.core.eventHandling.BaseEventHandler||(n=new o.core.eventHandling.BaseEventHandler(e,t)),this._updateEventListeners.push(n)},_triggerUpdateEvent:function(e){i.invoke(this._pagerViews,"update",e,this._listModel,this._sortValue,this),i.invoke(this._updateEventListeners,"handle",e,this._listModel,this._sortValue,this)},setPulldownSortConfig:function(e){var t;if(this._pulldownEventListener&&o.createInstance("notificationCenter").removeEventListener(this._pulldownEventListener),e.pulldownSortConfig instanceof o.PulldownSortConfig&&(t=e.pulldownSortConfig),e instanceof o.PulldownSortConfig&&(t=e),!t)throw"setPulldownSortConfig: not found kh.PulldownSortConfig";var n=this._sortValue,i=t.getSortValue();this._sortValue=i,this._initialized&&i!==n&&this.refresh(!0),this._pulldownEventListener=o.createInstance("notificationCenter").addEventListener(t.getChangeEventName(),this._changeSort,this)},_changeSort:function(e){this._sortValue=e,this.setCurrentPageNumber(1,!1)},dispose:function(){var e=o.createInstance("notificationCenter");this._pulldownEventListener&&e.removeEventListener(this._pulldownEventListener),this._refreshEventListener&&e.removeEventListener(this._refreshEventListener),o.cleanupProperties(this)},_refreshEventHandler:function(e,t){if(this._initialized){var n=this._rootWidget;if(n){for(;n;){if(!n.isVisible())return;n=n.parent}return i.isNumber(e)?void this.setCurrentPageNumber(e,!0===t):void this.refresh(!0===t)}}},_errorHandling:function(e){if(e instanceof Error)throw e.message="core.pager.controller.PagerController:"+e.message,e}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=(e.ccui,e._,e.console);t.createNameSpaceIfNotExists("core.pager.view"),t.core.pager.view.PagerView=n.Class.extend({className:"PagerView",_rootWidget:null,ctor:function(e){this._rootWidget=e},initialize:function(){i.warn("PagerView:initialize MUST implement")},setTouchEventHandler:function(e){},update:function(e,t,n){i.warn("PagerView:update MUST implement")}})}((this||0).self||global),function(e){var a=e.kh,r=(e.khutil,e.cc,e.ccui,e._);e.console,a.createNameSpaceIfNotExists("core.pager.enum");var s={REPLACE_OPTION_PAGE:"{@page}",REPLACE_OPTION_PER_PAGE:"{@perPage}"};a.core.pager.enum.API_OPTION=s;var o={FETCH_DEFAULT:2,FETCH_FIRST_ONLY:1,FETCH_ALL:2,FETCH_PER_PAGE:3,FETCH_FIVE_PAGE:4};a.core.pager.enum.FETCH_MODE=o,a.createNameSpaceIfNotExists("core.pager.model");function c(){}c.prototype.getRawData=function(){throw"未取得のデータを参照しようとした"},a.core.pager.model.ApiDataList=a.core.pager.model.BaseList.extend({className:"ApiDataList",_apiMethod:null,_apiMethodOptions:null,_modelClass:null,NOT_FETCH:-1,MAX_FIRST_FETCH_COUNT:1e5,_maxRecordCount:-1,_existsRecordCount:-1,_fetchMode:null,ctor:function(e,t,n,i){this._apiMethod=e,this._apiMethodOptions=t,this._modelClass=n,this._fetchMode="number"==typeof i?i:o.FETCH_DEFAULT},initialize:function(e){return this.getPageData(1,e)},initialize_:function(e,t){return this._currentPageNumber=t,this.getPageData(t,e)},updateOption:function(e){this._apiMethodOptions=e},getMaxRecordCount:function(){if(this._maxRecordCount===this.NOT_FETCH)throw"ERROR: Not Fetch Models";return this._maxRecordCount},getExistsRecordCount:function(){if(this._maxRecordCount===this.NOT_FETCH)throw"ERROR: Not Fetch Models";return this._existsRecordCount},getPageData:function(t,n){if(this._fetchComplete||this._hasFetchedModel(t,n))return this._sliceModels(t,n);if(this._fetchMode!==o.FETCH_FIVE_PAGE)return this._fetchMode===o.FETCH_FIRST_ONLY&&1===t||this._fetchMode===o.FETCH_PER_PAGE?this._fetch(t,n):this.getAllContent().then(function(e){return!0===this._fetchComplete?e:(this._fetchMode=o.FETCH_PER_PAGE,this._hasFetchedModel(t,n)?e:this._fetch(t,n))}.bind(this)).then(this._sliceModels.bind(this,t,n));var e=Math.ceil(t/5);return this._fetch(e,5*n).then(this._sliceModels.bind(this,t,n))},getAllContent:function(){if(this._fetchComplete)return this._super.apply(this,arguments);var e=this.MAX_FIRST_FETCH_COUNT;return this._isFetched()&&(e=this.getExistsRecordCount()),this._fetch(1,e)},_fetch:function(e,t){var n=this._apiMethodOptions.map(this._optionReplaceHandler.bind(this,e,t));return this._apiMethod.apply(null,n).then(this._updateModels.bind(this,e,t)).fail(function(e){if(e instanceof Error)throw e})},_hasFetchedModel:function(e,t){if(r.isEmpty(this._cachedModels))return!1;var n=(e-1)*t;return!r.find(this._cachedModels.slice(n,n+t),function(e){return e instanceof c})},_isFetched:function(){return this._maxRecordCount!==this.NOT_FETCH},clearCache:function(){this._fetchComplete=!1,this._cachedModels.length=0},_updateModels:function(e,t,n){this._maxRecordCount=n.body.max_record_count,this._existsRecordCount=n.body.exists_record_count||this._maxRecordCount,r.isEmpty(this._cachedModels)&&(this._cachedModels=Array(this._maxRecordCount).fill(new c));var i=t*(e-1),o=n.body.data.map(this.__updateModel.bind(this,this._cachedModels,i));return this._fetchComplete=this._hasFetchedModel(1,this._maxRecordCount),o},__updateModel:function(e,t,n,i){var o=t+i;return e[o]instanceof this._modelClass?e[o].updateRawData(n):e[o]=new this._modelClass(n),e[o]},_optionReplaceHandler:function(e,t,n){switch(n){case s.REPLACE_OPTION_PAGE:return e;case s.REPLACE_OPTION_PER_PAGE:return t;default:return n}}}),a.core.pager.model.ApiDataListFactory=function(e,t,n,i){var o=a.createInstance(e),r=o[t];if("function"!=typeof r)throw"API Method Not Found:"+e+"."+t;return i=i||a.core.pager.model.PlainData,n=n||[s.REPLACE_OPTION_PAGE,s.REPLACE_OPTION_PER_PAGE],new a.core.pager.model.ApiDataList(r.bind(o),n,i)}}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc,e.ccui,e._),i=e.console;t.createNameSpaceIfNotExists("core.pager.model"),t.core.pager.model.PlainDataList=t.core.pager.model.BaseList.extend({className:"PlainDataList",_fetchComplete:!0,ctor:function(e){return n.isArray(e)?void(this._cachedModels=e.map(function(e){return new t.core.pager.model.PlainData(e)})):void i.error("PlainDataList construct need array",e)},getMaxRecordCount:function(){return this._cachedModels.length},clearCache:function(){}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=(e.ccui,e._),o=e.console;t.createNameSpaceIfNotExists("core.pager.model"),t.core.pager.model.PlainData=n.Class.extend({className:"PlainData",_rawData:null,ctor:function(e){this._rawData=e},getRawData:function(){return JSON.parse(JSON.stringify(this._rawData))},updateRawData:function(e){this._rawData=JSON.parse(JSON.stringify(e))},equal:function(e){return e.className!==this.className?(o.warn("異なるModel定義同士で比較が行われています",e,this),!1):i.isEqual(this._rawData,e.getRawData())},dispose:function(){this._rawData=null,t.cleanupProperties(this)}})}((this||0).self||global),function(e){var s=e.kh,i=e.khutil,o=e.cc,r=e.ccui,c=e._;e.console,s.createNameSpaceIfNotExists("core.pager.view.page"),s.core.pager.view.page.CoreCardUi=s.core.pager.view.PagerView.extend({className:"CoreCardUi",_isFillEmptyRecord:!1,_coreCardActionName:null,_touchHandler:null,_lastPageModels:null,ctor:function(e,t,n){if(!(e instanceof o.Node))throw"coreCardUiParent : must instenceOf cc.Node";if(t&&"string"!=typeof t)throw"coreCardDIName : must type String:"+t;this._coreCardDIName=t,n=n||{},this._isFillEmptyRecord=!0===n.isFillEmptyRecord,this._coreCardActionName=n.actionName,this.setTouchEventHandler(n.touchHandler),this._super(e)},isFillEmptyRecord:function(){return this._isFillEmptyRecord},setTouchEventHandler:function(e){this._touchHandler=e},update:function(e,t,n){this._rootWidget&&!this._rootWidget.dispose&&(!this._coreCardDIName&&0<e.length&&(this._coreCardDIName=i.getCoreCardDINameByRecord(e[0].getRawData())),this._getCoreCardUINodes().forEach(this._updateOne.bind(this,e,n)),this._lastPageModels=e)},_getCoreCardUINodes:function(){return this._rootWidget.getChildren()},_updateOne:function(e,t,n,i){var o=e[i];if(o&&!1!==o.getRawData().is_owned){var r=this._createOrGetCoreCardUI(n,i);r.getResult().parent.setVisible(!0),r.initAction(this._coreCardActionName),r.setData(o.getRawData(),t),r.setVisible(!0),n.setVisible(!0)}else this._hideItem(n,i)},_hideItem:function(e,t){this._createOrGetCoreCardUI(e,t).setVisible(!1),e.setVisible(this.isFillEmptyRecord())},_createOrGetCoreCardUI:function(e,t){var n=e.getUserData();if(n instanceof s.CoreCardUI)return n;var i=e.seekWidgetByName("corecard_ui");if(!i)throw'NotFound "corecard_ui":'+this._rootWidget.name;var o,r={handler:this._touchHandler,view:this,index:t},a=c.find(i.getChildren(),function(e){return e.getActionByTag(e.tag)});return a?(o=this._createCoreCardUI(e,a),void(r.coreCardUI=o).addTouchEventListener(this._touchEvent,r)):((o=this._createCoreCardUI(e)).loadResource(o.UI_JSON_NAME),i.addChild(o.getResult()),(r.coreCardUI=o).addTouchEventListener(this._touchEvent,r),o)},_createCoreCardUI:function(e,t){var n=s.createInstance(this._coreCardDIName,[this._coreCardActionName,t]);if(!(n instanceof s.CoreCardUI))throw"Wrong DI Name => コアカードクラスではありません:"+this._coreCardDIName;return e.setUserData(n),n},_touchEvent:function(e,t){if(t===r.Widget.TOUCH_ENDED){var n=this.view,i=n._lastPageModels&&n._lastPageModels[this.index];if(n._touchHandler&&i){var o=this.coreCardUI;n._createHandler(n._touchHandler).handle(i,o,this.index)}}},_createHandler:function(e){switch(typeof e){case"string":return s.createInstance(e);case"object":return e;default:throw{message:"Invaild TouchEventHandler",context:e}}}})}((this||0).self||global),function(e){var n=e.kh;e.khutil,e.cc,e.ccui,e._,e.console,n.createNameSpaceIfNotExists("core.pager.view.page"),n.core.pager.view.page.BasePageUi=n.core.pager.view.PagerView.extend({className:"BasePageUi",ctor:function(e){this._rootWidget=e},update:function(i,e,t,o){this._rootWidget.getChildren().forEach(function(e,t){var n=i[t];return n?(this._updateOne(e,n,o),void e.setVisible(!0)):void e.setVisible(!1)}.bind(this))},_updateOne:function(e,t,n){}}),n.core.pager.view.page.BasePageUiFactory=function(e,t){return new(n.core.pager.view.page.BasePageUi.extend({_updateOne:t}))(e)}}((this||0).self||global),function(e){var o=e.kh,t=e.khutil,i=(e.cc,e.ccui),r=e._,n=e.console;o.createNameSpaceIfNotExists("core.pager.view.button"),o.core.pager.view.button.ViewPageUi=o.SceneObject.extend({className:"ViewPageUi",_rootWidget:null,_pagerController:null,_initialized:!1,ctor:function(e,t){this._rootWidget=e,this._pagerController=t},WIDGET_NAMES:{FIRST_BUTTON:"btn_page_back_tip",LAST_BUTTON:"btn_page_next_tip",PAGE_NUMBER_BUTTON:"page_btn_{pageIndex}"},APPEARANCE_NAMES:{BUTTON_VISIBILITY:"animation_{index}"},initialize:function(e){return this._initialized&&!e||(this._initControls(),this._pagerController.addUpdateEventListener(this._updateControlStatus,this),this._initialized=!0),this},getMaxPageCount:function(){return this._pagerController.getMaxPageCount()},getCurrentPageNumber:function(){return this._pagerController.getCurrentPageNumber()},show:function(){this._rootWidget.setVisible(!0)},hide:function(){this._rootWidget.setVisible(!1)},_initControls:function(){this._firstPageButton=this._initGotoFirstPageButton(),this._lastPageButton=this._initGotoLastPageButton(),this._pageNumberButtons=this._initPageNumberButtons(),this._pageNumberButtonCount=r.keys(this._pageNumberButtons).length},_gotoPage:function(e){this._pagerController.setCurrentPageNumber(e)},_updateControlStatus:function(){if(!this._rootWidget.disposed){if(0===this.getMaxPageCount())return void this.hide();this.show(),this._updatePageNumberButtonVisibility(),this._updateButtonNumbers(),this._updatePageNumberButtonSelectedStatus(),this._updateFirstButtonEnabledState(),this._updateLastButtonEnabledState()}},_updatePageNumberButtonVisibility:function(){var e=Math.min(this.getMaxPageCount(),this._pageNumberButtonCount)-1;e=Math.max(0,e);var t=this.APPEARANCE_NAMES.BUTTON_VISIBILITY.replace("{index}",e.toString());this._rootWidget.setAppearance(t)},_updateButtonNumbers:function(){var e=Math.min(this._pageNumberButtonCount,this.getMaxPageCount()),t=Math.floor(e/2),i=Math.max(1,this.getCurrentPageNumber()-t);i=Math.min(i,this.getMaxPageCount()-e+1),r.each(this._pageNumberButtons,function(e,t){var n=parseInt(t)+i;e.setTitleText(n.toString()),e.setUserData(n)})},_updateFirstButtonEnabledState:function(){var e=1<this.getCurrentPageNumber();this._firstPageButton.setEnabled(e),this._firstPageButton.setBright(e)},_updateLastButtonEnabledState:function(){var e=this.getCurrentPageNumber()<this.getMaxPageCount();this._lastPageButton.setEnabled(e),this._lastPageButton.setBright(e)},_updatePageNumberButtonSelectedStatus:function(){var n=this.getCurrentPageNumber();r.each(this._pageNumberButtons,function(e){var t=e.getUserData()===n;e.setEnabled(!t),e.setBright(!t)})},_onPageButtonClick:function(e,t){if(t===i.Widget.TOUCH_ENDED){var n=e.getUserData();this._gotoPage(n)}},_onFirstPageButtonClick:function(e,t){t===i.Widget.TOUCH_ENDED&&this._gotoPage(1)},_onLastPageButtonClick:function(e,t){t===i.Widget.TOUCH_ENDED&&this._gotoPage(this.getMaxPageCount())},_initGotoFirstPageButton:function(){var e=t.getWidgetFromNode(this._rootWidget,this.WIDGET_NAMES.FIRST_BUTTON,function(e){n.warn(this.className+": "+e)}.bind(this));return e.addTouchEventListener(this._onFirstPageButtonClick,this),e.setSound(o.SoundList.BUTTON_TOUCHED_SWITCH),e},_initGotoLastPageButton:function(){var e=t.getWidgetFromNode(this._rootWidget,this.WIDGET_NAMES.LAST_BUTTON,function(e){n.warn(this.className+": "+e)}.bind(this));return e.addTouchEventListener(this._onLastPageButtonClick,this),e.setSound(o.SoundList.BUTTON_TOUCHED_SWITCH),e},_initPageNumberButtons:function(){var i=this.WIDGET_NAMES.PAGE_NUMBER_BUTTON.replace("{pageIndex}","");return r.transform(this._rootWidget.getChildren(),function(e,t){var n=t.getName();-1!==n.indexOf(i)&&((e[parseInt(n.replace(/[^\d]/g,""))]=t).addTouchEventListener(this._onPageButtonClick,this),t.setSound(o.SoundList.BUTTON_TOUCHED_SWITCH))}.bind(this),{})}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("core.pager.view.button"),t.core.pager.view.button.ChangePageUi=n.Class.extend({className:"ChangePageUi",ctor:function(e){}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc,e.ccui,e._),a=e.console;t.createNameSpaceIfNotExists("core.pager.controller"),t.core.pager.controller.SelectablePagerController=t.core.pager.controller.PagerController.extend({className:"SelectablePagerController",_maxSelectCount:null,_canDeselect:null,_selectedModels:null,_selectEventHandlers:null,ctor:function(e,t,n,i,o,r){return"number"!=typeof o?void a.error("MUST: maxSelectCount is Number",o):(this._maxSelectCount=o,this._canDeselect=r,this._selectedModels=[],this._selectEventHandlers=[],void this._super(e,t,n,i))},getSelectedData:function(){return[].concat(this._selectedModels)},getSelectNumber:function(t){return n.findIndex(this._selectedModels,function(e){return t.equal(e)})+1},addSelectEventHandler:function(e,t,n){if("function"!=typeof e)throw this.className+".addSelectEventHandler: MUST callback Function "+e;this._selectEventHandlers.push({callback:e,context:t||this,expandData:n||{}})},_selectEventHandler:function(t){this._selectEventHandlers.forEach(function(e){e.callback.call(e.context,t,this,e.expandData)})},isOnly:function(){return 1===this._maxSelectCount},canDeselect:function(){return this._canDeselect},isFillSelected:function(){return this._maxSelectCount<=this.getSelectedData().length},toggleSelect:function(e){var t=this.getSelectNumber(e);return t<=0?this._select(e):!this.canDeselect()||(this._deselect(e,t),!1)},_select:function(e){return!(!this.isOnly()&&this.isFillSelected()||(this.isOnly()?this._selectedModels=[e]:this._selectedModels.push(e),this._selectEventHandler(e),this.refresh(),0))},_deselect:function(e,t){this._selectedModels.splice(t-1,1),this._selectEventHandler(e),this.refresh()},refresh:function(e,t){!0===t&&this.clearSelect(),this._super(e)},clearSelect:function(){this._selectedModels=[]}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc,e.ccui,e._);e.console,t.createNameSpaceIfNotExists("core.pager.view.page"),t.core.pager.view.page.SelectableCoreCardUi=t.core.pager.view.page.CoreCardUi.extend({className:"SelectableCoreCardUi",_controller:null,_showDetailMode:null,_updateOne:function(e,t,n,i){if(this._super.apply(this,arguments),n.isVisible()){var o=e[i],r=this._controller,a=this._createOrGetCoreCardUI(n,i),s=r.getSelectNumber(o);return this.isShowDetail()&&a.showDetailButton(0<s&&o,this._getDetailMode()),r.isOnly()?void a.setIconSelected(0<s):void a.setSelectNumber(s)}},isShowDetail:function(){return n.isNumber(this._getDetailMode())},_getDetailMode:function(){return this._showDetailMode},setDetailMode:function(e){return n.isNumber(e)?void(this._showDetailMode=e):void(this._showDetailMode=null)},setPagerController:function(e){this._controller=e}})}((this||0).self||global),function(e){var t=e.kh;e.khutil,e.cc,e.ccui,e._,e.console,t.createNameSpaceIfNotExists("core.pager.controller"),t.core.pager.controller.ScrollablePagerController=t.core.pager.controller.PagerController.extend({className:"ScrollablePagerController",ctor:function(e,t,n){}})}((this||0).self||global),function(e){var s=e.kh,c=(e.khutil,e.cc,e.ccui,e._,e.console);s.createNameSpaceIfNotExists("core.pager.controller"),s.core.pager.controller.CoreCardSelectablePagerController=s.core.pager.controller.SelectablePagerController.extend({className:"CoreCardSelectablePagerController",ctor:function(e,t,n,i,o,r,a){return o instanceof s.core.pager.view.page.SelectableCoreCardUi?"number"!=typeof r?void c.error("MUST: maxSelectCount is Number",r):(o.setPagerController(this),o.setTouchEventHandler(new s.core.eventHandling.BaseEventHandler(this.toggleSelect,this)),this._super(e,t,n,i,r,a),void this._pagerViews.push(o)):void c.error("MUST: coreCardUiView instanceof kh.core.pager.view.page.SelectableCoreCardUi",o&&o.toString())},_selectEventHandler:function(t,n){this._selectEventHandlers.forEach(function(e){e.callback.call(e.context,t,n,e.expandData)})}})}((this||0).self||global),function(e){function c(e,t){switch(typeof t.panelName){case"string":return e.seekWidgetByName(t.panelName);case"object":return t.panelName;default:var n=/^corecard_blank_.+_ui/,i=e.seekWidgets(function(e){return n.test(e.getName())})[0];if(!i)throw"Not Found PanelNode:"+t.baseName;return _.warn("HelperCoreCardListUI:RECOMMEND("+t.baseName+"): listArgs.panelName = "+i.getName()),i}}var u=e.kh,l=e.khutil,h=(e.cc,e.ccui,e._),_=e.console;u.createNameSpaceIfNotExists("core.pager.helper"),$staticRes(res["core-pages-sort_list_0_ui"]),u.core.pager.helper.coreCardListUI=function(e,t,n,i){var o=function(e,t){switch(typeof t.baseName){case"string":var n=e.seekWidgetByPath(t.baseName);return n||(_.warn("HelperCoreCardListUI:Waning: listArgs.baseName => Not Found"),e);case"object":return t.baseName;default:return _.warn("HelperCoreCardListUI:RECOMMEND: listArgs.baseName = ?"),e}}(e,t),r=i||u.core.pager.model.ApiDataListFactory(t.apiName,t.apiMethod,t.apiParams,t.apiModel),a=0<t.maxSelectCount?function(e,t,n,i){var o=c(e,t),r=new u.core.pager.view.page.SelectableCoreCardUi(o,t.cardType&&l.getCoreCardDINameByKind(t.cardType),{actionName:t.cardFrame,isFillEmptyRecord:t.isFillEmptyRecord});h.isNumber(t.showDetailMode)&&r.setDetailMode(t.showDetailMode);var a=!!h.isUndefined(t.canDeselect)||t.canDeselect,s=new u.core.pager.controller.CoreCardSelectablePagerController(e,i,[],e.seekWidgetByName("list_blank_0").getParent(),r,t.maxSelectCount,a);return n&&s.addSelectEventHandler(n),s}(o,t,n,r):function(e,t,n,i){var o=c(e,t),r=new u.core.pager.view.page.CoreCardUi(o,t.cardType&&l.getCoreCardDINameByKind(t.cardType),{actionName:t.cardFrame,touchHandler:n,isFillEmptyRecord:t.isFillEmptyRecord});return new u.core.pager.controller.PagerController(e,i,[r],e.seekWidgetByName("list_blank_0").getParent())}(o,t,n,r),s=o.seekWidgetByName(t.viewPageUiNodeName||"viewpage_ui");s&&new u.core.pager.view.button.ViewPageUi(s,a).initialize();return function(e,t,n,i){if(i.sortKey||i.sortArgs){var o=u.createInstance("PulldownSortConfig"),r=h.extend({sortValue:"attack_desc",sortButton:"btn_sort",sortLabel:"sort_label",sortMenuBase:"sortlist",sortChoice:"core-pages-sort_list_0_ui",parentNodeName:t,changeEventName:i.sortEvent||"pulldown_sort_config"},i);o.init(i.sortArgs||r,i.sortConfig).then(n.setPulldownSortConfig.bind(n))}}(0,o,a,t),a}}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("core.eventHandling"),t.core.eventHandling.BaseEventHandler=n.Class.extend({className:"BaseEventHandler",_callback:null,_context:null,ctor:function(e,t){this._callback=e,this._context=t},handle:function(){if(!this._callback)throw"must implement";this._callback.apply(this._context,arguments)}})}((this||0).self||global),function(e){var t=e.kh,r=(e.khutil,e.cc,e.ccui),a=e._,n=e.console;t.createNameSpaceIfNotExists("core.pager.view.page"),t.core.pager.view.page.ScrollPageLayer=r.Widget.extend({_perPage:3,ctor:function(e,t,n,i){this._super(),this._node=e,this._perPage=e.getChildren().length,this._initRecordFunc=t,this.setAnchorPoint(0,-1),this.setTouchEnabled(!1),a.isObject(n)&&(this._touchTargetNode=n.targetNode,this._touchEventFuncName=n.touchEventFuncName,this._sceneDelegate=i)},getPageNode:function(){return this._node},setVisible:function(e){e&&!1===this.isVisible()&&(this._node.removeFromParent(!1),this._node.appendTo(this)),this._node.setVisible(e),this._super(e)},seekWidgetByName:function(){return this._node.seekWidgetByName.apply(this._node,arguments)},seekWidgetByPath:function(){return this._node.seekWidgetByPath.apply(this._node,arguments)},seekWidgets:function(){return this._node.seekWidgets.apply(this._node,arguments)},setRecords:function(e,t){for(var n=0;n<this._perPage;n++)this.setRecord(e[t+n],t+n)},setRecord:function(i,e){var t,o=this.getPageNode().getChildren()[e%this._perPage];if(a.isEmpty(i))o.setVisible(!1);else if(a.isFunction(this._initRecordFunc)&&this._initRecordFunc(o,i,e),o.setVisible(!0),this._touchEventFuncName)return null===(t=a.isUndefined(this._touchTargetNode)?o:o.seekWidgetByName(this._touchTargetNode))?void n.debug("[NOTICE] Could not find touching target."+this._touchTargetNode):a.isFunction(this._sceneDelegate[this._touchEventFuncName])?void t.addTouchEventListener(function(e,t,n){n===r.Widget.TOUCH_ENDED&&this[e](o,i)}.bind(this._sceneDelegate,this._touchEventFuncName)):void n.debug("[NOTICE] Could not find touch function.")}})}((this||0).self||global);