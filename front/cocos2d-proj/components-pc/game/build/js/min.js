"use strict";!function(e){var t=e.Q;if(void 0!==t){var n=t.defer(),i=t.defer();kh.loadResourceAsset=t.all([n.promise,i.promise]);var a=document.createElement("script");a.defer=!0,a.onload=function(e){return function(){console.log("Load Complete: "+this.src),a.onload=null,a.onerror=null,e.resolve()}}(i),a.onerror=function(e){return function(t){console.log("Load Error: "+t.target.src),a.onload=null,a.onerror=null,e.reject(t)}}(i),a.src="./build/js/resourceAsset.js"+kh.versionQueryString,e.document.body.appendChild(a),e.location&&-1!==e.location.pathname.indexOf("/top/")||kh.postMessage("deployLoading"),cc._fontLoader.TYPE[".otf"]="opentype",cc.loader.load([{type:"font",name:"GameFont",srcs:["../../components/core/css/gamefont.otf"]}],function(){n.resolve()})}}((this||0).self||global);var AQuests,res={"core-btn-btn_atlas.plist":"../core/res/btn/btn_atlas.plist","core-btn-viewpage_atlas.plist":"../core/res/btn/viewpage_atlas.plist","core-btn-viewpage_ui":"../core/res/btn/viewpage_ui.json","core-corecard-corecard_acce_ui":"../core/res/corecard/corecard_acce_ui.json","core-corecard-corecard_atlas.plist":"../core/res/corecard/corecard_atlas.plist","core-corecard-corecard_blank_5_4_ui":"../core/res/corecard/corecard_blank_5_4_ui.json","core-corecard-corecard_blank_6_3_ui":"../core/res/corecard/corecard_blank_6_3_ui.json","core-corecard-corecard_chara_ui":"../core/res/corecard/corecard_chara_ui.json","core-corecard-corecard_item_ui":"../core/res/corecard/corecard_item_ui.json","core-corecard-corecard_job_ui":"../core/res/corecard/corecard_job_ui.json","core-corecard-corecard_npc_ui":"../core/res/corecard/corecard_npc_ui.json","core-corecard-corecard_summon_ui":"../core/res/corecard/corecard_summon_ui.json","core-corecard-corecard_weapon_ui":"../core/res/corecard/corecard_weapon_ui.json","core-font-attack_big.fnt":"../core/res/font/attack_big.fnt","core-font-hp_big.fnt":"../core/res/font/hp_big.fnt","core-font-item_get_num.fnt":"../core/res/font/item_get_num.fnt","core-font-my_header_power_no.fnt":"../core/res/font/my_header_power_no.fnt","core-font-my_header_rank_no.fnt":"../core/res/font/my_header_rank_no.fnt","core-icon-abilityicon.plist":"../core/res/icon/abilityicon.plist","core-icon-battletypeicon.plist":"../core/res/icon/battletypeicon.plist","core-icon-elementicon.plist":"../core/res/icon/elementicon.plist","core-icon-rarityicon.plist":"../core/res/icon/rarityicon.plist","core-icon-treasureicon.plist":"../core/res/icon/treasureicon.plist","core-icon-weapontypeicon.plist":"../core/res/icon/weapontypeicon.plist","core-introduce-introduce.plist":"../core/res/introduce/introduce.plist","core-introduce_acce-introduce_acce_atlas.plist":"../core/res/introduce/introduce_acce/introduce_acce_atlas.plist","core-menu-menu_atlas_0.plist":"../core/res/menu/menu_atlas_0.plist","core-menu-menu_ui":"../core/res/menu/menu_ui.json","core-menu-menu_ui_beginner_mission":"../core/res/menu/menu_ui_beginner_mission.json","core-battletype_text-battletype_text_atlas.plist":"../core/res/pages/battletype_text/battletype_text_atlas.plist","core-pages-bg_01.jpg":"../core/res/pages/bg_01.jpg","core-pages-bg_beige.jpg":"../core/res/pages/bg_beige.jpg","core-pages-core_gauge_atlas.plist":"../core/res/pages/core_gauge_atlas.plist","core-element_img-element_img_atlas.plist":"../core/res/pages/element_img/element_img_atlas.plist","core-enh_ani-ani_levelup_plate":"../core/res/pages/enh_ani/ani_levelup_plate.json","core-enh_ani-enh_ani_atlas.plist":"../core/res/pages/enh_ani/enh_ani_atlas.plist","core-enh_ani-se_levelup_0001.mp3":"../core/res/pages/enh_ani/se_levelup_0001.mp3","core-pages-mainparts_atlas.plist":"../core/res/pages/mainparts_atlas.plist","core-pages-mainparts_star_gauge_ui":"../core/res/pages/mainparts_star_gauge_ui.json","core-raid_btn-raid_atlas.plist":"../core/res/pages/raid_btn/raid_atlas.plist","core-raid_btn-raid_ui":"../core/res/pages/raid_btn/raid_ui.json","core-pages-sort_0_ui":"../core/res/pages/sort_0_ui.json","core-pages-sort_list_0_ui":"../core/res/pages/sort_list_0_ui.json","core-pages-subparts_atlas.plist":"../core/res/pages/subparts_atlas.plist","core-popup-base_popup.png":"../core/res/popup/base_popup.png","core-popup-btn":"../core/res/popup/btn.json","core-popup-com_back_check":"../core/res/popup/com_back_check.json","core-popup-com_edit_stamp_page_ui":"../core/res/popup/com_edit_stamp_page_ui.json","core-popup-com_illust_up":"../core/res/popup/com_illust_up.json","core-popup-gud_sh_sort_ui":"../core/res/popup/gud_sh_sort_ui.json","core-popup-illustup_base.png":"../core/res/popup/illustup_base.png","core-popup-illustup_bg.png":"../core/res/popup/illustup_bg.png","core-popup-menu_list":"../core/res/popup/menu_list.json","core-popup-my_001_news_a":"../core/res/popup/my_001_news_a.json","core-popup-my_001_news_btn_ui":"../core/res/popup/my_001_news_btn_ui.json","core-popup-my_banner_list_ui":"../core/res/popup/my_banner_list_ui.json","core-popup-my_banner_page_ui":"../core/res/popup/my_banner_page_ui.json","core-popup-my_ev_banner":"../core/res/popup/my_ev_banner.json","core-popup-popup_base_0000.plist":"../core/res/popup/popup_base_0000.plist","core-popup-popup_btn_0000.plist":"../core/res/popup/popup_btn_0000.plist","core-popup-popup_common":"../core/res/popup/popup_common.json","core-popup-popup_icon_0000.plist":"../core/res/popup/popup_icon_0000.plist","core-popup_layer-acce_allsell_enhance_check_result_a":"../core/res/popup/popup_layer/acce_allsell_enhance_check_result_a.json","core-popup_layer-acce_allsell_enhance_check_result_b":"../core/res/popup/popup_layer/acce_allsell_enhance_check_result_b.json","core-popup_layer-acce_detail_effect_list_ui":"../core/res/popup/popup_layer/acce_detail_effect_list_ui.json","core-popup_layer-acce_detail_effect_page_ui":"../core/res/popup/popup_layer/acce_detail_effect_page_ui.json","core-popup_layer-acce_detail_protection_on_off":"../core/res/popup/popup_layer/acce_detail_protection_on_off.json","core-popup_layer-acce_info":"../core/res/popup/popup_layer/acce_info.json","core-popup_layer-acce_info_effect_ui":"../core/res/popup/popup_layer/acce_info_effect_ui.json","core-popup_layer-acce_non_offer":"../core/res/popup/popup_layer/acce_non_offer.json","core-popup_layer-acce_protection_btn_ui":"../core/res/popup/popup_layer/acce_protection_btn_ui.json","core-popup_layer-acce_raritybar_ui":"../core/res/popup/popup_layer/acce_raritybar_ui.json","core-popup_layer-acce_release_check":"../core/res/popup/popup_layer/acce_release_check.json","core-popup_layer-acce_remove_check":"../core/res/popup/popup_layer/acce_remove_check.json","core-popup_layer-acce_sale_price_ui":"../core/res/popup/popup_layer/acce_sale_price_ui.json","core-popup_layer-acce_sell_check":"../core/res/popup/popup_layer/acce_sell_check.json","core-popup_layer-acce_sell_result":"../core/res/popup/popup_layer/acce_sell_result.json","core-popup_layer-acce_set":"../core/res/popup/popup_layer/acce_set.json","core-popup_layer-com_filter_chara":"../core/res/popup/popup_layer/com_filter_chara.json","core-popup_layer-com_filter_element_ui":"../core/res/popup/popup_layer/com_filter_element_ui.json","core-popup_layer-com_filter_other":"../core/res/popup/popup_layer/com_filter_other.json","core-popup_layer-com_filter_rarity_ui":"../core/res/popup/popup_layer/com_filter_rarity_ui.json","core-popup_layer-enh_use_expitem":"../core/res/popup/popup_layer/enh_use_expitem.json","core-popup_layer-enh_use_expitem_confirm":"../core/res/popup/popup_layer/enh_use_expitem_confirm.json","core-popup_layer-popup_layer_atlas_0.plist":"../core/res/popup/popup_layer/popup_layer_atlas_0.plist","core-popup_layer-popup_layer_corecard_blank_5_2_ui":"../core/res/popup/popup_layer/popup_layer_corecard_blank_5_2_ui.json","core-popup_layer-popup_layer_corecard_blank_5_4_ui":"../core/res/popup/popup_layer/popup_layer_corecard_blank_5_4_ui.json","core-popup_layer-sh_hp_attack_base.png":"../core/res/popup/popup_layer/sh_hp_attack_base.png","core-popup_layer-sh_summon_base.png":"../core/res/popup/popup_layer/sh_summon_base.png","core-popup_layer-sh_weapon_base.png":"../core/res/popup/popup_layer/sh_weapon_base.png","core-popup_layer-sub_tutorial":"../core/res/popup/popup_layer/sub_tutorial.json","core-popup-ra_quest_appearance":"../core/res/popup/ra_quest_appearance.json","core-popup-sh_buy_check":"../core/res/popup/sh_buy_check.json","core-popup-sh_buy_result":"../core/res/popup/sh_buy_result.json","core-popup-sh_item_info":"../core/res/popup/sh_item_info.json","core-popup-sh_stone_check":"../core/res/popup/sh_stone_check.json","core-popup-sh_summon_info":"../core/res/popup/sh_summon_info.json","core-popup-sh_weapon_info":"../core/res/popup/sh_weapon_info.json","core-popup-sub_tutorial_page_ui":"../core/res/popup/sub_tutorial_page_ui.json","core-popup-text_button_only":"../core/res/popup/text_button_only.json","core-quest_select-quest_select_atlas.plist":"../core/res/quest_select/quest_select_atlas.plist","core-quest_select-quest_select_ui":"../core/res/quest_select/quest_select_ui.json","core-sort-sort_list_ui":"../core/res/sort/sort_list_ui.json","core-headerparts-headerparts_atlas.plist":"../core/res/ui_main/headerparts/headerparts_atlas.plist","core-headerparts-headerparts_ui":"../core/res/ui_main/headerparts/headerparts_ui.json","core-mainmenu-mainmenu_atlas.plist":"../core/res/ui_main/mainmenu/mainmenu_atlas.plist","core-mainmenu-mainmenu_enhance_ui":"../core/res/ui_main/mainmenu/mainmenu_enhance_ui.json","core-mainmenu-mainmenu_gacha_ui":"../core/res/ui_main/mainmenu/mainmenu_gacha_ui.json","core-mainmenu-mainmenu_menu_ui":"../core/res/ui_main/mainmenu/mainmenu_menu_ui.json","core-mainmenu-mainmenu_mypage_ui":"../core/res/ui_main/mainmenu/mainmenu_mypage_ui.json","core-mainmenu-mainmenu_party_ui":"../core/res/ui_main/mainmenu/mainmenu_party_ui.json","core-mainmenu-mainmenu_quest_normal_ui":"../core/res/ui_main/mainmenu/mainmenu_quest_normal_ui.json","core-mainmenu-mainmenu_quest_raid_ui":"../core/res/ui_main/mainmenu/mainmenu_quest_raid_ui.json","core-mainmenu-mainmenu_raid_particle.plist":"../core/res/ui_main/mainmenu/mainmenu_raid_particle.plist","core-mainmenu-mainmenu_ui":"../core/res/ui_main/mainmenu/mainmenu_ui.json","core-mainmenu-mainmenu_union_ui":"../core/res/ui_main/mainmenu/mainmenu_union_ui.json","core-submenu-submenu_ui":"../core/res/ui_main/submenu/submenu_ui.json","acce-acce_002_003_005-acce_002_003_005":"../acce/res/acce_002_003_005/acce_002_003_005.json","acce-acce_007_008-acce_007_008":"../acce/res/acce_007_008/acce_007_008.json","acce-acce_010-acce_010":"../acce/res/acce_010/acce_010.json","acce-acce_atlas_0.plist":"../acce/res/acce_atlas_0.plist","acce-acce_atlas_1.plist":"../acce/res/acce_atlas_1.plist","acce-acce_btn_ui":"../acce/res/acce_btn_ui.json","acce-acce_effect_list_ui":"../acce/res/acce_effect_list_ui.json","acce-acce_effect_page_ui":"../acce/res/acce_effect_page_ui.json","acce-acce_header_label_ui":"../acce/res/acce_header_label_ui.json","acce-acce_nothing_label_ui":"../acce/res/acce_nothing_label_ui.json","acce-acce_popup_ui":"../acce/res/acce_popup_ui.json","acce-acce_select_label_ui":"../acce/res/acce_select_label_ui.json","acce-se_mix_0001.mp3":"../acce/res/se_mix_0001.mp3","acce-se_mix_great_0001.mp3":"../acce/res/se_mix_great_0001.mp3","core-btn-btn_tab_two_ui":"../core/res/btn/btn_tab_two_ui.json","core-popup_layer-autospend_error":"../core/res/popup/popup_layer/autospend_error.json","core-popup_layer-autospend_hint":"../core/res/popup/popup_layer/autospend_hint.json","core-popup_layer-autospend_result":"../core/res/popup/popup_layer/autospend_result.json","autospend-autospend_001-autospend_001":"../autospend/res/autospend_001/autospend_001.json","autospend-autospend_atlas.plist":"../autospend/res/autospend_atlas.plist","autospend-autospend_popup_ui":"../autospend/res/autospend_popup_ui.json",battle_ui_base_json:"../battle/res/battle_ui/a_q_001.json",battle_ui_plist_0:"../battle/res/battle_ui/a_q_001_atlas_0.plist",battle_ui_plist_1:"../battle/res/battle_ui/a_q_001_atlas_1.plist",battle_ui_plist_2:"../battle/res/battle_ui/a_q_001_atlas_2.plist",battle_ui_plist_3:"../battle/res/battle_ui/a_q_001_atlas_3.plist",battle_ui_enemy_hud_l_ui:"../battle/res/battle_ui/a_q_001_enemy_hud_l_ui.json",battle_ui_enemy_hud_s_ui:"../battle/res/battle_ui/a_q_001_enemy_hud_s_ui.json",battle_ui_element_plist:"../battle/res/battle_ui/a_q_001_atlas_element.plist",battle_ui_character_card:"../battle/res/battle_ui/battlecard_chara_ui.json",battle_ui_summon_card:"../battle/res/battle_ui/battlecard_summon_ui.json",battle_ui_status_panel:"../battle/res/battle_ui/a_q_001_battle_status_ui.json",battle_ui_footer_buttons:"../battle/res/battle_ui/a_q_001_footer_btn_ui.json",battle_ui_cutin_burst_plist:"../battle/res/battle_ani/cutin_burst/battle_direct_burst_0.plist",battle_ui_font_burst:"../battle/res/battle_ui/battlecard-text_burst.fnt",battle_ui_font_hp:"../battle/res/battle_ui/battlecard-text_hp.fnt",battle_ui_font_summon:"../battle/res/battle_ui/battle_summon_text.fnt",battle_ui_rank_animation:"../battle/res/rank_exp_get/rank_get_ani.json",battle_ui_exp_animation:"../battle/res/rank_exp_get/exp_get_ani.json",battle_ui_turn_animation:"../battle/res/battle_ui/battle_ani_turn.json",battle_ui_rank_exp_plist:"../battle/res/rank_exp_get/Plist.plist",battle_ui_rank_font:"../battle/res/rank_exp_get/rank_no.fnt",battle_ui_exp_font:"../battle/res/rank_exp_get/exp_no.fnt",battle_ui_turn_plist:"../battle/res/battle_ui/a_q_001_atlas_0.plist",battle_ui_turn_font:"../battle/res/battle_ui/turnplate_no.fnt",battle_ui_side_bg:"../battle/res/battle_ui/battle_side_bg.png","battle_ui_battlecard-text_hp":"../battle/res/battle_ui/battlecard-text_hp.png","battle_ui_battlecard-burst_disabled":"../battle/res/battle_ui/battlecard-burst_disabled.png","battle_ui_battlecard-text_burst":"../battle/res/battle_ui/battlecard-text_burst.png",battle_ui_summon_base_l:"../battle/res/battle_ui/battle_summon_base_l.png",battle_ui_base_popup:"../core/res/popup/base_popup.png",battle_ui_turnplate_no:"../battle/res/battle_ui/turnplate_no.png",battle_ui_se_flight_mp3:"../battle/res/battle_ani/fight/se_fight.mp3",battle_effect_text_no_fnt:"../battle/res/battle_effect_text/battle_effecttext_no.fnt",battle_effect_text_no_png:"../battle/res/battle_effect_text/battle_effecttext_no.png",battle_damage_text_darkness:"../battle/res/battle_damage_text/battle_damage_text_darkness.png",battle_damage_text_flame:"../battle/res/battle_damage_text/battle_damage_text_flame.png",battle_damage_text_heal:"../battle/res/battle_damage_text/battle_damage_text_heal.png",battle_damage_text_light:"../battle/res/battle_damage_text/battle_damage_text_light.png",battle_damage_text_nonelemental:"../battle/res/battle_damage_text/battle_damage_text_nonelemental.png",battle_damage_text_thunder:"../battle/res/battle_damage_text/battle_damage_text_thunder.png",battle_damage_text_water:"../battle/res/battle_damage_text/battle_damage_text_water.png",battle_damage_text_wind:"../battle/res/battle_damage_text/battle_damage_text_wind.png",battle_damage_text_phantom:"../battle/res/battle_damage_text/battle_damage_text_phantom.png",battle_damage_text_darkness_fnt:"../battle/res/battle_damage_text/battle_damage_text_darkness.fnt",battle_damage_text_flame_fnt:"../battle/res/battle_damage_text/battle_damage_text_flame.fnt",battle_damage_text_heal_fnt:"../battle/res/battle_damage_text/battle_damage_text_heal.fnt",battle_damage_text_light_fnt:"../battle/res/battle_damage_text/battle_damage_text_light.fnt",battle_damage_text_nonelemental_fnt:"../battle/res/battle_damage_text/battle_damage_text_nonelemental.fnt",battle_damage_text_thunder_fnt:"../battle/res/battle_damage_text/battle_damage_text_thunder.fnt",battle_damage_text_water_fnt:"../battle/res/battle_damage_text/battle_damage_text_water.fnt",battle_damage_text_wind_fnt:"../battle/res/battle_damage_text/battle_damage_text_wind.fnt",battle_damage_text_phantom_fnt:"../battle/res/battle_damage_text/battle_damage_text_phantom.fnt",battle_a_q_001_ui_cure_json:"../battle/res/battle_ui/a_q_001_ui_cure.json",battle_ui_raid_plist:"../battle/res/battle_ui/a_q_003_atlas_0.plist",battle_ui_summon_popup:"../battle/res/battle_ui/a_q_001_ui_summongo.json",battle_ui_summon_broken_popup:"../battle/res/battle_ui/a_q_001_broken.json",battle_ui_ability_popup_0:"../battle/res/battle_ui/a_q_001_ui_skillgo_0.json",battle_ui_ability_popup_1:"../battle/res/battle_ui/a_q_001_ui_skillgo_1.json",battle_ui_continue_popup_0:"../battle/res/battle_ui/a_q_001_ui_continue_0.json",battle_ui_raid_back_check_popup:"../battle/res/battle_ui/a_q_003_ui_back_check.json",battle_ui_continue_popup_1:"../battle/res/battle_ui/a_q_001_ui_continue_1.json",battle_ui_continue_popup_3:"../battle/res/battle_ui/a_q_001_continue_3.json",battle_ui_menu_popup:"../battle/res/battle_ui/a_q_001_ui_menu.json",battle_log_plate_ui:"../battle/res/battle_ui/a_q_003_log_plate_ui.json",battle_ui_log:"../battle/res/battle_ui/a_q_003_ui_log.json",battle_log_list_ui:"../battle/res/battle_ui/a_q_003_log_list_ui.json",battle_ui_multimenu_popup:"../battle/res/battle_ui/a_q_003_ui_multimenu.json",battle_ui_multimenu_b_popup:"../battle/res/battle_ui/a_q_003_ui_multimenu_b.json",battle_ui_rescueconfirm_popup:"../battle/res/battle_ui/a_q_003_ui_rescueconfirm.json",battle_ui_mypage_popup:"../core/res/popup/popup_layer/a_q_001_ui_mypage_a.json",battle_ui_relief_mypage_popup:"../core/res/popup/popup_layer/a_q_001_ui_mypage_b.json",battle_ui_ranking_popup:"../core/res/popup/popup_layer/a_q_003_ui_ranking.json",battle_ranking_list:"../core/res/popup/popup_layer/a_q_003_ranking_list_ui.json",battle_player_card:"../core/res/popup/popup_layer/a_q_003_player_card_ui.json",battle_ui_stamp_popup:"../battle/res/battle_ui/a_q_003_ui_chatstamp.json",battle_post_stamp:"../battle/res/battle_ui/battle_stamp_ui.json",battle_ui_process_popup:"../battle/res/battle_ui/a_q_001_ui_process.json",battle_treasure_item:"../battle/res/battle_ani/treasure_get/tre_item.json",battle_treasure_normal:"../battle/res/battle_ani/treasure_get/tre_n.json",battle_treasure_rainbow:"../battle/res/battle_ani/treasure_get/tre_r.json",battle_treasure_silver:"../battle/res/battle_ani/treasure_get/tre_s.json",battle_treasure_gold:"../battle/res/battle_ani/treasure_get/tre_g.json",battle_treasure_plist:"../battle/res/battle_ani/treasure_get/tre_get.plist",battle_summon_effect_animation:"../battle/res/battle_ani/effect_summon/summon.json",battle_summon_effect_plist:"../battle/res/battle_ani/effect_summon/summon0.plist",battle_ability_effect_animation:"../battle/res/battle_ani/effect_ability/use_ability.json",battle_ability_effect_plist:"../battle/res/battle_ani/effect_ability/use_ability0.plist",battle_lose_animation:"../battle/res/battle_ani/win_lose/lose.json",battle_lose_plist:"../battle/res/battle_ani/win_lose/lose_0000.plist",battle_win_animation:"../battle/res/battle_ani/win_lose/win.json",battle_win_plist:"../battle/res/battle_ani/win_lose/win_0000.plist",battle_start_animation:"../battle/res/battle_ani/fight/fight.json",battle_start_animation_plist:"../battle/res/battle_ani/fight/fight0.plist",battle_effect_base_json:"../battle/res/battle_effect_base/battle_effect_base.ExportJson",battle_effect_base_plist:"../battle/res/battle_effect_base/battle_effect_base0.plist","core-popup-btn_plist":"../core/res/popup/popup_btn_0000.plist","core-popup-popup_btn_0000":"../core/res/popup/popup_btn_0000.plist","core-popup-plist":"../core/res/popup/popup_base_0000.plist","core-btn-btn_atlas":"../core/res/btn/btn_atlas.plist","core-popup_layer-com_age_limit_a":"../core/res/popup/popup_layer/com_age_limit_a.json",battle_ui_particle_plist:"../battle/res/battle_ui/particle_battle_attack.plist",battle_common_nameplate_plist:"../battle/res/battle_ani/cutin_burst/battle_common_nameplate.plist",battle_ui_raid_plist_pc:"../battle/res/battle_ui/a_q_003_atlas_0_pc.plist",battle_popup_bg:"../battle/res/battle_ui/popup.png",battle_popup_base_json:"../battle/res/battle_popup_ui.json",battle_ui_ability_window:"../battle/res/battle_ui/a_q_001_ability_window.json",battle_next_stage:"../battle/res/battle_ani/next_stage/battle_direct_nextstage_pc.json",battle_next_stage_plist:"../battle/res/battle_ani/next_stage/battle_direct_nextstage_pc.plist",battle_burst_count_animation:"../battle/res/battle_ui/battle_ani_burst_count.json",battle_burst_count_font:"../battle/res/battle_ui/burst_count_no.fnt",battle_burst_count_font_image:"../battle/res/battle_ui/burst_count_no.png",battle_standby_aura:"../battle/res/battle_ani/standby_burst/standby_burst.json",battle_standby_aura_plist:"../battle/res/battle_ani/standby_burst/standby_burst0.plist",battle_auto_button:"../battle/res/battle_ui/a_q_001_btn_auto_ui.json","core-popup_layer-a_q_001_ui_skillgo_1":"../core/res/popup/popup_layer/a_q_001_ui_skillgo_1.json","core-popup_layer-a_q_001_menu":"../core/res/popup/popup_layer/a_q_001_menu.json","core-popup_layer-a_q_001_status":"../core/res/popup/popup_layer/a_q_001_status.json","core-popup_layer-a_q_001_ui_status_list":"../core/res/popup/popup_layer/a_q_001_ui_status_list.json","core-popup_layer-a_q_001_ui_status_list_page":"../core/res/popup/popup_layer/a_q_001_ui_status_list_page.json","core-popup_layer-scoreattack_result":"../core/res/popup/popup_layer/scoreattack_result.json","core-popup_layer-party_change_popup_atlas.plist":"../core/res/popup/popup_layer/party_change_popup_atlas.plist","core-popup-popup_base_0000":"../core/res/popup/popup_base_0000.plist","core-popup-popup_icon_0000":"../core/res/popup/popup_icon_0000.plist","core-icon-abilityicon_ui":"../core/res/icon/abilityicon_ui.json","core-btn-btn_change_page_a_ui":"../core/res/btn/btn_change_page_a_ui.json","core-final_evo_btn-btn_evo_final_after_before_atlas.plist":"../core/res/pages/final_evo_btn/btn_evo_final_after_before_atlas.plist","core-final_evo_btn-btn_evo_final_after_before_ui":"../core/res/pages/final_evo_btn/btn_evo_final_after_before_ui.json","core-popup_layer-acce_data":"../core/res/popup/popup_layer/acce_data.json","core-popup_layer-sh_item_info":"../core/res/popup/popup_layer/sh_item_info.json","core-popup_layer-sh_package_item_info":"../core/res/popup/popup_layer/sh_package_item_info.json","core-popup_layer-sh_summon_info":"../core/res/popup/popup_layer/sh_summon_info.json","core-popup_layer-sh_weapon_info":"../core/res/popup/popup_layer/sh_weapon_info.json","core-headerparts-headerparts_ap-bp_ui":"../core/res/ui_main/headerparts/headerparts_ap-bp_ui.json","beginner_mission-beginner_mission_ani-beginner_mission_ani_atlas.plist":"../beginner_mission/res/beginner_mission_ani/beginner_mission_ani_atlas.plist","beginner_mission-beginner_mission_ani-reward_clear_ui":"../beginner_mission/res/beginner_mission_ani/reward_clear_ui.json","beginner_mission-beginner_mission_ani-reward_complete_ui":"../beginner_mission/res/beginner_mission_ani/reward_complete_ui.json","beginner_mission-beginner_mission_atlas.plist":"../beginner_mission/res/beginner_mission_atlas.plist","beginner_mission-beginner_mission_bg.jpg":"../beginner_mission/res/beginner_mission_bg.jpg","beginner_mission-beginner_mission_complete_reward_ui":"../beginner_mission/res/beginner_mission_complete_reward_ui.json","beginner_mission-beginner_mission_main-beginner_mission_main":"../beginner_mission/res/beginner_mission_main/beginner_mission_main.json","beginner_mission-beginner_mission_main-beginner_mission_main_list_page_ui":"../beginner_mission/res/beginner_mission_main/beginner_mission_main_list_page_ui.json","beginner_mission-beginner_mission_main-beginner_mission_main_list_ui":"../beginner_mission/res/beginner_mission_main/beginner_mission_main_list_ui.json","beginner_mission-beginner_mission_popup_ui":"../beginner_mission/res/beginner_mission_popup_ui.json","beginner_mission-beginner_mission_receive_ui":"../beginner_mission/res/beginner_mission_receive_ui.json","core-btn-btn_tab_four_ui":"../core/res/btn/btn_tab_four_ui.json","core-weapon_type_text-weapon_type_text_atlas.plist":"../core/res/pages/weapon_type_text/weapon_type_text_atlas.plist","core-popup_layer-book_request_rank":"../core/res/popup/popup_layer/book_request_rank.json","core-popup_layer-com_filter_weapon":"../core/res/popup/popup_layer/com_filter_weapon.json","book-book_001-book_001":"../book/res/book_001/book_001.json","book-book_btn_auto-setting.png":"../book/res/book_btn_auto-setting.png","book-book_orb_num_base.png":"../book/res/book_orb_num_base.png","book-book_popup_ui":"../book/res/book_popup_ui.json","core-corecard-corecard_shop_ui":"../core/res/corecard/corecard_shop_ui.json","core-icon-queststatusicon_atlas.plist":"../core/res/icon/queststatusicon_atlas.plist","core-icon-queststatusicon_ui":"../core/res/icon/queststatusicon_ui.json","core-side_navi-side_navi_0_ui":"../core/res/pages/side_navi/side_navi_0_ui.json","core-side_navi-side_navi_0_ui_atlas.plist":"../core/res/pages/side_navi/side_navi_0_ui_atlas.plist","core-popup-com_age_limit_b":"../core/res/popup/com_age_limit_b.json","core-popup-com_age_limit_b_img.png":"../core/res/popup/com_age_limit_b_img.png","core-popup-com_ap_restart":"../core/res/popup/com_ap_restart.json","core-popup-com_need_ap_bp_1":"../core/res/popup/com_need_ap_bp_1.json","core-popup-com_need_ap_bp_1_sort_ui":"../core/res/popup/com_need_ap_bp_1_sort_ui.json","core-popup-com_need_ap_bp_2":"../core/res/popup/com_need_ap_bp_2.json","core-popup-com_use_result":"../core/res/popup/com_use_result.json","core-popup_layer-com_need_item_list_ui":"../core/res/popup/popup_layer/com_need_item_list_ui.json","core-popup_layer-com_need_item_ui":"../core/res/popup/popup_layer/com_need_item_ui.json","core-popup_layer-com_no_item":"../core/res/popup/popup_layer/com_no_item.json","core-popup_layer-com_open_episode":"../core/res/popup/popup_layer/com_open_episode.json","core-popup_layer-com_raid_start_check":"../core/res/popup/popup_layer/com_raid_start_check.json","core-popup_layer-sh_buy_result":"../core/res/popup/popup_layer/sh_buy_result.json","core-popup_layer-sh_change_check":"../core/res/popup/popup_layer/sh_change_check.json","core-popup-q_001_ap_next":"../core/res/popup/q_001_ap_next.json","core-popup-q_001_select":"../core/res/popup/q_001_select.json","core-popup-q_001_story":"../core/res/popup/q_001_story.json","core-popup-q_episode_btn_ui":"../core/res/popup/q_episode_btn_ui.json","core-popup-q_info":"../core/res/popup/q_info.json","core-popup-ra_need_item":"../core/res/popup/ra_need_item.json","core-popup-ra_no_item":"../core/res/popup/ra_no_item.json","core-popup-sh_change_material_ui":"../core/res/popup/sh_change_material_ui.json","conquest-con_000-con_000":"../conquest/res/con_000/con_000.json","conquest-con_001-con_001":"../conquest/res/con_001/con_001.json","conquest-con_001_first_animation-con_001_first_ani":"../conquest/res/con_001/con_001_first_animation/con_001_first_ani.json","conquest-con_001_first_animation-con_001_first_ani_atlas.plist":"../conquest/res/con_001/con_001_first_animation/con_001_first_ani_atlas.plist","conquest-con_001_first_animation-se_ra_first_ani.mp3":"../conquest/res/con_001/con_001_first_animation/se_ra_first_ani.mp3","conquest-con_001-con_001_popup_ui":"../conquest/res/con_001/con_001_popup_ui.json","conquest-con_002-con_002":"../conquest/res/con_002/con_002.json","conquest-con_002-con_002_popup_ui":"../conquest/res/con_002/con_002_popup_ui.json","conquest-con_002-sh_exchange_ui":"../conquest/res/con_002/sh_exchange_ui.json","conquest-con_002-sh_exchangelist_list_ui":"../conquest/res/con_002/sh_exchangelist_list_ui.json","conquest-con_002-sh_exchangelist_ui":"../conquest/res/con_002/sh_exchangelist_ui.json","conquest-con_005-con_005":"../conquest/res/con_005/con_005.json","conquest-con_005-con_005_atlas.plist":"../conquest/res/con_005/con_005_atlas.plist","conquest-con_005-con_005_popup_ui":"../conquest/res/con_005/con_005_popup_ui.json","conquest-con_005-con_005_questlist":"../conquest/res/con_005/con_005_questlist.json","conquest-con_005-con_005_questlist_page_ui":"../conquest/res/con_005/con_005_questlist_page_ui.json","conquest-conquest_atlas.plist":"../conquest/res/conquest_atlas.plist","conquest-conquest_btn_scenario_ui":"../conquest/res/conquest_btn_scenario_ui.json","conquest-conquest_btn_sp-quest_ui":"../conquest/res/conquest_btn_sp-quest_ui.json","core-btn-btn_tab_three_ui":"../core/res/btn/btn_tab_three_ui.json","core-btn-btn_tab_two_sub_ui":"../core/res/btn/btn_tab_two_sub_ui.json","core-icon-statustypeicon.plist":"../core/res/icon/statustypeicon.plist","core-introduce_acce-introduce_acce_status_card_ui":"../core/res/introduce/introduce_acce/introduce_acce_status_card_ui.json","core-introduce_acce-introduce_acce_status_ui":"../core/res/introduce/introduce_acce/introduce_acce_status_ui.json","core-introduce-introduce_btn_evolution_arousal_ui":"../core/res/introduce/introduce_btn_evolution_arousal_ui.json","core-introduce_chara-introduce_chara_status_1_ui":"../core/res/introduce/introduce_chara/introduce_chara_status_1_ui.json","core-introduce_chara-introduce_chara_status_particle_0.plist":"../core/res/introduce/introduce_chara/introduce_chara_status_particle_0.plist","core-introduce_chara-introduce_chara_status_particle_1.plist":"../core/res/introduce/introduce_chara/introduce_chara_status_particle_1.plist","core-introduce-introduce_statuslist_list_7_ui":"../core/res/introduce/introduce_statuslist_list_7_ui.json","core-introduce_summon-introduce_summon_atlas.plist":"../core/res/introduce/introduce_summon/introduce_summon_atlas.plist","core-introduce_summon-introduce_summon_status_1_ui":"../core/res/introduce/introduce_summon/introduce_summon_status_1_ui.json","core-introduce_weapon-introduce_weapon_status_1_ui":"../core/res/introduce/introduce_weapon/introduce_weapon_status_1_ui.json","core-statuslist-statuslist_ability_ui":"../core/res/introduce/statuslist/statuslist_ability_ui.json","core-statuslist-statuslist_assist_ui":"../core/res/introduce/statuslist/statuslist_assist_ui.json","core-statuslist-statuslist_atlas.plist":"../core/res/introduce/statuslist/statuslist_atlas.plist","core-statuslist-statuslist_burst_ui":"../core/res/introduce/statuslist/statuslist_burst_ui.json","core-statuslist-statuslist_ex-ability_blank_ui":"../core/res/introduce/statuslist/statuslist_ex-ability_blank_ui.json","core-statuslist-statuslist_ex-ability_ui":"../core/res/introduce/statuslist/statuslist_ex-ability_ui.json","core-all_over-all_over_0_ui":"../core/res/pages/all_over/all_over_0_ui.json","core-all_over-all_over_1_ui":"../core/res/pages/all_over/all_over_1_ui.json","core-favorite_btn-btn_favorite_ui":"../core/res/pages/favorite_btn/btn_favorite_ui.json","core-favorite_btn-favorite_btn_atlas.plist":"../core/res/pages/favorite_btn/favorite_btn_atlas.plist","core-visual_change_btn-visual_change_btn_atlas.plist":"../core/res/pages/visual_change_btn/visual_change_btn_atlas.plist","core-visual_change_btn-visual_change_btn_ui":"../core/res/pages/visual_change_btn/visual_change_btn_ui.json","core-popup-ga_scene_check":"../core/res/popup/ga_scene_check.json","core-popup-p_ability_puton_off":"../core/res/popup/p_ability_puton_off.json","core-popup-p_job_get":"../core/res/popup/p_job_get.json","core-popup-p_level_bonus":"../core/res/popup/p_level_bonus.json","core-popup-p_need_point":"../core/res/popup/p_need_point.json","core-popup_layer-acce_series_hint":"../core/res/popup/popup_layer/acce_series_hint.json","core-popup_layer-acce_unlock":"../core/res/popup/popup_layer/acce_unlock.json","core-popup_layer-com_favorite_confirm":"../core/res/popup/popup_layer/com_favorite_confirm.json","core-popup_layer-com_favorite_info":"../core/res/popup/popup_layer/com_favorite_info.json","core-popup_layer-li_sumsell_check":"../core/res/popup/popup_layer/li_sumsell_check.json","core-popup_layer-li_sumsell_result":"../core/res/popup/popup_layer/li_sumsell_result.json","core-popup_layer-li_weasell_check":"../core/res/popup/popup_layer/li_weasell_check.json","core-popup_layer-li_weasell_result":"../core/res/popup/popup_layer/li_weasell_result.json","core-popup_layer-need_material_ui":"../core/res/popup/popup_layer/need_material_ui.json","core-popup_layer-visual_change_check":"../core/res/popup/popup_layer/visual_change_check.json","detail-de_001_2-de_001_2":"../detail/res/de_001_2/de_001_2.json","detail-de_003-de_003":"../detail/res/de_003/de_003.json","detail-de_004-de_004":"../detail/res/de_004/de_004.json","detail-de_chara_btn_ui":"../detail/res/de_chara_btn_ui.json","detail-de_popup_ui":"../detail/res/de_popup_ui.json","detail-de_weapon_summon_btn_ui":"../detail/res/de_weapon_summon_btn_ui.json","core-enh_ani-ani_skillup_plate":"../core/res/pages/enh_ani/ani_skillup_plate.json","core-enh_ani-se_skill_up_0001.mp3":"../core/res/pages/enh_ani/se_skill_up_0001.mp3","core-pages-sort_ui_two_pulldown":"../core/res/pages/sort_ui_two_pulldown.json","core-popup-com_need_mate":"../core/res/popup/com_need_mate.json","core-popup-com_non_offer":"../core/res/popup/com_non_offer.json","core-popup-evo_item_choose":"../core/res/popup/evo_item_choose.json","core-popup-evo_money_check":"../core/res/popup/evo_money_check.json","core-popup-focus_fla_blue.png":"../core/res/popup/focus_fla_blue.png","core-popup_layer-arousal_mate_check":"../core/res/popup/popup_layer/arousal_mate_check.json","core-popup_layer-enh_auto_select":"../core/res/popup/popup_layer/enh_auto_select.json","core-popup_layer-enh_rare_check":"../core/res/popup/popup_layer/enh_rare_check.json","core-popup_layer-enh_use_items":"../core/res/popup/popup_layer/enh_use_items.json","core-popup_layer-enh_use_items_confirm":"../core/res/popup/popup_layer/enh_use_items_confirm.json","core-popup_layer-evo_mate_check":"../core/res/popup/popup_layer/evo_mate_check.json","core-popup-q_003_getability":"../core/res/popup/q_003_getability.json","enh_evo-arousal_002-arousal_002":"../enh_evo/res/arousal_002/arousal_002.json","enh_evo-arousal_003-arousal_003":"../enh_evo/res/arousal_003/arousal_003.json","enh_evo-arousal_popup_ui":"../enh_evo/res/arousal_popup_ui.json","enh_evo-enh_001_2_6_evo_001_2_3-enh_001_2_6_evo_001_2_3":"../enh_evo/res/enh_001_2_6_evo_001_2_3/enh_001_2_6_evo_001_2_3.json","enh_evo-enh_007-enh_007":"../enh_evo/res/enh_007/enh_007.json","enh_evo-enh_008-enh_008":"../enh_evo/res/enh_008/enh_008.json","enh_evo-enh_009-enh_009":"../enh_evo/res/enh_009/enh_009.json","enh_evo-enh_013-enh_013":"../enh_evo/res/enh_013/enh_013.json","enh_evo-enh_014-enh_014":"../enh_evo/res/enh_014/enh_014.json","enh_evo-enh_015-enh_015":"../enh_evo/res/enh_015/enh_015.json","enh_evo-enh_evo_atlas_0.plist":"../enh_evo/res/enh_evo_atlas_0.plist","enh_evo-enh_evo_atlas_1.plist":"../enh_evo/res/enh_evo_atlas_1.plist","enh_evo-enh_evo_popup_ui":"../enh_evo/res/enh_evo_popup_ui.json","enh_evo-evo_007-evo_007":"../enh_evo/res/evo_007/evo_007.json","enh_evo-evo_008-evo_008":"../enh_evo/res/evo_008/evo_008.json","enh_evo-evo_009-evo_009":"../enh_evo/res/evo_009/evo_009.json","enh_evo-evo_010-evo_010":"../enh_evo/res/evo_010/evo_010.json","enh_evo-evo_012-evo_012":"../enh_evo/res/evo_012/evo_012.json","enh_evo-evo_013-evo_013":"../enh_evo/res/evo_013/evo_013.json","enh_evo-evo_014-evo_014":"../enh_evo/res/evo_014/evo_014.json","enh_evo-evo_btn_ui":"../enh_evo/res/evo_btn_ui.json","enh_evo-se_breakthrough_0001.mp3":"../enh_evo/res/se_breakthrough_0001.mp3","enh_evo-se_mix_0001.mp3":"../enh_evo/res/se_mix_0001.mp3","enh_evo-se_mix_great_0001.mp3":"../enh_evo/res/se_mix_great_0001.mp3","core-arousal_btn-arousal_btn_after_before_atlas.plist":"../core/res/pages/arousal_btn/arousal_btn_after_before_atlas.plist","core-arousal_btn-arousal_btn_after_before_ui":"../core/res/pages/arousal_btn/arousal_btn_after_before_ui.json","core-pages-epiparts_atlas.plist":"../core/res/pages/epiparts_atlas.plist","core-popup-epi_replay_check":"../core/res/popup/epi_replay_check.json","core-popup-epi_scene_check":"../core/res/popup/epi_scene_check.json","core-popup-epi_story_check":"../core/res/popup/epi_story_check.json","core-popup_layer-epi_btn_chapter":"../core/res/popup/popup_layer/epi_btn_chapter.json","core-popup_layer-epi_chapter_select":"../core/res/popup/popup_layer/epi_chapter_select.json","epi-epi_001-epi_001":"../epi/res/epi_001/epi_001.json","epi-epi_001-epi_new_ui":"../epi/res/epi_001/epi_new_ui.json","epi-epi_001-questlist_epi_blue_ui":"../epi/res/epi_001/questlist_epi_blue_ui.json","epi-epi_001-questlist_epi_yellow_ui":"../epi/res/epi_001/questlist_epi_yellow_ui.json","epi-epi_002_3_4-epi_002_3_4":"../epi/res/epi_002_3_4/epi_002_3_4.json","epi-epi_002_3_4-quest_list_white_ui":"../epi/res/epi_002_3_4/quest_list_white_ui.json","epi-epi_atlas.plist":"../epi/res/epi_atlas.plist","epi-epi_popup_ui":"../epi/res/epi_popup_ui.json","epi-questlist_epi_pink_ui":"../epi/res/questlist_epi_pink_ui.json","core-btn-btn_tab_six_element_ui":"../core/res/btn/btn_tab_six_element_ui.json","core-ranking_reward-ranking_reward_atlas.plist":"../core/res/pages/ranking_reward/ranking_reward_atlas.plist","core-popup_layer-epic_check":"../core/res/popup/popup_layer/epic_check.json","epic-epic_atlas.plist":"../epic/res/epic_atlas.plist","epic-epic_popup_ui":"../epic/res/epic_popup_ui.json","epic-epic_quest_list-epic_quest_list":"../epic/res/epic_quest_list/epic_quest_list.json","epic-epic_quest_list-epic_quest_list_page_ui":"../epic/res/epic_quest_list/epic_quest_list_page_ui.json","epic-epic_quest_list-epic_quest_list_ui":"../epic/res/epic_quest_list/epic_quest_list_ui.json","epic-epic_quest_top-epic_quest_top":"../epic/res/epic_quest_top/epic_quest_top.json","epic-epic_select-epic_event_banner_ui":"../epic/res/epic_select/epic_event_banner_ui.json","epic-epic_select-epic_select":"../epic/res/epic_select/epic_select.json","epic-epic_select-epic_select_bannerlist_page_ui":"../epic/res/epic_select/epic_select_bannerlist_page_ui.json","event-ev_000-ev_000":"../event/res/ev_000/ev_000.json","event-ev_000-ev_000_eventlist_page_ui":"../event/res/ev_000/ev_000_eventlist_page_ui.json","core-btn-viewpage_s_ui":"../core/res/btn/viewpage_s_ui.json","core-popup_layer-exchit_001_check":"../core/res/popup/popup_layer/exchit_001_check.json","core-popup_layer-exchit_002_check":"../core/res/popup/popup_layer/exchit_002_check.json","core-popup_layer-exchit_result":"../core/res/popup/popup_layer/exchit_result.json","exchangeitem-exchit_001-exchit_001":"../exchangeitem/res/exchit_001/exchit_001.json","exchangeitem-exchit_001-exchit_001_exchangeitemlist":"../exchangeitem/res/exchit_001/exchit_001_exchangeitemlist.json","exchangeitem-exchit_001-exchit_001_exchangeitemlist_page_ui":"../exchangeitem/res/exchit_001/exchit_001_exchangeitemlist_page_ui.json","exchangeitem-exchit_atlas.plist":"../exchangeitem/res/exchit_atlas.plist","exchangeitem-exchit_bg.jpg":"../exchangeitem/res/exchit_bg.jpg","exchangeitem-exchit_popup_ui":"../exchangeitem/res/exchit_popup_ui.json","core-userlist-userlist_0_ui":"../core/res/pages/userlist/userlist_0_ui.json","core-userlist-userlist_atlas.plist":"../core/res/pages/userlist/userlist_atlas.plist","core-userlist-userlist_page_ui":"../core/res/pages/userlist/userlist_page_ui.json","core-popup-com_edit_greed":"../core/res/popup/com_edit_greed.json","core-popup-com_edit_greed_a_ui":"../core/res/popup/com_edit_greed_a_ui.json","core-popup-com_edit_greed_b_ui":"../core/res/popup/com_edit_greed_b_ui.json","core-popup-com_req_check":"../core/res/popup/com_req_check.json","friend-fr_001-fr_001":"../friend/res/fr_001/fr_001.json","friend-fr_002_3-fr_002_3":"../friend/res/fr_002_3/fr_002_3.json","friend-fr_002_3-fr_input_ui":"../friend/res/fr_002_3/fr_input_ui.json","core-btn-btn_tab_variable_blue_ui":"../core/res/btn/btn_tab_variable_blue_ui.json","core-btn-btn_tab_variable_rarity_ui":"../core/res/btn/btn_tab_variable_rarity_ui.json","core-btn-btn_tab_variable_short_ui":"../core/res/btn/btn_tab_variable_short_ui.json","core-corecard_chara-corecard_atlas.plist":"../core/res/corecard_chara/corecard_atlas.plist","core-corecard_chara-corecard_chara_ui":"../core/res/corecard_chara/corecard_chara_ui.json","core-corecard_summon-corecard_atlas.plist":"../core/res/corecard_summon/corecard_atlas.plist","core-corecard_summon-corecard_summon_ui":"../core/res/corecard_summon/corecard_summon_ui.json","core-corecard_weapon-corecard_atlas.plist":"../core/res/corecard_weapon/corecard_atlas.plist","core-corecard_weapon-corecard_weapon_ui":"../core/res/corecard_weapon/corecard_weapon_ui.json","core-popup-com_open_episode":"../core/res/popup/com_open_episode.json","core-popup-ga_check_stone-ticket":"../core/res/popup/ga_check_stone-ticket.json","core-popup-ga_item_info":"../core/res/popup/ga_item_info.json","core-popup-ga_tips":"../core/res/popup/ga_tips.json","core-popup_layer-ga_check_usestone":"../core/res/popup/popup_layer/ga_check_usestone.json","core-popup_layer-ga_need_usestone":"../core/res/popup/popup_layer/ga_need_usestone.json","core-popup_layer-ga_tips":"../core/res/popup/popup_layer/ga_tips.json","core-sort-sort_ui_slong":"../core/res/sort/sort_ui_slong.json","mypage-gacha_add-gacha_add_atlas_1.plist":"../mypage/res/notice_ani/gacha_add/gacha_add_atlas_1.plist","gacha-ga_000-ga_000":"../gacha/res/ga_000/ga_000.json","gacha-ga_000-ga_bannerlist_page_ui":"../gacha/res/ga_000/ga_bannerlist_page_ui.json","gacha-ga_000-ga_bannerlist_ui":"../gacha/res/ga_000/ga_bannerlist_ui.json","gacha-ga_001_2_3_4-ga_002":"../gacha/res/ga_001_2_3_4/ga_002.json","gacha-ga_001_2_3_4-ga_main_btn_ui":"../gacha/res/ga_001_2_3_4/ga_main_btn_ui.json","gacha-ga_001_2_3_4-ga_sub_btn_ui":"../gacha/res/ga_001_2_3_4/ga_sub_btn_ui.json","gacha-ga_001_2_3_4-ga_top_slider_ui":"../gacha/res/ga_001_2_3_4/ga_top_slider_ui.json","gacha-ga_010-ga_010":"../gacha/res/ga_010/ga_010.json","gacha-ga_010-ga_main_btn_ui":"../gacha/res/ga_010/ga_main_btn_ui.json","gacha-ga_010-ga_result_corecard_ui":"../gacha/res/ga_010/ga_result_corecard_ui.json","gacha-ga_simple_ani_nike-ga_ani_effect":"../gacha/res/ga_010/ga_simple_ani_nike/ga_ani_effect.json","gacha-ga_simple_ani_nike-ga_ani_effect.plist":"../gacha/res/ga_010/ga_simple_ani_nike/ga_ani_effect.plist","gacha-ga_simple_ani_nike-ga_ani_nike":"../gacha/res/ga_010/ga_simple_ani_nike/ga_ani_nike.json","gacha-ga_simple_ani_nike-ga_ani_nike.plist":"../gacha/res/ga_010/ga_simple_ani_nike/ga_ani_nike.plist","gacha-ga_simple_ani_nike-se_nomalgacha_10.mp3":"../gacha/res/ga_010/ga_simple_ani_nike/se_nomalgacha_10.mp3","gacha-ga_010-ga_sub_btn_ui":"../gacha/res/ga_010/ga_sub_btn_ui.json","gacha-ga_ani-ga_ani":"../gacha/res/ga_ani/ga_ani.json","gacha-ga_ani-ga_ani_00":"../gacha/res/ga_ani/ga_ani_00.json","gacha-ga_ani-ga_ani_01":"../gacha/res/ga_ani/ga_ani_01.json","gacha-ga_ani-ga_ani_02":"../gacha/res/ga_ani/ga_ani_02.json","gacha-ga_ani-ga_ani_03":"../gacha/res/ga_ani/ga_ani_03.json","gacha-ga_ani-ga_ani_04_0":"../gacha/res/ga_ani/ga_ani_04_0.json","gacha-ga_ani-ga_ani_04_0_promotion":"../gacha/res/ga_ani/ga_ani_04_0_promotion.json","gacha-ga_ani-ga_ani_04_1":"../gacha/res/ga_ani/ga_ani_04_1.json","gacha-ga_ani-ga_ani_05":"../gacha/res/ga_ani/ga_ani_05.json","gacha-ga_ani-ga_ani_06":"../gacha/res/ga_ani/ga_ani_06.json","gacha-ga_ani-ga_ani_06_promotion":"../gacha/res/ga_ani/ga_ani_06_promotion.json","gacha-ga_ani-ga_ani_atlas_0.plist":"../gacha/res/ga_ani/ga_ani_atlas_0.plist","gacha-ga_ani-ga_ani_atlas_1.plist":"../gacha/res/ga_ani/ga_ani_atlas_1.plist","gacha-ga_ani-ga_ani_atlas_2.plist":"../gacha/res/ga_ani/ga_ani_atlas_2.plist","gacha-ga_ani-ga_ani_ball.plist":"../gacha/res/ga_ani/ga_ani_ball.plist","gacha-ga_ani-ga_ani_bg1.png":"../gacha/res/ga_ani/ga_ani_bg1.png","gacha-ga_ani-ga_ani_bg_a.png":"../gacha/res/ga_ani/ga_ani_bg_a.png","gacha-ga_ani-ga_ani_effect":"../gacha/res/ga_ani/ga_ani_effect.json","gacha-ga_ani-ga_ani_light4.png":"../gacha/res/ga_ani/ga_ani_light4.png","gacha-ga_ani-ga_ani_light6_0.png":"../gacha/res/ga_ani/ga_ani_light6_0.png","gacha-ga_ani-ga_ani_light6_1.png":"../gacha/res/ga_ani/ga_ani_light6_1.png","gacha-ga_ani-ga_ani_light6_2.png":"../gacha/res/ga_ani/ga_ani_light6_2.png","gacha-ga_ani-ga_ani_nike_atlas.plist":"../gacha/res/ga_ani/ga_ani_nike_atlas.plist","gacha-ga_ani-ga_ani_rarity_atlas.plist":"../gacha/res/ga_ani/ga_ani_rarity_atlas.plist","gacha-ga_ani-se_gacha_0001.mp3":"../gacha/res/ga_ani/se_gacha_0001.mp3","gacha-ga_ani-se_gacha_0002.mp3":"../gacha/res/ga_ani/se_gacha_0002.mp3","gacha-ga_ani-se_gacha_0003.mp3":"../gacha/res/ga_ani/se_gacha_0003.mp3","gacha-ga_ani-se_gacha_0004.mp3":"../gacha/res/ga_ani/se_gacha_0004.mp3","gacha-ga_ani-se_gacha_0005.mp3":"../gacha/res/ga_ani/se_gacha_0005.mp3","gacha-ga_ani-se_gacha_0006.mp3":"../gacha/res/ga_ani/se_gacha_0006.mp3","gacha-ga_ani-se_gacha_0009.mp3":"../gacha/res/ga_ani/se_gacha_0009.mp3","gacha-ga_ani-se_gacha_0011.mp3":"../gacha/res/ga_ani/se_gacha_0011.mp3","gacha-ga_ani-se_gacha_0012.mp3":"../gacha/res/ga_ani/se_gacha_0012.mp3","gacha-ga_ani-se_gacha_0013.mp3":"../gacha/res/ga_ani/se_gacha_0013.mp3","gacha-ga_atlas.plist":"../gacha/res/ga_atlas.plist","gacha-ga_bg.jpg":"../gacha/res/ga_bg.jpg","gacha-ga_contents_list-ga_contents_chara_list_page_ui":"../gacha/res/ga_contents_list/ga_contents_chara_list_page_ui.json","gacha-ga_contents_list-ga_contents_chara_list_ui":"../gacha/res/ga_contents_list/ga_contents_chara_list_ui.json","gacha-ga_contents_list-ga_contents_list":"../gacha/res/ga_contents_list/ga_contents_list.json","gacha-ga_contents_list-ga_contents_weapon_summon_list_page_ui":"../gacha/res/ga_contents_list/ga_contents_weapon_summon_list_page_ui.json","gacha-ga_contents_list-ga_contents_weapon_summon_list_ui":"../gacha/res/ga_contents_list/ga_contents_weapon_summon_list_ui.json","gacha-ga_popup_ui":"../gacha/res/ga_popup_ui.json","core-corecard-corecard_blank_5_3_ui":"../core/res/corecard/corecard_blank_5_3_ui.json","core-bursttime-btn_burstinfo.png":"../core/res/pages/bursttime/btn_burstinfo.png","core-bursttime-bursttime_period_base_1.png":"../core/res/pages/bursttime/bursttime_period_base_1.png","core-bursttime-bursttime_period_textimg.png":"../core/res/pages/bursttime/bursttime_period_textimg.png","core-bursttime-bursttime_period_ui":"../core/res/pages/bursttime/bursttime_period_ui.json","core-pages-newslist_ui":"../core/res/pages/newslist_ui.json","core-pages-newslist_ui_page":"../core/res/pages/newslist_ui_page.json","core-userlist-balloonlist_atlas.plist":"../core/res/pages/userlist/balloonlist_atlas.plist","core-userlist-balloonlist_ui":"../core/res/pages/userlist/balloonlist_ui.json","core-userlist-balloonlist_ui_page":"../core/res/pages/userlist/balloonlist_ui_page.json","core-popup-gud_001_break_leave":"../core/res/popup/gud_001_break_leave.json","core-popup-gud_001_bursttime_change":"../core/res/popup/gud_001_bursttime_change.json","core-popup-gud_001_bursttime_change_sort_ui":"../core/res/popup/gud_001_bursttime_change_sort_ui.json","core-popup-gud_001_bursttime_result":"../core/res/popup/gud_001_bursttime_result.json","core-popup-gud_001_control":"../core/res/popup/gud_001_control.json","core-popup-gud_001_edit":"../core/res/popup/gud_001_edit.json","core-popup-gud_001_uncontrol_a":"../core/res/popup/gud_001_uncontrol_a.json","core-popup-gud_001_uncontrol_b":"../core/res/popup/gud_001_uncontrol_b.json","core-popup-gud_002_detail":"../core/res/popup/gud_002_detail.json","core-popup-gud_005_levelup":"../core/res/popup/gud_005_levelup.json","core-popup-gud_005_result":"../core/res/popup/gud_005_result.json","core-popup-gud_013_fire_top_change_end":"../core/res/popup/gud_013_fire_top_change_end.json","core-popup-gud_auth_change":"../core/res/popup/gud_auth_change.json","core-popup-gud_auth_change_sort_ui":"../core/res/popup/gud_auth_change_sort_ui.json","core-popup-gud_gem_amount":"../core/res/popup/gud_gem_amount.json","core-popup-gud_gem_check":"../core/res/popup/gud_gem_check.json","core-popup-gud_gem_rankup":"../core/res/popup/gud_gem_rankup.json","core-popup-gud_gem_result":"../core/res/popup/gud_gem_result.json","core-popup-gud_guardian_change_buy":"../core/res/popup/gud_guardian_change_buy.json","core-popup-gud_guardian_detail_b":"../core/res/popup/gud_guardian_detail_b.json","core-popup-gud_guardian_detail_nomoney":"../core/res/popup/gud_guardian_detail_nomoney.json","core-popup-gud_mystatus":"../core/res/popup/gud_mystatus.json","core-popup-gud_name_cha":"../core/res/popup/gud_name_cha.json","core-popup-gud_request_end":"../core/res/popup/gud_request_end.json","core-popup-gud_sh_sort_list_ui":"../core/res/popup/gud_sh_sort_list_ui.json","core-popup_layer-com_consumption_check_result_1":"../core/res/popup/popup_layer/com_consumption_check_result_1.json","core-popup_layer-com_consumption_check_result_2":"../core/res/popup/popup_layer/com_consumption_check_result_2.json","core-popup_layer-gud_request_set_a":"../core/res/popup/popup_layer/gud_request_set_a.json","core-popup_layer-gud_request_set_b":"../core/res/popup/popup_layer/gud_request_set_b.json","core-popup_layer-gud_search_setting":"../core/res/popup/popup_layer/gud_search_setting.json","core-sort-sort_list_ui_long":"../core/res/sort/sort_list_ui_long.json","core-sort-sort_ui_long":"../core/res/sort/sort_ui_long.json","guild-gud_000-gud_000_a":"../guild/res/gud_000/gud_000_a.json","guild-gud_000-gud_000_b":"../guild/res/gud_000/gud_000_b.json","guild-gud_000-gud_000_c":"../guild/res/gud_000/gud_000_c.json","guild-gud_000-gud_unionlist_page_ui":"../guild/res/gud_000/gud_unionlist_page_ui.json","guild-gud_000-gud_unionlist_ui":"../guild/res/gud_000/gud_unionlist_ui.json","guild-gud_000-guild_000_img.jpg":"../guild/res/gud_000/guild_000_img.jpg","guild-gud_001-btn_guardian_ui":"../guild/res/gud_001/btn_guardian_ui.json","guild-gud_001-gud_001":"../guild/res/gud_001/gud_001.json","guild-gud_001-gud_001_a_ui":"../guild/res/gud_001/gud_001_a_ui.json","guild-gud_001-gud_001_atlas.plist":"../guild/res/gud_001/gud_001_atlas.plist","guild-gud_001-gud_001_b_ui":"../guild/res/gud_001/gud_001_b_ui.json","guild-gud_001-gud_001_c_ui":"../guild/res/gud_001/gud_001_c_ui.json","guild-gud_001-gud_001_d_ui":"../guild/res/gud_001/gud_001_d_ui.json","guild-gud_001-gud_comment_ui":"../guild/res/gud_001/gud_comment_ui.json","guild-gud_002-gud_002":"../guild/res/gud_002/gud_002.json","guild-gud_002-introduce_guardian_window.png":"../guild/res/gud_002/introduce_guardian_window.png","guild-gud_003-gud_003":"../guild/res/gud_003/gud_003.json","guild-gud_003-gud_guardianlist_0_page_ui":"../guild/res/gud_003/gud_guardianlist_0_page_ui.json","guild-gud_003-gud_guardianlist_0_ui":"../guild/res/gud_003/gud_guardianlist_0_ui.json","guild-gud_003-gud_guardianlist_1_page_ui":"../guild/res/gud_003/gud_guardianlist_1_page_ui.json","guild-gud_003-gud_guardianlist_1_ui":"../guild/res/gud_003/gud_guardianlist_1_ui.json","guild-gud_005-gud_005":"../guild/res/gud_005/gud_005.json","guild-gud_007-gud_007_leader":"../guild/res/gud_007/gud_007_leader.json","guild-gud_007-gud_007_not_leader":"../guild/res/gud_007/gud_007_not_leader.json","guild-gud_008-gud_008":"../guild/res/gud_008/gud_008.json","guild-gud_009-gud_009":"../guild/res/gud_009/gud_009.json","guild-gud_010_011_012-gud_010_011_012":"../guild/res/gud_010_011_012/gud_010_011_012.json","guild-gud_010_011_012-gud_input_ui":"../guild/res/gud_010_011_012/gud_input_ui.json","guild-gud_013-gud_013_a":"../guild/res/gud_013/gud_013_a.json","guild-gud_013-gud_013_b":"../guild/res/gud_013/gud_013_b.json","guild-gud_atlas.plist":"../guild/res/gud_atlas.plist","guild-gud_popup_ui":"../guild/res/gud_popup_ui.json","guild-icon_guild_position.plist":"../guild/res/icon_guild_position.plist","core-font-job_level_no.fnt":"../core/res/font/job_level_no.fnt","core-popup_layer-highjob_change":"../core/res/popup/popup_layer/highjob_change.json","core-popup_layer-highjob_change_joblist_page_ui":"../core/res/popup/popup_layer/highjob_change_joblist_page_ui.json","core-popup_layer-highjob_change_joblist_ui":"../core/res/popup/popup_layer/highjob_change_joblist_ui.json","core-popup_layer-highjob_step_check_do":"../core/res/popup/popup_layer/highjob_step_check_do.json","core-popup_layer-highjob_step_do_confirm":"../core/res/popup/popup_layer/highjob_step_do_confirm.json","core-popup_layer-highjob_weapon_check":"../core/res/popup/popup_layer/highjob_weapon_check.json","core-popup_layer-highjob_weapon_get":"../core/res/popup/popup_layer/highjob_weapon_get.json","highjob-highjob_ani-bg_labo_back.png":"../highjob/res/highjob_ani/bg_labo_back.png","highjob-highjob_ani-bg_labo_front.png":"../highjob/res/highjob_ani/bg_labo_front.png","highjob-highjob_ani-bg_labo_zoom.jpg":"../highjob/res/highjob_ani/bg_labo_zoom.jpg","highjob-highjob_ani-bg_space.jpg":"../highjob/res/highjob_ani/bg_space.jpg","highjob-highjob_ani-emblem_ui":"../highjob/res/highjob_ani/emblem_ui.json","highjob-highjob_ani-highjob_ani":"../highjob/res/highjob_ani/highjob_ani.json","highjob-highjob_ani-highjob_ani_atlas.plist":"../highjob/res/highjob_ani/highjob_ani_atlas.plist","highjob-highjob_ani-light_circle_back.png":"../highjob/res/highjob_ani/light_circle_back.png","highjob-highjob_ani-light_circle_front.png":"../highjob/res/highjob_ani/light_circle_front.png","highjob-highjob_ani-light_line.png":"../highjob/res/highjob_ani/light_line.png","highjob-highjob_ani-light_particle_1.png":"../highjob/res/highjob_ani/light_particle_1.png","highjob-highjob_ani-light_particle_2.png":"../highjob/res/highjob_ani/light_particle_2.png","highjob-highjob_ani-light_spread.png":"../highjob/res/highjob_ani/light_spread.png","highjob-highjob_ani-magic_circle.png":"../highjob/res/highjob_ani/magic_circle.png","highjob-highjob_ani-se_page_exjob_1.mp3":"../highjob/res/highjob_ani/se_page_exjob_1.mp3","highjob-highjob_ani-se_page_exjob_2.mp3":"../highjob/res/highjob_ani/se_page_exjob_2.mp3","highjob-highjob_ani-se_page_exjob_3.mp3":"../highjob/res/highjob_ani/se_page_exjob_3.mp3","highjob-highjob_ani-se_page_exjob_4.mp3":"../highjob/res/highjob_ani/se_page_exjob_4.mp3","highjob-highjob_atlas.plist":"../highjob/res/highjob_atlas.plist","highjob-highjob_bg.jpg":"../highjob/res/highjob_bg.jpg","highjob-highjob_bg_frame.png":"../highjob/res/highjob_bg_frame.png","highjob-highjob_main-highjob_main":"../highjob/res/highjob_main/highjob_main.json","highjob-highjob_main-highjob_main_phase_ui":"../highjob/res/highjob_main/highjob_main_phase_ui.json","highjob-highjob_popup_ui":"../highjob/res/highjob_popup_ui.json","highjob-highjob_weapon_select-highjob_weapon_select":"../highjob/res/highjob_weapon_select/highjob_weapon_select.json","core-introduce_chara-introduce_chara_status_0_ui":"../core/res/introduce/introduce_chara/introduce_chara_status_0_ui.json","core-introduce_summon-introduce_summon_status_0_ui":"../core/res/introduce/introduce_summon/introduce_summon_status_0_ui.json","core-introduce_weapon-introduce_weapon_status_0_ui":"../core/res/introduce/introduce_weapon/introduce_weapon_status_0_ui.json","core-statuslist-statuslist_weapon-skill_ui":"../core/res/introduce/statuslist/statuslist_weapon-skill_ui.json","core-ranking_reward-receive_ui":"../core/res/pages/ranking_reward/receive_ui.json","core-popup-com_new_member":"../core/res/popup/com_new_member.json","core-popup_layer-hlbattle_get_error":"../core/res/popup/popup_layer/hlbattle_get_error.json","core-popup_layer-hlbattle_wanted":"../core/res/popup/popup_layer/hlbattle_wanted.json","core-popup_layer-prs_receive":"../core/res/popup/popup_layer/prs_receive.json","core-popup-prs_carry_limit":"../core/res/popup/prs_carry_limit.json","core-popup-prs_non_receive_list_ui":"../core/res/popup/prs_non_receive_list_ui.json","core-popup-prs_receive_check_result":"../core/res/popup/prs_receive_check_result.json","core-popup-prs_receive_list_ui":"../core/res/popup/prs_receive_list_ui.json","core-popup-sub_tutorial":"../core/res/popup/sub_tutorial.json","hlbattle-hlbattle_001-hlbattle_001":"../hlbattle/res/hlbattle_001/hlbattle_001.json","hlbattle-hlbattle_atlas.plist":"../hlbattle/res/hlbattle_atlas.plist","hlbattle-hlbattle_missionlist_page_ui":"../hlbattle/res/hlbattle_missionlist_page_ui.json","hlbattle-hlbattle_missionlist_ui":"../hlbattle/res/hlbattle_missionlist_ui.json","hlbattle-hlbattle_popup_ui":"../hlbattle/res/hlbattle_popup_ui.json","hlbattle-hlbattle_rewardlist_page_ui":"../hlbattle/res/hlbattle_rewardlist_page_ui.json","hlbattle-hlbattle_rewardlist_ui":"../hlbattle/res/hlbattle_rewardlist_ui.json","core-popup-it_use_check":"../core/res/popup/it_use_check.json","core-popup-it_use_info":"../core/res/popup/it_use_info.json","core-popup_layer-it_time_limit_ticket_check":"../core/res/popup/popup_layer/it_time_limit_ticket_check.json","core-popup_layer-time_limit_page_ui":"../core/res/popup/popup_layer/time_limit_page_ui.json","core-popup_layer-time_limit_ui":"../core/res/popup/popup_layer/time_limit_ui.json","item-it_001-it_001":"../item/res/it_001/it_001.json","item-it_popup_ui":"../item/res/it_popup_ui.json","core-popup_layer-com_consumption_check_result_3":"../core/res/popup/popup_layer/com_consumption_check_result_3.json","core-popup_layer-com_consumption_check_result_4":"../core/res/popup/popup_layer/com_consumption_check_result_4.json","list-li_007_8-li_007_8":"../list/res/li_007_8/li_007_8.json","list-li_orb_num_base.png":"../list/res/li_orb_num_base.png","list-li_popup_ui":"../list/res/li_popup_ui.json","core-side_navi-side_navi_03.png":"../core/res/pages/side_navi/side_navi_03.png","core-side_navi-side_navi_2_ui":"../core/res/pages/side_navi/side_navi_2_ui.json","mission-mission_001-mission_001":"../mission/res/mission_001/mission_001.json","mission-mission_001-mission_001_amon_ui":"../mission/res/mission_001/mission_001_amon_ui.json","mission-mission_001-mission_001_missionlist_daily_page_ui":"../mission/res/mission_001/mission_001_missionlist_daily_page_ui.json","mission-mission_001-mission_001_missionlist_daily_ui":"../mission/res/mission_001/mission_001_missionlist_daily_ui.json","mission-mission_001-mission_001_missionlist_event_page_ui":"../mission/res/mission_001/mission_001_missionlist_event_page_ui.json","mission-mission_001-mission_001_missionlist_event_ui":"../mission/res/mission_001/mission_001_missionlist_event_ui.json","mission-mission_001-mission_001_missionlist_weekly_page_ui":"../mission/res/mission_001/mission_001_missionlist_weekly_page_ui.json","mission-mission_001-mission_001_missionlist_weekly_ui":"../mission/res/mission_001/mission_001_missionlist_weekly_ui.json","mission-mission_atlas.plist":"../mission/res/mission_atlas.plist","mission-mission_complete_reward_ui":"../mission/res/mission_complete_reward_ui.json","mission-mission_popup_ui":"../mission/res/mission_popup_ui.json","mission-mission_receive_ui":"../mission/res/mission_receive_ui.json","core-bursttime-bursttime_remaining_base.png":"../core/res/pages/bursttime/bursttime_remaining_base.png","core-bursttime-bursttime_remaining_ui":"../core/res/pages/bursttime/bursttime_remaining_ui.json","core-raid_btn-raid_btn_ui":"../core/res/pages/raid_btn/raid_btn_ui.json","core-popup_layer-my_time_limit_ticket_caution":"../core/res/popup/popup_layer/my_time_limit_ticket_caution.json","core-popup_layer-my_visual":"../core/res/popup/popup_layer/my_visual.json","mypage-my_001-my_001":"../mypage/res/my_001/my_001.json","mypage-my_001-my_atlas.plist":"../mypage/res/my_001/my_atlas.plist","mypage-my_btn_atlas-my_btn_atlas.plist":"../mypage/res/my_001/my_btn_atlas/my_btn_atlas.plist","mypage-my_btn_atlas-my_quest_raid_particle.plist":"../mypage/res/my_001/my_btn_atlas/my_quest_raid_particle.plist","mypage-my_001-my_chara_page_ui":"../mypage/res/my_001/my_chara_page_ui.json","mypage-my_001-my_emblem_img.png":"../mypage/res/my_001/my_emblem_img.png","mypage-my_001-my_emblem_ui":"../mypage/res/my_001/my_emblem_ui.json","mypage-my_001-my_event-info_page_ui":"../mypage/res/my_001/my_event-info_page_ui.json","mypage-my_001-my_event-info_ui":"../mypage/res/my_001/my_event-info_ui.json","mypage-my_001-my_harem_ui":"../mypage/res/my_001/my_harem_ui.json","mypage-my_001-my_mainbtn_ui":"../mypage/res/my_001/my_mainbtn_ui.json","mypage-my_001-my_mission_ui":"../mypage/res/my_001/my_mission_ui.json","mypage-my_001-my_particle.plist":"../mypage/res/my_001/my_particle.plist","mypage-my_001-my_quest_normal":"../mypage/res/my_001/my_quest_normal.json","mypage-my_001-my_quest_raid":"../mypage/res/my_001/my_quest_raid.json","mypage-my_popup_ui":"../mypage/res/my_popup_ui.json","mypage-gacha_add-gacha_add_ani":"../mypage/res/notice_ani/gacha_add/gacha_add_ani.json","mypage-gacha_add-gacha_add_ani_01":"../mypage/res/notice_ani/gacha_add/gacha_add_ani_01.json","mypage-gacha_add-gacha_add_ani_02":"../mypage/res/notice_ani/gacha_add/gacha_add_ani_02.json","mypage-gacha_add-gacha_add_ani_03":"../mypage/res/notice_ani/gacha_add/gacha_add_ani_03.json","mypage-gacha_add-gacha_add_ani_04":"../mypage/res/notice_ani/gacha_add/gacha_add_ani_04.json","mypage-gacha_add-gacha_add_ani_05":"../mypage/res/notice_ani/gacha_add/gacha_add_ani_05.json","mypage-gacha_add-gacha_add_atlas_0.plist":"../mypage/res/notice_ani/gacha_add/gacha_add_atlas_0.plist","mypage-gacha_add-gacha_add_bg.jpg":"../mypage/res/notice_ani/gacha_add/gacha_add_bg.jpg","mypage-gacha_add-se_notice_01.mp3":"../mypage/res/notice_ani/gacha_add/se_notice_01.mp3","mypage-gacha_add-se_notice_02.mp3":"../mypage/res/notice_ani/gacha_add/se_notice_02.mp3","mypage-gacha_add-se_notice_03.mp3":"../mypage/res/notice_ani/gacha_add/se_notice_03.mp3","mypage-gacha_add-se_notice_04.mp3":"../mypage/res/notice_ani/gacha_add/se_notice_04.mp3","core-pages-bg_02.jpg":"../core/res/pages/bg_02.jpg","note-no_001-no_001":"../note/res/no_001/no_001.json","note-no_002-chapterlist_ui":"../note/res/no_002/chapterlist_ui.json","note-no_002-no_002":"../note/res/no_002/no_002.json","note-no_002-no_event_banner_ui":"../note/res/no_002/no_event_banner_ui.json","note-no_002-no_event_bannerlist_ui":"../note/res/no_002/no_event_bannerlist_ui.json","note-no_002-worldlist_page_ui":"../note/res/no_002/worldlist_page_ui.json","note-no_002-worldlist_ui":"../note/res/no_002/worldlist_ui.json","note-no_003-no_003":"../note/res/no_003/no_003.json","note-no_003-no_episodelist_page_ui":"../note/res/no_003/no_episodelist_page_ui.json","note-no_003-no_episodelist_ui":"../note/res/no_003/no_episodelist_ui.json","note-no_004-no_004":"../note/res/no_004/no_004.json","note-no_007-no_007":"../note/res/no_007/no_007.json","note-no_012-no_012":"../note/res/no_012/no_012.json","note-no_012-no_012_episodelist_page_ui":"../note/res/no_012/no_012_episodelist_page_ui.json","note-no_atlas_0.plist":"../note/res/no_atlas_0.plist","core-btn-btn_tab_two_mini_ui":"../core/res/btn/btn_tab_two_mini_ui.json","core-btn-viewpage_three_ui":"../core/res/btn/viewpage_three_ui.json","core-font-attack_no.fnt":"../core/res/font/attack_no.fnt","core-font-hp_no.fnt":"../core/res/font/hp_no.fnt","core-introduce_acce-introduce_popup_acce_status_card_ui":"../core/res/introduce/introduce_acce/introduce_popup_acce_status_card_ui.json","core-introduce_acce-introduce_popup_acce_status_ui":"../core/res/introduce/introduce_acce/introduce_popup_acce_status_ui.json","core-introduce_chara-introduce_popup_chara_status_ui":"../core/res/introduce/introduce_chara/introduce_popup_chara_status_ui.json","core-introduce_job-introduce_job.plist":"../core/res/introduce/introduce_job/introduce_job.plist","core-introduce_job-introduce_job_condition_0_ui":"../core/res/introduce/introduce_job/introduce_job_condition_0_ui.json","core-introduce_job-introduce_job_condition_1_ui":"../core/res/introduce/introduce_job/introduce_job_condition_1_ui.json","core-introduce_job-introduce_job_status_0_ui":"../core/res/introduce/introduce_job/introduce_job_status_0_ui.json","core-introduce_job-introduce_job_status_1_ui":"../core/res/introduce/introduce_job/introduce_job_status_1_ui.json","core-introduce-introduce_popup_statuslist_list_3_ui":"../core/res/introduce/introduce_popup_statuslist_list_3_ui.json","core-introduce-introduce_popup_statuslist_list_7_ui":"../core/res/introduce/introduce_popup_statuslist_list_7_ui.json","core-popup-menu_chat":"../core/res/popup/menu_chat.json","core-popup-p_001_autoorg":"../core/res/popup/p_001_autoorg.json","core-popup-p_ability_assist_info":"../core/res/popup/p_ability_assist_info.json","core-popup-p_autoorg":"../core/res/popup/p_autoorg.json","core-popup-p_bonus_info":"../core/res/popup/p_bonus_info.json","core-popup-p_bonus_list_ui":"../core/res/popup/p_bonus_list_ui.json","core-popup-p_chara_change":"../core/res/popup/p_chara_change.json","core-popup-p_fluctuation_ui":"../core/res/popup/p_fluctuation_ui.json","core-popup-p_job_change":"../core/res/popup/p_job_change.json","core-popup-p_job_change_bonus_list_ui":"../core/res/popup/p_job_change_bonus_list_ui.json","core-popup-p_orgend":"../core/res/popup/p_orgend.json","core-popup-p_weapon_main":"../core/res/popup/p_weapon_main.json","core-popup-p_weapon_summon_change":"../core/res/popup/p_weapon_summon_change.json","core-popup_layer-chara_raritybar_ui":"../core/res/popup/popup_layer/chara_raritybar_ui.json","core-popup_layer-com_character_status":"../core/res/popup/popup_layer/com_character_status.json","core-popup_layer-p_001_autoorg":"../core/res/popup/popup_layer/p_001_autoorg.json","core-popup_layer-p_party_change":"../core/res/popup/popup_layer/p_party_change.json","core-popup_layer-p_support_summon_config_description":"../core/res/popup/popup_layer/p_support_summon_config_description.json","core-popup_layer-par_ability_change_check":"../core/res/popup/popup_layer/par_ability_change_check.json","core-popup_layer-par_ability_get":"../core/res/popup/popup_layer/par_ability_get.json","core-popup_layer-par_energy_bonus":"../core/res/popup/popup_layer/par_energy_bonus.json","core-popup_layer-par_energy_bonus_list_page_ui":"../core/res/popup/popup_layer/par_energy_bonus_list_page_ui.json","core-popup_layer-par_energy_bonus_list_ui":"../core/res/popup/popup_layer/par_energy_bonus_list_ui.json","core-popup_layer-par_energy_change":"../core/res/popup/popup_layer/par_energy_change.json","core-popup_layer-par_energy_change_help":"../core/res/popup/popup_layer/par_energy_change_help.json","core-popup_layer-par_exchange_mp":"../core/res/popup/popup_layer/par_exchange_mp.json","core-popup_layer-par_exchange_mp_confirm":"../core/res/popup/popup_layer/par_exchange_mp_confirm.json","core-popup_layer-par_help_ability_get":"../core/res/popup/popup_layer/par_help_ability_get.json","core-popup_layer-par_help_mp":"../core/res/popup/popup_layer/par_help_mp.json","core-popup_layer-par_help_status_enhance":"../core/res/popup/popup_layer/par_help_status_enhance.json","core-popup_layer-par_status_allreset_confirm":"../core/res/popup/popup_layer/par_status_allreset_confirm.json","core-popup_layer-par_status_enhance":"../core/res/popup/popup_layer/par_status_enhance.json","core-popup_layer-par_status_reset":"../core/res/popup/popup_layer/par_status_reset.json","core-popup_layer-party_change_main_summon_ui":"../core/res/popup/popup_layer/party_change_main_summon_ui.json","core-popup_layer-party_change_page_ui":"../core/res/popup/popup_layer/party_change_page_ui.json","core-popup_layer-party_change_select_btn_ui":"../core/res/popup/popup_layer/party_change_select_btn_ui.json","core-popup_layer-party_change_support_summon_ui":"../core/res/popup/popup_layer/party_change_support_summon_ui.json","core-popup_layer-q_002_sup":"../core/res/popup/popup_layer/q_002_sup.json","party-jobchange_ani-jobchange_ani":"../party/res/jobchange_ani/jobchange_ani.json","party-jobchange_ani-jobchange_atlas.plist":"../party/res/jobchange_ani/jobchange_atlas.plist","party-jobchange_ani-se_change_0001.mp3":"../party/res/jobchange_ani/se_change_0001.mp3","party-jobget_ani-jobget_ani":"../party/res/jobget_ani/jobget_ani.json","party-jobget_ani-jobget_atlas.plist":"../party/res/jobget_ani/jobget_atlas.plist","party-jobget_ani-se_open_0001.mp3":"../party/res/jobget_ani/se_open_0001.mp3","party-par_001-par_001_chara_card_ui":"../party/res/par_001_2_3/par_001/par_001_chara_card_ui.json","party-par_001-par_001_main_member_ui":"../party/res/par_001_2_3/par_001/par_001_main_member_ui.json","party-par_001-par_001_sub_member_ui":"../party/res/par_001_2_3/par_001/par_001_sub_member_ui.json","party-par_001-par_001_ui":"../party/res/par_001_2_3/par_001/par_001_ui.json","party-par_001_2_3-par_001_2_3":"../party/res/par_001_2_3/par_001_2_3.json","party-par_001_2_3-par_001_2_3_atlas.plist":"../party/res/par_001_2_3/par_001_2_3_atlas.plist","party-par_002-par_002_sub_weapon_ui":"../party/res/par_001_2_3/par_002/par_002_sub_weapon_ui.json","party-par_002-par_002_ui":"../party/res/par_001_2_3/par_002/par_002_ui.json","party-par_003-par_003_sub_summon_ui":"../party/res/par_001_2_3/par_003/par_003_sub_summon_ui.json","party-par_003-par_003_ui":"../party/res/par_001_2_3/par_003/par_003_ui.json","party-par_001_2_3-par_btn_back_quest_acce_ui":"../party/res/par_001_2_3/par_btn_back_quest_acce_ui.json","party-par_004-par_004":"../party/res/par_004/par_004.json","party-par_005-par_005":"../party/res/par_005/par_005.json","party-par_006_7-par_006_7":"../party/res/par_006_7/par_006_7.json","party-par_006_7-par_006_7_atlas.plist":"../party/res/par_006_7/par_006_7_atlas.plist","party-par_006_7-par_006_7_joblist_page_ui":"../party/res/par_006_7/par_006_7_joblist_page_ui.json","party-par_006_7-par_006_7_joblist_ui":"../party/res/par_006_7/par_006_7_joblist_ui.json","party-par_006_7-par_006_7_topbtn_ui":"../party/res/par_006_7/par_006_7_topbtn_ui.json","party-par_008-par_008":"../party/res/par_008/par_008.json","party-par_009-par_009":"../party/res/par_009/par_009.json","party-par_013-par_013":"../party/res/par_013/par_013.json","party-par_015-par_015":"../party/res/par_015/par_015.json","party-par_atlas.plist":"../party/res/par_atlas.plist","party-par_energy_release-par_energy_release":"../party/res/par_energy_release/par_energy_release.json","party-par_energy_release-par_energy_release_abilitylist_page_ui":"../party/res/par_energy_release/par_energy_release_abilitylist_page_ui.json","party-par_energy_release-par_energy_release_abilitylist_ui":"../party/res/par_energy_release/par_energy_release_abilitylist_ui.json","party-par_energy_release-par_energy_release_popup_ui":"../party/res/par_energy_release/par_energy_release_popup_ui.json","party-par_energy_release-par_energy_release_statuslist_page_ui":"../party/res/par_energy_release/par_energy_release_statuslist_page_ui.json","party-par_energy_release-par_energy_release_statuslist_ui":"../party/res/par_energy_release/par_energy_release_statuslist_ui.json","party-par_pick_member_acce-par_pick_member_acce":"../party/res/par_pick_member_acce/par_pick_member_acce.json","party-par_pick_member_acce-par_pick_member_acce_popup_ui":"../party/res/par_pick_member_acce/par_pick_member_acce_popup_ui.json","party-par_popup_ui":"../party/res/par_popup_ui.json","core-btn-btn_tab_three_mini_ui":"../core/res/btn/btn_tab_three_mini_ui.json","core-corecard-corecard_blank_4_3_ui":"../core/res/corecard/corecard_blank_4_3_ui.json","core-popup_layer-poprank_check":"../core/res/popup/popup_layer/poprank_check.json","core-popup_layer-poprank_exchange":"../core/res/popup/popup_layer/poprank_exchange.json","core-popup_layer-poprank_result":"../core/res/popup/popup_layer/poprank_result.json","core-popup_layer-poprank_select":"../core/res/popup/popup_layer/poprank_select.json","poprank-poprank_000-poprank_000":"../poprank/res/poprank_000/poprank_000.json","poprank-poprank_001-poprank_001":"../poprank/res/poprank_001/poprank_001.json","poprank-poprank_002-poprank_002":"../poprank/res/poprank_002/poprank_002.json","poprank-poprank_002-poprank_002_balloon_ui":"../poprank/res/poprank_002/poprank_002_balloon_ui.json","poprank-poprank_003-poprank_003":"../poprank/res/poprank_003/poprank_003.json","poprank-poprank_004-poprank_004":"../poprank/res/poprank_004/poprank_004.json","poprank-poprank_004-poprank_004_receivedlist_page_ui":"../poprank/res/poprank_004/poprank_004_receivedlist_page_ui.json","poprank-poprank_004-poprank_004_receivedlist_ui":"../poprank/res/poprank_004/poprank_004_receivedlist_ui.json","poprank-poprank_005-poprank_005":"../poprank/res/poprank_005/poprank_005.json","poprank-poprank_atlas.plist":"../poprank/res/poprank_atlas.plist","poprank-poprank_chara_status_0_ui":"../poprank/res/poprank_chara_status_0_ui.json","poprank-poprank_chara_status_1_ui":"../poprank/res/poprank_chara_status_1_ui.json","poprank-poprank_chara_status_particle_0.plist":"../poprank/res/poprank_chara_status_particle_0.plist","poprank-poprank_chara_status_particle_1.plist":"../poprank/res/poprank_chara_status_particle_1.plist","poprank-poprank_popup_ui":"../poprank/res/poprank_popup_ui.json","poprank-poprank_rank_arrow_ui":"../poprank/res/poprank_rank_arrow_ui.json","poprank-poprank_ranklist_page_ui":"../poprank/res/poprank_ranklist_page_ui.json","poprank-poprank_ranklist_ui":"../poprank/res/poprank_ranklist_ui.json","present-present_atlas.plist":"../present/res/present_atlas.plist","present-prs_001_2_3-prs_001_2_3":"../present/res/prs_001_2_3/prs_001_2_3.json","present-prs_001_2_3-prs_card_ui":"../present/res/prs_001_2_3/prs_card_ui.json","present-prs_001_2_3-prs_cardlist_ui":"../present/res/prs_001_2_3/prs_cardlist_ui.json","present-prs_popup_ui":"../present/res/prs_popup_ui.json","core-corecard-corecard_blank_4_4_ui":"../core/res/corecard/corecard_blank_4_4_ui.json","core-font-prizehunt_num.fnt":"../core/res/font/prizehunt_num.fnt","core-pages-sort_1_ui":"../core/res/pages/sort_1_ui.json","core-popup_layer-prizehunt_around_save_check":"../core/res/popup/popup_layer/prizehunt_around_save_check.json","core-popup_layer-prizehunt_around_select":"../core/res/popup/popup_layer/prizehunt_around_select.json","core-popup_layer-prizehunt_exit_check":"../core/res/popup/popup_layer/prizehunt_exit_check.json","core-popup_layer-prizehunt_newpage_check":"../core/res/popup/popup_layer/prizehunt_newpage_check.json","core-popup_layer-prizehunt_next_check":"../core/res/popup/popup_layer/prizehunt_next_check.json","core-popup_layer-prizehunt_popup_atlas.plist":"../core/res/popup/popup_layer/prizehunt_popup_atlas.plist","core-popup_layer-prizehunt_quest_check":"../core/res/popup/popup_layer/prizehunt_quest_check.json","core-popup_layer-prizehunt_result":"../core/res/popup/popup_layer/prizehunt_result.json","core-popup_layer-prizehunt_result_item_check":"../core/res/popup/popup_layer/prizehunt_result_item_check.json","core-popup_layer-prizehunt_result_ui":"../core/res/popup/popup_layer/prizehunt_result_ui.json","core-popup_layer-prizehunt_stop_check":"../core/res/popup/popup_layer/prizehunt_stop_check.json","prizehunt-prizehunt_atlas.plist":"../prizehunt/res/prizehunt_atlas.plist","prizehunt-prizehunt_popup_ui":"../prizehunt/res/prizehunt_popup_ui.json","prizehunt-prizehunt_arisa_ani-prizehunt_arisa_ani":"../prizehunt/res/prizehunt_quest/prizehunt_arisa_ani/prizehunt_arisa_ani.json","prizehunt-prizehunt_arisa_ani-prizehunt_arisa_ani_atlas.plist":"../prizehunt/res/prizehunt_quest/prizehunt_arisa_ani/prizehunt_arisa_ani_atlas.plist","prizehunt-prizehunt_logo_ani-prizehunt_logo_ani_atlas.plist":"../prizehunt/res/prizehunt_quest/prizehunt_logo_ani/prizehunt_logo_ani_atlas.plist","prizehunt-prizehunt_logo_ani-prizehunt_logo_boss_battle_ani":"../prizehunt/res/prizehunt_quest/prizehunt_logo_ani/prizehunt_logo_boss_battle_ani.json","prizehunt-prizehunt_logo_ani-prizehunt_logo_lose_ani":"../prizehunt/res/prizehunt_quest/prizehunt_logo_ani/prizehunt_logo_lose_ani.json","prizehunt-prizehunt_logo_ani-prizehunt_logo_normal_battle_ani":"../prizehunt/res/prizehunt_quest/prizehunt_logo_ani/prizehunt_logo_normal_battle_ani.json","prizehunt-prizehunt_logo_ani-prizehunt_logo_win_ani":"../prizehunt/res/prizehunt_quest/prizehunt_logo_ani/prizehunt_logo_win_ani.json","prizehunt-prizehunt_logo_ani-se_otakara_finish.mp3":"../prizehunt/res/prizehunt_quest/prizehunt_logo_ani/se_otakara_finish.mp3","prizehunt-prizehunt_logo_ani-se_treasure_boss.mp3":"../prizehunt/res/prizehunt_quest/prizehunt_logo_ani/se_treasure_boss.mp3","prizehunt-prizehunt_logo_ani-se_treasure_zako.mp3":"../prizehunt/res/prizehunt_quest/prizehunt_logo_ani/se_treasure_zako.mp3","prizehunt-prizehunt_quest-prizehunt_quest":"../prizehunt/res/prizehunt_quest/prizehunt_quest.json","prizehunt-prizehunt_quest-prizehunt_quest_battle_rank_ui":"../prizehunt/res/prizehunt_quest/prizehunt_quest_battle_rank_ui.json","prizehunt-prizehunt_quest_font-battle_stage_num.fnt":"../prizehunt/res/prizehunt_quest/prizehunt_quest_font/battle_stage_num.fnt","prizehunt-prizehunt_quest_font-book_progress_num.fnt":"../prizehunt/res/prizehunt_quest/prizehunt_quest_font/book_progress_num.fnt","prizehunt-prizehunt_quest_font-lap_num.fnt":"../prizehunt/res/prizehunt_quest/prizehunt_quest_font/lap_num.fnt","prizehunt-prizehunt_quest_font-progress_num.fnt":"../prizehunt/res/prizehunt_quest/prizehunt_quest_font/progress_num.fnt","prizehunt-prizehunt_quest-prizehunt_quest_gauge_ui":"../prizehunt/res/prizehunt_quest/prizehunt_quest_gauge_ui.json","prizehunt-prizehunt_quest-prizehunt_quest_partylist_page_ui":"../prizehunt/res/prizehunt_quest/prizehunt_quest_partylist_page_ui.json","prizehunt-prizehunt_quest-prizehunt_quest_partylist_ui.csd":"../prizehunt/res/prizehunt_quest/prizehunt_quest_partylist_ui.csd.json","prizehunt-prizehunt_treasure_get_ani-bronze.mp3":"../prizehunt/res/prizehunt_quest/prizehunt_treasure_get_ani/bronze.mp3","prizehunt-prizehunt_treasure_get_ani-gold.mp3":"../prizehunt/res/prizehunt_quest/prizehunt_treasure_get_ani/gold.mp3","prizehunt-prizehunt_treasure_get_ani-prizehunt_treasure_get_ani_atlas.plist":"../prizehunt/res/prizehunt_quest/prizehunt_treasure_get_ani/prizehunt_treasure_get_ani_atlas.plist","prizehunt-prizehunt_treasure_get_ani-prizehunt_treasure_get_bronze_ani":"../prizehunt/res/prizehunt_quest/prizehunt_treasure_get_ani/prizehunt_treasure_get_bronze_ani.json","prizehunt-prizehunt_treasure_get_ani-prizehunt_treasure_get_gold_ani":"../prizehunt/res/prizehunt_quest/prizehunt_treasure_get_ani/prizehunt_treasure_get_gold_ani.json","prizehunt-prizehunt_treasure_get_ani-prizehunt_treasure_get_rainbow_ani":"../prizehunt/res/prizehunt_quest/prizehunt_treasure_get_ani/prizehunt_treasure_get_rainbow_ani.json","prizehunt-prizehunt_treasure_get_ani-prizehunt_treasure_get_silver_ani":"../prizehunt/res/prizehunt_quest/prizehunt_treasure_get_ani/prizehunt_treasure_get_silver_ani.json","prizehunt-prizehunt_treasure_get_ani-rainbow.mp3":"../prizehunt/res/prizehunt_quest/prizehunt_treasure_get_ani/rainbow.mp3","prizehunt-prizehunt_treasure_get_ani-silver.mp3":"../prizehunt/res/prizehunt_quest/prizehunt_treasure_get_ani/silver.mp3","prizehunt-prizehunt_top-prizehunt_top":"../prizehunt/res/prizehunt_top/prizehunt_top.json","prizehunt-prizehunt_top-prizehunt_treasurelist_page_ui":"../prizehunt/res/prizehunt_top/prizehunt_treasurelist_page_ui.json","prizehunt-prizehunt_top-prizehunt_treasurelist_ui":"../prizehunt/res/prizehunt_top/prizehunt_treasurelist_ui.json","prizehunt-prizehunt_top_notice-prizehunt_top_notice":"../prizehunt/res/prizehunt_top_notice/prizehunt_top_notice.json","core-popup_layer-prf_support_summon_set_result":"../core/res/popup/popup_layer/prf_support_summon_set_result.json","core-popup_layer-prf_support_summon_unset_result":"../core/res/popup/popup_layer/prf_support_summon_unset_result.json","core-popup-prf_edit_com":"../core/res/popup/prf_edit_com.json","profile-prf_001-prf_001_atlas.plist":"../profile/res/prf_001/prf_001_atlas.plist","profile-prf_001-prf_001_myself":"../profile/res/prf_001/prf_001_myself.json","profile-prf_001-prf_001_others":"../profile/res/prf_001/prf_001_others.json","profile-prf_001-prf_001_profile":"../profile/res/prf_001/prf_001_profile.json","profile-prf_001-prf_001_status":"../profile/res/prf_001/prf_001_status.json","profile-prf_001-prf_001_union":"../profile/res/prf_001/prf_001_union.json","profile-prf_005-prf_005_myself":"../profile/res/prf_005/prf_005_myself.json","profile-prf_005-prf_005_others":"../profile/res/prf_005/prf_005_others.json","profile-prf_005-prf_btn_reload.png":"../profile/res/prf_005/prf_btn_reload.png","profile-prf_btn_friend":"../profile/res/prf_btn_friend.json","profile-prf_btn_scout":"../profile/res/prf_btn_scout.json","profile-prf_comment_ui":"../profile/res/prf_comment_ui.json","profile-prf_popup_ui":"../profile/res/prf_popup_ui.json","profile-prf_support_summon_config-prf_support_summon_config":"../profile/res/prf_support_summon_config/prf_support_summon_config.json","profile-prf_support_summon_config-prf_support_summon_config_atlas.plist":"../profile/res/prf_support_summon_config/prf_support_summon_config_atlas.plist","core-btn-btn_tab_all_element_type_ui":"../core/res/btn/btn_tab_all_element_type_ui.json","core-btn-btn_tab_four_mini_ui":"../core/res/btn/btn_tab_four_mini_ui.json","core-userlist-supportlist_page_ui":"../core/res/pages/userlist/supportlist_page_ui.json","core-userlist-supportlist_ui":"../core/res/pages/userlist/supportlist_ui.json","core-popup-com_raid_appearance":"../core/res/popup/com_raid_appearance.json","core-popup-fapplist_base.png":"../core/res/popup/fapplist_base.png","core-popup_layer-acce_reward":"../core/res/popup/popup_layer/acce_reward.json","core-popup_layer-tower_quest_mission_data_ui":"../core/res/popup/popup_layer/tower_quest_mission_data_ui.json","core-popup_layer-tower_quest_popup_atlas.plist":"../core/res/popup/popup_layer/tower_quest_popup_atlas.plist","core-popup_layer-tower_quest_result":"../core/res/popup/popup_layer/tower_quest_result.json","core-popup-q_003_comp":"../core/res/popup/q_003_comp.json","core-popup-q_003_fapp":"../core/res/popup/q_003_fapp.json","core-popup-q_003_masterbonus":"../core/res/popup/q_003_masterbonus.json","core-popup-q_levelup":"../core/res/popup/q_levelup.json","core-popup-q_mvp":"../core/res/popup/q_mvp.json","core-popup-q_newitem":"../core/res/popup/q_newitem.json","quest-q_001-q_001":"../quest/res/q_001/q_001.json","quest-q_001-q_001_atlas_0.plist":"../quest/res/q_001/q_001_atlas_0.plist","quest-q_001-q_001_atlas_1.plist":"../quest/res/q_001/q_001_atlas_1.plist","quest-q_001-q_001_boss_node":"../quest/res/q_001/q_001_boss_node.json","quest-q_001-q_001_clear_node":"../quest/res/q_001/q_001_clear_node.json","quest-q_001-q_001_questlist_page_ui":"../quest/res/q_001/q_001_questlist_page_ui.json","quest-q_001-q_001_questlist_ui":"../quest/res/q_001/q_001_questlist_ui.json","quest-q_001-q_001_tab_ui":"../quest/res/q_001/q_001_tab_ui.json","quest-q_001-q_001_unknown_node":"../quest/res/q_001/q_001_unknown_node.json","quest-q_002-q_002":"../quest/res/q_002/q_002.json","quest-q_003-q_003_1":"../quest/res/q_003/q_003_1.json","quest-q_003-q_003_1_chara_ui":"../quest/res/q_003/q_003_1_chara_ui.json","quest-q_003-q_003_2":"../quest/res/q_003/q_003_2.json","quest-q_003-q_003_atlas.plist":"../quest/res/q_003/q_003_atlas.plist","quest-q_003-q_result_window.png":"../quest/res/q_003/q_result_window.png","quest-q_004-q_004":"../quest/res/q_004/q_004.json","quest-q_004-q_004_questlist":"../quest/res/q_004/q_004_questlist.json","quest-q_004-q_004_questlist_page_ui":"../quest/res/q_004/q_004_questlist_page_ui.json","quest-q_005-area_mist":"../quest/res/q_005/area_mist.json","quest-q_005-q_005":"../quest/res/q_005/q_005.json","quest-q_005-q_005_bg_0000.jpg":"../quest/res/q_005/q_005_bg_0000.jpg","quest-q_005-q_005_bg_0001.jpg":"../quest/res/q_005/q_005_bg_0001.jpg","quest-q_005-q_005_bg_0002.jpg":"../quest/res/q_005/q_005_bg_0002.jpg","quest-q_005-q_005_enemyicon_ui":"../quest/res/q_005/q_005_enemyicon_ui.json","quest-q_005-q_005_map_1_atlas.plist":"../quest/res/q_005/q_005_map_1_atlas.plist","quest-q_005-q_005_map_1_ui":"../quest/res/q_005/q_005_map_1_ui.json","quest-q_005-q_005_map_2_ui":"../quest/res/q_005/q_005_map_2_ui.json","quest-q_005-q_005_map_3_ui":"../quest/res/q_005/q_005_map_3_ui.json","quest-q_006_7_8-q_006_7_8":"../quest/res/q_006_7_8/q_006_7_8.json","quest-q_006_7_8-q_006_7_8_atlas.plist":"../quest/res/q_006_7_8/q_006_7_8_atlas.plist","quest-q_006_7_8-q_006_raidlist_page_ui":"../quest/res/q_006_7_8/q_006_raidlist_page_ui.json","quest-q_006_7_8-q_006_raidlist_ui":"../quest/res/q_006_7_8/q_006_raidlist_ui.json","quest-q_006_7_8-q_007_8_raidendlist_page_ui":"../quest/res/q_006_7_8/q_007_8_raidendlist_page_ui.json","quest-q_006_7_8-q_007_8_raidendlist_ui":"../quest/res/q_006_7_8/q_007_8_raidendlist_ui.json","quest-q_009-q_009":"../quest/res/q_009/q_009.json","quest-q_009-raid_window.png":"../quest/res/q_009/raid_window.png","quest-q_010-q_010":"../quest/res/q_010/q_010.json","quest-q_010-q_010_atlas_0.plist":"../quest/res/q_010/q_010_atlas_0.plist","quest-q_010-q_010_atlas_1.plist":"../quest/res/q_010/q_010_atlas_1.plist","quest-q_010-q_010_player_discoverer_ui":"../quest/res/q_010/q_010_player_discoverer_ui.json","quest-q_010-q_010_player_mvp_second_ui":"../quest/res/q_010/q_010_player_mvp_second_ui.json","quest-q_010-q_010_player_mvp_ui":"../quest/res/q_010/q_010_player_mvp_ui.json","quest-q_010-q_010_result_failed_ui":"../quest/res/q_010/q_010_result_failed_ui.json","quest-q_010-q_010_result_succeed_ui":"../quest/res/q_010/q_010_result_succeed_ui.json","quest-q_010-q_010_reward_get_player_ui":"../quest/res/q_010/q_010_reward_get_player_ui.json","quest-q_010-q_result_failed_base.png":"../quest/res/q_010/q_result_failed_base.png","quest-q_010-q_result_success_base.png":"../quest/res/q_010/q_result_success_base.png","quest-q_010-q_success_effect_03.png":"../quest/res/q_010/q_success_effect_03.png","quest-q_010-q_success_effect_04.png":"../quest/res/q_010/q_success_effect_04.png","quest-q_011-q_011":"../quest/res/q_011/q_011.json","quest-q_011-q_011_bg.jpg":"../quest/res/q_011/q_011_bg.jpg","quest-q_011-q_011_need-item_ui":"../quest/res/q_011/q_011_need-item_ui.json","quest-q_011-q_011_questlist_page_ui":"../quest/res/q_011/q_011_questlist_page_ui.json","quest-q_011-q_011_questlist_ui":"../quest/res/q_011/q_011_questlist_ui.json","quest-q_atlas.plist":"../quest/res/q_atlas.plist","quest-q_map_chara":"../quest/res/q_map_chara.json","quest-q_need-item_ui":"../quest/res/q_need-item_ui.json","quest-q_popup_ui":"../quest/res/q_popup_ui.json","quest-q_portal_top-q_portal_top":"../quest/res/q_portal_top/q_portal_top.json","quest-q_portal_top_ani-q_portal_top_ani_atlas.plist":"../quest/res/q_portal_top/q_portal_top_ani/q_portal_top_ani_atlas.plist","quest-q_portal_top_ani-q_portal_top_release_ani_acce":"../quest/res/q_portal_top/q_portal_top_ani/q_portal_top_release_ani_acce.json","quest-q_portal_top_ani-q_portal_top_release_ani_conquest":"../quest/res/q_portal_top/q_portal_top_ani/q_portal_top_release_ani_conquest.json","quest-q_portal_top_ani-q_portal_top_release_ani_element_type":"../quest/res/q_portal_top/q_portal_top_ani/q_portal_top_release_ani_element_type.json","quest-q_portal_top_ani-q_portal_top_release_ani_epic":"../quest/res/q_portal_top/q_portal_top_ani/q_portal_top_release_ani_epic.json","quest-q_portal_top_ani-q_portal_top_release_ani_hlbattle":"../quest/res/q_portal_top/q_portal_top_ani/q_portal_top_release_ani_hlbattle.json","quest-q_portal_top_ani-q_portal_top_release_ani_main":"../quest/res/q_portal_top/q_portal_top_ani/q_portal_top_release_ani_main.json","quest-q_portal_top_ani-q_portal_top_release_ani_material":"../quest/res/q_portal_top/q_portal_top_ani/q_portal_top_release_ani_material.json","quest-q_portal_top_ani-q_portal_top_release_ani_raid":"../quest/res/q_portal_top/q_portal_top_ani/q_portal_top_release_ani_raid.json","quest-q_portal_top_ani-quest_unlock.mp3":"../quest/res/q_portal_top/q_portal_top_ani/quest_unlock.mp3","quest-q_portal_top-q_portal_top_atlas.plist":"../quest/res/q_portal_top/q_portal_top_atlas.plist","quest-q_portal_top-q_portal_top_btn_acce_ui":"../quest/res/q_portal_top/q_portal_top_btn_acce_ui.json","quest-q_portal_top-q_portal_top_btn_conquest_ui":"../quest/res/q_portal_top/q_portal_top_btn_conquest_ui.json","quest-q_portal_top-q_portal_top_btn_element_type_ui":"../quest/res/q_portal_top/q_portal_top_btn_element_type_ui.json","quest-q_portal_top-q_portal_top_btn_epic_ui":"../quest/res/q_portal_top/q_portal_top_btn_epic_ui.json","quest-q_portal_top-q_portal_top_btn_hlbattle_ui":"../quest/res/q_portal_top/q_portal_top_btn_hlbattle_ui.json","quest-q_portal_top-q_portal_top_btn_main_ui":"../quest/res/q_portal_top/q_portal_top_btn_main_ui.json","quest-q_portal_top-q_portal_top_btn_material_ui":"../quest/res/q_portal_top/q_portal_top_btn_material_ui.json","quest-q_portal_top-q_portal_top_btn_raid_ui":"../quest/res/q_portal_top/q_portal_top_btn_raid_ui.json","quest-q_special_top-q_special_top":"../quest/res/q_special_top/q_special_top.json","quest-q_special_top-q_special_top_questlist_page_ui":"../quest/res/q_special_top/q_special_top_questlist_page_ui.json","quest-q_special_top-q_special_top_questlist_ui":"../quest/res/q_special_top/q_special_top_questlist_ui.json","core-popup_layer-q_001_ap_open":"../core/res/popup/popup_layer/q_001_ap_open.json","raidevent-ra_000-ra_000":"../raidevent/res/ra_000/ra_000.json","raidevent-ra_001-ra_001":"../raidevent/res/ra_001/ra_001.json","raidevent-ra_001_first_animation-ra_001_first_ani":"../raidevent/res/ra_001/ra_001_first_animation/ra_001_first_ani.json","raidevent-ra_001_first_animation-ra_001_first_ani_atlas.plist":"../raidevent/res/ra_001/ra_001_first_animation/ra_001_first_ani_atlas.plist","raidevent-ra_001_first_animation-se_ra_first_ani.mp3":"../raidevent/res/ra_001/ra_001_first_animation/se_ra_first_ani.mp3","raidevent-ra_002-ra_002":"../raidevent/res/ra_002/ra_002.json","raidevent-ra_002-ra_002_questlist_page_ui":"../raidevent/res/ra_002/ra_002_questlist_page_ui.json","raidevent-ra_002-ra_002_questlist_ui":"../raidevent/res/ra_002/ra_002_questlist_ui.json","raidevent-ra_003-ra_003":"../raidevent/res/ra_003/ra_003.json","raidevent-ra_003-ra_003_receivedlist_page_ui":"../raidevent/res/ra_003/ra_003_receivedlist_page_ui.json","raidevent-ra_003-ra_003_receivedlist_ui":"../raidevent/res/ra_003/ra_003_receivedlist_ui.json","raidevent-ra_004-ra_004":"../raidevent/res/ra_004/ra_004.json","raidevent-ra_004-ra_004_gacha-slider_ui":"../raidevent/res/ra_004/ra_004_gacha-slider_ui.json","raidevent-ra_005-ra_005":"../raidevent/res/ra_005/ra_005.json","raidevent-ra_005-ra_result_corecard_ui":"../raidevent/res/ra_005/ra_result_corecard_ui.json","raidevent-ra_006-ra_006":"../raidevent/res/ra_006/ra_006.json","raidevent-ra_atlas.plist":"../raidevent/res/ra_atlas.plist","raidevent-ra_btn_ev-quest_ui":"../raidevent/res/ra_btn_ev-quest_ui.json","raidevent-ra_gacha-btn-gacha-btn1_0_01.png":"../raidevent/res/ra_gacha-btn/gacha-btn1_0_01.png","raidevent-ra_need-item_ui":"../raidevent/res/ra_need-item_ui.json","raidevent-ra_popup_ui":"../raidevent/res/ra_popup_ui.json","core-popup-a_q_002_brief":"../core/res/popup/a_q_002_brief.json","core-popup-a_q_002_log":"../core/res/popup/a_q_002_log.json","core-popup-a_q_002_log_list_ui":"../core/res/popup/a_q_002_log_list_ui.json","core-ranking_reward-ranking_arrow_ui":"../core/res/pages/ranking_reward/ranking_arrow_ui.json","core-side_navi-side_navi_3_atlas.plist":"../core/res/pages/side_navi/side_navi_3_atlas.plist","core-side_navi-side_navi_3_ui":"../core/res/pages/side_navi/side_navi_3_ui.json","core-popup_layer-scoreattack_ranking_rule":"../core/res/popup/popup_layer/scoreattack_ranking_rule.json","core-popup_layer-scoreattack_score_detail":"../core/res/popup/popup_layer/scoreattack_score_detail.json","scoreattack-scoreattack_atlas.plist":"../scoreattack/res/scoreattack_atlas.plist","scoreattack-scoreattack_popup_ui":"../scoreattack/res/scoreattack_popup_ui.json","scoreattack-scoreattack_quest-scoreattack_quest":"../scoreattack/res/scoreattack_quest/scoreattack_quest.json","scoreattack-scoreattack_quest-scoreattack_quest_list_page_ui":"../scoreattack/res/scoreattack_quest/scoreattack_quest_list_page_ui.json","scoreattack-scoreattack_quest-scoreattack_quest_list_ui":"../scoreattack/res/scoreattack_quest/scoreattack_quest_list_ui.json","scoreattack-scoreattack_ranking-scoreattack_ranking":"../scoreattack/res/scoreattack_ranking/scoreattack_ranking.json","scoreattack-scoreattack_ranking-scoreattack_ranking_list_page_ui":"../scoreattack/res/scoreattack_ranking/scoreattack_ranking_list_page_ui.json","scoreattack-scoreattack_ranking-scoreattack_ranking_list_ui":"../scoreattack/res/scoreattack_ranking/scoreattack_ranking_list_ui.json","scoreattack-scoreattack_reward-scoreattack_reward":"../scoreattack/res/scoreattack_reward/scoreattack_reward.json","scoreattack-scoreattack_reward-scoreattack_reward_list_page_ui":"../scoreattack/res/scoreattack_reward/scoreattack_reward_list_page_ui.json","scoreattack-scoreattack_reward-scoreattack_reward_list_ui":"../scoreattack/res/scoreattack_reward/scoreattack_reward_list_ui.json","scoreattack-scoreattack_top-scoreattack_top":"../scoreattack/res/scoreattack_top/scoreattack_top.json","scoreattack-scoreattack_top_end-scoreattack_top_end":"../scoreattack/res/scoreattack_top_end/scoreattack_top_end.json","scoreattack-scoreattack_top_notice-scoreattack_top_notice":"../scoreattack/res/scoreattack_top_notice/scoreattack_top_notice.json","serial-seri_000-seri_000":"../serial/res/seri_000/seri_000.json","serial-seri_000-seri_attention_line.png":"../serial/res/seri_000/seri_attention_line.png","set-set_001-set_001":"../set/res/set_001/set_001.json","set-set_001-set_001_atlas.plist":"../set/res/set_001/set_001_atlas.plist","core-btn-btn_tab_variable_ui":"../core/res/btn/btn_tab_variable_ui.json","core-category_text-category_text_atlas.plist":"../core/res/pages/category_text/category_text_atlas.plist","core-side_navi-side_navi_1_atlas.plist":"../core/res/pages/side_navi/side_navi_1_atlas.plist","core-side_navi-side_navi_1_ui":"../core/res/pages/side_navi/side_navi_1_ui.json","core-popup_layer-com_filter_shop":"../core/res/popup/popup_layer/com_filter_shop.json","core-popup_layer-com_need_mate":"../core/res/popup/popup_layer/com_need_mate.json","core-popup_layer-sh_currency_caution":"../core/res/popup/popup_layer/sh_currency_caution.json","shop-sh_001-sh_001":"../shop/res/sh_001/sh_001.json","shop-sh_001-sh_001_event_bannerlist_page_ui":"../shop/res/sh_001/sh_001_event_bannerlist_page_ui.json","shop-sh_002-sh_002":"../shop/res/sh_002/sh_002.json","shop-sh_101-sh_101":"../shop/res/sh_101/sh_101.json","shop-sh_101-sh_101_event_bannerlist_page_ui":"../shop/res/sh_101/sh_101_event_bannerlist_page_ui.json","shop-sh_102-sh_102":"../shop/res/sh_102/sh_102.json","shop-sh_102-sh_currency_list_ui":"../shop/res/sh_102/sh_currency_list_ui.json","shop-sh_102-sh_currency_ui":"../shop/res/sh_102/sh_currency_ui.json","shop-sh_102-sh_material_ui":"../shop/res/sh_102/sh_material_ui.json","shop-sh_102-sh_materiallist_list_ui":"../shop/res/sh_102/sh_materiallist_list_ui.json","shop-sh_102-sh_materiallist_ui":"../shop/res/sh_102/sh_materiallist_ui.json","shop-sh_event_banner_ui":"../shop/res/sh_event_banner_ui.json","shop-sh_popup_ui":"../shop/res/sh_popup_ui.json","shop-sh_red_list_ui":"../shop/res/sh_red_list_ui.json","shop-sh_red_ui":"../shop/res/sh_red_ui.json","shop-shop_atlas_0.plist":"../shop/res/shop_atlas_0.plist","shop-shop_bg.jpg":"../shop/res/shop_bg.jpg","status-sellprice_base.png":"../status/res/sellprice_base.png","status-status_001-status_001":"../status/res/status_001/status_001.json","status-status_002-status_002":"../status/res/status_002/status_002.json","status-status_003-status_003":"../status/res/status_003/status_003.json","status-status_btn_ui":"../status/res/status_btn_ui.json","status-status_popup_ui":"../status/res/status_popup_ui.json","core-popup_layer-com_privacy_policy_change":"../core/res/popup/popup_layer/com_privacy_policy_change.json","top-top_001-mainmenu_bg_particle.plist":"../top/res/top_001/mainmenu_bg_particle.plist","top-top_001-top_001":"../top/res/top_001/top_001.json","top-top_001-top_001_atlas.plist":"../top/res/top_001/top_001_atlas.plist","top-top_001-top_btn_gamestart":"../top/res/top_001/top_btn_gamestart.json","top-top_001-top_btn_particle_0.plist":"../top/res/top_001/top_btn_particle_0.plist","top-top_001-top_btn_particle_1.plist":"../top/res/top_001/top_btn_particle_1.plist","top-top_001-top_logo_particle.plist":"../top/res/top_001/top_logo_particle.plist","top-top_001-top_logo_particle.png":"../top/res/top_001/top_logo_particle.png","top-top_popup_ui":"../top/res/top_popup_ui.json","core-popup_layer-tower_give_item":"../core/res/popup/popup_layer/tower_give_item.json","core-popup_layer-tower_quest_battle_data":"../core/res/popup/popup_layer/tower_quest_battle_data.json","core-popup_layer-tower_quest_battle_data_enemy_ui":"../core/res/popup/popup_layer/tower_quest_battle_data_enemy_ui.json","core-popup_layer-tower_quest_cannot_start":"../core/res/popup/popup_layer/tower_quest_cannot_start.json","core-popup_layer-tower_quest_confirm_start":"../core/res/popup/popup_layer/tower_quest_confirm_start.json","core-popup_layer-tower_quest_item_shortage":"../core/res/popup/popup_layer/tower_quest_item_shortage.json","core-popup_layer-tower_quest_mission_data":"../core/res/popup/popup_layer/tower_quest_mission_data.json","core-popup_layer-tower_ranking_rule":"../core/res/popup/popup_layer/tower_ranking_rule.json","tower-tower_arisa_ani-tower_arisa_ani_atlas.plist":"../tower/res/tower_arisa_ani/tower_arisa_ani_atlas.plist","tower-tower_arisa_ani-tower_arisa_ani_ui":"../tower/res/tower_arisa_ani/tower_arisa_ani_ui.json","tower-tower_atlas.plist":"../tower/res/tower_atlas.plist","tower-tower_cloud_ani-tower_cloud_ani_atlas.plist":"../tower/res/tower_cloud_ani/tower_cloud_ani_atlas.plist","tower-tower_cloud_ani-tower_cloud_back_back_ani_ui":"../tower/res/tower_cloud_ani/tower_cloud_back_back_ani_ui.json","tower-tower_cloud_ani-tower_cloud_back_front_ani_ui":"../tower/res/tower_cloud_ani/tower_cloud_back_front_ani_ui.json","tower-tower_cloud_ani-tower_cloud_front_ani_ui":"../tower/res/tower_cloud_ani/tower_cloud_front_ani_ui.json","tower-tower_dia_ani-tower_dia_ani_atlas.plist":"../tower/res/tower_dia_ani/tower_dia_ani_atlas.plist","tower-tower_dia_ani-tower_dia_ani_ui":"../tower/res/tower_dia_ani/tower_dia_ani_ui.json","tower-tower_popup_ui":"../tower/res/tower_popup_ui.json","tower-tower_quest-tower_bg_sky.jpg":"../tower/res/tower_quest/tower_bg_sky.jpg","tower-tower_quest-tower_quest":"../tower/res/tower_quest/tower_quest.json","tower-tower_quest-tower_quest_atlas.plist":"../tower/res/tower_quest/tower_quest_atlas.plist","tower-tower_quest-tower_quest_balloon_ui":"../tower/res/tower_quest/tower_quest_balloon_ui.json","tower-tower_quest-tower_quest_btn_challenge_ui":"../tower/res/tower_quest/tower_quest_btn_challenge_ui.json","tower-tower_quest-tower_quest_door_ui":"../tower/res/tower_quest/tower_quest_door_ui.json","tower-tower_quest-tower_quest_list_page_ui":"../tower/res/tower_quest/tower_quest_list_page_ui.json","tower-tower_quest-tower_quest_list_ui":"../tower/res/tower_quest/tower_quest_list_ui.json","tower-tower_ranking-tower_ranking":"../tower/res/tower_ranking/tower_ranking.json","tower-tower_ranking-tower_ranking_list_page_ui":"../tower/res/tower_ranking/tower_ranking_list_page_ui.json","tower-tower_ranking-tower_ranking_list_ui":"../tower/res/tower_ranking/tower_ranking_list_ui.json","tower-tower_ranking_reward-tower_ranking_reward":"../tower/res/tower_ranking_reward/tower_ranking_reward.json","tower-tower_ranking_reward-tower_ranking_reward_list_page_ui":"../tower/res/tower_ranking_reward/tower_ranking_reward_list_page_ui.json","tower-tower_ranking_reward-tower_ranking_reward_list_ui":"../tower/res/tower_ranking_reward/tower_ranking_reward_list_ui.json","tower-tower_top-tower_top":"../tower/res/tower_top/tower_top.json","tower-tower_top_end-tower_top_end":"../tower/res/tower_top_end/tower_top_end.json","tower-tower_top_notice-tower_top_notice":"../tower/res/tower_top_notice/tower_top_notice.json","core-popup_layer-a_q_003_player_card_ui":"../core/res/popup/popup_layer/a_q_003_player_card_ui.json","core-popup_layer-a_q_003_ranking_list_ui":"../core/res/popup/popup_layer/a_q_003_ranking_list_ui.json","core-popup_layer-a_q_003_ui_ranking":"../core/res/popup/popup_layer/a_q_003_ui_ranking.json","core-popup_layer-unievent_buff_error_a":"../core/res/popup/popup_layer/unievent_buff_error_a.json","core-popup_layer-unievent_buff_error_b":"../core/res/popup/popup_layer/unievent_buff_error_b.json","core-popup_layer-unievent_buff_error_c":"../core/res/popup/popup_layer/unievent_buff_error_c.json","core-popup_layer-unievent_buff_result":"../core/res/popup/popup_layer/unievent_buff_result.json","core-popup_layer-unievent_buff_result_base.png":"../core/res/popup/popup_layer/unievent_buff_result_base.png","core-popup_layer-unievent_buff_result_level_ui":"../core/res/popup/popup_layer/unievent_buff_result_level_ui.json","core-popup_layer-unievent_buff_use":"../core/res/popup/popup_layer/unievent_buff_use.json","core-popup_layer-unievent_buff_use_base.png":"../core/res/popup/popup_layer/unievent_buff_use_base.png","core-popup_layer-unievent_buff_use_level_ui":"../core/res/popup/popup_layer/unievent_buff_use_level_ui.json","core-popup_layer-unievent_login_bp":"../core/res/popup/popup_layer/unievent_login_bp.json","core-popup_layer-unievent_sort_ui":"../core/res/popup/popup_layer/unievent_sort_ui.json","core-popup_layer-uniraid_attention":"../core/res/popup/popup_layer/uniraid_attention.json","core-popup_layer-uniraid_rankinginfo":"../core/res/popup/popup_layer/uniraid_rankinginfo.json","unionraid-uniraid_000-uniraid_000":"../unionraid/res/uniraid_000/uniraid_000.json","unionraid-uniraid_001-uniraid_001":"../unionraid/res/uniraid_001/uniraid_001.json","unionraid-uniraid_002-uniraid_002":"../unionraid/res/uniraid_002/uniraid_002.json","unionraid-uniraid_002-uniraid_002_raidlist_page_ui":"../unionraid/res/uniraid_002/uniraid_002_raidlist_page_ui.json","unionraid-uniraid_002-uniraid_002_raidlist_ui":"../unionraid/res/uniraid_002/uniraid_002_raidlist_ui.json","unionraid-uniraid_004-uniraid_004":"../unionraid/res/uniraid_004/uniraid_004.json","unionraid-uniraid_004-uniraid_004_questlist_page_ui":"../unionraid/res/uniraid_004/uniraid_004_questlist_page_ui.json","unionraid-uniraid_004-uniraid_004_questlist_ui":"../unionraid/res/uniraid_004/uniraid_004_questlist_ui.json","unionraid-uniraid_005-uniraid_005":"../unionraid/res/uniraid_005/uniraid_005.json","unionraid-uniraid_005-uniraid_005_receivedlist_page_ui":"../unionraid/res/uniraid_005/uniraid_005_receivedlist_page_ui.json","unionraid-uniraid_005-uniraid_005_receivedlist_ui":"../unionraid/res/uniraid_005/uniraid_005_receivedlist_ui.json","unionraid-uniraid_007-uniraid_007":"../unionraid/res/uniraid_007/uniraid_007.json","unionraid-uniraid_008-uniraid_008":"../unionraid/res/uniraid_008/uniraid_008.json","unionraid-uniraid_008-uniraid_008_ranklist_page_ui":"../unionraid/res/uniraid_008/uniraid_008_ranklist_page_ui.json","unionraid-uniraid_008-uniraid_008_ranklist_ui":"../unionraid/res/uniraid_008/uniraid_008_ranklist_ui.json","unionraid-uniraid_009-uniraid_009":"../unionraid/res/uniraid_009/uniraid_009.json","unionraid-uniraid_009-uniraid_009_receivedlist_page_ui":"../unionraid/res/uniraid_009/uniraid_009_receivedlist_page_ui.json","unionraid-uniraid_009-uniraid_009_receivedlist_ui":"../unionraid/res/uniraid_009/uniraid_009_receivedlist_ui.json","unionraid-uniraid_atlas.plist":"../unionraid/res/uniraid_atlas.plist","unionraid-uniraid_battle_status_ui":"../unionraid/res/uniraid_battle_status_ui.json","unionraid-uniraid_battle_time_font.fnt":"../unionraid/res/uniraid_battle_time_font.fnt","unionraid-uniraid_btn_daemon_ui":"../unionraid/res/uniraid_btn_daemon_ui.json","unionraid-uniraid_btn_interchange_ui":"../unionraid/res/uniraid_btn_interchange_ui.json","unionraid-uniraid_btn_unionchat_ui":"../unionraid/res/uniraid_btn_unionchat_ui.json","unionraid-uniraid_expert_expedition_p_no_label":"../unionraid/res/uniraid_expert_expedition_p_no_label.json","unionraid-uniraid_info_buff_battle_time":"../unionraid/res/uniraid_info_buff_battle_time.json","unionraid-uniraid_info_buff_ui":"../unionraid/res/uniraid_info_buff_ui.json","unionraid-uniraid_info_own_union_name_ui":"../unionraid/res/uniraid_info_own_union_name_ui.json","unionraid-uniraid_info_ui":"../unionraid/res/uniraid_info_ui.json","unionraid-uniraid_popup_ui":"../unionraid/res/uniraid_popup_ui.json","unionraid-uniraid_ultimate_expedition_p_no_label":"../unionraid/res/uniraid_ultimate_expedition_p_no_label.json","unionraid-uniraid_union_total_p_no_label":"../unionraid/res/uniraid_union_total_p_no_label.json","core/res/btn/btn_atlas.png":"../core/res/btn/btn_atlas.png","core/res/btn/viewpage_atlas.png":"../core/res/btn/viewpage_atlas.png","core/res/corecard/corecard_atlas.png":"../core/res/corecard/corecard_atlas.png","core/res/font/attack_big.png":"../core/res/font/attack_big.png","core/res/font/hp_big.png":"../core/res/font/hp_big.png","core/res/font/item_get_num.png":"../core/res/font/item_get_num.png","core/res/font/my_header_power_no.png":"../core/res/font/my_header_power_no.png","core/res/font/my_header_rank_no.png":"../core/res/font/my_header_rank_no.png","core/res/icon/abilityicon.png":"../core/res/icon/abilityicon.png","core/res/icon/battletypeicon.png":"../core/res/icon/battletypeicon.png","core/res/icon/elementicon.png":"../core/res/icon/elementicon.png","core/res/icon/rarityicon.png":"../core/res/icon/rarityicon.png","core/res/icon/treasureicon.png":"../core/res/icon/treasureicon.png","core/res/icon/weapontypeicon.png":"../core/res/icon/weapontypeicon.png","core/res/introduce/introduce.png":"../core/res/introduce/introduce.png","core/res/introduce/introduce_acce/introduce_acce_atlas.png":"../core/res/introduce/introduce_acce/introduce_acce_atlas.png","core/res/menu/menu_atlas_0.png":"../core/res/menu/menu_atlas_0.png","core/res/pages/battletype_text/battletype_text_atlas.png":"../core/res/pages/battletype_text/battletype_text_atlas.png","core/res/pages/core_gauge_atlas.png":"../core/res/pages/core_gauge_atlas.png","core/res/pages/element_img/element_img_atlas.png":"../core/res/pages/element_img/element_img_atlas.png","core/res/pages/enh_ani/enh_ani_atlas.png":"../core/res/pages/enh_ani/enh_ani_atlas.png","core/res/pages/mainparts_atlas.png":"../core/res/pages/mainparts_atlas.png","core/res/pages/raid_btn/raid_atlas.png":"../core/res/pages/raid_btn/raid_atlas.png","core/res/pages/subparts_atlas.png":"../core/res/pages/subparts_atlas.png","core/res/popup/popup_base_0000.png":"../core/res/popup/popup_base_0000.png","core/res/popup/popup_btn_0000.png":"../core/res/popup/popup_btn_0000.png","core/res/popup/popup_icon_0000.png":"../core/res/popup/popup_icon_0000.png","core/res/popup/popup_layer/popup_layer_atlas_0.png":"../core/res/popup/popup_layer/popup_layer_atlas_0.png","core/res/quest_select/quest_select_atlas.png":"../core/res/quest_select/quest_select_atlas.png","core/res/ui_main/headerparts/headerparts_atlas.png":"../core/res/ui_main/headerparts/headerparts_atlas.png","core/res/ui_main/mainmenu/mainmenu_atlas.png":"../core/res/ui_main/mainmenu/mainmenu_atlas.png","acce/res/acce_atlas_0.png":"../acce/res/acce_atlas_0.png","acce/res/acce_atlas_1.png":"../acce/res/acce_atlas_1.png","autospend/res/autospend_atlas.png":"../autospend/res/autospend_atlas.png","battle/res/battle_ui/a_q_001_atlas_0.png":"../battle/res/battle_ui/a_q_001_atlas_0.png","battle/res/battle_ui/a_q_001_atlas_1.png":"../battle/res/battle_ui/a_q_001_atlas_1.png","battle/res/battle_ui/a_q_001_atlas_2.png":"../battle/res/battle_ui/a_q_001_atlas_2.png","battle/res/battle_ui/a_q_001_atlas_3.png":"../battle/res/battle_ui/a_q_001_atlas_3.png","battle/res/battle_ui/a_q_001_atlas_element.png":"../battle/res/battle_ui/a_q_001_atlas_element.png","battle/res/battle_ani/cutin_burst/battle_direct_burst_0.png":"../battle/res/battle_ani/cutin_burst/battle_direct_burst_0.png","battle/res/battle_ui/battlecard-text_burst.png":"../battle/res/battle_ui/battlecard-text_burst.png","battle/res/battle_ui/battlecard-text_hp.png":"../battle/res/battle_ui/battlecard-text_hp.png","battle/res/battle_ui/battle_summon_text.png":"../battle/res/battle_ui/battle_summon_text.png","battle/res/rank_exp_get/Plist.png":"../battle/res/rank_exp_get/Plist.png","battle/res/rank_exp_get/rank_no.png":"../battle/res/rank_exp_get/rank_no.png","battle/res/rank_exp_get/exp_no.png":"../battle/res/rank_exp_get/exp_no.png","battle/res/battle_ui/turnplate_no.png":"../battle/res/battle_ui/turnplate_no.png","battle/res/battle_effect_text/battle_effecttext_no.png":"../battle/res/battle_effect_text/battle_effecttext_no.png","battle/res/battle_damage_text/battle_damage_text_darkness.png":"../battle/res/battle_damage_text/battle_damage_text_darkness.png","battle/res/battle_damage_text/battle_damage_text_flame.png":"../battle/res/battle_damage_text/battle_damage_text_flame.png","battle/res/battle_damage_text/battle_damage_text_heal.png":"../battle/res/battle_damage_text/battle_damage_text_heal.png","battle/res/battle_damage_text/battle_damage_text_light.png":"../battle/res/battle_damage_text/battle_damage_text_light.png","battle/res/battle_damage_text/battle_damage_text_nonelemental.png":"../battle/res/battle_damage_text/battle_damage_text_nonelemental.png","battle/res/battle_damage_text/battle_damage_text_thunder.png":"../battle/res/battle_damage_text/battle_damage_text_thunder.png","battle/res/battle_damage_text/battle_damage_text_water.png":"../battle/res/battle_damage_text/battle_damage_text_water.png","battle/res/battle_damage_text/battle_damage_text_wind.png":"../battle/res/battle_damage_text/battle_damage_text_wind.png","battle/res/battle_damage_text/battle_damage_text_phantom.png":"../battle/res/battle_damage_text/battle_damage_text_phantom.png","battle/res/battle_ui/a_q_003_atlas_0.png":"../battle/res/battle_ui/a_q_003_atlas_0.png","battle/res/battle_ani/treasure_get/tre_get.png":"../battle/res/battle_ani/treasure_get/tre_get.png","battle/res/battle_ani/effect_summon/summon0.png":"../battle/res/battle_ani/effect_summon/summon0.png","battle/res/battle_ani/effect_ability/use_ability0.png":"../battle/res/battle_ani/effect_ability/use_ability0.png","battle/res/battle_ani/win_lose/lose_0000.png":"../battle/res/battle_ani/win_lose/lose_0000.png","battle/res/battle_ani/win_lose/win_0000.png":"../battle/res/battle_ani/win_lose/win_0000.png","battle/res/battle_ani/fight/fight0.png":"../battle/res/battle_ani/fight/fight0.png","battle/res/battle_effect_base/battle_effect_base0.png":"../battle/res/battle_effect_base/battle_effect_base0.png","battle/res/battle_ani/cutin_burst/battle_common_nameplate.png":"../battle/res/battle_ani/cutin_burst/battle_common_nameplate.png","battle/res/battle_ui/a_q_003_atlas_0_pc.png":"../battle/res/battle_ui/a_q_003_atlas_0_pc.png","battle/res/battle_ani/next_stage/battle_direct_nextstage_pc.png":"../battle/res/battle_ani/next_stage/battle_direct_nextstage_pc.png","battle/res/battle_ui/burst_count_no.png":"../battle/res/battle_ui/burst_count_no.png","battle/res/battle_ani/standby_burst/standby_burst0.png":"../battle/res/battle_ani/standby_burst/standby_burst0.png","core/res/popup/popup_layer/party_change_popup_atlas.png":"../core/res/popup/popup_layer/party_change_popup_atlas.png","core/res/pages/final_evo_btn/btn_evo_final_after_before_atlas.png":"../core/res/pages/final_evo_btn/btn_evo_final_after_before_atlas.png","beginner_mission/res/beginner_mission_ani/beginner_mission_ani_atlas.png":"../beginner_mission/res/beginner_mission_ani/beginner_mission_ani_atlas.png","beginner_mission/res/beginner_mission_atlas.png":"../beginner_mission/res/beginner_mission_atlas.png","core/res/pages/weapon_type_text/weapon_type_text_atlas.png":"../core/res/pages/weapon_type_text/weapon_type_text_atlas.png","core/res/icon/queststatusicon_atlas.png":"../core/res/icon/queststatusicon_atlas.png","core/res/pages/side_navi/side_navi_0_ui_atlas.png":"../core/res/pages/side_navi/side_navi_0_ui_atlas.png","conquest/res/con_001/con_001_first_animation/con_001_first_ani_atlas.png":"../conquest/res/con_001/con_001_first_animation/con_001_first_ani_atlas.png","conquest/res/con_005/con_005_atlas.png":"../conquest/res/con_005/con_005_atlas.png","conquest/res/conquest_atlas.png":"../conquest/res/conquest_atlas.png","core/res/icon/statustypeicon.png":"../core/res/icon/statustypeicon.png","core/res/introduce/introduce_summon/introduce_summon_atlas.png":"../core/res/introduce/introduce_summon/introduce_summon_atlas.png","core/res/introduce/statuslist/statuslist_atlas.png":"../core/res/introduce/statuslist/statuslist_atlas.png","core/res/pages/favorite_btn/favorite_btn_atlas.png":"../core/res/pages/favorite_btn/favorite_btn_atlas.png","core/res/pages/visual_change_btn/visual_change_btn_atlas.png":"../core/res/pages/visual_change_btn/visual_change_btn_atlas.png","enh_evo/res/enh_evo_atlas_0.png":"../enh_evo/res/enh_evo_atlas_0.png","enh_evo/res/enh_evo_atlas_1.png":"../enh_evo/res/enh_evo_atlas_1.png","core/res/pages/arousal_btn/arousal_btn_after_before_atlas.png":"../core/res/pages/arousal_btn/arousal_btn_after_before_atlas.png","core/res/pages/epiparts_atlas.png":"../core/res/pages/epiparts_atlas.png","epi/res/epi_atlas.png":"../epi/res/epi_atlas.png","core/res/pages/ranking_reward/ranking_reward_atlas.png":"../core/res/pages/ranking_reward/ranking_reward_atlas.png","epic/res/epic_atlas.png":"../epic/res/epic_atlas.png","exchangeitem/res/exchit_atlas.png":"../exchangeitem/res/exchit_atlas.png","core/res/pages/userlist/userlist_atlas.png":"../core/res/pages/userlist/userlist_atlas.png","core/res/corecard_chara/corecard_atlas.png":"../core/res/corecard_chara/corecard_atlas.png","core/res/corecard_summon/corecard_atlas.png":"../core/res/corecard_summon/corecard_atlas.png","core/res/corecard_weapon/corecard_atlas.png":"../core/res/corecard_weapon/corecard_atlas.png","mypage/res/notice_ani/gacha_add/gacha_add_atlas_1.png":"../mypage/res/notice_ani/gacha_add/gacha_add_atlas_1.png","gacha/res/ga_010/ga_simple_ani_nike/ga_ani_effect.png":"../gacha/res/ga_010/ga_simple_ani_nike/ga_ani_effect.png","gacha/res/ga_010/ga_simple_ani_nike/ga_ani_nike.png":"../gacha/res/ga_010/ga_simple_ani_nike/ga_ani_nike.png","gacha/res/ga_ani/ga_ani_atlas_0.png":"../gacha/res/ga_ani/ga_ani_atlas_0.png","gacha/res/ga_ani/ga_ani_atlas_1.png":"../gacha/res/ga_ani/ga_ani_atlas_1.png","gacha/res/ga_ani/ga_ani_atlas_2.png":"../gacha/res/ga_ani/ga_ani_atlas_2.png","gacha/res/ga_ani/ga_ani_ball.png":"../gacha/res/ga_ani/ga_ani_ball.png","gacha/res/ga_ani/ga_ani_nike_atlas.png":"../gacha/res/ga_ani/ga_ani_nike_atlas.png","gacha/res/ga_ani/ga_ani_rarity_atlas.png":"../gacha/res/ga_ani/ga_ani_rarity_atlas.png","gacha/res/ga_atlas.png":"../gacha/res/ga_atlas.png","core/res/pages/userlist/balloonlist_atlas.png":"../core/res/pages/userlist/balloonlist_atlas.png","guild/res/gud_001/gud_001_atlas.png":"../guild/res/gud_001/gud_001_atlas.png","guild/res/gud_atlas.png":"../guild/res/gud_atlas.png","guild/res/icon_guild_position.png":"../guild/res/icon_guild_position.png","core/res/font/job_level_no.png":"../core/res/font/job_level_no.png","highjob/res/highjob_ani/highjob_ani_atlas.png":"../highjob/res/highjob_ani/highjob_ani_atlas.png","highjob/res/highjob_atlas.png":"../highjob/res/highjob_atlas.png","hlbattle/res/hlbattle_atlas.png":"../hlbattle/res/hlbattle_atlas.png","mission/res/mission_atlas.png":"../mission/res/mission_atlas.png","mypage/res/my_001/my_atlas.png":"../mypage/res/my_001/my_atlas.png","mypage/res/my_001/my_btn_atlas/my_btn_atlas.png":"../mypage/res/my_001/my_btn_atlas/my_btn_atlas.png","mypage/res/notice_ani/gacha_add/gacha_add_atlas_0.png":"../mypage/res/notice_ani/gacha_add/gacha_add_atlas_0.png","note/res/no_atlas_0.png":"../note/res/no_atlas_0.png","core/res/font/attack_no.png":"../core/res/font/attack_no.png","core/res/font/hp_no.png":"../core/res/font/hp_no.png","core/res/introduce/introduce_job/introduce_job.png":"../core/res/introduce/introduce_job/introduce_job.png","party/res/jobchange_ani/jobchange_atlas.png":"../party/res/jobchange_ani/jobchange_atlas.png","party/res/jobget_ani/jobget_atlas.png":"../party/res/jobget_ani/jobget_atlas.png","party/res/par_001_2_3/par_001_2_3_atlas.png":"../party/res/par_001_2_3/par_001_2_3_atlas.png","party/res/par_006_7/par_006_7_atlas.png":"../party/res/par_006_7/par_006_7_atlas.png","party/res/par_atlas.png":"../party/res/par_atlas.png","poprank/res/poprank_atlas.png":"../poprank/res/poprank_atlas.png","present/res/present_atlas.png":"../present/res/present_atlas.png","core/res/font/prizehunt_num.png":"../core/res/font/prizehunt_num.png","core/res/popup/popup_layer/prizehunt_popup_atlas.png":"../core/res/popup/popup_layer/prizehunt_popup_atlas.png","prizehunt/res/prizehunt_atlas.png":"../prizehunt/res/prizehunt_atlas.png","prizehunt/res/prizehunt_quest/prizehunt_arisa_ani/prizehunt_arisa_ani_atlas.png":"../prizehunt/res/prizehunt_quest/prizehunt_arisa_ani/prizehunt_arisa_ani_atlas.png","prizehunt/res/prizehunt_quest/prizehunt_logo_ani/prizehunt_logo_ani_atlas.png":"../prizehunt/res/prizehunt_quest/prizehunt_logo_ani/prizehunt_logo_ani_atlas.png","prizehunt/res/prizehunt_quest/prizehunt_quest_font/battle_stage_num.png":"../prizehunt/res/prizehunt_quest/prizehunt_quest_font/battle_stage_num.png","prizehunt/res/prizehunt_quest/prizehunt_quest_font/book_progress_num.png":"../prizehunt/res/prizehunt_quest/prizehunt_quest_font/book_progress_num.png","prizehunt/res/prizehunt_quest/prizehunt_quest_font/lap_num.png":"../prizehunt/res/prizehunt_quest/prizehunt_quest_font/lap_num.png","prizehunt/res/prizehunt_quest/prizehunt_quest_font/progress_num.png":"../prizehunt/res/prizehunt_quest/prizehunt_quest_font/progress_num.png","prizehunt/res/prizehunt_quest/prizehunt_treasure_get_ani/prizehunt_treasure_get_ani_atlas.png":"../prizehunt/res/prizehunt_quest/prizehunt_treasure_get_ani/prizehunt_treasure_get_ani_atlas.png","profile/res/prf_001/prf_001_atlas.png":"../profile/res/prf_001/prf_001_atlas.png","profile/res/prf_support_summon_config/prf_support_summon_config_atlas.png":"../profile/res/prf_support_summon_config/prf_support_summon_config_atlas.png","core/res/popup/popup_layer/tower_quest_popup_atlas.png":"../core/res/popup/popup_layer/tower_quest_popup_atlas.png","quest/res/q_001/q_001_atlas_0.png":"../quest/res/q_001/q_001_atlas_0.png","quest/res/q_001/q_001_atlas_1.png":"../quest/res/q_001/q_001_atlas_1.png","quest/res/q_003/q_003_atlas.png":"../quest/res/q_003/q_003_atlas.png","quest/res/q_005/q_005_map_1_atlas.png":"../quest/res/q_005/q_005_map_1_atlas.png","quest/res/q_006_7_8/q_006_7_8_atlas.png":"../quest/res/q_006_7_8/q_006_7_8_atlas.png","quest/res/q_010/q_010_atlas_0.png":"../quest/res/q_010/q_010_atlas_0.png","quest/res/q_010/q_010_atlas_1.png":"../quest/res/q_010/q_010_atlas_1.png","quest/res/q_atlas.png":"../quest/res/q_atlas.png","quest/res/q_portal_top/q_portal_top_ani/q_portal_top_ani_atlas.png":"../quest/res/q_portal_top/q_portal_top_ani/q_portal_top_ani_atlas.png","quest/res/q_portal_top/q_portal_top_atlas.png":"../quest/res/q_portal_top/q_portal_top_atlas.png","raidevent/res/ra_001/ra_001_first_animation/ra_001_first_ani_atlas.png":"../raidevent/res/ra_001/ra_001_first_animation/ra_001_first_ani_atlas.png","raidevent/res/ra_atlas.png":"../raidevent/res/ra_atlas.png","core/res/pages/side_navi/side_navi_3_atlas.png":"../core/res/pages/side_navi/side_navi_3_atlas.png","scoreattack/res/scoreattack_atlas.png":"../scoreattack/res/scoreattack_atlas.png","set/res/set_001/set_001_atlas.png":"../set/res/set_001/set_001_atlas.png","core/res/pages/category_text/category_text_atlas.png":"../core/res/pages/category_text/category_text_atlas.png","core/res/pages/side_navi/side_navi_1_atlas.png":"../core/res/pages/side_navi/side_navi_1_atlas.png","shop/res/shop_atlas_0.png":"../shop/res/shop_atlas_0.png","top/res/top_001/top_001_atlas.png":"../top/res/top_001/top_001_atlas.png","tower/res/tower_arisa_ani/tower_arisa_ani_atlas.png":"../tower/res/tower_arisa_ani/tower_arisa_ani_atlas.png","tower/res/tower_atlas.png":"../tower/res/tower_atlas.png","tower/res/tower_cloud_ani/tower_cloud_ani_atlas.png":"../tower/res/tower_cloud_ani/tower_cloud_ani_atlas.png","tower/res/tower_dia_ani/tower_dia_ani_atlas.png":"../tower/res/tower_dia_ani/tower_dia_ani_atlas.png","tower/res/tower_quest/tower_quest_atlas.png":"../tower/res/tower_quest/tower_quest_atlas.png","unionraid/res/uniraid_atlas.png":"../unionraid/res/uniraid_atlas.png","unionraid/res/uniraid_battle_time_font.png":"../unionraid/res/uniraid_battle_time_font.png"},mp3Resources=["../core/res/pages/enh_ani/se_levelup_0001.mp3","../acce/res/se_mix_0001.mp3","../acce/res/se_mix_great_0001.mp3","../battle/res/battle_ani/fight/se_fight.mp3","../conquest/res/con_001/con_001_first_animation/se_ra_first_ani.mp3","../core/res/pages/enh_ani/se_levelup_0001.mp3","../core/res/pages/enh_ani/se_skill_up_0001.mp3","../enh_evo/res/se_breakthrough_0001.mp3","../enh_evo/res/se_mix_0001.mp3","../enh_evo/res/se_mix_great_0001.mp3","../gacha/res/ga_010/ga_simple_ani_nike/se_nomalgacha_10.mp3","../gacha/res/ga_ani/se_gacha_0001.mp3","../gacha/res/ga_ani/se_gacha_0002.mp3","../gacha/res/ga_ani/se_gacha_0003.mp3","../gacha/res/ga_ani/se_gacha_0004.mp3","../gacha/res/ga_ani/se_gacha_0005.mp3","../gacha/res/ga_ani/se_gacha_0006.mp3","../gacha/res/ga_ani/se_gacha_0009.mp3","../gacha/res/ga_ani/se_gacha_0011.mp3","../gacha/res/ga_ani/se_gacha_0012.mp3","../gacha/res/ga_ani/se_gacha_0013.mp3","../highjob/res/highjob_ani/se_page_exjob_1.mp3","../highjob/res/highjob_ani/se_page_exjob_2.mp3","../highjob/res/highjob_ani/se_page_exjob_3.mp3","../highjob/res/highjob_ani/se_page_exjob_4.mp3","../mypage/res/notice_ani/gacha_add/se_notice_01.mp3","../mypage/res/notice_ani/gacha_add/se_notice_02.mp3","../mypage/res/notice_ani/gacha_add/se_notice_03.mp3","../mypage/res/notice_ani/gacha_add/se_notice_04.mp3","../party/res/jobchange_ani/se_change_0001.mp3","../party/res/jobget_ani/se_open_0001.mp3","../prizehunt/res/prizehunt_quest/prizehunt_logo_ani/se_otakara_finish.mp3","../prizehunt/res/prizehunt_quest/prizehunt_logo_ani/se_treasure_boss.mp3","../prizehunt/res/prizehunt_quest/prizehunt_logo_ani/se_treasure_zako.mp3","../prizehunt/res/prizehunt_quest/prizehunt_treasure_get_ani/bronze.mp3","../prizehunt/res/prizehunt_quest/prizehunt_treasure_get_ani/gold.mp3","../prizehunt/res/prizehunt_quest/prizehunt_treasure_get_ani/rainbow.mp3","../prizehunt/res/prizehunt_quest/prizehunt_treasure_get_ani/silver.mp3","../quest/res/q_portal_top/q_portal_top_ani/quest_unlock.mp3","../raidevent/res/ra_001/ra_001_first_animation/se_ra_first_ani.mp3","../battle/res/battle_ani/fight/se_fight.mp3","../battle/res/battle_ani/fight/se_fight.mp3","../battle/res/battle_ani/fight/se_fight.mp3"];!function(e){e.kh=e.kh||{};var t=e.kh,n=e.cc,i=e.ccs,a=e._,o=e.res;t.QuestSceneCommonDelegate=n.Class.extend({SQUARE_MAX:5,ctor:function(){},owner:null,selected:"",_mainQuestList:null,_questInfoData:null,onExit:function(){this._mainQuestList=null,this._questInfoData=null,this.owner=null,this._questClearedAnimationDefer&&this._questClearedAnimationDefer.promise.isPending()&&(this._questClearedAnimationDefer.reject(),this._questClearedAnimationDefer=null)},_getMainNewLabelNode:function(){return this.owner.seekWidgetByPath("btn_main_quest..rest_label")},_getFreeNewLabelNode:function(){return this.owner.seekWidgetByPath("btn_free_quest..rest_label")},_getMainNewLabelBaseNode:function(){return this.owner.seekWidgetByPath("btn_main_quest..rest_base")},_getFreeNewLabelBaseNode:function(){return this.owner.seekWidgetByPath("btn_free_quest..rest_base")},setFreeNewLabel:function(e){this._setNewLabel("free",e)},setMainNewLabel:function(e){this._setNewLabel("main",e)},_setNewLabel:function(e,t){var n=0;a.each(t,function(e,t){n+=e.is_cleared?0:1},this);var i=this["_get"+a.capitalize(e)+"NewLabelNode"]();this["_get"+a.capitalize(e)+"NewLabelBaseNode"]().setVisible(0<n),i.setString(n)},checkComApRestartPopup:function(e){var t=this.getInProgressQuest(e);t&&this.__showPopup_comApRestart(t)},restartCheckInProgressQuest:function(e,t){var n=this.getInProgressQuest(t);if(!n)return!1;var i=this._isInProgressQuest(e,n);return 0===String(n.type).indexOf("epic_")&&(n.type="epic"),i?(this._restart(n),!0):(this.__showPopup_comApRestart(n),!0)},_isInProgressQuest:function(e,t){return!(!t||!e||e.a_quest_id!==t.a_quest_id||e.type!==t.type)},getInProgressQuest:function(e){if(e&&e.in_progress){if(e.in_progress.is_unverified)return null;var t=e.in_progress.own_quest||e.in_progress.own_raid;if(t)return t.type=t.type||"raid",t}return null},__showPopup_comApRestart:function(e){var n=this.owner.popups.comApRestart;n.open({questTitle:e.title,type:e.type}).then(function(){(n.seekWidgetByName("btn_withdrawal"),n.seekWidgetByName("btn_restart"),n.seekWidgetByName("confirm_label")).setString(t.w("popupQuestRestartLabel").replace("#replace#",e.title));var i=this;t.setTouchEventHandlers(n,{"TOUCH_ENDED btn_withdrawal":function(){i._giveup(e),n.dismiss()},"TOUCH_ENDED btn_restart":function(){i._restart(e),n.dismiss()}.bind(i)})}.bind(this))},_restart:function(e){var n=e.portal_type;if("material"===n||"elemental"===n||"accessory"===n){var i="material"===n?e.category:e.element_type;t.createInstance("questStateManager").restartQuest(e.a_quest_id,e.type,e.quest_id,n,i)}else t.createInstance("questStateManager").restartQuest(e.a_quest_id,e.type,e.quest_id)},_giveup:function(e){0===String(e.type).indexOf("epic_")&&(e.type="epic"),t.createInstance("apiAQuests").getGainedItems(e.a_quest_id,e.type).then(function(t){t.body.gained_items,this.owner.popups.comBackCheck.open({coin:t.body.gained_items.gem,normal:t.body.gained_items.wooden_box,silver:t.body.gained_items.silver_box,gold:t.body.gained_items.golden_box,rainbow:t.body.gained_items.rainbow_box,needToOpenComBackResult:!0,aQuestId:e.a_quest_id,questType:e.type}).then(function(){}.bind(this))}.bind(this))},setMainMoveNextIcon:function(e,n){t.env.isSp||a.each(n,function(t,n){var i=t.widget,a=t.record,o=i.seekWidgetByName("img_quest_info_icon"),r=o.getParent();e.in_progress&&e.in_progress.own_quest&&a.a_quest_id===e.in_progress.own_quest.a_quest_id&&a.type===e.in_progress.own_quest.type?(o.setVisible(!0),o.loadTexture("core/res/icon/queststatusicon_now.png",ccui.Widget.PLIST_TEXTURE),r.animate("default",!1)):a.a_quest_id===e.next_a_quest_id&&(o.loadTexture("core/res/icon/queststatusicon_new.png",ccui.Widget.PLIST_TEXTURE),o.setVisible(!0),r.animate("new",!0))})},setAreaAnimation:function(e,t){this._mainQuestList=e,this._questInfoData=t,this._questClearedAnimationDefer=Q.defer(),this._setSquareAnimation(),this._showNaviChara()},showNaviCharaOnNode:function(e){this.__playSquareAnimation($staticRes(o["quest-q_map_chara"]),e,0)},_showNaviChara:function(){var e=a.sortBy(this._mainQuestList,["quest_num"]);a.each(e,function(e,t){if(this._questInfoData.next_a_quest_id===e.a_quest_id){var n=this.owner.seekWidgetByName("q_map_mass_"+t);this.__playSquareAnimation($staticRes(o["quest-q_map_chara"]),n,0)}},this)},_setSquareAnimation:function(){var e=a.sortBy(this._mainQuestList,["quest_num"]),n=!1;a.each(a.range(this.SQUARE_MAX),function(i,a){var r=e[a],s=r&&r.is_cleared,c=this.owner.seekWidgetByName("q_map_mass_"+a),u=c.seekWidgetByName("q_map_mass_label"),l=r?""+r.quest_num+t.w("chapter"):"????";if(u.setString(l),r&&(r.squareNum=a),a<4&&r){var _=this.owner.seekWidgetByName("q_001_map_arrow_"+a),p=this.owner.seekWidgetByName("q_001_base_way_blue_"+a);_.setVisible(r.is_cleared),p.setVisible(r.is_cleared)}if(3!==a||s||this.__playSquareAnimation($staticRes(o["quest-q_001-q_001_boss_node"]),c,0),4!==a||s||this.__playSquareAnimation($staticRes(o["quest-q_001-q_001_unknown_node"]),c,0),s){this.__checkPlaySquareAnimation(r.quest_id)?(n=!0,this._questClearedAnimationDefer.promise.done(function(){this.__nextQuestShowPopup()}.bind(this)),this.__playSquareAnimation($staticRes(o["quest-q_001-q_001_clear_node"]),c,{start:0,end:60},!0).then(function(e){e.gotoFrameAndPlay(60,60,!0),this._questClearedAnimationDefer.resolve()}.bind(this))):this.__playSquareAnimation($staticRes(o["quest-q_001-q_001_clear_node"]),c,{start:60,end:60})}},this),this.__checkShowNextQuestPopup()&&!1===n&&this.__nextQuestShowPopup()},__checkPlaySquareAnimation:function(e){return this.owner.routerParams.quest_cleared_id===e&&(this._questInfoData.has_unlocked_quest||this._questInfoData.has_unlocked_area)},__checkShowNextQuestPopup:function(){return this._questInfoData.has_follow_up_quest||this._questInfoData.has_unlocked_quest||this._questInfoData.has_unlocked_area||this._questInfoData.has_completed_last_main_quest||this._questInfoData.has_unverified},__nextQuestShowPopup:function(){!this._questInfoData.has_follow_up_quest||null!=this._questInfoData.next_a_quest_id&&null!=this.__getCurrentQuestData()||(t.createInstance("apiAQuestInfo").confirmFollowUpPopup(),this._questInfoData.has_follow_up_quest=!1);var e=this.__getCurrentQuestData();if(this._questInfoData.has_unlocked_area)(n=this.owner.popups.q_newworld).open().then(function(){t.createInstance("apiAWorlds").getAreas().then(function(e){this._areas=e.body.a_areas;var i="<p><br />"+this.__getNextAreaData().area_name+"<br />"+t.w("release")+"!</p>";n.setContent(i)}.bind(this))}.bind(this));else if(this._questInfoData.has_follow_up_quest&&!a.isUndefined(e))this.owner.popups.q_001_ap_next.open().then(function(){var n=this.owner.seekWidgetByName("synopsis_label"),i=this.owner.popups.q_001_ap_next;i.blueBtn.setEnabled(!0);var o=e.description;e.episodes&&e.episodes.length&&(o=a.last(e.episodes).description),n.setString(o),i.setTitle(e.quest_num+t.w("chapter")+""+e.title+""),i._selectQuestData=e,t.createInstance("apiAQuestInfo").confirmFollowUpPopup()}.bind(this));else if(this._questInfoData.has_unlocked_quest){var n;(n=this.owner.popups.q_001_ap_open).open().then(function(){var e="<p><br />"+this.__getCurrentQuestData().title+"<br />"+t.w("release")+"!</p>";n.setContent(e),t.createInstance("apiAQuestInfo").confirmUnlockedQuestPopup()}.bind(this))}else this._questInfoData.has_completed_last_main_quest?this.owner.popups.q_quest_stop.open().then(function(){t.createInstance("apiAQuestInfo").confirmCompletedLastMainQuestPopup()}):this._questInfoData.has_unverified&&this.owner.popups.popupExistUnconfirmBattle.open()},__getCurrentQuestData:function(){return a.find(this._mainQuestList,function(e){return this._questInfoData.next_a_quest_id===e.a_quest_id},this)},__getNextAreaData:function(){return a.find(this._areas,function(e){return this._questInfoData.next_a_area_id===e.a_area_id},this)},__setSquareEndAnimationEvent:function(e,t){var n=new i.Timeline,a=new i.EventFrame;a.setEvent("endAnimation"),a.setFrameIndex(t-2),n.addFrame(a),e.addTimeline(n);var o=Q.defer();return e.setFrameEventCallFunc(function(t){"endAnimation"===t.getEvent()&&o.resolve(e)}),o.promise},__playSquareAnimation:function(e,t,n,a){var o=i.load($dynamicRes(e));o.node.runAction(o.action),t.addChild(o.node);var r=null;if(a)r=this.__setSquareEndAnimationEvent(o.action,n.end);return"object"==typeof n?o.action.gotoFrameAndPlay(n.start,n.end,!0):"number"==typeof n&&o.action.gotoFrameAndPlay(n,!0),o.node.setPosition(t.getSize().width>>1,t.getSize().height>>1),r},getEvents:function(){return{}}})}((this||0).self||global),function(e){e.kh=e.kh||{};var t=e.kh;e.cc,e.ccs,e._,e.res,t.QuestScenePcCommonDelegate=t.QuestSceneCommonDelegate.extend({ctor:function(){}})}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="Events",o={getQuest:function(){return this._http.get({url:"/events",json:{filter:"quest"}})},getRaidEvent:function(e){return this._http.get({url:"/events/raid_event/"+e})},getRaidEventNotice:function(e){return this._http.get({url:"/events/raid_event_notice/"+e})},getQuestEvent:function(e){return this._http.get({url:"/events/quest_event/"+e})},getQuestEventNotice:function(e){return this._http.get({url:"/events/quest_event_notice/"+e})},getUnionEvent:function(e){return this._http.get({url:"/events/union_event/"+e})},getUnionEventNotice:function(e){return this._http.get({url:"/events/union_event_notice/"+e})},getUnionRaidNotice:function(e){return this._http.get({url:"/events/union_raid_notice/"+e})},getUnionRaid:function(e){return this._http.get({url:"/events/union_raid/"+e})},getPoprankDescriptionImages:function(e){return this._http.get({url:"/events/poprank/"+e+"/description_images"})},getTowerNotice:function(e){return this._http.get({url:"/events/tower_event_notice/"+e})},getScoreAttackNotice:function(e){return this._http.get({url:"/events/score_attack_event_notice/"+e})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiEvents",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},o)),n.env.useApiMock){n.MockApi=n.MockApi||{};var r={};t.each(o,function(e,t){r[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi."+a+"."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},r))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="ABattles",o={getCheckUserBattlePoint:function(e){return this._http.get({url:"/a_battles/"+e})},joinBattle:function(e,t,n,i){return this._http.post({url:"/a_battles/"+e,json:{support_a_summon_id:t,a_party_id:n,quest_type:i}})},getHistoryList:function(){return this._http.get({url:"/a_battles",json:{kind:"history"}})},getUnverifiedList:function(){return this._http.get({url:"/a_battles",json:{kind:"unverified"}})},getRaidRequestList:function(){return this._http.get({url:"/a_battles",json:{kind:"raid_request"}})},getUnionRaidRequestList:function(e,t){return this._http.get({url:"/a_battles",json:{kind:"event",event_id:e,difficulty:t}})},getBattleResult:function(e,t){var n="/a_battles/"+e+"/result";return this._http.post({url:n,json:{quest_type:t}})},battleResult:function(e,t){var n="/a_battles/"+e+"/result";return this._http.get({url:n,json:{quest_type:t}})},getRanking:function(e,t){var n="/a_battles/"+e+"/ranking";return this._http.get({url:n,json:{quest_type:t}})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiABattles",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})},_createStartParam:function(e){return{url:this._urls.START,json:{quest_type:e}}},_createUseItemParam:function(e,t,n){var i={url:"/"+t+"/use"};return i.json=null!=n?{quest_type:e,chara_pos:n}:{quest_type:e},i},_createAttackParam:function(e,t,n){return{url:this._urls.ATTACK,json:{quest_type:e,burst_button_enabled:t,target:n}}},_createAttackSummonParam:function(e,t){return{url:this._urls.SUMMON_ATTACK,json:{quest_type:e,summon_pos:t}}},_createAbilityParam:function(e,t,n,i){return{url:this._urls.ABILITY,json:{quest_type:e,chara_pos:t,ability_pos:n,target:i}}}},o)),n.env.useApiMock){n.MockApi=n.MockApi||{};var r={};t.each(o,function(e,t){r[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi."+a+"."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},r))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),AQuests||(AQuests={}),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="AQuests",o={getQuest:function(e,t,n){return this._http.get({url:["/a_quests",e].join("/"),json:{type:t,account_id:n}})},startQuest:function(e,t,n,i,a,o){var r={type:t,a_party_id:n,support_a_summon_id:i};return void 0!==a&&(r.episode_num=a),void 0!==o&&(r.starting_lap=o),this._http.post({url:["/a_quests",e,"start"].join("/"),json:r})},checkQuest:function(e,t,n){return this._http.get({url:"/a_quests/"+e+"/check",json:{type:t,a_party_id:n}})},getNextState:function(e,t){return this._http.post({url:["/a_quests",e,"next_state"].join("/"),json:{type:t}})},getCurrentState:function(e,t){return this._http.get({url:"/a_quests/"+e+"/current_state",json:{type:t}})},getGainedItems:function(e,t){return this._http.get({url:["/a_quests",e,"gained_items"].join("/"),json:{type:t}})},giveupQuest:function(e,t){return this._http.post({url:["/a_quests",e,"giveup"].join("/"),json:{type:t}})},getQuestListByCategory:function(e){return this._http.get({url:"/a_quests",json:{type:"quest_portal",portal_type:e}})},getListSpecialQuest:function(e){return t.isUndefined(e)&&(e="special"),this._http.get({url:"/a_quests",json:{type:e}})},getListEventQuest:function(e,t){return this._http.get({url:"/a_quests",json:{type:t||"event",event_id:e}})},getListEventScenarioQuest:function(e){return this._http.get({url:"/a_quests",json:{type:"event_scenario",event_id:e}})},getListEventNotScenarioQuest:function(e){return this._http.get({url:"/a_quests",json:{type:"event_not_scenario",event_id:e}})},getCheckUserAP:function(e,t){return this._http.get({url:"/a_quests/"+e+"/check_user_ap",json:{type:t}})},getUnconfirmedHaremEpisodes:function(e,t){return this._http.get({url:"/a_quests",json:{type:"harem",unconfirmed:!0,page:e,per_page:t}})},getListHaremByCharacter:function(e){return this._http.get({url:"/a_quests",json:{type:"harem-character",character_id:e}})},getListHaremBySummon:function(e){return this._http.get({url:"/a_quests",json:{type:"harem-summon",summon_id:e}})},getListHaremByJob:function(e){return this._http.get({url:"/a_quests",json:{type:"harem-job",job_id:e}})},getListExHarem:function(e,t){return this._http.get({url:"/a_quests",json:{type:"harem-ex",page:e,per_page:t}})},getListRaid:function(){return this._http.get({url:"/a_quests",json:{type:"raid"}})},getBattleInfo:function(e,t){return this._http.get({url:"/a_quests/"+t+"/battle_info",json:{type:e}})}};n.Api[a]=i.Class.extend(t.assign({className:"KHApiAQuests",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},o));var r=["TutorialApi"];if(n.env.useApiMock&&r.push("MockApi"),t.each(r,function(e){n[e]=n[e]||{};var r={};t.each(o,function(t,i){r[i]=function(){if(!n[e])throw"kh."+e+"is not defined";if(!n[e][a][i+"JSON"])throw"not implemented: kh."+e+"."+a+"."+i;var t=Q.defer();return t.resolve({body:n[e][a][i+"JSON"].apply(this,arguments)}),t.promise}}),n[e][a]=i.Class.extend(t.assign({},r))}),"undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,n){n+="JSON";var i="tutorialMock";t.each(["mock",i],function(e){var t="./"+e+"/"+n+".js";if(!s.existsSync(t)){var o=c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,n);e===i&&(o=o.replace(/MockApi/g,"TutorialApi")),s.writeFileSync(t,o)}})}),process.exit()}}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="AUnions",o={get:function(e){return this._http.get({url:"/a_unions/"+e})},getMe:function(){return this.get("me")},getBurstTimeInfo:function(e){return t.isUndefined(e)&&(e="me"),this._http.get({url:"/a_unions/"+e+"/burst_time_info"})},getChats:function(){return this._http.get({url:"/a_unions/me/chats"})},getDonationInfo:function(){return this._http.get({url:"/a_unions/me/donation_info"})},getGuardianDonationMaterials:function(e,t,i){return this._http.get({url:"/a_unions/me/guardian_donation_materials",json:{display_filter_name:n.displayFilter.enums.FILTER_NAME.GUILD_WEAPON,sort:e,page:t,per_page:i}})},getGuardians:function(e){return this._http.get({url:"/a_unions/me/guardians",json:{have:!!t.isUndefined(e)||e}})},getSelectedGuardian:function(){return this._http.get({url:"/a_unions/me/guardians/selected"})},setSelectedGuardian:function(e){return this._http.put({url:"/a_unions/me/guardians/selected",json:{a_guardian_id:e}})},getMembersExternal:function(e,t,n){return n=n||"me",this._http.get({url:"/a_unions/"+n+"/members",json:{page:e,per_page:t}})},getMembers:function(e,t){return this._http.get({url:"/a_unions/me/members",json:{page:e,per_page:t}})},getMember:function(e){return this._http.get({url:"/a_unions/me/members/"+e})},getNewInfo:function(){return this._http.get({url:"/a_unions/me/new_info"})},getNews:function(e,t){return this._http.get({url:"/a_unions/me/news",json:{page:e,per_page:t}})},dissolution:function(){return this._http.del({url:"/a_unions/me"})},getMembersForFire:function(e,t){return this._http.get({url:"/a_unions/me/members",json:{filter:"member_dismissed",page:e,per_page:t}})},fireMember:function(e){return this._http.del({url:"/a_unions/me/members/"+e})},leave:function(){return this._http.del({url:"/a_unions/me/members/me"})},create:function(e){return this._http.post({url:"/a_unions",json:{a_union_id:"me",name:e}})},comment:function(e){return n.createInstance("inspectionApiDelegate").createInspection(e).then(function(t){return this._http.post({url:"/a_unions/me/chats",json:{message:e,text_id:t.getTextId()}})}.bind(this))},stamp:function(e){return this._http.post({url:"/a_unions/me/chats",json:{stamp_id:e}})},deleteChat:function(e){return this._http.del({url:"/a_unions/me/chats/"+e})},donation:function(e){return this._http.post({url:"/a_unions/me/donation",json:{gem:e}})},guardianBuy:function(e){return this._http.post({url:"/a_unions/me/guardians_buy",json:{guardian_id:e}})},guardianDonationGem:function(e){return this._http.post({url:"/a_unions/me/guardian_donation",json:{gem:e}})},confirmGuardianEnhanceMaterials:function(e){return this._http.get({url:"/a_unions/me/confirm_guardian_enhance_materials",json:{ids:e}})},guardianDonationWeapons:function(e){return this._http.post({url:"/a_unions/me/guardian_donation",json:{ids:e}})},changeUnionName:function(e,t){return n.createInstance("inspectionApiDelegate").createOrUpdateInspection(t,e).then(function(t){return this._http.put({url:"/a_unions/me",json:{name:e,text_id:t}})}.bind(this))},changeUnionComment:function(e,t){return n.createInstance("inspectionApiDelegate").createOrUpdateInspection(t,e).then(function(t){return this._http.put({url:"/a_unions/me",json:{comment:e,text_id:t}})}.bind(this))},changeBurstTimeInfo:function(e){return this._http.put({url:"/a_unions/me/burst_time_info",json:{burst_time_info:{reserved_burst_times:e}}})},changeMemberUnionPosition:function(e,t){return this._http.put({url:"/a_unions/me/members/"+e,json:{union_position:t}})},getMembersForLeader:function(e,t){return this._http.get({url:"/a_unions/me/members",json:{filter:"appointed_to_leader",page:e,per_page:t}})},changeLeader:function(e){return this._http.put({url:"/a_unions/me/members/"+e,json:{union_position:"leader"}})},accept:function(e){return this._http.post({url:"/a_unions",json:{a_player_id:e}})},acceptScout:function(e){return this._http.post({url:"/a_unions",json:{a_union_id:e}})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiAUnions",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},o)),n.env.useApiMock){n.MockApi=n.MockApi||{};var r={};t.each(o,function(e,t){r[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi."+a+"."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},r))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="APlayers",o={getJobPoint:function(e){return this._http.get({url:"/a_players/"+e+"/job_point"})},get:function(e){return this._http.get({url:"/a_players/"+e})},getMe:function(){return this.get("me").then(this.__storeMeForLogging)},getMeEx:function(e){return this._http.get({url:"/a_players/me",json:{c:e}}).then(this.__storeMeForLogging)},__storeMeForLogging:function(e){var t=e.body,a={dmm_id:t.dmm_id,name:t.name};return n.createInstance("logger").setStatusInfo("player",a),i.sys.localStorage.setItem("KHUserId",null===t.dmm_id?"NULL":t.dmm_id),i.sys.localStorage.setItem("KHUserName",t.name),e},getMeNumeric:function(){return this._http.get({url:"/a_players/me",json:{id_numeric:!0}})},getCurrency:function(){return this._http.get({url:"/a_players/me/currency"})},getPlayerCurrency:function(e){return this._http.get({url:"/a_players/"+e+"/currency"})},getSelectedJobId:function(){return this._http.get({url:"/a_players/me/selected_job_id"})},getRecommended:function(){return this._http.get({url:"/a_players/",json:{recommended:!0}})},getListByRank:function(e){return this._http.get({url:"/a_players/",json:{rank:e}})},getQuestPoints:function(){return this._http.get({url:"/a_players/me/quest_points"})},getUnionJoinedLimitState:function(){return this._http.get({url:"/a_players/me/union_joined_limit_state"})},updateDescription:function(e,t){return n.createInstance("inspectionApiDelegate").createOrUpdateInspection(t,e).then(function(t){return this._http.put({url:"/a_players/me",json:{description:e,text_id:t}})}.bind(this))},getGameConfig:function(){return this._http.get({url:"/a_players/me/game_config"})},getSortConfig:function(){return this._http.get({url:"/a_players/me/sort_config"})},getAutoSpendConfig:function(e){return this._http.get({url:"/a_players/me/auto_spend_config",json:{type:e}})},getDisplayFilterConfig:function(e){return this._http.get({url:"/a_players/me/display_filter/"+e})},getMasterPoint:function(){return this._http.get({url:"/a_players/me/hero_master_point"})},updateGameConfig:function(e){return this._http.put({url:"/a_players/me/game_config",json:e})},updateAutoSpendConfig:function(e){return this._http.put({url:"/a_players/me/auto_spend_config",json:e})},updateGachaAnimationSkipFlag:function(e){return this._http.put({url:"/a_players/me/game_config",json:{gacha_animation_skip:e}})},updateSortConfig:function(e){return this._http.put({url:"/a_players/me/sort_config",json:e})},updateDisplayFilterConfig:function(e,t){return this._http.post({url:"/a_players/me/display_filter/"+e,json:t})},getSelectedPartyInfo:function(e){return this._http.get({url:"/a_players/"+e+"/selected_party_info"})},getBattlePower:function(){return this._http.get({url:"/a_players/me/battle_power"})},exchangeMasterPoint:function(e,t){return this._http.post({url:"/a_players/me/hero_master_point",json:{type:e,amount:t}})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiAPlayers",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},o)),n.env.useApiMock){n.MockApi=n.MockApi||{};var r={};t.each(o,function(e,t){r[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi."+a+"."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},r))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="AParties",o={changeJob:function(e,t){return this._http.put({url:"/a_parties/select_job/"+e,json:{a_job_id:t}})},setExAbility:function(e,t){return this._http.put({url:"/a_parties/ex_ability/"+e,json:{ex_ability_id:t}})},changeCharacter:function(e,t,n){return this._http.put({url:["/a_parties",e,"characters",t].join("/"),json:{a_character_id:n}})},changeWeapon:function(e,t,n){return this._http.put({url:["/a_parties",e,"weapons",t].join("/"),json:{a_weapon_id:n}})},changeSummon:function(e,t,n){return this._http.put({url:["/a_parties",e,"summons",t].join("/"),json:{a_summon_id:n}})},makeRecommendedDeck:function(e,t,n,i){return this._http.put({url:["/a_parties",e,"deck"].join("/"),json:{recommend:!0,target:t,element_type:n,character_rarities:i}})},getSelectedDeck:function(){return this.getDeck("selected")},getDeck:function(e){return this._http.get({url:["/a_parties",e,"deck"].join("/")})},getDecks:function(){return this._http.get({url:"/a_parties_decks"})},changeDeck:function(e){return this._http.put({url:["/a_parties",e].join("/"),json:{selected:!0}})},getExAbilitiesByParty:function(e){return this._http.get({url:["/a_parties",e,"ex_abilities"].join("/")})},getJobsByParty:function(e,t){return this._http.get({url:["/a_parties",e,"jobs",t].join("/")})},getSelectableCharactersByParty:function(e,t,i,a){return this._http.get({url:["/a_parties",e,"selectable_characters",t].join("/"),json:{display_filter_name:n.displayFilter.enums.FILTER_NAME.PARTY_CHARA,page:i,per_page:a}})},getSelectableWeaponsByParty:function(e,t,i,a){return this._http.get({url:["/a_parties",e,"selectable_weapons",t].join("/"),json:{display_filter_name:n.displayFilter.enums.FILTER_NAME.PARTY_WEAPON,page:i,per_page:a}})},getSelectableSummonsByParty:function(e,t,i,a){return this._http.get({url:["/a_parties",e,"selectable_summons",t].join("/"),json:{display_filter_name:n.displayFilter.enums.FILTER_NAME.PARTY_SUMMON,page:i,per_page:a}})},assignCharacters:function(e,t){return this._http.put({url:["/a_parties",e,"assign_characters"].join("/"),json:t})},selectAbility:function(e,t,n){return this._http.put({url:"/a_parties/select_ability/"+e,json:{slot_number:t,ability_id:n}})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiAParties",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},o)),n.env.useApiMock){n.MockApi=n.MockApi||{};var r={};t.each(o,function(e,t){r[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi.partyMock."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},r))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="AQuestInfo",o={get:function(){return this._http.get({url:"/a_quest_info"})},getRaid:function(){return this._http.get({url:"/a_quest_info/raid"})},getRaidAndHarem:function(){return this._http.get({url:"/a_quest_info/raid_and_harem"})},moveArea:function(e){return this._http.put({url:"/a_quest_info/me",json:{current_a_area_id:e}})},confirmFollowUpPopup:function(){return this._http.put({url:"/a_quest_info/me",json:{has_follow_up_quest:!1}})},confirmUnlockedQuestPopup:function(){return this._http.put({url:"/a_quest_info/me",json:{has_unlocked_quest:!1}})},confirmUnlockedAreaPopup:function(){return this._http.put({url:"/a_quest_info/me",json:{has_unlocked_area:!1}})},confirmCompletedLastMainQuestPopup:function(){return this._http.put({url:"/a_quest_info/me",json:{has_completed_last_main_quest:!1}})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiAQuestInfo",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},o)),n.env.useApiMock){n.MockApi=n.MockApi||{};var r={};t.each(o,function(e,t){r[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi."+a+"."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}},r),n.MockApi[a]=i.Class.extend(t.assign({},r))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="AAreas",o={getMainQuestsInCurrentArea:function(){return this._http.get({url:"/a_areas/current/quests",json:{type:"main"}})},getFreeQuestsInCurrentArea:function(){return this._http.get({url:"/a_areas/current/quests",json:{type:"free"}})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiAAreas",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},o)),n.env.useApiMock){n.MockApi=n.MockApi||{};var r={};t.each(o,function(e,t){r[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi."+a+"."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},r))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="AFriendOffers",o={makeOffer:function(e){return this._http.post({url:"/a_friend_offers",json:{from_player_id:"me",to_player_id:e}})},getList:function(e,t,n){return this._http.get({url:"/a_friend_offers",json:{type:e,page:t,per_page:n}})},deleteOffers:function(e){return this._http.del({url:"/a_friend_offers",json:{ids:e}})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiAFriendOffers",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},o)),n.env.useApiMock){n.MockApi=n.MockApi||{};var r={};t.each(o,function(e,t){r[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi."+a+"."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},r))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="AItems",o={getApGain:function(){return this._http.get({url:"/a_items",json:{type:"ap_gain"}})},getBpGain:function(){return this._http.get({url:"/a_items",json:{type:"bp_gain"}})},getCure:function(e,t){return this._http.get({url:"/a_items",json:{type:"cure",page:e,per_page:t}})},getEvolution:function(){return this._http.get({url:"/a_items",json:{type:"evolution"}})},getTreasure:function(e,t){return this._http.get({url:"/a_items",json:{type:"treasure",page:e,per_page:t}})},getTicket:function(e,t){return this._http.get({url:"/a_items",json:{type:"ticket",page:e,per_page:t,zero_omit:!0}})},useItem:function(e,t){return t=t||1,this._http.post({url:["/a_items",e,"use"].join("/"),json:{num:t}})},getCureEvolution:function(e,t){return this._http.get({url:"/a_items",json:{type:"cure_evolution",page:e,per_page:t}})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiAItems",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},o)),n.env.useApiMock){n.MockApi=n.MockApi||{};var r={};t.each(o,function(e,t){r[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi."+a+"."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}},r),n.MockApi[a]=i.Class.extend(t.assign({},r))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="AWorlds",o={getAreas:function(){return this._http.get({url:"/a_worlds/current"})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiAWorlds",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},o)),n.env.useApiMock){n.MockApi=n.MockApi||{};var r={};t.each(o,function(e,t){r[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi."+a+"."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},r))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="ASummons",o={get:function(e){return this._http.get({url:"/a_summons/"+e})},lock:function(e){return this._http.put({url:"/a_summons/"+e,json:{is_locked:!0}})},unlock:function(e){return this._http.put({url:"/a_summons/"+e,json:{is_locked:!1}})},getList:function(e,t,n){return this._http.get({url:"/a_summons/",json:{display_filter_name:e,page:t,per_page:n}})},getListEnhanceBase:function(e,t,i){return this._http.get({url:"/a_summons",json:{display_filter_name:n.displayFilter.enums.FILTER_NAME.ENH_BASE_SUMMON,selectable_base_filter:"enhance",sort:e,page:t,per_page:i}})},getEnhanceMaterials:function(e,t,i){return this._http.get({url:"/a_summons/"+e+"/enhance_materials",json:{display_filter_name:n.displayFilter.enums.FILTER_NAME.ENH_MATERIAL_SUMMON,page:t,per_page:i}})},getRecommendEnhanceMaterials:function(e){return this._http.get({url:"/a_summons/"+e+"/recommend_enhance_materials"})},getExpitem:function(e){return this._http.get({url:"/a_summons/"+e+"/enhance_exp_spheres"})},enhanceByExpitem:function(e,t){return this._http.post({url:"/a_summons/"+e+"/enhance_by_exp_sphere",json:{use_exp_point:t}})},confirmEnhanceMaterials:function(e,t){return this._http.get({url:"/a_summons/"+e+"/confirm_enhance_materials",json:{ids:t}})},enhance:function(e,t){return this._http.post({url:"/a_summons/"+e+"/enhance",json:{ids:t}})},getListEvolveBase:function(e,t,i){return this._http.get({url:"/a_summons",json:{display_filter_name:n.displayFilter.enums.FILTER_NAME.EVO_BASE_SUMMON,selectable_base_filter:"evolve",sort:e,page:t,per_page:i}})},getEvolveMaterials:function(e,t,i){return this._http.get({url:"/a_summons/"+e+"/evolve_materials",json:{display_filter_name:n.displayFilter.enums.FILTER_NAME.EVO_MATERIAL_SUMMON,page:t,per_page:i}})},confirmEvolveMaterial:function(e,t){return this._http.get({url:"/a_summons/"+e+"/confirm_evolve_material",json:{id:t}})},evolve:function(e,t){return this._http.post({url:"/a_summons/"+e+"/evolve",json:{id:t}})},getSupporterInfo:function(e,t){return this._http.get({url:"/a_summons/supporters/"+e,json:{element_type:t}})},getSupporters:function(e){return this._http.get({url:"/a_summons/supporters",json:{element_type:e}})},confirmSellPrice:function(e){return this._http.get({url:"/a_summons_sale_selection",json:{ids:e}})},sell:function(e){return this._http.post({url:"/a_summons_sale",json:{ids:e}})},getSellableList:function(e,t){return this._http.get({url:"/a_summons",json:{display_filter_name:n.displayFilter.enums.FILTER_NAME.SELL_SUMMON,selectable_base_filter:"sellable",page:e,per_page:t}})},getRecommendSellableList:function(){return this._http.get({url:"/a_summons",json:{sale_recommended:!0}})},getEnhanceEvolveInfo:function(e){return this._http.get({url:"/a_summons/"+e+"/enhance_evolve_info"})},getEvolutionItems:function(e){return this._http.get({url:"/a_summons/"+e+"/evolution_items"})},confirmEvolveByItem:function(e,t){return this._http.get({url:"/a_summons/"+e+"/confirm_evolve_by_item",json:{item_id:t}})},evolveByItem:function(e,t){return this._http.post({url:"/a_summons/"+e+"/evolve_by_item",json:{item_id:t}})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiASummons",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},o)),n.env.useApiMock){n.MockApi=n.MockApi||{};var r={};t.each(o,function(e,t){r[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi."+a+"."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},r))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="Shop",o="/shop/",r={getGoodsPoint:function(e,t){return this._http.get({url:o+"goods",json:{item_type:"shop_item",currency:"point",page:e,per_page:t}})},getGoodsStone:function(e,t){return this._http.get({url:o+"goods",json:{item_type:"shop_item",currency:"stone",page:e,per_page:t}})},getShop:function(e){return this._http.get({url:o+e})},getGoodsPseudoCurrency:function(e,t){return this._http.get({url:o+"goods",json:{item_type:"shop_item",currency:"kamihime_coin",page:e,per_page:t}})},getEvents:function(e){return this._http.get({url:o+"events/"+e})},getGoodsPointHeal:function(e,t){return this._http.get({url:o+"goods",json:{currency:"point",item_type:"heal",page:e,per_page:t}})},getGoodsPointExtension:function(e,t){return this._http.get({url:o+"goods",json:{currency:"point",item_type:"extension",page:e,per_page:t}})},getGoodsStoneHeal:function(e,t){return this._http.get({url:o+"goods",json:{currency:"stone",item_type:"heal",page:e,per_page:t}})},getGoodsStoneExtension:function(e,t){return this._http.get({url:o+"goods",json:{currency:"stone",item_type:"extension",page:e,per_page:t}})},getGoodsStoneContinue:function(){return this._http.get({url:o+"goods",json:{item_type:"continue",currency:"stone"}})},getGoodsPointContinue:function(){return this._http.get({url:o+"goods",json:{item_type:"continue",currency:"point"}})},getGoodsPseudoCurrencyApGain:function(){return this._http.get({url:o+"goods",json:{item_type:"ap_gain",currency:"kamihime_coin"}})},getGoodsStoneApGain:function(){return this._http.get({url:o+"goods",json:{item_type:"ap_gain",currency:"stone"}})},getGoodsPseudoCurrencyBpGain:function(){return this._http.get({url:o+"goods",json:{item_type:"bp_gain",currency:"kamihime_coin"}})},getGoodsStoneBpGain:function(){return this._http.get({url:o+"goods",json:{item_type:"bp_gain",currency:"stone"}})},getGoodsAccessoryPoint:function(e,t){return this._http.get({url:o+"accessory_point_goods",json:{page:e,per_page:t}})},getGoodsSummonOrb:function(e,t){return this._http.get({url:o+"summon_orb_goods",json:{page:e,per_page:t}})},getStandardPseudoCurrencyItem:function(){return this._http.get({url:o+"goods",json:{item_type:"kamihime_coin",currency:"point"}})},getTreasuresItemEquipment:function(e,t){return this._http.get({url:o+"treasures",json:{type:"item_equipment",page:e,per_page:t}})},getTreasuresTreasure:function(e,t){return this._http.get({url:o+"treasures",json:{type:"treasure",page:e,per_page:t}})},getTreasuresDragonEye:function(e,t){return this._http.get({url:o+"treasures",json:{type:"dragon_eye",page:e,per_page:t}})},getTreasuresByEventId:function(e,t,n){var i={event_id:e};return t&&(i.page=t),n&&(i.per_page=n),this._http.get({url:o+"treasures",json:i})},buy:function(e,t,n){return this._http.post({url:o+"buy",json:{shop_item_id:e,num:t,currency:n}})},buyProduct:function(e,t){return this._http.post({url:o,json:{product_id:e,amount:t}})},exchangeItemEquipment:function(e,t){return this._http.post({url:o+"exchange",json:{shop_treasure_id:e,shop_type:"item_equipment",num:t}})},exchangeTreasure:function(e,t){return this._http.post({url:o+"exchange",json:{shop_treasure_id:e,shop_type:"treasure",num:t}})},exchangeDragonEye:function(e,t){return this._http.post({url:o+"exchange",json:{shop_treasure_id:e,shop_type:"dragon_eye",num:t}})},exchangeEvent:function(e,t,n){return this._http.post({url:o+"exchange",json:{shop_treasure_id:e,shop_type:"event",event_id:n,num:t}})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiShop",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},r)),n.env.useApiMock){n.MockApi=n.MockApi||{};var s={};t.each(r,function(e,t){s[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi.Shop."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},s))}if("undefined"!=typeof process&&"undefined"!=typeof require){var c=require("fs"),u=c.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(r,function(e,t){var n="./mock/"+(t+="JSON")+".js";return c.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void c.writeFileSync(n,u.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="ShopBuyResult",o={put:function(e){return this._http.put({url:"/shop_buy_result",json:{payment_id:e}})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiShopBuyResult",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},o)),n.env.useApiMock){n.MockApi=n.MockApi||{};var r={};t.each(o,function(e,t){r[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi."+a+"."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},r))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="ABanners",o={getGachaBanners:function(){return this._http.get({url:"/a_banners/gacha"})},getShopBanners:function(){return this._http.get({url:"/a_banners/shop"})},getQuestBanners:function(){return this._http.get({url:"/a_banners/quest"})},getStoryEventBanners:function(e,t){return this._http.get({url:"/a_banners/story_event",json:{page:e,per_page:t}})},getTreasureEventBanners:function(e,t){return this._http.get({url:"/a_banners/treasure_event",json:{page:e,per_page:t}})},getTreasureEpicBanners:function(e,t){return this._http.get({url:"/a_banners/treasure_epic",json:{page:e,per_page:t}})},getMypageBanners:function(){return this._http.get({url:"/a_banners/mypage"})},getEventOnPeriodBanners:function(){return this._http.get({url:"/a_banners/event_on_period"})},getEventAfterPeriodBanners:function(){return this._http.get({url:"/a_banners/event_after_period"})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiABanners",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},o)),n.env.useApiMock){n.MockApi=n.MockApi||{};var r={};t.each(o,function(e,t){r[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi."+a+"."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},r))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="Characters",o={get:function(e){return this._http.get({url:"/characters/"+e})},getExperiencePointList:function(){return this._http.get({url:"/characters/experience_point_list"})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiCharacters",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},o)),n.env.useApiMock){n.MockApi=n.MockApi||{};var r={};t.each(o,function(e,t){r[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi."+a+"."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},r))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="Summons",o={get:function(e){return this._http.get({url:"/summons/"+e})},getExperiencePointList:function(){return this._http.get({url:"/summons/experience_point_list"})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiSummons",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},o)),n.env.useApiMock){n.MockApi=n.MockApi||{};var r={};t.each(o,function(e,t){r[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi."+a+"."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},r))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="Weapons",o={get:function(e){return this._http.get({url:"/weapons/"+e})},getExperiencePointList:function(){return this._http.get({url:"/weapons/experience_point_list"})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiWeapons",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},o)),n.env.useApiMock){n.MockApi=n.MockApi||{};var r={};t.each(o,function(e,t){r[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi."+a+"."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},r))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="Items",o={get:function(e){return this._http.get({url:"/items/"+e})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiItems",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},o)),n.env.useApiMock){n.MockApi=n.MockApi||{};var r={};t.each(o,function(e,t){r[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi.Items."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},r))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="Accessories",o={get:function(e){return this._http.get({url:"/accessories/"+e})},getExperiencePointList:function(){return this._http.get({url:"/accessories/experience_point_list"})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiAccessories",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},o)),n.env.useApiMock){n.MockApi=n.MockApi||{};var r={};t.each(o,function(e,t){r[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi."+a+"."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},r))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global);var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},__awaiter=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(a,o){function r(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?a(e.value):new n(function(t){t(e.value)}).then(r,s)}c((i=i.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(a)throw new TypeError("Generator is already executing.");for(;c;)try{if(a=1,o&&(r=2&n[0]?o.return:n[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,n[1])).done)return r;switch(o=0,r&&(n=[2&n[0],r.value]),n[0]){case 0:case 1:r=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!(r=(r=c.trys).length>0&&r[r.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!r||n[1]>r[0]&&n[1]<r[3])){c.label=n[1];break}if(6===n[0]&&c.label<r[1]){c.label=r[1],r=n;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(n);break}r[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],o=0}finally{a=r=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var a,o,r,s,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};kh.createNameSpaceIfNotExists("MockApi"),function(e){var t=function(){function e(){}return e.prototype.get=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n;return __generator(this,function(i){return t=__assign({},e={state:"unlocked",has_campaign_in_progress:!0,unlock_condition:{type:"rank_reached",value:50}},{current_element_type:"flame"}),n=__assign({},e,{current_event_id:1}),[2,Promise.resolve({ok:!0,body:{main:e,raid:e,material:e,epic:e,elemental:t,accessory:t,guild_order:n,conquest:n}})]})})},e.prototype.putUnlock=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,Promise.resolve({ok:!0,body:{}})]})})},e}();e.ApiAQuestPortalMock=t}(AQuestPortal||(AQuestPortal={})),kh.MockApi.AQuestPortal=AQuestPortal.ApiAQuestPortalMock;var AQuestPortal;__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},__awaiter=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(a,o){function r(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?a(e.value):new n(function(t){t(e.value)}).then(r,s)}c((i=i.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(a)throw new TypeError("Generator is already executing.");for(;c;)try{if(a=1,o&&(r=2&n[0]?o.return:n[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,n[1])).done)return r;switch(o=0,r&&(n=[2&n[0],r.value]),n[0]){case 0:case 1:r=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!(r=(r=c.trys).length>0&&r[r.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!r||n[1]>r[0]&&n[1]<r[3])){c.label=n[1];break}if(6===n[0]&&c.label<r[1]){c.label=r[1],r=n;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(n);break}r[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],o=0}finally{a=r=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var a,o,r,s,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};kh.createNameSpaceIfNotExists("Api"),function(e){var t="/a_quest_portal",n=function(){function e(){this._http=kh.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return __assign({},e,{url:kh.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/")})}})}return e.prototype.get=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this._http.get({url:t})];case 1:return[2,e.sent()]}})})},e.prototype.putUnlock=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,this._http.post({url:t+"/unlock",json:{portal_types:e}})];case 1:return[2,n.sent()]}})})},e}();e.ApiAQuestPortal=n}(AQuestPortal||(AQuestPortal={})),kh.Api.AQuestPortal=AQuestPortal.ApiAQuestPortal,function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="GameDescriptions",o={get:function(e){return this._http.get({url:"/game_descriptions/"+e})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiGameDescriptions",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},o)),n.env.useApiMock){n.MockApi=n.MockApi||{};var r={};t.each(o,function(e,t){r[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi."+a+"."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},r))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.GameDescriptionsModel=n.Class.extend({className:"GameDescriptionsModel",ctor:function(e){this.contents={},this._parseContents(e.data)},_parseContents:function(e){_.each(e,function(e){this.contents[e.sub_category]=e.content}.bind(this))}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e.console;t.GameDescriptionsRepository=n.Class.extend({className:"GameDescriptionsRepository",ctor:function(){this._cache={}},import:function(e){var n=this._cache[e];return _.isUndefined(n)?t.createInstance("apiGameDescriptions").get(e).then(function(n){var i=t.createInstance("GameDescriptionsModel",[n.body]);return this._cache[e]=i,i}.bind(this)).fail(function(e){i.error(e&&e.stack?e.stack:e)}):Q.resolve(n)}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);t.BurstTime=t.EventSubject.extend({EVENT_PREFIX:"burst_time",EVENT_NAME:{UPDATE_SUCCESS:"update_success"},_burstTimeInfo:null,_preReservedBurstTimes:null,ctor:function(){this._super(),this._resetPreReservedBurstTimes()},_resetPreReservedBurstTimes:function(){this._preReservedBurstTimes=n.map(n.range(2),function(e){return new t.BurstTimeUnit})},prepare:function(e){return t.createInstance("apiAUnions").getBurstTimeInfo(e).then(function(e){this._burstTimeInfo=e.body.burst_time_info}.bind(this))},isEnabled:function(){return!!this._burstTimeInfo&&!0===this._burstTimeInfo.enabled},isInBurstTime:function(){if(!this._burstTimeInfo)return!1;if(!0!==this._burstTimeInfo.in_burst_time)return!1;var e=this.getEndDate();return null!==e&&e.getTime()-(new Date).getTime()>0},getFirstSelectedBurstTimeInfo:function(){return this.getSelectedBurstTimeInfo(0)},getSecondSelectedBurstTimeInfo:function(){return this.getSelectedBurstTimeInfo(1)},getSelectedBurstTimeInfo:function(e){return this._burstTimeInfo&&this._burstTimeInfo.selected_burst_times&&this._burstTimeInfo.selected_burst_times[e]?this._burstTimeInfo.selected_burst_times[e]:null},getFirstReservedBurstTimeInfo:function(){return this.getReservedBurstTimeInfo(0)},getSecondReservedBurstTimeInfo:function(){return this.getReservedBurstTimeInfo(1)},getReservedBurstTimeInfo:function(e){return this._burstTimeInfo&&this._burstTimeInfo.reserved_burst_times&&this._burstTimeInfo.reserved_burst_times[e]?this._burstTimeInfo.reserved_burst_times[e]:null},getEndDate:function(){return this._burstTimeInfo&&this._burstTimeInfo.end_date?new Date(this._burstTimeInfo.end_date):null},_getRemainingTime:function(){var e=this.getEndDate();if(null===e)return"";var t=e.getTime()-(new Date).getTime(),n=0,i=0;return t>0&&(n=Math.floor(t/1e3/60),i=Math.floor(t/1e3%60)),{minute:n,second:i}},getRemainingTime:function(){var e=this._getRemainingTime();return n.padZero(e.minute,2)+""+n.padZero(e.second,2)+""},getRemainingTimeSimple:function(){var e=this._getRemainingTime();return n.padZero(e.minute,2)+":"+n.padZero(e.second,2)},isReserved:function(){return!!this._burstTimeInfo&&(!(!this._burstTimeInfo.reserved_burst_times||0===this._burstTimeInfo.reserved_burst_times.length)&&n(this._burstTimeInfo.reserved_burst_times).filter(function(e){var t=e.type;return void 0!==t&&null!==t}).size()>0)},isReservable:function(){return!!this._burstTimeInfo&&!0===this._burstTimeInfo.reservable},update:function(){var e=Q.defer();if(null===this._preReservedBurstTimes||0===this._preReservedBurstTimes.length)return e.reject();var i=n.map(this._preReservedBurstTimes,function(e){return{type:e.getBurstTimeInfo().type}});return t.createInstance("apiAUnions").changeBurstTimeInfo(i).then(function(t){return t.body.error?(console.log(t.body.error),e.reject(t.body.error),void(e=null)):(this._burstTimeInfo=t.body.burst_time_info,this.dispatchEvent("UPDATE_SUCCESS"),e.resolve(t),void(e=null))}.bind(this)).fail(function(e){console.error(e.stack)}),e.promise},changePreReservedBurstTime:function(e,t){this._preReservedBurstTimes[e]||console.error("kh.BurstTime.changePreReservedBurstTime() ");var i=n.filter(this.getSelectableBurstTimes(),function(e){return e.type===t});return 0===i.length?void console.error("kh.BurstTime.changePreReservedBurstTime() "):void this._preReservedBurstTimes[e].setBurstTimeInfo(i[0])},getSelectableBurstTimes:function(){return this._burstTimeInfo?this._burstTimeInfo.selectable_burst_times:[]}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e._,t.BurstTimeUnit=n.Class.extend({_burstTimeInfo:{},ctor:function(){this.setBurstTimeInfo({type:null,description:""})},getBurstTimeInfo:function(){return this._burstTimeInfo},setBurstTimeInfo:function(e){this._burstTimeInfo=e}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e._,t.BurstTimeCountDownPanel=n.Node.extend({UPDATE_INTERVAL:.5,_timerId:null,_widget:null,_label:null,_khBurstTime:null,show:function(e){var i=n.director.getRunningScene();return i.addChild(this),this._widget=i.seekWidgetByName("bursttime_remaining_ui"),this._widget.setVisible(!1),this._label=i.seekWidgetByName("bursttime_remaining_label"),e instanceof t.BurstTime?(this._khBurstTime=e,void this._initWidget()):(this._khBurstTime=t.createInstance("burstTime"),void this._khBurstTime.prepare().then(this._initWidget.bind(this)))},_initWidget:function(){this._khBurstTime.isEnabled()&&this._khBurstTime.isInBurstTime()&&(this._updateCount(),this._startCountDown(),this._widget.setVisible(!0),t.env.isSp||this._widget.addChild(new n.Sprite))},_updateCount:function(){var e=this._khBurstTime.getRemainingTime();this._label.setString(e)},_startCountDown:function(){this.schedule(this._updateCount,this.UPDATE_INTERVAL)},_stopCountDown:function(){this.unschedule(this._updateCount)}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.ImplantedPopup=n.SceneObject.extend({_dismissAnimationName:null,ctor:function(e){return this.__initDefer=Q.defer(),this._getScene()._delegate?void this._getScene()._delegate.__waitForNodesLoaded().then(function(){this._init(e)}.bind(this)):void this._init(e)},_init:function(e){var t=this._getScene(),n=t.seekWidgetByName("popup_ui");if(null===n)return console.error("ImplantedPopup: The node 'popup_ui' not found. (name = "+e+").");this._uiNode=n;var i=t.seekWidgetByName(e);if(null===i)return console.error("ImplantedPopup: The node "+e+" not found.");this._node=i;var a=i.getUserData();null!==a&&console.warn("ImplantedPopup!"+e+"UserData",a),this._node.setUserData(this),this._setGroupPanelNode(),this.__initDefer.resolve(!0)},_waitForInit:function(){return this.__initDefer.promise},_setGroupPanelNode:function(){if(n.env.isSp){var e=this._uiNode.seekWidgetByName("group_panel");null!==e&&(e.height=cc.game.config.designHeight,e.width=cc.game.config.designWidth)}},_getScene:function(){return cc.director.getRunningScene()},getNode:function(){return this._node},getName:function(){return this._node.getName()},setTitle:function(e){this.getNode().setStrings({title_label:e})},setButtonEvents:function(e){var i={};t.each(e,function(e,n){t.isBoolean(e)&&(e=this.dismiss.bind(this,e)),i["TOUCH_ENDED "+n]=e},this),this._waitForInit().then(function(){n.setTouchEventHandlers(this.getNode(),i,this)}.bind(this))},open:function(){this._dfd=Q.defer(),n.createInstance("notificationCenter").dispatchEvent("menu_open");var e=arguments;return this._waitForInit().then(function(){this._initContents.apply(this,e),this._openAnimation()}.bind(this)),this._dfd.promise},_openAnimation:function(){return this._uiNode.animate(this.getName(),!1).then(function(){this._uiNode.setVisible(!0)}.bind(this))},dismiss:function(e){this._uiNode.animate(this._dismissAnimationName||"default_view",!1).then(this._closeAnimationEndHandler.bind(this)),e?this._dfd.resolve(this):this._dfd.reject()},_closeAnimationEndHandler:function(){this._uiNode.setVisible(!1),n.createInstance("notificationCenter").dispatchEvent("menu_close")},_onDispose:function(){var e=this.getNode();e&&(e.getUserData()===this&&e.setUserData(null))},_getNodeByName:function(e,n){t.isUndefined(n)&&(n=this.getNode());var i=n.seekWidgetByName(e);return i||console.warn("EnhUseItemsPopup._getNodeByName(): node '"+e+"' not found"),i},_initContents:function(e){}});n.ImplantedPopup.createOrGet=function(e,i,a){a=a||t.capitalize(t.camelize(i))+"Popup";var o=e.seekWidgetByName(i);return null!==o&&null!=o.getUserData()?o.getUserData():n.createInstance(a,[i])},n.ImplantedPopup.create=function(e,i,a){a=a||t.capitalize(t.camelize(i))+"Popup";var o=e.seekWidgetByName(i);return null!=o&&o.setUserData(null),n.createInstance(a,[i])}}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e._,t.model=t.model||{},t.model.PlayerMe=n.Class.extend({prepare:function(){return this._getMePromise().then(function(e){return this._data=e.body,this}.bind(this))},_getMePromise:function(){return t.createInstance("apiAPlayers").getMe().fail(function(e){console.warn(e.stack)})},getRawData:function(){return null==this._data&&window.alert("[PlayerMe::getRawData]\nYou must call prepare first!"),this._data}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e._,t.model=t.model||{},t.model.PlayerQuestPoints=n.Class.extend({prepare:function(){return this._getQuestPointsPromise().then(function(e){return this._questPoints=e.getAsObject(),this}.bind(this))},_getQuestPointsPromise:function(){return t.createInstance("myselfInfoRepository").getQuestPoints().catch(function(e){console.warn(e)})},getQuestPoints:function(){return null==this._questPoints&&window.alert("[PlayerQuestPoints::getQuestPoints]\nYou must call prepare first!"),this._questPoints},getAP:function(){return null==this._questPoints&&window.alert("[PlayerQuestPoints::getAP]\nYou must call prepare first!"),this._questPoints.ap},getBP:function(){return null==this._questPoints&&window.alert("[PlayerQuestPoints::getBP]\nYou must call prepare first!"),this._questPoints.bp},getMaxAP:function(){return null==this._questPoints&&window.alert("[PlayerQuestPoints::getMaxAP]\nYou must call prepare first!"),this._questPoints.max_ap},getMaxBP:function(){return null==this._questPoints&&window.alert("[PlayerQuestPoints::getMaxBP]\nYou must call prepare first!"),this._questPoints.max_bp},getApRecoverTime:function(){return null==this._questPoints&&window.alert("[PlayerQuestPoints::getApRecoverTime]\nYou must call prepare first!"),this._questPoints.ap_recover_time},getBpRecoverTime:function(){return null==this._questPoints&&window.alert("[PlayerQuestPoints::getBpRecoverTime]\nYou must call prepare first!"),this._questPoints.bp_recover_time}})}((this||0).self||global),function(e){var t=e._,n=e.kh;n.PopupFactoryComApRestart=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-com_ap_restart",title:"",buttonLabels:{blackBtn:""},buttons:{blackBtn:function(){this.dismiss()}}},POPUP_METHODS:{},onPopupOpened:function(e,t){var i={};i.questTitle=t.questTitle||"",i.type="raid"===t.questType?"":"",e.setStrings({confirm_label:"\n{{type}}{{questTitle}}".replace(/{{([^}]+)}}/g,function(e,t){return i[t]})}),n.setTouchEventHandlers(e,{"TOUCH_ENDED btn_withdrawal":function(){e.dismiss().then(function(){this._showPopupComBackCheck(t.aQuestId,t.questType)}.bind(this))},"TOUCH_ENDED btn_restart":function(){e.dismiss().then(function(){this._gotoQuest(t.aQuestId,t.questType)}.bind(this))}},this);var a=e.seekWidgetByName("btn_restart");a.setSoundEnabled(!0),a.setSound(n.SoundList.BUTTON_TOUCHED_CONFIRMED)},_showPopupComBackCheck:function(t,i){n.createInstance("apiAQuests").getGainedItems(t,i).then(function(e){var a=e.body.gained_items,o=n.createInstance("popupFactoryComBackCheck").create({});console.log("bachCkeck",t,i),o.open({type:i,coin:a.gem,normal:a.wooden_box,silver:a.silver_box,gold:a.golden_box,rainbow:a.rainbow_box,needToOpenComBackResult:!0,aQuestId:t,questType:i})}).fail(function(t){e.console.error(t)})},_gotoQuest:function(e,t){n.createInstance("questStateManager").restartQuest(e,t)},_addMethodsToPopup:function(e){n.PopupFactoryPopupCommon.prototype._addMethodsToPopup.call(this,e),t.assign(e,this.POPUP_METHODS)}})}((this||0).self||global),function(e){var t=e._,n=e.kh;n.PopupFactoryComBackCheck=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-com_back_check",title:"",buttonLabels:{blackBtn:"",redBtn:""},buttons:{blackBtn:function(){this.dismiss().then(this.onCancel)},redBtn:function(){if("prizehunt"===this.questType&&"battle"===n.createInstance("router").getCurrentComponent())return n.createInstance("aQuestInfo").dispose(),n.createInstance("battleWorld").checkContinuePopupConditions()?void n.createInstance("questStateManager").gotoNextQuestState():void n.createInstance("router").navigate("prizehunt/prizehunt_quest",{},{a_quest_id:this.aQuestId,giveUp:!0});n.createInstance("apiAQuests").giveupQuest(this.aQuestId,this.questType).then(function(i){n.createInstance("aQuestInfo").dispose();var a=!t.isEmpty(i.body.scoreattack_result)&&0!==n.createInstance("router").getCurrentFragment().indexOf("battle/");this.dismiss().then(function(){if(!a)return this.needToOpenComBackResult?void n.createInstance("popupFactoryComBackResult").create({}).open({type:this.questType,sceneUpdateRequired:!0}):void n.core.router.navigateFromQuest(this.questType,this.preventNavigateBack,this.aQuestId,!1,i.body.event_id,i.body.epic_subject_id,this.questId,this.questCategory,this.questSubCategory);var e={data:i.body.scoreattack_result,shouldGoQuestTop:!1,eventId:null};n.ImplantedPopup.create(cc.director.getRunningScene(),"scoreattack_result").open(e).fin(function(){var e=(cc.director.getRunningScene()||{})._delegate||{};(e.clearOwnQuest||function(){}).apply(e)})}.bind(this)).fail(function(t){e.console.error(t)})}.bind(this)).fail(function(t){e.console.error(t)})}},buttonSounds:{redBtn:n.SoundList.BUTTON_TOUCHED_CONFIRMED}},typeDictionary:{coin:"gem",normal:"bronze",silver:"silver",gold:"gold",rainbow:"rainbow"},POPUP_METHODS:{},onPopupOpened:function(e,n){var i=n.type,a=n.questType||i;"raid"===i&&e.setStrings({confirm_label:e.seekWidgetByName("confirm_label").getString().replace("","")}),"prizehunt"===a&&e.setStrings({confirm_label:"\n"}),t.each(t.keys(this.typeDictionary),function(t){e.seekWidgetByName("{{type}}_no_label".replace(/{{type}}/,this.typeDictionary[t])).setString((n[t]||0).toString())}.bind(this)),e.needToOpenComBackResult=n.needToOpenComBackResult||!1,e.aQuestId=n.aQuestId,e.questId=n.questId,e.questType=n.questType,e.type=i,e.onCancel=n.onCancel||function(){},e.preventNavigateBack=n.preventNavigateBack||!1,e.questCategory=n.questCategory,e.questSubCategory=n.questSubCategory},_addMethodsToPopup:function(e){n.PopupFactoryPopupCommon.prototype._addMethodsToPopup.call(this,e),t.assign(e,this.POPUP_METHODS)}})}((this||0).self||global),function(e){var t=e._,n=e.kh;n.PopupFactoryComBackResult=n.PopupFactoryTextOnly.extend({POPUP_PROPERTIES:{title:"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(){var e=cc.director.getRunningScene()._delegate;this.sceneUpdateRequired&&(e.update||function(){})(),this.dismiss().then(function(){(e.clearOwnQuest||function(){}).apply(e)})}}},POPUP_METHODS:{},WIDGET_NAMES:{},onPopupOpened:function(e,t){var n="raid"===t.type?"":"";e.setContent("{{type}}".replace(/{{type}}/,n)),e.sceneUpdateRequired=!1!==t.sceneUpdateRequired},_addMethodsToPopup:function(e){n.PopupFactoryTextOnly.prototype._addMethodsToPopup.call(this,e),t.assign(e,this.POPUP_METHODS)}})}((this||0).self||global),function(e){var t=e._,n=e.kh;n.PopupFactoryComNeedApBp=cc.Class.extend({POPUP_TYPES:{UNDEFINED:0,HAS_RECOVERY_ITEMS:1,NO_RECOVERY_ITEMS:2},ctor:function(){this._popupType=this.POPUP_TYPES.UNDEFINED,this._instances={}},create:function(e){var t=this._cacheParams(e),n=this._getItemInfo(t.property,t.items.data),i=this._getCurrentQuestPoints(t.property,t.questPoints),a=this._getMaxQuestPoints(t.property,t.questPoints);return this._updatePopupType(n),this._popupParams=this._getPopupParams(n,i,a),this._instantiate()},getPopupParams:function(){return this._popupParams||{}},cleanup:function(){this._instances={},this._popupParams=null,this._params=null},_cacheParams:function(e){return this._params=t.assign(this._params||{},e),this._params},_instantiate:function(e){if(this._popupType===this.POPUP_TYPES.UNDEFINED)return console.warn("KHPopupFactoryComNeedApBp._instantiate: popup data not properly initialized, please check the params passed to the create method."),{};if(this._instances[this._popupType])return this._instances[this._popupType];var i=n.createInstance("popupFactoryComNeedApBp"+this._popupType).create({});return i.open=function(e){return function(i){var a=n.createInstance("popupFactoryComNeedApBp").getPopupParams();return e.call(this,t.assign(a,i||{}))}}(i.open),this._instances[this._popupType]=i,i},_getPopupParams:function(e,t,n){return{property:this._params.property,questTitle:this._params.questTitle,item:e.fullRecoveryItem,itemLittleRecover:e.halfRecoveryItem,component:this._params.component,currentQuestPoints:t,maxQuestPoints:n,onUse:this._params.onUse,onCancel:this._params.onCancel||function(){},needBattleBp:this._params.needBattleBp}},_getMaxQuestPoints:function(e,t){return"AP"===e?t.max_ap:t.max_bp},_getCurrentQuestPoints:function(e,t){return"AP"===e?t.ap:t.bp},_updatePopupType:function(e){0===e.fullRecoveryItem.num&&0===e.halfRecoveryItem.num?this._popupType=this.POPUP_TYPES.NO_RECOVERY_ITEMS:this._popupType=this.POPUP_TYPES.HAS_RECOVERY_ITEMS},_getItemInfo:function(e,i){return{fullRecoveryItem:t.find(i,function(t){return t.name===n.w("AP"===e?"elixir":"energyLeaf")}),halfRecoveryItem:t.find(i,function(t){return t.name===n.w("AP"===e?"elixirHalf":"energySeed")})}}})}((this||0).self||global),function(e){var t=e._,n=e.kh;n.PopupFactoryComNeedApBp1=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-com_need_ap_bp_1",buttonLabels:{blackBtn:"",blueBtn:""},buttons:{blackBtn:function(){this._onCancel(),this.cleanUp().then(this.dismiss.bind(this))},blueBtn:function(){this._useItems(),this.cleanUp().then(this.dismiss.bind(this))}}},WIDGET_NAMES:{FULL:{POINTS_BEFORE_AFTER:"comp_recovery_use_labelimg",ITEMS_BEFORE_AFTER:"comp_recovery_have_labelimg"},HALF:{POINTS_BEFORE_AFTER:"harf_recovery_use_labelimg",ITEMS_BEFORE_AFTER:"harf_recovery_have_labelimg"}},POPUP_METHODS:{PULLDOWN_STOPS:{DEFAULT:[0,1,2,3,4,5,6,7,8,9,10],ENERGY_SEED:[0,1,2,3,4,5,10,20,30,40,50]},MAX_QUEST_POINTS:{AP:999,BP:99,DEFAULT:999},ITEM_IDS:{ENERGY_SEED:9},setItemFull:function(e){this._itemFull=e},setItemHalf:function(e){this._itemHalf=e},setCurrentQuestPoints:function(e){this._currentQuestPoints=e},setMaxQuestPoints:function(e){this._maxQuestPoints=e},setQuestPointType:function(e){this._questPointType=e},setNeedBattlePoint:function(e){this._needBattlePoint=e},createPulldowns:function(){this._createPulldownFull(),this._createPulldownHalf()},onUse:function(e){this._onUse=e},onCancel:function(e){this._onCancel=e},cleanUp:function(){return this._pulldownFull.releaseMenu(),this._pulldownHalf.releaseMenu(),Q.all(t(this.WIDGET_NAMES.FULL).values().concat(t.values(this.WIDGET_NAMES.HALF)).map(function(e){var t={};return t[e]="",this.setHtmlStrings(t,n.GameConfig.POPUP_CSS)},this).value())},_setBeforeAndAfterCount:function(e,t,i){var a={};return a[this.WIDGET_NAMES[i].ITEMS_BEFORE_AFTER]=this._generateAmountBoxContent(e,t),this.setHtmlStrings(a,n.GameConfig.POPUP_CSS)},_setBeforeAndAfterQuestPoint:function(e,t,i){var a={};return a[this.WIDGET_NAMES[i].POINTS_BEFORE_AFTER]=this._generateAmountBoxContent(e,t),this.setHtmlStrings(a,n.GameConfig.POPUP_CSS)},_generateAmountBoxContent:function(e,t){return'<table class="nb"><tr style="-moz-transform: none !important;-webkit-transform: none !important;"><td class="numbox_middle_mini"><span class="white">'+e+'&rarr;</span><span class="'+this._getAmountAfterTextColor(e,t)+'">'+t+"</span></td></tr></table>"},_getAmountAfterTextColor:function(e,t){return t>e?"yellow":e>t?"red":"white"},_calculatePulldownLength:function(e){for(var t=this._getmaxQuestPoints(e),n=this._getItemRecoveryValue(e),i=e.num,a=t-this._currentQuestPoints,o=Math.floor(a/n),r=Math.min(o,i),s=this._getPulldownStops(e),c=1;c<s.length&&!(r<s[c]);c++);return c},_getmaxQuestPoints:function(e){var t=0;switch(e.type){case"ap_gain":t=this.MAX_QUEST_POINTS.AP;break;case"bp_gain":t=this.MAX_QUEST_POINTS.BP;break;default:t=this.MAX_QUEST_POINTS.DEFAULT}return t},_getPulldownStops:function(e){return e.item_id===this.ITEM_IDS.ENERGY_SEED?this.PULLDOWN_STOPS.ENERGY_SEED:this.PULLDOWN_STOPS.DEFAULT},_createPulldownChoices:function(e){var n=this._getPulldownStops(e),i=t.range(this._calculatePulldownLength(e));return t.map(i,function(e){var t=n[e];return{text:t.toString(),value:t}})},_createPulldownFull:function(){this._pulldownFull=this._createPulldown(this.seekWidgetByPath("group_panel_0.btn_pulldown"),this._createPulldownChoices(this._itemFull),this._onPulldownSelectFull,this,0)},_createPulldownHalf:function(){this._pulldownHalf=this._createPulldown(this.seekWidgetByPath("group_panel_1.btn_pulldown"),this._createPulldownChoices(this._itemHalf),this._onPulldownSelectHalf,this,this._getDefaultSelectValue(this._itemHalf))},_getDefaultSelectValue:function(e){var t=this._getmaxQuestPoints(e);if(e.recovered_amount>=t)return 0;if(e.item_id===this.ITEM_IDS.ENERGY_SEED){var n=this._currentQuestPoints,i=this._needBattlePoint;if(i>n)return i>n+e.num?0:i-n}return e.num?1:0},_createPulldown:function(e,t,i,a,o){var r=e.seekWidgetByName("amount_label"),s=new n.Pulldown({button:e,label:r,menuBase:!0,choice:!0},t);return s.onChange(i,a),s.selectValue(o),s},_onPulldownSelectFull:function(e){this._onPulldownSelect(e,"FULL")},_onPulldownSelectHalf:function(e){this._onPulldownSelect(e,"HALF")},_onPulldownSelect:function(e,t){var n="FULL"===t?this._itemFull:this._itemHalf,i=0===e.value,a="FULL"===t?this._pulldownHalf:this._pulldownFull;this._setItemSelectedNumber(e.value,t),this._setBeforeAndAfterCount(n.num,n.num-e.value,t),this._setBeforeAndAfterQuestPoint(this._currentQuestPoints,this._getQuestPointsAfter(e.value,n),t),i||a.selectValue(0),this._updateButtonStatus()},_setItemSelectedNumber:function(e,t){"FULL"===t?this._itemFullSelected=e:this._itemHalfSelected=e},_getItemRecoveryValue:function(e){return e.recovered_amount-this._currentQuestPoints},_getQuestPointsAfter:function(e,t){return this._currentQuestPoints+e*this._getItemRecoveryValue(t)},_updateButtonStatus:function(){var e=this._itemFullSelected+this._itemHalfSelected>0;n.pc.roles.UIUtility._setEnableButton(this.blueBtn,e)},_useItems:function(){var t=this._getSelectedItemInfo(),i=this._getSelectedItemAmount(),a=t.a_item_id,o={item:t,beforeAP:this._currentQuestPoints,onUse:this._onUse};return n.createInstance("apiAItems").useItem(a,i).then(function(e){return o.countBefore=e.body.num+i,o.count=e.body.num,this._updateQuestPoints()}.bind(this)).then(function(e){return o.afterAP=e[this._questPointType.toLowerCase()],n.createInstance("popupFactoryComUseResult").create({}).open(o)}.bind(this)).fail(function(t){e.console.error(t)})},_getSelectedItemInfo:function(){return this._itemFullSelected>this._itemHalfSelected?this._itemFull:this._itemHalf},_getSelectedItemAmount:function(){return this._itemFullSelected||this._itemHalfSelected},_updateQuestPoints:function(){var e=cc.director.getRunningScene();return Q.fcall(function(){return e.headerDelegate&&t.isFunction(e.headerDelegate.updateQuestPoints)?e.headerDelegate.updateQuestPoints():n.createInstance("myselfInfoRepository").getQuestPoints(!0).then(function(e){return e.getAsObject()})}).then(function(n){return e._delegate&&t.isFunction(e._delegate.updateQuestPoints)?e._delegate.updateQuestPoints():n})}},onPopupOpened:function(e,i){e.WIDGET_NAMES=this.WIDGET_NAMES,e.BUTTON_FRAME_NAMES=this.BUTTON_FRAME_NAMES;var a=(i.property||"bp").toUpperCase(),o=i.questTitle||"",r=i.item||{},s=i.itemLittleRecover||{},c=i.needBattleBp||0;e.setItemFull(r),e.setItemHalf(s),e.setQuestPointType(a),e.setCurrentQuestPoints(i.currentQuestPoints),e.setMaxQuestPoints(i.maxQuestPoints),e.onUse(i.onUse),e.onCancel(i.onCancel||function(){}),e.setNeedBattlePoint(c),e.createPulldowns(),e.loadTextures({comp_recovery_img:n.Img("corecard","item",t.padZero(r.item_id,4)).jpg,harf_recovery_img:n.Img("corecard","item",t.padZero(s.item_id,4)).jpg});var u=new RegExp("{{([^}]+)}}","g"),l=function(e){return function(t,n){return e[n]}},_="{{property}}".replace(u,l({property:a})),p={none_labelimg:"<div class='text_com_need_ap_bp1'>{{questTitle}}<br /><span class='red'>{{property}}</span><br />{{property}}</div>".replace(u,l({questTitle:o,property:a}))};"mypage"===i.component&&(_="{{property}}".replace(u,l({property:a})),p.none_labelimg="<br/><br/><div>{{property}}</div>".replace(u,l({property:a}))),e.setTitle(_),e.setHtmlStrings(p,n.GameConfig.POPUP_CSS),r.num<=0?e.seekWidgetByName("comp_recovery_img").setColor(cc.color("#808080")):e.seekWidgetByName("comp_recovery_img").setColor(cc.color("#ffffff")),s.num<=0?e.seekWidgetByName("harf_recovery_img").setColor(cc.color("#808080")):e.seekWidgetByName("harf_recovery_img").setColor(cc.color("#ffffff")),e.setStrings({comp_recovery_label:r.name,harf_recovery_label:s.name})},_addMethodsToPopup:function(e){n.PopupFactoryPopupCommon.prototype._addMethodsToPopup.call(this,e),t.assign(e,this.POPUP_METHODS)}})}((this||0).self||global),function(e){var t=e._,n=e.kh,i=e.console;e.cc,n.PopupFactoryComNeedApBp2=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-com_need_ap_bp_2",title:"AP",buttonLabels:{blackBtn:""},buttons:{blackBtn:function(){this._onCancel(),this._clearData(),this.dismiss()}}},WIDGET_NAMES:{EXPLANATION_LABEL:"none_labelimg"},BUTTON_NAMES:{PSEUDO_CURRENCY_BUY:"btn_coin_shop",PSEUDO_CURRENCY_EXCHANGE:"btn_coin_change",STONE_EXCHANGE:"btn_stone_change"},EXPLANATION_TEXT_HTML:"<div class='text_com_need_ap_bp2'>{questName}<br /><span class='red'>{recoveryType}</span><br />{recoveryType}</div>",EXPLANATION_MYPAGE_TEXT_HTML:"<br /><br />{recoveryType}",POPUP_METHODS:{initializeButtons:function(){this._restoreItemVendingProcessController.initializeButtons(this)},initializeLabels:function(e,t){this._restoreItemVendingProcessController.initializeCurrencyAmountLabels(this),this._setExplanationText(e,t)},onCancel:function(e){this._onCancel=e},_initializeRestoreItemVendingProcessController:function(e){n.vending_process.WithoutResultPopupDIConfig.apply(),this._restoreItemVendingProcessController=n.createInstance("RestoreItemVendingProcessController",[this._recoveryType,e]),this._restoreItemVendingProcessController.setOnTransactionCompletedCallback(this._onBuyCallback,this)},_preload:function(){this._restoreItemVendingProcessController.preload()},_clearData:function(){this._clearExplanationText(),n.vending_process.DIConfig.apply()},_onBuyCallback:function(){var e;this._clearData(),e="AP"===this._recoveryType?n.createInstance("apiAItems").getApGain():n.createInstance("apiAItems").getBpGain(),Q.all([e,n.createInstance("myselfInfoRepository").getQuestPoints(!0),this.dismiss()]).spread(function(e,t){n.createInstance("popupFactoryComNeedApBp").create({items:e.body,questPoints:t.getAsObject()}).open()}.bind(this)).fail(function(e){i.error(e)})},_setExplanationText:function(e,t){var i=this.EXPLANATION_TEXT_HTML.replace("{questName}",e).replace("{recoveryType}",this._recoveryType).replace("{recoveryType}",this._recoveryType);"mypage"===t.component&&(i=this.EXPLANATION_MYPAGE_TEXT_HTML.replace("{recoveryType}",this._recoveryType));var a={};a[this.WIDGET_NAMES.EXPLANATION_LABEL]=i,this.setHtmlStrings(a,n.GameConfig.POPUP_CSS)},_clearExplanationText:function(){this._getWidget(this.WIDGET_NAMES.EXPLANATION_LABEL).loadTexture("")},_getWidget:function(e){return khutil.getWidgetFromNode(this,e,function(e){i.warn("PopupFactoryComNeedApBp2._getWidget: "+e)})}},onPopupOpened:function(e,i){var a=(i.property||"bp").toUpperCase(),o=i.item||{},r=i.itemLittleRecover||{},s=i.questTitle;e.initializeButtons(),e.initializeLabels(s,i),e.onCancel(i.onCancel||function(){}),e.loadTextures({comp_recovery_img:n.Img("corecard","item",t.padZero(o.item_id,4)).jpg,harf_recovery_img:n.Img("corecard","item",t.padZero(r.item_id,4)).jpg});var c=new RegExp("{{([^}]+)}}","g"),u=function(e){return function(t,n){return e[n]}},l="{{property}}".replace(c,u({property:a}));"mypage"===i.component&&(l="{{property}}".replace(c,u({property:a}))),e.setTitle(l),e.setStrings({comp_recovery_label:o.name,harf_recovery_label:r.name})},configure:function(e,i){n.PopupFactoryPopupCommon.prototype.configure.call(this,e,i),e.WIDGET_NAMES=this.WIDGET_NAMES,e.BUTTON_NAMES=this.BUTTON_NAMES,e.EXPLANATION_TEXT_HTML=this.EXPLANATION_TEXT_HTML,e.EXPLANATION_MYPAGE_TEXT_HTML=this.EXPLANATION_MYPAGE_TEXT_HTML,t.assign(e,this.POPUP_METHODS),this._eventIdInfo=this._eventIdInfo||{},e.getEventId=function(e){return function(){return e.eventId}}(this._eventIdInfo),e.getEpicId=function(e){return function(){return e.epicId}}(this._eventIdInfo),e.getQuestId=function(e){return function(){return e.questId}}(this._eventIdInfo),e.open=function(e){return function(t){this._recoveryType=t.property.toUpperCase();var i=n.createInstance("VendingLocationInformation");i.setComponent(t.component);var a=this.getEventId();null!=a&&i.setEventId(a);var o=this.getEpicId();null!=o&&i.setEpicId(o);var r=this.getQuestId();return null!=r&&i.setQuestId(r),this._initializeRestoreItemVendingProcessController(i),this._preload(),e.apply(this,arguments)}}(e.open)},setEventId:function(e){this._eventIdInfo=this._eventIdInfo||{},this._eventIdInfo.eventId=e},setQuestId:function(e){this._eventIdInfo=this._eventIdInfo||{},this._eventIdInfo.questId=e},setEpicId:function(e){this._eventIdInfo=this._eventIdInfo||{},this._eventIdInfo.epicId=e}})}((this||0).self||global),function(e){var t=e._,n=e.kh;n.PopupFactoryComRaidCheck=n.PopupFactoryTextOnly.extend({POPUP_PROPERTIES:{title:"",content:'<span class="red"></span>',buttonLabels:{blueBtn:"",blackBtn:""},buttons:{blueBtn:function(){this.dismiss().then(function(){n.createInstance("router").navigate("quest/q_007")})},blackBtn:function(){this.dismiss()}},buttonSounds:{blueBtn:n.SoundList.BUTTON_TOUCHED_CONFIRMED}},POPUP_METHODS:{},_addMethodsToPopup:function(e){n.PopupFactoryTextOnly.prototype._addMethodsToPopup.call(this,e),t.assign(e,this.POPUP_METHODS)}})}((this||0).self||global),function(e){var t=e._,n=e.kh;n.PopupFactoryComUseResult=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-com_use_result",title:"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(){this.dismiss().then(function(){return t.isFunction(this._onUse)?this._onUse(this._afterQuestPoints):void n.createInstance("sceneManager").reloadScene()}.bind(this))}},buttonSounds:{blueBtn:n.SoundList.BUTTON_TOUCHED_CONFIRMED}},POPUP_METHODS:{},onPopupOpened:function(e,i){var a=i.item||{},o=i.count,r=null!=i.countBefore?i.countBefore:o+1,s="ap_gain"===i.item.type,c=i.beforeAP,u=i.afterAP,l=new RegExp("{{([^}]+)}}","g"),_=function(e){return function(t,n){return e[n]}};e._onUse=i.onUse,e._afterQuestPoints=u;var p='<table class="nb"><tr><td class="numbox_middle_mini"><span class="white">{{before}}&rarr;</span><span class="yellow">{{after}}</span></td></tr></table>';e.setHtmlStrings({ap_bp_labelimg:p.replace(l,_({before:c,after:u})),have_labelimg:p.replace(l,_({before:r,after:o}))},n.GameConfig.POPUP_CSS),e.loadTextures({elixir_or_elixir_half_img:n.Img("corecard","item",t.padZero(a.item_id,4)).jpg}),e.setStrings({ap_bp_heal_label:s?"AP":"BP",elixir_or_elixir_half_have_label:"{{item}}\n".replace(l,_({item:a.name}))})},_addMethodsToPopup:function(e){n.PopupFactoryPopupCommon.prototype._addMethodsToPopup.call(this,e),t.assign(e,this.POPUP_METHODS)}})}((this||0).self||global),function(e){var t=e._,n=e.kh;n.PopupFactoryComQuestInfo=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-q_info",title:"",buttonLabels:{blueBtn:"OK"},buttonSounds:{blueBtn:n.SoundList.BUTTON_TOUCHED_CONFIRMED},buttons:{blueBtn:function(e){this.dismiss()}}},WIDGET_NAMES:{},POPUP_METHODS:{},create:function(e,i){return n.PopupFactory.prototype.create.call(this,t.assign(e,this.POPUP_PROPERTIES),i)},_addMethodsToPopup:function(e){n.PopupFactoryPopupCommon.prototype._addMethodsToPopup.call(this,e),t.assign(e,this.POPUP_METHODS)},onPopupOpened:function(e,t){console.log(e,t),e.seekWidgetByName("title_label").setString(t.title),e.seekWidgetByName("synopsis_label").setString(t.description),e.seekWidgetByName("condition_label").setString(t.start_condition)}})}((this||0).self||global),function(e){var t=e._,n=e.kh;e.cc,e.ccui,n.PopupFactoryBuyCheck=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-sh_buy_check",title:"",buttonLabels:{blueBtn:"",blackBtn:""},buttonSounds:{blueBtn:n.SoundList.BUTTON_TOUCHED_CONFIRMED,blackBtn:n.SoundList.BUTTON_TOUCHED_CANCEL},buttons:{blueBtn:function(e){this.factory.pulldown.releaseMenu(),this.factory._buy()},blackBtn:function(e){this.factory.pulldown.releaseMenu();var t=this.factory.onClose;this.factory=null,this.dismiss().then(t)}}},POPUP_METHODS:{},onPopupOpened:function(e,i){this.popup=e;var a=e.seekWidgetByName("item_img"),o=e.seekWidgetByName("item_name_label"),r=e.seekWidgetByName("item_description_label"),s=e.seekWidgetByName("price_label");this.options=i.options,e.factory=this,this.onClose=i.onClose||function(){};var c=n.Img("corecard","item",t.padZero(i.id,4)).jpg;a.loadTexture(c),o.setString(i.name),r.setString(i.description),s.setString(i.price+""),this.selectedValue=1,this.selectedRecord=i,this.onBuy=i.onBuy;var u=this._getPulldownCondition(i);this.pulldown=new n.Pulldown({button:e.seekWidgetByName("btn_pulldown"),label:e.seekWidgetByName("amount_label"),menuBase:e.seekWidgetByName("gud_sh_sort"),choice:ccs.load(res["core-sort-sort_list_ui"]).node},u),this.pulldown.onChange(function(e){this.selectedValue=e.value,s.setString(i.price*this.selectedValue)}.bind(this))},_buy:function(){var e={};e.num=this.selectedValue,e.name=this.selectedRecord.name,e.description=this.selectedRecord.description,e.price=this.selectedRecord.price,e.itemId=this.selectedRecord.shop_item_id,e.contentId=this.selectedRecord.id,e.contentType=this.selectedRecord.kind,n.createInstance("paymentRequest").requestShopItem(e,this.options).then(function(e){return this.popup.dismiss().thenResolve(e)}.bind(this)).then(function(e){this._showResultPopup(e)}.bind(this))},_showResultPopup:function(e){var t={type:"point",buyResult:e,onClose:this.onBuy};n.createInstance("popupFactoryBuyResult").create({}).open(t)},_getPulldownCondition:function(e){var n=[];return t.each(t.range(e.buy_max_num),function(e){e++,n.push({value:e,text:e})}),n[0].selected=!0,n}})}((this||0).self||global),function(e){var t=e._,n=e.kh,i=e.cc;e.ccui,n.PopupFactoryStoneCheck=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-sh_stone_check",title:"",buttonLabels:{blueBtn:"",blackBtn:""},buttonSounds:{blueBtn:n.SoundList.BUTTON_TOUCHED_CONFIRMED,blackBtn:n.SoundList.BUTTON_TOUCHED_CANCEL},buttons:{blueBtn:function(e){this.factory.pulldown.releaseMenu(),this.factory._buy.call(this.factory),this.dismiss()},blackBtn:function(e){this.factory.pulldown.releaseMenu();var t=this.factory.onClose;this.factory=null,this.dismiss().then(t)}}},POPUP_METHODS:{},onPopupOpened:function(e,a){var o=e.seekWidgetByName("item_img"),r=e.seekWidgetByName("item_name_label"),s=e.seekWidgetByName("item_description_label"),c=e.seekWidgetByName("price_labelimg");e.factory=this,this.onClose=a.onClose||function(){},this.onBuy=a.onBuy||function(){};var u=n.Img("corecard","item",t.padZero(a.id,4)).jpg;o.loadTexture(u),r.setString(a.name),s.setString(a.description),this.selectedValue=1,this.selectedRecord=a;var l=this._getPulldownCondition(a),_=e.seekWidgetByName("sort_ui");if(l&&l.length<10){var p=45*(10-l.length);_.setPositionY(24-p)}this.pulldown=new n.Pulldown({button:e.seekWidgetByName("btn_pulldown"),label:e.seekWidgetByName("amount_label"),menuBase:e.seekWidgetByName("gud_sh_sort"),choice:ccs.load(res["core-sort-sort_list_ui"]).node},l),this.pulldown.onChange(function(e){this.selectedRecord=a,this.selectedValue=e.value,d()}.bind(this));var d=function(){var e=this.selectedValue*a.stones,t=a.currency.stone-e,o='<table style="width: 400px;height: 60px;"><tr><td><div class="text_common">'+("<span class='orange'>&nbsp;&nbsp;</span><span class='white'>"+a.stones+n.w("stone")+"</span><br /><span class='orange'>"+n.w("stone")+"&nbsp;&nbsp;</span><span class='white'>"+a.currency.stone+"&rarr;</span><span class='red'>"+t+"</span>")+"</div></td></tr></table>";n.convertHTMLToTexture(o,i.size(400,60),n.GameConfig.POPUP_CSS).then(function(e){var t=c.getVirtualRenderer();t.initWithTexture(e),t.setAnchorPoint(0,0),t.setVisible(!0)}.bind(this))}.bind(this);d()},_buy:function(){n.createInstance("apiShop").buy(this.selectedRecord.shop_item_id,this.selectedValue,"stone").then(function(e){if(!e.body.result)throw new Error(n.w("stone")+"");var t=i.director.getRunningScene();null!=t.headerDelegate&&t.headerDelegate.updateCurrency(),this._showResultPopup({num:this.selectedValue,shop_item_id:this.selectedRecord.shop_item_id})}.bind(this)).fail(function(e){console.error(e)})},_getPulldownCondition:function(e){var n=Math.floor(e.currency.stone/e.stones);n=e.buy_max_num<n?e.buy_max_num:n;var i=t.map(t.range(n),function(e){return{value:++e,text:e}});return i[0].selected=!0,i},_showResultPopup:function(e){var t={type:"stone",buyResult:e,onClose:this.onBuy};n.createInstance("popupFactoryBuyResult").create({}).open(t)}})}((this||0).self||global),function(e){var t=(e._,e.kh);e.cc,e.ccui,t.PopupFactoryComAgeLimitB=t.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-com_age_limit_b",title:"",buttonLabels:{redBtn:"R",blackBtn:""},buttonSounds:{redBtn:t.SoundList.BUTTON_TOUCHED_DECIDE,blackBtn:t.SoundList.BUTTON_TOUCHED_DECIDE},buttons:{redBtn:function(e){this.dismiss().then(function(){if(t.env.R18GameURL){var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null);var n=document.createElement("a");n.target="_top",n.href=t.env.R18GameURL,n.dispatchEvent(e)}})},blackBtn:function(e){this.dismiss()}}},POPUP_METHODS:{},onPopupOpened:function(e,t){}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;e.Q,t.createNameSpaceIfNotExists("pc.roles"),t.pc.roles.UIUtility={_setEnableButton:function(e,t){var a=null;i.isObject(e)?a=e:a=n.director.getRunningScene().seekWidgetByName(e);a.setEnabled(t),a.setColor(t?n.color("#FFFFFF"):n.color("#808080"))},_setGrayOutButton:function(e,t){i.isUndefined(e._cascadeColorEnabled)||e.setCascadeColorEnabled(!0);(i.isObject(e)?e:this.seekWidgetByName(e)).setColor(t?n.color("#FFFFFF"):n.color("#808080"))},_showNothingLabel:function(e){if(!i.isUndefined(e)&&!i.isNull(e)){var t=e.seekWidgetByName("nothing_label");return null===t?void console.warn("[ERROR] Could not find noghing label."):void t.setVisible(!0)}console.warn("[ERROR] Could not access scene object.")},_setGrayShader:function(e,t,a){var o=function(e,t){var i=t?ccui.Scale9Sprite.WebGLRenderCmd._getGrayShaderProgram():n.shaderCache.programForKey(n.SHADER_SPRITE_POSITION_TEXTURECOLOR),a=function(){this.setShaderProgram(i),this.removeEventListener("load",a)};return e instanceof ccui.Button?(e._buttonClickedRenderer.addLoadedEventListener(a,e._buttonClickedRenderer),e._buttonDisableRenderer.addLoadedEventListener(a,e._buttonDisableRenderer),void e._buttonNormalRenderer.addLoadedEventListener(a,e._buttonNormalRenderer)):e.getVirtualRenderer?void e.getVirtualRenderer().addLoadedEventListener(a,e.getVirtualRenderer()):void(e.setShaderProgram&&e.addLoadedEventListener(a,e))};(o(e,t),a)&&e.seekWidgets(i.isFunction(a)?a:function(){return!0}).forEach(function(e){o(e,t)})}}}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;e.Q,t.pc.roles=t.pc.roles||{};var a={basic:"R",upper:"SR",uppermost:"SSR",highjob:"SSR_arousal"},o=["flame","water","wind","thunder"];t.pc.roles.ImagesCommon={_loadEpisodeImage:function(e,n,i){t.createInstance("episodeImage").loadTextureToImageView(e,n,i,1)},_setIntroduceCharaImage:function(e,a){var o=n.director.getRunningScene();if(!i.isUndefined(e)&&null!==o.seekWidgetByName("illust-com-kneeshot_chara")){var r=t.Img("illust-com-kneeshot","chara",i.padZero(e,4),0).png;o.seekWidgetByName("illust-com-kneeshot_chara").loadTexture(r);var s=this.__getRarityBgPath(a);o.seekWidgetByName("rarity_bg").loadTexture(s)}},_setIntroduceJobImage:function(e,o){var r=o||n.director.getRunningScene();if(!i.isUndefined(e.job_id)&&null!==r.seekWidgetByName("illust-com-kneeshot_job")){var s=t.Img("illust-com-kneeshot","job",i.padZero(e.job_id,4),e.skin||0).png;r.seekWidgetByName("illust-com-kneeshot_job").loadTexture(s);var c=a[(e.rank||"basic").toLowerCase()],u=this.__getRarityBgPath(c);r.seekWidgetByName("rarity_bg").loadTexture(u);var l=r.seekWidgetByName("name_base");if(null!==l){var _="core/res/introduce/introduce_raritybar_"+c+".png";l.loadTexture(_,ccui.Widget.PLIST_TEXTURE)}}},_setIntroduceWeaponImage:function(e){var a=n.director.getRunningScene();if(!i.isUndefined(e.weapon_id)&&null!==a.seekWidgetByName("introduceimg_weapon")){var o=t.Img("introduceimg","weapon",i.padZero(e.weapon_id,4),e.skin||0).jpg;a.seekWidgetByName("introduceimg_weapon").loadTexture(o)}},_setIntroduceSummonImage:function(e){var a=n.director.getRunningScene();if(!i.isUndefined(e.summon_id)&&null!==a.seekWidgetByName("illust-com-kneeshot_summon")){var o=t.Img("illust-com-kneeshot","summon",i.padZero(e.summon_id,4),e.skin||0).png;a.seekWidgetByName("illust-com-kneeshot_summon").loadTexture(o);var r=this.__getRarityBgPath(e.rare);a.seekWidgetByName("rarity_bg").loadTexture(r)}},_setIntroduceGuardianImage:function(e){var a=n.director.getRunningScene();if(e&&!i.isUndefined(e.guardian_id)&&null!==a.seekWidgetByName("illust-com-kneeshot_guardian")){var r=t.Img("illust-com-kneeshot","guardian",i.padZero(e.guardian_id,4),0).png;if(a.seekWidgetByName("illust-com-kneeshot_guardian").loadTexture(r),!i.isUndefined(e.element_type)){var s=o[e.element_type],c=t.Img("guardian_bg",s).jpg;a.seekWidgetByName("guardian_bg").loadTexture(c)}}},__getRarityBgPath:function(e){return"../core/res/pages/rarity_bg/rarity_bg_"+e.toLowerCase()+".jpg"}}}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);e.Q,t.pc.roles=t.pc.roles||{},t.pc.roles.StringsCommon={_setCardStrings:function(e,t){n.isUndefined(t.name)||null===e.seekWidgetByName("name_label")||e.setStrings({name_label:t.name}),n.isUndefined(t.attack)||null===e.seekWidgetByName("attack_no")||e.setStrings({attack_no:String(t.attack)}),n.isUndefined(t.min_attack)||null===e.seekWidgetByName("attack_min_no_label")||e.setStrings({attack_min_no_label:String(t.min_attack)}),n.isUndefined(t.min_attack)||null===e.seekWidgetByName("attack_min_no")||e.setStrings({attack_min_no:String(t.min_attack)}),n.isUndefined(t.max_attack)||null===e.seekWidgetByName("attack_max_no_label")||e.setStrings({attack_max_no_label:String(t.max_attack)}),n.isUndefined(t.max_attack)||null===e.seekWidgetByName("attack_max_no")||e.setStrings({attack_max_no:String(t.max_attack)}),n.isUndefined(t.hp)||null===e.seekWidgetByName("hp_no")||e.setStrings({hp_no:String(t.hp)}),n.isUndefined(t.min_hp)||null===e.seekWidgetByName("hp_min_no_label")||e.setStrings({hp_min_no_label:String(t.min_hp)}),n.isUndefined(t.min_hp)||null===e.seekWidgetByName("hp_min_no")||e.setStrings({hp_min_no:String(t.min_hp)}),n.isUndefined(t.max_hp)||null===e.seekWidgetByName("hp_max_no_label")||e.setStrings({hp_max_no_label:String(t.max_hp)}),n.isUndefined(t.max_hp)||null===e.seekWidgetByName("hp_max_no")||e.setStrings({hp_max_no:String(t.max_hp)}),n.isUndefined(t.level)||null===e.seekWidgetByName("level_label")||e.setStrings({level_label:String(t.level)}),n.isUndefined(t.level)||null===e.seekWidgetByName("level_now_label")||e.setStrings({level_now_label:String(t.level)}),n.isUndefined(t.max_level)||null===e.seekWidgetByName("level_max_label")||e.setStrings({level_max_label:"MAX "+String(t.max_level)}),n.isUndefined(t.next_exp)||null===e.seekWidgetByName("exp_next_label")||e.setStrings({exp_next_label:"NEXT:"+String(t.next_exp)}),n.isUndefined(t.level)||n.isUndefined(t.max_level)||null===e.seekWidgetByName("exp_next_label")||e.seekWidgetByName("exp_next_label").setVisible(t.level<t.max_level),n.isUndefined(t.skill)||null===e.seekWidgetByName("skill_next_label")||(0===t.skill.next_exp?e.seekWidgetByName("skill_next_label").setVisible(!1):(e.setStrings({skill_next_label:"NEXT:"+t.skill.next_exp}),e.seekWidgetByName("skill_next_label").setVisible(!0))),n.isUndefined(t.level)||n.isUndefined(t.max_level)||null===e.seekWidgetByName("skill_next_label")||e.seekWidgetByName("skill_next_label").setVisible(!0),n.isUndefined(t.bonus)||null===e.seekWidgetByName("plus_no")||e.setStrings({plus_no:t.bonus<1?"":"+"+t.bonus}),n.isUndefined(t.description)||null===e.seekWidgetByName("flavor_label")||e.setStrings({flavor_label:t.description})},_setSummonAttackEffectStrings:function(e,t){if(!n.isUndefined(t.attack_info)){n.isUndefined(t.attack_info.name)||null===e.seekWidgetByName("attack_name_label")||e.setStrings({attack_name_label:t.attack_info.name}),n.isUndefined(t.attack_info.description)||null===e.seekWidgetByName("attack_description_label")||e.setStrings({attack_description_label:t.attack_info.description});var i=e.seekWidgetByName("interval_label");n.isUndefined(t.attack_info.turn)||null===i||(i.getParent().setVisible(t.attack_info.turn>0),i.setString(""+t.attack_info.turn+""))}if(n.isUndefined(t.effect_info)||(n.isUndefined(t.effect_info.name)||null===e.seekWidgetByName("support_name_label")||e.setStrings({support_name_label:t.effect_info.name}),n.isUndefined(t.effect_info.description)||null===e.seekWidgetByName("support_description_label")||e.setStrings({support_description_label:t.effect_info.description})),!n.isUndefined(t.attack)&&(n.isUndefined(t.attack.name)||null===e.seekWidgetByName("attack_name_label")||e.setStrings({attack_name_label:t.attack.name}),n.isUndefined(t.attack.description)||null===e.seekWidgetByName("attack_description_label")||e.setStrings({attack_description_label:t.attack.description}),!n.isUndefined(t.attack.turn)&&null!==e.seekWidgetByName("interval_label"))){var a=e.seekWidgetByName("interval_label");a.getParent().setVisible(t.attack.turn>0),a.setString(""+t.attack.turn+"")}n.isUndefined(t.effect)||(n.isUndefined(t.effect.name)||null===e.seekWidgetByName("support_name_label")||e.setStrings({support_name_label:t.effect.name}),n.isUndefined(t.effect.description)||null===e.seekWidgetByName("support_description_label")||e.setStrings({support_description_label:t.effect.description}))}}}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);e.Q,t.pc.roles=t.pc.roles||{},t.pc.roles.GaugesCommon={_setExpGauge:function(e,t){if(!(n.isUndefined(t.exp)||n.isUndefined(t.next_exp)||n.isUndefined(t.level)||n.isUndefined(t.max_level)||null===e.seekWidgetByName("exp-gauge"))){var i=t.level===t.max_level?100:t.exp/(t.next_exp+t.exp)*100;e.seekWidgetByName("exp-gauge").percent=i}},_setSkillExpGauge:function(e,t){var n=e.seekWidgetByName("skill-gauge");n&&(n.percent=t.skill.progress)},_setStarGauge:function(e,t){if(!n.isUndefined(t.max_overlimit_count)&&!n.isUndefined(t.overlimit_count)){var i=this.__getStarGaugeBlankNode(e,t),a=this.__getStarGaugeNode(e,t);i&&a&&(t.is_aroused?this.__setAppearanceStarGaugeAroused(e):this.__setAppearanceStarGaugeNormal(e),i.percent=20*t.max_overlimit_count,a.percent=20*t.overlimit_count)}},__setAppearanceStarGaugeAroused:function(e){var t=this.__getStarGaugeFrameNode(e);t&&t.setAppearance("star_gauge_arousal")},__setAppearanceStarGaugeNormal:function(e){var t=this.__getStarGaugeFrameNode(e);t&&t.setAppearance("star_gauge")},__getStarGaugeFrameNode:function(e){return e.seekWidgetByName("mainparts_star_gauge_ui")},__getStarGaugeBlankNode:function(e,t){return t.is_aroused?e.seekWidgetByName("star_gauge_blank_arousal"):e.seekWidgetByName("star_gauge_blank")},__getStarGaugeNode:function(e,t){return t.is_aroused?e.seekWidgetByName("star_gauge_arousal"):e.seekWidgetByName("star_gauge")}}}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);e.Q,t.pc.roles=t.pc.roles||{},t.pc.roles.IconsCommon={_setRarityIcon:function(e,t,i){var a=e.seekWidgetByName(i||"rarity_icon");if(!n.isUndefined(t.rare)&&null!==a){var o=t.rare;if(t.is_aroused&&(o+="_arousal"),!n.contains(["N","R","SR","SSR","N_arousal","R_arousal","SR_arousal","SSR_arousal"],o))return void console.error("Invalid rarity type: "+o);var r="core/res/icon/rarityicon_"+o+".png";a.loadTexture(r,ccui.Widget.PLIST_TEXTURE)}},_setRarityBar:function(e,t){if(!n.isUndefined(t.rare)&&null!==e.seekWidgetByName("name_base")){var i=t.rare;if(!n.contains(["N","R","SR","SSR"],i))return void console.error("Invalid rarity type: "+i);var a="core/res/introduce/introduce_raritybar_"+i+".png";e.seekWidgetByName("name_base").loadTexture(a,ccui.Widget.PLIST_TEXTURE)}},_setElementIcon:function(e,t,i,a){var o=e.seekWidgetByName(a||"element_icon");if(!n.isUndefined(t.element_type)&&null!==o){var r=t.element_type;n.contains([0,1,2,3,4,5,6,8],r)||console.warn("Unknown element type: "+r);var s=(i=i||"core/res/introduce/introduce_element_")+r+".png";o.loadTexture(s,ccui.Widget.PLIST_TEXTURE)}},_setElementIconCommonRes:function(e,t,n){this._setElementIcon(e,t,"core/res/icon/elementicon_",n)},_setStatustypeIcon:function(e,t){if(!n.isUndefined(t.character_type)&&null!==e.seekWidgetByName("statustype_icon")){var i=t.character_type;if(!n.contains(["attack","balance","defense","special","heal"],i))return void console.error("Invalid character type: "+i);var a="core/res/icon/statustypeicon_"+i+".png";e.seekWidgetByName("statustype_icon").loadTexture(a,ccui.Widget.PLIST_TEXTURE)}},_setJobStatustypeIcon:function(e,t){n.isUndefined(t.type)||(t.character_type=t.type,this._setStatustypeIcon(e,t))},_setWeaponIcon:function(e,t,i){if(i=i||"weapontype_icon",!n.isUndefined(t.weapon_type)&&null!==e.seekWidgetByName(i)){var a=t.weapon_type;if(!n.contains(["sword","special_sword","spear","ax","staff","hammer","gun","bow","magic_item"],a))return void console.error("Invalid weapon type: "+a);var o="core/res/icon/weapontypeicon_"+a+".png";e.seekWidgetByName(i).loadTexture(o,ccui.Widget.PLIST_TEXTURE)}},_setWeaponsIcon:function(e,t){n.isUndefined(t.familiar_weapon_types)||n.each(t.familiar_weapon_types,function(t,n){this._setWeaponIcon(e,{weapon_type:t},"weapontypeicon_"+n)},this)},_setForteIcon:function(e,t){return null===e?void console.error("iconNode is null."):n.isUndefined(t)?void console.error("weaponName is undefined."):void e.loadTexture("core/res/icon/weapontypeicon_"+t+".png",ccui.Widget.PLIST_TEXTURE)}}}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);e.Q,t.pc.roles=t.pc.roles||{},t.pc.roles.CoreCardCommon={_setProperCoreCardElementRarity:function(e,t,n){var i;switch(khutil.getCoreCardDINameByRecord(t)){case"CoreCardJobUI":i="e";break;case"CoreCardWeaponUI":case"CoreCardSummonUI":case"CoreCardCharacterUI":case"CoreCardAccessoryUI":i="e_r";break;default:i="plain"}return this._setProperCoreCard(e,t,n,i)},_setProperCoreCard:function(e,i,a,o){var r=khutil.getCoreCardDINameByRecord(i),s=e.seekWidgetByName(a||"corecard_ui"),c=s.getUserData()||{};n.invoke(c,"setVisible",!1);var u=c[r];return u instanceof t.CoreCardUI?(u.setData(i),u.setVisible(!0),u):((u=t.createInstance(r,[o])).setData(i),s.addChild(u.getResult()),c[r]=u,s.setUserData(c),u)},_setCharacterCoreCard:function(e,t,n){return this._setupCoreCard(e,t,n,"plain","character")},_setCharacterCoreCardElementRarity:function(e,t,n){return this._setupCoreCard(e,t,n,"e_r","character")},_setCharacterCoreCardFull:function(e,t,n){return this._setupCoreCard(e,t,n,"full","character")},_setWeaponCoreCardElementRarity:function(e,t,n){return this._setupCoreCard(e,t,n,"e_r","weapon")},_setWeaponCoreCardFull:function(e,t,n){return this._setupCoreCard(e,t,n,"full","weapon")},_setJobCoreCard:function(e,t,n){return this._setupCoreCard(e,t,n,"e","job")},_setSummonCoreCardElementRarity:function(e,t,n){return this._setupCoreCard(e,t,n,"e_r","summon")},_setSummonCoreCardFull:function(e,t,n){return this._setupCoreCard(e,t,n,"full","summon")},_setAccessoryCoreCardElementRarity:function(e,t,n){return this._setupCoreCard(e,t,n,"e_r","accessory")},_setAccessoryCoreCardFull:function(e,t,n){var i=this._setupCoreCard(e,t,n,"full","accessory");return i.setTotalLabel(" "+(t.hp+t.attack)),i},_setItemCoreCard:function(e,t,n){return this._setupCoreCard(e,t,n,"plain","item")},_setPackageItemCoreCard:function(e,t,n){return this._setupCoreCard(e,t,n,"plain","package")},_setItemCoreCardAmount:function(e,t,n){return this._setupCoreCard(e,t,n,"amount","item")},_setupCoreCard:function(e,t,n,i,a){var o=e.seekWidgetByName(n||"corecard_ui");if(null==o)throw new Error("_setupCoreCard: targetNode Not Found:"+n);var r=a?khutil.getCoreCardDINameByKind(a):khutil.getCoreCardDINameByRecord(t),s=this._createOrGetCoreCardUI(r,o,i);return s.setData(t,null,"CoreCardCommon"),s.setVisible(!0),o.setVisible(!0),s},_createOrGetCoreCardUI:function(e,i,a){var o=i.getUserData()||{};if(o instanceof t.CoreCardUI)return o;var r=i.getActionManager().getActionByTag(i.tag,i);if(r&&r.animationInfo&&r.animationInfo[a]){if(s=t.createInstance(e,[a,i]),i.setUserData(s),null!=i.seekWidgetByName(s.IMG_NODE_NAME))return s;i.removeAllChildrenWithCleanup(!0)}var s,c=n.find(i.getChildren(),function(e){return e.getActionByTag(e.tag)});return c?(s=t.createInstance(e,[a,c]),i.setUserData(s),s):(s=t.createInstance(e,[a]),i.addChild(s.getResult()),i.setUserData(s),s)}}}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);e.Q,t.pc.list=t.pc.list||{},t.pc.list.roles=t.pc.list.roles||{},t.pc.list.roles.SliderCommon={_setSlider:function(e,i,a,o,r,s,c,u){var l=e.seekWidgetByName(i);if(null!==l){l.removeAllChildren();var _=[];n.each(a,function(t,n){var i=this._createSliderNode(e,t,o,r,s,n);i&&_.push(i)},this);var p=new t.PageView;p.initialize(_,function(t,i){n.isFunction(this[c])&&this[c](e,i,a[i-1])},this),p.setDirection(ccui.ScrollView.DIR_HORIZONTAL),l.addChild(p);var d=[];if(d[t.PAGE_CONTROLLER_CONTROLS.NEXT_BUTTON]="btn_next",d[t.PAGE_CONTROLLER_CONTROLS.PREVIOUS_BUTTON]="btn_prev",(new t.PageController).init(e,d,p),!n.isUndefined(u)&&!n.isUndefined(u.interval))if(n.isNumber(u.interval)){p.setLoopContent(!0);this.carouselTimer=n.delay(this._autoScroll,u.interval,u.interval,this,p)}else console.log("[ERROR] Invalid interval param.");return p.gotoFirstPage(),p}console.warn("[ERROR] Could not find a parent node: "+i)},_autoScroll:function(e,t,i){i.gotoNextPage(),t.carouselTimer=n.delay(t._autoScroll,e,e,t,i)},_stopAutoScroll:function(){this.carouselTimer&&(clearTimeout(this.carouselTimer),this.carouselTimer=null)},_createSliderNode:function(e,t,i,a,o,r){if(n.isUndefined(res[i]))return console.warn("[ERROR] Could not find slider resource: "+i),null;var s=ccs.load($dynamicRes(res[i])).node;return null===s?(console.debug("[ERROR] Could not find slider: "+i),null):(n.isUndefined(o)||n.isUndefined(o.nodeName)||n.isUndefined(o.funcName)||(null===s.seekWidgetByName(o.nodeName)?console.warn("[WARN] Could not find a touchable node name: "+o.nodeName):n.isFunction(this[o.funcName])?s.seekWidgetByName(o.nodeName).addTouchEventListener(function(n,i){i===ccui.Widget.TOUCH_ENDED&&this[o.funcName](e,s,t)},this):console.warn("[WARN] Could not find a slot function: "+o.funcName)),n.isFunction(this[a])&&this[a](e,s,t),s)}}}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;e.Q,t.pc.list=t.pc.list||{},t.pc.list.roles=t.pc.list.roles||{},t.pc.list.roles.UserListCommon={_setUserList:function(e,a,o,r){if(i.contains(["blue_only","red_only","blue_red","guild_blue_only","guild_red_only","guild_plain"],o)){var s=e.getActionByTag(e.tag);if(s){if(i.isUndefined(s.animationInfo[o]))return void console.warn("[ERROR] Could not find button animation in userlist: "+o);s.gotoFrameAndPause(s.animationInfo[o].startIndex)}!i.isUndefined(a.name)&&e.seekWidgetByName("username_label")&&e.setStrings({username_label:a.name+" Rank"+a.rank}),i.isUndefined(a.name)||i.isUndefined(a.rank)||!e.seekWidgetByName("player_name_rank_label")||e.setStrings({player_name_rank_label:a.name+"\nRank"+a.rank}),!i.isUndefined(a.raid_points)&&e.seekWidgetByName("total_point_no")&&e.setStrings({total_point_no:a.raid_points}),!i.isUndefined(a.damage_done)&&e.seekWidgetByName("total_damage_no")&&e.setStrings({total_damage_no:a.damage_done});var c=a.last_login_date_time||a.login_date;if(!i.isUndefined(c)&&e.seekWidgetByName("login_label")&&e.setStrings({login_label:""+c}),!i.isUndefined(a.union_position)&&e.seekWidgetByName("icon_guild_position"))if(i.contains(["leader","member","officer","sub_leader"],a.union_position)){n.spriteFrameCache.addSpriteFrames(res["guild-icon_guild_position.plist"]);var u=e.seekWidgetByName("icon_guild_position");u.setVisible(!0),u.loadTexture("guild/res/icon_guild_position_"+a.union_position+".png",ccui.Widget.PLIST_TEXTURE)}else console.error("Invalid union position type: "+a.union_position);if(!i.isUndefined(a.summon_id)&&e.seekWidgetByName("playercard_summon")&&e.loadTextures({playercard_summon:t.Img("playercard","summon",i.padZero(a.summon_id,4),0).png}),!i.isUndefined(a.job_id)&&e.seekWidgetByName("playercard_job")&&e.loadTextures({playercard_job:t.Img("playercard","job",i.padZero(a.job_id,4),0).png}),i.isUndefined(a.a_friend_offer_id)?i.isUndefined(a.a_friend_id)||(e.tag=a.a_friend_id):e.tag=a.a_friend_offer_id,!i.isUndefined(r)){var l,_=n.director.getRunningScene();(l=e.bfsWidgetByName("btn_user"))&&i.isFunction(this[r.user])&&l.addTouchEventListener(function(t,n){n===ccui.Widget.TOUCH_ENDED&&this[r.user](e,a,_)},this),(l=e.bfsWidgetByName("btn_blue_s"))&&i.isFunction(this[r.blue])&&l.addTouchEventListener(function(t,n){n===ccui.Widget.TOUCH_ENDED&&this[r.blue](e,a,_)},this),(l=e.bfsWidgetByName("btn_red_s"))&&i.isFunction(this[r.red])&&l.addTouchEventListener(function(t,n){n===ccui.Widget.TOUCH_ENDED&&this[r.red](e,a,_)},this),i.isFunction(this[r.check])&&((l=e.bfsWidgetByName("CheckBox_1"))&&i.isFunction(this[r.check])&&l.addTouchEventListener(function(t,n){n===ccui.Widget.TOUCH_ENDED&&this[r.check](e,a,!e.seekWidgetByName("CheckBox_1").selected,_)},this))}}else console.warn("[ERROR] Invalid button pattern type: "+o)}}}((this||0).self||global),function(e){var t=e.kh;e.cc,e._,e.Q,t.pc.roles=t.pc.roles||{},t.pc.roles.RoutingCommon={_consoleErrorRouterParams:function(e){if(t.env.riseErrorOnRoutingValidation)throw new Error("Routing parameter validation failed. requires "+e+" .");console.debug("[CAUTION] Created temporary router param for debug: "+e+"."),console.debug("          If you define this parameter, this caution will be cleared.")},_consoleErrorRoutingAbort:function(e){console.debug("[CAUTION] Not defined router parameters: "+e),console.debug("          Routing aborted.")},_navigateToPresent:function(e){t.createInstance("router").navigate("present/prs_001",e)},_navigateToGachaTop:function(e){t.createInstance("router").navigate("gacha",e)},_navigateToGemGacha:function(e){t.createInstance("router").navigate("gacha/ga_004",e)},_navigateToQuest:function(e){t.createInstance("router").navigate("quest",e)}}}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);e.Q,t.pc.quest=t.pc.quest||{},t.pc.quest.roles=t.pc.quest.roles||{},t.pc.quest.roles.Routing={_navigateToMy001:function(){t.createInstance("router").navigate("mypage/my_001")},_navigateByQuestType:function(e){if(/daily|guerrilla|acce/.test(e.quest_type)&&null!=e.quest_category){var i={q_special_top:{category:e.quest_category,tab:e.quest_sub_category}};t.createInstance("router").navigate("quest/q_special_top",i)}else switch(e.quest_type){case"raid":this._navigateTo011(e.is_own_raid);break;case"main":case"free":this._navigateTo001();break;case"tower_event":this._navigateToTowerQuest(e.event_id,e.a_quest_id);break;case"mission":this._navigateToHlbattle001();break;case"event":this._navigateToConquest(e.event_type,e.event_id);break;case"event_union_lilim_raid":this._navigateToUniRaid004(e.event_id);break;case"event_union_demon_raid":this._navigateToUniRaid002(e.event_id);break;case"event_union_throne_raid":this._navigateToUniRaid004(e.event_id);break;case"event_union_seraph_raid":this._navigateToUniRaid002(e.event_id);break;case"event_raid":n.isEqual(e.returnQuestRoute,"quest/q_006")?t.createInstance("router").navigate("quest/q_006"):n.isEqual(e.returnQuestRoute,"raidevent/ra_002")&&this._navigateToRa002(e.event_id);break;case t.quest.QUEST_TYPE.SCOREATTACK_QUEST:t.createInstance("router").navigate("scoreattack/scoreattack_quest",{scoreattack_quest:{event_id:e.event_id}});break;case t.quest.QUEST_TYPE.EPIC_QUEST:case t.quest.QUEST_TYPE.EPIC_SCENARIO_QUEST:t.createInstance("router").navigate("epic/epic_quest_list",{},{epic_quest_list:{epicId:e.epic_id,event_id:e.event_id}});break;case t.quest.QUEST_TYPE.PRIZE_HUNT:t.createInstance("router").navigate("prizehunt/prizehunt_top",{},{event_id:e.event_id});break;default:this._navigateToMy001()}},_navigateTo007:function(e){var n=t.createInstance("router");return-1!==["q_006","q_007","q_008"].indexOf(n.getCurrentSceneName())?void e._delegate.show007():void t.createInstance("router").navigate("quest/q_007")},_navigateTo008:function(){t.createInstance("router").navigate("quest/q_008")},_navigateTo001:function(){t.createInstance("router").navigate("quest/q_001",{})},_navigateToTowerQuest:function(e,n){t.createInstance("router").navigate("tower/tower_quest",{tower_quest:{event_id:e,clear_a_quest_id:n}})},_navigateToHlbattle001:function(){t.createInstance("router").navigate("hlbattle",{prf_001:{type:"own"}})},_navigateToConquest:function(e,n){var i="quest_story_event"===e?"tab_1":"tab_0";t.createInstance("router").navigate("conquest/con_005",{con_005:{event_id:n,tab:i}})},_navigateToUniRaid002:function(e){t.createInstance("router").navigate("unionraid/uniraid_002",{},{event_id:e})},_navigateToUniRaid004:function(e){t.createInstance("router").navigate("unionraid/uniraid_004",{},{event_id:e})},_navigateToRa002:function(e){t.createInstance("router").navigate("raidevent/ra_002",{ra_002:{event_id:e}})},_navigateTo011:function(e){e?t.createInstance("router").navigate("quest/q_011"):t.createInstance("router").navigate("quest/q_006")},_navigateTo002:function(e,i,a,o){if(n.isUndefined(i)||n.isUndefined(i.a_quest_id)||n.isUndefined(i.type))this._consoleErrorRoutingAbort("record.a_quest_id");else{var r=t.createInstance("router").getCurrentFragment();t.createInstance("router").navigate("quest/q_002",{q_002:{target:"quest",quest_id:i.quest_id,owner_account_id:i.owner_account_id,quest_type:i.type,episode_num:a,recommended_element_type:o,returnQuestRoute:r}})}},_navigate001To006:function(e,n){var i={};n&&(i={tab:n}),t.createInstance("router").navigate("quest/q_006",i)},_navigate001To009:function(e,i,a){return n.isUndefined(i)||n.isUndefined(i.a_quest_id)||n.isUndefined(i.type)?void this._consoleErrorRoutingAbort("record.a_quest_id"):void t.createInstance("router").navigate("quest/q_009",{q_009:{target:"quest",quest_id:i.quest_id,owner_account_id:i.owner_account_id,quest_type:i.type,recommended_element_type:a}})},_navigate004To009:function(e,i,a){return n.isUndefined(i)||n.isUndefined(i.a_quest_id)||n.isUndefined(i.type)?void this._consoleErrorRoutingAbort("record.a_quest_id"):void t.createInstance("router").navigate("quest/q_009",{q_009:{target:"quest",quest_id:i.quest_id,owner_account_id:i.owner_account_id,quest_type:i.type,recommended_element_type:a}})},_navigate006To009:function(e,i,a){return n.isUndefined(e)||n.isUndefined(e.a_quest_id)||n.isUndefined(e.quest_type)||n.isUndefined(e.battle_bp)?void this._consoleErrorRoutingAbort("record.a_quest_id"):void t.createInstance("router").navigate("quest/q_009",{q_009:{target:"raid",quest_id:e.quest_id,a_quest_id:e.a_quest_id,a_battle_id:e.a_battle_id,a_player_id:i,owner_account_id:e.owner_account_id,is_own_raid:e.is_own_raid,quest_type:e.quest_type,raid_boss:e.enemy_name,battle_bp:e.battle_bp,recommended_element_type:a,event_id:e.event_info.id,returnQuestRoute:"quest/q_006"}})},_verifyRouterParams002:function(e){(n.isUndefined(e.routerParams)||n.isUndefined(e.routerParams.q_002))&&(e.routerParams.q_002={},e.routerParams.q_002.quest_id=1,e.routerParams.q_002.owner_account_id=1,e.routerParams.q_002.quest_type="main",e.routerParams.q_002.episode_num=1,this._consoleErrorRouterParams("routerParams.q_002, .a_quest_id, .quest_type, .episode_num"))},_navigate002ToParty:function(e,n,i,a,o){var r=e.routerParams.q_002;r.a_supporter_id=i,r.supporter_element_type=a,t.router.PartyNavigate.makeTo001Member(r.from_tower,"quest/q_002",n,o,{q_002:r}).navigate()},_navigate002To004:function(e){var n={q_004:{tab:e}};t.createInstance("router").navigate("quest/q_004",{},n)},_navigate003_2To003_1:function(e){t.createInstance("router").navigate("quest/q_003_1",e.routerParams,e.temporaryRouterParams)},_navigate009ToParty:function(e,n,i,a,o){var r=e.routerParams.q_009;r.a_supporter_id=i,r.supporter_element_type=a,t.router.PartyNavigate.makeTo001Member(r.from_tower,"quest/q_009",n,o,{q_009:r}).navigate()},_navigate009ToQuestTop:function(e,n,i){"event_union_demon_raid"===n||"event_union_seraph_raid"===n?t.createInstance("router").navigate("unionraid/uniraid_002",{},{event_id:i}):t.createInstance("router").navigate("quest/q_001",{})},_verifyRouterParams003_001:function(e){n.isUndefined(e.routerParams.a_battle_id)&&(e.routerParams.a_battle_id=1,this._consoleErrorRouterParams("routerParams.a_battle_id")),n.isUndefined(e.routerParams.quest_type)&&(e.routerParams.quest_type="event_raid",this._consoleErrorRouterParams("routerParams.quest_type"))},_navigate003_001To003_002:function(e,i){n.isUndefined(i.a_battle_id)&&(i.a_battle_id=1,this._consoleErrorRoutingAbort("routerParams.a_battle_id")),n.isUndefined(i.quest_type)&&(i.quest_type="main",this._consoleErrorRoutingAbort("routerParams.quest_type")),t.createInstance("router").navigate("quest/q_003_2",i)},_verifyRouterParams003_002:function(e){n.isUndefined(e.routerParams.a_battle_id)&&(e.routerParams.a_battle_id=1,this._consoleErrorRouterParams("routerParams.a_battle_id")),n.isUndefined(e.routerParams.quest_type)&&(e.routerParams.quest_type="main",this._consoleErrorRouterParams("routerParams.quest_type"))},_navigate003_002To001:function(e,n){t.createInstance("router").navigate("quest/q_001",n)},_verifyTemporaryRouterParams004:function(e){return n.isUndefined(e.temporaryRouterParams.q_004)?void(e.temporaryRouterParams.q_004={}):void(n.isUndefined(e.temporaryRouterParams.q_004.tab)&&(e.temporaryRouterParams.q_004={}))},_verifyRouterParams006:function(e){n.isUndefined(e.routerParams)&&(e.routerParams={}),n.isUndefined(e.routerParams.routing_quest_type)&&(e.routerParams.routing_quest_type="")},_navigate007To003:function(e){t.createInstance("router").navigate("quest/q_003_1",{a_battle_id:e.a_battle_id,quest_type:e.quest_type,is_own_raid:e.is_own_raid})},_navigate008To001:function(e){t.createInstance("router").navigate("quest/q_001",{})},_navigate008To010:function(e){t.createInstance("router").navigate("quest/q_010",{q_010:{quest_id:e.quest_id,a_battle_id:e.a_battle_id,quest_type:e.quest_type,had_won:e.had_won}})},_navigate006ToBackBtn:function(e){return"raidevent"===e.routing_quest_type?void t.createInstance("router").navigate("raidevent/ra_001",{ra_001:{event_id:e.routing_event_id}}):"raid"===e.routing_quest_type?void t.createInstance("router").navigate("quest/q_011"):void t.createInstance("router").navigate("quest/q_portal_top")},_verifyRouterParams010:function(e){return n.isUndefined(e.routerParams.q_010)?(e.routerParams.q_010=e.routerParams.q_010||{},e.routerParams.q_010.quest_id=1,e.routerParams.q_010.a_battle_id=2,e.routerParams.q_010.quest_type="event_raid",e.routerParams.q_010.had_won=!1,void this._consoleErrorRouterParams("routerParams.q_010, .a_battle_id, .quest_type, .had_won .quest_id")):(n.isUndefined(e.routerParams.q_010.a_battle_id)&&(e.routerParams.q_010=e.routerParams.q_010||{},e.routerParams.q_010.a_battle_id=1,this._consoleErrorRouterParams("routerParams.q_010, .a_battle_id")),n.isUndefined(e.routerParams.q_010.quest_type)&&(e.routerParams.q_010=e.routerParams.q_010||{},e.routerParams.q_010.quest_type="raid",this._consoleErrorRouterParams("routerParams.q_010, .quest_type")),n.isUndefined(e.routerParams.q_010.had_won)&&(e.routerParams.q_010=e.routerParams.q_010||{},e.routerParams.q_010.had_won=!0,this._consoleErrorRouterParams("routerParams.q_010, .had_won")),void(n.isUndefined(e.routerParams.q_010.quest_id)&&(e.routerParams.q_010=e.routerParams.q_010||{},e.routerParams.q_010.quest_id=1,this._consoleErrorRouterParams("routerParams.q_010, .quest_id"))))},_navigateToPrf001:function(e,n){var i=e.a_player_id,a="me"===i;t.createInstance("router").navigate("profile/prf_001"+(a?"a":"b"),{prf_001:{id:i}},{return_to_profile:{routes:"quest/q_010",params:{q_010:{quest_id:n.routerParams.q_010.quest_id,a_battle_id:n.routerParams.q_010.a_battle_id,quest_type:n.routerParams.q_010.quest_type,had_won:n.routerParams.q_010.had_won}}}})},_navigate010To008:function(){t.createInstance("router").navigate("quest/q_008",{})},_navigate011To009:function(e,i){return n.isUndefined(e)||n.isUndefined(e.a_quest_id)||n.isUndefined(e.type)?void this._consoleErrorRoutingAbort("record.a_quest_id"):void t.createInstance("router").navigate("quest/q_009",{q_009:{target:"quest",is_own_raid:!0,quest_id:e.quest_id,owner_account_id:e.owner_account_id,quest_type:e.type,recommended_element_type:i}})}},n.assign(t.pc.quest.roles.Routing,t.pc.roles.RoutingCommon)}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);e.Q,t.pc.list=t.pc.list||{},t.pc.list.roles=t.pc.list.roles||{},t.pc.list.roles.PageListControllerCommon={_fillupList:function(e,i,a,o,r,s,c){if(n.isUndefined(a))console.debug("[ERROR] Could not read record.");else if(n.isUndefined(o))console.debug("[ERROR] Could not read recordMax.");else if(n.isUndefined(i)&&(i={}),n.isUndefined(i.viewParent)&&(i.viewParent="page_list"),n.isUndefined(i.subPageRes))console.debug("[ERROR] not found resource. "+i.viewParent);else if(n.isUndefined(res[i.subPageRes]))console.debug("[ERROR] Could not find resource. "+i.subPageRes);else{n.isUndefined(i.panelsPerPage)&&(i.panelsPerPage=3);var u=e.seekWidgetByName(i.viewParent);if(null!==u){(g=u.getUserData())instanceof t.PageView&&g.cleanup();var l=i.panelsPerPage,_=Math.ceil(o/l),p=Math.min(_,5),d=this.__initPageUiNodes(u,i,p),h=this.__initPageList(d,_,p,i,s,r),m=Math.min(o,l*p);n.each(a.slice(0,m),this.__initRecord.bind(this,l,h)),n.each(n.range(m,l*p),this.__initRecord.bind(this,l,h,null));var g=this.__createPageListView(e,u,h,c);g.gotoFirstPage(),p>=_||g.addOnPageChangeCallback(function(e,t,n,i){for(var a=t-2,o=0;o<5;o++){var r=a+o;if(r<1){if(!i.isLoopContent())continue;r=n.length-r}if(r>n.length){if(!i.isLoopContent())continue;r-=n.length}n[r-1].setRecords(this.record,(r-1)*l)}},{record:a,perPage:l})}else console.debug("[ERROR] Could not find page view parent.")}},__initPageList:function(e,i,a,o,r,s){var c=this;return n.map(n.range(0,i),function(n){var i=e[n%a],u=new t.core.pager.view.page.ScrollPageLayer(i,r,s,c);return u.setName(o.subPageRes+"-"+n),u})},__initPageUiNodes:function(e,i,a){var o=e;return e.getChildren()[0]instanceof t.ScrollViewAbstract&&(o=e.getChildren()[0]),n.map(n.range(0,a),function(e){var n=o.getChildren()[e];return!n||0===n.getChildren().length||n.getContentSize().width<=0?ccs.load($dynamicRes(res[i.subPageRes])).node:n instanceof t.core.pager.view.page.ScrollPageLayer?n.getPageNode():n})},__initRecord:function(e,t,n,i){t[Math.floor(i/e)].setRecord(n,i)},__createPageListView:function(e,i,a,o){var r=new t.PageView;r.initialize(a,function(e,t){!n.isUndefined(o)&&n.isFunction(o)&&o(e,t)},this),i.removeAllChildrenWithCleanup(!0),i.addChild(r),i.setUserData(r);var s=[];return s[t.PAGE_CONTROLLER_CONTROLS.NEXT_BUTTON]="btn_down",s[t.PAGE_CONTROLLER_CONTROLS.PREVIOUS_BUTTON]="btn_up",s[t.PAGE_CONTROLLER_CONTROLS.NUMBER_DISPLAY]="page_current_num.page_max_num",(new t.PageControllerEx).init(e,s,r),r}}}((this||0).self||global),function(e){var t=e._,n=e.kh;n.PopupFactoryAbilityAcquired=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-q_003_getability",buttonLabels:{blueBtn:"OK"}},WIDGET_NAMES:{coreCard:"corecard_ui",abilityIcon:"ability_img",label:"ability_name_labelimg"},create:function(e,i){return n.PopupFactory.prototype.create.call(this,t.assign(e,this.POPUP_PROPERTIES),i)},_addMethodsToPopup:function(e){n.PopupFactoryPopupCommon.prototype._addMethodsToPopup.call(this,e);var t=this.WIDGET_NAMES;e._setData=function(e,t){this._setStrings(e,t),this._setTextures(e,t),this._setCoreCard(e,t)},e._setStrings=function(i,a){var o=i.ability_name,r={};r[t.label]="<span class='white'>"+i[a+"_name"]+"</span><br /><span class='yellow'>"+o+"</span><span class='white'></span>",e.contentNode.setHtmlStrings(r,n.GameConfig.POPUP_CSS)},e._setTextures=function(t,i){n.createInstance("AbilityIcon",[e,t.ability_type,t.category,!1]).show()},e._setCoreCard=function(i,a){var o="job"===a?n.createInstance("CoreCardJobUI",["plain"]):n.createInstance("CoreCardCharacterUI",["plain"]);o.setImg(i[a+"_id"],i.skin||0),e.seekWidgetByName(t.coreCard).addChild(o.getResult())}}})}((this||0).self||global),function(e){var t=e._,n=e.kh;n.PopupFactoryCharacterAbilityImproved=n.PopupFactoryAbilityAcquired.extend({CHARA_POPUP_PROPERTIES:{title:""},create:function(e,i){return n.PopupFactoryAbilityAcquired.prototype.create.call(this,t.assign(e,this.CHARA_POPUP_PROPERTIES),i)},_addMethodsToPopup:function(e){n.PopupFactoryAbilityAcquired.prototype._addMethodsToPopup.call(this,e);var t=this.WIDGET_NAMES;e.setData=function(i){var a=(i.ability_name,{});a[t.label]="<span class='white'>"+i.character_name+""+i.ability_name_before+"</span><br /><span class='yellow'>"+i.ability_name_after+"</span><span class='white'></span>",e.contentNode.setHtmlStrings(a,n.GameConfig.POPUP_CSS),this._setTextures({chara_id:i.character_id,ability_type:i.ability_type,category:i.category,skin:i.skin},"chara"),this._setCoreCard({chara_id:i.character_id,skin:i.skin},"chara")}}})}((this||0).self||global),function(e){var t=e._,n=e.kh;n.PopupFactoryJobAbilityAcquired=n.PopupFactoryAbilityAcquired.extend({JOB_POPUP_PROPERTIES:{title:""},create:function(e,i){return n.PopupFactoryAbilityAcquired.prototype.create.call(this,t.assign(e,this.JOB_POPUP_PROPERTIES),i)},_addMethodsToPopup:function(e){n.PopupFactoryAbilityAcquired.prototype._addMethodsToPopup.call(this,e),e.setData=function(e){this._setData(e,"job")}}})}((this||0).self||global),function(e){var t=e._,n=e.kh;e.ccui,n.PopupFactoryJobMaxBonus=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-q_003_masterbonus",title:"MASTER",buttonLabels:{blueBtn:"OK"}},WIDGET_NAMES:{bonusImage:"bonus_img",bonusLabel:"bonus_label",bonusAquiredTextLabel:"top_label"},BONUS_AQUIRED_TEXT:{PRE:"LvMAX\n",POST:"MASTER"},create:function(e,i){return n.PopupFactory.prototype.create.call(this,t.assign(e,this.POPUP_PROPERTIES),i)},_addMethodsToPopup:function(e){n.PopupFactoryPopupCommon.prototype._addMethodsToPopup.call(this,e);var i=this.WIDGET_NAMES,a=this.BONUS_AQUIRED_TEXT;e.setData=function(o){var r=o.type,s=o.job_name,c=o.description,u={};u[i.bonusImage]=n.Img("coreimg","job-bonusicon",t.padZero(r,4)).png,e.loadTextures(u);var l={};l[i.bonusAquiredTextLabel]=a.PRE+s+a.POST,l[i.bonusLabel]=c,e.setStrings(l)}}})}((this||0).self||global),function(e){var t=e._,n=e.kh,i=e.ccui;n.PopupFactoryMvp=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-q_mvp",title:"MVP",buttonLabels:{blueBtn:"OK"}},WIDGET_NAMES:{initiator:"q_010_player_discoverer_ui",first:"q_010_player_mvp_ui",second:"q_010_player_mvp_second_ui"},CARD_WIDGET_NAMES:{nameAndRank:"player_name_rank_label",points:"total_point_no",damage:"total_damage_no",jobTexture:"playercard_job",summonTexture:"playercard_summon"},create:function(e,i){return n.PopupFactory.prototype.create.call(this,t.assign(e,this.POPUP_PROPERTIES),i)},_addMethodsToPopup:function(e){n.PopupFactoryPopupCommon.prototype._addMethodsToPopup.call(this,e);var a=this.WIDGET_NAMES,o=this.CARD_WIDGET_NAMES;e.setAppearanceDiscover=function(){var e=this.getAnimationNode();e&&e.setAppearance("discoverer_mvp")},e.setAppearanceNotDiscover=function(){var e=this.getAnimationNode();e&&e.setAppearance("only_mvp")},e.getAnimationNode=function(){var e=this.seekWidgetByName("q_010_player_discoverer_ui");return e?e.parent:null},e.setData=function(r){r.initiator?this.setAppearanceDiscover():this.setAppearanceNotDiscover(),t.each(a,function(a,s){var c=r[s],u=i.helper.seekWidgetByName(e,a);if(u.setVisible(!!c),null!=c){var l={};l[o.nameAndRank]=c.name+"\nRank "+c.rank,l[o.points]=c.raid_points,l[o.damage]=c.damage_done,u.setStrings(l);var _={};_[o.jobTexture]=n.Img("playercard","job",t.padZero(c.job_id,4),0).png,_[o.summonTexture]=n.Img("playercard","summon",t.padZero(c.summon_id,4),0).png,u.loadTextures(_)}})}}})}((this||0).self||global),function(e){var t=e._,n=e.kh;e.ccui,n.PopupFactoryRankUp=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-q_levelup",title:"RANK UP!",buttonLabels:{blueBtn:"OK"}},WIDGET_NAMES:{rankLevel:"rankup_labelimg",questPoints:"bonus_labelimg",jobPoints:"get_job_point_labelimg"},create:function(e,i){return n.PopupFactory.prototype.create.call(this,t.assign(e,this.POPUP_PROPERTIES),i)},_addMethodsToPopup:function(e){n.PopupFactoryPopupCommon.prototype._addMethodsToPopup.call(this,e);var t=this.WIDGET_NAMES;e.setData=function(i){var a=i.rankUpData,o=i.rankLevelBefore,r=i.rankLevelAfter,s={};s[t.rankLevel]="<table class='nb'><tr><td class='numbox_long'><span class='white'>Rank&nbsp;"+o+"</span><span class='yellow'>"+r+"</span></td></tr></table>",s[t.questPoints]="<span class='white'>AP</span> <span class='orange'>"+a.ap_before+""+a.ap_after+"</span><br /><span class='white'>HP</span> <span class='orange'>+"+a.hp_increase+"</span>",s[t.jobPoints]="<span class='white'>P</span> <span class='blue'>+"+a.job_points_gained+"</span><br /><span class='white'>(P</span> <span class='blue'>"+a.job_points_total+"</span><span class='white'>)</span>",e.contentNode.setHtmlStrings(s,n.GameConfig.POPUP_CSS)}}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e.ccs,e.ccui),i=e._;t.createNameSpaceIfNotExists("q_003_1"),t.q_003_1.PopupRaQuestAppearance=t.Popup.extend({OK_BUTTON_NAME:"btn_ok",TEXTURE_NODE_NAME:"questimg",UNLOCK_QUEST_INFO_LABEL:"appearance_labelimg",QUEST_IMAGE_PATH:"questimg_{quest_type}-quest_{quest_id}_1",QUEST_IMAGE_EXTENSION:"jpg",setData:function(e){return this._defer=Q.defer(),this._data=e,this._setupOkButton(),this._displayQuestTexture(e),this._displayQuestUnlockedText(e),this._defer.promise},_createCloseBtn:function(){return this.seekWidgetByName(this.OK_BUTTON_NAME)},_setupOkButton:function(){var e=this.seekWidgetByName(this.OK_BUTTON_NAME);e.setSound(t.SoundList.BUTTON_TOUCHED_CONFIRMED),e.addTouchEventListener(function(e,t){t===n.Widget.TOUCH_ENDED&&this.dismiss().then(this._defer.resolve)}.bind(this))},_displayQuestTexture:function(e){var n=this.seekWidgetByName(this.TEXTURE_NODE_NAME),a=this.QUEST_IMAGE_PATH.replace("{quest_type}",e.quest_type).replace("{quest_id}",i.padZero(e.quest_id,4)),o=t.Img(a)[this.QUEST_IMAGE_EXTENSION];n.loadTexture(o)},_displayQuestUnlockedText:function(e){var n={};n[this.UNLOCK_QUEST_INFO_LABEL]=e.sudden_quest_description.replace(/\"/g,"").replace(/<div/g,'<div style="margin: 10px auto;"'),this.setHtmlStrings(n,t.GameConfig.POPUP_CSS)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e.ccs;t.createNameSpaceIfNotExists("q_003_1"),t.q_003_1.PopupFactoryRaQuestAppearance=n.Class.extend({create:function(){var e=i.load($staticRes(res["core-popup-com_raid_appearance"]));return t.createInstance("PopupRaQuestAppearance",[e.node])}})}((this||0).self||global),function(e){var t=e._,n=e.kh;n.PopupFactoryCharacterAbilityAcquired=n.PopupFactoryAbilityAcquired.extend({CHARA_POPUP_PROPERTIES:{title:""},create:function(e,i){return n.PopupFactoryAbilityAcquired.prototype.create.call(this,t.assign(e,this.CHARA_POPUP_PROPERTIES),i)},_addMethodsToPopup:function(e){n.PopupFactoryAbilityAcquired.prototype._addMethodsToPopup.call(this,e),this.WIDGET_NAMES,e.setData=function(e){this._setData({chara_id:e.character_id,chara_name:e.character_name,ability_type:e.ability_type,category:e.category,ability_name:e.ability_name,skin:e.skin||0},"chara")}}})}((this||0).self||global),function(e){var t=e._,n=e.kh;n.PopupFactoryCharacterAcquired=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-com_new_member",title:"",buttonLabels:{blueBtn:"OK"}},WIDGET_NAMES:{characterCard:"corecard_chara_ui",descriptionLabel:"party_join_label"},CHARACTER_ACQUIRED_TEXT:"",create:function(e,i){return n.PopupFactory.prototype.create.call(this,t.assign(e,this.POPUP_PROPERTIES),i)},_addMethodsToPopup:function(e){n.PopupFactoryPopupCommon.prototype._addMethodsToPopup.call(this,e);var t=this.WIDGET_NAMES,i=this.CHARACTER_ACQUIRED_TEXT;e.setData=function(a){(function(e){return n.createInstance("apiCharacters").get(e)})(a.character_id).then(function(a){var o=a.body;n.pc.roles.CoreCardCommon._setCharacterCoreCardElementRarity(e,o,t.characterCard);var r={};r[t.descriptionLabel]=o.name+i,e.contentNode.setStrings(r)}).fail(function(e){console.error(e)})}}})}((this||0).self||global),function(e){var t=e._,n=e.kh;n.PopupFactoryFriendRequest=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-q_003_fapp",title:"",buttonLabels:{blueBtn:"OK",blackBtn:""}},WIDGET_NAMES:{userLabel:"user_info_label",jobImage:"job_img",summonImage:"summon_img"},create:function(e,i){return n.PopupFactory.prototype.create.call(this,t.assign(e,this.POPUP_PROPERTIES),i)},_addMethodsToPopup:function(e){n.PopupFactoryPopupCommon.prototype._addMethodsToPopup.call(this,e);var i=this.WIDGET_NAMES;e.setData=function(a){var o={};o[i.jobImage]=n.Img("playercard","job",t.padZero(a.job_id,4),0).png,o[i.summonImage]=n.Img("playercard","summon",t.padZero(a.summon_id,4),0).png,e.contentNode.loadTextures(o);var r={};r[i.userLabel]=a.name+"\nRank"+a.rank+"\n"+a.summon_name,e.contentNode.setStrings(r)}}})}((this||0).self||global),function(e){var t=e._,n=e.kh;n.PopupFactoryNewItemAcquired=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-q_newitem",title:"",buttonLabels:{blueBtn:"OK"}},WIDGET_NAMES:{newLabel:"new_itemget_labelimg",itemIcon:"item_img",descriptionLabel:"item_description_label"},create:function(e,i){return n.PopupFactory.prototype.create.call(this,t.assign(e,this.POPUP_PROPERTIES),i)},_addMethodsToPopup:function(e){n.PopupFactoryPopupCommon.prototype._addMethodsToPopup.call(this,e);var i=this.WIDGET_NAMES;e.setData=function(a){var o={};o[i.newLabel]="<span class='red'>"+a.name+"</span><span class='white'></span>",e.contentNode.setHtmlStrings(o,n.GameConfig.POPUP_CSS);var r=a.treasure_type;"accessory"===a.treasure_type&&(r="acce");var s=["corecard",r,t.padZero(a.id,4)];"weapon"!==r&&"summon"!==r||s.push(a.skin||"0");var c={};c[i.itemIcon]=n.Img.apply(null,s).jpg,e.contentNode.loadTextures(c);var u={};u[i.descriptionLabel]=a.description,e.contentNode.setStrings(u)}}})}((this||0).self||global),function(e){var t=e._,n=e.kh;n.PopupFactoryQuestClearBonusItemsAcquired=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-q_003_comp",title:"",buttonLabels:{blueBtn:"OK"}},WIDGET_NAMES:{coreCardUI:"corecard_ui_90",quantityLabel:"get_label"},create:function(e,i){return n.PopupFactory.prototype.create.call(this,t.assign(e,this.POPUP_PROPERTIES),i)},_addMethodsToPopup:function(e){n.PopupFactoryPopupCommon.prototype._addMethodsToPopup.call(this,e);var t=this.WIDGET_NAMES;e.setData=function(n){this._setProperCoreCardElementRarity(e.contentNode,n,t.coreCardUI);var i={};i[t.quantityLabel]=n.name+""+n.quantity+"",e.contentNode.setStrings(i)}.bind(this)}}),t.assign(n.PopupFactoryQuestClearBonusItemsAcquired.prototype,n.pc.roles.CoreCardCommon)}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc,e.ccui,e._),i=e.console;t.createNameSpaceIfNotExists("core.router");var a=[["harem","_routeToHarem"],["daily","_routeToSpecialTop"],["guerrilla","_routeToSpecialTop"],["accessory","_routeToSpecialTop"],["event_main","_routeToRaidEventTop"],["event_raid","_routeToRaidEvent"],["event_union_lilim_raid","_routeToLilimRaid"],["event_union_demon_raid","_routeToDemonRaid"],["event_union_throne_raid","_routeToLilimRaid"],["event_union_seraph_raid","_routeToDemonRaid"],["event_union_raid_end","_routeToUnionRaidEnd"],["event_quest_main","_routeToConquestScenario"],["event","_routeToEvent"],["raid","_routeToRaid"],["mission","_routeToGuildOrder"],["scoreattack","_routeToScoreAttack"],["epic","_routeToEpic"],["epic_story","_routeToEpic"],["prizehunt","_routeToPrizeHunt"],["main","_routeToMain"]],o="_routeToDefault",r=0,s=1,c={_routeToHarem:function(e,t,n,i,a,o){var r="new";"harem-ex"===t&&(r="ex"),e("epi",{epi_001:{tab:r}})},_routeToEvent:function(e,n,a,o,r,s){t.createInstance("apiEvents").getQuestEvent(a).then(function(n){var i=n.body.event_type;"quest_event"===i||"quest_story_event"===i?e("conquest/con_005",{con_005:{event_id:a,tab:"tab_0"}}):"tower_event"===i?e("tower/tower_quest",{tower_quest:{event_id:a,clear_a_quest_id:o}}):t.createInstance("router").navigate("quest/q_portal_top")}.bind(this)).fail(function(e){i.error(e)})},_routeToRaidEvent:function(e,t,n,i,a,o){!0===o?this._routeToRaidEventTop(e,t,n,i,a,o):e("quest/q_006")},_routeToRaidEventTop:function(e,t,n,i,a,o){e("raidevent/ra_002",{ra_002:{event_id:n}})},_routeToLilimRaid:function(e,t,n,i,a,o){!0===o?e("unionraid/uniraid_004",{},{event_id:n}):e("quest/q_006")},_routeToGuildOrder:function(e){e("hlbattle/hlbattle_001")},_routeToDemonRaid:function(e,t,n,i,a,o){e("unionraid/uniraid_002",{},{event_id:n})},_routeToUnionRaidEnd:function(e,t,n,i,a,o){e("unionraid/uniraid_007",{},{event_id:n})},_routeToConquestScenario:function(e,t,n,i,a,o){e("conquest/con_005",{con_005:{event_id:n,tab:"tab_1"}})},_routeToSpecialTop:function(e,n,i,a,o,r,s,c,u){Q(t.createInstance("questListCollectionRepository").getQuestListCollection(c)).then(function(e){return e.verify(c,u,s)?void t.createInstance("router").navigate("quest/q_special_top",{q_special_top:{category:c,tab:u}}):void t.createInstance("router").navigate("quest/q_portal_top")})},_routeToDailyAndGuerrilla:function(e){this._navigateToQ004(e,"daily_guerrilla")},_routeToAccessory:function(e){this._navigateToQ004(e,"accessory")},_routeToRaid:function(e,t,n,i,a,o){e(!0===o?"quest/q_011":"quest/q_006")},_routeToScoreAttack:function(e,t,n,i,a,o){e("scoreattack/scoreattack_quest",{scoreattack_quest:{event_id:n}})},_routeToEpic:function(e,t,n,i,a,o){e("epic/epic_quest_list",{},{epic_quest_list:{epicId:a,event_id:n}})},_routeToPrizeHunt:function(e,t,n,i,a,o){e("prizehunt/prizehunt_top",{},{prizehunt_top:{event_id:n}})},_routeToMain:function(e,t,n,i,a,o){e("quest/q_001",{quest_cleared_id:i})},_routeToDefault:function(e,t,n,i,a,o){e("quest/q_portal_top",{quest_cleared_id:i})}};t.core.router.navigateFromQuest=function(e,i,u,l,_,p,d,h,m){var g=i?"navigateAndPreventHistoryBack":"navigate",f=t.createInstance("router"),b=f[g].bind(f),v=n.find(a,function(t,n){var i=t[r];return-1!==e.search(i)},this),E=v&&v[s]||o;c[E](b,e,_,u,p,l,d,h,m)}}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc.quest=t.pc.quest||{},t.pc.quest.roles=t.pc.quest.roles||{},t.pc.quest.roles.QuestSelectCommon=t.pc.quest.roles.QuestSelectCommon||{},t.pc.quest.roles.QuestSelectCommon.popups={_popups:{comNeedApBp1:{factoryName:"popupFactoryComNeedApBp1"},comNeedApBp2:{factoryName:"popupFactoryComNeedApBp2"},comApRestart:{factoryName:"popupFactoryComApRestart"},com_raid_check:{factoryName:"popupFactoryBlackBlue",title:"",content:"<span class='red'></span>",buttonLabels:{blueBtn:"",blackBtn:""},buttonSounds:{blueBtn:t.SoundList.BUTTON_TOUCHED_CONFIRMED},buttons:{blueBtn:function(e){this.dismiss(),t.createInstance("router").navigate("quest/q_007")},blackBtn:function(e){this.dismiss()}}},q_multi_start:{factoryName:"popupFactoryTextOnly",resource:"text_button_only.json",title:"",buttonLabels:{blackBtn:"",blueBtn:"OK"},buttons:{blackBtn:function(e){this.dismiss()},blueBtn:function(e){this.dismiss(),e._delegate.selectQuest(e)}}},q_multi_limit:{factoryName:"popupFactoryBlue",title:"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){this.dismiss()}}},q_caution_2:{factoryName:"popupFactoryBlue",title:"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){this.dismiss()}}},q_caution_3:{factoryName:"popupFactoryTextOnlyVariableSize",name:"q_caution_3",id:"300",buttonLabels:{blueBtn:"OK"},buttonSounds:{blueBtn:t.SoundList.BUTTON_TOUCHED_CONFIRMED},buttons:{blueBtn:function(e){this.dismiss()}}},q_001_select:{factoryName:"popupFactoryPopupCommon",resourceName:"core-popup-q_001_select",title:"",buttonLabels:{blackBtn:""},buttons:{blackBtn:function(e){this.dismiss()}}},q_001_story:{factoryName:"popupFactoryPopupCommon",resourceName:"core-popup-q_001_story",title:"",buttonLabels:{blueBtn:"OK",blackBtn:""},buttons:{blueBtn:function(e){e.popups.q_001_select.dismiss(),this.dismiss(),e._delegate.selectQuest(e)},blackBtn:function(e){e.popups.q_001_select.setVisible(!0),this.dismiss()}}},popupExistUnconfirmBattle:{factoryName:"popupFactoryBlackBlue",title:"",content:"<span class='red'></span>",buttonLabels:{blueBtn:"",blackBtn:""},buttonSounds:{blueBtn:t.SoundList.BUTTON_TOUCHED_CONFIRMED},buttons:{blueBtn:function(e){this.dismiss(),e._delegate._navigateTo007(e)},blackBtn:function(e){this.dismiss()}}},ra_no_item:{factoryName:"popupFactoryPopupCommon",resourceName:"core-popup-ra_no_item",title:"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){this.dismiss()}}},ra_need_item:{factoryName:"popupFactoryPopupCommon",resourceName:"core-popup-ra_need_item",title:"",buttonLabels:{blackBtn:"",redBtn:""},buttons:{blackBtn:function(e){this.dismiss()},redBtn:function(e){this.dismiss(),e._delegate.selectQuest(e)}}},com_caution_2:{factoryName:"popupFactoryBlue",title:"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){this.dismiss()}}}}},t.pc.quest.roles.QuestSelectCommon.methods={_questInfo:null,startCheckQuestState:function(e,t){this._selectQuest=t,this._popupState=0,this._selectedEpisodeNum=null,this.selectQuest(e)},selectQuest:function(e){var t=0,n=2,a=4,o=8,r=32,s=[{flag:16,method:this._unverifyRaidPopup.bind(this,e)},{flag:a,method:this._rankLimitPopup.bind(this,e)},{flag:n,method:this._challengeLimitPopup.bind(this,e)},{flag:r,method:this._requiredItemPopup.bind(this,e)},{flag:t,method:this._apShortPopup.bind(this,e)},{flag:o,method:this._episodeSelectPopup.bind(this,e)}];if(!i.some(s,function(e){if(!(this._popupState&e.flag)&&e.method())return this._popupState|=e.flag,!0},this)){var c=this._selectedEpisodeNum||1,u=i(this._selectQuest.episodes).find(function(e){return e.num===c},this),l=u?u.recommended_element_type:null;this.startQuest(e,this._selectQuest,this._selectedEpisodeNum,l)}},_unverifyRaidPopup:function(e){return!(!this._questInfo||!this._questInfo.has_unverified)&&(e.popups.com_raid_check.open().fail(function(e){console.error(e.stack)}),!0)},_requiredItemPopup:function(e){if(i.isUndefined(this._selectQuest.required_item)||i.isEmpty(this._selectQuest.required_item))return!1;var n=this._selectQuest.required_item,a=n.possession_amount>=n.amount;if(t.quest_required_item.DIConfigForPopupWithPanel.apply(),a){var o=t.createInstance("QuestModel",[this._selectQuest]);return t.createInstance("QuestRequiredItemPopupNeedItem").open(this,o).then(this.selectQuest.bind(this,e)),!0}o=t.createInstance("QuestModel",[this._selectQuest]);return t.createInstance("QuestRequiredItemPopupNoItem").open(this,o),!0},__setupPopupContentsForRaNoItemOrRaNeedItem:function(e,i){var a=i.required_item,o=a.possession_amount>=a.amount,r=this._getQuestNodeFromRequiredItemPopup(e,o);null!==r&&(this._initFuncRaidPanel(r,i),r.setColor(o?n.color.WHITE:n.color("#808080")),"event_raid"!==i.type&&this.__showRequiredItemNode(r,i)),e.setHtmlStrings({need_item_labelimg:this._createRequiredItemsMessage(i)},t.GameConfig.POPUP_CSS)},__showRequiredItemNode:function(e,i){var a=n.director.getRunningScene(),o=t.createInstance("QuestModel",[i]);t.createInstance("QuestRequiredItemController",[a._delegate,o,e]).showRequiredItem()},_getQuestNodeFromRequiredItemPopup:function(e,t){return t?e.seekWidgetByName("need_item_list_ui"):e.seekWidgetByName("com_need_item_list_ui")},_createRequiredItemsMessage:function(e){var t=e.required_item,n="<span class='white'>"+e.title+"       <br/><span class='orange'>"+t.name+"</span>      <span class='red'>"+t.amount+"</span> <br/>      <div style='margin: 0.5em 0;'><span class='orange'></span>"+t.possession_amount,i=t.possession_amount-t.amount;return i>=0&&(n+="&rarr;<span class='red'>"+i+"</span>"),n+"</div></span>"},_apShortPopup:function(e){if(this._selectQuest.quest_ap<=this._questPoints.ap)return!1;var n=t.createInstance("apiAItems");return a.all([n.getApGain(),this.updateQuestPoints()]).spread(function(e,n){var i=t.createInstance("router").getCurrentComponent();this._needApBpPopupFactory=t.createInstance("popupFactoryComNeedApBp"),this._needApBpPopupFactory.create({property:"AP",questTitle:this._selectQuest.title,questPoints:n,items:e.body,component:i,onUse:this._onUseApItem.bind(this),needBattleBp:0}).open()}.bind(this)).fail(function(e){console.error(e)}),!0},_onUseApItem:function(e){this._questPoints.ap=e,this.selectQuest(n.director.getRunningScene())},_rankLimitPopup:function(e){if(!this._selectQuest||!this._selectQuest.limit_info||"number"!=typeof this._selectQuest.limit_info.rank)return!1;var t=this._selectQuest.limit_info.rank;if(t<=this._player.rank)return!1;var n=e.popups.q_caution_2;return n.open().then(function(){var e="<p>Rank"+t+"<br /></p><p class='red'>[]<br />Rank"+t+"</p>";n.setContent(e)}.bind(this)).fail(function(e){console.error(e.stack)}),!0},_challengeLimitPopup:function(e){if(!this._selectQuest||!this._selectQuest.limit_info)return!1;var t=this._selectQuest.limit_info,n="number"==typeof t.remaining_challenge_count,a="accessory"===this._selectQuest.type?this._questInfo.accessory_quest_remaining_challenge_count:null;if(!n&&null===a)return!1;if(t.remaining_challenge_count>0&&!i.isEmpty(this._selectQuest.required_item))return!1;if(n&&(null===a||t.remaining_challenge_count<=a)){var o=t.remaining_challenge_count,r="in_session"===t.constraint_type;return o<=0?this.__multiLimitPopup(e,r):this.__multiStartPopup(e,o),!0}return a<=0?this.__multiLimitForAccessoryQuestPopup(e):this.__multiStartForAccessoryQuestPopup(e,a),!0},__multiLimitPopup:function(e,n){var i=e.popups.q_multi_limit,a="<p class='red'><br/>";n||(a=a+"<p><span class='red'>"+t.w("popupQuestMultiLimitResetTime")+"</span></p>"),i.open().then(function(){i.setContent(a)}.bind(this)).fail(function(e){console.error(e.stack)})},__multiStartPopup:function(e,t){var n=e.popups.q_multi_start;n.open().then(function(){var e="<br /><span class='red'>"+t+"</span><br />";n.setContent(e)}.bind(this)).fail(function(e){console.error(e.stack)})},__multiLimitForAccessoryQuestPopup:function(e){var n=e.popups.q_multi_limit;n.open().then(function(){var e="<p class='red'><br /><p><span class='red'>"+t.w("popupQuestMultiLimitResetTime")+"</span></p>";n.setContent(e)}.bind(this)).fail(function(e){console.error(e.stack)})},__multiStartForAccessoryQuestPopup:function(e,t){var n=e.popups.q_multi_start;n.open().then(function(){var e="<br /><span class='red'>"+t+"</span><br />";n.setContent(e)}.bind(this)).fail(function(e){console.error(e.stack)})},_episodeSelectPopup:function(e){return!(!this._selectQuest||!this._selectQuest.is_cleared||this._selectQuest.episodes.length<=1||(e.popups.q_001_select.open().then(function(){var n=e.popups.q_001_select;n.blueBtn.setEnabled(!1),this._changeEventSkipBtn(e),e.seekWidgetByName("btn_eventskip").addTouchEventListener(function(n,i){if(i===ccui.Widget.TOUCH_ENDED){var a=t.createInstance("playerGameConfig"),o=a.getEpisodeEventSkip();a.setEpisodeEventSkip(!o),this._changeEventSkipBtn(e)}}.bind(this)),i.invoke(i.map(i.range(4),function(t){return e.seekWidgetByName("episode_"+t)}),"setVisible",!1),i.each(this._selectQuest.episodes,function(n,i){var o=e.seekWidgetByName("episode_"+i);o.setVisible(!0);var r=o.seekWidgetByName("btn_episode");o.seekWidgetByName("episode_label").setString(t.w("episode")+(i+1)),r.addTouchEventListener(function(o,r){if(r===ccui.Widget.TOUCH_ENDED){this._selectedEpisodeNum=this._selectQuest.episodes[i].num,e.popups.q_001_select.setVisible(!1);var s=t.createInstance("playerGameConfig");a.all([s.isDirty()&&s.updateGameConfig(),e.popups.q_001_story.open()]).then(function(){var i=e.popups.q_001_story;i.seekWidgetByName("synopsis_label").setString(n.description),i.setTitle(this._selectQuest.quest_num+t.w("chapter")+""+this._selectQuest.title+"")}.bind(this))}}.bind(this))},this),n.setTitle(this._selectQuest.quest_num+t.w("chapter")+""+this._selectQuest.title+"")}.bind(this)),0))},_qCaution3Popup:function(e,i){var a=e.popups.q_caution_3;a.open().then(function(){var e="";null==i.limit_info.rank&&null==i.limit_info.remaining_challenge_count||(e="<span class='red'><br /></span>"),null!=i.limit_info.rank&&(e+="<span class='red'>Rank&nbsp;"+i.limit_info.rank+"&nbsp;<br /></span>"),null!=i.limit_info.remaining_challenge_count&&(e+="<span class='red'>&nbsp;&nbsp;"+i.limit_info.remaining_challenge_count+"<br /></span>",e+="<span class='mini'>"+t.w("popupQuestMultiLimitResetTime")+"</span>"),i.limit_info.elixir&&(e+="<p class='red'><br />",e+=0!==i.limit_info.elixir?":"+i.limit_info.elixir+"</p>":"</p>"),a.setContent(e,n.size(a.contentNode.getContentSize().width,260)),a.setTitle(i.title)}.bind(this)).fail(function(e){console.error(e.stack)})},_changeEventSkipBtn:function(e){var i=t.createInstance("playerGameConfig").getEpisodeEventSkip(),a=e.seekWidgetByName("btn_eventskip");a.setColor(n.color(i?"#FFFFFF":"#808080")),a.setBright(!i)},_cleanUpPaymentId:function(){null!=n.director.getRunningScene().routerParams.payment_id&&t.createInstance("router").permanentlyRemoveRouterParam("payment_id")},updateQuestPoints:function(){var e=n.director.getRunningScene().headerDelegate;return e?e.updateQuestPoints().then(function(e){return this._questPoints=e,e}.bind(this)):t.createInstance("myselfInfoRepository").getQuestPoints(!0).then(function(e){return this._questPoints=e.getAsObject(),this._questPoints}.bind(this))}}}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;e.Q,t.pc.quest=t.pc.quest||{},t.pc.quest.roles=t.pc.quest.roles||{},t.pc.quest.roles.QuestMainPageListPopups={_popups:{comQuestInfo:{factoryName:"popupFactoryComQuestInfo"}}},t.pc.quest.roles.QuestMainPageListController={_fillupQuestMainList:function(e,n,a){if(i.contains(["main","free"],n)){var o=e.seekWidgetByName(n+"_quest_node");if(null!==o){var r=e.seekWidgetByName("q_001_questlist_page_ui");null!==r&&r.removeFromParent();var s="main"==n?"getMainQuestsInCurrentArea":"getFreeQuestsInCurrentArea",c=t.createInstance("apiAAreas"),u="main"==n?this._initFuncMainQuestPanel.bind(this):this._initFuncFreeQuestPanel.bind(this);return this._tmpWidgetRecords=[],c[s]().then(function(e){var n={targetNode:"quest_base",touchEventFuncName:a};return $staticRes(res["quest-q_001-q_001_questlist_page_ui"]),this._fillupList(o,{viewParent:t.PageListParams.QUEST_LIST.viewParent,subPageRes:t.PageListParams.QUEST_LIST.subPageRes,panelsPerPage:t.PageListParams.QUEST_LIST.perPage,dontClone:t.PageListParams.QUEST_LIST.dontClone},e.body.data,e.body.max_record_count,n,u),e.body}.bind(this)).fail(function(e){console.error(e)})}console.warn("[ERROR] Could not find a page parent: "+n+"_quest_node")}else console.warn("Invalid quest type: "+n)},_initFuncMainQuestPanel:function(e,t,n){console.log(e,t,n),this._tmpWidgetRecords.push({widget:e,record:t}),this._initFuncMainQuestpanelCommon(e,t)},_initFuncFreeQuestPanel:function(e,t,n){console.log(e,t,n),this._tmpWidgetRecords.push({widget:e,record:t}),this._initFuncMainQuestpanelCommon(e,t)},_initFuncMainQuestpanelCommon:function(e,t){if(i.isUndefined(t.type)||i.contains(["main","free","raid"],t.type)){var n=e.getActionByTag(e.tag);console.log(n),n&&n.gotoFrameAndPause(n.animationInfo[t.type].startIndex),this._initFuncQuestpanelCommon(e,t)}else console.warn("Invalid card type: "+t.type)},_initFuncQuestpanelCommon:function(e,n,a){a=void 0===a&&!0;var o=n.type;"accessory"===o&&(o="acce");var r=e.seekWidgetByName("questimg");if(null!==r&&!i.isUndefined(o)&&!i.isUndefined(n.quest_id)){var s=o.indexOf("event")>-1?"event":o,c=t.Img("questimg",s+"-quest",i.padZero(n.quest_id,4),1).jpg;r.loadTexture(c)}var u=e.seekWidgetByName("quest_header_label");null===u||i.isUndefined(n.quest_num)||i.isUndefined(n.title)||u.setString("main"===o?""+n.quest_num+t.w("chapter")+" "+n.title:n.title);var l=e.seekWidgetByName("icon_raid-battle");if(null!==l){var _=o.match("raid");l.setVisible(_)}var p=e.seekWidgetByName("cons_ap_label");null===p||i.isUndefined(n.quest_ap)||p.setString("AP"+n.quest_ap);var d=e.seekWidgetByName("cons_label");if(null!==d&&!i.isUndefined(n.event_info)&&!i.isUndefined(n.event_info.type)){var h=n.event_info.type;switch(d.setVisible(!0),h){case"quest_ap_half":d.setString(t.WordBook.quest_ap_half);break;case"quest_ap_free":d.setString(t.WordBook.quest_ap_free);break;default:d.setVisible(!1)}}var m=e.seekWidgetByName("progress_label");null===m||i.isUndefined(n.now_progress)||i.isUndefined(n.max_progress)||m.setString(""+n.now_progress+"/"+n.max_progress);var g=e.seekWidgetByName("gauge_base");null===g||i.isUndefined(n.max_progress)||g.setPercent(100*n.max_progress/4);var f=e.seekWidgetByName("gauge_rate");null===f||i.isUndefined(n.now_progress)||i.isUndefined(n.max_progress)||f.setPercent(100*n.now_progress/4);var b=e.seekWidgetByName("quest_reward");if(null!==b&&!i.isUndefined(n.reward_info)&&!i.isUndefined(n.reward_info.item_id)){var v=i.isNumber(n.now_progress)&&i.isNumber(n.max_progress)&&n.now_progress===n.max_progress;if(!v){var E=n.reward_info.reward_type;"accessory"===E&&(E="acce");var y=t.Img("rewardicon",E,i.padZero(n.reward_info.item_id,4)).png;b.loadTexture(y)}b.setVisible(!v)}var P=e.seekWidgetByName("quest_time_label");null===P||i.isUndefined(n.time_left)||P.setString(n.time_left);var I=e.seekWidgetByName("img_quest_info_icon");if(I&&a){var C=I.getParent();if(!i.isUndefined(n.is_new)&&!i.isUndefined(n.is_cleared)){var N=n.is_new||n.is_cleared;if(I.setVisible(N),C.setVisible(N),N){var A=n.is_new?"core/res/icon/queststatusicon_new.png":n.is_cleared?"core/res/icon/queststatusicon_clear.png":"";I.loadTexture(A,ccui.Widget.PLIST_TEXTURE),n.is_new?C.animate("new",!0):C.animate("default",!1)}}n.in_progress&&(I.setVisible(!0),C.setVisible(!0),I.loadTexture("core/res/icon/queststatusicon_now.png",ccui.Widget.PLIST_TEXTURE),C.animate("default",!1))}"raid"===o?this._setRaidIconBallonAndTouchEvent(e,n):this._setCommonIconBallonAndTouchEvent(e,n)},_setCommonIconBallonAndTouchEvent:function(e,t){var n=this._getBtnIconBalloonNode(e);if(null!==n){if(t.is_cleared)return void n.setVisible(!1);n.relationQuest=t,n.addTouchEventListener(this._comQuestInfo.bind(this))}},_setRaidIconBallonAndTouchEvent:function(e,t){var n=this._getBtnIconBalloonNode(e);null!==n&&(n.relationQuest=t,n.addTouchEventListener(this._raidInfoPopup.bind(this)))},_getBtnIconBalloonNode:function(e){return null==e?null:e.seekWidgetByName("btn_icon_balloon")},_fillupSpecialQuestLists:function(e,n){var a={daily_guerrilla:{questTypes:["daily","guerrilla","event_limited_quest"],apiParams:["daily_guerrilla"],tabNodeName:"tab_0_node",touchEventFuncName:""},accessory:{questTypes:["accessory"],tabNodeName:"tab_1_node",touchEventFuncName:""}};return this._getListSpecialQuestPromise().then(function(o){var r=o.body.data;i.each(a,function(a,o){var s=this._getNodeByName(a.tabNodeName,e),c=this._getNodeByName("q_004_questlist_page_ui",s);null!==c&&c.removeFromParent();var u=i.filter(r,function(e){return i.contains(a.questTypes,e.type)}),l={targetNode:"quest_base",touchEventFuncName:n};$staticRes(res["quest-q_004-q_004_questlist_page_ui"]),this._fillupList(s,{viewParent:t.PageListParams.SP_QUEST_LIST.viewParent,subPageRes:t.PageListParams.SP_QUEST_LIST.subPageRes,panelsPerPage:t.PageListParams.SP_QUEST_LIST.perPage,dontClone:t.PageListParams.SP_QUEST_LIST.dontClone},u,u.length,l,this._initFuncSpecialQuestpanelCommon.bind(this))}.bind(this))}.bind(this))},_initFuncRaidPanel:function(e,t){this._initFuncQuestpanelCommon(e,t)},_getListSpecialQuestPromise:function(){return t.createInstance("apiAQuests").getListSpecialQuest().fail(function(e){console.error(e)})},_initFuncSpecialQuestpanelCommon:function(e,t){var n=t.type;if("accessory"===n&&(n="acce"),"event_limited_quest"===n&&(n="event"),i.isUndefined(n)||i.contains(["raid","daily","guerrilla","event","acce"],n)){var a=e.getActionByTag(e.tag);a&&a.gotoFrameAndPause(a.animationInfo[n].startIndex),this._initFuncQuestpanelCommon(e,t),this._setNeedItemUiNode(e,t)}else console.warn("Invalid card type: "+n)},_setNeedItemUiNode:function(e,t){var n=t.required_item,a=this._getNodeByName("q_need-item_ui",e);if(i.isUndefined(n)||i.isEmpty(n)||i.isUndefined(n.name))this._setNeedItemOffAppearance(a);else{this._setNeedItemOnAppearance(a);var o=this._getNodeByName("need-item_name_label",a),r=this._getNodeByName("need-item_cost_label",a);o.setString(n.name),r.setString(":"+n.amount)}},_setNeedItemOnAppearance:function(e){e.setAppearance("need_item_on")},_setNeedItemOffAppearance:function(e){e.setAppearance("need_item_off")},_raidInfoPopup:function(e,t){if(t===ccui.Widget.TOUCH_ENDED){var i=n.director.getRunningScene(),a=e.relationQuest;this._qCaution3Popup(i,a)}},_comQuestInfo:function(e,t){var a=e.relationQuest;if(t===ccui.Widget.TOUCH_ENDED){var o=n.director.getRunningScene();if(!i.isUndefined(a.reward_info)&&"accessory"===a.reward_info.reward_type)return void this._openAcceRewardPopup(o,a.reward_info);var r=o.popups.comQuestInfo,s=a.title,c="";null!=a.limit_info&&null!=a.limit_info.rank&&(c="[]\nRank "+a.limit_info.rank+""),r.open({title:s,description:a.description,start_condition:c}).then(function(){}.bind(this)).fail(function(e){console.error(e.stack)})}},_openAcceRewardPopup:function(e,n){return this._getAccessoryGetPromise(n.item_id).then(function(n){return t.ImplantedPopup.createOrGet(e,"acce_reward","AcceRewardPopup").open(n.body)})},_getAccessoryGetPromise:function(e){return t.createInstance("apiAccessories").get(e).fail(function(e){console.error(e.stack)})},_getNodeByName:function(e,t){i.isUndefined(t)&&(t=n.director.getRunningScene());var a=t.seekWidgetByName(e);return a||console.warn("QuestMainPageListController._getNodeByName(): node '"+e+"' not found"),a}},i.assign(t.pc.quest.roles.QuestMainPageListController,t.pc.list.roles.PageListControllerCommon)}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);e.Q,t.pc.quest=t.pc.quest||{},t.pc.quest.roles=t.pc.quest.roles||{},t.pc.quest.roles.QuestSupportPageListController={_fillupSupportSummonList:function(e,n){var i=n.getElementType(),a=this._createTabNumber(i),o=e.seekWidgetByName("tab_"+a+"_node");$staticRes(res["core-userlist-supportlist_page_ui"]),this._fillupList(o,t.PageListParams.SUPPORT_SUMMON_LIST,n.getSupporterList(),n.getMaxRecordCount(),{targetNode:"supportlist_base",touchEventFuncName:"_touchSupportSummonPanel"},this._initFuncSupportSummonPanelCommon.bind(this))},_createTabNumber:function(e){return 8===e?6:e},_initFuncSupportSummonPanelCommon:function(e,t){if(!n.isUndefined(t.summon_info)){var i=t.summon_info;this._setSummonCoreCardElementRarity(e,i,"corecard_summon_ui")}var a=e.seekWidgetByName("user_name_label");null===a||n.isUndefined(t.player_info)||n.isUndefined(t.player_info.name)||n.isUndefined(t.player_info.rank)||a.setString(t.player_info.name+" Rank "+t.player_info.rank);var o=e.seekWidgetByName("summon_name_label");null===o||n.isUndefined(t.summon_info)||n.isUndefined(t.summon_info.name)||n.isUndefined(t.summon_info.level)||o.setString("Lv"+t.summon_info.level+" "+t.summon_info.name);var r=e.seekWidgetByName("summon_support_label");null===r||n.isUndefined(t.summon_info)||n.isUndefined(t.summon_info.effect_description)||r.setString(t.summon_info.effect_description);var s=e.seekWidgetByName("last_login_label");null===s||n.isUndefined(t.login_state_str)||s.setString(t.login_state_str.replace("","\n"));var c=e.seekWidgetByName("friend_icon");null===c||n.isUndefined(t.is_friend)||c.setVisible(t.is_friend)}},n.assign(t.pc.quest.roles.QuestSupportPageListController,t.pc.roles.CoreCardCommon,t.pc.list.roles.PageListControllerCommon)}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=(e.cc,e._);e.Q,$staticRes(res["quest-q_006_7_8-q_006_raidlist_page_ui"]),$staticRes(res["quest-q_006_7_8-q_007_8_raidendlist_page_ui"]),$staticRes(res["quest-q_006_7_8-q_007_8_raidendlist_page_ui"]),t.pc.quest=t.pc.quest||{},t.pc.quest.roles=t.pc.quest.roles||{},t.pc.quest.roles.QuestRaidPageListController={_fillupRaidBattleList:function(e,n,a){if(i.contains(["request","unverify","history"],n)){var o="q_006_node",r=t.PageListParams.RAID_REQUEST_LIST.subPageRes,s=t.PageListParams.RAID_REQUEST_LIST.viewParent,c="getRaidRequestList",u=this._initFuncRaidPanel.bind(this);"unverify"===n?(o="q_007_node",r=t.PageListParams.RAID_UNVERIFIED_LIST.subPageRes,s=t.PageListParams.RAID_UNVERIFIED_LIST.viewParent,c="getUnverifiedList",u=this._initFuncUnverifyPanel.bind(this)):"history"===n&&(o="q_008_node",r=t.PageListParams.RAID_HISTORY_LIST.subPageRes,s=t.PageListParams.RAID_HISTORY_LIST.viewParent,c="getHistoryList",u=this._initFuncHistoryPanel.bind(this));var l=e.seekWidgetByName(o);if(null!==l){var _=e.seekWidgetByName(s);return null!==_&&_.removeFromParent(),t.createInstance("apiABattles")[c]().then(function(e){var n={targetNode:"quest_base",touchEventFuncName:a};return this._fillupList(l,{viewParent:t.PageListParams.RAID_LIST.viewParent,subPageRes:r,panelsPerPage:t.PageListParams.RAID_LIST.perPage},e.body.data,e.body.max_record_count,n,u),0===e.body.max_record_count&&(i.isFunction(this._showNothingLabel)?this._showNothingLabel(l):console.warn("[ERROR] You sould assign UIUtility role.")),e.body}.bind(this)).fail(function(e){console.error(e)})}console.warn("[ERROR] Could not find a list parent node.")}else console.warn("Invalid quest type: "+n)},_initFuncRaidPanel:function(e,t){if(!i.isUndefined(t.has_union_member)&&!0===t.has_union_member){var n=e.getActionByTag(e.tag);console.log(n),n&&n.gotoFrameAndPause(n.animationInfo.union.startIndex)}this._initFuncRaidBattlePanelCommon(e,t)},_initFuncUnverifyPanel:function(e,t){if(!i.isUndefined(t.had_won)&&!1===t.had_won){var n=e.getActionByTag(e.tag);console.log(n),n&&n.gotoFrameAndPause(n.animationInfo.failed.startIndex)}this._initFuncRaidBattlePanelCommon(e,t,"unverify")},_initFuncHistoryPanel:function(e,t){if(!i.isUndefined(t.had_won)&&!1===t.had_won){var n=e.getActionByTag(e.tag);console.log(n),n&&n.gotoFrameAndPause(n.animationInfo.failed.startIndex)}this._initFuncRaidBattlePanelCommon(e,t,"history")},_initFuncRaidBattlePanelCommon:function(e,a,o){o=o||"raid";var r=e.seekWidgetByName("questimg_raid-quest");if(null!==r&&!i.isUndefined(a.quest_id)){var s=0===a.quest_type.indexOf("event")?"event-quest":"raid-quest",c=t.Img("questimg",s,i.padZero(a.quest_id,4),1).jpg;r.loadTexture(c)}var u=e.seekWidgetByName("quest_header_label");null===u||i.isUndefined(a.enemy_level)||i.isUndefined(a.enemy_name)||u.setString("Lv"+a.enemy_level+" "+a.enemy_name);var l=e.seekWidgetByName("hp_gauge");null===l||i.isUndefined(a.enemy_hp)||(l.percent=a.enemy_hp/a.enemy_max*100);var _=e.seekWidgetByName("bp_base");null!==_&&_.setVisible(!0);var p=e.seekWidgetByName("bp_label");null===p||i.isUndefined(a.battle_bp)||p.setString("BP "+a.battle_bp);var d=e.seekWidgetByName("help_label");if(null!==d&&!i.isUndefined(a.help_requested_player_name)){var h=a.is_own_raid?"":a.help_requested_player_name+"";d.setString(h)}var m=e.seekWidgetByName("join_count_label");null===m||i.isUndefined(a.participants)||m.setString(a.participants.toString());var g=e.seekWidgetByName("time_rest_label");null===g||i.isUndefined(a.time_left)||g.setString(a.time_left);var f=e.seekWidgetByName("defeat_date_label");null===f||i.isUndefined(a.end_date)||f.setString(a.end_date);var b=e.seekWidgetByName("cons_label");if(null!==b&&!i.isUndefined(a.event_info)&&!i.isUndefined(a.event_info.type))switch(a.event_info.type){case"quest_ap_half":b.setString(t.WordBook.quest_bp_half),b.setVisible(!0);break;default:b.setVisible(!1)}var v=e.seekWidgetByName("reward_label");if(null!==v&&"unverify"===o?(v.setString(""),v.setVisible(!0)):null!=v&&"history"===o&&(v.setString(""),v.setVisible(!0)),"union_raid"!==a.quest_type){var E=n.getWidgetFromNode(e,"icon_balloon");null!==E&&E.setVisible(!1)}this._initRaidQuestInfoIcon(e,a)},_initRaidQuestInfoIcon:function(e,t){var n=e.seekWidgetByName("img_quest_info_icon");if(null!==n){var a=n.getParent();if(!i.isUndefined(t.is_new)&&!i.isUndefined(t.is_cleared)){var o=t.is_new||t.is_cleared,r=t.is_new?"core/res/icon/queststatusicon_new.png":t.is_cleared?"core/res/icon/queststatusicon_clear.png":"";n.loadTexture(r,ccui.Widget.PLIST_TEXTURE),n.setVisible(o),a.setVisible(o),t.is_new?a.animate("new",!0):a.animate("default",!1)}i.isUndefined(t.is_joined)||!0!==t.is_joined||(n.loadTexture("core/res/icon/queststatusicon_enter-war.png",ccui.Widget.PLIST_TEXTURE),n.setVisible(!0),a.setVisible(!0),a.animate("enter_war",!0))}}},i.assign(t.pc.quest.roles.QuestRaidPageListController,t.pc.roles.CoreCardCommon,t.pc.list.roles.PageListControllerCommon)}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._),i=(e.Q,e.console);t.pc.quest=t.pc.quest||{},t.pc.quest.roles=t.pc.quest.roles||{},t.pc.quest.roles.QuestStart=t.pc.quest.roles.QuestStart||{},t.pc.quest.roles.QuestStart={_targetParam:null,questStart:function(e,n,i){var a=t.createInstance("router");a.permanentlyRemoveRouterParam("party"),this._targetParam=e.routerParams[a.getCurrentSceneName()];var o={quest:this._startQuest,raid:this._startRaid};t.createInstance("apiAParties").changeDeck(n).then(o[this._targetParam.target].bind(this,e,n,i))},_startQuest:function(e,a,o){t.createInstance("apiAQuests").startQuest(this._targetParam.quest_id,this._targetParam.quest_type,a,o.summon_info.a_summon_id,this._isLatestEpisode?void 0:this.selectedEpisode.num,this._targetParam.starting_lap).then(function(i){var a=i.body;if(t.createInstance("myselfInfoRepository").allCacheClear(),n.isUndefined(a.cannot_progress_info)){t.createInstance("aQuestInfo").dispose();var o=i.body,r=o.next_info.next_kind,s={talk:{page:"scenario/scenario-play",idName:"id"},"harem-character":{page:"scenario/harem-play",idName:"id"},"harem-job":{page:"scenario/harem-play",idName:"id"},"harem-summon":{page:"scenario/harem-play",idName:"id"},"harem-story":{page:"scenario/harem-play",idName:"id"},battle:{page:"battle",idName:"a_battle_id"},battle_result:{page:"quest/q_003",idName:"a_battle_id"},episode_result:{page:"quest/q_003_2",idName:"a_battle_id"},prize_quest_a:{page:"prizehunt/prizehunt_quest",idName:"quest_id"},finish:{page:"quest/q_001",idName:"id"}}[r],c=Object.assign({},e.routerParams);c[s.idName]=o.next_info.id,c.a_quest_id=a.a_quest_id,c.quest_id=this._targetParam.quest_id,c.quest_type=this._targetParam.quest_type,-1!==c.quest_type.search("raid")&&(c.is_own_raid=!0),"epic"===c.quest_type&&(c.epic_subject_id=this._targetParam.epic_subject_id),"prize_quest_a"===r&&(c.event_id=o.next_info.event_id),this._targetParam.quest_category&&(c.quest_category=this._targetParam.quest_category),this._targetParam.quest_sub_category&&(c.quest_sub_category=this._targetParam.quest_sub_category),delete c.q_002,delete c.q_009,t.createInstance("router").navigate(s.page,c,n.merge({ignoreImplicitRoute:/^scenario/.test(s.page)},c))}else if("cannot_use_character"===a.cannot_progress_info.type||"cannot_use_character_for_tower"===a.cannot_progress_info.type){var u=e.popups.popupCaution,l=n.clone(a.cannot_progress_info.data.names),_=l.shift();n.each(l,function(e,t){_=_+(t%2==0?", ":"<br />")+e}),u.setContent("<p><br /></p><p class='red'>[]<br />"+_+"<br />"+a.cannot_progress_info.data.reason+"</p>"),u.open()}else if("sp_quest_timeover"===a.cannot_progress_info.type){(u=e.popups.popupCaution).setTitle(""),u.setContent("<br />"),u.open(),u.blueBtn.addTouchEventListener(function(e,n){n===ccui.Widget.TOUCH_ENDED&&t.createInstance("router").navigate("quest/q_portal_top")}.bind(this))}else if("already_finished"===a.cannot_progress_info.type){(u=e.popups.popupCaution).setTitle(""),u.setContent(""),u.open(),u.blueBtn.addTouchEventListener(function(e,n){n===ccui.Widget.TOUCH_ENDED&&t.createInstance("router").navigate("quest/q_001",{})}.bind(this))}else if("does_not_have_challenge_item"===a.cannot_progress_info.type){u=e.popups.popupCaution;t.createInstance("apiAQuests").getQuest(e.routerParams.q_002.a_quest_id,e.routerParams.q_002.quest_type).then(function(e){var t=e.body,n=e.body.required_item;u.setTitle(""),u.setContent("<p>"+t.title+"<br />"+n.name+""+ +n.amount+"</p><p>:"+n.possession_amount+"</p><p class='red'>"+a.cannot_progress_info.data.reason+"</p>"),u.open()})}else if("does_not_have_enough_ap"===a.cannot_progress_info.type){(u=e.popups.popupCaution).setTitle("AP"),u.setContent("AP"),u.open(),u.blueBtn.addTouchEventListener(function(e,n){n===ccui.Widget.TOUCH_ENDED&&t.createInstance("router").navigate("quest/q_001",{})}.bind(this))}else if("challenge_limit_reached"===a.cannot_progress_info.type){u=e.popups.popupCaution;var p="<p class='red'><br /><p><span class='red'>"+t.w("popupQuestMultiLimitResetTime")+"</span></p>";u.setContent(p),u.open(),u.blueBtn.addTouchEventListener(function(e,n){n===ccui.Widget.TOUCH_ENDED&&t.createInstance("router").navigate("quest/q_001",{})}.bind(this))}else if("challenge_limit_reached_in_session"===a.cannot_progress_info.type){p="<p class='red'><br /></p>";(u=e.popups.popupCaution).setContent(p),u.open(),u.blueBtn.addTouchEventListener(function(e,n){n===ccui.Widget.TOUCH_ENDED&&t.createInstance("router").navigate("quest/q_001",{})}.bind(this))}else if("accessory_quest_challenge_limit_reached"===a.cannot_progress_info.type){u=e.popups.popupCaution,p="<p class='red'><br /><p><span class='red'>"+t.w("popupQuestMultiLimitResetTime")+"</span></p>";u.setContent(p),u.open(),u.blueBtn.addTouchEventListener(function(e,n){n===ccui.Widget.TOUCH_ENDED&&t.createInstance("router").navigate("quest/q_001",{})}.bind(this))}else if("has_quest_in_progress"===a.cannot_progress_info.type){(u=e.popups.popupCaution).setTitle(""),u.setContent(""),u.open(),u.blueBtn.addTouchEventListener(function(e,t){}.bind(this))}else if("has_unconfirmed_battle"===a.cannot_progress_info.type){(u=e.popups.popupConfirm).setTitle(""),u.setContent("<span class='red'></span>"),u.open(),u.blueBtn.addTouchEventListener(function(e,n){t.createInstance("router").navigate("quest/q_007")}.bind(this))}else if("can_not_be_shown"===a.cannot_progress_info.type){(u=e.popups.popupCaution).setTitle(""),u.setContent(""),u.open(),u.blueBtn.addTouchEventListener(function(e,t){}.bind(this))}else{(u=e.popups.popupCaution).setTitle(""),u.setContent(""),u.open(),u.blueBtn.addTouchEventListener(function(e,t){}.bind(this))}}.bind(this)).fail(function(e){i.error(e.stack)})},_startRaid:function(e,a,o){t.createInstance("apiABattles").joinBattle(this._targetParam.a_battle_id,o.summon_info.a_summon_id,a,this._targetParam.quest_type).then(function(i){var a=i.body,o=this._targetParam.event_id,r=this._targetParam.quest_type;if(n.isUndefined(a.cannot_progress_info))t.createInstance("router").navigate("battle",{quest_type:this._targetParam.quest_type,a_battle_id:this._targetParam.a_battle_id,a_player_id:this._targetParam.a_player_id,a_quest_id:this._targetParam.a_quest_id,is_own_raid:this._targetParam.is_own_raid});else if("already_participants_max"===a.cannot_progress_info.type){(s=e.popups.popupCaution).setTitle(""),s.setContent("<br />"),s.open(),s.blueBtn.addTouchEventListener(function(e,n){n===ccui.Widget.TOUCH_ENDED&&t.createInstance("router").navigate("quest/q_006",{})}.bind(this))}else if("already_finished"===a.cannot_progress_info.type){(s=e.popups.popupCaution).setTitle(""),s.setContent(""),s.open(),s.blueBtn.addTouchEventListener(function(i,a){a===ccui.Widget.TOUCH_ENDED&&(n.isFunction(this._navigate009ToQuestTop)?this._navigate009ToQuestTop(e,r,o):t.createInstance("router").navigate("quest/q_001",{}))}.bind(this))}else if("has_unconfirmed_battle"===a.cannot_progress_info.type){(s=e.popups.popupCaution).setTitle(""),s.setContent("<span class='red'></span>"),s.open(),s.blueBtn.addTouchEventListener(function(e,n){t.createInstance("router").navigate("quest/q_007")})}else if("does_not_have_enough_bp"===a.cannot_progress_info.type){(s=e.popups.popupCaution).setTitle("BP"),s.setContent("BP"),s.open(),s.blueBtn.addTouchEventListener(function(e,n){n===ccui.Widget.TOUCH_ENDED&&t.createInstance("router").navigate("quest/q_006",{})}.bind(this))}else if("has_unconfirmed_battle"===a.cannot_progress_info.type){(s=e.popups.popupCaution).setTitle(""),s.setContent("<span class='red'></span>"),s.open(),s.blueBtn.addTouchEventListener(function(e,n){t.createInstance("router").navigate("quest/q_007")})}else if("challenge_limit_reached"===a.cannot_progress_info.type){var s=e.popups.popupCaution,c="<p class='red'><br /><p><span class='red'>"+t.w("popupQuestMultiLimitResetTime")+"</span></p>";s.setContent(c),s.open(),s.blueBtn.addTouchEventListener(function(e,n){n===ccui.Widget.TOUCH_ENDED&&t.createInstance("router").navigate("quest/q_001",{})}.bind(this))}else t.createInstance("router").navigate("battle",{quest_type:this._targetParam.quest_type,a_battle_id:this._targetParam.a_battle_id,a_player_id:this._targetParam.a_player_id,a_quest_id:this._targetParam.a_quest_id,is_own_raid:this._targetParam.is_own_raid})}.bind(this)).fail(function(e){i.error(e.stack)})}}}((this||0).self||global),function(e){var t=(e.cc,e.ccui,e.kh),n=e.res,i=e._;t.pc.quest=t.pc.quest||{},t.pc.quest.roles=t.pc.quest.roles||{},$staticRes(n["quest-q_010-q_010_reward_get_player_ui"]),t.pc.quest.roles.QuestResultPlayerSlider={BACKGROUND_NAMES:{initiator:"q_resultlist_discover",first:"q_resultlist_mvp",second:"q_resultlist_mvp-second"},_fillPlayerSlider:function(e,t){var n=[];if(i.isNull(t.initiator)||i.isNull(t.first))console.debug("[ERROR] Could not read MVP data.");else{var a=t.initiator;a&&(a.type="initiator",n.push(a));var o=t.first;if(o.type="first",n.push(o),t.second){var r=t.second;r.type="second",n.push(r)}this._setSlider(e,"get_player_page",n,"quest-q_010-q_010_reward_get_player_ui","_setPlayerSliderPanel",{},"_slidePlayerPanel")}},_setPlayerSliderPanel:function(e,t,n){i.isUndefined(n.type)||i.isUndefined(this.BACKGROUND_NAMES[n.type])||i.isUndefined(t.seekWidgetByName(this.BACKGROUND_NAMES[n.type]))||t.seekWidgetByName(this.BACKGROUND_NAMES[n.type]).setVisible(!0);t.stopAllActions(),this._setUserList(t,n,"blue_only",{user:"_onTouchUserButton"})},_slidePlayerPanel:function(e,t){i.each(i.range(3),function(n){e.seekWidgetByName("current_icon_"+n).setVisible(n===t-1)},this)}},i.assign(t.pc.quest.roles.QuestResultPlayerSlider,t.pc.list.roles.SliderCommon,t.pc.list.roles.UserListCommon)}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.quest=n.quest||{},n.quest.view=n.quest.view||{},n.quest.view.AcceRewardPopup=n.ImplantedPopup.extend({UI_NODE_NAMES:{name:"acce_name_label",coreCardUI:"corecard_acce_ui",btnOk:"btn_ok"},_uiNodes:{},_accessoryMaster:null,_initContents:function(e){this._accessoryMaster=e,this._uiNodes=this._getUINodes(),this._clearContents(),this._setTextNodes(),this._setCoreCard(),this._setBtns()},_setTextNodes:function(){this._uiNodes.name.setText(this._accessoryMaster.name)},_setCoreCard:function(){this._setAccessoryCoreCardElementRarity(this._node,this._accessoryMaster,"corecard_acce_ui")},_setBtns:function(){var e=this._uiNodes.btnOk;e.setEnabled(!0),e.setTouchEnabled(!0),e.addTouchEventListener(function(e,t){t===ccui.Widget.TOUCH_ENDED&&(this._clearContents(),this.dismiss())}.bind(this))},_clearContents:function(){this._clearTextNodes(),this._clearCoreCard()},_clearTextNodes:function(){this._uiNodes.name.setText("")},_clearCoreCard:function(){this._uiNodes.coreCardUI.setVisible(!1)},_getUINodes:function(){return t.mapValues(this.UI_NODE_NAMES,function(e){return this._getNodeByName(e)}.bind(this))},_getNodeByName:function(e,n){(t.isUndefined(n)||null===n)&&(n=this._node);var i=n.seekWidgetByName(e);return i||console.warn("AcceRewardPopup._getByNode(): node '"+e+"' not found"),i}}),t.assign(n.quest.view.AcceRewardPopup.prototype,n.pc.roles.CoreCardCommon)}((this||0).self||global),function(e){(e.kh||{}).pressButtonEmulate=function(e,t,n){if(n!==ccui.Widget.TOUCH_MOVED){if(_.isString(t)||t instanceof RegExp){for(var i=e;!i.getName()||0!==i.getName().indexOf(t);)if(!(i=i.getParent())){i=e;break}}else t instanceof cc.Node&&(i=t);switch(n){case ccui.Widget.TOUCH_ENDED:case ccui.Widget.TOUCH_CANCELED:i.setScale(1);break;case ccui.Widget.TOUCH_BEGAN:i.setScale(.9)}}}}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.quest=n.quest||{},n.quest.view=n.quest.view||{},n.quest.view.SelectPartyPopup=n.ImplantedPopup.extend({_parentNodeName:"q_002_sup",_aParties:null,_defaultAPartyIndex:null,_showAPartyIndex:null,_currentDeckPage:null,_supporter:null,_quest:null,_questPoints:null,_recommendedElementType:null,_isRaid:null,_scene:null,_from_tower:null,_pageView:null,_initContents:function(e,t,i,a,o,r,s){this._aParties=t,this._supporter=i,this._quest=a,this._questPoints=o,this._recommendedElementType=r,this._isRaid=s,this._scene=e;var c=this._scene.routerParams[n.createInstance("router").getCurrentSceneName()];this._from_tower=(this._scene.routerParams.party||c||{}).from_tower,this._initAParties().then(function(){this._setQuestInfo(),this.setButtonEvents({btn_cancel:!1,btn_to_quest:this._startQuest.bind(this),touch_panel_main_summon:this._selectMainSummonTab.bind(this,!0),touch_panel_support_summon:this._selectMainSummonTab.bind(this,!1),btn_organize_advice:this._showPopupConfirmAutoOrgWithElement.bind(this),btn_organize_party:this._showConfirmOrganizePartyPopup.bind(this)});var e=this.getNode().bfsWidgetByName("btn_cancel");e.setSoundEnabled(!0),e.setSound(n.SoundList.BUTTON_TOUCHED_CANCEL)}.bind(this)).fail(function(e){console.error(e)})},_isLoadedAParties:function(){return!t.isNull(this._aParties)},_selectedPartyIsLast:function(){return this._showAPartyIndex+1===this._aParties.length},_selectedPartyIsFirst:function(){return 0===this._showAPartyIndex},_selectedPartyIsDefault:function(){return this._showAPartyIndex===this._defaultAPartyIndex},_getShowParty:function(){return this._aParties[this._showAPartyIndex]},_initAParties:function(){return Q.defer(),this._defaultAPartyIndex=t.findIndex(this._aParties,function(e){return e.selected}),this._initAPartiesView(),this._setAPartySupportSummonView(),this._selectMainSummonTab(!0),this._setAPartiesIconBtn(),Q.resolve()},_setTitle:function(e){this._getNodeByName("title_label").setString("["+e+"/"+this._aParties.length+"]")},_setAPartiesIconBtn:function(){t.each(this._aParties,function(e,t){var i="touch_panel_btn_"+(t+1),a=this._getNodeByName(i),o=this._getNodeByName("btn_"+(t+1));a.addTouchEventListener(function(e,i){n.pressButtonEmulate(e,o,i),i===ccui.Widget.TOUCH_ENDED&&this._goToPageByIndex(t)},this)}.bind(this))},_setAPartiesIconView:function(e){t.each(this._aParties,function(t,n){var i=n===e;this._getNodeByName("select_light_"+(n+1)).setVisible(i)}.bind(this))},_initAPartiesView:function(){var e=this.getNode(),i=e.seekWidgetByName("page_panel"),a=this.__initPageUiNodes(i,$staticRes(res["core-popup_layer-party_change_page_ui"]),3),o=t.map(this._aParties,function(e,t){var i=new n.core.pager.view.page.ScrollPageLayer(a[t%3],this._setAPartyView.bind(this));return i.setName("party_change_page_ui-"+t),i},this);i.removeAllChildren(),this._pageView=new n.PageView,this._pageView.initialize(o,this.__updateSelectedPartyUi,this),this._pageView.setLoopContent(!0),this._pageView.setDirection(ccui.ScrollView.DIR_HORIZONTAL),i.addChild(this._pageView);var r=[];r[n.PAGE_CONTROLLER_CONTROLS.NEXT_BUTTON]="btn_page_next",r[n.PAGE_CONTROLLER_CONTROLS.PREVIOUS_BUTTON]="btn_page_back",(new n.PageController).init(e,r,this._pageView),this._aParties.forEach(function(e,t){this._setAPartyIconColor(e.job.element_type,e.is_equipped_main_weapon,t)}.bind(this)),this._pageView.addOnPageChangeCallback(function(e,t,n,i){for(var a=t-1,o=0;o<3;o++){var r=a+o;r<1&&(r=n.length),r>n.length&&(r=1),n[r-1].setRecords(this.record,r-1)}},{record:this._aParties}),this._goToPageByIndex(this._defaultAPartyIndex)},__updateSelectedPartyUi:function(e,t){this._currentDeckPage=e,this._showAPartyIndex=t-1,this._setAPartiesIconView(this._showAPartyIndex),this._setTitle(t);var n=this._getShowParty();this._setAPartyMainSummonView(n.leader_summon),this._setPartyBtn(n)},__initPageUiNodes:function(e,i,a){var o=e;return e.getChildren()[0]instanceof n.ScrollViewAbstract&&(o=e.getChildren()[0]),t.map(t.range(0,a),function(e){var t=o.getChildren()[e];if(!t||0===t.getChildren().length||t.getContentSize().width<=0){var a=ccs.load(i).node;return a.setAnchorPoint(-.1,0),a}return t instanceof n.core.pager.view.page.ScrollPageLayer?t.getPageNode():t})},_goToPageByIndex:function(e){t.isNull(this._pageView)||this._pageView.gotoPageByIndex(e)},_setAPartyView:function(e,t,n){return this._setAPartyJobView(e,t.job),this._setAPartyCharactersView(e,t.characters),this._setAPartyIconColor(t.job.element_type,t.is_equipped_main_weapon,n),e},_setAPartyIconColor:function(e,i,a){var o="btn_"+(a+1),r=this._getNodeByName(o),s=t.findKey(n.ELEMENT_TYPE,function(t){return t===e});"PHANTOM"===s&&(s="illusion"),!1===i&&(s="nothing");var c="core/res/popup/popup_layer/party_change_btn_"+s.toLowerCase()+".png";r.loadTextureNormal(c,ccui.Widget.PLIST_TEXTURE),r.loadTexturePressed(c,ccui.Widget.PLIST_TEXTURE)},_setAPartyJobView:function(e,t){this._setJobCoreCard(e,t,"corecard_job_ui")},_setPartyBtn:function(e){var t=this._scene.routerParams[n.createInstance("router").getCurrentSceneName()],i=(this._scene.routerParams.party||t||{}).from_tower,a={setVisible:function(){}},o=this._getNodeByName("btn_organize_advice")||a,r=this._getNodeByName("btn_organize_party")||a,s=this._getNodeByName("random_enemy_label")||a,c=this._getNodeByName("busy_party_label")||a;if(r._origX||(r._origX=r.x),e.in_use)return o.setVisible(!1),r.setVisible(!1),s.setVisible(!1),void c.setVisible(!0);r.setVisible(!0),6===this._recommendedElementType?(s.setVisible(!0),o.setVisible(!1),r.x=r._origX+30):i?(s.setVisible(!1),o.setVisible(!0),o.setEnabled(!1),o.setColor(cc.color("#808080")),r.x=r._origX):(s.setVisible(!1),o.setVisible(!0),r.x=r._origX),c.setVisible(!1)},_setAPartyMainSummonView:function(e){var t=this._getNodeByName("party_change_main_summon_ui"),n=this._setSummonCoreCardElementRarity(t,e,"corecard_summon_ui");n.setPlusNoVisible(!0),n.setPlusNo(0<e.bonus?"+"+e.bonus:""),t.setStrings({summon_name_level:"Lv"+e.level+" "+e.name,summon_attack:e.attack_description,summon_support:e.effect_description})},_setAPartySupportSummonView:function(){var e=this._getNodeByName("party_change_support_summon_ui"),t=this._supporter.summon_info,n=this._supporter.player_info;this._setSummonCoreCardElementRarity(e,t,"corecard_summon_ui"),e.setStrings({plus_no:t.bonus>0?"+"+t.bonus:"",name_label:n.name+" Rank "+n.rank,summon_name_label:"Lv"+t.level+" "+t.name,summon_attack_label:t.attack_description,summon_support_label:t.effect_description,last_login_label:this._supporter.login_state_str+""}),this._getNodeByName("friend_icon").setVisible(this._supporter.is_friend)},_setAPartyCharactersView:function(e,n){t.each(n,function(t,n){this._setAPartyCharacterView(e,t,n)}.bind(this))},_setAPartyCharacterView:function(e,n,i){var a="corecard_chara_ui_"+i;if(t.isEmpty(n))e.bfsWidgetByName(a).setVisible(!1);else{var o=this._setCharacterCoreCardElementRarity(e,n,a);o.setPlusNoVisible(!0),o.setPlusNo(0<n.bonus?"+"+n.bonus:""),this._setAPartyCharacterEventFilter(e,a,n,i)}},_setAPartyCharacterEventFilter:function(e,t,i,a){if(this._from_tower){var o=e.seekWidgetByName(t),r=o.seekWidgetByName("already_entry_label"),s=o.seekWidgetByName("corecard_chara_ui_"+a);return i.cannot_tower_enter?void this._filterCoreCardNodeForTowerEvent(i,r,s,!0):(this._filterCoreCardNodeForTowerEvent(i,r,s,!1),void n.pc.roles.UIUtility._setGrayOutButton(s,!0))}},_filterCoreCardNodeForTowerEvent:function(e,n,i,a){var o=i.getChildren().filter(function(e){return"already_entry_label"!==e.getName()&&"selecting_frame"!==e.getName()&&"selected_label"!==e.getName()&&"btn_detail"!==e.getName()&&0===e.getChildren().length});t.each(o,function(e){e.setColor(a?cc.color("#808080"):cc.color("#FFFFFF"))}),n.setVisible(a),a&&(n.setString(e.cannot_tower_enter_endat+"\n\n"),n.setZOrder(10))},_selectMainSummonTab:function(e){this._getNodeByName("tab_main_summon_node").setVisible(e),this._getNodeByName("tab_support_summon_node").setVisible(!e),this._getNodeByName("img_main_summon_0").setVisible(!e),this._getNodeByName("img_main_summon_1").setVisible(e),this._getNodeByName("img_support_summon_0").setVisible(e),this._getNodeByName("img_support_summon_1").setVisible(!e)},_setQuestInfo:function(){this._setLimitElixirInfo(),this._setApBpInfo()},_setApBpInfo:function(){var e=this._getNodeByName("ap_bp_label"),t=this._getNodeByName("job_point_label_before"),n=this._getNodeByName("job_point_label_after"),i=this._isRaid&&this._scene.routerParams.q_009.battle_bp,a=i?"BP":"AP";e.setString(a);var o=Number(this._questPoints[a.toLowerCase()]);t.setString(o.toString());var r=o-Number(i?this._scene.routerParams.q_009.battle_bp:this._quest.quest_ap);n.setString(r.toString())},_setLimitElixirInfo:function(){var e=this._getNodeByName("limit_label"),t=this._quest.limit_info.elixir;if(null!=t){var n;n=0===t?"":""+t+"",e.setString(n)}else e.setVisible(!1)},_showConfirmOrganizePartyPopup:function(){var e=this._scene.popups.popupConfirmGoToParty001;e.open().then(function(){e.blueBtn.addTouchEventListener(function(e,t){if(t===ccui.Widget.TOUCH_ENDED){var n=this._getShowParty();this._scene._delegate.navigateToParty(this._scene,n.a_party_id)}}.bind(this))}.bind(this)).fail(function(e){console.error(e)})},_showPopupConfirmAutoOrgWithElement:function(){var e=this._scene.popups.popupConfirmAutoOrgWithElement;e.open().then(function(){var t="",n=this._recommendedElementType;switch(n){case 0:t="<span class='red_shadow'></span>";break;case 1:t="<span class='blue_shadow'></span>";break;case 2:t="<span class='green_shadow'></span>";break;case 3:t="<span class='yellow_shadow'></span>";break;case 4:t="<span class='dark_shadow'></span>";break;default:t="<span class='light_shadow'></span>"}t="<p>"+t+"<br />"+t+"<br /></p><p class='red mini'></p>",e.setContent(t),e.blueBtn.addTouchEventListener(function(e,t){t===ccui.Widget.TOUCH_ENDED&&this._makeRecommendedDeck(n)}.bind(this))}.bind(this)).fail(function(e){console.error(e)})},_makeRecommendedDeck:function(e){var i=n.createInstance("apiAParties"),a=this._getShowParty();return i.makeRecommendedDeck(a.a_party_id,"all",e,["ssrare","srare","rare"]).then(function(e){var n=e.body.deck,i=n.summons[0];a.characters=n.characters,a.is_equipped_main_weapon=n.is_equipped_main_weapon,a.leader_summon.bonus_point=i.bonus,a.leader_summon.element_type=i.element_type,a.leader_summon.id=i.summon_id,a.leader_summon.level=i.level,a.leader_summon.name=i.name,a.leader_summon.rare=i.rare,a.leader_summon.skin=i.skin||0,a.leader_summon.attack_description=n.attack_description,a.leader_summon.effect_description=n.effect_description,a.job.id=n.job.job_id,t.isUndefined(n.job.element_type)||(a.job.element_type=n.job.element_type),this._setAPartyView(this._currentDeckPage,a,this._showAPartyIndex),this._setAPartyMainSummonView(a.leader_summon)}.bind(this)).fail(function(e){console.error(e)})},_startQuest:function(){var e=this._getShowParty();this._scene._delegate.questStart(this._scene,e.a_party_id,this._supporter);var t=this._scene.routerParams[n.createInstance("router").getCurrentSceneName()];(this._scene.routerParams.party||t||{}).from_tower||this.dismiss()}}),n.assignRoles(n.quest.view.SelectPartyPopup,[n.pc.roles.UIUtility,n.pc.roles.CoreCardCommon])}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.createNameSpaceIfNotExists("pc.view"),n.pc.view.AcceDataPopup=n.ImplantedPopup.extend({_initContents:function(e){this.setButtonEvents({btn_ok:!0});var t=this.getNode();this._setAccessoryCoreCardElementRarity(t,e,"corecard_acce_ui");var n=this._getNodes();this._setValue(n.name,e.name),this._setValue(n.minHp,e.min_hp),this._setValue(n.maxHp,e.max_hp),this._setValue(n.minAttack,e.min_attack),this._setValue(n.maxAttack,e.max_attack);var i=e.brand;n.brand.setVisible(i),n.noBrand.setVisible(!i),i&&this._setValue(n.brand,i)},_getNodes:function(){var e=this.getNode();return t({minHp:"hp_min_no",maxHp:"hp_max_no",minAttack:"attack_min_no",maxAttack:"attack_max_no",name:"acce_name_label",brand:"unique_effect_label",noBrand:"hyphen"}).map(function(t,n){var i=e.seekWidgetByName(t);return i||console.warn("AcceDataPopup: node not found: "+t),[n,i]}).zipObject().value()},_setValue:function(e,t){e&&e.setString(t.toString())}}),n.assignRoles(n.pc.view.AcceDataPopup,[n.pc.roles.CoreCardCommon])}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e.console;t.createNameSpaceIfNotExists("quest.model"),t.quest.model.SupporterLists=n.Class.extend({SUPPORTER_LIST_CACHE_KEY:"quest_supporter_list",SUPPORTER_LIST_CACHE_TIME_LIMIT_MS:72e5,ctor:function(){this._supporterListCache=t.createInstance("componentCache"),this._apiASummons=t.createInstance("apiASummons")},getSupporterSummonList:function(e){return this._getRawSupporterSummonList(e).then(function(n){return t.createInstance("SupporterListModel",[n,e])})},getSupporterByIdAndElementType:function(e,t){return this.getSupporterSummonList(t).then(function(t){return t.getSupporterById(e)})},_getRawSupporterSummonList:function(e){var t=this._getSupporterSummonListFromCache(e);return null!=t?Q.resolve(t):this._getSupporterSummonListFromServer(e)},_getSupporterListsFromCache:function(){return this._supporterListCache.get(this.SUPPORTER_LIST_CACHE_KEY)},_getSupporterSummonListFromCache:function(e){var t=this._getSupporterListsFromCache();return null==t?null:t[e]},_getSupporterSummonListFromServer:function(e){return this._apiASummons.getSupporters(e).then(function(t){var n=t.body;return this._cacheSupporterListData(n,e),n}.bind(this),function(e){i.error(e&&e.stack?e.stack:e)})},_cacheSupporterListData:function(e,t){var n=this._getSupporterListsFromCache();return null!=n?void(n[t]=e):((n={})[t]=e,void this._supporterListCache.cache(this.SUPPORTER_LIST_CACHE_KEY,n,this.SUPPORTER_LIST_CACHE_TIME_LIMIT_MS))}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;t.createNameSpaceIfNotExists("quest.model"),t.quest.model.SupporterList=n.Class.extend({ctor:function(e,t){this._supporterListData=e,this._elementType=t},getSupporterList:function(){return this._supporterListData.data},getElementType:function(){return this._elementType},getMaxRecordCount:function(){return this._supporterListData.max_record_count},getSupporterById:function(e){var t=this.getSupporterList();return i.find(t,function(t){return e===t.a_supporter_id})},hasSupporter:function(e){return null!=this.getSupporterById(e)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("quest.model"),t.quest.model.SelectedSupporter=n.Class.extend({ctor:function(e){this._supporterData=e},getRawSupporterData:function(){return this._supporterData},getId:function(){return this._supporterData.a_supporter_id},getElementType:function(){return this._supporterData.summon_info.element_type},hasSummonInfo:function(){return null!=this._supporterData&&null!=this._supporterData.summon_info||(t.createInstance("smartBeat").log("supporterData is null"),console.error("Can not find summon_info"),!1)}})}((this||0).self||global),function(e){var t=e.kh,n=e._,i=e.res;t.ELEMENT_TYPE={},t.NUMBER_FONT_BY_ELEMENT_TYPE={},n.each({FLAME:0,WATER:1,WIND:2,THUNDER:3,DARKNESS:4,LIGHT:5,NONELEMENTAL:6,PHANTOM:8},function(e,n){t.ELEMENT_TYPE[n]=e,t.NUMBER_FONT_BY_ELEMENT_TYPE[e]=i["battle_damage_text_"+n.toLowerCase()+"_fnt"]}),t.NUMBER_FONT_HEAL=i.battle_damage_text_heal_fnt}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("quest.controller"),t.quest.controller.SupporterList=n.Class.extend({DEFAULT_ELEMENT_TYPE:0,TAB_WIDGET_NAME_PREFIX:"tab_",ELEMENT_TAB_DELEGATE_INDEX:0,ctor:function(e){this._supporterListsModel=e,this._renderedLists={},this.routerParams=t.createInstance("routerParams")},showInitialSupporterList:function(e){var t=this._getInitialElementType(e),n=this._getElementTabDelegate(),i=this._getElementTabWidget(t);return this._initialSupporterListCalled=!0,null==i&&null==(i=this._getElementTabWidget(0))?Q.reject("KHSupporterListController: Unable to initialize initial tab."):(n.selectTab(i),this._generateInitialSupporterListPromise())},showSupporterListByElementType:function(e){return this._initialSupporterListCalled?this._getSupporterSummonListModel(e).then(this._showSupporterList.bind(this)).then(this._resolveInitialSupporterListDefer.bind(this)):Q.resolve()},_getInitialElementType:function(e){var n=this._getSelectedElementType();if(n)return n;if(null!=e&&e.hasSummonInfo())return e.getElementType();var i=this._getRecommendedElementType();return i===t.ELEMENT_TYPE.NONELEMENTAL?this.DEFAULT_ELEMENT_TYPE:null!=i?i:this.DEFAULT_ELEMENT_TYPE},_getRecommendedElementType:function(){return this._getRouterParams().recommended_element_type},_getSelectedElementType:function(){return this._getTemporaryRouterParams().selected_element_type},_getRouterParams:function(){return this.routerParams.getRouterParams()},_getTemporaryRouterParams:function(){return this.routerParams.getTemporaryRouterParams()},_getElementTabDelegate:function(){return n.director.getRunningScene().tabDelegateList[this.ELEMENT_TAB_DELEGATE_INDEX]},_getElementTabWidget:function(e){var i=n.director.getRunningScene();return e===t.ELEMENT_TYPE.PHANTOM?i.seekWidgetByName(this.TAB_WIDGET_NAME_PREFIX+6):i.seekWidgetByName(this.TAB_WIDGET_NAME_PREFIX+e)},_generateInitialSupporterListPromise:function(){return this._initialSupporterListDefer=Q.defer(),this._initialSupporterListDefer.promise},_resolveInitialSupporterListDefer:function(){this._initialSupporterListDefer&&this._initialSupporterListDefer.resolve(),this._initialSupporterListDefer=null},_getSupporterSummonListModel:function(e){return this._supporterListsModel.getSupporterSummonList(e)},_showSupporterList:function(e){var t=e.getElementType(),i=e.getSupporterList();if(this._renderedLists[t]===i)return Q.resolve();this._renderedLists[t]=i;var a=n.director.getRunningScene();return a._delegate._fillupSupportSummonList(a,e),Q.resolve()}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("quest.controller"),t.quest.controller.SupporterSelection=n.Class.extend({ctor:function(e){this._supporterListsModel=e,this.routerParams=t.createInstance("routerParams")},selectSupporter:function(e){this._refreshSelectedSupporterBySupporterData(e)},getSelectedSupporter:function(){return this.hasSupporterSelected()?Q.resolve(this._selectedSupporter):this._refreshSelectedSupporterByRouterParams().then(function(){return this._selectedSupporter}.bind(this))},hasSupporterSelected:function(){return null!=this._selectedSupporter},_getSelectedSupporterIdFromRouterParams:function(){return this._getRouterParams().a_supporter_id},_getSelectedSupporterElementTypeFromRouterParams:function(){return this._getRouterParams().supporter_element_type},_getSelectedElementType:function(){var e=this._getTemporaryRouterParams().selected_element_type;return 6===parseInt(e)&&(e=8),e},_getRouterParams:function(){return this.routerParams.getRouterParams()},_getTemporaryRouterParams:function(){return this.routerParams.getTemporaryRouterParams()},_refreshSelectedSupporterByRouterParams:function(){var e=this._getSelectedSupporterIdFromRouterParams(),t=this._getSelectedSupporterElementTypeFromRouterParams();return this._getSelectedElementType()&&(t=this._getSelectedElementType()),null==e||null==t?Q.resolve():this._supporterListsModel.getSupporterByIdAndElementType(e,t).then(this._refreshSelectedSupporterBySupporterData.bind(this))},_refreshSelectedSupporterBySupporterData:function(e){this._selectedSupporter=t.createInstance("SelectedSupporterModel",[e])}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.createNameSpaceIfNotExists("scoreattack"),t.scoreattack.WordBook={EVENT_TYPE:"score_attack_event",QUEST_TYPE:"scoreattack",RECEIVE_REWARD_EVENT_TYPE:"score_attack_event_receive_reward"},t.scoreattack.enum={RANKING_TYPE:{TOTAL:"scoreattack_total_score",BEST:"scoreattack_best_score"},HAS_NOT_SCORE:"-",REWARD_TYPE:{TOTAL_SCORE:"total_score",TOTAL_RANKING:"scoreattack_total_score",BEST_RANKING:"scoreattack_best_score"}}}((this||0).self||global),function(e){var t=e.kh;e.cc,e._,t.createNameSpaceIfNotExists("scoreattack.view"),t.scoreattack.view.ScoreAttackBattleResultPopup=t.ImplantedPopup.extend({_initContents:function(e){var n=e.data,i=e.shouldGoQuestTop,a=e.eventId,o={btn_ok:!i||this._goQuestTop.bind(this,a)};this.setButtonEvents(o),this.getNode().setStrings({score_num_label:String(n.score),data_num_label:String(n.totaling_point)}),this.getNode().bfsWidgetByName("data_label").setString(n.rule_title);var r=this.getNode().seekWidgetByName("element_icon");r.loadTexture("core/res/icon/elementicon_"+n.battle_element+".png",ccui.Widget.PLIST_TEXTURE),r.setVisible(!0);var s=/^element_(.+?)_label/;this.getNode().seekWidgets(function(e){return 0===e.getChildren().length&&s.test(e.getName())}).forEach(function(e){var i=s.exec(e.getName())[1],a=Number(t.WordBook.ELEMENT_TYPE_LIST[i].num);e.setVisible(a===n.battle_element)})},_goQuestTop:function(e){t.createInstance("router").navigate("scoreattack/scoreattack_quest",{scoreattack_quest:{event_id:e}})}}),t.dictx.registerWithProtoStrategy("ScoreattackResultPopup",t.scoreattack.view.ScoreAttackBattleResultPopup)}((this||0).self||global),function(e){var t=(e._,e.kh||{}),n=e.cc;t.createNameSpaceIfNotExists("quest.model"),t.quest.QUEST_TYPE={MAIN_QUEST:"main",RAID_QUEST:"raid",FREE_QUEST:"free",DAILY_QUEST:"daily",GUERRILLA_QUEST:"guerrilla",EVENT_QUEST:"event",ACCESSORY_QUEST:"accessory",MISSION_QUEST:"mission",SCOREATTACK_QUEST:"scoreattack",HAREM_CHARACTER_QUEST:"harem-character",HAREM_JOB_QUEST:"harem-job",HAREM_SUMMON_QUEST:"harem-summon",HAREM_EX_QUEST:"harem-ex",TOWER_EVENT_QUEST:"tower_event",EVENT_RAID_QUEST:"event_raid",EVENT_MAIN_QUEST:"event_main",EVENT_SCENARIO_QUEST:"event_quest_main",EVENT_CONQUEST_QUEST:"event_conex",EVENT_DEMON_RAID_QUEST:"event_union_demon_raid",EVENT_LILIM_RAID_QUEST:"event_union_lilim_raid",EVENT_SERAPH_RAID_QUEST:"event_union_seraph_raid",EVENT_THRONE_RAID_QUEST:"event_union_throne_raid",EPIC_QUEST:"epic",EPIC_BATTLE_QUEST:"epic_battle",EPIC_SCENARIO_QUEST:"epic_story",EVENT_LIMITED_QUEST:"event_limited_quest",PRIZE_HUNT:"prizehunt"};var i=t.quest.QUEST_TYPE;t.quest.model.QuestType=n.Class.extend({ctor:function(e){this._questType=e},canRetry:function(e){switch(this._questType){case i.MAIN_QUEST:case i.FREE_QUEST:case i.DAILY_QUEST:case i.GUERRILLA_QUEST:case i.EVENT_CONQUEST_QUEST:case i.SCOREATTACK_QUEST:case i.EPIC_QUEST:case i.ACCESSORY_QUEST:case i.EVENT_QUEST:case i.EVENT_LIMITED_QUEST:return!0;case i.EVENT_RAID_QUEST:case i.RAID_QUEST:case i.EVENT_LILIM_RAID_QUEST:case i.EVENT_THRONE_RAID_QUEST:return!0===e;default:return!1}},isRaid:function(){switch(this._questType){case i.RAID_QUEST:case i.EVENT_RAID_QUEST:case i.EVENT_DEMON_RAID_QUEST:case i.EVENT_LILIM_RAID_QUEST:case i.EVENT_SERAPH_RAID_QUEST:case i.EVENT_THRONE_RAID_QUEST:return!0;default:return!1}},shouldHideBackButton:function(){switch(this._questType){case i.HAREM_CHARACTER_QUEST:case i.HAREM_JOB_QUEST:case i.HAREM_SUMMON_QUEST:case i.HAREM_EX_QUEST:case i.EVENT_SCENARIO_QUEST:case i.EVENT_MAIN_QUEST:return!0;default:return!1}},getReturnQuestRoute:function(){switch(this._questType){case i.EVENT_RAID_QUEST:return"raidevent/ra_002";case i.RAID_QUEST:return"quest/q_006";case i.MAIN_QUEST:return"quest/q_002";case i.PRIZE_HUNT:return"prizehunt/prizehunt_top";default:return null}},toString:function(){return this._questType},toJSON:function(){return this.toString()},toQuestStartParam:function(){switch(this._questType){case i.EVENT_CONQUEST_QUEST:return"event";default:return this._questType}}})}((this||0).self||global),function(e){e.isElementTypeQuestCategoryState=function(e){return"current_element_type"in e},e.isEventTypeQuestCategoryState=function(e){return"current_event_id"in e}}(QuestPortal||(QuestPortal={})),function(e){e.isMaterialQuestListCollection=function(e){return"material_quest_list"in e},e.isElementQuestListCollection=function(e){return"elemental_quest_list"in e},e.isAccessoryQuestListCollection=function(e){return"accessory_quest_list"in e}}(QuestSpecial||(QuestSpecial={}));__awaiter=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(a,o){function r(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?a(e.value):new n(function(t){t(e.value)}).then(r,s)}c((i=i.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(a)throw new TypeError("Generator is already executing.");for(;c;)try{if(a=1,o&&(r=2&n[0]?o.return:n[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,n[1])).done)return r;switch(o=0,r&&(n=[2&n[0],r.value]),n[0]){case 0:case 1:r=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!(r=(r=c.trys).length>0&&r[r.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!r||n[1]>r[0]&&n[1]<r[3])){c.label=n[1];break}if(6===n[0]&&c.label<r[1]){c.label=r[1],r=n;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(n);break}r[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],o=0}finally{a=r=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var a,o,r,s,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};!function(e){var t={rank_reached:"com_caution_2",main_quest_cleared:"com_caution_wait_update",release_date_reached:"com_caution_progress_locked"},n={rank_reached:function(e){return"<p>Rank"+e+"<br /></p>\n      <p class='red'>[]<br />Rank"+e+"</p>"},main_quest_cleared:function(e){return"<p><br /></p>\n      <p class='red'>[]<br />"+e+"</p>"},release_date_reached:function(e){return"<p><br />\n      </p>"}},i=function(){function e(e){this.rawData=e}return e.prototype.render=function(e){return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(a){switch(a.label){case 0:return(i=e.popups[t[this.rawData.type]]).setContent(n[this.rawData.type](this.rawData.value)),[4,i.open()];case 1:return a.sent(),[2]}})})},e}();e.UnlockCondition=i}(QuestPortal||(QuestPortal={})),function(e){var t=function(){function e(e){this.hasCampaign=e}return e.prototype.render=function(e){e.seekWidgetByName("campaign_icon").setVisible(this.hasCampaign)},e}();e.CampaignNotification=t}(QuestPortal||(QuestPortal={}));__awaiter=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(a,o){function r(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?a(e.value):new n(function(t){t(e.value)}).then(r,s)}c((i=i.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(a)throw new TypeError("Generator is already executing.");for(;c;)try{if(a=1,o&&(r=2&n[0]?o.return:n[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,n[1])).done)return r;switch(o=0,r&&(n=[2&n[0],r.value]),n[0]){case 0:case 1:r=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!(r=(r=c.trys).length>0&&r[r.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!r||n[1]>r[0]&&n[1]<r[3])){c.label=n[1];break}if(6===n[0]&&c.label<r[1]){c.label=r[1],r=n;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(n);break}r[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],o=0}finally{a=r=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var a,o,r,s,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};!function(e){var t={main:{route:"quest/q_001"},raid:{route:"quest/q_011"},material:{route:"quest/q_special_top",routerParameterKey:"q_special_top"},epic:{route:"epic/epic_select",routerParameterKey:"epic_select"},elemental:{route:"quest/q_special_top",routerParameterKey:"q_special_top"},accessory:{route:"quest/q_special_top",routerParameterKey:"q_special_top"},guild_order:{route:"hlbattle/hlbattle_001"},conquest:{route:"conquest/con_001",routerParameterKey:"con_001"}},n=function(){function n(t,n){this.rawData=t,this.questCategoryId=n,this.unlockCondition=new e.UnlockCondition(t.unlock_condition),this.campaignNotification=new e.CampaignNotification(t.has_campaign_in_progress)}return n.prototype.render=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:switch(n){case"pre_animation":return[3,1];case"animation":return[3,3];case"post_animation":return[3,5]}return[3,7];case 1:return[4,this.renderPreAnimationStage(e)];case 2:return[2,i.sent()];case 3:return[4,this.renderAnimationStage(t)];case 4:return[2,i.sent()];case 5:return[4,this.renderPostAnimationStage(e,t)];case 6:return[2,i.sent()];case 7:return[3,8];case 8:return[2]}})})},n.prototype.isUnlockable=function(){return"unlockable"===this.rawData.state},n.prototype.isAvailable=function(){return"unlockable"===this.rawData.state||"unlocked"===this.rawData.state},n.prototype.renderPreAnimationStage=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return"locked"!==this.rawData.state&&"unlockable"!==this.rawData.state?[3,2]:[4,e.animate("lock",!1)];case 1:t.sent(),t.label=2;case 2:return[2]}})})},n.prototype.renderAnimationStage=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,i;return __generator(this,function(a){switch(a.label){case 0:return"unlockable"!==this.rawData.state?[2]:(e.setVisible(!0),t=e.getAction(),n=kh.createInstance("AnimationEventHandlerCcs_2_0").init(t),i=kh.createInstance("AnimationEndEvent",[n]),kh.createInstance("Sound2Event",[n]),t.gotoFrameAndPlay(0,!1),[4,i.listen()]);case 1:return a.sent(),[2]}})})},n.prototype.renderPostAnimationStage=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return t.setVisible(!1),"unlockable"!==this.rawData.state?[3,2]:[4,e.animate("released",!1)];case 1:n.sent(),n.label=2;case 2:return this.updateButtonTouchEvent(e),this.campaignNotification.render(e),[2]}})})},n.prototype.updateButtonTouchEvent=function(e){var t=this;if("locked"!==this.rawData.state){var n=e.seekWidgetByName("menu_btn");this.addEventListener(n,function(){return t.navigate()})}else{var i=e.seekWidgetByName("menu_btn_lock");this.addEventListener(i,function(){return t.showUnlockConditions()})}},n.prototype.addEventListener=function(e,t){e.addTouchEventListener(function(e,n){n===ccui.Widget.TOUCH_ENDED&&t()})},n.prototype.navigate=function(){var n,i,a=kh.createInstance("router"),o=t[this.questCategoryId],r=o.route,s=o.routerParameterKey,c=this.questCategoryId;if(e.isEventTypeQuestCategoryState(this.rawData)){var u=null==s?{}:((n={})[s]={event_id:this.rawData.current_event_id},n);return a.navigate(r,u)}var l=null==s?{}:((i={})[s]={category:c},i);return a.navigate(r,l)},n.prototype.showUnlockConditions=function(){var e=cc.director.getRunningScene();this.unlockCondition.render(e)},n}();e.QuestCategory=n}(QuestPortal||(QuestPortal={}));var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),__read=(__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},__awaiter=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(a,o){function r(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?a(e.value):new n(function(t){t(e.value)}).then(r,s)}c((i=i.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(a)throw new TypeError("Generator is already executing.");for(;c;)try{if(a=1,o&&(r=2&n[0]?o.return:n[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,n[1])).done)return r;switch(o=0,r&&(n=[2&n[0],r.value]),n[0]){case 0:case 1:r=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!(r=(r=c.trys).length>0&&r[r.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!r||n[1]>r[0]&&n[1]<r[3])){c.label=n[1];break}if(6===n[0]&&c.label<r[1]){c.label=r[1],r=n;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(n);break}r[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],o=0}finally{a=r=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var a,o,r,s,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,a,o=n.call(e),r=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(e){a={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return r}),__spread=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(__read(arguments[t]));return e};kh.createNameSpaceIfNotExists("quest.entity"),function(e){var t=["main","raid","material","epic","elemental","accessory","guild_order","conquest"],n={main:"q_portal_top_btn_main_ui",raid:"q_portal_top_btn_raid_ui",material:"q_portal_top_btn_material_ui",epic:"q_portal_top_btn_epic_ui",elemental:"q_portal_top_btn_element_type_ui",accessory:"q_portal_top_btn_acce_ui",guild_order:"q_portal_top_btn_hlbattle_ui",conquest:"q_portal_top_btn_conquest_ui"},i={main:"q_portal_top_release_ani_main",raid:"q_portal_top_release_ani_raid",material:"q_portal_top_release_ani_material",epic:"q_portal_top_release_ani_epic",elemental:"q_portal_top_release_ani_element_type",accessory:"q_portal_top_release_ani_acce",guild_order:"q_portal_top_release_ani_hlbattle",conquest:"q_portal_top_release_ani_conquest"},a="filter_black",o="black";e.questPortalId={id:"QuestPortal",equal:function(e){return"QuestPortal"===e.id}};var r=function(r){function s(t){var n=this;return Object.freeze(t),(n=r.call(this,e.questPortalId,t)||this).questCategories=_.reduce(t,function(t,n,i){var a,o=new e.QuestCategory(n,i);return __assign({},t,((a={})[i]=o,a))},{}),n}return __extends(s,r),s.prototype.makePurgeRule=function(){return new PurgeRule(2,0)},s.prototype.get=function(){return _.cloneDeep(this.getPlainBody())},s.prototype.render=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return this.isAvailable("raid")||t.disable(),[4,this.renderPreAnimationStage(e)];case 1:return n.sent(),[4,this.renderAnimationStage(e)];case 2:return n.sent(),[4,this.renderPostAnimationStage(e)];case 3:return n.sent(),[2]}})})},s.renderDefaultState=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,e.animate(o,!1)];case 1:return t.sent(),[2]}})})},s.prototype.renderPreAnimationStage=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return e.seekWidgetByName(a).setTouchEnabled(!0),[4,e.animate(o,!1)];case 1:return t.sent(),[4,this.renderQuestCategories(e,"pre_animation")];case 2:return t.sent(),[2]}})})},s.prototype.renderAnimationStage=function(e){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(i){switch(i.label){case 0:return this.hasUnlockableQuestCategories()?[3,2]:[4,e.animate("default_view",!1)];case 1:return i.sent(),[2];case 2:return this.unlockQuestCategories(),t=e.seekWidgetByName("side_navi_0_ui"),n=t.getAction(),_.isEmpty(n)?[3,4]:[4,n.gotoFrameAndPause(0)];case 3:i.sent(),i.label=4;case 4:return[4,this.renderQuestCategories(e,"animation")];case 5:return i.sent(),[4,e.animate("fade_in",!1)];case 6:return i.sent(),[2]}})})},s.prototype.renderPostAnimationStage=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.renderQuestCategories(e,"post_animation")];case 1:return t.sent(),e.seekWidgetByName(a).setTouchEnabled(!1),e.seekWidgetByName("btn_event").setVisible(!0),[2]}})})},s.prototype.renderQuestCategories=function(e,a){var o=this;return _.reduce(t,function(t,r){return __awaiter(o,void 0,void 0,function(){var o,s,c;return __generator(this,function(u){switch(u.label){case 0:return o=this.questCategories[r],s=e.seekWidgetByName(n[r]),c=e.seekWidgetByName(i[r]),[4,t];case 1:return u.sent(),[4,o.render(s,c,a)];case 2:return u.sent(),[2]}})})},Promise.resolve())},s.prototype.unlockQuestCategories=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return t=_.reduce(this.questCategories,function(e,t,n){return t.isUnlockable()?__spread(e,[n]):e},[]),[4,(new e.QuestPortalRepository).unlockQuestCategories(t)];case 1:return n.sent(),this.setOldFlag(),[2]}})})},s.prototype.hasUnlockableQuestCategories=function(){return _.some(this.questCategories,function(e){return e.isUnlockable()})},s.prototype.isAvailable=function(e){return this.questCategories[e].isAvailable()},s}(BaseEntity);e.QuestPortal=r}(QuestPortal||(QuestPortal={})),kh.quest.entity.QuestPortal=QuestPortal.QuestPortal,function(e){var t={material:"",elemental:"",accessory:""},n=function(){function e(e){this.questCategory=e}return e.prototype.render=function(e){var n=e.seekWidgetByName("header_label");null!=n&&n.setText(t[this.questCategory])},e}();e.QuestSpecialHeader=n}(QuestSpecial||(QuestSpecial={})),function(e){var t={material:"\n",elemental:"\n",accessory:"\n"},n=function(){function e(e){this.questCategory=e}return e.prototype.render=function(e){var n=e.seekWidgetByName("balloon_label");null!=n&&n.setText(t[this.questCategory])},e}();e.QuestSpecialNaviChara=n}(QuestSpecial||(QuestSpecial={}));__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};!function(e){var t={material:"tab_material_ui",elemental:"tab_element_type_ui",accessory:"tab_element_type_ui"},n={gem:"tab_0",character_enhance:"tab_1",weapon_enhance:"tab_2",summon_enhance:"tab_3"},i={flame:"tab_0",water:"tab_1",wind:"tab_2",thunder:"tab_3",darkness:"tab_4",light:"tab_5",all:"tab_6"},a=__assign({},n,i),o=function(){function e(e){this.onTabChange=e}return e.prototype.render=function(e,t){var n=this,i=this.findRootNode(e);if(null!=i){i.setVisible(!0),this.forEachTab(e,function(t,i){n.deselectTab(t),t.setSound(kh.SoundList.BUTTON_TOUCHED_SWITCH),n.addEventListener(t,function(){return n.onClickTab(t,e,i)})});var a=this.findTab(e,t);null!=a&&this.selectTab(a)}},e.prototype.forEachTab=function(e,t){if("material"===e||"elemental"===e||"accessory"===e){var a=this.findRootNode(e),o="material"===e?n:i;_.map(o,function(e,n){if(null!==a){var i=a.seekWidgetByName(e);null!==i&&t(i,n)}})}},e.prototype.onClickTab=function(e,t,n){var i=this;this.forEachTab(t,function(e){return i.deselectTab(e)}),this.selectTab(e),this.onTabChange(t,n)},e.prototype.selectTab=function(e){e.setBright(!1),e.setEnabled(!1)},e.prototype.deselectTab=function(e){e.setBright(!0),e.setEnabled(!0)},e.prototype.findRootNode=function(e){var n=cc.director.getRunningScene(),i=t[e];return void 0===i?null:n.seekWidgetByName(i)},e.prototype.findTab=function(e,t){var n=this.findRootNode(e);if(null===n)return null;var i=a[t];return void 0===i?null:n.seekWidgetByName(i)},e.prototype.addEventListener=function(e,t){e.addTouchEventListener(function(e,n){n==ccui.Widget.TOUCH_ENDED&&t()})},e}();e.QuestSpecialTabs=o}(QuestSpecial||(QuestSpecial={}));__extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();!function(e){var t={data:[],max_record_count:0},n=function(){function e(e){this.id=e}return e.prototype.equal=function(e){return e.id===this.id},e}();e.QuestListCollectionId=n;var i=function(n){function i(t,i){var a=this;return Object.freeze(i),(a=n.call(this,t,i)||this).rawData=i,a.selectedTab=null,a.visibleQuestListController=null,a.questSpecialTabs=new e.QuestSpecialTabs(a.onTabChange.bind(a)),a.questSpecialHeader=new e.QuestSpecialHeader(t.id),a.questSpecialNaviChara=new e.QuestSpecialNaviChara(t.id),a.sceneDelegate=null,a}return __extends(i,n),i.prototype.makePurgeRule=function(){return new PurgeRule(2,1)},i.prototype.get=function(){return _.cloneDeep(this.getPlainBody())},i.prototype.getDefaultTab=function(){return e.isMaterialQuestListCollection(this.rawData)?"gem":"flame"},i.prototype.render=function(e,t,n){this.sceneDelegate=t,this.questSpecialHeader.render(e),this.questSpecialNaviChara.render(e);var i=this.getQuestCategory();this.renderTab(i,n)},i.prototype.validateQuest=function(e,t){null!=this.visibleQuestListController&&this.visibleQuestListController.onTouchQuestPanel(e,t)},i.prototype.startQuest=function(e,t,n){kh.createInstance("router").navigate("quest/q_002",{q_002:{target:"quest",quest_id:e.quest_id,quest_type:e.type,quest_category:this.getQuestCategory(),quest_sub_category:this.getQuestSubCategory(),owner_account_id:e.owner_account_id,episode_num:t,recommended_element_type:n,returnQuestRoute:"quest/q_special_top"}})},i.prototype.cleanUp=function(){this.sceneDelegate=null,this.setOldFlag()},i.prototype.renderTab=function(e,t){if(null!==this.sceneDelegate){this.hasTabs()&&this.questSpecialTabs.render(e,t),this.selectedTab=t;var n=this.getQuestSubCategory();if(null!==n){var i=this.getQuestListController(n,this.sceneDelegate);this.visibleQuestListController=i,i.showQuestList()}}},i.prototype.onTabChange=function(e,t){this.renderTab(e,t)},i.prototype.getQuestListController=function(e,n){var i,a=kh.createInstance("QuestListController",[n,"window_gray"]),o=this.getQuestListData();return i=e in o?o[e]:_.cloneDeep(t),a.setData(kh.createInstance("QuestListModel",[i])),a},i.prototype.getQuestListData=function(){return e.isMaterialQuestListCollection(this.rawData)?this.rawData.material_quest_list:e.isElementQuestListCollection(this.rawData)?this.rawData.elemental_quest_list:this.rawData.accessory_quest_list},i.prototype.getQuestCategory=function(){return e.isMaterialQuestListCollection(this.rawData)?"material":e.isElementQuestListCollection(this.rawData)?"elemental":"accessory"},i.prototype.verify=function(t,n,i){if(this.getQuestCategory()!==t)return!1;if(e.isMaterialQuestListCollection(this.rawData))return!0;var a=this.getQuestListData()[n];return void 0!==a&&_.some(a.data,function(e){return e.quest_id===i})},i.prototype.getQuestSubCategory=function(){if(this.hasTabs()&&null!==this.selectedTab)return this.selectedTab;var e=this.getQuestListData();return _.reduce(e,function(e,t,n){return void 0===t?e:t.data.length>0?n:e},null)},i.prototype.hasTabs=function(){if(e.isMaterialQuestListCollection(this.rawData))return!0;var t=this.getQuestListData();return _.filter(t,function(e){return void 0!==e&&e.data.length>0}).length>1},i}(BaseEntity);e.QuestListCollection=i}(QuestSpecial||(QuestSpecial={}));var QuestPortal;__extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),__awaiter=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(a,o){function r(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?a(e.value):new n(function(t){t(e.value)}).then(r,s)}c((i=i.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(a)throw new TypeError("Generator is already executing.");for(;c;)try{if(a=1,o&&(r=2&n[0]?o.return:n[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,n[1])).done)return r;switch(o=0,r&&(n=[2&n[0],r.value]),n[0]){case 0:case 1:r=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!(r=(r=c.trys).length>0&&r[r.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!r||n[1]>r[0]&&n[1]<r[3])){c.label=n[1];break}if(6===n[0]&&c.label<r[1]){c.label=r[1],r=n;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(n);break}r[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],o=0}finally{a=r=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var a,o,r,s,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};kh.createNameSpaceIfNotExists("quest.repository"),function(e){var t={get:function(e,t){return kh.createInstance("apiAQuestPortal").get()}},n=function(n){function i(){return n.call(this,new OnMemoryCache,t)||this}return __extends(i,n),i.prototype.make=function(t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,new e.QuestPortal(n.body)]})})},i.prototype.getQuestPortal=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.get(e.questPortalId)];case 1:return[2,t.sent()]}})})},i.prototype.unlockQuestCategories=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,kh.createInstance("apiAQuestPortal").putUnlock(e)];case 1:return t.sent(),[2]}})})},i}(BaseRepository);e.QuestPortalRepository=n}(QuestPortal||(QuestPortal={})),kh.quest.repository.QuestPortal=QuestPortal.QuestPortalRepository;var QuestSpecial;__extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),__awaiter=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(a,o){function r(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?a(e.value):new n(function(t){t(e.value)}).then(r,s)}c((i=i.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(a)throw new TypeError("Generator is already executing.");for(;c;)try{if(a=1,o&&(r=2&n[0]?o.return:n[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,n[1])).done)return r;switch(o=0,r&&(n=[2&n[0],r.value]),n[0]){case 0:case 1:r=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!(r=(r=c.trys).length>0&&r[r.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!r||n[1]>r[0]&&n[1]<r[3])){c.label=n[1];break}if(6===n[0]&&c.label<r[1]){c.label=r[1],r=n;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(n);break}r[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],o=0}finally{a=r=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var a,o,r,s,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};kh.createNameSpaceIfNotExists("quest.repository"),function(e){var t={get:function(e,t){return kh.createInstance("apiAQuests").getQuestListByCategory(e.id)}},n=function(n){function i(e){return n.call(this,new OnMemoryCache,t)||this}return __extends(i,n),i.prototype.make=function(t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return[2,new e.QuestListCollection(t,n.body)]})})},i.prototype.getQuestListCollection=function(t){return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(i){switch(i.label){case 0:return n=new e.QuestListCollectionId(t),[4,this.get(n)];case 1:return[2,i.sent()]}})})},i}(BaseRepository);e.QuestListCollectionRepository=n}(QuestSpecial||(QuestSpecial={})),kh.quest.repository.QuestListCollectionRepository=QuestSpecial.QuestListCollectionRepository,function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.quest=t.pc.quest||{},t.pc.quest.q_portal_top=t.pc.quest.q_portal_top||{},t.pc.quest.q_portal_top.Scene=t.BaseScene.extend({resourceFileName:"q_portal_top/q_portal_top.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"quest",sceneName:"q_portal_top",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_event","btnCallbackBtnEvent",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"event/ev_000")),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.Q;t.pc=t.pc||{},t.pc.quest=t.pc.quest||{},t.pc.quest.q_portal_top=t.pc.quest.q_portal_top||{},t.pc.quest.q_portal_top.SceneDelegate=t.pc.BaseSceneDelegate.extend({_popups:{com_caution_2:{factoryName:"popupFactoryBlue",title:"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){this.dismiss()}}},com_caution_wait_update:{factoryName:"popupFactoryBlue",title:"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){this.dismiss()}}},com_caution_progress_locked:{factoryName:"popupFactoryBlue",title:"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){this.dismiss()}}}},onSceneInit:function(e){var i=t.createInstance("questPortalRepository");this._setBackBtn(e);var a=t.createInstance("RaidButtonController");return n.all([i.getQuestPortal(),t.createInstance("aQuestInfo").getRaid(),t.quest.entity.QuestPortal.renderDefaultState(e)]).spread(function(t,i){return n(t.render(e,a)).then(function(){var t=e.routerParams;t.routing_quest_type="q_portal_top",a.setData(i),a.setRouterParams(t),a.show()}),n.resolve()}).fail(console.error)},onSceneEnter:function(e){return n.resolve()},onSceneExit:function(e){return n.resolve()},_touchEndedBackBtnProcess:function(e){t.createInstance("router").navigate("mypage/my_001")}})}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.quest=t.pc.quest||{},t.pc.quest.q_001=t.pc.quest.q_001||{},t.pc.quest.q_001.Scene=t.BaseScene.extend({resourceFileName:"q_001/q_001.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[{tab1:{node:"btn_main_quest","content-node":"main_quest_node"},tab2:{node:"btn_free_quest","content-node":"free_quest_node"}}],componentName:"quest",sceneName:"q_001",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_map","btnCallbackBtnMap",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"quest/q_005")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"questbanner_event","btnCallbackQuestbannerEvent",null,function(){alert("{{}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc=t.pc||{},t.pc.quest=t.pc.quest||{},t.pc.quest.q_001=t.pc.quest.q_001||{},t.pc.quest.q_001.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../q_popup_ui.json"],_popups:{comBackCheck:{factoryName:"popupFactoryComBackCheck"},comApRestart:{factoryName:"popupFactoryComApRestart"},q_001_ap_next:{factoryName:"popupFactoryPopupCommon",resourceName:"core-popup-q_001_ap_next",title:"",buttonLabels:{blueBtn:"OK",blackBtn:""},buttons:{blueBtn:function(e){this.dismiss(),e._delegate.startCheckQuestState(e,this._selectQuestData)},blackBtn:function(e){this.dismiss()}}},q_001_ap_open:{factoryName:"popupFactoryBlue",title:""+t.w("release")+"!",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){this.dismiss()}}},q_newworld:{factoryName:"popupFactoryBlue",title:""+t.w("release")+"!",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){this.dismiss(),t.createInstance("router").navigate("quest/q_005")}}},q_quest_stop:{factoryName:"popupFactoryBlue",title:"",content:"<br />",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){this.dismiss()}}}},questCommonDelegate:new t.QuestScenePcCommonDelegate,onSceneInit:function(e){this._cleanUpPaymentId(),this._setBackBtn(e);var n=[];n.push(t.createInstance("apiAQuestInfo").get().then(function(t){this._apiAQuestInfo_get(e,t.body)}.bind(this))),n.push(this._fillupQuestMainList(e,"main","_touchQuestPanel").then(function(e){this._mainQuestList=i.filter(e.data,function(e){return"main"===e.type})}.bind(this))),n.push(this._fillupQuestMainList(e,"free","_touchQuestPanel").then(function(e){this._freeQuestList=i.filter(e.data,function(e){return"free"===e.type})}.bind(this)));var o=t.createInstance("apiABanners").getQuestBanners().then(function(t){this._updateEventBanner(e,t.body)}.bind(this));return n.push(o),a.all(n).then(this._onDataRetrieved.bind(this,e)).fail(function(e){console.error(e)})},_onDataRetrieved:function(e){e===n.director.getRunningScene()&&(this.questCommonDelegate.owner=e,this.questCommonDelegate.setAreaAnimation(this._mainQuestList,this._questInfo),this.questCommonDelegate.setMainMoveNextIcon(this._questInfo,this._tmpWidgetRecords),this.questCommonDelegate.setMainNewLabel(this._mainQuestList),this.questCommonDelegate.setFreeNewLabel(this._freeQuestList),this.questCommonDelegate.setMainMoveNextIcon(this._questInfo,this._tmpWidgetRecords),this.questCommonDelegate.checkComApRestartPopup(this._questInfo),e.tabDelegateList[0].selectTab(e.seekWidgetByName("btn_main_quest")))},onSceneEnter:function(e){var n=t.createInstance("apiAPlayers"),i=t.createInstance("myselfInfoRepository");return t.tutorial.startTutorialIfNeed(e).fail(function(){}).then(function(){return a.all([i.getQuestPoints(),i.getMe(),n.getGameConfig()]).spread(function(e,t,n){this._questPoints=e.getAsObject(),this._player=t.body,this.gameConfig=n.body.game_config}.bind(this)).fail(function(e){console.error(e)})}.bind(this))},onSceneExit:function(e){return a.defer(),this.questCommonDelegate.onExit(),this._needApBpPopupFactory&&(this._needApBpPopupFactory.cleanup(),this._needApBpPopupFactory=null),a.resolve()},btnCallbackBtnMap:function(e){var t=a.defer();return t.resolve(),t.promise},btnCallbackQuestbannerEvent:function(e){var t=a.defer();return t.reject(this._override),t.promise},_updateEventBanner:function(e,n){if(!(n.data.length<=0)){var a=n.data[0];e.seekWidgetByName("banner_btn_panel").setVisible(!0);var o=t.Img("eventimg","banner",i.padZero(a.banner_id,4)).png,r=e.seekWidgetByName("questbanner_event");r.loadTextures(o,o,o),r.addTouchEventListener(function(e,n){if(n===ccui.Widget.TOUCH_ENDED){var o=a.navigate_page,r={};r[i.last(o.split("/"))]={event_id:a.event_id},t.createInstance("router").navigate(o,r,{event_id:a.event_id})}}.bind(this))}},_apiAQuestInfo_get:function(e,n){this._questInfo=n;var a=t.Img("questtop","area",i.padZero(n.current_area_id,4),0);e.seekWidgetByName("questtop_area").loadTexture(a.jpg)},_touchQuestPanel:function(e,t){var i=n.director.getRunningScene();this.questCommonDelegate.restartCheckInProgressQuest(t,this._questInfo)||this.startCheckQuestState(i,t)},startQuest:function(e,t,n,i){"raid"===this._selectQuest.type?this._navigate001To009(e,t,i):this._navigateTo002(e,t,n,i)},update:function(){t.createInstance("sceneManager").reloadScene()},clearOwnQuest:function(){delete this._questInfo.in_progress.own_quest},_touchEndedBackBtnProcess:function(e){t.createInstance("router").navigate("quest/q_portal_top")}}),i.assign(t.pc.quest.q_001.SceneDelegate.prototype._popups,t.pc.quest.roles.QuestSelectCommon.popups._popups,t.pc.quest.roles.QuestMainPageListPopups._popups),i.assign(t.pc.quest.q_001.SceneDelegate.prototype,t.pc.roles.UIUtility,t.pc.quest.roles.Routing,t.pc.quest.roles.QuestMainPageListController,t.pc.quest.roles.QuestSelectCommon.methods)}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.quest=t.pc.quest||{},t.pc.quest.q_002=t.pc.quest.q_002||{},t.pc.quest.q_002.Scene=t.BaseScene.extend({resourceFileName:"q_002/q_002.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[{tab1:{node:"tab_0","content-node":"tab_0_node"},tab2:{node:"tab_1","content-node":"tab_1_node"},tab3:{node:"tab_2","content-node":"tab_2_node"},tab4:{node:"tab_3","content-node":"tab_3_node"},tab5:{node:"tab_4","content-node":"tab_4_node"},tab6:{node:"tab_5","content-node":"tab_5_node"},tab7:{node:"tab_6","content-node":"tab_6_node"}}],componentName:"quest",sceneName:"q_002",_delegate:null,_init:function(){this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e._,i=e.Q;t.pc=t.pc||{},t.pc.quest=t.pc.quest||{},t.pc.quest.q_002=t.pc.quest.q_002||{},t.pc.quest.q_002.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../q_popup_ui.json"],_popups:{popupConfirmGoToParty001:{factoryName:"popupFactoryBlackBlue",title:"",content:"",buttonLabels:{blackBtn:"",blueBtn:"OK"},buttons:{blackBtn:function(e){this.dismiss()},blueBtn:function(e){this.dismiss()}}},popupConfirmAutoOrgWithElement:{factoryName:"popupFactoryBlackBlue",title:"",buttonLabels:{blackBtn:"",blueBtn:"OK"},buttons:{blackBtn:function(e){this.dismiss()},blueBtn:function(e){this.dismiss()}}},popupCaution:{factoryName:"popupFactoryBlue",title:"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){this.dismiss()}}},popupConfirm:{factoryName:"popupFactoryBlackBlue",title:"",buttonLabels:{blackBtn:"",blueBtn:""},buttons:{blackBtn:function(e){this.dismiss()},blueBtn:function(e){this.dismiss()}}}},onSceneInit:function(e){return this._verifyRouterParams002(e),this._setBackBtn(e),t.tutorial.startTutorialIfNeed(e).fail(function(){return!0}).then(function(){return this._initControllers(),i.all([t.createInstance("apiAQuests").getQuest(e.routerParams.q_002.quest_id,e.routerParams.q_002.quest_type,e.routerParams.q_002.owner_account_id),t.createInstance("myselfInfoRepository").getQuestPoints(),this._getAPartiesData(),this._showInitialSupporterList()])}.bind(this)).spread(function(t,i){this.questData=t.body,this.selectedEpisode=n.find(this.questData.episodes,function(t){return t.num===e.routerParams.q_002.episode_num}),this.selectedEpisode||(this._isLatestEpisode=!0,this.selectedEpisode=n.last(this.questData.episodes)),this.questPoints=i.getAsObject(),this._getSupporterSelectionController().hasSupporterSelected()&&this._showPartySelectPopup(e)}.bind(this)).fail(function(e){e&&console.error(e)})},onSceneEnter:function(e){e.enableRestore(!1),e.tabDelegateList.forEach(function(e){e.preventInitialization()})},_getAPartiesData:function(){return t.createInstance("apiAParties").getDecks().then(function(e){return this._aParties=e.body.decks,e}.bind(this)).fail(function(e){console.error(e)})},_touchSupportSummonPanel:function(e,t,n){this._getSupporterSelectionController().selectSupporter(t),this._showPartySelectPopup()},navigateToParty:function(e,t){this._getSupporterSelectionController().getSelectedSupporter().then(function(n){var i=n.getId(),a=n.getElementType(),o=this._getSelectedTabNumber(e);this._navigate002ToParty(e,t,i,a,o)}.bind(this))},_getSelectedTabNumber:function(e){var t=e.tabDelegateList[0].selected;return n.last(t.match(/\d/g))},tabCallbackTab0:function(e){this._onChangeTab(0)},tabCallbackTab1:function(e){this._onChangeTab(1)},tabCallbackTab2:function(e){this._onChangeTab(2)},tabCallbackTab3:function(e){this._onChangeTab(3)},tabCallbackTab4:function(e){this._onChangeTab(4)},tabCallbackTab5:function(e){this._onChangeTab(5)},tabCallbackTab6:function(e){this._onChangeTab(8)},btnCallbackBtnBack:function(e){return this._touchEndedBackBtnProcess(e),i.reject(this._override)},_onChangeTab:function(e){var t=e;this._getSupporterListController().showSupporterListByElementType(t)},_initControllers:function(){var e=t.createInstance("SupporterListsModel");this._initSupporterListController(e),this._initSupporterSelectionController(e)},_initSupporterSelectionController:function(e){this._supporterSelectionController=t.createInstance("SupporterSelectionController",[e])},_initSupporterListController:function(e){this._supporterListController=t.createInstance("SupporterListController",[e])},_getSupporterSelectionController:function(){return this._supporterSelectionController},_getSupporterListController:function(){return this._supporterListController},_showInitialSupporterList:function(){var e=this._getSupporterListController();return this._getSupporterSelectionController().getSelectedSupporter().then(e.showInitialSupporterList.bind(e))},_showPartySelectPopup:function(){var e=cc.director.getRunningScene();this._getSupporterSelectionController().getSelectedSupporter().then(function(n){var i=t.ImplantedPopup.createOrGet(e,"q_002_sup","SelectPartyPopup"),a=this.selectedEpisode.recommended_element_type;i.open(e,this._aParties,n.getRawSupporterData(),this.questData,this.questPoints,a,!1).fail(function(e){e&&console.error(e)})}.bind(this))},_touchEndedBackBtnProcess:function(e){this._navigateByQuestType(e.routerParams.q_002)}}),n.assign(t.pc.quest.q_002.SceneDelegate.prototype,t.pc.roles.UIUtility,t.pc.quest.roles.Routing,t.pc.quest.roles.QuestSupportPageListController,t.pc.quest.roles.QuestStart)}((this||0).self||global),function(e){var t=e.kh,n=e.ccui,i=(e.res,e.console);e.khutil;e.khutil;t.q_003_1=t.q_003_1||{},t.q_003_1.Properties={className:"KH_Q_003_1_Scene",GAUGE_ANIMATION_PERCENT_PER_SEC:50,WIDGET_NAMES:{RANK_NUM:"q_003_1_result_rank_no",RANK_GAUGE:"q_003_1_result_rank_gauge",RANK_UP:"q_003_1_result_rank_up",JOB_LVL_NUM:"q_003_1_result_job_level_no",JOB_LVL_GAUGE:"q_003_1_result_job_level_gauge",JOB_LVL_MASTER:"q_003_1_result_level_master",JOB_LVL_UP:"q_003_1_result_level_up",JOB_CARD:"corecard_job_ui",CHARACTER_CARDS:{COUNT:5,NAME:"q_003_1_chara_"},CORECARD_JOB:"corecard_job_ui",CORECARD_CHARACTER:"corecard_chara_ui",RANK_POINT_GAINED:"q_003_1_result_rank_point_no",EXP_GAINED:"q_003_1_result_exp_no",NEXT_BUTTON:"q_003_1_next",MONSTERS_SLAIN_REWARD:"q_003_1_result_gem_monster_no",CONVERT_REWARD:"q_003_1_result_gem_convert_no",TOTAL_REWARD:"q_003_1_result_gem_sum_no"},CHARACTER_CARD_WIDGET_NAMES:{TEXTURE:"q_003_1_chara_img",ENJOYMENT_BASE:"q_003_1_chara_enjoyment_base",ENJOYMENT:"q_003_1_chara_enjoyment_label",LVL_NUM:"q_003_1_chara_level_no",LVL_GAUGE:"q_003_1_chara_level_gauge",LVL_UP:"q_003_1_chara_level_up"},SOUND_EFFECT_IDS:{LEVEL_UP:1},resourceName:"quest-q_003-q_003_1",footerDelegate:new t.FooterDelegate},t.q_003_1.Popups={_popups:{raidMvp:{factoryName:"popupRaidMvp",buttons:{blueBtn:function(e){this.dismiss().then(e._popupDefer.resolve)}}},rankUp:{factoryName:"popupRankUp",buttons:{blueBtn:function(e){this.dismiss().then(e._popupDefer.resolve)}}},jobAbilityAcquired:{factoryName:"popupJobAbilityAcquired",buttons:{blueBtn:function(e){this.dismiss().then(e._popupDefer.resolve)}}},jobMaxBonus:{factoryName:"popupJobMaxBonus",buttons:{blueBtn:function(e){this.dismiss().then(e._popupDefer.resolve)}}},characterAbilityAcquired:{factoryName:"popupCharacterAbilityAcquired",buttons:{blueBtn:function(e){this.dismiss().then(e._popupDefer.resolve)}}},characterAbilityImproved:{factoryName:"popupCharacterAbilityImproved",buttons:{blueBtn:function(e){this.dismiss().then(e._popupDefer.resolve)}}}}},t.q_003_1.Methods={_init:function(){this._initData(),this._start()},_hideBackButton:function(){this.mainMenuDelegate&&this.mainMenuDelegate.setBackButtonVisible(!1)},_initData:function(){null!=this.routerParams.a_battle_id&&null!=this.routerParams.quest_type||this._redirect("quest"),this._widgets={},this._clearValues(),this._battleResultDataPromise=this._getBattleResultData(this.routerParams.a_battle_id,this.routerParams.quest_type).then(this._verifyData.bind(this)),this._soundEffectsPromise=this._loadSound()},_start:function(){Q.all([this._battleResultDataPromise.then(this._setStartingData.bind(this)).then(this._showRaidMvpPopup.bind(this)).then(this._showTowerQuestResultPopup.bind(this)).then(this._showScoreAttackQuestResultPopup.bind(this)),this._soundEffectsPromise]).spread(this._animateGauges.bind(this)).then(this._showRewardPopups.bind(this)).then(this._showPopupIfSuddenQuestRewardExist.bind(this)).then(this._addNextButtonEventListener.bind(this,this._gotoQ0032.bind(this))).fail(function(e){i.error(e)})},getBattleId:function(){return this.routerParams.a_battle_id},_redirectOnFail:function(e){409!==e.status&&(function(e){}("goto error page"),i.error("html error: "+e.status)),"harem"===this.routerParams.quest_type?this._redirect("harem"):this._redirect("quest")},_getWidget:function(e){return null==this._widgets[e]&&(this._widgets[e]=this.seekWidgetByName(e)),this._widgets[e]},_getBattleResultData:function(e,n){if(t.gVal.quest=t.gVal.quest||{},t.gVal.quest.battleResultData){var i=t.gVal.quest.battleResultData;if(i.a_battle_id===e&&i.quest_type===n)return Q.resolve(i)}return t.createInstance("apiABattles").getBattleResult(e,n).fail(this._redirectOnFail.bind(this)).then(this._cacheData.bind(this))},_loadSound:function(){var e=Q.defer(),n=t.createInstance("seLoader");return this._seList={},n.loadLevelUpSe(this.SOUND_EFFECT_IDS.LEVEL_UP).then(function(e){this._seList.levelUp=e}.bind(this)).fail(function(e){i.error(e.stack||e)}).finally(function(){e.resolve()}),e.promise},_cacheData:function(e){var n=e.body;return n.a_battle_id=this.routerParams.a_battle_id,n.quest_type=this.routerParams.quest_type,t.gVal.quest.battleResultData=n,e.body},_verifyData:function(e){var t=0,n=e.gems_gained,i=e.points_gained,a=e.job,o=e.characters,r=e.player,s=e.raid_stats&&!_.isEmpty(e.raid_stats.mvp)?1:0,c=function(e){null!=e.level_data_before&&null!=e.level_data_after&&(t|=e.level_data_after.level-e.level_data_before.level||0,t|=e.level_data_after.gauge-e.level_data_before.gauge||0)};return null!=n&&(t|=n.monsters_slain||0,t|=n.prizes||0,t|=n.converts||0,t|=n.total||0),null!=i&&(t|=i.experience||0,t|=i.rank||0),null!=a&&c(a),null!=o&&_.each(o,c),null!=r&&null!=r.rank_data_before&&null!=r.rank_data_after&&(t|=r.rank_data_after.level-r.rank_data_before.level||0,t|=r.rank_data_after.gauge-r.rank_data_before.gauge||0),t|=s,t|=!_.isEmpty(e.scoreattack_result),(t|=!_.isEmpty(e.tower_quest_cleared))?e:(this._gotoQ0032(),e)},_setStartingData:function(e){this._setRankLevel(e.player.rank_data_before.level,e.player.rank_data_before.max),this._setRankLevelGauge(e.player.rank_data_before.gauge),this._gotMasterPoint(e)?(this._setJobLevel(e.master_point.before.level,e.master_point.before.max),this._setJobMasterPointGauge(e.master_point.before.gauge||0)):(this._setJobLevel(e.job.level_data_before.level,e.job.level_data_before.max),this._setJobLevelGauge(e.job.level_data_before.gauge)),this._showJobGaugeLabel(e);var n=this._createJobCorecardHandler(this.seekWidgetByName(this.WIDGET_NAMES.CORECARD_JOB));this._loadJobCardTexture(n,e.job.job_id,e.job.job_skin),this._setJobElement(n,e.job.element_type),_.each(e.characters,function(e,t){var n=this._getCharacterCardWidget(t);if(null!=n){var a=this._createCharacterCorecardHandler(n.seekWidgetByName(this.WIDGET_NAMES.CORECARD_CHARACTER));a.setAroused(e.is_aroused),this._loadCharacterCardTexture(a,e.character_id,e.character_skin),this._setCharacterBonus(a,e.bonus),this._setCharacterElement(a,e.element_type),this._setCharacterRarity(a,e.rare),this._setCharacterCardLevel(n,e.level_data_before.level,e.level_data_before.max),this._setCharacterCardLevelGauge(n,e.level_data_before.gauge),this._setCharacterCardEnjoyment(n,e.enjoyment),n.setVisible(!0)}else i.warn("q_003_1.Scene._setStartingData: character widget not found")},this);var a={};return t.env.isSp?(a[this.WIDGET_NAMES.RANK_POINT_GAINED]="RANK +"+e.points_gained.rank,a[this.WIDGET_NAMES.EXP_GAINED]="EXP +"+e.points_gained.experience):(a[this.WIDGET_NAMES.RANK_POINT_GAINED]="RANK\n+"+e.points_gained.rank,a[this.WIDGET_NAMES.EXP_GAINED]="EXP\n+"+e.points_gained.experience),a[this.WIDGET_NAMES.MONSTERS_SLAIN_REWARD]="+"+e.gems_gained.monsters_slain,a[this.WIDGET_NAMES.CONVERT_REWARD]="+"+e.gems_gained.converts,a[this.WIDGET_NAMES.TOTAL_REWARD]=" +"+e.gems_gained.total,this.setStrings(a),e},_gotMasterPoint:function(e){return!!e.master_point&&e.job.level_data_before.max&&e.master_point.after&&e.master_point.before},_clearValues:function(){this._getWidget(this.WIDGET_NAMES.JOB_CARD).setVisible(!1),this._setRankLevel("",!1),this._setRankLevelGauge(0),this._setJobLevel("",!1),this._setJobLevelGauge(0),this._setJobMasterPointGauge(0);var e={};e[this.WIDGET_NAMES.RANK_POINT_GAINED]="",e[this.WIDGET_NAMES.EXP_GAINED]="",e[this.WIDGET_NAMES.MONSTERS_SLAIN_REWARD]="",e[this.WIDGET_NAMES.CONVERT_REWARD]="",e[this.WIDGET_NAMES.TOTAL_REWARD]="",this.setStrings(e)},_showRaidMvpPopup:function(e){return null==e.raid_stats||null==e.raid_stats.mvp?e:this._showPopup(this.popups.raidMvp,e.raid_stats.mvp).then(function(){return e})},_showTowerQuestResultPopup:function(e){return e.tower_quest_cleared?t.ImplantedPopup.create(this,"tower_quest_result").open(e.tower_quest_cleared).fail(i.error).thenResolve(e):e},_showScoreAttackQuestResultPopup:function(e){if(_.isEmpty(e.scoreattack_result))return e;var n={data:e.scoreattack_result,shouldGoQuestTop:!1,eventId:null};return t.ImplantedPopup.create(this,"scoreattack_result").open(n).fail(i.error).thenResolve(e)},_showPopup:function(e,t){return this._popupDefer=Q.defer(),e.open().then(e.setData.bind(e,t)),this._popupDefer.promise},_showJobGaugeLabel:function(e){var t=this._gotMasterPoint(e);this._getWidget(this.WIDGET_NAMES.JOB_MASTER_POINT_LABEL).setVisible(t),this._getWidget(this.WIDGET_NAMES.JOB_LVL_LABEL).setVisible(!t)},_animateGauges:function(e){var t,n,a=function(e,t){return 100*(t.level-e.level)+t.gauge%100},o=_.compact(_.map(e.characters,function(e,t){var n=this._getCharacterCardWidget(t);return null==n?(i.warn("q_003_1.Scene._setStartingData: character widget not found"),null):this._animateCharacterCardLevelGauge(n,a(e.level_data_before,e.level_data_after))},this)),r=this._animateRankLevelGauge(a(e.player.rank_data_before,e.player.rank_data_after));return _(o).pluck("promise").each(function(t,n){t.then(this._showCharacterEndData.bind(this,n,e.characters[n]))},this),r.promise.then(this._showRankEndData.bind(this,e)),this._gotMasterPoint(e)?(t=this._animateJobMasterPointGauge(a(e.master_point.before,e.master_point.after)),n=this._showMasterPointEndData.bind(this,e.master_point)):(t=this._animateJobLevelGauge(a(e.job.level_data_before,e.job.level_data_after)),n=this._showJobEndData.bind(this,e.job)),t.promise.then(n),this._addNextButtonEventListener(function(){_.invoke(o,"interrupt"),r.interrupt(),t.interrupt()}),Q.all(_.pluck(o,"promise").concat([r.promise,t.promise])).then(function(){return e})},_showRankEndData:function(e){var t=e.player.rank_data_before,n=e.player.rank_data_after;this._setRankLevelGauge(n.gauge),this._setRankLevel(n.level,n.max),null!=t.level&&null!=n.level&&t.level!==n.level&&this._showRankUpLabel()},_showMasterPointEndData:function(e){this._setJobMasterPointGauge(e.after.gauge),this._setJobLevel(e.after.level,e.after.max)},_showJobEndData:function(e){var t=e.level_data_before,n=e.level_data_after;this._setJobLevelGauge(n.gauge),this._setJobLevel(n.level,n.max),null!=t.level&&null!=n.level&&t.level!==n.level&&(this._setJobLevelUpLabelVisible(!n.max),n.max&&this._showJobMasterLabel())},_showCharacterEndData:function(e,t){var n=t.level_data_before,i=t.level_data_after,a=this._getCharacterCardWidget(e);this._setCharacterCardLevelGauge(a,i.gauge),this._setCharacterCardLevel(a,i.level,i.max),null!=n.level&&null!=i.level&&n.level!==i.level&&this._showCharacterLevelUpLabel(a)},_showPopupIfSuddenQuestRewardExist:function(e){if(_.isEmpty(e.sudden_quest_appeared))return Q.resolve(e);var n=t.createInstance("popupFactoryRaQuestAppearance").create();return n.open().then(n.setData.bind(n,e.sudden_quest_appeared)).thenResolve(e)},_showRewardPopups:function(e){var t=[];return null!=e.rank_up&&t.push(this._showRankUpPopup.bind(this,e.rank_up,e.player.rank_data_before.level,e.player.rank_data_after.level)),null!=e.new_job_abilities_gained&&t.push(this._showJobAbilitiesAcquiredPopups.bind(this,e.new_job_abilities_gained,e.job.job_id)),null!=e.job_max_bonus&&t.push(this._showJobMaxBonusPopup.bind(this,e.job_max_bonus)),null!=e.new_character_abilities_gained&&t.push(this._showCharacterAbilityAcquiredPopups.bind(this,e.new_character_abilities_gained)),null!=e.character_ability_upgrades&&t.push(this._showCharacterAbilityImprovedPopups.bind(this,e.character_ability_upgrades)),t.push(function(){return e}),t.reduce(Q.when,Q())},_showRankUpPopup:function(e,t,n){return this._showPopup(this.popups.rankUp,{rankUpData:e,rankLevelBefore:t,rankLevelAfter:n})},_showJobAbilitiesAcquiredPopups:function(e,t){return _.map(e,function(e){return this._showPopup.bind(this,this.popups.jobAbilityAcquired,_.assign(e,{job_id:t}))},this).reduce(Q.when,Q())},_showJobMaxBonusPopup:function(e){return this._showPopup(this.popups.jobMaxBonus,e)},_showCharacterAbilityAcquiredPopups:function(e){return _.map(e,function(e){return this._showPopup.bind(this,this.popups.characterAbilityAcquired,e)},this).reduce(Q.when,Q())},_showCharacterAbilityImprovedPopups:function(e){return _.map(e,function(e){return this._showPopup.bind(this,this.popups.characterAbilityImproved,e)},this).reduce(Q.when,Q())},_createJobCorecardHandler:function(e){return e.setVisible(!0),t.createInstance("CoreCardJobUI",["e",e])},_loadJobCardTexture:function(e,t,n){e.setImg(t,n||0)},_setJobElement:function(e,t){return null==t?void i.warn("q_003_1.Scene._setJobElement: element data not found"):void e.setIconElement(t)},_setRankLevel:function(e,t){this._getWidget(this.WIDGET_NAMES.RANK_NUM).string=t?e+"(MAX)":e},_increaseRankLevel:function(){var e=this._getWidget(this.WIDGET_NAMES.RANK_NUM);e.string=parseInt(e.string)+1},_setRankLevelGauge:function(e){this._getWidget(this.WIDGET_NAMES.RANK_GAUGE).percent=e},_animateRankLevelGauge:function(e){if(0===e)return{interrupt:function(){},promise:Q.resolve()};var t=Q.defer(),n=this._getWidget(this.WIDGET_NAMES.RANK_GAUGE).animateRecursive(e,this.GAUGE_ANIMATION_PERCENT_PER_SEC,function(n){n===Math.ceil(e/100)-1&&e%100!=0||(this._increaseRankLevel(),this._showRankUpLabel(),this._playLevelUpSound()),n===Math.ceil(e/100)-1&&t.resolve()},this);return{interrupt:function(){n(),t.resolve()},promise:t.promise}},_showRankUpLabel:function(){this._playFlashAnimation(this._getWidget(this.WIDGET_NAMES.RANK_UP))},_setJobLevel:function(e,t){this._getWidget(this.WIDGET_NAMES.JOB_LVL_NUM).string=t?e+"(MAX)":e},_increaseJobLevel:function(){var e=this._getWidget(this.WIDGET_NAMES.JOB_LVL_NUM);e.string=parseInt(e.string)+1},_setJobLevelGauge:function(e){this._getWidget(this.WIDGET_NAMES.JOB_LVL_GAUGE).percent=e},_setJobMasterPointGauge:function(e){this._getWidget(this.WIDGET_NAMES.JOB_MASTER_POINT_GAUGE).percent=e},_gaugeAnimationCallback:function(e,t,n,i){i===Math.ceil(t/100)-1&&t%100!=0||(this._setJobMasterPointGetLabelVisible(!n),this._setJobLevelUpLabelVisible(n),this._playLevelUpSound(),this._increaseJobLevel()),i===Math.ceil(t/100)-1&&e.resolve()},_animateJobLevelGauge:function(e){if(0===e)return{interrupt:function(){},promise:Q.resolve()};var t=Q.defer(),n=this._gaugeAnimationCallback.bind(this,t,e,!0),i=this._getWidget(this.WIDGET_NAMES.JOB_LVL_GAUGE);i.setVisible(!0);var a=i.animateRecursive(e,this.GAUGE_ANIMATION_PERCENT_PER_SEC,n,this);return{interrupt:function(){a(),t.resolve()},promise:t.promise}},_animateJobMasterPointGauge:function(e){if(0===e)return{interrupt:function(){},promise:Q.resolve()};var t=Q.defer(),n=this._gaugeAnimationCallback.bind(this,t,e,!1),i=this._getWidget(this.WIDGET_NAMES.JOB_MASTER_POINT_GAUGE);i.setVisible(!0);var a=i.animateRecursive(e,this.GAUGE_ANIMATION_PERCENT_PER_SEC,n,this);return{interrupt:function(){a(),t.resolve()},promise:t.promise}},_showJobMasterLabel:function(){this._playFlashAnimation(this._getWidget(this.WIDGET_NAMES.JOB_LVL_MASTER))},_setJobLevelUpLabelVisible:function(e){var t=this._getWidget(this.WIDGET_NAMES.JOB_LVL_UP);e?this._playFlashAnimation(t):t.stopAllActions(),t.setVisible(e)},_setJobMasterPointGetLabelVisible:function(e){var t=this._getWidget(this.WIDGET_NAMES.JOB_MASTER_POINT_GET);e?this._playFlashAnimation(t):t.stopAllActions(),t.setVisible(e)},_getCharacterCardWidget:function(e){return this._getWidget(this.WIDGET_NAMES.CHARACTER_CARDS.NAME+e)},_createCharacterCorecardHandler:function(e){return e.setVisible(!0),t.createInstance("CoreCardCharacterUI",["e_r",e])},_loadCharacterCardTexture:function(e,t,n){e.setImg(t,n||0)},_setCharacterElement:function(e,t){return null==t?void i.warn("q_003_1.Scene._setCharacterElement: element data not found"):void e.setIconElement(t)},_setCharacterRarity:function(e,t){return null==t?void i.warn("q_003_1.Scene._setCharacterRarity: rarity data not found"):void e.setIconRarity(t)},_setCharacterBonus:function(e,t){e.setPlusNo(t?"+"+t:""),e.setPlusNoVisible(!!t)},_setCharacterCardEnjoyment:function(e,t){return _.isUndefined(t)||_.isNull(t)?void e.seekWidgetByName(this.CHARACTER_CARD_WIDGET_NAMES.ENJOYMENT_BASE).setVisible(!1):void(e.seekWidgetByName(this.CHARACTER_CARD_WIDGET_NAMES.ENJOYMENT).string=t)},_setCharacterCardLevel:function(e,t,n){e.seekWidgetByName(this.CHARACTER_CARD_WIDGET_NAMES.LVL_NUM).string=n?t+"(MAX)":t},_increaseCharacterLevel:function(e){var t=e.seekWidgetByName(this.CHARACTER_CARD_WIDGET_NAMES.LVL_NUM);t.string=parseInt(t.string)+1},_setCharacterCardLevelGauge:function(e,t){e.seekWidgetByName(this.CHARACTER_CARD_WIDGET_NAMES.LVL_GAUGE).percent=t},_animateCharacterCardLevelGauge:function(e,t){if(0===t)return{interrupt:function(){},promise:Q.resolve()};var n=Q.defer(),i=e.seekWidgetByName(this.CHARACTER_CARD_WIDGET_NAMES.LVL_GAUGE).animateRecursive(t,this.GAUGE_ANIMATION_PERCENT_PER_SEC,function(i){i===Math.ceil(t/100)-1&&t%100!=0||(this._increaseCharacterLevel(e),this._showCharacterLevelUpLabel(e),this._playLevelUpSound()),i===Math.ceil(t/100)-1&&n.resolve()},this);return{interrupt:function(){i(),n.resolve()},promise:n.promise}},_showCharacterLevelUpLabel:function(e){this._playFlashAnimation(e.seekWidgetByName(this.CHARACTER_CARD_WIDGET_NAMES.LVL_UP))},_playLevelUpSound:function(){return this._seList.levelUp&&""!==this._seList.levelUp?void this._playSound(this._seList.levelUp):void(t.createInstance("playerGameConfig").isSeOn()&&this._loadSound().then(function(){this._playSound(this._seList.levelUp)}.bind(this)))},_playSound:function(e){null!=e&&""!==e&&(new t.SE).play(e)},_createLevelUpFlashAnimation:function(e){var n=t.createInstance("frameAnimationHelper");return n.createAction(30,[n.createAlphaTimeline([{fi:0,alpha:75},{fi:6,alpha:255},{fi:20,alpha:255},{fi:30,alpha:75}])],e)},_playFlashAnimation:function(e){if(null!=e&&!e.actionManager.numberOfRunningActionsInTarget(e)){this._centerWidget(e);var t=this._createLevelUpFlashAnimation(e);e.setVisible(!0),e.runAction(t),t.gotoFrameAndPlay(0,!0)}},_centerWidget:function(e){var t=e.anchorX,n=e.anchorY,i=e.width,a=e.height;.5!==t&&(e.x=e.x-i*t+i/2,e.anchorX=.5),.5!==n&&(e.y=e.y-a*n+a/2,e.anchorY=.5)},_addNextButtonEventListener:function(e,t){this._getWidget(this.WIDGET_NAMES.NEXT_BUTTON).addTouchEventListener(function(t,i){i===n.Widget.TOUCH_ENDED&&e&&e.call(this)},t)},_redirect:function(e,n){t.createInstance("router").navigate(e,n)},_gotoQ0032:function(){var e={};e.a_battle_id=this.routerParams.a_battle_id,e.quest_type=this.routerParams.quest_type,this._redirect("quest/q_003_2",e)}},t.q_003_1.Scene=t.BaseScene.extend(_.assign(t.q_003_1.Popups,t.q_003_1.Properties,t.q_003_1.Methods))}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.quest=t.pc.quest||{},t.pc.quest.q_003_001=t.pc.quest.q_003_001||{},t.pc.quest.q_003_001.Scene=t.BaseScene.extend({resourceFileName:"q_003/q_003_1.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"quest",sceneName:"q_003_001",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_next","btnCallbackBtnNext",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"quest/q_003_2")),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._),i=e.Q;t.pc=t.pc||{},t.pc.quest=t.pc.quest||{},t.pc.quest.q_003_001=t.pc.quest.q_003_001||{},t.pc.quest.q_003_001.Properties=n.assign(t.q_003_1.Properties,{WIDGET_NAMES:{RANK_NUM:"rank_no_label",RANK_GAUGE:"rank_gauge",RANK_UP:"labelicon_rankup",JOB_LVL_LABEL:"job_level_label",JOB_LVL_NUM:"job_level_no_label",JOB_LVL_GAUGE:"job_level_gauge",JOB_LVL_MASTER:"labelicon_master",JOB_LVL_UP:"labelicon_levelup",JOB_MASTER_POINT_LABEL:"master_point_label",JOB_MASTER_POINT_GAUGE:"master_point_gauge",JOB_MASTER_POINT_GET:"labelicon_pointget",JOB_CARD:"corecard_job_ui",CHARACTER_CARDS:{COUNT:6,NAME:"q_003_1_chara_ui_"},CORECARD_JOB:"corecard_job_ui",CORECARD_CHARACTER:"corecard_chara_ui",RANK_POINT_GAINED:"get_rank_label",EXP_GAINED:"get_exp_label",NEXT_BUTTON:"btn_next",MONSTERS_SLAIN_REWARD:"gem_monster_no_label",CONVERT_REWARD:"gem_convert_no_label",TOTAL_REWARD:"gem_sum_no_label"},CHARACTER_CARD_WIDGET_NAMES:{TEXTURE:"q_003_1_chara_img",ENJOYMENT_BASE:"enjoyment_base",ENJOYMENT:"enjoyment_label",LVL_NUM:"level_no_label",LVL_GAUGE:"level_gauge",LVL_UP:"labelicon_levelup"}}),t.pc.quest.q_003_001.Methods=n.assign(t.q_003_1.Methods,{_navigate003_001To003_002:t.pc.quest.roles.Routing._navigate003_001To003_002,_gotoQ0032:function(){var e={};e.a_battle_id=this.routerParams.a_battle_id,e.quest_type=this.routerParams.quest_type,e.is_own_raid=this.routerParams.is_own_raid,e.quest_id=this.routerParams.quest_id,e.quest_category=this.routerParams.quest_category,e.quest_sub_category=this.routerParams.quest_sub_category,this._navigate003_001To003_002(this,e)}}),t.pc.quest.q_003_001.SceneDelegate=t.pc.BaseSceneDelegate.extend(n.assign(t.q_003_1.Popups,{_delayNodes:["../q_popup_ui.json"],onSceneInit:function(e){return e._hideBackButton(),i.resolve()},onSceneEnter:function(e){var i=n.assign(t.pc.quest.q_003_001.Properties,t.q_003_1.Methods);return n.assign(e,i,function(e,t){return e||t},e),t.createInstance("aQuestInfo").dispose(),t.createInstance("myselfInfoRepository").allCacheClear(),this._startPromise=t.tutorial.startTutorialIfNeed(e).fail(this._verifyRouterParams003_001.bind(this,e)).then(function(){e._initData()}),this._startPromise},onPageInAnimationEnd:function(e){return this._startPromise.then(e._start.bind(e)).then(function(){return this._startPromise=null,!0}.bind(this))},onSceneExit:function(e){return i.defer(),i.resolve()},btnCallbackBtnNext:function(e){var t=i.defer();return t.reject(this._override),t.promise}})),n.assign(t.pc.quest.q_003_001.SceneDelegate.prototype,t.pc.quest.roles.Routing)}((this||0).self||global),function(e){var t=e.kh,n=e.ccui,i=e.console;t.q_003_2=t.q_003_2||{},t.q_003_2.Properties={className:"KH_Q_003_2_Scene",PAGE_VIEW_BASE:"page_q_003_2_prize_list",PAGE_VIEW_CONTROLS:_.invert({q_003_2_change_page_right:t.PAGE_CONTROLLER_CONTROLS.NEXT_BUTTON,q_003_2_change_page_left:t.PAGE_CONTROLLER_CONTROLS.PREVIOUS_BUTTON}),PAGE_VIEW_ITEMS_PER_PAGE:16,PAGE_VIEW_DIRECTION:n.ScrollView.DIR_HORIZONTAL,SUBPAGE_WIDGET:"corecard_blank_4_4_ui",SUBPAGE_WIDGET_NAMES:{RECORD_BASE:{COUNT:16,NAME:"list_blank_"}},CORECARD_WIDGET:"corecard_ui",NO_PRIZE_WIDGET:"q_003_2_no_prize_label",TO_TOP_BUTTON:"q_003_2_quest_top",BUTTON_TEXT:[["main",""],["free",""],["harem",""],["daily",""],["guerrilla",""],["accessory",""],["event_limited_quest",""],["event_main",""],["event_raid","",""],["event_union_lilim_raid","",""],["event_union_throne_raid","",""],["event_union_demon_raid",""],["event_union_seraph_raid",""],["event_union_raid_end",""],["event_quest_main",""],["event_conex",""],["tower_event",""],["event",""],["raid","",""],["mission",""],[t.quest.QUEST_TYPE.SCOREATTACK_QUEST,""],[t.quest.QUEST_TYPE.EPIC_QUEST,""],[t.quest.QUEST_TYPE.EPIC_SCENARIO_QUEST,""],["tutorial",""]],DEFAULT_BUTTON_TEXT:"",QUEST_TYPE_SEARCH_REGEXP_INDEX:0,COMMON_TEXT_INDEX:1,IS_RESCUE_RAID_TEXT_INDEX:2,resourceName:"quest-q_003-q_003_2",footerDelegate:new t.FooterDelegate},t.q_003_2.Popups={_popups:{newItemAcquired:{factoryName:"popupNewItemAcquired",buttons:{blueBtn:function(e){this.dismiss().then(e._popupDefer.resolve)}}},characterAcquired:{factoryName:"popupCharacterAcquired",buttons:{blueBtn:function(e){this.dismiss().then(e._popupDefer.resolve)}}},characterAbilityAcquired:{factoryName:"popupCharacterAbilityAcquired",buttons:{blueBtn:function(e){this.dismiss().then(e._popupDefer.resolve)}}},questClearBonusItemsAcquired:{factoryName:"popupQuestClearBonusItemsAcquired",buttons:{blueBtn:function(e){this.dismiss().then(e._popupDefer.resolve)}}},friendRequest:{factoryName:"popupFriendRequest",buttons:{blueBtn:function(e){var t;e._makeFriendRequest().then(function(e){t=e}).then(this.dismiss.bind(this)).then(function(){t=t||{error:"default"},e._popupDefer.resolve(t)})},blackBtn:function(e){this.dismiss().then(e._popupDefer.resolve.bind(e,!1))}}},friendRequestResult:{factoryName:"popupFactoryTextOnly",title:"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){this.dismiss().then(e._popupDefer.resolve)}}},sh_summon_info:{factoryName:"popupFactoryShSummonInfo"},sh_weapon_info:{factoryName:"popupFactoryShWeaponInfo"},sh_item_info:{factoryName:"popupFactoryShItemInfo"}}},_.assign(t.q_003_2.Popups._popups,t.pc.quest.roles.QuestSelectCommon.popups._popups),t.q_003_2.Events={_events:{"TOUCH_ENDED q_003_2_quest_top":"__gotoQuestTop"}},t.q_003_2.Methods={_init:function(){if(null==t.gVal.quest.battleResultData)return this._redirect("mypage");var e=t.gVal.quest.battleResultData,n=this.routerParams.a_battle_id;this.quest_type=this.routerParams.quest_type,this.event_id=e.event_id,t.gVal.quest.battleResultData&&t.gVal.quest.battleResultData.raid_stats?(this.is_event_end=!0===t.gVal.quest.battleResultData.raid_stats.is_event_all_over&&("event_union_lilim_raid"===this.quest_type||"event_union_demon_raid"===this.quest_type||"event_union_throne_raid"===this.quest_type||"event_union_seraph_raid"===this.quest_type),this.ref_event_id=t.gVal.quest.battleResultData.raid_stats.result_event_id):(this.is_event_end=!1,this.ref_event_id=-1);var i=Q.resolve();this._isQuestTypeOfConquest()&&(i=Q.all([this._overwriteQuestTypeIfConEx(e.event_id)]));var a=new t.quest.model.QuestType(this.quest_type),o=e&&e.epic_result||{};return(a.shouldHideBackButton()||o.event_quest_type===t.quest.QUEST_TYPE.EPIC_SCENARIO_QUEST)&&this._hideBackButton(),i.then(function(){return this._hasInvalidResult(n,e)?(this._clearCache(),this._redirect("quest")):(this._setReturnButtonTitle(this.is_event_end?"event_union_raid_end":this.quest_type),null!=e.quest_cleared&&(this._questClearedId=e.quest_cleared.quest_id),this._supporterAPlayerId=e.supporter.a_player_id,this._showItemsGained(e.items_gained),void this._showNewItemAcquiredPopups(e.new_items_gained||[]))}.bind(this))},_hideBackButton:function(){this.mainMenuDelegate&&this.mainMenuDelegate.setBackButtonVisible(!1)},_overwriteQuestTypeIfConEx:function(e){return t.createInstance("apiEvents").getQuestEvent(e).then(function(e){"quest_story_event"===e.body.event_type&&(this.quest_type="event_conex")}.bind(this),function(e){i.error(e),Q.reject(e)})},_hasInvalidResult:function(e,t){if(null==t)return!0;if(t.a_battle_id!==e)return!0;if("event_conex"===this.quest_type){if("event"!==t.quest_type)return!0}else if(t.quest_type!==this.quest_type)return!0;return!1},_isQuestTypeOfConquest:function(){return"event"===this.quest_type},_setReturnButtonTitle:function(e){var t=this.DEFAULT_BUTTON_TEXT,n=_.find(this.BUTTON_TEXT,function(t,n){var i=t[this.QUEST_TYPE_SEARCH_REGEXP_INDEX];return-1!==e.search(i)},this);n&&(t=!this.routerParams.is_own_raid&&n[this.IS_RESCUE_RAID_TEXT_INDEX]?n[this.IS_RESCUE_RAID_TEXT_INDEX]:n[this.COMMON_TEXT_INDEX]),this.seekWidgetByName(this.TO_TOP_BUTTON_LABEL).string=t},_showItemsGained:function(e){if(null==e||0===e.length)return this.seekWidgetByName(this.NO_PRIZE_WIDGET).setVisible(!0),this.seekWidgetByName(this.PAGE_VIEW_BASE).setVisible(!1),void this._hidePageviewControls();var n,i=e.slice(0),a=this._divideItemDataByPage(i),o=this._createSubPages(a);(n=t.createInstance("PageView").initialize(o)).setDirection(this.PAGE_VIEW_DIRECTION),this.seekWidgetByName(this.PAGE_VIEW_BASE).addChild(n),t.createInstance("PageController").init(this.resource.node,this.PAGE_VIEW_CONTROLS,n),n.gotoFirstPage(),null==n.getNextPage()?this._hidePageviewControls():(this.seekWidgetByName(this.PAGE_VIEW_CONTROLS[1]).setVisible(!1),this.seekWidgetByName(this.PAGE_VIEW_CONTROLS[2]).setVisible(!1),n.scheduleOnce(function(){this.seekWidgetByName(this.PAGE_VIEW_BASE).setNodeDirty(),this.seekWidgetByName(this.PAGE_VIEW_CONTROLS[1]).setVisible(!0),this.seekWidgetByName(this.PAGE_VIEW_CONTROLS[2]).setVisible(!0)}.bind(this),.3))},_hidePageviewControls:function(){_.each(this.PAGE_VIEW_CONTROLS,function(e){this.resource.node.seekWidgetByName(e).setVisible(!1)},this)},_divideItemDataByPage:function(e){var t=Math.ceil(e.length/this.PAGE_VIEW_ITEMS_PER_PAGE);return _.map(_.range(t),function(){var t=Math.min(e.length,this.PAGE_VIEW_ITEMS_PER_PAGE);return _.map(_.range(t),function(){return e.shift()},this)},this)},_createSubPages:function(e){var t=this.seekWidgetByName(this.SUBPAGE_WIDGET),n=_.map(e,function(e){var n=t.clone();return this._initSubPage(n,e),n},this);return t.removeAllChildren(),t.removeFromParent(),n},_initSubPage:function(e,t){_.each(t,function(t,n){var i=e.seekWidgetByName(this.SUBPAGE_WIDGET_NAMES.RECORD_BASE.NAME+n),a=i.seekWidgetByName(this.CORECARD_WIDGET);i.setVisible(!0),a.setVisible(!0);var o=this["_create"+_.capitalize(t.treasure_type)+"CorecardHandler"](a,t);a.addChild(o.uiNode),this["_fill"+_.capitalize(t.treasure_type)+"CorecardHandler"](o,t),this["_add"+_.capitalize(t.treasure_type)+"CorecardTouchEvent"](o,t)},this),e.setVisible(!0)},_createItemCorecardHandler:function(e,n){var i=n.amount>1?"treasure_amount":"treasure";return t.createInstance("CoreCardItemUI",[i])},_createWeaponCorecardHandler:function(e,n){var i=n.amount>1?"treasure_amount":"treasure";return t.createInstance("CoreCardWeaponUI",[i])},_createSummonCorecardHandler:function(e,n){var i=n.amount>1?"treasure_amount":"treasure";return t.createInstance("CoreCardSummonUI",[i])},_createAccessoryCorecardHandler:function(e,n){var i=n.amount>1?"treasure_amount":"treasure";return t.createInstance("CoreCardAccessoryUI",[i])},_addItemCorecardTouchEvent:function(e,t){this.__addCorecardTouchEvent("item",e,t)},_addWeaponCorecardTouchEvent:function(e,t){this.__addCorecardTouchEvent("weapon",e,t)},_addSummonCorecardTouchEvent:function(e,t){this.__addCorecardTouchEvent("summon",e,t)},_addAccessoryCorecardTouchEvent:function(e,t){this.__addCorecardTouchEvent("accessory",e,t)},__addCorecardTouchEvent:function(e,t,n){var i,a={weapon:{type:"implanted",node:"sh_weapon_info"},summon:{type:"oldType",name:"sh_summon_info"},item:{type:"oldType",name:"sh_item_info"},accessory:{type:"implanted",node:"acce_data",diName:"AcceDataPopup"}}[e];i="implanted"===a.type?this.__createEventListenerImplantedPopup(e,a,n.id):this.__createEventListenerOldTypePopup(e,a,n.id),t.addTouchEventListener(i)},__createEventListenerOldTypePopup:function(e,t,i){return function(a,o){if(o==n.Widget.TOUCH_ENDED){var r=this.popups[t.name];Q.all([this.__getRecord(e,i),r.open()]).spread(function(t){"weapon"===e||"summon"===e?r.setData(r,t.body):r.setData(t.body)})}}.bind(this)},__createEventListenerImplantedPopup:function(e,i,a){return function(o,r){r==n.Widget.TOUCH_ENDED&&this.__getRecord(e,a).then(function(e){var n=e.body,a=cc.director.getRunningScene();t.ImplantedPopup.createOrGet(a,i.node,i.diName).open(n)})}.bind(this)},__getRecord:function(e,n){var a;return a="accessory"===e?"apiAccessories":"api"+_.capitalize(e)+"s",t.createInstance(a).get(n).fail(function(e){return i.error(e),Q.reject()})},_fillCorecardHandlerBase:function(e,t){e.setTreasureBox(t.box_type||"none"),t.amount>1&&e.setAmount("x"+t.amount,!0)},_fillCorecardHandlerExtended:function(e,t){this._fillCorecardHandlerBase(e,t),null!=t.element_type?e.setIconElement(t.element_type):i.warn("q_003_2.Scene._fillCorecardHandlerExtended: element data not found"),null!=t.rare?e.setIconRarity(t.rare):i.warn("q_003_2.Scene._fillCorecardHandlerExtended: rarity data not found"),e.setPlusNo(t.bonus?"+"+t.bonus:""),e.setImg(t.id,t.skin||0)},_fillItemCorecardHandler:function(e,t){this._fillCorecardHandlerBase(e,t),e.setImg(t.id)},_fillWeaponCorecardHandler:function(e,t){this._fillCorecardHandlerExtended(e,t)},_fillSummonCorecardHandler:function(e,t){this._fillCorecardHandlerExtended(e,t)},_fillAccessoryCorecardHandler:function(e,t){this._fillCorecardHandlerExtended(e,t)},_clearCache:function(){t.gVal.quest.battleResultData=null},_showPopup:function(e,t){return this._popupDefer=Q.defer(),e.open().then(e.setData.bind(e,t)),this._popupDefer.promise},_showEndPopups:function(e){if(this._isShowedEndPopups)return Q.resolve();var t=[];return null!=e.new_characters_gained&&t.push(this._showCharacterAcquiredPopups.bind(this,e.new_characters_gained)),null!=e.quest_cleared&&t.push(this._showQuestClearBonusPopups.bind(this,e.quest_cleared)),null!=e.supporter&&e.supporter.can_friend_request&&(t.push(this._showFriendRequestPopup.bind(this,e.supporter)),t.push(this._showFriendRequestResultPopup.bind(this))),this._isShowedEndPopups=!0,t.reduce(Q.when,Q())},_showNewItemAcquiredPopups:function(e){return _.map(e,function(e){return this._showPopup.bind(this,this.popups.newItemAcquired,e)},this).reduce(Q.when,Q())},_showCharacterAcquiredPopups:function(e){return _.map(e,function(e){return this._showPopup.bind(this,this.popups.characterAcquired,e)},this).reduce(Q.when,Q())},_showQuestClearBonusPopups:function(e){var t=[];return null!=e.bonus_items&&t.push(this._showQuestClearBonusItemsAcquiredPopups.bind(this,e.bonus_items)),null!=e.new_character_abilities_gained&&t.push(this._showCharacterAbilityAcquiredPopups.bind(this,e.new_character_abilities_gained)),t.reduce(Q.when,Q())},_showQuestClearBonusItemsAcquiredPopups:function(e){return _.map(e,function(e){return this._showPopup.bind(this,this.popups.questClearBonusItemsAcquired,e)},this).reduce(Q.when,Q())},_showCharacterAbilityAcquiredPopups:function(e){return _.map(e,function(e){return this._showPopup.bind(this,this.popups.characterAbilityAcquired,e)},this).reduce(Q.when,Q())},_showFriendRequestPopup:function(e){return this._showPopup(this.popups.friendRequest,e)},_showFriendRequestResultPopup:function(e){if(!e)return Q.resolve();var n;this._popupDefer=Q.defer(),n=e.offer_made?t.WordBook.FRIEND_REQUEST_SEND:t.WordBook.FRIEND_REQUEST_ERROR_MESSAGE[e.error];var i=this.popups.friendRequestResult;return i.open().then(i.setContent.bind(i,n)),this._popupDefer.promise},_makeFriendRequest:function(){return t.createInstance("apiAFriendOffers").makeOffer(this._supporterAPlayerId).then(function(e){return e.body}).fail(function(e){i.error("apiAFriendOffers.makeOffer error: "+e.stack)})},_redirect:function(e,n){t.createInstance("router").navigateAndPreventHistoryBack(e,n)},__gotoQuestTop:function(){this._showEndPopups(t.gVal.quest.battleResultData).then(function(){this._clearCache(),this._redirect.apply(this,this._getNavigateArguments())}.bind(this)).fail(function(e){i.error(e)})},_getNavigateArguments:function(){return-1!==this.quest_type.search("harem")?["epi",{epi_001:{tab:"new"}}]:["quest",{quest_cleared_id:this._questClearedId}]}},t.q_003_2.Scene=t.BaseScene.extend(_.assign(t.q_003_2.Popups,t.q_003_2.Events,t.q_003_2.Properties,t.q_003_2.Methods))}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.quest=t.pc.quest||{},t.pc.quest.q_003_002=t.pc.quest.q_003_002||{},t.pc.quest.q_003_002.Scene=t.BaseScene.extend({resourceFileName:"q_003/q_003_2.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"quest",sceneName:"q_003_002",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_back_top","btnCallbackBtnBackTop",null,function(){alert("{{}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_retry","btnCallbackBtnRetry",null,function(){alert("{{}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.ccui,i=e._,a=e.Q,o=e.console;t.pc=t.pc||{},t.pc.quest=t.pc.quest||{},t.pc.quest.q_003_002=t.pc.quest.q_003_002||{},t.pc.quest.q_003_002.Properties=i.assign(t.q_003_2.Properties,{PAGE_VIEW_BASE:"page_prize_list",PAGE_VIEW_CONTROL_BASE:"btn_change_page_a_ui",PAGE_VIEW_CONTROLS:i.invert({btn_down:t.PAGE_CONTROLLER_CONTROLS.NEXT_BUTTON,btn_up:t.PAGE_CONTROLLER_CONTROLS.PREVIOUS_BUTTON,"page_current_num.page_max_num":t.PAGE_CONTROLLER_CONTROLS.NUMBER_DISPLAY}),PAGE_VIEW_ITEMS_PER_PAGE:t.BtnsPageListParams.QUEST_RESULT_PRIZES.perPage,PAGE_VIEW_DIRECTION:n.ScrollView.DIR_VERTICAL,SUBPAGE_WIDGET:t.BtnsPageListParams.QUEST_RESULT_PRIZES.panelName,SUBPAGE_WIDGET_NAMES:{RECORD_BASE:{COUNT:t.BtnsPageListParams.QUEST_RESULT_PRIZES.perPage,NAME:"list_blank_"}},CORECARD_WIDGET:"corecard_ui",NO_PRIZE_WIDGET:"nothing_label",TO_TOP_BUTTON:"btn_back_top",TO_TOP_BUTTON_LABEL:"back_top_label"}),t.pc.quest.q_003_002.Methods=i.assign(t.q_003_2.Methods,{__gotoQuestTop:function(){var e=t.gVal.quest.battleResultData;this._showEndPopups(e).then(function(){this._clearCache();var n=cc.director.getRunningScene(),i=n.routerParams.a_quest_id,a=n.routerParams.quest_id,o=this.event_id||this._findRaidEventId(n)||e&&e.event_id,r=e&&e.epic_result||{},s=r.epic_subject_id,c=n.routerParams.quest_category,u=n.routerParams.quest_sub_category;delete this.event_id;var l=!0===this.routerParams.is_own_raid;return!0===r.is_prologue?void t.createInstance("router").navigateAndPreventHistoryBack("epic/epic_quest_top",{},{epic_quest_top:{epicId:s}}):void t.core.router.navigateFromQuest(this.is_event_end?"event_union_raid_end":this.quest_type,!0,i,l,this.is_event_end?this.ref_event_id:o,s,a,c,u)}.bind(this)).fail(function(e){o.error(e)})},_findRaidEventId:function(e){var t=e.routerParams.quest_type;return-1==["event_main","event_raid"].indexOf(t)?null:(e.routerParams.ra_002||e.routerParams.ra_001||{}).event_id||null},_hidePageviewControls:function(){this.seekWidgetByName(this.PAGE_VIEW_CONTROL_BASE).setVisible(!1)},_getBattleResultData:t.q_003_1.Methods._getBattleResultData,_redirectOnFail:t.q_003_1.Methods._redirectOnFail,_cacheData:t.q_003_1.Methods._cacheData}),t.pc.quest.q_003_002.SceneDelegate=t.pc.BaseSceneDelegate.extend(i.assign(t.q_003_2.Popups,{_delayNodes:["../q_popup_ui.json"],onSceneInit:function(e){return this._setBackBtn(e),this._battleResultDataPromise},onSceneEnter:function(e){var n=i.assign(t.pc.quest.q_003_002.Properties,t.q_003_2.Methods);i.assign(e,n,function(e,t){return e||t},e);var a=e.routerParams.a_battle_id,o=e.routerParams.quest_type;return this._battleResultDataPromise=t.tutorial.startTutorialIfNeed(e).fail(this._verifyRouterParams003_002.bind(this,e)).then(function(){return e._getBattleResultData(a,o)}),t.createInstance("aQuestInfo").dispose(),this._battleResultDataPromise.then(n._init.bind(e)).then(function(){e.headerDelegate.updateQuestPoints()})},doPageInAnimation:function(e){var n=t.gVal.quest.battleResultData,o=new t.quest.model.QuestType(e.quest_type||e.routerParams.quest_type),r=!i.isEmpty(n.retry_info)&&o.canRetry(n.retry_info.is_own_raid);return e.animate(r?"page_in_retry":"page_in",!1).then(function(){e.animate(r?"default_view_retry":"default_view",!0);var t="onPageInAnimationEnd";return i.isFunction(this[t])?this[t].call(this,e):a.resolve()}.bind(this))},btnCallbackBtnBackTop:function(e){var t=a.defer();return e.__gotoQuestTop(),t.reject(this._override),t.promise},btnCallbackBtnRetry:function(e){var i=t.gVal.quest.battleResultData,r=new t.quest.model.QuestType(e.quest_type||e.routerParams.quest_type),s=i.retry_info||{};return s.epic_subject_id=(i.epic_result||{}).epic_subject_id,e._showEndPopups(i).then(function(){var e=s.quest_id;return a.all([t.createInstance("apiAQuests").checkQuest(e,r.toQuestStartParam()),t.createInstance("apiAQuestInfo").get()])}.bind(this)).spread(function(i,a){if(this._selectQuest=i.body.quest_info,this._questInfo=a.body,!i.body.result)return this._showCannotProgressInfo(e,i.body.cannot_progress_info,s);var o=this._selectQuest.required_item;if(o.possession_amount>=o.amount){t.quest_required_item.DIConfigForPopupWithPanel.apply();var c=t.createInstance("QuestModel",[this._selectQuest]);return t.createInstance("QuestRequiredItemPopupNeedItem").open(this,c).then(this._routingToRetry.bind(this,r,s))}if(this._challengeLimitPopup(e)){var u=this;e.popups.q_multi_start.blueBtn.addTouchEventListener(function(e,t){t===n.Widget.TOUCH_ENDED&&(this.dismiss(),u._routingToRetry(r,s))},e.popups.q_multi_start)}else this._routingToRetry(r,s)}.bind(this)).fail(function(e){e&&o.error(e)}),a.reject(this._override)},_routingToRetry:function(e,n){this._clearCache();var i=cc.director.getRunningScene(),a=i.routerParams.quest_category,o=i.routerParams.quest_sub_category,r={target:"quest",quest_id:n.quest_id,owner_account_id:n.owner_account_id,event_id:n.event_id,quest_type:e.toQuestStartParam(),episode_num:n.episode_num,recommended_element_type:n.recommended_element_type,returnQuestRoute:e.getReturnQuestRoute(),epic_id:n.epic_subject_id,quest_category:a,quest_sub_category:o};return n.is_raid?void t.createInstance("router").navigate("quest/q_009",{q_009:r}):void t.createInstance("router").navigate("quest/q_002",{q_002:r})},fillupQuestPanel:function(e,n){var i=n.getRawQuest();t.pc.quest.roles.QuestMainPageListController._initFuncQuestpanelCommon(e,i,!1)},_showCannotProgressInfo:function(e,i){var o=e.popups.com_caution_2;switch(o.setTitle(""),i.type){case"does_not_have_enough_ap":return a.all([t.createInstance("apiAItems").getApGain(),t.createInstance("myselfInfoRepository").getQuestPoints()]).spread(this._showPopupApBpNeed.bind(this,e));case"sp_quest_timeover":o.setTitle(""),o.setContent("<br />");var r=o.open();return o.blueBtn.addTouchEventListener(function(e,i){i===n.Widget.TOUCH_ENDED&&t.createInstance("router").navigate("quest/q_portal_top")}),r;case"already_finished":return o.setTitle(""),o.setContent(""),o.open();case"does_not_have_challenge_item":return this._requiredItemPopup(e);case"challenge_limit_reached":var s="<p class='red'><br /><p><span class='red'>"+t.w("popupQuestMultiLimitResetTime")+"</span></p>";return o.setContent(s),o.open();case"challenge_limit_reached_in_session":s="<p class='red'><br /></p>";return o.setContent(s),o.open();case"accessory_quest_challenge_limit_reached":s="<p class='red'><br /><p><span class='red'>"+t.w("popupQuestMultiLimitResetTime")+"</span></p>";return o.setContent(s),o.open();case"has_unconfirmed_battle":return(o=e.popups.com_raid_check).open();default:return o.setContent(i.data.reason),o.open()}},_showPopupApBpNeed:function(e,n,a){var o=t.gVal.quest.battleResultData,r=a.getAsObject(),s=n.body,c=i.find(s.data,function(e){return e.name===t.w("elixir")}),u=i.find(s.data,function(e){return e.name===t.w("elixirHalf")});(0===c.num&&0===u.num?e.popups.comNeedApBp2:e.popups.comNeedApBp1).open({property:"AP",questTitle:o.retry_info.quest_title,item:c,itemLittleRecover:u,onUse:this.btnCallbackBtnRetry.bind(this,e),currentQuestPoints:r.ap,maxQuestPoints:r.max_ap,component:"quest"})},_findRaidEventId:function(e){var t=e.routerParams.quest_type;return-1==["event_main","event_raid"].indexOf(t)?null:(e.routerParams.ra_002||e.routerParams.ra_001||{}).event_id||null},_touchEndedBackBtnProcess:function(e){this._navigate003_2To003_1(e)}})),t.assignRoles(t.pc.quest.q_003_002.SceneDelegate,[t.pc.quest.roles.Routing,t.pc.quest.roles.QuestSelectCommon.methods])}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.quest=t.pc.quest||{},t.pc.quest.q_004=t.pc.quest.q_004||{},t.pc.quest.q_004.Scene=t.BaseScene.extend({resourceFileName:"q_004/q_004.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[{tab1:{node:"tab_0","content-node":"tab_0_node"},tab2:{node:"tab_1","content-node":"tab_1_node"}}],componentName:"quest",sceneName:"q_004",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_back_con_top","btnCallbackBtnBackConTop",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"conquest/con_001")),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc=t.pc||{},t.pc.quest=t.pc.quest||{},t.pc.quest.q_004=t.pc.quest.q_004||{},$staticRes(res["core-popup-ra_need_item"]),$staticRes(res["core-popup-ra_no_item"]),t.pc.quest.q_004.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../q_popup_ui.json"],_popups:{},questCommonDelegate:new t.QuestScenePcCommonDelegate,_tabNames:{daily_guerrilla:"tab_0",accessory:"tab_1"},onSceneInit:function(e){this._verifyTemporaryRouterParams004(e),this._cleanUpPaymentId(),this.questCommonDelegate.owner=e;var n=t.createInstance("apiAQuestInfo"),i=t.createInstance("myselfInfoRepository"),o=n.get().then(function(e){this._questInfo=e.body}.bind(this)).then(function(){return a.all([i.getQuestPoints(),i.getMe(),this._fillupSpecialQuestLists(e,"_touchSpecialQuestPanel")]).spread(function(e,t,n){this._questPoints=e.getAsObject(),this._player=t.body}.bind(this)).fail(function(e){console.error(e.stack)})}.bind(this));return this._selectInitialTab(e),this._setBackBtn(e),o},onSceneEnter:function(e){return a.resolve()},onSceneExit:function(e){return a.defer(),i.isFunction(this.questCommonDelegate.onExit)?this.questCommonDelegate.onExit():this.questCommonDelegate.owner=null,a.resolve()},_touchSpecialQuestPanel:function(e,t){var i=n.director.getRunningScene();this.questCommonDelegate.restartCheckInProgressQuest(t,this._questInfo)||this.startCheckQuestState(i,t)},startQuest:function(e,t,n,i){"raid"===this._selectQuest.type?this._navigate004To009(e,t,i):this._navigateTo002(e,t,n,i)},update:function(){t.createInstance("sceneManager").reloadScene()},fillupQuestPanel:function(e,t){var n=t.getRawQuest();this._initFuncQuestpanelCommon(e,n)},_selectInitialTab:function(e){var t=e.temporaryRouterParams.q_004.tab;return i.isUndefined(t)&&(t="daily_guerrilla"),this._tabNames.hasOwnProperty(t)?void this._showTabByTabName(this._tabNames[t]):void console.error("SceneDelegate._setInitialTab(): Invalid tab value, "+t)},_showTabByTabName:function(e){var t=n.director.getRunningScene(),i=this._getNodeByName(e,t);t.tabDelegateList[0].selectTab(i)},tabCallbackTab0:function(e){console.log("tabCallBackTab0")},tabCallbackTab1:function(e){console.log("tabCallBackTab1")},clearOwnQuest:function(){delete this._questInfo.in_progress.own_quest},_touchEndedBackBtnProcess:function(e){this._navigateTo001()}}),i.assign(t.pc.quest.q_004.SceneDelegate.prototype._popups,t.pc.quest.q_001.SceneDelegate.prototype._popups,t.pc.quest.roles.QuestSelectCommon.popups._popups,t.pc.quest.roles.QuestMainPageListPopups._popups),i.assign(t.pc.quest.q_004.SceneDelegate.prototype,t.pc.quest.roles.QuestSelectCommon.methods,t.pc.roles.UIUtility,t.pc.quest.roles.Routing,t.pc.quest.roles.QuestMainPageListController)}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.quest=t.pc.quest||{},t.pc.quest.q_005=t.pc.quest.q_005||{},t.pc.quest.q_005.Scene=t.BaseScene.extend({resourceFileName:"q_005/q_005.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"quest",sceneName:"q_005",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_shift_map","btnCallbackBtnShiftMap",null,function(){alert("{{q_005_backcheck q_001}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_prev_map","btnCallbackBtnPrevMap",null,function(){alert("{{}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_next_map","btnCallbackBtnNextMap",null,function(){alert("{{}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e.ccs,a=e.ccui,o=e._,r=e.Q,s=e.console;t.pc=t.pc||{},t.pc.quest=t.pc.quest||{},t.pc.quest.q_005=t.pc.quest.q_005||{};var c=e.res;$staticRes(c["quest-q_005-q_005_map_1_ui"]),$staticRes(c["quest-q_005-q_005_map_2_ui"]),$staticRes(c["quest-q_005-q_005_map_3_ui"]),$staticRes(c["quest-q_005-area_mist"]),t.pc.quest.q_005.NODE_NAMES={CURRENT_MAP:"map_panel_0.map_ui",NEXT_MAP:"map_panel_1.map_ui",BTN_PREV_MAP:"btn_prev_map",BTN_NEXT_MAP:"btn_next_map"},t.pc.quest.q_005.SceneDelegate=t.pc.BaseSceneDelegate.extend({_popups:{popupBackCheck:{factoryName:"popupFactoryBlackRed",title:"",content:"<p><br /><br /></p><p class='red'></p>",buttonLabels:{blackBtn:"",redBtn:""},buttonSounds:{redBtn:t.SoundList.BUTTON_TOUCHED_CONFIRMED},buttons:{blackBtn:function(e){this.dismiss()},redBtn:function(e){e._delegate.giveupQuest(e),this.dismiss()}}}},onSceneInit:function(e){var n=t.createInstance("apiAWorlds").getAreas(),i=t.createInstance("apiAQuestInfo").get();return e.seekWidgetByName("btn_shift_map").setSound(t.SoundList.BUTTON_TOUCHED_CONFIRMED),this._disableCtrlBtns(e),this._setBackBtn(e),r.all([n,i]).spread(function(n,i){if(this._mapDelegate=new t.MapDelegate(i.body,n.body.a_areas),this._mapDelegate.hasUnlockedArea()){var a=this._mapDelegate.getMapNoOfUnlockedArea();this._mapDelegate.setCurrentMapNo(a)}this._updateCurrentMap(e),this._updateAreaInfo(e,this._getSelectedAreaId())}.bind(this)).fail(function(e){s.error(e.stack)})},onSceneEnter:function(e){return r.defer(),r.resolve()},onSceneExit:function(e){return r.defer(),r.resolve()},btnCallbackBtnShiftMap:function(e){var t=r.defer();return t.reject(this._override),this._getSelectedAAreaId()?this._otherAreaHasQuestInProgress()?(e.popups.popupBackCheck.open(),t.promise):(this.moveToOtherArea(),t.promise):t.promise},btnCallbackBtnPrevMap:function(e){var t=this._mapDelegate.getCurrentMapNo();return this._mapDelegate.setCurrentMapNo(t-1),this._updateCurrentMap(e),r.reject(this._override)},btnCallbackBtnNextMap:function(e){var t=this._mapDelegate.getCurrentMapNo();return this._mapDelegate.setCurrentMapNo(t+1),this._updateCurrentMap(e),r.reject(this._override)},_otherAreaHasQuestInProgress:function(){var e=this._getAQuestInfo();return!(!e.in_progress||!e.in_progress.own_quest&&!e.in_progress.own_raid||e.current_a_area_id===this._getSelectedAAreaId())},moveToOtherArea:function(){t.createInstance("apiAQuestInfo").moveArea(this._getSelectedAAreaId()).then(function(e){s.log(e),t.createInstance("router").navigate("quest")}.bind(this)).fail(function(e){s.error(e.stack)})},giveupQuest:function(e){var n=this._getAQuestInfo().in_progress.own_quest||this._getAQuestInfo().in_progress.own_raid;n.type=n.type||"raid",t.createInstance("apiAQuests").giveupQuest(n.a_quest_id,n.type).then(function(e){t.createInstance("aQuestInfo").dispose(),t.createInstance("popupFactoryComBackResult").create({}).open({type:n.type}),t.createInstance("apiAQuestInfo").get().then(function(e){this._questInfo=e.body,this._updateProgressTag(this._getInProgressTagNode(),this._inProgressArea)}.bind(this)).fail(function(e){s.error(e.stack)})}.bind(this)).fail(function(e){s.error(e.stack)})},_getInProgressTagNode:function(){if(null==this._inProgressArea)return null;var e=n.director.getRunningScene(),t="area_"+o.padZero(this._inProgressArea.area_id,2);return e.seekWidgetByPath(t+".Node")},_disableCtrlBtns:function(e){o.each([t.pc.quest.q_005.NODE_NAMES.BTN_PREV_MAP,t.pc.quest.q_005.NODE_NAMES.BTN_NEXT_MAP],function(t){var i=e.seekWidgetByName(t);i&&(i.setColor(n.color("#808080")),i.setTouchEnabled(!1))})},_updateCurrentMap:function(e){this._setMap(e,t.pc.quest.q_005.NODE_NAMES.CURRENT_MAP,this._mapDelegate.getCurrentMapNo()),t.env.isSp||this._setMap(e,t.pc.quest.q_005.NODE_NAMES.NEXT_MAP,this._mapDelegate.getCurrentMapNo()+1),this._disableCtrlBtns(e),this._enableBtnPrevIfHasPrev(e),this._enableBtnNextIfHasNext(e),this._setEachArea(e).then(function(){this._playAreaAnimation(e),this._setAreaTouchEvent(e),this._updatePageNum(e)}.bind(this))},_setMap:function(e,t,n){return new r.Promise(function(a){var o="quest-q_005-q_005_map_"+n+"_ui",r=i.load($dynamicRes(c[o]));if(!r.node)return s.warn("[WARN] resouce not found: "+o),void a();r.action&&r.node.runAction(r.action);var u=e.seekWidgetByPath(t);return u?(u.removeAllChildren(),u.addChild(r.node),void a()):void a()}).fail(function(e){s.warn(e)})},_enableBtnPrevIfHasPrev:function(e){if(this._mapDelegate.hasPrev()){var i=e.seekWidgetByName(t.pc.quest.q_005.NODE_NAMES.BTN_PREV_MAP);i&&(i.setColor(n.color.WHITE),i.setTouchEnabled(!0))}},_enableBtnNextIfHasNext:function(e){if(this._mapDelegate.hasNext()){var i=e.seekWidgetByName(t.pc.quest.q_005.NODE_NAMES.BTN_NEXT_MAP);i&&(i.setColor(n.color.WHITE),i.setTouchEnabled(!0))}},_setEachArea:function(e){this._worldNodes={};var n=this._mapDelegate.getAAreasOnCurrentMap();return t.env.isSp||Array.prototype.push.apply(n,this._mapDelegate.getAAreasOnNextMap()),r.all(o.map(n,function(t){var n=e.seekWidgetByName("area_"+o.padZero(t.area_id,2));if(n)return this._loadAreaIcon(n,t)},this))},_loadAreaIcon:function(e,n){var a="../quest/res/q_005/area_[% areaId %].json".replace(/\[%\sareaId\s%\]/g,function(e,t){return o.padZero(n.area_id,2)});return t.loader.load([a]).then(function(){var t=i.load(a);t.node.runAction(t.action),e.addChild(t.node),this._updateProgressTag(t.node,n),this._worldNodes[n.a_area_id]=t.node;var r=o.reduce(n.not_clear_quest_info,function(e,t){return e+t});r>0&&(e.seekWidgetByName("count_base").setVisible(!0),e.seekWidgetByName("count_label").setString(r)),n.a_area_id===this._getSelectedAAreaId()&&this.showWorldNaviCharacter(n.a_area_id)}.bind(this)).fail(function(e){return s.warn(e.stack),r.reject(e)})},showWorldNaviCharacter:function(e){this._setWorldNaviCharacterVisible(e,!0)},hideWorldNaviCharacter:function(e){this._setWorldNaviCharacterVisible(e,!1)},_setWorldNaviCharacterVisible:function(e,t){var n=this._worldNodes[e];if(null!=n){var i=n.seekWidgetByName("q_map_chara"),a=i.getActionByTag(i.tag);t?a.gotoFrameAndPlay(0,a.getDuration(),!0):a.gotoFrameAndPause(0),i.setVisible(t)}},_updateProgressTag:function(e,t){if(null!=e){var n=this._getAQuestInfo().in_progress.own_quest||{};n.a_area_id=n.a_area_id||null,t.a_area_id===n.a_area_id?(this._inProgressArea=t,e.seekWidgetByName("rate_icon").loadTexture("core/res/icon/queststatusicon_now.png",a.Widget.PLIST_TEXTURE),e.seekWidgetByName("rate_icon").setVisible(!0)):t.a_area_id===this._getAQuestInfo().next_a_area_id?(e.seekWidgetByName("rate_icon").loadTexture("core/res/icon/queststatusicon_new.png",a.Widget.PLIST_TEXTURE),e.seekWidgetByName("rate_icon").setVisible(!0)):e.seekWidgetByName("rate_icon").setVisible(!1)}},_playAreaAnimation:function(e){var n=this._getAQuestInfo(),i=this._mapDelegate.getAAreasOnCurrentMap();t.env.isSp||Array.prototype.push.apply(i,this._mapDelegate.getAAreasOnNextMap()),o.each(i,function(t){0!=t.is_released&&(!this._hasPlayedReleaseAnimation&&n.has_unlocked_area&&t.a_area_id===n.next_a_area_id?(this._playAreaReleaseAnimation(e,t),this._hasPlayedReleaseAnimation=!0):this._playAreaDefaultAnimation(e,t))},this)},_playAreaReleaseAnimation:function(e,n){var a="area_"+o.padZero(n.area_id,2),u=e.seekWidgetByPath(a),l=e.seekWidgetByPath(a+".Node");if(l){l.changeFrame(1),l.setVisible(!1);var _=i.load(c["quest-q_005-area_mist"]),p=_.node;p.runAction(_.action),u.addChild(p),p.seekWidgetByName("icon_map").initWithSpriteFrameName("quest/res/q_005/icon_map_"+o.padZero(n.area_id,2)+"_01.png"),p.setStrings({area_name_label:n.area_name}),r.delay(10).then(function(){p.animate("area_open",!1).delay(1e3).then(function(){p.removeFromParent(),this._playAreaDefaultAnimation(e,n),t.createInstance("apiAQuestInfo").confirmUnlockedAreaPopup()}.bind(this)).fail(function(e){s.error(e.stack)})}.bind(this))}},_playAreaDefaultAnimation:function(e,t){var n=o.padZero(t.area_id,2),i="area_"+n,a="area_"+n+"_ani",r=e.seekWidgetByPath(i+".Node");r&&(r.setVisible(!0),r.animate(a,!0))},_setAreaTouchEvent:function(e){var t=this._mapDelegate.getAAreasOnCurrentMap();o.each(t,function(n){var i="area_"+o.padZero(n.area_id,2),r=e.seekWidgetByPath(i+"..map_btn");r&&r.addTouchEventListener(function(i,r){r===a.Widget.TOUCH_ENDED&&(this._mapDelegate.setSelectedArea(n),o(t).pluck("a_area_id").each(this.hideWorldNaviCharacter,this),this.showWorldNaviCharacter(n.a_area_id),this._updateAreaInfo(e,n.area_id))}.bind(this))},this)},_updateAreaInfo:function(e){var n=this._mapDelegate.getSelectedArea();if(n){e.loadTextures({worldimg_area:t.Img("worldimg","area",o.padZero(n.area_id,4),0).png,worldtreasure_area:t.Img("worldtreasure","area",o.padZero(n.area_id,4),0).png}),e.setStrings({map_name_label:n.area_name,world_description_label:n.description}),e.seekWidgetByPath("main_quest_base.rest_count_label").setString(n.not_clear_quest_info.main_num.toString(10)),e.seekWidgetByPath("free_quest_base.rest_count_label").setString(n.not_clear_quest_info.free_num.toString(10));var i={undiscovered:0,discovered:1,slain:2};o.each(o.range(3),function(a){var r=e.seekWidgetByName("q_005_enemyicon_ui_"+a);if(!n||!n.rare_enemy_info||a>=n.rare_enemy_info.length)r.setVisible(!1);else{var s=n.rare_enemy_info[a];r.loadTextures({"iconene_enemy-looks":t.Img("iconene","enemy-looks",o.padZero(s.id,4)).png}),r.seekWidgetByName("subdued_icon").setVisible(s.state===i.slain),r.setVisible(!0)}},this)}},_updatePageNum:function(e){var t=e.seekWidgetByName("page_num");if(t){var n=this._mapDelegate.getCurrentMapNo(),i=this._mapDelegate.getMaxMapNo();t.setString([n,i].join("/"))}},_getAQuestInfo:function(){return this._mapDelegate.getAQuestInfo()},_getSelectedAAreaId:function(){return(this._mapDelegate.getSelectedArea()||{}).a_area_id},_getSelectedAreaId:function(){return(this._mapDelegate.getSelectedArea()||{}).area_id},_touchEndedBackBtnProcess:function(e){this._navigateTo001()}}),o.assign(t.pc.quest.q_005.SceneDelegate.prototype,t.pc.quest.roles.Routing)}((this||0).self||global),function(e){var t=e.kh,n=e._,i=(e.console,e.cc);t.MapDelegate=i.Class.extend({DEFAULT_MAP_NO:1,ctor:function(e,t){this._aQuestInfo=e,this._aAreas=t},getMapNumbers:function(){return this._mapNumbers?this._mapNumbers:(this._mapNumbers=n(this.getAAreas()).pluck("map_no").uniq().value().sort(function(e,t){return e-t})||[],this._mapNumbers)},getAQuestInfo:function(){return this._aQuestInfo},getAAreas:function(){return this._aAreas},findAAreaByAreaId:function(e){return n.find(this.getAAreas(),function(t){return e===t.area_id})||{}},findAAreaByAAreaId:function(e){return n.find(this.getAAreas(),function(t){return e===t.a_area_id})||{}},findCurrentAArea:function(){var e=this.getAQuestInfo().current_area_id;return this.findAAreaByAreaId(e)},getSelectedArea:function(){return this._selectedArea?this._selectedArea:(this.setSelectedArea(this.findCurrentAArea()),this._selectedArea)},setSelectedArea:function(e){this._selectedArea=e},getCurrentMapNo:function(){return this._currentMapNo?this._currentMapNo:(this.setCurrentMapNo((this.getSelectedArea()||{}).map_no),this._currentMapNo||1)},setCurrentMapNo:function(e){this._currentMapNo=e},getPrevMapNo:function(){var e=this.getCurrentMapNo(),t=this.getMapNumbers(),n=t.indexOf(e);return n<=0?null:t[n-1]},getNextMapNo:function(){var e=this.getCurrentMapNo(),t=this.getMapNumbers(),n=t.indexOf(e);return n<0?null:t.length-1<=n?null:t[n+1]},getMaxMapNo:function(){var e=this.getMapNumbers();return e.length<1?-1:e[e.length-1]},hasPrev:function(){return n.isNumber(this.getPrevMapNo())},hasNext:function(){return n.isNumber(this.getNextMapNo())},getAAreasOnCurrentMap:function(){var e=this.getCurrentMapNo();return n.filter(this.getAAreas(),function(t){return t.map_no===e})||[]},getAAreasOnNextMap:function(){var e=this.getNextMapNo();return n.filter(this.getAAreas(),function(t){return t.map_no===e})||[]},hasUnlockedArea:function(){return this.getAQuestInfo().has_unlocked_area},getMapNoOfUnlockedArea:function(){if(!this.hasUnlockedArea)return null;var e=this.getAQuestInfo().next_a_area_id;return(n.find(this.getAAreas(),function(t){return t.a_area_id===e})||{map_no:t.KHMapDelegate.DEFAULT_MAP_NO}).map_no}})}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{q_006_attention:{factoryName:"popupFactoryTextOnly",content:"q_006_attention",title:"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(){this.dismiss()}}}});t.pc.quest=t.pc.quest||{},t.pc.quest.q_006_007_008=t.pc.quest.q_006_007_008||{},t.pc.quest.q_006_007_008.Scene=t.BaseScene.extend({resourceFileName:"q_006_7_8/q_006_7_8.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[{tab1:{node:"tab_0","content-node":"q_006_node"},tab2:{node:"tab_1","content-node":"q_007_node"},tab3:{node:"tab_2","content-node":"q_008_node"}}],componentName:"quest",sceneName:"q_006_007_008",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_hint","btnCallbackBtnHint",null,function(e){this.popups.q_006_attention.open(e)}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc=t.pc||{},t.pc.quest=t.pc.quest||{},t.pc.quest.q_006_007_008=t.pc.quest.q_006_007_008||{},t.pc.quest.q_006_007_008.SceneDelegate=t.pc.BaseSceneDelegate.extend({_popups:{comNeedApBp1:{factoryName:"popupFactoryComNeedApBp1"},comNeedApBp2:{factoryName:"popupFactoryComNeedApBp2"},comRaidCheck:{factoryName:"popupFactoryComRaidCheck"},comUseResult:{factoryName:"popupFactoryComUseResult"},q_006_attention:{factoryName:"popupFactoryBlue",title:"",content:['<div style="text-align: left; font-size: 20px">',"<br /></span>","</div>"].join(""),buttonLabels:{blueBtn:"OK"},buttonSounds:{blueBtn:t.SoundList.BUTTON_TOUCHED_CONFIRMED},buttons:{blueBtn:function(e){this.dismiss()}},onPopupOpened:function(e){e.seekWidgetByName("popup_base").height=375,e.seekWidgetByName("title_label").y=300,e.seekWidgetByName("popup_labelimg").y=210,e.seekWidgetByName("popup_labelimg").height=220}},popupReachedRaidMax:{factoryName:"popupFactoryBlue",title:"",content:"<span class='red'>3</span>",buttonLabels:{blueBtn:"OK"},buttonSounds:{blueBtn:t.SoundList.BUTTON_TOUCHED_CONFIRMED},buttons:{blueBtn:function(e){this.dismiss()}}},com_need_bp_2:{factoryName:"popupFactoryTextOnly",action:{"":{id:"501","json":"","":"corecard_item_ID","":""},"()":{id:"503","json":"","":"sh_002","":""},"":{id:"499","json":"","":"CSS","":""},"()":{id:"502","json":"","":"sh_003","":""}},id:"497",name:"com_need_bp_2",page:["q_006_a"],resource:"",title:"BP"},q_multi_overdo:{factoryName:"popupFactoryTextOnly",action:{"OK(blue)":{id:"436","json":"btn.json","":"OKq_multi_overdo","":"blue_btn"},"q_multi_overdo":{id:"435","json":"text_button_only.json ","":" CSS","":"popup_labelimg"}},id:"433",name:"q_multi_overdo",page:["q_006_a"],resource:"text_button_only.json",title:""}},_tabNode:{q_006:"tab_0",q_007:"tab_1",q_008:"tab_2"},onSceneInit:function(e){this._cleanUpPaymentId(),this.hasQuestHistoryList=!1;var n=t.createInstance("apiAPlayers"),o=t.createInstance("myselfInfoRepository"),r=a.all([this._fillupRaidBattleList(e,"request","_touchRaidPanel"),this._fillupRaidBattleList(e,"unverify","_touchUnverifyPanel"),o.getQuestPoints(),n.getMeNumeric()]).spread(function(e,t,n,a){this.joinCount=i.filter(e.data,function(e){return e.is_joined&&!e.is_own_raid}).length,this.unverifyCount=t.data.length,this.questPoint=n.getAsObject(),this.player=a.body}.bind(this)).fail(function(e){console.error(e.stack)});return this._selectInitialTab(e),this._setBackBtn(e),r},_selectInitialTab:function(e){var n=t.createInstance("router").getCurrentSceneName();null!=this._tabNode[n]&&this._showTabByTabName(this._tabNode[n])},show006:function(){this._showTabByTabName("tab_0")},show007:function(){this._showTabByTabName("tab_1")},show008:function(){this._showTabByTabName("tab_2")},_showTabByTabName:function(e){var t=n.director.getRunningScene();t.tabDelegateList[0].selectTab(t.seekWidgetByName(e))},tabCallbackTab0:function(e){var n=t.createInstance("myselfInfoRepository");a.all([this._fillupRaidBattleList(e,"request","_touchRaidPanel"),n.getQuestPoints()]).spread(function(t,n){this.joinCount=i.filter(t.data,function(e){return e.is_joined&&!e.is_own_raid}).length,this.questPoint=n.getAsObject();var a=0==t.data.length;e.seekWidgetByName("nothing_label").setVisible(a)}.bind(this)).fail(function(e){console.error(e.stack)})},tabCallbackTab2:function(e){this.hasQuestHistoryList||a.all([this._fillupRaidBattleList(e,"history","_touchHistoryPanel")]).spread(function(e){this.hasQuestHistoryList=!0}.bind(this)).fail(function(e){console.error(e.stack)})},onSceneEnter:function(e){return a.resolve()},onSceneExit:function(e){return a.defer(),this._needApBpPopupFactory&&(this._needApBpPopupFactory.cleanup(),this._needApBpPopupFactory=null),a.resolve()},btnCallbackBtnHint:function(e){var t=a.defer();return t.resolve(),t.promise},_touchRaidPanel:function(e,i){var o=n.director.getRunningScene();if(i.is_joined)t.createInstance("router").navigate("battle",{quest_type:i.quest_type,a_quest_id:i.a_quest_id,a_battle_id:i.a_battle_id,is_own_raid:i.is_own_raid,a_player_id:this.player.a_player_id});else if(this.joinCount>=3)this._showPopupReachedRaidMax(o);else if(this.unverifyCount)this._showPopupExistUnconfirmBattle(o);else{if(!(this.questPoint.bp<i.battle_bp)){var r=i.recommended_element_type;return void this._navigate006To009(i,this.player.a_player_id,r)}var s=t.createInstance("apiAItems");a.all([s.getBpGain(),this.updateQuestPoints()]).spread(function(n,a){this._needApBpPopupFactory=t.createInstance("popupFactoryComNeedApBp"),this._needApBpPopupFactory.create({property:"BP",questTitle:"Lv"+i.enemy_level+" "+i.enemy_name,questPoints:this.questPoint,items:n.body,component:"quest",onUse:this._onUseBpItem.bind(this,e,i),needBattleBp:i.battle_bp}).open()}.bind(this)).fail(function(e){console.error(e.stack)})}},_onUseBpItem:function(e,t,n){this.questPoint.bp=n,this._touchRaidPanel(e,t)},_touchUnverifyPanel:function(e,t,n){this._navigate007To003(t)},_touchHistoryPanel:function(e,t,n){this._navigate008To010(t)},_showPopupReachedRaidMax:function(e){e.popups.popupReachedRaidMax.open()},_showPopupExistUnconfirmBattle:function(e){e.popups.popupExistUnconfirmBattle.open()},updateQuestPoints:function(){return n.director.getRunningScene().headerDelegate.updateQuestPoints().then(function(e){return this.questPoint=e,e}.bind(this))},_touchEndedBackBtnProcess:function(e){this._navigate006ToBackBtn(e.routerParams)}}),i.assign(t.pc.quest.q_006_007_008.SceneDelegate.prototype._popups,t.pc.quest.roles.QuestSelectCommon.popups._popups),i.assign(t.pc.quest.q_006_007_008.SceneDelegate.prototype,t.pc.quest.roles.QuestSelectCommon.methods,t.pc.roles.UIUtility,t.pc.quest.roles.Routing,t.pc.quest.roles.QuestRaidPageListController)}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.quest=t.pc.quest||{},t.pc.quest.q_009=t.pc.quest.q_009||{},t.pc.quest.q_009.Scene=t.BaseScene.extend({resourceFileName:"q_009/q_009.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[{tab1:{node:"tab_0","content-node":"tab_0_node"},tab2:{node:"tab_1","content-node":"tab_1_node"},tab3:{node:"tab_2","content-node":"tab_2_node"},tab4:{node:"tab_3","content-node":"tab_3_node"},tab5:{node:"tab_4","content-node":"tab_4_node"},tab6:{node:"tab_5","content-node":"tab_5_node"},tab7:{node:"tab_6","content-node":"tab_6_node"}}],componentName:"quest",sceneName:"q_009",_delegate:null,_init:function(){this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc=t.pc||{},t.pc.quest=t.pc.quest||{},t.pc.quest.q_009=t.pc.quest.q_009||{},t.pc.quest.q_009.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../q_popup_ui.json"],_popups:{popupConfirmGoToParty001:{factoryName:"popupFactoryBlackBlue",title:"",content:"",buttonLabels:{blackBtn:"",blueBtn:"OK"},buttons:{blackBtn:function(e){this.dismiss()},blueBtn:function(e){this.dismiss()}}},popupConfirmAutoOrgWithElement:{factoryName:"popupFactoryBlackBlue",title:"",buttonLabels:{blackBtn:"",blueBtn:"OK"},buttons:{blackBtn:function(e){this.dismiss()},blueBtn:function(e){this.dismiss()}}},popupCaution:{factoryName:"popupFactoryBlue",title:"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){this.dismiss()}}},popupConfirm:{factoryName:"popupFactoryBlackBlue",title:"",buttonLabels:{blackBtn:"",blueBtn:""},buttons:{blackBtn:function(e){this.dismiss()},blueBtn:function(e){this.dismiss()}}}},onSceneInit:function(e){this._initControllers();var n=a.all([t.createInstance("apiAQuests").getQuest(e.routerParams.q_009.quest_id,e.routerParams.q_009.quest_type,e.routerParams.q_009.owner_account_id),t.createInstance("myselfInfoRepository").getQuestPoints(),this._getAPartiesData(),this._showInitialSupporterList()]).spread(function(t,n){this._isLatestEpisode=!0,this.questData=t.body,this.selectedEpisode=i.last(this.questData.episodes),this.questPoints=n.getAsObject(),this._setRaidBase(e),this._getSupporterSelectionController().hasSupporterSelected()&&this._showPartySelectPopup()}.bind(this)).fail(function(e){e&&console.error(e)});return this._setBackBtn(e),n},_getAPartiesData:function(){return t.createInstance("apiAParties").getDecks().then(function(e){return this._aParties=e.body.decks,e}.bind(this)).fail(function(e){console.error(e.stack)})},onSceneEnter:function(e){return a.defer(),a.resolve()},onSceneExit:function(e){return a.defer(),a.resolve()},_touchSupportSummonPanel:function(e,t,n){this._getSupporterSelectionController().selectSupporter(t),this._showPartySelectPopup()},_setRaidBase:function(e){if(this.questData.raid_info){var n=this.questData.raid_info,a=n.enemy_level;e.routerParams.q_009&&e.routerParams.q_009.enemy_level&&(a=e.routerParams.q_009.enemy_level,delete e.routerParams.q_009.enemy_level);var o=e.seekWidgetByName("raid_base"),r=o.seekWidgetByName("questimg_raid-quest"),s=0===this.questData.type.indexOf("event")?"event-quest":"raid-quest",c=t.Img("questimg",s,i.padZero(this.questData.quest_id,4),1).jpg;r.loadTexture(c),o.seekWidgetByName("raid_label").setString("Lv"+a+"\n"+n.enemy_name+"\n")}else console.warn("this.questData.raid_info is not defined !!")},navigateToParty:function(e,t){this._getSupporterSelectionController().getSelectedSupporter().then(function(n){var i=n.getId(),a=n.getElementType(),o=this._getSelectedTabNumber(e);this._navigate009ToParty(e,t,i,a,o)}.bind(this))},_getSelectedTabNumber:function(e){var t=e.tabDelegateList[0].selected;return i.last(t.match(/\d/g))},tabCallbackTab0:function(e){this._onChangeTab(0)},tabCallbackTab1:function(e){this._onChangeTab(1)},tabCallbackTab2:function(e){this._onChangeTab(2)},tabCallbackTab3:function(e){this._onChangeTab(3)},tabCallbackTab4:function(e){this._onChangeTab(4)},tabCallbackTab5:function(e){this._onChangeTab(5)},tabCallbackTab6:function(e){this._onChangeTab(8)},btnCallbackBtnBack:function(e){return this._touchEndedBackBtnProcess(e),a.reject(this._override)},_onChangeTab:function(e){var t=e;this._getSupporterListController().showSupporterListByElementType(t)},_initControllers:function(){var e=t.createInstance("SupporterListsModel");this._initSupporterListController(e),this._initSupporterSelectionController(e)},_initSupporterSelectionController:function(e){this._supporterSelectionController=t.createInstance("SupporterSelectionController",[e])},_initSupporterListController:function(e){this._supporterListController=t.createInstance("SupporterListController",[e])},_getSupporterSelectionController:function(){return this._supporterSelectionController},_getSupporterListController:function(){return this._supporterListController},_showInitialSupporterList:function(){var e=this._getSupporterListController();return this._getSupporterSelectionController().getSelectedSupporter().then(e.showInitialSupporterList.bind(e))},_showPartySelectPopup:function(){var e=n.director.getRunningScene();this._getSupporterSelectionController().getSelectedSupporter().then(function(n){var i=t.ImplantedPopup.createOrGet(e,"q_002_sup","SelectPartyPopup"),a=this.selectedEpisode.recommended_element_type;i.open(e,this._aParties,n.getRawSupporterData(),this.questData,this.questPoints,a,!0).fail(function(e){e&&console.error(e)})}.bind(this))},_touchEndedBackBtnProcess:function(e){this._navigateByQuestType(e.routerParams.q_009)}}),i.assign(t.pc.quest.q_009.SceneDelegate.prototype,t.pc.roles.UIUtility,t.pc.quest.roles.Routing,t.pc.quest.roles.QuestSupportPageListController,t.pc.quest.roles.QuestStart)}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.quest=t.pc.quest||{},t.pc.quest.q_010=t.pc.quest.q_010||{},t.pc.quest.q_010.Scene=t.BaseScene.extend({resourceFileName:"q_010/q_010.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"quest",sceneName:"q_010",_delegate:null,_init:function(){this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._),i=e.Q;t.pc=t.pc||{},t.pc.quest=t.pc.quest||{},t.pc.quest.q_010=t.pc.quest.q_010||{},t.pc.quest.q_010.SceneDelegate=t.pc.BaseSceneDelegate.extend({_popups:{},onSceneInit:function(e){this._verifyRouterParams010(e),this._setBackBtn(e);var n=e.routerParams.q_010.had_won;this._baseNodeName=n?"q_010_result_succeed_ui":"q_010_result_failed_ui";var i=n?"_fillupPageSuccess":"_fillupPageFail",a=e.routerParams.q_010.a_battle_id,o=e.routerParams.q_010.quest_type;return t.createInstance("apiABattles").battleResult(a,o).then(function(t){console.log(t.body),this[i](e,t.body)}.bind(this)).fail(function(e){console.error(e.stack)})},onSceneEnter:function(e){return i.defer(),i.resolve()},onSceneExit:function(e){return i.defer(),i.resolve()},onPageInAnimationEnd:function(e){return i.defer(),e.seekWidgetByName("q_010_result_succeed_ui").setVisible(e.routerParams.q_010.had_won),e.seekWidgetByName("q_010_result_failed_ui").setVisible(!e.routerParams.q_010.had_won),e.seekWidgetByName(this._baseNodeName).animate("layer_in",!1),i.resolve()},_fillupPageSuccess:function(e,t){var n=e.seekWidgetByName(this._baseNodeName);n.seekWidgetByName("btn_next").setVisible(!1),n.seekWidgetByName("btn_prev").setVisible(!1);var i=e.routerParams.q_010.quest_id;this._fillupCommon(n,t,i),n.seekWidgetByName("get_items_label").setString(this._createItemString(t.items_gained)),this._fillPlayerSlider(e,t.raid_stats.mvp),n.setNodeDirty(),e.scheduleOnce(function(){n.seekWidgetByName("btn_next").setVisible(!0),n.seekWidgetByName("btn_prev").setVisible(!0)},.3)},_fillupPageFail:function(e,t){var n=e.seekWidgetByName(this._baseNodeName),i=e.routerParams.q_010.quest_id;this._fillupCommon(n,t,i)},_fillupCommon:function(e,i,a){var o=0===(i.raid_stats.quest_type||i.raid_stats.type||"").indexOf("event")?"event-quest":"raid-quest",r=t.Img("questimg",o,n.padZero(a,4),1).jpg;e.loadTextures({"questimg_raid-quest":r}),e.setStrings({raid_name_label:"Lv"+i.raid_stats.boss_lvl+" "+i.raid_stats.boss_name,date_label:" "+i.raid_stats.end_date,join_label:" "+i.raid_stats.participant_number+"",get_rank_label:"Rank"+i.points_gained.rank,get_exp_label:"EXP"+i.points_gained.experience,damage_no_label:n.isUndefined(i.raid_stats.damage_done)?"0":i.raid_stats.damage_done.toString()})},_createItemString:function(e){if(n.isUndefined(e))return"";var t=[];return n.each(e,function(e){t.push(e.name)}),t.join("/")},_onTouchUserButton:function(e,t,n){this._navigateToPrf001(t,n)},_touchEndedBackBtnProcess:function(e){this._navigateTo008()}}),n.assign(t.pc.quest.q_010.SceneDelegate.prototype,t.pc.quest.roles.QuestResultPlayerSlider,t.pc.quest.roles.Routing)}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.quest=t.pc.quest||{},t.pc.quest.q_011=t.pc.quest.q_011||{},t.pc.quest.q_011.Scene=t.BaseScene.extend({resourceFileName:"q_011/q_011.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[{tab1:{node:"tab_0","content-node":"tab_0_node"},tab2:{node:"tab_1","content-node":"tab_1_node"},tab3:{node:"tab_2","content-node":"tab_2_node"},tab4:{node:"tab_3","content-node":"tab_3_node"},tab5:{node:"tab_4","content-node":"tab_4_node"},tab6:{node:"tab_5","content-node":"tab_5_node"},tab7:{node:"tab_6","content-node":"tab_6_node"}}],componentName:"quest",sceneName:"q_011",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"main_raid_btn_back","btnCallbackMainRaidBtnBack",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"quest/q_portal_top")),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e._;t.pc=t.pc||{},t.createNameSpaceIfNotExists("pc.quest.q_011"),t.pc.quest.q_011.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../q_popup_ui.json"],NONELEMENTAL_TAB_EXCLAMATION_ICON_NAME:"new_icon",_popups:{ra_need_item:{factoryName:"QuestRequiredItemPopupFactoryRaNoItem"},comBackCheck:{factoryName:"popupFactoryComBackCheck"}},onSceneInit:function(e){return $staticRes(res["quest-q_011-q_011_questlist_page_ui"]),this._cleanUpPaymentId(),this.questSceneCommonDelegate=new t.QuestScenePcCommonDelegate,this.questSceneCommonDelegate.owner=e,this._verifyRouterParams006(e),this._setBackBtn(e),Q.all([this._initializeRaidQuestLists(),this._showBurstTimeCountdownPanel()]).spread(function(n){var i=n.getRaidQuestListByElementType(t.WordBook.ELEMENT_TYPE_LIST.nonelemental.num);if(i.hasQuests())for(var a=i.getQuests(),o=0;o<a.length;o++){var r=a[o];if(!r.isCleared())return void t.createInstance("questStateManager").startQuest(r.getQuestId(),"raid")}var s=n.getRaidQuestListByElementType(t.WordBook.ELEMENT_TYPE_LIST.phantom.num);e.seekWidgetByName(this.NONELEMENTAL_TAB_EXCLAMATION_ICON_NAME).setVisible(s.hasQuests()),this._initializeRaidButton(e).show(),this._showQuestInProgressPopup()}.bind(this))},onSceneEnter:function(e){return this._initializeRoleData()},onSceneExit:function(e){return this._raidQuestListsController.cleanUp(),Q.resolve()},onPageInAnimationEnd:function(e){return Q.defer(),Q.resolve()},tabCallbackTab0:function(e){this._onChangeTab(0)},tabCallbackTab1:function(e){this._onChangeTab(1)},tabCallbackTab2:function(e){this._onChangeTab(2)},tabCallbackTab3:function(e){this._onChangeTab(3)},tabCallbackTab4:function(e){this._onChangeTab(4)},tabCallbackTab5:function(e){this._onChangeTab(5)},tabCallbackTab6:function(e){this._onChangeTab(8)},update:function(){t.createInstance("sceneManager").reloadScene()},fillupQuestList:function(e,n,i){var a=t.PageListParams.MAIN_RAID_LIST,o=n.getRawQuestList(),r=n.getMaxRecordCount();this._fillupList(e,a,o,r,{targetNode:"quest_base",touchEventFuncName:"onTouchQuestPanel"},i)},fillupQuestPanel:function(e,t){var n=t.getRawQuest();this._initFuncQuestpanelCommon(e,n)},onTouchQuestPanel:function(e,t){this._raidQuestListsController.onTouchQuestPanel(e,t)},startQuest:function(e,t,n,i){this._navigate011To009(t,i)},btnCallbackMainRaidBtnBack:function(e){return Q.resolve()},_initializeRaidQuestLists:function(){return this._raidQuestListsController=t.createInstance("RaidQuestListsController",[this]),this._raidQuestListsController.initialize()},_initializeRaidButton:function(e){var n=e.routerParams;n.routing_quest_type="raid";var i=t.createInstance("RaidButtonController"),a=t.createInstance("questInfoModel");return i.setData(a),i.setRouterParams(n),i},_initializeRoleData:function(){var e=t.createInstance("questInfoModel"),n=t.createInstance("PlayerQuestPointsModel"),i=t.createInstance("PlayerMeModel");return Q.all([e.prepare(),n.prepare(),i.prepare()]).spread(function(e,t,n){this._questInfo=e.getRawData(),this._questPoints=t.getQuestPoints(),this._player=n.getRawData()}.bind(this))},_showBurstTimeCountdownPanel:function(){t.createInstance("BurstTimeCountDownPanel").show()},_showQuestInProgressPopup:function(){this.questSceneCommonDelegate.checkComApRestartPopup(this._questInfo)},_onChangeTab:function(e){var t=e;this._raidQuestListsController.showQuestList(t)},_touchEndedBackBtnProcess:function(e){t.createInstance("router").navigate("quest/q_portal_top")},clearOwnQuest:function(){delete this._questInfo.in_progress.own_quest}}),n.assign(t.pc.quest.q_011.SceneDelegate.prototype._popups,t.pc.quest.q_001.SceneDelegate.prototype._popups,t.pc.quest.roles.QuestSelectCommon.popups._popups,t.pc.quest.roles.QuestMainPageListPopups._popups),n.assign(t.pc.quest.q_011.SceneDelegate.prototype,t.pc.quest.roles.Routing,t.pc.quest.roles.QuestSelectCommon.methods,t.pc.quest.roles.QuestMainPageListController)}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e.console,t.createNameSpaceIfNotExists("quest.raid_quest_lists"),t.quest.raid_quest_lists.Controller=n.Class.extend({className:"RaidQuestListsController",WIDGET_NAMES:{LIST_PARENT:"tab_#_node"},ctor:function(e){this._initializeProgress=Q.defer(),this._sceneDelegate=e,this.questListControllerCache={},this._setRequiredItemPopupShowPanel()},initialize:function(){return this._fetchRaidQuestListsData().then(this._setRaidQuestListModel.bind(this)).then(this._showInitialState.bind(this)).then(function(){this._initializeProgress.resolve(this._raidQuestListsModel)}.bind(this)),this._initializeProgress.promise},showQuestList:function(e){this._initializeProgress.promise.then(function(){this._visibleQuestListElementType=e,this._createRaidQuestListController(e).showQuestList()}.bind(this))},onTouchQuestPanel:function(e,t){this._createRaidQuestListController(this._visibleQuestListElementType).onTouchQuestPanel(e,t)},cleanUp:function(){this._sceneDelegate=null,this._raidQuestListsModel=null,_.invoke(this.questListControllerCache,"cleanUp")},_setRaidQuestListModel:function(e){this._raidQuestListsModel=e},_setRequiredItemPopupShowPanel:function(){t.quest_required_item.DIConfigForPopupWithPanel.apply()},_fetchRaidQuestListsData:function(){return this._createRaidQuestListsRepository().getRaidQuestLists()},_showInitialState:function(){var e=this._createView();e.showInitialState(),e.cleanUp()},_createRaidQuestListsRepository:function(){return t.createInstance("RaidQuestListsRepository")},_createRaidQuestListController:function(e){if(this.questListControllerCache[e])return this.questListControllerCache[e];this.questListControllerCache[e]=t.createInstance("QuestListController",[this._sceneDelegate,this._getListParentNodeName()]);var n=this._raidQuestListsModel.getRaidQuestListByElementType(e);return this.questListControllerCache[e].setData(n),this.questListControllerCache[e]},_createView:function(){var e=n.director.getRunningScene();return t.createInstance("RaidQuestListsView",[e,this._raidQuestListsModel])},_getListParentNodeName:function(){return this.WIDGET_NAMES.LIST_PARENT.replace("#",this._tabNumberToElementType(this._visibleQuestListElementType))},_tabNumberToElementType:function(e){return 8===e?6:e}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("quest.raid_quest_lists"),t.quest.raid_quest_lists.Model=n.Class.extend({className:"RaidQuestListsModel",ctor:function(e){this._raidQuestLists=this._createRaidQuestLists(e)},getRaidQuestListByElementType:function(e){return this._raidQuestLists[e]},hasRaidQuests:function(){return _.some(this._raidQuestLists,function(e){return e.hasQuests()})},_createRaidQuestLists:function(e){return _.reduce(e,function(e,t){var n=this._createRaidQuestList(t);return e[t.element_type]=n,e}.bind(this),{})},_createRaidQuestList:function(e){return t.createInstance("QuestListModel",[e])}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e.console;t.createNameSpaceIfNotExists("quest.raid_quest_lists"),t.quest.raid_quest_lists.View=n.Class.extend({className:"RaidQuestListsView",WIDGET_NAMES:{LIST:"list_node",EMPTY:"nothing_node"},BTN_NAMES:{UP:"btn_up",DOWN:"btn_down"},ctor:function(e,t){this._parentWidget=e,this._raidQuestListsModel=t},showInitialState:function(){var e=this._raidQuestListsModel.hasRaidQuests();this._setNormalListWidget(e),this._setNothingListWidget(e)},cleanUp:function(){this._parentWidget=null,this._raidQuestListsModel=null},_setNormalListWidget:function(e){var t=e,n=this.WIDGET_NAMES.LIST,a=this._parentWidget.seekWidgetByName(n);return null==a?void i.warn("KHRaidQuestListsView._showWidgetByName: widget {"+n+"} not found!"):void a.setVisible(t)},_setNothingListWidget:function(e){var t=!e,n=this.WIDGET_NAMES.EMPTY,a=this._parentWidget.seekWidgetByName(n);return null==a?void i.warn("KHRaidQuestListsView._showWidgetByName: widget {"+n+"} not found!"):(a.setVisible(t),void this._setNothingListBtn(a))},_setNothingListBtn:function(e){var t=e.seekWidgetByName(this.BTN_NAMES.UP),n=e.seekWidgetByName(this.BTN_NAMES.DOWN);this._setBtnGrayout(t),this._setBtnGrayout(n)},_setBtnGrayout:function(e){e.setTouchEnabled(!1),e.setBright(!1)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e.console;t.createNameSpaceIfNotExists("quest.raid_quest_lists"),t.quest.raid_quest_lists.Repository=n.Class.extend({className:"RaidQuestListsRepository",getRaidQuestLists:function(){return this._getRaidQuestListsData().then(this._createRaidQuestListsModel.bind(this))},_getRaidQuestListsData:function(){return t.createInstance("apiAQuests").getListRaid().then(function(e){return e.body},function(e){i.error(e&&e.stack?e.stack:e)})},_createRaidQuestListsModel:function(e){return t.createInstance("RaidQuestListsModel",[e.raid_quest_lists])}})}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.quest=t.pc.quest||{},t.pc.quest.q_special_top=t.pc.quest.q_special_top||{},t.pc.quest.q_special_top.Scene=t.BaseScene.extend({resourceFileName:"q_special_top/q_special_top.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"quest",sceneName:"q_special_top",_delegate:null,_init:function(){this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._),i=e.Q;t.pc=t.pc||{},t.pc.quest=t.pc.quest||{},t.pc.quest.q_special_top=t.pc.quest.q_special_top||{},t.pc.quest.q_special_top.SceneDelegate=t.pc.BaseSceneDelegate.extend({_popups:{comBackCheck:{factoryName:"popupFactoryComBackCheck"}},onSceneInit:function(e){this._cleanUpPaymentId(),this.questSceneCommonDelegate=new t.QuestScenePcCommonDelegate,this.questSceneCommonDelegate.owner=e;var n=t.createInstance("routerParams").getRouterParams(),a=n.category,o=n.tab,r=t.createInstance("questListCollectionRepository");return t.quest_required_item.DIConfigForPopupWithPanel.apply(),i.all([r.getQuestListCollection(a),this._initializeRoleData(),this.__waitForNodesLoaded()]).spread(function(t){return this._showQuestInProgressPopup(),this._questList=t,o=o||t.getDefaultTab(),t.render(e,this,o)}.bind(this)).fail(console.error),this._setBackBtn(e),i.resolve()},onSceneEnter:function(e){return i.resolve()},onSceneExit:function(e){return this._questList&&this._questList.cleanUp(),i.resolve()},fillupQuestList:function(e,n,i){var a=t.PageListParams.QUEST_SPECIAL_LIST,o=n.getRawQuestList(),r=n.getMaxRecordCount();this._fillupList(e,a,o,r,{targetNode:"quest_base",touchEventFuncName:"onTouchQuestPanel"},i)},fillupQuestPanel:function(e,t){var n=t.getRawQuest();this._initFuncQuestpanelCommon(e,n)},onTouchQuestPanel:function(e,t){this._questList.validateQuest(e,t)},_touchEndedBackBtnProcess:function(e){t.createInstance("router").navigate("quest/q_portal_top")},_initializeRoleData:function(){var e=t.createInstance("questInfoModel"),n=t.createInstance("PlayerQuestPointsModel"),a=t.createInstance("PlayerMeModel");return i.all([e.prepare(),n.prepare(),a.prepare()]).spread(function(e,t,n){this._questInfo=e.getRawData(),this._questPoints=t.getQuestPoints(),this._player=n.getRawData()}.bind(this))},_showQuestInProgressPopup:function(){this.questSceneCommonDelegate.checkComApRestartPopup(this._questInfo)},startQuest:function(e,t,n,i){this._questList.startQuest(t,n,i)},clearOwnQuest:function(){delete this._questInfo.in_progress.own_quest},update:function(){t.createInstance("sceneManager").reloadScene()}}),n.assign(t.pc.quest.q_special_top.SceneDelegate.prototype._popups,t.pc.quest.q_001.SceneDelegate.prototype._popups,t.pc.quest.roles.QuestSelectCommon.popups._popups,t.pc.quest.roles.QuestMainPageListPopups._popups),n.assign(t.pc.quest.q_special_top.SceneDelegate.prototype,t.pc.quest.roles.Routing,t.pc.quest.roles.QuestSelectCommon.methods,t.pc.quest.roles.QuestMainPageListController)}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("tower.model"),t.tower.model.AMission=n.Class.extend({className:"AMission",_rawMission:null,ctor:function(e){this._rawMission=e},getTitle:function(){return this._rawMission.title},getDescription:function(){return this._rawMission.description},isCleared:function(){return this._rawMission.is_cleared},getRewardName:function(){return this._rawMission.reward_name},getRewardAmount:function(){return this._rawMission.reward_amount}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("tower.view"),t.tower.view.TowerQuestMissionDataPanel=n.Class.extend({className:"TowerQuestMissionDataPanel",_panelRootNode:null,NODE_NAMES:{TITLE_LABEL:"mission_title_label",NOT_ACHIEVED_ICON:"not_achieved_icon",MISSION_CLEAR_ICON:"mission_clear_icon",DESCRIPTION_LABEL:"mission_info_label",REWARD_LABEL:"reword_item_label"},ctor:function(e){this._panelRootNode=e},update:function(e){this._setLabel(this.NODE_NAMES.TITLE_LABEL,e.getTitle()),this._setLabel(this.NODE_NAMES.DESCRIPTION_LABEL,e.getDescription());var t=e.getRewardName()+""+e.getRewardAmount();this._setLabel(this.NODE_NAMES.REWARD_LABEL,t),this._setClearIcon(e)},_setClearIcon:function(e){var t=e.isCleared(),n=this._panelRootNode.seekWidgetByName(this.NODE_NAMES.MISSION_CLEAR_ICON),i=this._panelRootNode.seekWidgetByName(this.NODE_NAMES.NOT_ACHIEVED_ICON);n.setVisible(t),i.setVisible(!t)},_setLabel:function(e,t){var n=this._panelRootNode.seekWidgetByName(e);null!==n&&(n.setString(""+t),n.setVisible(!0))}})}((this||0).self||global),function(e){var t=e.kh;e.khutil,e.cc,e.ccui,e._,e.console,t.createNameSpaceIfNotExists("tower.view"),t.tower.view.TowerQuestResultPopup=t.ImplantedPopup.extend({className:"TowerQuestResultPopup",NODE_NAMES:{TOTAL_NUM_LABEL:"total_num_label",MISSION_MEDAL_LABEL:"num_label_0",CLEAR_TURN_BONUS_LABEL:"num_label_1",CLEAR_TURN_LABEL:"clear_turn_num_label"},MISSION_DATA_UI_NODE_NAME_PREFIX:"tower_quest_mission_data_ui_",_initContents:function(e){this.setButtonEvents({btn_ok:!0});var n=e.mission_bonus,i=e.clear_turn_bonus;this._setLabel(this.NODE_NAMES.TOTAL_NUM_LABEL,n+i),this._setLabel(this.NODE_NAMES.MISSION_MEDAL_LABEL,n),this._setLabel(this.NODE_NAMES.CLEAR_TURN_BONUS_LABEL,i),this._setLabel(this.NODE_NAMES.CLEAR_TURN_LABEL,e.clear_turn),e.missions.forEach(function(e,n){var i=this.getNode().seekWidgetByName(this.MISSION_DATA_UI_NODE_NAME_PREFIX+n);if(i){var a=new t.tower.model.AMission(e);new t.tower.view.TowerQuestMissionDataPanel(i).update(a)}}.bind(this))},_setLabel:function(e,t){var n=this.getNode().seekWidgetByName(e);n.setString(""+t),n.setVisible(!0)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("quest_list"),t.quest_list.Controller=n.Class.extend({className:"QuestListController",ctor:function(e,t){this._sceneDelegate=e,this._listParentWidgetName=t,this._view=this._createView()},fetchData:function(e,t){return this._createQuestListRepository().getQuestList(e,t).then(function(e){return this._questListModel=e,e})},setData:function(e){this._questListModel=e},showQuestList:function(){this._view.showQuestList(this._questListModel,this.showQuestPanel.bind(this))},showQuestPanel:function(e,t){var n=this._getQuestModelById(t.quest_id),i=this._createQuestPanelController(e,n);i.showQuestPanel(e),i.cleanUp()},onTouchQuestPanel:function(e,t){var n=this._getQuestModelById(t.quest_id),i=this._createQuestPanelController(e,n);i.onTouchQuestPanel().then(i.cleanUp.bind(i))},cleanUp:function(){this._sceneDelegate=null,this._questListModel=null,this._view.cleanUp()},_getRootWidgetPath:function(){return this._listParentWidgetName},_createView:function(){var e=this._getRootWidgetPath();return t.createInstance("QuestListView",[this._sceneDelegate,e])},_getQuestModelById:function(e){return this._questListModel.getQuestModelById(e)},_createQuestPanelController:function(e,n){return t.createInstance("QuestPanelController",[this._sceneDelegate,e,n])},_createQuestListRepository:function(){return t.createInstance("QuestListRepository")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("quest_list"),t.quest_list.Model=n.Class.extend({className:"QuestListModel",ctor:function(e){this._rawQuestLists=e.data,this._quests=this._createQuests(e.data),this._maxRecordCount=e.max_record_count},getQuests:function(){return this._quests},getMaxRecordCount:function(){return this._maxRecordCount},getRawQuestList:function(){return this._rawQuestLists},containsQuest:function(e){return _.some(this._quests,function(t){return t.getQuestId()===e})},hasQuests:function(){return this._quests.length>0},getQuestModelById:function(e){return _.find(this._quests,function(t){return t.getQuestId()===e})},_createQuests:function(e){return _.map(e,function(e){return t.createInstance("QuestModel",[e])})}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e.console;t.createNameSpaceIfNotExists("quest_list"),t.quest_list.View=n.Class.extend({className:"QuestListView",ctor:function(e,t){this._sceneDelegate=e,this._rootWidgetPath=t},showQuestList:function(e,t){if(!this._isRendered){var n=this._getRootNode();if(!n)return void i.warn("KHQuestListView.showQuestList: rootNode not found!");this._sceneDelegate.fillupQuestList(n,e,t),this._isRendered=!0}},cleanUp:function(){this._sceneDelegate=null},_getRootNode:function(){var e=n.director.getRunningScene();return i.log(this._rootWidgetPath),e.seekWidgetByPath(this._rootWidgetPath)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e.console;t.createNameSpaceIfNotExists("quest_list"),t.quest_list.Repository=n.Class.extend({className:"QuestListRepository",getQuestList:function(e,t){var n={main:this._getMainQuestList,free:this._getFreeQuestList,special:this._getSpecialQuestList,event:this._getEventQuestList,event_scenario:this._getEventScenarioQuestList,event_not_scenario:this._getEventNotScenarioQuestList,"harem-character":this._getHaremByCharacterList,"harem-summon":this._getHaremBySummonList,"harem-job":this._getHaremByJobList}[e];return null==n?(i.warn("QuestListRepository.getQuestList: listType not found!"),null):n.call(this,t)},_getMainQuestList:function(){return this._getApiAAreas().getMainQuestsInCurrentArea().then(this._createQuestList.bind(this))},_getFreeQuestList:function(){return this._getApiAAreas().getFreeQuestsInCurrentArea().then(this._createQuestList.bind(this))},_getSpecialQuestList:function(){return this._getApiAQuests().getListSpecialQuest().then(this._createQuestList.bind(this))},_getEventQuestList:function(e){return this._getApiAQuests().getListEventQuest(e).then(this._createQuestList.bind(this))},_getEventScenarioQuestList:function(e){return this._getApiAQuests().getListEventScenarioQuest(e).then(this._createQuestList.bind(this))},_getEventNotScenarioQuestList:function(e){return this._getApiAQuests().getListEventNotScenarioQuest(e).then(this._createQuestList.bind(this))},_getHaremByCharacterList:function(e){return this._getApiAQuests().getListHaremByCharacter(e).then(this._createQuestList.bind(this))},_getHaremBySummonList:function(e){return this._getApiAQuests().getListHaremBySummon(e).then(this._createQuestList.bind(this))},_getHaremByJobList:function(e){return this._getApiAQuests().getListHaremBySummon(e).then(this._createQuestList.bind(this))},_getApiAAreas:function(){return t.createInstance("apiAAreas")},_getApiAQuests:function(){return t.createInstance("apiAQuests")},_createQuestList:function(e){return t.createInstance("QuestListModel",[e])}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("quest_panel"),t.quest_panel.Controller=n.Class.extend({className:"QuestPanelController",ctor:function(e,t,n){this._sceneDelegate=e,this._panelWidget=t,this._questModel=n,this._view=this._createView()},showQuestPanel:function(){this._view.showQuestPanel(this._questModel),this._createRequiredItemController().showRequiredItem()},setTouchEnabled:function(e){this._getTouchEventNode().setTouchEnabled(e)},onTouchQuestPanel:function(){var e=this._questModel.getRawQuest();return this._verifyQuestInProgress(e).then(this._verifyRequiredItem.bind(this)).then(this._startQuest.bind(this,e))},cleanUp:function(){this._sceneDelegate=null,this._questModel=null,this._panelWidget=null,this._view.cleanUp()},_createView:function(){return t.createInstance("QuestPanelView",[this._sceneDelegate,this._panelWidget])},_getRawQuestInfo:function(){return t.createInstance("questInfoModel").getRawData()},_createRequiredItemController:function(){return t.createInstance("QuestRequiredItemController",[this._sceneDelegate,this._questModel,this._panelWidget])},_verifyQuestInProgress:function(e){return this._sceneDelegate.questSceneCommonDelegate.restartCheckInProgressQuest(e,this._getRawQuestInfo())?Q.reject():Q.resolve()},_verifyRequiredItem:function(){return this._createRequiredItemController().verifyRequiredItem()},_startQuest:function(e){var t=n.director.getRunningScene();this._sceneDelegate.startCheckQuestState(t,e)},_getTouchEventNode:function(){return this._panelWidget}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("quest_panel"),t.quest_panel.Model=n.Class.extend({className:"QuestModel",ctor:function(e,t){this._rawQuest=e,this._questListIndex=t},getRawQuest:function(){return this._rawQuest},getQuestId:function(){return this._rawQuest.quest_id},getQuestListIndex:function(){return this._questListIndex},getRequiredItem:function(){var e=this._rawQuest.required_item;return t.createInstance("QuestRequiredItemModel",[e])},getTitle:function(){return this._rawQuest.title},hasChallengeLimit:function(){return null!=this._rawQuest.limit_info&&null!=this._rawQuest.limit_info.remaining_challenge_count},getRemainingChallengeCount:function(){return this._rawQuest.limit_info.remaining_challenge_count},isCleared:function(){return!0===this._rawQuest.is_cleared}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e.console,t.createNameSpaceIfNotExists("quest_panel"),t.quest_panel.View=n.Class.extend({className:"QuestPanelView",ctor:function(e,t){this._sceneDelegate=e,this._panelWidget=t},showQuestPanel:function(e){this._sceneDelegate.fillupQuestPanel(this._panelWidget,e)},cleanUp:function(){this._sceneDelegate=null,this._panelWidget=null}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("quest_required_item"),t.quest_required_item.Controller=n.Class.extend({className:"QuestRequiredItemController",ctor:function(e,t,n){this._sceneDelegate=e,this._questModel=t,this._parentWidget=n},showRequiredItem:function(){var e=this._createRequiredItemView(),t=this._getRequiredItemModel();e.showRequiredItem(t)},verifyRequiredItem:function(){return this._createRequiredItemVerificationController().verifyRequiredItem()},_createRequiredItemView:function(){return t.createInstance("QuestRequiredItemView",[this._sceneDelegate,this._parentWidget])},_getRequiredItemModel:function(){return this._questModel.getRequiredItem()},_createRequiredItemVerificationController:function(){return t.createInstance("QuestRequiredItemVerificationController",[this._sceneDelegate,this._questModel])}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("quest_required_item"),t.quest_required_item.VerificationController=n.Class.extend({className:"QuestRequiredItemVerificationController",ctor:function(e,t){this._sceneDelegate=e,this._questModel=t,this._requiredItemModel=t.getRequiredItem()},verifyRequiredItem:function(){return this._hasRequiredItem()?this._hasEnoughRequiredItems()?(this._replaceSufficientRequiredItemsPopupInvoker(),Q.resolve()):(this._replaceInsufficientItemsPopupInvoker(),Q.resolve()):(this._replaceNoRequiredItemsPopupInvoker(),Q.resolve())},_hasRequiredItem:function(){return this._requiredItemModel.hasRequiredItem()},_hasEnoughRequiredItems:function(){var e=this._requiredItemModel.getRequiredAmount();return this._requiredItemModel.getPossessedAmount()>=e},_showSufficientRequiredItemsPopup:function(){return t.createInstance("QuestRequiredItemPopupNeedItem").open(this._sceneDelegate,this._questModel)},_showInsufficientRequiredItemsPopup:function(){return t.createInstance("QuestRequiredItemPopupNoItem").open(this._sceneDelegate,this._questModel)},_replaceNoRequiredItemsPopupInvoker:function(){this._sceneDelegate._requiredItemPopup=function(){return!1}},_replaceSufficientRequiredItemsPopupInvoker:function(){this._sceneDelegate._requiredItemPopup=function(){var e=n.director.getRunningScene();return this._showSufficientRequiredItemsPopup().then(this._sceneDelegate.selectQuest.bind(this._sceneDelegate,e)),!0}.bind(this)},_replaceInsufficientItemsPopupInvoker:function(){this._sceneDelegate._requiredItemPopup=function(){return n.director.getRunningScene(),this._showInsufficientRequiredItemsPopup(),!0}.bind(this)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("quest_required_item"),t.quest_required_item.Model=n.Class.extend({className:"QuestRequiredItemModel",ctor:function(e){this._rawRequiredItemData=e},hasRequiredItem:function(){return!_.isEmpty(this._rawRequiredItemData)},getItemId:function(){return this._rawRequiredItemData.item_id},getItemName:function(){return this._rawRequiredItemData.name},getRequiredAmount:function(){return this._rawRequiredItemData.amount},getPossessedAmount:function(){return this._rawRequiredItemData.possession_amount},hasEnoughRequiredItems:function(){var e=this.getRequiredAmount();return this.getPossessedAmount()>=e}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("quest_required_item"),t.quest_required_item.View=n.Class.extend({className:"QuestRequiredItemView",WIDGET_NAMES:{SHADES:["red_shadow","need_item_base"],NAME_LABEL:"need-item_name_label",COST_LABEL:"need-item_cost_label"},APPEARANCE_NAMES:{SHOW:"need_item_on",HIDE:"need_item_off"},ctor:function(e,t){this._sceneDelegate=e,this._panelWidget=t},showRequiredItem:function(e){var i=this._panelWidget;if(e.hasRequiredItem()){this._setTextToLabels(e);var a=this._hasEnoughRequiredItems(e);i.setColor(a?n.color.WHITE:t.GameConfig.UI_GREYOUT_COLOR),this._showRequiredItemInfo()}else this._hideRequiredItemInfo()},cleanUp:function(){this._sceneDelegate=null,this._panelWidget=null},_setTextToLabels:function(e){var t=this._getWidgetByName(this.WIDGET_NAMES.NAME_LABEL),n=this._getWidgetByName(this.WIDGET_NAMES.COST_LABEL),i=e.getItemName(),a=e.getRequiredAmount();t.setString(i),n.setString(""+(a||"-"))},_hideRequiredItemInfo:function(){this._setAppearance(this.APPEARANCE_NAMES.HIDE)},_showRequiredItemInfo:function(){this._setAppearance(this.APPEARANCE_NAMES.SHOW)},_hasEnoughRequiredItems:function(e){var t=e.getRequiredAmount();return e.getPossessedAmount()>=t},_getRequiredItemRootNode:function(){return _(this.WIDGET_NAMES.SHADES).map(this._getWidgetByName.bind(this)).find(_.isObject).getParent()},_getWidgetByName:function(e){var t=this._panelWidget.seekWidgetByName(e);return null==t?(console.warn("KHQuestRequiredItemView._getWidgetByName: widget {"+e+"} not found!"),null):t},_setAppearance:function(e){this._getRequiredItemRootNode().setAppearance(e)}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,t.quest_required_item.View.prototype);t.createNameSpaceIfNotExists("quest_required_item"),t.quest_required_item.ViewForSingleNodeText=t.quest_required_item.View.extend({className:"QuestRequiredItemViewForSingleNodeText",WIDGET_NAMES:_.assign(_.clone(n.WIDGET_NAMES),{NAME_LABEL:"name_use_label"}),_setTextToLabels:function(e){var t=this._getWidgetByName(this.WIDGET_NAMES.NAME_LABEL),n=e.getItemName(),i=e.getRequiredAmount();t.setString(n+" "+(i||"-"))},_hideRequiredItemInfo:function(){},_showRequiredItemInfo:function(){}})}((this||0).self||global),function(e){var t=e._,n=e.kh;n.createNameSpaceIfNotExists("quest_required_item.popup"),n.quest_required_item.popup.FactoryRaNoItem=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-ra_no_item",title:"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){this.clearData(),this.dismiss(),this._confirm()}}},WIDGET_PATHS:{QUEST_PANEL:"com_need_item_list_ui"},POPUP_METHODS:{setQuestModel:function(e){this._questModel=e},getQuestModel:function(){return this._questModel},setSceneDelegate:function(e){this._sceneDelegate=e},setOnConfirmCallback:function(e){this._onConfirmCallback=e},setOnCancelCallback:function(e){this._onCancelCallback=e},showQuestPanel:function(){n.createInstance("QuestRequiredItemPopupPanel").showQuestPanel(this._sceneDelegate,this._getQuestPanelWidget(),this._questModel)},showRequiredItemText:function(){n.createInstance("QuestRequiredItemPopupText").showRequiredItemText(this,this._questModel)},clearData:function(){this._clearRequiredItemText(),this._clearQuestPanel()},_clearQuestPanel:function(){n.createInstance("QuestRequiredItemPopupPanel").clearQuestPanel()},_confirm:function(){t.isFunction(this._onConfirmCallback)&&this._onConfirmCallback()},_cancel:function(){t.isFunction(this._onCancelCallback)&&this._onCancelCallback()},_clearRequiredItemText:function(){n.createInstance("QuestRequiredItemPopupText").clearRequiredItemText(this)},_getQuestPanelWidget:function(){var e=this.seekWidgetByName(this.WIDGET_PATHS.QUEST_PANEL);return null==e?(console.warn("KHPopupFactoryRaNoItem._getQuestPanelWidget: widget not found"),null):e}},onPopupOpened:function(e,t){null!=t&&(e.WIDGET_PATHS=this.WIDGET_PATHS,e.setSceneDelegate(t.sceneDelegate),e.setQuestModel(t.questModel),e.setOnConfirmCallback(t.onConfirmCallback),e.showRequiredItemText())},_addMethodsToPopup:function(e){n.PopupFactoryPopupCommon.prototype._addMethodsToPopup.call(this,e),t.assign(e,this.POPUP_METHODS)}})}((this||0).self||global),function(e){var t=(e._,e.kh);t.createNameSpaceIfNotExists("quest_required_item.popup"),t.quest_required_item.popup.ComRaidStartCheck=t.ImplantedPopup.extend({className:"QuestRequiredItemPopupComRaidStartCheck",BUTTON_NAMES:{CANCEL:"btn_cancel",CONFIRM:"btn_challenge"},WIDGET_NAMES:{REQUIRED_ITEM_LABEL:"need_item_labelimg",CHALLENGE_TIMES_LABEL:"challenging_times_labelimg"},APPEARANCE_NAMES:{CHALLENGE_TIMES_VISIBLE:"challenging_times_on",CHALLENGE_TIMES_HIDDEN:"challenging_times_off"},showQuestPanel:function(){this._waitForInit().then(function(){t.createInstance("QuestRequiredItemPopupPanel").showQuestPanel(this._sceneDelegate,this.getNode(),this._questModel)}.bind(this))},_initButtons:function(){var e={};e[this.BUTTON_NAMES.CANCEL]=this.dismiss.bind(this,!1),e[this.BUTTON_NAMES.CONFIRM]=this.dismiss.bind(this,!0),this.setButtonEvents(e)},_initContents:function(e,t){this._sceneDelegate=e,this._questModel=t,this._initButtons(),this._showRequiredItemText(t),this._handleChallengeCount(t)},_showRequiredItemText:function(e){var n=this._getNodeByName(this.WIDGET_NAMES.REQUIRED_ITEM_LABEL);t.createInstance("QuestRequiredItemPopupText").showRequiredItemText(n,e)},_handleChallengeCount:function(e){return e.hasChallengeLimit()?(this._showChallengeCountText(e),void this._setAppearance(this.APPEARANCE_NAMES.CHALLENGE_TIMES_VISIBLE)):void this._setAppearance(this.APPEARANCE_NAMES.CHALLENGE_TIMES_HIDDEN)},_showChallengeCountText:function(e){var n=e.getRemainingChallengeCount(),i={};i[this.WIDGET_NAMES.CHALLENGE_TIMES_LABEL]=this._getChallengeCountText(n),this.getNode().setHtmlStrings(i,t.GameConfig.POPUP_CSS)},_clearContents:function(){this._clearRequiredItemText(),this._clearRequiredItemText()},_clearQuestPanel:function(){t.createInstance("QuestRequiredItemPopupPanel").clearQuestPanel()},_clearRequiredItemText:function(){t.createInstance("QuestRequiredItemPopupText").clearRequiredItemText(this)},_setAppearance:function(e){this.getNode().setAppearance(e)},_getNodeByName:function(e){var t=this.getNode().seekWidgetByName(e);return null==e&&console.warn("KHMyTimeLimitTicketCautionPopup._getNode: node '"+e+"' not found."),t},_getChallengeCountText:function(e){return"<div><span class='red'>"+e+"</span></div>"}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("quest_required_item.popup"),t.quest_required_item.popup.Panel=n.Class.extend({showQuestPanel:function(e,t,n){this._createQuestPanelController(e,t,n).showQuestPanel()},clearQuestPanel:function(){},_createQuestPanelController:function(e,n,i){var a=t.createInstance("QuestPanelController",[e,n,i]);return a.setTouchEnabled(!1),a}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("quest_required_item.popup"),t.quest_required_item.popup.Text=n.Class.extend({className:"QuestRequiredItemPopupText",WIDGET_PATHS:{NEED_ITEM_LABEL:"need_item_labelimg"},showRequiredItemText:function(e,n){var i={};i[this.WIDGET_PATHS.NEED_ITEM_LABEL]=this._createRequiredItemText(n),e.setHtmlStrings(i,t.GameConfig.POPUP_CSS)},clearRequiredItemText:function(e){var n={};n[this.WIDGET_PATHS.NEED_ITEM_LABEL]="",e.setHtmlStrings(n,t.GameConfig.POPUP_CSS)},_createRequiredItemText:function(e){var t=e.getRequiredItem(),n=e.getTitle(),i=t.getItemName(),a=t.getRequiredAmount(),o=t.getPossessedAmount(),r=o-a,s="<span class='white'>"+n+"         <br/><span class='yellow'>"+i+"</span>        <span class='yellow'>"+a+"</span> <br/>        <div style='margin: 0.5em 0;'><span class='orange'></span>"+o;return r>=0&&(s+="&rarr;<span class='orange'>"+r+"</span>"),s+"</div></span>"}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("quest_required_item.popup"),t.quest_required_item.popup.Wrapper=n.Class.extend({className:"QuestRequiredItemPopupWrapper",POPUP_DI_ID:"",POPUP_NAME:"",open:function(e,t){var n=Q.defer(),i=this._createPopup(),a=n.resolve.bind(n),o=n.reject.bind(n),r=this._createPopupParameters(e,t,a,o);return i.open(r).then(this._onOpen.bind(this,i)),n.promise},_onOpen:function(){},_createPopup:function(){var e=n.director.getRunningScene();return e.popups.POPUP_NAME?e.popups.POPUP_NAME:t.createInstance(this.POPUP_DI_ID).create({})},_createPopupParameters:function(e,t,n,i){var a={};return a.sceneDelegate=e,a.questModel=t,a.onConfirmCallback=n,a.onCancelCallback=i,a}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("quest_required_item.popup"),t.quest_required_item.popup.ImplantedWrapper=n.Class.extend({className:"QuestRequiredItemPopupImplantedWrapper",POPUP_DI_ID:"",POPUP_NAME:"",open:function(e,t){var n=this._createPopup(),i=n.open(e,t);return this._onOpen(n),i},_onOpen:function(e){},_createPopup:function(){return t.ImplantedPopup.createOrGet(n.director.getRunningScene(),this.POPUP_NAME,this.POPUP_DI_ID)}})}((this||0).self||global),function(e){var t=e.kh;e.cc,t.createNameSpaceIfNotExists("quest_required_item.popup"),t.quest_required_item.popup.NeedItem=t.quest_required_item.popup.ImplantedWrapper.extend({className:"QuestRequiredItemPopupNeedItem",POPUP_DI_ID:"QuestRequiredItemPopupComRaidStartCheck",POPUP_NAME:"com_raid_start_check",_onOpen:function(){}})}((this||0).self||global),function(e){var t=e.kh;t.createNameSpaceIfNotExists("quest_required_item.popup"),t.quest_required_item.popup.NeedItemWithPanel=t.quest_required_item.popup.NeedItem.extend({className:"QuestRequiredItemPopupNeedItemWithPanel",_onOpen:function(e){e.showQuestPanel()}})}((this||0).self||global),function(e){var t=e.kh;e.cc,t.createNameSpaceIfNotExists("quest_required_item.popup"),t.quest_required_item.popup.NoItem=t.quest_required_item.popup.Wrapper.extend({className:"QuestRequiredItemPopupNoItem",POPUP_DI_ID:"QuestRequiredItemPopupFactoryRaNoItem",POPUP_NAME:"ra_no_item",_onOpen:function(){}})}((this||0).self||global),function(e){var t=e.kh;e.cc,t.createNameSpaceIfNotExists("quest_required_item.popup"),t.quest_required_item.popup.NoItemWithPanel=t.quest_required_item.popup.NoItem.extend({className:"QuestRequiredItemPopupNoItemWithPanel",_onOpen:function(e){e.showQuestPanel()}})}((this||0).self||global),function(e){var t=e.kh,n=e.di;t.dictx=t.dictx||n.createContext(),t.createNameSpaceIfNotExists("quest_required_item"),t.quest_required_item.DIConfigForPopupWithPanel={apply:function(){var e={QuestRequiredItemPopupNeedItem:t.quest_required_item.popup.NeedItemWithPanel,QuestRequiredItemPopupNoItem:t.quest_required_item.popup.NoItemWithPanel};t.dictx.injectDependent({},e)}}}((this||0).self||global),function(e){var t=e.kh,n=e.di;t.dictx=t.dictx||n.createContext(),t.createNameSpaceIfNotExists("quest_required_item"),t.quest_required_item.DIConfigForPanelWithSingleNodeText={apply:function(){var e={QuestRequiredItemView:t.quest_required_item.ViewForSingleNodeText};t.dictx.injectDependent({},e)},revert:function(){var e={QuestRequiredItemView:t.quest_required_item.View};t.dictx.injectDependent({},e)}}}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e.console;t.createNameSpaceIfNotExists("raid_button"),t.raid_button.Controller=n.Class.extend({className:"RaidButtonController",BUTTON_NAMES:{ACTIVE:"btn_raid_01",ASLEEP:"btn_raid_02"},ctor:function(){this._raidButtonView=this._createRaidButtonView(),this._initButtonCallbacks()},fetchData:function(){return this._questInfoModel=this._createQuestInfoModel(),this._prepareQuestInfoModel()},setData:function(e){this._questInfoModel=e},setRouterParams:function(e){this._routerParams=e},show:function(){var e=this._questInfoModel.hasNewRaidRequest(),t=this._questInfoModel.hasUnverified();this._raidButtonView.show(e,t)},disable:function(){this._raidButtonView.disable()},_createQuestInfoModel:function(){return t.createInstance("questInfoModel")},_prepareQuestInfoModel:function(){return this._questInfoModel.prepare()},_createRaidButtonView:function(){return t.createInstance("RaidButtonView")},_initButtonCallbacks:function(){this._setButtonTouchEvent(this.BUTTON_NAMES.ACTIVE,this._onClickActiveButton,this),this._setButtonTouchEvent(this.BUTTON_NAMES.ASLEEP,this._onClickAsleepButton,this)},_onClickActiveButton:function(){var e=this._questInfoModel.hasUnverified()?"unclaimed":"arrival",n=this._routerParams.routing_quest_type;t.createInstance("router").navigate("quest/q_006",{tab:e,routing_quest_type:n})},_onClickAsleepButton:function(){var e=this._routerParams.routing_quest_type;t.createInstance("router").navigate("quest/q_006",{routing_quest_type:e})},_setButtonTouchEvent:function(e,t,a){var o=n.director.getRunningScene().seekWidgetByName(e);return null==o?void i.warn("KHRaidButtonController._setButtonTouchEvent: button {"+e+"} not found!"):void o.addTouchEventListener(t,a)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;t.model=t.model||{},t.model.QuestInfo=n.Class.extend({prepare:function(){return this._getQuestInfoPromise().then(function(e){return this._data=e.body,this}.bind(this))},_getQuestInfoPromise:function(){return t.createInstance("apiAQuestInfo").get().fail(function(e){console.warn(e.stack)})},getRawData:function(){return null==this._data&&window.alert("[QuestInfo::getRawData]\nYou must call prepare first!"),this._data},getHelpJoinedCount:function(){null==this._data&&window.alert("[QuestInfo::getHelpJoinedCount]\nYou must call prepare first!");var e=this._data.in_progress||{},t=(e.own_raid||{}).a_battle_id||0,n=e.help_raid_ids||[];return i.reduce(n,function(e,n){return e+(n!==t?1:0)},0)},hasNewRaidRequest:function(){return null==this._data&&window.alert("[QuestInfo::hasNewRaidRequest]\nYou must call prepare first!"),this._data.has_new_raid_request},hasUnverified:function(){return null==this._data&&window.alert("[QuestInfo::hasUnverified]\nYou must call prepare first!"),this._data.has_unverified},hasTemporaryQuests:function(){return null==this._data&&window.alert("[QuestInfo::hasUnverified]\nYou must call prepare first!"),this._data.has_temp_quest},isInProgressOwnRaidQuest:function(e){null==this._data&&window.alert("[QuestInfo::isInProgressRaidQuest]\nYou must call prepare first!");var t=this._data.in_progress;return null!=t&&null!=t.own_raid&&e===t.own_raid.a_quest_id},isInProgressOwnQuest:function(e,t){null==this._data&&window.alert("[QuestInfo::isInProgressQuest]\nYou must call prepare first!");var n=this._data.in_progress;return null!=n&&null!=n.own_quest&&e===n.own_quest.a_quest_id&&t===n.own_quest.type}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.view=t.view||{},t.view.RaidButton=t.SceneObject.extend({show:function(e,t){!1!==this._enabled&&(this._showRaidBtn(),e?this._animateRaidEffect():this._setAppearanceDefault(),t?this._showInfoIcon():this._hideInfoIcon())},disable:function(){var e=this._getRaidBtnUi();null!==e&&(e.setVisible(!1),this._enabled=!1)},_showInfoIcon:function(){var e=this._getInfoIconNode();null!==e&&e.setVisible(!0)},_hideInfoIcon:function(){var e=this._getInfoIconNode();null!==e&&e.setVisible(!1)},_animateRaidEffect:function(){var e=this._getRaidBtnUi();null!==e&&e.animate("raid_effect_start",!0)},_setAppearanceDefault:function(){var e=this._getRaidBtnUi();null!==e&&e.setAppearance("default_view")},_showRaidBtn:function(){var e=this._getRaidBtnUi();null!==e&&e.setVisible(!0)},_getRaidBtnUi:function(){return cc.director.getRunningScene().seekWidgetByName("raid_ui")},_getInfoIconNode:function(){var e=this._getRaidBtnUi();return null===e?null:e.seekWidgetByName("info_icon")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("sp_quest_button"),t.sp_quest_button.Controller=n.Class.extend({className:"SpQuestButtonController",fetchData:function(){t.createInstance("questInfoModel").prepare().then(function(e){return this.setData(e),e}.bind(this))},setData:function(e){this._questInfoModel=e},showSpQuestButton:function(){this._handleExclamationIcon()},_handleExclamationIcon:function(){var e=this._questInfoModel.hasTemporaryQuests();this._createSpQuestButtonView().setExclamationIconVisible(e)},_createSpQuestButtonView:function(){return t.createInstance("SpQuestButtonView",[this._questInfoModel])}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e.console;t.createNameSpaceIfNotExists("sp_quest_button"),t.sp_quest_button.View=n.Class.extend({className:"SpQuestButtonView",WIDGET_NAMES:{ICON:"icon_sp_quest_uncon"},setExclamationIconVisible:function(e){this._setWidgetVisibleByName(this.WIDGET_NAMES.ICON,e)},_setWidgetVisibleByName:function(e,t){var n=this._getWidgetByName(e);return null==n?void i.warn("KHSpQuestButtonView: widget {"+e+"} not found!"):void n.setVisible(t)},_getWidgetByName:function(e){return n.director.getRunningScene().seekWidgetByName(e)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("player_currency"),t.player_currency.Model=n.Class.extend({className:"PlayerCurrencyModel",ctor:function(e){this._playerCurrencyData=e},getGemAmount:function(){return this._playerCurrencyData.gem},getJobPointAmount:function(){return this._playerCurrencyData.job_point},getStoneAmount:function(){return this._playerCurrencyData.stone},getPseudoCurrencyAmount:function(){return this._playerCurrencyData.pseudo_currency},getAccessoryPointAmount:function(){return this._playerCurrencyData.accessory_point},getSummonOrbAmount:function(){return this._playerCurrencyData.summon_orb},getRawData:function(){return this._playerCurrencyData}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e.console;t.createNameSpaceIfNotExists("player_currency"),t.player_currency.Repository=n.Class.extend({className:"PlayerCurrencyRepository",getMyCurrency:function(){return t.createInstance("apiAPlayers").getCurrency().then(this._createPlayerCurrencyModel).fail(function(e){i.error(e&&e.stack?e.stack:e)})},_createPlayerCurrencyModel:function(e){return t.createInstance("PlayerCurrencyModel",[e.body])}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("player_currency"),t.player_currency.Preloader=n.Class.extend({className:"PlayerCurrencyPreloader",CACHE_KEY:"_myCurrency",preloadMyCurrency:function(){return this.getMyCurrency()},getMyCurrency:function(){return null==this[this.CACHE_KEY]&&(this[this.CACHE_KEY]=t.createInstance("PlayerCurrencyRepository").getMyCurrency()),this[this.CACHE_KEY]},clear:function(){this[this.CACHE_KEY]=null}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e.ccui,a=e.khutil,o=e.console;t.createNameSpaceIfNotExists("restore_item_vending_process"),t.restore_item_vending_process.BuyButtonController=n.Class.extend({className:"RestoreItemBuyButtonController",BUTTON_NAMES:{PSEUDO_CURRENCY_BUY:"btn_coin_shop",PSEUDO_CURRENCY_EXCHANGE:"btn_coin_change",STONE_EXCHANGE:"btn_stone_change"},ctor:function(e){this._rootNode=e},initializeButtons:function(e,t){this._enableExchangeWithPseudoCurrencyButton(e),this._enableExchangeWithStonesButton(t),this._setButtonCallbacks()},setOnExchangeWithStoneCallback:function(e,t){this._onExchangeWithStoneCallback=e.bind(t)},setOnExchangeWithPseudoCurrencyCallback:function(e,t){this._onExchangeWithPseudoCurrencyCallback=e.bind(t)},setOnBuyPseudoCurrencyCallback:function(e,t){this._onBuyPseudoCurrencyCallback=e.bind(t)},_enableExchangeWithPseudoCurrencyButton:function(e){var t=this._getWidget(this.BUTTON_NAMES.PSEUDO_CURRENCY_EXCHANGE),n=this._getWidget(this.BUTTON_NAMES.PSEUDO_CURRENCY_BUY);t.setVisible(e),n.setVisible(!e)},_enableExchangeWithStonesButton:function(e){var n=this._getWidget(this.BUTTON_NAMES.STONE_EXCHANGE);t.pc.roles.UIUtility._setEnableButton(n,e)},_setButtonCallbacks:function(){var e=this._getWidget(this.BUTTON_NAMES.STONE_EXCHANGE),t=this._getWidget(this.BUTTON_NAMES.PSEUDO_CURRENCY_EXCHANGE),n=this._getWidget(this.BUTTON_NAMES.PSEUDO_CURRENCY_BUY);e.addTouchEventListener(this._onClickExchangeWithStoneButton,this),t.addTouchEventListener(this._onClickExchangeWithPseudoCurrencyButton,this),n.addTouchEventListener(this._onClickBuyPseudoCurrencyButton,this)},_onClickExchangeWithPseudoCurrencyButton:function(e,t){this._onClickCallback(e,t,this._onExchangeWithPseudoCurrencyCallback)},_onClickExchangeWithStoneButton:function(e,t){this._onClickCallback(e,t,this._onExchangeWithStoneCallback)},_onClickBuyPseudoCurrencyButton:function(e,t){this._onClickCallback(e,t,this._onBuyPseudoCurrencyCallback)},_onClickCallback:function(e,t,n){t===i.Widget.TOUCH_ENDED&&(n||function(){})()},_getWidget:function(e){return a.getWidgetFromNode(this._rootNode,e,function(e){o.warn("RestoreItemBuyButtonController._getWidget: "+e)})}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e.khutil,a=e.console;t.createNameSpaceIfNotExists("restore_item_vending_process"),t.restore_item_vending_process.CurrencyAmountLabelController=n.Class.extend({className:"RestoreItemCurrencyAmountLabelController",WIDGET_NAMES:{PSEUDO_CURRENCY_AMOUNT_LABEL:"have_coin_label",STONE_AMOUNT_LABEL:"have_stone_label"},ctor:function(e){this._rootNode=e},initializeCurrencyAmountLabels:function(e){this._setPseudoCurrencyAmountLabel(e),this._setStoneAmountLabel(e)},clearCurrencyAmountLabels:function(){this._getWidget(this.WIDGET_NAMES.PSEUDO_CURRENCY_AMOUNT_LABEL).string="",this._getWidget(this.WIDGET_NAMES.STONE_AMOUNT_LABEL).string=""},_setPseudoCurrencyAmountLabel:function(e){var t=this._getWidget(this.WIDGET_NAMES.PSEUDO_CURRENCY_AMOUNT_LABEL),n=e.getPseudoCurrencyAmount();t.string=n+""},_setStoneAmountLabel:function(e){var t=this._getWidget(this.WIDGET_NAMES.STONE_AMOUNT_LABEL),n=e.getStoneAmount();t.string=n+""},_getWidget:function(e){return i.getWidgetFromNode(this._rootNode,e,function(e){a.warn("RestoreItemCurrencyAmountLabelController._getWidget: "+e)})}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("restore_item_vending_process"),t.restore_item_vending_process.Controller=n.Class.extend({className:"RestoreItemVendingProcessController",RECOVERY_TYPES:{AP:"AP",BP:"BP"},_setPreloaderClassesByRecoveryType:function(){this.PRELOADER_CLASSES_BY_RECOVERY_TYPE={},this.PRELOADER_CLASSES_BY_RECOVERY_TYPE[this.RECOVERY_TYPES.AP]={PSEUDO_CURRENCY:"PseudoCurrencyRestoreApItemPreloader",STONE:"StoneRestoreApItemPreloader"},this.PRELOADER_CLASSES_BY_RECOVERY_TYPE[this.RECOVERY_TYPES.BP]={PSEUDO_CURRENCY:"PseudoCurrencyRestoreBpItemPreloader",STONE:"StoneRestoreBpItemPreloader"}},ctor:function(e,t){this._setPreloaderClassesByRecoveryType(),this._recoveryType=e,this._vendingLocationInformation=t,this._pseudoCurrencyRestoreItemPreloader=this._createPseudoCurrencyRestoreItemPreloader(),this._stoneRestoreItemPreloader=this._createStoneRestoreItemPreloader(),this._playerCurrencyPreloader=this._createPlayerCurrencyPreloader(),this._standardPseudoCurrencyItemPreloader=this._createStandardPseudoCurrencyItemPreloader()},preload:function(){this._pseudoCurrencyRestoreItemPreloader.preloadRestoreItem(),this._stoneRestoreItemPreloader.preloadRestoreItem(),this._playerCurrencyPreloader.preloadMyCurrency(),this._hasSufficientPseudoCurrency().then(function(e){e||this._standardPseudoCurrencyItemPreloader.preloadItem()}.bind(this))},initializeButtons:function(e){Q.all([this._hasSufficientPseudoCurrency(),this._hasSufficientStones()]).spread(function(n,i){var a=t.createInstance("RestoreItemBuyButtonController",[e]);a.initializeButtons(n,i),a.setOnExchangeWithPseudoCurrencyCallback(this._buyRestoreItemWithPseudoCurrency,this),a.setOnExchangeWithStoneCallback(this._buyRestoreItemWithStones,this),a.setOnBuyPseudoCurrencyCallback(this._buyPseudoCurrency,this)}.bind(this))},initializeCurrencyAmountLabels:function(e){this._currencyAmountLabelController=t.createInstance("RestoreItemCurrencyAmountLabelController",[e]),this._playerCurrencyPreloader.getMyCurrency().then(this._currencyAmountLabelController.initializeCurrencyAmountLabels.bind(this._currencyAmountLabelController))},_clearCurrencyAmountLabels:function(){this._currencyAmountLabelController.clearCurrencyAmountLabels()},setOnTransactionCompletedCallback:function(e,t){this._onTransactionCompletedCallback=e.bind(t)},_buyRestoreItemWithPseudoCurrency:function(){this._buyRestoreItem(this._pseudoCurrencyRestoreItemPreloader)},_buyRestoreItemWithStones:function(){this._buyRestoreItem(this._stoneRestoreItemPreloader)},_buyPseudoCurrency:function(){this._standardPseudoCurrencyItemPreloader.getItem().then(function(e){return t.createInstance("StandardPseudoCurrencyItemVendingProcessController",[e]).buy(this._vendingLocationInformation,e)}.bind(this)).thenResolve(0).then(this._onTransactionCompleted.bind(this))},_buyRestoreItem:function(e){Q.all([e.getRestoreItem(),this._playerCurrencyPreloader.getMyCurrency()]).then(t.createInstance.bind(t,"VendingProcessController")).invoke("buy").then(this._onTransactionCompleted.bind(this))},_onTransactionCompleted:function(e){this._clearPreloaderCache(),this._clearCurrencyAmountLabels(),(this._onTransactionCompletedCallback||function(){})(e)},_hasSufficientPseudoCurrency:function(){return Q.all([this._pseudoCurrencyRestoreItemPreloader.getRestoreItem(),this._playerCurrencyPreloader.getMyCurrency()]).spread(function(e,t){return e.getPrice()<=t.getPseudoCurrencyAmount()})},_hasSufficientStones:function(){return Q.all([this._stoneRestoreItemPreloader.getRestoreItem(),this._playerCurrencyPreloader.getMyCurrency()]).spread(function(e,t){return e.getPrice()<=t.getStoneAmount()})},_clearPreloaderCache:function(){this._pseudoCurrencyRestoreItemPreloader.clear(),this._stoneRestoreItemPreloader.clear(),this._playerCurrencyPreloader.clear(),this._standardPseudoCurrencyItemPreloader.clear()},_createPseudoCurrencyRestoreItemPreloader:function(){return t.createInstance(this.PRELOADER_CLASSES_BY_RECOVERY_TYPE[this._recoveryType].PSEUDO_CURRENCY)},_createStoneRestoreItemPreloader:function(){return t.createInstance(this.PRELOADER_CLASSES_BY_RECOVERY_TYPE[this._recoveryType].STONE)},_createPlayerCurrencyPreloader:function(){return t.createInstance("PlayerCurrencyPreloader")},_createStandardPseudoCurrencyItemPreloader:function(){return t.createInstance("StandardPseudoCurrencyItemPreloader")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("restore_item_vending_process"),t.restore_item_vending_process.PreloaderAbstract=n.Class.extend({className:"RestoreApItemPseudoCurrencyPreloaderAbstract",CACHE_KEY:"_restoreItem",preloadRestoreItem:function(){return this.getRestoreItem()},getRestoreItem:function(){return null==this[this.CACHE_KEY]&&(this[this.CACHE_KEY]=this._fetchItem().then(function(e){return t.createInstance("ShopItemModel",[_.first(e.body.data)])}).fail(function(e){console.error(e&&e.stack?e.stack:e)})),this[this.CACHE_KEY]},_fetchItem:function(){},clear:function(){this[this.CACHE_KEY]=null,this[this.CACHE_KEY]=null}})}((this||0).self||global),function(e){var t=e.kh;e.cc,t.createNameSpaceIfNotExists("restore_item_vending_process"),t.restore_item_vending_process.ApItemPseudoCurrencyPreloader=t.restore_item_vending_process.PreloaderAbstract.extend({className:"RestoreApItemPseudoCurrencyPreloader",_fetchItem:function(){return t.createInstance("apiShop").getGoodsPseudoCurrencyApGain()}})}((this||0).self||global),function(e){var t=e.kh;e.cc,t.createNameSpaceIfNotExists("restore_item_vending_process"),t.restore_item_vending_process.BpItemPseudoCurrencyPreloader=t.restore_item_vending_process.PreloaderAbstract.extend({className:"RestoreBpItemPseudoCurrencyPreloader",_fetchItem:function(){return t.createInstance("apiShop").getGoodsPseudoCurrencyBpGain()}})}((this||0).self||global),function(e){var t=e.kh;e.cc,t.createNameSpaceIfNotExists("restore_item_vending_process"),t.restore_item_vending_process.ApItemStonePreloader=t.restore_item_vending_process.PreloaderAbstract.extend({className:"RestoreApItemStonePreloader",_fetchItem:function(){return t.createInstance("apiShop").getGoodsStoneApGain()}})}((this||0).self||global),function(e){var t=e.kh;e.cc,t.createNameSpaceIfNotExists("restore_item_vending_process"),t.restore_item_vending_process.BpItemStonePreloader=t.restore_item_vending_process.PreloaderAbstract.extend({className:"RestoreBpItemStonePreloader",_fetchItem:function(){return t.createInstance("apiShop").getGoodsStoneBpGain()}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e.console;t.createNameSpaceIfNotExists("standard_pseudo_currency_item_vending_process"),t.standard_pseudo_currency_item_vending_process.Preloader=n.Class.extend({className:"StandardPseudoCurrencyItemPreloader",CACHE_KEY:"_standardPseudoCurrencyItem",preloadItem:function(){return this.getItem()},getItem:function(){return null==this[this.CACHE_KEY]&&(this[this.CACHE_KEY]=this._fetchItem().then(function(e){return t.createInstance("ShopItemModel",_.first(e.body.data))}).fail(function(e){i.error(e&&e.stack?e.stack:e)})),this[this.CACHE_KEY]},_fetchItem:function(){return t.createInstance("apiShop").getStandardPseudoCurrencyItem()},clear:function(){this[this.CACHE_KEY]=null,this[this.CACHE_KEY]=null}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("standard_pseudo_currency_item_vending_process"),t.standard_pseudo_currency_item_vending_process.Controller=n.Class.extend({className:"StandardPseudoCurrencyItemVendingProcessController",ctor:function(e){this._shopItemModel=e},buy:function(e){return(null==this._shopItemModel?t.createInstance("StandardPseudoCurrencyItemPreloader").getItem():Q.resolve(this._shopItemModel)).then(this._requestPlatformTransaction.bind(this,e))},_requestPlatformTransaction:function(e,n){var i={num:1,name:n.getName(),description:n.getDescription(),price:n.getPrice(),itemId:n.getShopItemId(),contentId:n.getContentId(),contentType:n.getContentType()},a=e.getLocationInformation();return t.createInstance("paymentRequest").requestShopItem(i,a)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("standard_pseudo_currency_item_vending_process"),t.standard_pseudo_currency_item_vending_process.LocationInformation=n.Class.extend({className:"VendingLocationInformation",ctor:function(){this._locationInformation={}},getLocationInformation:function(){return this._locationInformation},setComponent:function(e){this._locationInformation.component=e},setQuestType:function(e){this._locationInformation.quest_type=e},setBattleId:function(e){this._locationInformation.a_battle_id=e},setIsOwnRaid:function(e){e&&(this._locationInformation.is_own_raid=e)},setQuestId:function(e){this._locationInformation.a_quest_id=e},setEventId:function(e){this._locationInformation.event_id=e},setEpicId:function(e){this._locationInformation.epicId=e}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.console;t.createNameSpaceIfNotExists("vending_process"),t.vending_process.PopupFactoryShBuyCheck=t.PopupFactoryPopupCommon.extend({className:"PopupFactoryShBuyCheck",POPUP_PROPERTIES:{resourceName:"core-popup-sh_buy_check",title:"",buttonLabels:{blueBtn:"",blackBtn:""},buttons:{blueBtn:function(e){this._onConfirm(),this.dismiss()},blackBtn:function(e){this._onCancel(),this.dismiss()}}},WIDGET_NAMES:{IMAGE:"item_img",PRICE:"price_label",TITLE:"title_label",NAME:"item_name_label",DESCRIPTION:"item_description_label",CURRENCY:"have_item_labelimg"},CURRENCY_TEXT_HTML:"<div class='white' style='text-align: left !important;'><span>{currencyBefore}</span><span class='red'>{currencyAfter}</span></div>",POPUP_METHODS:{initializePopupData:function(e,t){this._shopItemModel=e,this._playerCurrencyModel=t,this._initializeNameLabel(),this._initializeDescriptionLabel(),this._showImage(),this._createPulldown(this._createPulldownElements())},setOnConfirmCallback:function(e){this._onConfirmCallback=e},setOnCancelCallback:function(e){this._onCancelCallback=e},_clearData:function(){this._cleanUpPulldown(),this._clearImage(),this._clearCurrencyLabel(),this._clearNameLabel(),this._clearDescriptionLabel(),this._clearPriceLabel()},_initializeNameLabel:function(){var e=this._getWidget(this.WIDGET_NAMES.NAME),t=this._shopItemModel.getName();e.string=t.toString()},_clearNameLabel:function(){this._getWidget(this.WIDGET_NAMES.NAME).string=""},_initializeDescriptionLabel:function(){var e=this._getWidget(this.WIDGET_NAMES.DESCRIPTION),t=this._shopItemModel.getDescription();e.string=t.toString()},_clearDescriptionLabel:function(){this._getWidget(this.WIDGET_NAMES.DESCRIPTION).string=""},_updateCurrencyLabel:function(){var e={};e[this.WIDGET_NAMES.CURRENCY]=this._createCurrencyText(),this.setHtmlStrings(e,t.GameConfig.POPUP_CSS)},_clearCurrencyLabel:function(){this._getWidget(this.WIDGET_NAMES.CURRENCY).loadTexture("")},_createCurrencyText:function(){var e=this._shopItemModel.getPrice(),t=this._getCurrencyAmount(),n=t-e*this._selectedAmount;return this.CURRENCY_TEXT_HTML.replace("{currencyBefore}",t.toString()).replace("{currencyAfter}",n.toString())},_getCurrencyAmount:function(){return this._shopItemModel.isCurrencyTypePseudoCurrency()?this._playerCurrencyModel.getPseudoCurrencyAmount():this._shopItemModel.isCurrencyTypeStone()?this._playerCurrencyModel.getStoneAmount():(i.error("PopupFactoryShBuyCheck._getCurrencyAmount: Invalid currency type: "+this._shopItemModel.getCurrencyType()+"!"),0)},_showImage:function(){var e=this._getWidget(this.WIDGET_NAMES.IMAGE);t.createInstance("ShopItemImageController").initializeImage(e,this._shopItemModel)},_clearImage:function(){this._getWidget(this.WIDGET_NAMES.IMAGE).removeAllChildren()},_updatePriceLabel:function(e){var t=this._shopItemModel.getPrice();this._getWidget(this.WIDGET_NAMES.PRICE).string=t*e+""},_clearPriceLabel:function(){this._getWidget(this.WIDGET_NAMES.PRICE).string=""},_createPulldown:function(e){this._pulldown=new t.Pulldown({button:this.seekWidgetByName("btn_pulldown"),label:this.seekWidgetByName("amount_label"),menuBase:this.seekWidgetByName("gud_sh_sort"),choice:ccs.load(res["core-sort-sort_list_ui"]).node},e),this._pulldown.onChange(this._onChangePulldown.bind(this)),this._onChangePulldown(e[0])},_createPulldownElements:function(){var e=this._shopItemModel.getPrice(),t=this._getCurrencyAmount(),n=Math.floor(t/e);return n=Math.min(this._shopItemModel.getStock(),n),_.map(_.range(n),function(e){var t={value:e+1,text:(e+1).toString()};return 0===e&&(t.selected=!0),t})},_onChangePulldown:function(e){this._selectedAmount=e.value,this._updatePriceLabel(e.value),this._updateCurrencyLabel()},_cleanUpPulldown:function(){this._pulldown&&this._pulldown.releaseMenu()},_getWidget:function(e){return n.getWidgetFromNode(this,e,function(e){i.warn("KHPopupShBuyCheck._getWidget: "+e)}.bind(this))},_onCancel:function(){this._clearData(),_.isFunction(this._onCancelCallback)&&this._onCancelCallback(this._selectedAmount),this._onCancelCallback=null,this._onConfirmCallback=null},_onConfirm:function(){this._clearData(),_.isFunction(this._onConfirmCallback)&&this._onConfirmCallback(this._selectedAmount),this._onCancelCallback=null,this._onConfirmCallback=null}},configure:function(e,n){t.PopupFactoryPopupCommon.prototype.configure.call(this,e,n),e.WIDGET_NAMES=this.WIDGET_NAMES,e.CURRENCY_TEXT_HTML=this.CURRENCY_TEXT_HTML,_.assign(e,this.POPUP_METHODS)},onPopupOpened:function(e,t){e.initializePopupData(t.shopItemModel,t.playerCurrencyModel),e.setOnConfirmCallback(t.onConfirm),e.setOnCancelCallback(t.onCancel)}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.console;t.createNameSpaceIfNotExists("vending_process"),t.vending_process.PopupShBuyResult=t.ImplantedPopup.extend({className:"PopupShBuyResult",ROOT_NODE:"sh_buy_result",DI_NAME:"PopupShBuyResult",BUTTON_NAMES:{CLOSE:"btn_popup_close"},WIDGET_NAMES:{IMAGE:"corecard_ui",RESULT:"buy_result_label",HEADER:"title_label"},HEADER_TEXT:{POINT:"",DEFAULT:""},RESULT_TEXT:{POINT:"{amountObtained}",DEFAULT:"{amountObtained}"},_initContents:function(e,t){this._initShopItemImage(e),this._setHeaderText(e),this._setResultText(e,t),this._initButtons()},_clearContents:function(){this._getWidget(this.WIDGET_NAMES.HEADER).string="",this._getWidget(this.WIDGET_NAMES.RESULT).string="",this._getWidget(this.WIDGET_NAMES.IMAGE).loadTexture("")},_initButtons:function(){var e={};e[this.BUTTON_NAMES.CLOSE]=this.dismiss.bind(this,!0),this.setButtonEvents(e)},_initShopItemImage:function(e){this._setProperCoreCardElementRarity(this.getNode(),e._shopItemData,"corecard_ui")},_setHeaderText:function(e){var t=this._getWidget(this.WIDGET_NAMES.HEADER);return e.isCurrencyTypePoint()?void(t.string=this.HEADER_TEXT.POINT):void(t.string=this.HEADER_TEXT.DEFAULT)},_setResultText:function(e,t){var n=this._getWidget(this.WIDGET_NAMES.RESULT);return e.isCurrencyTypePoint()?void(n.string=this.RESULT_TEXT.POINT.replace("{amountObtained}",t)):void(n.string=this.RESULT_TEXT.DEFAULT.replace("{amountObtained}",t))},_getWidget:function(e){return n.getWidgetFromNode(this.getNode(),e,function(e){i.warn(this.className+"_getWidget: "+e)}.bind(this))}}),t.assignRoles(t.vending_process.PopupShBuyResult,[t.pc.roles.CoreCardCommon])}((this||0).self||global),function(e){var t=e.kh;t.createNameSpaceIfNotExists("vending_process"),t.vending_process.PopupShBuyCheck=t.PopupFactoryPopupCommon.extend({className:"PopupShBuyCheck",ctor:function(){this._popup=t.createInstance("PopupFactoryShBuyCheck").create()},open:function(e,t){var n=Q.defer();return this._popup.open({shopItemModel:e,playerCurrencyModel:t,onConfirm:n.resolve.bind(n),onCancel:n.reject.bind(n)}),n.promise}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e.console;t.createNameSpaceIfNotExists("vending_process"),t.vending_process.Controller=n.Class.extend({className:"VendingProcessController",ctor:function(e,t){this._shopItemModel=e,this._playerCurrencyModel=t},buy:function(){return this._showConfirmPopup().then(this._requestTransaction.bind(this)).then(this._showTransactionResult.bind(this)).then(this._refreshPage.bind(this))},_showConfirmPopup:function(){return this._createConfirmPopup().open(this._shopItemModel,this._playerCurrencyModel)},_requestTransaction:function(e){var n=this._shopItemModel.getShopItemId(),a=this._shopItemModel.getCurrencyType();return t.createInstance("apiShop").buy(n,e,a).fail(function(e){i.error(e&&e.stack?e.stack:e)}).thenResolve(e)},_showTransactionResult:function(e){return this._createTransactionResultPopup().open(this._shopItemModel,e)},_createConfirmPopup:function(){return t.createInstance("PopupShBuyCheck",[this._shopItemModel,this._playerCurrencyModel])},_createTransactionResultPopup:function(){var e=t.vending_process.PopupShBuyResult.prototype,i=n.director.getRunningScene();return t.ImplantedPopup.createOrGet(i,e.ROOT_NODE,e.DI_NAME)},_refreshPage:function(){t.createInstance("myselfInfoRepository").allCacheClear(),n.director.getRunningScene().refresh()}})}((this||0).self||global),function(e){var t=e.kh;t.createNameSpaceIfNotExists("vending_process"),t.vending_process.WithoutResultController=t.vending_process.Controller.extend({className:"VendingProcessWithoutResultController",buy:function(){return this._showConfirmPopup().then(this._requestTransaction.bind(this))}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("shop_item"),t.shop_item.Model=n.Class.extend({className:"ShopItemModel",CURRENCY_TYPES:{POINT:"point",PSEUDO_CURRENCY:"kamihime_coin",STONE:"stone",ACCESSORY_POINT:"accessory_point"},ITEM_TYPES:{ITEM:"item",WEAPON:"weapon",SUMMON:"summon",ACCESSORY:"accessory",CHARACTER:"character",PACKAGE:"package"},SHOP_TYPES:{POINT:"point",PSEUDO_CURRENCY:"pseudo_currency",STONE:"stone",TREASURE:"treasure",UNSPECIFIED:"unspecified"},ctor:function(e,t){this._shopItemData=e,this._shopType=t||this.SHOP_TYPES.UNSPECIFIED},getShopItemId:function(){return this._shopItemData.shop_item_id},getContentId:function(){return this._shopItemData.id},getName:function(){return this._shopItemData.name},getDescription:function(){return this._shopItemData.description},getStock:function(){return this._shopItemData.buy_max_num},getPrice:function(){return this._shopItemData.price},isOnSale:function(){return this._shopItemData.on_sale},isEmpty:function(){return null==this.getShopItemId()},getCurrencyType:function(){return this._shopItemData.currency_type},isCurrencyTypePoint:function(){return this.getCurrencyType()===this.CURRENCY_TYPES.POINT},isCurrencyTypePseudoCurrency:function(){return this.getCurrencyType()===this.CURRENCY_TYPES.PSEUDO_CURRENCY},isCurrencyTypeStone:function(){return this.getCurrencyType()===this.CURRENCY_TYPES.STONE},getItemType:function(){return this._shopItemData.shop_item_type},getRawData:function(){return this._shopItemData},getShopType:function(){return this._shopType},getContentType:function(){return this._shopItemData.kind}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("shop_item"),t.shop_item.ImageController=n.Class.extend({className:"ShopItemImageController",_setImageNameIdentifiersByItemType:function(e){this.IMAGE_NAME_IDENTIFIERS={},this.IMAGE_NAME_IDENTIFIERS[e.ITEM]="item",this.IMAGE_NAME_IDENTIFIERS[e.WEAPON]="weapon",this.IMAGE_NAME_IDENTIFIERS[e.SUMMON]="summon",this.IMAGE_NAME_IDENTIFIERS[e.CHARACTER]="chara",this.IMAGE_NAME_IDENTIFIERS[e.ACCESSORY]="acce",this.IMAGE_NAME_IDENTIFIERS[e.PACKAGE]="package"},initializeImage:function(e,n){this._setImageNameIdentifiersByItemType(t.shop_item.Model.prototype.ITEM_TYPES);var i=this._createImagePath(n);this._createView(e).show(i)},_createView:function(e){return t.createInstance("ShopItemImageView",e)},_createImagePath:function(e){var n=e.getContentId(),i=e.getContentType(),a=this.IMAGE_NAME_IDENTIFIERS[i];return"summon"===i||"character"===i||"weapon"===i?t.Img("corecard",a,_.padZero(n,4),0).jpg:t.Img("corecard",a,_.padZero(n,4)).jpg}})}((this||0).self||global),function(e){var t=e._,n=e.kh,i=e.cc;n.createNameSpaceIfNotExists("shop_item"),n.shop_item.ImageView=i.Class.extend({className:"ShopItemImageView",ctor:function(e){this._widget=e},show:function(e){if(null!=this._widget){if(t.isFunction(this._widget.loadTexture))return void i.loader.loadImg(e,function(t,n){t?console.warn(t):(this._widget.loadTexture(e),this.cleanUp())}.bind(this));if(t.isFunction(this._widget.setTexture))return void this._widget.setTexture(e);var n=this._createSprite(e);this._widget.addChild(n)}},_createSprite:function(e){var t=new i.Sprite(e);return t.setAnchorPoint(i.p(0,0)),t},cleanUp:function(){this._widget=null}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;e.Q,t.createNameSpaceIfNotExists("pc.roles"),t.pc.roles.UIUtility={_setEnableButton:function(e,t){var a=null;i.isObject(e)?a=e:a=n.director.getRunningScene().seekWidgetByName(e);a.setEnabled(t),a.setColor(t?n.color("#FFFFFF"):n.color("#808080"))},_setGrayOutButton:function(e,t){i.isUndefined(e._cascadeColorEnabled)||e.setCascadeColorEnabled(!0);(i.isObject(e)?e:this.seekWidgetByName(e)).setColor(t?n.color("#FFFFFF"):n.color("#808080"))},_showNothingLabel:function(e){if(!i.isUndefined(e)&&!i.isNull(e)){var t=e.seekWidgetByName("nothing_label");return null===t?void console.warn("[ERROR] Could not find noghing label."):void t.setVisible(!0)}console.warn("[ERROR] Could not access scene object.")},_setGrayShader:function(e,t,a){var o=function(e,t){var i=t?ccui.Scale9Sprite.WebGLRenderCmd._getGrayShaderProgram():n.shaderCache.programForKey(n.SHADER_SPRITE_POSITION_TEXTURECOLOR),a=function(){this.setShaderProgram(i),this.removeEventListener("load",a)};return e instanceof ccui.Button?(e._buttonClickedRenderer.addLoadedEventListener(a,e._buttonClickedRenderer),e._buttonDisableRenderer.addLoadedEventListener(a,e._buttonDisableRenderer),void e._buttonNormalRenderer.addLoadedEventListener(a,e._buttonNormalRenderer)):e.getVirtualRenderer?void e.getVirtualRenderer().addLoadedEventListener(a,e.getVirtualRenderer()):void(e.setShaderProgram&&e.addLoadedEventListener(a,e))};(o(e,t),a)&&e.seekWidgets(i.isFunction(a)?a:function(){return!0}).forEach(function(e){o(e,t)})}}}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;e.Q,t.pc.roles=t.pc.roles||{};var a={basic:"R",upper:"SR",uppermost:"SSR",highjob:"SSR_arousal"},o=["flame","water","wind","thunder"];t.pc.roles.ImagesCommon={_loadEpisodeImage:function(e,n,i){t.createInstance("episodeImage").loadTextureToImageView(e,n,i,1)},_setIntroduceCharaImage:function(e,a){var o=n.director.getRunningScene();if(!i.isUndefined(e)&&null!==o.seekWidgetByName("illust-com-kneeshot_chara")){var r=t.Img("illust-com-kneeshot","chara",i.padZero(e,4),0).png;o.seekWidgetByName("illust-com-kneeshot_chara").loadTexture(r);var s=this.__getRarityBgPath(a);o.seekWidgetByName("rarity_bg").loadTexture(s)}},_setIntroduceJobImage:function(e,o){var r=o||n.director.getRunningScene();if(!i.isUndefined(e.job_id)&&null!==r.seekWidgetByName("illust-com-kneeshot_job")){var s=t.Img("illust-com-kneeshot","job",i.padZero(e.job_id,4),e.skin||0).png;r.seekWidgetByName("illust-com-kneeshot_job").loadTexture(s);var c=a[(e.rank||"basic").toLowerCase()],u=this.__getRarityBgPath(c);r.seekWidgetByName("rarity_bg").loadTexture(u);var l=r.seekWidgetByName("name_base");if(null!==l){var _="core/res/introduce/introduce_raritybar_"+c+".png";l.loadTexture(_,ccui.Widget.PLIST_TEXTURE)}}},_setIntroduceWeaponImage:function(e){var a=n.director.getRunningScene();if(!i.isUndefined(e.weapon_id)&&null!==a.seekWidgetByName("introduceimg_weapon")){var o=t.Img("introduceimg","weapon",i.padZero(e.weapon_id,4),e.skin||0).jpg;a.seekWidgetByName("introduceimg_weapon").loadTexture(o)}},_setIntroduceSummonImage:function(e){var a=n.director.getRunningScene();if(!i.isUndefined(e.summon_id)&&null!==a.seekWidgetByName("illust-com-kneeshot_summon")){var o=t.Img("illust-com-kneeshot","summon",i.padZero(e.summon_id,4),e.skin||0).png;a.seekWidgetByName("illust-com-kneeshot_summon").loadTexture(o);var r=this.__getRarityBgPath(e.rare);a.seekWidgetByName("rarity_bg").loadTexture(r)}},_setIntroduceGuardianImage:function(e){var a=n.director.getRunningScene();if(e&&!i.isUndefined(e.guardian_id)&&null!==a.seekWidgetByName("illust-com-kneeshot_guardian")){var r=t.Img("illust-com-kneeshot","guardian",i.padZero(e.guardian_id,4),0).png;if(a.seekWidgetByName("illust-com-kneeshot_guardian").loadTexture(r),!i.isUndefined(e.element_type)){var s=o[e.element_type],c=t.Img("guardian_bg",s).jpg;a.seekWidgetByName("guardian_bg").loadTexture(c)}}},__getRarityBgPath:function(e){return"../core/res/pages/rarity_bg/rarity_bg_"+e.toLowerCase()+".jpg"}}}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);e.Q,t.pc.roles=t.pc.roles||{},t.pc.roles.StringsCommon={_setCardStrings:function(e,t){n.isUndefined(t.name)||null===e.seekWidgetByName("name_label")||e.setStrings({name_label:t.name}),n.isUndefined(t.attack)||null===e.seekWidgetByName("attack_no")||e.setStrings({attack_no:String(t.attack)}),n.isUndefined(t.min_attack)||null===e.seekWidgetByName("attack_min_no_label")||e.setStrings({attack_min_no_label:String(t.min_attack)}),n.isUndefined(t.min_attack)||null===e.seekWidgetByName("attack_min_no")||e.setStrings({attack_min_no:String(t.min_attack)}),n.isUndefined(t.max_attack)||null===e.seekWidgetByName("attack_max_no_label")||e.setStrings({attack_max_no_label:String(t.max_attack)}),n.isUndefined(t.max_attack)||null===e.seekWidgetByName("attack_max_no")||e.setStrings({attack_max_no:String(t.max_attack)}),n.isUndefined(t.hp)||null===e.seekWidgetByName("hp_no")||e.setStrings({hp_no:String(t.hp)}),n.isUndefined(t.min_hp)||null===e.seekWidgetByName("hp_min_no_label")||e.setStrings({hp_min_no_label:String(t.min_hp)}),n.isUndefined(t.min_hp)||null===e.seekWidgetByName("hp_min_no")||e.setStrings({hp_min_no:String(t.min_hp)}),n.isUndefined(t.max_hp)||null===e.seekWidgetByName("hp_max_no_label")||e.setStrings({hp_max_no_label:String(t.max_hp)}),n.isUndefined(t.max_hp)||null===e.seekWidgetByName("hp_max_no")||e.setStrings({hp_max_no:String(t.max_hp)}),n.isUndefined(t.level)||null===e.seekWidgetByName("level_label")||e.setStrings({level_label:String(t.level)}),n.isUndefined(t.level)||null===e.seekWidgetByName("level_now_label")||e.setStrings({level_now_label:String(t.level)}),n.isUndefined(t.max_level)||null===e.seekWidgetByName("level_max_label")||e.setStrings({level_max_label:"MAX "+String(t.max_level)}),n.isUndefined(t.next_exp)||null===e.seekWidgetByName("exp_next_label")||e.setStrings({exp_next_label:"NEXT:"+String(t.next_exp)}),n.isUndefined(t.level)||n.isUndefined(t.max_level)||null===e.seekWidgetByName("exp_next_label")||e.seekWidgetByName("exp_next_label").setVisible(t.level<t.max_level),n.isUndefined(t.skill)||null===e.seekWidgetByName("skill_next_label")||(0===t.skill.next_exp?e.seekWidgetByName("skill_next_label").setVisible(!1):(e.setStrings({skill_next_label:"NEXT:"+t.skill.next_exp}),e.seekWidgetByName("skill_next_label").setVisible(!0))),n.isUndefined(t.level)||n.isUndefined(t.max_level)||null===e.seekWidgetByName("skill_next_label")||e.seekWidgetByName("skill_next_label").setVisible(!0),n.isUndefined(t.bonus)||null===e.seekWidgetByName("plus_no")||e.setStrings({plus_no:t.bonus<1?"":"+"+t.bonus}),n.isUndefined(t.description)||null===e.seekWidgetByName("flavor_label")||e.setStrings({flavor_label:t.description})},_setSummonAttackEffectStrings:function(e,t){if(!n.isUndefined(t.attack_info)){n.isUndefined(t.attack_info.name)||null===e.seekWidgetByName("attack_name_label")||e.setStrings({attack_name_label:t.attack_info.name}),n.isUndefined(t.attack_info.description)||null===e.seekWidgetByName("attack_description_label")||e.setStrings({attack_description_label:t.attack_info.description});var i=e.seekWidgetByName("interval_label");n.isUndefined(t.attack_info.turn)||null===i||(i.getParent().setVisible(t.attack_info.turn>0),i.setString(""+t.attack_info.turn+""))}if(n.isUndefined(t.effect_info)||(n.isUndefined(t.effect_info.name)||null===e.seekWidgetByName("support_name_label")||e.setStrings({support_name_label:t.effect_info.name}),n.isUndefined(t.effect_info.description)||null===e.seekWidgetByName("support_description_label")||e.setStrings({support_description_label:t.effect_info.description})),!n.isUndefined(t.attack)&&(n.isUndefined(t.attack.name)||null===e.seekWidgetByName("attack_name_label")||e.setStrings({attack_name_label:t.attack.name}),n.isUndefined(t.attack.description)||null===e.seekWidgetByName("attack_description_label")||e.setStrings({attack_description_label:t.attack.description}),!n.isUndefined(t.attack.turn)&&null!==e.seekWidgetByName("interval_label"))){var a=e.seekWidgetByName("interval_label");a.getParent().setVisible(t.attack.turn>0),a.setString(""+t.attack.turn+"")}n.isUndefined(t.effect)||(n.isUndefined(t.effect.name)||null===e.seekWidgetByName("support_name_label")||e.setStrings({support_name_label:t.effect.name}),n.isUndefined(t.effect.description)||null===e.seekWidgetByName("support_description_label")||e.setStrings({support_description_label:t.effect.description}))}}}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);e.Q,t.pc.roles=t.pc.roles||{},t.pc.roles.GaugesCommon={_setExpGauge:function(e,t){if(!(n.isUndefined(t.exp)||n.isUndefined(t.next_exp)||n.isUndefined(t.level)||n.isUndefined(t.max_level)||null===e.seekWidgetByName("exp-gauge"))){var i=t.level===t.max_level?100:t.exp/(t.next_exp+t.exp)*100;e.seekWidgetByName("exp-gauge").percent=i}},_setSkillExpGauge:function(e,t){var n=e.seekWidgetByName("skill-gauge");n&&(n.percent=t.skill.progress)},_setStarGauge:function(e,t){if(!n.isUndefined(t.max_overlimit_count)&&!n.isUndefined(t.overlimit_count)){var i=this.__getStarGaugeBlankNode(e,t),a=this.__getStarGaugeNode(e,t);i&&a&&(t.is_aroused?this.__setAppearanceStarGaugeAroused(e):this.__setAppearanceStarGaugeNormal(e),i.percent=20*t.max_overlimit_count,a.percent=20*t.overlimit_count)}},__setAppearanceStarGaugeAroused:function(e){var t=this.__getStarGaugeFrameNode(e);t&&t.setAppearance("star_gauge_arousal")},__setAppearanceStarGaugeNormal:function(e){var t=this.__getStarGaugeFrameNode(e);t&&t.setAppearance("star_gauge")},__getStarGaugeFrameNode:function(e){return e.seekWidgetByName("mainparts_star_gauge_ui")},__getStarGaugeBlankNode:function(e,t){return t.is_aroused?e.seekWidgetByName("star_gauge_blank_arousal"):e.seekWidgetByName("star_gauge_blank")},__getStarGaugeNode:function(e,t){return t.is_aroused?e.seekWidgetByName("star_gauge_arousal"):e.seekWidgetByName("star_gauge")}}}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);e.Q,t.pc.roles=t.pc.roles||{},t.pc.roles.IconsCommon={_setRarityIcon:function(e,t,i){var a=e.seekWidgetByName(i||"rarity_icon");if(!n.isUndefined(t.rare)&&null!==a){var o=t.rare;if(t.is_aroused&&(o+="_arousal"),!n.contains(["N","R","SR","SSR","N_arousal","R_arousal","SR_arousal","SSR_arousal"],o))return void console.error("Invalid rarity type: "+o);var r="core/res/icon/rarityicon_"+o+".png";a.loadTexture(r,ccui.Widget.PLIST_TEXTURE)}},_setRarityBar:function(e,t){if(!n.isUndefined(t.rare)&&null!==e.seekWidgetByName("name_base")){var i=t.rare;if(!n.contains(["N","R","SR","SSR"],i))return void console.error("Invalid rarity type: "+i);var a="core/res/introduce/introduce_raritybar_"+i+".png";e.seekWidgetByName("name_base").loadTexture(a,ccui.Widget.PLIST_TEXTURE)}},_setElementIcon:function(e,t,i,a){var o=e.seekWidgetByName(a||"element_icon");if(!n.isUndefined(t.element_type)&&null!==o){var r=t.element_type;n.contains([0,1,2,3,4,5,6,8],r)||console.warn("Unknown element type: "+r);var s=(i=i||"core/res/introduce/introduce_element_")+r+".png";o.loadTexture(s,ccui.Widget.PLIST_TEXTURE)}},_setElementIconCommonRes:function(e,t,n){this._setElementIcon(e,t,"core/res/icon/elementicon_",n)},_setStatustypeIcon:function(e,t){if(!n.isUndefined(t.character_type)&&null!==e.seekWidgetByName("statustype_icon")){var i=t.character_type;if(!n.contains(["attack","balance","defense","special","heal"],i))return void console.error("Invalid character type: "+i);var a="core/res/icon/statustypeicon_"+i+".png";e.seekWidgetByName("statustype_icon").loadTexture(a,ccui.Widget.PLIST_TEXTURE)}},_setJobStatustypeIcon:function(e,t){n.isUndefined(t.type)||(t.character_type=t.type,this._setStatustypeIcon(e,t))},_setWeaponIcon:function(e,t,i){if(i=i||"weapontype_icon",!n.isUndefined(t.weapon_type)&&null!==e.seekWidgetByName(i)){var a=t.weapon_type;if(!n.contains(["sword","special_sword","spear","ax","staff","hammer","gun","bow","magic_item"],a))return void console.error("Invalid weapon type: "+a);var o="core/res/icon/weapontypeicon_"+a+".png";e.seekWidgetByName(i).loadTexture(o,ccui.Widget.PLIST_TEXTURE)}},_setWeaponsIcon:function(e,t){n.isUndefined(t.familiar_weapon_types)||n.each(t.familiar_weapon_types,function(t,n){this._setWeaponIcon(e,{weapon_type:t},"weapontypeicon_"+n)},this)},_setForteIcon:function(e,t){return null===e?void console.error("iconNode is null."):n.isUndefined(t)?void console.error("weaponName is undefined."):void e.loadTexture("core/res/icon/weapontypeicon_"+t+".png",ccui.Widget.PLIST_TEXTURE)}}}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._,e.Q);t.pc.roles=t.pc.roles||{},t.pc.roles.AnimationCommon={_setEndAnimationEvent:function(e,t,i){var a=new ccs.Timeline,o=new ccs.EventFrame;i=i||"endAnimation",o.setEvent(i),o.setFrameIndex(t),a.addFrame(o),e.addTimeline(a);var r=n.defer();return e.setFrameEventCallFunc(function(t){t.getEvent()===i&&r.resolve(e)}),r.promise}}}((this||0).self||global),function(e){var t=e.kh;e.cc,e._,e.Q,t.pc.roles=t.pc.roles||{},t.pc.roles.RoutingCommon={_consoleErrorRouterParams:function(e){if(t.env.riseErrorOnRoutingValidation)throw new Error("Routing parameter validation failed. requires "+e+" .");console.debug("[CAUTION] Created temporary router param for debug: "+e+"."),console.debug("          If you define this parameter, this caution will be cleared.")},_consoleErrorRoutingAbort:function(e){console.debug("[CAUTION] Not defined router parameters: "+e),console.debug("          Routing aborted.")},_navigateToPresent:function(e){t.createInstance("router").navigate("present/prs_001",e)},_navigateToGachaTop:function(e){t.createInstance("router").navigate("gacha",e)},_navigateToGemGacha:function(e){t.createInstance("router").navigate("gacha/ga_004",e)},_navigateToQuest:function(e){t.createInstance("router").navigate("quest",e)}}}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e._,t.EventSubject=n.Class.extend({EVENT_PREFIX:"",EVENT_NAME:{},_uniqueEventPrefix:"",_notificationCenter:null,ctor:function(){this._uniqueEventPrefix=this.EVENT_PREFIX+":"+this.__instanceId,this._notificationCenter=t.createInstance("notificationCenter")},_getUniqueEventName:function(e){return void 0===this.EVENT_NAME[e]?(console.error("kh.EventSubject._getUniqueEventName() :"+e),""):this._uniqueEventPrefix+":"+this.EVENT_NAME[e]},addEventListener:function(e,t,n){var i=this._getUniqueEventName(e);return this._notificationCenter.addEventListener(i,t,n)},dispatchEvent:function(e,t){var n=this._getUniqueEventName(e);this._notificationCenter.dispatchEvent(n,t)},removeEventListener:function(e){this._notificationCenter.removeEventListener(e)},removeEventListenersByEventName:function(e){var t=this._getUniqueEventName(e);this._notificationCenter.removeEventListenersByEventName(t)},removeAllEventListeners:function(){Object.keys(this.EVENT_NAME).forEach(function(e){this.removeEventListenersByEventName(e)},this)}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.createNameSpaceIfNotExists("autospend.model"),n.autospend.model.AutoSpendConfig=n.EventSubject.extend({EVENT_PREFIX:"auto_spend_config",EVENT_NAME:{PROPERTY_CHANGED:"property_changed"},TYPE_SUMMON:"summon",TYPE_WEAPON:"weapon",_type:null,_apiAPlayers:null,_autoSpendConfig:null,ctor:function(e){this._super(),this._type=e,this._apiAPlayers=n.createInstance("apiAPlayers")},prepare:function(){return this._getAutoSpendConfigGetPromise(this._type).then(function(e){return this._autoSpendConfig=e.body.auto_spend_config,this._notifyPropertyChanged(),this}.bind(this))},_getAutoSpendConfigGetPromise:function(e){return this._apiAPlayers.getAutoSpendConfig(e).fail(function(e){console.error(e.stack)})},isEnabled:function(){return this._getPropertyOrDefault("enabled")},getType:function(){return this.type},containsRarity:function(e){var n=this._getPropertyOrDefault("rarities",[]);return t.contains(n,e)},containsBuildUpRarity:function(e){var n=this._getPropertyOrDefault("buildup_rarities",[]);return t.contains(n,e)},includesHasBonus:function(){return this._getPropertyOrDefault("includes_has_bonus",!1)},setEnabled:function(e){this._autoSpendConfig.enabled=e,e||(this._autoSpendConfig.rarities=[],this._autoSpendConfig.buildup_rarities=[],this._autoSpendConfig.includes_has_bonus=!1),this._notifyPropertyChanged()},toggleRarity:function(e){return this.containsRarity(e)?(t.pull(this._autoSpendConfig.rarities,e),void this._notifyPropertyChanged()):(this._autoSpendConfig.rarities.push(e),void this._notifyPropertyChanged())},toggleBuildUpRarity:function(e){return this.containsBuildUpRarity(e)?(t.pull(this._autoSpendConfig.buildup_rarities,e),void this._notifyPropertyChanged()):(this._autoSpendConfig.buildup_rarities.push(e),void this._notifyPropertyChanged())},setIncludesHasBonus:function(e){this._autoSpendConfig.includes_has_bonus=e,this._notifyPropertyChanged()},isValid:function(){return!this.isEnabled()||!t.isEmpty(this._autoSpendConfig.rarities)||!t.isEmpty(this._autoSpendConfig.buildup_rarities)},update:function(){return this._apiAPlayers.updateAutoSpendConfig(this._autoSpendConfig).fail(function(e){console.error(e.stack)})},_getPropertyOrDefault:function(e,n){return t.isUndefined(n)&&(n=null),this._autoSpendConfig?this._autoSpendConfig[e]:n},_notifyPropertyChanged:function(){this.dispatchEvent("PROPERTY_CHANGED")}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.createNameSpaceIfNotExists("autospend.view"),n.autospend.view.AutoSpendFormView=n.SceneObject.extend({UI_NODE_NAMES:{enabled:{offBtn:"btn_function_off",onBtn:"btn_function_on"},normalLabel:"normal_label",rarities:{N:{icon:"normal_rarityicon_n",checkbox:"btn_checkbox_normal_n"},R:{icon:"normal_rarityicon_r",checkbox:"btn_checkbox_normal_r"}},buildUpLabel:"material_label",buildUpRarities:{R:{icon:"material_rarityicon_r",checkbox:"btn_checkbox_material_r"},SR:{icon:"material_rarityicon_sr",checkbox:"btn_checkbox_material_sr"}},hasBonus:{notSellBtn:"btn_not_sell",sellBtn:"btn_sell"}},_uiNodes:{},ctor:function(e){this._node=e,this._uiNodes=this._getUINodes()},update:function(e){this._updateEnabled(e),this._updateRarities(e),this._updateBuildUpRarities(e),this._updateHasBonus(e)},_updateEnabled:function(e){var t=e.isEnabled(),n=this._uiNodes.enabled.offBtn,i=this._uiNodes.enabled.onBtn;n.setHighlighted(!t),n.setTouchEnabled(t),i.setHighlighted(t),i.setTouchEnabled(!t)},_updateRarities:function(e){var n=e.isEnabled(),i=this._uiNodes.normalLabel,a=n?"#FFFFFF":"#808080",o=cc.color(a);i.setColor(o),t.forEach(this._uiNodes.rarities,function(t,i){t.checkbox.setColor(o),t.icon.setColor(o),t.checkbox.setTouchEnabled(n);var a=e.containsRarity(i);t.checkbox.setHighlighted(a)}.bind(this))},_updateBuildUpRarities:function(e){var n=e.isEnabled(),i=this._uiNodes.buildUpLabel,a=n?"#FFFFFF":"#808080",o=cc.color(a);i.setColor(o),t.forEach(this._uiNodes.buildUpRarities,function(t,i){t.checkbox.setColor(o),t.icon.setColor(o),t.checkbox.setTouchEnabled(n);var a=e.containsBuildUpRarity(i);t.checkbox.setHighlighted(a)}.bind(this))},_updateHasBonus:function(e){var t=e.isEnabled(),n=e.includesHasBonus(),i=this._uiNodes.hasBonus.sellBtn,a=this._uiNodes.hasBonus.notSellBtn,o=t?"#FFFFFF":"#808080",r=cc.color(o);i.setTouchEnabled(t&&!n),i.setHighlighted(n),i.setColor(r),a.setTouchEnabled(t&&n),a.setHighlighted(!n),a.setColor(r)},_getUINodes:function(){var e={};e.enabled=t.mapValues(this.UI_NODE_NAMES.enabled,function(e){return this._getNodeByName(e)}.bind(this)),e.normalLabel=this._getNodeByName(this.UI_NODE_NAMES.normalLabel),e.buildUpLabel=this._getNodeByName(this.UI_NODE_NAMES.buildUpLabel),e.hasBonus=t.mapValues(this.UI_NODE_NAMES.hasBonus,function(e){return this._getNodeByName(e)}.bind(this));var n=Object.assign({},this.UI_NODE_NAMES.rarities);this._node.seekWidgetByName(this.UI_NODE_NAMES.rarities.R.icon)||delete n.R,e.rarities=t.mapValues(n,function(e){return{icon:this._getNodeByName(e.icon),checkbox:this._getNodeByName(e.checkbox)}}.bind(this)),e.buildUpRarities=t.mapValues(this.UI_NODE_NAMES.buildUpRarities,function(e){return{icon:this._getNodeByName(e.icon),checkbox:this._getNodeByName(e.checkbox)}}.bind(this));var i=function(e){e.checkbox.setLockTimeout(20)};return t.forEach(e.rarities,i),t.forEach(e.buildUpRarities,i),e},_getNodeByName:function(e,n){t.isUndefined(n)&&(n=this._node);var i=n.seekWidgetByName(e);return i||console.warn("AutoSpendFormView._getNodeByName(): node '"+e+"' not found"),i}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.createNameSpaceIfNotExists("autospend.view"),t.autospend.view.AutoSpendHintPopup=t.ImplantedPopup.extend({_initContents:function(){this.setButtonEvents({btn_ok:!0})}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.createNameSpaceIfNotExists("autospend.view"),t.autospend.view.AutoSpendErrorPopup=t.ImplantedPopup.extend({_initContents:function(){this.setButtonEvents({btn_ok:!0})}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.createNameSpaceIfNotExists("autospend.view"),t.autospend.view.AutoSpendResultPopup=t.ImplantedPopup.extend({_initContents:function(){this.setButtonEvents({btn_ok:!0})}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);e.Q,t.createNameSpaceIfNotExists("pc.autospend.roles"),t.pc.autospend.roles.Routing={_verifyTemporaryRouterParams001:function(e){if(!n.isUndefined(e.temporaryRouterParams.autospend_001)&&!n.isUndefined(e.temporaryRouterParams.autospend_001.tab)){var t=e.temporaryRouterParams.autospend_001.tab;return n.contains(["weapon","summon"],t)}}},n.assign(t.pc.autospend.roles.Routing,t.pc.roles.RoutingCommon)}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.autospend=t.pc.autospend||{},t.pc.autospend.autospend_001=t.pc.autospend.autospend_001||{},t.pc.autospend.autospend_001.Scene=t.BaseScene.extend({resourceFileName:"autospend_001/autospend_001.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[{tab1:{node:"tab_0","content-node":"tab_0_node"},tab2:{node:"tab_1","content-node":"tab_1_node"}}],componentName:"autospend",sceneName:"autospend_001",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath("weapon_panel"),"btn_function_off","btnCallbackWeaponPanelBtnFunctionOff",null,function(){alert("{{}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("weapon_panel"),"btn_function_on","btnCallbackWeaponPanelBtnFunctionOn",null,function(){alert("{{}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("weapon_panel"),"btn_checkbox_normal_n","btnCallbackWeaponPanelBtnCheckboxNormalN",null,function(){alert("{{}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("weapon_panel"),"btn_checkbox_material_r","btnCallbackWeaponPanelBtnCheckboxMaterialR",null,function(){alert("{{}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("weapon_panel"),"btn_checkbox_material_sr","btnCallbackWeaponPanelBtnCheckboxMaterialSr",null,function(){alert("{{}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("weapon_panel"),"btn_not_sell","btnCallbackWeaponPanelBtnNotSell",null,function(){alert("{{}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("weapon_panel"),"btn_sell","btnCallbackWeaponPanelBtnSell",null,function(){alert("{{}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("summon_panel"),"btn_function_off","btnCallbackSummonPanelBtnFunctionOff",null,function(){alert("{{}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("summon_panel"),"btn_function_on","btnCallbackSummonPanelBtnFunctionOn",null,function(){alert("{{}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("summon_panel"),"btn_checkbox_normal_n","btnCallbackSummonPanelBtnCheckboxNormalN",null,function(){alert("{{}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("summon_panel"),"btn_checkbox_normal_r","btnCallbackSummonPanelBtnCheckboxNormalR",null,function(){alert("{{}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("summon_panel"),"btn_checkbox_material_r","btnCallbackSummonPanelBtnCheckboxMaterialR",null,function(){alert("{{}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("summon_panel"),"btn_checkbox_material_sr","btnCallbackSummonPanelBtnCheckboxMaterialSr",null,function(){alert("{{}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("summon_panel"),"btn_not_sell","btnCallbackSummonPanelBtnNotSell",null,function(){alert("{{}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("summon_panel"),"btn_sell","btnCallbackSummonPanelBtnSell",null,function(){alert("{{}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_hint","btnCallbackBtnHint",null,function(){alert("{{autospend_hint}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_apply_setting","btnCallbackBtnApplySetting",null,function(){alert("{{}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=(e._,e.Q);t.pc=t.pc||{},t.pc.autospend=t.pc.autospend||{},t.pc.autospend.autospend_001=t.pc.autospend.autospend_001||{},t.pc.autospend.autospend_001.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../autospend_popup_ui.json"],_popups:{},_summonConfigModel:null,_weaponConfigModel:null,_summonConfigFormView:null,_weaponConfigFormView:null,onSceneInit:function(e){this._verifyTemporaryRouterParams001(e);var n=e.temporaryRouterParams.autospend_001?e.temporaryRouterParams.autospend_001:{tab:"weapon"};this._weaponConfigModel=new t.autospend.model.AutoSpendConfig(t.autospend.model.AutoSpendConfig.prototype.TYPE_WEAPON);var a=e.seekWidgetByName("weapon_panel");this._weaponConfigFormView=new t.autospend.view.AutoSpendFormView(a),this._weaponConfigModel.addEventListener("PROPERTY_CHANGED",function(){this._weaponConfigFormView.update(this._weaponConfigModel)}.bind(this)),this._summonConfigModel=new t.autospend.model.AutoSpendConfig(t.autospend.model.AutoSpendConfig.prototype.TYPE_SUMMON);var o=e.seekWidgetByName("summon_panel");return this._summonConfigFormView=new t.autospend.view.AutoSpendFormView(o),this._summonConfigModel.addEventListener("PROPERTY_CHANGED",function(){this._summonConfigFormView.update(this._summonConfigModel)}.bind(this)),this._selectTab(e,n.tab),i.all([this._summonConfigModel.prepare(),this._weaponConfigModel.prepare()]).spread(function(e,t){return i.resolve()})},onSceneEnter:function(e){return i.defer(),i.resolve()},onSceneExit:function(e){return this._summonConfigModel.removeEventListenersByEventName("PROPERTY_CHANGED"),this._weaponConfigModel.removeEventListenersByEventName("PROPERTY_CHANGED"),i.resolve()},onPageInAnimationEnd:function(e){return i.defer(),i.resolve()},tabCallbackTab0:function(e){},tabCallbackTab1:function(e){},btnCallbackWeaponPanelBtnFunctionOff:function(e){var t=i.defer();return t.reject(this._override),this._weaponConfigModel.setEnabled(!1),t.promise},btnCallbackWeaponPanelBtnFunctionOn:function(e){var t=i.defer();return t.reject(this._override),this._weaponConfigModel.setEnabled(!0),t.promise},btnCallbackWeaponPanelBtnCheckboxNormalN:function(e){var t=i.defer();return t.reject(this._override),this._weaponConfigModel.toggleRarity("N"),t.promise},btnCallbackWeaponPanelBtnCheckboxMaterialR:function(e){var t=i.defer();return t.reject(this._override),this._weaponConfigModel.toggleBuildUpRarity("R"),t.promise},btnCallbackWeaponPanelBtnCheckboxMaterialSr:function(e){var t=i.defer();return t.reject(this._override),this._weaponConfigModel.toggleBuildUpRarity("SR"),t.promise},btnCallbackWeaponPanelBtnNotSell:function(e){var t=i.defer();return t.reject(this._override),this._weaponConfigModel.setIncludesHasBonus(!1),t.promise},btnCallbackWeaponPanelBtnSell:function(e){var t=i.defer();return t.reject(this._override),this._weaponConfigModel.setIncludesHasBonus(!0),t.promise},btnCallbackSummonPanelBtnFunctionOff:function(e){var t=i.defer();return t.reject(this._override),this._summonConfigModel.setEnabled(!1),t.promise},btnCallbackSummonPanelBtnFunctionOn:function(e){var t=i.defer();return t.reject(this._override),this._summonConfigModel.setEnabled(!0),t.promise},btnCallbackSummonPanelBtnCheckboxNormalN:function(e){var t=i.defer();return t.reject(this._override),this._summonConfigModel.toggleRarity("N"),t.promise},btnCallbackSummonPanelBtnCheckboxNormalR:function(e){var t=i.defer();return t.reject(this._override),this._summonConfigModel.toggleRarity("R"),t.promise},btnCallbackSummonPanelBtnCheckboxMaterialR:function(e){var t=i.defer();return t.reject(this._override),this._summonConfigModel.toggleBuildUpRarity("R"),t.promise},btnCallbackSummonPanelBtnCheckboxMaterialSr:function(e){var t=i.defer();return t.reject(this._override),this._summonConfigModel.toggleBuildUpRarity("SR"),t.promise},btnCallbackSummonPanelBtnNotSell:function(e){var t=i.defer();return t.reject(this._override),this._summonConfigModel.setIncludesHasBonus(!1),t.promise},btnCallbackSummonPanelBtnSell:function(e){var t=i.defer();return t.reject(this._override),this._summonConfigModel.setIncludesHasBonus(!0),t.promise},btnCallbackBtnHint:function(e){var t=i.defer();return t.reject(this._override),this._openAutoSpendHintPopup(),t.promise},btnCallbackBtnApplySetting:function(e){var t=i.defer();return t.reject(this._override),this._summonConfigModel.isValid()&&this._weaponConfigModel.isValid()?(i.all([this._summonConfigModel.update(),this._weaponConfigModel.update()]).spread(function(){this._openAutoSpendResultPopup()}.bind(this)),t.promise):(this._openAutoSpendErrorPopup(),t.promise)},_selectTab:function(e,t){var n="summon"===t?"tab_1":"tab_0",i=e.seekWidgetByName(n);i&&e.tabDelegateList[0].selectTab(i)},_openAutoSpendHintPopup:function(){var e=n.director.getRunningScene();t.ImplantedPopup.createOrGet(e,"autospend_hint","AutoSpendHintPopup").open()},_openAutoSpendErrorPopup:function(){var e=n.director.getRunningScene();t.ImplantedPopup.createOrGet(e,"autospend_error","AutoSpendErrorPopup").open()},_openAutoSpendResultPopup:function(){var e=n.director.getRunningScene();t.ImplantedPopup.createOrGet(e,"autospend_result","AutoSpendResultPopup").open()}}),t.assignRoles(t.pc.autospend.autospend_001.SceneDelegate,[t.pc.roles.UIUtility,t.pc.autospend.roles.Routing])}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.router=n.router||{},n.router.routes=n.router.routes||{},t.merge(n.router.routes,{autospend:{autospend:"autospend_001","autospend/autospend_001":"autospend_001"}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);t.createNameSpaceIfNotExists("battle.view"),t.battle.view.AQ001StatusPopup=t.ImplantedPopup.extend({WIDGET_NAMES:{OK_BUTTON:"a_q_001_status_ok",HEADER_LABEL:"a_q_001_status_header_label",LIST_VIEW:"change_page_panel",BUTTON_UP:"btn_up",BUTTON_DOWN:"btn_down"},LIST_ITEM_WIDGET_NAMES:{ICON:"a_q_001_status_list_icon",DESCRIPTION:"a_q_001_status_list_description",DURATION:"a_q_001_status_list_interval_turn",DURATION_BASE:"a_q_001_status_list_interval_base",LEVEL_LABEL:"accumulation_no_label"},_listViewManager:null,_initContents:function(e,t){this.setTitle(e),this._displayStatusEffects(e,t);var n={a_q_001_status_ok:this._touchAQ001StatusOk.bind(this)};this.setButtonEvents(n)},_touchAQ001StatusOk:function(){this.dismiss(),this.clearTitle(),this.clearListView()},_displayStatusEffects:function(e,t){var i={},a=this._createListView();n(t).uniq().each(function(t){t["removeExpiredEffects"+n.capitalize(e.from)](e.pos),i[t.getId()]=t["getCooldownInfo"+n.capitalize(e.from)](e.pos).slice(0)});var o=t.filter(function(e){return i[e.getId()].length>0}).map(function(e){return this.createStatus(e,i[e.getId()].shift())},this);this._setListViewButtons(a),a.setRecords(o),this._listViewManager=a},_createListView:function(){var e=this._getListViewParent();return e.setPositionX(330),new t.ListViewManager(e,"core-popup_layer-a_q_001_ui_status_list",function(e,t){var n=t.statusEffect,i=t.cooldownInfo;this._setEffectDuration(e,i),this._setEffectIcon(e,n),this._setEffectDescription(e,n),this.setLevel(e,i)}.bind(this))},_getListViewParent:function(){return this._getNodeByName(this.WIDGET_NAMES.LIST_VIEW)},_setEffectIcon:function(e,n){var i=this.LIST_ITEM_WIDGET_NAMES,a=t.generateStatusIconPath(n.getType());e.seekWidgetByName(i.ICON).loadTexture(a.png||a.jpg)},_setEffectDuration:function(e,t){var n=this.LIST_ITEM_WIDGET_NAMES,i=this.getTimeRemaining(t),a=e.seekWidgetByName(n.DURATION_BASE);a.setVisible(i),a.seekWidgetByName(n.DURATION).string=i?""+i:""},_setEffectDescription:function(e,t){var n=this.LIST_ITEM_WIDGET_NAMES;e.seekWidgetByName(n.DESCRIPTION).string=t.getDescription()},setLevel:function(e,t){var n=this.LIST_ITEM_WIDGET_NAMES,i=e.seekWidgetByName(n.LEVEL_LABEL);(t.level&&(i.string=t.getLevel().toString()),t.description)&&(e.seekWidgetByName(n.DESCRIPTION).string=t.description);i.setVisible(!0)},_setListViewButtons:function(e){var t=this.WIDGET_NAMES,n=this._getNodeByName(t.BUTTON_UP),i=this._getNodeByName(t.BUTTON_DOWN);e.setBtnUp(n),e.setBtnDown(i),n.setBright(!1)},getTimeRemaining:function(e){return null!=e.turn?e.turn+"":null!=e.seconds?e.seconds.get()+"":""},createStatus:function(e,t){return{statusEffect:e,cooldownInfo:t}},setTitle:function(e){this.getNode().setStrings({a_q_001_status_header_label:e.name+""})},clearTitle:function(){this.getNode().setStrings({a_q_001_status_header_label:""})},clearListView:function(){this._getListViewParent().removeAllChildren(),this._listViewManager=null}}),t.dictx.registerWithProtoStrategy("AQ001StatusPopup",t.battle.view.AQ001StatusPopup)}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;t.createNameSpaceIfNotExists("battle.view"),t.battle.view.AQ001MenuPopup=t.ImplantedPopup.extend({MAX_CHARACTER_COUNT:5,MAX_SUB_COUNT:2,configUpdateRequired:0,resourceName:"battle_ui_menu_popup",typeDictionary:{coin:"gem",normal:"bronze",silver:"silver",gold:"gold",rainbow:"rainbow"},_initParams:null,_initContents:function(e){this._initParams=e;var i=e.gained;this._showGainedItems(i||{}),this._showCharacters();var a=this.getNode();this.configUpdateRequired=0;var o=t.createInstance("playerGameConfig"),r=a.seekWidgetByName("a_q_001_menu_fast_forward");r.setTitleText(""),r.setBright(!o.isBattleSpeedFast()),a.seekWidgetByName("btn_skip").setBright(!o.isAbilityPopupSkip()),a.seekWidgetByName("a_q_001_menu_diagram").setBright(!o.getElementDiagramVisible()),a.seekWidgetByName("btn_summon_skip").setBright(o.isSummonEffectEnabled());var s={btn_skip:this._touchBtnSkip.bind(this,o),btn_summon_skip:this._touchBtnSummonSkip.bind(this,o),a_q_001_menu_diagram:this._touchAQ001MenuDiagram.bind(this,o),a_q_001_menu_fast_forward:this._touchAQ001MenuFastForward.bind(this,o),a_q_001_menu_cancel:this._touchAQ001MenuCancel.bind(this),a_q_001_menu_mypage:this._touchAQ001MenuMypage.bind(this),a_q_001_menu_withdraw:this._touchAQ001MenuWithdraw.bind(this,i)};this.setButtonEvents(s),a.seekWidgetByName("a_q_001_menu_cancel").setSound(t.SoundList.WINDOW_CLOSE),a.seekWidgetByName("a_q_001_menu_fast_forward").setSound(t.SoundList.BUTTON_TOUCHED_DECIDE),a.seekWidgetByName("a_q_001_menu_diagram").setSound(t.SoundList.BUTTON_TOUCHED_DECIDE),a.seekWidgetByName("btn_skip").setSound(t.SoundList.BUTTON_TOUCHED_DECIDE),a.seekWidgetByName("a_q_001_menu_mypage").setSound(t.SoundList.BUTTON_TOUCHED_DECIDE);var c=a.seekWidgetByName("a_q_001_menu_withdraw");null!=c&&(t.createInstance("questInfo").isUnionMajorRaidBossQuestType()?(c.setEnabled(!1),c.setColor(n.color("#808080")),c.setSoundEnabled(!1)):(c.setEnabled(!0),c.setColor(n.color.WHITE),c.setSound(t.SoundList.BUTTON_TOUCHED_DECIDE)))},updateConfig:function(){0|this.configUpdateRequired&&t.createInstance("playerGameConfig").updateGameConfig().then(function(){t.createInstance("playerGameConfigDISettings").updateDIDependencyLists(t.createInstance("playerGameConfig"));var e=t.createInstance("battleWorld");i.invoke(i.filter(e.characterList.concat(e.enemyList),function(e){return!i.isEmpty(e)&&null!=e}),"applyPlayerGameConfig")})},_showGainedItems:function(e){var t=this.getNode();i.each(i.keys(this.typeDictionary),function(n){t.seekWidgetByName("a_q_001_menu_prize_{{type}}_no".replace(/{{type}}/,this.typeDictionary[n])).setString((e[n]||0).toString())}.bind(this))},_showCharacters:function(){var e=t.createInstance("battleWorld"),n=this._getCharacterDataList(e.characterList,this.MAX_CHARACTER_COUNT),a=this._getCharacterDataList(e.subList,this.MAX_SUB_COUNT);i.each(i.range(this.MAX_CHARACTER_COUNT+this.MAX_SUB_COUNT),function(e){e>=this.MAX_CHARACTER_COUNT?this._loadCharacterTexture(e,a[e-this.MAX_CHARACTER_COUNT]):this._loadCharacterTexture(e,n[e])},this)},_getCharacterDataList:function(e,t){return i.map(i.range(t),function(t){return t>=e.length||null==e[t]||i.isEmpty(e[t])?{id:-1,isJob:!1}:{id:e[t].id,isJob:e[t].isJob||!1}})},_loadCharacterTexture:function(e,n){var i=this.getNode().seekWidgetByName("a_q_001_menu_party_chara_card_"+e);if(i.setVisible(-1!==n.id),-1!==n.id){var a=t.generateAvatarCorecard(n.id,n.isJob,n.skin||0);i.loadTexture(a.png||a.jpg)}},_touchBtnSkip:function(e){var t=e.isAbilityPopupSkip();this.getNode().seekWidgetByName("btn_skip").setBright(t),e.setAbilityPopupSkip(!t),this.configUpdateRequired^=8},_touchBtnSummonSkip:function(e){var t=e.isSummonEffectEnabled();this.getNode().seekWidgetByName("btn_summon_skip").setBright(!t),e.setSummonEffectEnabled(!t),this.configUpdateRequired^=4},_touchAQ001MenuDiagram:function(e){var n=e.getElementDiagramVisible();this.getNode().seekWidgetByName("a_q_001_menu_diagram").setBright(n),e.setElementDiagramVisible(!n),t.createInstance("battleUI").AttributeDiagram.setEnabled(!n),this.configUpdateRequired^=2},_touchAQ001MenuFastForward:function(e){var n=e.isBattleSpeedFast();this.getNode().seekWidgetByName("a_q_001_menu_fast_forward").setBright(n),e.setBattleSpeedFast(!n),t.createInstance("playerGameConfigDISettings").updateDIDependencyLists(e);var a=t.createInstance("battleWorld");i.invoke(i.filter(a.characterList.concat(a.enemyList),function(e){return!i.isEmpty(e)&&null!=e}),"applyPlayerGameConfig"),this.configUpdateRequired^=1},_touchAQ001MenuCancel:function(){this.updateConfig(),this.dismiss()},_touchAQ001MenuMypage:function(){this.updateConfig(),this.dismiss(),this._getScene()._questInfo._isOwnRaid?t.createInstance("myPagePopupFactory").create({}).open():t.createInstance("reliefMypagePopupFactory").create({}).open()},_touchAQ001MenuWithdraw:function(e){this.updateConfig(),this.dismiss();var n=t.createInstance("questInfo");t.createInstance("backCheckPopupFactory").create({}).open(i.assign(e,{type:"quest",aQuestId:n.getQuestId(),questId:n.getMasterQuestId(),questType:n.getQuestType(),onCancel:function(){this.open(this._initParams)}.bind(this),preventNavigateBack:!0,questCategory:n.getQuestCategory(),questSubCategory:n.getQuestSubCategory()}))}}),t.dictx.registerWithProtoStrategy("AQ001MenuPopup",t.battle.view.AQ001MenuPopup)}((this||0).self||global),function(e){var t=e.kh;e.cc,e._,t.createNameSpaceIfNotExists("battle.view"),t.battle.view.AQ001SkillGo1Popup=t.ImplantedPopup.extend({_initContents:function(e){var n=t.createInstance("abilityPopupExtended");this.popup=t.createInstance("abilityPopupFactory").create({blueprint:t.ABILITY_POPUP_BLUEPRINTS.abilityPopupExtended,methods:{}},[n]),n.popupDefer=this._dfd,n.popup=this,n._characterPanels=null,n._refreshCharacterProperties(),this._dfd.promise.finally(function(){this.popup.dismiss()}.bind(this));var i=this.getNode();this.popup.getWidget=function(e){return i.seekWidgetByName(e)},n._abilityType=e.party_member_selectable_type||"heal",n._characterPanels=n._characterPanels||n._initCharacterCards(i),this.popup.displayAbilityData(e),n._displayCharacterPanels();this.setButtonEvents({a_q_001_skillgo_1_cancel:!1})}}),t.dictx.registerWithProtoStrategy("AQ001SkillGo1Popup",t.battle.view.AQ001SkillGo1Popup)}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.AbilityInfoSlide=n.Class.extend({className:"KHAbilityInfoSlide",WIDGET_NAMES:{ROOT:"a_q_001_ability_window",OK_BUTTON:"btn_ok",CANCEL_BUTTON:"btn_cancel",ABILITY_BAN_EXPLANATION:"ban_label",ABILITY_DURATION_EXPLANATION:"duration_label",ABILITY_INTERVAL_LABEL:"interval_label",ABILITY_DESCRIPTION_LABEL:"description_label",ABILITY_NAME_LABEL:"name_label",ABILITY_ICON:"coreimg_abilityicon"},ANIMATION_NAMES:{OPEN:"ability_open",CLOSE:"ability_close",OK_CANCEL:"skill_ok",CANCEL:"skill_not"},BAN_LABEL_TEXTS:{NOT_READY:"",BAN_ABILITY:"",CONDITION:""},open:function(e){var n=Q.defer();return this._widget=t.createInstance("battleUI").getWidgetByName(this.WIDGET_NAMES.ROOT),this._widget.seekWidgetByName(this.WIDGET_NAMES.OK_BUTTON).addTouchEventListener(function(e,t){t===ccui.Widget.TOUCH_ENDED&&(n.resolve(),this.close())},this),this._widget.seekWidgetByName(this.WIDGET_NAMES.CANCEL_BUTTON).addTouchEventListener(function(e,t){t===ccui.Widget.TOUCH_ENDED&&(n.reject(),this.close())},this),this._displayAbilityData(e),t.createInstance("battleUI").playAction(this.ANIMATION_NAMES.OPEN),t.createInstance("characterStatusPanelHandler").setEnabled(!1),this._widget.scheduleOnce(this.setAbilityButton.bind(this,e)),n.promise},close:function(){t.createInstance("battleUI").playAction(this.ANIMATION_NAMES.CLOSE),t.createInstance("characterStatusPanelHandler").setEnabled(!0)},getWidget:function(e){return this._widget.seekWidgetByName(e)},setAbilityDuration:function(e){var t=null==e?"":":"+e;this.getWidget(this.WIDGET_NAMES.ABILITY_DURATION_EXPLANATION).string=t},setAbilityBanExplanationVisible:function(e){this.getWidget(this.WIDGET_NAMES.ABILITY_BAN_EXPLANATION).setVisible(e)},setAbilityBanLabelText:function(e){var t;e.is_banned?t=this.BAN_LABEL_TEXTS.BAN_ABILITY:e.ready?e.is_condition_satisfy||(t=this.BAN_LABEL_TEXTS.CONDITION):t=this.BAN_LABEL_TEXTS.NOT_READY,this.getWidget(this.WIDGET_NAMES.ABILITY_BAN_EXPLANATION).string=t},setAbilityName:function(e){this.getWidget(this.WIDGET_NAMES.ABILITY_NAME_LABEL).string=e},setAbilityIcon:function(e){t.createInstance("AbilityIcon",[this._widget,e.type,e.color,!1]).show()},setAbilityIconDarkenFilter:function(e){this.getWidget(this.WIDGET_NAMES.ABILITY_ICON).color=e?n.color(255,255,255,255):t.BATTLE_UI_DARKEN_FILTER_COLOR},setAbilityDescription:function(e){this.getWidget(this.WIDGET_NAMES.ABILITY_DESCRIPTION_LABEL).string=e},setAbilityInterval:function(e){this.getWidget(this.WIDGET_NAMES.ABILITY_INTERVAL_LABEL).string=":"+e+""},_displayAbilityData:function(e){this.setAbilityName(e.name),this.setAbilityDescription(e.description),this.setAbilityIcon(e),this.setAbilityIconDarkenFilter(e.ready),this.setAbilityInterval(e.turn),this.setAbilityDuration(e.duration),this.setAbilityBanLabelText(e),this.setAbilityIconDarkenFilter(e.ready&&!e.is_banned&&e.is_condition_satisfy)},setAbilityButton:function(e){var t;t=e.ready&&!e.is_banned&&e.is_condition_satisfy?this.ANIMATION_NAMES.OK_CANCEL:this.ANIMATION_NAMES.CANCEL,this._widget.animate(t)}})}((this||0).self||global),function(e){var t=e.kh;t.PubsubMock=cc.Class.extend({ctor:function(){},join:function(){},addEventListener:function(){}}),t.pubsubMock=new t.PubsubMock}((this||0).self||global),function(e){var t=e.kh;t.EVENT_PREFIX={},t.EVENT_PREFIX.SUMMON=["SUMMON0","SUMMON1","SUMMON2","SUMMON3","SUMMON4","SUMMON5"],t.EVENT_NAME={},t.EVENT_NAME.SUMMON_ANIMATION={REQUEST_PLAY:"REQUEST_PLAY"},t.EVENT_NAME.BATTLE_DATA_RECEIVED="battleDataReceived",t.EVENT_NAME.PUBSUB_EVENT_APPLY_BATTLE_DATA="applyBattleData",t.EVENT_NAME.BATTLE_UI_DARKEN_FILTER={DARKEN_FOOTER:"battle_ui_darken_filter_darken_footer",RESTORE_FOOTER:"battle_ui_darken_filter_restore_footer"},_.each(_.range(5),function(e){t.EVENT_NAME.BATTLE_UI_DARKEN_FILTER["DARKEN_CHARACTER_"+e]="battle_ui_darken_filter_darken_character_"+e,t.EVENT_NAME.BATTLE_UI_DARKEN_FILTER["RESTORE_CHARACTER_"+e]="battle_ui_darken_filter_restore_character_"+e}),t.EVENT_NAME.POST_STAMP="show_stamp",t.EVENT_NAME.FADE_CHARACTERS_IN="fade_characters_in"}((this||0).self||global),function(e){var t=e.kh;t.createNameSpaceIfNotExists("raid_scenario"),t.raid_scenario.RAID_SCENARIO_LIMIT=30,t.raid_scenario.CHANNEL_REGISTRY={default:[],2:["increase_participants","raid_message"]}}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e.console;t.BattleScene=n.Scene.extend({_raidParticipantAPlayerId:null,ctor:function(n){this._super(),this._isNextStage=!1,this._sceneNavigate=n;var i=n.getRouterParams();i.payment_id&&t.createInstance("router").permanentlyRemoveRouterParam("payment_id"),this._questInfo=null==i?t.createInstance("questInfo"):t.createInstance("questInfo").init(i.a_battle_id,i.quest_type,i.a_quest_id,i.quest_id,i.is_own_raid,i.quest_category,i.quest_sub_category),t.env.useApiMock||-1!==this.getBattleId()&&""!==this.getQuestType()&&-1!==this.getQuestId()||(e.console.error("Trying to start a battle without proper ID info: redirecting to quest top!"),t.createInstance("router").navigate("quest"))},_getMyPlayerId:function(){return null==this._raidParticipantAPlayerId?t.createInstance("apiAPlayers").getMeNumeric().then(function(e){return e.body.a_player_id}):Q.resolve(this._raidParticipantAPlayerId)},_getWebsocketRoot:function(){return t.createInstance("apiBattle").getWebsocketDomain().then(function(e){return e.body.domain+":"+e.body.port})},onEnter:function(){this._super(),t.env.isSp&&n.game.setFrameRate(30),t.createInstance("myselfInfoRepository").clearQuestPointCache();var e=function(){n.game.resume(),this.scheduleOnce(function(){n.game.resume()})}.bind(this);this._backgroundUpdater=n.eventManager.addCustomListener(n.game.EVENT_HIDE,e),this.isRaid()&&(this._readyPubsubBattle(),t.createInstance("raidDIConfig").inject(!0)),t.createInstance("playerGameConfigDISettings").updateDIDependencyLists(t.createInstance("playerGameConfig"));var a=t.createInstance("battleWorld");a.init().then(function(){n.director.resume(),n.director.startAnimation(),a.runScene(this)}.bind(this)).catch(function(e){e&&(i.warn(e),t.createInstance("smartBeat").sendError(e))})},_readyPubsubBattle:function(){Q.all([this._getMyPlayerId(),this._getWebsocketRoot()]).spread(this._joinPubsubRoom.bind(this)).fail(function(e){i.error(e)})},_joinPubsubRoom:function(e,n){this._raidParticipantAPlayerId=e;var i=t.createInstance("pubsubBattle");i.connect(n),i.join(this.getBattleId(),this.getQuestType(),e)},getBattleId:function(){return this._questInfo.getBattleId()},getQuestType:function(){return this._questInfo.getQuestType()},getQuestId:function(){return this._questInfo.getQuestId()},isRaid:function(){return this._questInfo.isRaidQuestType()},renew:function(){return new this.constructor(this._sceneNavigate)},belongsToAPlayerId:function(e){return this._raidParticipantAPlayerId===e},onExit:function(){t.env.isSp&&n.game.setFrameRate(20),n.eventManager.removeListener(this._backgroundUpdater),this.isRaid()&&t.createInstance("pubsubBattle").disconnect(),this.getActionManager().removeAllActions(),n.eventManager.removeAllListeners(),t.addConnectionEventListeners(),n.Scene.prototype.onExit.apply(this,arguments),!0!==this._isNextStage&&Object.keys(t.di.battleSingletonDependencyList).concat(t.di.raidBattleSingletonDependencyList).forEach(function(e){if("questInfo"!==e&&t.dictx.has(e)){var n=t.dictx.entry(e).object();n&&n.dispose&&n.dispose(),t.cleanupProperties(n),t.dictx.entry(e).object(void 0)}})}})}((this||0).self||global),function(e){var t=e.cc,n=e.ccui,i=e.kh,a=(e.res,e.gResources,e._),o=e.khutil,r=e.console;i.BattleWorld=t.Class.extend({className:"KHBattleWorld",ENTER_BATTLE_ANIMATION_DELAY:600,FIXED_ENTITY_NAMES:{LAYER:"layer",BATTLE_UI:"BattleUI",SOUND:"sound",CUT_IN:"cutin"},backendAPI:null,scenarioPlayer:null,soundPlayer:null,BattleLayer:null,BackgroundLayer:null,characterList:[],enemyList:[],subList:[],fallenList:[],turn:null,cutIn:null,background:null,summonList:null,characterAbilityList:[],battleUI:null,buttonCallbacks:null,soundButton:null,attackButton:null,burstButton:null,healButton:null,backButton:null,summonButton:null,summonPanelGroup:null,characterPanelList:null,enemyStatusBarList:null,battleStatus:null,statusEffectList:{},_initializerRegistry:null,_layerRegistry:null,runScene:function(e){this._setPropertiesToLayer(),e.addChild(this.BackgroundLayer),e.addChild(this.EnemyLayer),e.addChild(this.CharacterLayer),e.addChild(this.BattleLayer),e.addChild(this.UIBackLayer),e.addChild(this.CutinLayer),e.addChild(this.UIFrontLayer);var t=i.createInstance("router"),n=t.getCurrentComponent(),a=t.getCurrentSceneName();i.createInstance("notificationCenter").dispatchEvent("scene:prepared",[n,a]),this._start(e.__instanceId)},_setPropertiesToLayer:function(){a.each(this._layerRegistry.getPropertyAppendToLayerList(),function(e,t){a.isUndefined(this[t])||a.isNull(this[t])||this._setPropertyToLayerFromLayerName(e.appendToLayer,this[t],e.zOrder)},this)},_setPropertyToLayerFromLayerName:function(e,t,n){if(a.isArray(t))a.each(t,function(t){this._setPropertyToLayerFromLayerName(e,t,n)}.bind(this));else{if(null==t||a.isUndefined(t.appendTo))return;t.appendTo(this[e],n)}},init:function(){var t=this._getSceneInstanceId();return i.createInstance("smartBeat").init(),this._getInitialData().then(this.__verifySceneInstance.bind(this,t)).then(function(e){return Q.all([this._startProgressAnimation(e.stage),this._load(e.battle)]).thenResolve(e)}.bind(this)).then(this.__verifySceneInstance.bind(this,t)).fail(function(t){e.console.warn(t)}).then(this._initializeFixedProperties.bind(this)).fail(function(t){e.console.warn(t)}).then(this._handleInitialData.bind(this)).then(this._finishProgressAnimation.bind(this)).then(this._initEvents.bind(this)).then(this._updateBattleStatus.bind(this)).fail(function(t){t&&t.stack&&(e.console.warn(t),i.createInstance("smartBeat").sendError(t))})},_initializeFixedProperties:function(e){return this._initializerRegistry=i.createInstance("initializerRegistry"),this._layerRegistry=i.createInstance("layerRegistry"),this.scenarioPlayer=i.createInstance("scenarioPlayer"),this.burstVoiceScenario=i.createInstance("burstVoiceScenario").init(),this._initButtonCallbacks(),a(this.FIXED_ENTITY_NAMES).each(function(e){this._initProperty(e)},this),this.curePopup=i.createInstance("curePopup").init(),this.autoScenarioHandler=i.createInstance("autoScenarioHandler").init(),e},_getInitialData:function(){var e=this._getSceneInstanceId();return Q.all([this._getInitialBattleData(),this._getInitialQuestData()]).spread(function(t,n){return{stage:t.body.stage,battle:t,status:t.body.status,quest:n.body,sceneInstanceId:e}})},_getInitialBattleData:function(){this.backendAPI=i.createInstance("apiBattle");var e=i.createInstance("questInfo");return this.backendAPI.getStart(e.getQuestType())},_getInitialQuestData:function(){var e=i.createInstance("questInfo");return i.createInstance("apiAQuests").getGainedItems(e.getQuestId(),e.getQuestType())},_handleInitialData:function(e){return this._handleInitialBattleData(e.battle).then(this._handleInitialQuestData.bind(this,e.quest)).thenResolve(e)},_handleInitialBattleData:function(e){var t=a.cloneDeep(e.body);return delete t.status,i.createInstance("logger").reportBattleStart(this._getSceneInstanceId(),t),this._initPropertiesFromStartData(e.body)},_handleInitialQuestData:function(e){return this.battleUI.BattleUIHeader.updateTreasureData(e.gained_items),Q.resolve(e)},_startProgressAnimation:function(e){return e.current<=1?Q.resolve():(i.postMessage("removeLoading"),this._stageProgress=i.createInstance("StageProgress"),this._stageProgress.playProgressAnimation(e))},_finishProgressAnimation:function(e){return i.postMessage("removeLoading"),null==this._stageProgress?e:(this._stageProgress.finishProgressAnimation(),e)},_initEvents:function(e){t.eventManager.addCustomListener(i.EVENT_NAME.SUMMON_ANIMATION.REQUEST_PLAY,a.bind(this._summonAttack,this));var n=i.createInstance("notificationCenter"),o=i.createInstance("router").getCurrentFragment();return a.each(i.EventSettings,function(e){e(n,o,this)},this),e},_summonAttack:function(e){var n=i.createInstance("notificationCenter");this.battleUI.beforeSummon(),this.battleUI.setEnabled(!1),n.dispatchEvent(i.EVENT_NAME.BATTLE_UI_DARKEN_FILTER.DARKEN_FOOTER),this.scenarioPlayer.addScenarioEndEventCallbackOnce(function(){this.battleUI.setEnabled(!0),n.dispatchEvent(i.EVENT_NAME.BATTLE_UI_DARKEN_FILTER.RESTORE_FOOTER)},this);var a=t.director.getRunningScene().getQuestType(),o=e.getUserData();i.createInstance("logger").reportBattleActionRequest(this._getSceneInstanceId(),{action_type:"postAttackSummon"}),Q.all([this.backendAPI.postAttackSummonJson(a,o),this.summonList[o].play()]).then(function(e){this._handleData(e[0])}.bind(this))},_load:function(e){var t=e.body,n=i.createInstance("battleUrlParser");n.parse(t);var a=n.getUrlList(),o=Q.defer(),r=this._getSceneInstanceId();return i.loader.load(a).then(function(){t.sceneInstanceId=r,o.resolve(t)}),o.promise},_start:function(e){return this.stage.drawBackground(),this.stage.playBgm(),this.stage.showStageNumbers(),this._playAllEnterBattleAnimations(e).then(this._playBossAnimation.bind(this)).then(this.__verifySceneInstance.bind(this,e)).then(this._playStartAnimation.bind(this)).then(this.__verifySceneInstance.bind(this,e)).then(this._showOnStartPopups.bind(this)).then(this.__verifySceneInstance.bind(this,e)).then(this._enableBattleUI.bind(this)).then(this._updateBattleUIStatus.bind(this)).then(this._resumeAutoScenario.bind(this))},_playAllEnterBattleAnimations:function(e){return this._playEnterBattleAnimations(this.enemyList).then(this.__verifySceneInstance.bind(this,e)).then(this._playEnterBattleAnimations.bind(this,this.characterList)).then(this.__verifySceneInstance.bind(this,e)).then(o.getPromiseToDelayAnimation.bind(o,this.ENTER_BATTLE_ANIMATION_DELAY))},_playEnterBattleAnimations:function(e){return o.getPromiseToDelayAnimation(this.ENTER_BATTLE_ANIMATION_DELAY).then(function(){a.map(a.shuffle(e),function(e){return null==e||null==e.playEnterBattleAnimation?Q.resolve:e.playEnterBattleAnimation.bind(e)},this).reduce(Q.when,Q())})},_playBossAnimation:function(){return this.stage.hasBossAnimation()?i.createInstance("BossAnimation").playBossAnimation(this.CutinLayer):Q.resolve()},_playStartAnimation:function(){return i.createInstance("StartAnimation").playStartAnimation(this.CutinLayer)},_enableBattleUI:function(e){this.battleUI.CenterPanel.setEnabled(!0),this.battleUI.setEnabled(e),i.createInstance("notificationCenter").dispatchEvent(i.EVENT_NAME.BATTLE_UI_DARKEN_FILTER.RESTORE_FOOTER)},_updateBattleUIStatus:function(){return this._hasEnemies()?Q.resolve():(i.createInstance("stage").setStageCleared(!0),this.battleUI.CenterPanel.setEnabled(!0),this.battleUI.setEnabled(!1),this._showTreasureData(),this.battleUI.NextButton.setEndBattleCallback(),this.battleUI.CenterPanel.showNextButton())},_resumeAutoScenario:function(){var e=i.createInstance("autoScenarioHandler");return e.isInterrupted()?i.createInstance("stage").isStageCleared()?Q.resolve():0===a.reject(i.createInstance("battleWorld").characterList,a.isEmpty).length?Q.resolve():(e.resume(),e.isEnabled()&&this.battleUI.AttackButton.simulateAttack(),Q.resolve()):Q.resolve()},_showTreasureData:function(){var e=this.battleUI.BattleUIHeader;e.hideHeaderInfo(),e.setPrizeVisible(!0)},_showOnStartPopups:function(){return this.checkContinuePopupConditions()?(i.createInstance("notificationCenter").dispatchEvent(i.EVENT_NAME.BATTLE_UI_DARKEN_FILTER.DARKEN_FOOTER),i.createInstance("continuePopup").open().thenResolve(!1)):Q.resolve(!0)},checkContinuePopupConditions:function(){return!this._hasCharacters()&&this._hasEnemies()},_hasEnemies:function(){return a.filter(this.enemyList,function(e){return e&&!a.isEmpty(e)}).length>0},_hasCharacters:function(){return a.filter(this.characterList,function(e){return e&&!a.isEmpty(e)}).length>0},_initPropertiesFromStartData:function(e){this._initProperty("EnemyStatusBarList",e),a(e).each(function(e,t){"sceneInstanceId"!==t&&this._initProperty(t,e)},this);var t=Q.defer();return t.resolve(e),t.promise},_initButtonCallbacks:function(){this.buttonCallbacks={},this.buttonCallbacks.onPushAttackButtonCallback=this._onPushAttackButtonCallback.bind(this),this.buttonCallbacks.onPushBurstButtonCallback=this._onPushBurstButtonCallback.bind(this),this.buttonCallbacks.onPushAbilityButtonCallback=this._onPushAbilityButtonCallback.bind(this),this.buttonCallbacks.onPushHealButtonCallback=this._onPushHealButtonCallback.bind(this),this.buttonCallbacks.onPushSoundButtonCallback=this._onPushSoundButtonCallback.bind(this)},_initProperty:function(e,t){var n=this._createEntity(e,t),i=this._getPropertyNameFromEntityKey(e);this._setEntityToProperty(i,n)},_createEntity:function(e,t){var n=this._createInitializer(e),i=t;if("initDataKeys"in n){var o=n.initDataKeys;i=a.map(o,function(e,n){return"initialData"==n?t:this[n]},this)}return n.init(i),n.getEntity()},_setEntityToProperty:function(e,t){if(a.isObject(e)){var n=a.keys(e);a.each(n,function(n){this._setEntityToProperty(e[n],t[n])},this)}else this[e]=t},_createInitializer:function(e){return this._initializerRegistry.createFactory(e).create()},_getPropertyNameFromEntityKey:function(e){return this._initializerRegistry.getPropertyNameFromEntityKey(e)},_applyDataKeyList:{scenario:"_playScenario",turn:"_applyTurn"},_onPushSoundButtonCallback:function(e,t){if(t===n.Widget.TOUCH_ENDED){var a=i.createInstance("soundPlayer"),o=i.createInstance("playerGameConfig"),r=!o.isSoundOn();this.battleUI.SoundButton.setTexture(r),a.enableSound(r),a.enableBgm(r),a.enableSe(r),a.enableVoice(r),o.setAllSoundOn(r),o.updateGameConfig(),this._applyPlayerGameConfig(),r&&i.createInstance("stage").playBgm()}},_applyPlayerGameConfig:function(){i.createInstance("playerGameConfigDISettings").updateDIDependencyLists(i.createInstance("playerGameConfig")),i.createInstance("battleUrlParser").updateParser()},_onPushAttackButtonCallback:function(e,t){if(t===n.Widget.TOUCH_ENDED){var a=i.generateGenericSoundPath(i.BattleGenericSeIdList.attackButton).mp3;this.soundPlayer.playSoundEffect(a),this.attack()}},attack:function(){this._runPreAttackAutoScenario().then(this._attack.bind(this),function(e){if(e){var n=i.createInstance("smartBeat");n.log("Attack: QuestType/"+t.director.getRunningScene().getQuestType()),n.log("isFlgUseSpecialAttack:"+this.battleUI.isFlgUseSpecialAttack()),n.log("Target:"+this.getTarget()),n.log("enemy:"+JSON.stringify(this.enemyList.map(function(e){return e._avatarData}))),n.log("summon:"+JSON.stringify(this.summonList.map(function(e){return e.model.attributes}))),n.log("characterList:"+JSON.stringify(this.characterList.map(function(e){return e._avatarData}))),n.log("autoState:"+this.autoScenarioHandler._stateHandler.getCurrentState().className),n.sendError(e)}})},_runPreAttackAutoScenario:function(){var e=i.createInstance("autoScenarioHandler");return e.resume(),e.runPreAttackScenario()},_attack:function(){var e=i.createInstance("notificationCenter");this.battleUI.setEnabled(!1),e.dispatchEvent(i.EVENT_NAME.BATTLE_UI_DARKEN_FILTER.DARKEN_FOOTER),this.scenarioPlayer.addScenarioEndEventCallbackOnce(function(){this.battleUI.setEnabled(!0),e.dispatchEvent(i.EVENT_NAME.BATTLE_UI_DARKEN_FILTER.RESTORE_FOOTER),this.burstVoiceScenario.play()},this);var n=t.director.getRunningScene().getQuestType(),a=this._getSceneInstanceId();return i.createInstance("logger").reportBattleActionRequest(this._getSceneInstanceId(),{action_type:"postAttack"}),this.backendAPI.postAttack(n,this.battleUI.isFlgUseSpecialAttack(),this.getTarget()).then(function(e){return this._verifySceneInstance(a)?this._handleData(e):Q.reject("KHBattleWorld._attack: attack scenario aborted due to a reload")}.bind(this)).then(function(){return this._verifySceneInstance(a)?void(i.createInstance("stage").isStageCleared()||i.createInstance("autoScenarioHandler").runPostAttackScenario()):Q.reject("KHBattleWorld._attack: attack scenario aborted due to a reload")}.bind(this))},_onPushBurstButtonCallback:function(e,t){t===n.Widget.TOUCH_ENDED&&(this.battleUI.toggleFlgUseSpecialAttack(),e.setBright(!this.battleUI.isFlgUseSpecialAttack()),a.each(this.characterList,function(e){a.isEmpty(e)||e.updateDefaultAnimation()}))},_onPushAbilityButtonCallback:function(e,t){if(t===n.Widget.TOUCH_ENDED){var i=e.getUserData().characterIndex,a=e.getUserData().iconIndex;this.characterAbilityList[i][a].showPopup().then(this._useAbility.bind(this,i,a))}},useAbility:function(e,t,n){return this._useAbility(e,t,n)},_useAbility:function(e,n,a){this.characterPanelList[e].updateAbilityDarkenFilter(n,!1),this.battleStatus.forceNextUpdate("_abilityNotSatisfied"),null==a&&(a=this.getTarget());var o=t.director.getRunningScene().getQuestType();i.createInstance("battleUrlParser").setAbilityIndex(n),this.battleUI.setEnabled(!1),this.scenarioPlayer.addScenarioEndEventCallbackOnce(function(){i.createInstance("notificationCenter").dispatchEvent(i.EVENT_NAME.BATTLE_UI_DARKEN_FILTER.RESTORE_FOOTER),this.battleUI.setEnabled(!0)},this);var r=this._getSceneInstanceId();return i.createInstance("logger").reportBattleActionRequest(this._getSceneInstanceId(),{action_type:"postAbility"}),this.backendAPI.postAbilityJson(o,e,n,a).then(function(e){if(this._verifySceneInstance(r))return this._handleData(e)}.bind(this))},_onPushHealButtonCallback:function(e,t){t===n.Widget.TOUCH_ENDED&&(this.curePopup=i.createInstance("curePopup"),this.curePopup.updateCharacterList(this.characterPanelList),this.curePopup.openPopup(this.useItem.bind(this)))},useItem:function(e,n){var a=t.director.getRunningScene().getQuestType(),o=i.createInstance("notificationCenter");this.battleUI.setEnabled(!1),this.battleUI.AttributeDiagram.setVisible(!1),o.dispatchEvent(i.EVENT_NAME.BATTLE_UI_DARKEN_FILTER.DARKEN_FOOTER),this.scenarioPlayer.addScenarioEndEventCallbackOnce(function(){this.battleUI.setEnabled(!0),this.battleUI.AttributeDiagram.setVisible(!0),o.dispatchEvent(i.EVENT_NAME.BATTLE_UI_DARKEN_FILTER.RESTORE_FOOTER)},this);var r=this._getSceneInstanceId();i.createInstance("logger").reportBattleActionRequest(this._getSceneInstanceId(),{action_type:"postItem_"+e}),this.backendAPI.postUseItem(a,e,n).then(function(e){this._verifySceneInstance(r)&&this._handleData(e)}.bind(this))},_handleData:function(e){return e&&e.body&&e.body.scenario&&i.createInstance("logger").reportBattleScenario(this._getSceneInstanceId(),a.cloneDeep(e.body.scenario)),e&&e.body&&e.body.status&&i.createInstance("logger").reportBattleStatus(this._getSceneInstanceId(),a.cloneDeep(e.body.status)),this._load(e).then(this._applyData.bind(this)).then(this._updateBattleStatus.bind(this))},_updateBattleStatus:function(e){if(this._verifySceneInstance(e.sceneInstanceId)&&!a(e.status).isUndefined())return this.battleStatus.update(e.status),e},_applyData:function(e){var t=e.sceneInstanceId;if(!this._verifySceneInstance(t))return Q.reject("KHBattleWorld._applyData: data handling interrupted due to a reload.");var n=Q.defer();return Q.all(a.map(e,function(e,n){var i=this._applyDataKeyList[n];if(a.isFunction(this[i]))return this[i](e,t)},this)).then(n.resolve.bind(null,e)),n.promise},_playScenario:function(e,t){return this._verifySceneInstance(t)?this.scenarioPlayer.play(e,this).fail(function(e){r.error(e)}):Q.reject("KHBattleWorld._playScenario: scenario aborted due to a reload.")},_applyTurn:function(e){this.turn.setTurnNumber(e)},_getSceneInstanceId:function(){return t.director.getRunningScene().__instanceId},_verifySceneInstance:function(e){return e===t.director.getRunningScene().__instanceId},__verifySceneInstance:function(e,n){return e===t.director.getRunningScene().__instanceId?Q.resolve(n):Q.reject("KHBattleWorld._verifySceneInstance: aborted process due to a scenario instance id mismatch.")},getAvatar:function(e,t){var n;if(e==i.ActionData.TARGET_NAMES.PLAYER)n=this.characterList[t];else{if(e!=i.ActionData.TARGET_NAMES.ENEMY)throw new Error("invalid targetName");n=this.enemyList[t]}return n},getAllAvatarArmature:function(){var e=this.characterList.concat(this.enemyList);return a.map(e,function(e){return null==e||a.isEmpty(e)?null:e.armature})},getAliveAvatarArmature:function(){return this.getAllAvatarArmature().filter(function(e){return null!==e})},getTarget:function(){var e=a.filter(this.enemyStatusBarList,function(e){return null!=e&&!a.isEmpty(e)&&e.isTarget()});return 0===e.length?-1:e[0].index},reloadBattle:function(e){i.createInstance("logger").reportBattleExit(this._getSceneInstanceId(),{type:"reload"}),i.createInstance("battleStatus").clearCache(),i.createInstance("treasureStatus").clearCache(),i.createInstance("scenarioPlayer").removeScenarioEndEventCallbacks(),t.director.getRunningScene().isRaid()&&i.createInstance("pubsubBattle").disconnect(),t.director.getRunningScene()._isNextStage=!0===e,i.createInstance("sceneManager").reloadScene()},endBattle:function(){i.createInstance("logger").reportBattleExit(this._getSceneInstanceId(),{type:"end"});var e=i.createInstance("soundPlayer"),t=i.createInstance("questInfo");return i.dictx.entry("questInfo").object(void 0),t.isJoinedRaid()?(e.clearCache(),void i.createInstance("router").navigateAndPreventHistoryBack("quest/q_003_1",{a_battle_id:t.getBattleId(),quest_type:t.getQuestType(),quest_id:t.getMasterQuestId(),quest_category:t.getQuestCategory(),quest_sub_category:t.getQuestSubCategory(),is_own_raid:t.isOwnRaid()})):void i.createInstance("questStateManager").gotoNextQuestState(t.getQuestId(),t.getQuestType(),t.isOwnRaid(),t.getMasterQuestId(),t.getQuestCategory(),t.getQuestSubCategory()).then(e.clearCache.bind(e)).fail(function(e){r.error({message:"quest ended unexpectedly",detail:e})})},dispose:function(){this._onDispose()},_onDispose:function(){this.characterList=null,this.enemyList=null,this.enemyStatusBarList=null,this.buttonCallbacks=null,this.scenarioPlayer=null,this.battleUI&&this.battleUI.dispose(),this.battleUI=null}})}((this||0).self||global),function(e){var t=e.kh,n=e.console,i=(e.ccui,t.BattleWorld.prototype);t.RaidBattleWorld=t.BattleWorld.extend({className:"KHRaidBattleWorld",_applyDataKeyList:_.assign(i._applyDataKeyList,{pubsubScenario:"_playPubsubScenario"}),init:function(){return this._raidMessageHandler=t.createInstance("RaidMessageHandler"),this.raidHelpRequestStatus=t.createInstance("RaidHelpRequestStatus"),t.BattleWorld.prototype.init.call(this)},_getInitialQuestData:function(){var e=t.createInstance("questInfo");return e.isJoinedRaid()?t.createInstance("apiBattle").getGainedItems(e.getQuestType()):t.createInstance("apiAQuests").getGainedItems(e.getQuestId(),e.getQuestType())},applyReceivedBattleData:function(e){var t=e.messages||[],n=e.scenario||[],i=e.status||{};this._handleRaidDataMessages(t),this._handleRaidDataScenario(n,i)},_handleRaidDataScenario:function(e,t){this._handleData({body:{pubsubScenario:e,status:t}})},_handleRaidDataMessages:function(e){this._raidMessageHandler.postMessages(e)},_playScenario:function(e){var t=this.scenarioPlayer.enqueueOwnScenario(e);return this.scenarioPlayer.openFloodGate(),this.__playScenario(t)},_playPubsubScenario:function(e){var t=this.scenarioPlayer.enqueueOtherPlayerScenario(e);return this.__playScenario(t)},__playScenario:function(e){return this.scenarioPlayer.play(),e.fail(function(e){e&&e.stack?n.error(e.stack):n.warn(e)})},_updateBattleUIStatus:function(){return this._hasEnemies()?this.raidInfo.checkTimeup()?this.battleUI.CenterPanel.hideAttackButton():this._hasCharacters()||0===t.createInstance("cureItemInfo").getElixirUsableAmount()?this._hasCharacters()?Q.resolve():(this.battleUI.setEnabled(!1),this.battleUI.CenterPanel.skipCurrentAnimation(),this.battleUI.MenuButton.setEnabled(!0),this.battleUI.CenterPanel.hideAttackButton()):this.battleUI.CenterPanel.showReviveButton():(t.createInstance("stage").setStageCleared(!0),this.battleUI.raidHelpRequestButton.setEnabled(!1),this.battleUI.CenterPanel.showNextButton())},_showOnStartPopups:function(){var e=t.createInstance("questInfo");if(this._checkEnemiesDownConditions())return t.createInstance("notificationCenter").dispatchEvent(t.EVENT_NAME.BATTLE_UI_DARKEN_FILTER.DARKEN_FOOTER),this._showTreasureData(),this.battleUI.NextButton.setEndBattleCallback(),t.createInstance("raidDownPopupFactory").create({}).open().thenResolve(!1);if(this.raidInfo.checkTimeup())return t.createInstance("notificationCenter").dispatchEvent(t.EVENT_NAME.BATTLE_UI_DARKEN_FILTER.DARKEN_FOOTER),t.createInstance("RunoutPopupFactory").create().open({aQuestId:e.getQuestId(),questType:e.getQuestType()}).thenResolve(!1);if(this._checkRaidRequestPopupConditions()){if(e.isUnionMajorRaidBossQuestType())return Q.resolve(!0);var n=e.getQuestType(),i=this.raidHelpRequestStatus;return t.createInstance("rescueConfirmPopupFactory").updateRescueRequestData(i).then(function(e){if(e.needToShowPopup()){var t={questType:n,raidHelpRequestStatus:i};return e.create({}).open(t)}}).thenResolve(!0)}return Q.resolve(!0)},_checkRaidRequestPopupConditions:function(){if(this.raidInfo.checkTimeup()||t.BattleWorld.prototype.checkContinuePopupConditions.call(this))return!1;var e=t.createInstance("raidInfo").getParticipants();return e.current!==e.max},_checkEnemiesDownConditions:function(){return 0===_.filter(this.enemyList,function(e){return!(null==e||_.isEmpty(e))}).length},_attack:function(){this.scenarioPlayer.playCurrentlyQueuedScenariosWithPriority(),this.scenarioPlayer.closeFloodGate(),i._attack.apply(this,arguments)},_summonAttack:function(){this.scenarioPlayer.playCurrentlyQueuedScenariosWithPriority(),this.scenarioPlayer.closeFloodGate(),i._summonAttack.apply(this,arguments)},_useAbility:function(){this.scenarioPlayer.playCurrentlyQueuedScenariosWithPriority(),this.scenarioPlayer.closeFloodGate(),i._useAbility.apply(this,arguments)},useItem:function(e,t){this.scenarioPlayer.playCurrentlyQueuedScenariosWithPriority(),this.scenarioPlayer.closeFloodGate(),i.useItem.apply(this,arguments)},reloadBattle:function(){this.raidHelpRequestStatus.cleanUp(),i.reloadBattle.apply(this,arguments)},endBattle:function(){this.raidHelpRequestStatus.cleanUp(),i.endBattle.apply(this,arguments)},dispose:function(){this.raidHelpRequestStatus.cleanUp()}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.QuestInfo=n.Class.extend({init:function(e,t,n,i,a,o,r){return null!=e&&(this._battleId=e),null!=t&&(this._questType=t),null!=n&&(this._questId=n),null!=i&&(this._masterQuestId=i),this._isOwnRaid=a,this._isJoinedRaid=this.isRaidQuestType()&&!a,this._questCategory=o,this._questSubCategory=r,this},getBattleId:function(){return null==this._battleId?-1:this._battleId},getQuestType:function(){return null==this._questType?"":this._questType},isRaidQuestType:function(){return-1!==this.getQuestType().search("raid")},getQuestId:function(){return null==this._questId?-1:this._questId},getMasterQuestId:function(){return null==this._masterQuestId?-1:this._masterQuestId},getQuestCategory:function(){return this._questCategory},getQuestSubCategory:function(){return this._questSubCategory},isJoinedRaid:function(){return this._isJoinedRaid},isUnionMajorRaidBossQuestType:function(){return"event_union_demon_raid"===this.getQuestType()||"event_union_seraph_raid"===this.getQuestType()},isGuildOrderQuestType:function(){return"mission"===this.getQuestType()},isTowerEventQuest:function(){return"tower_event"===this.getQuestType()},isOwnRaid:function(){return this._isOwnRaid}})}((this||0).self||global),function(e){var t=e.kh;t.RaidInfo=cc.Class.extend({init:function(e){return this._raidInfo=e,this._setParticipantNumber(e.participants),this._setRemainingTime(e.time_left),this},_setParticipantNumber:function(e){t.createInstance("battleUI").BattleUIHeader.updateParticipantNumber(e.current,e.max)},_setRemainingTime:function(e){t.createInstance("battleUI").BattleUIHeader.updateRemainingTime(e.seconds,e.timestamp)},checkTimeup:function(){return this._raidInfo.time_left.seconds<=0},getEventId:function(){return this._raidInfo.event_id},getParticipants:function(){return this._raidInfo.participants}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;t.RaidHelpRequestStatus=n.Class.extend({className:"RaidHelpRequestStatus",HELP_REQUEST_TYPES:{ALL:"to_all",FRIENDS:"to_friends",UNION_MEMBERS:"to_union_members"},ctor:function(){this._questType=t.createInstance("questInfo").getQuestType(),this._api=t.createInstance("apiBattle"),this._onTickCallbacks={},this._onTickCallbacks[this.HELP_REQUEST_TYPES.ALL]=[],this._onTickCallbacks[this.HELP_REQUEST_TYPES.FRIENDS]=[],this._onRequestAvailabilityChangeCallbacks=[]},fetch:function(){return this._api.getHelpRequestPossibility(this._questType).then(this._updateHelpRequestStatus.bind(this)).thenResolve(this)},requestHelp:function(e,t,n){return this._api.postHelpRequest(e,t,n,this._questType).then(this._updateHelpRequestStatus.bind(this))},onRequestAllCountdownTick:function(e){this._onTickCallbacks[this.HELP_REQUEST_TYPES.ALL].push(e),null!=this._helpRequestStatus&&e(this._calculateRemainingCooldown(this._helpRequestStatus,this.HELP_REQUEST_TYPES.ALL))},onRequestFriendsCountdownTick:function(e){this._onTickCallbacks.to_friends.push(e),null!=this._helpRequestStatus&&e(this._calculateRemainingCooldown(this._helpRequestStatus,this.HELP_REQUEST_TYPES.FRIENDS))},onRequestAvailabilityChange:function(e){this._onRequestAvailabilityChangeCallbacks.push(e)},clearOnTickCallbacks:function(){i.each(this._onTickCallbacks,function(e,t){this._onTickCallbacks[t]=[]},this)},clearOnRequestAvailabilityChangeCallbacks:function(){this._onRequestAvailabilityChangeCallbacks=[]},isRaidFull:function(){return this._helpRequestStatus.raid_full},hasNotJoinedUnion:function(){return"no_union"===this._helpRequestStatus[this.HELP_REQUEST_TYPES.UNION_MEMBERS].status},hasNoFriends:function(){return"no_friends"===this._helpRequestStatus[this.HELP_REQUEST_TYPES.FRIENDS].status},hasAlreadySendToAll:function(){return this._hasAlreadySend(this.HELP_REQUEST_TYPES.ALL)},hasAlreadySendToFriends:function(){return this._hasAlreadySend(this.HELP_REQUEST_TYPES.FRIENDS)},hasAlreadySendToUnionMembers:function(){return this._hasAlreadySend(this.HELP_REQUEST_TYPES.UNION_MEMBERS)},cleanUp:function(){this.clearOnTickCallbacks(),this.clearOnRequestAvailabilityChangeCallbacks(),null!=this._countdownTimer&&clearInterval(this._countdownTimer)},_hasAlreadySend:function(e){return"request_already_send"===this._helpRequestStatus[e].status},_updateHelpRequestStatus:function(e){this._updateHelpRequestAvailability(e.body),this._startCountdown(e.body),this._helpRequestStatus=e.body},_updateHelpRequestAvailability:function(e){var t=this._isHelpRequestAvailable(e),n=this._helpRequestAvailable!==t;this._helpRequestAvailable=t,n&&this._fireEvent(this._onRequestAvailabilityChangeCallbacks,[t])},_isHelpRequestAvailable:function(e){return!e.raid_full&&(!!i.some(this.HELP_REQUEST_TYPES,this._isRequestTypeUsable.bind(this,e))||i.some(this.HELP_REQUEST_TYPES,this._hasCooledDown.bind(this,e)))},_isRequestTypeUsable:function(e,t){return"usable"===e[t].status},_startCountdown:function(e){null!=this._countdownTimer&&clearInterval(this._countdownTimer),this._countdown(e),this._countdownTimer=setInterval(this._countdown.bind(this,e),1e3)},_countdown:function(e){i(this.HELP_REQUEST_TYPES).filter(this._hasCooldown.bind(this,e)).each(this._fireTickEvent.bind(this,e)),!this._helpRequestAvailable&&i.some(this.HELP_REQUEST_TYPES,this._hasCooledDown.bind(this,e))&&(this._helpRequestAvailable=!0,this._fireEvent(this._onRequestAvailabilityChangeCallbacks,[!0])),i.some(this.HELP_REQUEST_TYPES,this._hasCooldownInProgress.bind(this,e))||null==this._countdownTimer||(clearInterval(this._countdownTimer),this._countdownTimer=null)},_hasCooldown:function(e,t){return"request_already_send"===e[t].status&&i.has(e[t],"time_limit")},_hasCooledDown:function(e,t){return!!this._hasCooldown(e,t)&&0===this._calculateRemainingCooldown(e,t)},_hasCooldownInProgress:function(e,t){return this._hasCooldown(e,t)&&!this._hasCooledDown(e,t)},_calculateRemainingCooldown:function(e,t){return i.has(e[t],"time_limit")?Math.max(e[t].time_limit-Date.now()/1e3,0):0},_fireTickEvent:function(e,t){var n=this._calculateRemainingCooldown(e,t);this._fireEvent(this._onTickCallbacks[t],[n])},_fireEvent:function(e,t){i.invoke(e,"apply",null,t)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.CureItemInfo=n.Class.extend({ctor:function(){this._itemInfoHandlers={elixir:t.createInstance("ElixirInfo")}},update:function(e){var t=this._itemInfoHandlers[e.physical_name];t&&t.update(e)},getElixirUsableAmount:function(){return this._itemInfoHandlers.elixir.getElixirUsableAmount()}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.ElixirInfo=n.Class.extend({ctor:function(){this._elixirUsableAmount=-1},update:function(e){this.setElixirUsableAmount(e.usable_amount)},reset:function(){this._elixirUsableAmount=-1},setElixirUsableAmount:function(e){null!=e&&(this._elixirUsableAmount=e)},getElixirUsableAmount:function(){return this._elixirUsableAmount}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.NODE_POSITION={BATTLE_BOTTOM_LEFT:n.p(0,0),SUMMON:n.p(0,0),SUMMON_DAMAGE:n.p(0,0),NAMEPLATE_ANIMATION_POS:n.p(370,150),CUTIN:n.p(0,0),BATTLE_FIELD_CENTER:n.p(370,320),RAID_MESSAGE_WINDOW:n.p(30,0),RECEIVE_RAID_POINTS_SPRITE:n.p(0,520)},t.CHARACTER_POSITION_LIST=[[n.p(.5,.5)],[n.p(.5,.5),n.p(.525,.29)],[n.p(.5,.5),n.p(.525,.29),n.p(.55,.05*1.5)],[n.p(.5,.5),n.p(.525,.29),n.p(.55,.05*1.5),n.p(.665,.45)],[n.p(.5,.5),n.p(.525,.29),n.p(.55,.05*1.5),n.p(.665,.45),n.p(.05*13.8,.225)]],t.CHARACTER_Z_ORDER_MAP={CHARACTER_0:0,CHARACTER_1:2,CHARACTER_2:4,CHARACTER_3:1,CHARACTER_4:3},t.CHARACTER_POSITION_COVER=n.p(.45,.05*7),t.ENEMY_POSITION_LIST=[[n.p(.2,.25)],[n.p(.2,.4),n.p(.05*3,.1)],[n.p(.2,.45),n.p(.1,.05*4.7),n.p(.25,.05)]],t.ENEMY_POSITION_COVER=n.p(.05*7,.05*7),t.ENEMY_STATUS_BAR_POSITIONS=[[n.p(150,565)],[n.p(100,550),n.p(400,550)],[n.p(225,565),n.p(50,515),n.p(400,515)]],t.SUMMON_MOVIE_SCALE=1.1,t.NUMBER_RANDOM_POS_RECT={SIZE:n.size(100,100),ANCHOR:n.p(.5,.5)},t.STATUS_EFFECT_ICON_RANDOM_POS_RECT={SIZE:n.size(100,100),ANCHOR:n.p(.5,.5)},t.STAMP_RANDOM_POS_RECT=n.rect(200,0,300,450)}((this||0).self||global),function(e){e.kh.BattleGenericSeIdList={attackButton:0,target:1,burstMax:2,raging:3,stun:4,bossDown:5,playerDown:6}}((this||0).self||global),function(e){var t=e.cc,n=e.kh,i=e._;n.BattleUrlParser=t.Class.extend({name:"KHBattleUrlParser",ctor:function(){this.resources={},this._newResources={},this.updateParser()},updateParser:function(){this._parser=n.createInstance("BattleUrlParserByConfig")},parse:function(e){this._newResources=this._parser.parse(e)},getUrlList:function(){var e=this._flatten(this._newResources);return this.resources=i.merge(this.resources,this._newResources),this._newResources={},e},setAbilityIndex:function(e){this._parser.setAbilityIndex(e)},_flatten:function(e){return i(e).map(function(e,t){return i.isObject(e)?this._flatten(e):e},this).flatten().uniq().compact().value()}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;t.BattleUrlParserBase=n.Class.extend({name:"KHBattleUrlParserBase",parse:function(e){return this._newResources={},i.each(e,function(e,t){var n="__parse"+i.capitalize(i.camelize(t));null!=this[n]&&this[n](e)},this),this._newResources},setAbilityIndex:function(e){this._abilityIndex=e},__parseStage:function(e){var n={};i.assign(n,t.generateBattleBackgroundPaths(e.background_id)),null!=e.vs_animation_id&&(n.bossAnimation=i.assign(t.generateBossAnimationPath(),t.generateBossImagePath(e.vs_animation_id))),this._newResources.stage=n},__parseCharacter:function(e){this._newResources.job={},this._newResources.avatar={},i.each(e,function(e){if(null!=e&&!i.isEmpty(e)){var n=this._isJob(e),a=n?"job":"avatar";this._newResources[a][e.id]=this._newResources[a][e.id]||t.generateAvatarAnimationPaths(e.id,n)}},this)},__parseEnemy:function(e){this._newResources.enemy={},i.each(e,function(e){null==e||i.isEmpty(e)||(this._newResources.enemy[e.id]=this._newResources.enemy[e.id]||t.generateEnemyAnimationPaths(e.id))},this)},__parsePubsubScenario:function(e){this.__parseScenario(e)},__parseScenario:function(e){this._newResources.scenario={},i.each(e,function(e){var t="__parseScenario"+i.capitalize(i.camelize(e.cmd));null!=this[t]&&this[t](e)},this)},__parseScenarioAttack:function(t){var n=this._isJob(t)?"job":t.from;this._newResources.scenario.attack=this._newResources.scenario.attack||{},this._newResources.scenario.attack[n]=this._newResources.scenario.attack[n]||{};var a=this._getAvatarId(t);return null==a?void e.console.error("KHBattleUrlParserBase.__parseScenarioAttack: avatar id not found"):void(this._newResources.scenario.attack[n][a]=this._parseAvatar(i.assign({id:a},t)))},__parseScenarioCutin:function(e){this._newResources.scenario.cutin=this._newResources.scenario.cutin||{},this["__parseScenarioCutin"+i.capitalize(e.type)](e)},__parseScenarioCutinPlayerBurst:function(n){var a=this._getAvatarId(i.assign({from:"player"},n));if(null!=a){var o=this._isJob({pos:n.pos})?"job":"avatar";this._newResources.scenario.cutin[n.type]=this._newResources.scenario.cutin[n.type]||t.generateCutinBurstBasePath(),this._newResources.scenario.cutin[n.type][o]=this._newResources.scenario.cutin[n.type][o]||{},this._newResources.scenario.cutin[n.type][o][a]=t.generateCutinBurstPaths(a,this._isJob(n))}else e.console.error("KHBattleUrlParserBase.__parseScenarioCutinPlayerBurst: avatar id not found")},__parseScenarioCutinBurstStreak:function(n){this._newResources.scenario.cutin[n.type]=this._newResources.scenario.cutin[n.type]||{},i.each(n.poslist,function(i){var a=this._getAvatarId({from:"player",pos:i});if(null!=a){var o=this._isJob({pos:i});this._newResources.scenario.cutin[n.type].job=this._newResources.scenario.cutin[n.type].job||{},this._newResources.scenario.cutin[n.type].avatar=this._newResources.scenario.cutin[n.type].avatar||{},this._newResources.scenario.cutin[n.type][o?"job":"avatar"][a]=t.generateCutinBurstStreakPaths(a,this._isJob({pos:i}))}else e.console.error("KHBattleUrlParserBase.__parseScenarioCutinBurstStreak: avatar id not found")},this),this._newResources.scenario.cutin[n.type]["base_"+n.poslist.length]=t.generateCutinBurstStreakBasePath(n.poslist.length)},__parseScenarioCutinPlayerBeatdown:function(n){var a=this._getAvatarId(i.assign({from:"player"},n));if(null!=a){var o=this._isJob({pos:n.pos})?"job":"avatar";this._newResources.scenario.cutin[n.type]=this._newResources.scenario.cutin[n.type]||t.generateCutinDieBasePath(),this._newResources.scenario.cutin[n.type][o]=this._newResources.scenario.cutin[n.type][o]||{},this._newResources.scenario.cutin[n.type][o][a]=t.generateCutinDiePaths(a,this._isJob(n))}else e.console.error("KHBattleUrlParserBase.__parseScenarioCutinPlayerBeatdown: avatar id not found")},__parseScenarioDamage:function(e){this["__parseScenarioDamage"+i.capitalize(e.animation_resource_type)||"Ability"](e)},__parseScenarioDamageAbility:function(e){e.animation_id&&(this._newResources.scenario.ability=this._newResources.scenario.ability||{},this._newResources.scenario.ability[e.animation_id]=t.generateAbilityPaths(e.animation_id))},__parseScenarioDamageBurst:function(e){if(e.animation_id){if("enemy"===e.from)return void this.__parseScenarioDamageEnemyBurst(e);this._newResources.scenario.burst=this._newResources.scenario.burst||{},this._newResources.scenario.burst[e.animation_id]=t.generateBurstPaths(e.animation_id)}},__parseScenarioDamageEnemyBurst:function(e){this._newResources.scenario.enemyBurst=this._newResources.scenario.enemyBurst||{},this._newResources.scenario.enemyBurst[e.animation_id]=t.generateEnemyBurstPaths(e.animation_id)},__parseScenarioHeal:function(e){this["__parseScenarioHeal"+i.capitalize(e.animation_resource_type)||"Item"](e)},__parseScenarioHealItem:function(e){e.animation_id&&(this._newResources.scenario.item=this._newResources.scenario.item||{},this._newResources.scenario.item[e.animation_id]=t.generateItemPaths(e.animation_id),i.assign(this._newResources.scenario.item[e.animation_id],t.generateItemSoundPaths()))},__parseScenarioHealAbility:function(e){e.animation_id&&(this._newResources.scenario.ability=this._newResources.scenario.ability||{},this._newResources.scenario.ability[e.animation_id]=t.generateAbilityPaths(e.animation_id))},__parseScenarioHealBurst:function(e){if(e.animation_id){if("enemy"===e.from)return void this.__parseScenarioHealEnemyBurst(e);this._newResources.scenario.burst=this._newResources.scenario.burst||{},this._newResources.scenario.burst[e.animation_id]=t.generateBurstPaths(e.animation_id)}},__parseScenarioHealEnemyBurst:function(e){this._newResources.scenario.enemyBurst=this._newResources.scenario.enemyBurst||{},this._newResources.scenario.enemyBurst[e.animation_id]=t.generateEnemyBurstPaths(e.animation_id)},__parseScenarioRevive:function(e){e.animation_id&&(this._newResources.scenario.ability=this._newResources.scenario.ability||{},this._newResources.scenario.ability[e.animation_id]=t.generateAbilityPaths(e.animation_id),i.each(e.avatar_joined,function(t){this.__parseScenarioJoinBattle(i.assign(t,{from:e.from||"player"}))},this))},__parseScenarioPlayVisualEffect:function(e){this["__parseScenarioPlayVisualEffect"+i.capitalize(e.animation_resource_type)||"Ability"](e)},__parseScenarioPlayVisualEffectAbility:function(e){e.animation_id&&(this._newResources.scenario.ability=this._newResources.scenario.ability||{},this._newResources.scenario.ability[e.animation_id]=t.generateAbilityPaths(e.animation_id))},__parseScenarioApplyStatus:function(e){e.animation_id&&(this._newResources.scenario.ability=this._newResources.scenario.ability||{},this._newResources.scenario.ability[e.animation_id]=t.generateAbilityPaths(e.animation_id))},__parseScenarioRemoveStatus:function(e){e.animation_id&&(this._newResources.scenario.ability=this._newResources.scenario.ability||{},this._newResources.scenario.ability[e.animation_id]=t.generateAbilityPaths(e.animation_id))},__parseScenarioBurstResult:function(e){},__parseScenarioBurstStreak:function(e){this._newResources.scenario.burstStreak=this._newResources.scenario.burstStreak||{},this._newResources.scenario.burstStreak[e.id]=t.generateBurstStreakPaths(e.id)},__parseScenarioSummonMovie:function(e){this._newResources.scenario.summonMovie=this._newResources.scenario.summonMovie||{},this._newResources.scenario.summonMovie[e.id]={},this._newResources.scenario.summonMovie[e.id].movie=t.generateSummonMoviePaths(e.id),this._newResources.scenario.summonMovie[e.id].chara=t.generateSummonCharaPaths(e.id)},__parseScenarioSummonDamage:function(e){this._newResources.scenario.summonDamage=this._newResources.scenario.summonDamage||{},this._newResources.scenario.summonDamage[e.id]=t.generateSummonEffectPaths(e.id)},__parseScenarioJoinBattle:function(e){if("player"===e.from){var n=this._isJob(e.avatar),i=n?"job":"avatar";this._newResources[i]=this._newResources[i]||{},this._newResources[i][e.avatar.id]=this._newResources[i][e.avatar.id]||t.generateAvatarAnimationPaths(e.avatar.id,n)}else"enemy"===e.from&&(this._newResources.enemy=this._newResources.enemy||{},this._newResources.enemy[e.avatar.id]=this._newResources.enemy[e.avatar.id]||t.generateEnemyAnimationPaths(e.avatar.id))},_isJob:function(e){if(e.is_job)return!0;if(null==e.is_job&&null!=e.pos&&"enemy"!==e.from){var n=t.createInstance("battleWorld").characterList[e.pos];return null!=n&&n.isJob}return!1},_getAvatarId:function(e){var n=t.createInstance("battleWorld");return"enemy"===e.from?null==n.enemyList[e.pos]?null:n.enemyList[e.pos].id:"player"===e.from?null==n.characterList[e.pos]?null:n.characterList[e.pos].id:void 0},_parseAvatar:function(e){return"enemy"===e.from?t.generateEnemyAnimationPaths(e.id):t.generateAvatarAnimationPaths(e.id,this._isJob(e))}})}((this||0).self||global),function(e){var t=e.kh,n=e._,i={__parseCharacter:function(e){t.BattleUrlParserBase.prototype.__parseCharacter.call(this,e),n.each(e,function(e){if(null!=e&&!n.isEmpty(e)){var i=this._isJob(e),a=i?"job":"avatar",o=t.IDList.VOICES.PANEL_OPEN;n.assign(this._newResources[a][e.id],{se:t.generateAvatarSoundPaths(e.id,i,o.LOWER,o.UPPER)})}},this)},__parseScenarioAttack:function(i){t.BattleUrlParserBase.prototype.__parseScenarioAttack.call(this,i);var a=this._isJob(i)?"job":i.from,o=this._getAvatarId(i);if(null!=o){var r=t.IDList.VOICES.ATTACK;this._newResources.scenario.attack[a][o].hitSe=t.generateOnHitSoundPaths(this._getAvatarHitSe(i)||0),this._newResources.scenario.attack[a][o].se=this._parseAvatarSound(n.assign({id:o},i),r.LOWER,r.UPPER),this._filterPinchSe(i)}else e.console.error("KHBattleUrlParserBase.__parseScenarioAttack: avatar id not found")},__parseScenarioHealItem:function(e){t.BattleUrlParserBase.prototype.__parseScenarioHealItem.call(this,e),n.assign(this._newResources.scenario.item[e.animation_id],t.generateItemSoundPaths())},__parseScenarioBurst:function(e){if("enemy"!==e.from){this._newResources.scenario.burst=this._newResources.scenario.burst||{player:{job:{},avatar:{}},enemy:{avatar:{}}};var n=e.from,i=this._getAvatarId(e),a=this._isJob(e),o=a?"job":"avatar",r=t.IDList.VOICES.BURST;this._newResources.scenario.burst[n][o][i]={se:t.generateAvatarSoundPaths(i,a,r.LOWER,r.UPPER)},this._filterPinchSe(e)}},__parseScenarioAbility:function(e){this._newResources.scenario.ability=this._newResources.scenario.ability||{player:{job:{},avatar:{}},enemy:{avatar:{}}};var n=e.from,i=this._getAvatarId(e),a=this._isJob(e),o=a?"job":"avatar",r=t.IDList.VOICES.ABILITY.LOWER+(this._abilityIndex||0);this._newResources.scenario.ability[n][o][i]={se:t.generateAvatarSoundPaths(i,a,r,r+1)}},__parseScenarioDamage:function(e){t.BattleUrlParserBase.prototype.__parseScenarioDamage.call(this,e),this._filterPinchSe(e)},__parseScenarioHeal:function(e){t.BattleUrlParserBase.prototype.__parseScenarioHeal.call(this,e),this._filterPinchSe(e)},__parseScenarioHealAbility:function(e){t.BattleUrlParserBase.prototype.__parseScenarioHealAbility.call(this,e),this._filterPinchSe(e)},__parseScenarioJoinBattle:function(e){if(t.BattleUrlParserBase.prototype.__parseScenarioJoinBattle.call(this,e),"player"===e.from){var n=this._isJob(e.avatar),i=n?"job":"avatar",a=t.IDList.VOICES.JOIN;this._newResources.scenario.joinBattle=this._newResources.scenario.joinBattle||{job:{},avatar:{}},this._newResources.scenario.joinBattle[i][e.avatar.id]=this._newResources.scenario.joinBattle[e.avatar.id]||{},this._newResources.scenario.joinBattle[i][e.avatar.id].se=t.generateAvatarSoundPaths(e.avatar.id,n,a.LOWER,a.UPPER)}},__parseScenarioDie:function(e){if("player"===e.from){var n=t.IDList.VOICES.DIE,i=t.createInstance("battleWorld").characterList[e.pos],a=i.isJob?"job":"avatar";this._newResources.scenario.die=this._newResources.scenario.die||{job:{},avatar:{}},this._newResources.scenario.die[a][i.id]=this._newResources.scenario.die[a][i.id]||{},this._newResources.scenario.die[a][i.id].se=t.generateAvatarSoundPaths(i.id,i.isJob,n.LOWER,n.UPPER)}},__parseScenarioWin:function(){var e=t.IDList.VOICES.WIN,i=n(t.createInstance("battleWorld").characterList).filter(function(e){return null!=e&&!n.isEmpty(e)}).shuffle().value()[0];null==i||n.isEmpty(i)||(this._newResources.scenario.win=this._newResources.scenario.win||{},this._newResources.scenario.win.se=t.generateAvatarSoundPaths(i.id,i.isJob,e.LOWER,e.UPPER))},_getAvatarHitSe:function(n){var i=t.createInstance("battleWorld");return"enemy"===n.from?null==i.enemyList[n.pos]?void e.console.error("KHBattleUrlParserBase._getAvatarHitSe: enemy not found"):i.enemyList[n.pos].hitSe:"player"===n.from?null==i.characterList[n.pos]?void e.console.error("KHBattleUrlParserBase._getAvatarHitSe: character not found"):i.characterList[n.pos].hitSe:void 0},_parseAvatarSound:function(e,n,i){return"enemy"===e.from?null:t.generateAvatarSoundPaths(e.id,this._isJob(e),n,i)},_filterPinchSe:function(e){var i=e.damage||e.heal;if(null!=i){var a=t.createInstance("battleWorld").characterList;n(i).each(function(e){n(e).each(function(e){if("player"===e.to){var i=a[e.pos];if(!(null==i||n.isEmpty(i)||i.currentAnimation===t.AVATAR_ANIMATION_NAMES.PINCH||i.getPinchTreshhold()<e.hp)){var o=i.isJob?"job":"avatar";this._newResources[o]=this._newResources[o]||{},this._newResources[o][i.id]=this._newResources[o][i.id]||{},this._newResources[o][i.id].sePinch=this._newResources[o][i.id].sePinch||t.generateAvatarSoundPaths(i.id,i.isJob,22,23)}}},this)},this)}}};t.BattleUrlParserSe=t.BattleUrlParserBase.extend(i);var a={__parseStage:function(e){t.BattleUrlParserBase.prototype.__parseStage.call(this,e),n.assign(this._newResources.stage,t.generateBattleBgmPaths(e.bgm_id))}};t.BattleUrlParserBgm=t.BattleUrlParserBase.extend(a),t.BattleUrlParserSound=t.BattleUrlParserBase.extend(n({}).assign(i).assign(a).value())}((this||0).self||global),function(e){e.kh.mockResourcePaths={cutinCharaDie:"res/cutin_beatdown/battle_direct_knocked_out_ava_0000.png",cutinJobDie:"res/cutin_beatdown/battle_direct_knocked_out_job_0000.png",jobCard:"res/TEMPORARY/battlecard_job_0001_0.png",characterCard:"res/TEMPORARY/battlecard_chara_0001_0.png",bossImage:"res/TEMPORARY/encount-sp_vsboss_0000.png"}}((this||0).self||global),function(e){var t=e.kh||{};t.animationResourcePaths=_.assign(t.animationResourcePaths||{},{enemyAnimation:"enemy/ene_####/ene_####.ExportJson",summonMovie:"summon/sum_####/sum_####_movie.json",summonChara:"summon/sum_####/sum_####_chara.json",summonEffect:"summon/sum_####/sum_####_effect.json",burst:"burst/burst_####/burst_####.json",burstStreak:"streak/streak_##/streak_##.json",enemyBurst:"enemy_burst/ene_burst_####/ene_burst_####.json",ability:"ability/abi_####/abi_####.json",battleBgm:"sound/bgm/bgm_battle_####.mp3",enemySound:"enemy/ene_####/se_ene_######.mp3",genericSound:"sound/generic/se_battle_####.mp3"}),t.imageResourcePaths=_.assign(t.imageResourcePaths||{},{cutinCharaBurst:"battleburst_chara_####_#.jpg",cutinJobBurst:"battleburst_job_####_#.jpg",cutinJobDie:"battleout_chara_####_#.png",cutinCharaDie:"battleout_job_####_#.png",cutinCharaBurstStreak:"battlestreak_chara_####_#.jpg",cutinJobBurstStreak:"battlestreak_job_####_#.jpg",battleBackground:"battleimg_stage-bg_####.jpg",enemyIcon:"iconene_enemy-looks_####.png",jobCard:"battlecard_job_####_#.png",characterCard:"battlecard_chara_####_#.png",summonCard:"corecard_summon_####_#.jpg",jobPartyCard:"partycard_job_####_#.jpg",characterPartyCard:"partycard_chara_####_#.jpg",abilityIcon:"coreimg_abilityicon_####.png",statusIcon:"coreimg_statusicon_####.png",logIcon:"iconcircle_job_####_#.png",stampIcon:"coreimg_stamp_####.png",corecardJob:"corecard_job_####_#.jpg",corecardChara:"corecard_chara_####_#.jpg",bossImage:"encount-sp_vsboss_####.png"}),t.soundResourcePaths=_.assign(t.soundResourcePaths||{},{}),t.localResourcePaths=_.assign(t.localResourcePaths||{},{cutinBurst:"res/battle_ani/cutin_burst/battle_direct_burst.json",cutinDie:"res/cutin_beatdown/battle_direct_knocked_out.json",cutinBurstStreak:"res/battle_ani/cutin_streak/battle_direct_streak_#.json",bossAnimation:"res/battle_ani/boss_encount/boss_encount.json"})}((this||0).self||global),function(e){var t=e.kh||{};t.localResourcePaths=_.assign(t.localResourcePaths||{},{cutinBurst:"res/battle_ani/cutin_burst/battle_direct_burst.json",cutinDie:"../../components/battle/res/cutin_beatdown/battle_direct_knocked_out.json",cutinBurstStreak:"res/battle_ani/cutin_streak/battle_direct_streak_#.json",bossAnimation:"res/battle_ani/boss_encount/boss_encount.json"})}((this||0).self||global),function(e){var t=e.kh||{},n=t.generateResourcePath;t.generateEnemyAnimationPaths=function(e,t){return n("enemyAnimation",e,t)},t.generateEnemySoundPaths=function(e,t,i){return _.map(_.range(i-t),function(i){return n("enemySound",e,t+i).mp3})},t.generateOnHitSoundPaths=function(e,t){return n("onhitSound",e,t)},t.generateSummonCharaPaths=function(e,t){return n("summonChara",e,t)},t.generateSummonMoviePaths=function(e,t){return n("summonMovie",e,t)},t.generateSummonEffectPaths=function(e,t){return n("summonEffect",e,t)},t.generateBurstPaths=function(e,t){return n("burst",e,t)},t.generateBurstStreakPaths=function(e,t){return n("burstStreak",e,t)},t.generateEnemyBurstPaths=function(e,t){return n("enemyBurst",e,t)},t.generateAbilityPaths=function(e,t){return n("ability",e,t)},t.generateCutinBurstBasePath=function(){return n("cutinBurst")},t.generateCutinDieBasePath=function(){return n("cutinDie")},t.generateCutinBurstStreakBasePath=function(e){return n("cutinBurstStreak",0,e)},t.generateCutinBurstPaths=function(e,t,i){return n(t?"cutinJobBurst":"cutinCharaBurst",e,i)},t.generateCutinBurstStreakPaths=function(e,t,i){return n(t?"cutinJobBurstStreak":"cutinCharaBurstStreak",e,i)},t.generateCutinDiePaths=function(e,t,i){return n(t?"cutinJobDie":"cutinCharaDie",e,i)},t.generateBattleBgmPaths=function(e){return n("battleBgm",e)},t.generateBattleBackgroundPaths=function(e){return n("battleBackground",e)},t.generateItemPaths=function(e){return n("item",e)},t.generateItemSoundPaths=function(e){return n("itemSound",e)},t.generateEnemyIconPath=function(e){return n("enemyIcon",e)},t.generateAvatarCardPath=function(e,t,i){return n(t?"jobCard":"characterCard",e,i)},t.generateAvatarPartyCardPath=function(e,t,i){return n(t?"jobPartyCard":"characterPartyCard",e,i)},t.generateSummonCardPath=function(e,t){return n("summonCard",e,t)},t.generateAbilityIconPath=function(e){return n("abilityIcon",e)},t.generateStatusIconPath=function(e){return n("statusIcon",e)},t.generateLogIconPath=function(e,t){return n("logIcon",e,t)},t.generateStampIconPath=function(e){return n("stampIcon",e)},t.generateAvatarCorecard=function(e,t,i){return n(t?"corecardJob":"corecardChara",e,i)},t.generateBossAnimationPath=function(){return n("bossAnimation")},t.generateBossImagePath=function(e){return n("bossImage",e)},t.generateGenericSoundPath=function(e){return n("genericSound",e)}}((this||0).self||global),function(e){var t=e.cc,n=e.kh;e._,n.NumberNode=t.Node.extend({className:"kh.NumberNode",dummyBMFont:"res/battle_effect_text/battle_effecttext_no.fnt",ctor:function(e,t){this._super(this,arguments);var n=this._getLabelBMF(e,t);this.addChild(n),this.setContentSize(n.getContentSize())},_getLabelBMF:function(e,t){var i=n.NUMBER_FONT_BY_ELEMENT_TYPE[t],a=n.createInstance("LabelBMFont",["",i||this.dummyBMFont]);return a.setString(""+e),a}})}((this||0).self||global),function(e){var t=e.cc,n=e.kh;n.NUMBER_ACTION_STRATEGY={},n.NUMBER_ACTION_STRATEGY.DAMAGE=function(){return t.sequence(t.scaleBy(.1,.5,.5),t.spawn(t.scaleBy(.4,1.1,1.1).easing(t.easeElasticOut(.1)),t.moveBy(.5,0,0)))},n.NUMBER_ACTION_STRATEGY.HEAL=function(){var e=[t.scaleBy(.04,.8,.85),t.scaleBy(.08,.85,.8),t.fadeOut(.6).easing(t.easeExponentialIn())];return t.sequence.apply(null,e)},n.NUMBER_ACTION_STRATEGY.MISS=function(){var e=[t.scaleBy(.04,1,1.05),t.scaleBy(.08,1.05,1),t.fadeOut(1).easing(t.easeExponentialIn())];return t.sequence.apply(null,e)},n.NUMBER_ACTION_STRATEGY.TOTALDAMAGE=function(){return t.sequence(t.scaleBy(.1,1.2,1.2),t.spawn(t.scaleBy(.4,.6,.6).easing(t.easeElasticOut(.4)),t.moveBy(.9,0,5)))},n.NUMBER_ACTION_STRATEGY.STATUS_EFFECT=function(){return t.sequence(t.delayTime(.05),t.scaleBy(.05,.95,.95),t.spawn(t.scaleBy(.1,.8,.8),t.moveBy(.2,0,0)),t.delayTime(.05),t.spawn(t.moveBy(0,0,0),t.fadeOut(.1)))},n.NUMBER_ACTION_STRATEGY.STAMP=function(){return t.sequence(t.spawn(t.scaleBy(.4,1.1,1.1).easing(t.easeExponentialOut()),t.moveBy(.6,0,6)),t.spawn(t.moveBy(.2,0,2),t.fadeOut(.2).easing(t.easeExponentialIn())))}}((this||0).self||global),function(e){var t=e.cc,n=e.kh;n.EventSettings.damageNumber=function(e,i,a){a instanceof n.BattleWorld&&(e.addEventListener("show_damage_point",function(e,i){var o=i.element_type;null==o&&(o=n.ELEMENT_TYPE.NONELEMENTAL);var r,s=i.miss?n.NUMBER_FONT_BY_ELEMENT_TYPE[n.ELEMENT_TYPE.NONELEMENTAL]:n.NUMBER_FONT_BY_ELEMENT_TYPE[o],c=n.createInstance("DisposableAnimationNode",[n.NUMBER_ACTION_STRATEGY.DAMAGE]),u=n.NUMBER_RANDOM_POS_RECT.SIZE,l=n.NUMBER_RANDOM_POS_RECT.ANCHOR,_=t.rect(e.x-l.x*u.width,e.y-l.y*u.height,u.width,u.height);c.setPosition(n.createInstance("PositionGenerator").generateRandomPositionInRect(_)),c.scale={ls:1.4,l:1.4,m:1,s:.8}[i.size||"m"],r=i.miss?n.createInstance("LabelBMFont",["m",s]):n.createInstance("LabelBMFont",[i.value,s]);var p;p="enemy"===i.to?r.getContentSize().width*r.getAnchorPoint().x-c.getPositionX():-r.getContentSize().width*r.getAnchorPoint().x*.5,r.setPosition(t.p(p,0)),c.addChild(r);var d={ls:"s",l:"w"}[i.size];if(d){var h=n.createInstance("LabelBMFont",[d,s]);h.setPosition(t.p(p,r.getContentSize().height)),c.addChild(h)}a.UIBackLayer.addChild(c)}),e.addEventListener("show_total_damage_point",function(e,i){var o=i.element_type,r=n.NUMBER_FONT_BY_ELEMENT_TYPE[o],s=n.createInstance("DisposableAnimationNode",[n.NUMBER_ACTION_STRATEGY.TOTALDAMAGE]);s.setPosition(e);var c=n.createInstance("LabelBMFont",[i.value,r]);s.addChild(c);var u=n.createInstance("LabelBMFont",["t",r]);u.setPosition(t.p(0,c.getContentSize().height)),s.addChild(u),a.UIBackLayer.addChild(s)}),e.addEventListener("show_heal_point",function(e,t){var i=n.NUMBER_FONT_HEAL,o=n.createInstance("DisposableAnimationNode",[n.NUMBER_ACTION_STRATEGY.HEAL]);o.setPosition(e);var r=n.createInstance("LabelBMFont",[t.value,i]);o.addChild(r),a.UIBackLayer.addChild(o)}))}}((this||0).self||global),function(e){var t=e.kh;e.console,t.EventSettings.memberStatus=function(e,n,i){if(i instanceof t.BattleWorld){i=null;var a=function(e){t.createInstance("characterUpdater").updateCharacter(e.idx,e.data)};e.addEventListener(t.BattleStatus.eventName.PARTY_MEMBER_CHANGED,a),e.addEventListener(t.BattleStatus.eventName.PARTY_MEMBER_ADDED,a)}}}((this||0).self||global),function(e){var t=e.cc,n=e.kh;n.EventSettings.statusEffect=function(e,i,a){if(a instanceof n.BattleWorld){e.addEventListener("show_status_effect",function(e,i,s){var c=s?r(i):o(),u=n.STATUS_EFFECT_ICON_RANDOM_POS_RECT.SIZE,l=n.STATUS_EFFECT_ICON_RANDOM_POS_RECT.ANCHOR,_=t.rect(e.x-l.x*u.width,e.y-l.y*u.height,u.width,u.height);c.setPosition(n.createInstance("PositionGenerator").generateRandomPositionInRect(_)),a.UIBackLayer.addChild(c)});var o=function(){var e=n.createInstance("DisposableAnimationNode",[n.NUMBER_ACTION_STRATEGY.MISS]),t=n.NUMBER_FONT_BY_ELEMENT_TYPE[n.ELEMENT_TYPE.NONELEMENTAL];return e.addChild(n.createInstance("LabelBMFont",["m",t])),e},r=function(e){var t=n.createInstance("DisposableAnimationNode",[n.NUMBER_ACTION_STRATEGY.STATUS_EFFECT]),i=n.generateStatusIconPath(e);return t.addChild(new ccui.ImageView(i.png||i.jpg)),t}}}}((this||0).self||global),function(e){var t=e.kh;t.EventSettings.statusEffectTurn=function(n,i,a){if(a instanceof t.BattleWorld){var o=function(n){if(!(n.idx>t.GameConfig.PARTY_SETTINGS.MAX_AVATAR_COUNT)){var i=a.statusEffectList;if(_.invoke(i,"unregisterCharacter",n.idx),n.data.status_effects){var o=t.createInstance("battleWorld").characterList[n.idx];if(null==o||_.isEmpty(o))return void e.console.warn("battleStatus trying to update a character non-existent in the battle world");_.each(n.data.status_effects,function(t){null!=i[t.id]?i[t.id].updateCharacter(n.idx,t):e.console.warn("battleStatus trying to update a status effect id non-existent in the battle world")}),_.invoke(i,"drawStatusOnCharacter",n.idx)}}},r=function(n){var i=a.statusEffectList;if(_.invoke(i,"unregisterEnemy",n.idx),n.data.status_effects){var o=t.createInstance("battleWorld").enemyList[n.idx];if(null==o||_.isEmpty(o))return void e.console.warn("battleStatus trying to update an enemy non-existent in the battle world");_.each(n.data.status_effects,function(t){null!=i[t.id]?i[t.id].updateEnemy(n.idx,t):e.console.warn("battleStatus trying to update a status effect id non-existent in the battle world")}),_.invoke(i,"drawStatusOnEnemy",n.idx)}};n.addEventListener(t.BattleStatus.eventName.PARTY_MEMBER_CHANGED,o),n.addEventListener(t.BattleStatus.eventName.PARTY_MEMBER_ADDED,o),n.addEventListener(t.BattleStatus.eventName.PARTY_MEMBER_REMOVED,function(e){_.invoke(a.statusEffectList,"unregisterCharacter",e.idx)}),n.addEventListener(t.BattleStatus.eventName.ENEMY_CHANGED,r),n.addEventListener(t.BattleStatus.eventName.ENEMY_ADDED,r),n.addEventListener(t.BattleStatus.eventName.ENEMY_REMOVED,function(e){_.invoke(a.statusEffectList,"unregisterEnemy",e.idx)})}}}((this||0).self||global),function(e){var t=e.kh;t.EventSettings.avatarQuake=function(e,n,i){if(i instanceof t.BattleWorld){var a=null,o=function(e){var n=i.getAliveAvatarArmature();null===a?a=t.createInstance("NodeQuake",[n]):a.updateTargets(n),a[e]()};e.addEventListener("start_quake",function(){o("quakeStart")}),e.addEventListener("end_quake",function(){o("quakeEnd")})}}}((this||0).self||global),function(e){var t=e.kh;t.EventSettings.abilityTurn=function(e,n,i){if(i instanceof t.BattleWorld){var a=function(e){var t=i.characterAbilityList;_.isUndefined(t[e.idx])||_.each(e.data,function(n,i){null!=t[e.idx][i]&&t[e.idx][i].onStatusUpdate(n)})};e.addEventListener(t.BattleStatus.eventName.ABILITY_TURNS_CHANGED,a),e.addEventListener(t.BattleStatus.eventName.ABILITY_TURNS_ADDED,a)}}}((this||0).self||global),function(e){var t=e.kh;t.EventSettings.abilityBan=function(e,n,i){if(i instanceof t.BattleWorld){var a=function(e){var t=i.characterAbilityList[e.idx];_.isUndefined(t)||_.each(t,function(t,n){null!=t&&null!=t.setAbilityBanned&&t.setAbilityBanned(-1!==e.data.indexOf(n))})};e.addEventListener(t.BattleStatus.eventName.ABILITY_BANS_CHANGED,a),e.addEventListener(t.BattleStatus.eventName.ABILITY_BANS_ADDED,a),e.addEventListener(t.BattleStatus.eventName.ABILITY_BANS_REMOVED,function(e){var t=i.characterAbilityList[e.idx];_.isUndefined(t)||_.each(t,function(e){null!=e&&null!=e.setAbilityBanned&&e.setAbilityBanned(!1)})})}}}((this||0).self||global),function(e){var t=e.kh;t.EventSettings.abilityNotSatisfied=function(e,n,i){if(i instanceof t.BattleWorld){var a=function(e){var t=i.characterAbilityList;_.isUndefined(t[e.idx])||_.each(t[e.idx],function(t,n){null!=t&&null!=t.updateAbilityCondition&&t.updateAbilityCondition(-1===e.data.indexOf(n))})};e.addEventListener(t.BattleStatus.eventName.ABILITY_NOT_SATISFIED_CHANGED,a),e.addEventListener(t.BattleStatus.eventName.ABILITY_NOT_SATISFIED_ADDED,a),e.addEventListener(t.BattleStatus.eventName.ABILITY_NOT_SATISFIED_REMOVED,a)}}}((this||0).self||global),function(e){var t=e.kh;t.EventSettings.burstBan=function(e,n,i){if(i instanceof t.BattleWorld){var a=function(e){_.each(i.characterList,function(t){_.isEmpty(t)||t.setBurstBanned(-1!==e.data.indexOf(t.index))}),_.each(i.subList,function(t){_.isEmpty(t)||(t.isBurstBanned=-1!==e.data.indexOf(t.index))})};e.addEventListener(t.BattleStatus.eventName.BURST_BANS_CHANGED,a),e.addEventListener(t.BattleStatus.eventName.BURST_BANS_ADDED,a),e.addEventListener(t.BattleStatus.eventName.BURST_BANS_REMOVED,function(e){_.each(i.characterList,function(e){_.isEmpty(e)||e.setBurstBanned(!1)}),_.each(i.subList,function(e){_.isEmpty(e)||(e.isBurstBanned=!1)})})}}}((this||0).self||global),function(e){var t=e.kh;t.EventSettings.summonTurn=function(n,i,a){if(a instanceof t.BattleWorld){var o=function(t){var n=a.battleUI.SummonPanelGroup.panelList;return t.idx>=n.length?void e.console.warn("eventSettings/summonTurn: summonPanel not found"):(n[t.idx].updateTurn(t.data),void a.battleUI.SummonButton.updateTurn(t.idx,t.data))};n.addEventListener(t.BattleStatus.eventName.SUMMON_TURNS_CHANGED,o),n.addEventListener(t.BattleStatus.eventName.SUMMON_TURNS_ADDED,o)}}}((this||0).self||global),function(e){var t=e.kh;t.EventSettings.pubsubApplyBattleData=function(e,n,i){i instanceof t.BattleWorld&&cc.director.getRunningScene().isRaid()&&t.createInstance("pubsubBattle").addEventListener(t.EVENT_NAME.PUBSUB_EVENT_APPLY_BATTLE_DATA,function(n){var i=JSON.parse(n);cc.director.getRunningScene().belongsToAPlayerId(i.publisher_a_player_id)||e.dispatchEvent(t.EVENT_NAME.BATTLE_DATA_RECEIVED,[i])})}}((this||0).self||global),function(e){var t=e.kh;t.EventSettings.battleDataReceived=function(e,n,i){i instanceof t.BattleWorld&&cc.director.getRunningScene().isRaid()&&e.addEventListener(t.EVENT_NAME.BATTLE_DATA_RECEIVED,i.applyReceivedBattleData.bind(i))}}((this||0).self||global),function(e){var t=e.kh;t.EventSettings.battleUIDarkenFilter=function(e,n,i){if(i instanceof t.BattleWorld){var a=i.battleUI,o=function(e){_.invoke(a.CharacterPanelList,"enableDarkenFilter",e)},r=function(e,t){a.CharacterPanelList[e].enableDarkenFilter(t)};e.addEventListener(t.EVENT_NAME.BATTLE_UI_DARKEN_FILTER.DARKEN_FOOTER,o.bind(null,!0)),e.addEventListener(t.EVENT_NAME.BATTLE_UI_DARKEN_FILTER.RESTORE_FOOTER,o.bind(null,!1)),_.each(_.range(5),function(n){e.addEventListener(t.EVENT_NAME.BATTLE_UI_DARKEN_FILTER["DARKEN_CHARACTER_"+n],r.bind(null,n,!0)),e.addEventListener(t.EVENT_NAME.BATTLE_UI_DARKEN_FILTER["RESTORE_CHARACTER_"+n],r.bind(null,n,!1))})}}}((this||0).self||global),function(e){var t=e.kh;t.EventSettings.cureItemStatus=function(e,n,i){if(i instanceof t.BattleWorld){var a={elixir:function(e){var n=t.createInstance("continuePopup");n.updateElixirCount(e.count),n.updateElixirLimit(e.usable_amount)}},o={elixir:function(e){var n=t.createInstance("continuePopup");n.updateElixirCount(e.count),n.updateElixirLimit(e.usable_amount)}},r={elixir:function(e){t.createInstance("continuePopup").updateElixirCount(0)}};e.addEventListener(t.BattleStatus.eventName.CURE_ITEM_CHANGED,function(e){var n=e.data;null!=a[n.physical_name]&&a[n.physical_name](n),t.createInstance("cureItemInfo").update(n)}),e.addEventListener(t.BattleStatus.eventName.CURE_ITEM_ADDED,function(e){var n=e.data;null!=o[n.physical_name]&&o[n.physical_name](n),t.createInstance("cureItemInfo").update(n)}),e.addEventListener(t.BattleStatus.eventName.CURE_ITEM_REMOVED,function(e){var n=e.data;null!=r[n.physical_name]&&r[n.physical_name](n),t.createInstance("cureItemInfo").remove(n)})}}}((this||0).self||global),function(e){var t=e.kh;t.EventSettings.abilityPopupExtended=function(e,n,i){if(i instanceof t.BattleWorld){var a=t.createInstance("abilityPopupExtended"),o=function(e){a.updateCharacterData(e.idx,e.data)};e.addEventListener(t.BattleStatus.eventName.PARTY_MEMBER_CHANGED,o),e.addEventListener(t.BattleStatus.eventName.PARTY_MEMBER_ADDED,o),e.addEventListener(t.BattleStatus.eventName.PARTY_MEMBER_REMOVED,function(e){a.removeCharacterData(e.idx)})}}}((this||0).self||global),function(e){var t=e.cc,n=e.kh,i=e.ccs,a=e.res;n.EventSettings.stamp=function(e,o,r){r instanceof n.BattleWorld&&e.addEventListener("show_stamp",function(e,o){var s=n.generateStampIconPath(e);t.loader.load(s.png||s.jpg,function(){var e=i.load(a.battle_post_stamp).node;e.seekWidgetByName("coreimg_stamp").loadTexture(s.png||s.jpg),e.seekWidgetByName("username_label").string=o;var c=_.clone(n.STAMP_RANDOM_POS_RECT);c.width-=e.width,c.height-=e.height,e.setPosition(n.createInstance("PositionGenerator").generateRandomPositionInRect(c)),r.UIFrontLayer.addChild(e),e.runAction(t.sequence(n.NUMBER_ACTION_STRATEGY.STAMP(),t.removeSelf()))})})}}((this||0).self||global),function(e){var t=e.kh;t.EventSettings.fadeAvatar=function(e,i,a){a instanceof t.BattleWorld&&e.addEventListener(t.EVENT_NAME.FADE_CHARACTERS_IN,n.bind(this,a))};var n=function(e,n){n=_.isNumber(n)?n:.5,e.characterList.forEach(function(e){e instanceof t.Avatar&&e.fadeIn(n)})}}((this||0).self||global),function(e){var t=e.kh,n=e.console;t.EventSettings=t.EventSettings||{},t.EventSettings.colorFilter=function(e,i,a){a instanceof t.BattleScene&&(a=null,null,e.addEventListener("white_s",function(e,i,a){n.log("start_whiteout triggered!!!"),e.colorFilter=e.colorFilter||t.createInstance("ColorFilter",[e]),e.colorFilter.startWhiteOut(i,a)}),e.addEventListener("white_e",function(e,i,a){n.log("end_whiteout triggered!!!"),e.colorFilter=e.colorFilter||t.createInstance("ColorFilter",[e]),e.colorFilter.endWhiteOut(i,a)}),e.addEventListener("black_s",function(e,i,a){n.log("start_blackout triggered!!!"),e.colorFilter=e.colorFilter||t.createInstance("ColorFilter",[e]),e.colorFilter.startBlackOut(i,a)}),e.addEventListener("black_e",function(e,i,a){n.log("end_blackout triggered!!!"),e.colorFilter=e.colorFilter||t.createInstance("ColorFilter",[e]),e.colorFilter.endBlackOut(i,a)}),e=null)}}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e.window;t.ColorFilter=n.Class.extend({className:"ColorFilter",whiteFilter:null,blackFilter:null,_layer:null,_durationConfig:{fast:.2,slow:.5},_filterTags:{white_pale:11111,white_deep:22222,black_pale:33333,black_deep:44444},_alphaConfig:{pale:128,deep:179},_maxAlpha:0,ctor:function(e){if(null==e)throw new Error("invalid layer");this._layer=e,this.whiteFilter=this._initFilter(n.color(255,255,255,0)),this.blackFilter=this._initFilter(n.color(0,0,0,0))},_playFadeOutAnimation:function(e,t){var n=Q.defer();return e.runAction(this._fadeOutSequence(n,t)),n.promise},_playFadeInAnimation:function(e,t){var n=Q.defer();return e.runAction(this._fadeInSequence(n,t)),n.promise},_fadeOutSequence:function(e,t){return n.sequence(n.fadeTo(t,0),n.callFunc(function(){e.resolve()}))},_fadeInSequence:function(e,t){return n.sequence(n.fadeTo(t,this._maxAlpha),n.callFunc(function(){e.resolve()}))},_playColorFilterStart:function(e,t,n,i){return e.setOpacity(0),this._layer.addChild(e,0,this._filterTags[n]),this._playFadeInAnimation(e,i)},_checkAndRemoveLayerChild:function(e){e.getParent()===this._layer&&this._layer.removeChild(e)},startWhiteOut:function(e,t){this._checkAndRemoveLayerChild(this.whiteFilter),this._maxAlpha=this._alphaConfig[e];var i=n.color(255,255,255,this._maxAlpha),a="white_"+e,o=this._durationConfig[t];return this._playColorFilterStart(this.whiteFilter,i,a,o)},startBlackOut:function(e,t){this._checkAndRemoveLayerChild(this.blackFilter),this._maxAlpha=this._alphaConfig[e];var i=n.color(0,0,0,this._alphaConfig[e]),a="black_"+e,o=this._durationConfig[t];return this._playColorFilterStart(this.blackFilter,i,a,o)},_playColorFilterEnd:function(e,t){var n=this._filterTags[e],a=e.match(/white/)?this.whiteFilter:this.blackFilter;return this._playFadeOutAnimation(a,t).then(i.setTimeout(function(){0===a.getOpacity()&&this._cleanUp(n)}.bind(this),1e3))},endWhiteOut:function(e,t){var n="white_"+e,i=this._durationConfig[t];return this._playColorFilterEnd(n,i)},endBlackOut:function(e,t){var n="black_"+e,i=this._durationConfig[t];return this._playColorFilterEnd(n,i)},_initFilter:function(e){var i=t.createInstance("Sprite");return i.setTextureRect(n.rect(0,0,n.winSize.width,n.winSize.height)),i.setColor(e),i.setPosition(n.winSize.width/2,n.winSize.height/2),i},_cleanUp:function(e){this._layer.removeChildByTag(e)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;t.LayerRegistry=n.Class.extend({className:"KHLayerRegistry",_propertyAppendToLayerList:null,ctor:function(){this._propertyAppendToLayerList=i.transform({UIFrontLayer:[["battleUI"]],UIBackLayer:[["enemyStatusBarList"]],EnemyLayer:[["enemyList"]],CharacterLayer:[["characterList"]],BattleLayer:[["turn",100],["cutIn",200]]},function(e,t,n){i.each(t,function(t){var i=t.shift(),a=t.shift();e[i]={appendToLayer:n,zOrder:a}})})},getPropertyAppendToLayerList:function(){return this._propertyAppendToLayerList}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.BattleLayer=n.Layer.extend({})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.BackgroundLayer=n.Layer.extend({})}((this||0).self||global),function(e){var t=e.kh;t.NameBar=cc.Node.extend({className:"KHNameBar",name:"",nameBarNode:null,nameNode:null,ctor:function(e){this._super(),this.name=e},onEnter:function(){this._super(),this._initNameBarNode(),this._initNameNode(),this.nameBarNode.addChild(this.nameNode),this.addChild(this.nameBarNode)},_initNameBarNode:function(){var e=t.createInstance("Sprite",[res.nameBar_png]);e.setPosition(cc.winSize.width/2,cc.winSize.height-200),this.nameBarNode=e},_initNameNode:function(){var e=t.createInstance("LabelTTF",[this.name,"Arial",30,null,cc.TEXT_ALIGNMENT_CENTER,cc.VERTICAL_TEXT_ALIGNMENT_CENTER]),n=this.nameBarNode.getContentSize();e.setPosition(cc.p(n.width/2,n.height/2)),this.nameNode=e},playDisplayAnimation:function(){var e=Q.defer(),t=cc.sequence(cc.delayTime(1),cc.callFunc(function(){e.resolve()},this));return this.runAction(t),e.promise},onExit:function(){this._super(),this._cleanUp()},_cleanUp:function(){this.nameNode.removeFromParent(),this.nameBarNode.removeFromParent(),this.nameNode=null,this.nameBarNode=null}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e._,t.NamePlateAnimation=n.Class.extend({ctor:function(){var e=this._initNamePlate();this._node=e.node,this._action=e.action},setText:function(e){null!=e&&this._namePlateText.setString(e)},play:function(e){this.setText(e),t.createInstance("battleWorld").CutinLayer.addChild(this._node),this._node.runAction(this._action),this._action.gotoFrameAndPlay(0,this._action.getDuration(),0,!1)},_initNamePlate:function(){var e=this._initNamePlateSprite();e.setCascadeOpacityEnabled(!0);var t=this._initNamePlateAnimation(e);return this._namePlateText=this._initNamePlateText(e),this._initNameplateAnimationEndEvent(t),t.gotoFrameAndPause(0),{node:e,action:t}},_initNamePlateSprite:function(e){n.spriteFrameCache.addSpriteFrames(res.battle_common_nameplate_plist);var i=new n.Sprite("#battle/res/battle_ani/cutin_burst/battle_common_nameplate.png");return i.setPosition(t.NODE_POSITION.NAMEPLATE_ANIMATION_POS),i.setAnchorPoint(n.p(.5,.5)),i},_initNamePlateText:function(e){var t=new ccui.Text;return t.setFontSize(14),t.setAnchorPoint(n.p(.5,.55)),t.setPosition(n.p(e.width/2,e.height/2)),e.addChild(t),t},_initNamePlateAnimation:function(e){var i=t.createInstance("frameAnimationHelper"),a=t.NODE_POSITION.NAMEPLATE_ANIMATION_POS;return i.createAction(60,[i.createPositionTimeline([{fi:0,pos:n.p(a.x,a.y)},{fi:10,pos:n.p(a.x,a.y+20)},{fi:30,pos:n.p(a.x,a.y+30)},{fi:60,pos:n.p(a.x,a.y+40)}]),i.createScaleTimeline([{fi:0,scale:2},{fi:15,scale:2},{fi:30,scale:2.5},{fi:33,scale:1.8},{fi:36,scale:2}]),i.createAlphaTimeline([{fi:0,alpha:0},{fi:15,alpha:255},{fi:50,alpha:255},{fi:60,alpha:0}]),i.createEventTimeline([{fi:60,event:"animation_e"}])],e)},_initNameplateAnimationEndEvent:function(e){e.setFrameEventCallFunc(function(t){"animation_e"===t.getEvent()&&(e.gotoFrameAndPause(0),t.getNode().removeFromParent())},this)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.Stage=n.Class.extend({init:function(e){var i=t.createInstance("battleUrlParser").resources.stage;return this.setStageCleared(!1),this._currentStage=e.current,this._maxStage=e.max,this._background=new n.Sprite(i.png||i.jpg),this._bgm=i.mp3,this._hasBossAnimation=null!=e.vs_animation_id,this._onStageClearEventListeners=[],this},drawBackground:function(){this._background.setAnchorPoint(n.p(0,0)),this._background.setPosition(t.NODE_POSITION.BATTLE_BOTTOM_LEFT),t.createInstance("battleWorld").BackgroundLayer.addChild(this._background)},playBgm:function(){null!=this._bgm&&t.createInstance("soundPlayer").playMusic(this._bgm,t.GameConfig.BATTLE_SETTINGS.SOUND_SCALE.BGM)},setStageNumbers:function(e,t){this._currentStage=e,this._maxStage=t},showStageNumbers:function(){t.createInstance("battleWorld").battleUI.BattleUIHeader.setBattleCount(this._currentStage,this._maxStage)},hasBossAnimation:function(){return this._hasBossAnimation},setStageCleared:function(e){this._stageCleared=e},isStageCleared:function(){return this._stageCleared},clearStage:function(){this.setStageCleared(!0),t.createInstance("notificationCenter").dispatchEvent(t.EVENT_NAME.FADE_CHARACTERS_IN)}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a="battle/res/battle_ani/next_stage/";t.StageProgress=i.Class.extend({className:"KHStageProgress",RESOURCE_NAME:"battle_next_stage",NODE_NAMES:{BG_BOSS:"battle_direct_nextstage_bgboss",BG_NORMAL:"battle_direct_nextstage_bg01",PREV_NUMBER:"battle_direct_nextstage_no01",CURRENT_NUMBER:"battle_direct_nextstage_no02",TOTAL_NUMBER:"battle_direct_nextstage_nos01",BEACON_PREV_1:"battle_direct_nextstage1_first",BEACON_PREV_2:"battle_direct_nextstage2_first",BEACON_CURRENT:"battle_direct_nextstage1_second",BEACON_NEXT:"battle_direct_nextstage1_third"},TEXTURE_NAMES:{STAGE_NO:{PREFIX:a+"battle_direct_nextstage_no0",EXTENSION:".png",COUNT:5},TOTAL_NO:{PREFIX:a+"battle_direct_nextstage_nos0",EXTENSION:".png",COUNT:5}},BEACON_TEXTURES_BY_MONSTER_TYPE:{normal:a+"battle_direct_nextstage1.png",rare:a+"battle_direct_nextstage_rare1.png",boss:a+"battle_direct_nextstage_boss1.png"},EVENT_NAMES:{ANIMATION_PAUSE:"login_stop",ANIMATION_END:"animation_e",BG_CHANGE:"boss_bg"},FADE_IN_SPEED:.5,FADE_OUT_SPEED:.5,ANIMATION_START_DELAY:.2,ctor:function(){this._pos=i.p(.5*i.winSize.width,.5*i.winSize.height)},playProgressAnimation:function(a){var o=t.createInstance("WindowVisualEffect").init(e.res[this.RESOURCE_NAME]),r=o._node,s=new i.LayerColor(i.color(0,0,0,255));return i.director.getRunningScene().addChild(s,100),r.anchorY=.5,r.anchorX=.5,r.opacity=0,o.play(s,this._pos),o.pause(),this._setStageNumbers(r,a),this._setStageBeacons(r,a),this._setBackground(o,r,a),n.fadeIn(r,this.FADE_IN_SPEED).then(n.getPromiseToDelayAnimation.bind(null,1e3*this.ANIMATION_START_DELAY)).then(o.resume.bind(o)),this._animation=o,this._node=r,this._layer=s,this._enableProgressAnimationEndEvent().fail(function(t){e.console.error(t)})},finishProgressAnimation:function(){this._animation.resume(),this._enableFadeAnimationEndEvent()},_enableProgressAnimationEndEvent:function(){var e=Q.defer();return this._animation.addAnimationEventCallback(this.EVENT_NAMES.ANIMATION_PAUSE,function(){this._animation.pause(),e.resolve()},this),e.promise},_enableFadeAnimationEndEvent:function(){this._animation.addAnimationEventCallback(this.EVENT_NAMES.ANIMATION_END,function(){this._animation.removeAnimationEventCallback(this.EVENT_NAMES.ANIMATION_END),n.fadeOut(this._node,this.FADE_OUT_SPEED),n.fadeOut(this._layer,this.FADE_OUT_SPEED).then(this._cleanUp.bind(this))},this)},_setStageNumbers:function(e,t){var n=t.current-1,i=t.current,a=t.max,o=this.TEXTURE_NAMES.STAGE_NO.PREFIX+n+this.TEXTURE_NAMES.STAGE_NO.EXTENSION,r=this.TEXTURE_NAMES.STAGE_NO.PREFIX+i+this.TEXTURE_NAMES.STAGE_NO.EXTENSION,s=this.TEXTURE_NAMES.TOTAL_NO.PREFIX+a+this.TEXTURE_NAMES.TOTAL_NO.EXTENSION;e.seekWidgetByName(this.NODE_NAMES.PREV_NUMBER).setSpriteFrame(o),e.seekWidgetByName(this.NODE_NAMES.CURRENT_NUMBER).setSpriteFrame(r),e.seekWidgetByName(this.NODE_NAMES.TOTAL_NUMBER).setSpriteFrame(s)},_setStageBeacons:function(e,t){var n="normal";t.has_rare_monster&&(n="rare"),t.current===t.max&&(n="boss");var i=this.BEACON_TEXTURES_BY_MONSTER_TYPE[n];if(e.seekWidgetByName(this.NODE_NAMES.BEACON_CURRENT).setSpriteFrame(i),t.current!==t.max){var a="normal";t.current+1===t.max&&(a="boss");var o=this.BEACON_TEXTURES_BY_MONSTER_TYPE[a];e.seekWidgetByName(this.NODE_NAMES.BEACON_NEXT).setSpriteFrame(o)}else e.seekWidgetByName(this.NODE_NAMES.BEACON_NEXT).setVisible(!1)},_setBackground:function(e,t,n){t.seekWidgetByName(this.NODE_NAMES.BG_BOSS).setVisible(!1),n.current===n.max&&e.addAnimationEventCallback(this.EVENT_NAMES.BG_CHANGE,function(){t.seekWidgetByName(this.NODE_NAMES.BG_BOSS).setVisible(!0),t.seekWidgetByName(this.NODE_NAMES.BG_NORMAL).setVisible(!1)},this)},_cleanUp:function(){this._animation.cleanUp(),this._animation=null,this._layer.removeFromParent(),this._layer=null}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc;t.StartAnimation=i.Class.extend({className:"KHStartAnimation",RESOURCE_NAME:"battle_start_animation",ANIMATION_START_DELAY:.1,playStartAnimation:function(a){var o=Q.defer(),r=t.createInstance("WindowVisualEffect").init(e.res[this.RESOURCE_NAME]);return t.createInstance("Sound2Event",[r]),r.setAnimationEndCallback(function(){r.cleanUp(),o.resolve()},this),n.getPromiseToDelayAnimation(1e3*this.ANIMATION_START_DELAY).then(r.play.bind(r,a,i.p(0,0))),o.promise}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e.res;t.TargetAnimation=n.Class.extend({className:"KHTargetAnimation",ctor:function(){n.spriteFrameCache.addSpriteFrames(i.battle_ui_plist_3),this._sprite=new n.Sprite("#battle/res/battle_ui/battle_target_focus.png"),this._isPlaying=!1,this.setLayer(t.createInstance("battleWorld").BattleLayer)},setLayer:function(e){this._layer=e},play:function(e){if(this._isPlaying)return Q.reject("Target animation already playing, ignoring further target orders until the animation is finished");this._isPlaying=!0;var i=Q.defer(),a=this._sprite;a.setPosition(e.getCenterPos()),a.anchorX=.5,a.anchorY=.5,a.scaleX=0,a.scaleY=0;var o=Math.round(60*(Math.random()-.5)),r=Math.round(60*(Math.random()-.5));a.x+=o,a.y+=r,this._layer.addChild(a),a.runAction(n.spawn(n.sequence(n.rotateBy(.06,10),n.rotateBy(.3,-45).easing(n.easeIn(2))),n.sequence(n.moveBy(.36,-o,-r)),n.sequence(n.scaleTo(.06,1,1),n.scaleTo(.3,.7,.7).easing(n.easeIn(2)),n.scaleTo(.1,.68,.68),n.spawn(n.scaleTo(.2,.65,.65).easing(n.easeIn(1)),n.blink(.2,2)),n.callFunc(i.resolve),n.removeSelf())));var s=t.generateGenericSoundPath(t.BattleGenericSeIdList.target).mp3;return t.createInstance("soundPlayer").playSoundEffect(s),i.promise.then(function(){this._isPlaying=!1}.bind(this))}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc;t.BossAnimation=i.Class.extend({className:"KHBossAnimation",ANIMATION_START_DELAY:.1,playBossAnimation:function(e){var i=Q.defer(),a=t.createInstance("battleUrlParser").resources.stage.bossAnimation,o=t.createInstance("WindowVisualEffect").init(a.json);return o._node.seekWidgetByName("boss_encount_03").seekWidgetByName("encount-sp_vsboss").loadTexture(a.png||a.jpg),o._node.seekWidgetByName("boss_encount_9-2").seekWidgetByName("encount-sp_vsboss").loadTexture(a.png||a.jpg),t.createInstance("Sound2Event",[o]),o.setAnimationEndCallback(function(){o.cleanUp(),i.resolve()},this),n.getPromiseToDelayAnimation(1e3*this.ANIMATION_START_DELAY).then(o.play.bind(o,e,t.NODE_POSITION.BATTLE_BOTTOM_LEFT)),i.promise}})}((this||0).self||global),function(e){var t=e.kh;e._,t.BattleArmatureVisualEffect=t.ArmatureVisualEffect.extend({className:"KHBattleArmatureVisualEffect",init:function(e,n,i){t.ArmatureVisualEffect.prototype.init.apply(this,arguments);var a=t.createInstance("playerGameConfig");return this._animation.setSpeedScale(a.getBattleSpeedScale()),this._armature.scaleX/=a.getImageScale(),this._armature.scaleY/=a.getImageScale(),this}})}((this||0).self||global),function(e){var t=e.kh;e._,e.console,t.BattleWindowVisualEffect=t.WindowVisualEffect.extend({className:"KHBattleWindowVisualEffect",init:function(e,n){return t.WindowVisualEffect.prototype.init.apply(this,arguments)?(this._applyPlayerGameConfig(this),this):null},getChildEffect:function(e){var n=t.WindowVisualEffect.prototype.getChildEffect.apply(this,arguments);return this._applyPlayerGameConfig(n),n},_applyPlayerGameConfig:function(e){var n=t.createInstance("playerGameConfig");e._action.setTimeSpeed(n.getBattleSpeedScale()),e._action._frameInternal=1/cc.game.config.frameRate,e._node.scaleX/=n.getImageScale(),e._node.scaleY/=n.getImageScale()}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.AutoScenario=t.AutoScenario||{},t.AutoScenario.Handler=n.Class.extend({className:"KHAutoScenarioHandler",STORAGE_KEY_AUTO_BATTLE:"battle_auto_mode",ctor:function(){this._stateHandler=t.createInstance("AutoScenarioStateHandler"),this._triggerHandler=t.createInstance("AutoScenarioTriggerHandler")},init:function(){return this.updateView(),this._refreshTriggers(),this},updateView:function(){var e=t.createInstance("battleUI").AutoButton;if(e){var n=this._stateHandler.getViewState();e.updateTexture(n)}},runPreAttackScenario:function(){return this._runScenarios("runPreAttackScenario").then(function(){return this.isInterrupted()?Q.reject():Q.resolve()}.bind(this))},runPostAttackScenario:function(){return this._runScenarios("runPostAttackScenario")},runEndStageScenario:function(){return this.isInterrupted()&&this.isLastStateAuto()?this._runScenariosBeforeInterrupted("runEndStageScenario"):this._runScenarios("runEndStageScenario")},moveToNextState:function(){var e=this._stateHandler.moveToNextState();return this.updateView(),e},changeState:function(e){var t=this._stateHandler.changeState(e);return this.updateView(),t},getState:function(){return this._stateHandler.getCurrentState().STATE},isEnabled:function(){return this._stateHandler.isEnabled()},interrupt:function(){this._stateHandler.interrupt()},isInterrupted:function(){return this._stateHandler.getCurrentState().STATE===t.AutoScenario.State.STATES.INTERRUPTED},isLastStateAuto:function(){var e=this._stateHandler.getLastStateBeforeInterrupted().STATE;return e===t.AutoScenario.State.STATES.ATTACK||e===t.AutoScenario.State.STATES.ABILITY},resume:function(){this._stateHandler.resume()},_refreshTriggers:function(){this._triggerHandler.removeTriggers(),this._triggerHandler.enableTriggers(this)},_runScenarios:function(e){var t=this._getScenarios();return _.map(t,function(t){return t[e].bind(t)}).reduce(Q.when,Q())},_runScenariosBeforeInterrupted:function(e){var t=this._getScenariosBeforeInterrupted();return _.map(t,function(t){return t[e].bind(t)}).reduce(Q.when,Q())},_getScenarios:function(){return this._stateHandler.getScenarios()},_getScenariosBeforeInterrupted:function(){return this._stateHandler.getScenariosBeforeInterrupted()}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.AutoScenario.State=t.AutoScenario.State||{},t.AutoScenario.State.STATES={DISABLED:0,ATTACK:1,ABILITY:2,INTERRUPTED:3},t.AutoScenario.State.Handler=n.Class.extend({className:"KHAutoScenarioStateHandler",STATES:t.AutoScenario.State.STATES,STATE_CLASS_NAMES:function(e){var t={};return t[e.DISABLED]="AutoScenarioStateDisabled",t[e.ATTACK]="AutoScenarioStateAttack",t[e.ABILITY]="AutoScenarioStateAbility",t[e.INTERRUPTED]="AutoScenarioStateInterrupted",t}(t.AutoScenario.State.STATES),ctor:function(){var e=[this.STATES.DISABLED,this.STATES.ATTACK,this.STATES.ABILITY],n=t.createInstance("sessionStorage").get(t.AutoScenario.Handler.prototype.STORAGE_KEY_AUTO_BATTLE),i=this.STATES.DISABLED;"number"==typeof n&&e.indexOf(n)>-1&&(i=n),this._stateIterator=t.createInstance("AutoScenarioStateIterator",[e,i]),this._updateCurrentState()},moveToNextState:function(){return this._stateIterator.moveToNextState(),this._updateCurrentState(),this.getCurrentState()},changeState:function(e){return-1===_.values(this.STATES).indexOf(e)?(console.warn("KHAutoScenarioStateHandler: state index out of range"),this.getCurrentState()):e===this.STATES.INTERRUPTED?(this.interrupt(),this.getCurrentState()):(this._stateIterator.changeState(e),this._updateCurrentState(),this.getCurrentState())},getCurrentState:function(){return this._state},getLastStateBeforeInterrupted:function(){return this._instantiateByIteratorState()},getScenarios:function(){return this._state.getScenarios()},getScenariosBeforeInterrupted:function(){return this.getLastStateBeforeInterrupted().getScenarios()},isEnabled:function(){return this.getScenarios().length>0},interrupt:function(){this._state=this._instantiateState(this.STATES.INTERRUPTED)},resume:function(){this._state=this._instantiateByIteratorState()},getViewState:function(){return this._instantiateByIteratorState()},_updateCurrentState:function(){this._state&&this._state.preventsStateChange||(this._state=this._instantiateByIteratorState())},_getStateCount:function(){return _.keys(this.STATES).length},_instantiateByIteratorState:function(){var e=this._stateIterator.getCurrentState();return this._instantiateState(e)},_instantiateState:function(e){return t.createInstance(this.STATE_CLASS_NAMES[e])}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.AutoScenario.Trigger=t.AutoScenario.Trigger||{},t.AutoScenario.Trigger.Handler=n.Class.extend({className:"KHAutoScenarioTriggerHandler",TRIGGERS:["AutoScenarioTriggerEndStage"],ctor:function(){this._triggers=this._instantiateTriggers()},removeTriggers:function(){_.invoke(this._triggers,"removeTrigger")},enableTriggers:function(e){_.invoke(this._triggers,"enableTrigger",e)},_instantiateTriggers:function(){return _.map(this.TRIGGERS,t.createInstance,t)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.AutoScenario.Attack=n.Class.extend({className:"KHAutoScenarioAttack",runPreAttackScenario:function(){return Q.resolve()},runPostAttackScenario:function(){return t.createInstance("scenarioPlayer").removeScenarioEndEventCallbacks(),t.createInstance("battleUI").AttackButton.simulateAttack(),Q.resolve()},runEndStageScenario:function(){return Q.resolve()}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e.console;t.AutoScenario.Ability=n.Class.extend({className:"KHAutoScenarioAbility",runPreAttackScenario:function(){return this._playAllAvailableAbilities().fail(function(e){i.warn(e&&e.stack?e.stack:e)})},runPostAttackScenario:function(){return Q.resolve()},runEndStageScenario:function(){return Q.resolve()},_playAllAvailableAbilities:function(){var e=t.createInstance("battleWorld"),n=e.characterList,i=e.characterAbilityList,a=t.createInstance("smartBeat");return null==e.characterList?a.sendError("characterList is Null at Ability Auto"):e.characterList.length<=0&&a.sendError("characterList is Empty at Ability Auto"),null==e.characterAbilityList?a.sendError("characterList is Null at Ability Auto"):e.characterAbilityList.length<=0&&a.sendError("characterList is Empty at Ability Auto"),_.map(n,function(e){return this._playAvailableCharacterAbilities.bind(this,i,e)},this).reduce(Q.when,Q())},_playAvailableCharacterAbilities:function(e,n){if(_.isEmpty(n))return Q.resolve();var i=n.index,a=e[i],o=t.createInstance("smartBeat");return null==a&&(o.log("character:"+JSON.stringify(n)),o.log("characterAbilityList:"+JSON.stringify(e)),o.sendError("fail to load character ability lists at Ability Auto")),_(a).reject(_.isEmpty).shuffle().map(function(e){return this._useAbility.bind(this,i,e)},this).reduce(Q.when,Q())},_useAbility:function(e,n){if(!n.isUsable())return Q.resolve();var i=this._getAbilityTarget(n);if(n.isPartyMemberSelectable()&&i<0)return Q.resolve();if(t.createInstance("autoScenarioHandler").isInterrupted())return Q.resolve("");var a=Q.defer(),o=t.createInstance("battleWorld");return t.createInstance("scenarioPlayer").addScenarioEndEventCallbackOnce(a.resolve,a),o.useAbility(e,n.getIndex(),i),a.promise},_getAbilityTarget:function(e){return e.isPartyMemberSelectable()?this._getPartyMemberSingleTarget(e):t.createInstance("battleWorld").getTarget()},_getPartyMemberSingleTarget:function(e){return{heal:this._getPartyMemberSingleHealTarget,revive:this._getPartyMemberSingleReviveTarget,buff:this._getPartyMemberSingleBuffTarget}[e.getPartyMemberSelectableType()].call(this)},_getPartyMemberSingleHealTarget:function(){var e=t.createInstance("battleWorld").characterList,n=_(e).reject(_.isEmpty).shuffle().find(function(e){return e.hp<e.maxHp});return n?n.index:-1},_getPartyMemberSingleReviveTarget:function(){var e=t.createInstance("battleWorld").characterList,n=_(e).shuffle().find(function(e){return null!=e&&_.isEmpty(e)});return n?n.index:-1},_getPartyMemberSingleBuffTarget:function(){var e=t.createInstance("battleWorld").characterList,n=_(e).shuffle().find(function(e){return!_.isEmpty(e)});return n?n.index:-1}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.AutoScenario.Next=n.Class.extend({className:"KHAutoScenarioNext",MOVE_TO_NEXT_STAGE_DELAY_MS:500,runPreAttackScenario:function(){return Q.resolve()},runPostAttackScenario:function(){return Q.resolve()},runEndStageScenario:function(){return Q.delay(this.MOVE_TO_NEXT_STAGE_DELAY_MS).then(function(){t.createInstance("battleUI").NextButton.emulateNextButtonPress()}),Q.resolve()}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.AutoScenario.State.Iterator=n.Class.extend({className:"KHAutoScenarioStateIterator",ctor:function(e,t){this._stateList=e,this._currentStateIndex=e.indexOf(t)},moveToNextState:function(){return this._currentStateIndex++,this._currentStateIndex%=this._getStateCount(),this.getCurrentState()},changeState:function(e){return this._currentStateIndex=this._stateList.indexOf(e),this.getCurrentState()},getCurrentState:function(){return this._stateList[this._currentStateIndex]},_getStateCount:function(){return this._stateList.length}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.AutoScenario.State.Attack=n.Class.extend({className:"KHAutoScenarioStateAttack",STATE:t.AutoScenario.State.STATES.ATTACK,ctor:function(){this.preventsStateChange=!1,this.isIterative=!0},getScenarios:function(){return _.map(["AutoScenarioAttack","AutoScenarioNext"],t.createInstance,t)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.AutoScenario.State.Disabled=n.Class.extend({className:"KHAutoScenarioStateDisabled",STATE:t.AutoScenario.State.STATES.DISABLED,ctor:function(){this.preventsStateChange=!1,this.isIterative=!0},getScenarios:function(){return _.map([],t.createInstance,t)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.AutoScenario.State.Ability=n.Class.extend({className:"KHAutoScenarioStateAbility",STATE:t.AutoScenario.State.STATES.ABILITY,ctor:function(){this.preventsStateChange=!1,this.isIterative=!0},getScenarios:function(){return _.map(["AutoScenarioAbility","AutoScenarioAttack","AutoScenarioNext"],t.createInstance,t)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.AutoScenario.State.Interrupted=n.Class.extend({className:"KHAutoScenarioStateInterrupted",STATE:t.AutoScenario.State.STATES.INTERRUPTED,ctor:function(){this.preventsStateChange=!0,this.isIterative=!1},getScenarios:function(){return _.map([],t.createInstance,t)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.AutoScenario.Trigger.EndStage=n.Class.extend({className:"AutoScenarioTriggerEndStage",removeTrigger:function(){this._eventListener&&t.createInstance("battleUI").CenterPanel.removeButtonAnimationEndCallback(this._eventListener)},enableTrigger:function(e){var n=t.createInstance("battleUI").CenterPanel;this._eventListener=n.addButtonAnimationEndCallback(n.BUTTON_ANIMATION_NAMES.SHOW_NEXT_BUTTON,e.runEndStageScenario,e)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.UIPartAbstract=n.Class.extend({className:"KHUIPartAbstract",ctor:function(e,t){this._battleUI=e,this._widget=t?e.getWidgetByName(t):null},init:function(){return this},addTouchEventListener:function(e,t){this._widget.addTouchEventListener(e,t)},setVisible:function(e){this._widget.setVisible(e)},setEnabled:function(e){this._widget.setEnabled(e)},enableDarkenFilter:function(e){this._widget.color=e?t.BATTLE_UI_DARKEN_FILTER_COLOR:n.color(255,255,255,255)},removeFromParent:function(){this._widget.removeFromParent()},appendToLayerByLayerName:function(e){return this.appendToLayer(t.createInstance("battleWorld")[e])},appendToLayer:function(e){if(null==e)return this;var t=function(){};return null!=this._widget.getParent()&&(t=this._getRestoreFunction(this._widget),this.removeFromParent(!1)),e.addChild(this._widget),t(),this._layer=e,this},_getRestoreFunction:function(e){var t=e.seekWidgets(function(e){return!_.isEmpty(e.getAction())}).map(function(e){var t=e.getAction();return function(){e.runAction(t)}});return function(){_.each(t,function(e){e()})}},reappendToLayer:function(){return this.appendToLayer(this._layer)},cleanup:function(){this._widget&&(this._widget.addTouchEventListener&&this._widget.addTouchEventListener(null,null),this._widget=null)}})}((this||0).self||global),function(e){var t=e.cc,n=e.ccs,i=e.ccui,a=e.kh,o=e.res,r=e._;a.BATTLE_UI_DARKEN_FILTER_COLOR=t.color("#808080"),a.BattleUI=t.Node.extend({className:"BattleUI",BATTLE_UI_BASE_JSON_NAME:r.getFileNameFromPath(o.battle_ui_base_json),LAYER_REGISTRY:{DEFAULT:"UIFrontLayer",CenterPanel:"UIBackLayer",EnemyStatusBarList:"UIBackLayer"},SoundButton:null,AttackButton:null,BurstButton:null,HealButton:null,BackButton:null,NextButton:null,SummonButton:null,SummonPanelGroup:null,CharacterPanelList:null,EnemyStatusBarList:null,BattleUIHeader:null,_battleUIRootNode:null,_flgUseSpecialAttack:!0,USE_BURST_STORAGE_KEY:"kh_battle_use_burst_flag",init:function(){var e=n.load(o.battle_ui_base_json);this._battleUIRootNode=e.node,this._action=this._battleUIRootNode.runAction(e.action),this._action.gotoFrameAndPause(0),this._eventHandler=a.createInstance("AnimationEventHandlerCcs_2_0").init(this._action),this._isEnabled=!0,e.node.seekWidgetByName("header_base").setTouchEnabled(!1);var t=a.createInstance("sessionStorage").get(this.USE_BURST_STORAGE_KEY);return"boolean"==typeof t&&(this._flgUseSpecialAttack=t),this},playAction:function(e){this._action.gotoFrameAndPlay(this._action.animationInfo[e].startIndex,this._action.animationInfo[e].endIndex,!1)},playAndTrackAction:function(e){var t=Q.defer();return this.setAnimationEndCallback(e,function(){this.removeAnimationEndCallback(e),t.resolve()},this),this.playAction(e),t.promise},setAnimationEndCallback:function(e,t,i){var a=new n.Timeline,o=new n.EventFrame;o.setEvent(e+"_e"),o.setFrameIndex(this._action.animationInfo[e].endIndex),a.addFrame(o),this._action.addTimeline(a),this._eventHandler.addAnimationEventCallback(e+"_e",t,i),this._animationEndCallbackRemovers=this._animationEndCallbackRemovers||[],this._animationEndCallbackRemovers[e]=function(){this._action.removeTimeline(a),this._eventHandler.removeAnimationEventCallback(e+"_e")}.bind(this)},removeAnimationEndCallback:function(e){null!=this._animationEndCallbackRemovers[e]&&(this._animationEndCallbackRemovers[e](),this._animationEndCallbackRemovers[e]=null)},getWidgetByName:function(e){var n=this._battleUIRootNode;if(t.sys.isNative){n=n.getChildByTag(10003)}return i.helper.seekWidgetByName(n,e)},getRootNode:function(){return this._battleUIRootNode},appendTo:function(e){e.addChild(this._battleUIRootNode)},isFlgUseSpecialAttack:function(){return this._flgUseSpecialAttack},toggleFlgUseSpecialAttack:function(){this._flgUseSpecialAttack=!this._flgUseSpecialAttack,a.createInstance("sessionStorage").set(this.USE_BURST_STORAGE_KEY,this._flgUseSpecialAttack)},beforeSummon:function(){this.SummonPanelGroup.close(),this.setSummonLocked(!0)},setSummonLocked:function(e){r.invoke(this.SummonPanelGroup.panelList.concat(this.SummonButton.panelList),"setLocked",e)},endSummon:function(){},setEnabled:function(e){if(this._isEnabled===e)return Q.resolve();this._isEnabled=e;var t=this.CenterPanel[e?"showAttackButton":"hideAttackButton"]();return this.AttributeDiagram.setVisible(e),this.SoundButton.setEnabled(e),this.SummonButton.setEnabled(e),!e&&this.SummonPanelGroup.close(),this.AttackButton.setEnabled(e),r.each(a.createInstance("battleWorld").enemyStatusBarList,function(t){null==t||r.isEmpty(t)||t.setEnabled(e)}),r.invoke(this.CharacterPanelList,"setTouchEnabled",e),this.MenuButton.setEnabled(e),this.HealButton.setEnabled(e),this.HealButton.enableDarkenFilter(!e),t},setTouchEnabled:function(e){this.SoundButton.setEnabled(e),this.SummonButton.setEnabled(e),r.each(a.createInstance("battleWorld").enemyStatusBarList,function(t){null==t||r.isEmpty(t)||t.setEnabled(e)}),r.invoke(this.CharacterPanelList,"setTouchEnabled",e),this.MenuButton.setEnabled(e),this.HealButton.setEnabled(e)},setSummonBroken:function(e){this.SummonButton.setBroken(e)},dispose:function(){this._onDispose()},_onDispose:function(){this.BattleUIHeader&&(this.BattleUIHeader.cleanUp(),this.BattleUIHeader=null),this.CenterPanel&&(this.CenterPanel.cleanup(),this.CenterPanel=null),this.AttackButton&&(this.AttackButton.cleanup(),this.AttackButton=null),this.CharacterCard&&(this.CharacterCard.cleanup(!0),this.CharacterCard=null),this.SoundButton&&(this.SoundButton=null),this.CharacterPanelList&&(this.CharacterPanelList.map(function(e){e.cleanup(!0)}),this.CharacterPanelList.length=0,this.CharacterPanelList=null),this.removeAllChildrenWithCleanup(!0)}})}((this||0).self||global),function(e){var t=e.kh;t.RaidBattleUI=t.BattleUI.extend({className:"RaidBattleUI",init:function(){return t.BattleUI.prototype.init.call(this),this.reviveButton=t.createInstance("ReviveButton").init(this),this.raidMenuButton=t.createInstance("RaidMenuButton").init(this),this.stampButton=t.createInstance("StampButton").init(this),this.raidMessageWindow=t.createInstance("RaidMessageWindow").init(this),this.raidHelpRequestButton=t.createInstance("RaidHelpRequestButton").init(this,t.createInstance("battleWorld").raidHelpRequestStatus),this},_onDispose:function(){this.reviveButton=null,this.raidMenuButton=null,this.stampButton=null,this.raidMessageWindow&&this.raidMessageWindow.cleanup(),this.raidMessageWindow=null,this._super()}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.SoundButton=n.Class.extend({className:"KHSoundButton",_widget:null,ctor:function(e,n,i){this._widget=e.getWidgetByName(n),this._widget.addTouchEventListener(i,this),this.setTexture(t.createInstance("playerGameConfig").isSoundOn()),this.setEnabled(!1)},setEnabled:function(e){this._widget.setEnabled(e)},setTexture:function(e){this._widget.loadTextureNormal(e?"battle/res/battle_ui/battle_btn_sound_1.png":"battle/res/battle_ui/battle_btn_sound_0.png",ccui.Widget.PLIST_TEXTURE)}})}((this||0).self||global),function(e){var t=e.kh;e.cc,t.CenterPanel=t.UIPartAbstract.extend({className:"KHCenterPanel",ctor:function(e,t){this._battleUI=e,this._widget=e.getWidgetByName(t)},showDefaultView:function(){return this._battleUI.AttackButton.setVisible(!0),this._battleUI.AttributeDiagram.setVisible(!0),this.hideReviveButton()},showAttackButton:function(){return this.showDefaultView()},hideAttackButton:function(){return this._battleUI.AttackButton.setVisible(!1)},showNextButton:function(){return this._battleUI.NextButton.showButton()},showReviveButton:function(){return null==this._battleUI.reviveButton?Q.resolve():(this._battleUI.reviveButton.setVisible(!0),Q.resolve())},hideReviveButton:function(){return null==this._battleUI.reviveButton?Q.resolve():(this._battleUI.reviveButton.setVisible(!1),Q.resolve())},setEnabled:function(e){this._enabled=e},isEnabled:function(){return this._enabled},setVisible:function(e){this._widget.setVisible(e)}})}((this||0).self||global),function(e){var t=e.kh,n=t.CenterPanel.prototype;t.CenterPanel=t.CenterPanel.extend({className:"KHCenterPanel",BUTTONS:{ATTACK:0,REVIVE:1,NEXT:2,NONE:3},BUTTON_ANIMATION_NAMES:{DEFAULT:"default_view",HIDE_ATTACK_BUTTON:"attack",SHOW_NEXT_BUTTON:"next_stage",SHOW_REVIVE_BUTTON:"revive"},PARTICLE_ANIMATION_NAME:"Particle_1",ATTACK_BUTTON_BASE:"gear_attack",REVIVE_BUTTON_BASE:"gear_revive",ctor:function(e,t){n.ctor.call(this,e,t),this._widget.seekWidgetByName(this.ATTACK_BUTTON_BASE).setVisible(!1),this.setEnabled(!1),this._visibleButton=this.BUTTONS.NONE,this._animationEndEventListeners=[]},showDefaultView:function(){return this.isEnabled()?(this._visibleButton=this.BUTTONS.ATTACK,this._widget.seekWidgetByName(this.ATTACK_BUTTON_BASE).setVisible(!0),this._widget.getAction().gotoFrameAndPause(0),Q.resolve()):Q.resolve()},showAttackButton:function(){return this._visibleButton=this.BUTTONS.ATTACK,this.showDefaultView()},hideAttackButton:function(){return this._visibleButton!==this.BUTTONS.ATTACK?Q.resolve():(this._visibleButton=this.BUTTONS.NONE,this._playAnimation(this.BUTTON_ANIMATION_NAMES.HIDE_ATTACK_BUTTON,!1))},showNextButton:function(){return t.createInstance("autoScenarioHandler").interrupt(),this._visibleButton=this.BUTTONS.NEXT,this._playAnimation(this.BUTTON_ANIMATION_NAMES.SHOW_NEXT_BUTTON,!1)},showReviveButton:function(){return this._visibleButton=this.BUTTONS.REVIVE,this._widget.seekWidgetByName(this.REVIVE_BUTTON_BASE).setVisible(!0),this._playAnimation(this.BUTTON_ANIMATION_NAMES.SHOW_REVIVE_BUTTON,!1)},hideReviveButton:function(){if(this._visibleButton!==this.BUTTONS.REVIVE)return Q.resolve();this._visibleButton=this.BUTTONS.NONE;var e=this._widget.getAnimInfo(this.BUTTON_ANIMATION_NAMES.SHOW_REVIVE_BUTTON);return e.action.gotoFrameAndPause(e.animInfo.startIndex),this._widget.seekWidgetByName(this.REVIVE_BUTTON_BASE).setVisible(!1),Q.resolve()},appendToLayer:function(e){n.appendToLayer.call(this,e);var t=this._widget.seekWidgetByName(this.PARTICLE_ANIMATION_NAME);return null!=t&&t.scheduleUpdateWithPriority(1),this},skipCurrentAnimation:function(){this._currentAnimation&&this._widget.changeFrameWithAnimInfo(this._currentAnimation,"end")},addButtonAnimationEndCallback:function(e,t,n){return this._addButtonAnimationEndCallback(e,t,n,!1)},addButtonAnimationEndCallbackOnce:function(e,t,n){return this._addButtonAnimationEndCallback(e,t,n,!0)},removeButtonAnimationEndCallback:function(e){_.pull(this._animationEndEventListeners,e)},removeAllButtonAnimationEndCallbacks:function(){this._animationEndEventListeners=[]},_addButtonAnimationEndCallback:function(e,t,n,i){var a={animationName:e=e,callback:t,context:n,once:i};return this._animationEndEventListeners.push(a),a},_playAnimation:function(e,t){return this.isEnabled()?(this.skipCurrentAnimation(),this._currentAnimation=e,this._widget.getAction().setTimeSpeed(1),this._widget.animate(e,t).then(function(){this._fireAnimationEndEvent(this._currentAnimation),this._currentAnimation=null}.bind(this))):Q.resolve()},_fireAnimationEndEvent:function(e){var t=_.filter(this._animationEndEventListeners,function(t){return t.animationName===e});_.each(t,function(e){e.callback.call(e.context)},this),_.each(t,function(e){e.once&&this.removeButtonAnimationEndCallback(e)},this)},cleanUp:function(){this.removeAllButtonAnimationEndCallbacks()}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e.ccui);t.AttackButton=t.UIPartAbstract.extend({className:"KHAttackButton",init:function(e){return this._onTouchCallbacks=[],this.addOnTouchCallback(e),this._widget.addTouchEventListener(this._fireOnTouchEvent,this),this._widget.setSoundEnabled(!1),this.setEnabled(!1),this},addOnTouchCallback:function(e,t){this._onTouchCallbacks.push({callback:e,context:t})},removeOnTouchCallback:function(e){_.remove(this._onTouchCallbacks,function(t){return e===t.callback})},setAdditionalOnTouchBehaviour:function(e){var t=function(){e(),this.removeOnTouchCallback(t)};this.addOnTouchCallback(e,this),this._onTouchAdditionalCallback=t},clearAdditionalOnTouchBehaviour:function(){this.removeOnTouchCallback(this._onTouchAdditionalCallback),this._onTouchAdditionalCallback=null},simulateAttack:function(){this._fireOnTouchEvent(this._widget,n.Widget.TOUCH_ENDED)},_fireOnTouchEvent:function(e,t){t===n.Widget.TOUCH_ENDED&&_.each(this._onTouchCallbacks,function(n){n.callback.call(n.context,e,t)})},cleanup:function(){this._super.apply(this,arguments),this._onTouchCallbacks=null}})}((this||0).self||global),function(e){var t=e.kh;e.cc,t.BurstButton=t.UIPartAbstract.extend({className:"KHBurstButton",_widget:null,_battleUI:null,ctor:function(e,t,n){this._super(e,t),this.addTouchEventListener(n,this),this.setEnabled(!0),this._widget.setBright(!e.isFlgUseSpecialAttack())},setEnabled:function(e){t.pc.roles.UIUtility._setEnableButton.call(null,this._widget,e)}})}((this||0).self||global),function(e){var t=e.kh;e.cc,t.HealButton=t.UIPartAbstract.extend({className:"KHHealButton",_widget:null,ctor:function(e,t,n){this._super(e,t),this.addTouchEventListener(n,this),this.setEnabled(!1)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.UI_BACK_BUTTON_SET_CALLBACK_EVENT_NAME="ui_back_button",t.BackButton=n.Class.extend({className:"KHBackButton",_widget:null,_battleUI:null,_onTouchCallback:null,ctor:function(e,t){this._battleUI=e,this._widget=e.getWidgetByName(t),this._widget.addTouchEventListener(this._onPushEvent,this)},setOnTouchBehaviour:function(e){this._onTouchCallback=e},setVisible:function(e){this._widget.setVisible(e)},_onPushEvent:function(e,t){t===ccui.Widget.TOUCH_ENDED&&this._onTouchCallback&&(this._onTouchCallback(),this._onTouchCallback=null)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e.ccui;e.console,t.NextButton=n.Class.extend({className:"KHNextButton",ctor:function(e,n){this._battleUI=e,this._widget=e.getWidgetByName(n),this._widget.addTouchEventListener(this._onTouchEvent,this),this._widget.setSound(t.SoundList.BUTTON_TOUCHED_CONFIRMED)},showButton:function(){this._battleUI.CenterPanel.showNextButton()},setNextStageCallback:function(){this._onTouchCallback=this._gotoNextStage},setEndBattleCallback:function(){this._onTouchCallback=this._gotoNextQuestState},emulateNextButtonPress:function(){this._widget.extractCurrentTouchEvent().emulateTouchEnded()},_onTouchEvent:function(e,t){t===i.Widget.TOUCH_ENDED&&null!=this._onTouchCallback&&(this._onTouchCallback(),this._onTouchCallback=null)},_gotoNextStage:function(){t.createInstance("battleWorld").reloadBattle(!0)},_gotoNextQuestState:function(){t.createInstance("battleWorld").endBattle()}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e.ccui;t.MenuButton=n.Class.extend({className:"KHMenuButton",ctor:function(e,n){this._battleUI=e,this._widget=e.getWidgetByName(n),this._widget.addTouchEventListener(this._onTouchEvent,this),this._widget.setSound(t.SoundList.WINDOW_OPEN),this.setEnabled(!1)},_onTouchEvent:function(e,a){a===i.Widget.TOUCH_ENDED&&(this.setEnabled(!1),this._getGainedItems().then(function(e){var i=e.body.gained_items,a=n.director.getRunningScene();t.ImplantedPopup.createOrGet(a,"a_q_001_menu","AQ001MenuPopup").open({gained:{coin:i.gem,normal:i.wooden_box,silver:i.silver_box,gold:i.golden_box,rainbow:i.rainbow_box}})}).finally(this.setEnabled.bind(this,!0)))},_getGainedItems:function(){var e=t.createInstance("questInfo");return e.isJoinedRaid()?t.createInstance("apiBattle").getGainedItems(e.getQuestType()):t.createInstance("apiAQuests").getGainedItems(e.getQuestId(),e.getQuestType())},setEnabled:function(e){this._widget.setEnabled(e)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.console;t.AutoButton=n.Class.extend({className:"KHAutoButton",APPEARANCE_NAMES:function(e){var t={};return t[e.DISABLED]="auto_off",t[e.ATTACK]="auto_on_attack",t[e.ABILITY]="auto_on_ability",t}(t.AutoScenario.State.STATES),BUTTON_NAMES:["btn_auto_off","btn_auto_on_attack","btn_auto_on_ability"],init:function(e,t){return this._battleUI=e,null!=t&&""!==t&&(this._widget=e.getWidgetByName(t),i.each(this.BUTTON_NAMES,this._setWidgetTouchEventListener.bind(this,this._onTouchEvent,this))),this},updateTexture:function(e){var t=this.APPEARANCE_NAMES[e.STATE];this._setAppearance(t)},setEnabled:function(e){t.pc.roles.UIUtility._setEnableButton.call(null,this._widget,e)},_setAppearance:function(e){null!=e&&this._widget.setAppearance(e)},_onTouchEvent:function(e,n){if(n===ccui.Widget.TOUCH_ENDED){var i=t.createInstance("autoScenarioHandler");i.moveToNextState(),i.isInterrupted()||t.createInstance("sessionStorage").set(t.AutoScenario.Handler.prototype.STORAGE_KEY_AUTO_BATTLE,i.getState())}},_setWidgetTouchEventListener:function(e,t,n){var i=this._widget.seekWidgetByName(n);return null==i?void a.warn("KHAutoButton._setWidgetTouchEventListener: widget not found: "+n):void i.addTouchEventListener(e,t)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.ReloadButton=n.Class.extend({className:"KHReloadButton",_widget:null,ctor:function(e,t){this._widget=e.getWidgetByName(t),this._widget.addTouchEventListener(this._onTouchEventListener,this)},_onTouchEventListener:function(e,t){t===ccui.Widget.TOUCH_ENDED&&this._onReload()},_onReload:function(){t.createInstance("battleWorld").reloadBattle(!1)},setEnabled:function(e){this._widget.setEnabled(e)}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e.ccui);t.ReviveButton=t.UIPartAbstract.extend({className:"KHReviveButton",WIDGET_NAME:"btn_revive",init:function(e){return this._battleUI=e,this._widget=e.getWidgetByName(this.WIDGET_NAME),this._widget.addTouchEventListener(this._onTouchEvent,this),this},setVisible:function(e){this._widget.setVisible(e)},_onTouchEvent:function(e,i){if(i===n.Widget.TOUCH_ENDED){var a=t.createInstance("notificationCenter");this._battleUI.setEnabled(!1),a.dispatchEvent(t.EVENT_NAME.BATTLE_UI_DARKEN_FILTER.DARKEN_FOOTER),t.createInstance("continuePopup").open()}}})}((this||0).self||global),function(e){var t=e.kh;t.RaidReloadButton=t.ReloadButton.extend({className:"KHRaidReloadButton",_onReload:function(){t.createInstance("scenarioPlayer").clearScenarioQueue(),t.createInstance("pubsubBattle").removeAllEventListeners(),t.ReloadButton.prototype._onReload.call(this)}})}((this||0).self||global),function(e){var t=e.kh;e.cc,e.ccui,e.console,t.RaidNextButton=t.NextButton.extend({className:"KHRaidNextButton",showButton:function(){this._battleUI.CenterPanel.showNextButton(),this._battleUI.raidMenuButton.setVisible(!1)}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e.ccui);t.RaidMenuButton=t.UIPartAbstract.extend({className:"KHRaidMenuButton",WIDGET_NAME:"btn_info",init:function(e){return this._battleUI=e,this._widget=e.getWidgetByName(this.WIDGET_NAME),this._widget.setTouchEnabled(!0),this._widget.setSoundEnabled(!0),this._widget.addTouchEventListener(this._onTouchEvent,this),this._widget.setSound(t.SoundList.BUTTON_TOUCHED_DECIDE),this.setVisible(!0),this},_onTouchEvent:function(e,i){if(i===n.Widget.TOUCH_ENDED){var a=t.createInstance("questInfo").getQuestType();t.createInstance("raidMenuPopupFactory").create({}).open({questType:a})}}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e.ccui);t.RaidHelpRequestButton=t.UIPartAbstract.extend({className:"KHRaidHelpRequestButton",WIDGET_NAME:"raid_battle_menu",init:function(e,n){return this._battleUI=e,this._raidHelpRequestStatus=n,this._popupFactory=t.createInstance("rescueConfirmPopupFactory"),this._widget=e.getWidgetByName(this.WIDGET_NAME),this._widget.setTouchEnabled(!0),this._widget.setSoundEnabled(!0),this.setVisible(!0),t.createInstance("questInfo").isUnionMajorRaidBossQuestType()?(this.setEnabled(!1),this):(this._widget.addTouchEventListener(this._onTouchEvent,this),this._widget.setSound(t.SoundList.BUTTON_TOUCHED_DECIDE),this._listenForHelpRequestAvailabilityChanges(n),this)},setEnabled:function(e){t.UIPartAbstract.prototype.setEnabled.call(this,e),this.enableDarkenFilter(!e),this._raidHelpRequestStatus.clearOnRequestAvailabilityChangeCallbacks(),e&&this._listenForHelpRequestAvailabilityChanges(this._raidHelpRequestStatus)},_onTouchEvent:function(e,i){if(i===n.Widget.TOUCH_ENDED){var a={questType:t.createInstance("questInfo").getQuestType(),raidHelpRequestStatus:this._raidHelpRequestStatus};this._popupFactory.updateRescueRequestData(this._raidHelpRequestStatus).then(function(e){return e.create({}).open(a)},console.error)}},_listenForHelpRequestAvailabilityChanges:function(e){e.onRequestAvailabilityChange(function(e){this.enableDarkenFilter(!e)}.bind(this))}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.SummonButton=n.Class.extend({className:"KHSummonButton",ACTION_NAMES:{SUMMON_OPEN:"summon_open",SUMMON_CLOSE:"summon_close"},TOUCH_PANEL_NAME:"btn_summon",BAN_WIDGET_NAME:"banfilter_summon",MAIN_LABEL_NAME:"main_fra",SUPPORT_LABEL_NAME:"sup_fra",SUMMON_MAIN_INDEX:0,SUMMON_SUPPORT_INDEX:6,panelList:[],_isOpened:!1,_widget:null,_battleUI:null,ctor:function(e,n){this._battleUI=e,this._widget=e.getWidgetByName(n),this._initPanel(),this._touchPanel=e.getWidgetByName(this.TOUCH_PANEL_NAME);var i=this.onPushTouchPanel;this._touchPanel.addTouchEventListener(i,this),this._touchPanel.setSoundEnabled(!0),this._touchPanel.setSound(t.SoundList.BUTTON_TOUCHED_DECIDE),this.setEnabled(!1)},_initPanel:function(){var e=this._widget;this.panelList=_.map(_.range(t.SUMMON_PANEL_NUM),function(n){var i=t.createInstance("SummonPanel",[e,n]);return i.setTurnNumberEnabled(!1),i})},onPushTouchPanel:function(e,t){t===ccui.Widget.TOUCH_BEGAN?this._widget.setHighlighted(!0):t===ccui.Widget.TOUCH_ENDED?(this.onPushEvent(e,t),this._widget.setHighlighted(!1)):t===ccui.Widget.TOUCH_CANCELED&&this._widget.setHighlighted(!1)},onPushEvent:function(e,n){n===ccui.Widget.TOUCH_ENDED&&(this._battleUI.SummonPanelGroup.isOpened()||t.createInstance("characterStatusPanelHandler").close().then(this._battleUI.SummonPanelGroup.open.bind(this._battleUI.SummonPanelGroup)))},enableDarkenFilter:function(e){this._widget.color=e?t.BATTLE_UI_DARKEN_FILTER_COLOR:n.color(255,255,255,255)},updateTurn:function(e,t){e===this.SUMMON_MAIN_INDEX?this._enableMainLabelDarkenFilter(t):e===this.SUMMON_SUPPORT_INDEX&&this._enableSupportLabelDarkenFilter(t);var n=this.panelList[e];null!=n&&n.updateTurn(t)},_enableMainLabelDarkenFilter:function(e){this._widget.seekWidgetByName(this.MAIN_LABEL_NAME).color=e?t.BATTLE_UI_DARKEN_FILTER_COLOR:n.color(255,255,255,255)},_enableSupportLabelDarkenFilter:function(e){this._widget.seekWidgetByName(this.SUPPORT_LABEL_NAME).color=e?t.BATTLE_UI_DARKEN_FILTER_COLOR:n.color(255,255,255,255)},setEnabled:function(e){this.enableDarkenFilter(!e),this._widget.setEnabled(e)},setBroken:function(e){this._widget.seekWidgetByName(this.BAN_WIDGET_NAME).setVisible(e);var n=e?this._showSummonBrokenPopup:this.onPushTouchPanel;this._touchPanel.addTouchEventListener(n,this),this._touchPanel.ignoreShrinkEffect=!0,this._touchPanel.setSound(e?t.SoundList.BUTTON_TOUCHED_CANCEL:t.SoundList.BUTTON_TOUCHED_DECIDE)},_showSummonBrokenPopup:function(e,n){n===ccui.Widget.TOUCH_ENDED&&(this._battleUI.setTouchEnabled(!1),t.createInstance("summonBrokenPopup").open().then(this._battleUI.setTouchEnabled.bind(this._battleUI,!0)))}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e.ccui,a=e.console;t.SummonCard=n.Class.extend({className:"KHSummonCard",DARKEN_FILTER_COLOR:n.color("#303030"),CARD_NAME:"corecard_summon",ELEMENT_NAME:"icon_element",TURN_LABEL_NAME:"turn_label",init:function(e){return this._card=e.seekWidgetByName(this.CARD_NAME),this._element=e.seekWidgetByName(this.ELEMENT_NAME),this._turnLabel=e.seekWidgetByName(this.TURN_LABEL_NAME),this.setVisible(!1),this},initCardTouchEvent:function(e,n){this.addTouchEventListener(e,n),this.setTouchEnabled(!0),this.setSound(t.SoundList.BUTTON_TOUCHED_DECIDE)},addTouchEventListener:function(e,t){this._card.addTouchEventListener(e,t)},setTouchEnabled:function(e){this._card.setTouchEnabled(e)},setSound:function(e){this._card.setSound(e)},setTexture:function(e){var n=e.element_type,o=e.id,r=e.skin;if(null==n&&(a.warn("KHSummonPanel._updateTexture: summon element_type data not properly received, defaulting to 0"),n=0),null!=o){null==r&&(a.warn("KHSummonPanel._updateTexture: summon skin data not properly received, defaulting to 0"),r=0);var s=t.generateSummonCardPath(o,r);this._card.loadTexture(s.png||s.jpg,i.Widget.LOCAL_TEXTURE),this._card.setVisible(!0),this._element.loadTexture("battle/res/battle_ui/elementicon_"+n+".png",i.Widget.PLIST_TEXTURE),this._element.setVisible(!0)}else a.warn("KHSummonPanel._updateTexture: summon id data not properly received")},setVisible:function(e){this._card.setVisible(e),this._element.setVisible(e),this._turnLabel.setVisible(e)},updateTurn:function(e){return e<=0?void this._turnLabel.setVisible(!1):(this._turnLabel.string="t"+e,void this._turnLabel.setVisible(this._turnNumberEnabled))},setTurnNumberEnabled:function(e){this._turnNumberEnabled=e},enableDarkenFilter:function(e){this._card.color=e?this.DARKEN_FILTER_COLOR:n.color(255,255,255,255),this._element.color=e?t.BATTLE_UI_DARKEN_FILTER_COLOR:n.color(255,255,255,255)},setUsable:function(e){this.enableDarkenFilter(!e),this.setSound(e?t.SoundList.BUTTON_TOUCHED_DECIDE:t.SoundList.BUTTON_TOUCHED_CANCEL)}})}((this||0).self||global),function(e){var t=e.kh;t.StampButton=t.UIPartAbstract.extend({className:"KHStampButton",WIDGET_NAME:"btn_stamp",init:function(e){return this._battleUI=e,this._widget=e.getWidgetByName(this.WIDGET_NAME),this._widget.addTouchEventListener(this._onTouchEvent,this),this._widget.setSoundEnabled(!0),this._widget.setTouchEnabled(!0),this._widget.setSound(t.SoundList.BUTTON_TOUCHED_DECIDE),this.setVisible(!0),this},_onTouchEvent:function(e,n){if(n===ccui.Widget.TOUCH_ENDED){var i=t.createInstance("stampPopupFactory").create({});i.open(),i.loadStampList()}}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;t.SUMMON_PANEL_NUM=7,t.SummonPanelGroup=n.Class.extend({className:"KHSummonPanelGroup",ACTION_NAMES:{SUMMON_OPEN:"summon_open",SUMMON_CLOSE:"summon_close"},UI_CLOSE_NAME:"btn_close",panelList:[],_widget:null,ctor:function(e,n){this._battleUI=e,this._widget=e.getWidgetByName(n),this._initPanel(),this._touchPanel=ccui.helper.seekWidgetByName(this._widget,this.UI_CLOSE_NAME),this._touchPanel.setTouchEnabled(!0),this._touchPanel.addTouchEventListener(this._closeButtonCallback,this),this._touchPanel.setSoundEnabled(!0),this._touchPanel.setSound(t.SoundList.BUTTON_TOUCHED_CANCEL),this._opened=!1},_initPanel:function(){var e=this._widget;this.panelList=i.map(i.range(t.SUMMON_PANEL_NUM),function(n){var i=t.createInstance("SummonPanel",[e,n]);return i.setTurnNumberEnabled(!0),i})},enableDarkenFilter:function(e){this._widget.color=e?t.BATTLE_UI_DARKEN_FILTER_COLOR:n.color(255,255,255,255)},setEnabled:function(e){this._widget.setEnabled(e)},_closeButtonCallback:function(e,t){t===ccui.Widget.TOUCH_ENDED&&this._opened&&this.close()},open:function(){this._setOpen(!0)},close:function(){this._setOpen(!1)},isOpened:function(){return this._opened},_setOpen:function(e){this.isOpened()!==e&&(this._opened=e,i.each(t.createInstance("battleWorld").enemyStatusBarList,function(t){null==t||i.isEmpty(t)||t.setEnabled(!e)}),this._battleUI.playAction(this.ACTION_NAMES[e?"SUMMON_OPEN":"SUMMON_CLOSE"]),i.each(i.range(5),function(t){this._battleUI.getWidgetByName("battlecard_chara_ui_"+t).setEnabled(!e)},this),this._battleUI.getWidgetByName("btn_heal").setEnabled(!e),this._battleUI.getWidgetByName("btn_burst").setEnabled(!e),e||t.createInstance("summonPopup").popup.dismiss())}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.ccui;t.SummonPanel=n.Class.extend({className:"KHSummonPanel",UI_NAME_PREFIX:"battlecard_summon_ui_",ctor:function(e,i){this.index=i;var o=a.helper.seekWidgetByName(e,this.UI_NAME_PREFIX+i);this._card=t.createInstance("SummonCard").init(o),this._card.initCardTouchEvent(this.pushPanel,this),this._eventPrefix=t.EVENT_PREFIX.SUMMON[i],n.eventManager.addCustomListener(this._eventPrefix+t.Summon.EVENT_NAME.CHANGE_ATTR,this._changeAttr.bind(this)),this._popup=t.createInstance("summonPopup")},_changeAttr:function(e){var t=e.getUserData();return this._summonData=t,null==t.id||null==t.skin?void this.setVisible(!1):(this.setVisible(!0),void this._updateTexture(t))},_updateTexture:function(e){this._card.setTexture(e)},setVisible:function(e){this._card.setVisible(e)},pushPanel:function(e,o){if(o===a.Widget.TOUCH_ENDED){var r=this.isUsable(),s=this.ban||!1,c=this.turn,u=this.index;this._popup.open(i.assign(this._summonData,{ready:r,ban:s,turn:c,index:u})).then(function(){n.eventManager.dispatchCustomEvent(t.EVENT_NAME.SUMMON_ANIMATION.REQUEST_PLAY,u)}.bind(this))}},updateTurn:function(e){this.turn=e,this._card.updateTurn(e),this._card.setUsable(this.isUsable())},setTurnNumberEnabled:function(e){this._card.setTurnNumberEnabled(e)},setBanned:function(e){this.ban=e,this._card.setUsable(this.isUsable())},setLocked:function(e){this.locked=e,this._card.setUsable(this.isUsable())},isUsable:function(){return!this.ban&&!this.locked&&0===this.turn}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.ccui,o=e.console;t.CharacterPanel=n.Class.extend({className:"KHCharacterPanel",ctor:function(e,n,i,a){this._battleUI=e,this._pos=a,this._slot=e.getWidgetByName(n),this._card=t.createInstance("CharacterCard").init(this._slot.seekWidgetByName(t.CHARACTER_PANEL_BASE)),this._card.addTouchEventListener(this.onPushEvent,this),this._card.setSoundEnabled(!1),this._initStatusPanel(i),this.enableDarkenFilter(!0),this.setVisible(!1)},insertData:function(e){return null==e?void o.warn("kh.CharacterCard.insertData: no data found"):(this._avatarData=e,this._card.insertData(e),void this._statusPanel.insertData(e))},changePosition:function(e){e!==this._pos&&null!=e&&(this._pos=e,this._slot=this._battleUI.getWidgetByName(t.Initializer.BattleUIInitializer.prototype.UI_OBJECT_NAMES.CharacterPanelList[e]),this._card.removeFromParent(!1),this._card.appendTo(this._slot),this._statusPanel.changePosition(e))},getPosition:function(){return this._pos},enable:function(){this.setVisible(!0),this._statusPanel.enable()},disable:function(){this.setVisible(!1),this.clearAbilityIcons(),this.clearAbilityTurns(),this.clearAllStatusEffects(),this._statusPanel.disable()},setTouchEnabled:function(e){this._statusPanel.setTouchEnabled(e),this._enableCard(e)},cleanUp:function(){this.clearAbilityIcons(),this.clearAllStatusEffects(),this._statusPanel.cleanUp()},setVisible:function(e){this._card.setVisible(e)},onPushEvent:function(e,t){if(t===a.Widget.TOUCH_ENDED){this._statusPanel.open(),this._battleUI.AttackButton.addOnTouchCallback(this._statusPanel.close,this._statusPanel);var n=function(){this._battleUI.AttackButton.removeOnTouchCallback(this._statusPanel.close),this._statusPanel.removeOnCloseCallback(n)};this._statusPanel.addOnCloseCallback(n,this)}},isOpened:function(){return this._statusPanel.isOpened()},adjustHP:function(){this._statusPanel.isOpened()?(this._statusPanel.updateHPGauge(),this._card.updateHPValue()):(this._card.updateHPGauge(),this._statusPanel.updateHPValue())},updateBurstGauge:function(){this._statusPanel.isOpened()?(this._statusPanel.updateBurstGauge(),this._card.updateBurstValue()):(this._card.updateBurstGauge(),this._statusPanel.updateBurstValue())},addOnStatusPanelShowCallback:function(e,t){return this._statusPanel.addOnShowCallback(e,t)},removeOnStatusPanelShowCallback:function(e){this._statusPanel.removeOnShowCallback(e)},clearOnStatusPanelShowCallbacks:function(){this._statusPanel.clearOnShowCallbacks()},_initStatusPanel:function(e){this._statusPanel=t.createInstance("CharacterStatusPanel",[this._battleUI,e,this._pos]).init()},_setUiArrayList:function(e,t){for(var n=[],i=t.COUNT,o=0;o<i;o++)n[o]=a.helper.seekWidgetByName(e,t.NAME+o),n[o].iconIndex=o,n[o].setVisible(!1);return n},_initStatusEffectIconHandler:function(e,n){var a=this._setUiArrayList(e,n),o=i.map(a,function(e,n){return t.createInstance("StatusEffectIcon").init(e,n)},this);return t.createInstance("StatusEffectIconHandler").init(o)},enableStatusPanel:function(){this._statusPanel.enable()},enableDarkenFilter:function(e){this._card.enableDarkenFilter(e)},initAbilityIcon:function(e,t){this._card.initAbilityIcon(e,t),this._statusPanel.initAbilityIcon(e,t)},removeAbilityIcon:function(e){this._card.removeAbilityIcon(e),this._statusPanel.removeAbilityIcon(e)},clearAbilityIcons:function(){this._card.clearAbilityIcons(),this._statusPanel.clearAbilityIcons()},clearAbilityTurns:function(){this._statusPanel.clearAbilityTurns()},updateAbilityTurn:function(e,t,n){this._card.updateAbilityTurn(e,t,n),this._statusPanel.updateAbilityTurn(e,t,n)},setAbilityBanned:function(e,t,n){this._card.setAbilityBanned(e,t,n),this._statusPanel.setAbilityBanned(e,t,n)},updateAbilityCondition:function(e,t){this._card.updateAbilityCondition(e,t),this._statusPanel.updateAbilityCondition(e,t)},updateAbilityDarkenFilter:function(e,t){this._statusPanel.updateAbilityDarkenFilter(e,t)},setBurstBanned:function(e){this._card.setBurstBanned(e),this._statusPanel.setBurstBanned(e)},updateStatusEffect:function(e,t){var n=this._card.statusEffectIconHandler.getStatusEffectsByIdLength(e.getId()),i=t.length;if(n!==i){for(;i>n;)this.pushStatusEffect(e),n++;for(;n>i;)this.removeStatusEffect(e),n--}},pushStatusEffect:function(e){this._card.pushStatusEffect(e),this._statusPanel.pushStatusEffect(e)},removeStatusEffect:function(e){this._card.removeStatusEffect(e),this._statusPanel.removeStatusEffect(e)},clearAllStatusEffects:function(){this._card.clearAllStatusEffects(),this._statusPanel.clearAllStatusEffects()},_enableCard:function(e){this._card.setTouchEnabled(e)},cleanup:function(){this._card=null,this._statusPanel=null}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.ccui,o=e.console;t.CHARACTER_PANEL_STATUS_ICONS={COUNT:8,NAME:"status_"},t.CHARACTER_PANEL_ABILITY_ICONS={COUNT:4,NAME:"ability_diamond_"},t.CHARACTER_PANEL_HP={NUMBER:"hp_no",GAUGE:"gauge_hp"},t.CHARACTER_PANEL_BURST={NUMBER:"burst_no",GAUGE:"gauge_burst",GAUGE2:"gauge_second_burst",BAN:"burst_disabled"},t.CHARACTER_PANEL_BAR_ANIMATION_DURATION=.1,t.CHARACTER_PANEL_BASE="btn_battlecard",t.CHARACTER_PANEL_ELEMENT="element",t.CharacterCard=n.Class.extend({className:"KHCharacterCard",ABILITY_ICON_RESOURCE_NAMES:{black:"battle/res/battle_ui/battlecard-ability_0.png",yellow:"battle/res/battle_ui/battlecard-ability_1.png",green:"battle/res/battle_ui/battlecard-ability_2.png",red:"battle/res/battle_ui/battlecard-ability_3.png",blue:"battle/res/battle_ui/battlecard-ability_4.png"},ELEMENT_ICON_RESOURCE_NAME:{PREFIX:"battle/res/battle_ui/battlecard-element_",SUFFIX:".png"},BURST_GAUGE_ANIMATION_NAMES:{DEFAULT:"default_view",BRIGHTEN:"gauge_burst_max"},init:function(e){return this._widget=e,this._widget.ignoreShrinkEffect=!0,this._widget.setSound(t.SoundList.BUTTON_TOUCHED_DECIDE),this._initAction(e),this._initElements(),this._abilityBanInfo={},this},appendTo:function(e,t){this._widget.appendTo(e,t)},removeFromParent:function(e){this._widget.removeFromParent(e)},setVisible:function(e){this._widget.setVisible(e)},addTouchEventListener:function(e,t){this._widget.addTouchEventListener(e,t)},setTouchEnabled:function(e){this._widget.setTouchEnabled(e)},setSoundEnabled:function(e){this._widget.setSoundEnabled(e)},enableDarkenFilter:function(e){this._widget.color=e?t.BATTLE_UI_DARKEN_FILTER_COLOR:n.color(255,255,255,255)},updateHPGauge:function(){this._adjustBar(this.hpBar,"percent",this.hpPercent,t.CHARACTER_PANEL_BAR_ANIMATION_DURATION,""),this._adjustNumber(this.hpNumber,"string",this.hp,t.CHARACTER_PANEL_BAR_ANIMATION_DURATION,"")},updateBurstGauge:function(){var e=this.burstBar.percent;this._updateBurstGaugeBrightenedState(),this._adjustBar(this.burstBar,"percent",Math.min(this.burst,100),t.CHARACTER_PANEL_BAR_ANIMATION_DURATION,"").then(function(){if(this._updateBurstGaugeBrightenedState(),e<100&&this.burstBar.percent>=100){var n=t.generateGenericSoundPath(t.BattleGenericSeIdList.burstMax).mp3;t.createInstance("soundPlayer").playSoundEffect(n)}}.bind(this)),this._adjustBar(this.burstBar2,"percent",this.burst-100,t.CHARACTER_PANEL_BAR_ANIMATION_DURATION,""),this._adjustNumber(this.burstNumber,"string",this.burst,t.CHARACTER_PANEL_BAR_ANIMATION_DURATION,"")},_updateBurstGaugeBrightenedState:function(){this.burst>=100&&this.burstBar.percent>=100&&!this._burstGaugeIsBrightened&&this.brightenBurstGauge(),this.burst>=100&&this.burstBar.percent>=100||!this._burstGaugeIsBrightened||this.darkenBurstGauge()},_adjustBar:function(e,t,n,i,a){return e.adjustPropertyByTweenAction(t,n,i,a)},_adjustNumber:function(e,t,n,i,a){e.adjustPropertyByTweenAction(t,n,i,a)},_initElements:function(){this.abilityIcons=[],this.statusEffectIconHandler=this._initStatusEffectIconHandler(this._widget,t.CHARACTER_PANEL_STATUS_ICONS),this.abilityIcons=this._setUiArrayList(this._widget,t.CHARACTER_PANEL_ABILITY_ICONS),this.abilityIconColors=[],this.hpBar=a.helper.seekWidgetByName(this._widget,t.CHARACTER_PANEL_HP.GAUGE),this.hpNumber=a.helper.seekWidgetByName(this._widget,t.CHARACTER_PANEL_HP.NUMBER),this.burstBar=a.helper.seekWidgetByName(this._widget,t.CHARACTER_PANEL_BURST.GAUGE),this.burstBar2=a.helper.seekWidgetByName(this._widget,t.CHARACTER_PANEL_BURST.GAUGE2),this.burstNumber=a.helper.seekWidgetByName(this._widget,t.CHARACTER_PANEL_BURST.NUMBER),this.element=a.helper.seekWidgetByName(this._widget,t.CHARACTER_PANEL_ELEMENT)},_initAction:function(e){var t=e.getParent();this._action=t.getActionByTag(t.tag)},_setUiArrayList:function(e,t){return i.map(i.range(t.COUNT),function(n){var i=e.seekWidgetByName(t.NAME+n);return i.setVisible(!1),i})},_initStatusEffectIconHandler:function(e,n){var a=this._setUiArrayList(e,n),o=i.map(a,function(e,n){return t.createInstance("StatusEffectIcon").init(e,n)},this);return t.createInstance("StatusEffectIconHandler").init(o,"member")},insertData:function(e){return null==e?void o.warn("kh.CharacterCard.insertData: no data found"):(this._avatarData=e,this._defineProperties(),this.updateHPValue(),this.updateBurstValue(),this.updateBurstBanned(),this.initPortrait(),void this.initElement())},_defineProperties:function(){var e=this._avatarData;Object.defineProperties(this,{hp:{get:function(){return e.hp},configurable:!0},hpPercent:{get:function(){return e.hp/(e.hpmax||e.max_hp||0)*100},configurable:!0},burst:{get:function(){return e.burst||0},configurable:!0},isJob:{get:function(){return e.is_job},configurable:!0},id:{get:function(){return e.id},configurable:!0},skin:{get:function(){return e.skin},configurable:!0},elementType:{get:function(){return e.element_type},configurable:!0},isBurstBanned:{get:function(){return!!e.is_burst_banned},configurable:!0}})},updateHPValue:function(){this.hpBar.percent=this.hpPercent,this.hpNumber.string=this.hp.toString()},updateBurstValue:function(){this.burstBar.percent=this.burst,this.burstBar2.percent=this.burst-100,this.burstNumber.string=this.burst.toString(),this._updateBurstGaugeBrightenedState()},updateBurstBanned:function(){this.setBurstBanned(this.isBurstBanned)},initPortrait:function(){var e=t.generateAvatarCardPath(this.id,this.isJob,this.skin);this._widget.loadTextureNormal(e.png||e.jpg,a.Widget.LOCAL_TEXTURE),this._widget.loadTexturePressed(e.png||e.jpg,a.Widget.LOCAL_TEXTURE)},initElement:function(){this.element.loadTexture(this.ELEMENT_ICON_RESOURCE_NAME.PREFIX+this.elementType+this.ELEMENT_ICON_RESOURCE_NAME.SUFFIX,a.Widget.PLIST_TEXTURE)},initAbilityIcon:function(e,t){var n=this.abilityIcons[t],i=this.ABILITY_ICON_RESOURCE_NAMES[e.is_banned?"black":e.color];n.loadTexture(i,a.Widget.PLIST_TEXTURE),this.abilityIconColors[t]=e.color,n.setVisible(!0)},removeAbilityIcon:function(e){this.abilityIcons[e].setVisible(!1)},clearAbilityIcons:function(){i.each(i.range(this.abilityIcons.length),function(e){this.removeAbilityIcon(e)},this)},updateAbilityTurn:function(e,t,n){var i=n?this.abilityIconColors[t]:"black",o=this.ABILITY_ICON_RESOURCE_NAMES[i];this.abilityIcons[t].loadTexture(o,a.Widget.PLIST_TEXTURE)},setAbilityBanned:function(e,t,n){var i=this.ABILITY_ICON_RESOURCE_NAMES[n?this.abilityIconColors[t]:"black"];this.abilityIcons[t].loadTexture(i,a.Widget.PLIST_TEXTURE)},updateAbilityCondition:function(e,t){var n=this.ABILITY_ICON_RESOURCE_NAMES[t?this.abilityIconColors[e]:"black"];this.abilityIcons[e].loadTexture(n,a.Widget.PLIST_TEXTURE)},setBurstBanned:function(e){this._widget.seekWidgetByName(t.CHARACTER_PANEL_BURST.BAN).setVisible(e);var i=e?t.BATTLE_UI_DARKEN_FILTER_COLOR:n.color(255,255,255,255);this._widget.seekWidgetByName(t.CHARACTER_PANEL_BURST.GAUGE).color=i,this._widget.seekWidgetByName(t.CHARACTER_PANEL_BURST.GAUGE2).color=i},pushStatusEffect:function(e){this.statusEffectIconHandler.pushStatusEffect(e),this.statusEffectIconHandler.draw()},removeStatusEffect:function(e){this.statusEffectIconHandler.removeStatusEffect(e),this.statusEffectIconHandler.draw()},clearAllStatusEffects:function(){this.statusEffectIconHandler.clearAllStatusEffects()},getStatusEffectCount:function(){return this.statusEffectIconHandler.getAllStatusEffects().length},brightenBurstGauge:function(){var e=this._action.animationInfo[this.BURST_GAUGE_ANIMATION_NAMES.BRIGHTEN];this._action.gotoFrameAndPlay(e.startIndex,e.endIndex,!1),this._burstGaugeIsBrightened=!0},darkenBurstGauge:function(){var e=this._action.animationInfo[this.BURST_GAUGE_ANIMATION_NAMES.DEFAULT];this._action.gotoFrameAndPlay(e.startIndex,e.endIndex,!1),this._burstGaugeIsBrightened=!1},cleanup:function(){this._widget.addTouchEventListener(null,null)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e.ccs,a=e.ccui,o=e.res;e.console,t.CHARACTER_PANEL_STATUS_SCREEN_CARD="battlecard_chara_ui",t.CHARACTER_PANEL_STATUS_SCREEN_BURST={NAME:"burst_label",DESCRIPTION:"burst_detail_label"},t.CHARACTER_PANEL_STATUS_SCREEN_ABILITY_ICONS={COUNT:4,NAME:t.env.isSp?"abilityicon_ui_":"ability_ui_"},t.CHARACTER_PANEL_STATUS_SCREEN_ABILITY_TURN_NUMBERS={COUNT:4,NAME:"turn_label_"},t.CHARACTER_PANEL_STATUS_SCREEN_ABILITY_BAN="banfilter_ability",t.CharacterStatusPanel=n.Class.extend({className:"KHCharacterStatusPanel",ctor:function(e,t,n){this._battleUI=e,this._widget=i.load(o.battle_ui_status_panel).node,this._index=n,this._abilityButtonCallback=t,this._isOpen=!1,this._onShowEventListeners=[]},init:function(){return this._card=t.createInstance("CharacterCard").init(this._widget.seekWidgetByName(t.CHARACTER_PANEL_BASE)),this._card.addTouchEventListener(this._showStatusEffectPopup,this),this._enableCard(!1),this._characterStatusPanelHandler=t.createInstance("characterStatusPanelHandler"),this._initElements(),this},insertData:function(e){this._avatarData=e,this._card.insertData(e),this._widget.seekWidgetByName(t.CHARACTER_PANEL_STATUS_SCREEN_BURST.NAME).string=e.burst_name||"",this._widget.seekWidgetByName(t.CHARACTER_PANEL_STATUS_SCREEN_BURST.DESCRIPTION).string=e.burst_description||""},changePosition:function(e){this._characterStatusPanelHandler.removeCharacterStatusPanel(this),this._index=e,this.enable()},enable:function(){this._characterStatusPanelHandler.insertCharacterStatusPanel(this,this._index)},disable:function(){this._characterStatusPanelHandler.removeCharacterStatusPanel(this)},setTouchEnabled:function(e){_.each(this._abilityIcons,function(t){var n=e&&t.isVisible();t.setTouchEnabled(n),t.setSoundEnabled(n);var i=t.seekWidgetByName("coreimg_abilityicon");i.setTouchEnabled(n),i.setSoundEnabled(n)}),this._enableCard(e)},cleanUp:function(){this.disable(),this._widget.removeFromParent(),this._widget=null,this._characterStatusPanelHandler=null},open:function(){this._characterStatusPanelHandler.open(this._index),this.setOpened(!0)},close:function(){this._characterStatusPanelHandler.close(),this.setOpened(!1)},setOpened:function(e){this._isOpen=e,this._updateCharacterStandbyMotion()},isOpened:function(){return this._isOpen},addOnCloseCallback:function(e,t){this._characterStatusPanelHandler.addOnCloseCallback(e,t)},removeOnCloseCallback:function(e){this._characterStatusPanelHandler.removeOnCloseCallback(e)},clearOnCloseCallbacks:function(){this._characterStatusPanelHandler.clearOnCloseCallbacks()},addOnOpenCallback:function(e,t){this._characterStatusPanelHandler.addOnOpenCallback(e,t)},removeOnOpenCallback:function(e){this._characterStatusPanelHandler.removeOnOpenCallback(e)},clearOnOpenCallbacks:function(){this._characterStatusPanelHandler.clearOnOpenCallbacks()},addOnShowCallback:function(e,t){var n=this._characterStatusPanelHandler.addOnShowCallback(function(n){n===this&&e.call(t,this,this._index)},this);return this._onShowEventListeners.push(n),n},removeOnShowCallback:function(e){_.pull(this._onShowEventListeners,e),this._characterStatusPanelHandler.removeOnShowCallback(e)},clearOnShowCallbacks:function(){_(this._onShowEventListeners).uniq().each(this._characterStatusPanelHandler.removeOnShowCallback.bind(this._characterStatusPanelHandler)),this._onShowEventListeners=[]},pushStatusEffect:function(e){this._card.pushStatusEffect(e),this._enableCard(!0)},removeStatusEffect:function(e){this._card.removeStatusEffect(e),this._enableCard(!0)},clearAllStatusEffects:function(){this._card.clearAllStatusEffects(),this._enableCard(!1)},_enableCard:function(e){var t=!!this._card.getStatusEffectCount();this._card.setTouchEnabled(e&&t),this._card.setSoundEnabled(e&&t)},initAbilityIcon:function(e,n){this._card.initAbilityIcon(e,n);var i=this._abilityIcons[n];i.setVisible(!0),i.setEnabled(!0);var a=t.createInstance("AbilityIcon",[i,e.type,e.color,!0]);a.show();var o=a.getIconNode();o.setUserData({characterIndex:this._index,iconIndex:n}),o.setVisible(!0),o.setEnabled(!0),o.setSoundEnabled(!0),o.addTouchEventListener(this._abilityButtonCallback),o.setSound(t.SoundList.BUTTON_TOUCHED_DECIDE),this.setAbilityBanned(e.is_banned,n)},removeAbilityIcon:function(e){var t=this._abilityIcons[e];t.setVisible(!1),t.setEnabled(!1),t.setSoundEnabled(!1),t.setUserData(null),this._card.removeAbilityIcon(e)},clearAbilityIcons:function(){_.each(this._abilityIcons,function(e,t){this.removeAbilityIcon(t)},this)},clearAbilityTurns:function(){_.invoke(this._turnNumbers,"setVisible",!1)},updateAbilityTurn:function(e,t,n){this._card.updateAbilityTurn(e,t,n);var i=this._turnNumbers[t];i.setVisible(!!e),i.string="Turn "+e,this._updateAbilityDarkenFilter(t,n),this._updateOnAbilityTouchSound(t,n)},setAbilityBanned:function(e,n,i){this._card.setAbilityBanned(e,n,i),this._abilityIcons[n].seekWidgetByName(t.CHARACTER_PANEL_STATUS_SCREEN_ABILITY_BAN).setVisible(e),this._updateAbilityDarkenFilter(n,i),this._updateOnAbilityTouchSound(n,i)},updateAbilityCondition:function(e,t){this._card.updateAbilityCondition(e,t),this._updateAbilityDarkenFilter(e,t),this._updateOnAbilityTouchSound(e,t)},setBurstBanned:function(e){this._card.setBurstBanned(e)},getWidget:function(){return this._widget},updateHPGauge:function(){this._card.updateHPGauge()},updateBurstGauge:function(){this._card.updateBurstGauge()},updateHPValue:function(){this._card.updateHPValue()},updateBurstValue:function(){this._card.updateBurstValue()},updateAbilityDarkenFilter:function(e,t){this._updateAbilityDarkenFilter(e,t)},_updateAbilityDarkenFilter:function(e,i){null!=this._abilityIcons[e]&&(this._abilityIcons[e].color=i?n.color(255,255,255,255):t.BATTLE_UI_DARKEN_FILTER_COLOR)},_updateOnAbilityTouchSound:function(e,n){null!=this._abilityIcons[e]&&this._abilityIcons[e].setSound(n?t.SoundList.BUTTON_TOUCHED_DECIDE:t.SoundList.BUTTON_TOUCHED_CANCEL)},_showStatusEffectPopup:function(e,i){if(i===a.Widget.TOUCH_ENDED){var o=n.director.getRunningScene();t.ImplantedPopup.createOrGet(o,"a_q_001_status","AQ001StatusPopup").open({name:t.createInstance("battleWorld").characterList[this._index].name,pos:this._index,from:"character"},this._card.statusEffectIconHandler.getAllStatusEffects())}},_initElements:function(){this._abilityIcons=this._setUiArrayList(this._widget,t.CHARACTER_PANEL_STATUS_SCREEN_ABILITY_ICONS),this._turnNumbers=this._setUiArrayList(this._widget,t.CHARACTER_PANEL_STATUS_SCREEN_ABILITY_TURN_NUMBERS)},_setUiArrayList:function(e,t){return _.map(_.range(t.COUNT),function(n){var i=e.seekWidgetByName(t.NAME+n);return i.setVisible(!1),i})},_updateCharacterStandbyMotion:function(){var e=t.createInstance("battleWorld").characterList[this._index];_.isEmpty(e)||e.updateDefaultAnimation()}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.ccui;t.CharacterStatusPanelHandler=n.Class.extend({className:"KHCharacterStatusPanelHandler",ACTION_NAMES:{PANEL_OPEN:"skill_open",PANEL_CLOSE:"skill_close"},PAGEVIEW_PARENT_NAME:"battle_status_page",PAGE_CONTROL_BASE:"status_base",PAGE_CONTROLS:i.invert({btn_page_down:t.PAGE_CONTROLLER_CONTROLS.NEXT_BUTTON,btn_page_up:t.PAGE_CONTROLLER_CONTROLS.PREVIOUS_BUTTON}),BACK_BUTTON:"btn_back",init:function(e){return this._open=!1,this._statusPanelList={},this._onOpenCallbacks=[],this._onCloseCallbacks=[],this._onShowCallbacks=[],this._battleUI=e,this._pageViewParent=e.getWidgetByName(this.PAGEVIEW_PARENT_NAME),this._pageControlWidget=e.getWidgetByName(this.PAGE_CONTROL_BASE),this._pageViewParent.removeAllChildren(),this._pageViewParent.setVisible(!0),this._pageView=null,this.addOnOpenCallback(this._initOnOpen,this),e.getWidgetByName(this.BACK_BUTTON).addTouchEventListener(this._onTouchBackButtonCallback,this),e.getWidgetByName(this.BACK_BUTTON).setSound(t.SoundList.BUTTON_TOUCHED_CANCEL),this},_initOnOpen:function(){this._pageView=this._initPageView(),this._initPageController(),this.removeOnOpenCallback(this._initOnOpen)},insertCharacterStatusPanel:function(e,t){if(null!=this._statusPanelList[t]&&null!=this._pageView){var n=this._getCompactStatusPanelList().indexOf(this._statusPanelList[t]);this._pageView.removePageByIndex(n)}if(this._statusPanelList[t]=e,null!=this._pageView){var i=this._getCompactStatusPanelList().indexOf(e);this._pageView.addPage(e.getWidget(),i)}},removeCharacterStatusPanel:function(e){var t=this._getCompactStatusPanelList().indexOf(e);null!=this._pageView&&this._pageView.removePageByIndex(t),this._statusPanelList=i.omit(this._statusPanelList,function(t){return t===e})},open:function(e){if(this._open)return Q.resolve();this._fireOnOpenEvent(e),this._pageView.setEnabled(!0),this._pageView.setVisible(!0);var t=i.keys(i.omit(this._statusPanelList,i.isNull)).indexOf(e.toString());return this._pageView.gotoPageByIndex(t),this._open=!0,this._battleUI.playAndTrackAction(this.ACTION_NAMES.PANEL_OPEN)},close:function(){if(!this._open)return Q.resolve();this._fireOnCloseEvent();var e=this._getCompactStatusPanelList();return i.invoke(e,"setOpened",!1),this._pageView.setEnabled(!1),this._pageView.setVisible(!1),this._open=!1,this._battleUI.playAndTrackAction(this.ACTION_NAMES.PANEL_CLOSE)},addOnCloseCallback:function(e,t){this._onCloseCallbacks.push({callback:e,context:t})},removeOnCloseCallback:function(e){i.remove(this._onCloseCallbacks,function(t){return t.callback===e})},clearOnCloseCallbacks:function(){this._onCloseCallbacks=[]},_fireOnCloseEvent:function(){i.eachRight(this._onCloseCallbacks,function(e){e.callback.call(e.context)})},_onTouchBackButtonCallback:function(e,t){t===a.Widget.TOUCH_ENDED&&this.close()},_getCompactStatusPanelList:function(){return i.compact(i.values(this._statusPanelList))},addOnOpenCallback:function(e,t){this._onOpenCallbacks.push({callback:e,context:t})},removeOnOpenCallback:function(e){i.eachRight(this._onOpenCallbacks,function(t,n){e===t.callback&&this._onOpenCallbacks.splice(n,1)},this)},clearOnOpenCallbacks:function(){this._onOpenCallbacks=[]},addOnShowCallback:function(e,t){var n={callback:e,context:t};return this._onShowCallbacks.push(n),n},removeOnShowCallback:function(e){i.pull(this._onShowCallbacks,e)},clearOnShowCallbacks:function(){this._onShowCallbacks=[]},setEnabled:function(e){null!=this._pageView&&this._pageView.setEnabled(e)},_fireOnOpenEvent:function(e){i.each(this._onOpenCallbacks,function(t){t.callback.call(t.context,e)},this)},_initPageView:function(){var e=t.createInstance(t.PageView),n=i.invoke(this._getCompactStatusPanelList(),"getWidget");return e.initialize(n,this._onPageChangeCallback,this),e.setLoopContent(!0),this._pageViewParent.addChild(e),e},_initPageController:function(){t.createInstance("PageController").init(this._pageControlWidget,this.PAGE_CONTROLS,this._pageView)},_onPageChangeCallback:function(e,t){if(!this._pageView||this._pageView.isVisible()){var n=t-1,a=this._getCompactStatusPanelList();i.invoke(a,"setOpened",!1),a[n].setOpened(!0),this._fireOnShowEvent(a[n])}},_fireOnShowEvent:function(e){i.each(this._onShowCallbacks,function(t){t.callback.call(t.context,e)},this)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e.ccs,a=e.ccui,o=e._,r=e.console;t.ENEMY_STATUS_BAR_ANIMATION_DURATION=.08,t.ENEMY_HITBOXES=[n.size(300,400),n.size(250,250),n.size(150,175)],t.ENEMY_STATUS_BAR_JSONS=[res.battle_ui_enemy_hud_l_ui,res.battle_ui_enemy_hud_s_ui,res.battle_ui_enemy_hud_s_ui],t.ENEMY_STATUS_BAR_ELEMENT_NAMES={PORTRAIT:"iconene_enemy-looks",NAME_LABEL:"name_label",HP_GAUGE:"hp_gauge",STATUS_ICONS:{COUNT:8,NAME:"status_position_"},MODE_GAUGE_BASE:"mode_gauge_base",MODE_GAUGE:"mode_gauge",MODE_GAUGE_TEXT_STUN:"mode_text_0",MODE_GAUGE_TEXT_RAGING:"mode_text_1",CHARGE_TURN_DOTS:"charge_gauge_blank",CHARGE_TURN_ACTIVE_DOT:"charge_gauge",TOUCH_PANEL:"touch_panel",TARGET:"target_icon"},t.EnemyStatusBar=n.Node.extend({className:"KHEnemyStatusBar",CHARGE_TURN_ANIMATION_NAMES:{BLINK:"charge_gauge_max",DEFAULT:"default_view"},ctor:function(e,n,i,a){this.index=a,this._name=e.name,this._initBase(e,n,t.ENEMY_STATUS_BAR_POSITIONS[i-1][a]),this._loadPortrait(e.id),this._displayEnemyInfo(e.level,e.name),this._initModeGauge(e),this._initTargetAnimation(),this._hitbox=this._initHitbox(i,a),this._enabled=!1},changePosition:function(e){this.index=e;var n=t.createInstance("battleWorld").enemyList.length,i=t.ENEMY_STATUS_BAR_POSITIONS[n-1];this.ui.setPosition(i[e]),this._setHitboxPosition(n,this._hitbox,e)},untarget:function(){a.helper.seekWidgetByName(this.ui,t.ENEMY_STATUS_BAR_ELEMENT_NAMES.TARGET).setVisible(!1)},isTarget:function(){return a.helper.seekWidgetByName(this.ui,t.ENEMY_STATUS_BAR_ELEMENT_NAMES.TARGET).isVisible()},setEnabled:function(e){this._enabled=e,null!=this._hitbox&&this._hitbox.setEnabled(e)},isEnabled:function(){return this._enabled},cleanUp:function(){this._hitbox.removeFromParent(),this._hitbox=null,this.ui.removeFromParent(),this.ui=null},adjustHitboxPosToAvatar:function(e){var t=this._hitbox;t.y=t.y+e.height*(.5-e.anchorY)},_initBase:function(e,n,o){var r=i.load(n);this.ui=r.node,this._action=r.action,this.ui.runAction(this._action),this._hpGauge=a.helper.seekWidgetByName(this.ui,t.ENEMY_STATUS_BAR_ELEMENT_NAMES.HP_GAUGE),this._hpGauge.percent=e.hp/e.hpmax*100,this._statusEffectIconHandler=this._initStatusEffectIconHandler(this.ui,t.ENEMY_STATUS_BAR_ELEMENT_NAMES.STATUS_ICONS),this._initTouchPanel(),this._chargeTurnDotsCount=0,this._chargeTurnDotsActiveCount=0,a.helper.seekWidgetByName(this.ui,t.ENEMY_STATUS_BAR_ELEMENT_NAMES.CHARGE_TURN_DOTS).setVisible(!1),a.helper.seekWidgetByName(this.ui,t.ENEMY_STATUS_BAR_ELEMENT_NAMES.CHARGE_TURN_ACTIVE_DOT).setVisible(!1),this.adjustMaxChargeTurnDots(e.max_charge_turn),this.adjustActiveChargeTurnDots(e.current_charge_turn),this.ui.setPosition(o)},_initTouchPanel:function(){var e=this.ui.seekWidgetByName(t.ENEMY_STATUS_BAR_ELEMENT_NAMES.TOUCH_PANEL);e.addTouchEventListener(this._showStatusEffectPopup,this),e.setSoundEnabled(!0),e.setSound(t.SoundList.BUTTON_TOUCHED_DECIDE),a.helper.seekWidgetByName(this.ui,t.ENEMY_STATUS_BAR_ELEMENT_NAMES.PORTRAIT).addTouchEventListener(this._targetEnemy,this)},_initModeGauge:function(e){if(this._changeMode(e.current_mode),this._modeGaugeBase=a.helper.seekWidgetByName(this.ui,t.ENEMY_STATUS_BAR_ELEMENT_NAMES.MODE_GAUGE_BASE),null!=this._modeGaugeBase&&(this._modeGaugeTextRaging=a.helper.seekWidgetByName(this.ui,t.ENEMY_STATUS_BAR_ELEMENT_NAMES.MODE_GAUGE_TEXT_RAGING),this._modeGaugeTextStun=a.helper.seekWidgetByName(this.ui,t.ENEMY_STATUS_BAR_ELEMENT_NAMES.MODE_GAUGE_TEXT_STUN),this._modeGaugeTextRaging.setVisible("raging"===e.current_mode),this._modeGaugeTextStun.setVisible("stun"===e.current_mode),this._modeGaugeBase.setVisible(e.has_mode_gauge),"stun"===e.current_mode?this.changeStunModeDots():this.changeNormalModeDots(),e.has_mode_gauge)){this._modeGauge=a.helper.seekWidgetByName(this.ui,t.ENEMY_STATUS_BAR_ELEMENT_NAMES.MODE_GAUGE);var n=0;o.isUndefined(e.mode_gauge_percent)||(n=e.mode_gauge_percent),this._modeGauge.percent=n}},_loadPortrait:function(e){var n=t.generateEnemyIconPath(e);a.helper.seekWidgetByName(this.ui,t.ENEMY_STATUS_BAR_ELEMENT_NAMES.PORTRAIT).loadTexture(n.png||n.jpg)},_displayEnemyInfo:function(e,n){a.helper.seekWidgetByName(this.ui,t.ENEMY_STATUS_BAR_ELEMENT_NAMES.NAME_LABEL).string="Lv"+e+" "+n},_initStatusEffectIconHandler:function(e,n){var i=this._seekWidgetsByListInfo(e,n),a=o.map(i,function(e,n){return t.createInstance("StatusEffectIcon").init(e,n)},this);return t.createInstance("StatusEffectIconHandler").init(a,"enemy")},_initHitbox:function(e,n){var i=new a.Widget;return i.name="enemy_hitbox_"+n,i.setSize(t.ENEMY_HITBOXES[e-1]),this._setHitboxPosition(e,i,n),t.createInstance("battleWorld").BattleLayer.addChild(i),i.addTouchEventListener(this._targetEnemy,this),i.setTouchEnabled(!0),i},_setHitboxPosition:function(e,i,a){i.setPosition(n.p(t.ENEMY_POSITION_LIST[e-1][a].x*n.winSize.width,t.ENEMY_POSITION_LIST[e-1][a].y*n.winSize.height))},_initTargetAnimation:function(){this._targetAnimation=t.createInstance("TargetAnimation")},_targetEnemy:function(e,n){if(n===a.Widget.TOUCH_ENDED&&this.isEnabled()){o.invoke(o.compact(t.createInstance("battleWorld").enemyStatusBarList),"untarget"),a.helper.seekWidgetByName(this.ui,t.ENEMY_STATUS_BAR_ELEMENT_NAMES.TARGET).setVisible(!0);var i=t.createInstance("battleWorld").enemyList[this.index];this._targetAnimation.play(i)}},_showStatusEffectPopup:function(e,i){if(i===a.Widget.TOUCH_ENDED&&this.isEnabled()){var o=this._statusEffectIconHandler.getAllStatusEffects();if(!(o.length<=0)){var r=n.director.getRunningScene();t.ImplantedPopup.createOrGet(r,"a_q_001_status","AQ001StatusPopup").open({name:this._name,pos:this.index,from:"enemy"},o)}}},appendTo:function(e){e.addChild(this.ui),this._onEnter()},adjustHP:function(e,n){this._hpGauge.adjustPropertyByTweenAction("percent",n,t.ENEMY_STATUS_BAR_ANIMATION_DURATION,"")},adjustActiveChargeTurnDots:function(e){this._adjustChargeTurnDots(e,"_chargeTurnDotsActive")},adjustMaxChargeTurnDots:function(e){this._adjustChargeTurnDots(e,"_chargeTurnDots")},_adjustChargeTurnDots:function(e,n){if(!o.isUndefined(e))if("_chargeTurnDots"===n)this._chargeTurnDotsCount=e,0==e?(a.helper.seekWidgetByName(this.ui,t.ENEMY_STATUS_BAR_ELEMENT_NAMES.CHARGE_TURN_DOTS).setVisible(!1),this._adjustChargeTurnDots(0,"_chargeTurnDotsActive")):(a.helper.seekWidgetByName(this.ui,t.ENEMY_STATUS_BAR_ELEMENT_NAMES.CHARGE_TURN_DOTS).setVisible(!0),a.helper.seekWidgetByName(this.ui,t.ENEMY_STATUS_BAR_ELEMENT_NAMES.CHARGE_TURN_DOTS).percent=e/8*100,e<this._chargeTurnDotsActiveCount&&this._adjustChargeTurnDots(e,"_chargeTurnDotsActive"),this._updateChargeTurnBlinkAnimation());else if(this._chargeTurnDotsActiveCount=e,0==e)a.helper.seekWidgetByName(this.ui,t.ENEMY_STATUS_BAR_ELEMENT_NAMES.CHARGE_TURN_ACTIVE_DOT).setVisible(!1);else if(0==this._chargeTurnDotsCount)this._chargeTurnDotsActiveCount=0,a.helper.seekWidgetByName(this.ui,t.ENEMY_STATUS_BAR_ELEMENT_NAMES.CHARGE_TURN_ACTIVE_DOT).setVisible(!1);else{if(a.helper.seekWidgetByName(this.ui,t.ENEMY_STATUS_BAR_ELEMENT_NAMES.CHARGE_TURN_ACTIVE_DOT).setVisible(!0),e>this._chargeTurnDotsCount)return void this._adjustChargeTurnDots(this._chargeTurnDotsCount,"_chargeTurnDotsActive");a.helper.seekWidgetByName(this.ui,t.ENEMY_STATUS_BAR_ELEMENT_NAMES.CHARGE_TURN_ACTIVE_DOT).percent=e/8*100,this._updateChargeTurnBlinkAnimation()}},_updateChargeTurnBlinkAnimation:function(){var e=this._chargeTurnDotsActiveCount===this._chargeTurnDotsCount&&"stun"!==this._mode,t=this._action.animationInfo[this.CHARGE_TURN_ANIMATION_NAMES[e?"BLINK":"DEFAULT"]];this._action.gotoFrameAndPlay(t.startIndex,t.endIndex,e)},changeNormalModeDots:function(){var e=this.ui.seekWidgetByName(t.ENEMY_STATUS_BAR_ELEMENT_NAMES.CHARGE_TURN_ACTIVE_DOT),n=e.percent;e.loadTexture("battle/res/battle_ui/battle_turn-gauge_s_0.png",a.Widget.PLIST_TEXTURE),e.percent=0,e.percent=n,this._changeMode("normal"),this._updateChargeTurnBlinkAnimation()},changeStunModeDots:function(){var e=this.ui.seekWidgetByName(t.ENEMY_STATUS_BAR_ELEMENT_NAMES.CHARGE_TURN_ACTIVE_DOT),n=e.percent;e.loadTexture("battle/res/battle_ui/battle_turn-gauge_s_1.png",a.Widget.PLIST_TEXTURE),e.percent=0,e.percent=n,this._changeMode("stun"),this._updateChargeTurnBlinkAnimation()},_changeMode:function(e){this._mode=e},adjustModeGauge:function(e){return null==this._modeGauge?void r.warn("KHEnemyStatusBar.adjustModeGauge: trying to adjust the mode gauge of an enemy without a mode gauge"):void this._modeGauge.adjustPropertyByTweenAction("percent",e,t.ENEMY_STATUS_BAR_ANIMATION_DURATION,"")},displayStunMode:function(e){return null==this._modeGaugeTextStun?void r.warn("KHEnemyStatusBar.displayStunMode: trying to adjust the mode of an enemy without a mode gauge"):void this._modeGaugeTextStun.setVisible(e)},displayRagingMode:function(e){return null==this._modeGaugeTextRaging?void r.warn("KHEnemyStatusBar.displayRagingMode: trying to adjust the mode of an enemy without a mode gauge"):void this._modeGaugeTextRaging.setVisible(e)},setVisible:function(e){this.ui.setVisible(e)},_seekWidgetsByListInfo:function(e,t){for(var n=[],i=t.COUNT,o=t.NAME,r=0;r<i;r++)n[r]=a.helper.seekWidgetByName(e,o+r);return n},_onEnter:function(){this._statusEffectIconHandler.draw()},pushStatusEffect:function(e){this._statusEffectIconHandler.pushStatusEffect(e),this._statusEffectIconHandler.draw()},updateStatusEffect:function(e,t){var n=this._statusEffectIconHandler.getStatusEffectsByIdLength(e.getId()),i=t.length;if(n!==i){for(;i>n;)this._statusEffectIconHandler.pushStatusEffect(e),n++;for(;n>i;)this._statusEffectIconHandler.removeStatusEffect(e),n--;this._statusEffectIconHandler.draw()}},removeStatusEffect:function(e){this._statusEffectIconHandler.removeStatusEffect(e),this._statusEffectIconHandler.draw()},getStatusEffects:function(){return this._statusEffectIconHandler.getAllStatusEffects()}})}((this||0).self||global),function(e){var t=e.kh;e.cc,t.AttributeDiagram=t.UIPartAbstract.extend({className:"KHAttributeDiagram",_widget:null,ctor:function(e,n){var i=e.getWidgetByName(n);this._widget=ccui.helper.seekWidgetByName(i,"diagram"),this.setEnabled(t.createInstance("playerGameConfig").getElementDiagramVisible())},setEnabled:function(e){this._enabled=e,e?null==this._widget.getParent()&&(this._parent.addChild(this._widget),this.setVisible(!0)):(this._parent=this._widget.getParent(),this._widget.removeFromParent())},isEnabled:function(){return this._enabled},setVisible:function(e){this._widget.setVisible(e)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.BATTLE_UI_HEADER_PRIZES={GOLD:0,SILVER:1,BRONZE:2},t.BattleUIHeader=n.Class.extend({className:"KHBattleUIHeader",ELEMENT_NAMES:{PRIZE_BASE:"header_prize_base",PRIZE_GOLD:"gold_no",PRIZE_SILVER:"silver_no",PRIZE_BRONZE:"bronze_no",BATTLE_COUNT:"header_text"},ctor:function(e,n){this._battleCount=1,this._prizeCounts=[],this._prizeCounts[t.BATTLE_UI_HEADER_PRIZES.GOLD]=0,this._prizeCounts[t.BATTLE_UI_HEADER_PRIZES.SILVER]=0,this._prizeCounts[t.BATTLE_UI_HEADER_PRIZES.BRONZE]=0,this._widget=e.getWidgetByName(n),this._battleCountWidget=ccui.helper.seekWidgetByName(this._widget,this.ELEMENT_NAMES.BATTLE_COUNT),this._prizeBase=ccui.helper.seekWidgetByName(this._widget,this.ELEMENT_NAMES.PRIZE_BASE),this._prizes=[],this._prizes[t.BATTLE_UI_HEADER_PRIZES.GOLD]=ccui.helper.seekWidgetByName(this._widget,this.ELEMENT_NAMES.PRIZE_GOLD),this._prizes[t.BATTLE_UI_HEADER_PRIZES.SILVER]=ccui.helper.seekWidgetByName(this._widget,this.ELEMENT_NAMES.PRIZE_SILVER),this._prizes[t.BATTLE_UI_HEADER_PRIZES.BRONZE]=ccui.helper.seekWidgetByName(this._widget,this.ELEMENT_NAMES.PRIZE_BRONZE),_.each(this._prizeCounts,this.setPrizeCount,this),this.setPrizeVisible(!1)},setPrizeVisible:function(e){this._prizeBase.setVisible(e)},getPrizeVisible:function(){return this._prizeBase.isVisible()},setBattleCountVisible:function(e){this._battleCountWidget.setVisible(e)},getBattleCountVisible:function(){return this._battleCountWidget.isVisible()},hideHeaderInfo:function(){this.setPrizeVisible(!1),this.setBattleCountVisible(!1)},setBattleCount:function(e,t){_.isUndefined(t)&&_.isUndefined(this._battleCountWidgetTotal)||(this._battleCountWidgetTotal=t||this._battleCountWidgetTotal,this._battleCountWidget.string="STAGE "+e+"/"+this._battleCountWidgetTotal)},setPrizeCount:function(e,t){null!=this._prizeCounts[t]&&null!=this._prizes[t]&&(this._prizeCounts[t]=e,this._prizes[t].string=e.toString())},incrementPrizeCount:function(e){null!=this._prizeCounts[e]&&(this._prizeCounts[e]++,this._prizes[e].string=this._prizeCounts[e].toString())},decrementPrizeCount:function(e){null!=this._prizeCounts[e]&&(this._prizeCounts[e]--,this._prizes[e].string=this._prizeCounts[e])},cleanUp:function(){this._widget=null,this._battleCountWidget=null,this._prizeBase=null,this._prizes=null},updateTreasureData:function(e){return 0===(e.golden_box||0+e.silver_box||0+e.wooden_box||0)?void this.setPrizeVisible(!1):(this.setPrizeCount(e.golden_box,t.BATTLE_UI_HEADER_PRIZES.GOLD),this.setPrizeCount(e.silver_box,t.BATTLE_UI_HEADER_PRIZES.SILVER),void this.setPrizeCount(e.wooden_box,t.BATTLE_UI_HEADER_PRIZES.BRONZE))}})}((this||0).self||global),function(e){var t=e.kh;t.BATTLE_UI_HEADER_PRIZES.RAINBOW=3,t.RaidBattleUIHeader=t.BattleUIHeader.extend({className:"KHRaidBattleUIHeader",ELEMENT_NAMES:_.assign(t.BattleUIHeader.prototype.ELEMENT_NAMES,{RAID_BASE:"raid_text_base",PARTICIPANTS:"join_member_label",TIME:"last_time_label",PRIZE_RAINBOW:""}),ctor:function(e,n){this._super(e,n),this._prizeCounts[t.BATTLE_UI_HEADER_PRIZES.RAINBOW]=0,this._prizes[t.BATTLE_UI_HEADER_PRIZES.RAINBOW]=this._widget.seekWidgetByName(this.ELEMENT_NAMES.PRIZE_RAINBOW),this.setPrizeCount(0,t.BATTLE_UI_HEADER_PRIZES.RAINBOW),this.setBattleCountVisible(!1),this.setRaidInfoVisible(!0)},setRaidInfoVisible:function(e){this._widget.seekWidgetByName(this.ELEMENT_NAMES.RAID_BASE).setVisible(e)},hideHeaderInfo:function(){t.BattleUIHeader.prototype.hideHeaderInfo.call(this),this.setRaidInfoVisible(!1)},updateTreasureData:function(e){t.BattleUIHeader.prototype.updateTreasureData.call(this,e),0!==(e.rainbow_box||0)&&this.setPrizeCount(e.rainbow_box,t.BATTLE_UI_HEADER_PRIZES.RAINBOW)},updateParticipantNumber:function(e,t){null!=t&&(this._maxParticipants=t),this._currentParticipants=Math.min(e,this._maxParticipants),this._widget.seekWidgetByName(this.ELEMENT_NAMES.PARTICIPANTS).string=this._currentParticipants+"/"+this._maxParticipants},incrementParticipantNumber:function(){this.updateParticipantNumber(this._currentParticipants+1,this._maxParticipants)},updateRemainingTime:function(e,t){this._startRemainingTime=e,this._timestamp=t,this._startCountDown()},cleanUp:function(){this._stopCountDown(),this._super()},_startCountDown:function(){this._tick(),this._widget.schedule(this._tick.bind(this),1)},_stopCountDown:function(){this._widget.unscheduleAllCallbacks()},_tick:function(){var e=Math.round(Date.now()/1e3)-this._timestamp,t=this._startRemainingTime-e;return t<=0?(this._updateRemainingTimeDisplay("0:00"),void this._stopCountDown()):void this._updateRemainingTimeDisplay(this._stringifySeconds(t))},_updateRemainingTimeDisplay:function(e){this._widget.seekWidgetByName(this.ELEMENT_NAMES.TIME).string=e},_stringifySeconds:function(e){var t=0,n=0,i=e;return i>=3600&&(t=Math.floor(i/3600),i%=3600),i>60&&(n=Math.floor(i/60),i%=60),(t?t+":"+_.padZero(n,2):n)+":"+_.padZero(i,2)},_onDispose:function(){this._widget&&(this.cleanUp(),this._widget=null)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.StatusEffectIcon=n.Class.extend({className:"KHStatusEffectIcon",init:function(e,t){return this._widget=e,this._index=t,this},draw:function(e){return this._statusEffect=e,null==e?(this._texture=null,void this._widget.setVisible(!1)):(this._texture=t.generateStatusIconPath(e.getType()),this._widget.setVisible(!0),void this._drawTexture())},_drawTexture:function(){null!=this._widget.loadTexture&&this._widget.loadTexture(this._texture.png||this._texture.jpg),null!=this._widget.loadTextureNormal&&this._widget.loadTextureNormal(this._texture.png||this._texture.jpg),null!=this._widget.loadTexturePressed&&this._widget.loadTexturePressed(this._texture.png||this._texture.jpg)},getCurrentStatusEffect:function(){return this._statusEffect},getIndex:function(){return this._index},setTouchEventListener:function(e,t){null!=this._widget.addTouchEventListener&&this._widget.addTouchEventListener(function(n,i){i===ccui.Widget.TOUCH_ENDED&&e.call(t)},t)},changeWidget:function(e){this._widget=e}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e.console;t.StatusEffectIconHandler=n.Class.extend({className:"KHStatusEffectIconHandler",TYPE_MEMBER:"member",TYPE_ENEMY:"enemy",MAX_GROUP_NUMBER:999999999,ctor:function(){this._iconViewList=[],this._statusEffectList=[]},init:function(e,t){return this._iconViewList=e,this._type=t,this._statusEffectList=[],this},draw:function(){var e=this._statusEffectList;this._iconViewList.forEach(function(t,n){t.draw(e[n])})},pushStatusEffect:function(e){if(null==e){var a="WARNING: KHStatusEffectIconHandler.pushStatusEffect: status effect not found on the battle world";return i.warn(a),t.createInstance("logger").reportBattleStatusEffects(n.director.getRunningScene().__instanceId,{status_effect_list:_.invoke(t.createInstance("battleWorld").statusEffectList,"getId")}),void t.createInstance("logger").reportJsException(a)}if(null!=e.getType()){this.removeStatusEffect(e);var o=this._findInsertIndex(e);return o>-1?void this._statusEffectList.splice(o,0,e):void this._statusEffectList.push(e)}},_findInsertIndex:function(e){var t=this.__getIconGroupNumber(e),n=this;return _.findIndex(this._statusEffectList,function(e){return n.__getIconGroupNumber(e)>t})},removeStatusEffect:function(e){_.pull(this._statusEffectList,e)},clearAllStatusEffects:function(){this._statusEffectList=[],this.draw()},getAllStatusEffects:function(){return _.clone(this._statusEffectList)},getStatusEffectsByIdLength:function(e){return _.filter(this.getAllStatusEffects(),function(t){return t.getId()===e}).length},setTouchEventListener:function(e,t){_.each(this._iconViewList,function(n){n.setTouchEventListener(e,t)})},changeIconWidgets:function(e){_.each(_.range(Math.min(this._iconViewList.length,e.length)),function(t){this._iconViewList[t].changeWidget(e[t])},this)},_getIconListLength:function(){return this._iconViewList.length},_getActiveIconsLength:function(){return this._statusEffectList.length},_getVisibleIconsLength:function(){return Math.min(this._getIconListLength(),this._getActiveIconsLength())},__getIconGroupNumber:function(e){return this._type===this.TYPE_ENEMY?e.getEnemyIconGroupNumber():e.getMemberIconGroupNumber()}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e.ccui,e.console,t.ResultWindow=n.Class.extend({className:"KHResultWindow",MAX_SHOW_MESSAGE_TIME:2e3,WIDGET_NAMES:{CATEGORY:"category_label",NAME:"name_label",EFFECT:"effect_label"},ctor:function(e,t){this._battleUI=e,this._widget=e.getWidgetByName(t),this._widget.seekWidgetByName(this.WIDGET_NAMES.CATEGORY).setVisible(!0),this._widget.seekWidgetByName(this.WIDGET_NAMES.NAME).setVisible(!0),this._widget.seekWidgetByName(this.WIDGET_NAMES.EFFECT).setVisible(!0),this._widget.seekWidgetByName(this.WIDGET_NAMES.EFFECT).setColor(n.color(255,255,0,255))},setVisible:function(e){this._widget.setVisible(e)},postMessage:function(e,t,n){null!=this._currentMessageDefer&&this._currentMessageDefer.promise.isPending()&&this._currentMessageDefer.reject("Overwriting currently displaying battle message"),this._currentMessageDefer=Q.defer(),this._postCategory(e),this._postName(t),this._postEffect(n),this.setVisible(!0),Q.delay(this.MAX_SHOW_MESSAGE_TIME).then(this._currentMessageDefer.resolve.bind(this._currentMessageDefer)),this._currentMessageDefer.promise.then(this.setVisible.bind(this,!1))},_postCategory:function(e){this._widget.seekWidgetByName(this.WIDGET_NAMES.CATEGORY).string=e},_postName:function(e){this._widget.seekWidgetByName(this.WIDGET_NAMES.NAME).string=e},_postEffect:function(e){this._widget.seekWidgetByName(this.WIDGET_NAMES.EFFECT).string=e}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e.res;t.RaidMessageWindow=n.Class.extend({className:"KHRaidMessageWindow",RESOURCE_NAME:"battle_log_plate_ui",WINDOW_POSITION:t.NODE_POSITION.RAID_MESSAGE_WINDOW,SHOW_MESSAGE_TIME:2e3,WIDGET_NAMES:{ICON:"player_job_img",ACTION:"action_label",DAMAGE:"damage_label",EFFECT:"effect_label"},ctor:function(){this._messageQueue=[]},init:function(e){return this._battleUI=e,this._widget=ccs.load(i[this.RESOURCE_NAME]).node,this._widget.setPosition(this.WINDOW_POSITION),t.createInstance("battleWorld").UIBackLayer.addChild(this._widget,-1),this._labels=_.map(_.range(4),function(e){return this._widget.seekWidgetByName("label_"+e)},this),this.setVisible(!1),this},setVisible:function(e){this._widget.setVisible(e),_.invoke(this._labels,"setVisible",e)},isVisible:function(){return this._widget.isVisible()},postMessage:function(e,t,n,i,a,o){this._setPlayerIcon(e),this._writeMessage(t,n,i,a),this._playSoundEffect(o),this.setVisible(!0),this._setTimeout()},_setTimeout:function(){this._widget.unscheduleAllCallbacks(),this._widget.scheduleOnce(this.setVisible.bind(this,!1),this.SHOW_MESSAGE_TIME/1e3)},_writeMessage:function(e,t,n,i){var a=arguments;_.each(this._labels,function(e,t){e.string=a[t]||"",e.setVisible(""!==e.string)})},_setPlayerIcon:function(e){var n=t.generateLogIconPath(e.job_id,e.job_skin);this._widget.seekWidgetByName(this.WIDGET_NAMES.ICON).loadTexture(n.png||n.jpg)},_playSoundEffect:function(e){var n=t.BattleGenericSeIdList[e];if(null!=n){var i=t.generateGenericSoundPath(n).mp3;t.createInstance("soundPlayer").playSoundEffect(i)}},cleanup:function(){this._widget&&this._widget.unscheduleAllCallbacks(),this._widget=null}})}((this||0).self||global),function(e){var t=e.kh,n=e.ccui;t.ListViewManager=cc.Class.extend({_class:"kh.ScrollListManager",resource:null,ctor:function(t,n,i){this.panel=t;var a=e.res;n&&(this.resource=ccs.load($dynamicRes(a[n])),null==this.resource.node&&e.console.error("resource.node is undefined: ",n)),this.recordWidgetInitializeFunc=i,this.addedWidgetList=[],this._init()},_init:function(){},clear:function(){this.listView&&this.listView.removeFromParent(),this.addedWidgetList=[]},setRecords:function(e){this.clear(),this.listView=new t.ListView,this.addedWidgetList=_.map(e,function(e,t){var n=this.resource.node.clone();try{this.recordWidgetInitializeFunc(n,e,t)}catch(e){console.error(e)}return n},this),this.listView.initialize(this.addedWidgetList),this.panel.addChild(this.listView),this.btnUp.setTouchEnabled(!1),this.btnUp.setBright(!1);var i=this.listView.isContentOverflow();this.btnDown.setTouchEnabled(i),this.btnDown.setBright(i),this.listView.addEventListenerScrollView(function(e,i){if(i===n.ScrollView.EVENT_SCROLL_TO_TOP||i===n.ScrollView.EVENT_SCROLL_TO_BOTTOM||i===n.ScrollView.EVENT_SCROLLING)if(this.btnUp&&this.btnDown){if(e.getContentSize().height-e.getInnerContainerSize().height!=0){if(i===n.ScrollView.EVENT_SCROLL_TO_TOP||i===n.ScrollView.EVENT_SCROLL_TO_BOTTOM){var a=!(i==n.ScrollView.EVENT_SCROLL_TO_TOP);this.btnUp.setTouchEnabled(a),this.btnUp.setBright(a),this.btnDown.setTouchEnabled(!a),this.btnDown.setBright(!a)}i===n.ScrollView.EVENT_SCROLLING&&(this.btnUp.setTouchEnabled(!0),this.btnUp.setBright(!0),this.btnDown.setTouchEnabled(!0),this.btnDown.setBright(!0))}}else if(!this._sendError){this._sendError=!0;var o=t.createInstance("smartBeat");this instanceof cc.Node&&o.log("context is cc.Node"),o.log("btnUp:"+!!this.btnUp),o.log("btnDown:"+!!this.btnDown),o.sendError("kh.ListViewManager: Invalid call ScrollEvent")}},this)},pushRecord:function(e){var t=this.resource.node.clone(),n=this.listView.getChildren().length;_.isFunction(this.recordWidgetInitializeFunc)&&this.recordWidgetInitializeFunc(t,e,n),this.listView.addRecord(t,n);var i=this.listView.isContentOverflow();this.btnDown.setTouchEnabled(i),this.btnDown.setBright(i)},setBtnUp:function(e){this.btnUp=e,e.setLockTimeout(0),e.addTouchEventListener(function(e,i){i===n.Widget.TOUCH_BEGAN&&((new t.SE).play(t.SoundList.BUTTON_TOUCHED_SWITCH),this._scroll(0,-36)),i!==n.Widget.TOUCH_ENDED&&i!==n.Widget.TOUCH_CANCELED||this.listView.unscheduleAllCallbacks()}.bind(this)),e.setSoundEnabled(!1)},setBtnDown:function(e){this.btnDown=e,e.setLockTimeout(0),e.addTouchEventListener(function(e,i){i===n.Widget.TOUCH_BEGAN&&((new t.SE).play(t.SoundList.BUTTON_TOUCHED_SWITCH),this._scroll(0,36)),i!==n.Widget.TOUCH_ENDED&&i!==n.Widget.TOUCH_CANCELED||this.listView.unscheduleAllCallbacks()}.bind(this)),e.setSoundEnabled(!1)},jumpToBottom:function(){this.btnDown.setTouchEnabled(!1),this.btnDown.setBright(!1),this.listView.isContentOverflow()?(this.listView.jumpToBottom(),this.btnUp.setTouchEnabled(!0),this.btnUp.setBright(!0)):(this.btnUp.setTouchEnabled(!1),this.btnUp.setBright(!1))},jumpToTop:function(){this.btnUp.setTouchEnabled(!1),this.btnUp.setBright(!1),this.listView.isContentOverflow()?(this.listView.jumpToTop(),this.btnDown.setTouchEnabled(!0),this.btnDown.setBright(!0)):(this.btnDown.setTouchEnabled(!1),this.btnDown.setBright(!1))},_scrollTimer:null,_scroll:function(e,t){this.btnUp.setTouchEnabled(!0),this.btnUp.setBright(!0),this.btnDown.setTouchEnabled(!0),this.btnDown.setBright(!0);var n=this.listView,i=this,a=function e(){var a=n.getContentSize().height-n.getInnerContainerSize().height,o=(n.getScrollPosition()+t)/-a*100;return o<=0?(i.jumpToTop(),void n.unschedule(e)):o>=100?(i.jumpToBottom(),void n.unschedule(e)):void n.jumpToPercentVertical(o)};a(),n.schedule(a,.1)}})}((this||0).self||global),function(e){var t=e._,n=e.kh;n.SummonPopup=cc.Class.extend({className:"KHSummonPopup",RESOURCE_NAME:"battle_ui_summon_popup",WIDGET_NAMES:{OK_BUTTON:"a_q_001_summongo_ok",CANCEL_BUTTON:"a_q_001_summongo_cancel",SUMMON_CARD:"a_q_001_battlecard_summon_ui",SUMMON_NAME:"a_q_001_summongo_summon_name",ATTACK_NAME:"a_q_001_summongo_trick_name",ATTACK_DESCRIPTION:"a_q_001_summongo_trick_description",ATTACK_TURN:"a_q_001_summongo_turn_interval",EFFECT_NAME:"a_q_001_summongo_skill_name",EFFECT_DESCRIPTION:"a_q_001_summongo_skill_description",EFFECT_ENABLED:"a_q_001_summongo_skill_invalid",SUMMON_BAN_LABEL:"a_q_001_summongo_summon_ban_label"},BUTTON_TYPES:{OK_CANCEL:"summon_ok",CANCEL:"summon_not"},ctor:function(){var e=this._getPopupMethods(),t=this.RESOURCE_NAME,i=this.WIDGET_NAMES;this.popup=n.createInstance("battleUIPopupFactory").create({resourceName:t,methods:e,buttonWidgets:{okBtn:i.OK_BUTTON,cancelBtn:i.CANCEL_BUTTON},buttons:{okBtn:function(e){e.popupDefer.resolve(),this.dismiss()},cancelBtn:function(){this.dismiss()}},buttonSounds:{okBtn:n.SoundList.BUTTON_TOUCHED_CONFIRMED,cancelBtn:n.SoundList.BUTTON_TOUCHED_CANCEL},buttonLabels:{okBtn:"OK",cancelBtn:""}},[this])},open:function(e){var t;return this.popupDefer=Q.defer(),t=e.ready?this.BUTTON_TYPES.OK_CANCEL:this.BUTTON_TYPES.CANCEL,this.popup.showButtons(t),this.popup.open().then(this._displaySummonData.bind(this,e)),this.popupDefer.promise},_getPopupMethods:function(){var e={},i=this.WIDGET_NAMES;return e.getCard=function(){return this._card||(this._card=n.createInstance("SummonCard").init(this.getWidget(i.SUMMON_CARD))),this._card},e.setSummonCard=function(e){this.getCard().setTexture(e)},e.setSummonName=function(e){this.getWidget(i.SUMMON_NAME).string=e},e.setSummonAttackName=function(e){this.getWidget(i.ATTACK_NAME).string=e},e.setSummonAttackDescription=function(e){this.getWidget(i.ATTACK_DESCRIPTION).string=e},e.setSummonAttackTurn=function(e,t){var n=this.getWidget(i.ATTACK_TURN);n.getParent().setVisible(!t&&0!==e),n.string=""+e},e.setSummonEffectName=function(e){this.getWidget(i.EFFECT_NAME).string=e},e.setSummonEffectDescription=function(e){this.getWidget(i.EFFECT_DESCRIPTION).string=e},e.setSummonEffectEnabled=function(e){this.getWidget(i.EFFECT_ENABLED).setVisible(!e)},e.setCardTurn=function(e){this.getCard().updateTurn(e)},e.enableDarkenFilter=function(e){this.getCard().enableDarkenFilter(e)},e.setBanLabelVisible=function(e){t.each(["a_q_001_summongo_trick_base","a_q_001_summongo_skill_base","a_q_001_summongo_trick_description","a_q_001_summongo_skill_description","a_q_001_summongo_skill_invalid"],function(t){this.getWidget(t).setVisible(!e)},this),this.getWidget(i.SUMMON_BAN_LABEL).setVisible(e)},e.setInvalidLabel=function(e){},e.onExit=this._onExit.bind(this),e},_displaySummonData:function(e){var t=this.popup;t.setSummonCard(e),t.setSummonName(e.name),t.setSummonAttackName(e.attack_info.name),t.setSummonAttackDescription(e.attack_info.description),t.setSummonAttackTurn(e.attack_info.turn,e.ban),t.setSummonEffectName(e.effect_info.name),t.setSummonEffectDescription(e.effect_info.description),t.setCardTurn(e.turn),t.setSummonEffectEnabled(e.effect_info.enabled),t.enableDarkenFilter(!e.ready),t.setBanLabelVisible(e.ban),t.setInvalidLabel(e.index)},_onExit:function(){n.Popup.prototype.onExit.call(this.popup),null==this.popupDefer||this.popupDefer.promise.isFulfilled()||this.popupDefer.reject("Summon popup closed without using the confirm button, no further action required")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e.ccs,a=e.ccui,o=e.res;t.SummonBrokenPopup=t.Popup.extend({className:"KHSummonBrokenPopup",RESOURCE_NAME:"battle_ui_summon_broken_popup",PANEL_NAME:"btn_device_panel",ctor:function(){var e=i.load(o[this.RESOURCE_NAME]).node;this._super(e),this.panel=a.helper.seekWidgetByName(e,this.PANEL_NAME),this.panel.setTouchEnabled(!1),this.setCloseButton(!0)},_enableTouchEvent:function(){var e,i;e={event:n.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:function(){return!0},onTouchEnded:function(){(new t.SE).play(t.SoundList.BUTTON_TOUCHED_CANCEL),i()}},i=function(){this.dismiss().then(function(){this.onCloseDefer.resolve()}.bind(this))}.bind(this);var a=n.eventManager.addListener(e,this.panel);return{disableAll:function(){n.eventManager.removeListener(a)}}},open:function(){return this.onCloseDefer=Q.defer(),t.Popup.prototype.open.call(this),this.onCloseDefer.promise}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.ccui,o=e.res;t.CurePopup=t.CurePopup||{},t.CurePopup.CURE_NAME={BOTTLE:"cure_bottle",MEDIC:"cure_medic",ELIXIR:"cure_elixir"},t.CurePopup=n.Class.extend(i.assign(t.CurePopup,{className:"KHCurePopup",CHARACTER_CARD_BASE_WIDGET_NAMES:i.map(i.range(t.GameConfig.PARTY_SETTINGS.MAX_AVATAR_COUNT),function(e){return"battlecard_chara_ui_"+e}),EXCHANGE_ITEM_NAME:function(){var e={};return e[t.CurePopup.CURE_NAME.BOTTLE]="cure-bottle",e[t.CurePopup.CURE_NAME.MEDIC]="cure-medic",e[t.CurePopup.CURE_NAME.ELIXIR]="elixir",e}(),FONT_COLORS:{default:n.color("#000000"),red:n.color("#cc0000")},_partyMemberList:null,_cureItemList:null,_currentFocusCureName:null,_characterPanelList:null,_frameParam:{clear:function(){this.frame=0,this.takeNum=12,this.height=754,this.word=void 0,this.fontColor="default",this.charafilter=!1,this.ok="disabled",this.brightenFallen=!1,this.showAmount=!1}},ctor:function(){this.popup=ccs.load(o.battle_a_q_001_ui_cure_json),this._action=this.popup.action,this._partyMemberList=[],this._cureItemList=[],this._characterPanelList=null},init:function(){return this.popup.node.runAction(this._action),this._setNotificationEventListener(),this._characterPanels=this._characterPanels||this._initCharacterCards(),this},_setNotificationEventListener:function(){var e=t.createInstance("notificationCenter");i.each(t.BattleStatus.eventName,function(t,n){var i=null;if(-1!==n.indexOf("PARTY_MEMBER"))i=this._partyMemberList||[];else{if(-1===n.indexOf("CURE_ITEM"))return;i=this._cureItemList||[]}e.addEventListener(t,function(e){i[e.idx]=e.data})},this)},_getCureItemData:function(e){var t=this.EXCHANGE_ITEM_NAME[e];return i.find(this._cureItemList,function(e){return e.physical_name===t})},updateCharacterList:function(e){this._characterPanelList=e},updateCureItemCount:function(t,n){var i=this._getCureItemData(t);return null==i?(e.console.warn("KHCurePopup.updateCureItemCount: cure item not found"),this._cureItemList.push({physical_name:this.EXCHANGE_ITEM_NAME[t],count:n}),!1):i.count!==n&&(i.count=n,!0)},_useItem:function(e){this._popup.dismiss().then(function(){var n=this._currentFocusCureName;return 0===this._getCureItemData(n).usable_amount?void t.createInstance("ElixirLimitPopup",[!1]).open():void this.callBackFunction(this.EXCHANGE_ITEM_NAME[n],e)}.bind(this)).catch(function(e){throw new Error(e)})},openPopup:function(e){this._refreshCharacterProperties(),this._popupParts=this._getPopupWidgetParts();var n=t.createInstance("Popup",[this._popupParts.widget]);n.setCloseButton(this._popupParts.closeButton),this.callBackFunction=e;var i=this;this._popupParts.actionButton.addTouchEventListener(function(e,t){t===a.Widget.TOUCH_ENDED&&i._useItem()},n),n.open(),this._popup=n,this._popupParts=null,n=null},dismiss:function(){this._popup&&(this._popup.dismiss(),this._popup=null)},_makeFrameParamClear:function(){this._frameParam.clear(),this._currentFocusCureName=null},_makeFrameParamCureBottle:function(){var e=this._frameParam;e.clear();var t=this._getCureItemData(this.CURE_NAME.BOTTLE);e.takeNum=t.count,this._hasHealable()?(e.frame=1,e.height=854,e.word="\n",e.fontColor="default",e.ok="disabled",e.charafilter=!0,e.showAmount=!0,e.brightenFallen=!1):(e.frame=1,e.height=854,e.word="",e.fontColor="red",e.ok="disabled",e.charafilter=!0,e.showAmount=!1,e.brightenFallen=!1)},_makeFrameParamCureMedic:function(){var e=this._frameParam;e.clear();var t=this._getCureItemData(this.CURE_NAME.MEDIC);e.takeNum=t.count,this._hasHealable()?(e.frame=2,e.height=854,e.word="",e.fontColor="default",e.ok="enabled",e.charafilter=!0,e.showAmount=!0,e.brightenFallen=!1):(e.frame=1,e.height=854,e.word="",e.fontColor="red",e.ok="disabled",e.charafilter=!0,e.showAmount=!1,e.brightenFallen=!1)},_makeFrameParamCureElixir:function(){var e=this._frameParam;e.clear();var t=this._getCureItemData(this.CURE_NAME.ELIXIR);e.takeNum=t.count,this._isVanguardAllHpMax()||this._hasRestorableSubs()?(e.frame=2,e.height=854,e.word="",e.fontColor="default",e.ok="enabled",e.charafilter=!0,e.showAmount=!0,e.brightenFallen=!0):this._isVanguardAllBurstMax()?(e.frame=2,e.height=854,e.word="HPMAX",e.fontColor="red",e.ok="enabled",e.charafilter=!0,e.showAmount=!0):(e.frame=1,e.height=854,e.word="",e.fontColor="red",e.ok="disabled",e.charafilter=!0,e.showAmount=!1)},_camelCase:function(e){return e.replace(/\_(\w)/g,function(e,t){return t.toUpperCase()})},_changeFrame:function(e){this["_makeFrameParam"+i.capitalize(this._camelCase(e))](),this._changeFrameExec()},_hasHealable:function(){return i.some(i.range(Math.min(this._characterPanelList.length,this._characterData.length)),function(e){var t=this._characterData[e];return null!=t&&!i.isEmpty(t)&&t.hp!==t.max_hp&&0!==t.hp},this)},_isVanguardAllHpMax:function(){return i.some(i.range(Math.min(this._characterPanelList.length,this._characterData.length)),function(e){var t=this._characterData[e];return null!=t&&!i.isEmpty(t)&&t.hp!==t.max_hp},this)},_hasRestorableSubs:function(){var e=this._characterData.slice(t.GameConfig.PARTY_SETTINGS.MAX_AVATAR_COUNT,this._characterData.length);return i(e).reject(i.isEmpty).some(function(e){return e.hp!==e.max_hp||e.burst<e.max_burst},this)},_isVanguardAllBurstMax:function(){return i.some(i.range(Math.min(this._characterPanelList.length,this._characterData.length)),function(e){var t=this._characterData[e];return null!=t&&!i.isEmpty(t)&&t.burst<t.max_burst},this)},_changeFrameExec:function(){var e=this._frameParam,n=a.helper.seekWidgetByName(this.popup.node,"a_q_001_cure_ok"),o=a.helper.seekWidgetByName(this.popup.node,{1:"a_q_001_cure_detail_0",2:"a_q_001_cure_detail_1"}[e.frame]);if(t.env.isSp||0==e.frame)this._action.gotoFrameAndPause(e.frame);else{var r=a.helper.seekWidgetByName(this.popup.node,"a_q_001_cure_chancel"),s=a.helper.seekWidgetByName(this.popup.node,"a_q_001_cure_have_base");0!=e.frame&&(r.y=n.y,s.y=213,o.y=244,s.setVisible(!0),o.setVisible(!0),1==e.frame?(r.x=320,a.helper.seekWidgetByName(this.popup.node,"a_q_001_cure_detail_0").setVisible(!0),a.helper.seekWidgetByName(this.popup.node,"a_q_001_cure_detail_1").setVisible(!1),n.setVisible(!1)):(r.x=640-n.x,a.helper.seekWidgetByName(this.popup.node,"a_q_001_cure_detail_0").setVisible(!1),a.helper.seekWidgetByName(this.popup.node,"a_q_001_cure_detail_1").setVisible(!0),n.setVisible(!0)))}var c=a.helper.seekWidgetByName(this.popup.node,"a_q_001_cure_popup_base");if(c.setSize({width:c.getSize().width,height:e.height}),e.word&&(o.setString(e.word),o.setColor(this.FONT_COLORS[e.fontColor||"default"])),"enabled"===e.ok?n.setVisible(!0):n.setVisible(!1),this.popup.node.seekWidgetByName("a_q_001_cure_have_base").setVisible(e.showAmount),e.showAmount){var u=a.helper.seekWidgetByName(this.popup.node,"a_q_001_cure_have_before"),l=a.helper.seekWidgetByName(this.popup.node,"a_q_001_cure_have_after");u.setString(e.takeNum.toString()+" "),l.setString((e.takeNum-1).toString())}i.each(this._characterData,function(t,n){if(!(n>=this._characterPanels.length)){var i=this._characterPanels[n];i.enableDarkenFilter(t.hp===t.max_hp&&e.charafilter||t.has_fallen&&!e.brightenFallen),i.setTouchEnabled(t.hp!==t.max_hp&&!t.has_fallen&&this._canCharacterPanelSelect())}},this)},_changeCureFocus:function(e,t){null!==e&&a.helper.seekWidgetByName(this.popup.node,"a_q_001_"+e+"_focus").setVisible(t)},_clearAllCureFocus:function(){i.each(this.CURE_NAME,function(e){this._changeCureFocus(e,!1)},this)},_prepareCureItem:function(e,o){var r,s=a.helper.seekWidgetByName(this.popup.node,"a_q_001_"+e);e===this.CURE_NAME.BOTTLE?r=t.IDList.ItemID.cure_bottle:e===this.CURE_NAME.MEDIC?r=t.IDList.ItemID.cure_medic:e===this.CURE_NAME.ELIXIR&&(r=t.IDList.ItemID.elixir);var c=t.Img("corecard","item",i.padZero(r,4)).jpg;s.loadTextureNormal(c),s.loadTexturePressed(c),s.ignoreShrinkEffect=!0,s.addTouchEventListener(function(t,n){n===a.Widget.TOUCH_ENDED&&0<o&&this._currentFocusCureName!==e&&(this._changeCureFocus(this._currentFocusCureName,!1),this._currentFocusCureName=e,this._changeCureFocus(this._currentFocusCureName,!0),this._changeFrame(this._currentFocusCureName))}.bind(this)),s.color=0===o?t.BATTLE_UI_DARKEN_FILTER_COLOR:n.color(255,255,255,255),a.helper.seekWidgetByName(this.popup.node,"a_q_001_"+e+"_have_number").setString(""+o)},_canCharacterPanelSelect:function(e){return this._currentFocusCureName===this.CURE_NAME.BOTTLE},_initCharacterCards:function(){var e=t.AbilityPopupExtended.prototype._initCharacterCards.call(this,this.popup.node);return i.each(e,function(e,t){e.addTouchEventListener(function(e,n){n===a.Widget.TOUCH_ENDED&&this._useItem(t)},this)},this),e},_refreshCharacterProperties:function(){this._characterData=i.clone(this._partyMemberList),t.AbilityPopupExtended.prototype._refreshCharacterProperties.call(this)},_fillCharacterPanel:function(e){t.AbilityPopupExtended.prototype._fillCharacterPanel.call(this,e)},_setAbilityIcons:function(e,n){t.AbilityPopupExtended.prototype._setAbilityIcons.call(this,e,n)},_setStatusIcons:function(e,n){t.AbilityPopupExtended.prototype._setStatusIcons.call(this,e,n)},_getPopupWidgetParts:function(){var e=this.popup.node;this._clearAllCureFocus(),this._changeFrame("clear");var n=a.helper.seekWidgetByName(e,"a_q_001_cure_chancel"),o=a.helper.seekWidgetByName(e,"a_q_001_cure_ok");return n.setSound(t.SoundList.BUTTON_TOUCHED_CANCEL),o.setSound(t.SoundList.BUTTON_TOUCHED_DECIDE),this._prepareCureItem(this.CURE_NAME.BOTTLE,this._getCureItemData(this.CURE_NAME.BOTTLE).count),this._prepareCureItem(this.CURE_NAME.MEDIC,this._getCureItemData(this.CURE_NAME.MEDIC).count),this._prepareCureItem(this.CURE_NAME.ELIXIR,this._getCureItemData(this.CURE_NAME.ELIXIR).count),i.each(this._characterPanels,function(e,t){var n=this._characterData[t];return null==n||i.isEmpty(n)?void e.setVisible(!1):(this._fillCharacterPanel(n),void e.setVisible(!0))},this),{widget:e,actionButton:o,closeButton:n}}}))}((this||0).self||global),function(e){var t=e._,n=e.kh,i=e.ccui;n.BattleUIPopupFactory=n.PopupFactory.extend({create:function(e,t){return this.resourceName=e.resourceName,n.PopupFactory.prototype.create.call(this,e,t)},configure:function(e,t){this._addMethodsToPopup(e,t)},_addMethodsToPopup:function(n,a){n._widgets={},n.getWidget=function(e){return null==this._widgets[e]&&(this._widgets[e]=i.helper.seekWidgetByName(this.resource.node,e)),this._widgets[e]}.bind(n),n.showButtons=function(t){var n=this.resource.action;this.resource.node.runAction(n);var i=n.animationInfo[t];return i?void n.gotoFrameAndPause(i.startIndex):void e.console.error("no such button type: ",t)}.bind(n),t.each(a.methods,function(e,t){n[t]=e.bind(n)})},_prepareButtons:function(e,a,o){t.each(a.buttonWidgets,function(t,n){e[n]=i.helper.seekWidgetByName(e.resource.node,t)}),n.PopupFactory.prototype._prepareButtons.apply(this,arguments)},_getButtonType:function(){},_showButtons:function(){}})}((this||0).self||global),function(e){var t=e._,n=e.kh,i=e.cc;n.ABILITY_POPUP_BLUEPRINTS={abilityPopupNormal:0,abilityPopupExtended:1},n.AbilityPopupFactory=n.BattleUIPopupFactory.extend({RESOURCE_NAME_PREFIX:"battle_ui_ability_popup_",WIDGET_PREFIX:"a_q_001_skillgo_",WIDGET_SUFFIXES:{CANCEL_BUTTON:"_cancel",ABILITY_ICON:"_ability",ABILITY_NAME:"_ability_name",ABILITY_DESCRIPTION:"_ability_description",ABILITY_INTERVAL:"_ability_interval_label",ABILITY_DURATION:"_ability_time_label"},create:function(e,t){null==e.blueprint&&console.error("Error trying to initialize popup: no blueprint is specified!"),this.blueprint=e.blueprint;var i=this.RESOURCE_NAME_PREFIX+e.blueprint,a=this._addPopupMethods(e.methods||{}),o=this._addPopupButtonWidgets(e.buttonWidgets||{}),r=this._addPopupButtons(e.buttons||{}),s=this._addPopupButtonLabels(e.buttonLabels||{}),c=this._addPopupButtonSound(e.buttonSounds||{});return n.BattleUIPopupFactory.prototype.create.call(this,{resourceName:i,methods:a,buttonWidgets:o,buttons:r,buttonLabels:s,buttonSounds:c},t)},_addPopupMethods:function(e){var a={};return t.each(this.WIDGET_SUFFIXES,function(e,t){a[t]=this.WIDGET_PREFIX+this.blueprint+e},this),e.setAbilityName=function(e){this.getWidget(a.ABILITY_NAME).string=e},e.setAbilityIcon=function(e){var t=this.getWidget(a.ABILITY_ICON);t.setAnchorPoint({x:.5,y:.5}),n.createInstance("AbilityIcon",[t,e.type,e.category,!1]).show()},e.setAbilityIconDarkenFilter=function(e){this.getWidget(a.ABILITY_ICON).color=e?i.color(255,255,255,255):n.BATTLE_UI_DARKEN_FILTER_COLOR},e.setAbilityDescription=function(e){this.getWidget(a.ABILITY_DESCRIPTION).string=e},e.setAbilityInterval=function(e){this.getWidget(a.ABILITY_INTERVAL).string=":"+e+""},e.setAbilityDuration=function(e){this.getWidget(a.ABILITY_DURATION).string=null==e?"":":"+e},e.displayAbilityData=function(e){this.setAbilityName(e.name),this.setAbilityDescription(e.description),this.setAbilityIcon(e),this.setAbilityIconDarkenFilter(e.ready),this.setAbilityInterval(e.turn),this.setAbilityDuration(e.duration)},e},_addPopupButtonWidgets:function(e){return e.cancelBtn=this.WIDGET_PREFIX+this.blueprint+this.WIDGET_SUFFIXES.CANCEL_BUTTON,e},_addPopupButtons:function(e){return e.cancelBtn=function(){this.dismiss()},e},_addPopupButtonLabels:function(e){return e.cancelBtn="",e},_addPopupButtonSound:function(e){return e.cancelBtn=n.SoundList.BUTTON_TOUCHED_CANCEL,e}})}((this||0).self||global),function(e){var t=e._,n=e.kh,i=e.cc,a=e.ccui;n.AbilityPopupExtended=i.Class.extend({className:"KHAbilityPopupExtended",CHARACTER_CARD_BASE_WIDGET_NAMES:t.map(t.range(7),function(e){return"battlecard_chara_ui_"+e}),ctor:function(){this._characterData={}},open:function(e){return this.popupDefer=Q.defer(),this.popup=n.createInstance("abilityPopupFactory").create({blueprint:n.ABILITY_POPUP_BLUEPRINTS.abilityPopupExtended,methods:{onExit:this._onExit.bind(this)}},[this]),this._characterPanels=null,this._refreshCharacterProperties(),this.popup.open().then(function(){this._abilityType=e.party_member_selectable_type||"heal",this._characterPanels=this._characterPanels||this._initCharacterCards(),this.popup.displayAbilityData(e),this._displayCharacterPanels()}.bind(this)),this.popupDefer.promise},updateCharacterData:function(e,n){null==n.status_effects&&this._characterData[e]&&null!=this._characterData[e].status_effects&&delete this._characterData[e].status_effects,this._characterData[e]=t.assign(this._characterData[e]||{},n)},removeCharacterData:function(e){this._characterData[e]=null,null!=this._characterPanels&&this._characterPanels[e].setVisible(!1)},_initCharacterCards:function(e){return e=e||this.popup,t.map(this.CHARACTER_CARD_BASE_WIDGET_NAMES,function(t){e.seekWidgetByName(t).setVisible(!0);var i=n.createInstance("CharacterCard").init(e.seekWidgetByName(t).seekWidgetByName(n.CHARACTER_PANEL_BASE));return i.setVisible(!1),i},this)},_refreshCharacterProperties:function(){var e=n.createInstance("battleWorld"),i=n.createInstance("FallenAvatarOrderHandler");t.each(e.characterList.concat(e.subList||[]),function(e,n){var a=t.isEmpty(e)?i.getFallenByCharacterIndex(n):e;null!=a&&(this._characterData[n]=t.assign(this._characterData[n]||{},{index:n,id:a.id,is_job:a.isJob,element_type:a.elementType,skin:a.skin,has_fallen:!!a.hasFallen||0===a.hp,is_burst_banned:!!a.isBurstBanned}),this._characterData[n].burst=this._characterData[n].burst||a.burst||0,this._characterData[n].max_burst=this._characterData[n].max_burst||a.max_burst||100,this._characterData[n].hp=a.hasFallen?0:this._characterData[n].hp||0,this._characterData[n].hp_max=this._characterData[n].hp_max||1)},this)},_fillCharacterPanel:function(e){var t=this._characterPanels[e.index];return t.insertData(e),this._setAbilityIcons(t,e),this._setStatusIcons(t,e),t},_setAbilityIcons:function(e,i){e.clearAbilityIcons();var a=n.createInstance("battleWorld").characterAbilityList[i.index];t.each(a||[],function(n,a){if(null!=n&&!t.isEmpty(n))return e.initAbilityIcon(n.getAbilityData(),a),i.has_fallen?void e.updateAbilityTurn(0,a,!1):void e.updateAbilityTurn(!n.isUsable(),a,n.isUsable())})},_setStatusIcons:function(e,i){e.clearAllStatusEffects(),t.each(i.status_effects,function(t,a){var o=n.createInstance("battleWorld").statusEffectList[i.status_effects[a].id];e.pushStatusEffect(o)},this)},_displayCharacterPanels:function(){this.popup,t.each(this._characterPanels,function(n,i){var o=this._characterData[i];if(null==o||t.isEmpty(o))n.setVisible(!1);else if(null!=o.index){this._fillCharacterPanel(o),n.setVisible(!0);var r=this._shouldEnableTouchPanel(o);n.enableDarkenFilter(!r),n.setTouchEnabled(r),n.setSoundEnabled(r),r&&(n.addTouchEventListener(function(e,t){t===a.Widget.TOUCH_ENDED&&(this.popupDefer.resolve(o.index),this.popup.dismiss())},this),n.ignoreShrinkEffect=!0)}else e.console.warn("KHAbilityPopupExtended._displayCharacterPanels: battleStatus data and battleWorld data do not match")},this)},_shouldEnableTouchPanel:function(e){return{revive:this._shouldEnableTouchPanelForAbilityTypeRevive,buff:this._shouldEnableTouchPanelForAbilityTypeBuff,heal:this._shouldEnableTouchPanelForAbilityTypeHeal}[this._abilityType].call(this,e)},_shouldEnableTouchPanelForAbilityTypeRevive:function(e){return e.has_fallen||0===e.hp},_shouldEnableTouchPanelForAbilityTypeBuff:function(e){return!e.has_fallen&&0!==e.hp&&e.index<n.GameConfig.PARTY_SETTINGS.MAX_AVATAR_COUNT},_shouldEnableTouchPanelForAbilityTypeHeal:function(e){return!e.has_fallen&&0!==e.hp&&!(e.hp>=e.max_hp)&&e.index<n.GameConfig.PARTY_SETTINGS.MAX_AVATAR_COUNT},_onExit:function(){n.Popup.prototype.onExit.call(this.popup),null==this.popupDefer||this.popupDefer.promise.isFulfilled()||this.popupDefer.reject("Ability extended popup closed without using the confirm button, no further action required")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.AbilityPopupNormal=n.Class.extend({className:"KHAbilityPopupNormal",WIDGET_NAMES:{OK_BUTTON:"a_q_001_skillgo_0_ok",ABILITY_BAN:"a_q_001_skillgo_ability_ban",ABILITY_BAN_EXPLANATION:"a_q_001_skillgo_0_ability_ban_label",ABILITY_DURATION_BASE:"a_q_001_skillgo_0_ability_duration_base",ABILITY_DURATION_EXPLANATION:"a_q_001_skillgo_0_ability_duration_label"},BUTTON_TYPES:{OK_CANCEL:"skill_ok",CANCEL:"skill_not"},ctor:function(){this.buttonType=this.BUTTON_TYPES.CANCEL;var e=this._getPopupMethods(),n=this.WIDGET_NAMES;return this.popup=t.createInstance("abilityPopupFactory").create({blueprint:t.ABILITY_POPUP_BLUEPRINTS.abilityPopupNormal,methods:e,buttonWidgets:{okBtn:n.OK_BUTTON},buttons:{okBtn:function(e){e.popupDefer.resolve(),this.dismiss()}},buttonSounds:{okBtn:t.SoundList.BUTTON_TOUCHED_DECIDE},buttonLabels:{okBtn:"OK"}},[this]),this},open:function(e){var t;return this.popupDefer=Q.defer(),t=e.ready&&!e.is_banned?this.BUTTON_TYPES.OK_CANCEL:this.BUTTON_TYPES.CANCEL,this.popup.showButtons(t),this.popup.open().then(this._displayAbilityData.bind(this,e)),this.popupDefer.promise},_getPopupMethods:function(){var e={},t=this.WIDGET_NAMES;return e.setAbilityDuration=function(e){null!=e&&(this.getWidget(t.ABILITY_DURATION_EXPLANATION).string=":"+e)},e.setAbilityDurationVisible=function(e){this.getWidget(t.ABILITY_DURATION_BASE).setVisible(e)},e.setAbilityBanExplanationVisible=function(e){this.getWidget(t.ABILITY_BAN_EXPLANATION).setVisible(e)},e.setAbilityBanVisible=function(e){this.getWidget(t.ABILITY_BAN).setVisible(e)},e.onExit=this._onExit.bind(this),e},_displayAbilityData:function(e){var t=this.popup;t.displayAbilityData(e),t.setAbilityDurationVisible(null!=e.duration),t.setAbilityDuration(e.duration),t.setAbilityBanVisible(!!e.is_banned),t.setAbilityIconDarkenFilter(e.ready&&!e.is_banned)},_onExit:function(){t.Popup.prototype.onExit.call(this.popup),null==this.popupDefer||this.popupDefer.promise.isFulfilled()||this.popupDefer.reject("Ability normal popup closed without using the confirm button, no further action required")}})}((this||0).self||global),function(e){var t=(e._,e.kh);t.CONTINUE_POPUP_BLUEPRINTS={continuePopupElixir:0,continuePopupNoElixir:1,continuePopupLimitedElixir:3},t.ContinuePopupFactory=t.BattleUIPopupFactory.extend({RESOURCE_NAME_PREFIX:"battle_ui_continue_popup_",WIDGET_PREFIX:"a_q_001_continue_",WIDGET_SUFFIXES:{CANCEL_BUTTON:"_cancel"},create:function(e,n){null==e.blueprint&&console.error("Error trying to initialize popup: no blueprint is specified!"),this.blueprint=e.blueprint;var i=this.RESOURCE_NAME_PREFIX+e.blueprint,a=e.methods||{},o=this._addPopupButtonWidgets(e.buttonWidgets||{}),r=this._addPopupButtons(e.buttons||{}),s=this._addPopupButtonLabels(e.buttonLabels||{}),c=this._addPopupButtonSound(e.buttonSound||{});return t.BattleUIPopupFactory.prototype.create.call(this,{resourceName:i,methods:a,buttonWidgets:o,buttons:r,buttonLabels:s,buttonSounds:c},n)},_addPopupButtonWidgets:function(e){return e.cancelBtn=this.WIDGET_PREFIX+this.blueprint+this.WIDGET_SUFFIXES.CANCEL_BUTTON,e},_addPopupButtons:function(e){return e.cancelBtn=function(e){t.createInstance("continuePopup").dismiss().then(function(){var e=t.createInstance("questInfo");t.createInstance("apiAQuests").getGainedItems(e.getQuestId(),e.getQuestType()).then(function(n){var i=n.body.gained_items;t.createInstance("backCheckPopupFactory").create({}).open({type:"quest",coin:i.gem,normal:i.wooden_box,silver:i.silver_box,gold:i.golden_box,rainbow:i.rainbow_box,aQuestId:e.getQuestId(),questType:e.getQuestType(),onCancel:function(){t.createInstance("continuePopup").open()},preventNavigateBack:!0})})})},e},_addPopupButtonLabels:function(e){return e.cancelBtn="",e},_addPopupButtonSound:function(e){return e.cancelBtn=t.SoundList.BUTTON_TOUCHED_CANCEL,e}})}((this||0).self||global),function(e){var t=e.kh;t.RaidContinuePopupFactory=t.ContinuePopupFactory.extend({_addPopupButtons:function(e){return e.cancelBtn=function(n){t.createInstance("continuePopup").dismiss().then(function(){t.createInstance("backCheckPopupFactory").create({}).open(e)})},e}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.ContinuePopupElixir=n.Class.extend({className:"KHContinuePopupElixir",WIDGET_NAMES:{PICTURE:"a_q_001_continue_0_elixir",COUNT_BEFORE:"a_q_001_continue_0_elixir_have_before",COUNT_AFTER:"a_q_001_continue_0_elixir_have_after",OK_BUTTON:"a_q_001_continue_0_ok"},_popupSettings:{blueprint:t.CONTINUE_POPUP_BLUEPRINTS.continuePopupElixir,buttonLabels:{okBtn:"OK"},buttonSounds:{okBtn:t.SoundList.BUTTON_TOUCHED_CONFIRMED},buttons:{okBtn:function(e){t.createInstance("continuePopup").dismiss().then(function(){t.createInstance("continuePopup").decrementElixirCount(),t.createInstance("battleWorld").useItem("elixir")})}}},ctor:function(){var e=this._getPopupMethods(),n=this.WIDGET_NAMES,i=_.assign(this._popupSettings,{methods:e,buttonWidgets:{okBtn:n.OK_BUTTON}});this.popup=t.createInstance("continuePopupFactory").create(i,[this])},open:function(e){return this.popup.setPicture(),this.popup.setElixirCount(e),this.popup.open()},dismiss:function(){return this.popup?this.popup.dismiss():Q.resolve()},_getPopupMethods:function(){var e={},n=this.WIDGET_NAMES;return e.setPicture=function(){this.getWidget(n.PICTURE).setVisible(!0),this.getWidget(n.PICTURE).loadTexture(t.Img("corecard","item",_.padZero(t.IDList.ItemID.elixir,4)).jpg)},e.setElixirCount=function(e){this.getWidget(n.COUNT_BEFORE).string=e+" ",this.getWidget(n.COUNT_AFTER).string=(e-1).toString()},e}})}((this||0).self||global),function(e){var t=e.kh;t.RaidContinuePopupElixir=t.ContinuePopupElixir.extend({className:"KHRaidContinuePopupElixir",ctor:function(){this._popupSettings.buttons.okBtn=function(e){t.createInstance("continuePopup").dismiss().then(function(){var e=t.createInstance("battleUI").CenterPanel;e.setEnabled(!0),e.hideReviveButton(),t.createInstance("continuePopup").decrementElixirCount(),t.createInstance("battleWorld").useItem("elixir")})},this._super()}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.ContinuePopupNoElixir=n.Class.extend({className:"KHContinuePopupNoElixir",WIDGET_NAMES:{PICTURE:"a_q_001_continue_1_elixir"},RECOVERY_TYPE:"AP",COMPONENT:"battle",ctor:function(){var e=this._getPopupMethods();this.WIDGET_NAMES,this.popup=t.createInstance("continuePopupFactory").create({blueprint:t.CONTINUE_POPUP_BLUEPRINTS.continuePopupNoElixir,methods:e},[this])},open:function(){return this.popup.setPicture(),this._initializeRestoreItemVendingProcessController(),this._initializeButtons(),this._initializeLabels(),this.popup.open()},_initializeRestoreItemVendingProcessController:function(){var e=this._createVendingLocationInformation();this._restoreItemVendingProcessController=t.createInstance("RestoreItemVendingProcessController",[this.RECOVERY_TYPE,e]),this._restoreItemVendingProcessController.preload(),this._restoreItemVendingProcessController.setOnTransactionCompletedCallback(this._onBuyCallback,this)},_initializeButtons:function(){this._restoreItemVendingProcessController.initializeButtons(this.popup)},_initializeLabels:function(){this._restoreItemVendingProcessController.initializeCurrencyAmountLabels(this.popup)},dismiss:function(){return this.popup?this.popup.dismiss():Q.resolve()},_onBuyCallback:function(e){t.createInstance("continuePopup").dismiss().then(function(){var n=t.createInstance("continuePopup");null!=e&&n.updateElixirCount(e),n.refreshPopupType(),n.open()}.bind(this))},_createVendingLocationInformation:function(){var e=t.createInstance("VendingLocationInformation"),n=t.createInstance("questInfo"),i=n.getBattleId(),a=n.getQuestId(),o=n.getQuestType(),r=n.isOwnRaid();return e.setComponent(this.COMPONENT),e.setBattleId(i),e.setQuestId(a),e.setQuestType(o),e.setIsOwnRaid(r),e},_getPopupMethods:function(){var e={},n=this.WIDGET_NAMES;return e.setPicture=function(){this.getWidget(n.PICTURE).setVisible(!0),this.getWidget(n.PICTURE).loadTexture(t.Img("corecard","item",_.padZero(t.IDList.ItemID.elixir,4)).jpg)},e}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,t.ContinuePopupElixir.prototype);t.ContinuePopupLimitedElixir=t.ContinuePopupElixir.extend({className:"KHContinuePopupLimitedElixir",WIDGET_NAMES:_(n.WIDGET_NAMES).transform(function(e,t,n){e[n]=t.replace("_0_","_3_")}).assign({LIMIT_LABEL:"a_q_001_continue_3_elixir_use_confirm_label_0"}).value(),_popupSettings:_.assign(_.clone(n._popupSettings),{blueprint:t.CONTINUE_POPUP_BLUEPRINTS.continuePopupLimitedElixir}),open:function(e,t){return this.popup._elixirLimit=t,this.popup.setElixirLimit(t),n.open.call(this,e,t)},_getPopupMethods:function(){var e=n._getPopupMethods.call(this),t=this.WIDGET_NAMES;return _.assign(e,{setElixirLimit:function(e){this.getWidget(t.LIMIT_LABEL).string="\n"+e+""}})}})}((this||0).self||global),function(e){var t=e.kh;t.RaidContinuePopupLimitedElixir=t.ContinuePopupLimitedElixir.extend({className:"KHRaidContinuePopupLimitedElixir",ctor:function(){t.RaidContinuePopupElixir.prototype.ctor.call(this)}})}((this||0).self||global),function(e){var t=e._,n=e.kh,i=e.console;n.ContinuePopup=cc.Class.extend({className:"KHContinuePopup",CONTINUE_POPUP_TYPES:{HAS_ELIXIR:0,NO_ELIXIR:1,LIMITED_ELIXIR:2,ELIXIR_USE_LIMIT_REACHED:3},ctor:function(){this._instantiate={},this._instantiate[this.CONTINUE_POPUP_TYPES.HAS_ELIXIR]=n.createInstance.bind(null,"continuePopupElixir"),this._instantiate[this.CONTINUE_POPUP_TYPES.NO_ELIXIR]=n.createInstance.bind(null,"continuePopupNoElixir"),this._instantiate[this.CONTINUE_POPUP_TYPES.LIMITED_ELIXIR]=n.createInstance.bind(null,"continuePopupLimitedElixir"),this._instantiate[this.CONTINUE_POPUP_TYPES.ELIXIR_USE_LIMIT_REACHED]=n.createInstance.bind(null,"ElixirLimitPopup"),this._currentType=this.CONTINUE_POPUP_TYPES.NO_ELIXIR,this._elixirCount=0},updateElixirCount:function(e){this._currentType=e<=0?this.CONTINUE_POPUP_TYPES.NO_ELIXIR:this.CONTINUE_POPUP_TYPES.HAS_ELIXIR,this._elixirCount=e},decrementElixirCount:function(){t.isNumber(this._elixirCount)||i.warn("KHContinuePopup.decrementElixirCount: no elixir data received from server."),this.updateElixirCount(this._elixirCount-1)},updateElixirLimit:function(e){if(null!=e)return this._elixirLimit=e,0===e?void(this._currentType=this.CONTINUE_POPUP_TYPES.ELIXIR_USE_LIMIT_REACHED):void(this._currentType!==this.CONTINUE_POPUP_TYPES.NO_ELIXIR&&(this._currentType=this.CONTINUE_POPUP_TYPES.LIMITED_ELIXIR))},refreshPopupType:function(){this.updateElixirCount(this._elixirCount),this.updateElixirLimit(this._elixirLimit)},open:function(){var e=this._instantiate[this._currentType]();return this._currentlyOpenedPopup=e,e.open(this._elixirCount,this._elixirLimit)},dismiss:function(){var e=this._currentlyOpenedPopup;return this._currentlyOpenedPopup=null,e?e.dismiss():Q.resolve()}})}((this||0).self||global),function(e){var t=e.kh;t.RunoutPopupFactory=cc.Class.extend({create:function(){return t.createInstance("popupFactoryTextOnly").create({title:"",content:"",buttonLabels:{blueBtn:"OK"},buttonSounds:{blueBtn:t.SoundList.BUTTON_TOUCHED_CONFIRMED},buttons:{blueBtn:function(e){t.createInstance("router").navigate("quest")}},onPopupOpened:function(e,t){e.aQuestId=t.aQuestId,e.questType=t.questType}})}})}((this||0).self||global),function(e){var t=e._,n=e.kh;n.BackCheckPopupFactory=n.PopupFactory.extend({resourceName:"battle_ui_raid_back_check_popup",POPUP_METHODS:{giveUp:function(){var e=n.createInstance("questInfo");return e.isJoinedRaid()?n.createInstance("apiBattle").giveup(e.getQuestType()):n.createInstance("apiAQuests").giveupQuest(e.getQuestId(),e.getQuestType())}},create:function(e,i){var a=n.PopupFactory.prototype.create.call(this,t.assign(e,this.POPUP_PROPERTIES),i);return t.assign(a,this.POPUP_METHODS),a},onPopupOpened:function(t,i){var a=i.onCancel||function(){};n.setTouchEventHandlers(t,{"TOUCH_ENDED btn_cancel":function(){this.dismiss().then(a),n.createInstance("battleUI").setTouchEnabled(!0)},"TOUCH_ENDED btn_withdraw":function(){Q.all([this.giveUp(),this.dismiss()]).then(function(){n.createInstance("aQuestInfo").dispose(),n.createInstance("popupFactoryTextOnly").create({title:"",content:"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(){this.dismiss().then(function(){var e=n.createInstance("raidInfo").getEventId(),t=n.createInstance("questInfo"),i=t.getQuestType();console.debug("## Withdrawing battle.",i,e),n.core.router.navigateFromQuest(i,!0,t.getQuestId(),t.isOwnRaid(),e,null,t.getMasterQuestId(),t.getQuestCategory(),t.getQuestSubCategory())})}}}).open()}.bind(this)).fail(function(t){e.console.error(t)})},"TOUCH_ENDED btn_mypage":function(){this.dismiss().then(function(){n.createInstance("router").navigate("mypage")})}},t),t.seekWidgetByName("btn_cancel").setSound(n.SoundList.BUTTON_TOUCHED_CANCEL),t.seekWidgetByName("btn_mypage").setSound(n.SoundList.BUTTON_TOUCHED_DECIDE);var o=t.seekWidgetByName("btn_withdraw");null!=o&&(n.createInstance("questInfo").isUnionMajorRaidBossQuestType()?(o.setEnabled(!1),o.setColor(cc.color("#808080")),o.setSoundEnabled(!1)):(o.setEnabled(!0),o.setColor(cc.color.WHITE),o.setSound(n.SoundList.BUTTON_TOUCHED_DECIDE)))}})}((this||0).self||global),function(e){var t=e._,n=e.kh;e.console,e.cc,n.RaidMenuPopupFactory=n.PopupFactory.extend({resourceName:"battle_ui_multimenu_b_popup",POPUP_METHODS:{},create:function(e,i){var a=n.PopupFactory.prototype.create.call(this,t.assign(e,this.POPUP_PROPERTIES),i);return t.assign(a,this.POPUP_METHODS),a},onPopupOpened:function(e,t){this._initBtns(e,t)},_initBtns:function(e,t){var i=t.questType;n.setTouchEventHandlers(e,{"TOUCH_ENDED btn_ranking":function(){this.dismiss().then(function(){n.createInstance("raidRankingPopupFactory").create({}).open({questType:i})})},"TOUCH_ENDED btn_log":function(){this.dismiss().then(function(){n.createInstance("raidLogPopupFactory").create({}).open({questType:i})})},"TOUCH_ENDED btn_close":function(){this.dismiss()}},e),e.seekWidgetByName("btn_ranking").setSound(n.SoundList.BUTTON_TOUCHED_DECIDE),e.seekWidgetByName("btn_log").setSound(n.SoundList.BUTTON_TOUCHED_DECIDE),e.seekWidgetByName("btn_close").setSound(n.SoundList.BUTTON_TOUCHED_CANCEL)}})}((this||0).self||global),function(e){var t=e._,n=e.kh,i=e.cc,a=e.console;n.RescueConfirmPopupFactory=n.PopupFactory.extend({resourceName:"battle_ui_rescueconfirm_popup",CONDITIONS_TABLE:{CONDITIONS:["own_raid","other_raid","raid_full","no_union","no_friends","already_send_union","already_send_friends","already_send_all"],POPUP_SHOW:[{CONDITIONS:[0,0,1,0,0,0,0,0],VALUE:!1},{CONDITIONS:[0,1,0,0,0,1,1,1],VALUE:!1},{CONDITIONS:[0,0,0,0,0,0,0,0],VALUE:!0}],POPUP_TEXT:[{CONDITIONS:[0,0,1,0,0,0,0,0],VALUE:""},{CONDITIONS:[0,1,0,0,0,1,1,1],VALUE:""},{CONDITIONS:[0,0,0,0,0,0,0,0],VALUE:"\n\n"}],UNION_BUTTON:[{CONDITIONS:[0,0,0,1,0,0,0,0],VALUE:{ENABLED:!1,TEXT:""}},{CONDITIONS:[0,0,1,0,0,0,0,0],VALUE:{ENABLED:!1,TEXT:""}},{CONDITIONS:[0,0,0,0,0,1,0,0],VALUE:{ENABLED:!1,TEXT:""}},{CONDITIONS:[0,0,0,0,0,0,0,0],VALUE:{ENABLED:!0,TEXT:""}}],FRIEND_BUTTON:[{CONDITIONS:[0,0,0,0,1,0,0,0],VALUE:{ENABLED:!1,TEXT:""}},{CONDITIONS:[0,0,1,0,0,0,0,0],VALUE:{ENABLED:!1,TEXT:""}},{CONDITIONS:[0,1,0,0,0,0,1,0],VALUE:{ENABLED:!1,TEXT:""}},{CONDITIONS:[1,0,0,0,0,0,1,0],VALUE:{ENABLED:!1,TEXT:"{mm}{ss}"}},{CONDITIONS:[0,0,0,0,0,0,0,0],VALUE:{ENABLED:!0,TEXT:""}}],ALL_BUTTON:[{CONDITIONS:[0,0,1,0,0,0,0,0],VALUE:{ENABLED:!1,TEXT:""}},{CONDITIONS:[0,1,0,0,0,0,0,1],VALUE:{ENABLED:!1,TEXT:""}},{CONDITIONS:[1,0,0,0,0,0,0,1],VALUE:{ENABLED:!1,TEXT:"{mm}{ss}"}},{CONDITIONS:[0,0,0,0,0,0,0,0],VALUE:{ENABLED:!0,TEXT:""}}]},POPUP_DEFINITIONS:{LABEL_NAMES:{mainContentLabel:"info_label",toAll:"all_next_time_label",toFriends:"frien_next_time_label",toUnion:"union_next_time_label"},BUTTON_NAMES:{requestRescue:"btn_request_rescue",toAll:"btn_all",toFriends:"btn_friend",toUnion:"btn_union"}},POPUP_METHODS:{init:function(){this._initButtonStatus()},_initButtonStatus:function(){this.buttonStatus=t.reduce(["toAll","toFriends","toUnion"],function(e,t){return e[t]=this._createButtonStatus(t,!0,""),e}.bind(this),{})},updatePostRequestButtonStatus:function(){var e=this.seekWidgetByName(this.BUTTON_NAMES.requestRescue),n=null!=t.find(this.buttonStatus,function(e){return e.button.isTouchEnabled()&&e.selected});e.setTouchEnabled(n),e.setColor(i.color(n?"#ffffff":"#808080"))},updateExplanationText:function(e){this.seekWidgetByName(this.LABEL_NAMES.mainContentLabel).string=e},_createButtonStatus:function(e,t,n){return{selected:t,text:n,button:this.seekWidgetByName(this.BUTTON_NAMES[e]),label:this.seekWidgetByName(this.LABEL_NAMES[e])}},setButtonEnabled:function(e,t){this._setButtonEnabledByButtonStatus(this.buttonStatus[e],t)},_setButtonEnabledByButtonStatus:function(e,t){e.button.setTouchEnabled(t),this._updateButton(e),this.updatePostRequestButtonStatus()},toggleButtonSelectedState:function(e){var t=this.buttonStatus[e];t.button.isTouchEnabled()&&(t.selected=!t.selected,this._updateButton(t),this.updatePostRequestButtonStatus())},setButtonLabelText:function(e,t){var n=this.buttonStatus[e];n.text=t,this._setButtonLabelTextByButtonStatus(n)},setButtonTimerToAll:function(e){e.onRequestAllCountdownTick(this._tick.bind(this,"toAll"))},setButtonTimerToFriends:function(e){e.onRequestFriendsCountdownTick(this._tick.bind(this,"toFriends"))},_setButtonLabelTextByButtonStatus:function(e){e.label.setVisible(""!=e.text),e.label.string=e.text},_updateButtonLabelTime:function(e,n){var i=Math.floor(n/60),a=Math.floor(n%60);e.label.string=e.text.replace("{mm}",t.padZero(i,2)).replace("{ss}",t.padZero(a,2))},_tick:function(e,t){var n=this.buttonStatus[e];return 0===t?void this._reEnableButton(n):void this._updateButtonLabelTime(n,t)},_reEnableButton:function(e){e.button.isTouchEnabled()||(this._setButtonEnabledByButtonStatus(e,!0),e.text="",this._setButtonLabelTextByButtonStatus(e))},_updateButton:function(e){var t=e.selected&&e.button.isTouchEnabled();e.button.setBright(!t),e.button.setColor(i.color(t?"#ffffff":"#808080"))}},create:function(e,i){var a=n.PopupFactory.prototype.create.call(this,t.assign(e,this.POPUP_PROPERTIES),i);return t.assign(a,this.POPUP_DEFINITIONS),t.assign(a,this.POPUP_METHODS),a},onPopupOpened:function(e,t){this._setTouchEventHandlers(e,t),this._setButtonSound(e),e.init(),e.setButtonEnabled("toAll",this.needToEnableAllButton()),e.setButtonEnabled("toFriends",this.needToEnableFriendButton()),e.setButtonEnabled("toUnion",this.needToEnableUnionButton()),e.setButtonLabelText("toAll",this.getAllButtonText()),e.setButtonLabelText("toFriends",this.getFriendButtonText()),e.setButtonLabelText("toUnion",this.getUnionButtonText()),this.needTimerAllButton()&&e.setButtonTimerToAll(t.raidHelpRequestStatus),this.needTimerFriendButton()&&e.setButtonTimerToFriends(t.raidHelpRequestStatus),e.updateExplanationText(this.getPopupText()),e.updatePostRequestButtonStatus()},_setTouchEventHandlers:function(e,t){n.setTouchEventHandlers(e,{"TOUCH_ENDED btn_all":function(){this.toggleButtonSelectedState("toAll")},"TOUCH_ENDED btn_friend":function(){this.toggleButtonSelectedState("toFriends")},"TOUCH_ENDED btn_union":function(){this.toggleButtonSelectedState("toUnion")},"TOUCH_ENDED btn_request_rescue":function(){var e=this.buttonStatus;t.raidHelpRequestStatus.requestHelp(e.toAll.selected&&e.toAll.button.isTouchEnabled(),e.toFriends.selected&&e.toFriends.button.isTouchEnabled(),e.toUnion.selected&&e.toUnion.button.isTouchEnabled()).then(function(){t.raidHelpRequestStatus.clearOnTickCallbacks(),this.dismiss()}.bind(this)).fail(function(e){a.error(e)})},"TOUCH_ENDED btn_cancel":function(){t.raidHelpRequestStatus.clearOnTickCallbacks(),this.dismiss()}},e)},_setButtonSound:function(e){e.seekWidgetByName("btn_all").setSound(n.SoundList.BUTTON_TOUCHED_DECIDE),e.seekWidgetByName("btn_friend").setSound(n.SoundList.BUTTON_TOUCHED_DECIDE),e.seekWidgetByName("btn_union").setSound(n.SoundList.BUTTON_TOUCHED_DECIDE),e.seekWidgetByName("btn_request_rescue").setSound(n.SoundList.BUTTON_TOUCHED_CONFIRMED),e.seekWidgetByName("btn_cancel").setSound(n.SoundList.BUTTON_TOUCHED_CANCEL)},updateRescueRequestData:function(e){return e.fetch().then(this._updateRescueRequestStatus.bind(this),a.error).thenResolve(this)},_updateRescueRequestStatus:function(e){var t=0;n.createInstance("questInfo").isJoinedRaid()||(t|=1<<this.CONDITIONS_TABLE.CONDITIONS.indexOf("own_raid")),n.createInstance("questInfo").isJoinedRaid()&&(t|=1<<this.CONDITIONS_TABLE.CONDITIONS.indexOf("other_raid")),e.isRaidFull()&&(t|=1<<this.CONDITIONS_TABLE.CONDITIONS.indexOf("raid_full")),e.hasNotJoinedUnion()&&(t|=1<<this.CONDITIONS_TABLE.CONDITIONS.indexOf("no_union")),e.hasNoFriends()&&(t|=1<<this.CONDITIONS_TABLE.CONDITIONS.indexOf("no_friends")),e.hasAlreadySendToUnionMembers()&&(t|=1<<this.CONDITIONS_TABLE.CONDITIONS.indexOf("already_send_union")),e.hasAlreadySendToFriends()&&(t|=1<<this.CONDITIONS_TABLE.CONDITIONS.indexOf("already_send_friends")),e.hasAlreadySendToAll()&&(t|=1<<this.CONDITIONS_TABLE.CONDITIONS.indexOf("already_send_all")),this._rescueRequestStatus=t},needToShowPopup:function(){return this._getConditionTableValue("POPUP_SHOW")},getPopupText:function(){return this._getConditionTableValue("POPUP_TEXT")},getUnionButtonText:function(){return this._getConditionTableValue("UNION_BUTTON").TEXT},getFriendButtonText:function(){return this._getConditionTableValue("FRIEND_BUTTON").TEXT},getAllButtonText:function(){return this._getConditionTableValue("ALL_BUTTON").TEXT},needToEnableUnionButton:function(){return this._getConditionTableValue("UNION_BUTTON").ENABLED},needToEnableFriendButton:function(){return this._getConditionTableValue("FRIEND_BUTTON").ENABLED},needToEnableAllButton:function(){return this._getConditionTableValue("ALL_BUTTON").ENABLED},needTimerAllButton:function(){return-1!==this._getConditionTableValue("ALL_BUTTON").TEXT.search("{mm}")},needTimerFriendButton:function(){return-1!==this._getConditionTableValue("FRIEND_BUTTON").TEXT.search("{mm}")},_getConditionTableValue:function(e){var n=this.CONDITIONS_TABLE[e],i=this._rescueRequestStatus;return t.find(n,function(e){var n=t.reduce(e.CONDITIONS,function(e,t,n){return e|t<<n},0);return(i&n)===n},this).VALUE}})}((this||0).self||global),function(e){var t=e.kh;t.RaidDownPopupFactory=cc.Class.extend({create:function(){return t.createInstance("popupFactoryTextOnly").create({title:"",content:"",buttonLabels:{blueBtn:"OK"},buttonSounds:{blueBtn:t.SoundList.BUTTON_TOUCHED_CONFIRMED},buttons:{blueBtn:function(e){this.dismiss()}}})}})}((this||0).self||global),function(e){var t=(e._,e.kh);t.MyPagePopupFactory=t.PopupFactory.extend({resourceName:"battle_ui_mypage_popup",create:function(e,n){return t.PopupFactory.prototype.create.call(this,e,n)},onPopupOpened:function(e,n){t.setTouchEventHandlers(e,{"TOUCH_ENDED a_q_001_mypage_cancel":function(){this.dismiss()},"TOUCH_ENDED a_q_001_mypage_ok":function(){this.dismiss().then(function(){t.createInstance("router").navigate("mypage/my_001")})}},e),e.seekWidgetByName("a_q_001_mypage_ok").setSound(t.SoundList.BUTTON_TOUCHED_CONFIRMED),e.seekWidgetByName("a_q_001_mypage_cancel").setSound(t.SoundList.BUTTON_TOUCHED_CANCEL)}})}((this||0).self||global),function(e){var t=(e._,e.kh);t.ReliefMyPagePopupFactory=t.PopupFactory.extend({resourceName:"battle_ui_relief_mypage_popup",create:function(e,n){return t.PopupFactory.prototype.create.call(this,e,n)},onPopupOpened:function(e,n){t.setTouchEventHandlers(e,{"TOUCH_ENDED a_q_001_mypage_cancel":function(){this.dismiss()},"TOUCH_ENDED a_q_001_mypage_ok":function(){this.dismiss().then(function(){t.createInstance("router").navigate("mypage/my_001")})}},e),e.seekWidgetByName("a_q_001_mypage_ok").setSound(t.SoundList.BUTTON_TOUCHED_CONFIRMED),e.seekWidgetByName("a_q_001_mypage_cancel").setSound(t.SoundList.BUTTON_TOUCHED_CANCEL)}})}((this||0).self||global),function(e){var t=(e._,e.kh);t.ProcessPopupFactory=t.PopupFactory.extend({resourceName:"battle_ui_process_popup",create:function(e,n){return t.PopupFactory.prototype.create.call(this,e,n)},onPopupOpened:function(e,n){var i=n.cooldownTime;e.getOkButtonNode=function(){return this.seekWidgetByName("a_q_001_process_description_ok")},e.setOkButtonEnabled=function(e){var t=this.getOkButtonNode();if(null!=t){var n=e?"#FFFFFF":"#808080";t.setColor(cc.color(n)),t.setEnabled(e)}},t.setTouchEventHandlers(e,{"TOUCH_ENDED a_q_001_process_description_ok":function(){this.dismiss()}},e),e.seekWidgetByName("a_q_001_process_description_ok").setSound(t.SoundList.BUTTON_TOUCHED_CONFIRMED),e.setOkButtonEnabled(!1),Q.delay(i).then(function(){e.setOkButtonEnabled(!0)})}})}((this||0).self||global),function(e){var t=e._,n=e.kh;e.ccui,n.RaidLogPopupFactory=n.PopupFactory.extend({resourceName:"battle_ui_log",POPUP_METHODS:{},create:function(e,i){var a=n.PopupFactory.prototype.create.call(this,t.assign(e,this.POPUP_PROPERTIES),i);return t.assign(a,this.POPUP_METHODS),a},onPopupOpened:function(i,a){var o=a.questType,r=i.seekWidgetByName("shadow_bg_panel"),s=i.seekWidgetByName("btn_log_up"),c=i.seekWidgetByName("btn_log_down"),u=new n.ListViewManager(r,"battle_log_list_ui",function(e,i){var a=["line_1_action","line_2_action","line_3_damage_result","line_4_effect_result"];t.each(t.range(4),function(t){var n=e.seekWidgetByName("label_"+t),o=i[a[t]]||"";n.string=o,n.setVisible(""!==o),n.ignoreContentAdaptWithSize(!0)});var o=n.generateLogIconPath(i.job_id,i.skin);e.loadTextures({player_job_img:o.png||o.jpg}),e.seekWidgetByName("my_player_label").setVisible(i.is_mine),e.seekWidgetByName("player_fra").setVisible(i.is_mine)});u.setBtnUp(s),u.setBtnDown(c),n.createInstance("apiBattle").getBattleLog(o).then(function(e){u.setRecords(e.body.data)}).fail(function(t){e.console.error(t)}),n.setTouchEventHandlers(i,{"TOUCH_ENDED btn_close":function(){this.dismiss()}},i),i.seekWidgetByName("btn_close").setSound(n.SoundList.BUTTON_TOUCHED_CANCEL)}})}((this||0).self||global),function(e){var t=e._,n=e.kh,i=e.ccui;n.RaidRankingPopupFactory=n.BattleUIPopupFactory.extend({className:"KHRaidRankingPopupFactory",WIDGET_NAMES:{RANKING_LIST:{PREFIX:"ranking_list_",COUNT:10},PLAYER_LIST:{PREFIX:"player_",COUNT:3},JOB_IMAGE:"player_job_img",ELEMENT_ICON:"element_icon",PLAYER_NAME:"player_name_label",RANKING_ICON:"ranking_icon",IS_ME:"my_player_label",IS_DOWN:"down_icon"},RANKING_ICON_RESOURCE_NAMES:["core/res/popup/popup_layer/ranking_first.png","core/res/popup/popup_layer/ranking_second.png","core/res/popup/popup_layer/ranking_third.png"],ELEMENT_ICON_RESOURCE_NAME:{PREFIX:"battle/res/battle_ui/elementicon_",SUFFIX:".png"},_popupSettings:{resourceName:"battle_ui_ranking_popup",buttonWidgets:{closeBtn:"btn_close"},buttonLabels:{closeBtn:""},buttonSounds:{closeBtn:n.SoundList.BUTTON_TOUCHED_CANCEL},buttons:{closeBtn:function(){this.dismiss()}}},create:function(e,i){return n.BattleUIPopupFactory.prototype.create.call(this,t.assign(e,this._popupSettings),i)},configure:function(e,t){this._addMethodsToPopup(e,t)},_addMethodsToPopup:function(e,a){n.BattleUIPopupFactory.prototype._addMethodsToPopup.apply(this,arguments);var o=this.WIDGET_NAMES,r=this.RANKING_ICON_RESOURCE_NAMES,s=this.ELEMENT_ICON_RESOURCE_NAME;e.clearRankingList=function(){t.each(t.range(o.RANKING_LIST.COUNT),function(e){this.getWidget(o.RANKING_LIST.PREFIX+e).setVisible(!1)},this)}.bind(e),e.fillRankingList=function(e){t.each(t.range(Math.ceil(e.length/3)),function(n){t.each(t.range(3),function(t){var i=3*n+t,a=this.getWidget(o.RANKING_LIST.PREFIX+n),r=a.seekWidgetByName(o.PLAYER_LIST.PREFIX+t);return a.setVisible(!0),r.setVisible(!0),i>=e.length?void r.setVisible(!1):void this.fillPlayerCard(r,e[i],i)},this)},this)}.bind(e),e.fillPlayerCard=function(e,t,a){var c=n.generateLogIconPath(t.job_id,t.job_skin),u=s.PREFIX+t.element_type+s.SUFFIX;e.seekWidgetByName(o.JOB_IMAGE).loadTexture(c.jpg||c.png,i.Widget.LOCAL_TEXTURE),e.seekWidgetByName(o.ELEMENT_ICON).loadTexture(u,i.Widget.PLIST_TEXTURE),e.seekWidgetByName(o.PLAYER_NAME).string=t.player_name,a<3&&e.seekWidgetByName(o.RANKING_ICON).loadTexture(r[a],i.Widget.PLIST_TEXTURE),e.seekWidgetByName(o.RANKING_ICON).setVisible(a<3),e.seekWidgetByName(o.IS_ME).setVisible(t.is_mine),e.seekWidgetByName(o.IS_DOWN).setVisible(t.is_down)}.bind(e)},onPopupOpened:function(e,t){e.clearRankingList(),n.createInstance("apiBattle").getRanking(t.questType).then(function(t){e.fillRankingList(t.body)})}})}((this||0).self||global),function(e){var t=(e._,e.kh);e.cc,t.StampPopupFactory=t.BattleUIPopupFactory.extend({RESOURCE_NAME:"battle_ui_stamp_popup",WIDGET_NAMES:{GET_POTION_LABEL:"stamp_label_1",PAGEVIEW_PARENT:"page_stamp_list",CLOSE_BUTTON:"btn_close"},create:function(e,n){var i=this.RESOURCE_NAME,a=this._addPopupMethods(e.methods||{}),o=this._addPopupButtonWidgets(e.buttonWidgets||{}),r=this._addPopupButtons(e.buttons||{}),s=this._addPopupButtonLabels(e.buttonLabels||{}),c=this._addPopupButtonSound(e.buttonSounds||{});return this.popup=t.BattleUIPopupFactory.prototype.create.call(this,{resourceName:i,methods:a,buttonWidgets:o,buttons:r,buttonLabels:s,buttonSounds:c},n),this.popup},_addPopupMethods:function(n){var i=this.WIDGET_NAMES;return n.setGetPotionLabelVisible=function(e){this.getWidget(i.GET_POTION_LABEL).setVisible(e)},n.loadStampList=function(){t.createInstance("StampList").init(this.getWidget(i.PAGEVIEW_PARENT),this,function(n){Q.all(t.createInstance("apiBattle").postStamp(t.createInstance("questInfo").getQuestType(),n),this.dismiss()).then(function(e){var n=e.body;if(t.createInstance("notificationCenter").dispatchEvent(t.EVENT_NAME.POST_STAMP,[n.stamp_id,n.from_player_info.name]),null!=n.cure_item_status){t.createInstance("battleStatus").update(n.cure_item_status);var i=n.message;return null==i?void console.warn("KHStampPopupFactory: cure medic updated but no message data was send"):void t.createInstance("battleUI").raidMessageWindow.postMessage({job_id:i.job_id,job_skin:i.job_skin},i.line_1_action||"",i.line_2_action||"",i.line_3_damage_result||"",i.line_4_effect_result||"")}}).fail(function(t){e.console.error(t)})}.bind(this)).loadStamps()},n},_addPopupButtonWidgets:function(e){return e.closeBtn=this.WIDGET_NAMES.CLOSE_BUTTON,e},_addPopupButtons:function(e){return e.closeBtn=function(){this.dismiss()},e},_addPopupButtonLabels:function(e){return e.closeBtn="",e},_addPopupButtonSound:function(e){e.closeBtn=t.SoundList.BUTTON_TOUCHED_CANCEL}})}((this||0).self||global),function(e){var t=e._,n=e.kh;n.ElixirLimitPopupFactory=n.PopupFactoryBlack.extend({POPUP_PROPERTIES:{buttonLabels:{blackBtn:""},buttonSounds:{blackBtn:n.SoundList.BUTTON_TOUCHED_CANCEL},buttons:{blackBtn:function(){var e=n.createInstance("battleUI");e.CenterPanel.hideReviveButton(),e.MenuButton.setEnabled(!0),this.dismiss()}}},create:function(e,i){var a=n.PopupFactory.prototype.create.call(this,t.assign(this.POPUP_PROPERTIES,e),i);return a.setContent("<br />"),a}})}((this||0).self||global),function(e){var t=e._,n=e.kh;e.console,n.ElixirLimitEndBattlePopupFactory=n.PopupFactoryBlue.extend({POPUP_PROPERTIES:{buttonSounds:{blueBtn:n.SoundList.BUTTON_TOUCHED_DECIDE},buttons:{blueBtn:function(e){var t=n.createInstance("questInfo");return"prizehunt"===t.getQuestType()?void n.createInstance("questStateManager").gotoNextQuestState():void n.core.router.navigateFromQuest(t.getQuestType(),!0,t.getQuestId(),t.isOwnRaid(),(e||{}).event_id,(e||{}).epic_subject_id,t.getMasterQuestId(),t.getQuestCategory(),t.getQuestSubCategory())}}},BUTTON_TEXT:{main:"",mission:"",guerrilla:"",daily:"",accessory:"",tower_event:"",raid:"",scoreattack:"",DEFAULT:""},_giveUpResponse:null,create:function(e,i){e.buttonLabels=this._addPopupButtonLabels(e.buttonLabels||{});var a=n.PopupFactory.prototype.create.call(this,t.assign(this.POPUP_PROPERTIES,e),i);return a.setContent("<br /><br />"),a},onPopupOpened:function(e,t){},_getButtonText:function(e){return e.isRaidQuestType()?this.BUTTON_TEXT.raid:this.BUTTON_TEXT[e.getQuestType()]||this.BUTTON_TEXT.DEFAULT},_addPopupButtonLabels:function(e){var t=n.createInstance("questInfo");return e.blueBtn=this._getButtonText(t),e}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.ElixirLimitPopup=n.Class.extend({POPUP_PROPERTIES:{title:""},_endBattle:null,_popupOpenParams:null,ctor:function(e){_.isUndefined(e)&&(e=!t.createInstance("questInfo").isRaidQuestType()),this._endBattle=e},open:function(){return this._instantiatePopup().then(function(){this._popup.open(this._popupOpenParams)}.bind(this))},_instantiatePopup:function(){return this._endBattle?"prizehunt"===t.createInstance("questInfo").getQuestType()?(t.createInstance("aQuestInfo").dispose(),this._popup=t.createInstance("elixirLimitEndBattlePopupFactory").create(this.POPUP_PROPERTIES),Q.resolve()):this._giveUp().then(function(e){return _.isEmpty(e.body.scoreattack_result)?void(this._popup=t.createInstance("elixirLimitEndBattlePopupFactory").create(this.POPUP_PROPERTIES,[e.body])):(this._popup=t.ImplantedPopup.create(n.director.getRunningScene(),"scoreattack_result"),void(this._popupOpenParams={data:e.body.scoreattack_result,shouldGoQuestTop:!0,eventId:e.body.event_id}))}.bind(this)):(this._popup=t.createInstance("elixirLimitPopupFactory").create(this.POPUP_PROPERTIES),Q.resolve())},_giveUp:function(){var e=t.createInstance("questInfo");return e.isJoinedRaid()?t.createInstance("apiBattle").giveup(e.getQuestType()).fail(function(e){console.error(e&&e.stack?e.stack:e)}):t.createInstance("apiAQuests").giveupQuest(e.getQuestId(),e.getQuestType()).fail(function(e){console.error(e&&e.stack?e.stack:e)})}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.Initializer.InitializerFactory=n.Class.extend({create:function(){return this.createInitializer()},createInitializer:function(){throw new Error("abstract method")}})}((this||0).self||global),function(e){var t=e.kh;t.Initializer.CharacterInitializerFactory=t.Initializer.InitializerFactory.extend({createInitializer:function(){return t.createInstance(t.Initializer.CharacterInitializer)}})}((this||0).self||global),function(e){var t=e.kh;t.Initializer.FallenInitializerFactory=t.Initializer.InitializerFactory.extend({createInitializer:function(){return t.createInstance(t.Initializer.FallenInitializer)}})}((this||0).self||global),function(e){var t=e.kh;t.Initializer.SubInitializerFactory=t.Initializer.InitializerFactory.extend({createInitializer:function(){return t.createInstance(t.Initializer.SubInitializer)}})}((this||0).self||global),function(e){var t=e.kh||{};t.Initializer.EnemyInitializerFactory=t.Initializer.InitializerFactory.extend({createInitializer:function(){return t.createInstance(t.Initializer.EnemyInitializer)}})}((this||0).self||global),function(e){var t=e.kh;t.Initializer.LayerInitializerFactory=t.Initializer.InitializerFactory.extend({createInitializer:function(){return t.createInstance(t.Initializer.LayerInitializer)}})}((this||0).self||global),function(e){var t=e.kh;t.Initializer.BattleUIInitializerFactory=t.Initializer.InitializerFactory.extend({createInitializer:function(){return t.createInstance("BattleUIInitializer")}})}((this||0).self||global),function(e){var t=e.kh;e.cc,t.Initializer.EnemyStatusBarInitializerFactory=t.Initializer.InitializerFactory.extend({createInitializer:function(){return t.createInstance(t.Initializer.EnemyStatusBarInitializer)}})}((this||0).self||global),function(e){var t=e.kh;t.Initializer.TurnInitializerFactory=t.Initializer.InitializerFactory.extend({createInitializer:function(){return t.createInstance(t.Initializer.TurnInitializer)}})}((this||0).self||global),function(e){var t=e.kh;t.Initializer.CutInInitializerFactory=t.Initializer.InitializerFactory.extend({createInitializer:function(){return t.createInstance(t.Initializer.CutInInitializer)}})}((this||0).self||global),function(e){var t=e.kh;t.Initializer.SoundPlayerInitializerFactory=t.Initializer.InitializerFactory.extend({createInitializer:function(){return t.createInstance(t.Initializer.SoundPlayerInitializer)}})}((this||0).self||global),function(e){var t=e.kh;t.Initializer.AbilityInitializerFactory=t.Initializer.InitializerFactory.extend({createInitializer:function(){return t.createInstance(t.Initializer.AbilityInitializer)}})}((this||0).self||global),function(e){var t=e.kh;t.Initializer.SummonInitializerFactory=t.Initializer.InitializerFactory.extend({createInitializer:function(){return t.createInstance(t.Initializer.SummonInitializer)}})}((this||0).self||global),function(e){var t=e.kh;t.Initializer.StatusEffectInitializerFactory=t.Initializer.InitializerFactory.extend({createInitializer:function(){return t.createInstance(t.Initializer.StatusEffectInitializer)}})}((this||0).self||global),function(e){var t=e.kh;t.Initializer.BattleStatusInitializerFactory=t.Initializer.InitializerFactory.extend({createInitializer:function(){return t.createInstance(t.Initializer.BattleStatusInitializer)}})}((this||0).self||global),function(e){var t=e.kh;t.Initializer.StageInitializerFactory=t.Initializer.InitializerFactory.extend({createInitializer:function(){return t.createInstance(t.Initializer.StageInitializer)}})}((this||0).self||global),function(e){var t=e.kh;t.Initializer.RaidInfoInitializerFactory=t.Initializer.InitializerFactory.extend({createInitializer:function(){return t.createInstance(t.Initializer.RaidInfoInitializer)}})}((this||0).self||global),function(e){var t=e.kh;t.Initializer.TreasureInitializerFactory=t.Initializer.InitializerFactory.extend({createInitializer:function(){return t.createInstance(t.Initializer.TreasureInitializer)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.Initializer.InitializerAbstract=n.Class.extend({entity:null,init:function(){throw new Error("please overwrite")},getEntity:function(){return this.entity}})}((this||0).self||global),function(e){var t=e.kh,n=e._;t.Initializer.CharacterInitializer=t.Initializer.InitializerAbstract.extend({init:function(e){var i=e,a=t.createInstance("battleWorld"),o=a.characterPanelList,r=a.battleUI,s=t.CHARACTER_POSITION_LIST[i.length-1],c=!1,u=n.map(i,function(e,i){if(!(i>=o.length)&&o[i],n.isEmpty(e))return{};var a=t.createInstance("Character").init(e,i,o[i]);return a.initEnterBattleAnimation(s[i]),a.isJob&&(c=!0),t.createInstance("characterUpdater").setCharacter(a),a});r.setSummonBroken(!c),this.entity=u}})}((this||0).self||global),function(e){var t=e.kh,n=e._;t.Initializer.FallenInitializer=t.Initializer.InitializerAbstract.extend({init:function(e){this.entity=n(e).map(function(e,n){if(null==e)return null;var i={id:e.id,skin:e.skin,elementType:e.element_type,isJob:e.is_job,hasFallen:!0};return t.createInstance("characterUpdater").setCharacter(i),i}).compact().value()}})}((this||0).self||global),function(e){var t=e.kh,n=e._;t.Initializer.SubInitializer=t.Initializer.InitializerAbstract.extend({init:function(e){this.entity=n.map(e,function(e,i){if(n.isEmpty(e))return{};var a={index:i+t.GameConfig.PARTY_SETTINGS.MAX_AVATAR_COUNT,id:e.id,skin:e.skin,elementType:e.element_type,isJob:e.is_job};return t.createInstance("characterUpdater").setCharacter(a),a})}})}((this||0).self||global),function(e){var t=e.kh,n=e._;t.Initializer.EnemyInitializer=t.Initializer.InitializerAbstract.extend({init:function(e){var i=e,a=t.createInstance("battleWorld").enemyStatusBarList,o=t.ENEMY_POSITION_LIST[i.length-1];this.entity=n.map(i,function(e,i){if(n.isEmpty(e))return null;var r=t.createInstance("Enemy").init(e,i,a[i]);return r.initEnterBattleAnimation(o[i]),r})}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.Initializer.LayerInitializer=t.Initializer.InitializerAbstract.extend({init:function(){var e=t.createInstance(t.BattleLayer),i=t.createInstance(t.BackgroundLayer);this.entity={UIFrontLayer:new n.Layer,CutinLayer:new n.Layer,UIBackLayer:new n.Layer,EnemyLayer:new n.Layer,CharacterLayer:new n.Layer,BattleLayer:e,BackgroundLayer:i}}})}((this||0).self||global),function(e){var t=(e.cc,e.kh),n=e._;t.Initializer.BattleUIInitializer=t.Initializer.InitializerAbstract.extend({className:"battleUIInitializer",UI_OBJECT_NAMES:{SoundButton:"btn_sound",CenterPanel:"a_q_001_footer_btn_ui",AttackButton:"btn_attack",HealButton:"btn_heal",BurstButton:"btn_burst",BackButton:"a_q_001_footer_back",NextButton:"btn_next",MenuButton:"btn_menu",ReloadButton:"btn_reload",SummonButton:"summon_base_s",SummonPanels:"summon_base_l",BattleUIHeader:"info_shadow",AttributeDiagram:"diagram",CharacterPanelList:n.map(n.range(t.GameConfig.PARTY_SETTINGS.MAX_AVATAR_COUNT),function(e){return"battlecard_chara_ui_"+e}),ResultWindow:"result_window_base",AutoButton:"a_q_001_btn_auto_ui"},BUTTON_CALLBACK_REGISTRY:{ATTACK:"onPushAttackButtonCallback",BURST:"onPushBurstButtonCallback",ABILITY:"onPushAbilityButtonCallback",HEAL:"onPushHealButtonCallback",SOUND:"onPushSoundButtonCallback"},initDataKeys:{buttonCallbacks:0},entity:{BattleUI:null,CharacterPanelList:null,AttackButton:null,HealButton:null,BurstButton:null,BackButton:null,NextButton:null,MenuButton:null,SkipButton:null,SummonButton:null,SummonPanelGroup:null,ResultWindow:null,AttributeDiagram:null},init:function(e){var n=this.initDataKeys,i=e[n.buttonCallbacks][this.BUTTON_CALLBACK_REGISTRY.ATTACK],a=e[n.buttonCallbacks][this.BUTTON_CALLBACK_REGISTRY.BURST],o=e[n.buttonCallbacks][this.BUTTON_CALLBACK_REGISTRY.ABILITY],r=e[n.buttonCallbacks][this.BUTTON_CALLBACK_REGISTRY.HEAL],s=e[n.buttonCallbacks][this.BUTTON_CALLBACK_REGISTRY.SOUND];this.battleUI=t.createInstance("battleUI").init(),this._initCharacterPanels(o),this._initAttackButton(i),this._initHealButton(r),this._initBurstButton(a),this._initNextButton(),this._initMenuButton(),this._initSummonButton(),this._initSummonPanelGroup(),this._initSoundButton(s),this._initReloadButton(),this._initBattleUIHeader(),this._initResultWindow(),this._initAttributeDiagram(),this._initCenterPanel(),this.battleUI.setEnabled(!1),this.entity={BattleUI:this.battleUI,CharacterPanelList:this.battleUI.CharacterPanelList}},_initCharacterPanels:function(e){t.createInstance("characterStatusPanelHandler").init(this.battleUI),this.battleUI.CharacterPanelList=n.map(this.UI_OBJECT_NAMES.CharacterPanelList,function(n,i){return t.createInstance("CharacterPanel",[this.battleUI,n,e,i])},this)},_initSoundButton:function(e){this.battleUI.SoundButton=t.createInstance("SoundButton",[this.battleUI,this.UI_OBJECT_NAMES.SoundButton,e])},_initCenterPanel:function(){this.battleUI.CenterPanel=t.createInstance("CenterPanel",[this.battleUI,this.UI_OBJECT_NAMES.CenterPanel]).appendToLayerByLayerName(this.battleUI.LAYER_REGISTRY.CenterPanel)},_initAttackButton:function(e){this.battleUI.AttackButton=t.createInstance("AttackButton",[this.battleUI,this.UI_OBJECT_NAMES.AttackButton]).init(e)},_initHealButton:function(e){this.battleUI.HealButton=t.createInstance("HealButton",[this.battleUI,this.UI_OBJECT_NAMES.HealButton,e])},_initBurstButton:function(e){this.battleUI.BurstButton=t.createInstance("BurstButton",[this.battleUI,this.UI_OBJECT_NAMES.BurstButton,e])},_initBackButton:function(e){this.battleUI.BackButton=t.createInstance("BackButton",[this.battleUI,this.UI_OBJECT_NAMES.BackButton])},_initNextButton:function(){this.battleUI.NextButton=t.createInstance("NextButton",[this.battleUI,this.UI_OBJECT_NAMES.NextButton])},_initMenuButton:function(){this.battleUI.MenuButton=t.createInstance("MenuButton",[this.battleUI,this.UI_OBJECT_NAMES.MenuButton])},_initSkipButton:function(){this.battleUI.SkipButton=t.createInstance("SkipButton",[this.battleUI,this.UI_OBJECT_NAMES.SkipButton])},_initSummonButton:function(){this.battleUI.SummonButton=t.createInstance("SummonButton",[this.battleUI,this.UI_OBJECT_NAMES.SummonButton])},_initSummonPanelGroup:function(){this.battleUI.SummonPanelGroup=t.createInstance("SummonPanelGroup",[this.battleUI,this.UI_OBJECT_NAMES.SummonPanels])},_initReloadButton:function(){this.battleUI.ReloadButton=t.createInstance("ReloadButton",[this.battleUI,this.UI_OBJECT_NAMES.ReloadButton])},_initBattleUIHeader:function(){this.battleUI.BattleUIHeader=t.createInstance("BattleUIHeader",[this.battleUI,this.UI_OBJECT_NAMES.BattleUIHeader])},_initResultWindow:function(){this.battleUI.ResultWindow=t.createInstance("ResultWindow",[this.battleUI,this.UI_OBJECT_NAMES.ResultWindow])},_initAttributeDiagram:function(){this.battleUI.AttributeDiagram=t.createInstance("AttributeDiagram",[this.battleUI,this.UI_OBJECT_NAMES.AttributeDiagram])}})}((this||0).self||global),function(e){var t=e.kh,n=t.Initializer.BattleUIInitializer.prototype;t.Initializer.BattleUIInitializer=t.Initializer.BattleUIInitializer.extend({init:function(e){n.init.call(this,e),this._initAutoButton()},_initAutoButton:function(){this.battleUI.AutoButton=t.createInstance("AutoButton").init(this.battleUI,this.UI_OBJECT_NAMES.AutoButton)}})}((this||0).self||global),function(e){var t=e.kh;e._,t.Initializer.BattleUIInitializerNoSound=t.Initializer.BattleUIInitializer.extend({className:"battleUIInitializerNoSound",_initSoundButton:function(e){this.battleUI.SoundButton=t.createInstance("SoundButton",[this.battleUI,this.UI_OBJECT_NAMES.SoundButton,e]),this.battleUI.SoundButton.setTexture(!1)}})}((this||0).self||global),function(e){var t=e.kh,n=e._;t.Initializer.EnemyStatusBarInitializer=t.Initializer.InitializerAbstract.extend({init:function(e){var i=e.enemy,a=t.ENEMY_STATUS_BAR_JSONS[i.length-1],o=n.map(i,function(e,o){return n.isEmpty(e)?null:t.createInstance("EnemyStatusBar",[e,a,i.length,o])});this.entity=o}})}((this||0).self||global),function(e){var t=e.kh;e.cc,t.Initializer.SummonInitializer=t.Initializer.InitializerAbstract.extend({init:function(e){var n=_.map(e,function(e,n){var i=t.createInstance(t.Summon);return i.init(e,n),i});this.entity=n}})}((this||0).self||global),function(e){var t=e.kh;e.cc,t.Initializer.TurnInitializer=t.Initializer.InitializerAbstract.extend({init:function(e){var n=t.createInstance(t.Turn);n.init(e),this.entity=n}})}((this||0).self||global),function(e){var t=e.kh;e.cc,t.Initializer.CutInInitializer=t.Initializer.InitializerAbstract.extend({init:function(e){var n=t.createInstance(t.CutIn,e);this.entity=n}})}((this||0).self||global),function(e){var t=e.kh;t.Initializer.SoundPlayerInitializer=t.Initializer.InitializerAbstract.extend({init:function(){this.entity=t.createInstance("soundPlayer")}})}((this||0).self||global),function(e){var t=e.kh,n=e._;t.Initializer.AbilityInitializer=t.Initializer.InitializerAbstract.extend({init:function(e){var i,a=t.createInstance("battleWorld"),o=function(e,a){return n.isEmpty(e)?null:t.createInstance("Ability").init(e,a,i)},r=function(e,t){return n.isEmpty(e)?null:{_abilityData:e,index:t,color:e.color,getAbilityData:function(){return this._abilityData},setAbilityBanned:function(e){this._abilityData.is_banned=e},onStatusUpdate:function(e){this._abilityData.ready=0===e},isUsable:function(){return this._abilityData.ready&&!this._abilityData.is_banned}}};this.entity=n.map(e,function(e,s){return n.isEmpty(e)?[]:s>=t.GameConfig.PARTY_SETTINGS.MAX_AVATAR_COUNT?n.map(e,r):(i=a.characterPanelList[s],n.map(e,o))})}})}((this||0).self||global),function(e){var t=e.kh,n=e._,i=e.console;t.Initializer.StatusEffectInitializer=t.Initializer.InitializerAbstract.extend({init:function(e){var a={};n.each(e,function(e){try{a[e.id]=t.createInstance("StatusEffect").init(e)}catch(a){var n=t.createInstance("logger");n.reportCustomBattleData(cc.director.getRunningScene().__instanceId,{failed_status_effect_data:e},"status_effect_initialize");var o="WARNING: KHStatusEffectInitializer.init: initialize failed.";a&&(o+=a.stack),i.warn(o),n.reportJsException(o)}}),this.entity=a}})}((this||0).self||global),function(e){var t=e.kh;t.Initializer.BattleStatusInitializer=t.Initializer.InitializerAbstract.extend({init:function(){this.entity=t.createInstance("battleStatus")}})}((this||0).self||global),function(e){var t=e.kh;e.cc,e.res,t.Initializer.StageInitializer=t.Initializer.InitializerAbstract.extend({init:function(e){this.entity=t.createInstance("stage").init(e)}})}((this||0).self||global),function(e){var t=e.kh;e._,t.Initializer.RaidInfoInitializer=t.Initializer.InitializerAbstract.extend({init:function(e){this.entity=t.createInstance("raidInfo").init(e)}})}((this||0).self||global),function(e){var t=e.kh,n=e._,i=e.console;t.Initializer.TreasureInitializer=t.Initializer.InitializerAbstract.extend({init:function(e){this.entity=t.createInstance("treasureStatus"),n.each(e,function(e,n){try{this.entity.updateTreasureStatus(n,e)}catch(n){var a=t.createInstance("logger");a.reportCustomBattleData(cc.director.getRunningScene().__instanceId,{failed_treasure_data:e},"treasure_initialize");var o="WARNING: KHTreasureInitializer.init: initialize failed.";n&&(o+=n.stack),i.warn(o),a.reportJsException(o)}},this)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.Initializer.InitializerRegistry=n.Class.extend({className:"KHInitializerInitializerRegistry",createFactory:function(e){return t.createInstance(this[e].Factory)},getPropertyNameFromEntityKey:function(e){return this[e].propertyName},stage:{Factory:t.Initializer.StageInitializerFactory,propertyName:"stage"},character:{Factory:t.Initializer.CharacterInitializerFactory,propertyName:"characterList"},fallen:{Factory:t.Initializer.FallenInitializerFactory,propertyName:"fallenList"},sub:{Factory:t.Initializer.SubInitializerFactory,propertyName:"subList"},enemy:{Factory:t.Initializer.EnemyInitializerFactory,propertyName:"enemyList"},layer:{Factory:t.Initializer.LayerInitializerFactory,propertyName:{UIFrontLayer:"UIFrontLayer",UIBackLayer:"UIBackLayer",CutinLayer:"CutinLayer",BattleLayer:"BattleLayer",CharacterLayer:"CharacterLayer",EnemyLayer:"EnemyLayer",BackgroundLayer:"BackgroundLayer"}},BattleUI:{Factory:t.Initializer.BattleUIInitializerFactory,propertyName:{BattleUI:"battleUI",CharacterPanelList:"characterPanelList"}},EnemyStatusBarList:{Factory:t.Initializer.EnemyStatusBarInitializerFactory,propertyName:"enemyStatusBarList"},summon:{Factory:t.Initializer.SummonInitializerFactory,propertyName:"summonList"},turn:{Factory:t.Initializer.TurnInitializerFactory,propertyName:"turn"},cutin:{Factory:t.Initializer.CutInInitializerFactory,propertyName:"cutIn"},sound:{Factory:t.Initializer.SoundPlayerInitializerFactory,propertyName:"soundPlayer"},ability:{Factory:t.Initializer.AbilityInitializerFactory,propertyName:"characterAbilityList"},status_effect:{Factory:t.Initializer.StatusEffectInitializerFactory,propertyName:"statusEffectList"},status:{Factory:t.Initializer.BattleStatusInitializerFactory,propertyName:"battleStatus"},raid_info:{Factory:t.Initializer.RaidInfoInitializerFactory,propertyName:"raidInfo"},treasure:{Factory:t.Initializer.TreasureInitializerFactory,propertyName:"treasureStatus"}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.REDUCE_HP_ANIMATION_ATTRIBUTES={PHYSICAL:0,FIRE:1,ICE:2},t.REDUCE_HP_ANIMATION_ATTRIBUTE_PROPS=[],t.REDUCE_HP_ANIMATION_ATTRIBUTE_PROPS[t.REDUCE_HP_ANIMATION_ATTRIBUTES.PHYSICAL]={FILL_STYLE:n.color(0,0,0,255),STROKE_STYLE:n.color(255,255,255,255)},t.REDUCE_HP_ANIMATION_ATTRIBUTE_PROPS[t.REDUCE_HP_ANIMATION_ATTRIBUTES.FIRE]={FILL_STYLE:n.color(255,255,0,255),STROKE_STYLE:n.color(255,0,0,255)},t.REDUCE_HP_ANIMATION_ATTRIBUTE_PROPS[t.REDUCE_HP_ANIMATION_ATTRIBUTES.ICE]={FILL_STYLE:n.color(255,255,255,255),STROKE_STYLE:n.color(100,100,255,255)},t.REDUCE_HP_ANIMATION_FONT_SIZES={S:25,M:35,L:50},t.ReduceHPAnimation=n.Node.extend({className:"KHReduceHPAnimation",label:null,time:0,defer:null,_gravity:0,_speedX:0,ctor:function(){this._super(),this.scheduleUpdate()},initialize:function(e){this._setLabel(e)},_setLabel:function(e){var i=e.miss?"miss":e.value.toString(),a=t.REDUCE_HP_ANIMATION_FONT_SIZES[e.size.toUpperCase()],o=e.attribute,r=new n.LabelTTF(i,"Arial",a);n.sys.isNative||(r.fillStyle=t.REDUCE_HP_ANIMATION_ATTRIBUTE_PROPS[o].FILL_STYLE,r.strokeStyle=t.REDUCE_HP_ANIMATION_ATTRIBUTE_PROPS[o].STROKE_STYLE,r.lineWidth=2),this._speedX=160*(Math.random()-.5),this.defer=Q.defer(),this.label=r,this.addChild(r)},update:function(e){this.label.y+=400*e-this._gravity,this.label.x+=this._speedX*e,this.time+=200*e,this.time>70&&(this.label.opacity-=300*e,this.label.opacity<=0&&this.defer.resolve()),this._gravity+=18*e,this._speedX+=this._speedX>0?-1*e:1*e}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.REDUCE_HP_ANIMATION_FONT_SIZES={S:25,M:35,L:50},t.GainHPAnimation=n.Node.extend({className:"KHGainHPAnimation",label:null,time:0,defer:null,_speedY:0,ctor:function(){this._super(),this.scheduleUpdate()},initialize:function(e){this._setLabel(e)},_setLabel:function(e){var i=e.miss?"miss":e.value.toString(),a=t.REDUCE_HP_ANIMATION_FONT_SIZES[e.size.toUpperCase()],o=new n.LabelTTF(i,"Arial",a);o.fillStyle=n.color("00cc66",255),o.strokeStyle=n.color(255,255,255,255),o.lineWidth=2,this.defer=Q.defer(),this.label=o,this._sppedY=20,this.addChild(o)},update:function(e){this.time>50&&(this._sppedY=10),this.label.y+=Math.pow(this._sppedY,2)/400,this._sppedY+=100*e,this.time>100&&(this.label.opacity-=600*e,this.label.opacity<=0&&this.defer.resolve()),this.time+=200*e}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e.ccs,a=e._,o=e.console,r={IDLE:"avatar_normal",ATTACK:"avatar_attack",RAGING:"avatar_raging",DAMAGE:"avatar_damage",STANDBY:"avatar_standby",BURST:"avatar_burst",PINCH:"avatar_pinch",WIN:"avatar_win",ABILITY:"avatar_ability",ATTACK_DOUBLE:"avatar_attack_double",ATTACK_TRIPLE:"avatar_attack_triple",ATTACK_BY_COUNT:["avatar_attack","avatar_attack_double","avatar_attack_triple"]},s={};s[r.IDLE]={loop:!0},s[r.ATTACK]={loop:!1},s[r.RAGING]={loop:!0},s[r.DAMAGE]={loop:!0},s[r.STANDBY]={loop:!0},s[r.BURST]={loop:!1},s[r.PINCH]={loop:!0},s[r.WIN]={loop:!0},s[r.ABILITY]={loop:!1},s[r.ATTACK_DOUBLE]={loop:!1},s[r.ATTACK_TRIPLE]={loop:!1},t.AVATAR_ANIMATION_NAMES=r,t.AVATAR_ANIMATION_SETTINGS=s,t.AVATAR_EFFECT_NAMES={ATTACK:"effect_attack",BURST:"effect_burst",ABILITY_BASE:"effect_skill_base",STANDBY:"effect_standby",RECOVER:"effect_recover"},t.AVATAR_HP_ANIMATION_NAMES={REDUCE:"ReduceHPAnimation",GAIN:"GainHPAnimation"},t.AVATAR_DIE_FADEOUT_DELAY_TIME=.5,t.Avatar=n.Node.extend({className:"KHAvatar",COVER_ANIMATION_SPEED:.1,index:null,name:null,statusPanel:null,hp:null,maxHp:null,armature:null,currentAnimation:null,defaultAnimation:null,centerPos:null,ctor:function(){this._super()},initialize:function(e,n,i){this._avatarData=e,this._defineProperties(),this.index=n,this.name=e.name,this._animationSpecialEffects={},this._resumeLastInterruptedAnimations=[];var a=this._loadArmature(e);this.armature=a.armature,this._animation=a.armature.getAnimation(),this._disposeArmature=a.dispose,this._availableAnimations=this._animation.getAnimationData().movementNames,this._setupCustomCenterPosModifier(),this.statusPanel=this._initStatusPanel(i,e),this.applyPlayerGameConfig(),this.defaultAnimation=this._updateDefaultAnimation(),this._eventHandler=t.createInstance("AnimationEventHandlerCcs_1_6").init(this._animation),this._initStartAnimation(e),this.__disposed=!1},appendSpecialEffectToAnimation:function(e,n,i){if(!this._animationSpecialEffects[e]){var a=t.createInstance("WindowVisualEffect").init(n);a.setLoop(i),t.createInstance("Sound2Event",[a]),this._animationSpecialEffects[e]=a}},removeSpecialEffectFromAnimation:function(e){this._animationSpecialEffects[e]&&(this._animationSpecialEffects[e].cleanUp(),delete this._animationSpecialEffects[e])},changePosition:function(e){this.index=e,this.statusPanel.changePosition(e),this.setLocalZOrder(e)},_defineProperties:function(){var e=this._avatarData;Object.defineProperties(this,{hp:{get:function(){return e.hp},set:function(t){e.hp=t}},maxHp:{get:function(){return e.hpmax},set:function(t){e.hpmax=t}},hpPercent:{get:function(){return e.hp/e.hpmax*100}},burst:{get:function(){return e.burst},set:function(t){e.burst=t}},hitSe:{get:function(){return e.hit_se_id}},id:{get:function(){return e.id}},elementType:{get:function(){return e.element_type}}})},applyPlayerGameConfig:function(){var e=t.createInstance("playerGameConfig");this._animation.setSpeedScale(e.getBattleSpeedScale()),this.armature.scaleX/=e.getImageScale(),this.armature.scaleY/=e.getImageScale()},cleanUp:function(){this.name=null,this.hp=null,this.maxHp=null,this._disposeArmature(),this.armature=null,this._animation=null,this.defaultAnimation=null,this._eventHandler.cleanUp(),this._eventHandler=null,a.invoke(this._animationSpecialEffects||{},"cleanUp"),this._animationSpecialEffects=null,this._resumeLastInterruptedAnimations=[],this.__disposed=!0},fadeIn:function(e){return this.armature&&255!==this.armature.opacity?0===e?(this.armature.opacity=255,this.armature.updateDisplayedOpacity(),this._fadeInAllSpecialEffects(0)):Q.all([this._playFadeTo(n.fadeIn,e),this._fadeInAllSpecialEffects(e)]):Q.resolve()},fadeOut:function(e){return 0===this.armature.opacity?Q.resolve():0===e?(this.armature.opacity=0,this.armature.updateDisplayedOpacity(),this._fadeOutAllSpecialEffects(0)):Q.all([this._playFadeTo(n.fadeOut,e),this._fadeOutAllSpecialEffects(e)])},_playFadeTo:function(e,t){var i=Q.defer(),a=this._animation;a.pauseColorAnimations();var o=this,r=this.armature.updateDisplayedOpacity.bind(this.armature,void 0);return this.armature.schedule(r),this.armature.runAction(n.sequence(e(t),n.callFunc(function(){o.armature.unschedule(r),o.armature.updateDisplayedOpacity(),o.scheduleOnce(function(){a.resumeColorAnimations(),i.resolve()},.05)}))),i.promise},initEnterBattleAnimation:function(e){return null==this.ENTER_BATTLE_ANIMATION_X?void o.warn("KHAvatar.initEnterBattleAnimation: need to override"):(this.setPosNormalized(e),this.armature.x-=this.ENTER_BATTLE_ANIMATION_X,void(this.armature.y-=this.ENTER_BATTLE_ANIMATION_Y))},playEnterBattleAnimation:function(){return null==this.ENTER_BATTLE_ANIMATION_SPEED?Q.reject("KHAvatar.playEnterBattleAnimation: need to override"):(this.armature.runAction(n.sequence(n.spawn(n.moveBy(this.ENTER_BATTLE_ANIMATION_SPEED,n.p(this.ENTER_BATTLE_ANIMATION_X,0)).easing(n.easeBezierAction(0,.999,.9997,1)),n.moveBy(.9*this.ENTER_BATTLE_ANIMATION_SPEED,n.p(0,this.ENTER_BATTLE_ANIMATION_Y))),n.callFunc(this._playStartAnimation.bind(this)))),khutil.getPromiseToDelayAnimation(100))},_getDamageMovementDuration:function(){return null==this._animation?null:this._animation.getAnimationData().getMovement(this.AVATAR_ANIMATION_NAMES.DAMAGE)},_setDamageMovementDuration:function(e){null!=this._animation&&(this._getDamageMovementDuration().duration=e)},playAnimation:function(n){return!this.disposed&&(this.currentAnimation=n,this._hasAnimation(n)?t.AVATAR_ANIMATION_SETTINGS[n].loop?(this._animation.play(n),this._playAnimationSpecialEffect(n),!0):(this._animation.playWithNames([n,this.defaultAnimation]),this._playAnimationSpecialEffect(n),this.addAnimationEventCallback("complete",this._playAnimationCompleteCallback,this),!0):(e.console.error("KHAvatar.js: avatar does not have animation: "+n),n!==this.AVATAR_ANIMATION_NAMES.IDLE&&(this.playAnimation(this.AVATAR_ANIMATION_NAMES.IDLE),!1)))},_playAnimationCompleteCallback:function(){var e=this._animation._movementList;return 0===e.length?(this.currentAnimation=null,this.removeAnimationEventCallback("complete",this._playAnimationCompleteCallback),void this.playIdleAnimation()):(e.shift(),0===e.length?(this.currentAnimation=null,this.removeAnimationEventCallback("complete",this._playAnimationCompleteCallback),void this.playIdleAnimation()):(this.currentAnimation=e[0],void this._playAnimationSpecialEffect(e[0])))},_playAnimationSpecialEffect:function(e){a.each(this._animationSpecialEffects,function(e){e.pause(),e.getNode().setVisible(!1)});var t=this._animationSpecialEffects[e];null!=t&&(t.getNode().setVisible(!0),t.play(this,this.getCenterPos()))},_fadeInAllSpecialEffects:function(e){return this._fadeAllSpecialEffects(e,!0)},_fadeOutAllSpecialEffects:function(e){return this._fadeAllSpecialEffects(e,!1)},_fadeAllSpecialEffects:function(e,t){var i=t?"fadeIn":"fadeOut";return Q.all(a.map(this._animationSpecialEffects,function(a){if(!a)return Q.resolve();var o=a.getNode();if(!o)return Q.resolve();if(0===e)return o.opacity=t?255:0,Q.resolve();var r=Q.defer();return o.runAction(n.sequence(n[i](e,255),n.callFunc(function(){o.scheduleOnce(function(){r.resolve()},.05)}))),r.promise}))},_hasAnimation:function(e){return-1!==this._availableAnimations.indexOf(e)},playDieAnimation:function(){var e=this._getDamageMovementDuration();if(this.disposed||!e)return Q.resolve();this.currentAnimation=this.AVATAR_ANIMATION_NAMES.DAMAGE;var n=e.duration;return this._setDamageMovementDuration(1),this._animation.play(this.currentAnimation,-1,!1),this._animation.pause(),this.fadeOut(t.AVATAR_DIE_FADEOUT_DELAY_TIME).then(function(){this._setDamageMovementDuration(n)}.bind(this))},playAttackAnimation:function(e){if(!(a.isNumber(e)&&e>3)){var t=0;a.isNumber(e)&&(t=e-1),this.playAnimation(this.AVATAR_ANIMATION_NAMES.ATTACK_BY_COUNT[t])}},playAbilityAnimation:function(){this.playAnimation(this.AVATAR_ANIMATION_NAMES.ABILITY)},playBurstAnimation:function(){this.playAnimation(this.AVATAR_ANIMATION_NAMES.BURST)},playOnHitAnimation:function(){this.playAnimation(this.AVATAR_ANIMATION_NAMES.DAMAGE)},playOnHealAnimation:function(){},playWinAnimation:function(){this.playAnimation(this.AVATAR_ANIMATION_NAMES.WIN)},playIdleAnimation:function(){this.currentAnimation!==this.defaultAnimation&&this.playAnimation(this.defaultAnimation)},playReduceHPAnimation:function(e){t.createInstance("notificationCenter").dispatchEvent("show_damage_point",[this.getCenterPos(),e])},playGainHPAnimation:function(e){t.createInstance("notificationCenter").dispatchEvent("show_heal_point",[this.getCenterPos(),e])},playReceiveStatusEffectAnimation:function(e,n){t.createInstance("notificationCenter").dispatchEvent("show_status_effect",[this.getCenterPos(),e,n])},playCoverAnimation:function(){return Q.resolve()},resetCoverAnimation:function(){return Q.resolve()},_playCoverAnimation:function(e){var t=n.p(e.x,e.y);t.x*=n.winSize.width,t.y*=n.winSize.height;var i=this.getPos(),a=this.getLocalZOrder();return this.setLocalZOrder(this.COVER_Z_ORDER),this.resetCoverAnimation=function(){return this.setLocalZOrder(a),this._playCoverJumpAnimation(i).then(function(){this.resetCoverAnimation=function(){return Q.resolve()}}.bind(this))},this._playCoverJumpAnimation(t)},_playCoverJumpAnimation:function(e){var t=Q.defer();return this.armature.runAction(n.sequence(n.jumpTo(this.COVER_ANIMATION_SPEED,e,25,1),n.callFunc(function(){t.resolve()}))),t.promise},interruptAnimation:function(){var e=this.currentAnimation,t=this._animation._currentFrame;return this._animation.pause(),e===this.defaultAnimation||e===this._previousDefaultAnimation?void this._resumeLastInterruptedAnimations.push(this.playIdleAnimation.bind(this)):void this._resumeLastInterruptedAnimations.push(function(){this.playAnimation(e),this._animation.gotoAndPlay(t)}.bind(this))},resumeLastInterruptedAnimation:function(){a.isEmpty(this._resumeLastInterruptedAnimations)||this._resumeLastInterruptedAnimations.pop()()},_playHPChangeAnimation:function(e,n){var i=t.createInstance(n);i.initialize(e),i.label.setPosition(this.getCenterPos()),this.addChild(i),i.defer.promise.then(function(){i.unscheduleUpdate(),i.removeFromParent()})},processDamage:function(e){if(e.value<0){var t=a.assign({},e);return t.value*=-1,void this.processHeal(t)}this.playReduceHPAnimation(e),this.adjustHP(e)},processHeal:function(e){if(e.value<0){var t=a.assign({},e);return t.value*=-1,void this.processDamage(t)}this.playGainHPAnimation(e),this.adjustHP(e)},adjustHP:function(e){this.__disposed||this.hp===e.hp||(this.hp=e.hp,null!=this.statusPanel&&this.statusPanel.adjustHP(this.hp,this.hpPercent),this._previousDefaultAnimation=this.defaultAnimation,this.defaultAnimation=this._updateDefaultAnimation(),this._updateQueuedDefaultAnimation(this._previousDefaultAnimation,this.defaultAnimation))},setPos:function(e){this.armature.setPosition(e),this._setCenterPos()},setPosNormalized:function(e){var t=n.p(e.x,e.y);t.x*=n.winSize.width,t.y*=n.winSize.height,this.armature.setPosition(t),this._setCenterPos()},getPos:function(){return this.armature.getPosition()},getPosOnAvatar:function(e){var t=this._getVirtualRect();return n.p(t.x+t.width*e.x,t.y+t.height*e.y)},getCenterPos:function(){return this._updateCenterPos(),this.centerPos},_getRect:function(){var e=this.armature;return n.rect(e.x-e.width*e.anchorX,e.y-e.height*e.anchorY,e.width,e.height)},_getVirtualRect:function(){var e=this.getCenterPos(),t=this._getRect(),i=n.rect(0,0,0,0);return i.width=2*Math.min(e.x-t.x,t.x+t.width-e.x),i.height=2*Math.min(e.y-t.y,t.y+t.height-e.y),i.x=e.x-i.width/2,i.y=e.y-i.height/2,i},_updateCenterPos:function(){this._setCenterPos()},_loadArmature:function(e){var t=this._res.ExportJson,r=e.armature_name;try{i.armatureDataManager.addArmatureFileInfo(t)}catch(e){o.error("Failed to obtain avatar animation resource: name: "+this.name+", id: "+this.id)}a.isString(r)||(r=i.armatureDataManager.getRelativeData(t).armatures[0]);var s=i.Armature.create(r);this.addChild(s);return{armature:s,dispose:function(){n.spriteFrameCache.removeSpriteFramesFromFile(t),i.armatureDataManager.removeArmatureFileInfo(t),s.removeFromParent()}}},clone:function(){var e=this._res.ExportJson,t=this._avatarData.armature_name;try{i.armatureDataManager.addArmatureFileInfo(e)}catch(e){o.error("Failed to obtain avatar animation resource: name: "+this.name+", id: "+this.id)}a.isString(t)||(t=i.armatureDataManager.getRelativeData(e).armatures[0]);var n=i.Armature.create(t),s=new ccui.Widget;return s.setContentSize(n.getContentSize()),s.setAnchorPoint(this.getAnchorPoint()),s.addChild(n),n.getAnimation().play(r.IDLE),s},_initStartAnimation:function(e){this._startAnimation=t.AVATAR_ANIMATION_NAMES[e.start_animation.toUpperCase()]||t.AVATAR_ANIMATION_NAMES.IDLE},_playStartAnimation:function(){null==this.currentAnimation&&(this._animation.playWithIndex(0,0,0),this.playIdleAnimation())},_setupCustomCenterPosModifier:function(){var e=this.armature.getBoneDic().position_config;if(e){var t=e.getDisplayManager().getDecorativeDisplayList()[0];return null==t?void o.warn("KHAvatar._setupCustomCenterPosModifier: position config bone found, but no texture is set"):void(this._centerPosModifier=t.getDisplay().getAnchorPoint())}},_setCenterPos:function(){var e,t,i=this.armature;return null==i?(this.centerPos.x=null==this.centerPos.x?-1e3:this.centerPos.x,void(this.centerPos.y=null==this.centerPos.y?-1e3:this.centerPos.y)):(this._centerPosModifier?(e=i.x+i.width*(this._centerPosModifier.x-i.anchorX),t=i.y+i.height*(this._centerPosModifier.y-i.anchorY)):(e=i.x,t=i.y+i.height*(.5-i.anchorY)),void(this.centerPos=n.p(e,t)))},setDefaultAnimation:function(e){if(!this._hasAnimation(e))return this.defaultAnimation=t.AVATAR_ANIMATION_NAMES.IDLE,void o.warn("KHAvatar.setDefaultAnimation: animation name not found: "+e);var n=this.defaultAnimation;this.defaultAnimation=e;var i=this._animation._movementList.indexOf(n);-1!==i&&this._animation._movementList.splice(i,1,e)},updateDefaultAnimation:function(){var e=this.currentAnimation===this.defaultAnimation;this.setDefaultAnimation(this._updateDefaultAnimation()),e&&this.playIdleAnimation()},_updateDefaultAnimation:function(){return t.AVATAR_ANIMATION_NAMES.IDLE},_updateQueuedDefaultAnimation:function(e,t){if(e!==t){var n=this._animation._movementList;if(this.currentAnimation===e&&this.playAnimation(t),0!==n.length){var i=n.indexOf(e);-1!==i&&(n[i]=t)}}},_initStatusPanel:function(){},addAnimationEventCallback:function(e,t,n){this._eventHandler.addAnimationEventCallback(e,t,n)},removeAnimationEventCallback:function(e,t){null!=this._eventHandler&&this._eventHandler.removeAnimationEventCallback(e,t)},removeAnimationEventName:function(e){this._eventHandler.removeAnimationEventName(e)},removeAllAnimationEventCallbacks:function(){this._eventHandler.removeAllAnimationEventCallbacks()},pauseEventListening:function(){this._eventHandler.enableEventListening(!1)},resumeEventListening:function(){this._eventHandler.enableEventListening(!0)},appendTo:function(e){e.addChild(this,this.index)},getLayer:function(){return this.getParent()}})}((this||0).self||global),function(e){var t=e.kh;t.Character=t.Avatar.extend({className:"KHCharacter",AVATAR_ANIMATION_NAMES:_.assign(_.clone(t.AVATAR_ANIMATION_NAMES),{}),ANIMATION_SPECIAL_EFFECTS:_.invert({battle_standby_aura:t.AVATAR_ANIMATION_NAMES.STANDBY}),ENTER_BATTLE_ANIMATION_SPEED:.3,ENTER_BATTLE_ANIMATION_X:-400,ENTER_BATTLE_ANIMATION_Y:-30,COVER_Z_ORDER:3,ON_PANEL_SHOW_SOUND_COOLDOWN_LENGTH:500,ctor:function(){this._super()},init:function(e,n,i){var a=t.createInstance("battleUrlParser").resources;return this._res=e.is_job?a.job[e.id]:a.avatar[e.id],this.initialize(e,n,i),this},changePosition:function(e){t.Avatar.prototype.changePosition.call(this,e);var n=t.CHARACTER_POSITION_LIST[t.createInstance("battleWorld").characterList.length-1];this.setPosNormalized(n[e])},_defineProperties:function(){var e=this._avatarData;t.Avatar.prototype._defineProperties.call(this),Object.defineProperties(this,{isJob:{get:function(){return e.is_job},set:function(t){e.is_job=t}},skin:{get:function(){return e.skin}},isBurstBanned:{get:function(){return!!e.is_burst_banned}},max_burst:{get:function(){return Math.max(100,e.max_burst)}}})},processHeal:function(e){t.Avatar.prototype.processHeal.call(this,e),e.burst_gauge_amount&&this.adjustBurstGauge(e.burst_gauge_amount)},adjustBurstGauge:function(e){this.__disposed||(this.burst!==e&&(this.burst=e,this.statusPanel&&this.statusPanel.updateBurstGauge()),this._previousDefaultAnimation=this.defaultAnimation,this.defaultAnimation=this._updateDefaultAnimation(),this._updateQueuedDefaultAnimation(this._previousDefaultAnimation,this.defaultAnimation))},cleanUp:function(){t.Avatar.prototype.cleanUp.call(this),null!=this.statusPanel&&(this.statusPanel.clearOnStatusPanelShowCallbacks(),this.statusPanel.disable(),this.statusPanel=null)},playCoverAnimation:function(){return this._playCoverAnimation(t.CHARACTER_POSITION_COVER)},getPinchTreshhold:function(){return this.maxHp/4},setBurstBanned:function(e){this.__disposed||(this._avatarData.is_burst_banned=e,this.statusPanel&&this.statusPanel.setBurstBanned(e),this._previousDefaultAnimation=this.defaultAnimation,this.defaultAnimation=this._updateDefaultAnimation(),this._updateQueuedDefaultAnimation(this._previousDefaultAnimation,this.defaultAnimation))},appendTo:function(e){e.addChild(this,t.CHARACTER_Z_ORDER_MAP["CHARACTER_"+this.index])},startOnShowPanelSoundCooldown:function(){this._onShowPanelSoundCooldown=setTimeout(function(){this._onShowPanelSoundCooldown=0}.bind(this),this.ON_PANEL_SHOW_SOUND_COOLDOWN_LENGTH)},_initStatusPanel:function(t,n){return null==t?(e.console.warn("KHCharacter._initStatusPanel: no status panel found"),null):(t.insertData(n),t.addOnStatusPanelShowCallback(this._playOnStatusPanelOpenSound,this),t.enable(),t)},_updateDefaultAnimation:function(){if(this.__disposed)return t.AVATAR_ANIMATION_NAMES.PINCH;if(this.burst>=100&&!this.isBurstBanned&&t.createInstance("battleUI").isFlgUseSpecialAttack()||this.statusPanel&&this.statusPanel.isOpened()){var e=t.AVATAR_ANIMATION_NAMES.STANDBY;return this.appendSpecialEffectToAnimation(e,res[this.ANIMATION_SPECIAL_EFFECTS[e]],!0),e}return this.removeSpecialEffectFromAnimation(t.AVATAR_ANIMATION_NAMES.STANDBY),this.hp<this.getPinchTreshhold()?t.AVATAR_ANIMATION_NAMES.PINCH:t.AVATAR_ANIMATION_NAMES.IDLE},_playOnStatusPanelOpenSound:function(){t.createInstance("playerGameConfig").isSeOn()&&!this._onShowPanelSoundCooldown&&(_.each(t.createInstance("battleWorld").characterList,function(e){_.isEmpty(e)||e.startOnShowPanelSoundCooldown()}),this._getOnStatusPanelOpenSound().then(function(e){t.createInstance("soundPlayer").playSoundEffect(e)}.bind(this)))},_getOnStatusPanelOpenSound:function(){if(!this._res.se){var e=t.IDList.VOICES.PANEL_OPEN;this._res.se=t.generateAvatarSoundPaths(this.id,this.isJob,e.LOWER,e.UPPER)}var n=this._res.se[0];return cc.loader.getRes(n)?Q.resolve(n):t.loader.load(n)}})}((this||0).self||global),function(e){var t=e.kh;t.Enemy=t.Avatar.extend({className:"KHEnemy",AVATAR_ANIMATION_NAMES:_.assign(_.clone(t.AVATAR_ANIMATION_NAMES),{ABILITY:"avatar_attack"}),ENTER_BATTLE_ANIMATION_SPEED:.3,ENTER_BATTLE_ANIMATION_X:400,ENTER_BATTLE_ANIMATION_Y:-30,COVER_Z_ORDER:1,defaultAnimation:t.AVATAR_ANIMATION_NAMES.IDLE,ctor:function(){this._super()},init:function(e,n,i){var a=t.createInstance("battleUrlParser").resources;return this._res=a.enemy[e.id],this.initialize(e,n,i),this},_defineProperties:function(){var e=this._avatarData;t.Avatar.prototype._defineProperties.call(this),Object.defineProperties(this,{isBoss:{get:function(){return e.has_mode_gauge}},currentMode:{get:function(){return this._currentMode||e.current_mode}}})},cleanUp:function(){t.Avatar.prototype.cleanUp.call(this),this.statusPanel&&this.statusPanel.cleanUp(),this.statusPanel=null},changePosition:function(e){t.Avatar.prototype.changePosition.call(this,e);var n=t.ENEMY_POSITION_LIST[t.createInstance("battleWorld").enemyList.length-1];this.setPosNormalized(n[e])},setDefaultNormalMode:function(){this._currentMode="normal",this.setDefaultAnimation(t.AVATAR_ANIMATION_NAMES.IDLE)},setDefaultStunMode:function(){this._currentMode="stun",this.setDefaultAnimation(t.AVATAR_ANIMATION_NAMES.PINCH)},setDefaultRagingMode:function(){this._currentMode="raging",this.setDefaultAnimation(t.AVATAR_ANIMATION_NAMES.RAGING)},playDieAnimation:function(){if(this.isBoss){var e=t.generateGenericSoundPath(t.BattleGenericSeIdList.bossDown).mp3;t.createInstance("soundPlayer").playSoundEffect(e)}return t.Avatar.prototype.playDieAnimation.call(this)},playCoverAnimation:function(){return this._playCoverAnimation(t.ENEMY_POSITION_COVER)},_updateDefaultAnimation:function(){return"raging"===this.currentMode?t.AVATAR_ANIMATION_NAMES.RAGING:"stun"===this.currentMode?t.AVATAR_ANIMATION_NAMES.PINCH:t.AVATAR_ANIMATION_NAMES.IDLE},_initStatusPanel:function(e){return e.adjustHitboxPosToAvatar(this.armature),e}})}((this||0).self||global),function(e){var t=e.kh;t.RaidEnemy=t.Enemy.extend({className:"KHRaidEnemy",init:function(e,n,i){return this._lastUpdates={},t.Enemy.prototype.init.call(this,e,n,i)},checkUpdateRequired:function(e,t){return(null==this._lastUpdates[e]||this._lastUpdates[e]<t)&&(this._lastUpdates[e]=t,!0)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.console;t.AvatarOrderHandler=n.Class.extend({className:"AvatarOrderHandler",MAX_PLAYER_AVATAR_COUNT:t.GameConfig.PARTY_SETTINGS.MAX_AVATAR_COUNT,MAX_SUB_COUNT:t.GameConfig.PARTY_SETTINGS.MAX_SUB_COUNT,MAX_ENEMY_COUNT:t.GameConfig.BATTLE_SETTINGS.MAX_ENEMY_COUNT,movePlayers:function(e){var n=t.createInstance("battleWorld");this._moveAvatars(e,n.characterList,"character",n)},moveEnemies:function(e){var n=t.createInstance("battleWorld");this._moveAvatars(e,n.enemyList,"enemy",n)},_moveAvatars:function(e,n,o,r){if(this._verifyData(e)){var s=[],c={},u="character"===o?r.characterPanelList.slice(0):r.enemyList.slice(0),l="character"===o?r.characterAbilityList.slice(0):[],_=[];i.each(e,function(e){if(!("character"===o&&e.from_pos>=this.MAX_PLAYER_AVATAR_COUNT)){var p=c[e.from_pos]||n[e.from_pos];if(null==p)return void a.warn("kh.AvatarOrderHandler._moveAvatars: avatar index "+e.from_pos+" not found");if(i.isEmpty(p)&&t.createInstance("FallenAvatarOrderHandler").moveFallenByCharacterIndex(e.from_pos,e.to_pos),c[e.from_pos]=null,n[e.from_pos]===p&&(n[e.from_pos]=null,s.push(e.from_pos)),"character"===o&&e.to_pos>=this.MAX_PLAYER_AVATAR_COUNT){var d=p.statusPanel||u[e.from_pos];return _.push(d),void this._removeAvatar(p,o,r)}if(null==e.to_pos)return void this._removeAvatar(p,o,r);null!=n[e.to_pos]&&(c[e.to_pos]=n[e.to_pos]),n[e.to_pos]=p,this["_reassign"+i.capitalize(o)+"StatusPanel"](p.statusPanel||u[e.from_pos],e,r),"character"===o&&this._reassignAbilities(l[e.from_pos],e,r),i.pull(s,e.to_pos),p.changePosition&&p.changePosition(e.to_pos)}},this),this._autoReassignOverlappingAvatars(n,c,s,o),this._repositionRoamingStatusPanels(_,s,r),this._clearBattleStatusCache(o)}},_verifyData:function(e){if(null==e)return!1;var t=i.pluck(e,"from_pos"),n=i.pluck(e,"to_pos"),o=!1;return i.each(e,function(e){return-1===t.indexOf(e.from_pos)?(a.warn("kh.AvatarOrderHandler._verifyData: duplicate data found, aborting avatar order change command"),o=!0,!1):(t.shift(e.from_pos),null!=e.to_pos?-1===n.indexOf(e.to_pos)?(a.warn("kh.AvatarOrderHandler._verifyData: duplicate data found, aborting avatar order change command"),o=!0,!1):void n.shift(e.to_pos):void 0)}),!o},_autoReassignOverlappingAvatars:function(e,t,n,o){var r=i.compact(i.values(t));0!==r.length&&(a.warn("kh.AvatarOrderHandler._autoReassignOverlappingAvatars: overlapping avatars found after avatar positions reorder command finished, auto-reordering"),i.each(r,function(t){if(0!==n.length){var r=n.shift();e[r]=t,"sub"!==o&&(t.changePosition(r),this["_reassign"+i.capitalize(o)+"StatusPanel"](t.statusPanel,r))}else a.warn("kh.AvatarOrderHandler._moveAvatars: overlapping avatar positions and empty spaces do not match")},this))},_repositionRoamingStatusPanels:function(e,t,n){i.each(e,function(e){var o;if(0===t.length){a.warn("kh.AvatarOrderHandler._repositionRoamingStatusPanels: no available slot to reposition roaming status panel to");var r=i.invoke(n.battleUI.CharacterPanelList,"getPos");if(i.each(i.range(this.MAX_PLAYER_AVATAR_COUNT),function(e){if(-1===r.indexOf(e))return o=e,!1},this),!o)return void a.warn("kh.AvatarOrderHandler._repositionRoamingStatusPanels: auto reassign status panel failed")}else o=t.shift();n.characterPanelList[o]=e,n.battleUI.CharacterPanelList[o]=e,e.changePosition(o)})},_reassignCharacterStatusPanel:function(e,t,n){null!=e&&(n.battleUI.CharacterPanelList[t.to_pos]=e,n.characterPanelList[t.to_pos]=e,e.changePosition(t.to_pos))},_reassignAbilities:function(e,t,n){null!=e&&(n.characterAbilityList[t.to_pos]=e)},_clearEnemyStatusPanel:function(e,t){t.enemyStatusBarList[e.from_pos]={}},_reassignEnemyStatusPanel:function(e,t,n){n.enemyStatusBarList[t.to_pos]=e},_removeAvatar:function(e,t,n){i.isEmpty(e)||this["_remove"+i.capitalize(t)](e,n)},_removeCharacter:function(e,t){e.cleanUp()},_removeEnemy:function(e){e.cleanUp()},_clearBattleStatusCache:function(e){"enemy"===e?this._clearEnemyBattleStatusCache(t.createInstance("battleStatus")):this._clearPlayerBattleStatusCache(t.createInstance("battleStatus"))},_clearEnemyBattleStatusCache:function(e){e.forceNextUpdate(e.CACHE_INDEX.ENEMIES)},_clearPlayerBattleStatusCache:function(e){e.forceNextUpdate(e.CACHE_INDEX.PARTY_MEMBERS),e.forceNextUpdate(e.CACHE_INDEX.ABILITY_TURNS),e.forceNextUpdate(e.CACHE_INDEX.ABILITY_BANS),e.forceNextUpdate(e.CACHE_INDEX.BURST_BANS)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.console;t.FallenAvatarOrderHandler=n.Class.extend({className:"FallenAvatarOrderHandler",MAX_PLAYER_AVATAR_COUNT:t.GameConfig.PARTY_SETTINGS.MAX_AVATAR_COUNT,MAX_SUB_COUNT:t.GameConfig.PARTY_SETTINGS.MAX_SUB_COUNT,ctor:function(){var e=t.createInstance("battleWorld");this._characterList=e.characterList,this._subList=e.subList,this._fallenList=e.fallenList},getFallenPos:function(e){var t=-1;return null==e||null==this._fallenList?t:(i.each(this._characterList,function(n,a){return!(a>=e.length)&&(i.isEmpty(n)&&e[a]===e?(t=a,!1):void 0)}),t)},getFallenIndex:function(e){return this._fallenList.indexOf(e)},registerCharacterAsFallen:function(e){var t=this.convertCharacterIndexToFallenIndex(e.index),n=this.extractFallenDataFromCharacter(e);this._fallenList.splice(t,0,n)},reportFallenAsRevived:function(e){this._fallenList.splice(this.getFallenIndex(e),1)},removeFallenByCharacterIndex:function(e){this.reportFallenAsRevived(this.getFallenByCharacterIndex(e))},extractFallenDataFromCharacter:function(e){return{id:e.id,index:e.index,skin:e.skin,elementType:e.elementType,isJob:e.isJob,maxHp:e.maxHp,name:e.name,hasFallen:!0}},getFallenByCharacterIndex:function(e){var t=this.convertCharacterIndexToFallenIndex(e);return t>=this._fallenList.length?null:this._fallenList[t]},convertCharacterIndexToFallenIndex:function(e){if(e<0)return-1;var t=0;return i.each(i.range(e),function(e){return e<this._characterList.length&&i.isEmpty(this._characterList[e])?void t++:void((e-=this.MAX_PLAYER_AVATAR_COUNT)<0||e>=this._subList.length||i.isEmpty(this._subList[e])&&t++)},this),t},moveFallenByCharacterIndex:function(e,t){var n=this._fallenList[this.convertCharacterIndexToFallenIndex(e)];if(null!=n){if(i.pull(this._fallenList,n),null!=t&&-1!==t){var o=this.convertCharacterIndexToFallenIndex(t);this._fallenList.splice(o,0,n)}}else a.warn("KHFallenAvatarOrderHandler.moveFallenByCharacterIndex: fallen not found.")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.console;t.CharacterUpdater=n.Class.extend({className:"CharacterUpdater",MAX_PLAYER_AVATAR_COUNT:t.GameConfig.PARTY_SETTINGS.MAX_AVATAR_COUNT,MAX_SUB_COUNT:t.GameConfig.PARTY_SETTINGS.MAX_SUB_COUNT,MAX_ENEMY_COUNT:t.GameConfig.BATTLE_SETTINGS.MAX_ENEMY_COUNT,ctor:function(){this._characters={},this._battleWorld=t.createInstance("battleWorld")},_getFallenOrderHandler:function(){return t.createInstance("FallenAvatarOrderHandler")},setCharacter:function(e){null!=e.id&&this._registerCharacter(e)},updateCharacter:function(e,t){if(null!=t.id){var n=this._createCharacterData(t),i=this._getCharacterByCharacterData(n);if(null!=i){var a=this._createCharacterData(i);this._updateStats(i,n,e);var o=this._createCharacterData(i);this._needsConvert(a,o)&&this._convertCharacter(a,o),this._needsToChangePos(a,o)&&this._changePos(a,o)}}},_needsConvert:function(e,t){return this._getCharacterType(e)!==this._getCharacterType(t)},_getCharacterByCharacterData:function(e){return this._characters[this._getCharacterCacheKey(e)]},_registerCharacter:function(e){var t=this._createCharacterData(e),n=this._getCharacterCacheKey(t);this._characters[n]=e},_getCharacterCacheKey:function(e){var t=e.id;return e.isJob&&(t=t.toString()+"j"),t},_needsToChangePos:function(e,t){return e.index!==t.index||"fallen"===this._getCharacterType(t)},_changePos:function(e,t){var n=this._getCharacterType(t);this["_change"+i.capitalize(n)+"Pos"](e,t)},_changeAvatarPos:function(e,t,n){a.warn("KHCharacterUpdater: main character positions do not match with the provided status data.")},_changeSubPos:function(e,t){this._battleWorld.subList[t.index-this.MAX_PLAYER_AVATAR_COUNT]=this._getCharacterByCharacterData(t)},_changeFallenPos:function(e,o){var r=this._getCharacterByCharacterData(o);this._getFallenOrderHandler().reportFallenAsRevived(r),this._getFallenOrderHandler().registerCharacterAsFallen(r);var s=this._getFallenOrderHandler().getFallenByCharacterIndex(o.index);if(null==s){var c=t.createInstance("logger");c.reportBattleCharacterStatus(n.director.getRunningScene().__instanceId,{character_updater:i.reduce(this._characters,function(e,t,n){return e[n]=this._createCharacterData(t),e}.bind(this),{}),character_list:i.map(t.createInstance("battleWorld").characterList,function(e,t){return this._createCharacterData(e)},this),sub_list:i.cloneDeep(t.createInstance("battleWorld").subList),fallen_list:i.cloneDeep(t.createInstance("battleWorld").fallenList)});var u="WARNING: KHCharacterUpdater._changeFallenPos: invalid fallen data.";a.warn(u),c.reportJsException(new Error(u))}else this._registerCharacter(s);o.index>=0&&o.index<this.MAX_PLAYER_AVATAR_COUNT&&(this._battleWorld.characterList[o.index]={}),o.index>=this.MAX_PLAYER_AVATAR_COUNT&&o.index<this.MAX_PLAYER_AVATAR_COUNT+this.MAX_SUB_COUNT&&(this._battleWorld.subList[o.index-this.MAX_PLAYER_AVATAR_COUNT]={})},_updateStats:function(e,t,n){e.isJob=t.isJob,e.burst=t.burst,e.hp=t.hp,e.maxHp=t.maxHp,e.name=t.name,e.index=n,e.hasFallen=t.hasFallen||0===t.hp},_getCharacterType:function(e){return e.hasFallen?"fallen":e.index>=this.MAX_PLAYER_AVATAR_COUNT?"sub":"avatar"},_createCharacterData:function(e){return null==e?(a.warn("KHCharacterUpdater._createCharacterData: no character data passed."),{}):{id:e.id,isJob:e.isJob||e.is_job||"job"===e.avatar_type,burst:e.burst||0,hp:e.hp||0,maxHp:e.maxHp||e.max_hp,name:e.name,index:e.index,hasFallen:e.hasFallen||!1}},_convertCharacter:function(e,t){var n=this._getCharacterType(e),a=this._getCharacterType(t),o=this._getCharacterByCharacterData(t);return"fallen"===n&&this._getFallenOrderHandler().reportFallenAsRevived(o),this["_convertCharacterTo"+i.capitalize(a)](o)},_convertCharacterToSub:function(e){var t={index:e.index,id:e.id,skin:e.skin,elementType:e.elementType,isJob:e.isJob};return this._registerCharacter(t),this._battleWorld.subList[e.index-this.MAX_PLAYER_AVATAR_COUNT]=t,t},_convertCharacterToFallen:function(e){this._getFallenOrderHandler().registerCharacterAsFallen(e);var t=this._getFallenOrderHandler().getFallenByCharacterIndex(e.index);return this._registerCharacter(t),e.index>=0&&e.index<this.MAX_PLAYER_AVATAR_COUNT&&(this._battleWorld.characterList[e.index]={}),e.index>=this.MAX_PLAYER_AVATAR_COUNT&&e.index<this.MAX_PLAYER_AVATAR_COUNT+this.MAX_SUB_COUNT&&(this._battleWorld.subList[e.index-this.MAX_PLAYER_AVATAR_COUNT]={}),i.isFunction(e.cleanUp)&&e.cleanUp(),t},_convertCharacterToAvatar:function(e){var t=i.find(this._battleWorld.characterList,function(t){return t&&t.id===e.id});return null==t?void a.warn("KHCharacterUpdater._convertCharacterToCharacter: avatar data not found."):(this._registerCharacter(t),t)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.Turn=n.Node.extend({PLAYER_ANIMATION_TIMER:0,TURN_ANIMATION_TIMER:300,ENEMY_ANIMATION_TIMER:300,TURN_ANIMATION_NAMES:{PLAYER:"animation2",ENEMY:"animation1",TURN:"animation0"},MAX_SIMULTANEOUS_ANIMATIONS:2,turnNumber:0,defer:null,init:function(e){this.setTurnNumber(e.number),this.setSummonLocked(e.summon_used),this._preloadTurnAnimations()},_preloadTurnAnimations:function(){this._turnAnimations=_(this.MAX_SIMULTANEOUS_ANIMATIONS).range().map(this._preloadAnimation,this).value()},_preloadAnimation:function(){var e=t.createInstance("WindowVisualEffect");return e.init(res.battle_ui_turn_animation,this),e.setLoop(!1),e.getNode().setVisible(!1),_(this.TURN_ANIMATION_NAMES).each(function(t){this._setHideOnAnimationEndEvent(t,e)},this),e},_setHideOnAnimationEndEvent:function(e,t){t.setAnimationNameEndCallback(e,function(){t.getNode().setVisible(!1)},t)},_getNextTurnAnimation:function(){var e=this._turnAnimations.shift();return this._turnAnimations.push(e),e},setTurnNumber:function(e){this.turnNumber=e},incrementTurn:function(){this.turnNumber++},playPlayerTurnAnimation:function(){var e=this._getNextTurnAnimation();return e.playByName(this.TURN_ANIMATION_NAMES.PLAYER,this,t.NODE_POSITION.BATTLE_BOTTOM_LEFT),e.getNode().setVisible(!0),Q.delay(this.PLAYER_ANIMATION_TIMER)},playTurnNumberAnimation:function(){var e=this._getNextTurnAnimation(),n=e.getNode();return n.seekWidgetByName("turnplate_no").setString(""+this.turnNumber),e.playByName(this.TURN_ANIMATION_NAMES.TURN,this,t.NODE_POSITION.BATTLE_BOTTOM_LEFT),n.setVisible(!0),Q.delay(this.TURN_ANIMATION_TIMER)},playEnemyTurnAnimation:function(){var e=this._getNextTurnAnimation();return e.playByName(this.TURN_ANIMATION_NAMES.ENEMY,this,t.NODE_POSITION.BATTLE_BOTTOM_LEFT),e.getNode().setVisible(!0),Q.delay(this.ENEMY_ANIMATION_TIMER)},_runTurnAnimationSequence:function(e,t,i){this.defer=Q.defer();var a=n.sequence(n.moveBy(.5,n.p(t,i)).easing(n.easeOut(3)),n.delayTime(.3),n.fadeOut(.2),n.callFunc(function(){this.removeChild(e),this.defer.resolve()},this));return e.runAction(a),this.defer.promise},setSummonLocked:function(e){t.createInstance("battleWorld").battleUI.setSummonLocked(e)},resetTurn:function(){return this.setSummonLocked(!1),Q.resolve()}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e._,t.CutIn=n.Node.extend({className:"CutIn",ctor:function(){this._super(),this._playerBurstCutinCommandHandler=t.createInstance("CutinHandlerPlayerBurst"),this._playerBeatdownCutinCommandHandler=t.createInstance("CutinHandlerPlayerBeatdown"),this._burstStreakCutinCommandHandler=t.createInstance("CutinHandlerBurstStreak")},playBurstCutInAnimation:function(){return this._playerBurstCutinCommandHandler.play()},playBeatdownCutInAnimation:function(){return this._playerBeatdownCutinCommandHandler.play()},playBurstStreakCutInAnimation:function(){return this._burstStreakCutinCommandHandler.play()},queueCutinCommand:function(e){this["_"+e.getType()+"CutinCommandHandler"].queueCutinCommand(e)},createCutinEffect:function(e){var t;return null!=e.getPosList()&&(t=e.getPosList().length),this["_"+e.getType()+"CutinCommandHandler"].createCutinEffect(t)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;t.CutInHandler={},t.CutInHandler.Abstract=n.Class.extend({className:"CutInHandlerAbstract",NODE_NAMES:{},EVENT_NAMES:{ANIMATION_START:"animation_s",ANIMATION_END:"animation_e"},ctor:function(){this._commandHandlers=[],this._cutinVisualEffect=null},queueCutinCommand:function(e){var t=this._createCommandHandler(e);this._commandHandlers.push(t),1===this._commandHandlers.length&&t.drawData()},createCutinEffect:function(e){if(this._cutinVisualEffect)return this._cutinVisualEffect;var n=this._getVisualEffectResource(e);return this._cutinVisualEffect=t.createInstance("WindowVisualEffect").init(n.json),this._cutinVisualEffect},play:function(){if(!this._commandHandlers.length)return Q.reject("KHCutInHandler.Abstract.play: cutin command not properly initialized or destroyed prematurely.");var t=this._commandHandlers.shift().play();return this._commandHandlers.length?t.then(this._commandHandlers[0].drawData):t.then(this._cleanUp.bind(this)),t.fail(function(t){e.console.warn(t.stack||t)}),t},_cleanUp:function(){null!=this._cutinVisualEffect&&(this._cutinVisualEffect.cleanUp(),this._cutinVisualEffect=null,this._commandHandlers=[])},_playCutin:function(){if(null==this._cutinVisualEffect)return Q.reject("KHCutin._playCutin: cutin visual effect not properly initialized or destroyed prematurely.");var e=this._cutinVisualEffect,n=Q.defer();return e.addAnimationEventCallback(this.EVENT_NAMES.ANIMATION_END,function(){e.getNode().setVisible(!1),e.removeAllAnimationEventCallbacks(),n.resolve()},this),e.getNode().setVisible(!0),e.play(t.createInstance("battleWorld").CutinLayer,t.NODE_POSITION.CUTIN),n.promise},_createCommandHandler:function(e){var t=this._getTextures(e),n=this._getText(e);return{drawData:this._drawData.bind(this,t,n),play:this._playCutin.bind(this)}},_getCharacter:function(e){var n=t.createInstance("battleWorld").characterList[e];return i.isEmpty(n)&&(n=t.createInstance("FallenAvatarOrderHandler").getFallenByCharacterIndex(e)),n},_getVisualEffectResource:function(e,t){return{}},_getTextures:function(e){return[]},_getText:function(e){return""},_drawData:function(e,t){}})}((this||0).self||global),function(e){var t=e.kh;t.CutInHandler.BurstStreak=t.CutInHandler.Abstract.extend({className:"CutInHandlerBurstStreak",NODE_NAMES:{TEXTURE_TARGET_PREFIX:"battle_direct_streak_chara_"},_getVisualEffectResource:function(n){var i=t.createInstance("battleUrlParser");return null==i.resources.scenario.cutin||null==i.resources.scenario.cutin.burstStreak?(e.console.warn("KHCutIn._getVisualEffectResource: resources not properly loaded"),{}):i.resources.scenario.cutin.burstStreak["base_"+n]},_getTextures:function(n){var i=t.createInstance("battleUrlParser");return{jpegs:_.map(n.getPosList(),function(a){var o=t.createInstance("battleWorld").characterList[a];return null==o||_.isEmpty(o)?(e.console.warn("KHCutIn._getResources: avatar id not found"),null):null==i.resources.scenario.cutin||null==i.resources.scenario.cutin[n.getType()]||null==i.resources.scenario.cutin[n.getType()][o.isJob?"job":"avatar"]||null==i.resources.scenario.cutin[n.getType()][o.isJob?"job":"avatar"][o.id]||null==i.resources.scenario.cutin[n.getType()][o.isJob?"job":"avatar"][o.id].jpg?(e.console.warn("KHCutIn._getBurstStreakResources: resources not properly loaded"),null):i.resources.scenario.cutin[n.getType()][o.isJob?"job":"avatar"][o.id].jpg},this)}},_getText:function(e){return""},_drawData:function(e,t){_.each(e.jpegs,function(e,t){this._cutinVisualEffect.changeTexture(this.NODE_NAMES.TEXTURE_TARGET_PREFIX+t,e)},this)}})}((this||0).self||global),function(e){var t=e.kh;e.cc,t.CutInHandler.PlayerBurst=t.CutInHandler.Abstract.extend({className:"CutInHandlerPlayerBurst",NODE_NAMES:{TEXTURE_TARGET_NAME:"battle_direct_burst_chara",STRING_TARGET_NAME:"battle_direct_burst_text"},_getVisualEffectResource:function(){return t.createInstance("battleUrlParser").resources.scenario.cutin.playerBurst},_getTextures:function(n){var i=this._getCharacter(n.getPos());if(null==i)return e.console.warn("KHCutIn._getResources: character id not found"),{};var a=i.id,o=i.isJob?"job":"avatar",r=t.createInstance("battleUrlParser").resources.scenario.cutin;return null==r||null==r.playerBurst||null==r.playerBurst[o]||null==r.playerBurst[o][a]?(e.console.warn("KHCutIn._getResources: resources not properly loaded"),{}):r.playerBurst[o][a]},_getText:function(e){return e.getName()},_drawData:function(e,t){this._cutinVisualEffect.changeString(this.NODE_NAMES.STRING_TARGET_NAME,t),this._cutinVisualEffect.changeTexture(this.NODE_NAMES.TEXTURE_TARGET_NAME,""),this._cutinVisualEffect.changeTexture(this.NODE_NAMES.TEXTURE_TARGET_NAME,e.jpg||e.png)}})}((this||0).self||global),function(e){var t=e.kh;t.CutInHandler.PlayerBeatdown=t.CutInHandler.Abstract.extend({className:"CutInHandlerPlayerBeatdown",NODE_NAMES:{TEXTURE_TARGET_NAME:"battle_direct_knocked_out_chara"},_getVisualEffectResource:function(){var n=t.createInstance("battleUrlParser");return null==n.resources.scenario.cutin||null==n.resources.scenario.cutin.playerBeatdown?(e.console.warn("KHCutIn._getVisualEffectResource: resources not properly loaded"),{}):n.resources.scenario.cutin.playerBeatdown},_getTextures:function(n){var i=this._getCharacter(n.getPos());if(null==i)return e.console.warn("KHCutIn._getResources: character id not found"),{};var a=i.id,o=i.isJob?"job":"avatar",r=t.createInstance("battleUrlParser").resources.scenario.cutin;return null==r||null==r.playerBeatdown||null==r.playerBeatdown[o]||null==r.playerBeatdown[o][a]?(e.console.warn("KHCutIn._getResources: resources not properly loaded"),{}):r.playerBeatdown[o][a]},_getText:function(e){return""},_drawData:function(e,t){this._cutinVisualEffect.changeTexture(this.NODE_NAMES.TEXTURE_TARGET_NAME,""),this._cutinVisualEffect.changeTexture(this.NODE_NAMES.TEXTURE_TARGET_NAME,e.jpg||e.png)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.Ability=n.Class.extend({className:"KHAbility",init:function(e,t,n){return this.color=e.color,this._abilityData=e,this._index=t,this._statusPanel=n,this._statusPanel.initAbilityIcon(e,t),this},showPopup:function(){var e=!!t.createInstance("playerGameConfig").isAbilityPopupSkip();return e&&!this.isUsable()?Q.reject("Ability is not ready, no popup will be shown and the ability will not be played"):e&&!this._abilityData.party_member_selectable?Q.resolve():this._getPopup().open(this._abilityData)},setAbilityBanned:function(e){this._abilityData.is_banned=e,this._statusPanel.setAbilityBanned(e,this._index,this.isUsable())},updateAbilityCondition:function(e){this._abilityData.is_condition_satisfy=!1!==e,this._statusPanel.updateAbilityCondition(this._index,this.isUsable())},_getPopup:function(){if(this._abilityData.party_member_selectable&&this.isUsable()){var e=t.createInstance("routerParams").getCurrentScene();return t.ImplantedPopup.createOrGet(e,"a_q_001_ui_skillgo_1","AQ001SkillGo1Popup")}return t.createInstance("abilityPopupNormal")},cleanUp:function(){this._index=null,this._statusPanel=null},onStatusUpdate:function(e){this._abilityData.ready=0===e,this._statusPanel.updateAbilityTurn(e,this._index,this.isUsable())},getAbilityData:function(){return this._abilityData},isUsable:function(){return this._abilityData.ready&&!this._abilityData.is_banned&&this._abilityData.is_condition_satisfy},isPartyMemberSelectable:function(){return this._abilityData.party_member_selectable},getPartyMemberSelectableType:function(){return this._abilityData.party_member_selectable_type},getIndex:function(){return this._index}})}((this||0).self||global),function(e){var t=e.cc;e.kh.BattleCommandFactory=t.Class.extend({className:"KHBattleCommandFactory",create:function(e,t){if(_.isUndefined(e)||_.isUndefined(t))throw new Error("invalid args");return this._createCommand(e,t)},_createCommand:function(){throw new Error("")}})}((this||0).self||global),function(e){var t=e.cc,n=e.kh;n.BattleCommand=n.BattleCommand||{},n.RaidBattleCommand=n.RaidBattleCommand||{},n.BattleCommand.Abstract=t.Class.extend({className:"KHBattleCommandAbstract",EVENT_LIST:[],battleWorld:null,actionData:null,run:function(){throw new Error("you need call init method")},init:function(e,t){this.battleWorld=e,this.actionData=this._createActionDataObject(t),this._res=this._getResources(t)},_getResources:function(t){if(null==t.cmd)return null;var i=n.createInstance("battleUrlParser");if(null==i.resources.scenario)return null;var a=_.camelize(t.cmd);if(null==i.resources.scenario[a])return null;var o=t.id||this.getSubject().id;return null==o?(e.console.warn("KHBattleCommandAbstract._getResources: id not found"),null):i.resources.scenario[a][o]||null},cleanUp:function(){null!=this._targets&&(_.each(this._targets,function(e){_.each(e,function(e){null==e||_.isEmpty(e)||this._removeAllRegisteredEventsFromTarget(e)},this)},this),this._targets=null),null==this._subject||_.isEmpty(this._subject)||this._removeAllRegisteredEventsFromTarget(this._subject),this._subject=null,null!=this._visualEffects&&(_.invoke(this._visualEffects,"cleanUp"),this._visualEffects=null),this.actionData=null,this.battleWorld=null},_removeAllRegisteredEventsFromTarget:function(e){_.each(this.getEventList(),function(t){e.removeAnimationEventCallback(t)})},_createActionDataObject:function(e){return n.createInstance("ActionData",[e])},getSubject:function(){if(null!=this._subject)return this._subject;var e=this.actionData.getFrom(),t=this.actionData.getPos();return null==e||null==t?null:(this._subject=this.battleWorld.getAvatar(e,t),this._subject)},getEventList:function(){var e=n.BattleCommand.FRAME_EVENT_NAMES,t=n.BattleCommand.COLORFILTER_EVENT_NAMES,i=n.BattleCommand.LAYER_HOP_EVENT_NAMES;return _(this.EVENT_LIST).map(function(n){return"COLORFILTER"===n?_.values(t):"LAYER_HOP"===n?_.values(i):e[n]}).flatten().value()},getTargets:function(){return null!=this._targets?this._targets:(this._targets=_.map(this.actionData.getModifyHPData(),function(e){return _.map(e,function(e){return this.battleWorld.getAvatar(e.to,e.pos)},this)},this),this._targets)},getVisualEffects:function(){return null!=this._visualEffects?this._visualEffects:(this._visualEffects=_.compact(this._createVisualEffects()),this._visualEffects)},getSoundEffects:function(){if(null!=this._soundEffects)return this._soundEffects;if(null==this._res||null==this._res.se)return e.console.warn("KHBattleCommandAbstract.getSoundEffects: sound effects not properly loaded"),[];var t=this._res.se||[];return null!=this._res.hitSe&&t.push(this._res.hitSe.mp3),t},getVoices:function(){return null!=this._voices?this._voices:(this._voices=this.actionData.getVoices(),this._voices)},_createVisualEffects:function(){return null!=this._res&&null!=this._res.json?[n.createInstance("WindowVisualEffect").init(this._res.json)]:null!=this._res&&null!=this._res.ExportJson?[n.createInstance("ArmatureVisualEffect").init(this._res.ExportJson)]:(e.console.warn("KHBattleCommandAbstract._createVisualEffects: visual effect resources not properly loaded"),[])},playAvatarAnimationOnce:function(e,t){return null==e?Q.reject("KHBattleCommandAbstract.playAvatarAnimationOnce: avatar does not exist"):e.playAnimation(t)?this._useArmatureAnimationEventOnce(e,t):Q.reject("KHBattleCommandAbstract.playAvatarAnimationOnce: no avatar movement data")},playVisualEffectOnce:function(e,t,n,i){var a=t,o=n,r=i;return _.isString(o)&&_.isUndefined(r)&&(r=o,o=null),_.isString(a)&&_.isUndefined(r)&&(r=a,a=null),_.isUndefined(r)?(e.play(a,o),this._useActionAnimationEventOnce(e).then(e.stop.bind(e))):e.play(r,a,o)?this._useArmatureAnimationEventOnce(e).then(e.stop.bind(e)):Q.reject("KHBattleCommandAbstract.playVisualEffectOnce: no armature effect movement data")},_useArmatureAnimationEventOnce:function(e,t){var n=Q.defer(),i=function(e,a,o){a===ccs.MovementEventType.start&&o===t||(this.removeAnimationEventCallback("start",i),this.removeAnimationEventCallback("complete",i),this.removeAnimationEventCallback("loopComplete",i),n.resolve())};return e.addAnimationEventCallback("complete",i,e),e.addAnimationEventCallback("loopComplete",i,e),t&&e.addAnimationEventCallback("start",i,e),n.promise},_useActionAnimationEventOnce:function(e){var t=Q.defer(),n=function(){this.removeAnimationEventCallback("animation_e",n),t.resolve()};return e.addAnimationEventCallback("animation_e",n,e),t.promise},runAvatarSequenceByAnimation:function(e,t,n){var i=function(e,i){return n&&n(e,i),this.playAvatarAnimationOnce(e,t)}.bind(this);return khutil.runSequence(e,i)},brightenCharacterPanel:function(t){if(null==t)return e.console.warn("KHBattleCommandAbstract.brightenCharacterPanel: character not found"),function(){};var i=n.createInstance("notificationCenter");return i.dispatchEvent(n.EVENT_NAME.BATTLE_UI_DARKEN_FILTER["RESTORE_CHARACTER_"+t]),i.dispatchEvent.bind(i,n.EVENT_NAME.BATTLE_UI_DARKEN_FILTER["DARKEN_CHARACTER_"+t])},postMessage:function(){var e=this.actionData.getMessage();null!=e&&this.battleWorld.battleUI.ResultWindow.postMessage(e.category||"",e.name||"",e.effect||"")},postRaidMessage:function(){var e=this.actionData.getRaidMessage();null!=e&&n.createInstance("RaidMessageHandler").postMessages([{type:"log",message:e}])},handleCoverStart:function(){var e=this._getCoverAvatar();return null==e||_.isEmpty(e)?Q.resolve():e.playCoverAnimation()},handleCoverEnd:function(){var e=this._getCoverAvatar();return null==e||_.isEmpty(e)?Q.resolve():e.resetCoverAnimation()},_getCoverAvatar:function(){var e=this.actionData.getCover();if(null==e||e<0)return null;var t=this.actionData.getTo();return this.battleWorld["player"===t?"characterList":"enemyList"][e]}})}((this||0).self||global),function(e){var t=e.kh,n=e.Q,i={MULTI:4,SIMULTANEOUS:2,POS_PER_EVENT:1},a={multi_simultaneous:i.MULTI|i.SIMULTANEOUS|i.POS_PER_EVENT,multi_sequence:i.MULTI|i.POS_PER_EVENT,single:i.SIMULTANEOUS};t.BattleCommand.HpModifierAbstract=t.BattleCommand.Abstract.extend({className:"KHBattleCommandHpModifierAbstract",FLAGS:i,ANIMATION_TYPE_FLAG_SETTINGS:a,EVENT_LIST:["DAMAGE_START","DAMAGE_END","SOUND_START_CCS_21","SOUND_END_CCS_21","COLORFILTER","LAYER_HOP"],preload:function(){this.getVisualEffects()},run:function(){var i=this.getEventList(),a=this._eventLogic||t.createInstance("BattleCommandEventLogic").init(this);return this.handleCoverStart().then(function(){return n.all([a.registerEvents(i),this.start()])}.bind(this)).fail(function(t){e.console.warn(t.stack||t)}).finally(function(){var e=this.handleCoverEnd();return this.cleanUp(),e}.bind(this))},start:function(){return this.actionData.getAnimationId()?this._playVisualEffects():n.resolve()},_playVisualEffects:function(i){var a=this.getVisualEffects();if(null==a||0===a.length)return n.reject("KHBattleCommandHpModifierAbstract._playVisualEffects: no visual effects found");var o=this.getTargets().slice(0),r=n.defer(),s=_.after(a.length,r.resolve),c=function(n,i){if(0===n.length)return t.NODE_POSITION.BATTLE_FIELD_CENTER;var a=_.compact(_.uniq(n));if(0===a.length)return e.console.warn("KHBattleCommandHpModifierAbstract._playVisualEffects: no target found"),t.NODE_POSITION.BATTLE_FIELD_CENTER;var o=_.invoke(a,"getPosOnAvatar",i).reduce(function(e,t){return cc.p(e.x+t.x,e.y+t.y)});return cc.p(o.x/a.length,o.y/a.length)},u=function(e){var t=_(e).map(function(e){return null==e||_.isEmpty(e)?null:e.getLayer()}).compact().uniq().value();return t.length>1||0===t.length?this.battleWorld.BattleLayer:t[0]}.bind(this);return _(a).map(function(e){var t=this.getAnimationFlags(),n=t&this.FLAGS.POS_PER_EVENT?o.shift():_.flatten(o),a=e.getRelativeDisplayPosition(),r=c(n,a),l=u(n),p=function(){return null!=this._onEffectPlayStartCallback&&this._onEffectPlayStartCallback.callback.call(this._onEffectPlayStartCallback.context,e,n),this.playVisualEffectOnce(e,l,r,i).finally(function(){null!=this._onEffectPlayEndCallback&&this._onEffectPlayEndCallback.callback.call(this._onEffectPlayEndCallback.context,e,n),s()}.bind(this))}.bind(this);return t&this.FLAGS.SIMULTANEOUS?p():this._visualEffectPlaySequenceSpeed?function(){return p(),khutil.getPromiseToDelayAnimation(this._visualEffectPlaySequenceSpeed)}.bind(this):p},this).reduce(n.when,n()),r.promise},_createVisualEffects:function(){return this.actionData.getAnimationId()?null==this._res.json?(e.console.warn("KHBattleCommandHpModifierAbstract._createVisualEffects: visual effect resource not properly loaded"),[]):this.getAnimationFlags()&this.FLAGS.MULTI?_.map(_.range(_.flatten(this.getTargets()).length),function(){return t.createInstance("WindowVisualEffect").init(this._res.json)},this):[t.createInstance("WindowVisualEffect").init(this._res.json)]:[]},getAnimationFlags:function(){return this.ANIMATION_TYPE_FLAG_SETTINGS[this.getAnimationType()]},setVisualEffectPlaySequenceSpeed:function(e){this._visualEffectPlaySequenceSpeed=e},setOnEffectPlayStartCallback:function(e,t){this._onEffectPlayStartCallback={callback:e,context:t}},setOnEffectPlayEndCallback:function(e,t){this._onEffectPlayEndCallback={callback:e,context:t}},cleanUp:function(){t.BattleCommand.Abstract.prototype.cleanUp.call(this),this._onEffectPlayStartCallback=null,this._onEffectPlayEndCallback=null},getTargets:function(){var e=t.BattleCommand.Abstract.prototype.getTargets.call(this);return this.actionData.getAnimationType(),this.getAnimationFlags()&this.FLAGS.MULTI?this._restructureDataForMulti(e):e},getModifyHpData:function(){var e=(this.actionData.getAnimationType(),this.actionData.getModifyHPData());return this.getAnimationFlags()&this.FLAGS.MULTI?this._restructureDataForMulti(e):e},getAnimationType:function(){return this.actionData.getAnimationType()||"multi_simultaneous"},_restructureDataForMulti:function(e){return _(e).flatten().map(function(e){return[e]}).value()},_getResources:function(e){var n=t.createInstance("battleUrlParser"),i=e.animation_resource_type;return"burst"===i&&"enemy"===e.from&&(i="enemyBurst"),null==n.resources.scenario[i]?null:n.resources.scenario[i][this.actionData.getAnimationId()]}})}((this||0).self||global),function(e){var t=(e.cc,e.kh);t.BattleCommand.AttackFactory=t.BattleCommandFactory.extend({className:"KHBattleCommandAttackFactory",_createCommand:function(e,n){var i=t.createInstance("BattleCommandAttack");return i.init(e,n),i}})}((this||0).self||global),function(e){var t=(e.cc,e.kh);t.BattleCommand.BurstFactory=t.BattleCommandFactory.extend({className:"KHBattleCommandBurstFactory",_createCommand:function(e,n){var i=t.createInstance("BattleCommandBurst");return i.init(e,n),i}})}((this||0).self||global),function(e){var t=(e.cc,e.kh);t.BattleCommand.BurstResultFactory=t.BattleCommandFactory.extend({className:"KHBattleCommandBurstResultFactory",_createCommand:function(e,n){var i=t.createInstance("BattleCommandBurstResult");return i.init(e,n),i}})}((this||0).self||global),function(e){var t=(e.cc,e.kh);t.BattleCommand.NormalFactory=t.BattleCommandFactory.extend({className:"KHBattleCommandNormalFactory",_createCommand:function(e,n){var i=t.createInstance("BattleCommandNormal");return i.init(e,n),i}})}((this||0).self||global),function(e){var t=(e.cc,e.kh);t.BattleCommand.TurnFactory=t.BattleCommandFactory.extend({className:"KHBattleCommandTurnFactory",_createCommand:function(e,n){var i=t.createInstance("BattleCommandTurn");return i.init(e,n),i}})}((this||0).self||global),function(e){var t=(e.cc,e.kh);t.BattleCommand.CutInFactory=t.BattleCommandFactory.extend({name:"KHBattleCommandTurnFactory",_createCommand:function(e,n){var i=t.createInstance("BattleCommandCutIn");return i.init(e,n),i}})}((this||0).self||global),function(e){var t=(e.cc,e.kh);t.BattleCommand.AbilityFactory=t.BattleCommandFactory.extend({className:"KHBattleCommandAbilityFactory",_createCommand:function(e,n){var i=t.createInstance("BattleCommandAbility");return i.init(e,n),i}})}((this||0).self||global),function(e){var t=e.kh;t.BattleCommand.DamageFactory=t.BattleCommandFactory.extend({name:"KHBattleCommandDamageFactory",_createCommand:function(e,n){var i=t.createInstance("BattleCommandDamage");return i.init(e,n),i}})}((this||0).self||global),function(e){var t=(e.cc,e.kh);t.BattleCommand.HealFactory=t.BattleCommandFactory.extend({className:"KHBattleCommandHealFactory",_createCommand:function(e,n){var i=t.createInstance("BattleCommandHeal");return i.init(e,n),i}})}((this||0).self||global),function(e){var t=(e.cc,e.kh);t.BattleCommand.SummonMovieFactory=t.BattleCommandFactory.extend({name:"KHBattleCommandSummonMovieFactory",_createCommand:function(e,n){var i=t.createInstance("BattleCommandSummonMovie");return i.init(e,n),i}})}((this||0).self||global),function(e){var t=(e.cc,e.kh);t.BattleCommand.SummonDamageFactory=t.BattleCommandFactory.extend({name:"KHBattleCommandSummonDamageFactory",_createCommand:function(e,n){var i=t.createInstance("BattleCommandSummonDamage");return i.init(e,n),i}})}((this||0).self||global),function(e){var t=e.kh;t.BattleCommand.SetEnemyChargeTurnFactory=t.BattleCommandFactory.extend({className:"KHBattleCommandSetEnemyChargeTurnFactory",_createCommand:function(e,n){var i=t.createInstance("BattleCommandSetEnemyChargeTurn");return i.init(e,n),i}})}((this||0).self||global),function(e){var t=(e.cc,e.kh);t.BattleCommand.SetEnemyModeGaugeFactory=t.BattleCommandFactory.extend({className:"KHBattleCommandSetEnemyModeGaugeFactory",_createCommand:function(e,n){var i=t.createInstance("BattleCommandSetEnemyModeGauge");return i.init(e,n),i}})}((this||0).self||global),function(e){var t=e.kh;t.BattleCommand.WinFactory=t.BattleCommandFactory.extend({className:"KHBattleCommandWinFactory",_createCommand:function(e,n){var i=t.createInstance("BattleCommandWin");return i.init(e,n),i}})}((this||0).self||global),function(e){var t=e.kh;t.BattleCommand.LoseFactory=t.BattleCommandFactory.extend({className:"KHBattleCommandLoseFactory",_createCommand:function(e,n){var i=t.createInstance("BattleCommandLose");return i.init(e,n),i}})}((this||0).self||global),function(e){var t=e.kh;t.BattleCommand.NextStageFactory=t.BattleCommandFactory.extend({className:"KHBattleCommandNextStageFactory",_createCommand:function(e,n){var i=t.createInstance("BattleCommandNextStage");return i.init(e,n),i}})}((this||0).self||global),function(e){var t=e.kh;t.BattleCommand.ChangeEnemyModeFactory=t.BattleCommandFactory.extend({className:"KHBattleCommandChangeEnemyModeFactory",_createCommand:function(e,n){var i=t.createInstance("BattleCommandChangeEnemyMode");return i.init(e,n),i}})}((this||0).self||global),function(e){var t=e.kh;t.BattleCommand.DieFactory=t.BattleCommandFactory.extend({className:"KHBattleCommandDieFactory",_createCommand:function(e,n){var i=t.createInstance("BattleCommandDie");return i.init(e,n),i}})}((this||0).self||global),function(e){var t=e.kh;t.BattleCommand.SetBurstGaugeFactory=t.BattleCommandFactory.extend({className:"KHBattleCommandSetBurstGaugeFactory",_createCommand:function(e,n){var i=t.createInstance("BattleCommandSetBurstGauge");return i.init(e,n),i}})}((this||0).self||global),function(e){var t=e.kh;t.BattleCommand.JoinFactory=t.BattleCommandFactory.extend({className:"KHBattleCommandJoinFactory",_createCommand:function(e,n){var i=t.createInstance("BattleCommandJoin");return i.init(e,n),i}})}((this||0).self||global),function(e){var t=e.kh;t.BattleCommand.RemoveStatusFactory=t.BattleCommandFactory.extend({className:"KHBattleCommandRemoveStatusFactory",_createCommand:function(e,n){var i=t.createInstance("BattleCommandRemoveStatus");return i.init(e,n),i}})}((this||0).self||global),function(e){var t=e.kh;t.BattleCommand.ApplyStatusFactory=t.BattleCommandFactory.extend({className:"KHBattleCommandApplyStatusFactory",_createCommand:function(e,n){var i=t.createInstance("BattleCommandApplyStatus");return i.init(e,n),i}})}((this||0).self||global),function(e){var t=e.kh;t.BattleCommand.IncreaseParticipantsFactory=t.BattleCommandFactory.extend({className:"KHBattleCommandIncreaseParticipantsFactory",_createCommand:function(e,n){var i=t.createInstance("BattleCommandIncreaseParticipants");return i.init(e,n),i}})}((this||0).self||global),function(e){var t=e.kh;t.BattleCommand.AdjustEnemyHpFactory=t.BattleCommandFactory.extend({className:"KHBattleCommandAdjustEnemyHpFactory",_createCommand:function(e,n){var i=t.createInstance("BattleCommandAdjustEnemyHp");return i.init(e,n),i}})}((this||0).self||global),function(e){var t=e.kh;t.BattleCommand.ReceiveRaidPointsFactory=t.BattleCommandFactory.extend({className:"KHBattleCommandReceiveRaidPointsFactory",_createCommand:function(e,n){var i=t.createInstance("BattleCommandReceiveRaidPoints");return i.init(e,n),i}})}((this||0).self||global),function(e){var t=e.kh;t.BattleCommand.TimeupFactory=t.BattleCommandFactory.extend({className:"KHBattleCommandTimeupFactory",_createCommand:function(e,n){var i=t.createInstance("BattleCommandTimeup");return i.init(e,n),i}})}((this||0).self||global),function(e){var t=e.kh;t.BattleCommand.EnemiesDownFactory=t.BattleCommandFactory.extend({className:"KHBattleCommandEnemiesDownFactory",_createCommand:function(e,n){var i=t.createInstance("BattleCommandEnemiesDown");return i.init(e,n),i}})}((this||0).self||global),function(e){var t=(e.cc,e.kh);t.BattleCommand.BurstStreakFactory=t.BattleCommandFactory.extend({name:"KHBattleCommandBurstStreakFactory",_createCommand:function(e,n){var i=t.createInstance("BattleCommandBurstStreak");return i.init(e,n),i}})}((this||0).self||global),function(e){var t=e.kh;t.BattleCommand.PlayVisualEffectFactory=t.BattleCommandFactory.extend({name:"KHBattlePlayVisualEffectFactory",_createCommand:function(e,n){var i=t.createInstance("BattleCommandPlayVisualEffect");return i.init(e,n),i}})}((this||0).self||global),function(e){var t=(e.cc,e.kh);t.BattleCommand.BanAbilityFactory=t.BattleCommandFactory.extend({name:"KHBattleCommandBanAbilityFactory",_createCommand:function(e,n){var i=t.createInstance("BattleCommandBanAbility");return i.init(e,n),i}})}((this||0).self||global),function(e){var t=(e.cc,e.kh);t.BattleCommand.UnbanAbilityFactory=t.BattleCommandFactory.extend({name:"KHBattleCommandUnbanAbilityFactory",_createCommand:function(e,n){var i=t.createInstance("BattleCommandUnbanAbility");return i.init(e,n),i}})}((this||0).self||global),function(e){var t=e.kh;t.BattleCommand.BanBurstFactory=t.BattleCommandFactory.extend({name:"KHBattleCommandBanBurstFactory",_createCommand:function(e,n){var i=t.createInstance("BattleCommandBanBurst");return i.init(e,n),i}})}((this||0).self||global),function(e){var t=e.kh;t.BattleCommand.UnbanBurstFactory=t.BattleCommandFactory.extend({name:"KHBattleCommandUnbanBurstFactory",_createCommand:function(e,n){var i=t.createInstance("BattleCommandUnbanBurst");return i.init(e,n),i}})}((this||0).self||global),function(e){var t=e.kh;t.BattleCommand.MoveAvatarFactory=t.BattleCommandFactory.extend({className:"KHBattleCommandMoveAvatarFactory",_createCommand:function(e,n){var i=t.createInstance("BattleCommandMoveAvatar");return i.init(e,n),i}})}((this||0).self||global),function(e){var t=e.kh;t.BattleCommand.ReviveFactory=t.BattleCommandFactory.extend({className:"KHBattleCommandReviveFactory",_createCommand:function(e,n){var i=t.createInstance("BattleCommandRevive");return i.init(e,n),i}})}((this||0).self||global),function(e){var t=e.kh;t.BattleCommand.MessageFactory=t.BattleCommandFactory.extend({className:"KHBattleCommandMessageFactory",_createCommand:function(e,n){var i=t.createInstance("BattleCommandMessage");return i.init(e,n),i}})}((this||0).self||global),function(e){var t=e.kh;t.BattleCommand.RaidMessageFactory=t.BattleCommandFactory.extend({className:"KHBattleCommandRaidMessageFactory",_createCommand:function(e,n){var i=t.createInstance("BattleCommandRaidMessage");return i.init(e,n),i}})}((this||0).self||global),function(e){var t=e.kh;t.BattleCommand.CooldownFactory=t.BattleCommandFactory.extend({className:"KHBattleCommandCooldownFactory",_createCommand:function(e,n){var i=t.createInstance("BattleCommandCooldown");return i.init(e,n),i}})}((this||0).self||global),function(e){var t=e.cc,n=e.kh;n.BattleCommandFactory.Registry={normal:n.BattleCommand.NormalFactory,attack:n.BattleCommand.AttackFactory,cutin:n.BattleCommand.CutInFactory,burst:n.BattleCommand.BurstFactory,burst_result:n.BattleCommand.BurstResultFactory,turn:n.BattleCommand.TurnFactory,ability:n.BattleCommand.AbilityFactory,damage:n.BattleCommand.DamageFactory,heal:n.BattleCommand.HealFactory,summon_movie:n.BattleCommand.SummonMovieFactory,summon_damage:n.BattleCommand.SummonDamageFactory,set_burst_gauge:n.BattleCommand.SetBurstGaugeFactory,set_enemy_mode_gauge:n.BattleCommand.SetEnemyModeGaugeFactory,set_enemy_charge_turn:n.BattleCommand.SetEnemyChargeTurnFactory,win:n.BattleCommand.WinFactory,lose:n.BattleCommand.LoseFactory,change_enemy_mode:n.BattleCommand.ChangeEnemyModeFactory,join_battle:n.BattleCommand.JoinFactory,die:n.BattleCommand.DieFactory,next_stage:n.BattleCommand.NextStageFactory,apply_status:n.BattleCommand.ApplyStatusFactory,remove_status:n.BattleCommand.RemoveStatusFactory,increase_participants:n.BattleCommand.IncreaseParticipantsFactory,receive_raid_points:n.BattleCommand.ReceiveRaidPointsFactory,adjust_enemy_hp:n.BattleCommand.AdjustEnemyHpFactory,timeup:n.BattleCommand.TimeupFactory,enemies_down:n.BattleCommand.EnemiesDownFactory,burst_streak:n.BattleCommand.BurstStreakFactory,play_visual_effect:n.BattleCommand.PlayVisualEffectFactory,ban_ability:n.BattleCommand.BanAbilityFactory,unban_ability:n.BattleCommand.UnbanAbilityFactory,ban_burst:n.BattleCommand.BanBurstFactory,unban_burst:n.BattleCommand.UnbanBurstFactory,move_avatar:n.BattleCommand.MoveAvatarFactory,revive:n.BattleCommand.ReviveFactory,message:n.BattleCommand.MessageFactory,raid_message:n.BattleCommand.RaidMessageFactory,cooldown:n.BattleCommand.CooldownFactory},n.BattleCommandFactoryRegistry=t.Class.extend({className:"KHBattleCommandFactoryRegistry",ctor:function(){this._factoryRegistry=n.BattleCommandFactory.Registry},createFactory:function(e){var t=this._factoryRegistry[e];return n.createInstance(t)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.console;t.BattleCommand.FRAME_EVENT_NAMES={ATTACK_EFFECT_START:"effect_attack_s",BURST_EFFECT_START:"effect_burst_s",ABILITY_EFFECT_START:"effect_skill_s",SOUND_START_CCS_21:"sound2_s",SOUND_END_CCS_21:"sound2_e",SOUND_START_CCS_16:"sound1_s",SOUND_END_CCS_16:"sound1_e",DAMAGE_START:"avatar_damage_s",DAMAGE_END:"avatar_damage_e",DAMAGE_NUMBER:"direct_hp_number_s",HEAL_NUMBER:"direct_heal_number_s",QUAKE_AVATAR_START:"quake_avatar_s",QUAKE_AVATAR_END:"quake_avatar_e",STATUS_ICON:"direct_status_s"},t.BattleCommand.COLORFILTER_EVENT_NAMES={START_WHITEOUT_DEEP_SLOW:"white_deep_slow_s",END_WHITEOUT_DEEP_SLOW:"white_deep_slow_e",START_WHITEOUT_DEEP_FAST:"white_deep_fast_s",END_WHITEOUT_DEEP_FAST:"white_deep_fast_e",START_WHITEOUT_PALE_SLOW:"white_pale_slow_s",END_WHITEOUT_PALE_SLOW:"white_pale_slow_e",START_WHITEOUT_PALE_FAST:"white_pale_fast_s",END_WHITEOUT_PALE_FAST:"white_pale_fast_e",START_BLACKOUT_DEEP_SLOW:"black_deep_slow_s",END_BLACKOUT_DEEP_SLOW:"black_deep_slow_e",START_BLACKOUT_DEEP_FAST:"black_deep_fast_s",END_BLACKOUT_DEEP_FAST:"black_deep_fast_e",START_BLACKOUT_PALE_SLOW:"black_pale_slow_s",END_BLACKOUT_PALE_SLOW:"black_pale_slow_e",START_BLACKOUT_PALE_FAST:"black_pale_fast_s",END_BLACKOUT_PALE_FAST:"black_pale_fast_e"},t.BattleCommand.LAYER_HOP_EVENT_NAMES={CHANGE_LAYER_CHARACTER:"move_layer_character",CHANGE_LAYER_ENEMY:"move_layer_enemy",CHANGE_LAYER_BACKGROUND:"move_layer_background"},t.BattleCommand.EventLogic=n.Class.extend({className:"KHBattleCommandEventLogic",init:function(e){return this.battleCommand=e,Object.defineProperties(this,{actionData:{get:function(){return this.battleCommand.actionData}},battleWorld:{get:function(){return this.battleCommand.battleWorld}}}),this._initColorFilterEventMethods(),this},registerEvents:function(e){var n=i(t.BattleCommand.FRAME_EVENT_NAMES).invert().assign(i.invert(t.BattleCommand.COLORFILTER_EVENT_NAMES)).assign(i.invert(t.BattleCommand.LAYER_HOP_EVENT_NAMES)).value();return Q.all(i.map(e,function(e){return this["__register"+i.capitalize(i.camelize(n[e].toLowerCase()))](e)},this)).fail(function(e){a.warn(e.stack)})},__registerAttackEffectStart:function(e){return this._registerSingleTargetEffectStart(e,t.AVATAR_EFFECT_NAMES.ATTACK)},__registerBurstEffectStart:function(e){var t=Q.defer();return this._getSubject().addAnimationEventCallback(e,t.resolve),t.promise},_registerSingleTargetEffectStart:function(e,t){var n=this._getVisualEffects(),o=this._getSubject(),r=this._getTargets().slice(0),s=Q.defer(),c=i.after(n.length,s.resolve),u=function(e){e.cleanUp(),c()};if(null==o)return Q.reject("KHBattleCommandEventLogic._registerSingleTargetEffectStart: subject avatar does not exist");var l=function(){if(0===n.length)return a.warn("KHBattleCommandEventLogic._registerSingleTargetEffectStart: insufficient visual effects created"),void c();var e=n.shift();if(0===r.length)return a.warn("KHBattleCommandEventLogic._registerSingleTargetEffectStart: target avatar does not exist"),void u(e);var o=r.shift()[0];return null==o||i.isEmpty(o)?(a.warn("KHBattleCommandEventLogic._registerSingleTargetEffectStart: target avatar does not exist"),void u(e)):void this.playVisualEffectOnce(e,o.getLayer(),o.getCenterPos(),t).fail(function(e){a.warn(e.stack||e)}).finally(u.bind(null,e))}.bind(this.battleCommand);return o.addAnimationEventCallback(e,l),s.promise},__registerAbilityEffectStart:function(e){var t=Q.defer();return this._getSubject().addAnimationEventCallback(e,t.resolve),t.promise},__registerSoundStartCcs16:function(e){this._registerSoundEventCcs16(e,!0)},__registerSoundEndCcs16:function(e){this._registerSoundEventCcs16(e,!1)},_registerSoundEventCcs16:function(e,n){var o=[(n?"play":"stop")+"SoundEffect"],r=0,s=this._getSoundEffects(),c=t.createInstance("soundPlayer"),u=function(e){if(!(r>=s.length)){var n=s.shift();return s.push(n),null==n?void a.warn("KHBattleCommandEventLogic._registerSoundEventCcs16: no sound file found"):(c[o](n,!1,t.GameConfig.BATTLE_SETTINGS.SOUND_SCALE.CCS16EVENT),void r++)}a.warn("KHBattleCommandEventLogic._registerSoundEventCcs16: no sound file found")}.bind(this.battleCommand);i.invoke(i.compact(this._getVisualEffects().concat(this._getSubject())),"addAnimationEventCallback",e,u,this)},__registerSoundStartCcs21:function(e){this._registerSoundEventCcs21(e,!0)},__registerSoundEndCcs21:function(e){this._registerSoundEventCcs21(e,!1)},_registerSoundEventCcs21:function(e,n){var o=[(n?"play":"stop")+"SoundEffect"],r=t.createInstance("soundPlayer"),s=function(t){var n=t.getNode();return null==n?(a.warn(e+" failed: CocosStudio2.1 audio effect not properly loaded."),null):n.getComponent("Audio")},c=function(e){var n=s(e);if(null!=n){var i=n.getFile();return null==i?void a.warn("KHBattleCommandEventLogic._registerSoundEventCcs16: no sound file found"):void r[o](i,n.isLoop(),t.GameConfig.BATTLE_SETTINGS.SOUND_SCALE.CCS21EVENT)}}.bind(this.battleCommand);i.invoke(i.compact(this._getVisualEffects().concat(this._getSubject())),"addAnimationEventCallback",e,c,this)},__registerDamageStart:function(e){this._registerDamageEvent(e,!1)},__registerDamageEnd:function(e){this._registerDamageEvent(e,!0)},_registerDamageEvent:function(e,t){var n=1,o=2,r=4,s={};s[0]=s[n|o]=["pauseEventListening","interruptAnimation","playOnHitAnimation"],s[o]=s[n]=[],s[r]=["resumeLastInterruptedAnimation","resumeEventListening"];var c=t?r:0;c|=this.actionData.isHeal()&&!t?o:0;var u=this._getTargets().slice(0),l=this._getModifyHPData(),_=i.map(u,function(e,a){return function(){i.each(e,function(e,o){l[a][o].value<0&&!t?c|=n:c&=~n,i(e).pick(s[c]).values().invoke("apply",e)},this)}.bind(this.battleCommand)},this);i.invoke(this._getVisualEffects(),"addAnimationEventCallback",e,function(){return 0===_.length?void a.warn("KHBattleCommandEventLogic._registerDamageEvent: insufficient damage data"):void _.shift()()})},__registerDamageNumber:function(e){this._registerNumberEvent(e)},__registerHealNumber:function(e){this._registerNumberEvent(e)},_registerNumberEvent:function(e){var t=this._getModifyHPData(),n=this.actionData.isHeal(),o=this._getTargets().slice(0),r=this._handlePinchSe.bind(this),s=i.map(t,function(e){var t=o.shift();return i.each.bind(null,t,function(t,i){return null==t?void a.warn("KHBattleCommandEventLogic._registerNumberEvent: target not found"):(r(t,e[i]),void(n?t.processHeal(e[i]):t.processDamage(e[i])))},this)},this.battleCommand);i.invoke(this._getVisualEffects(),"addAnimationEventCallback",e,function(){return 0===s.length?void a.warn("KHBattleCommandEventLogic._registerNumberEvent: insufficient modify hp data"):void s.shift()()})},_handlePinchSe:function(e,n){if(!("player"!==n.to||e.currentAnimation===t.AVATAR_ANIMATION_NAMES.PINCH||e.getPinchTreshhold()<n.hp)){var i=e.isJob?"job":"avatar",a=t.createInstance("battleUrlParser").resources;if(null!=a[i]&&null!=a[i][e.id]){var o=t.createInstance("battleUrlParser").resources[i][e.id].sePinch;if(null!=o&&0!==o.length)return this._getSubject()===e?void this._getSoundEffects().unshift(o.shift()):void e.addAnimationEventCallback(t.BattleCommand.FRAME_EVENT_NAMES.SOUND_START_CCS_16,function(){0!==o.length&&t.createInstance("soundPlayer").playSoundEffect(o.shift())})}}},__registerStatusIcon:function(e){var t=i.flatten(this._getTargets().slice(0)),n=this.battleCommand.statusEffectData,o=i.pluck(n.affected_avatars.players||{},"applied").concat(i.pluck(n.affected_avatars.enemies||{},"applied")),r=function(){if(0!==t.length){var e=t.shift(),i=o.shift(),r=n.type;i&&null==r||e.playReceiveStatusEffectAnimation(r,i)}else a.warn("KHBattleCommandEventLogic.__registerStatusIcon: target not found")}.bind(this.battleCommand);i.invoke(this._getVisualEffects(),"addAnimationEventCallback",e,r)},__registerQuakeAvatarStart:function(e){i.invoke(this._getVisualEffects(),"addAnimationEventCallback",e,function(){t.createInstance("notificationCenter").dispatchEvent("start_quake")})},__registerQuakeAvatarEnd:function(e){i.invoke(this._getVisualEffects(),"addAnimationEventCallback",e,function(){t.createInstance("notificationCenter").dispatchEvent("end_quake")})},_initColorFilterEventMethods:function(){i.each(t.BattleCommand.COLORFILTER_EVENT_NAMES,function(e,t){this["__register"+i.capitalize(i.camelize(t.toLowerCase()))]=this._registerColorFilterEvent.bind(this,e)},this)},_registerColorFilterEvent:function(e){var n=e.split("_"),a=this.battleWorld.BackgroundLayer;i.invoke(i.compact(this._getVisualEffects().concat(this._getSubject())),"addAnimationEventCallback",e,function(){t.createInstance("notificationCenter").dispatchEvent(n[0]+"_"+n[3],[a,n[1],n[2]])})},__registerChangeLayerCharacter:function(e){this._registerChangeLayer(e,t.createInstance("battleWorld").CharacterLayer)},__registerChangeLayerEnemy:function(e){this._registerChangeLayer(e,t.createInstance("battleWorld").EnemyLayer)},__registerChangeLayerBackground:function(e){this._registerChangeLayer(e,t.createInstance("battleWorld").BackgroundLayer)},_registerChangeLayer:function(e,a){var o=function(e){if(null!=e&&i.isFunction(e.getNode)){var o=e.getNode();if(null!=o){var r=o.getParent();if(r!==a&&null!=r){var s,c="layerHopEventPositionNode";if(r.getName()===c?s=r:(o.removeFromParent(),(s=new n.Node).setName(c),s.setPosition(r.convertToWorldSpace(n.p(0,0))),s.addChild(o)),s.getParent()!==a){null!=s.getParent()&&s.removeFromParent(),a.addChild(s),s.setLocalZOrder(Math.max(t.GameConfig.BATTLE_SETTINGS.MAX_ENEMY_COUNT,t.GameConfig.PARTY_SETTINGS.MAX_AVATAR_COUNT)+1);this.addOnCleanUpCallback(function(e){null!=this.getParent()&&this.removeFromParent()},s)}}}}};i.each(this._getVisualEffects(),function(t){t.addAnimationEventCallback(e,o,t)})},_getVisualEffects:function(){return this.battleCommand.getVisualEffects()},_getModifyHPData:function(){return i.isFunction(this.battleCommand.getModifyHpData)?this.battleCommand.getModifyHpData():this.actionData.getModifyHPData()},_getTargets:function(){return this.battleCommand.getTargets()},_getSubject:function(){return this.battleCommand.getSubject()},_getSoundEffects:function(){return this.battleCommand.getSoundEffects()}})}((this||0).self||global),function(e){var t=e.kh;t.BattleCommand.EventLogicNoSound=t.BattleCommand.EventLogic.extend({className:"KHBattleCommandEventLogicNoSound",__registerSoundStartCcs16:function(){},__registerSoundEndCcs16:function(){},__registerSoundStartCcs21:function(){},__registerSoundEndCcs21:function(){}})}((this||0).self||global),function(e){var t=e.kh,n=e._;t.BattleCommand.Attack=t.BattleCommand.Abstract.extend({className:"KHBattleCommandAttack",EVENT_LIST:["ATTACK_EFFECT_START","DAMAGE_START","DAMAGE_END","DAMAGE_NUMBER","SOUND_START_CCS_16","SOUND_END_CCS_16","COLORFILTER"],run:function(){var n=t.createInstance("BattleCommandEventLogic").init(this),i=this.actionData.getModifyHPData().length,a=this.getSubject(),o=this._brightenCharacterPanel(a.index);return this.handleCoverStart().then(function(){return Q.all([n.registerEvents(this.getEventList()),this.playAvatarAnimationOnce(a,t.AVATAR_ANIMATION_NAMES.ATTACK_BY_COUNT[i-1])])}.bind(this)).fail(function(t){e.console.warn(t.stack||t)}.bind(this)).finally(function(){var e=this.handleCoverEnd();return o(),this.cleanUp(),e}.bind(this))},_getResources:function(){var n=t.createInstance("battleUrlParser"),i=this.getSubject();if(null==i)return e.console.warn("KHBattleCommandAttack._getResources: subject not found"),{};var a=i.isJob?"job":this.actionData.getFrom();return n.resources.scenario.attack[a][i.id]},_createVisualEffects:function(){if(null==this._res.ExportJson)return e.console.warn("KHBattleCommandAttack._createVisualEffects: visual effect resource not properly loaded"),[];var i=this.actionData.getModifyHPData().length;return n.map(n.range(i),function(){return t.createInstance("ArmatureVisualEffect").init(this._res.ExportJson)},this)},_brightenCharacterPanel:function(e){return"player"!==this.actionData.getFrom()?function(){}:t.BattleCommand.Abstract.prototype.brightenCharacterPanel.call(this,e)},getSoundEffects:function(){if(null!=this._soundEffects)return this._soundEffects;if(null==this._res.hitSe)return e.console.warn("KHBattleCommandAttack.getSoundEffects: sound effects not properly loaded"),[];var t=this.actionData.getModifyHPData().length;if("enemy"===this.actionData.getFrom())return this._soundEffects=[],n.each(n.range(t),function(e){this._soundEffects.push(this._res.hitSe.mp3)},this),this._soundEffects;if(null==this._res.se)return e.console.warn("KHBattleCommandAttack.getSoundEffects: sound effects not properly loaded"),[];var i=n.shuffle(this._res.se);return this._soundEffects=[],n.each(n.range(t),function(e){this._soundEffects.push(i.shift()),this._soundEffects.push(this._res.hitSe.mp3)},this),this._soundEffects}})}((this||0).self||global),function(e){var t=e.kh;e.cc,t.BattleCommand.Burst=t.BattleCommand.Abstract.extend({className:"KHBattleCommandBurst",EVENT_LIST:["BURST_EFFECT_START","SOUND_START_CCS_16","SOUND_END_CCS_16","COLORFILTER","LAYER_HOP"],run:function(n){var i=t.createInstance("BattleCommandEventLogic").init(this),a=this.getSubject(),o=this._brightenCharacterPanel(a.index);null!=n&&_.isFunction(n.preload)&&n.preload();var r=i.registerEvents(this.getEventList());return this.playAvatarAnimationOnce(a,t.AVATAR_ANIMATION_NAMES.BURST).then(this.cleanUp.bind(this)),r.fail(function(t){e.console.warn(t.stack||t)}.bind(this)).finally(function(){o()}.bind(this))},_getResources:function(){var e=t.createInstance("battleUrlParser"),n=this.getSubject(),i=n.isJob?"job":"avatar",a=this.actionData.getFrom();if(null!=e.resources.scenario.burst&&null!=e.resources.scenario.burst[a]&&null!=e.resources.scenario.burst[a][i])return e.resources.scenario.burst[a][i][n.id]},getVisualEffects:function(){return[]},_brightenCharacterPanel:function(e){return t.BattleCommand.Attack.prototype._brightenCharacterPanel.call(this,e)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e.res,a=e._;t.BattleCommand.BurstResult=t.BattleCommand.Abstract.extend({className:"KHBattleCommandBurstResult",BURST_COUNT_ANIMATION_COUNT_NODE_NAME:"burst_count_no",total:null,count:null,run:function(){this._setupValues();var e=this.actionData.getTotalDamage();return Q.all([this._playTotalAnimation(e),this._playBurstCountAnimation()]).fail(function(e){console.debug(e)})},_setupValues:function(){this.count=this.actionData.getCount()},_playTotalAnimation:function(e){if(!a.isUndefined(e.value)&&""!==e.value){var i=n.director.getWinSize();t.createInstance("notificationCenter").dispatchEvent("show_total_damage_point",[n.p(i.width/2,i.height/2),e])}},_playBurstCountAnimation:function(){if(!a.isUndefined(this.count)&&""!==this.count){var e=Q.defer(),o=t.createInstance("WindowVisualEffect").init(i.battle_burst_count_animation);return o.changeString(this.BURST_COUNT_ANIMATION_COUNT_NODE_NAME,this.count.toString()),o.setAnimationEndCallback(function(){this.cleanUp(),e.resolve()},o),o.play(this.battleWorld.CutinLayer,n.p(0,0)),e.promise}}})}((this||0).self||global),function(e){var t=(e.cc,e.kh);t.BattleCommand.Normal=t.BattleCommand.Abstract.extend({className:"KHBattleCommandNormal",run:function(){return this.getSubject().playIdleAnimation()}})}((this||0).self||global),function(e){var t=(e.cc,e.kh);t.BattleCommand.PlayTurnAnimationFuncNames={player:["playPlayerTurnAnimation","playTurnNumberAnimation","resetTurn"],enemy:["playEnemyTurnAnimation"]},t.BattleCommand.Turn=t.BattleCommand.Abstract.extend({className:"KHBattleCommandTurn",run:function(){return this._playTurnAnimation()},_playTurnAnimation:function(){var e=t.BattleCommand.PlayTurnAnimationFuncNames[this.actionData.getFrom()],n=this.battleWorld.turn;return _(n).pick(e).invoke("bind",n).reduce(Q.when,Q())}})}((this||0).self||global),function(e){var t=e.kh,n=e.console;t.BattleCommand.PlayCutInAnimationFuncNames={playerBurst:"playBurstCutInAnimation",playerBeatdown:"playBeatdownCutInAnimation",burstStreak:"playBurstStreakCutInAnimation"},t.BattleCommand.CutIn=t.BattleCommand.Abstract.extend({className:"KHBattleCommandCutIn",EVENT_LIST:["SOUND_START_CCS_21","SOUND_END_CCS_21"],init:function(e,n){t.BattleCommand.Abstract.prototype.init.apply(this,arguments),this._createVisualEffects(),e.cutIn.queueCutinCommand(this.actionData)},run:function(){var e,i=t.createInstance("BattleCommandEventLogic").init(this),a=this.actionData.getPos(),o=this.getSubject();return e=null==a||null==o||_.isEmpty(o)?function(){}:null!=a?this.brightenCharacterPanel(a):function(){},Q.all([i.registerEvents(this.getEventList()),this._playCutInAnimation()]).fail(function(e){n.warn(e.stack||e)}.bind(this)).finally(function(){e(),this.cleanUp()}.bind(this))},cleanUp:function(){},_playCutInAnimation:function(){var n=t.BattleCommand.PlayCutInAnimationFuncNames[this.actionData.getType()];return _.isUndefined(n)?(e.console.warn("KHBattleCommandCutIn._playCutInAnimation: unknown cutin type"),Q.resolve()):this.battleWorld.cutIn[n]()},_createVisualEffects:function(){return this._visualEffects?this._visualEffects:(this._visualEffects=[this.battleWorld.cutIn.createCutinEffect(this.actionData)],this._visualEffects)},_getResources:function(e){return{}}})}((this||0).self||global),function(e){var t=e.kh,n=e.res,i=e.Q;t.BattleCommand.Ability=t.BattleCommand.Abstract.extend({className:"KHBattleCommandAbility",EVENT_LIST:["SOUND_START_CCS_16","SOUND_END_CCS_16","ABILITY_EFFECT_START","COLORFILTER"],run:function(){var n=this.getSubject();if(null==n||_.isEmpty(n))return e.console.warn("KHBattleCommandAbility.run: subject avatar not found"),i.resolve();var a=this._initAbilityBaseEffect();a.play(this.battleWorld.CharacterLayer,n.getPosOnAvatar(a.getRelativeDisplayPosition())),this.postMessage();var o=t.createInstance("BattleCommandEventLogic").init(this),r=[];return"enemy"===this.actionData.getFrom()&&(_.pull(this.EVENT_LIST,"ABILITY_EFFECT_START"),r.push(o.__registerAbilityEffectStart(t.BattleCommand.FRAME_EVENT_NAMES.ATTACK_EFFECT_START))),r.push(o.registerEvents(this.getEventList())),this.playAvatarAnimationOnce(n,n.AVATAR_ANIMATION_NAMES.ABILITY).then(this.cleanUp.bind(this)),i.all(r).fail(function(t){e.console.warn(t.stack||t)})},_initAbilityBaseEffect:function(){var e=t.createInstance("WindowVisualEffect").init(n.battle_ability_effect_animation);return t.createInstance("Sound2Event",[e]),e.setAnimationEndCallback(e.cleanUp,e),e},_getResources:function(e){var n=t.createInstance("battleUrlParser"),i=this.getSubject(),a=i.isJob?"job":"avatar",o=this.actionData.getFrom();if(null!=n.resources.scenario.ability&&null!=n.resources.scenario.ability[o]&&null!=n.resources.scenario.ability[o][a])return n.resources.scenario.ability[o][a][i.id]},getVisualEffects:function(){return[]},getSoundEffects:function(){return null!=this._soundEffects?this._soundEffects:null==this._res.se?(e.console.warn("KHBattleCommandAbility.getSoundEffects: sound effects not properly loaded"),[]):null!=this._res.se?this._res.se:void 0}})}((this||0).self||global),function(e){var t=e.kh,n=e.console;t.BattleCommand.Damage=t.BattleCommand.HpModifierAbstract.extend({className:"KHBattleCommandDamage",getEventList:function(){var e=t.BattleCommand.Abstract.prototype.getEventList.call(this);if(!this.getVisualEffects().length)return e;var i=t.BattleCommand.FRAME_EVENT_NAMES,a=i.DAMAGE_NUMBER,o=this.getVisualEffects()[0];if(o.hasFrameEvent(a))return e.concat(a);var r=i.HEAL_NUMBER;return o.hasFrameEvent(r)?(n.warn("KHBattleCommandHeal.getEventList: no <"+a+"> event found, registering <"+r+"> instead."),e.concat(r)):(n.warn("KHBattleCommandHeal.getEventList: no <"+a+"> event or <"+r+"> found."),e.concat(a))}})}((this||0).self||global),function(e){var t=e.kh,n=e.console;t.BattleCommand.Heal=t.BattleCommand.HpModifierAbstract.extend({className:"KHBattleCommandHeal",VISUAL_EFFECT_SEQUENCE_SPEED:200,FLAGS:_.assign(t.BattleCommand.HpModifierAbstract.prototype.FLAGS,{ARMATURE:8,ITEM:16}),_createVisualEffects:function(){if(!this.actionData.getAnimationId())return[];var n=this.getAnimationFlags(),i=n&this.FLAGS.ARMATURE?"ArmatureVisualEffect":"WindowVisualEffect",a=n&this.FLAGS.ARMATURE?"ExportJson":"json";return null==this._res[a]?(e.console.warn("KHBattleCommandHeal._createVisualEffects: resources not properly loaded"),[]):n&this.FLAGS.MULTI?_.map(_.range(this.getTargets().length),function(){return t.createInstance(i).init(this._res[a])},this):[t.createInstance(i).init(this._res[a])]},start:function(){return this.actionData.getAnimationId()?(this.setVisualEffectPlaySequenceSpeed(this.VISUAL_EFFECT_SEQUENCE_SPEED),this.getAnimationFlags()&this.FLAGS.ITEM?this._playVisualEffects(t.AVATAR_EFFECT_NAMES.RECOVER):this._playVisualEffects()):Q.resolve()},getAnimationFlags:function(){var e=t.BattleCommand.HpModifierAbstract.prototype.getAnimationFlags.call(this);return null==this._res?e:(null!=this._res.ExportJson&&(e|=this.FLAGS.ARMATURE),"item"===this.actionData.getAnimationResourceType()&&(e|=this.FLAGS.ITEM),e)},getSoundEffects:function(){return null!=this._res.mp3?_.map(_.range(this.getVisualEffects().length),function(){return this._res.mp3},this):[]},getEventList:function(){var e=t.BattleCommand.Abstract.prototype.getEventList.call(this);if(!this.getVisualEffects().length)return e;var i=t.BattleCommand.FRAME_EVENT_NAMES,a=i.HEAL_NUMBER,o=this.getVisualEffects()[0];if(o.hasFrameEvent(a))return e.concat(a);var r=i.DAMAGE_NUMBER;return o.hasFrameEvent(r)?(n.warn("KHBattleCommandHeal.getEventList: no <"+a+"> event found, registering <"+r+"> instead."),e.concat(r)):(n.warn("KHBattleCommandHeal.getEventList: no <"+a+"> event or <"+r+"> found."),e.concat(a))}})}((this||0).self||global),function(e){var t=e.kh,n=e._,i=e.console;t.BattleCommand.SummonMovie=t.BattleCommand.Abstract.extend({className:"KHBattleCommandSummonMovie",CHARA_EFFECT_WIDGET_NAME:"chara",EVENT_LIST:["SOUND_START_CCS_21","SOUND_END_CCS_21"],run:function(){if(!t.createInstance("playerGameConfig").isSummonEffectEnabled())return Q.resolve();var e=t.createInstance("BattleCommandEventLogic").init(this);return n(this.battleWorld.enemyStatusBarList).filter(function(e){return!(null==e||n.isEmpty(e))}).invoke("setVisible",!1),Q.all([e.registerEvents(this.getEventList()),this._playMovie()]).then(this.cleanUp.bind(this)).fail(function(e){this.cleanUp(),i.error(e)}.bind(this))},cleanUp:function(){n.invoke(this._visualEffects,"cleanUp"),this._visualEffects=null,n(this.battleWorld.enemyStatusBarList).filter(function(e){return!(null==e||n.isEmpty(e))}).invoke("setVisible",!0)},_createVisualEffects:function(){var e;try{e=t.createInstance("WindowVisualEffect").init(this._res.movie.json)}catch(e){i.error("Failed to instantiate summon movie effects: json: "+this._res.movie.json+", id: "+this.actionData.getId())}var n=e.getNode();return n.scaleX=t.SUMMON_MOVIE_SCALE,n.scaleY=t.SUMMON_MOVIE_SCALE,[e,e.getChildEffect(this.CHARA_EFFECT_WIDGET_NAME)]},_playMovie:function(){return this.playVisualEffectOnce(this.getVisualEffects()[0],this.battleWorld.BattleLayer,t.NODE_POSITION.SUMMON)}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e.ccs,e._);t.BattleCommand.SummonDamage=t.BattleCommand.Abstract.extend({className:"KHBattleCommandSummonDamage",EVENT_LIST:["DAMAGE_START","DAMAGE_END","SOUND_START_CCS_21","SOUND_END_CCS_21","QUAKE_AVATAR_START","QUAKE_AVATAR_END","DAMAGE_NUMBER","COLORFILTER","LAYER_HOP"],run:function(){var n=t.createInstance("BattleCommandEventLogic").init(this),i=this.getVisualEffects()[0];return this.handleCoverStart().then(function(){return Q.all([n.registerEvents(this.getEventList()),this.playVisualEffectOnce(i,this.battleWorld.BattleLayer,t.NODE_POSITION.SUMMON_DAMAGE)])}.bind(this)).then(this._fadeInCharacters.bind(this)).fail(function(t){return e.console.warn(t.stack||t),this._fadeInCharacters()}.bind(this)).finally(function(){var e=this.handleCoverEnd();return this.battleWorld.battleUI.endSummon(),this.cleanUp(),e}.bind(this))},_fadeInCharacters:function(){return Q.all(n(this.battleWorld.characterList).filter(function(e){return!(null==e||n.isEmpty(e))}).invoke("fadeIn",t.Summon.prototype.FADE_SPEED))}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil;t.BattleCommand.SetEnemyChargeTurn=t.BattleCommand.Abstract.extend({className:"KHBattleCommandSetEnemyChargeTurn",CHARGE_TURN_COMMAND_DELAY:500,run:function(){var e=this.actionData.getCount(),t=this.actionData.getMax(),i=this.battleWorld.enemyStatusBarList[this.actionData.getPos()];return _.isUndefined(t)||i.adjustMaxChargeTurnDots(t),_.isUndefined(e)||i.adjustActiveChargeTurnDots(e),n.getPromiseToDelayAnimation(this.CHARGE_TURN_COMMAND_DELAY).then(this.postMessage.bind(this))}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil;t.BattleCommand.SetEnemyModeGauge=t.BattleCommand.Abstract.extend({className:"KHBattleCommandSetEnemyModeGauge",run:function(){var e=this.actionData.getPercent();return this.battleWorld.enemyStatusBarList[this.actionData.getPos()].adjustModeGauge(e),n.getPromiseToDelayAnimation(1e3*t.ENEMY_STATUS_BAR_ANIMATION_DURATION)}})}((this||0).self||global),function(e){var t=e.kh;t.RaidBattleCommand.SetEnemyModeGauge=t.BattleCommand.SetEnemyModeGauge.extend({className:"KHRaidBattleCommandSetEnemyModeGauge",run:function(){var n=this.battleWorld.enemyList[this.actionData.getPos()];return null==n||_.isEmpty(n)?(e.console.warn("KHBattleCommandSetEnemyModeGauge.run: target not found"),Q.resolve()):n.checkUpdateRequired("modeGauge",this.actionData.getTimestamp())?t.BattleCommand.SetEnemyModeGauge.prototype.run.call(this):Q.resolve()}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e.res),i=e.khutil;t.BattleCommand.Win=t.BattleCommand.Abstract.extend({className:"KHBattleCommandWin",WIN_COMMAND_DELAY:500,run:function(){var n=t.createInstance("stage");return n.isStageCleared()?Q.resolve():(n.clearStage(),this._clearScenarioCallbacks(),this._disableAutoFunctionality(),this._disableUI(),this._hideContinuePopup(),this._hideCurePopup(),this._playVoice(),this._showTreasureGained(),this._playEnemyDieAnimation().then(this._clearBattleWorldEnemyList.bind(this)).then(this._playAvatarWinAnimation.bind(this)).then(this._playWinCutinAnimation.bind(this)).then(this._showNextButton.bind(this)).fail(function(t){e.console.warn(t.stack)}))},_disableAutoFunctionality:function(){t.createInstance("autoScenarioHandler").interrupt()},_disableUI:function(){t.createInstance("battleUI").AutoButton.setEnabled(!1),t.createInstance("battleUI").BurstButton.setEnabled(!1),t.createInstance("battleUI").setEnabled(!1),t.createInstance("notificationCenter").dispatchEvent(t.EVENT_NAME.BATTLE_UI_DARKEN_FILTER.DARKEN_FOOTER)},_clearScenarioCallbacks:function(){t.createInstance("scenarioPlayer").removeScenarioEndEventCallbacks()},_playEnemyDieAnimation:function(){var e=_(this.battleWorld.enemyList).filter(function(e){return null!=e&&!_.isEmpty(e)}).map(function(e){return e.playDieAnimation().then(e.cleanUp.bind(e))}).value();return Q.all(e)},_clearBattleWorldEnemyList:function(){this.battleWorld.enemyList=_.map(this.battleWorld.enemyList,function(){return{}}),this.battleWorld.enemyStatusBarList=[]},_playAvatarWinAnimation:function(){return _(this.battleWorld.characterList).filter(function(e){return null!=e&&!_.isEmpty(e)}).invoke("playWinAnimation"),i.getPromiseToDelayAnimation(this.WIN_COMMAND_DELAY)},_playWinCutinAnimation:function(){var e=Q.defer(),a=t.createInstance("WindowVisualEffect").init(n.battle_win_animation);return a.setAnimationEndCallback(function(){a.cleanUp(),i.getPromiseToDelayAnimation(this.WIN_COMMAND_DELAY).then(e.resolve)}.bind(this)),a.play(this.battleWorld.CutinLayer,t.NODE_POSITION.BATTLE_BOTTOM_LEFT),e.promise},_showTreasureGained:function(){var e=this.battleWorld.battleUI.BattleUIHeader;e.hideHeaderInfo(),e.setPrizeVisible(!0)},_showNextButton:function(){this.battleWorld.battleUI.NextButton.setEndBattleCallback(),this.battleWorld.battleUI.CenterPanel.showNextButton()},_playVoice:function(){var e=this.getSoundEffects();0!==e.length&&t.createInstance("soundPlayer").playSoundEffect(e[0])},_hideContinuePopup:function(){t.createInstance("continuePopup").dismiss(),this.battleWorld.battleUI.CenterPanel.hideReviveButton()},_hideCurePopup:function(){t.createInstance("curePopup").dismiss()},_getResources:function(e){var n=t.createInstance("battleUrlParser");return null==n.resources.scenario?null:n.resources.scenario.win||null}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e.res;t.BattleCommand.Lose=t.BattleCommand.Abstract.extend({className:"KHBattleCommandLose",FADE_SPEED:.1,run:function(){var n=t.createInstance("continuePopup");return this._interruptAutoAttackScenario(),t.createInstance("scenarioPlayer").removeScenarioEndEventCallbacks(),this._playLoseAnimation().then(n.open.bind(n)).fail(function(t){e.console.warn(t.stack)})},_interruptAutoAttackScenario:function(){t.createInstance("autoScenarioHandler").interrupt()},_playLoseAnimation:function(){var e=Q.defer(),n=t.createInstance("WindowVisualEffect").init(i.battle_lose_animation);return t.createInstance("Sound2Event",[n]),n.setAnimationEndCallback(function(){this._fadeLoseAnimation(n).then(n.cleanUp.bind(n)),e.resolve()}.bind(this)),n.play(this.battleWorld.CutinLayer,t.NODE_POSITION.BATTLE_BOTTOM_LEFT),this._loseAnimation=n,e.promise},_fadeLoseAnimation:function(e){var t=Q.defer(),i=this.FADE_SPEED;return e._node.runAction(n.sequence(n.fadeOut(i,0),n.callFunc(t.resolve))),t.promise}})}((this||0).self||global),function(e){var t=e.kh;t.RaidBattleCommand.Lose=t.BattleCommand.Lose.extend({className:"KHRaidBattleCommandLose",run:function(){var n=t.createInstance("continuePopup");return t.createInstance("scenarioPlayer").removeScenarioEndEventCallbacks(),this._interruptAutoAttackScenario(),this._playLoseAnimation().then(this._showReviveButton.bind(this)).then(n.open.bind(n)).fail(function(t){e.console.warn(t.stack)})},_showReviveButton:function(){return 0===t.createInstance("cureItemInfo").getElixirUsableAmount()?Q.resolve():t.createInstance("battleUI").CenterPanel.showReviveButton()}})}((this||0).self||global),function(e){var t=e.kh;t.BattleCommand.NextStage=t.BattleCommand.Abstract.extend({className:"KHBattleCommandNextStage",run:function(){return t.createInstance("scenarioPlayer").removeScenarioEndEventCallbacks(),this.battleWorld.battleUI.NextButton.setNextStageCallback(),this._showTreasureGained(),this.battleWorld.battleUI.CenterPanel.showNextButton(),t.createInstance("stage").clearStage(),Q.resolve()},_showTreasureGained:function(){var e=this.battleWorld.battleUI.BattleUIHeader;e.hideHeaderInfo(),e.setPrizeVisible(!0)}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.res);t.BattleCommand.ChangeEnemyMode=t.BattleCommand.Abstract.extend({className:"KHBattleCommandChangeEnemyMode",run:function(){var n=this.actionData.getPos(),i=this.actionData.getType(),a=this.battleWorld.getAvatar(t.ActionData.TARGET_NAMES.ENEMY,n);if(null==a||_.isEmpty(a))return e.console.warn("KHBattleCommandChangeEnemyMode.run: target not found"),Q.resolve();a["setDefault"+_.capitalize(i)+"Mode"](),a.playIdleAnimation();var o={stun:this._playBattleEffectBase,raging:this._playBattleEffectBase,normal:function(){return Q.resolve()}}[i].call(this,a,"effect_"+i),r=this.battleWorld.enemyStatusBarList[n];this["_changeBar"+_.capitalize(i)+"Mode"](r);var s=t.generateGenericSoundPath(t.BattleGenericSeIdList[i]);return null!=s&&t.createInstance("soundPlayer").playSoundEffect(s.mp3),o.then(this.postMessage.bind(this))},_playBattleEffectBase:function(e,i){return this._battleBaseEffect=t.createInstance("ArmatureVisualEffect").init(n.battle_effect_base_json,e),this.playVisualEffectOnce(this._battleBaseEffect,e,e.getCenterPos(),i)},_changeBarRagingMode:function(e){e.displayStunMode(!1),e.displayRagingMode(!0),e.changeNormalModeDots()},_changeBarStunMode:function(e){e.displayRagingMode(!1),e.displayStunMode(!0),e.changeStunModeDots()},_changeBarNormalMode:function(e){e.displayRagingMode(!1),e.displayStunMode(!1),e.changeNormalModeDots()}})}((this||0).self||global),function(e){var t=e.kh;e.khutil,e.res,t.RaidBattleCommand.ChangeEnemyMode=t.BattleCommand.ChangeEnemyMode.extend({className:"KHBattleCommandChangeEnemyMode",run:function(){return this.postRaidMessage(),t.BattleCommand.ChangeEnemyMode.prototype.run.call(this)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e.ccs,a=e.res,o=e.console;t.BattleCommand.Die=t.BattleCommand.Abstract.extend({className:"KHBattleCommandDie",run:function(){var n,i=this.actionData.getFrom(),a=this.getSubject();return _.isEmpty(a)?(o.warn("KHBattleCommandDie.run: avatar not found: "+i+", pos:"+this.actionData.getPos()),Q.resolve()):("enemy"===i?n=t.createInstance("TreasureDropper").init(a.getPos(),a.index):this._playVoice(),this._reduceRemainingHp(a),this._setReloadButtonEnabled(!1),a.playDieAnimation().then(function(){this["_"+i+"Die"](a)}.bind(this)).then(this._showExperienceGained.bind(this,a.getCenterPos())).then(this._showRankPointsGained.bind(this,a.getCenterPos())).then(this._dropTreasure.bind(this,n)).then(this._setReloadButtonEnabled.bind(this,!0)).fail(function(t){e.console.error(t)}))},_reduceRemainingHp:function(e){e.adjustHP({hp:0})},_playerDie:function(e){e.isJob&&this.battleWorld.battleUI.setSummonBroken(!0);var n=t.createInstance("FallenAvatarOrderHandler").extractFallenDataFromCharacter(e);t.createInstance("characterUpdater").updateCharacter(this.actionData.getPos(),n)},_enemyDie:function(e){e.cleanUp();var t=this.actionData.getPos();this.battleWorld.enemyList[t]={},this.battleWorld.enemyStatusBarList[t]=null},_dropTreasure:function(e){if(null!=e){var t=this.actionData.getTreasure();_.isArray(t)&&0!==t.length&&e.dropTreasure(t)}},_showExperienceGained:function(e){return this._showPointsGainedAnimation("exp",e)},_showRankPointsGained:function(e){return this._showPointsGainedAnimation("rank",e)},_showPointsGainedAnimation:function(e,o){var r,s;if("exp"===e){if(r=a.battle_ui_exp_animation,null==(s=this.actionData.getExperience()))return;s="E"+s}else{if(r=a.battle_ui_rank_animation,null==(s=this.actionData.getRankPoints()))return;s="R"+s}var c=t.createInstance("PositionGenerator").generateRandomPositionInRect(n.rect(o.x-50,o.y-50,100,100)),u=i.load(r);return u.node.setPosition(c),ccui.helper.seekWidgetByName(u.node,"num").string=s,this.battleWorld.UIBackLayer.addChild(u.node),u.node.runAction(u.action),u.action.gotoFrameAndPlay(0,!1),khutil.getPromiseToDelayAnimation(100)},_playVoice:function(){var e=this.getSoundEffects();0!==e.length&&t.createInstance("soundPlayer").playSoundEffect(e[0])},_getResources:function(e){if(null==e.cmd)return null;var n=t.createInstance("battleUrlParser");if(null==n.resources.scenario)return null;if(null==n.resources.scenario.die)return null;var i=this.getSubject(),a=i.isJob,o=i.id;return null==n.resources.scenario.die[a?"job":"avatar"]?null:n.resources.scenario.die[a?"job":"avatar"][o]||null},_setReloadButtonEnabled:function(e){this.battleWorld.battleUI.ReloadButton.setEnabled(e)}})}((this||0).self||global),function(e){var t=e.kh;e.cc,e.ccs,e.res,t.RaidBattleCommand.Die=t.BattleCommand.Die.extend({className:"KHRaidBattleCommandDie",run:function(){return this.postRaidMessage(),t.BattleCommand.Die.prototype.run.call(this)}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil;t.BattleCommand.SetBurstGauge=t.BattleCommand.Abstract.extend({className:"KHBattleCommandSetBurstGauge",BURST_GAUGE_COMMAND_DELAY:0,run:function(){return _.each(this.actionData.getBurstGaugeAdjustments(),function(e){var t=this.battleWorld.characterList[e.pos];null!=t.adjustBurstGauge?t.adjustBurstGauge(e.percent):console.log("try to adjust burst gauge on a missed character")},this),n.getPromiseToDelayAnimation(this.BURST_GAUGE_COMMAND_DELAY)}})}((this||0).self||global),function(e){var t=e.kh,n=e._,i=e.console;t.BattleCommand.Join=t.BattleCommand.Abstract.extend({className:"KHBattleCommandJoin",run:function(){var e,t=this.actionData.getFrom(),n=this.actionData.getPos(),a=this.actionData.getAvatarData();return"player"===t?(e=this.createCharacter(a,n,this.actionData.getAbilityData()),this._setCharacterPos(e,n),this._clearCharacterStatusCache()):"enemy"===t&&(e=this.createEnemy(a,n),this._setEnemyPos(e,n),this._clearEnemyStatusCache()),e.playEnterBattleAnimation().then(this._playVoice.bind(this)).fail(function(e){i.error(e)})},_getCharacterStatusPanel:function(e){return this.battleWorld.characterPanelList[e]},_createEnemyStatusPanel:function(e,n){var i=this.battleWorld.enemyList.length;n>=i&&i++;var a=t.ENEMY_STATUS_BAR_JSONS[i-1],o=t.createInstance("EnemyStatusBar",[e,a,i,n]);return o.appendTo(this.battleWorld.UIBackLayer),this.battleWorld.enemyStatusBarList[n]=o,o},createCharacter:function(e,t,n){var i=this._getCharacterStatusPanel(t),a=this._createCharacterAvatar(e,t,i);return a.appendTo(this.battleWorld.CharacterLayer),this._createAbility(t,i,n),a},createEnemy:function(e,t){var n=this._createEnemyStatusPanel(e,t),i=this._createEnemyAvatar(e,t,n);return i.appendTo(this.battleWorld.EnemyLayer),i},_createCharacterAvatar:function(e,n,i){var a=t.createInstance("Character").init(e,n,i);return this.battleWorld.characterList[n]=a,t.createInstance("characterUpdater").updateCharacter(n,a),a.isJob&&this.battleWorld.battleUI.setSummonBroken(!1),a},_createEnemyAvatar:function(e,n,i){var a=t.createInstance("Enemy").init(e,n,i);return this.battleWorld.enemyList[n]=a,a},_setCharacterPos:function(e,n){var i=t.CHARACTER_POSITION_LIST[this.battleWorld.characterList.length-1];e.initEnterBattleAnimation(i[n])},_setEnemyPos:function(e,n){var i=t.ENEMY_POSITION_LIST[this.battleWorld.enemyList.length-1];e.initEnterBattleAnimation(i[n])},_createAbility:function(e,i,a){this.battleWorld.characterAbilityList[e]=n.map(a,function(e,a){return n.isEmpty(e)?null:t.createInstance("Ability").init(e,a,i)})},_playVoice:function(){var e=this.getSoundEffects();0!==e.length&&t.createInstance("soundPlayer").playSoundEffect(e[0])},_getResources:function(e){if(null==e.cmd)return null;var n=t.createInstance("battleUrlParser");if(null==n.resources.scenario)return null;if(null==n.resources.scenario.joinBattle)return null;var i=this.actionData.getAvatarData(),a=i.is_job,o=i.id;return null==n.resources.scenario.joinBattle[a?"job":"avatar"]?null:n.resources.scenario.joinBattle[a?"job":"avatar"][o]||null},_getJoinedAvatarSubPos:function(e){var t=n.compact(this.battleWorld.subList);if(null==t||0===t.length)return-1;var i=n.find(n.range(t.length),function(n){return e.id===t[n].id&&e.isJob===t[n].isJob});return null==i?-1:i},_clearCharacterStatusCache:function(){t.AvatarOrderHandler.prototype._clearPlayerBattleStatusCache.call(this,t.createInstance("battleStatus"))},_clearEnemyStatusCache:function(){t.AvatarOrderHandler.prototype._clearEnemyBattleStatusCache.call(this,t.createInstance("battleStatus"))}})}((this||0).self||global),function(e){var t=e.kh,n=e.console;t.BattleCommand.RemoveStatus=t.BattleCommand.HpModifierAbstract.extend({className:"KHBattleCommandRemoveStatus",EVENT_LIST:["SOUND_START_CCS_21","COLORFILTER"],REMOVE_SPEED:300,init:function(e,t){this.battleWorld=e,this.actionData=this._createActionDataObject(t),this.statusEffectData=t,this._res=this._getResources(t)},preload:function(){this.getVisualEffects()},run:function(){var e=t.createInstance("BattleCommandEventLogic").init(this),i=this._getStatusEffectIdList();if(!this.statusEffectData.animation_id){var a=this.getTargets();return _.each(a,function(e,t){e=_.isArray(e)?e:[e],_.each(e,function(e){this._removeStatusEffects(e,i[t])},this)},this),Q.resolve()}return this.setVisualEffectPlaySequenceSpeed(this.REMOVE_SPEED),this._setOnEffectEndCallback(i),Q.all([e.registerEvents(this.getEventList()),this.start()]).fail(function(e){n.warn(e.stack)})},getTargets:function(){if(null!=this._targets)return this._targets;var e=this.battleWorld.characterList,t=this.battleWorld.enemyList,n=[];return _.each(this.statusEffectData.affected_avatars.players,function(t){n.push(e[t.pos])},this),_.each(this.statusEffectData.affected_avatars.enemies,function(e){n.push(t[e.pos])},this),this.getAnimationFlags()&this.FLAGS.MULTI?this._targets=this._restructureDataForMulti(n):this._targets=[n],this._targets},getAnimationType:function(){return this.actionData.getAnimationType()||"multi_sequence"},_getStatusEffectIdList:function(){var e=this.statusEffectData.affected_avatars;return e&&e.players&&!e.players.concat&&(n.warn("KHBattleCommandRemoveStatus: corrupt affected_avatars data send: "+e),e.players=[]),e&&e.enemies&&!e.enemies.concat&&(n.warn("KHBattleCommandRemoveStatus: corrupt affected_avatars data send: "+e),e.enemies=[]),_.pluck((e.players||[]).concat(e.enemies||[]),"removed_ids")},_setOnEffectEndCallback:function(e){this.setOnEffectPlayEndCallback(function(t,n){_.each(n,function(t,n){this._removeStatusEffects(t,e[n])},this)},this)},_removeStatusEffects:function(e,t){return null==e||_.isEmpty(e)?void n.warn("KHBattleCommandRemoveStatus._removeStatusEffects: target not found"):null==t?void n.warn("KHBattleCommandRemoveStatus._removeStatusEffects: status effect removed ids already used"):void _.each(t,function(t,i){var a=this.battleWorld.statusEffectList[t];return null==a?void n.warn("KHBattleCommandRemoveStatus._removeStatusEffects: status effect not found"):void e.statusPanel.removeStatusEffect(a)},this)},_getResources:function(e){if(!e.animation_id)return null;var i=t.createInstance("battleUrlParser");return null==i.resources.scenario.ability||null==i.resources.scenario.ability[this.statusEffectData.animation_id]?(n.warn("KHBattleCommandRemoveStatus._getResources: resources not properly loaded"),{}):i.resources.scenario.ability[this.statusEffectData.animation_id]}})}((this||0).self||global),function(e){var t=e.kh;t.BattleCommand.ApplyStatus=t.BattleCommand.HpModifierAbstract.extend({className:"KHBattleCommandApplyStatus",EVENT_LIST:["STATUS_ICON","SOUND_START_CCS_21","COLORFILTER"],APPLY_SPEED:300,init:function(e,t){this.battleWorld=e,this.actionData=this._createActionDataObject(t),this.statusEffectData=t,this._res=this._getResources(t)},preload:function(){this._createStatusEffect(this.statusEffectData),this.getVisualEffects()},run:function(){var n=t.createInstance("BattleCommandEventLogic").init(this),i=this._createStatusEffect(this.statusEffectData);return this.setVisualEffectPlaySequenceSpeed(this.APPLY_SPEED),Q.all([n.registerEvents(this.getEventList()),this.start()]).fail(function(t){e.console.warn(t.stack||t)}.bind(this)).finally(function(){i.applyStatusEffectToAvatars(),this._clearBattleStatusCache()}.bind(this))},getTargets:function(){if(null!=this._targets)return this._targets;var e=this.battleWorld.statusEffectList[this.statusEffectData.id].getTargetAvatars();return this.getAnimationFlags()&this.FLAGS.MULTI?this._targets=this._restructureDataForMulti(e):this._targets=[e],this._targets},getAnimationType:function(){return this.actionData.getAnimationType()||"multi_sequence"},_createStatusEffect:function(e){var n;return(n=null!=this.battleWorld.statusEffectList[e.id]?this.battleWorld.statusEffectList[e.id]:t.createInstance("StatusEffect")).init(e),this.battleWorld.statusEffectList[e.id]=n,n},_getResources:function(n){if(!this.statusEffectData.animation_id)return{};var i=t.createInstance("battleUrlParser");return null==i.resources.scenario.ability||null==i.resources.scenario.ability[this.statusEffectData.animation_id]?(e.console.warn("KHBattleCommandApplyStatus._getResources: resources not properly loaded"),{}):i.resources.scenario.ability[this.statusEffectData.animation_id]},_clearBattleStatusCache:function(){var e=t.createInstance("battleStatus");e.clearCacheByName(e.CACHE_INDEX.PARTY_MEMBERS),e.clearCacheByName(e.CACHE_INDEX.ENEMIES)}})}((this||0).self||global),function(e){var t=e.kh;t.BattleCommand.IncreaseParticipants=t.BattleCommand.Abstract.extend({className:"KHBattleCommandIncreaseParticipants",run:function(){return t.createInstance("battleUI").BattleUIHeader.incrementParticipantNumber(),this.postRaidMessage(),Q.resolve()}})}((this||0).self||global),function(e){var t=e.kh;t.BattleCommand.AdjustEnemyHp=t.BattleCommand.Abstract.extend({className:"KHBattleCommandAdjustEnemyHp",run:function(){this.postRaidMessage();var t=this.battleWorld.enemyList[this.actionData.getPos()];return null==t||_.isEmpty(t)?(e.console.warn("KHBattleCommandAdjustEnemyHp.run: target not found"),Q.resolve()):(t.checkUpdateRequired("hp",this.actionData.getTimestamp())&&t.adjustHP({hp:this.actionData.getHp()}),Q.resolve())}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil;t.BattleCommand.ReceiveRaidPoints=t.BattleCommand.Abstract.extend({className:"KHBattleCommandReceiveRaidPoints",COMMAND_DURATION:1e3,VISIBLE_DURATION:1e3,FADE_IN_SPEED:.1,FADE_OUT_SPEED:1,SPRITE_POSITION:t.NODE_POSITION.RECEIVE_RAID_POINTS_SPRITE,run:function(){var e=this._createRaidPointSprite(),i=this._createLabel();return e.addChild(i),t.createInstance("battleWorld").UIBackLayer.addChild(e),this._fadeIn(e,i).then(this._delay.bind(this)).then(this._fadeOut.bind(this,e,i)).then(this._cleanUp.bind(this,e)),n.getPromiseToDelayAnimation(this.COMMAND_DURATION)},_createRaidPointSprite:function(){var e=new cc.Sprite("#battle/res/battle_ui/credit_point.png");return e.setPosition(this.SPRITE_POSITION),e.setAnchorPoint(cc.p(0,0)),e.setOpacity(0),e},_createLabel:function(){var e=new cc.LabelTTF("+"+this.actionData.getAmount());return e.setFontFillColor(cc.color(255,255,255,255)),e.setFontSize(25),e.enableStroke(cc.color(200,0,0,255),1),e.setAnchorPoint(cc.p(0,.5)),e.setVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_CENTER),e.setPosition(cc.p(65,22)),e.setOpacity(0),e.setSkewX(10),e},_fadeIn:function(e,t){return Q.all([n.fadeIn(e,this.FADE_IN_SPEED),n.fadeIn(t,this.FADE_IN_SPEED)])},_delay:function(){return Q.delay(this.VISIBLE_DURATION)},_fadeOut:function(e,t){return Q.all([n.fadeOut(e,this.FADE_OUT_SPEED),n.fadeOut(t,this.FADE_OUT_SPEED)])},_cleanUp:function(e){e.setVisible(!1),e.removeFromParent()}})}((this||0).self||global),function(e){var t=e.kh;t.BattleCommand.Timeup=t.BattleCommand.Abstract.extend({className:"KHBattleCommandTimeup",run:function(){var e=t.createInstance("questInfo");return t.createInstance("notificationCenter").dispatchEvent(t.EVENT_NAME.BATTLE_UI_DARKEN_FILTER.DARKEN_FOOTER),t.createInstance("battleUI").setEnabled(!1),t.createInstance("RunoutPopupFactory").create().open({aQuestId:e.getQuestId(),questType:e.getQuestType()}),this._interruptAutoAttack(),Q.resolve()},_interruptAutoAttack:function(){t.createInstance("autoScenarioHandler").interrupt()}})}((this||0).self||global),function(e){var t=e.kh;t.BattleCommand.EnemiesDown=t.BattleCommand.Abstract.extend({className:"KHRaidBattleCommandEnemiesDown",run:function(){return t.createInstance("raidDownPopupFactory").create({}).open(),Q.resolve()}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e.ccs,e._,e.console);t.BattleCommand.BurstStreak=t.BattleCommand.Abstract.extend({className:"KHBattleCommandBurstStreak",EVENT_LIST:["DAMAGE_START","DAMAGE_END","SOUND_START_CCS_21","SOUND_END_CCS_21","QUAKE_AVATAR_START","QUAKE_AVATAR_END","DAMAGE_NUMBER","COLORFILTER"],run:function(){var e=t.createInstance("BattleCommandEventLogic").init(this),i=this.getVisualEffects()[0];return null==i?(n.warn("KHBattleCommandBurstStreak.run: unable to create visual effect"),Q.resolve()):this.handleCoverStart().then(function(){return Q.all([e.registerEvents(this.getEventList()),this.playVisualEffectOnce(i,this.battleWorld.BattleLayer,t.NODE_POSITION.SUMMON_DAMAGE)])}.bind(this)).fail(function(e){n.warn(e.stack||e)}.bind(this)).finally(function(){var e=this.handleCoverEnd();return this.cleanUp(),e}.bind(this))},_getResources:function(e){return t.createInstance("battleUrlParser").resources.scenario.burstStreak[e.id]}})}((this||0).self||global),function(e){var t=e.kh;t.BattleCommand.PlayVisualEffect=t.BattleCommand.HpModifierAbstract.extend({className:"KHBattleCommandPlayVisualEffect",EVENT_LIST:["SOUND_START_CCS_21","SOUND_END_CCS_21","COLORFILTER","LAYER_HOP"],getTargets:function(){return _.compact(_.map(this.actionData.getTargets(),function(e){if("player"===e.to){var t=this.battleWorld.characterList[e.pos];return null==t||_.isEmpty(t)?null:[t]}if("enemy"===e.to){var n=this.battleWorld.enemyList[e.pos];return null==n||_.isEmpty(n)?null:[n]}},this))}})}((this||0).self||global),function(e){var t=e.kh;e.cc,e.ccs,e.res,t.BattleCommand.BanAbilityAbstract=t.BattleCommand.Abstract.extend({className:"KHBattleCommandBanAbilityAbstract",init:function(e,t){this.battleWorld=e,this.characterAbilityBans=t.abilities},_setAbilitiesBanned:function(n){var i=t.createInstance("battleStatus");i.clearCacheByName(i.CACHE_INDEX.ABILITY_BANS),_.each(this.characterAbilityBans,function(t){var i=t.character_pos,a=t.ability_pos_list;_.each(a,function(t){var a=this.battleWorld.characterAbilityList[i];if(null!=a&&!_.isEmpty(a)){var o=a[t];return null==o||null==o.setAbilityBanned?void e.console.warn("KHBattleCommandBanAbilityAbstract._setAbilityBans: ability not found"):void this.battleWorld.characterAbilityList[i][t].setAbilityBanned(n,t)}e.console.warn("KHBattleCommandBanAbilityAbstract._setAbilityBans: character not found")},this)},this)}})}((this||0).self||global),function(e){var t=e.kh;e.cc,e.ccs,e.res,t.BattleCommand.BanAbility=t.BattleCommand.BanAbilityAbstract.extend({className:"KHBattleCommandBanAbility",run:function(){return this._setAbilitiesBanned(!0),Q.defer()}})}((this||0).self||global),function(e){var t=e.kh;e.cc,e.ccs,e.res,t.BattleCommand.UnbanAbility=t.BattleCommand.BanAbilityAbstract.extend({className:"KHBattleCommandUnbanAbility",run:function(){return this._setAbilitiesBanned(!1),Q.defer()}})}((this||0).self||global),function(e){var t=e.kh;t.BattleCommand.BanBurstAbstract=t.BattleCommand.Abstract.extend({className:"KHBattleCommandBanBurstAbstract",init:function(e,t){this.battleWorld=e,this.burstBansCharacterIndices=t.poslist},_setBurstBanned:function(e){_.each(this.burstBansCharacterIndices,function(t){var n=this.battleWorld.characterList[t];null==n||_.isEmpty(n)||n.setBurstBanned(e)},this)}})}((this||0).self||global),function(e){var t=e.kh;t.BattleCommand.BanBurst=t.BattleCommand.BanBurstAbstract.extend({className:"KHBattleCommandBanBurst",run:function(){return this._setBurstBanned(!0),Q.defer()}})}((this||0).self||global),function(e){var t=e.kh;t.BattleCommand.UnbanBurst=t.BattleCommand.BanBurstAbstract.extend({className:"KHBattleCommandUnbanBurst",run:function(){return this._setBurstBanned(!1),Q.defer()}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._),i=e.Q;e.console,t.BattleCommand.MoveAvatar=t.BattleCommand.Abstract.extend({className:"KHBattleCommandMoveAvatar",FADE_SPEED:.2,run:function(){var e=this.actionData.getPlayers(),t=this.actionData.getEnemies();return this.fadeOutAvatars(e,t).then(this.moveAllAvatars.bind(this,e,t)).then(this.fadeInAvatars.bind(this,e,t))},fadeOutAvatars:function(e,t){return this._fadeAllAvatars(e,t,!0)},fadeInAvatars:function(e,t){return this._fadeAllAvatars(e,t,!1)},_fadeAllAvatars:function(e,t,n){return i.all([this._fadeAvatars(e,"character",n),this._fadeAvatars(t,"enemy",n)])},_fadeAvatars:function(e,t,a){return i.all(n.map(n.pluck(e,a?"from_pos":"to_pos"),function(e){var o=this.battleWorld[t+"List"][e];return null==o||n.isEmpty(o)?i.resolve():(o.statusPanel.setVisible(!a),o[a?"fadeOut":"fadeIn"](this.FADE_SPEED))},this))},moveAllAvatars:function(e,n){var a=t.createInstance("AvatarOrderHandler");return a.movePlayers(e),a.moveEnemies(n),i.resolve()}})}((this||0).self||global),function(e){var t=e.kh,n=e._,i=e.Q,a=e.console;t.BattleCommand.Revive=t.BattleCommand.Heal.extend({className:"KHBattleCommandRevive",FADE_SPEED:.2,VISUAL_EFFECT_SEQUENCE_SPEED:200,run:function(){return this.setVisualEffectPlaySequenceSpeed(this.VISUAL_EFFECT_SEQUENCE_SPEED),this.setOnEffectPlayStartCallback(this._effectPlayStartCallback,this),this._rearrangeAvatar().then(this._inviteAvatar.bind(this)).then(this._fadeInHiddenNonTargetAvatars.bind(this)).then(t.BattleCommand.Heal.prototype.run.bind(this))},_rearrangeAvatar:function(){var e=this.actionData.getFrom(),n="enemy"===e?"enemies":"players",i=this.actionData.getAvatarMoved(),a=t.createInstance("BattleCommandMoveAvatar"),o="player"===e?i:[],r="enemy"===e?i:[],s={};return s[n]=i,a.init(this.battleWorld,s),a.fadeOutAvatars(o,r).then(a.moveAllAvatars.bind(a,o,r))},_fadeInHiddenNonTargetAvatars:function(){var e="enemy"===this.actionData.getFrom()?"enemy":"character",t=this.battleWorld[e+"List"],a=n.map(t,function(e){if(null!=e&&null!=e.index)return e.index}),o=this.FADE_SPEED;n.each(this.actionData.getModifyHPData(),function(e){n.each(e,function(e){-1!==a.indexOf(e.pos)&&n.pull(a,e.pos)})});var r=n.map(a,function(e){return t[e]});return i.all(n.compact(n.map(r,function(e){return null==e||n.isEmpty(e)?null:(e.statusPanel.setVisible(!0),e.fadeIn(o))})))},_inviteAvatar:function(){var e="enemy"===this.actionData.getFrom()?"Enemy":"Character",a=this.actionData.getAvatarJoined(),o=t.createInstance("BattleCommandJoin"),r=this["_get"+e+"PosList"]();return i.all(n.map(a,function(t){o.init(this.battleWorld,t);var n=this["_create"+e+"Avatar"](o,t);return n.setPosNormalized(r[t.pos]),n.fadeOut(0),n.playIdleAnimation(),i.resolve()},this))},_getCharacterPosList:function(){return t.CHARACTER_POSITION_LIST[this.battleWorld.characterList.length-1]},_getEnemyPosList:function(){return t.ENEMY_POSITION_LIST[this.battleWorld.enemyList.length-1]},_createCharacterAvatar:function(e,t){return e.createCharacter(t.avatar,t.pos,t.ability)},_createEnemyAvatar:function(e,t){return e.createEnemy(t.avatar,t.pos)},getAnimationFlags:function(){return this.ANIMATION_TYPE_FLAG_SETTINGS[this.actionData.getAnimationType()||"multi_sequence"]},_getResources:function(){var e=t.createInstance("battleUrlParser");return null==e.resources.scenario.ability?null:this.actionData.getAnimationId()?e.resources.scenario.ability[this.actionData.getAnimationId()]:null},_effectPlayStartCallback:function(e,t){if(0===t.length||null==t[0]||n.isEmpty(t[0]))a.warn("kh.BattleCommandRevive: target to revive not found");else{var i=t[0];i.fadeIn(this.FADE_SPEED),i.statusPanel.setVisible(!0),i.statusPanel.enableDarkenFilter&&i.statusPanel.enableDarkenFilter(!1)}}})}((this||0).self||global),function(e){var t=e.kh;t.BattleCommand.Message=t.BattleCommand.Abstract.extend({className:"KHBattleCommandMessage",run:function(){return this.postMessage(),Q.resolve()}})}((this||0).self||global),function(e){var t=e.kh;t.BattleCommand.RaidMessage=t.BattleCommand.Abstract.extend({className:"KHBattleCommandRaidMessage",run:function(){return this.postRaidMessage(),Q.resolve()}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e.console,t.BattleCommand.Cooldown=t.BattleCommand.Abstract.extend({className:"KHBattleCommandCooldown",run:function(){if(t.createInstance("stage").isStageCleared())return Q.resolve();if(t.createInstance("autoScenarioHandler").isEnabled()){t.createInstance("scenarioPlayer").removeScenarioEndEventCallbacks();var e=n.director.getRunningScene();return this._cooldown().then(this._retry.bind(this,e)),Q.reject("KHBattleCommandCooldown._retry: retrying scenario, discarding old scenario flow")}return this._showCooldownPopup(),Q.resolve()},_showCooldownPopup:function(){var e=this.actionData.getRemainingCooldown();t.createInstance("processPopupFactory").create({}).open({cooldownTime:e})},_cooldown:function(){return Q.delay(this.actionData.getRemainingCooldown())},_retry:function(e){var i=t.createInstance("autoScenarioHandler");if(e==n.director.getRunningScene()&&!t.createInstance("stage").isStageCleared()&&0!==_.reject(t.createInstance("battleWorld").characterList,_.isEmpty).length)return i.isEnabled()?void t.createInstance("battleWorld").attack():(t.createInstance("battleUI").setEnabled(!0),void t.createInstance("notificationCenter").dispatchEvent(t.EVENT_NAME.BATTLE_UI_DARKEN_FILTER.RESTORE_FOOTER))}})}((this||0).self||global),function(e){var t=e.cc,n=e.kh,i=e._,a=e.console;n.ScenarioPlayer=t.Class.extend({className:"KHScenarioPlayer",_battleCmdFactoryReg:null,_emptyCallback:function(){},ctor:function(){this._init()},_init:function(){this._battleCmdFactoryReg=n.createInstance("battleCommandFactoryRegistry"),this._scenarioEndCallbacks=[]},play:function(e,t){if(!e||!e.length||!t){var i=Q.defer();return i.resolve(),i.promise}return this._runCommands(this._createCommands(t,e)).then(this._endScenario.bind(this)).fail(function(e){e||(a.warn(e),e.stack&&n.createInstance("smartBeat").sendError(e))})},_createCommands:function(e,t){return i.map(t,function(t){return this._battleCmdFactoryReg.createFactory(t.cmd).create(e,t)},this)},_runCommands:function(e){var t=Q.resolve();i.reduce(e,function(e,n){if(null!=e)return t=t.then(e.run.bind(e,n)),n});var n=i.last(e);return(t=t.then(n.run.bind(n)).fin(i.invoke.bind(i,e,"cleanUp"))).fail(function(e){a.warn(e&&e.stack?e.stack:e)}),t},_endScenario:function(){this._fireEndScenarioEvent(),n.createInstance("notificationCenter").dispatchEvent(n.EVENT_NAME.FADE_CHARACTERS_IN)},_fireEndScenarioEvent:function(){return Q.all(i.map(this._scenarioEndCallbacks,function(e){return e&&e.callback.call(e.context)})).then(this._removeEmptyCallbacks.bind(this))},addScenarioEndEventCallback:function(e,t){this._scenarioEndCallbacks.push({callback:e,context:t})},addScenarioEndEventCallbackOnce:function(e,t){var n=function(e,t){return function(){e.apply(this,arguments),t(n),n=null}}(e,this.removeScenarioEndEventCallback.bind(this));this._scenarioEndCallbacks.push({callback:n,context:t})},removeScenarioEndEventCallback:function(e){i.each(this._scenarioEndCallbacks,function(t){if(t.callback===e)return t.callback=this._emptyCallback,t.context=null,!1},this)},removeScenarioEndEventCallbacks:function(){this._scenarioEndCallbacks=[]},_removeEmptyCallbacks:function(){i.remove(this._scenarioEndCallbacks,function(e){return e.callback===this._emptyCallback},this)},_onDispose:function(){this.cleanUp()},cleanUp:function(){this._scenarioEndCallbacks=null,this._battleCmdFactoryReg=null}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;t.ActionData=n.Class.extend({_actionData:null,ctor:function(e){this._actionData=e},getId:function(){return this._actionData.id},getAnimationId:function(){return this._actionData.animation_id},getAnimationResourceType:function(){return this._actionData.animation_resource_type},getCmd:function(){return this._actionData.cmd},getPos:function(){return this._actionData.pos},getPosList:function(){return this._actionData.poslist},getType:function(){return this._actionData.type},getFrom:function(){return this._actionData.from},getTo:function(){var e=this.getModifyHPData();return null==e?null:e[0][0].to},getModifyHPData:function(){return i.isUndefined(this._actionData.damage)?i.isUndefined(this._actionData.heal)?void 0:this._actionData.heal:this._actionData.damage},getTargets:function(){return this._actionData.targets||[]},isHeal:function(){return null!=this._actionData.heal},getTotal:function(){return this._actionData.total},getTotalDamage:function(){return{value:this._actionData.total,element_type:this._actionData.element_type}},getCount:function(){return this._actionData.count},getMax:function(){return this._actionData.max},getPercent:function(){return this._actionData.percent},getAmount:function(){return this._actionData.amount},getHp:function(){return this._actionData.hp},getTimestamp:function(){return this._actionData.timestamp},getArmatureName:function(){return this._actionData.armatureName},getName:function(){return this._actionData.name},getResource:function(){return this._actionData.resource},voiceCount:0,getVoiceInOrder:function(){if(i.isUndefined(this._actionData.voice))return"";if(i.isUndefined(this._actionData.voice[this.voiceCount]))return"";var e=this._actionData.voice[this.voiceCount];return this.voiceCount++,e},getVoices:function(){return i.isUndefined(this._actionData.voice)?[]:this._actionData.voice},soundEffectCount:0,getSoundEffectInOrder:function(){if(i.isUndefined(this._actionData.soundEffect))return"";if(i.isUndefined(this._actionData.soundEffect[this.soundEffectCount]))return"";var e=this._actionData.soundEffect[this.soundEffectCount];return this.soundEffectCount++,e},getSoundEffects:function(){return i.isUndefined(this._actionData.soundEffect)?[]:this._actionData.soundEffect},visualEffectCount:0,getVisualEffectInOrder:function(){if(i.isUndefined(this._actionData.visualEffect))return null;if(i.isUndefined(this._actionData.visualEffect[this.visualEffectCount]))return null;var e=this._actionData.visualEffect[this.visualEffectCount];return this.visualEffectCount++,e},getVisualEffects:function(){return i.isUndefined(this._actionData.visualEffect)?[]:this._actionData.visualEffect},getSpeedScale:function(){return"speedScale"in this._actionData||(this._actionData.speedScale=1),this._actionData.speedScale},getBurstGaugeAdjustments:function(){return this._actionData.adjustments},getPlayers:function(){return this._actionData.players||[]},getEnemies:function(){return this._actionData.enemies||[]},getAbilityData:function(){return this._actionData.ability},getTreasure:function(){return this._actionData.treasure},getExperience:function(){return this._actionData.experience},getRankPoints:function(){return this._actionData.rank_points},getAnimationType:function(){return this._actionData.animation_type},getMessage:function(){return this._actionData.message?this._actionData.message:"message"===this._actionData.cmd?this._actionData:null},getRaidMessage:function(){return this._actionData.raid_message},getAvatarMoved:function(){return this._actionData.avatar_moved},getAvatarJoined:function(){return this._actionData.avatar_joined},getCover:function(){return this._actionData.has_cover_pos},getAvatarData:function(){return this._actionData.avatar},getRemainingCooldown:function(){return this._actionData.time_remaining}}),t.ActionData.TARGET_NAMES={PLAYER:"player",ENEMY:"enemy"}}((this||0).self||global),function(e){var t=e.kh;e.cc,e._,t.RaidActionData=t.ActionData.extend({getRaidMessage:function(){return this._actionData.raid_message}})}((this||0).self||global),function(e){var t=e.kh,n=e._;e.console,t.RaidScenarioPlayer=t.ScenarioPlayer.extend({className:"KHRaidScenarioPlayer",ctor:function(){this._super(),this._channels={},this._ignoreEndEventList=[],this._initChannels(),this._scenarioFactory=t.createInstance("RaidScenarioFactory")},_initChannels:function(){n.each(t.raid_scenario.CHANNEL_REGISTRY,function(e,n){this._channels[n]={isPaused:!1,isPlaying:!1,scenarioQueue:t.createInstance("RaidScenarioQueue",[t.raid_scenario.RAID_SCENARIO_LIMIT])}},this)},play:function(e){return Q.all(n.map(this._channels,function(e,t){!e.isPlaying&&this._playNextOnChannel(t);var n=e.scenarioQueue.getLast();return n?n.getPromise():Q.resolve()},this))},enqueueOtherPlayerScenario:function(e){return e&&e.length?this._assignDataToChannels(e,!1):Q.resolve()},enqueueOwnScenario:function(e){return e&&e.length?this._assignDataToChannels(e,!0):Q.resolve()},closeFloodGate:function(){this._channels.default.scenarioQueue.closeFloodGate()},openFloodGate:function(){this._channels.default.scenarioQueue.openFloodGate()},_assignDataToChannels:function(e,i){e=this._filterRaidMessages(e);var a=n.map(t.raid_scenario.CHANNEL_REGISTRY,function(t,n){var a=this._scenarioFactory.create(e,i,n);return this._enqueue(a,n)},this);return Q.all(a)},_filterRaidMessages:function(e){return e.concat(n(e).map(function(e){if(!e.raid_message)return null;var t=n.clone(e.raid_message);return delete e.raid_message,{cmd:"raid_message",raid_message:t}}).compact().value())},_enqueue:function(e,t){var n=this._channels[t];e.isOwnScenario()?n.scenarioQueue.pushToPriorityLane(e):n.scenarioQueue.push(e);var i=e.getPromise();return i.then(this._playNextOnChannel.bind(this,t)),i},pauseChannel:function(e){this._channels[e||"default"].isPaused=!0},resumeChannel:function(e){this._channels[e||"default"].isPaused=!1},playCurrentlyQueuedScenariosWithPriority:function(){return n.each(this._channels,function(e){e.scenarioQueue.moveAllToPriorityLane()},this),this.play()},clearScenarioQueue:function(){n.each(this._channels,function(e){e.isPaused=!1,e.isPlaying=!1,e.scenarioQueue.clearAll()})},_playNextOnChannel:function(e){var n=this._channels[e];if(n.isPaused)return n.isPlaying=!1,Q.resolve();var i=n.scenarioQueue.pullFirst();if(null==i)return n.isPlaying=!1,Q.resolve();n.isPlaying=!0;var a=t.ScenarioPlayer.prototype.play.call(this,i.getCommandList(),t.createInstance("battleWorld"));return i.isOwnScenario()&&a.finally(this._endScenarioBlock.bind(this,e)),a.finally(i.resolveAsFinished.bind(i)),a},_endScenario:function(){},_endScenarioBlock:function(e){return"default"!==e?Q.resolve():Q.all(n.map(this._scenarioEndCallbacks,function(e){return e.callback.call(e.context)})).then(this._removeEmptyCallbacks.bind(this))}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.console;t.BurstVoiceScenario=n.Class.extend({init:function(){return this._cache={job:{},character:{}},this},play:function(){t.createInstance("playerGameConfig").isSeOn()&&this._load().then(function(e){null!=e&&t.createInstance("soundPlayer").playSoundEffect(e)}.bind(this)).fail(function(e){e&&a.warn(e.stack?e.stack:e)})},_load:function(){if(!t.createInstance("battleUI").isFlgUseSpecialAttack())return Q.reject("Aborting play of burst voice sound effect: burst button not enabled");var e=i.filter(t.createInstance("battleWorld").characterList,function(e){return e&&e.burst>=100});if(0===e.length)return Q.reject("Aborting play of burst voice sound effect: no avatars have their burst gauge full");if(!t.createInstance("playerGameConfig").isSeOn())return Q.reject("Aborting play of burst voice sound effect: sound is disabled in the player game config");var n=t.IDList.VOICES.BURST_FULL,a=i.shuffle(e)[0],o=this._cache[a.isJob?"job":"character"][a.id];return o?Q.resolve(o):(o=t.generateAvatarSoundPaths(a.id,a.isJob,n.LOWER,n.UPPER).shift(),this._cache[a.isJob?"job":"character"][a.id]=o,t.loader.load([o]).thenResolve(o))}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=(e.ccui,e._);e.console,t.RaidScenario=n.Class.extend({className:"RaidScenario",ctor:function(e,t){this._commandList=this._filterOutCorruptData(e),this._isOwnScenario=t,this._progress=Q.defer()},isOwnScenario:function(){return this._isOwnScenario},getCommandList:function(){return this._commandList},getCommandAmount:function(){return this._commandList.length},trimCommandList:function(e){this._commandList=i.take(this._commandList,e)},getPromise:function(){return this._progress.promise},resolveAsFinished:function(){this._progress.resolve()},rejectAsDiscarded:function(){this._progress.reject("RaidScenario: scenario discarded")},_filterOutCorruptData:function(e){return i.reject(e,function(e){return!!i.isEmpty(e)||i.isEmpty(e.cmd)})}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=(e.ccui,e._),a=e.console;t.RaidScenarioQueue=n.Class.extend({className:"RaidScenarioQueue",ctor:function(e){this._otherPlayerCommandLimit=e,this._priorityLane=[],this._queue=[]},push:function(e){this._queue.push(e),this._trimOtherPlayerCommands()},pushToPriorityLane:function(e){this._priorityLane.push(e)},pullFirst:function(){return this._priorityLane.length>0?this._priorityLane.shift():this._isFloodGateClosed?null:this._queue.shift()},closeFloodGate:function(){this._isFloodGateClosed=!0},openFloodGate:function(){this._isFloodGateClosed=!1},getLast:function(){return i.last(this._priorityLane.concat(this._queue))},moveAllToPriorityLane:function(){this._priorityLane=this._priorityLane.concat(this._queue),this._queue=[]},clearAll:function(){this.moveAllToPriorityLane(),i.each(this._priorityLane,function(e){e.rejectAsDiscarded()}),this._priorityLane=[]},_trimOtherPlayerCommands:function(){var e=this._getOtherPlayerCommandCountInPriorityLane();this._queue=i.reduceRight(this._queue,function(t,n){if(n.isOwnScenario())return t.unshift(n),t;var i=n.getCommandAmount();if((e+=i)<=this._otherPlayerCommandLimit)return t.unshift(n),t;var o=e-this._otherPlayerCommandLimit;return e=Math.min(e,this._otherPlayerCommandLimit),o>=i?(a.log("all commands have been rejected"),n.trimCommandList(0),t.unshift(n),t):(n.trimCommandList(i-o),t.unshift(n),t)}.bind(this),[])},_getOtherPlayerCommandCountInPriorityLane:function(){return i.reduce(this._priorityLane,function(e,t){return t.isOwnScenario()?e:e+t.getCommandAmount()},0)}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=(e.ccui,e._);e.console,t.RaidScenarioFactory=n.Class.extend({className:"RaidScenarioFactory",create:function(e,n,i){var a;return a="default"===i?this._filterCommandsForDefaultChannel(e):this._filterCommandsByChannel(e,i),t.createInstance("RaidScenario",[a,n])},_filterCommandsByChannel:function(e,n){var a=t.raid_scenario.CHANNEL_REGISTRY[n];return i.filter(e,function(e){return null!=e&&-1!==a.indexOf(e.cmd)})},_filterCommandsForDefaultChannel:function(e){var t=this._getDefaultChannelCommandsToIgnore();return i.filter(e,function(e){return null!=e&&-1===t.indexOf(e.cmd)})},_getDefaultChannelCommandsToIgnore:function(){return this._defaultChannelCommandsToIgnore?this._defaultChannelCommandsToIgnore:(this._defaultChannelCommandsToIgnore=i.reduce(t.raid_scenario.CHANNEL_REGISTRY,function(e,t){return e.concat(t)},[]),this._defaultChannelCommandsToIgnore)}})}((this||0).self||global),function(e){var t=e.cc,n=e.kh,i=e._;n.RaidMessageHandler=t.Class.extend({className:"KHRaidMessageHandler",postMessages:function(e){i.each(e,function(e){this["_post"+i.capitalize(e.type)](e.message)},this)},_postLog:function(e){n.createInstance("battleUI").raidMessageWindow.postMessage({job_id:e.job_id,job_skin:e.job_skin},e.line_1_action||"",e.line_2_action||"",e.line_3_damage_result||"",e.line_4_effect_result||"",e.play_sound)},_postStamp:function(e){n.createInstance("notificationCenter").dispatchEvent(n.EVENT_NAME.POST_STAMP,[e.stamp_id,e.from_player_info.name])}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e.res,a=e._;e.Backbone,t.Summon=n.Class.extend({className:"KHSummon",CUTIN_EFFECT_POSITION:n.p(0,0),FADE_SPEED:.3,model:null,ctor:function(){this.model=t.createInstance("Model"),this.model.on("change",this._changeAttr,this)},init:function(e,n){this._eventPrefix=t.EVENT_PREFIX.SUMMON[n],this._setAttr(e)},play:function(){var e=Q.defer(),n=t.createInstance("battleWorld"),i=this.FADE_SPEED,o=this._initCutinVisualEffect();return t.createInstance("Sound2Event",[o]),o.setAnimationEndCallback(function(){o.cleanUp(),e.resolve(),null!=this.model.attributes.attack_info&&t.createInstance("namePlateAnimation").play(this.model.attributes.attack_info.name)},this),o.play(n.CutinLayer,this.CUTIN_EFFECT_POSITION),a(n.characterList).filter(function(e){return!(null==e||a.isEmpty(e))}).invoke("fadeOut",i),e.promise},_initCutinVisualEffect:function(){return t.createInstance("WindowVisualEffect").init(i.battle_summon_effect_animation)},_changeAttr:function(e){var i=e.changedAttributes();n.eventManager.dispatchCustomEvent(this._eventPrefix+t.Summon.EVENT_NAME.CHANGE_ATTR,i)},_setAttr:function(e){return this.model.set(e)}}),t.Summon.EVENT_NAME={CHANGE_ATTR:"CHANGE_ATTR"}}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;t.StatusEffect=n.Class.extend({className:"KHStatusEffect",ctor:function(){this._characters={},this._enemies={}},init:function(e){if(this._id=e.id,this._description=e.description,this._type=e.type,this._isUnique=e.is_unique,this._enemySortGroupNumber=e.enemy_sort_group_number,this._memberSortGroupNumber=e.member_sort_group_number,null==e.affected_avatars)return this;var n=t.createInstance("battleWorld");return this._targetCharacters=i.map(e.affected_avatars.players||[],function(e){var t=n.characterList[e.pos];if(null!=t&&!i.isEmpty(t))return t},this),this._targetEnemies=i.map(e.affected_avatars.enemies||[],function(e){var t=n.enemyList[e.pos];if(null!=t&&!i.isEmpty(t))return t},this),this._affectedCharacters=i.filter(this._targetCharacters,function(t,n){return e.affected_avatars.players[n].applied||null==e.affected_avatars.players[n].applied},this),this._affectedEnemies=i.filter(this._targetEnemies,function(t,n){return e.affected_avatars.enemies[n].applied||null==e.affected_avatars.enemies[n].applied},this),this},getId:function(){return this._id},getDescription:function(){return this._description},getType:function(){return this._type},getTargetAvatars:function(){return this._targetCharacters.concat(this._targetEnemies)},getAffectedAvatars:function(){return this._affectedCharacters.concat(this._affectedEnemies)},removeStatusFromCharacter:function(e){t.createInstance("battleWorld").characterList[e].statusPanel.removeStatusEffect(this)},removeStatusFromEnemy:function(e){t.createInstance("battleWorld").enemyList[e].statusPanel.removeStatusEffect(this)},applyStatusEffectToAvatars:function(){i(this.getAffectedAvatars()).filter(function(e){return null!=e}).pluck("statusPanel").invoke("pushStatusEffect",this)},drawStatusOnCharacter:function(n){var a=t.createInstance("battleWorld").characterList[n];return null==a||i.isEmpty(a)?void e.console.warn("KHStatusEffect.drawStatusOnCharacter: character not found"):void a.statusPanel.updateStatusEffect(this,this._characters[n]||[])},drawStatusOnEnemy:function(n){var a=t.createInstance("battleWorld").enemyList[n];return null==a||i.isEmpty(a)?void e.console.warn("KHStatusEffect.drawStatusOnEnemy: enemy not found"):void a.statusPanel.updateStatusEffect(this,this._enemies[n]||[])},updateCharacter:function(e,t){this._characters[e]=this._characters[e]||[],this._characters[e].push(this._createStatusEffectExpire(t))},updateEnemy:function(e,t){this._enemies[e]=this._enemies[e]||[],this._enemies[e].push(this._createStatusEffectExpire(t))},_createStatusEffectExpire:function(e){var t={};return null!=e.turn&&(t.turn=e.turn),null!=e.seconds&&(t.seconds=e.seconds,t.seconds.get=this._getRemainingSeconds.bind(this,t.seconds)),null!=e.level&&(t.level=e.level,t.getLevel=this._getRemainingLevel.bind(this,t.seconds,t.level)),t.description=e.description,t},getCooldownInfoCharacter:function(e){return this._characters[e]||[]},getCooldownInfoEnemy:function(e){return this._enemies[e]||[]},isUnique:function(){return this._isUnique},_getRemainingSeconds:function(e){var t=Math.round(Date.now()/1e3-e.timestamp),n=i.filter(e.remaining,function(e){return e.remain>t});if(0===n.length)return 0;var a=i.map(n,function(e){return e.remain});return Math.min.apply(null,a)-t||0},_getRemainingLevel:function(e,t){if(!e)return t;for(var n=Math.round(Date.now()/1e3-e.timestamp),a=i.filter(e.remaining,function(e){return e.remain>n}),o=0,r=0,s=a.length;r<s;++r)o+=a[r].level;return o},removeExpiredEffectsCharacter:function(e){this._removeExpiredEffects(this._characters,e),this.drawStatusOnCharacter(e)},removeExpiredEffectsEnemy:function(e){this._removeExpiredEffects(this._enemies,e),this.drawStatusOnEnemy(e)},_removeExpiredEffects:function(e,t){i.eachRight(e[t],function(n,i){null!=n.seconds&&n.seconds.get()<=0&&e[t].splice(i,1)},this)},unregisterCharacter:function(e){this._characters[e]=[]},unregisterEnemy:function(e){this._enemies[e]=[]},getEnemyIconGroupNumber:function(){return this._enemySortGroupNumber},getMemberIconGroupNumber:function(){return this._memberSortGroupNumber}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.console;t.Notifiable=n.Class.extend({className:"KHNotifiable",ctor:function(e){this._eventNameAssoc=e},triggerWhenChanged:function(e,t,n){var a,o,r;i.isUndefined(t)||i.isNull(t)||0===t.length?this._triggerAllRecordAdded(e,n):i.isUndefined(n)||i.isNull(n)||0===n.length?this._triggerAllRecordRemoved(e,t):(t.length<n.length?(a=n,o=t,r="_triggerRecordAdded"):(a=t,o=n,r="_triggerRecordRemoved"),i.each(a,function(a,s){return i(o[s]).isUndefined()?this[r](e,s,a):i(a).isUndefined()?this._triggerRecordRemoved(e,s,t[s]):i(a).isEqual(o[s])?void 0:this._triggerRecordChanged(e,s,n[s],t[s])}.bind(this)))},_triggerAllRecordAdded:function(e,t){i.each(t,function(t,n){this._triggerRecordAdded(e,n,t)}.bind(this))},_triggerAllRecordChanged:function(e,t){i.each(t,function(t,n){this._triggerRecordChanged(e,n,t)}.bind(this))},_triggerAllRecordRemoved:function(e,t){i.each(t,function(t,n){this._triggerRecordRemoved(e,n,t)}.bind(this))},_triggerRecordAdded:function(e,t,n){var i=this._eventName(e,"added");this._trigger(i,t,n)},_triggerRecordChanged:function(e,t,n,i){var a=this._eventName(e,"changed");this._trigger(a,t,n,i)},_triggerRecordRemoved:function(e,t,n,i){var a=this._eventName(e,"removed");this._trigger(a,t,n,i)},_trigger:function(e,n,i,a){t.createInstance("notificationCenter").dispatchEvent(e,[{idx:n,data:i,previousData:a}])},_eventName:function(e,t){var n=(e+"_"+t).toUpperCase();return this._eventNameAssoc[n]}}),t.BattleStatus=n.Class.extend({className:"KHBattleStatus",_partyMembers:null,_cureItems:null,ctor:function(){this._partyMembers=[],this._cureItems=[],this._eventNotifier=new t.Notifiable(t.BattleStatus.eventName),this._updateTimes={}},update:function(e){var t=e.timestamp;delete e.timestamp,i.each(e,function(e,n){var o=this["_update"+i.capitalize(i.camelize(n))];return i.isFunction(o)?void o.call(this,e,t):void a.warn("update function not found: "+n)}.bind(this))},CACHE_INDEX:{PARTY_MEMBERS:"_partyMembers",ENEMIES:"_enemies",CURE_ITEMS:"_cureItems",ABILITY_TURNS:"_abilityTurns",ABILITY_BANS:"_abilityBans",ABILITY_NOT_SATISFIED:"_abilityNotSatisfied",BURST_BANS:"_burstBans",SUMMON_TURNS:"_summonTurns",TREASURE:"_treasure"},clearCache:function(){this._partyMembers=null,this._enemies=null,this._cureItems=null,this._abilityTurns=null,this._abilityBans=null,this._abilityNotSatisfied=null,this._burstBans=null,this._summonTurns=null,this._treasure=null,this._updateTimes={}},clearCacheByName:function(e){this[e]=null},forceNextUpdate:function(e){i.each(this[e]||[],function(e,t,n){n[t]="update required"})},_updatePartyMembers:function(e,t){this._checkUpdateTime("partyMembers",t)&&(this._eventNotifier.triggerWhenChanged("party_member",this._partyMembers,e),this._partyMembers=e)},_updateEnemies:function(e,t){this._checkUpdateTime("enemies",t)&&(this._eventNotifier.triggerWhenChanged("enemy",this._enemies,e),this._enemies=e)},_updateCureItems:function(e,t){this._checkUpdateTime("cureItems",t)&&(this._eventNotifier.triggerWhenChanged("cure_item",this._cureItems,e),this._cureItems=e)},_updateAbilityTurns:function(e,t){this._checkUpdateTime("abilityTurns",t)&&(this._eventNotifier.triggerWhenChanged("ability_turns",this._abilityTurns,e),this._abilityTurns=e)},_updateAbilityBans:function(e,t){this._checkUpdateTime("abilityBans",t)&&(this._eventNotifier.triggerWhenChanged("ability_bans",this._abilityBans,e),this._abilityBans=e)},_updateAbilityNotSatisfied:function(e,t){this._checkUpdateTime("abilityNotSatisfied",t)&&(this._eventNotifier.triggerWhenChanged("ability_not_satisfied",this._abilityNotSatisfied,e),this._abilityNotSatisfied=e)},_updateBurstBans:function(e,t){this._checkUpdateTime("burstBans",t)&&(this._eventNotifier.triggerWhenChanged("burst_bans",this._burstBans,[e]),this._burstBans=[e])},_updateSummonTurns:function(e,t){this._checkUpdateTime("summonTurns",t)&&(this._eventNotifier.triggerWhenChanged("summon_turns",this._summonTurns,e),this._summonTurns=e)},_checkUpdateTime:function(e,t){return null==t||!(null!=this._updateTimes[e]&&this._updateTimes[e]>t)&&(this._updateTimes[e]=t,!0)}}),t.BattleStatus.eventName={PARTY_MEMBER_CHANGED:"BATTLE_STATUS_PARTY_MEMBER_CHANGED",PARTY_MEMBER_REMOVED:"BATTLE_STATUS_PARTY_MEMBER_REMOVED",PARTY_MEMBER_ADDED:"BATTLE_STATUS_PARTY_MEMBER_ADDED",ENEMY_CHANGED:"BATTLE_STATUS_ENEMY_CHANGED",ENEMY_REMOVED:"BATTLE_STATUS_ENEMY_REMOVED",ENEMY_ADDED:"BATTLE_STATUS_ENEMY_ADDED",CURE_ITEM_CHANGED:"BATTLE_STATUS_CURE_ITEM_CHANGED",CURE_ITEM_REMOVED:"BATTLE_STATUS_CURE_ITEM_REMOVED",CURE_ITEM_ADDED:"BATTLE_STATUS_CURE_ITEM_ADDED",ABILITY_TURNS_CHANGED:"BATTLE_STATUS_ABILITY_TURNS_CHANGED",ABILITY_TURNS_REMOVED:"BATTLE_STATUS_ABILITY_TURNS_REMOVED",ABILITY_TURNS_ADDED:"BATTLE_STATUS_ABILITY_TURNS_ADDED",ABILITY_BANS_CHANGED:"BATTLE_STATUS_ABILITY_BANS_CHANGED",ABILITY_BANS_REMOVED:"BATTLE_STATUS_ABILITY_BANS_REMOVED",ABILITY_BANS_ADDED:"BATTLE_STATUS_ABILITY_BANS_ADDED",ABILITY_NOT_SATISFIED_CHANGED:"BATTLE_STATUS_ABILITY_NOT_SATISFIED_CHANGED",ABILITY_NOT_SATISFIED_REMOVED:"BATTLE_STATUS_ABILITY_NOT_SATISFIED_REMOVED",ABILITY_NOT_SATISFIED_ADDED:"BATTLE_STATUS_ABILITY_NOT_SATISFIED_ADDED",BURST_BANS_CHANGED:"BATTLE_STATUS_BURST_BANS_CHANGED",BURST_BANS_REMOVED:"BATTLE_STATUS_BURST_BANS_REMOVED",BURST_BANS_ADDED:"BATTLE_STATUS_BURST_BANS_ADDED",SUMMON_TURNS_CHANGED:"BATTLE_STATUS_SUMMON_TURNS_CHANGED",SUMMON_TURNS_REMOVED:"BATTLE_STATUS_SUMMON_TURNS_REMOVED",SUMMON_TURNS_ADDED:"BATTLE_STATUS_SUMMON_TURNS_ADDED"}}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;t.NodeQuake=n.Class.extend({className:"NodeQuake",_moveDuration:.1,_movePosX:0,_movePosY:2,_quakeEndInfoList:[],_targets:null,ctor:function(e){this.updateTargets(e)},updateTargets:function(e){e&&(this._targets=e)},quakeStart:function(){this._quakeEndInfoList=[];var e=n.moveBy(this._moveDuration,n.p(-this._movePosX,-this._movePosY)),a=n.moveBy(this._moveDuration,n.p(this._movePosX,this._movePosY)),o=n.sequence(e,a),r=n.repeatForever(o);if(i.each(this._targets,function(e){var t=r.clone();t=e.runAction(t),this._quakeEndInfoList.push({action:t,initPos:e.getPosition()})},this),!this._logSended){var s=t.createInstance("smartBeat"),c=t.createInstance("battleWorld"),u=c.characterList.concat(c.enemyList),l=t.createInstance("questInfo");s.log("quest_type:"+l.getQuestType()+" / a_battle_id:"+l.getBattleId()),s.log(i.map(u,function(e){return e._avatarData}));var _=new Error("Unexpected call kh.NodeQuake.Quakestart");s.sendError(_),this._logSended=!0}},quakeEnd:function(){i.each(this._quakeEndInfoList,function(e){var t=e.action,a=e.initPos,o=i.find(this._targets,function(e){return e===t.getTarget()});if(void 0!==o){o.stopAction(t);var r=n.moveTo(0,n.p(a.x,a.y));o.runAction(r)}}.bind(this)),this._quakeEndInfoList=null}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.TreasureDropper=n.Class.extend({className:"KHTreasureDropper",CLASS_BY_TREASURE_TYPE:{coin:"TreasureDropCoin",item:"TreasureDropItem",normal:"TreasureDropNormal",silver:"TreasureDropSilver",gold:"TreasureDropGold",rainbow:"TreasureDropRainbow"},init:function(e,n){return this._index=n,t.createInstance("treasureStatus").registerTreasureDropper(this,n),this._treasureHolder=this._createTreasureHolderNode(e,n),this._animations={},this},dropTreasure:function(e){return this._calculateHolderSize(e.length),_.map(e,function(e){var n=t.createInstance(this.CLASS_BY_TREASURE_TYPE[e.type]).init(e.item_physical_name);return this._animations[e.type]=this._animations[e.type]||[],this._animations[e.type].push(n),n.playDropAnimation.bind(n,this._treasureHolder)},this).reduce(Q.when,Q())},cleanUp:function(){this.clearAll(),this._treasureHolder&&this._treasureHolder.removeFromParent(),this._treasureHolder=null,this._animations=null},showTreasure:function(e){this._calculateHolderSize(e.length),_.each(e,function(e){var n=t.createInstance(this.CLASS_BY_TREASURE_TYPE[e.type]).init(e.id);this._animations[e.type]=this._animations[e.type]||[],this._animations[e.type].push(n),n.showTreasure(this._treasureHolder)},this)},redraw:function(){this._treasureHolder.removeFromParent(),t.createInstance("battleWorld").EnemyLayer.addChild(this._treasureHolder,this._index)},removeTreasure:function(e){this._animations[e].shift().unDraw()},removeItem:function(e){var t=_.find(this._animations.item,{id:e});_.remove(this._animations.item,t),t.unDraw()},clearAll:function(){_.each(this._animations,function(e){_.invoke(e,"unDraw")}),this._animations={}},getTreasureCount:function(e){return null==this._animations[e]?0:this._animations[e].length},getItemCount:function(e){return null==this._animations.item?0:_.filter(this._animations.item,{id:e}).length},getItemIdList:function(){return _(this._animations.item).pluck("id").uniq().value()},getTotalTreasureCount:function(){return _.reduce(this._animations,function(e,t){return e+t.length},0)},_createTreasureHolderNode:function(e,i){var a=new n.Node;return t.createInstance("battleWorld").EnemyLayer.addChild(a,i),a.setAnchorPoint(n.p(.5,.5)),a.setPosition(e),a},_calculateHolderSize:function(e){var t=90+9*(e+=this.getTotalTreasureCount()),i=40+4*e;this._treasureHolder.setContentSize(n.size(t,i))}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e.khutil;t.TreasureDropAbstract=n.Class.extend({className:"KHTreasureDropAbstract",init:function(e){return this.itemName=e,this},playDropAnimation:function(e){return this._playDropAnimation(e,this._playAnimation.bind(this)),i.getPromiseToDelayAnimation(100)},showTreasure:function(e){this._playDropAnimation(e,this._showTreasure.bind(this))},unDraw:function(){null!=this._treasureAnimation&&(this._treasureAnimation.cleanUp(),this._decreaseUiTreasureCount())},_playDropAnimation:function(e,i){var a=t.createInstance("PositionGenerator").generateRandomPositionInRect(n.rect(0,0,e.width,e.height)),o=1+Math.random()/2,r=-a.y,s=this._createAnimationObject();s.setScale(n.p(o,o)),t.createInstance("Sound2Event",[s]),this._increaseUiTreasureCount(),i(s,e,a,r),this._treasureAnimation=s},_createAnimationObject:function(){return e.console.error("TreasureDropAbstract._createAnimationObject needs to be overridden"),t.createInstance("WindowVisualEffect")},_playAnimation:function(t,n,i,a){e.console.error("TreasureDropAbstract._playAnimation needs to be overridden")},_showTreasure:function(e,t,n,i){e.showLastFrame(t,n,i)},_increaseUiTreasureCount:function(){},_decreaseUiTreasureCount:function(){}})}((this||0).self||global),function(e){var t=e.kh,n=e.res;t.TreasureDropNormal=t.TreasureDropAbstract.extend({className:"KHTreasureDropNormal",_createAnimationObject:function(){return t.createInstance("WindowVisualEffect").init(n.battle_treasure_normal)},_playAnimation:function(e,t,n,i){e.playByName("animation0",t,n,i)},_showTreasure:function(e,t,n,i){e.showAnimationLastFrame("animation0",t,n,i)},_increaseUiTreasureCount:function(){t.createInstance("battleWorld").battleUI.BattleUIHeader.incrementPrizeCount(t.BATTLE_UI_HEADER_PRIZES.BRONZE)},_decreaseUiTreasureCount:function(){t.createInstance("battleWorld").battleUI.BattleUIHeader.decrementPrizeCount(t.BATTLE_UI_HEADER_PRIZES.BRONZE)}})}((this||0).self||global),function(e){var t=e.kh,n=e.res;t.TreasureDropSilver=t.TreasureDropAbstract.extend({className:"KHTreasureDropSilver",_createAnimationObject:function(){return t.createInstance("WindowVisualEffect").init(n.battle_treasure_silver)},_playAnimation:function(e,t,n,i){e.play(t,n,i)},_showTreasure:function(e,t,n,i){e.showLastFrame(t,n,i)},_increaseUiTreasureCount:function(){t.createInstance("battleWorld").battleUI.BattleUIHeader.incrementPrizeCount(t.BATTLE_UI_HEADER_PRIZES.SILVER)},_decreaseUiTreasureCount:function(){t.createInstance("battleWorld").battleUI.BattleUIHeader.decrementPrizeCount(t.BATTLE_UI_HEADER_PRIZES.SILVER)}})}((this||0).self||global),function(e){var t=e.kh,n=e.res;t.TreasureDropGold=t.TreasureDropAbstract.extend({className:"KHTreasureDropGold",_createAnimationObject:function(){return t.createInstance("WindowVisualEffect").init(n.battle_treasure_gold)},_playAnimation:function(e,t,n,i){e.play(t,n,i)},_showTreasure:function(e,t,n,i){e.showLastFrame(t,n,i)},_increaseUiTreasureCount:function(){t.createInstance("battleWorld").battleUI.BattleUIHeader.incrementPrizeCount(t.BATTLE_UI_HEADER_PRIZES.GOLD)},_decreaseUiTreasureCount:function(){t.createInstance("battleWorld").battleUI.BattleUIHeader.decrementPrizeCount(t.BATTLE_UI_HEADER_PRIZES.GOLD)}})}((this||0).self||global),function(e){var t=e.kh,n=e.res;t.TreasureDropRainbow=t.TreasureDropAbstract.extend({className:"KHTreasureDropRainbow",_createAnimationObject:function(){return t.createInstance("WindowVisualEffect").init(n.battle_treasure_rainbow)},_playAnimation:function(e,t,n,i){e.play(t,n,i)},_showTreasure:function(e,t,n,i){e.showLastFrame(t,n,i)}})}((this||0).self||global),function(e){var t=e.kh,n=e.res;t.TreasureDropItem=t.TreasureDropAbstract.extend({className:"KHTreasureDropItem",TEXTURE_NAME_BY_NAME:{cure_bottle:"battle/res/battle_ani/treasure_get/item_p_s.png",cure_medic:"battle/res/battle_ani/treasure_get/item_p_b.png",summon_turn_charge:"battle/res/battle_ani/treasure_get/item_t.png"},playDropAnimation:function(e){return this._setTexture(),t.TreasureDropAbstract.prototype.playDropAnimation.call(this,e)},showTreasure:function(e){this._setTexture(),t.TreasureDropAbstract.prototype.showTreasure.call(this,e)},_setTexture:function(){return null==this.itemName?void(this._texture=""):void(this._texture=this.TEXTURE_NAME_BY_NAME[this.itemName])},_createAnimationObject:function(){var e=t.createInstance("WindowVisualEffect").init(n.battle_treasure_item);return null!=this._texture&&e.changeTexture("item_img",this._texture,ccui.Widget.PLIST_TEXTURE),e},_playAnimation:function(e,t,n,i){e.play(t,n,i)},_showTreasure:function(e,t,n,i){e.showLastFrame(t,n,i)}})}((this||0).self||global),function(e){var t=e.kh,n=e.res;t.TreasureDropCoin=t.TreasureDropAbstract.extend({className:"KHTreasureDropCoin",_createAnimationObject:function(){return t.createInstance("WindowVisualEffect").init(n.battle_treasure_normal)},_playAnimation:function(e,t,n,i){e.playByName("animation1",t,n,i)},_showTreasure:function(e,t,n,i){e.showAnimationLastFrame("animation1",t,n,i)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.TreasureStatus=n.Class.extend({className:"KHTreasureStatus",TREASURE_TYPES:["item","coin","normal","silver","gold","rainbow"],ctor:function(){this._treasureDroppers={}},registerTreasureDropper:function(t,n){null!=this._treasureDroppers[n]&&e.console.warn("Enemy attempting to die and drop treasure a second time!"),this._treasureDroppers[n]=t},updateTreasureStatus:function(e,t){return null==t||0===t.length?void(null!=this._treasureDroppers[e]&&(this._treasureDroppers[e].cleanUp(),this._treasureDroppers[e]=null)):null==this._treasureDroppers[e]?(this._treasureDroppers[e]=this._createNewDropper(e),void this._treasureDroppers[e].showTreasure(t)):(this._discrepancies=[],_.each(this.TREASURE_TYPES,function(n){if("item"!==n){var i=_.filter(t,{type:n}).length-this._treasureDroppers[e].getTreasureCount(n);this._discrepancies=this._discrepancies.concat(_.map(_.range(i),function(){return{type:n}})),_.each(_.range(-i),function(){this._treasureDroppers[e].removeTreasure(n)},this)}else this._compareItemStatus(e,_.filter(t,{type:n}))},this),this._discrepancies.length>0&&this._treasureDroppers[e].showTreasure(this._discrepancies),void this._treasureDroppers[e].redraw())},clearCache:function(){_.invoke(this._treasureDroppers,"cleanUp"),this._treasureDroppers={}},_createNewDropper:function(e){var i=t.createInstance("battleWorld").enemyList.length,a=t.ENEMY_POSITION_LIST[i-1][e],o=n.p(a.x*n.winSize.width,a.y*n.winSize.height);return t.createInstance("TreasureDropper").init(o,e)},_compareItemStatus:function(e,t){var n={};_.each(t,function(e){n[e.id]=n[e.id]||0,n[e.id]++}),_.each(this._treasureDroppers[e].getItemIdList(),function(e){0===_.filter(t,{id:e}).length&&(n[e]=0)}),_.each(n,function(t,n){var i=parseInt(n),a=t-this._treasureDroppers[e].getItemCount(i);this._discrepancies=this._discrepancies.concat(_.map(_.range(a),function(){return{type:"item",id:i}})),_.each(_.range(-a),function(){this._treasureDroppers[e].removeItem(i)},this)},this)}})}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="InABattles",o={getStart:function(e){var t=this._createStartParam(e);return this._http.get(t)},postAttack:function(e,t,n){var i=this._createAttackParam(e,t,n);return this._http.post(i)},postAbilityJson:function(e,t,n,i){var a=this._createAbilityParam(e,t,n,i);return this._http.post(a)},postAttackSummonJson:function(e,t){var n=this._createAttackSummonParam(e,t);return this._http.post(n)},postUseItem:function(e,t,n){var i=this._createUseItemParam(e,t,n);return this._http.post(i)},getWebsocketDomain:function(){var e=this._createWebsocketDomainParam();return this._http.get(e)},getBattleLog:function(e){return this._http.get({url:this._urls.BATTLE_LOG,json:{quest_type:e}})},postHelpRequest:function(e,t,n,i){return this._http.post({url:this._urls.HELP_REQUEST,json:{to_all:e,to_friends:t,to_union_members:n,quest_type:i}})},getHelpRequestPossibility:function(e){return this._http.get({url:this._urls.HELP_REQUEST+"/possibility",json:{quest_type:e}})},getRanking:function(e){return this._http.get({url:this._urls.RANKING,json:{quest_type:e}})},getGainedItems:function(e){return this._http.get({url:this._urls.GAINED_ITEMS,json:{quest_type:e}})},giveup:function(e){return this._http.post({url:this._urls.GIVE_UP,json:{quest_type:e}})},postStamp:function(e,t){return this._http.post({url:this._urls.STAMP,json:{quest_type:e,stamp_id:t}})}};n.Api[a]=i.Class.extend(t.assign({className:"KHApiBattle",_http:null,_urls:{START:"/start",ATTACK:"/attack",SUMMON_ATTACK:"/summon_attack",ABILITY:"/ability",BATTLE_LOG:"/battle_log",HELP_REQUEST:"/help_request",RANKING:"/ranking",GAINED_ITEMS:"/gained_items",GIVE_UP:"/giveup",STAMP:"/stamp",WEBSOCKET_DOMAIN:"/websocket_domain"},ctor:function(){this._http=n.createInstance("HttpConnection");var e=i.director.getRunningScene();null==e.getBattleId&&console.throw("KHApiBattle: current scene has no getBattleId method");var t=e.getBattleId();this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+"/a_battles/"+t+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})},_createStartParam:function(e){return{url:this._urls.START,json:{quest_type:e}}},_createUseItemParam:function(e,t,n){var i={url:"/"+t+"/use"};return i.json=null!=n?{quest_type:e,chara_pos:n}:{quest_type:e},i},_createAttackParam:function(e,t,n){return{url:this._urls.ATTACK,json:{quest_type:e,burst_button_enabled:t,target:n}}},_createAttackSummonParam:function(e,t){return{url:this._urls.SUMMON_ATTACK,json:{quest_type:e,summon_pos:t}}},_createAbilityParam:function(e,t,n,i){return{url:this._urls.ABILITY,json:{quest_type:e,chara_pos:t,ability_pos:n,target:i}}},_createWebsocketDomainParam:function(){return{url:this._urls.WEBSOCKET_DOMAIN}}},o));var r=["TutorialApi"];if(n.env.useApiMock&&r.push("MockApi"),t.each(r,function(e){n[e]=n[e]||{};var r={};t.each(o,function(t,i){r[i]=function(){if(!n[e])throw"kh."+e+"is not defined";if(!n[e][a][i+"JSON"])throw"not implemented: kh."+e+"."+a+"."+i;var t=Q.defer();return t.resolve({body:n[e][a][i+"JSON"].apply(this,arguments)}),t.promise}}),n[e][a]=i.Class.extend(t.assign({},r))}),"undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,n){n+="JSON";var i="tutorialMock";t.each(["mock",i],function(e){var t="./"+e+"/"+n+".js";if(s.existsSync(t))console.log("skip: file exists: "+t);else{console.log("generate: "+t);var o=c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,n);e===i&&(o=o.replace(/MockApi/g,"TutorialApi")),s.writeFileSync(t,o)}})}),process.exit()}}((this||0).self||global),function(e){var t=e.kh;t.Pubsub=t.Pubsub||{},t.Pubsub.RECONNECTION_ATTEMPT_COUNT=10,t.Pubsub.TRANSPORTS=["websocket"]}((this||0).self||global),function(e){var t=e.kh,n=e.io;t.Pubsub=t.Pubsub||{},t.Api.PubsubBattle=cc.Class.extend({className:"KHApiPubsubBattle",_aBattleId:null,_type:null,_aPlayerId:null,_joined:!1,_socket:null,ctor:function(){this._registeredEvents=[]},connect:function(e){if(this._socket){if(this._socket.connected&&!this._socket.disconnect)return;this._socket.connect()}else this._socket=n.connect(e+"/battle",{reconnectionAttempts:t.Pubsub.RECONNECTION_ATTEMPT_COUNT,transports:t.Pubsub.TRANSPORTS,forceNew:!0});var i=this._socket;i.on("error",this._connectErrorCallback),i.on("connect_error",this._connectErrorCallback),i.on("connect_timeout",this._connectErrorCallback),i.on("reconnect_error",this._connectErrorCallback),i.on("reconnect_failed",this._connectErrorCallback),i.on("disconnect",function(e){"io server disconnect"===e&&i.connect(),console.warn("disconnect",e)})},_connectErrorCallback:function(e){var n=cc.director.getRunningScene();n&&n.isRaid()&&!n.disposed&&("object"==typeof e&&e.stack&&t.createInstance("smartBeat").sendError(e),n.scheduleOnce(function(e){!e.disposed&&this._socket&&this._socket.connect()}.bind(this,n),2))},join:function(e,t,n){this._joined||(this._aBattleId=e,this._type=t,this._joined=!0,this._aPlayerId=n,this._socket.emit("join",this._type+this._aBattleId),this._socket.emit("join",this._type+this._aBattleId+"_"+n))},addEventListener:function(e,n){if(this._socket){this._registeredEvents.push(e),this._socket.on(e,function(i){t.createInstance("logger").reportPubsubEvent(e,i),n(i)})}},removeAllEventListeners:function(){this._socket&&(_.each(this._registeredEvents,function(e){this._socket.off(e)},this),this._registeredEvents=[])},disconnect:function(){this._socket&&(this.removeAllEventListeners(),this._socket.disconnect(),this._socket=null,this._joined=!1,this._aBattleId=null,this._type=null)},_onDispose:function(){this.disconnect()}})}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="AStamps",o={get:function(){return this._http.get({url:"/a_stamps"})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiAStamps",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},o)),n.env.useApiMock){n.MockApi=n.MockApi||{};var r={};t.each(o,function(e,t){r[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi."+a+"."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},r))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e.kh;t.createNameSpaceIfNotExists("restore_item_vending_process"),t.restore_item_vending_process.BattleBuyButtonController=t.restore_item_vending_process.BuyButtonController.extend({className:"RestoreItemBattleBuyButtonController",BUTTON_NAMES:{PSEUDO_CURRENCY_BUY:"a_q_001_continue_1_go_shop",PSEUDO_CURRENCY_EXCHANGE:"a_q_001_continue_1_coin_change",STONE_EXCHANGE:"a_q_001_continue_1_stone_change"}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i={noSound:0,bgm:1,se:2};i.sound=i.bgm|i.se,t.PlayerGameConfigDISettings=n.Class.extend({FLAGS:i,DI_DEPENDENCY_LISTS:{noSound:{singleton:{},proto:{BattleUrlParserByConfig:t.BattleUrlParserBase,BattleCommandEventLogic:t.BattleCommand.EventLogicNoSound,BattleUIInitializer:t.Initializer.BattleUIInitializerNoSound}},bgm:{singleton:{},proto:{BattleUrlParserByConfig:t.BattleUrlParserBgm,BattleCommandEventLogic:t.BattleCommand.EventLogicNoSound,BattleUIInitializer:t.Initializer.BattleUIInitializerNoSound}},se:{singleton:{},proto:{BattleUrlParserByConfig:t.BattleUrlParserSe,BattleCommandEventLogic:t.BattleCommand.EventLogic,BattleUIInitializer:t.Initializer.BattleUIInitializer}},sound:{singleton:{},proto:{BattleUrlParserByConfig:t.BattleUrlParserSound,BattleCommandEventLogic:t.BattleCommand.EventLogic,BattleUIInitializer:t.Initializer.BattleUIInitializer}}},updateDIDependencyLists:function(e){var n=this._getConfig(e),i=this.DI_DEPENDENCY_LISTS[_.invert(this.FLAGS)[n]];t.dictx.injectDependent(i.singleton,i.proto)},_getConfig:function(e){var t=this.FLAGS.noSound|this.FLAGS.bgm;return e.isSeOn()&&(t|=this.FLAGS.se),t}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.RaidDIConfig=n.Class.extend({inject:function(e){this._hasInjectedRaidSettings&&!e||(t.dictx.injectDependent(this.raidBattleSingletonDependencyList,this.raidBattleProtoStrategyDependencyList),this._hasInjectedRaidSettings=!0)},raidBattleSingletonDependencyList:{battleWorld:t.RaidBattleWorld,battleUI:t.RaidBattleUI,raidInfo:t.RaidInfo,continuePopupFactory:t.RaidContinuePopupFactory,continuePopupElixir:t.RaidContinuePopupElixir,continuePopupLimitedElixir:t.RaidContinuePopupLimitedElixir,backCheckPopupFactory:t.BackCheckPopupFactory,raidMenuPopupFactory:t.RaidMenuPopupFactory,raidDownPopupFactory:t.RaidDownPopupFactory,rescueConfirmPopupFactory:t.RescueConfirmPopupFactory,raidLogPopupFactory:t.RaidLogPopupFactory,scenarioPlayer:t.RaidScenarioPlayer,raidRankingPopupFactory:t.RaidRankingPopupFactory},raidBattleProtoStrategyDependencyList:{BattleUIHeader:t.RaidBattleUIHeader,Enemy:t.RaidEnemy,BattleCommandIncreaseParticipants:t.BattleCommand.IncreaseParticipants,BattleCommandAdjustEnemyHp:t.BattleCommand.AdjustEnemyHp,BattleCommandReceiveRaidPoints:t.BattleCommand.ReceiveRaidPoints,BattleCommandTimeup:t.BattleCommand.Timeup,BattleCommandSetEnemyModeGauge:t.RaidBattleCommand.SetEnemyModeGauge,BattleCommandChangeEnemyMode:t.RaidBattleCommand.ChangeEnemyMode,BattleCommandDie:t.RaidBattleCommand.Die,BattleCommandLose:t.RaidBattleCommand.Lose,BattleCommandRaidMessage:t.BattleCommand.RaidMessage,RunoutPopupFactory:t.RunoutPopupFactory,ReviveButton:t.ReviveButton,RaidMenuButton:t.RaidMenuButton,RaidHelpRequestButton:t.RaidHelpRequestButton,NextButton:t.RaidNextButton,StampButton:t.StampButton,ReloadButton:t.RaidReloadButton,RaidMessageHandler:t.RaidMessageHandler,RaidMessageWindow:t.RaidMessageWindow,ActionData:t.RaidActionData,RaidScenario:t.RaidScenario,RaidScenarioQueue:t.RaidScenarioQueue,RaidScenarioFactory:t.RaidScenarioFactory,RaidHelpRequestStatus:t.RaidHelpRequestStatus}})}((this||0).self||global),function(e){var t=e.kh;e.ccui,t.UnionRouter=t.UnionRouter||{},t.UnionRouter=cc.Class.extend({navigateToTopScene:function(e){if(null!=e&&""!==e){var n=this._getNavigateFrom(e);if("me"===e){var i={};t.createInstance("apiAUnions").getMe().then(function(e){i=e.body||{}}.bind(this)).fail(function(e){console.warn(e.stack)}).then(function(){t.createInstance("router").navigate(null!=i.a_union_id?"guild/gud_001":"guild/gud_000",{},n)})}else t.createInstance("router").navigate("guild/gud_001_b",{},n)}else console.warn("illegal argument: a_union_id")},_getNavigateFrom:function(e){var n=t.createInstance("routerParams").getCurrentScene(),i=n.tabDelegateList[0];return _.isEmpty(i)||_.isUndefined(i.selected)||(n.temporaryRouterParams.restoreParams={tabs:[i.selected]}),{id:e,routes:t.createInstance("router").getCurrentFragment(),temporaryRouterParams:n.temporaryRouterParams}}})}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="APanelMissions",o={get:function(){return this._http.get({url:"/a_panel_missions/current"})},getSummary:function(){return this._http.get({url:"/a_panel_missions/summary"})},postSummary:function(){return this._http.post({url:"/a_panel_missions/summary"})},receiveReward:function(e){return this._http.post({url:"/a_panel_missions/receive",json:{a_panel_mission_id:e}})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiAPanelMissions",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},o)),n.env.useApiMock){n.MockApi=n.MockApi||{};var r={};t.each(o,function(e,t){r[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi."+a+"."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},r))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="ASubTutorialPages",o={get:function(e){return this._http.get({url:"/a_sub_tutorial_pages/"+e})},visited:function(e){return this._http.put({url:"/a_sub_tutorial_pages/"+e,json:{visited:!0}})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiASubTutorialPages",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},o)),n.env.useApiMock){n.MockApi=n.MockApi||{};var r={};t.each(o,function(e,t){r[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi."+a+"."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},r))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="PackageItems",o={get:function(e){return this._http.get({url:"/package_items/"+e})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiPackageItems",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},o)),n.env.useApiMock){n.MockApi=n.MockApi||{};var r={};t.each(o,function(e,t){r[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi."+a+"."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},r))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.createNameSpaceIfNotExists("core.view"),n.core.view.ImplantedSubTutorialPopup=n.ImplantedPopup.extend({_initialized:!1,_initContents:function(e,t){if(this._components=e,this._initialized){this.seekWidgetByName("sub_tutorial_page").getChildByName("default").gotoFirstPage()}else{this.setButtonEvents({btn_popup_close:!0});var i=this.getNode().bfsWidgetByName("btn_popup_close");i.setSoundEnabled(!0),i.setSound(n.SoundList.BUTTON_TOUCHED_CANCEL),this._createPageView(this._createPageList(t)),this._initialized=!0}},_createPageList:function(e){return t.map(t.range(e),function(e){return this._createPage(n.Img("popupsub",this._components,t.padZero(e+1,4)).png)},this)},_createPage:function(e){var t=ccs.load(res["core-popup-sub_tutorial_page_ui"]).node;return t.seekWidgetByName("popupsub_img").loadTexture(e),t},_createPageView:function(e){var t=e.length,i=new n.PageView;i.initialize(e,function(e,n){this.getNode().getChildren().filter(function(e){return 0===e.getName().indexOf("current_base_")}).forEach(function(e){e.setVisible(e.getName()==="current_base_"+(t-1))});for(var i=this.seekWidgetByName("current_base_"+(t-1)),a=0;a<t;a++)i.seekWidgetByName("current_icon_"+a).setVisible(!1);i.seekWidgetByName("current_icon_"+(n-1)).setVisible(!0)},this),i.setDirection(ccui.ScrollView.DIR_HORIZONTAL);var a=this.seekWidgetByName("sub_tutorial_page");a.removeAllChildren(),a.addChild(i),this.seekWidgetByName("btn_next").setVisible(t>1),this.seekWidgetByName("btn_prev").setVisible(t>1);var o=[];o[n.PAGE_CONTROLLER_CONTROLS.NEXT_BUTTON]="btn_next",o[n.PAGE_CONTROLLER_CONTROLS.PREVIOUS_BUTTON]="btn_prev",(new n.PageController).init(this.getNode(),o,i),i.gotoFirstPage()},seekWidgetByName:function(e){return this.getNode().seekWidgetByName(e)}})}((this||0).self||global),function(e){var t=(e.cc,e._,e.kh);t.createNameSpaceIfNotExists("core.item"),t.core.item.ShPackageItemInfoPopup=t.core.item.ShItemInfoPopup.extend({CORECARD_IMAGE_2ND_KEY:"package",_initContents:function(e){this.setButtonEvents({btn_popup_close:!0});var t=this.getNode();this._setCorecard(t,e.package_id),this._setItemName(t,e.name),this._setItemDescription(t,e.description)}})}((this||0).self||global),function(e){var t=e.cc,n=e.kh;e._,n.beginner_mission=n.beginner_mission||{},n.beginner_mission.model=n.beginner_mission.model||{},n.beginner_mission.model.Reward=t.Class.extend({_data:null,ctor:function(e){this._data=e},getId:function(){return this._data.id},getType:function(){return this._data.kind},getName:function(){return this._data.game_item.name+"x"+this._data.amount},getRawData:function(){return this._data.game_item}})}((this||0).self||global),function(e){var t=(e.cc,e.kh);e._,t.beginner_mission=t.beginner_mission||{},t.beginner_mission.model=t.beginner_mission.model||{},t.beginner_mission.model.Mission=t.core.pager.model.PlainData.extend({className:"Mission",getId:function(){return this._rawData.a_panel_mission_id},getTitle:function(){return this._rawData.title},getDescription:function(){return this._rawData.description},canReceive:function(){return this._rawData.can_receive},isReceivedReward:function(){return this._rawData.is_received},getProgress:function(){return this._rawData.now_progress+"/"+this._rawData.max_progress},getRoutingPage:function(){return this._rawData.routing_page},getState:function(){return this._rawData.state},getUnlockCondition:function(){return this._rawData.unlock_condition},getReward:function(){return new t.beginner_mission.model.Reward(this._rawData.reward)},getRawData:function(){return this._rawData}})}((this||0).self||global),function(e){var t=(e.cc,e.kh),n=e._;t.beginner_mission=t.beginner_mission||{},t.beginner_mission.model=t.beginner_mission.model||{},t.beginner_mission.model.Missions=t.core.pager.model.PlainDataList.extend({ctor:function(e){this._cachedModels=n.map(e||{},function(e){return new t.beginner_mission.model.Mission(e)})},canReceive:function(){return n.filter(this._cachedModels,function(e){return e.canReceive()}).length>0},getProgress:function(){var e=n.filter(this._cachedModels,function(e){return e.isReceivedReward()});return Object.keys(e).length+"/"+this._cachedModels.length}})}((this||0).self||global),function(e){var t=e.cc,n=e.kh;e._,n.beginner_mission=n.beginner_mission||{},n.beginner_mission.model=n.beginner_mission.model||{},n.beginner_mission.model.Panel=t.Class.extend({_panelData:null,_reward:null,_missions:null,ctor:function(e){this._panelData=e.panel,this._reward=new n.beginner_mission.model.Reward(e.reward),this._missions=new n.beginner_mission.model.Missions(e.missions)},getTitle:function(){return this._panelData.title},getOrderNumber:function(){return this._panelData.image_path},getMissions:function(){return this._missions},getReward:function(){return this._reward},getProgress:function(){return this._missions.getProgress()}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e.ccui;t.createNameSpaceIfNotExists("beginner_mission.view"),t.beginner_mission.view.MissionBtnView=n.Class.extend({className:"BeginnerMissionBtnView",_parentNode:null,_receiveRewardCallback:null,_challengeMissionCallback:null,ctor:function(e,t,n){this._parentNode=e,this._receiveRewardCallback=t,this._challengeMissionCallback=n},show:function(e,t){return e?void this.showReceived():t?(this._showReceivedBtn(),void this._setReceiveRewardBtnCallback()):(this._showChallengeBtn(),void this._setChallengeBtnCallback())},showReceived:function(){this._parentNode.setAppearance("received")},_showReceivedBtn:function(){this._parentNode.setAppearance("btn_get")},_showChallengeBtn:function(){this._parentNode.setAppearance("btn_challenge")},_setReceiveRewardBtnCallback:function(){this._getReceiveRewardBtn().addTouchEventListener(function(e,t){t===i.Widget.TOUCH_ENDED&&this._receiveRewardCallback()}.bind(this))},_setChallengeBtnCallback:function(){this._getChallengeBtn().addTouchEventListener(function(e,t){t===i.Widget.TOUCH_ENDED&&this._challengeMissionCallback()}.bind(this))},_getReceiveRewardBtn:function(){return this._parentNode.seekWidgetByName("btn_get")},_getChallengeBtn:function(){return this._parentNode.seekWidgetByName("btn_challenge")}}),t.assignRoles(t.beginner_mission.view.MissionBtnView,[t.pc.roles.UIUtility])}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e._,e.Q,t.pc.roles=t.pc.roles||{},t.pc.roles.ShInfoPopupInvoker={_openShSummonInfoPopup:function(e){t.createInstance("apiSummons").get(e).then(function(e){var i=n.director.getRunningScene();t.ImplantedPopup.createOrGet(i,"sh_summon_info").open(e.body)}.bind(this))},_openShWeaponInfoPopup:function(e){t.createInstance("apiWeapons").get(e).then(function(e){var i=n.director.getRunningScene();t.ImplantedPopup.createOrGet(i,"sh_weapon_info").open(e.body)}.bind(this))},_openShAccessoryInfoPopup:function(e){t.createInstance("apiAccessories").get(e).then(function(e){var i=n.director.getRunningScene();t.ImplantedPopup.createOrGet(i,"acce_data","AcceDataPopup").open(e.body)}.bind(this))},_openShPackageItemInfoPopup:function(e){t.createInstance("apiPackageItems").get(e).then(function(e){var i=n.director.getRunningScene();t.ImplantedPopup.createOrGet(i,"sh_package_item_info").open(e.body)}.bind(this))},_openShItemInfoPopup:function(e){t.createInstance("apiItems").get(e).then(function(e){var i=n.director.getRunningScene();t.ImplantedPopup.createOrGet(i,"sh_item_info").open(e.body)}.bind(this))}}}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=e.ccui,a=e._,o=e.console;t.createNameSpaceIfNotExists("beginner_mission.view"),t.beginner_mission.view.RewardView=n.Class.extend({className:"BeginnerMissionRewardView",_parentNode:null,_coreCardUiNodeName:null,_reward:null,ctor:function(e,t,n){this._parentNode=e,this._coreCardUiNodeName=t,this._reward=n},show:function(){var e=this._reward.getRawData(),t=this._reward.getType(),n=function(){},i=this._setProperCoreCardElementRarity(this._parentNode,a.extend({kind:t},e),this._coreCardUiNodeName);switch(t){case"item":case"treasure":n=this._touchItemCoreCard.bind(this,e);break;case"weapon":n=this._touchWeaponCoreCard.bind(this,e);break;case"summon":n=this._touchSummonCoreCard.bind(this,e);break;case"accessory":case"acce":n=this._touchAcceCoreCard.bind(this,e);break;case"package":n=this._touchPackageCoreCard.bind(this,e);break;default:return void o.warn([" type:"+t,e])}this._setRewardCoreCardCallback(i,n)},_touchWeaponCoreCard:function(e){var i=n.director.getRunningScene();t.ImplantedPopup.createOrGet(i,"sh_weapon_info","ShWeaponInfoPopup").open(e)},_touchSummonCoreCard:function(e){var i=n.director.getRunningScene();t.ImplantedPopup.createOrGet(i,"sh_summon_info","ShSummonInfoPopup").open(e)},_touchAcceCoreCard:function(e){var i=n.director.getRunningScene();t.ImplantedPopup.createOrGet(i,"acce_data","AcceDataPopup").open(e)},_touchItemCoreCard:function(e){var i=n.director.getRunningScene();t.ImplantedPopup.createOrGet(i,"sh_item_info","ShItemInfoPopup").open(e)},_touchTreasureCoreCard:function(e){var i=n.director.getRunningScene();t.ImplantedPopup.createOrGet(i,"com_need_mate","ShComNeedMatePopup").open(e)},_touchPackageCoreCard:function(e){var i=n.director.getRunningScene();t.ImplantedPopup.createOrGet(i,"sh_package_item_info","ShPackageItemInfoPopup").open(e)},_setRewardCoreCardCallback:function(e,t){e.addTouchEventListener(function(e,n){n===i.Widget.TOUCH_ENDED&&t()},this)}}),t.assignRoles(t.beginner_mission.view.RewardView,[t.pc.roles.UIUtility,t.pc.roles.CoreCardCommon])}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,t.createNameSpaceIfNotExists("beginner_mission.view"),t.beginner_mission.view.CompleteRewardView=n.Class.extend({className:"BeginnerMissionRewardView",REWARD_CORECARD_UI_NODE_NAME:"corecard_ui",REWARD_NAME_NODE_NAME:"complete_reward_label",PROGRESS_NODE_NOME:"beginner_mission_status_label",_parentNode:null,_panel:null,_rewardView:null,ctor:function(e,n){this._parentNode=e,this._panel=n,this._rewardView=new t.beginner_mission.view.RewardView(e,this.REWARD_CORECARD_UI_NODE_NAME,this._panel.getReward())},show:function(){this._showReward(),this._showProgress()},_showReward:function(){var e=this._panel.getReward();this._parentNode.seekWidgetByName(this.REWARD_NAME_NODE_NAME).setString(e.getName()),this._rewardView.show()},_showProgress:function(){this._parentNode.seekWidgetByName(this.PROGRESS_NODE_NOME).setString(" "+this._panel.getProgress())}}),t.assignRoles(t.beginner_mission.view.CompleteRewardView,[t.pc.roles.UIUtility])}((this||0).self||global),function(e){var t=(e.cc,e.kh);e._,t.beginner_mission=t.beginner_mission||{},t.beginner_mission.roles=t.beginner_mission.roles||{},t.beginner_mission.roles.PanelAnimation={_playReceiveRewardAnimation:function(e,n){var i=e.seekWidgetByName("reward_clear_ui");this._setProperCoreCardElementRarity(i,n.getRawData(),"corecard_ui"),i.setVisible(!0);var a=Q.defer();return i.animate("get_reward",!1).then(function(){i.animate("loop_reward",!0),i.seekWidgetByName("touch_panel").setVisible(!0),t.setTouchEventHandlers(i,{"TOUCH_ENDED touch_panel":function(){i.animate("end_reward",!1).then(function(){i.setVisible(!1),a.resolve()}.bind(this)).fail(function(e){console.error(e)})}},this)}.bind(this)).fail(function(e){console.error(e)}),a.promise},_playReceiveCompleteRewardAnimation:function(e,n){var i=e.seekWidgetByName("reward_complete_ui"),a=i.seekWidgetByName("corecard_panel");return this._setProperCoreCardElementRarity(a,n.getRawData(),"corecard_ui"),a.setVisible(!0),i.setVisible(!0),i.setLocalZOrder(1),i.animate("get_comp_reward",!1).then(function(){i.animate("loop_comp_reward",!0),i.seekWidgetByName("touch_panel").setVisible(!0);var e=Q.defer();return t.setTouchEventHandlers(i,{"TOUCH_ENDED touch_panel":function(){e.resolve()}},this),e.promise}.bind(this)).fail(function(e){console.error(e)})},_playStartNextMissionsAnimation:function(e){var t=e.seekWidgetByName("reward_complete_ui");return t.animate("end_comp_reward",!1).then(function(){return t.animate("next_comp_reward",!1)}.bind(this))}},t.assignRoles(t.beginner_mission.roles.PanelAnimation,[t.pc.roles.UIUtility,t.pc.roles.CoreCardCommon])}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,t.createNameSpaceIfNotExists("beginner_mission.view"),t.beginner_mission.view.MissionView=n.Class.extend({className:"BeginnerMissionView",REWARD_CORECARD_UI_NODE_NAME:"corecard_ui_68",_node:null,_mission:null,_btnView:null,_rewardView:null,ctor:function(e,n){this._node=e,this._mission=n,this._btnView=new t.beginner_mission.view.MissionBtnView(this._getBtnUiNode(),this._receiveRewardCallback.bind(this),this._challengeMissionCallback.bind(this)),this._rewardView=new t.beginner_mission.view.RewardView(this._node,this.REWARD_CORECARD_UI_NODE_NAME,this._mission.getReward())},show:function(){this._showBtn(this._mission),this._setMissionTitle(this._mission),this._setMissionDescription(this._mission),this._setMissionProgress(this._mission),this._initReward(this._mission.getReward())},_receiveRewardCallback:function(){return t.createInstance("BeginnerMissionPageController").receiveReward(this)},_challengeMissionCallback:function(){var e=this._mission.getRoutingPage();if("locked"!==this._mission.getState())if(/(q_accessories_top|q_material_top|q_element_type_top)/.test(e))t.createInstance("QuestListRouter").route(e);else if("guild"!==e)if(e.startsWith("gacha/ga_004"))t.createInstance("router").navigate(e,{ga_100:{}});else if(e.startsWith("profile/")){t.createInstance("router").navigate(e,{prf_001:{}},{return_to_profile:{routes:"beginner_mission/beginner_mission_main"}})}else t.createInstance("router").navigate(e);else t.createInstance("unionRouter").navigateToTopScene("me");else{var i=this._mission.getUnlockCondition();new QuestPortal.UnlockCondition(i).render(n.director.getRunningScene())}},_showBtn:function(e){this._btnView.show(e.isReceivedReward(),e.canReceive())},_setMissionTitle:function(e){var t=this._getMissionTitleLabel();null!=t&&t.setString(e.getTitle())},_setMissionDescription:function(e){var t=this._getMissionDescriptionLabel();null!=t&&t.setString(e.getDescription())},_setMissionProgress:function(e){return e.canReceive()||e.isReceivedReward()?void this._showClearedProgress():void this._showDefaultProgress(e)},_showClearedProgress:function(){this._node.setAppearance("clear_view")},_showDefaultProgress:function(e){this._node.setAppearance("default_view");var t=this._getMissionProgressLabel();null!=t&&t.setString(e.getProgress())},_initReward:function(e){this._setMissionRewardDescription(e),this._rewardView.show()},_setMissionRewardDescription:function(e){var t=this._getMissionRewardLabel();null!=t&&t.setString(e.getName())},_getMissionRewardLabel:function(){return this._node.seekWidgetByName("mission_reward_label")},_getMissionProgressLabel:function(){return this._node.seekWidgetByName("achievement_status_label")},_getMissionDescriptionLabel:function(){return this._node.seekWidgetByName("explanation_label")},_getMissionTitleLabel:function(){return this._node.seekWidgetByName("mission_header_label")},_getBtnUiNode:function(){return this._node.seekWidgetByName("beginner_mission_receive_ui")},getMission:function(){return this._mission},getBtnView:function(){return this._btnView}}),t.assignRoles(t.beginner_mission.view.MissionView,[t.pc.roles.UIUtility,t.pc.roles.CoreCardCommon])}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=e.ccui,a=e._;t.createNameSpaceIfNotExists("beginner_mission.controller"),t.beginner_mission.controller.MissionPageController=n.Class.extend({className:"BeginnerMissionPageController",_panel:null,_descriptionImages:[1],_subTutorialPrefix:"beginner_mission",update:function(e){return t.createInstance("apiAPanelMissions").get().then(function(t){this._show(e,t.body)}.bind(this)).fail(this._errorHandling)},_show:function(e,n){this._panel=new t.beginner_mission.model.Panel(n),this._showTitle(e),this._showCompleteReward(e),this._showMissions(e),this._setSubtutorialInfo(n)},_showCompleteReward:function(e){new t.beginner_mission.view.CompleteRewardView(e.seekWidgetByName("complete_reward_base"),this._panel).show()},_showTitle:function(e){var t="beginner_mission/res/beginner_mission_"+this._panel.getOrderNumber()+"_complete_reward.png";e.seekWidgetByName("complete_reward_header").loadTexture(t,i.Widget.PLIST_TEXTURE),e.seekWidgetByName("page_num_label").setString(this._panel.getTitle())},_showMissions:function(e){this._panel.getMissions().getAllContent().then(function(n){e.disposed||this._fillupList(e,{viewParent:t.PageListParams.BEGINNER_MISSION_LIST.viewParent,subPageRes:t.PageListParams.BEGINNER_MISSION_LIST.subPageRes,panelsPerPage:t.PageListParams.BEGINNER_MISSION_LIST.perPage},n,n.length,{},this._showMission.bind(this))}.bind(this)).fail(this._errorHandling)},_showMission:function(e,n,i){new t.beginner_mission.view.MissionView(e,n).show()},receiveReward:function(e){var i=e.getMission();return t.createInstance("apiAPanelMissions").receiveReward(i.getId()).then(function(e){var a=e.body;if(a.result){var o=n.director.getRunningScene();t.createInstance("myselfInfoRepository").allCacheClear();var r=this._panel.getReward();return Q.all([this._updateReceivedRewardIcon(o,a.panel.missions),this._show(o,a.panel),this._playReceiveRewardAnimation(o,i.getReward())]).then(function(){return!a.is_completed_missions||o.disposed?Q.reject():this._playReceiveCompleteRewardAnimation(o,r)}.bind(this)).then(function(){if(!a.exists_next_missions)return t.createInstance("router").navigate("mypage/my_001"),Q.reject()}).then(function(){return this._playStartNextMissionsAnimation(o)}.bind(this))}console.warn("")}.bind(this)).fail(this._errorHandling)},_updateReceivedRewardIcon:function(e,n){var i=new t.beginner_mission.model.Missions(n);t.createInstance("beginnerMissionInformationModel").setGettableReward(i.canReceive()),e.footerDelegate.updateMenuNewIcon(e)},_setSubtutorialInfo:function(e){a.isArray(e.description_images)&&(this._descriptionImages=e.description_images),a.isString(e.subturorial_prefix)&&(this._subTutorialPrefix=e.subturorial_prefix)},openSubTutorial:function(e){t.ImplantedPopup.createOrGet(e,"sub_tutorial","ImplantedSubTutorialPopup").open(this._subTutorialPrefix,this._descriptionImages.length)},_errorHandling:function(e){e&&console.error(e)}}),t.assignRoles(t.beginner_mission.controller.MissionPageController,[t.pc.list.roles.PageListControllerCommon,t.beginner_mission.roles.PanelAnimation,t.pc.roles.UIUtility,t.pc.roles.CoreCardCommon])}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.beginner_mission=t.pc.beginner_mission||{},t.pc.beginner_mission.beginner_mission_main=t.pc.beginner_mission.beginner_mission_main||{},t.pc.beginner_mission.beginner_mission_main.Scene=t.BaseScene.extend({resourceFileName:"beginner_mission_main/beginner_mission_main.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"beginner_mission",sceneName:"beginner_mission_main",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_present","btnCallbackBtnPresent",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"present/prs_001_2_3")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_hint","btnCallbackBtnHint",null,function(){alert("{{}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._,e.Q);t.pc=t.pc||{},t.pc.beginner_mission=t.pc.beginner_mission||{},t.pc.beginner_mission.beginner_mission_main=t.pc.beginner_mission.beginner_mission_main||{},t.pc.beginner_mission.beginner_mission_main.SceneDelegate=t.pc.BaseSceneDelegate.extend({_popups:{com_caution_2:{factoryName:"popupFactoryBlue",title:"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){this.dismiss()}}},com_caution_wait_update:{factoryName:"popupFactoryBlue",title:"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){this.dismiss()}}},com_caution_progress_locked:{factoryName:"popupFactoryBlue",title:"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){this.dismiss()}}}},onSceneInit:function(e){return this._setBackBtn(e),t.createInstance("BeginnerMissionPageController").update(e)},_touchEndedBackBtnProcess:function(e){t.createInstance("router").navigate("mypage/my_001")},btnCallbackBtnPresent:function(e){return t.createInstance("router").navigate("present/prs_001",{},{prs_001_002_003:{returnRoute:"beginner_mission"}}),n.reject(this._override)},btnCallbackBtnHint:function(e){return t.createInstance("BeginnerMissionPageController").openSubTutorial(e),n.reject(this._override)}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.router=n.router||{},n.router.routes=n.router.routes||{},t.merge(n.router.routes,{beginner_mission:{beginner_mission:"beginner_mission_main","beginner_mission/beginner_mission_main":"beginner_mission_main"}})}((this||0).self||global),function(e){var t=e.kh;e.khutil,e.cc,e.ccui,e._,e.console,t.createNameSpaceIfNotExists("displayFilter.enums"),t.displayFilter.enums.FILTER_NAME={PARTY_CHARA:"party_chara",PARTY_PICK_CHARA:"pick_chara",PARTY_WEAPON:"party_weapon",PARTY_SUMMON:"party_summon",PARTY_ACCESSORY:"party_acce",BOOK_CHARA:"book_chara",BOOK_WEAPON:"book_weapon",BOOK_SUMMON:"book_summon",BOOK_ACCESSORY:"book_acce",EPI_CHARA:"episode_chara",EPI_SUMMON:"episode_summ",SELECT_CHARA_FROM_ACCESSORY:"select_chara_acce",EQUIP_ACCESSORY:"equip_acce",SELL_WEAPON:"sell_weapon",SELL_SUMMON:"sell_summon",SELL_ACCESSORY:"sell_acce",ENH_BASE_CHARA:"enh_base_chara",ENH_BASE_WEAPON:"enh_base_weapon",ENH_BASE_SUMMON:"enh_base_summon",ENH_BASE_ACCESSORY:"enh_base_acce",ENH_MATERIAL_CHARA:"enh_mate_chara",ENH_MATERIAL_WEAPON:"enh_mate_weapon",ENH_MATERIAL_SUMMON:"enh_mate_summon",ENH_MATERIAL_ACCESSORY:"enh_mate_acce",EVO_BASE_CHARA:"evo_base_chara",EVO_BASE_WEAPON:"evo_base_weapon",EVO_BASE_SUMMON:"evo_base_summon",EVO_BASE_ACCESORY:"evo_base_acce",EVO_MATERIAL_CHARA:"evo_mate_chara",EVO_MATERIAL_WEAPON:"evo_mate_weapon",EVO_MATERIAL_SUMMON:"evo_mate_summon",EVO_MATERIAL_ACCESSORY:"evo_mate_acce",AROUSAL_CHARA:"arousal_chara",GUILD_WEAPON:"guild_weapon",SUPPORT_SUMMON:"support_summon"}}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.createNameSpaceIfNotExists("displayFilter.view"),t.displayFilter.view.ComFilterPopup=t.ImplantedPopup.extend({_elementTypeUIView:null,_rarityUIView:null,ctor:function(e){this._super.apply(this,arguments),this.setButtonEvents({btn_cancel:!1,btn_reset:this.reset.bind(this),btn_apply:!0})},_initContents:function(e){this._configModel=e,this._rarityUIView=new t.displayFilter.view.RaritySettingUI(this.getNode(),this._configModel),this._elementTypeUIView=new t.displayFilter.view.ElementTypeSettingUI(this.getNode(),this._configModel)},reset:function(){this._dfd&&this._dfd.promise.isPending()&&this._configModel.reset()},dismiss:function(e){this._dfd&&this._dfd.promise.isPending()&&(this._super.apply(this,arguments),!1===e&&this._configModel.cancelModifications(),this._clean())},_clean:function(){this._rarityUIView.clean(),this._rarityUIView=null,this._elementTypeUIView.clean(),this._elementTypeUIView=null,this._configModel=null}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.createNameSpaceIfNotExists("displayFilter.view"),t.displayFilter.view.ComCharacterFilterPopup=t.displayFilter.view.ComFilterPopup.extend({_initContents:function(e){this._configModel=e,this._rarityUIView=new t.displayFilter.view.RaritySettingUI(this.getNode(),this._configModel,!0),this._elementTypeUIView=new t.displayFilter.view.ElementTypeSettingUI(this.getNode(),this._configModel),this._characterTypeUIView=new t.displayFilter.view.CharacterTypeSettingUI(this.getNode(),this._configModel)},_clean:function(){this._characterTypeUIView.clean(),this._characterTypeUIView=null,this._super.apply(this,arguments)}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.createNameSpaceIfNotExists("displayFilter.view"),t.displayFilter.view.ComWeaponFilterPopup=t.displayFilter.view.ComFilterPopup.extend({_initContents:function(){this._super.apply(this,arguments),this._weaponTypeUIView=new t.displayFilter.view.WeaponTypeSettingUI(this.getNode(),this._configModel)},_clean:function(){this._weaponTypeUIView.clean(),this._weaponTypeUIView=null,this._super.apply(this,arguments)}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.createNameSpaceIfNotExists("displayFilter.model"),n.displayFilter.model.DisplayFilterConfig=n.EventSubject.extend({EVENT_PREFIX:"display_filter_config",EVENT_NAME:{PROPERTY_CHANGED:"property_changed",MODEL_UPDATED:"model_update"},RARITY:"rarity",CHARACTER_TYPE:"character_type",WEAPON_TYPE:"weapon_type",ELEMENT_TYPE:"element_type",_filterName:null,_filterEntity:null,ctor:function(e){this._super(),this._filterName=e},isEnabled:function(){return this._filterEntity.isEnabled()},prepare:function(){return n.createInstance("displayFilterRepository").get(this._filterName).then(function(e){return this._filterEntity=e,this._notifyPropertyChanged(),this._notifyModelUpdated(),this}.bind(this),function(e){console.error(e.stack)})},update:function(){return this._filterEntity.isModified()?n.createInstance("displayFilterRepository").save(this._filterName,this._filterEntity).then(function(e){this._filterEntity=e,this._notifyModelUpdated()}.bind(this),function(e){console.error(e.stack)}):(this._notifyModelUpdated(),Q.resolve())},containsRarity:function(e){var n=this._filterEntity.getPropertyOrDefault(this.RARITY,[]);return t.contains(n,e)},toggleRarity:function(e){this._filterEntity.toggleConfigProperty(this.RARITY,e),this._notifyPropertyChanged()},containsElementType:function(e){var n=this._filterEntity.getPropertyOrDefault(this.ELEMENT_TYPE,[]);return t.contains(n,e)},toggleElementType:function(e){this._filterEntity.toggleConfigProperty(this.ELEMENT_TYPE,e),this._notifyPropertyChanged()},containsCharacterType:function(e){var n=this._filterEntity.getPropertyOrDefault(this.CHARACTER_TYPE,[]);return t.contains(n,e)},toggleCharacterType:function(e){this._filterEntity.toggleConfigProperty(this.CHARACTER_TYPE,e),this._notifyPropertyChanged()},containsWeaponType:function(e){var n=this._filterEntity.getPropertyOrDefault(this.WEAPON_TYPE,[]);return t.contains(n,e)},toggleWeaponType:function(e){this._filterEntity.toggleConfigProperty(this.WEAPON_TYPE,e),this._notifyPropertyChanged()},cancelModifications:function(){this._filterEntity.cancelModifications(),n.createInstance("displayFilterRepository").get(this._filterEntity.idVO.id,!0).then(function(e){this._filterEntity=e,this._notifyPropertyChanged(),this._notifyModelUpdated()}.bind(this))},reset:function(){this._filterEntity.reset(),this._notifyPropertyChanged()},removeAllEventListeners:function(){for(var e in this.EVENT_NAME)this.removeEventListenersByEventName(e)},_notifyPropertyChanged:function(){this.dispatchEvent("PROPERTY_CHANGED")},_notifyModelUpdated:function(){this.dispatchEvent("MODEL_UPDATED")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e.console,t.DisplayFilterRepository=n.Class.extend({className:"DisplayFilterRepository",realRepository:null,ctor:function(){this.realRepository=new t.core.displayFilter.DisplayFilterRepository},get:function(e,n){var i=new t.core.displayFilter.DisplayFilterId(e);return!0===n&&this.realRepository.clearCache(i),this.realRepository.get(i)},getAsOffline:function(e){var n=new t.core.displayFilter.DisplayFilterId(e);return this.realRepository.getAsOffline(n)},save:function(e,n){var i=new t.core.displayFilter.DisplayFilterId(e);return this.realRepository.save(i,n)}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.createNameSpaceIfNotExists("displayFilter.view"),n.displayFilter.view.SettingButtonGroupUI=cc.Class.extend({className:"SettingButtonGroupUI",PARENT_NODE_NAME:"",BUTTON_VALUES:{buttonNodeName:"value"},CHECK_METHOD_NAME:"",TOGGLE_METHOD_NAME:"",_parentUINode:null,_buttonNodes:{},_configModel:null,_listener:null,ctor:function(e,n){for(var i in t.isString(e)&&(e=cc.director.getRunningScene().seekWidgetByName(e)),this._parentUINode=e.seekWidgetByName(this.PARENT_NODE_NAME),null===this._parentUINode&&console.error(this.className+": PARENT_NODE_NAME Not Found"),this._buttonNodes=this._getButtonNodes(e),this._configModel=n,this.BUTTON_VALUES){var a=this.BUTTON_VALUES[i];this.__addButtonTouchEvent(this._buttonNodes[i],a)}this._listener=n.addEventListener("PROPERTY_CHANGED",this.update,this),this.update()},_getButtonNodes:function(e){var t={};for(var n in this.BUTTON_VALUES){var i=e.seekWidgetByName(n);t[n]=i}return t},update:function(){if(this._configModel)for(var e in this._buttonNodes){var t=this._buttonNodes[e],n=this.BUTTON_VALUES[e],i=this._configModel[this.CHECK_METHOD_NAME](n);t.setBright(!i)}},__addButtonTouchEvent:function(e,t){e.addTouchEventListener(this.__buttonTouchEvent,{model:this._configModel,TOGGLE_METHOD_NAME:this.TOGGLE_METHOD_NAME,value:t})},__buttonTouchEvent:function(e,t){t===ccui.Widget.TOUCH_ENDED&&this.model[this.TOGGLE_METHOD_NAME](this.value)},clean:function(){this.update(),this._configModel.removeEventListener(this._listener),this._listener=null,this._configModel=null,this._parentUINode=null}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.createNameSpaceIfNotExists("displayFilter.view"),t.displayFilter.view.RaritySettingUI=t.displayFilter.view.SettingButtonGroupUI.extend({className:"RaritySettingUI",PARENT_NODE_NAME:"com_filter_rarity_ui",TOGGLE_METHOD_NAME:"toggleRarity",CHECK_METHOD_NAME:"containsRarity",BUTTON_VALUES:{btn_select_rarity_0:"SSR",btn_select_rarity_1:"SR",btn_select_rarity_2:"R",btn_select_rarity_3:"N"},ctor:function(e,t,n){this._super.apply(this,arguments),this._parentUINode.setAppearance(n?"btn_select_rarity_chara":"btn_select_rarity_not_chara")}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.createNameSpaceIfNotExists("displayFilter.view"),t.displayFilter.view.ElementTypeSettingUI=t.displayFilter.view.SettingButtonGroupUI.extend({className:"ElementTypeSetting",PARENT_NODE_NAME:"com_filter_element_ui",TOGGLE_METHOD_NAME:"toggleElementType",CHECK_METHOD_NAME:"containsElementType",BUTTON_VALUES:{btn_select_element_0:t.ELEMENT_TYPE.FLAME,btn_select_element_1:t.ELEMENT_TYPE.WATER,btn_select_element_2:t.ELEMENT_TYPE.WIND,btn_select_element_3:t.ELEMENT_TYPE.THUNDER,btn_select_element_4:t.ELEMENT_TYPE.LIGHT,btn_select_element_5:t.ELEMENT_TYPE.DARKNESS,btn_select_element_6:t.ELEMENT_TYPE.PHANTOM}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.createNameSpaceIfNotExists("displayFilter.view"),t.displayFilter.view.WeaponTypeSettingUI=t.displayFilter.view.SettingButtonGroupUI.extend({className:"WeaponTypeSettingUI",PARENT_NODE_NAME:"com_filter_weapon_select_base_2",TOGGLE_METHOD_NAME:"toggleWeaponType",CHECK_METHOD_NAME:"containsWeaponType",BUTTON_VALUES:{weapon_type_btn_sword:"sword",weapon_type_btn_special_sword:"special_sword",weapon_type_btn_spear:"spear",weapon_type_btn_ax:"ax",weapon_type_btn_staff:"staff",weapon_type_btn_hammer:"hammer",weapon_type_btn_gun:"gun",weapon_type_btn_bow:"bow",weapon_type_btn_magic_item:"magic_item"}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.createNameSpaceIfNotExists("displayFilter.view"),t.displayFilter.view.CharacterTypeSettingUI=t.displayFilter.view.SettingButtonGroupUI.extend({className:"CharacterTypeSettingUI",PARENT_NODE_NAME:"com_filter_chara_select_base",TOGGLE_METHOD_NAME:"toggleCharacterType",CHECK_METHOD_NAME:"containsCharacterType",BUTTON_VALUES:{com_filter_chara_attack_btn:"attack",com_filter_chara_defence_btn:"defense",com_filter_chara_special_btn:"special",com_filter_chara_balance_btn:"balance",com_filter_chara_heal_btn:"heal"}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.createNameSpaceIfNotExists("displayFilter.view"),n.displayFilter.view.FilterBtnView=cc.Class.extend({className:"FilterBtnView",BTN_NODE_NAME:"filter_btn",_btnNode:null,_configModel:null,_listener:null,_touchEventCallback:null,_touchEventCtx:null,ctor:function(e,n){t.isString(e)&&(e=cc.director.getRunningScene().seekWidgetByName(e)),this._btnNode=e.seekWidgetByName(this.BTN_NODE_NAME),null===this._btnNode&&console.error(this.className+": btnNode Not Found"),this._configModel=n,this._listener=n.addEventListener("MODEL_UPDATED",this.update,this),this._btnNode.addTouchEventListener(this._onTouchEvent,this)},update:function(){this._configModel&&this._btnNode.setBright(!this._configModel.isEnabled())},setTouchEventHandler:function(e,t){this._touchEventCallback=e,this._touchEventCtx=t},_onTouchEvent:function(e,t){t===ccui.Widget.TOUCH_ENDED&&this._touchEventCallback&&this._touchEventCallback.call(this._touchEventCtx)},clean:function(){this._configModel.removeEventListener(this._listener),this._listener=null,this._configModel=null,this._btnNode=null,this._touchEventCallback=null,this._touchEventCtx=null}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.createNameSpaceIfNotExists("displayFilter.controller"),t.displayFilter.controller.DisplayFilterSetting=cc.Class.extend({ctor:function(e,t,n){this._parentListNode=cc.director.getRunningScene().seekWidgetByPath(e),this._popupNodeName=t,this._filterName=n,this._initialized=!1},init:function(){return this._initialized||(this._configModel=new t.displayFilter.model.DisplayFilterConfig(this._filterName),this._filterBtnView=new t.displayFilter.view.FilterBtnView(this._parentListNode,this._configModel),this._filterBtnView.setTouchEventHandler(this.openPopup,this),this._initialized=!0),this._configModel.prepare()},openPopup:function(){return this._initialized||this.init(),this._popupUiNode=this._getPopupUiNode(),t.ImplantedPopup.create(this._popupUiNode,this._popupNodeName).open(this._configModel).then(this._configModel.update.bind(this._configModel)).then(this.applyScene.bind(this))},applyScene:function(){t.createInstance("notificationCenter").dispatchEvent(t.core.pager.controller.PagerController.prototype.REFRESH_EVENT,[1])},_getPopupUiNode:function(){return cc.director.getRunningScene().seekWidgetByName("popup_ui")},clean:function(){this._filterBtnView&&this._filterBtnView.clean(),this._popup&&this._popup.dismiss(),this._filterBtnView=null,this._parentListNode=null,this._popupUiNode=null,this._configModel&&this._configModel.removeAllEventListeners(),this._configModel=null}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc,e.ccui,e._);e.console,t.createNameSpaceIfNotExists("displayFilter.roles"),t.displayFilter.roles.DisplayFilterSceneController={_displayFilterControllers:{},_displayFilterClean:function(){n.forEach(this._displayFilterControllers,function(e){e.clean()}),this._displayFilterControllers={}},_initializeDisplayFilterController:function(e){var t=this._displayFilterControllers[e];t&&t.init()},_createDisplayFilterController:function(e){this._displayFilterControllers=n.mapValues(this._createDisplayFilterSettings(),function(e,n){return new t.displayFilter.controller.DisplayFilterSetting(n,e[1],e[0])})}}}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="ACharacters",o={get:function(e){return this._http.get({url:"/a_characters/"+e})},getList:function(e,t,n,i){var a=i||!1;return this._http.get({url:"/a_characters/",json:{display_filter_name:e,page:t,per_page:n,from_tower:a}})},getPickMembers:function(e,t,n,i){var a=i||!1;return this._http.get({url:"/a_characters/",json:{display_filter_name:e,selectable_base_filter:"assignable",page:t,per_page:n,from_tower:a}})},getListEnhanceBase:function(e,t,i){return this._http.get({url:"/a_characters",json:{display_filter_name:n.displayFilter.enums.FILTER_NAME.ENH_BASE_CHARA,selectable_base_filter:"enhance",sort:e,page:t,per_page:i}})},getEnhanceMaterials:function(e,t,i){return this._http.get({url:"/a_characters/"+e+"/enhance_materials",json:{display_filter_name:n.displayFilter.enums.FILTER_NAME.ENH_MATERIAL_CHARA,page:t,per_page:i}})},getEnhanceItems:function(){return this._http.get({url:"/a_characters/enhance_items"})},getExpitem:function(e){return this._http.get({url:"/a_characters/"+e+"/enhance_exp_spheres"})},getRecommendEnhanceMaterials:function(e){return this._http.get({url:"/a_characters/"+e+"/recommend_enhance_materials"})},confirmEnhanceMaterials:function(e,t){return this._http.get({url:"/a_characters/"+e+"/confirm_enhance_materials",json:{ids:t}})},enhance:function(e,t){return this._http.post({url:"/a_characters/"+e+"/enhance",json:{ids:t}})},enhanceByItem:function(e,t,n){return this._http.post({url:"/a_characters/"+e+"/enhance_by_item",json:{item_id:t,amount:n}})},enhanceByExpitem:function(e,t){return this._http.post({url:"/a_characters/"+e+"/enhance_by_exp_sphere",json:{use_exp_point:t}})},getListEvolveBase:function(e,t,i){return this._http.get({url:"/a_characters",json:{selectable_base_filter:"evolve",display_filter_name:n.displayFilter.enums.FILTER_NAME.EVO_BASE_CHARA,sort:e,page:t,per_page:i}})},getEvolveMaterials:function(e){return this._http.get({url:"/a_characters/"+e+"/evolve_material"})},evolve:function(e){return this._http.post({url:"/a_characters/"+e+"/evolve"})},getEnhanceEvolveInfo:function(e){return this._http.get({url:"/a_characters/"+e+"/enhance_evolve_info"})},getConfirmChangeAccessory:function(e,t,n){return this._http.get({url:["/a_characters",e,"accessories","confirm_equip",t].join("/"),json:{a_accessory_id:n}})},getListArouseBase:function(e,t,i){return this._http.get({url:"/a_characters",json:{selectable_base_filter:"arousal",display_filter_name:n.displayFilter.enums.FILTER_NAME.AROUSAL_CHARA,sort:e,page:t,per_page:i}})},changeAccessory:function(e,t,n){return this._http.put({url:["/a_characters",e,"accessories",t].join("/"),json:{a_accessory_id:n}})},getAccessoryUnlockMaterials:function(e){return this._http.get({url:["/a_characters",e,"accessories","unlock_material"].join("/")})},unlockAccessoryEquip:function(e){return this._http.post({url:["/a_characters",e,"accessories","equip_unlock"].join("/")})},getArouseMaterials:function(e){return this._http.get({url:"/a_characters/"+e+"/arouse_material"})},arouse:function(e){return this._http.post({url:"/a_characters/"+e+"/arouse"})},evolveByItem:function(e,t){return this._http.post({url:"/a_characters/"+e+"/evolve_by_item",json:{item_id:t}})},getEvolutionItems:function(e){return this._http.get({url:"/a_characters/"+e+"/evolution_items"})},changeAppearance:function(e,t){return this._http.put({url:["/a_characters",e,"appearance"].join("/"),json:{type:t}})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiACharacters",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},o)),n.env.useApiMock){n.MockApi=n.MockApi||{};var r={};t.each(o,function(e,t){r[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi."+a+"."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},r))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="AWeapons",o={get:function(e){return this._http.get({url:"/a_weapons/"+e})},lock:function(e){return this._http.put({url:"/a_weapons/"+e,json:{is_locked:!0}})},unlock:function(e){return this._http.put({url:"/a_weapons/"+e,json:{is_locked:!1}})},getList:function(e,t,n){return this._http.get({url:"/a_weapons/",json:{display_filter_name:e,page:t,per_page:n}})},getExpitem:function(e){return this._http.get({url:"/a_weapons/"+e+"/enhance_exp_spheres"})},enhanceByExpitem:function(e,t){return this._http.post({url:"/a_weapons/"+e+"/enhance_by_exp_sphere",json:{use_exp_point:t}})},getHighReleaseWeaponList:function(e,t,n){return this._http.get({url:"/a_weapons/",json:{selectable_base_filter:"job_restore",page:e,per_page:t,job_group_id:n}})},getListEnhanceBase:function(e,t,i){return this._http.get({url:"/a_weapons",json:{display_filter_name:n.displayFilter.enums.FILTER_NAME.ENH_BASE_WEAPON,selectable_base_filter:"enhance",sort:e,page:t,per_page:i}})},getEnhanceMaterials:function(e,t,i){return this._http.get({url:"/a_weapons/"+e+"/enhance_materials",json:{display_filter_name:n.displayFilter.enums.FILTER_NAME.ENH_MATERIAL_WEAPON,page:t,per_page:i}})},getRecommendGuardianDonationMaterials:function(){return this._http.get({url:"/a_weapons",json:{guardian_enhance_recommended:!0}})},getRecommendEnhanceMaterials:function(e){return this._http.get({url:"/a_weapons/"+e+"/recommend_enhance_materials"})},confirmEnhanceMaterials:function(e,t){return this._http.get({url:"/a_weapons/"+e+"/confirm_enhance_materials",json:{ids:t}})},enhance:function(e,t){return this._http.post({url:"/a_weapons/"+e+"/enhance",json:{ids:t}})},getListEvolveBase:function(e,t,i){return this._http.get({url:"/a_weapons",json:{display_filter_name:n.displayFilter.enums.FILTER_NAME.EVO_BASE_WEAPON,selectable_base_filter:"evolve",sort:e,page:t,per_page:i}})},getEvolveMaterials:function(e,t,i){return this._http.get({url:"/a_weapons/"+e+"/evolve_materials",json:{display_filter_name:n.displayFilter.enums.FILTER_NAME.EVO_MATERIAL_WEAPON,page:t,per_page:i}})},confirmEvolveMaterial:function(e,t){return this._http.get({url:"/a_weapons/"+e+"/confirm_evolve_material",json:{id:t}})},evolve:function(e,t){return this._http.post({url:"/a_weapons/"+e+"/evolve",json:{id:t}})},getArouseMaterials:function(e){return this._http.get({url:"/a_weapons/"+e+"/arouse_material"})},confirmSellPrice:function(e){return this._http.get({url:"/a_weapons_sale_selection",json:{ids:e}})},sell:function(e){return this._http.post({url:"/a_weapons_sale",json:{ids:e}})},getSellableList:function(e,t){return this._http.get({url:"/a_weapons",json:{display_filter_name:n.displayFilter.enums.FILTER_NAME.SELL_WEAPON,selectable_base_filter:"sellable",page:e,per_page:t}})},getRecommendSellableList:function(){return this._http.get({url:"/a_weapons",json:{sale_recommended:!0}})},getEnhanceEvolveInfo:function(e){return this._http.get({url:"/a_weapons/"+e+"/enhance_evolve_info"})},getEvolutionItems:function(e){return this._http.get({url:"/a_weapons/"+e+"/evolution_items"})},confirmEvolveByItem:function(e,t){return this._http.get({url:"/a_weapons/"+e+"/confirm_evolve_by_item",json:{item_id:t}})},evolveByItem:function(e,t){return this._http.post({url:"/a_weapons/"+e+"/evolve_by_item",json:{item_id:t}})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiAWeapons",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},o)),n.env.useApiMock){n.MockApi=n.MockApi||{};var r={};t.each(o,function(e,t){r[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi."+a+"."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},r))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="AAccessories",o={get:function(e){return this._http.get({url:"/a_accessories/"+e})},lock:function(e){return this._http.put({url:"/a_accessories/"+e,json:{is_locked:!0}})},unlock:function(e){return this._http.put({url:"/a_accessories/"+e,json:{is_locked:!1}})},getList:function(e,t,n,i){return this._http.get({url:"/a_accessories/",json:{display_filter_name:e,page:t,per_page:n,selectable_base_filter:i}})},getPickAccessoryList:function(e,t,n,i,a){return this._http.get({url:"/a_accessories/",json:{display_filter_name:e,page:t,per_page:n,selectable_base_filter:i,a_party_id:a}})},getListEnhanceBase:function(e,t,i){return this._http.get({url:"/a_accessories",json:{display_filter_name:n.displayFilter.enums.FILTER_NAME.ENH_BASE_ACCESSORY,selectable_base_filter:"enhance",sort:i,page:e,per_page:t}})},getEnhanceMaterials:function(e,t,i){return this._http.get({url:"/a_accessories/"+e+"/enhance_materials",json:{display_filter_name:n.displayFilter.enums.FILTER_NAME.ENH_MATERIAL_ACCESSORY,page:t,per_page:i}})},getRecommendEnhanceMaterials:function(e){return this._http.get({url:"/a_accessories/"+e+"/recommend_enhance_materials"})},confirmEnhanceMaterials:function(e,t){return this._http.get({url:"/a_accessories/"+e+"/confirm_enhance_materials",json:{ids:t}})},enhance:function(e,t){return this._http.post({url:"/a_accessories/"+e+"/enhance",json:{ids:t}})},getExpitem:function(e){return this._http.get({url:"/a_accessories/"+e+"/enhance_exp_spheres"})},enhanceByExpitem:function(e,t){return this._http.post({url:"/a_accessories/"+e+"/enhance_by_exp_sphere",json:{use_exp_point:t}})},confirmSellPrice:function(e){return this._http.get({url:"/a_accessories_sale_selection",json:{ids:e}})},sell:function(e){return this._http.post({url:"/a_accessories_sale",json:{ids:e}})},getSellableList:function(e,t){return this._http.get({url:"/a_accessories",json:{display_filter_name:n.displayFilter.enums.FILTER_NAME.SELL_ACCESSORY,selectable_base_filter:"sellable",page:e,per_page:t}})},getRecommendSellableList:function(){return this._http.get({url:"/a_accessories",json:{sale_recommended:!0}})},getListCharacterSelectable:function(e,t,i,a){return this._http.get({url:["/a_accessories","character_selectable",e,t].join("/"),json:{display_filter_name:n.displayFilter.enums.FILTER_NAME.EQUIP_ACCESSORY,page:i,per_page:a}})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiAAccessories",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},o)),n.env.useApiMock){n.MockApi=n.MockApi||{};var r={};t.each(o,function(e,t){r[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi."+a+"."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},r))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="AFavoriteMember",o={get:function(){return this._http.get({url:"/a_favorite_member"})},update:function(e,t){return this._http.put({url:"/a_favorite_member",json:{id:e,type:t}})},firstAccess:function(){return this._http.put({url:"/a_favorite_member/first_access",json:{}})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiAFavoriteMember",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},o)),n.env.useApiMock){n.MockApi=n.MockApi||{};var r={};t.each(o,function(e,t){r[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi."+a+"."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},r))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="ASupportSummonSetting",o={get:function(e){return this._http.get({url:"/a_support_summon_setting/"+e})},update:function(e,t){return this._http.put({url:"/a_support_summon_setting/"+e,json:{a_summon_id:t}})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiASupportSummonSetting",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},o)),n.env.useApiMock){n.MockApi=n.MockApi||{};var r={};t.each(o,function(e,t){r[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi."+a+"."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},r))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._,e.Q);t.pc.roles=t.pc.roles||{},t.pc.roles.AnimationCommon={_setEndAnimationEvent:function(e,t,i){var a=new ccs.Timeline,o=new ccs.EventFrame;i=i||"endAnimation",o.setEvent(i),o.setFrameIndex(t),a.addFrame(o),e.addTimeline(a);var r=n.defer();return e.setFrameEventCallFunc(function(t){t.getEvent()===i&&r.resolve(e)}),r.promise}}}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;e.Q,t.pc.roles=t.pc.roles||{},t.pc.roles.AllOverUI={_openAllOverPanel:function(e,a,o){var r=n.director.getRunningScene().seekWidgetByName("all_over_ui");if(null!==r){if(i.contains(["chara","weapon","summon","job","guardian","npc"],o)){var s=r.seekWidgetByName("illustzoom");return null===s?void console.warn("[ERROR] Could not find illustzoom | btn_faceup."):(this._initializeToImage(s),a=a||0,s.loadTexture(t.Img("illustzoom",o,i.padZero(e,4),a).png),r.setVisible(!0),this.eventListener=t.env.isSp?this._createTouchEvent(r,s):this._createMouseEvent(r,s),void n.eventManager.addListener(this.eventListener,r))}console.error("Invalid image type: "+o)}else console.warn("[ERROR] Could not find all_over_ui.")},_createTouchEvent:function(e,t){var i=!1;return n.EventListener.create({event:n.EventListener.TOUCH_ALL_AT_ONCE,swallowTouches:!0,onTouchesBegan:function(e,t){i=!0},onTouchesMoved:function(e,n){if(2==e.length){i=!1;var a=e[0].getLocationX()<e[1].getLocationX()?e[0]:e[1],o=e[0].getLocationX()<e[1].getLocationX()?e[1]:e[0],r=Math.abs(a.getLocationX()-a.getPreviousLocation().x);this._isPinchIn(a,o)?this._pinchInImage(t,r):this._isPinchOut(a,o)&&this._pinchOutImage(t,r)}var s=(e[0].getLocationX()-e[0].getPreviousLocation().x)*(.5*t.getScaleX()),c=(e[0].getLocationY()-e[0].getPreviousLocation().y)*(.5*t.getScaleY());i=i?this._isEnableTap(s,c):i;var u=this._clampImagePosition(t,s,c);t.setPosition(t.x+u.x,t.y+u.y)}.bind(this),onTouchesEnded:function(t,n){1==t.length&&i&&(e.setVisible(!1),this._onTouchClose(e))}.bind(this)})},_createMouseEvent:function(e,t){var i=!1,a=0,o=0,r={x:0,y:0};return n.EventListener.create({event:n.EventListener.MOUSE,onMouseMove:function(e){if(i){var n=(e.getLocationX()-o.x)/t.getScaleX(),a=(e.getLocationY()-o.y)/t.getScaleY(),s=this._clampImagePosition(t,n,a);r.x+=s.x,r.y+=s.y,t.setPosition(t.x+s.x,t.y+s.y),o=e.getLocation()}}.bind(this),onMouseDown:function(e){i=!0,a=e.getLocation(),o=e.getLocation()}.bind(this),onMouseUp:function(t){i=!1,e.isVisible()&&n.pointEqualToPoint(a,o)&&(e.setVisible(!1),this._onTouchClose(e))}.bind(this),onMouseScroll:function(e){var n=Math.max(1,Math.min(t.getScaleX()+.001*e._scrollY,3));t.setScale(n);var i=this._getImageMargin(t),a=i.width/2*-1,o=i.height/2*-1,s={x:a+r.x,y:o+r.y};t.setPosition(s.x,s.y)}.bind(this)})},_onTouchClose:function(e){e.setVisible(!1),n.eventManager.removeListener(this.eventListener)},_getImageMargin:function(e){return{width:e.width*e.getScaleX()-e.width,height:e.height*e.getScaleY()-e.height}},_clampImagePosition:function(e,t,n){var i=this._getImageMargin(e);return e.x+t<-1*i.width?t=-1*i.width-e.x:e.x+t>0&&(t=-1*e.x),e.y+n<-1*i.height?n=-1*i.height-e.y:e.y+n>0&&(n=-1*e.y),{x:t,y:n}},_initializeToImage:function(e){e.setPosition(0,0),e.setScale(1,1)},_isEnableTap:function(e,t){return Math.pow(e,2)+Math.pow(t,2)<.01},_pinchInImage:function(e,t){e.setScale(Math.min(e.getScaleX()+.01*t,4),Math.min(e.getScaleY()+.01*t,4)),e.setPosition(e.x-t,e.y-t)},_pinchOutImage:function(e,t){e.setScale(Math.max(e.getScaleX()-.01*t,1),Math.max(e.getScaleY()-.01*t,1)),e.setPosition(e.x+t,e.y+t)},_isPinchIn:function(e,t){return e.getLocationX()<e.getPreviousLocation().x&&t.getLocationX()>t.getPreviousLocation().x},_isPinchOut:function(e,t){return e.getLocationX()>e.getPreviousLocation().x&&t.getLocationX()<t.getPreviousLocation().x}}}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=(e.ccui,e._,e.console);t.createNameSpaceIfNotExists("core.controller"),t.core.controller.SummonOrbAmountLabelController=i.Class.extend({className:"SummonOrbAmountLabelController",NODE_NAME:"orb_num_label",display:function(){t.createInstance("myselfInfoRepository").getMyCurrency().then(function(e){this._displayLabel(e.getSummonOrbAmount())}.bind(this))},_displayLabel:function(e){var t=n.getWidget(this.NODE_NAME,function(e){a.warn(this.className+": "+e)}.bind(this));null!==t&&t.setString(e.toString())}})}((this||0).self||global),function(e){var t=(e.cc,e._),n=e.kh;n.createNameSpaceIfNotExists("core.item"),n.core.item.comConsumptionCheckResult=n.ImplantedPopup.extend({BUTTON_VISIBLE:{btn_enhance:!1,btn_sell:!1,btn_ok:!1,btn_cancel:!0},MATERIAL_TYPE:null,TITLE_LABEL:"",CONFIRM_MESSAGE_NORMAL:"",CONFIRM_MESSAGE_INCLUDE_RARE:"",RESULT_BUTTON_VISIBLE:{btn_enhance:!1,btn_sell:!1,btn_ok:!0,btn_cancel:!1},RESULT_TITLE_LABEL:"",RESULT_CONFIRM_MESSAGE:"",TITLE_LABEL_NODE_NAME:"title_label",CONFIRM_LABEL_NODE_NAME:"confirm_label",FIRST_CORECARD_NODE_NAME:"list_blank_0",BOTTOM_LABEL_NODE_NAME:"labelimg",BUTTON_EVENT_MAPPING:{btn_cancel:!1,btn_enhance:!0,btn_sell:!0,btn_ok:!0},LABEL_ONE_LINE_TEMPLATE:t.template('<div class="orange"><%= title %></div><div><%= body_html %></div>'),LABEL_SIMPLE_BODY_TEMPLATE:t.template('<div class="text_common_left"><span class="<%= color %>"><%= text %></span></div>'),LABEL_FLUCTUATE_BODY_TEMPLATE:t.template('<div class = "text_common_left"><span class="white"><%= before_text %>&ensp;</span><span class="<%= after_number_color %>"><%= after_text %></span></div>'),_consumptionParameter:null,_hasNum:null,_earnNum:null,_initContents:function(e,t){var n=this.getNode();return t?(this._setTitle(n,t),this._setConfirmLabel(n,null,t),this._setButtonVisible(n,t),void this._setBottomLabel(n,t)):(this._consumptionParameter=e,this.__initContents(e),this.setButtonEvents(this.BUTTON_EVENT_MAPPING),this._setButtonVisible(n),this._setTitle(n),this._setConfirmLabel(n,e.materials),this._setBottomLabel(n),void this._setCoreCards(n,e.materials))},__initContents:function(){},reopenByResultMode:function(){return this.open(this._consumptionParameter,!0)},_setButtonVisible:function(e,n){var i=n?this.RESULT_BUTTON_VISIBLE:this.BUTTON_VISIBLE;t.each(i,function(t,n){var i=e.seekWidgetByName(n);null!==i&&i.setVisible(t)})},_setTitle:function(e,t){var n=e.seekWidgetByName(this.TITLE_LABEL_NODE_NAME);if(null!==n){var i=t?this.RESULT_TITLE_LABEL:this.TITLE_LABEL;n.setString(i)}},_setConfirmLabel:function(e,t,n){var i=e.seekWidgetByName(this.CONFIRM_LABEL_NODE_NAME);if(null!==i)return n?void i.setString(this.RESULT_CONFIRM_MESSAGE):void i.setString(this._createConfirmLabel(t))},_createConfirmLabel:function(e){return""},_setBottomLabel:function(){},createGetJemCustomePointLabel:function(){return""},createHaveJemCustomPointLabel:function(){return""},_createHtmlByTemplate:function(e,n){return t.template(e)(n)},_setCoreCards:function(e,n){var i=e.seekWidgetByName(this.FIRST_CORECARD_NODE_NAME).parent.getChildren();t.each(i,this._setCoreCard.bind(this,n))},_setCoreCard:function(e,t,i){var a=e[i];if(a){var o=t.getUserData(),r=a;if(a instanceof n.core.pager.model.PlainData&&(r=a.getRawData()),!(o instanceof n.CoreCardUI)){var s=khutil.getCoreCardDINameByRecord(r);o=n.createInstance(s,["e_r"]);var c=t.getChildren()[0];c.addChild(o.getResult()),c.setVisible(!0),t.setUserData(o)}o.setData(r),o.setVisible(!0),t.setVisible(!0)}else t.setVisible(!1)},_isIncludedMoreThanRare:function(e){var n=Array("R","SR","SSR"),i=t.find(e,function(e){if(n.indexOf(e.rare)>=0)return!0});return!t.isUndefined(i)},_getHighestRearityInSelectedMaterials:function(e){var i=n.w("ORDERD_RARELITIES"),a=0;return t.find(e,function(e){a=Math.max(a,i.indexOf(e.rare))}),i[a]}})}((this||0).self||global),function(e){var t=(e.cc,e._,e.kh);t.createNameSpaceIfNotExists("list.popup"),t.list.popup.comSellWeapons=t.core.item.comConsumptionCheckResult.extend({BUTTON_VISIBLE:{btn_enhance:!1,btn_sell:!0,btn_ok:!1,btn_cancel:!0},TITLE_LABEL:"",CONFIRM_MESSAGE_NORMAL:"\n",CONFIRM_MESSAGE_INCLUDE_RARE:"R\n",TEXT2_LABEL:"",TEXT3_LABEL:"",_earnNum:null,_hasNum:null,RESULT_TITLE_LABEL:"",RESULT_CONFIRM_MESSAGE:"",__initContents:function(e){this._hasNum=e.myGem,this._earnNum=e.earnGem,this._earnExpitem=e.earnExpitem},_openAnimation:function(){return this._super().then(function(){this.getNode().setAppearance(this._earnExpitem>0?"exp":"normal")}.bind(this))},_setBottomLabel:function(){this.getNode().setStrings({get_jem_custom_point_label:this.createGetJemCustomePointLabel(),have_jem_custom_point_label:this.createHaveJemCustomPointLabel()}),this.getNode().setHtmlStrings({get_jem_custom_point_labelimg:this.createGetJemCustomPointLabelImg(),have_jem_custom_point_labelimg:this.createHaveJemCustomPointLabelImg(),get_exp_labelimg:this.createGetExpLabelImg()},t.GameConfig.POPUP_CSS)},_createConfirmLabel:function(e){return this._isIncludedMoreThanRare(e)?this.CONFIRM_MESSAGE_INCLUDE_RARE:this.CONFIRM_MESSAGE_NORMAL},createGetJemCustomPointLabelImg:function(){return this.LABEL_SIMPLE_BODY_TEMPLATE({color:"white",text:this._earnNum})},createHaveJemCustomPointLabelImg:function(){return this.LABEL_FLUCTUATE_BODY_TEMPLATE({before_text:this._hasNum,after_text:this._hasNum+this._earnNum,after_number_color:"yellow"})},createGetExpLabelImg:function(){return this.LABEL_SIMPLE_BODY_TEMPLATE({color:"white",text:this._earnExpitem})}})}((this||0).self||global),function(e){var t=(e.cc,e._,e.kh);t.createNameSpaceIfNotExists("list.popup"),t.list.popup.comSellSummons=t.core.item.comConsumptionCheckResult.extend({BUTTON_VISIBLE:{btn_enhance:!1,btn_sell:!0,btn_ok:!1,btn_cancel:!0},TITLE_LABEL:"",CONFIRM_MESSAGE_NORMAL:"\n",CONFIRM_MESSAGE_INCLUDE_RARE:"R\n",LABEL_ONE_LINE_TEMPLATE:'<div class="orange" style="width:8em"><%= title %></div><div><%= body_html %></div>',_earnNum:null,_hasNum:null,RESULT_TITLE_LABEL:"",RESULT_CONFIRM_MESSAGE:"",__initContents:function(e){this._hasNum=e.myGem,this._earnNum=e.earnGem,this._hasOrbAmount=e.myOrb,this._earnOrbAmount=e.earnOrb,this._earnExpitem=e.earnExpitem},_setBottomLabel:function(){this.getNode().setStrings({get_jem_custom_point_label:this.createGetJemCustomePointLabel(),have_jem_custom_point_label:this.createHaveJemCustomPointLabel()}),this.getNode().setHtmlStrings({get_jem_custom_point_labelimg:this.createGetJemCustomPointLabelImg(),have_jem_custom_point_labelimg:this.createHaveJemCustomPointLabelImg(),get_summon_orb_labelimg:this.createGetSummonOrbLabelImg(),have_summon_orb_labelimg:this.createHaveSummonOrbLabelImg(),get_exp_labelimg:this.createGetExpLabelImg()},t.GameConfig.POPUP_CSS)},_createConfirmLabel:function(e){return this._isIncludedMoreThanRare(e)?this.CONFIRM_MESSAGE_INCLUDE_RARE:this.CONFIRM_MESSAGE_NORMAL},_openAnimation:function(){return this._super().then(function(){this.getNode().setAppearance(this._earnExpitem>0?"exp":"normal")}.bind(this))},createGetJemCustomPointLabelImg:function(){return this.LABEL_SIMPLE_BODY_TEMPLATE({color:"white",text:this._earnNum})},createHaveJemCustomPointLabelImg:function(){return this.LABEL_FLUCTUATE_BODY_TEMPLATE({before_text:this._hasNum,after_text:this._hasNum+this._earnNum,after_number_color:"yellow"})},createGetSummonOrbLabelImg:function(){return this.LABEL_SIMPLE_BODY_TEMPLATE({color:"white",text:this._earnOrbAmount})},createHaveSummonOrbLabelImg:function(){return this.LABEL_FLUCTUATE_BODY_TEMPLATE({before_text:this._hasOrbAmount,after_text:this._hasOrbAmount+this._earnOrbAmount,after_number_color:"yellow"})},createGetExpLabelImg:function(){return this.LABEL_SIMPLE_BODY_TEMPLATE({color:"white",text:this._earnExpitem})}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.acce=n.acce||{},n.acce.model=n.acce.model||{},n.acce.model.CharacterAccessories=cc.Class.extend({_apiACharacters:null,_character:null,ctor:function(e){this._apiACharacters=n.createInstance("apiACharacters"),this._character=e},prepare:function(e){return this._apiACharacters.get(e).then(function(e){return this._setCharacter(e.body),this}.bind(this)).fail(function(e){console.error(e.stack)})},_setCharacter:function(e){this._character=e},getCharacter:function(){return new n.core.model.ACharacter(this._character)},getCharacterId:function(){return this._getPropertyOrDefault("character_id")},getACharacterId:function(){return this._getPropertyOrDefault("a_character_id")},getName:function(){return this._getPropertyOrDefault("name")},getRarityIconPath:function(){return"core/res/icon/rarityicon_"+this._getPropertyOrDefault("rare")+".png"},getRarityBarPath:function(){return"core/res/introduce/introduce_raritybar_"+this._getPropertyOrDefault("rare")+".png"},getIntroduceImgPath:function(){return n.Img("introduceimg","chara",t.padZero(this._character.character_id,4),this._character.skin||0).jpg},getBonus:function(){return this._getPropertyOrDefault("bonus")},getHp:function(){return this._getPropertyOrDefault("hp")},getAttack:function(){return this._getPropertyOrDefault("attack")},getTotalAccessoryHp:function(){return this._getPropertyOrDefault("total_accessory_hp")},getTotalAccessoryAttack:function(){return this._getPropertyOrDefault("total_accessory_attack")},getSkin:function(){return this._getPropertyOrDefault("skin")},isAccessorySlotEmpty:function(e){var n=this._character.accessories[e];return t.isUndefined(n)||null===n},isAccessorySlotLocked:function(e){return e>=this._character.max_accessory_equip_amount},unlockAccessorySlot:function(){return++this._character.max_accessory_equip_amount},getAccessoryByIndex:function(e){return t.isArray(this._character.accessories)?this._character.accessories[e]:null},setProtected:function(e,t){var n=this.getAccessoryByIndex(e);null!==n&&(n.is_locked=!0===t)},getAccessoryByAAccessoryId:function(e){var n=t.filter(this._character.accessories,function(t){return!!t&&t.a_accessory_id===e});return 0===n.length?null:n[0]},getAllEffects:function(){return this._getPropertyOrDefault("accessory_sub_effect_info",[])},_getPropertyOrDefault:function(e,n){return t.isUndefined(n)&&(n=null),!this._character||t.isUndefined(this._character[e])?n:this._character[e]},getAccessorySlotCount:function(){return this._character.accessories.length},confirmReleaseAccessoryByIndex:function(e){return this.confirmChangeAccessoryByIndex(e,null)},confirmChangeAccessoryByIndex:function(e,t){var n=this.getACharacterId();return this._apiACharacters.getConfirmChangeAccessory(n,e,t).then(function(e){return e.body}.bind(this)).fail(function(e){console.error(e.stack)})},releaseAccessoryByIndex:function(e){return this.changeAccessoryByIndex(e,null)},changeAccessoryByIndex:function(e,n){var i=this.getACharacterId();return this._apiACharacters.changeAccessory(i,e,n).then(function(n){return this._character&&t.isArray(this._character.accessories)&&(this._character.accessories[e]=null),n.body}.bind(this)).fail(function(e){e&&console.error(e)})},hasSeriesEffect:function(){return!0===this._getPropertyOrDefault("series_effect",{}).enabled},getSeriesEffectName:function(){return this._getPropertyOrDefault("series_effect",{}).name||""},getSeriesEffectDescription:function(){return this._getPropertyOrDefault("series_effect",{}).description||""}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.acce=n.acce||{},n.acce.model=n.acce.model||{},n.acce.enum=n.acce.enum||{},n.acce.enum.PARTY_STATUS={NOT_EQUIPPED:-1,SELF_PARTY:"self",OTHER_PARTY:"other",OUT_OF_PARTY:"out_of",UNKNOWN:"UNKNOWN"},n.acce.model.Accessory=n.core.pager.model.PlainData.extend({_apiAAccessories:null,_accessory:null,ctor:function(e){this._apiAAccessories=n.createInstance("apiAAccessories"),this._accessory=e,this._super.apply(this,arguments)},reload:function(){return this._getAAccessoryGetPromise(this._accessory.a_accessory_id).then(function(e){return this._accessory=e.body,this}.bind(this))},_getAAccessoryGetPromise:function(e){return this._apiAAccessories.get(e).fail(function(e){console.error(e.stack)})},getAAccessoryId:function(){return this._getPropertyOrDefault("a_accessory_id")},getAccessoryId:function(){return this._getPropertyOrDefault("accessory_id")},getRawAccessory:function(){return this._accessory},getName:function(){return this._getPropertyOrDefault("name")},getElementType:function(){return this._getPropertyOrDefault("element_type")},getRarityIconPath:function(){return"core/res/icon/rarityicon_"+this._getPropertyOrDefault("rare")+".png"},getLevel:function(){return this._getPropertyOrDefault("level")},getMaxLevel:function(){return this._getPropertyOrDefault("max_level")},isMaxLevel:function(){return this.getLevel()===this.getMaxLevel()},getExp:function(){return this._getPropertyOrDefault("exp")},getNextExp:function(){return this._getPropertyOrDefault("next_exp")},getSalePrice:function(){return this._getPropertyOrDefault("sale_price")},getHp:function(){return this._getPropertyOrDefault("hp")},getAttack:function(){return this._getPropertyOrDefault("attack")},isLocked:function(){return this._getPropertyOrDefault("is_locked",!1)},isEquipped:function(){return this._getPropertyOrDefault("is_equipped",!1)},getSubEffects:function(){return this._getPropertyOrDefault("sub_effects",[])},hasSubEffects:function(){return this.getSubEffects().length>0},getEquippedChara:function(){return"object"!=typeof this._accessory.equipped_character?(console.warn(""),new n.core.model.ACharacter({})):new n.core.model.ACharacter(this._getPropertyOrDefault("equipped_character",{}))},getEquippedPartyStatus:function(e){if(!this.isEquipped())return n.acce.enum.PARTY_STATUS.NOT_EQUIPPED;var i=(this._getPropertyOrDefault("equipped_character")||{}).a_party_ids;return t.isArray(i)?t.isEmpty(i)?n.acce.enum.PARTY_STATUS.OUT_OF_PARTY:t.contains(i,e)?n.acce.enum.PARTY_STATUS.SELF_PARTY:n.acce.enum.PARTY_STATUS.OTHER_PARTY:n.acce.enum.PARTY_STATUS.UNKNOWN},getRecommendMaterialIds:function(){var e=this.getAAccessoryId();return this._apiAAccessories.getRecommendEnhanceMaterials(e).then(function(e){return e.body}.bind(this)).fail(function(e){console.error(e.stack)})},confirmRecommendEnhance:function(e){return this.confirmEnhance(e)},confirmEnhance:function(e){var t=this.getAAccessoryId();return this._apiAAccessories.confirmEnhanceMaterials(t,e).then(function(e){return e.body}.bind(this)).fail(function(e){console.error(e.stack)})},enhance:function(e){var t=this.getAAccessoryId();return this._apiAAccessories.enhance(t,e).then(function(e){return e.body}.bind(this)).fail(function(e){console.error(e.stack)})},confirmSell:function(){var e=this.getAAccessoryId();return this._apiAAccessories.confirmSellPrice([e]).then(function(e){return e.body}.bind(this)).fail(function(e){console.error(e.stack)})},sell:function(){var e=this.getAAccessoryId();return this._apiAAccessories.sell([e]).then(function(e){return e.body}.bind(this)).fail(function(e){console.error(e.stack)})},openDetailPopup:function(e){var t=cc.director.getRunningScene(),i=this._getPropertyOrDefault("equipped_character"),a=null,o=null;return i&&(a=n.createInstance("characterAccessoriesModel",[i]),o=i.slot_num),n.ImplantedPopup.create(t,"acce_detail_protection_on_off","AcceDetailSwapPopup").open(this,a,o)},_getPropertyOrDefault:function(e,n){return t.isUndefined(n)&&(n=null),this._accessory?this._accessory[e]:n},equal:function(e){return e.className!==this.className?(console.warn("Model",e,this),!1):this.getAAccessoryId()===e.getAAccessoryId()}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.acce=t.acce||{},t.acce.model=t.acce.model||{},t.acce.model.AccessoryInfo=cc.Class.extend({_apiAPlayers:null,_playerMe:null,ctor:function(){this._apiAPlayers=t.createInstance("myselfInfoRepository")},prepare:function(){return this._getAPlayersGetMePromise().then(function(e){return this._playerMe=e.getPlainBody(),this}.bind(this))},_getAPlayersGetMePromise:function(){return this._apiAPlayers.getMe().fail(function(e){console.error(e)})},canBeUsed:function(){return Boolean(this._playerMe.can_use_accessory)},getMaxAccessoryAmount:function(){return this._playerMe.max_accessory_num},getAccessoryAmount:function(){return this._playerMe.accessory_num}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.acce=n.acce||{},n.acce.model=n.acce.model||{},n.acce.model.AccessoryPointInfo=cc.Class.extend({_playerCurrency:null,ctor:function(e){t.isUndefined(e)||(this._playerCurrency=e)},prepare:function(){return this._getAPlayersGetCurrecyPromise().then(function(e){return this._playerCurrency=e,this}.bind(this))},_getAPlayersGetCurrecyPromise:function(){return n.createInstance("myselfInfoRepository").getMyCurrency().catch(function(e){console.error(e)})},getAccessoryPoint:function(){return this._playerCurrency.getAccessoryPointAmount()},getAfterAccessoryPoint:function(e){return this.getAccessoryPoint()+e}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=(e.ccui,e._),a=e.console;t.createNameSpaceIfNotExists("core.model"),t.core.model.ACharacter=t.core.pager.model.PlainData.extend({className:"ACharacter",getAId:function(){return this._rawData.a_character_id},getMasterId:function(){return this._rawData.character_id},getExp:function(){return this._rawData.exp},getNextExp:function(){return this._rawData.next_exp},getLevel:function(){return this._rawData.level},getMaxLevel:function(){return this._rawData.max_level},openDetailPopup:function(e,i){var a=n.director.getRunningScene();return t.ImplantedPopup.createOrGet(a,"com_character_status").open(this.getAId(),e,i)},getGroupId:function(){return this._rawData.character_group_id},getHp:function(){return"number"==typeof this._rawData.base_hp?this._rawData.base_hp:this._rawData.hp},getAttackPoint:function(){return"number"==typeof this._rawData.base_attack?this._rawData.base_attack:this._rawData.attack},getElementType:function(){return this._rawData.element_type},canEquip:function(e){return e.getElementType()===this.getElementType()},getMaxAccessoryEquipCount:function(){return this._rawData.max_accessory_equip_amount},getAccessories:function(){return this._rawData.accessories?(t.acce&&t.acce.model&&t.acce.model.Accessory||a.error("[Must] kh.acce.model.Accessory not Loaded"),this._rawData.accessories.map(function(e){return null!=e?new t.acce.model.Accessory(e):null})):(a.warn(""),[])},equal:function(e){if(i.isUndefined(e))return!1;var t=e.getRawData().a_character_id;return i.isNumber(t)?this.getAId()===t:(a.warn("a_character_id"),!1)}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);e.Q,t.pc.acce=t.pc.acce||{},t.pc.acce.roles=t.pc.acce.roles||{},t.pc.acce.roles.Routing={};var i={_navigateTo006:function(e,n,i){var a=t.createInstance("router"),o=a.getCurrentFragment().replace(/^.*[\/]([^\/]+$)/,"$1");a.navigate("acce/detail/de_001",{de_001_002:{id:e,isOwn:!0,fromPartyPage:!1,equipedSelf:!1}},{de_001_002:{equipped_a_accessory_id:i,tab:"tab_2"},ignoreImplicitRoute:!0,navigateFrom:o})},_navigateToAccessoryShop:function(){var e={sh_102:{shop_id:5}};t.createInstance("router").navigate("shop/sh_102",e,{shop_id:5})},_verifyTemporaryRouterParams002:function(e){},_navigate002To006:function(e,n){t.createInstance("router").navigate("acce/detail/de_001",{de_001_002:{id:n.a_character_id,isOwn:!0,fromPartyPage:!1,equipedSelf:!1}},{de_001_002:{tab:"tab_2"},ignoreImplicitRoute:!0,navigateFrom:{routes:"acce/acce_002"}})},_verifyTemporaryRouterParams003:function(e){},_navigate003To008:function(e){t.createInstance("router").navigate("acce/acce_008",{},{acce_008:{a_accessory_id:e}})},_verifyTemporaryRouterParams006:function(e){n.isUndefined(e.temporaryRouterParams.acce_006)&&this._consoleErrorRouterParams("temporaryRouterParams.acce_006.a_character_id")},_navigate006To007:function(e,n,i,a){var o={acce_007:{a_character_id:n,num:i,a_accessory_id:a}};t.createInstance("router").navigate("acce/acce_007",{},o)},_navigate006To002:function(){t.createInstance("router").navigate("acce/acce_002")},_verifyTemporaryRouterParams007:function(e){n.isUndefined(e.temporaryRouterParams.acce_007)&&this._consoleErrorRouterParams("temporaryRouterParams.acce_007")},_navigate007To006:function(e,n,i,a){t.createInstance("router").navigate("acce/detail/de_001",{de_001_002:{id:e,isOwn:!0,fromPartyPage:!1,equipedSelf:!1}},{de_001_002:{equipped_a_accessory_id:a,tab:"tab_2"},ignoreImplicitRoute:!0,navigateFrom:i})},_verifyTemporaryRouterParams008:function(e){n.isUndefined(e.temporaryRouterParams.acce_008)&&this._consoleErrorRouterParams("temporaryRouterParams.acce_008")},_navigate008To003:function(){t.createInstance("router").navigate("acce/acce_003")},_navigate008To010:function(e,n,i,a){var o={acce_010:{accessory:n,result:i,materials:a}};t.createInstance("router").navigate("acce/acce_010",{},o)},_verifyTemporaryRouterParams010:function(e){n.isUndefined(e.temporaryRouterParams.acce_010)&&this._consoleErrorRouterParams("temporaryRouterParams.acce_010")},_navigateToAcce003:function(e){t.createInstance("router").navigate("acce/acce_003")},_navigate010To008:function(e){t.createInstance("router").navigate("acce/acce_008",{},{acce_008:{a_accessory_id:e}})},_navigateToBook001:function(){t.createInstance("router").navigate("book/book_001_accessory")},_navigateToDetail_001_2:function(e,n){t.createInstance("router").navigate("acce/detail/de_001",{de_001_002:{id:e}},{de_001_002:{tab:"tab_2"},navigateFrom:n})}};n.assign(t.pc.acce.roles.Routing,i,t.pc.roles.RoutingCommon)}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.acce=n.acce||{},n.acce.view=n.acce.view||{},n.acce.view.AcceDetailCommonPopup=n.ImplantedPopup.extend({_popups:{com_protect_on:{factoryName:"popupFactoryTextOnly",resource:"text_button_only.json",title:"",content:"<br><br>",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){this.dismiss(),cc.director.getRunningScene().refresh()}}},com_protect_off:{factoryName:"popupFactoryTextOnly",resource:"text_button_only.json",title:"",content:"<br><br>",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){this.dismiss(),cc.director.getRunningScene().refresh()}}}},UI_NODE_NAMES:{bgImg:"rarity_bg",img:"popup-intro",name:"name_label",category:"type_name_label",elementIcon:"element_icon",level:"level_now_label",maxLevel:"level_max_label",salePrice:"sale_price_label",expGaugeBase:"exp-gauge_base",expGauge:"exp-gauge",expNext:"exp_next_label",hp:"hp_no",attack:"attack_no",rarityBarBase:"acce_raritybar_ui",salePriceBase:"acce_sale_price_ui",subEffectsUI:"acce_detail_effect_page_ui",ACCE_UNIQUE_LABEL:"unique_effect_label",ACCE_HAS_NOT_UNIQUE_LABEL:"hyphen",btnProtectionUI:"acce_protection_btn_ui",btnProtectionOn:"btn_protection_on",btnProtectionOff:"btn_protection_off",labelSell:"acce_sell_label",labelProtected:"acce_protected_label",labelCanNotSell:"acce_can_not_sell_label",btnCancel:"btn_cancel",btnRelease:"btn_release",btnSell:"btn_sell"},ACTION_BTN_NODE_KEYS:["btnCancel","btnRelease","btnSell"],ACTION_LABEL_NODE_KEYS:["labelSell","labelProtected","labelCanNotSell"],MAX_SUB_EFFECT_COUNT:3,RARITY_LIST:["N","R","SR","SSR"],_uiNodes:{},_khAccessoryModel:null,_initContents:function(e){this._uiNodes=this._getUINodes(),this._khAccessoryModel=new n.acce.model.Accessory(e),this._clearContents(),this._setAccessoryInfo(e),this._setActionLabels(e),this._setActionBtns(e),this._adjustExpGaugeIfIsSp(),this._setCharacterCoreCard(this._khAccessoryModel.getEquippedChara())},_setAccessoryInfo:function(e){this._setRarity(e),this._setImg(e),this._setElementIcon(e),this._setExp(e),this._setSubEffects(e),this._setProtection(e),this._setTextNodes(e),this._setBrand(e)},_setActionLabels:function(e){console.log("please implement")},_setActionBtns:function(e){this._uiNodes.btnCancel.setVisible(!0),this.setButtonEvents({btn_cancel:function(){this._clearContents(),this.dismiss()}.bind(this)})},_clearContents:function(){this._setSalePriceVisible(null),this._clearAccessoryInfo(),this._clearActionLabels(),this._clearActionBtns()},_setBtnEnh:function(e){var t=e.level<e.max_level;n.pc.roles.UIUtility._setEnableButton(this._node.seekWidgetByName("btn_enh"),t),t&&n.setTouchEventHandlers(this._node,{"TOUCH_ENDED btn_enh":function(){this._navigate003To008(e.a_accessory_id)}},this)},_clearAccessoryInfo:function(){this._setAccessoryInfo(null)},_clearActionLabels:function(){t.each(this.ACTION_LABEL_NODE_KEYS,function(e){null!==this._uiNodes[e]&&this._uiNodes[e].setVisible(!1)}.bind(this))},_clearActionBtns:function(){t.each(this.ACTION_BTN_NODE_KEYS,function(e){null!==this._uiNodes[e]&&this._uiNodes[e].setVisible(!1)}.bind(this))},_setTextNodes:function(e){var i={name:e?e.name:"",level:e?e.level:"",maxLevel:e?"MAX:"+e.max_level:"",salePrice:e?e.sale_price+n.w("gem"):"",expNext:e?"NEXT:"+e.next_exp:"",hp:e?e.hp:"",attack:e?e.attack:"",category:e?e.category:""};t.each(i,function(e,t){this._uiNodes[t].setText(e)}.bind(this))},_setImg:function(e){var i=e?"../core/res/popup/popup_layer/acce_detail_rarity_bg_"+String(e.rare).toLowerCase()+".jpg":"";this._uiNodes.bgImg.loadTexture(i,ccui.Widget.LOCAL_TEXTURE);var a=e?n.Img("popup-intro","acce",t.padZero(e.accessory_id,4)).png:"";this._uiNodes.img.loadTexture(a)},_setElementIcon:function(e){if(this._uiNodes.elementIcon.setVisible(!0),e){var t="core/res/introduce/introduce_element_"+e.element_type+".png";this._uiNodes.elementIcon.loadTexture(t,ccui.Widget.PLIST_TEXTURE)}else this._uiNodes.elementIcon.loadTexture("")},_setExp:function(e){return null===e?void(this._uiNodes.expGauge.percent=0):void this._setExpGauge(this._uiNodes.expGaugeBase,e)},_setBrand:function(e){var t=e&&e.brand||null,n=this._getNodeByName(this.UI_NODE_NAMES.ACCE_UNIQUE_LABEL),i=this._getNodeByName(this.UI_NODE_NAMES.ACCE_HAS_NOT_UNIQUE_LABEL);n&&i&&(t&&n.setString(t),n.setVisible(t),i.setVisible(!t))},_adjustExpGaugeIfIsSp:function(){n.env.isSp&&(this._uiNodes.expGaugeBase.scale=1,this._uiNodes.expGaugeBase.anchorX=-.1,this._uiNodes.expGauge.anchorX=.05,this._uiNodes.expGauge.scaleX=1.21,this._uiNodes.expGauge.scaleY=1.12)},_setRarity:function(e){if(null!==e){var t="rarity_"+e.rare;this._uiNodes.rarityBarBase.setAppearance(t)}else this._uiNodes.rarityBarBase.setAppearance("rarity_N")},_setSubEffects:function(e){if(this._clearSubEffects(),e&&!t.isUndefined(e.sub_effects)){var n=[];t.each(this._uiNodes.subEffects,function(i,a){if(!t.isUndefined(e.sub_effects[a])){var o=e.sub_effects[a],r=o.description.slice(0,9),s=null===o.slot_number?"":"["+o.slot_number+"] ",c="+"+o.effect_rate+"%";this._uiNodes.subEffects[a].label.setText(s+r+c),n.push("effect_"+a)}}.bind(this)),0===e.sub_effects.length&&n.push("effect_off"),t.each(n,function(e){this._uiNodes.subEffectsUI.setAppearance(e)}.bind(this))}},_clearSubEffects:function(){t.each(this._uiNodes.subEffects,function(e,t){e.label.setText("")}.bind(this))},_setProtection:function(e){this._uiNodes.btnProtectionUI.setVisible(!0),this._uiNodes.btnProtectionOff.setVisible(!1),this._uiNodes.btnProtectionOn.setVisible(!1),this._uiNodes.labelProtected.setVisible(!1),e&&(e.is_locked?(this._uiNodes.btnProtectionOff.setVisible(!0),this._uiNodes.btnProtectionUI.animate("protected_off"),this._uiNodes.btnProtectionOff.addTouchEventListener(function(t,n){n===ccui.Widget.TOUCH_ENDED&&this._changeProtectionOff(e)}.bind(this))):(this._uiNodes.btnProtectionOn.setVisible(!0),this._uiNodes.btnProtectionUI.animate("protected_on"),this._uiNodes.btnProtectionOn.addTouchEventListener(function(t,n){n===ccui.Widget.TOUCH_ENDED&&this._changeProtectionOn(e)}.bind(this))))},_setSalePriceVisible:function(e){var n=null!==e,i=this._uiNodes.salePriceBase.getChildren();t.each(i,function(e){e.setVisible(n)})},_changeProtectionOn:function(e){return this._getAAccessoriesLockPromise(e.a_accessory_id).then(function(e){var t=e.body,n=cc.director.getRunningScene().popups.com_protect_on;return this.dismiss(),n.open().fail(function(e){console.error(e.stack)}),t}.bind(this))},_getAAccessoriesLockPromise:function(e){return n.createInstance("apiAAccessories").lock(e).fail(function(e){console.error(e.stack)})},_changeProtectionOff:function(e){return this._getAAccessoriesUnlockPromise(e.a_accessory_id).then(function(e){var t=e.body,n=cc.director.getRunningScene().popups.com_protect_off;return this.dismiss(),n.open().fail(function(e){console.error(e.stack)}),t}.bind(this))},_getAAccessoriesUnlockPromise:function(e){return n.createInstance("apiAAccessories").unlock(e).fail(function(e){console.error(e.stack)})},_getUINodes:function(){var e=t.mapValues(this.UI_NODE_NAMES,function(e){return this._getNodeByName(e)}.bind(this)),n={};t.each(this.RARITY_LIST,function(e){var t="rarity_"+e+"_base";n[e]=this._getNodeByName(t)}.bind(this)),e.rarityBars=n;var i=t.map(t.range(0,this.MAX_SUB_EFFECT_COUNT),function(e){var t="acce_detail_effect_list_ui_"+e,n=this._getNodeByName(t);return{base:n,label:this._getNodeByName("acce_effect_label",n)}}.bind(this));return e.subEffects=i,e},_setCharacterCoreCard:function(e){var t=this._node.seekWidgetByName("corecard_chara_ui");if(t){if(!(e instanceof n.core.model.ACharacter)||null==e.getAId())return void t.setVisible(!1);var i=n.createInstance("CoreCardCharacterUI",["e_r",t]);i.setData(e.getRawData()),i.setPlusNoVisible(!1),i.setIconEquipped(!0),i.setVisible(!0),t.getParent().setVisible(!0)}},_getNodeByName:function(e,n){t.isUndefined(n)&&(n=this._node);var i=n.seekWidgetByName(e);return i||console.warn("AcceDetailCommonPopup._getByNode(): node '"+e+"' not found"),i}}),t.assign(n.acce.view.AcceDetailCommonPopup.prototype,n.pc.acce.roles.Routing,n.pc.roles.GaugesCommon)}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.acce=t.acce||{},t.acce.view=t.acce.view||{},t.acce.view.AcceDetailSwapPopup=t.acce.view.AcceDetailCommonPopup.extend({_accessoryModel:null,_khCharacterAccessoriesModel:null,_slotNum:null,_initContents:function(e,n,i,a){this._khCharacterAccessoriesModel=n,this._slotNum=i,this._accessoryModel=e,e instanceof t.acce.model.Accessory||(this._accessoryModel=new t.acce.model.Accessory(e)),this._setBtnEnh(this._accessoryModel.getRawData()),this._super(this._accessoryModel.getRawData()),a&&(this._dismissAnimationName="com_character_status",this._closeAnimationEndHandler=function(){this._uiNode.setVisible(!0)})},_setActionLabels:function(e){this._setAppearanceAcceRelease()},_setAppearanceAcceRelease:function(){this._node.setAppearance("acce_release")},_setActionBtns:function(e){this._super(e),this._uiNodes.btnCancel.setVisible(!0);var n=this._uiNodes.btnRelease;n.setVisible(!0),t.pc.roles.UIUtility._setEnableButton(n,!1),e&&this._accessoryModel.isEquipped()&&(t.pc.roles.UIUtility._setEnableButton(n,!0),n.addTouchEventListener(function(e,t){t===ccui.Widget.TOUCH_ENDED&&this._releaseAccessory()}.bind(this)))},_releaseAccessory:function(){return this._khCharacterAccessoriesModel.releaseAccessoryByIndex(this._slotNum).then(function(e){this._dfd.resolve(this._slotNum),this.dismiss(!0)}.bind(this)).fail(function(e){console.error(e.stack)})},_getAAccessoriesUnlockPromise:function(){this._khCharacterAccessoriesModel.setProtected(this._slotNum,!1);var e=this._super.apply(this,arguments);return e.done(this._dfd.resolve.bind(this._dfd,this._slotNum)),e},_getAAccessoriesLockPromise:function(){this._khCharacterAccessoriesModel.setProtected(this._slotNum,!0);var e=this._super.apply(this,arguments);return e.done(this._dfd.resolve.bind(this._dfd,this._slotNum)),e},dismiss:function(){this._super.apply(this,arguments),this._dismissAnimationName=null,delete this._closeAnimationEndHandler}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.acce=t.acce||{},t.acce.view=t.acce.view||{},t.acce.view.AcceOthersDetailPopup=t.acce.view.AcceDetailCommonPopup.extend({_khCharacterAccessoriesModel:null,_slotNum:null,_initContents:function(e,t,n,i){this._khCharacterAccessoriesModel=t,this._slotNum=n,this._super(e),this._setCharacterCoreCard(t.getCharacter()),i&&(this._dismissAnimationName="com_character_status",this._closeAnimationEndHandler=function(){this._uiNode.setVisible(!0)})},dismiss:function(){this._super.apply(this,arguments),this._dismissAnimationName=null,delete this._closeAnimationEndHandler},_setActionLabels:function(e){this._node.setAppearance("acce_other")},_setProtection:function(e){this._uiNodes.btnProtectionOff.setVisible(!1),this._uiNodes.btnProtectionOn.setVisible(!1),this._uiNodes.labelProtected.setVisible(!1)}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.acce=n.acce||{},n.acce.view=n.acce.view||{},n.acce.view.AcceReleaseCheckPopup=n.ImplantedPopup.extend({UI_NODE_NAMES:{title:"title_label",description:"release_check_fixed_label",needCost:"need_cost_label",playerJem:"possession_count_labelimg",btnOk:"btn_ok",btnCancel:"btn_cancel"},_uiNodes:{},_equipResult:null,_khCharacterAccessoriesModel:null,_slotNum:null,_accessory:null,_initContents:function(e,t,n,i){this._equipResult=e,this._khCharacterAccessoriesModel=t,this._slotNum=n,this._accessory=i,this._uiNodes=this._getUINodes(),this._clearContents(),this._setTextNodes(e),this._setBtns(e)},_setTextNodes:function(e){var n={title:"",description:"",needCost:null!==e.need_gem?e.need_gem+"":""};t.each(n,function(e,t){this._uiNodes[t].setText(e)}.bind(this));var i="";null!==e.before_gem&&null!==e.after_gem&&(i='<div class="comSellNumbox"><span class="white">'+e.before_gem+'  </span><span class="yellow">'+e.after_gem+"</span></div>"),this._setPlayerJemHtml(i)},_setPlayerJemHtml:function(e){var t={};t[this.UI_NODE_NAMES.playerJem]=e,console.log(t),this._node.setHtmlStrings(t,n.GameConfig.POPUP_CSS)},_setBtns:function(e){var t=this._uiNodes.btnOk;return this._uiNodes.btnCancel.addTouchEventListener(function(e,t){t===ccui.Widget.TOUCH_ENDED&&this.dismiss()}.bind(this)),e.error_info?(t.setEnabled(!1),void t.setColor(cc.color("#808080"))):(t.setEnabled(!0),t.setColor(cc.color("#FFFFFF")),void t.addTouchEventListener(function(e,t){t===ccui.Widget.TOUCH_ENDED&&this._changeAccessory()}.bind(this)))},_clearContents:function(){this._clearTextNodes(),this._clearBtns()},_clearTextNodes:function(){t.each({title:"",description:"",needCost:""},function(e,t){this._uiNodes[t].setText(e)}.bind(this)),this._uiNodes.playerJem.loadTexture("")},_clearBtns:function(){this._uiNodes.btnOk.setEnabled(!0),this._uiNodes.btnOk.setColor(cc.color("#FFFFFF"))},_changeAccessory:function(){var e=this._accessory?this._accessory.a_accessory_id:null;return this._khCharacterAccessoriesModel.changeAccessoryByIndex(this._slotNum,e).then(function(t){this.dismiss();var n=this._khCharacterAccessoriesModel.getACharacterId();this._navigateTo006(n,this._slotNum,e)}.bind(this)).fail(function(e){console.error(e.stack)})},_getUINodes:function(){return t.mapValues(this.UI_NODE_NAMES,function(e){return this._getNodeByName(e)}.bind(this))},_getNodeByName:function(e,n){(t.isUndefined(n)||null===n)&&(n=this._node);var i=n.seekWidgetByName(e);return i||console.warn("AcceReleaseCheckPopup._getByNode(): node '"+e+"' not found"),i}}),t.assign(n.acce.view.AcceReleaseCheckPopup.prototype,n.pc.acce.roles.Routing)}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.acce=n.acce||{},n.acce.view=n.acce.view||{},n.acce.view.AcceInfoPopup=n.ImplantedPopup.extend({UI_NODE_NAMES:{title:"title_label",description:"fixed_label",btnOk:"btn_ok"},MAX_EFFECT_COUNT:15,_uiNodes:{},_khCharacterAccessoriesModel:null,_initContents:function(e,t){this._khCharacterAccessoriesModel=e,this._uiNodes=this._getUINodes(),this._clearContents(),this._setTextNodes(),this._setEffects(),this._setBtns(),t&&(this._dismissAnimationName="com_character_status",this._closeAnimationEndHandler=function(){this._uiNode.setVisible(!0)})},_setTextNodes:function(){t.each({title:"",description:""},function(e,t){this._uiNodes[t].setText(e)}.bind(this))},_setEffects:function(){var e=this._khCharacterAccessoriesModel.getAllEffects();t.each(this._uiNodes.effects,function(i,a){if(t.isUndefined(e[a]))return i.base.setVisible(!1),i.label.setText(""),void i.statusIcon.loadTexture("");var o=e[a];i.base.setVisible(!0);var r=o.name+"+"+o.effect_rate+"";i.label.setText(r);var s=n.Img("coreimg","statusicon",t.padZero(o.icon_type,4)).png;i.statusIcon.loadTexture(s)}.bind(this))},_setBtns:function(){this._uiNodes.btnOk.addTouchEventListener(function(e,t){t===ccui.Widget.TOUCH_ENDED&&(this._clearContents(),this.dismiss(!0))}.bind(this))},_clearContents:function(){this._uiNodes.title.setText(""),this._clearEffects()},_clearTextNodes:function(){t.each({title:"",description:""},function(e,t){this._uiNodes[t].setText(e)}.bind(this))},_clearEffects:function(){t.each(this._uiNodes.effects,function(e,t){e.base.setVisible(!1),e.label.setText(""),e.statusIcon.loadTexture("")})},_getUINodes:function(){var e=t.mapValues(this.UI_NODE_NAMES,function(e){return this._getNodeByName(e)}.bind(this));return e.effects=t.map(t.range(this.MAX_EFFECT_COUNT),function(e){var t="acce_info_effect_ui_"+e,n=this._getNodeByName(t);return{base:n,label:this._getNodeByName("acce_effect_label",n),statusIcon:this._getNodeByName("coreimg_statusicon",n)}}.bind(this)),e},_getNodeByName:function(e,n){(t.isUndefined(n)||null===n)&&(n=this._node);var i=n.seekWidgetByName(e);return i||console.warn("AcceInfoPopup._getByNode(): node '"+e+"' not found"),i},dismiss:function(){this._super.apply(this,arguments),this._dismissAnimationName=null,delete this._closeAnimationEndHandler}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.createNameSpaceIfNotExists("acce.view"),t.acce.view.AcceSeriesHintPopup=t.ImplantedPopup.extend({_initContents:function(e){this.setButtonEvents({btn_ok:!0}),e&&(this._dismissAnimationName="com_character_status",this._closeAnimationEndHandler=function(){this._uiNode.setVisible(!0)})},dismiss:function(){this._super.apply(this,arguments),this._dismissAnimationName=null,delete this._closeAnimationEndHandler}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.acce=n.acce||{},n.acce.view=n.acce.view||{},n.acce.view.AcceSetPopup=n.ImplantedPopup.extend({UI_NODE_NAMES:{title:"title_label",acceName:"acce_name_label",btnOk:"btn_ok"},_uiNodes:{},_initContents:function(e){this._uiNodes=this._getUINodes(),this._clearContents(),this._setTextNodes(e),this._setBtns()},_setTextNodes:function(e){var n={title:"",acceName:e.name};t.each(n,function(e,t){this._uiNodes[t].setText(e)}.bind(this))},_setBtns:function(){this._uiNodes.btnOk.addTouchEventListener(function(e,t){t===ccui.Widget.TOUCH_ENDED&&this.dismiss()}.bind(this))},_clearContents:function(){t.each({title:"",acceName:""},function(e,t){this._uiNodes[t].setText(e)}.bind(this))},_getUINodes:function(){return t.mapValues(this.UI_NODE_NAMES,function(e){return this._getNodeByName(e)}.bind(this))},_getNodeByName:function(e,n){(t.isUndefined(n)||null===n)&&(n=this._node);var i=n.seekWidgetByName(e);return i||console.warn("AcceSetPopup._getByNode(): node '"+e+"' not found"),i}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.book=t.book||{},t.book.view=t.book.view||{},t.book.view.CanNotUseAccessoryPopup=t.ImplantedPopup.extend({_initContents:function(){}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e.ccs,a=e._;t.PulldownSortConfig=n.Class.extend({className:"KHPulldownSortConfig",init:function(e,n){return a.isUndefined(e.sortKey)?(console.error("sortSet.sortKey is undefined. KHPulldownSortConfig initialize error."),Q.resolve()):(a.isUndefined(e.parentNodeName)||(this._parentNodeName=e.parentNodeName),this._sortKey=e.sortKey,this._sortValue=e.sortValue||"attack_asc",this._sortButton=e.sortButton||"par_009_13_15_sort",this._sortLabel=e.sortLabel||"par_009_13_15_sort_label",this._sortMenuBase=e.sortMenuBase||"list_par_009_13_15_sort",this._sortChoice=e.sortChoice||"party-par_009_13_15-par_009_13_15_sort_list_ui",this._changeEventName=e.changeEventName||"pulldown_sort_config",a.isObject(n)?(this._sortConfig=n,this._sortValue=n[this._sortKey],this._initPulldown(),Q.resolve({sortValue:this._sortValue,sortConfig:this._sortConfig,pulldownSortConfig:this})):t.createInstance("apiAPlayers").getSortConfig().then(function(e){return this._sortConfig=e.body.sort_config,this._sortValue=this._sortConfig[this._sortKey],this._initPulldown(),{sortValue:this._sortValue,sortConfig:this._sortConfig,pulldownSortConfig:this}}.bind(this)))},getSortConfig:function(){return this._sortConfig},getSortValue:function(){return this._sortValue},getChangeEventName:function(){return this._changeEventName},_initPulldown:function(){var e=JSON.parse(JSON.stringify(t.WordBook.SORT_CONDITION));if(this._sortKey.indexOf("weapon")>=0||"enhance_character_materials"===this._sortKey){var o=JSON.parse(JSON.stringify(t.WordBook.SORT_WEAPON_CONDITION));Array.prototype.push.apply(e,o)}(this._sortKey.indexOf("accessory")>=0||this._sortKey.indexOf("accessories")>=0)&&(e=a.reject(e,function(e){return"overlimit"===e.value.substr(0,9)})).push({value:"acce_series",text:""}),"pick_accessories"===this._sortKey&&e.push({value:"acce_equipped",text:""},{value:"acce_not_equipped",text:""}),"evolve_base_characters"===this._sortKey&&e.push({value:"aroused",text:""}),"arousal_base_characters"===this._sortKey&&(e=a.reject(e,function(e){return"overlimit"===e.value.substr(0,9)})),/(?=\w)episode_/.test(this._sortKey)&&(e=a.cloneDeep(t.WordBook.SORT_EPI_CONDITION)),e[0].selected=!1;var r=a.findIndex(e,function(e){return e.value==this._sortValue},this);a.assign(e[r],{selected:!0});var s=n.director.getRunningScene();if(a.isString(this._parentNodeName)){if(null===(s=s.seekWidgetByPath(this._parentNodeName)))return void console.error("[ERROR] Could not find the node: "+this._parentNodeName)}else this._parentNodeName instanceof n.Node&&(s=this._parentNodeName);new t.Pulldown({button:s.seekWidgetByName(this._sortButton),label:s.seekWidgetByName(this._sortLabel),menuBase:s.seekWidgetByName(this._sortMenuBase),choice:i.load($dynamicRes(res[this._sortChoice])).node},e).onChange(function(e){var n={};n[this._sortKey]=e.value,t.createInstance("apiAPlayers").updateSortConfig(n).then(function(n){this._sortConfig=n.body.sort_config,t.createInstance("notificationCenter").dispatchEvent(this._changeEventName,[e.value])}.bind(this))}.bind(this))}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.acce=t.acce||{},t.acce.view=t.acce.view||{},t.acce.view.AcceDetailSellPopup=t.acce.view.AcceDetailCommonPopup.extend({_initContents:function(e){this._super(e),this._setSalePriceVisible(e),this._setBtnEnh(e)},_setActionLabels:function(e){var t=this._uiNodes.labelSell,n=this._uiNodes.labelProtected;if(t.setVisible(!1),e){if(e.is_locked)return n.setVisible(!0),this._node.animate("acce_protected"),void n.setText("");if(e.is_equipped)return n.setVisible(!0),this._node.animate("acce_protected"),void n.setText("");t.setVisible(!0),this._setAppearanceAcceSell()}},_setAppearanceAcceSell:function(){this._node.setAppearance("acce_sell")},_setActionBtns:function(e){this._super(e);var t=this._uiNodes.btnSell;e?(t.setVisible(!0),!e.is_locked&&!e.is_equipped?(t.setEnabled(!0),t.setColor(cc.color("#FFFFFF")),t.addTouchEventListener(function(e,t){t===ccui.Widget.TOUCH_ENDED&&this._confirmSell()}.bind(this))):(t.setEnabled(!1),t.setColor(cc.color("#808080")))):t.setVisible(!1)},_confirmSell:function(){this._khAccessoryModel.confirmSell().then(function(e){this._openAcceSellCheckPopup(e)}.bind(this))},_openAcceSellCheckPopup:function(e){var n=t.createInstance("myselfInfoRepository").getMyCurrency().then(function(n){var i=n,a=cc.director.getRunningScene();return t.ImplantedPopup.createOrGet(a,"acce_sell_check","AcceSellCheckPopup").open(e,this._khAccessoryModel,i)}.bind(this)).catch(function(e){e&&e.stack&&console.error(e)});return this.dismiss(!0),n}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.acce=n.acce||{},n.acce.view=n.acce.view||{},n.acce.view.AcceSellCheckPopup=n.ImplantedPopup.extend({UI_NODE_NAMES:{title:"title_label",desc:"sell_check_label",descPointOver:"sell_point_over_label",salePrice:"get_jem_labelimg",playerJem:"have_jem_labelimg",getAccePoint:"get_acce_point_labelimg",playerAccePoint:"have_acce_point_labelimg",playerExpitem:"get_exp_labelimg",btnSell:"btn_sell",btnCancel:"btn_cancel"},APPEARANCE:{sell_check_exp:"sell_check_exp",sell_point_over_exp:"sell_point_over_exp",sell_check:"sell_check",sell_point_over:"sell_point_over"},_uiNodes:{},_sellConfirmResult:null,_playerCurrency:null,_khAccessoryModel:null,_khAccessoryPointInfoModel:null,_initContents:function(e,t,i){this._sellConfirmResult=e,this._khAccessoryModel=t,this._playerCurrency=i,this._khAccessoryPointInfoModel=new n.acce.model.AccessoryPointInfo(i),this._uiNodes=this._getUINodes(),this._clearContents(),this._setDescription(),this._setCostInfo(),this._setBtns(),this._setAppearance()},_openAnimation:function(){return this._super().then(this._setAppearance.bind(this))},_setAppearance:function(){var e=this._node;return this._sellConfirmResult.total_sell_sphere>0?void e.setAppearance(this.APPEARANCE.sell_check_exp):void e.setAppearance(this.APPEARANCE.sell_check)},_setDescription:function(){this._uiNodes.desc.setText("\n")},_setCostInfo:function(){var e=this._playerCurrency.getGemAmount(),t=this._khAccessoryPointInfoModel.getAccessoryPoint(),i='<div class="comSellNumbox"><span class="white">'+e+'&ensp;  </span><span class="yellow">'+(e+this._sellConfirmResult.total_sell_price)+"</span></div>",a='<div class="comSellNumbox"><span class="white">'+t+'&ensp;  </span><span class="yellow">'+this._khAccessoryPointInfoModel.getAfterAccessoryPoint(this._sellConfirmResult.total_accessory_point)+"</span></div>",o='<div class="comSellNumbox"><span class="white">'+this._sellConfirmResult.total_sell_price+"&ensp;</span></div>",r='<div class="comSellNumbox"><span class="white">'+this._sellConfirmResult.total_sell_sphere+"</span></div>",s='<div class="comSellNumbox"><span class="white">'+this._sellConfirmResult.total_accessory_point+"P</span></div>",c={};c[this.UI_NODE_NAMES.playerJem]=i,c[this.UI_NODE_NAMES.playerAccePoint]=a,c[this.UI_NODE_NAMES.salePrice]=o,c[this.UI_NODE_NAMES.playerExpitem]=r,c[this.UI_NODE_NAMES.getAccePoint]=s,this._node.setHtmlStrings(c,n.GameConfig.POPUP_CSS)},_setBtns:function(){var e=this._uiNodes.btnSell;this._uiNodes.btnCancel.addTouchEventListener(function(e,t){t===ccui.Widget.TOUCH_ENDED&&this.dismiss()}.bind(this)),e.addTouchEventListener(function(e,t){t===ccui.Widget.TOUCH_ENDED&&this._sellAccessory()}.bind(this))},_clearContents:function(){this._clearDescription(),this._clearCostInfo()},_clearDescription:function(){this._uiNodes.desc.setText(""),this._uiNodes.descPointOver.setText("")},_clearCostInfo:function(){this._uiNodes.playerJem.loadTexture(""),this._uiNodes.playerAccePoint.loadTexture("")},_sellAccessory:function(){var e=this._khAccessoryModel.sell().then(function(e){n.createInstance("myselfInfoRepository").allCacheClear(),this._openAcceSellResultPopup(e)}.bind(this));return this.dismiss(),e},_getUINodes:function(){return t.mapValues(this.UI_NODE_NAMES,function(e){return this._getNodeByName(e)}.bind(this))},_getNodeByName:function(e,n){(t.isUndefined(n)||null===n)&&(n=this._node);var i=n.seekWidgetByName(e);return i||console.warn("AcceSellCheckPopup._getNodeByName(): node '"+e+"' not found"),i},_openAcceSellResultPopup:function(e){var t=cc.director.getRunningScene();n.ImplantedPopup.createOrGet(t,"acce_sell_result","AcceSellResultPopup").open(e,this._khAccessoryModel,this._playerCurrency)}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.acce=n.acce||{},n.acce.view=n.acce.view||{},n.acce.view.AcceSellResultPopup=n.ImplantedPopup.extend({UI_NODE_NAMES:{salePrice:"get_jem_labelimg",playerJem:"have_jem_labelimg",getAccePoint:"get_acce_point_labelimg",playerAccePoint:"have_acce_point_labelimg",playerExpitem:"get_exp_labelimg",btnOk:"btn_ok",desc:"sell_result_label"},_uiNodes:{},_sellResult:null,_playerCurrency:null,_khAccessory:null,_khAccessoryPointInfoModel:null,_initContents:function(e,t,i){this._sellResult=e,this._khAccessory=t,this._playerCurrency=i,this._khAccessoryPointInfoModel=new n.acce.model.AccessoryPointInfo(i),this._uiNodes=this._getUINodes(),this._clearContents(),this._setDescription(),this._setCostInfo(),this._setBtns()},_setDescription:function(){this._uiNodes.desc.setText("")},_setCostInfo:function(){var e="normal",t=this._sellResult,i=this._playerCurrency.getGemAmount(),a=this._khAccessoryPointInfoModel.getAccessoryPoint(),o='<div class="comSellNumbox"><span class="white">'+i+'&emsp;&ensp;</span><span class="yellow">'+(i+t.total_sell_price)+"</span></div>",r='<div class="comSellNumbox"><span class="white">'+a+'&emsp;&ensp;</span><span class="yellow">'+this._khAccessoryPointInfoModel.getAfterAccessoryPoint(t.total_accessory_point)+"</span></div>",s='<div class="comSellNumbox"><span class="white">'+t.total_sell_price+"&ensp;</span></div>",c='<div class="comSellNumbox"><span class="white">'+t.total_sell_sphere+"</span></div>",u='<div class="comSellNumbox"><span class="white">'+t.total_accessory_point+"P</span></div>",l={};l[this.UI_NODE_NAMES.playerJem]=o,l[this.UI_NODE_NAMES.playerAccePoint]=r,l[this.UI_NODE_NAMES.salePrice]=s,l[this.UI_NODE_NAMES.getAccePoint]=u,t.total_sell_sphere>0&&(e="exp",l[this.UI_NODE_NAMES.playerExpitem]=c),this._node.setHtmlStrings(l,n.GameConfig.POPUP_CSS),this.getNode().setAppearance(e)},_setBtns:function(){this._uiNodes.btnOk.addTouchEventListener(function(e,t){t===ccui.Widget.TOUCH_ENDED&&(this._setAppearanceAcceSellResult(),this.dismiss(),cc.director.getRunningScene().refresh())},this)},_setAppearanceAcceSellResult:function(){this._node.setAppearance("acce_sell_result")},_clearContents:function(){this._clearDescription(),this._clearCostInfo()},_clearDescription:function(){this._uiNodes.desc.setText("")},_clearCostInfo:function(){this._uiNodes.salePrice.loadTexture(),this._uiNodes.getAccePoint.loadTexture(),this._uiNodes.playerJem.loadTexture(),this._uiNodes.playerAccePoint.loadTexture(),this._uiNodes.playerExpitem.loadTexture()},_getUINodes:function(){return t.mapValues(this.UI_NODE_NAMES,function(e){return this._getNodeByName(e)}.bind(this))},_getNodeByName:function(e,n){(t.isUndefined(n)||null===n)&&(n=this._node);var i=n.seekWidgetByName(e);return i||console.warn("AcceSellResultPopup._getNodeByName(): node '"+e+"' not found"),i}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e._,t.createNameSpaceIfNotExists("book.settings"),t.book.settings.CharacterPageSettings=n.Class.extend({className:"CharacterPageSettings",pageList:{baseName:"tab_0_node",panelName:t.BtnsPageListParams.BOOK_001_LIST.panelName,panelsPerPage:t.BtnsPageListParams.BOOK_001_LIST.perPage,apiName:"apiACharacters",apiMethod:"getList",apiParams:[t.displayFilter.enums.FILTER_NAME.BOOK_CHARA,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE],cardType:"chara",cardFrame:"full",sortKey:"list_characters",sortEvent:"pulldown_list_chara"},cardTouchHandlerName:"CharacterTouchEventHandler",buttonRoutes:{btn_enh:"enh_evo/enh_002",btn_evo:"enh_evo/evo_002",btn_arousal:"enh_evo/arousal_001"},toAmountLabelText:function(e){return""+e.character_num}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e._,t.createNameSpaceIfNotExists("book.settings"),t.book.settings.WeaponPageSettings=n.Class.extend({className:"WeaponPageSettings",pageList:{baseName:"tab_1_node",panelName:t.BtnsPageListParams.BOOK_001_LIST.panelName,panelsPerPage:t.BtnsPageListParams.BOOK_001_LIST.perPage,apiName:"apiAWeapons",apiMethod:"getList",apiParams:[t.displayFilter.enums.FILTER_NAME.BOOK_WEAPON,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE],cardType:"weapon",cardFrame:"full",sortKey:"list_weapons",sortEvent:"pulldown_list_weapon"},cardTouchHandlerName:"WeaponTouchEventHandler",buttonRoutes:{btn_enh:"enh_evo/enh_001",btn_evo:"enh_evo/evo_001",btn_allsell:["list/li_007",{li_007_008:{direction:"tab_0"}}]},toAmountLabelText:function(e){return""+e.weapon_num+"/"+e.max_weapon_num}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e._,t.createNameSpaceIfNotExists("book.settings"),t.book.settings.SummonPageSettings=n.Class.extend({className:"SummonPageSettings",pageList:{baseName:"tab_2_node",panelName:t.BtnsPageListParams.BOOK_001_LIST.panelName,panelsPerPage:t.BtnsPageListParams.BOOK_001_LIST.perPage,apiName:"apiASummons",apiMethod:"getList",apiParams:[t.displayFilter.enums.FILTER_NAME.BOOK_SUMMON,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE],cardType:"summon",cardFrame:"full",sortKey:"list_summons",sortEvent:"pulldown_list_summon"},cardTouchHandlerName:"SummonTouchEventHandler",buttonRoutes:{btn_enh:"enh_evo/enh_006",btn_evo:"enh_evo/evo_003",btn_allsell:["list/li_007",{li_007_008:{direction:"tab_1"}}]},toAmountLabelText:function(e){return""+e.summon_num+"/"+e.max_summon_num}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e._,t.createNameSpaceIfNotExists("book.settings"),t.book.settings.AccessoryPageSettings=n.Class.extend({className:"AccessoryPageSettings",pageList:{baseName:"tab_3_node",panelName:t.BtnsPageListParams.BOOK_001_LIST.panelName,panelsPerPage:t.BtnsPageListParams.BOOK_001_LIST.perPage,apiName:"apiAAccessories",apiMethod:"getList",apiParams:[t.displayFilter.enums.FILTER_NAME.BOOK_ACCESSORY,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE],cardType:"acce",cardFrame:"full",sortKey:"list_accessories",sortEvent:"pulldown_list_accessory"},cardTouchHandlerName:"AccessoryTouchEventHandler",buttonRoutes:{btn_enh:"acce/acce_003",btn_equip:"acce/acce_002",btn_allsell:"acce/acce_005"},toAmountLabelText:function(e){return""+e.accessory_num+"/"+e.max_accessory_num}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("book.controller"),t.book.controller.TabPageController=n.Class.extend({className:"TabPageController",ctor:function(e){this._delegateIndex=e||0},initializeAcceTab:function(e){var n=t.createInstance("accessoryInfoModel");n.prepare().then(function(){var t=!n.canBeUsed(),i=e.seekWidgetByName("btn_disabled");null!==i&&(i.setVisible(t),i.setEnabled(t))}.bind(this))},update:function(e){e=e||n.director.getRunningScene();var t=this._currentTabName(e);_.each(_.range(4),function(n){var i="tab_"+n,a=e.seekWidgetByName(i+"_node");_.isUndefined(a)||a.setVisible(i===t)})},getCurrentPageName:function(e){return e=e||n.director.getRunningScene(),this._currentTabName(e)+"_node"},_currentTabName:function(e){return e.tabDelegateList[this._delegateIndex].selected}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("book.controller"),t.book.controller.InventoryPageListController=n.Class.extend({className:"InventoryPageListController",_sortArgsOrg:{sortValue:"attack_desc",sortButton:"btn_sort",sortLabel:"sort_label",sortMenuBase:"sortlist",sortChoice:"core-pages-sort_list_0_ui",parentNodeName:"",changeEventName:""},ctor:function(e){this._listArgs=e.pageList,this._sortArgs=_.cloneDeep(this._sortArgsOrg),this._sortArgs.sortKey=this._listArgs.sortKey,this._sortArgs.changeEventName=this._listArgs.sortEvent,this._sortArgs.parentNodeName=this._listArgs.baseName,this._touchHandlerName=e.cardTouchHandlerName},showContents:function(e){if(!this._isShowing){this._isShowing=!0;var n=this._listArgs,i=e.seekWidgetByName(n.baseName),a=i.seekWidgetByName(n.panelName),o=this._getOrCreateApiListModel(),r=new t.core.pager.view.page.CoreCardUi(a,khutil.getCoreCardDINameByKind(n.cardType),{actionName:n.cardFrame,touchHandler:this._touchHandlerName}),s=new t.core.pager.controller.PagerController(i,o,[r],a),c=i.seekWidgetByName("viewpage_ui");new t.core.pager.view.button.ViewPageUi(c,s).initialize();var u=t.createInstance("PulldownSortConfig");return Q.all([s.initialize(),u.init(this._sortArgs,this._sortConfig).then(s.setPulldownSortConfig.bind(s))]).fail(function(e){console.error(e.stack)})}},prepareList:function(){return this._getOrCreateApiListModel().initialize()},_getOrCreateApiListModel:function(){var e=this._listArgs;return this._apiList=this._apiList||t.core.pager.model.ApiDataListFactory(e.apiName,e.apiMethod,e.apiParams),this._apiList}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("book.eventHandling"),t.book.eventHandling.CharacterTouchEventHandler=n.Class.extend({className:"CharacterTouchEventHandler",handle:function(e){var n=e.getRawData();t.createInstance("router").navigate("book/detail/de_001",{de_001_002:{id:n.a_character_id,isOwn:!0,fromPartyPage:!1,equipedSelf:!1}},{navigateFrom:{routes:"book/book_001_character"}})}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("book.eventHandling"),t.book.eventHandling.WeaponTouchEventHandler=n.Class.extend({className:"WeaponTouchEventHandler",handle:function(e){var n=e.getRawData();t.createInstance("router").navigate("book/detail/de_003",{de_003:{id:n.a_weapon_id,isOwn:!0,fromPartyPage:!1,equipedSelf:!1}},{navigateFrom:{routes:"book/book_001_weapon"}})}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("book.eventHandling"),t.book.eventHandling.SummonTouchEventHandler=n.Class.extend({className:"SummonTouchEventHandler",handle:function(e){var n=e.getRawData();t.createInstance("router").navigate("book/detail/de_004",{de_004:{id:n.a_summon_id,isOwn:!0,fromPartyPage:!1,equipedSelf:!1,equipedMainSelf:!1}},{navigateFrom:{routes:"book/book_001_summon"}})}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("book.eventHandling"),t.book.eventHandling.AccessoryTouchEventHandler=n.Class.extend({className:"AccessoryTouchEventHandler",handle:function(e){var i=e.getRawData(),a=n.director.getRunningScene();return t.ImplantedPopup.createOrGet(a,"acce_detail","AcceDetailSellPopup").open(i)}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.router=n.router||{},n.router.routes=n.router.routes||{},t.merge(n.router.routes,{book:{book:"book_001","book/book_001":"book_001","book/book_001_character":"book_001","book/book_001_weapon":"book_001","book/book_001_summon":"book_001","book/book_001_accessory":"book_001","book/detail/de_001":"de_001_002","book/detail/de_003":"de_003","book/detail/de_004":"de_004"}})}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.book=t.pc.book||{},t.pc.book.book_001=t.pc.book.book_001||{},t.pc.book.book_001.Scene=t.BaseScene.extend({resourceFileName:"book_001/book_001.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[{tab1:{node:"tab_0","content-node":"tab_0_node"},tab2:{node:"tab_1","content-node":"tab_1_node"},tab3:{node:"tab_2","content-node":"tab_2_node"},tab4:{node:"tab_3","content-node":"tab_3_node"}}],componentName:"book",sceneName:"book_001",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_disabled","btnCallbackBtnDisabled",null,function(){alert("{{book_request_rank}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("tab_0_node"),"btn_enh","btnCallbackTab0NodeBtnEnh",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"enh_evo/enh_001_2_6_evo_001_2_3")),this._initButtonEvent.call(this,this.seekWidgetByPath("tab_0_node"),"btn_evo","btnCallbackTab0NodeBtnEvo",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"enh_evo/enh_001_2_6_evo_001_2_3")),this._initButtonEvent.call(this,this.seekWidgetByPath("tab_0_node"),"btn_arousal","btnCallbackTab0NodeBtnArousal",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"enh_evo/arousal_002")),this._initButtonEvent.call(this,this.seekWidgetByPath("tab_1_node"),"btn_enh","btnCallbackTab1NodeBtnEnh",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"enh_evo/enh_001_2_6_evo_001_2_3")),this._initButtonEvent.call(this,this.seekWidgetByPath("tab_1_node"),"btn_evo","btnCallbackTab1NodeBtnEvo",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"enh_evo/enh_001_2_6_evo_001_2_3")),this._initButtonEvent.call(this,this.seekWidgetByPath("tab_1_node"),"btn_allsell","btnCallbackTab1NodeBtnAllsell",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"list/li_007_8")),this._initButtonEvent.call(this,this.seekWidgetByPath("tab_1_node"),"btn_autospend","btnCallbackTab1NodeBtnAutospend",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"autospend/autospend_001")),this._initButtonEvent.call(this,this.seekWidgetByPath("tab_2_node"),"btn_enh","btnCallbackTab2NodeBtnEnh",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"enh_evo/enh_001_2_6_evo_001_2_3")),this._initButtonEvent.call(this,this.seekWidgetByPath("tab_2_node"),"btn_evo","btnCallbackTab2NodeBtnEvo",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"enh_evo/enh_001_2_6_evo_001_2_3")),this._initButtonEvent.call(this,this.seekWidgetByPath("tab_2_node"),"btn_allsell","btnCallbackTab2NodeBtnAllsell",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"list/li_007_8")),this._initButtonEvent.call(this,this.seekWidgetByPath("tab_2_node"),"btn_autospend","btnCallbackTab2NodeBtnAutospend",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"autospend/autospend_001")),this._initButtonEvent.call(this,this.seekWidgetByPath("tab_3_node"),"btn_enh","btnCallbackTab3NodeBtnEnh",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"acce/acce_002_003_005_007")),this._initButtonEvent.call(this,this.seekWidgetByPath("tab_3_node"),"btn_equip","btnCallbackTab3NodeBtnEquip",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"acce/acce_002_003_005_007")),this._initButtonEvent.call(this,this.seekWidgetByPath("tab_3_node"),"btn_allsell","btnCallbackTab3NodeBtnAllsell",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"acce/acce_002_003_005_007")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_hint","btnCallbackBtnHint",null,function(){alert("{{}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("tab_0_node"),"filter_btn","btnCallbackTab0NodeFilterBtn",null,function(){alert("{{com_filter_chara}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("tab_1_node"),"filter_btn","btnCallbackTab1NodeFilterBtn",null,function(){alert("{{com_filter_weapon}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("tab_2_node"),"filter_btn","btnCallbackTab2NodeFilterBtn",null,function(){alert("{{com_filter_other}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("tab_3_node"),"filter_btn","btnCallbackTab3NodeFilterBtn",null,function(){alert("{{com_filter_other}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("book.book_001"),t.book.book_001.SceneData=n.Class.extend({className:"SceneData",settingsMap:{tab_0_node:"characterPageSettings",tab_1_node:"weaponPageSettings",tab_2_node:"summonPageSettings",tab_3_node:"accessoryPageSettings"},ctor:function(e){this._listControllerCach={},this._aPlayerMeCache=null},prepareTabPage:function(e,n){var i=this.settingsMap[e];return _.isUndefined(i)?void console.warn("Unknown tabPage node: "+e):(this._settings=t.createInstance(i),void this._getOrCreateListController(e).showContents(n))},prepareList:function(e,n){var i=this.settingsMap[e];return _.isUndefined(i)?void console.warn("Unknown tabPage node: "+e):(this._settings=t.createInstance(i),this._getOrCreateListController(e).prepareList())},prepareAPlayer:function(){return this._aPlayerMeCache=t.createInstance("myselfInfoRepository").getMe().then(function(e){return e.getPlainBody()})},_getOrCreateListController:function(e){var n=this._listControllerCach[e];return _.isUndefined(n)&&(n=t.createInstance("InventoryPageListController",[this._settings]),this._listControllerCach[e]=n),n},getSettings:function(){return this._settings},setAmountLabel:function(e){var t=e.seekWidgetByName("header_sub_label");t.setText(""),this._aPlayerMeCache=this._aPlayerMeCache||this.prepareAPlayer(),this._aPlayerMeCache.then(function(e){var n=this.getSettings().toAmountLabelText(e);t.setText(n)}.bind(this)).fail(function(e){e&&console.error(e)})},handleButtonEvent:function(e,n){var i=Q.defer(),a=this.getSettings().buttonRoutes[n];if(_.isUndefined(a))return console.debug("handler not found for: node="+n),void i.resolve();if(i.reject(e._override),_.isArray(a)){var o=a[0],r=a[1],s=a[2];t.createInstance("router").navigate(o,r,s)}else t.createInstance("router").navigate(a);return i.promise}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc=t.pc||{},t.pc.book=t.pc.book||{},t.pc.book.book_001=t.pc.book.book_001||{},t.pc.book.book_001.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../book_popup_ui.json"],_popups:{},TABS:{CHARACTER:{SCENE_NAME:"book_001_character",NODE_NAME:"tab_0"},WEAPON:{SCENE_NAME:"book_001_weapon",NODE_NAME:"tab_1"},SUMMON:{SCENE_NAME:"book_001_summon",NODE_NAME:"tab_2"},ACCESSORY:{SCENE_NAME:"book_001_accessory",NODE_NAME:"tab_3"}},_createDisplayFilterSettings:function(){return{tab_0_node:[t.displayFilter.enums.FILTER_NAME.BOOK_CHARA,"com_filter_chara"],tab_1_node:[t.displayFilter.enums.FILTER_NAME.BOOK_WEAPON,"com_filter_weapon"],tab_2_node:[t.displayFilter.enums.FILTER_NAME.BOOK_SUMMON,"com_filter_other"],tab_3_node:[t.displayFilter.enums.FILTER_NAME.BOOK_ACCESSORY,"com_filter_other"]}},onSceneInit:function(e){return a.defer(),this._setBackBtn(e),this._tabPageController=t.createInstance("TabPageController",[0]),this._tabPageController.initializeAcceTab(e),this._summonOrbLabel=t.createInstance("SummonOrbAmountLabelController"),this._createDisplayFilterController(e),this._setCurrentTab(e),a.resolve()},onSceneEnter:function(e){this._data=t.createInstance("SceneData");var n=Object.keys(this._createDisplayFilterSettings()).filter(function(e){return"tab_3_node"!==e}).map(this._data.prepareList.bind(this._data)),i=this._data.prepareAPlayer().then(function(e){if(e.can_use_accessory)return this._data.prepareList("tab_3_node")}.bind(this));return n.push(i),a.all(n)},onSceneExit:function(e){return a.defer(),this._displayFilterClean(),a.resolve()},onPageInAnimationEnd:function(e){return a.defer(),a.resolve()},tabCallbackTab0:function(e){this._tabPageController.update(e),this._data.prepareTabPage(this._tabPageController.getCurrentPageName(e),e),this._data.setAmountLabel(e),this._initializeDisplayFilterController("tab_0_node")},tabCallbackTab1:function(e){this._tabPageController.update(e),this._data.prepareTabPage(this._tabPageController.getCurrentPageName(e),e),this._data.setAmountLabel(e),this._initializeDisplayFilterController("tab_1_node")},tabCallbackTab2:function(e){this._summonOrbLabel.display(),this._tabPageController.update(e),this._data.prepareTabPage(this._tabPageController.getCurrentPageName(e),e),this._data.setAmountLabel(e),this._initializeDisplayFilterController("tab_2_node")},tabCallbackTab3:function(e){this._tabPageController.update(e),this._data.prepareTabPage(this._tabPageController.getCurrentPageName(e),e),this._data.setAmountLabel(e),this._initializeDisplayFilterController("tab_3_node"),this._showSubTutorialFirstAccess(e)},_showSubTutorialFirstAccess:function(e){if(!this._firstAccessorySubTutorial){this._firstAccessorySubTutorial=!0;var n="book_accessory",i=t.createInstance("apiASubTutorialPages");return i.get(n).then(function(t){t.body.need_first_display&&(this._openSubTutorialPopup(e),i.visited(n))}.bind(this)).fail(function(e){console.error(e.stack)})}},btnCallbackBtnDisabled:function(e){var n=a.defer();n.reject(this._override);var i=t.ImplantedPopup.createOrGet(e,"book_request_rank","CanNotUseAccessoryPopup");return i.setButtonEvents({btn_ok:!0}),i.open(),n.promise},btnCallbackTab0NodeBtnEnh:function(e){return this._data.handleButtonEvent(this,"btn_enh")},btnCallbackTab0NodeBtnEvo:function(e){return this._data.handleButtonEvent(this,"btn_evo")},btnCallbackTab0NodeBtnArousal:function(e){return this._data.handleButtonEvent(this,"btn_arousal")},btnCallbackTab1NodeBtnEnh:function(e){return this._data.handleButtonEvent(this,"btn_enh")},btnCallbackTab1NodeBtnEvo:function(e){return this._data.handleButtonEvent(this,"btn_evo")},btnCallbackTab1NodeBtnAllsell:function(e){return this._data.handleButtonEvent(this,"btn_allsell")},btnCallbackTab1NodeBtnAutospend:function(e){var n=a.defer();return n.reject(this._override),t.createInstance("router").navigate("autospend",{},{autospend_001:{tab:"weapon"}}),n.promise},btnCallbackTab2NodeBtnEnh:function(e){return this._data.handleButtonEvent(this,"btn_enh")},btnCallbackTab2NodeBtnEvo:function(e){return this._data.handleButtonEvent(this,"btn_evo")},btnCallbackTab2NodeBtnAllsell:function(e){return this._data.handleButtonEvent(this,"btn_allsell")},btnCallbackTab2NodeBtnAutospend:function(e){var n=a.defer();return n.reject(this._override),t.createInstance("router").navigate("autospend",{},{autospend_001:{tab:"summon"}}),n.promise},btnCallbackTab3NodeBtnEnh:function(e){return this._data.handleButtonEvent(this,"btn_enh")},btnCallbackTab3NodeBtnEquip:function(e){return this._data.handleButtonEvent(this,"btn_equip")},btnCallbackTab3NodeBtnAllsell:function(e){return this._data.handleButtonEvent(this,"btn_allsell")},btnCallbackBtnHint:function(e){return this._openSubTutorialPopup(e),a.reject(this._override)},_openSubTutorialPopup:function(e){return t.ImplantedPopup.createOrGet(e,"sub_tutorial","ImplantedSubTutorialPopup").open("acce",2)},_setCurrentTab:function(e){var n,i=t.createInstance("router").getCurrentSceneName(),a=e.tabDelegateList[0];switch(i){case"book":case"book/book_001":case this.TABS.CHARACTER.SCENE_NAME:default:n=e.seekWidgetByName(this.TABS.CHARACTER.NODE_NAME);break;case this.TABS.WEAPON.SCENE_NAME:n=e.seekWidgetByName(this.TABS.WEAPON.NODE_NAME);break;case this.TABS.SUMMON.SCENE_NAME:n=e.seekWidgetByName(this.TABS.SUMMON.NODE_NAME);break;case this.TABS.ACCESSORY.SCENE_NAME:n=e.seekWidgetByName(this.TABS.ACCESSORY.NODE_NAME)}a.selectTab(n)},_touchEndedBackBtnProcess:function(e){t.createInstance("router").navigate("mypage/my_001")},refreshPage:function(){t.createInstance("notificationCenter").dispatchEvent(t.core.pager.controller.PagerController.prototype.REFRESH_EVENT,[]);var e=n.director.getRunningScene();e.headerDelegate.updateCurrency().then(function(){this._data.setAmountLabel(e),this._summonOrbLabel.display()}.bind(this))}}),i.assign(t.pc.book.book_001.SceneDelegate.prototype._popups,t.acce.view.AcceDetailCommonPopup.prototype._popups),t.assignRoles(t.pc.book.book_001.SceneDelegate,[t.displayFilter.roles.DisplayFilterSceneController])}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="AEvents",o={getRaidEvent:function(e){return this._http.get({url:"/a_events/raid_event/"+e})},getRaidEventNotice:function(e){return this._http.get({url:"/a_events/raid_event_notice/"+e})},getRaidEventRewards:function(e,t,n,i){return this._http.get({url:"/a_events/raid_event/"+e+"/rewards",json:{type:t,page:n,per_page:i}})},receiveRaidEventReward:function(e,t){return this._http.post({url:"/a_events/raid_event/"+e+"/rewards/"+t})},receiveAllRaidEventRewards:function(e,t){return this._http.post({url:"/a_events/raid_event/"+e+"/rewards/receive",json:{type:t}})},notifyRaidEventNoticeFirstAccess:function(e){return this._http.put({url:"/a_events/raid_event_notice/"+e,json:{first_access:!1}})},notifyRaidEventFirstAccess:function(e){return this._http.put({url:"/a_events/raid_event/"+e,json:{first_access:!1}})},markRaidEventNewQuestConfirmed:function(e,t){return this._http.put({url:"/a_events/raid_event/"+e,json:{unlocked_quest:{quest_id:t,confirmed:!0}}})},markRaidEventSuddenQuestConfirmed:function(e,t){return this._http.put({url:"/a_events/raid_event/"+e,json:{quest_id:t,confirmed:!0}})},getQuestEvent:function(e){return this._http.get({url:"/a_events/quest_event/"+e})},getQuestEventNotice:function(e){return this._http.get({url:"/a_events/quest_event_notice/"+e})},updateQuestEventFirstAccess:function(e,t){return this._http.put({url:"/a_events/quest_event/"+e,json:{first_access:t}})},updateQuestEventNoticeFirstAccess:function(e,t){return this._http.put({url:"/a_events/quest_event_notice/"+e,json:{first_access:t}})},getUnionEvent:function(e){return this._http.get({url:"/a_events/union_event/"+e})},getUnionEventNotice:function(e){return this._http.get({url:"/a_events/union_event_notice/"+e})},notifyUnionEventNoticeFirstAccess:function(e){return this._http.put({url:"/a_events/union_event_notice/"+e,json:{first_access:!1}})},notifyUnionEventFirstAccess:function(e){return this._http.put({url:"/a_events/union_event/"+e,json:{first_access:!1}})},getTodayMatches:function(e){return this._http.get({url:"/a_events/union_event/"+e+"/matches",json:{date:"today"}})},getInventory:function(e){return this._http.get({url:"/a_events/union_event/"+e+"/inventory"})},getUnionEventMatchesBuffEffects:function(e,t){return this._http.get({url:"/a_events/union_event/"+e+"/matches/"+t+"/buff_effects"})},getUnionRaid:function(e){return this._http.get({url:"/a_events/union_raid/"+e})},getUnionRaidNotice:function(e){return this._http.get({url:"/a_events/union_raid_notice/"+e})},firstAccessUnionRaidNotice:function(e){return this._http.put({url:"/a_events/union_raid_notice/"+e,json:{first_access:!1}})},firstAccessUnionRaid:function(e){return this._http.put({url:"/a_events/union_raid/"+e,json:{first_access:!1}})},receiveUnionRaidLoginBonus:function(e,t){return this._http.put({url:"/a_events/union_raid/"+e,json:{login_bonus:{login_bonus_id:t,confirmed:!0}}})},getUnionRaidBattleSituation:function(e){return this._http.get({url:"/a_events/union_raid/"+e+"/battle_situation"})},getUnionRaidPoint:function(e){return this._http.get({url:"/a_events/union_raid/"+e+"/point"})},getUnionRaidItem:function(e){return this._http.get({url:"/a_events/union_raid/"+e+"/item"})},getUnionRaidDemonBuff:function(e){return this._http.get({url:"/a_events/union_raid/"+e+"/demon_buff"})},getUnionRaidRewards:function(e,t,n,i){return this._http.get({url:"/a_events/union_raid/"+e+"/rewards",json:{type:t,page:n,per_page:i}})},updateUnionRaidDemonBuff:function(e,t){return this._http.put({url:"/a_events/union_raid/"+e+"/demon_buff",json:{buff_effects:t}})},receiveUnionRaidReward:function(e,t){return this._http.post({url:"/a_events/union_raid/"+e+"/rewards/"+t})},receiveAllUnionRaidRewards:function(e,t){return this._http.post({url:"/a_events/union_raid/"+e+"/rewards/receive",json:{type:t}})},getUnionRaidRankingEvent:function(e){return this._http.get({url:"/a_events/union_raid/"+e+"/ranking_event"})},getUnionRaidRankingHasRewards:function(e){return this._http.get({url:this._getUnionRaidRootUrl()+e+"/ranking_event_has_rewards"})},getUnionRaidLastRankingUpdate:function(e){return this._http.get({url:this._getUnionRaidRootUrl()+e+"/last_ranking_update"})},getUnionRaidRankingRewards:function(e,t,n,i){return this._http.get({url:"/a_events/union_raid/"+e+"/ranking_rewards",json:{type:t,page:n,per_page:i}})},getUnionRaidRanking:function(e,t,n,i){return this._http.get({url:this._getUnionRaidRootUrl()+e+"/ranking",json:{type:t,page:n,per_page:i}})},getUnionRaidScore:function(e,t){return this._http.get({url:this._getUnionRaidRootUrl()+e+"/score",json:{type:t}})},receiveUnionRaidRankingReward:function(e,t){return this._http.post({url:"/a_events/union_raid/"+e+"/ranking_rewards/"+t})},receiveAllUnionRaidRankingRewards:function(e,t){return this._http.post({url:"/a_events/union_raid/"+e+"/ranking_rewards/receive",json:{type:t}})},getVoteTickets:function(){return this._http.get({url:this._getPoprankRootUrl()+"/vote_tickets"})},getCheeringPoints:function(){return this._http.get({url:this._getPoprankRootUrl()+"/cheering_points"})},getRewardObtainmentInfo:function(){return this._http.get({url:this._getPoprankRootUrl()+"/reward_obtainment_info"})},postExchangeCheeringPoints:function(){return this._http.post({url:this._getPoprankRootUrl()+"/exchange_cheering_points"})},getVoteTargets:function(e,t,n){return this._http.get({url:this._getPoprankRootUrl()+"/vote_targets",json:{rarity:e,page:t,per_page:n}})},postVote:function(e,t,n){return this._http.post({url:this._getPoprankRootUrl()+"/vote",json:{target_id:e,target_type:t,ticket_amount:n}})},getRanking:function(e,t,n){return this._http.get({url:this._getPoprankRootUrl()+"/ranking",json:{rarity:e,page:t,per_page:n}})},getUpperRanks:function(){return this._http.get({url:this._getPoprankRootUrl()+"/upper_rank"})},getLastRankingUpdate:function(){return this._http.get({url:this._getPoprankRootUrl()+"/last_ranking_update"})},getPoprankRewards:function(e,t){return this._http.get({url:this._getPoprankRootUrl()+"/rewards",json:{page:e,per_page:t,type:"total_player_vote_amount"}})},receivePoprankReward:function(e){return this._http.post({url:this._getPoprankRootUrl()+"/rewards/"+e})},receiveAllPoprankRewards:function(){return this._http.post({url:this._getPoprankRootUrl()+"/rewards/receive",json:{type:"total_player_vote_amount"}})},updateFirstAccessDatetime:function(e,t){return this._http.put({url:"/a_events/"+e+"/"+(t||this._eventId)+"/first_access"})},getScoreattackRecord:function(e,t){var i=n.scoreattack.WordBook.EVENT_TYPE;return this._http.get({url:"/a_events/"+i+"/"+(e||this._eventId)+"/"+t})},getScoreattackRewards:function(e,t,i,a){var o=n.scoreattack.WordBook.EVENT_TYPE;return this._http.get({url:"/a_events/"+o+"/"+(e||this._eventId)+"/rewards",json:{page:i,per_page:a,type:t}})},receiveScoreattackReward:function(e,t){var i=n.scoreattack.WordBook.EVENT_TYPE;return this._http.post({url:"/a_events/"+i+"/"+(e||this._eventId)+"/rewards/"+t})},receiveAllScoreattackRewards:function(e,t){var i=n.scoreattack.WordBook.EVENT_TYPE;return this._http.post({url:"/a_events/"+i+"/"+(e||this._eventId)+"/rewards/receive",json:{type:t}})},getScoreattackHasAccessed:function(){var e=n.scoreattack.WordBook.EVENT_TYPE;return this._http.get({url:"/a_events/"+e+"/has_accessed"})},getEventRanking:function(e,t,n,i,a){return this._http.get({url:"/a_events/"+e+"/"+(n||this._eventId)+"/ranking",json:{type:t,page:i,per_page:a}})},getEventRankingState:function(e,t){return this._http.get({url:"/a_events/"+e+"/"+(t||this._eventId)+"/ranking_state"})},getRankingHasRewards:function(e,t){return this._http.get({url:"/a_events/"+e+"/"+(t||this._eventId)+"/ranking_event_has_rewards"})},getLastEventRankingUpdate:function(e,t){return this._http.get({url:"/a_events/"+e+"/"+(t||this._eventId)+"/last_ranking_update"})},getEventRankingRewards:function(e,t,n,i,a){return this._http.get({url:"/a_events/"+e+"/"+(n||this._eventId)+"/ranking_rewards",json:{type:t,page:i,per_page:a}})},receiveEventRankingReward:function(e,t,n){return this._http.post({url:"/a_events/"+e+"/"+(t||this._eventId)+"/ranking_rewards/"+n})},receiveAllEventRankingRewards:function(e,t,n){return this._http.post({url:"/a_events/"+e+"/"+(t||this._eventId)+"/ranking_rewards/receive",json:{type:n}})},getDetail:function(e,t){return this._http.get({url:"/a_events/"+e+"/"+(t||this._eventId)})},updateStatus:function(e,t){return this._http.put({url:"/a_events/"+e+"/"+(t||this._eventId)})},getTowerComment:function(e,t){return this._http.post({url:"/a_events/"+e+"/"+(t||this._eventId)+"/arisa_comments"})},setEventIdDelegate:function(e){this._eventId=e}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiAEvents",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})},_getPoprankRootUrl:function(){if(null==this._eventId)throw new Error("KHApiEvents._getPoprankRootUrl: no event id set, use setEventIdDelegate to set the event id first!");return"/a_events/poprank/"+this._eventId},_getUnionRaidRootUrl:function(){return"/a_events/union_raid/"}},o)),n.env.useApiMock){n.MockApi=n.MockApi||{};var r={};t.each(o,function(e,t){r[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi."+a+"."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},r))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="Gacha",o={getAppearance:function(e,t){return this._http.get({url:"/gacha/"+e+"/appearance",json:{rare:t}})},getAppearanceByEventId:function(e,t){return this._http.get({url:"/gacha/event/"+e+"/appearance",json:{id:e,rare:t}})},getSliderDetail:function(e){return this._http.get({url:"/gacha/detail",json:{slider_id:e}})},getSummonRatios:function(e,t,n){return this._http.get({url:"/gacha/"+e+"/summon/ratios",json:{page:t,per_page:n}})},getWeaponRatios:function(e,t,n){return this._http.get({url:"/gacha/"+e+"/weapon/ratios",json:{page:t,per_page:n}})},getEventSummonRatios:function(e,t,n){return this._http.get({url:"/gacha/event/"+e+"/summon/ratios",json:{page:t,per_page:n}})},getEventWeaponRatios:function(e,t,n){return this._http.get({url:"/gacha/event/"+e+"/weapon/ratios",json:{page:t,per_page:n}})},getHaremEpisodeCharacter:function(e){return this._http.get({url:"/gacha/harem_episodes/characters/"+e})},getHaremEpisodesCharacters:function(e,t){return this._http.get({url:"/gacha/harem_episodes/characters",json:{page:e,per_page:t}})},getHaremEpisodeSummon:function(e){return this._http.get({url:"/gacha/harem_episodes/summons/"+e})},getHaremEpisodesSummons:function(e,t){return this._http.get({url:"/gacha/harem_episodes/summons",json:{page:e,per_page:t}})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiGacha",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},o)),n.env.useApiMock){n.MockApi=n.MockApi||{};var r={};t.each(o,function(e,t){r[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi.Gacha."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},r))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.createNameSpaceIfNotExists("pc.view"),t.pc.view.ComOpenEpisodePopup=t.ImplantedPopup.extend({_initContents:function(e,t){this.setButtonEvents({btn_popup_close:!0});var n=this.getNode();this._setCorecard(n,e),this._setJoinedMessage(n,e.name)},_setCorecard:function(e,t){this._setProperCoreCardElementRarity(e,t,"core_img")},_setJoinedMessage:function(e,t){var n=e.seekWidgetByName("harlem_release_label");null!==n&&(n.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_CENTER),n.setString(t+"\r\n"))}}),t.assignRoles(t.pc.view.ComOpenEpisodePopup,[t.pc.roles.CoreCardCommon])}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.createNameSpaceIfNotExists("core.item"),t.core.item.ShWeaponInfoPopup=t.ImplantedPopup.extend({_initContents:function(e){this.setButtonEvents({btn_popup_close:!0});var t=this.getNode();this.clearData(t),this.setData(t,e)}}),t.assignRoles(t.core.item.ShWeaponInfoPopup,[t.pc.roles.CoreCardCommon,t.pc.status.roles.ShWeaponInfoCommon])}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.createNameSpaceIfNotExists("core.item"),t.core.item.ShSummonInfoPopup=t.ImplantedPopup.extend({_initContents:function(e){this.setButtonEvents({btn_popup_close:!0});var t=this.getNode();this.clearData(t),this.setData(t,e)}}),t.assignRoles(t.core.item.ShSummonInfoPopup,[t.pc.roles.CoreCardCommon,t.pc.status.roles.ShSummonInfoCommon])}((this||0).self||global),function(e){var t=e.cc,n=e._,i=e.kh;i.createNameSpaceIfNotExists("core.item"),i.core.item.ShItemInfoPopup=i.ImplantedPopup.extend({CORECARD_IMAGE_2ND_KEY:"item",_initContents:function(e){this.setButtonEvents({btn_popup_close:!0});var t=this.getNode();this._setCorecard(t,e.item_id),this._setItemName(t,e.name),this._setItemDescription(t,e.description||e.item_description)},_setCorecard:function(e,t){var a=e.seekWidgetByName("item_img");if(null!==a){var o=i.Img("corecard",this.CORECARD_IMAGE_2ND_KEY,n.padZero(t,4)).jpg;a.setVisible(!0),a.loadTexture(o)}},_setItemName:function(e,t){var n=e.seekWidgetByName("item_name_label");null!==n&&n.setString(t)},_setItemDescription:function(e,n){var i=e.seekWidgetByName("item_description_label");null!==i&&(i.setTextHorizontalAlignment(t.TEXT_ALIGNMENT_CENTER),i.setString(n))}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);e.Q,t.pc.shop=t.pc.shop||{},t.pc.shop.roles=t.pc.shop.roles||{},t.pc.shop.roles.ShopTreasurePageListController={_fillupTreasureListCore:function(e,n){var i=e.seekWidgetByName(n.listName);i&&i.removeFromParent();var a=t.createInstance(n.apiName);return a[n.apiMethodName].apply(a,n.apiParams).then(function(t){if(null!=t.body.data){this._fillupList(e,{viewParent:n.listParent,subPageRes:n.subPageRes,panelsPerPage:n.pagePerPanel,dontClone:!0},t.body.data,t.body.max_record_count,{},this[n.initFuncName].bind(this))}return t.body}.bind(this)).fail(function(e){console.error(e.stack)})}},n.assign(t.pc.shop.roles.ShopTreasurePageListController,t.pc.list.roles.PageListControllerCommon)}((this||0).self||global),function(e){var t=e.kh,n=e._,i=e.blowfish,a=i.decrypt;t.EpisodeImage=cc.Class.extend({_episodeRecordCache:{},loadTextureToImageView:function(o,r,s,c){return n.isUndefined(s)?(console.warn("episode_id is not specified"),Q.resolve()):(this._episodeRecordCache[s]?Q.resolve(this._episodeRecordCache[s]):t.createInstance("apiEpisodes").get(s).then(function(e){return this._episodeRecordCache[s]=e,e}.bind(this))).then(function(t){var i=t.body.chapters[0].harem_scenes;if(n.isArray(i)&&0<i.length){var a=i[0];if(n.isUndefined(a))return e.console.warn(" 1"),"";var o=a.harem_scene_id;return n.isUndefined(o)?(e.console.warn(" 2"),""):a.resource_directory||""}var r=t.body.chapters[0].scenarios;if(n.isArray(r)&&0<r.length){var s=r[0];if(n.isUndefined(s))return e.console.warn(" 1"),"";var c=s.scenario_id;return n.isUndefined(c)?(e.console.warn(" 2"),""):s.resource_directory||""}}.bind(this)).then(function(e){var u=e.match(/[^\/]+$/);if(u){var l;if((u=u[0]).indexOf("-")<0&&(u=a.call(i,u,"bLoWfIsH",{outputType:1,cipherMode:0})),u=u.replace(/^[\w-_]+_(\d{4}-\d{1}-\d{1})-[HS]$/,function(e,t){return t}),/main/.test(r)){var _=s,p=c;l=t.Img("questimg",r,n.padZero(_,4),p).png,console.debug("[!! DEBUG IMG POPUP MAIN STORY !!]",l)}else l=t.Img("questimg",r.replace(/cter$/,"")+"-quest",u,c).png,console.debug("[!! DEBUG IMG POPUP CHARA STORY !!]",l);return o.loadTexture(l),Q.resolve()}}.bind(this)).fail(function(t){e.console.warn(t)})}})}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="Episodes",o={get:function(e){return this._http.get({url:"/episodes/"+e})},getHaremOnly:function(e){return this._http.get({url:"/episodes/"+e,json:{type:"harem_only"}})},getList:function(){return this._http.get({url:"/episodes/"})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiEpisodes",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},o)),n.env.useApiMock){n.MockApi=n.MockApi||{};var r={};t.each(o,function(e,t){r[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi."+a+"."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},r))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.router=n.router||{},n.router.routes=n.router.routes||{},t.merge(n.router.routes,{conquest:{conquest:"con_000","conquest/con_000":"con_000","conquest/con_001":"con_001","conquest/con_002":"con_002","conquest/con_005":"con_005"}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc.conquest=t.pc.conquest||{},t.pc.conquest.roles=t.pc.conquest.roles||{},t.pc.conquest.roles.ChangeCheckPopup={_showChangeCheckPopup:function(e,n){var i=e.seekWidgetByName("popup_ui");if(null!=i){var o=e.seekWidgetByName("sh_change_check");if(null!=o){if(null!=n&&null!=n.kind){this._selectedRecord=n,this._selectedValue=1,this.__changeCheckPopupChangeAnimation(o,n),this.__changeCheckPopupSetCoreCard(o,n),this.__setContentsPanel(o,n);var r=t.createInstance("StockInfoModel",[n.stock_info]);a.delay(300).then(function(){this.__setBuyPopupPulldown(o,n,r)}.bind(this)),this.__createMainLabelTexture(o,n),this.__createLimitLabelTexture(o,n,r),i.animate("sh_change_check",!1),i.setVisible(!0)}}else console.error("conquest.ChangeCheckPopup _showChangeCheckPopup shChangeCheckNode is null")}else console.error("conquest.ChangeCheckPopup _showChangeCheckPopup popupUiNode is null")},__cleanUpChangeCheckCoreCard:function(e){e.seekWidgetByName("corecard_ui").setVisible(!1),i.each(i.range(4),function(t){e.seekWidgetByName("sh_change_material_ui_"+t).loadTextures({material_img:null})},this)},__changeCheckPopupChangeAnimation:function(e,t){if(null!=t){var n=t.exchange_items;return null==n||0===n.length?void console.error("conquest.ChangeCheckPopup __changeCheckPopupChangeAnimation record.exchange_items is null"):void(t.have_max?e.animate("nothing_view",!1):e.animate("material_view_0"+n.length,!1))}console.error("conquest.ChangeCheckPopup __changeCheckPopupChangeAnimation record is null")},__changeCheckPopupSetCoreCard:function(e,t){var n=this["__changeCheckPopupSetCoreCard"+i.capitalize(t.kind)];return null==n?void this._setProperCoreCardElementRarity(e,t):void n.call(this,e,t)},__changeCheckPopupSetCoreCardWeapon:function(e,n){t.createInstance("apiWeapons").get(n.id).then(function(t){this._selectedWeapon=t.body,this._setProperCoreCardElementRarity(e,this._selectedWeapon)}.bind(this))},__changeCheckPopupSetCoreCardCharacter:function(e,n){t.createInstance("apiCharacters").get(n.id).then(function(t){this._selectedCharacter=t.body,this._setProperCoreCardElementRarity(e,this._selectedCharacter)}.bind(this))},__setContentsPanel:function(e,n){i.each(n.exchange_items,function(n,a){var o=e.seekWidgetByName("sh_change_material_ui_"+a),r=t.Img("corecard","item",i.padZero(n.item_id,4)).jpg;o.seekWidgetByName("material_img").loadTexture(r),this.__createAmountLabelTexture(o,n,this._selectedValue)},this)},__createAmountLabelTexture:function(e,i,a){var o=e.seekWidgetByName("amount_labelimg");o.loadTexture("");var r=i.have_num,s=r-a*i.required_num,c=n.size(320,65);o.setSize(c);var u="<div class='text_common_left' style='white-space: nowrap;'><span class='white'>"+i.name+""+i.required_num*a+"</span><br /><span class='yellow'></span>                   <span class='white'>"+r+"&rarr;</span><span class='red'>"+s+"</span></div>";o.setHtmlStrings({amount_labelimg:u},t.GameConfig.POPUP_CSS),o.visible=!0},__setBuyPopupPulldown:function(e,i,a){var o=this._getPulldownCondition(i,a),r=!!o.length;if(e.seekWidgetByName("btn_pulldown").setVisible(r),e.seekWidgetByName("unit_label").setVisible(r),e.seekWidgetByName("btn_blue_l_1").setTouchEnabled(r),e.seekWidgetByName("btn_blue_l_1").color=r?n.color("#FFFFFF"):n.color("#808080"),o.length){var s=e.seekWidgetByName("sort_ui");if(o&&o.length<10){var c=45*(10-o.length);s.setPositionY(134-c)}var u=e.seekWidgetByName("btn_pulldown");this.popupPulldown=new t.Pulldown({button:u,label:u.seekWidgetByName("amount_label"),menuBase:e.seekWidgetByName("gud_sh_sort"),choice:ccs.load(res["core-sort-sort_list_ui"]).node},o),this.popupPulldown.onChange(function(t){this._selectedValue=t.value,this.__setContentsPanel(e,i)}.bind(this))}},_getPulldownCondition:function(e,t){var n=t.getAmount(),a=!1,o=i.compact(i.map(i.range(n),function(t){return a?null:(t++,!i.some(e.exchange_items,function(e){return!(e.required_num*t<=e.have_num)})?{value:t,text:t}:(a=!0,null))}));return o.length?(o[0].selected=!0,o):[]},__createMainLabelTexture:function(e,n){var a=e.seekWidgetByName("main_labelimg");a.setVisible(!1);var o=a.getSize(),r=this._formatDescription(n.item_description),s=n.name;i.isFinite(n.amount)&&(s+="x"+n.amount);var c="<span class='red'>"+s+"</span><br />"+("package"===n.kind?"":"&nbsp;"+n.have_num+"<br />")+r,u='<div class="text_common_shop" style="white-space:nowrap;vertical-align:top;width: '+o.width+"px;height: "+o.height+'px;">'+c+"</div>";t.convertHTMLToTexture(u,o,t.GameConfig.POPUP_CSS).then(function(e){var t=a.getVirtualRenderer();t.initWithTexture(e),t.setAnchorPoint(0,0),t.setVisible(!0),a.setVisible(!0)}.bind(this))},__createLimitLabelTexture:function(e,i,a){var o=e.seekWidgetByName("limit_labelimg");o.loadTexture("");var r=a.getAmount(),s=(n.size(650,115),""),c="";a.hasDailyLimit()&&(s="<span class='white'>&nbsp;<span class='red'>"+r+"</span><span class='white'></span><br />                    <span class='darkkhaki_mini'>AM5:00</span><br />"),a.hasMonthlyLimit()&&(c="<span class='white'>&nbsp;<span class='red'>"+r+"</span><span class='white'></span><br />                      <span class='darkkhaki_mini'>1AM5:00</span>");var u='<div class="text_common">'+s+c+"</div>";i.have_max&&(u+="<div class='red'></div>"),o.setHtmlStrings({limit_labelimg:u},t.GameConfig.POPUP_CSS),o.visible=!0},_formatDescription:function(e){return e.replace(/\r?\n/g,"<br>")}}}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);e.Q,t.pc.conquest=t.pc.conquest||{},t.pc.conquest.roles=t.pc.conquest.roles||{},t.pc.conquest.roles.Routing={_navigateTo001:function(e,n,i){t.createInstance("router").navigate("conquest/con_001",{con_001:{event_id:n}},{event_type:i})},_navigateTo002:function(e,n,i){t.createInstance("router"),t.createInstance("router").navigate("conquest/con_002",{con_002:{event_id:n}},{event_type:i})},_navigateToEv000:function(e){t.createInstance("router"),t.createInstance("router").navigate("event/ev_000")},_navigateToCharacterStatus:function(e,i,a){return n.isUndefined(e)?void this._consoleErrorRoutingAbort("characterId"):void t.createInstance("router").navigate("status/status_001",{status_001:{id:e,isFromExchange:!0,returnRoute:i,returnParams:a}})},_navigateToQuestList:function(e){t.createInstance("router"),t.createInstance("router").navigate("conquest/con_005",{con_005:{event_id:e,tab:"tab_0"}})},_navigateToScenarioList:function(e){t.createInstance("router"),t.createInstance("router").navigate("conquest/con_005",{con_005:{event_id:e,tab:"tab_1"}})},_navigateToHe002:function(e){t.createInstance("router").navigate("help/he_002",null,{category:"event",categoryTitle:""})},_navigateToQ002:function(e,i,a,o,r,s){return n.isUndefined(i)||n.isUndefined(i.a_quest_id)||n.isUndefined(i.type)?void this._consoleErrorRoutingAbort("selectQuest, selectQuest.a_quest_id, selectQuest.type"):void t.createInstance("router").navigate("quest/q_002",{q_002:{target:"quest",quest_id:i.quest_id,owner_account_id:i.owner_account_id,event_id:s,quest_type:i.type,event_type:r,episode_num:a,recommended_element_type:o}})},_navigateToMy001:function(){t.createInstance("router").navigate("mypage/my_001")},_verifyRouterParams000:function(e){n.isUndefined(e.routerParams.con_000)&&this._consoleErrorRouterParams("routerParams.con_000")},_verifyRouterParams001:function(e){if(n.isUndefined(e.routerParams.con_001)&&this._consoleErrorRouterParams("routerParams.con_001"),n.isUndefined(e.routerParams.con_001.event_id))return n.isUndefined(e.routerParams.con_001.id)?void this._consoleErrorRouterParams("routerParams.con_001.event_id, routerParams.con_001.id"):void(e.routerParams.con_001.event_id=e.routerParams.con_001.id)},_verifyRouterParams002:function(e){n.isUndefined(e.routerParams.con_002)&&this._consoleErrorRouterParams("routerParams.con_002")}},n.assign(t.pc.conquest.roles.Routing,t.pc.roles.RoutingCommon)}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;$staticRes(res["conquest-con_001_first_animation-con_001_first_ani"]),t.pc.conquest=t.pc.conquest||{},t.pc.conquest.roles=t.pc.conquest.roles||{},t.pc.conquest.roles.Animation={_initAnimation:function(e,n){this._preLoadList={conquest_bgImage:t.Img("conquestani-bg","event",i.padZero(n,4)).jpg,conquest_charaImage:t.Img("conquestani-chara","event",i.padZero(n,4)).png};var a=this.__preloadImages(n);return this._questAnimation=this.__loadQuestEventAnimationData(e),a},_startQuestEventAnimation:function(e,t){var n=t.eventId;return null==n?(console.error("conquest.Animation _startQuestEventAnimation eventId is null"),a.reject()):this.__startQuestEventAnimationData(e,this._questAnimation,n)},__preloadImages:function(e){var t=[];return i.each(this._preLoadList,function(e,n){t.push(this.__loadImageCore(e))},this),this._preloadPromise=a.all(t),this._preloadPromise},__loadImageCore:function(e){var t=a.defer();return n.loader.loadImg(e,function(e,n){e?(t.reject(e.toString()),console.error(e)):t.resolve()}.bind(this)),t.promise},__loadQuestEventAnimationData:function(e){var t=ccs.load(res["conquest-con_001_first_animation-con_001_first_ani"]),n=t.node,i=t.action;return n.runAction(i),t},_initPlayer:function(){t.createInstance("soundPlayer").init(t.createInstance("playerGameConfig"))},__startQuestEventAnimationData:function(e,n,o){var r=e.seekWidgetByName("con_001_first_ani");if(null==r)return console.error("conquest.Animation __loadQuestEventAnimationData targetNode is null"),a.reject();var s=n.node,c=n.action;r.setVisible(!0),r.addChild(s);var u=t.Img("conquestani-bg","event",i.padZero(o,4)).jpg,l=t.Img("conquestani-chara","event",i.padZero(o,4)).png;s.seekWidgetByName("conquestani-bg_event").setTexture(u),i.each(i.range(4),function(e){s.seekWidgetByPath("conquestani-chara_panel_"+e+".conquestani-chara_event").setTexture(l)}),this._initPlayer();var _=t.createInstance("AnimationEventHandlerCcs_2_0").init(c),p=(t.createInstance("Sound2Event",[_]),c.getDuration());c.gotoFrameAndPlay(0,p,!1);var d=a.defer();return c.setFrameEventCallFunc(function(e){"animation_e"===e.getEvent()&&(r.setVisible(!1),r.removeAllChildren(),d.resolve())}),d.promise}}}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);e.Q,t.pc.conquest=t.pc.conquest||{},t.pc.conquest.roles=t.pc.conquest.roles||{},t.pc.conquest.roles.Background={_setBackgroundImage:function(e,t,i){var a;a=n.isFunction(this._getEventId)?this._getEventId():e.routerParams[t]&&e.routerParams[t].event_id;var o=this._getSceneNum(t),r=e.seekWidgetByName("conquest-bg"+o);if(r){var s=this._getImgPath(a,o,i);r.loadTexture(s),r.setVisible(!0)}},_getSceneNum:function(e){return e.replace("con_","").replace("conex_","")},_getImgPath:function(e,i,a){return"005"!==i||a?t.Img("conquest-bg"+i,"event",n.padZero(e,4)).jpg:t.env.isSp||t.env.isAndroid||t.env.isIOS?t.Img("conquestani-bg","event",n.padZero(e,4)).jpg:t.Img("conquest-bg002","event",n.padZero(e,4)).jpg},_setEventName:function(e,t){var n=e.seekWidgetByName("header_label");return null===n?void console.error("Background _setEventName nameNode is null"):null==t.event_name?void console.error("Background _setEventName eventData.event_name is null"):void n.setString(t.event_name)}}}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;$staticRes(res["conquest-con_002-sh_exchangelist_list_ui"]),t.pc.conquest=t.pc.conquest||{},t.pc.conquest.roles=t.pc.conquest.roles||{},t.pc.conquest.roles.Treasure={_setExchangeRequiredTreasure:function(e,t){i.each(e.event_treasures,function(e,n){this.__showExchangeRequiredTreasureImage(e,n,t),this.__showExchangeRequiredTreasureAmount(e.amount,n)},this)},_showExchangeableLabelNode:function(e,t){var n=e.seekWidgetByName("attention_textimg");return null===n?void console.error("conquest.Treasure _showExchangeableLabelNode attentionTextImgNode is null"):void n.setVisible(t.exist_exchangeable_items)},_setQuestEventTreasureList:function(e,t){var n={listParent:"change_page_panel",listName:"sh_exchangelist_list_ui",apiName:"apiShop",apiMethodName:"getTreasuresByEventId",apiParams:[t],initFuncName:"_setTreasuresItemEquipmentPanel",pagePerPanel:3,subPageRes:"conquest-con_002-sh_exchangelist_list_ui",exchangeUiName:"sh_exchange_ui"};return this._fillupTreasureListCore(e,n).then(function(t){var n=t.data;this.__showExchangeItemList(e),null!=n&&0!==n.length||this.__showAllExchangedText(e)}.bind(this))},_refreshQuestEventTreasureList:function(e,t){var n=e.seekWidgetByName("change_page_panel");return null===n?void console.error("conquest.Treasure _refreshQuestEventTreasureList panelNode is null"):(n.removeAllChildren(),this._setQuestEventTreasureList(e,t))},_refreshExchangeRequiredTreasure:function(e,n){t.createInstance("apiAEvents").getQuestEvent(n).then(function(e){var t=e.body;i.each(t.event_treasures,function(e,t){this.__showExchangeRequiredTreasureAmount(e.amount,t)},this)}.bind(this))},__showExchangeItemList:function(e){e.seekWidgetByName("list_node").setVisible(!0)},__showAllExchangedText:function(e){e.seekWidgetByName("nothing_node").setVisible(!0)},__showExchangeRequiredTreasureImage:function(e,i,a){var o=n.director.getRunningScene().seekWidgetByName("group_panel_"+i);if(null!=o){var r=o.seekWidgetByName(a);t.createInstance("CoreCardItemUI",["plain",r]).setData({item_id:e.item_id,num:e.amount}),o.setVisible(!0)}else console.error("conquest.Treasure __showExchangeRequiredTreasureImage groupPanelNode is null")},__showExchangeRequiredTreasureAmount:function(e,t){var i=n.director.getRunningScene().seekWidgetByPath("group_panel_"+t+"..have_label");return null==i?void console.error("Treasure __showExchangeRequiredTreasureAmount labelNode is null"):void i.setString(e.toString())},_onTouchShopTreasure:function(e,n){if("character"!==n.kind)this._showItemDetailPopup(e,n,this._getItemType(n));else{var i=t.createInstance("router").getCurrentFragment(),a=t.createInstance("routerParams").getRouterParams();this._navigateToCharacterStatus(n.id,i,a)}},_onTouchExchangeItem:function(e,t){this._showItemDetailPopup(e,t,this._getItemType(t))},_getItemType:function(e){var t=e.kind;return"item"!==t&&"treasure"!==t&&void 0!==t||(t="item",e.obtainment_info.is_today_sp_quest&&(t="item_sp")),t},_onTouchExchangeBtn:function(e,t){this._showChangeCheckPopup(e,t)},_showItemDetailPopup:function(e,t,n){if("weapon"===n)this._openShWeaponInfoPopup(t.id);else if("summon"===n)this._openShSummonInfoPopup(t.id);else if("package"===n)this._setTreasurePopupPackageInfoData(e,t),this._showTreasurePopup(e,"sh_item_info");else{var i=t.item_id||t.id||t.shop_treasure_id;this._openShItemInfoPopup(i)}},_showTreasurePopup:function(e,t){var n=e.seekWidgetByName("popup_ui");return null==n?void console.error("conquest.Treasure _showTreasurePopup popupUiNode is null"):(n.animate(t,!1),void n.setVisible(!0))},_setTreasurePopupPackageInfoData:function(e,t){var n=e.seekWidgetByName("popup_ui");if(null!=n){var i=t.id||t.item_id;this._showTreasurePopupPackageItemCoreCard(i,n,"item_img"),this._setLabelsOnItemInfoPopup(n,t)}else console.error("conquest.Treasure _showTreasurePopup popupUiNode is null")},_setLabelsOnItemInfoPopup:function(e,t){this.__getItemInfoPopupNode(e).setStrings({item_name_label:t.name,item_description_label:t.item_description})},__getItemInfoPopupNode:function(e){var t=e.seekWidgetByName("sh_item_info");if(!t)throw new Error(e.name+"..sh_item_info is not found");return t},_showTreasurePopupPackageItemCoreCard:function(e,n,i){var o=n.seekWidgetByName("corecard_item_ui"),r=t.createInstance("CoreCardPackageItemUI",[null,o]);if(r.setImg(e),!o){var s=r.getResult();n.seekWidgetByName(i).addChild(s)}return n.seekWidgetByName(i).setVisible(!0),t.setTouchEventHandlers(n,{"TOUCH_ENDED btn_popup_close":function(){n.setVisible(!1)}},this),a.resolve()},_showResultPopup:function(e,t,n){var i=e.seekWidgetByName("popup_ui");if(null!=i){var a=e.seekWidgetByName("sh_buy_result");return null==a?void console.error("conquest.Treasure _showResultPopup shBuyResultNode is null"):(this._setProperCoreCardElementRarity(a,n,"corecard_ui"),this._showResultPopupBuyResultLabel(i,t),void this._showTreasurePopup(i,"sh_buy_result"))}console.error("conquest.Treasure _showResultPopup popupUiNode is null")},_showResultPopupBuyResultLabel:function(e,t){var n=e.seekWidgetByName("buy_result_label");return null==n?void console.error("conquest.Treasure _showResultPopup buyResultLabel is null"):void n.setString(t+"")},exchange:function(e,i){t.createInstance("apiShop").exchangeEvent(e.shop_treasure_id,i).then(function(a){if(t.createInstance("myselfInfoRepository").allCacheClear(),a.body.result){var o=n.director.getRunningScene();this._showResultPopup(o,i,e)}}.bind(this)).fail(function(e){console.error(e)})},_setTreasuresItemEquipmentPanel:function(e,t){this._setExchangeTargetItem(e,t),this._setShopItemStockInfo(e,t),this._setExchangeButtonAvailability(e,t),this._setExchangeItemCoreCard(e,t),this._setExchangeBtnEvent(e,t),e.setVisible(!0)},_setExchangeTargetItem:function(e,t){var a=e.seekWidgetByName("corecard_shop");if(null!==a){if(a.parent&&a.parent.setVisible&&a.parent.setVisible(!0),i.isUndefined(t.shop_treasure_id))console.warn("[ERROR] Could not find a shop_treasure_id in the record.");else if(this._setCoreCardImg(a,t),this._removeTouchEventInvalidNode(e,t.kind),i.isFunction(this._onTouchShopTreasure)){var o=n.director.getRunningScene();e.bfsWidgetByName("corecard_shop").addTouchEventListener(function(e,n){n===ccui.Widget.TOUCH_ENDED&&this._onTouchShopTreasure(o,t)},this)}}else console.warn("[ERROR] Could not find corecard shop node.")},_removeTouchEventInvalidNode:function(e,t){var n=this._getNodeName(t),a=e.seekWidgetByName(n);return i.isNull(a)?void console.warn(":"+n):void(a.touchEnabled=!1)},_getNodeName:function(e){return"treasure"===e||"package"===e?"item_img":"character"===e?"chara_img":e+"_img"},_setCoreCardImg:function(e,t){i.isUndefined(t.id)&&console.warn("[ERROR] Could not find id in the record."),this._setProperCoreCardElementRarity(e.parent,t,e.getName())},_setShopItemStockInfo:function(e,n){var i=t.createInstance("TreasureModel",[n]),a=i.getStock(),o=e.seekWidgetByName("stock_base");t.createInstance("TreasureNameView").show(e,i),t.createInstance("StockInfoView").show(o,a),e.seekWidgetByName("rest_base").setVisible(!1)},_setExchangeButtonAvailability:function(e,t){var i=this._checkIfEnuoghExchangeResources(t.exchange_items),a=this._checkIfStockExist(t.stock_info),o=i&&a,r=e.seekWidgetByName("btn_exchange");r.setColor(n.color(o?"#FFFFFF":"#808080")),r.setEnabled(o)},_checkIfEnuoghExchangeResources:function(e){var t=!0;return i.each(e,function(e,n){e.have_num<e.required_num&&(t=!1)},this),t},_checkIfStockExist:function(e){return t.createInstance("StockInfoModel",[e]).hasStock()},_setExchangeItemCoreCard:function(e,t){i.each(i.range(4),function(a){var o=e.bfsWidgetByName("sh_exchange_ui_"+a);if(null!==o){if(o.parent&&o.parent.setVisible&&o.parent.setVisible(!0),o.setVisible(!1),!(t.exchange_items.length<=a)){var r=o.seekWidgetByName("need_amount_label");if(null===r)return void console.warn("[ERROR] Could not find need_amount_label.");var s=t.exchange_items[a],c=this._setItemCoreCard(o,s,"corecard_ui");if(i.isUndefined(s.have_num)||i.isUndefined(s.required_num)||r.setString(s.have_num+"/"+s.required_num),i.isFunction(this._onTouchExchangeItem)){var u=n.director.getRunningScene();c.addTouchEventListener(function(e,t){t===ccui.Widget.TOUCH_ENDED&&this._onTouchExchangeItem(u,s)},this)}c.setTouchEnabled(!0),c.setVisible(!0),o.setVisible(!0)}}else console.warn("[ERROR] Could not find sh_exchange_ui_"+a)},this)},_setExchangeBtnEvent:function(e,t){var i=n.director.getRunningScene();e.bfsWidgetByName("btn_exchange").addTouchEventListener(function(e,n){n===ccui.Widget.TOUCH_ENDED&&this._onTouchExchangeBtn(i,t)},this)}},i.assign(t.pc.conquest.roles.Treasure,t.pc.roles.CoreCardCommon,t.pc.shop.roles.ShopTreasurePageListController,t.pc.roles.ShInfoPopupInvoker,t.pc.conquest.roles.ChangeCheckPopup)}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e._,e.Q,t.pc=t.pc||{},t.pc.quest=t.pc.quest||{},t.pc.quest.roles.MainQuestPanel={_touchQuestPanel:function(e,t){var i=n.director.getRunningScene();this.questCommonDelegate.restartCheckInProgressQuest(t,this._questInfo)||this.startCheckQuestState(i,t)}}}((this||0).self||global),function(e){var t=e._,n=e.kh;n.PopupFactoryComApRestart=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-com_ap_restart",title:"",buttonLabels:{blackBtn:""},buttons:{blackBtn:function(){this.dismiss()}}},POPUP_METHODS:{},onPopupOpened:function(e,t){var i={};i.questTitle=t.questTitle||"",i.type="raid"===t.questType?"":"",e.setStrings({confirm_label:"\n{{type}}{{questTitle}}".replace(/{{([^}]+)}}/g,function(e,t){return i[t]})}),n.setTouchEventHandlers(e,{"TOUCH_ENDED btn_withdrawal":function(){e.dismiss().then(function(){this._showPopupComBackCheck(t.aQuestId,t.questType)}.bind(this))},"TOUCH_ENDED btn_restart":function(){e.dismiss().then(function(){this._gotoQuest(t.aQuestId,t.questType)}.bind(this))}},this);var a=e.seekWidgetByName("btn_restart");a.setSoundEnabled(!0),a.setSound(n.SoundList.BUTTON_TOUCHED_CONFIRMED)},_showPopupComBackCheck:function(t,i){n.createInstance("apiAQuests").getGainedItems(t,i).then(function(e){var a=e.body.gained_items,o=n.createInstance("popupFactoryComBackCheck").create({});console.log("bachCkeck",t,i),o.open({type:i,coin:a.gem,normal:a.wooden_box,silver:a.silver_box,gold:a.golden_box,rainbow:a.rainbow_box,needToOpenComBackResult:!0,aQuestId:t,questType:i})}).fail(function(t){e.console.error(t)})},_gotoQuest:function(e,t){n.createInstance("questStateManager").restartQuest(e,t)},_addMethodsToPopup:function(e){n.PopupFactoryPopupCommon.prototype._addMethodsToPopup.call(this,e),t.assign(e,this.POPUP_METHODS)}})}((this||0).self||global),function(e){var t=e._,n=e.kh;n.PopupFactoryComBackCheck=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-com_back_check",title:"",buttonLabels:{blackBtn:"",redBtn:""},buttons:{blackBtn:function(){this.dismiss().then(this.onCancel)},redBtn:function(){if("prizehunt"===this.questType&&"battle"===n.createInstance("router").getCurrentComponent())return n.createInstance("aQuestInfo").dispose(),n.createInstance("battleWorld").checkContinuePopupConditions()?void n.createInstance("questStateManager").gotoNextQuestState():void n.createInstance("router").navigate("prizehunt/prizehunt_quest",{},{a_quest_id:this.aQuestId,giveUp:!0});n.createInstance("apiAQuests").giveupQuest(this.aQuestId,this.questType).then(function(i){n.createInstance("aQuestInfo").dispose();var a=!t.isEmpty(i.body.scoreattack_result)&&0!==n.createInstance("router").getCurrentFragment().indexOf("battle/");this.dismiss().then(function(){if(!a)return this.needToOpenComBackResult?void n.createInstance("popupFactoryComBackResult").create({}).open({type:this.questType,sceneUpdateRequired:!0}):void n.core.router.navigateFromQuest(this.questType,this.preventNavigateBack,this.aQuestId,!1,i.body.event_id,i.body.epic_subject_id,this.questId,this.questCategory,this.questSubCategory);var e={data:i.body.scoreattack_result,shouldGoQuestTop:!1,eventId:null};n.ImplantedPopup.create(cc.director.getRunningScene(),"scoreattack_result").open(e).fin(function(){var e=(cc.director.getRunningScene()||{})._delegate||{};(e.clearOwnQuest||function(){}).apply(e)})}.bind(this)).fail(function(t){e.console.error(t)})}.bind(this)).fail(function(t){e.console.error(t)})}},buttonSounds:{redBtn:n.SoundList.BUTTON_TOUCHED_CONFIRMED}},typeDictionary:{coin:"gem",normal:"bronze",silver:"silver",gold:"gold",rainbow:"rainbow"},POPUP_METHODS:{},onPopupOpened:function(e,n){var i=n.type,a=n.questType||i;"raid"===i&&e.setStrings({confirm_label:e.seekWidgetByName("confirm_label").getString().replace("","")}),"prizehunt"===a&&e.setStrings({confirm_label:"\n"}),t.each(t.keys(this.typeDictionary),function(t){e.seekWidgetByName("{{type}}_no_label".replace(/{{type}}/,this.typeDictionary[t])).setString((n[t]||0).toString())}.bind(this)),e.needToOpenComBackResult=n.needToOpenComBackResult||!1,e.aQuestId=n.aQuestId,e.questId=n.questId,e.questType=n.questType,e.type=i,e.onCancel=n.onCancel||function(){},e.preventNavigateBack=n.preventNavigateBack||!1,e.questCategory=n.questCategory,e.questSubCategory=n.questSubCategory},_addMethodsToPopup:function(e){n.PopupFactoryPopupCommon.prototype._addMethodsToPopup.call(this,e),t.assign(e,this.POPUP_METHODS)}})}((this||0).self||global),function(e){var t=e._,n=e.kh;n.PopupFactoryComBackResult=n.PopupFactoryTextOnly.extend({POPUP_PROPERTIES:{title:"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(){var e=cc.director.getRunningScene()._delegate;this.sceneUpdateRequired&&(e.update||function(){})(),this.dismiss().then(function(){(e.clearOwnQuest||function(){}).apply(e)})}}},POPUP_METHODS:{},WIDGET_NAMES:{},onPopupOpened:function(e,t){var n="raid"===t.type?"":"";e.setContent("{{type}}".replace(/{{type}}/,n)),e.sceneUpdateRequired=!1!==t.sceneUpdateRequired},_addMethodsToPopup:function(e){n.PopupFactoryTextOnly.prototype._addMethodsToPopup.call(this,e),t.assign(e,this.POPUP_METHODS)}})}((this||0).self||global),function(e){var t=e._,n=e.kh;n.PopupFactoryComRaidCheck=n.PopupFactoryTextOnly.extend({POPUP_PROPERTIES:{title:"",content:'<span class="red"></span>',buttonLabels:{blueBtn:"",blackBtn:""},buttons:{blueBtn:function(){this.dismiss().then(function(){n.createInstance("router").navigate("quest/q_007")})},blackBtn:function(){this.dismiss()}},buttonSounds:{blueBtn:n.SoundList.BUTTON_TOUCHED_CONFIRMED}},POPUP_METHODS:{},_addMethodsToPopup:function(e){n.PopupFactoryTextOnly.prototype._addMethodsToPopup.call(this,e),t.assign(e,this.POPUP_METHODS)}})}((this||0).self||global),function(e){var t=e._,n=e.kh;n.PopupFactoryComNeedApBp=cc.Class.extend({POPUP_TYPES:{UNDEFINED:0,HAS_RECOVERY_ITEMS:1,NO_RECOVERY_ITEMS:2},ctor:function(){this._popupType=this.POPUP_TYPES.UNDEFINED,this._instances={}},create:function(e){var t=this._cacheParams(e),n=this._getItemInfo(t.property,t.items.data),i=this._getCurrentQuestPoints(t.property,t.questPoints),a=this._getMaxQuestPoints(t.property,t.questPoints);return this._updatePopupType(n),this._popupParams=this._getPopupParams(n,i,a),this._instantiate()},getPopupParams:function(){return this._popupParams||{}},cleanup:function(){this._instances={},this._popupParams=null,this._params=null},_cacheParams:function(e){return this._params=t.assign(this._params||{},e),this._params},_instantiate:function(e){if(this._popupType===this.POPUP_TYPES.UNDEFINED)return console.warn("KHPopupFactoryComNeedApBp._instantiate: popup data not properly initialized, please check the params passed to the create method."),{};if(this._instances[this._popupType])return this._instances[this._popupType];var i=n.createInstance("popupFactoryComNeedApBp"+this._popupType).create({});return i.open=function(e){return function(i){var a=n.createInstance("popupFactoryComNeedApBp").getPopupParams();return e.call(this,t.assign(a,i||{}))}}(i.open),this._instances[this._popupType]=i,i},_getPopupParams:function(e,t,n){return{property:this._params.property,questTitle:this._params.questTitle,item:e.fullRecoveryItem,itemLittleRecover:e.halfRecoveryItem,component:this._params.component,currentQuestPoints:t,maxQuestPoints:n,onUse:this._params.onUse,onCancel:this._params.onCancel||function(){},needBattleBp:this._params.needBattleBp}},_getMaxQuestPoints:function(e,t){return"AP"===e?t.max_ap:t.max_bp},_getCurrentQuestPoints:function(e,t){return"AP"===e?t.ap:t.bp},_updatePopupType:function(e){0===e.fullRecoveryItem.num&&0===e.halfRecoveryItem.num?this._popupType=this.POPUP_TYPES.NO_RECOVERY_ITEMS:this._popupType=this.POPUP_TYPES.HAS_RECOVERY_ITEMS},_getItemInfo:function(e,i){return{fullRecoveryItem:t.find(i,function(t){return t.name===n.w("AP"===e?"elixir":"energyLeaf")}),halfRecoveryItem:t.find(i,function(t){return t.name===n.w("AP"===e?"elixirHalf":"energySeed")})}}})}((this||0).self||global),function(e){var t=e._,n=e.kh;n.PopupFactoryComNeedApBp1=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-com_need_ap_bp_1",buttonLabels:{blackBtn:"",blueBtn:""},buttons:{blackBtn:function(){this._onCancel(),this.cleanUp().then(this.dismiss.bind(this))},blueBtn:function(){this._useItems(),this.cleanUp().then(this.dismiss.bind(this))}}},WIDGET_NAMES:{FULL:{POINTS_BEFORE_AFTER:"comp_recovery_use_labelimg",ITEMS_BEFORE_AFTER:"comp_recovery_have_labelimg"},HALF:{POINTS_BEFORE_AFTER:"harf_recovery_use_labelimg",ITEMS_BEFORE_AFTER:"harf_recovery_have_labelimg"}},POPUP_METHODS:{PULLDOWN_STOPS:{DEFAULT:[0,1,2,3,4,5,6,7,8,9,10],ENERGY_SEED:[0,1,2,3,4,5,10,20,30,40,50]},MAX_QUEST_POINTS:{AP:999,BP:99,DEFAULT:999},ITEM_IDS:{ENERGY_SEED:9},setItemFull:function(e){this._itemFull=e},setItemHalf:function(e){this._itemHalf=e},setCurrentQuestPoints:function(e){this._currentQuestPoints=e},setMaxQuestPoints:function(e){this._maxQuestPoints=e},setQuestPointType:function(e){this._questPointType=e},setNeedBattlePoint:function(e){this._needBattlePoint=e},createPulldowns:function(){this._createPulldownFull(),this._createPulldownHalf()},onUse:function(e){this._onUse=e},onCancel:function(e){this._onCancel=e},cleanUp:function(){return this._pulldownFull.releaseMenu(),this._pulldownHalf.releaseMenu(),Q.all(t(this.WIDGET_NAMES.FULL).values().concat(t.values(this.WIDGET_NAMES.HALF)).map(function(e){var t={};return t[e]="",this.setHtmlStrings(t,n.GameConfig.POPUP_CSS)},this).value())},_setBeforeAndAfterCount:function(e,t,i){var a={};return a[this.WIDGET_NAMES[i].ITEMS_BEFORE_AFTER]=this._generateAmountBoxContent(e,t),this.setHtmlStrings(a,n.GameConfig.POPUP_CSS)},_setBeforeAndAfterQuestPoint:function(e,t,i){var a={};return a[this.WIDGET_NAMES[i].POINTS_BEFORE_AFTER]=this._generateAmountBoxContent(e,t),this.setHtmlStrings(a,n.GameConfig.POPUP_CSS)},_generateAmountBoxContent:function(e,t){return'<table class="nb"><tr style="-moz-transform: none !important;-webkit-transform: none !important;"><td class="numbox_middle_mini"><span class="white">'+e+'&rarr;</span><span class="'+this._getAmountAfterTextColor(e,t)+'">'+t+"</span></td></tr></table>"},_getAmountAfterTextColor:function(e,t){return t>e?"yellow":e>t?"red":"white"},_calculatePulldownLength:function(e){for(var t=this._getmaxQuestPoints(e),n=this._getItemRecoveryValue(e),i=e.num,a=t-this._currentQuestPoints,o=Math.floor(a/n),r=Math.min(o,i),s=this._getPulldownStops(e),c=1;c<s.length&&!(r<s[c]);c++);return c},_getmaxQuestPoints:function(e){var t=0;switch(e.type){case"ap_gain":t=this.MAX_QUEST_POINTS.AP;break;case"bp_gain":t=this.MAX_QUEST_POINTS.BP;break;default:t=this.MAX_QUEST_POINTS.DEFAULT}return t},_getPulldownStops:function(e){return e.item_id===this.ITEM_IDS.ENERGY_SEED?this.PULLDOWN_STOPS.ENERGY_SEED:this.PULLDOWN_STOPS.DEFAULT},_createPulldownChoices:function(e){var n=this._getPulldownStops(e),i=t.range(this._calculatePulldownLength(e));return t.map(i,function(e){var t=n[e];return{text:t.toString(),value:t}})},_createPulldownFull:function(){this._pulldownFull=this._createPulldown(this.seekWidgetByPath("group_panel_0.btn_pulldown"),this._createPulldownChoices(this._itemFull),this._onPulldownSelectFull,this,0)},_createPulldownHalf:function(){this._pulldownHalf=this._createPulldown(this.seekWidgetByPath("group_panel_1.btn_pulldown"),this._createPulldownChoices(this._itemHalf),this._onPulldownSelectHalf,this,this._getDefaultSelectValue(this._itemHalf))},_getDefaultSelectValue:function(e){var t=this._getmaxQuestPoints(e);if(e.recovered_amount>=t)return 0;if(e.item_id===this.ITEM_IDS.ENERGY_SEED){var n=this._currentQuestPoints,i=this._needBattlePoint;if(i>n)return i>n+e.num?0:i-n}return e.num?1:0},_createPulldown:function(e,t,i,a,o){var r=e.seekWidgetByName("amount_label"),s=new n.Pulldown({button:e,label:r,menuBase:!0,choice:!0},t);return s.onChange(i,a),s.selectValue(o),s},_onPulldownSelectFull:function(e){this._onPulldownSelect(e,"FULL")},_onPulldownSelectHalf:function(e){this._onPulldownSelect(e,"HALF")},_onPulldownSelect:function(e,t){var n="FULL"===t?this._itemFull:this._itemHalf,i=0===e.value,a="FULL"===t?this._pulldownHalf:this._pulldownFull;this._setItemSelectedNumber(e.value,t),this._setBeforeAndAfterCount(n.num,n.num-e.value,t),this._setBeforeAndAfterQuestPoint(this._currentQuestPoints,this._getQuestPointsAfter(e.value,n),t),i||a.selectValue(0),this._updateButtonStatus()},_setItemSelectedNumber:function(e,t){"FULL"===t?this._itemFullSelected=e:this._itemHalfSelected=e},_getItemRecoveryValue:function(e){return e.recovered_amount-this._currentQuestPoints},_getQuestPointsAfter:function(e,t){return this._currentQuestPoints+e*this._getItemRecoveryValue(t)},_updateButtonStatus:function(){var e=this._itemFullSelected+this._itemHalfSelected>0;n.pc.roles.UIUtility._setEnableButton(this.blueBtn,e)},_useItems:function(){var t=this._getSelectedItemInfo(),i=this._getSelectedItemAmount(),a=t.a_item_id,o={item:t,beforeAP:this._currentQuestPoints,onUse:this._onUse};return n.createInstance("apiAItems").useItem(a,i).then(function(e){return o.countBefore=e.body.num+i,o.count=e.body.num,this._updateQuestPoints()}.bind(this)).then(function(e){return o.afterAP=e[this._questPointType.toLowerCase()],n.createInstance("popupFactoryComUseResult").create({}).open(o)}.bind(this)).fail(function(t){e.console.error(t)})},_getSelectedItemInfo:function(){return this._itemFullSelected>this._itemHalfSelected?this._itemFull:this._itemHalf},_getSelectedItemAmount:function(){return this._itemFullSelected||this._itemHalfSelected},_updateQuestPoints:function(){var e=cc.director.getRunningScene();return Q.fcall(function(){return e.headerDelegate&&t.isFunction(e.headerDelegate.updateQuestPoints)?e.headerDelegate.updateQuestPoints():n.createInstance("myselfInfoRepository").getQuestPoints(!0).then(function(e){return e.getAsObject()})}).then(function(n){return e._delegate&&t.isFunction(e._delegate.updateQuestPoints)?e._delegate.updateQuestPoints():n})}},onPopupOpened:function(e,i){e.WIDGET_NAMES=this.WIDGET_NAMES,e.BUTTON_FRAME_NAMES=this.BUTTON_FRAME_NAMES;var a=(i.property||"bp").toUpperCase(),o=i.questTitle||"",r=i.item||{},s=i.itemLittleRecover||{},c=i.needBattleBp||0;e.setItemFull(r),e.setItemHalf(s),e.setQuestPointType(a),e.setCurrentQuestPoints(i.currentQuestPoints),e.setMaxQuestPoints(i.maxQuestPoints),e.onUse(i.onUse),e.onCancel(i.onCancel||function(){}),e.setNeedBattlePoint(c),e.createPulldowns(),e.loadTextures({comp_recovery_img:n.Img("corecard","item",t.padZero(r.item_id,4)).jpg,harf_recovery_img:n.Img("corecard","item",t.padZero(s.item_id,4)).jpg});var u=new RegExp("{{([^}]+)}}","g"),l=function(e){return function(t,n){return e[n]}},_="{{property}}".replace(u,l({property:a})),p={none_labelimg:"<div class='text_com_need_ap_bp1'>{{questTitle}}<br /><span class='red'>{{property}}</span><br />{{property}}</div>".replace(u,l({questTitle:o,property:a}))};"mypage"===i.component&&(_="{{property}}".replace(u,l({property:a})),p.none_labelimg="<br/><br/><div>{{property}}</div>".replace(u,l({property:a}))),e.setTitle(_),e.setHtmlStrings(p,n.GameConfig.POPUP_CSS),r.num<=0?e.seekWidgetByName("comp_recovery_img").setColor(cc.color("#808080")):e.seekWidgetByName("comp_recovery_img").setColor(cc.color("#ffffff")),s.num<=0?e.seekWidgetByName("harf_recovery_img").setColor(cc.color("#808080")):e.seekWidgetByName("harf_recovery_img").setColor(cc.color("#ffffff")),e.setStrings({comp_recovery_label:r.name,harf_recovery_label:s.name})},_addMethodsToPopup:function(e){n.PopupFactoryPopupCommon.prototype._addMethodsToPopup.call(this,e),t.assign(e,this.POPUP_METHODS)}})}((this||0).self||global),function(e){var t=e._,n=e.kh,i=e.console;e.cc,n.PopupFactoryComNeedApBp2=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-com_need_ap_bp_2",title:"AP",buttonLabels:{blackBtn:""},buttons:{blackBtn:function(){this._onCancel(),this._clearData(),this.dismiss()}}},WIDGET_NAMES:{EXPLANATION_LABEL:"none_labelimg"},BUTTON_NAMES:{PSEUDO_CURRENCY_BUY:"btn_coin_shop",PSEUDO_CURRENCY_EXCHANGE:"btn_coin_change",STONE_EXCHANGE:"btn_stone_change"},EXPLANATION_TEXT_HTML:"<div class='text_com_need_ap_bp2'>{questName}<br /><span class='red'>{recoveryType}</span><br />{recoveryType}</div>",EXPLANATION_MYPAGE_TEXT_HTML:"<br /><br />{recoveryType}",POPUP_METHODS:{initializeButtons:function(){this._restoreItemVendingProcessController.initializeButtons(this)},initializeLabels:function(e,t){this._restoreItemVendingProcessController.initializeCurrencyAmountLabels(this),this._setExplanationText(e,t)},onCancel:function(e){this._onCancel=e},_initializeRestoreItemVendingProcessController:function(e){n.vending_process.WithoutResultPopupDIConfig.apply(),this._restoreItemVendingProcessController=n.createInstance("RestoreItemVendingProcessController",[this._recoveryType,e]),this._restoreItemVendingProcessController.setOnTransactionCompletedCallback(this._onBuyCallback,this)},_preload:function(){this._restoreItemVendingProcessController.preload()},_clearData:function(){this._clearExplanationText(),n.vending_process.DIConfig.apply()},_onBuyCallback:function(){var e;this._clearData(),e="AP"===this._recoveryType?n.createInstance("apiAItems").getApGain():n.createInstance("apiAItems").getBpGain(),Q.all([e,n.createInstance("myselfInfoRepository").getQuestPoints(!0),this.dismiss()]).spread(function(e,t){n.createInstance("popupFactoryComNeedApBp").create({items:e.body,questPoints:t.getAsObject()}).open()}.bind(this)).fail(function(e){i.error(e)})},_setExplanationText:function(e,t){var i=this.EXPLANATION_TEXT_HTML.replace("{questName}",e).replace("{recoveryType}",this._recoveryType).replace("{recoveryType}",this._recoveryType);"mypage"===t.component&&(i=this.EXPLANATION_MYPAGE_TEXT_HTML.replace("{recoveryType}",this._recoveryType));var a={};a[this.WIDGET_NAMES.EXPLANATION_LABEL]=i,this.setHtmlStrings(a,n.GameConfig.POPUP_CSS)},_clearExplanationText:function(){this._getWidget(this.WIDGET_NAMES.EXPLANATION_LABEL).loadTexture("")},_getWidget:function(e){return khutil.getWidgetFromNode(this,e,function(e){i.warn("PopupFactoryComNeedApBp2._getWidget: "+e)})}},onPopupOpened:function(e,i){var a=(i.property||"bp").toUpperCase(),o=i.item||{},r=i.itemLittleRecover||{},s=i.questTitle;e.initializeButtons(),e.initializeLabels(s,i),e.onCancel(i.onCancel||function(){}),e.loadTextures({comp_recovery_img:n.Img("corecard","item",t.padZero(o.item_id,4)).jpg,harf_recovery_img:n.Img("corecard","item",t.padZero(r.item_id,4)).jpg});var c=new RegExp("{{([^}]+)}}","g"),u=function(e){return function(t,n){return e[n]}},l="{{property}}".replace(c,u({property:a}));"mypage"===i.component&&(l="{{property}}".replace(c,u({property:a}))),e.setTitle(l),e.setStrings({comp_recovery_label:o.name,harf_recovery_label:r.name})},configure:function(e,i){n.PopupFactoryPopupCommon.prototype.configure.call(this,e,i),e.WIDGET_NAMES=this.WIDGET_NAMES,e.BUTTON_NAMES=this.BUTTON_NAMES,e.EXPLANATION_TEXT_HTML=this.EXPLANATION_TEXT_HTML,e.EXPLANATION_MYPAGE_TEXT_HTML=this.EXPLANATION_MYPAGE_TEXT_HTML,t.assign(e,this.POPUP_METHODS),this._eventIdInfo=this._eventIdInfo||{},e.getEventId=function(e){return function(){return e.eventId}}(this._eventIdInfo),e.getEpicId=function(e){return function(){return e.epicId}}(this._eventIdInfo),e.getQuestId=function(e){return function(){return e.questId}}(this._eventIdInfo),e.open=function(e){return function(t){this._recoveryType=t.property.toUpperCase();var i=n.createInstance("VendingLocationInformation");i.setComponent(t.component);var a=this.getEventId();null!=a&&i.setEventId(a);var o=this.getEpicId();null!=o&&i.setEpicId(o);var r=this.getQuestId();return null!=r&&i.setQuestId(r),this._initializeRestoreItemVendingProcessController(i),this._preload(),e.apply(this,arguments)}}(e.open)},setEventId:function(e){this._eventIdInfo=this._eventIdInfo||{},this._eventIdInfo.eventId=e},setQuestId:function(e){this._eventIdInfo=this._eventIdInfo||{},this._eventIdInfo.questId=e},setEpicId:function(e){this._eventIdInfo=this._eventIdInfo||{},this._eventIdInfo.epicId=e}})}((this||0).self||global),function(e){var t=e._,n=e.kh;n.PopupFactoryComUseResult=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-com_use_result",title:"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(){this.dismiss().then(function(){return t.isFunction(this._onUse)?this._onUse(this._afterQuestPoints):void n.createInstance("sceneManager").reloadScene()}.bind(this))}},buttonSounds:{blueBtn:n.SoundList.BUTTON_TOUCHED_CONFIRMED}},POPUP_METHODS:{},onPopupOpened:function(e,i){var a=i.item||{},o=i.count,r=null!=i.countBefore?i.countBefore:o+1,s="ap_gain"===i.item.type,c=i.beforeAP,u=i.afterAP,l=new RegExp("{{([^}]+)}}","g"),_=function(e){return function(t,n){return e[n]}};e._onUse=i.onUse,e._afterQuestPoints=u;var p='<table class="nb"><tr><td class="numbox_middle_mini"><span class="white">{{before}}&rarr;</span><span class="yellow">{{after}}</span></td></tr></table>';e.setHtmlStrings({ap_bp_labelimg:p.replace(l,_({before:c,after:u})),have_labelimg:p.replace(l,_({before:r,after:o}))},n.GameConfig.POPUP_CSS),e.loadTextures({elixir_or_elixir_half_img:n.Img("corecard","item",t.padZero(a.item_id,4)).jpg}),e.setStrings({ap_bp_heal_label:s?"AP":"BP",elixir_or_elixir_half_have_label:"{{item}}\n".replace(l,_({item:a.name}))})},_addMethodsToPopup:function(e){n.PopupFactoryPopupCommon.prototype._addMethodsToPopup.call(this,e),t.assign(e,this.POPUP_METHODS)}})}((this||0).self||global),function(e){var t=e._,n=e.kh;n.PopupFactoryComQuestInfo=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-q_info",title:"",buttonLabels:{blueBtn:"OK"},buttonSounds:{blueBtn:n.SoundList.BUTTON_TOUCHED_CONFIRMED},buttons:{blueBtn:function(e){this.dismiss()}}},WIDGET_NAMES:{},POPUP_METHODS:{},create:function(e,i){return n.PopupFactory.prototype.create.call(this,t.assign(e,this.POPUP_PROPERTIES),i)},_addMethodsToPopup:function(e){n.PopupFactoryPopupCommon.prototype._addMethodsToPopup.call(this,e),t.assign(e,this.POPUP_METHODS)},onPopupOpened:function(e,t){console.log(e,t),e.seekWidgetByName("title_label").setString(t.title),e.seekWidgetByName("synopsis_label").setString(t.description),e.seekWidgetByName("condition_label").setString(t.start_condition)}})}((this||0).self||global),function(e){var t=(e._,e.kh);e.cc,e.ccui,t.PopupFactoryComAgeLimitB=t.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-com_age_limit_b",title:"",buttonLabels:{redBtn:"R",blackBtn:""},buttonSounds:{redBtn:t.SoundList.BUTTON_TOUCHED_DECIDE,blackBtn:t.SoundList.BUTTON_TOUCHED_DECIDE},buttons:{redBtn:function(e){this.dismiss().then(function(){if(t.env.R18GameURL){var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null);var n=document.createElement("a");n.target="_top",n.href=t.env.R18GameURL,n.dispatchEvent(e)}})},blackBtn:function(e){this.dismiss()}}},POPUP_METHODS:{},onPopupOpened:function(e,t){}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.createNameSpaceIfNotExists("core.view"),n.core.view.ImplantedEventSubTutorialPopup=n.core.view.ImplantedSubTutorialPopup.extend({_eventId:null,_initContents:function(e,t){this._eventId=e,this._super(null,t)},_createPageList:function(e){return t.map(t.range(e),function(e){return this._createPage(n.Img("popupsub","event",t.padZero(this._eventId,4),e+1).png)},this)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("core.treasure_panel"),t.core.treasure_panel.TreasureModel=n.Class.extend({ClassName:"TreasureModel",ctor:function(e){this._rawData=e},getStock:function(){return t.createInstance("StockInfoModel",[this._rawData.stock_info])},getAmount:function(){return this._rawData.amount},getName:function(){return this._rawData.name}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("core.treasure_panel"),t.core.treasure_panel.TreasureNameView=n.Class.extend({ClassName:"TreasureNameView",show:function(e,t){var n=e.seekWidgetByName("name_label"),i=t.getName();i+=_.isFinite(t.getAmount())?"x"+t.getAmount():i,n.setText(i)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("core.treasure_panel"),t.core.treasure_panel.StockInfoModel=n.Class.extend({ClassName:"StockInfoModel",ctor:function(e){this._rawData=e},getAmount:function(){return this._rawData.amount},getDescription:function(){return this._rawData.type},hasStock:function(){return this._rawData&&this._rawData.has},hasDailyLimit:function(){return//.test(this._rawData.type)},hasMonthlyLimit:function(){return//.test(this._rawData.type)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("core.treasure_panel"),t.core.treasure_panel.StockInfoView=n.Class.extend({ClassName:"StockInfoView",show:function(e,t){if(t.hasStock()){var n=e.seekWidgetByName("stock_label"),i=e.seekWidgetByName("stock_num_label");n.setText(t.getDescription()),i.setText(t.getAmount().toString()),e.setVisible(!0)}else e.setVisible(!1)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e._,t.createNameSpaceIfNotExists("conquest.model"),t.conquest.model.QuestEvent=n.Class.extend({prepare:function(e){return this._eventId=e,this.update()},update:function(){return this._getQuestEventPromise(this._eventId).then(function(e){return this._eventData=e.body,this}.bind(this))},_getQuestEventPromise:function(e){return t.createInstance("apiAEvents").getQuestEvent(e).fail(function(e){console.warn(e)})},getRawEventData:function(){return this._eventData},isGuerrillaQuestHaveEmerged:function(){return null==this._eventData&&console.error("[QuestEventModel::isGuerrillaQuestHaveEmerged]\nYou must call prepare first!"),this._eventData.guerrilla_quest_have_emerged},isExistNotClearedScenario:function(){return null==this._eventData&&console.error("[QuestEventModel::isExistNotClearedScenario]\nYou must call prepare first!"),this._eventData.exist_not_cleared_scenario},getDescriptionImages:function(){return null==this._eventData&&console.error("[QuestEventModel::getDescriptionImages]\nYou must call prepare first!"),this._eventData.description_images||[]}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc.quest=t.pc.quest||{},t.pc.conquest.roles=t.pc.conquest.roles||{},t.pc.conquest.roles.QuestPageListController={_popups:{comQuestInfo:{factoryName:"popupFactoryComQuestInfo"}},_fillupEventQuestList:function(e,t,n,i){this.__fillupScenarioQuestList(e,n,i,t.exist_not_cleared_scenario),this.__fillupNotScenarioQuestList(e,n,i,t.guerrilla_quest_have_emerged)},__fillupScenarioQuestList:function(e,n,i,a){var o=t.createInstance("apiAQuests").getListEventScenarioQuest(n);this.__fillupQuestList(e,"tab_1_node",o,i),e.seekWidgetByName("icon_1").setVisible(a)},__fillupNotScenarioQuestList:function(e,n,i,a){var o=t.createInstance("apiAQuests").getListEventNotScenarioQuest(n);this.__fillupQuestList(e,"tab_0_node",o,i),e.seekWidgetByName("icon_0").setVisible(a)},__fillupQuestList:function(e,n,o,r){var s=e.seekWidgetByName(n);if(null!==s){var c=e.seekWidgetByName("con_005_questlist_page_ui");null!==c&&c.removeFromParent();var u,l=this._initFuncRaidPanel.bind(this);return u=i.isObject(this._questInfo)&&this._questInfo.in_progress?a.resolve({body:this._questInfo}):t.createInstance("apiAQuestInfo").get(),a.all([o,u]).spread(function(e,n){this._in_progress_id=this._pickInProgressAQuestId(n.body);var a={targetNode:"quest_base",touchEventFuncName:r};if($staticRes(res["conquest-con_005-con_005_questlist_page_ui"]),this._fillupList(s,{viewParent:"page_quest_list",subPageRes:t.PageListParams.CONQUEST_QUEST_LIST.subPageRes,panelsPerPage:t.PageListParams.CONQUEST_QUEST_LIST.perPage},e.body.data,e.body.max_record_count,a,l),0===e.body.max_record_count)i.isFunction(this._showNothingLabel)?this._showNothingLabel(s):console.warn("[ERROR] You sould assign UIUtility role.");else{var o=s.seekWidgetByName("list_node");null===o?console.warn("[ERROR] You sould assign UIUtility role."):o.setVisible(!0)}return e.body}.bind(this)).fail(function(e){console.error(e.stack)})}console.warn("[ERROR] Could not find a list parent node.")},_showNothingLabel:function(e){var t=e.seekWidgetByName("nothing_node");null!==t&&t.setVisible(!0)},_pickInProgressAQuestId:function(e){if(i.isEmpty(e)||i.isEmpty(e.in_progress))return null;var t=e.in_progress.own_quest;if(i.isEmpty(t))return null;var n=t.type;return"event_quest_main"!==n&&"event"!==n?null:t.a_quest_id},_initFuncRaidPanel:function(e,a){var o="event_quest_main"===a.type?"scenario":"quest";e.animate(o);var r=e.seekWidgetByName("questimg");if(null!==r&&!i.isUndefined(a.quest_id)){var s=t.Img("questimg","event-quest",i.padZero(a.quest_id,4),1).jpg;r.loadTexture(s)}var c=e.seekWidgetByName("quest_header_label");null===c||i.isUndefined(a.title)||c.setString(a.title);var u=e.seekWidgetByName("quest_time_label");null!==u&&(i.isString(a.time_left)&&a.time_left.length>0?(u.setString(a.time_left),u.setVisible(!0)):u.setVisible(!1));var l=e.seekWidgetByName("cons_ap_label");null===l||i.isUndefined(a.quest_ap)||l.setString("AP"+a.quest_ap);var _=e.seekWidgetByName("quest_reward");if(null!==_)if(a.is_cleared||i.isUndefined(a.reward_info)||i.isUndefined(a.reward_info.item_id))_.setVisible(!1);else{var p=t.Img("rewardicon","item",i.padZero(a.reward_info.item_id,4)).png;_.loadTexture(p),_.setVisible(!0)}var d=e.seekWidgetByName("name_use_label"),h=a.required_item;null===d||i.isEmpty(h)||i.isUndefined(h)||i.isUndefined(h.name)||d.setString(h.name+" "+(h.amount||"-"));var m=!!i.isEmpty(h)||h.possession_amount>=h.amount;e.setColor(m?n.color.WHITE:n.color("#808080"));var g=e.seekWidgetByName("time_rest_label");null===g||i.isUndefined(a.time_left)||g.setString(a.time_left);var f=e.seekWidgetByName("cons_label");if(null!==f&&!i.isUndefined(a.event_info)&&!i.isUndefined(a.event_info.type)){var b=a.event_info.type;switch(f.setVisible(!0),b){case"quest_ap_half":f.setString(t.WordBook.quest_ap_half);break;case"quest_ap_free":f.setString(t.WordBook.quest_ap_free);break;default:f.setVisible(!1)}}var v=e.seekWidgetByName("img_quest_info_icon");if(v){var E=v.getParent();if(!i.isUndefined(a.is_new)&&!i.isUndefined(a.is_cleared)){var y=this._in_progress_id==a.a_quest_id&&null!==a.a_quest_id,P=a.is_new||a.is_cleared||y,I="";y?I="core/res/icon/queststatusicon_now.png":a.is_new?I="core/res/icon/queststatusicon_new.png":a.is_cleared&&(I="core/res/icon/queststatusicon_clear.png"),v.loadTexture(I,ccui.Widget.PLIST_TEXTURE),v.setVisible(P),E.setVisible(P),a.is_new?E.animate("new",!0):E.animate("default",!1)}}var C=e.seekWidgetByName("btn_icon_balloon");if(C){var N="event_quest_main"===a.type,A=a.limit_info;N||i.isEmpty(A)||(N=i.isNumber(A.elixir)&&A.elixir>=0||i.isNumber(A.rank)&&A.rank>=0||i.isNumber(A.remaining_challenge_count)&&A.remaining_challenge_count>=0),C.setVisible(N),C.setEnabled(N),N&&this.__setBalloonButtonEventHandler(C,a)}},__setBalloonButtonEventHandler:function(e,t){var i=function(e,i){if(i===ccui.Widget.TOUCH_ENDED){var a=n.director.getRunningScene();"event_quest_main"===t.type?this._showQInfoPopup(a,t):this._qCaution3Popup(a,t)}}.bind(this);e.addTouchEventListener(i)},_showQInfoPopup:function(e,t){var n=e.popups.comQuestInfo,a=t.title,o=t.limit_info,r="";if(!i.isEmpty(o)){var s=[];i.isNumber(o.elixir)&&o.elixir>=0&&s.push(0!==o.elixir?":"+o.elixir+"":""),i.isNumber(o.rank)&&o.rank>=0&&s.push("Rank "+t.limit_info.rank+""),i.isNumber(o.remaining_challenge_count)&&o.remaining_challenge_count>=0&&s.push("  "+t.limit_info.remaining_challenge_count+""),r="[] "+s.join("\n")}n.open({title:a,description:t.description,start_condition:r}).fail(function(e){console.error(e.stack)})}},i.assign(t.pc.conquest.roles.QuestPageListController,t.pc.roles.CoreCardCommon,t.pc.list.roles.PageListControllerCommon)}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.conquest=t.pc.conquest||{},t.pc.conquest.con_000=t.pc.conquest.con_000||{},t.pc.conquest.con_000.Scene=t.BaseScene.extend({resourceFileName:"con_000/con_000.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"conquest",sceneName:"con_000",_delegate:null,_init:function(){this._initScene("page_in")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._,e.Q);t.pc=t.pc||{},t.pc.conquest=t.pc.conquest||{},t.pc.conquest.con_000=t.pc.conquest.con_000||{},t.pc.conquest.con_000.SceneDelegate=t.pc.BaseSceneDelegate.extend({_popups:{},onSceneInit:function(e){this._verifyRouterParams000(e);var n=e.routerParams.con_000.event_id;return this._setBackBtn(e),t.createInstance("apiAEvents").getQuestEventNotice(n).then(function(i){this._eventNoticeData=i.body,this._setBackgroundImage(e,"con_000",this._eventNoticeData.event_type),this._eventNoticeData.first_access&&t.createInstance("apiAEvents").updateQuestEventNoticeFirstAccess(n,!1).fail(function(e){console.error(e.stack)})}.bind(this)).fail(function(e){console.error(e.stack)})},onSceneEnter:function(e){return n.defer(),n.resolve()},onSceneExit:function(e){return n.defer(),n.resolve()},onPageInAnimationEnd:function(e){return n.defer(),n.resolve()},btnCallbackBtnHelp:function(e){var t=n.defer();return t.reject(this._override),this._navigateToHe002(e),t.promise},_touchEndedBackBtnProcess:function(e){this._navigateToMy001()}}),t.assignRoles(t.pc.conquest.con_000.SceneDelegate,[t.pc.roles.UIUtility,t.pc.conquest.roles.Routing,t.pc.conquest.roles.Background])}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.conquest=t.pc.conquest||{},t.pc.conquest.con_001=t.pc.conquest.con_001||{},t.pc.conquest.con_001.Scene=t.BaseScene.extend({resourceFileName:"con_001/con_001.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"conquest",sceneName:"con_001",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath("conquest_btn_sp-quest_ui"),"btn_quest","btnCallbackConquestBtnSpQuestUiBtnQuest",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"conquest/con_005")),this._initButtonEvent.call(this,this.seekWidgetByPath("conquest_btn_scenario_ui"),"btn_scenario","btnCallbackConquestBtnScenarioUiBtnScenario",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"conquest/con_005")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_interchange","btnCallbackBtnInterchange",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"conquest/con_002")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_blue_l","btnCallbackBtnBlueL",null,function(){alert("{{popup_uicon_001_popup_ui.jsonsub_tutorialpopup_ui}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=(e._,e.Q);t.pc=t.pc||{},t.pc.conquest=t.pc.conquest||{},t.pc.conquest.con_001=t.pc.conquest.con_001||{},t.pc.conquest.con_001.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../con_001_popup_ui.json"],SUB_TUTORIAL_PAGE_NAME:"con_001_",_popups:{},_eventType:null,onSceneInit:function(e){this._verifyRouterParams001(e);var n=this._getEventId();this._setBackBtn(e),e.contentLayer.seekWidgetByName("Scene").setVisible(!1);var a=t.createInstance("questEventModel");this._setQuestBtn(a.isGuerrillaQuestHaveEmerged()),this._setScenarioBtn(a.isExistNotClearedScenario());var o=a.getRawEventData();return this._eventType=o.event_type,this._setEventName(e,o),this._setBackgroundImage(e,"con_001",this._isQuestStoryEvent()),this._showExchangeableLabelNode(e,o),this._setExchangeRequiredTreasure(o,"corecard_item_ui_64"),o.first_access?this._initAnimation(e,n).then(function(){e.contentLayer.seekWidgetByName("Scene").setVisible(!0),this._startQuestEventAnimation(e,{eventId:n}).then(function(){t.createInstance("apiAEvents").updateQuestEventFirstAccess(n,!1).fail(function(e){console.error(e)}),this._showSubTutorialIfVisited(n)}.bind(this))}.bind(this)):(e.contentLayer.seekWidgetByName("Scene").setVisible(!0),this._showSubTutorialIfVisited(n),i.resolve())},onSceneEnter:function(e){var n=this._getEventId();return t.createInstance("questEventModel").prepare(n)},onPageInAnimationEnd:function(e){var n=t.createInstance("questEventModel");return this._setQuestBtn(n.isGuerrillaQuestHaveEmerged()),this._setScenarioBtn(n.isExistNotClearedScenario()),i.resolve()},_getEventId:function(){var e=n.director.getRunningScene();return e.routerParams.con_001.event_id||e.routerParams.con_001.id},_getEventType:function(){return this._eventType},_isQuestStoryEvent:function(){return"quest_story_event"===this._eventType},_showSubTutorialIfVisited:function(e){var n=this.SUB_TUTORIAL_PAGE_NAME+e;t.createInstance("apiASubTutorialPages").get(n).then(function(i){i.body.visited||(this._showHelp(e),t.createInstance("apiASubTutorialPages").visited(n))}.bind(this)).fail(function(e){console.error(e)})},_showHelp:function(e){var i=n.director.getRunningScene();t.ImplantedPopup.createOrGet(i,"sub_tutorial","ImplantedEventSubTutorialPopup").open(e,t.createInstance("questEventModel").getDescriptionImages().length)},btnCallbackConquestBtnSpQuestUiBtnQuest:function(e){return this._navigateToQuestList(this._getEventId()),i.reject(this._override)},btnCallbackConquestBtnScenarioUiBtnScenario:function(e){var t=this._getEventId();return this._navigateToScenarioList(t),i.reject(this._override)},btnCallbackBtnInterchange:function(e){var t=this._getEventId(),n=this._getEventType();return this._navigateTo002(e,t,n),i.reject(this._override)},btnCallbackBtnBlueL:function(e){var t=this._getEventId();return this._showHelp(t),i.reject(this._override)},btnCallbackBtnHelp:function(e){return this._navigateToHe002(e),i.reject(this._override)},_setQuestBtn:function(e){var t=this._getQuestBtn();t.setVisible(!0),e?t.setAppearance("attention_view"):t.setAppearance("default_view")},_setScenarioBtn:function(e){var t=this._getScenarioBtn();return this._isQuestStoryEvent()?(t.setVisible(!0),void(e?t.setAppearance("attention_view"):t.setAppearance("default_view"))):void t.setVisible(!1)},_getQuestBtn:function(){return n.director.getRunningScene().seekWidgetByName("conquest_btn_sp-quest_ui")},_getScenarioBtn:function(){return n.director.getRunningScene().seekWidgetByName("conquest_btn_scenario_ui")},_touchEndedBackBtnProcess:function(e){this._navigateToEv000()}}),t.assignRoles(t.pc.conquest.con_001.SceneDelegate,[t.pc.roles.UIUtility,t.pc.conquest.roles.Routing,t.pc.conquest.roles.Background,t.pc.conquest.roles.Animation,t.pc.conquest.roles.Treasure])}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.conquest=t.pc.conquest||{},t.pc.conquest.con_002=t.pc.conquest.con_002||{},t.pc.conquest.con_002.Scene=t.BaseScene.extend({resourceFileName:"con_002/con_002.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"conquest",sceneName:"con_002",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath("conquest_btn_sp-quest_ui"),"btn_quest","btnCallbackConquestBtnSpQuestUiBtnQuest",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"conquest/con_005")),this._initButtonEvent.call(this,this.seekWidgetByPath("sh_weapon_info"),"btn_popup_close","btnCallbackShWeaponInfoBtnPopupClose",null,function(){alert("{{popup_ui}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("sh_summon_info"),"btn_popup_close","btnCallbackShSummonInfoBtnPopupClose",null,function(){alert("{{popup_ui}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("sh_item_info"),"btn_popup_close","btnCallbackShItemInfoBtnPopupClose",null,function(){alert("{{popup_ui}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("sh_change_check"),"btn_pulldown","btnCallbackShChangeCheckBtnPulldown",null,function(){alert("{{}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("sh_change_check"),"btn_blue_l_0","btnCallbackShChangeCheckBtnBlueL0",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"enh_evo/enh_001_2_6_evo_001_2_3")),this._initButtonEvent.call(this,this.seekWidgetByPath("sh_change_check"),"btn_blue_l_1","btnCallbackShChangeCheckBtnBlueL1",null,function(){alert("{{sh_change_checksh_buy_result}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("sh_change_check"),"btn_popup_close","btnCallbackShChangeCheckBtnPopupClose",null,function(){alert("{{popup_ui}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("sh_buy_result"),"btn_popup_close","btnCallbackShBuyResultBtnPopupClose",null,function(){alert("{{popup_ui}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._,e.Q);t.pc=t.pc||{},t.pc.conquest=t.pc.conquest||{},t.pc.conquest.con_002=t.pc.conquest.con_002||{},t.pc.conquest.con_002.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../con_002_popup_ui.json"],_popups:{},_eventId:null,_eventType:null,onSceneInit:function(e){this._verifyRouterParams002(e);var n=e.routerParams.con_002.event_id;this._initQuestButtonAppearance(e),this._setQuestEventTreasureList(e,n),this._setBackBtn(e);var i=t.createInstance("questEventModel");return i.prepare(n).then(function(){var t=i.getRawEventData();this._eventId=t.event_id,this._eventType=t.event_type,this._setEventName(e,t),this._setBackgroundImage(e,"con_002",this._isQuestStoryEvent()),this._setQuestBtn(e,i.isGuerrillaQuestHaveEmerged()),this._setExchangeRequiredTreasure(t,"corecard_item_ui_52")}.bind(this)).fail(function(e){console.error(e.stack)})},_setQuestBtn:function(e,t){var n=this._getQuestButton(e);n.setVisible(!0),t?n.setAppearance("attention_view"):n.setAppearance("default_view")},_initQuestButtonAppearance:function(e){var t=this._isQuestStoryEvent()?"quest_view":"default_view";this._getQuestButton(e).setAppearance(t)},_getQuestButton:function(e){var t=e.seekWidgetByName("conquest_btn_sp-quest_ui");if(!t)throw new Error("conquest_btn_sp-quest-ui is not found");return t},_isQuestStoryEvent:function(){return"quest_story_event"===this._eventType},_getEventId:function(e){return this._eventId},_getEventType:function(){return this._eventType},onSceneEnter:function(e){return n.defer(),n.resolve()},onSceneExit:function(e){return n.defer(),n.resolve()},onPageInAnimationEnd:function(e){return n.defer(),n.resolve()},btnCallbackConquestBtnSpQuestUiBtnQuest:function(e){var t=e.routerParams.con_002.event_id;return this._navigateToQuestList(t),n.reject(this._override)},_popupClose:function(e){var t=e.seekWidgetByName("popup_ui");null!=t&&(t.setVisible(!1),t.animate("default_view",!1))},btnCallbackShWeaponInfoBtnPopupClose:function(e){var t=n.defer();return t.reject(this._override),this._popupClose(e),t.promise},btnCallbackShSummonInfoBtnPopupClose:function(e){var t=n.defer();return t.reject(this._override),this._popupClose(e),t.promise},btnCallbackShItemInfoBtnPopupClose:function(e){var t=n.defer();return t.reject(this._override),this._popupClose(e),t.promise},btnCallbackShChangeCheckBtnPulldown:function(e){var t=n.defer();return t.resolve(),t.promise},btnCallbackShChangeCheckBtnBlueL0:function(e){var i=n.defer();return i.reject(this._override),t.createInstance("router").navigate("enh_evo/enh_001"),i.promise},btnCallbackShChangeCheckBtnBlueL1:function(e){var t=n.defer();return t.reject(this._override),this.popupPulldown&&this.popupPulldown.releaseMenu(),this.popupPulldown=null,this._popupClose(e),this.exchange(this._selectedRecord,this._selectedValue),t.promise},btnCallbackShChangeCheckBtnPopupClose:function(e){var t=n.defer();return t.reject(this._override),this.popupPulldown&&this.popupPulldown.releaseMenu(),this.popupPulldown=null,this._popupClose(e),t.promise},btnCallbackShBuyResultBtnPopupClose:function(e){var t=n.defer();t.reject(this._override),this._popupClose(e);var i=e.routerParams.con_002.event_id;return this._refreshQuestEventTreasureList(e,i),this._refreshExchangeRequiredTreasure(e,i),"item"===this._selectedRecord.kind&&e.headerDelegate&&e.headerDelegate.updateCurrency&&e.headerDelegate.updateCurrency(),this._showEpisodePopup(e,this._selectedRecord),t.promise},_showEpisodePopup:function(e,n){"summon"!==n.kind&&"character"!==n.kind||n.is_material_item||0<n.have_num||this._getCharacterOrSummonMasterInfoPromise(n.kind,n.id).then(function(n){t.ImplantedPopup.createOrGet(e,"com_open_episode").open(n.body)})},_getCharacterOrSummonMasterInfoPromise:function(e,n){return t.createInstance({summon:"apiSummons",character:"apiCharacters"}[e]).get(n).fail(function(e){console.error(e.stack)})},btnCallbackBtnBackEventTop:function(e){var t=n.defer();t.reject(this._override);var i=this._getEventId(),a=this._getEventType();return this._navigateTo001(e,i,a),t.promise},_touchEndedBackBtnProcess:function(e){this.btnCallbackBtnBackEventTop()}}),t.assignRoles(t.pc.conquest.con_002.SceneDelegate,[t.pc.roles.UIUtility,t.pc.conquest.roles.Routing,t.pc.conquest.roles.Background,t.pc.conquest.roles.Treasure])}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.conquest=t.pc.conquest||{},t.pc.conquest.con_005=t.pc.conquest.con_005||{},t.pc.conquest.con_005.Scene=t.BaseScene.extend({resourceFileName:"con_005/con_005.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[{tab1:{node:"tab_0","content-node":"tab_0_node"},tab2:{node:"tab_1","content-node":"tab_1_node"}}],componentName:"conquest",sceneName:"con_005",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_back_event_top","btnCallbackBtnBackEventTop",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"conquest/con_001")),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc=t.pc||{},t.pc.conquest=t.pc.conquest||{},t.pc.conquest.con_005=t.pc.conquest.con_005||{},t.pc.conquest.con_005.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../con_005_popup_ui.json"],_popups:{comBackCheck:{factoryName:"popupFactoryComBackCheck"},comApRestart:{factoryName:"popupFactoryComApRestart"},q_001_ap_next:{factoryName:"popupFactoryPopupCommon",resourceName:"core-popup-q_001_ap_next",title:"",buttonLabels:{blueBtn:"OK",blackBtn:""},buttons:{blueBtn:function(e){this.dismiss(),e._delegate.startCheckQuestState(e,this._selectQuestData)},blackBtn:function(e){this.dismiss()}}},q_001_ap_open:{factoryName:"popupFactoryBlue",title:""+t.w("release")+"!",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){this.dismiss()}}}},questCommonDelegate:null,_apiPromise:null,ICON_IMG_PATH:{QUEST_NEW:"core/res/icon/queststatusicon_new.png",QUEST_CLEARED:"core/res/icon/queststatusicon_clear.png",QUEST_NOW:"core/res/icon/queststatusicon_now.png"},_eventId:null,_eventType:null,onSceneInit:function(e){t.createInstance("router").permanentlyRemoveRouterParam("payment_id"),this.questCommonDelegate=t.createInstance("questSceneCommonDelegate"),this.questCommonDelegate.owner=e;var n=this._getEventId();return this._setEventIdToApBpPopup(n),this._setBackBtn(e),this._apiPromise.spread(function(i){var a=i.body;this._eventType=a.event_type;var o=this._isQuestStoryEvent();if(this._setBackgroundImage(e,"con_005",o),this._setNavigator(o),this._setEventName(e,a),o)this._fillupEventQuestList(e,a,n,"_questPanelTapped");else{var r=t.createInstance("apiAQuests").getListEventQuest(n);this.__fillupQuestList(e,"tab_0_node",r,"_questPanelTapped")}e.seekWidgetByName("tab_ui").setVisible(o);var s=this._getInitTabName(e);this._selectTab(e,s)}.bind(this)).fail(function(e){e&&console.error(e)})},_getInitTabName:function(e){return e.routerParams.con_005&&e.routerParams.con_005.tab?e.routerParams.con_005.tab:"tab_0"},_selectTab:function(e,t){var n=e.tabDelegateList[0],i=e.seekWidgetByName(t);n.selectTab(i)},onSceneEnter:function(e){return a.defer(),t.createInstance("router").permanentlyRemoveRouterParam("payment_id"),this._setEventIdToApBpPopup(this._getEventId()),this._requestApi(),a.resolve()},onSceneExit:function(e){return a.defer(),this.questCommonDelegate=null,this._apiPromise=null,a.resolve()},onPageInAnimationEnd:function(e){return a.defer(),a.resolve()},btnCallbackBtnBackEventTop:function(e){var t=a.defer();return t.reject(this._override),this._navigateTo001(e,this._getEventId()),t.promise},_requestApi:function(){var e=this._getEventId();return this._apiPromise=this._apiPromise||a.all([t.createInstance("apiAEvents").getQuestEvent(e),this._updateOtherInformation()]),this._apiPromise},_getEventId:function(){return i.isNull(this._eventId)&&this._setEventId(),this._eventId},_setEventId:function(){var e=n.director.getRunningScene();this._eventId=e.routerParams.event_id||e.routerParams.con_005.event_id},_getEventType:function(){return this._eventType},_isQuestStoryEvent:function(){return"quest_story_event"===this._eventType},_setProgressIcon:function(e,t){var n=e.seekWidgetByName("img_quest_info_icon");n||console.error("img_quest_info_icon : not found",e);var a=n.getParent();if(!i.isUndefined(t.is_new)&&!i.isUndefined(t.is_cleared)){var o=t.is_new||t.is_cleared,r=t.is_new?this.ICON_IMG_PATH.QUEST_NEW:t.is_cleared?this.ICON_IMG_PATH.QUEST_CLEARED:"";n.loadTexture(r,ccui.Widget.PLIST_TEXTURE),n.setVisible(o),a.setVisible(o),t.is_new?a.animate("new",!0):a.animate("default",!1)}var s=this._questInfo;(s&&s.in_progress&&s.in_progress.own_quest&&t.a_quest_id===s.in_progress.own_quest.a_quest_id&&t.type===s.in_progress.own_quest.type||s&&s.in_progress&&s.in_progress.own_raid&&t.a_quest_id===s.in_progress.own_raid.a_quest_id)&&(n.setVisible(!0),n.loadTexture(this.ICON_IMG_PATH.QUEST_NOW,ccui.Widget.PLIST_TEXTURE),a.setVisible(!0),a.animate("default",!1))},_updateOtherInformation:function(){var e=t.createInstance("apiAQuestInfo"),n=t.createInstance("myselfInfoRepository");return a.all([e.get(),n.getQuestPoints(),n.getMe()]).spread(function(e,t,n){this._questInfo=e.body,this._questPoints=t.getAsObject(),this._player=n.body}.bind(this)).catch(function(e){console.error(e)})},_setNavigator:function(e){n.director.getRunningScene().seekWidgetByName("side_navi_0_ui").setVisible(e)},clearOwnQuest:function(){delete this._questInfo.in_progress.own_quest},_questPanelTapped:function(e,t){return i.isEmpty(t.required_item)||0===t.required_item.amount?this._doDefaultQuestStartingProcess(t):void(t.required_item.possession_amount>=t.required_item.amount?this._showNeedItemPopup(t):this._showNoItemPopup(t))},_showNeedItemPopup:function(e){var t=n.director.getRunningScene().popups.ra_need_item;t.open().then(function(){t._selectedQuestRecord=e,this.__setupPopupContentsForRaNoItemOrRaNeedItem(t,e)}.bind(this))},_showNoItemPopup:function(e){var t=n.director.getRunningScene().popups.ra_no_item;t.open().then(function(){this.__setupPopupContentsForRaNoItemOrRaNeedItem(t,e)}.bind(this))},__setupPopupContentsForRaNoItemOrRaNeedItem:function(e,n){var i=e.seekWidgetByName("need_item_list_ui");null!==i&&this._initFuncRaidPanel(i,n),e.setHtmlStrings({need_item_labelimg:this.__createRequiredItemsMessage(n)},t.GameConfig.POPUP_CSS)},__createRequiredItemsMessage:function(e){var t=e.required_item,n="<span class='white'>"+e.title+"       <br/><span class='orange'>"+t.name+"</span>      <span class='red'>"+t.amount+"</span> <br/>      <div style='margin: 0.5em 0;'><span class='orange'></span>"+t.possession_amount,i=t.possession_amount-t.amount;return i>=0&&(n+="&rarr;<span class='red'>"+i+"</span>"),n+"</div></span>"},update:function(){t.createInstance("sceneManager").reloadScene()},_doDefaultQuestStartingProcess:function(e){var t=n.director.getRunningScene();this.questCommonDelegate.restartCheckInProgressQuest(e,this._questInfo)||this.startCheckQuestState(t,e)},_setEventIdToApBpPopup:function(e){t.createInstance("popupFactoryComNeedApBp2").setEventId(e)},startQuest:function(e,t,n,i){if("event_quest_main"!==this._selectQuest.type){var a=this._getEventId(),o=this._getEventType();this._navigateToQ002(e,t,n,i,o,a)}else this._startStoryQuest(e,t.a_quest_id,t.quest_id)},_startStoryQuest:function(e,t,n,a){this._targetParam={a_quest_id:t,quest_id:n,quest_type:"event_quest_main"},this._supporterData={summon_info:{a_summon_id:0}},this.selectedEpisode={num:a},this._isLatestEpisode=!i.isUndefined(a),this._startQuest(e,0,this._supporterData)},tabCallbackTab0:function(e){},tabCallbackTab1:function(e){},_touchEndedBackBtnProcess:function(e){var t=this._getEventId(),n=this._getEventType();this._navigateTo001(e,t,n)}}),i.assign(t.pc.conquest.con_005.SceneDelegate.prototype._popups,t.pc.quest.roles.QuestSelectCommon.popups._popups,t.pc.quest.roles.QuestMainPageListPopups._popups),t.assignRoles(t.pc.conquest.con_005.SceneDelegate,[t.pc.roles.UIUtility,t.pc.conquest.roles.Routing,t.pc.conquest.roles.Background,t.pc.quest.roles.QuestStart,t.pc.quest.roles.QuestMainPageListController,t.pc.conquest.roles.QuestPageListController,t.pc.quest.roles.QuestSelectCommon.methods])}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;e.Q,t.pc.status=t.pc.status||{},t.pc.status.roles=t.pc.status.roles||{},t.pc.status.roles.AbilityCommon={_appendAbility:function(e,a,o,r,s){if(i.isUndefined(a.abilities))return 0;i.isUndefined(s)&&(s=$staticRes(res["core-statuslist-statuslist_ability_ui"])),i.isUndefined(r)&&(r="statuslist_ui_"),i.isUndefined(o)&&(o=0);var c=a.job_id>0,u=a.abilities.length,l=!1,_=t.createInstance("router").getCurrentFragment().endsWith("status_001");if(!_){var p=n.director.getRunningScene(),d=p.routerParams.de_001_002;i.isUndefined(d)||(_=!d.isOwn);var h=p.bfsWidgetByName("popup_ui").getAction().animationInfo;l=!!h.par_ability_change_check}return t.core.model.ability.AbilityListFactory.create(a.abilities,[],a).forEach(function(t,n){var i=t.getSelectedAbility(),u=this._createOrGetAbilityPanel(s,"ability_list_base",e,r,n+o);this._setAbilityPanelStrings(u,i);var d=u.seekWidgetByName("ability_learn_level_0"),h=u.seekWidgetByName("ability_learn_level_1");if(null!==d&&null!==h){var m=i.lv1over,g="Lv"+i.available_level;d.setString(g),h.setString(g),_||i.episode_cleared?(d.setVisible(m),h.setVisible(!1)):m&&(d.setVisible(!1),h.setVisible(!0),this.__setEpisodeButton(u,a,i)),i.createAbilityIconView(u).show();var f=l&&c&&t.isMultiple(),b=u.bfsWidgetByName("ability_list_change_btn"),v=u.bfsWidgetByName("ability_list_check_btn");if(!_&&f){var E={scene:p,record:a,abilityPanel:u,abilitySlotModel:t,delegate:this};v.setVisible(!t.learned()||!p.routerParams.party_id),v.addTouchEventListener(this._touchAbilityChangeCheck,E),b.setVisible(t.learned()&&p.routerParams.party_id),b.addTouchEventListener(this._touchAbilityChangeCheck,E)}else v.setVisible(!1),b.setVisible(!1);!f&&i.is_ex_ability&&null!=h&&(h.setVisible(!0),d.setString("EX"),d.setVisible(!0))}},this),u},__setEpisodeButton:function(e,t,n){var a=e.seekWidgetByName("ability_list_ep_btn");if(null!==a)return i.isUndefined(t.job_id)?(a.setVisible(!0),t.level<n.available_level?void this._setEnableButton(a,!1):void a.addTouchEventListener(function(e,t){t===ccui.Widget.TOUCH_ENDED&&this._touchEPButton()},this)):void a.setVisible(!1)},_touchAbilityChangeCheck:function(e,n){if(n===ccui.Widget.TOUCH_ENDED){var i=this.scene,a=this.abilityPanel,o="ability_list_check_btn"===e.getName();t.ImplantedPopup.create(i,"par_ability_change_check").open(this.abilitySlotModel,o).then(function(e){var n=e.abilitySlotModel,o=e.abilityModel;return n.select(o),this.delegate._setAbilityPanelStrings(a,o),o.createAbilityIconView(a).show(),t.createInstance("apiAParties").selectAbility(i.routerParams.party_id,n.getSlotNumber(),o.ability_id)}.bind(this)).fail(function(e){e&&e.stack&&console.error(e)})}},_appendExAbility:function(e,n,a,o,r){if(i.isUndefined(n.selected_ex_ability)||i.isUndefined(n.can_set_ex_ability))return 0;i.isUndefined(r)&&(r=$staticRes(res["core-statuslist-statuslist_ex-ability_ui"])),i.isUndefined(o)&&(o="statuslist_ui_"),i.isUndefined(a)&&(a=0);var s=n.selected_ex_ability;if(i.isUndefined(s.type))return r=$staticRes(res["core-statuslist-statuslist_ex-ability_blank_ui"]),this._createOrGetAbilityPanel(r,"stautslist_ex-blank",e,o,a),1;var c=this._createOrGetAbilityPanel(r,"ex_ability_list_base",e,o,a);return this._setExAbilityPanelStrings(c,s),t.createInstance("AbilityIcon",[c,s.type,s.category,!1]).show(),1},_createOrGetAbilityPanel:function(e,t,n,i,a){var o=n.seekWidgetByName(i+a);if(o){var r;o.getChildren().forEach(function(e){e.setVisible(!1)});var s=o.seekWidgetByName(t);return s?((r=s.getParent()).setVisible(!0),r):(r=ccs.load($dynamicRes(e)).node,o.addChild(r),r)}},_setAbilityPanelStrings:function(e,t){e.setStrings({ability_list_name:t.name,ability_list_description:t.description,ability_list_interval_label:this._getAbilityInterval(t),ability_list_duration_label:this._getAbilityDuration(t)})},_setExAbilityPanelStrings:function(e,t){e.setStrings({ex_ability_list_name:t.name,ex_ability_list_description:t.description,ex_ability_list_interval_label:this._getAbilityInterval(t),ex_ability_list_duration_label:this._getAbilityDuration(t)})},_setExAbilityIsSet:function(e,t){e.seekWidgetByName("ex_ability_list_setting_up").setVisible(t.is_set)},_setExAbilityIcon:function(e,n){t.createInstance("AbilityIcon",[e,n.type,n.category,!0]).show()},_getAbilityInterval:function(e){return""+e.recast+""},_getAbilityDuration:function(e){var t=[];return i.isEmpty(e.turn)||t.push(e.turn+""),i.isEmpty(e.second)||t.push(e.second+""),t.length>0?""+t.join(""):""},_touchEPButton:function(){t.createInstance("router").navigate("epi/epi_001",{epi_001:{tab:"new"}})},_fillAbilityPopup:function(e,n){t.createInstance("AbilityIcon",[e,n.type,n.category,!1]).show();var i=this._getAbilityDuration(n);e.setStrings({ability_name_label:n.name,ability_description_label:n.description,interval_label:this._getAbilityInterval(n),duration_label:i}),e.seekWidgetByName("duration_base").setVisible(""!=i)}}}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);e.Q,t.pc.status=t.pc.status||{},t.pc.status.roles=t.pc.status.roles||{},t.pc.status.roles.BurstCommon={_appendBurst:function(e,i,a,o,r){var s=0;if(n.isUndefined(i.burst))return s;n.isUndefined(r)&&(r=$staticRes(res["core-statuslist-statuslist_burst_ui"])),n.isUndefined(o)&&(o="statuslist_ui_"),n.isUndefined(a)&&(a=0);var c=this._createOrGetBurstPanel(r,e,o,a),u=i.burst.name||"[]";c.setStrings({burst_list_name:u,burst_list_description:i.burst.description});var l=c.seekWidgetByName("coreimg_bursticon");return null!==l&&l.loadTexture(t.Img("coreimg","bursticon",n.padZero(1,4)).png),++s},_createOrGetBurstPanel:function(e,t,n,i){var a=t.seekWidgetByName(n+i);if(a){var o;a.getChildren().forEach(function(e){e.setVisible(!1)});var r=a.seekWidgetByName("burst_list_base");return r?((o=r.getParent()).setVisible(!0),o):(o=ccs.load($dynamicRes(e)).node,a.addChild(o),o)}}}}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);e.Q,t.pc.status=t.pc.status||{},t.pc.status.roles=t.pc.status.roles||{},t.pc.status.roles.AssistCommon={_appendAssist:function(e,i,a,o,r){return n.isUndefined(i.assists)?0:(n.isUndefined(r)&&(r=$staticRes(res["core-statuslist-statuslist_assist_ui"])),n.isUndefined(o)&&(o="statuslist_ui_"),n.isUndefined(a)&&(a=0),t.core.model.ability.AbilityListFactory.create([],i.assists,i).forEachBySelectedAbility(function(i,s){var c=this._createOrGetAssistPanel(r,e,o,s+a);if(c){c.setStrings({assist_list_name:i.name,assist_list_description:i.description});var u=c.seekWidgetByName("coreimg_assisticon");null!==u&&u.loadTexture(t.Img("coreimg","assisticon",n.padZero(1,4)).png)}},this),i.assists.length)},_createOrGetAssistPanel:function(e,t,n,i){var a=t.seekWidgetByName(n+i);if(a){var o;a.getChildren().forEach(function(e){e.setVisible(!1)});var r=a.seekWidgetByName("assist_list_base");return r?((o=r.getParent()).setVisible(!0),o):(o=ccs.load($dynamicRes(e)).node,a.addChild(o),o)}},_getAssistAbilityIconImg:function(){return t.Img("coreimg","assisticon",n.padZero(1,4)).png}}}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);e.Q,t.pc.status=t.pc.status||{},t.pc.status.roles=t.pc.status.roles||{},t.pc.status.roles.WeaponSkillCommon={_appendWeaponSkill:function(e,i,a,o,r){var s=0;return n.isUndefined(i.skills)?s:(n.isUndefined(r)&&(r=res["core-statuslist-statuslist_weapon-skill_ui"]),n.isUndefined(o)&&(o="statuslist_ui_"),n.isUndefined(a)&&(a=0),n.each(i.skills,function(i,s){var c=ccs.load($dynamicRes(r)).node;if(c.setStrings({skill_name:i.name,skill_description:i.description}),i.level>0){var u=c.seekWidgetByName("level_no_label");null!==u&&(u.setString("Lv"+i.level),u.setVisible(!0))}var l=c.seekWidgetByName("coreimg_weapon-skillicon");null!==l&&l.loadTexture(t.Img("coreimg","weapon-skillicon",n.padZero(i.type,4)).png),null!==e.seekWidgetByName(o+(s+a))&&(e.seekWidgetByName(o+(s+a)).addChild(c),e.seekWidgetByName(o+(s+a)).setVisible(!0))},this),s=i.skills.length)},_setWeaponSkillBase:function(e,t){n.isUndefined(t.skills)||null!==e.seekWidgetByName("skill_base_0")&&n.each(t.skills,function(t,i){var a=e.seekWidgetByName("skill_base_"+i);if(null!==a&&null!==a.seekWidgetByName("skill_name_label")){var o=t.name+(n.isUndefined(t.level)?"":"LV"+t.level);a.setStrings({skill_name_label:o}),a.setVisible(!0)}},this)}}}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc.scene=t.pc.scene||{},t.pc.scene.roles=t.pc.scene.roles||{},$staticRes(res["party-jobget_ani-jobget_ani"]),t.pc.scene.roles.SceneJobCommon={_popups:{popupComIllustUp:{factoryName:"popupFactoryIllustUp",buttonLabels:{blackBtn:""},buttons:{blackBtn:function(e){this.dismiss()}}},popupConfirmLvUpBonus:{factoryName:"popupFactoryPopupCommon",resourceName:"core-popup-p_level_bonus",title:"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){this.dismiss()}}},popupAbilityNone:{factoryName:"popupFactoryBlue",title:"EX",content:"EX",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){this.dismiss()}}},popupNeedJobPoint:{factoryName:"popupFactoryPopupCommon",title:"",resourceName:"core-popup-p_need_point",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){this.dismiss()}}},popupConfirmGetJob:{factoryName:"popupFactoryPopupCommon",title:"",resourceName:"core-popup-p_job_get",buttonLabels:{blackBtn:"",blueBtn:""},buttons:{blackBtn:function(e){this.dismiss()},blueBtn:function(e){this.dismiss(),e._delegate._releaseJob.call(e._delegate)}}},popupJobEnergyChangeConfirm:{factoryName:"popupFactoryBlackBlue",title:"",buttonLabels:{blueBtn:"OK",blackBtn:""},buttons:{blueBtn:function(e){this.dismiss(),e._changeJobParameterDefer.resolve()},blackBtn:function(e){this.dismiss(),e._changeJobParameterDefer=null}}},popupSelectAbilityChange:{factoryName:"popupFactoryPopupCommon",resourceName:"core-popup-p_ability_puton_off",title:"",buttonLabels:{blackBtn:"",blueBtn:"OK"},buttonSounds:{blueBtn:t.SoundList.BUTTON_TOUCHED_CONFIRMED},onPopupOpened:function(e,t){e.bfsWidgetByName("remove_confirm_label").setVisible(!1),e.bfsWidgetByName("set_confirm_label").setString("")},buttons:{blackBtn:function(e){this.dismiss()},blueBtn:function(e){this.dismiss()}}}},jobReleaseAnimationInfo:{animation:null,zOrder:100,resource:"party-jobget_ani-jobget_ani"},_loadJob:function(e,n,o){return(i.isNumber(o)?t.createInstance("apiAParties").getJobsByParty(o,n):t.createInstance("apiAJobs").get(n)).then(function(t){return!e||e.dispose?a.reject():(this._job=t.body,this._loadCompleteJob=!0,this.__waitForNodesLoaded().then(function(){i.isUndefined(o)?this._fillupJobStatus("introduce_job_status_0_ui"):this._fillupJobStatus()}.bind(this)),t)}.bind(this)).fail(function(e){e&&console.error(e)})},_fillupJobStatus:function(e){return i.isUndefined(this._loadCompleteJob)||!1===this._loadCompleteJob?void console.debug("You should call _loadJob method first."):(this._setStatusBonusRecord(e),void this._setStatusBurstAbilityAssist())},_setStatusBonusRecord:function(e){i.isUndefined(e)&&(e="introduce_job_status_1_ui");var t=n.director.getRunningScene().seekWidgetByName(e);return null===t?void console.debug("Could not find "+e+"."):(this._setIntroduceJobImage(this._job),this._setMasterIcon4Title(t,this._job),this._setMasterIcon4Exp(t,this._job),this._setJobStatustypeIcon(t,this._job),this._setWeaponsIcon(t,this._job),this._setExpGauge(t,this._job),this._setCardStrings(t,this._job),this._fillupJobLvupBonus(t,this._job),this._fillupJobMasterBonus(t,this._job),void this._fillupJobExBonus(t,this._job))},_setMasterIcon4Title:function(e,t){if(i.isUndefined(this._loadCompleteJob)||!1===this._loadCompleteJob)console.debug("You should call _loadJob method first.");else if(!i.isUndefined(t.level)&&!i.isUndefined(t.max_level)&&t.level===t.max_level){var n=e.seekWidgetByName("master_icon");null!==n&&n.setVisible(!0)}},_setMasterIcon4Exp:function(e,t){if(i.isUndefined(this._loadCompleteJob)||!1===this._loadCompleteJob)console.debug("You should call _loadJob method first.");else if(!i.isUndefined(t.exp)&&!i.isUndefined(t.next_exp)&&t.exp===t.next_exp){var n=e.seekWidgetByName("job_master_icon");null!==n&&n.setVisible(!0);var a=e.seekWidgetByName("exp_next_label");null!==a&&a.setVisible(!1)}},_fillupJobLvupBonus:function(e,n){return i.isUndefined(this._loadCompleteJob)||!1===this._loadCompleteJob?void console.debug("You should call _loadJob method first."):void(i.isUndefined(n.bonus)||i.isUndefined(n.bonus.level_up_bonus)||i.each(n.bonus.level_up_bonus,function(n,a){var o=e.seekWidgetByName("job-bonusicon_lv-up_"+a);null!==o&&(null!==o.seekWidgetByName("lv-up_bonus_label")&&(o.seekWidgetByName("lv-up_bonus_label").setString(n.description),o.loadTexture(t.Img("coreimg","job-bonusicon",i.padZero(n.type,4)).png),o.setVisible(!0)))}))},_fillupJobMasterBonus:function(e,n){return i.isUndefined(this._loadCompleteJob)||!1===this._loadCompleteJob?void console.debug("You should call _loadJob method first."):void(i.isUndefined(n.bonus)||i.isUndefined(n.bonus.max_level_bonus)||i.each(n.bonus.max_level_bonus,function(n,a){var o=e.seekWidgetByName("job-bonusicon_master_"+a);null!==o&&(null!==o.seekWidgetByName("master_bonus_label")&&(o.seekWidgetByName("master_bonus_label").setString(n.description),o.loadTexture(t.Img("coreimg","job-bonusicon",i.padZero(n.type,4)).png),o.setVisible(!0)))}))},_fillupJobExBonus:function(e,n){return i.isUndefined(this._loadCompleteJob)||!1===this._loadCompleteJob?void console.debug("You should call _loadJob method first."):void(null!==e.seekWidgetByName("bonus-textimg_job")&&(i.isUndefined(n)||i.isUndefined(n.job_id)||!1!==i.isFunction(e.seekWidgetByName("bonus-textimg_job").loadTexture)&&e.loadTextures({"bonus-textimg_job":t.Img("bonus-textimg","job",i.padZero(n.job_id,4)).png})))},_setStatusBurstAbilityAssist:function(){var e=n.director.getRunningScene().seekWidgetByName("introduce_statuslist_list_7_ui"),t=0;t+=this._appendBurst(e,this._job),t+=this._appendAbility(e,this._job,t),t+=this._appendExAbility(e,this._job,t),t+=this._appendAssist(e,this._job,t),e.getChildren().forEach(function(e,n){0===e.getName().indexOf("statuslist_blank_")&&e.setVisible(n<t)})},_setUpControls:function(e){if(i.isUndefined(this._loadCompleteJob)||!1===this._loadCompleteJob)console.debug("You should call _loadJob method first.");else{var n=e.seekWidgetByName("btn_job-energy-release");if(n){var a=!0===this._job.energy_releasable;t.pc.roles.UIUtility._setEnableButton(n,this._job.level>=this._job.max_level),n.setVisible(a)}}},_showImageZoomPopup:function(){return i.isUndefined(this._loadCompleteJob)||!1===this._loadCompleteJob?void console.debug("You should call _loadJob method first."):void this._openAllOverPanel(this._job.job_id,this._job.skin,"job")},_showSetupExtraAbility:function(){if(!i.isUndefined(this._loadCompleteJob)&&!1!==this._loadCompleteJob){var e=n.director.getRunningScene(),t=e.popups.popupAbilityNone;return i.isUndefined(t)?void console.debug("Could not find popup: popupAbilityNone."):i.isUndefined(this._job.can_set_ex_ability)?void console.debug("Could not find job param: can_set_ex_ability."):this._job.can_set_ex_ability?e._sceneNavigate.toParty005(this._job.a_job_id).navigate():void t.open()}console.debug("You should call _loadJob method first.")},_showPopupBonus:function(){if(!i.isUndefined(this._loadCompleteJob)&&!1!==this._loadCompleteJob){var e=n.director.getRunningScene().popups.popupConfirmLvUpBonus;return i.isUndefined(e)?void console.error("Could not find popup: popupConfirmLvUpBonus."):void e.open().then(function(){var n=this._job.job_id;i.isUndefined(this._job.parameter_job_id)||(n=this._job.parameter_job_id),e.loadTextures({"bonus-textimg_job":t.Img("bonus-textimg","job",i.padZero(n,4)).png})}.bind(this))}console.error("You should call _loadJob method first.")},_showPopupConfirmGetJobWithNeedItem:function(e){var a=e.have_num,o=e.num,r=e.name,s=n.director.getRunningScene().popups.popupConfirmGetJob,c=a-o;s._getConfirmLabel=function(){return this.seekWidgetByName("confirm_label")},s.replaceConfirmLabel=function(e){var t=this._getConfirmLabel();if(null!==t&&!t.getString().match(e)){var n=t.getString().replace("P",e);t.setString(n)}},s.open().then(function(){s.replaceConfirmLabel(r),s.loadTextures({get_job_img:t.Img("joblist","job",i.padZero(this._job.job_id,4),0).png}),s.setHtmlStrings({job_point_fall_labelimg:e.name+":"+a+"<span class='red'>"+c+"</span>"},t.GameConfig.POPUP_CSS)}.bind(this))},_showPJobGetOrPNeedPoint:function(){if(this._player.job_point<this._job.release_need_job_point)this._popupNeedJobPoint();else{var e=n.director.getRunningScene().popups.popupConfirmGetJob,a=this._player.job_point-this._job.release_need_job_point;e.open().then(function(){e.loadTextures({get_job_img:t.Img("joblist","job",i.padZero(this._job.job_id,4),0).png}),e.setHtmlStrings({job_point_fall_labelimg:"P:"+this._player.job_point+"<span class='red'>"+a+"</span>"},t.GameConfig.POPUP_CSS)}.bind(this))}},_popupNeedJobPoint:function(){var e=n.director.getRunningScene().popups.popupNeedJobPoint;e.open().then(function(){this._job.need_jobs.forEach(function(n,a){e.seekWidgetByName("job_clippanel_"+a).seekWidgetByName("need_job").loadTexture(t.Img("joblist","job",i.padZero(n.job_id,4),0).png);var o=e.seekWidgetByName("condition_base_"+a),r=n.is_acquired?n.level===n.max_level?"MASTER":"Lv:"+n.level+"/"+n.max_level:"";o.seekWidgetByName("condition_label").setString(r)},this),e.setHtmlStrings({condition_notice_labelimg:"<span class='orange'>P</span><span class='white'>"+this._job.release_need_job_point+"P</span><br /><span class='red'></span>"},t.GameConfig.POPUP_CSS)}.bind(this)).fail(function(e){console.error(e.stack)})},_releaseJob:function(){t.createInstance("apiAJobs").release(this._job.job_id).then(function(e){this._playReleaseAnimation()}.bind(this)).fail(function(e){console.error(e)})},_playReleaseAnimation:function(){var a=new n.Node;a.setName("aniRoot");var o=n.director.getRunningScene();o.addChild(a),t.createInstance("soundPlayer").init(t.createInstance("playerGameConfig")),this.jobReleaseAnimationInfo.animation=t.createInstance("WindowVisualEffect").init(e.res[this.jobReleaseAnimationInfo.resource]);var r=this.jobReleaseAnimationInfo.animation,s=t.createInstance("Sound2Event",[r]);r.setAnimationNameEndCallback("release_ani",function(){s.unregisterEvent(),s=null,r.removeAnimationNameEndCallback(),a.seekWidgetByName("touch_btn").setVisible(!0),t.setTouchEventHandlers(a,{"TOUCH_ENDED touch_btn":function(){var e,n={par_006_007:{released_job:this._job}};o.routerParams.par_006_007&&o.routerParams.par_006_007.id&&(e={par_006_007:{id:o.routerParams.par_006_007.id}}),t.createInstance("router").navigate("party/par_007",e,n)}},this),r.playByName("touch_ani",a,n.p(0,0),this.jobReleaseAnimationInfo.zOrder,!0)},this),r.playByName("release_ani",a,n.p(0,0),this.jobReleaseAnimationInfo.zOrder,!1);var c=o.seekWidgetByName("job_panel_01"),u=o.seekWidgetByName("job_panel_02");c.loadTextures({"jobget-sp_job":t.Img("jobget-sp","job",i.padZero(this._job.job_id,4)).png}),u.loadTextures({"jobget-sp_job":t.Img("jobget-sp","job",i.padZero(this._job.job_id,4)).png})},_playLoopAnimation:function(e,t,n,a,o){var r=null;if(i.isObject(e))r=e;else r=ccs.load($dynamicRes(e));r.node.runAction(r.action),t.addChild(r.node);var s=null;if(a)s=this._setEndAnimationEvent(r.action,n.end);return"object"==typeof n?r.action.gotoFrameAndPlay(n.start,n.end,o):"number"==typeof n&&r.action.gotoFrameAndPlay(n,o),s}},i.assign(t.pc.scene.roles.SceneJobCommon,t.pc.roles.ImagesCommon,t.pc.roles.IconsCommon,t.pc.roles.StringsCommon,t.pc.roles.GaugesCommon,t.pc.status.roles.BurstCommon,t.pc.status.roles.AbilityCommon,t.pc.status.roles.AssistCommon,t.pc.roles.AnimationCommon,t.pc.roles.AllOverUI)}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc.scene=t.pc.scene||{},t.pc.scene.roles=t.pc.scene.roles||{},t.pc.scene.roles.SceneCharacterCommon={_popups:{popupComIllustUp:{factoryName:"popupFactoryIllustUp",buttonLabels:{blackBtn:""},buttons:{blackBtn:function(e){this.dismiss()}}},popupSceneCheck:{factoryName:"popupFactoryPopupCommon",resourceName:"core-popup-ga_scene_check",title:"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){this.dismiss()}}}},charaVoiceUrls:[],_soundPlayer:null,_playingCharacterVoiceResource:null,_loadACharacter:function(e,n){return this._isOwn=!!i.isUndefined(n)||n,t.createInstance("apiACharacters").get(e).then(function(e){return this._character=e.body,this._loadCompleteACharacter=!0,this._setUpControls(),this._fillupACharacterStatus().thenResolve(e.body)}.bind(this)).fail(function(e){console.error(e.stack)})},_loadCharacter:function(e){return t.createInstance("apiCharacters").get(e).then(function(e){this._character=e.body,this._loadCompleteACharacter=!0;var t=this._getCurrentAppearanceCharacterId();return this.updateCharacterVoices(t),this._fillupACharacterStatus("introduce_chara_status_0_ui").thenResolve(e.body)}.bind(this)).fail(function(e){console.error(e.stack)})},updateCharacterVoices:function(e){var n=t.createInstance("voiceLoader"),i=t.IDList.VOICES.NOTE;return n.loadCharacterVoices(e,i.LOWER,i.UPPER).then(function(e){this.charaVoiceUrls=e}.bind(this))},_fillupACharacterStatus:function(e){if(!i.isUndefined(this._loadCompleteACharacter)&&!1!==this._loadCompleteACharacter){this._setStatusBonusRecord(e),this._setStatusBurstAbilityAssist();var t=this._getCurrentAppearanceCharacterId();return this.updateAvatar(t)}console.error("You should call _loadACharacter method first.")},_getCurrentAppearanceCharacterId:function(){return i.isUndefined(this._character.appearance)?this._character.character_id:this._character.appearance.used_character_id||this._character.character_id},_setStatusBonusRecord:function(e){i.isUndefined(e)&&(e="introduce_chara_status_1_ui");var t=n.director.getRunningScene().seekWidgetByName(e);return null===t?void console.debug("Could not find "+e+"."):(this.updateBackgroundImage(),this._setRarityIcon(t,this._character),this._setRarityBar(t,this._character),this._setElementIcon(t,this._character),this._setStatustypeIcon(t,this._character),this._setExpGauge(t,this._character),this._setCardStrings(t,this._character),void this._setStarGauge(t,this._character))},updateBackgroundImage:function(){var e=this._getCurrentAppearanceCharacterId();this._setIntroduceCharaImage(e,this._character.rare)},_setStatusBurstAbilityAssist:function(){var e=n.director.getRunningScene().seekWidgetByName("introduce_statuslist_list_7_ui");this._clearAbilityList();var t=0;t+=this._appendBurst(e,this._character),t+=this._appendAbility(e,this._character,t),t+=this._appendAssist(e,this._character,t)},_setUpControls:function(){if(i.isUndefined(this._loadCompleteACharacter)||!1===this._loadCompleteACharacter)console.error("You should call _loadACharacter method first.");else{var e=n.director.getRunningScene();this._setEnhButton(e),this._setEvoButton(e)}},_setEnhButton:function(e){var t=e.seekWidgetByName("btn_enh");if(null!==t)return this._isOwn?void(this._character.level>=this._character.max_level&&this._character.bonus>=99&&this._setEnableButton(t,!1)):void t.setVisible(!1)},_setEvoButton:function(e){var t=this.__getEvoArousalUINode(e);if(null!==t)return this._isOwn?this._character.can_arouse?(this.__setAppearanceEvoArousalUICanArouse(e),void this.__setEnableArouseButton(e,!0)):(this.__setAppearanceEvoArousalUICanEvolve(e),this._character.overlimit_count<this._character.max_overlimit_count?void this.__setEnableEvolveButton(e,!0):void this.__setEnableEvolveButton(e,!1)):void t.setVisible(!1)},__setEnableArouseButton:function(e,t){var n=e.seekWidgetByName("btn_arousal");n&&this._setEnableButton(n,t)},__setEnableEvolveButton:function(e,t){var n=e.seekWidgetByName("btn_evo");n&&this._setEnableButton(n,t)},__setAppearanceEvoArousalUICanArouse:function(e){var t=this.__getEvoArousalUINode(e);t&&t.setAppearance("arousal")},__setAppearanceEvoArousalUICanEvolve:function(e){var t=this.__getEvoArousalUINode(e);t&&t.setAppearance("evo")},__getEvoArousalUINode:function(e){return e.seekWidgetByName("introduce_btn_evolution_arousal_ui")},_touchEnhButton:function(){t.createInstance("router").navigate("enh_evo/enh_008",{enh_008:{id:this._character.a_character_id}})},_touchEvoButton:function(){t.createInstance("router").navigate("enh_evo/evo_013",{evo_013:{id:this._character.a_character_id}})},_touchArouseButton:function(){t.createInstance("router").navigate("enh_evo/arousal_002",{},{arousal_002:{id:this._character.a_character_id}})},_showImageZoomPopup:function(){if(i.isUndefined(this._loadCompleteACharacter)||!1===this._loadCompleteACharacter)console.error("You should call _loadACharacter method first.");else if(null!=this._character.character_id||null==this._character.other_character_id){var e=this._getCurrentAppearanceCharacterId();this._openAllOverPanel(e,0,"chara")}else this._openAllOverPanel(this._character.other_character_id,this._character.skin,"npc")},_touchPlayVoiceButton:function(){if(t.createInstance("playerGameConfig").isVoiceOn()){if(this.charaVoiceUrls.length<1){var e=this._getCurrentAppearanceCharacterId();return void this.updateCharacterVoices(e).then(function(){this.charaVoiceUrls.length>0&&this._touchPlayVoiceButton()}.bind(this))}if(!this._voiceCooldown){this._cooldownVoice();var n=i.shuffle(this.charaVoiceUrls)[0];null===this._soundPlayer&&(this._soundPlayer=t.createInstance("soundPlayer")),null!==this._playingCharacterVoiceResource&&this._soundPlayer.stopVoice(this._playingCharacterVoiceResource),this._playingCharacterVoiceResource=n,this._soundPlayer.playVoice(n)}}},_cooldownVoice:function(){this._voiceCooldown=!0,a.delay(1e3).then(function(){this._voiceCooldown=!1}.bind(this))},updateAvatar:function(e){return this._loadedAvatar&&(this._unloadAvatar(this._loadedAvatar),this._loadedAvatar=null),this._loadAvatar(e).then(function(e){this._loadedAvatar=e,t.env.isSp&&this._loadedAvatar._showAvatar()}.bind(this))},cleanUpAvatar:function(){this._loadedAvatar&&(this._unloadAvatar(this._loadedAvatar),this._loadedAvatar=null)},_loadAvatar:function(e){var i=n.director.getRunningScene().seekWidgetByName("avatar_position_node");return null==i?a.resolve():t.createInstance("BasicAvatarSceneObject").init(e,!1,0).then(function(e){var t=e.getAvatar();t.appendTo(i),t.playStandByAnimation();var a=this._touchAvatar.bind(this),o={event:n.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!1,onTouchBegan:function(){return!0},onTouchEnded:a};return n.eventManager.addListener(o,t._armature),t}.bind(this))},_touchAvatar:function(){null!==this._playingCharacterVoiceResource&&this._soundPlayer.stopVoice(this._playingCharacterVoiceResource)},_unloadAvatar:function(e){e&&e.cleanup()},_showPopupEpisode:function(){if(!i.isUndefined(this._loadCompleteACharacter)&&!1!==this._loadCompleteACharacter){var e=n.director.getRunningScene();return i.isUndefined(this._character)||i.isUndefined(this._character.character_id)?void console.debug("[ERROR] Could not find this._character | .character_id"):void t.createInstance("apiGacha").getHaremEpisodeCharacter(this._character.character_id).then(function(n){var a=e.popups.popupSceneCheck,o=n.body;return i.isUndefined(a)?void console.debug("[ERROR] Could not load popupSceneCheck."):a.open().then(function(){if(a.setTitle(o.title),khutil.getWidgetFromNode(a,"mosaic_mask",function(e){console.warn("ga_scene_check: "+e)}).setVisible(t.env.isR18&&!0===o.is_r18),t.env.isR18){var e=khutil.getWidgetFromNode(a,"scene_img",function(e){console.warn("ga_scene_check: "+e)});this._loadEpisodeImage(e,"harem-character",o.episode_id)}else a.loadTextures({scene_img:t.Img("scene-check","chara",i.padZero(o.character_id,4)).png});a.setStrings({synopsis_label:o.description})}.bind(this))}.bind(this)).fail(function(e){e&&console.error(e)})}console.error("You should call _loadACharacter method first.")},_clearAbilityList:function(){var e=n.director.getRunningScene();i(i.range(0,7)).map(function(t){return e.seekWidgetByName("statuslist_ui_"+t)}).filter(function(e){return e}).invoke("removeAllChildren").value()}},i.assign(t.pc.scene.roles.SceneCharacterCommon,t.pc.roles.UIUtility,t.pc.roles.ImagesCommon,t.pc.roles.IconsCommon,t.pc.roles.StringsCommon,t.pc.roles.GaugesCommon,t.pc.status.roles.BurstCommon,t.pc.status.roles.AbilityCommon,t.pc.status.roles.AssistCommon,t.pc.roles.AllOverUI)}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc.scene=t.pc.scene||{},t.pc.scene.roles=t.pc.scene.roles||{},t.pc.scene.roles.SceneWeaponCommon={_popups:{popupComIllustUp:{factoryName:"popupFactoryIllustUp",buttonLabels:{blackBtn:""},buttons:{blackBtn:function(e){this.dismiss()}}},popupProtect:{factoryName:"popupFactoryBlue",buttonLabels:{blueBtn:"OK"},title:"",buttonSounds:{blueBtn:t.SoundList.BUTTON_TOUCHED_CONFIRMED},buttons:{blueBtn:function(){this.dissmiss()}}}},_loadAWeapon:function(e,n){return this._isOwn=!!i.isUndefined(n)||n,a.all([t.createInstance("apiAWeapons").get(e),t.createInstance("apiAWeapons").getEnhanceEvolveInfo(e)]).spread(function(e,t){return console.log(e.body,t.body),this._weapon=e.body,this._loadCompleteWeapons=!0,this._fillupAWeaponStatus(),this._protectFlag=this._weapon.is_locked,this._setLockStatus(this._weapon.is_locked),this._masterCanArouseFlag=this._weapon.can_arouse,this._enhanceableFlag=t.body.enhanceable,this._evolvableFlag=t.body.evolvable,this._arouseFlag=t.body.arousable,this._setControls(),e.body}.bind(this)).fail(function(e){console.error(e.stack)})},_loadWeapon:function(e,i){return t.createInstance("apiWeapons").get(e).then(function(e){console.log(e.body),this._weapon=e.body,this._loadCompleteWeapons=!0;var t=n.director.getRunningScene();this._masterCanArouseFlag=this._weapon.can_arouse,this._setArouseAvailableButton(t),null===t.seekWidgetByName("introduce_weapon_status_0_ui")?this._fillupAWeaponStatus("introduce_weapon_status_2_ui"):this._fillupAWeaponStatus("introduce_weapon_status_0_ui");var a=t.seekWidgetByName("plus_no");if(null!==a){var o=i>0?"+"+i:"";a.setString(o)}return e.body}.bind(this)).fail(function(e){console.error(e.stack)})},_fillupAWeaponStatus:function(e){return i.isUndefined(this._loadCompleteWeapons)||!1===this._loadCompleteWeapons?void console.error("You should call _loadAWeapon | _loadWeapon method first."):(this._setStatusRecord(e),void this._setStatusBurstSkill(e))},_setStatusRecord:function(e){i.isUndefined(e)&&(e="introduce_weapon_status_1_ui");var t=n.director.getRunningScene().seekWidgetByName(e);return null===t?void console.debug("Could not find "+e+"."):(this._setIntroduceWeaponImage(this._weapon),this._setRarityIcon(t,this._weapon),this._setRarityBar(t,this._weapon),this._setElementIcon(t,this._weapon),this._setWeaponIcon(t,this._weapon),this._setStatustypeIcon(t,this._weapon),this._setExpGauge(t,this._weapon),this._setCardStrings(t,this._weapon),void this._setStarGauge(t,this._weapon))},_setStatusBurstSkill:function(e){i.isUndefined(e)&&(e="introduce_weapon_status_1_ui");var t=n.director.getRunningScene().seekWidgetByName(e);if(null!==t){var a=0;a+=this._appendBurst(t,this._weapon),a+=this._appendWeaponSkill(t,this._weapon,a)}else console.debug("Could not find "+e+".")},_setControls:function(){if(i.isUndefined(this._loadCompleteWeapons)||!1===this._loadCompleteWeapons)console.error("You should call _loadAWeapon method first.");else{var e=n.director.getRunningScene();this._setEnhButton(e),this._setEvoButton(e),this._setFinalEvoButton(e),this._setSellButton(e),this._setArouseAvailableButton(e)}},_setEnhButton:function(e){var t=e.seekWidgetByName("btn_enh");if(null!==t)return this._isOwn?void(this._enhanceableFlag||this._setEnableButton(t,!1)):void t.setVisible(!1)},_setEvoButton:function(e){var t=e.seekWidgetByName("btn_evo");if(null!==t){if(!this._isOwn)return void t.setVisible(!1);t.setVisible(!this._arouseFlag),this._evolvableFlag||this._setEnableButton(t,!1)}},_setFinalEvoButton:function(e){var t=e.seekWidgetByName("btn_evo_final");if(null!==t){if(!this._isOwn)return void t.setVisible(!1);t.setVisible(this._arouseFlag),this._arouseFlag||this._setEnableButton(t,!1)}},_setArouseAvailableButton:function(e){var t=e.seekWidgetByName("btn_last_evo_able");null!==t&&t.setVisible(this._masterCanArouseFlag)},_setSellButton:function(e){var t=e.seekWidgetByName("btn_sell_select")||e.seekWidgetByName("btn_sell");if(null!==t)return this._isOwn?void((this._weapon.is_equipped||this._weapon.is_locked)&&this._setEnableButton(t,!1)):void t.setVisible(!1)},_setLockStatus:function(e){if(i.isUndefined(this._loadCompleteWeapons)||!1===this._loadCompleteWeapons)console.error("You should call _loadAWeapon method first.");else{var t=n.director.getRunningScene(),a=t.seekWidgetByName("btn_protect"),o=t.seekWidgetByName("protected_icon");if(null!==a&&null!==o){var r=t.seekWidgetByName("btn_sell_select")||t.seekWidgetByName("btn_sell");if(!this._isOwn)return a.setVisible(!1),void(null!==r&&r.setVisible(!1));a.setTitleText(e?"":""),o.setVisible(e),null!==r&&(!0===this._weapon.is_equipped?this._setEnableButton(r,!1):this._setEnableButton(r,!e))}}},_touchProtect:function(){if(!i.isUndefined(this._protectFlag)){var e=n.director.getRunningScene(),t=e.seekWidgetByName("btn_protect"),a=e.seekWidgetByName("protected_icon");return null===t||null===a?void console.error("Could not find protected control: btn_protect | protected_icon."):this._protectFlag?this._unlockWeapon(e):this._lockWeapon(e)}console.error("You should call _loadAWeapon method first.")},_lockWeapon:function(e){return t.createInstance("apiAWeapons").lock(this._weapon.a_weapon_id).then(function(t){this._weapon=t.body;var n=e.popups.popupProtect;return n.setContent("<p>"+this._weapon.name+(this._weapon.bonus<1?" ":"+"+this._weapon.bonus)+"<br /></p><p><br /></p>"),n.open(),this._protectFlag=!this._protectFlag,this._setLockStatus(this._weapon.is_locked),this._weapon}.bind(this)).fail(function(e){console.error(e.stack)})},_unlockWeapon:function(e){return t.createInstance("apiAWeapons").unlock(this._weapon.a_weapon_id).then(function(t){this._weapon=t.body;var n=e.popups.popupProtect;return n.setContent("<p>"+this._weapon.name+(this._weapon.bonus<1?" ":"+"+this._weapon.bonus)+"<br /></p><p></p>"),n.open(),this._protectFlag=!this._protectFlag,this._setLockStatus(this._weapon.is_locked),this._weapon}.bind(this)).fail(function(e){console.error(e.stack)})},_touchEnhButton:function(){t.createInstance("router").navigate("enh_evo/enh_007",{enh_007:{id:this._weapon.a_weapon_id}})},_touchEvoButton:function(){t.createInstance("router").navigate("enh_evo/evo_007",{evo_007:{id:this._weapon.a_weapon_id}})},_touchFinalEvoButton:function(){t.createInstance("router").navigate("enh_evo/evo_008",{evo_008:{id:this._weapon.a_weapon_id}})},_showImageZoomPopup:function(){return i.isUndefined(this._loadCompleteWeapons)||!1===this._loadCompleteWeapons?void console.error("You should call _loadAWeapon method first."):void this._openAllOverPanel(this._weapon.weapon_id,this._weapon.skin,"weapon")}},i.assign(t.pc.scene.roles.SceneWeaponCommon,t.pc.roles.ImagesCommon,t.pc.roles.IconsCommon,t.pc.roles.StringsCommon,t.pc.roles.GaugesCommon,t.pc.status.roles.BurstCommon,t.pc.status.roles.WeaponSkillCommon,t.pc.roles.AllOverUI)}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;e.Q,t.pc.scene=t.pc.scene||{},t.pc.scene.roles=t.pc.scene.roles||{},t.pc.scene.roles.SceneSummonCommon={_popups:{popupComIllustUp:{factoryName:"popupFactoryIllustUp",buttonLabels:{blackBtn:""},buttons:{blackBtn:function(e){this.dismiss()}}},popupProtect:{factoryName:"popupFactoryBlue",title:"",buttonLabels:{blueBtn:"OK"},buttonSounds:{blueBtn:t.SoundList.BUTTON_TOUCHED_CONFIRMED},buttons:{blueBtn:function(){this.dissmiss()}}},popupSceneCheck:{factoryName:"popupFactoryPopupCommon",resourceName:"core-popup-ga_scene_check",title:"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){this.dismiss()}}}},_loadASummon:function(e,n){return this._isOwn=!!i.isUndefined(n)||n,t.createInstance("apiASummons").get(e).then(function(e){return this._summon=e.body,this._loadCompleteSummon=!0,this._fillupASummonStatus(),this._setControls(),e.body}.bind(this)).fail(function(e){console.error(e.stack)})},_loadSummon:function(e,i){return t.createInstance("apiSummons").get(e).then(function(e){this._summon=e.body,this._loadCompleteSummon=!0;var t=n.director.getRunningScene();null===t.seekWidgetByName("introduce_summon_status_0_ui")?this._fillupASummonStatus("introduce_summon_status_2_ui"):this._fillupASummonStatus("introduce_summon_status_0_ui");var a=t.seekWidgetByName("plus_no");if(null!==a){var o=i>0?"+"+i:"";a.setString(o)}return e.body}.bind(this)).fail(function(e){console.error(e.stack)})},_fillupASummonStatus:function(e){return i.isUndefined(this._loadCompleteSummon)||!1===this._loadCompleteSummon?void console.debug("You should call _loadASummon | _loadSummon method first."):(this._setStatusRecord(e),void this._setAttackEffect(e))},_setStatusRecord:function(e){i.isUndefined(e)&&(e="introduce_summon_status_1_ui");var t=n.director.getRunningScene().seekWidgetByName(e);return null===t?void console.debug("Could not find "+e+"."):(this._setIntroduceSummonImage(this._summon),this._setRarityIcon(t,this._summon),this._setRarityBar(t,this._summon),this._setElementIcon(t,this._summon),this._setStatustypeIcon(t,this._summon),this._setExpGauge(t,this._summon),this._setCardStrings(t,this._summon),void this._setStarGauge(t,this._summon))},_setAttackEffect:function(e){i.isUndefined(e)&&(e="introduce_summon_status_1_ui");var t=n.director.getRunningScene().seekWidgetByName(e);return null===t?void console.debug("Could not find "+e+"."):void this._setSummonAttackEffectStrings(t,this._summon)},_setControls:function(){if(i.isUndefined(this._loadCompleteSummon)||!1===this._loadCompleteSummon)console.error("You should call _loadASummon method first.");else{var e=n.director.getRunningScene();this._setLockBtn(e),this._setEnhButton(e),this._setEvoButton(e),this._initSellButton(e)}},_setEnhButton:function(e){var t=e.seekWidgetByName("btn_enh");if(null!==t)return this._isOwn?void(this._summon.level>=this._summon.max_level&&this._summon.bonus>=99&&this._setEnableButton(t,!1)):void t.setVisible(!1)},_setEvoButton:function(e){var t=e.seekWidgetByName("btn_evo");if(null!==t)return this._isOwn?void(this._summon.overlimit_count>=this._summon.max_overlimit_count&&this._setEnableButton(t,!1)):void t.setVisible(!1)},_initSellButton:function(e){return this._isOwn?void this._setSellBtnVisibleAndEnable(!0,this._summon.can_sell):void this._setSellBtnVisibleAndEnable(!1,!1)},_setSellBtnVisibleAndEnable:function(e,t){var i=n.director.getRunningScene(),a=i.seekWidgetByName("btn_sell_select")||i.seekWidgetByName("btn_sell");if(null!==a)return e?void this._setEnableButton(a,t):void a.setVisible(!1)},_disableProtectButton:function(){if(i.isUndefined(this._loadCompleteSummon)||!1===this._loadCompleteSummon)console.error("You should call _loadASummon method first.");else{var e=n.director.getRunningScene(),t=e.seekWidgetByName("btn_protect"),a=e.seekWidgetByName("protected_icon");null!==t&&null!==a&&(t.setTitleText(""),a.setVisible(!0),this._setEnableButton(t,!1),this._setSellBtnVisibleAndEnable(!0,!1))}},_setLockBtn:function(e){var n=e.seekWidgetByName("btn_protect");if(null!==n)return this._isOwn?void t.createInstance("apiSummons").get(this._summon.summon_id).then(function(e){!1===e.body.can_sell?this._disableProtectButton():(this._protectFlag=this._summon.is_locked,this._setLockStatus(this._summon.is_locked))}.bind(this)).fail(function(e){console.error(e.stack)}):void n.setVisible(!1)},_setLockStatus:function(e){if(i.isUndefined(this._loadCompleteSummon)||!1===this._loadCompleteSummon)console.error("You should call _loadASummon method first.");else{var t=n.director.getRunningScene(),a=t.seekWidgetByName("btn_protect"),o=t.seekWidgetByName("protected_icon");if(null!==a&&null!==o){if(!this._isOwn)return void this._setSellBtnVisibleAndEnable(!1,!1);a.setTitleText(e?"":""),o.setVisible(e);var r=this._summon.can_sell&&!e;this._setSellBtnVisibleAndEnable(!0,r)}}},_touchProtect:function(){if(!i.isUndefined(this._protectFlag)){var e=n.director.getRunningScene(),t=e.seekWidgetByName("btn_protect"),a=e.seekWidgetByName("protected_icon");return null===t||null===a?void console.error("Could not find protected control: btn_protect | protected_icon."):this._protectFlag?this._unlockSummon(e):this._lockSummon(e)}console.error("You should call _loadASummon method first.")},_lockSummon:function(e){return t.createInstance("apiASummons").lock(this._summon.a_summon_id).then(function(t){this._summon=t.body;var n=e.popups.popupProtect;return n.setContent("<p>"+this._summon.name+(this._summon.bonus<1?" ":"+"+this._summon.bonus)+"<br /></p><p><br /></p>"),n.open(),this._protectFlag=!this._protectFlag,this._setLockStatus(this._summon.is_locked),this._summon}.bind(this)).fail(function(e){console.error(e.stack)})},_unlockSummon:function(e){return t.createInstance("apiASummons").unlock(this._summon.a_summon_id).then(function(t){this._summon=t.body;var n=e.popups.popupProtect;return n.setContent("<p>"+this._summon.name+(this._summon.bonus<1?" ":"+"+this._summon.bonus)+"<br /></p><p></p>"),n.open(),this._protectFlag=!this._protectFlag,this._setLockStatus(this._summon.is_locked),this._summon}.bind(this)).fail(function(e){console.error(e.stack)})},_touchEnhButton:function(){t.createInstance("router").navigate("enh_evo/enh_009",{enh_009:{id:this._summon.a_summon_id}})},_touchEvoButton:function(){t.createInstance("router").navigate("enh_evo/evo_010",{evo_010:{id:this._summon.a_summon_id}})},_showImageZoomPopup:function(){return i.isUndefined(this._loadCompleteSummon)||!1===this._loadCompleteSummon?void console.error("You should call _loadASummon method first."):void this._openAllOverPanel(this._summon.summon_id,this._summon.skin,"summon")},_showPopupEpisode:function(){if(!i.isUndefined(this._loadCompleteSummon)&&!1!==this._loadCompleteSummon){var e=n.director.getRunningScene();return i.isUndefined(this._summon)||i.isUndefined(this._summon.summon_id)?void console.debug("[ERROR] Could not find this._summon | .summon_id"):void t.createInstance("apiGacha").getHaremEpisodeSummon(this._summon.summon_id).then(function(n){var a=e.popups.popupSceneCheck,o=n.body;return i.isUndefined(a)?void console.debug("[ERROR] Could not load popupSceneCheck."):void a.open().then(function(){if(a.setTitle(o.title),khutil.getWidgetFromNode(a,"mosaic_mask",function(e){console.warn("ga_scene_check: "+e)}).setVisible(t.env.isR18),t.env.isR18){var e=khutil.getWidgetFromNode(a,"scene_img",function(e){console.warn("ga_scene_check: "+e)});this._loadEpisodeImage(e,"harem-summon",o.episode_id)}else a.loadTextures({scene_img:t.Img("scene-check","summon",i.padZero(o.summon_id,4)).png});a.setStrings({synopsis_label:o.description})}.bind(this)).fail(function(e){console.error(e.stack)})}.bind(this)).fail(function(e){console.error(e.stack)})}console.error("You should call _loadASummon method first.")}},i.assign(t.pc.scene.roles.SceneSummonCommon,t.pc.roles.ImagesCommon,t.pc.roles.IconsCommon,t.pc.roles.StringsCommon,t.pc.roles.GaugesCommon,t.pc.roles.AllOverUI)}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc,e.ccui,e._);e.console,t.createNameSpaceIfNotExists("view"),t.view.AssistAbilityIcon=t.view.AbilityIcon.extend({className:"AssistAbilityIcon",show:function(){this._iconNode.setTouchEnabled(this._touchEnable);var e=t.Img("coreimg","assisticon",n.padZero(1,4)).png;this._iconNode.loadTextureNormal(e),this._iconNode.loadTexturePressed(e),this._iconNode.setVisible(!0),this._frameNode.setVisible(!1)}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("core.model.ability"),t.core.model.ability.Ability=n.Class.extend({className:"Ability",ctor:function(e,t){this._abilityData=t;var n=t.learned;"boolean"!=typeof n&&(n=t.available_level<=e),Object.defineProperties(this,{ability_id:{value:t.ability_id,writable:!1,enumerable:!1,configurable:!1},name:{value:t.name,writable:!1,enumerable:!1,configurable:!1},description:{value:t.description,writable:!1,enumerable:!1,configurable:!1},type:{value:t.type,writable:!1,enumerable:!1,configurable:!1},category:{value:t.category,writable:!1,enumerable:!1,configurable:!1},available_level:{value:t.available_level,writable:!1,enumerable:!1,configurable:!1},learned:{value:n,writable:!1,enumerable:!1,configurable:!1},episode_cleared:{value:t.episode_cleared||!1,writable:!1,enumerable:!1,configurable:!1},lv1over:{value:t.available_level>1||!1,writable:!1,enumerable:!1,configurable:!1},is_ex_ability:{value:1===t.is_ex_ability,writable:!1,enumerable:!1,configurable:!1},recast:{value:t.recast,writable:!1,enumerable:!1,configurable:!1},turn:{value:t.turn,writable:!1,enumerable:!1,configurable:!1},second:{value:t.second,writable:!1,enumerable:!1,configurable:!1}})},equal:function(e){return this._abilityData.ability_id===e._abilityData.ability_id},createAbilityIconView:function(e,n){var i=t.createInstance("AbilityIcon",[e,this._abilityData.type,this._abilityData.category,!0===n]);return i.show(),i}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("core.model.ability"),t.core.model.ability.Empty=n.Class.extend({className:"AbilityEmptySlot",ctor:function(){Object.defineProperties(this,{name:{value:"",writable:!1,enumerable:!1,configurable:!1},description:{value:"",writable:!1,enumerable:!1,configurable:!1},available_level:{value:"",writable:!1,enumerable:!1,configurable:!1},learned:{value:!1,writable:!1,enumerable:!1,configurable:!1}})},createAbilityIconView:function(e){return e.setVisible(!1),e}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("core.model.ability"),t.core.model.ability.AssistAbility=n.Class.extend({className:"AssistAbility",ctor:function(e,t){this._abilityData=t,Object.defineProperties(this,{name:{value:t.name,writable:!1,enumerable:!1,configurable:!1},description:{value:t.description,writable:!1,enumerable:!1,configurable:!1},learned:{value:t.learned||!0,writable:!1,enumerable:!1,configurable:!1}})},createAbilityIconView:function(e){var n=new t.view.AssistAbilityIcon(e,null,null,!0);return n.show(),n}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("core.model"),t.core.model.ability.AbilityList=n.Class.extend({className:"AbilityList",_abilitySlots:null,ctor:function(e){this._abilitySlots=e,Object.defineProperties(this,{length:{value:this._abilitySlots.length,writable:!1,enumerable:!1,configurable:!1}})},forEach:function(e,t){this._abilitySlots.forEach(e,t)},forEachBySelectedAbility:function(e,t){this._abilitySlots.forEach(function(t,n){return e.call(this,t.getSelectedAbility(),n)},t)}}),t.core.model.ability.AbilityListFactory={create:function(e,n,i){var a=e.map(function(e,n){var a=n+1,o=(i.select_ability||{})["slot_"+a];return t.core.model.ability.AbilitySlotFactory.create(a,e,o,i.level)}),o=n.map(function(e,n){var a=n+5;return t.core.model.ability.AbilitySlotFactory.createAssistSlot(a,e,i.level)});return new t.core.model.ability.AbilityList(a.concat(o))}}}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=(e.ccui,e._);e.console,t.createNameSpaceIfNotExists("core.model.ability"),t.core.model.ability.AbilitySlot=n.Class.extend({className:"AbilitySlot",ctor:function(e,t,n){this._slotNumber=e,this._abilities=t,this._selectedIndex=n},_abilities:null,_selectedIndex:null,getSelectedAbility:function(){return this._abilities[this._selectedIndex]||this._abilities[0]},select:function(e){this._selectedIndex=Math.max(0,i.findIndex(this._abilities,function(t){return t.equal(e)}))},isMultiple:function(){return this._abilities.length>1},learned:function(){return i.findIndex(this._abilities,function(e){return e.learned})>-1},getAllContent:function(){return[].concat(this._abilities)},getSlotNumber:function(){return this._slotNumber}}),t.core.model.ability.AbilitySlotFactory={create:function(e,n,a,o){var r=0;return Array.isArray(n)&&n.length>1&&!isNaN(a)&&(r=Math.max(i.findIndex(n,function(e){return e.ability_id===a}),0)),this._create(e,n,r,o,t.core.model.ability.Ability)},createAssistSlot:function(e,n,i){return this._create(e,n,0,i,t.core.model.ability.AssistAbility)},_create:function(e,n,a,o,r){if(i.isEmpty(n))return new t.core.model.ability.AbilitySlot(e,[new t.core.model.ability.Empty],a);var s=n;Array.isArray(n)||(s=[n]);var c=s.map(function(e){return new r(o,e)});return new t.core.model.ability.AbilitySlot(e,c,a)}}}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.party=t.party||{},t.party.view=t.party.view||{},t.party.view.FavoriteInfoPopup=t.ImplantedPopup.extend({_parentNodeName:"com_favorite_confirm",_initContents:function(e,n){if(e){var i=n.getType(),a=n.getMemberId(),o=n.getName();if("character"===i)return void t.createInstance("apiCharacters").get(a).then(function(e){var t=e.body,n=this._getParentNode();this._setProperCoreCardElementRarity(n,t,"corecard_ui"),this._setName(t.name)}.bind(this));if("job"===i){var r=this._getParentNode();return this._setProperCoreCardElementRarity(r,{job_id:a,kind:"job"},"corecard_ui"),void this._setName(o)}console.error("type type:"+i+", id:"+a)}},_setName:function(e){this._getParentNode().seekWidgetByName("name_label").setString(e)},_getParentNode:function(){return cc.director.getRunningScene().seekWidgetByName(this._parentNodeName)}}),t.assignRoles(t.party.view.FavoriteInfoPopup,[t.pc.roles.UIUtility,t.pc.roles.CoreCardCommon])}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.party=n.party||{},n.party.model=n.party.model||{},n.party.model.AFavoriteMember=cc.Class.extend({_memberType:"job",_memberId:null,_memberName:"",_isFirstAccess:!1,ctor:function(e){this.updateAFavoriteMember(e.type,e.id,e.name),this.updateIsFirstAccess(e.first_access)},isFavorite:function(e,t){return!!this.existFavoriteMember()&&this._memberType===e&&this._memberId===t},existFavoriteMember:function(){return!t.isNull(this._memberId)},updateIsFirstAccess:function(e){this._isFirstAccess=e},updateAFavoriteMember:function(e,t,n){this._memberType=e,this._memberId=t,this._memberName=n},isFirstAccess:function(){return this._isFirstAccess},getType:function(){return this._memberType},getMemberId:function(){return this._memberId},getName:function(){return this._memberName},isJob:function(){return"job"===this._memberType},isCharacter:function(){return"character"===this._memberType}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("detail.eventHandling"),t.detail.eventHandling.WeaponSellButtonTouchEventHandler=n.Class.extend({className:"WeaponSellButtonTouchEventHandler",handle:function(e,n){var i=this._getAWeaponIdFromRouterParams(e),a=t.createInstance("myselfInfoRepository").getMyCurrency(),o=t.createInstance("apiAWeapons").confirmSellPrice([i]);Q.all([a,o]).spread(function(t,i){var a=t.getGemAmount(),o=i.body.total_sell_price,r=i.body.total_sell_sphere;this._openSellConfirmPopup(e,a,o,r,n)}.bind(this)).fail(function(e){console.error(e)})},_getAWeaponIdFromRouterParams:function(e){return e.routerParams.de_003.id},_openSellConfirmPopup:function(e,n,i,a,o){t.ImplantedPopup.createOrGet(e,"li_weasell_check","LiWeasellCheckPopup").open(n,i,a).then(function(){this._sellWeapon(e,n,i,a,o)}.bind(this))},_sellWeapon:function(e,n,i,a,o){var r=this._getAWeaponIdFromRouterParams(e);t.createInstance("apiAWeapons").sell([r]).then(function(r){t.createInstance("myselfInfoRepository").allCacheClear(),this._openSellResultPopup(e,n,i,a,o)}.bind(this)).fail(function(e){console.error(e)})},_openSellResultPopup:function(e,n,i,a,o){t.ImplantedPopup.createOrGet(e,"li_weasell_result","LiWeasellResultPopup").open(n,i,a).then(function(){t.createInstance("router").back()}.bind(this))}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("detail.eventHandling"),t.detail.eventHandling.SummonSellButtonTouchEventHandler=n.Class.extend({className:"SummonSellButtonTouchEventHandler",handle:function(e,n){var i=this._getASummonIdFromRouterParams(e),a=t.createInstance("myselfInfoRepository").getMyCurrency(),o=t.createInstance("apiASummons").confirmSellPrice([i]);Q.all([a,o]).spread(function(t,i){this._openSellConfirmPopup(e,t.mimicResponse(),i,n)}.bind(this)).fail(function(e){console.error(e)})},_getASummonIdFromRouterParams:function(e){return e.routerParams.de_004.id},_canNotBackScene:function(e){return e._fromEnhEvoPage},_openSellConfirmPopup:function(e,n,i,a){t.ImplantedPopup.createOrGet(e,"li_sumsell_check","LiSumsellCheckPopup").open(n,i).then(function(){this._sellSummon(e,n,i,a)}.bind(this))},_sellSummon:function(e,n,i,a){var o=this._getASummonIdFromRouterParams(e);t.createInstance("apiASummons").sell([o]).then(function(o){t.createInstance("myselfInfoRepository").allCacheClear(),this._openSellResultPopup(e,n,i,a)}.bind(this)).fail(function(e){console.error(e)})},_openSellResultPopup:function(e,n,i,a){var o=t.ImplantedPopup.createOrGet(e,"li_sumsell_result","LiSumsellResultPopup");return a?void o.open(n,i).then(function(){t.createInstance("router").back()}.bind(this)):void o.open(n,i).then(function(){t.createInstance("router").navigate("book")}.bind(this))}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=(e.ccui,e._);e.console,t.createNameSpaceIfNotExists("detail.controller"),t.detail.controller.DetailBackButtonsController=i.Class.extend({className:"DetailBackButtonsController",APPEARANCES:{party:"btn_back_list",book:"btn_back_list",profile:"btn_back_profile"},FROM_PAGE_MAP:{enh_008:"btn_back_select",evo_013:"btn_back_confirm",arousal_002:"btn_back_confirm",acce_002:"btn_back_select",enh_007:"btn_back_select",evo_007:"btn_back_select",evo_008:"btn_back_confirm",enh_009:"btn_back_select",evo_010:"btn_back_select",prf_001:"btn_back_profile",prf_support_summon_config:"btn_back_support_summon",par_pick_member_acce:"btn_back_list",par_001:"btn_back_par"},initialize:function(e){var t=n.getWidgetFromNode(e,"de_btn_back_ui",function(e){});if(null!==t){var i=this._getCurrentAppearanceName(e);t.setAppearance(i)}},_getCurrentAppearanceName:function(e){var n=e.temporaryRouterParams.navigateFrom;if(a.isObject(n)&&n.routes){var i=n.routes.indexOf("/");n=n.routes.substr(i+1)}if(!a.isUndefined(n)&&!a.isUndefined(this.FROM_PAGE_MAP[n]))return this.FROM_PAGE_MAP[n];var o=t.createInstance("router").getCurrentComponent();return this.APPEARANCES[o]}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.detail=n.detail||{},n.detail.view=n.detail.view||{},n.detail.view.ChangeAppearancePopup=n.ImplantedPopup.extend({_parentNodeName:"visual_change_check",_initContents:function(e){this._displayBeforeChangeCharacterImage(e),this._displayAfterChangeCharacterImage(e),this._setCaution(e)},_displayBeforeChangeCharacterImage:function(e){var t=this._getAppearanceCharacterId(e);this._displayCharacterImage(t,"corecard_chara_ui_0")},_displayAfterChangeCharacterImage:function(e){var t=this._getUnusedAppearanceCharacterId(e);this._displayCharacterImage(t,"corecard_chara_ui_1")},_displayCharacterImage:function(e,i){var a=this._getParentNode().seekWidgetByName(i).seekWidgetByName("chara_img"),o="corecard_chara_{id}_0".replace("{id}",t.padZero(e,4)),r=n.img.apply(n,o.split("_")).jpg;a.loadTexture(r),a.setVisible(!0)},_setCaution:function(e){var t=this._getParentNode(),n=t.seekWidgetByName("to_normal_node"),i=t.seekWidgetByName("to_arousal_node"),a=this._hasChangedAppearance(e);n.setVisible(!a),i.setVisible(a)},_hasChangedAppearance:function(e){return e.character_id!==this._getAppearanceCharacterId(e)},_getAppearanceCharacterId:function(e){return e.appearance.used_character_id},_getUnusedAppearanceCharacterId:function(e){return e.appearance.unused_character_id},_getParentNode:function(){return cc.director.getRunningScene().seekWidgetByName(this._parentNodeName)}}),n.assignRoles(n.detail.view.ChangeAppearancePopup,[n.pc.roles.UIUtility,n.pc.roles.CoreCardCommon])}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.detail=t.detail||{},t.detail.view=t.detail.view||{},t.detail.view.AcceUnlockPopup=t.ImplantedPopup.extend({_initContents:function(e){var t=e.result.items;this.__getNeedMaterialUINodes().forEach(this.__showItem.bind(this,t));var n=this.__canRelease(t);this._setEnableButton(this.getNode().seekWidgetByName("btn_release"),n),this.getNode().seekWidgetByName("attention_label").setVisible(!n),this.setButtonEvents({btn_cancel:!1,btn_release:n})},__getNeedMaterialUINodes:function(){return this.getNode().seekWidgets(function(e){return 0===(""+e.name).indexOf("need_material_ui_")})},__showItem:function(e,n,i){if(e[i]){var a=e[i],o=n.seekWidgetByName("corecard_item_ui"),r=t.createInstance("CoreCardItemUI",["plain",o]);r.setImg(a.item_id),r.addTouchEventListener(this._touchItemCoreCard.bind(this,a.item_id),this);var s=n.seekWidgetByName("need_material_label");s.setString(a.need_num.toString()),s.setVisible(!0);var c=a.num>=a.need_num,u=n.seekWidgetByName("have_material_label_sufficient");u.setString(a.num.toString()),u.setVisible(c);var l=n.seekWidgetByName("have_material_label_insufficient");l.setString(a.num.toString()),l.setVisible(!c),n.setVisible(!0)}else n.setVisible(!1)},_touchItemCoreCard:function(e,n,i){i===ccui.Widget.TOUCH_ENDED&&t.createInstance("apiItems").get(e).then(function(e){var n=cc.director.getRunningScene();t.ImplantedPopup.createOrGet(n,"sh_item_info_on_acce_unlock").open(e.body)}.bind(this))},__canRelease:function(e){return!e.find(function(e){return e.num<e.need_num})}}),t.assignRoles(t.detail.view.AcceUnlockPopup,[t.pc.roles.UIUtility])}((this||0).self||global),function(e){var t=(e.cc,e._,e.kh);t.createNameSpaceIfNotExists("core.item"),t.core.item.ShItemInfoOnAcceUnlockPopup=t.core.item.ShItemInfoPopup.extend({dismiss:function(e){var t=this.getNode().getParent().getParent();t.animate("acce_unlock",!1).then(function(){t.setVisible(!0)}.bind(this)),e?this._dfd.resolve(this):this._dfd.reject()}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.router=n.router||{},n.router.routes=n.router.routes||{},t.merge(n.router.routes,{detail:{detail:"de_001_002","detail/de_001":"de_001_002","detail/de_002":"de_001_002","detail/de_001_002":"de_001_002","detail/de_003":"de_003","detail/de_004":"de_004"}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);e.Q,t.createNameSpaceIfNotExists("pc.detail.roles"),t.pc.detail.roles.Routing={_navigate001ToPar001Equip:function(e){var i=e.routerParams.de_001_002;return n.isUndefined(i)?void this._consoleErrorRoutingAbort("routerParams.de_001_002"):n.isUndefined(i.id)||n.isUndefined(i.partyId)||n.isUndefined(i.number)?void this._consoleErrorRoutingAbort("routerParams.de_001_002.id | .partyId | .number"):void t.createInstance("apiAParties").changeCharacter(i.partyId,i.number,i.id).then(function(e){t.createInstance("router").navigate("party/par_001",{tab:"members"},{par_001:{number:e.body.set_num,id:i.id}})}.bind(this)).fail(function(e){console.error(e.stack)})},_navigate001ToPar001Reject:function(e){var i=e.routerParams.de_001_002;return n.isUndefined(i)?void this._consoleErrorRoutingAbort("routerParams.de_001_002"):n.isUndefined(i.partyId)||n.isUndefined(i.number)?void this._consoleErrorRoutingAbort("routerParams.de_001.partyId | .number"):void t.createInstance("apiAParties").changeCharacter(i.partyId,i.number,null).then(function(e){t.createInstance("router").navigate("party/par_001",{tab:"members"})}.bind(this)).fail(function(e){console.error(e.stack)})},_navigate001ToAcce007:function(e,n,i,a){var o={acce_007:{a_character_id:n,num:i,a_accessory_id:a},navigateFrom:e.temporaryRouterParams.navigateFrom};t.createInstance("router").navigate("acce/acce_007",{},o)},_navigate001ToPar009:function(e){var i=e.routerParams.de_001_002;return n.isUndefined(i)?void this._consoleErrorRoutingAbort("routerParams.de_001_002"):n.isUndefined(i.id)||n.isUndefined(i.partyId)||n.isUndefined(i.number)?void this._consoleErrorRoutingAbort("routerParams.de_001_002.id | .partyId | .number"):void t.createInstance("router").navigate("party/par_009",{party_id:i.partyId,par_009:{number:i.number,id:i.id}})},_navigate003ToPar002Equip:function(e){var i=e.routerParams.de_003;return n.isUndefined(i)?void this._consoleErrorRoutingAbort("routerParams.de_003"):n.isUndefined(i.id)||n.isUndefined(i.partyId)||n.isUndefined(i.number)?void this._consoleErrorRoutingAbort("routerParams.de_003.id | .partyId | .number"):void t.createInstance("apiAParties").changeWeapon(i.partyId,i.number,i.id).then(function(e){t.createInstance("router").navigate("party/par_002",{tab:"weapons",par_before:{before_hp:e.body.pre_hp,before_attack:e.body.pre_attk}},{par_002:{newnumber:e.body.set_num}})}.bind(this)).fail(function(e){console.error(e.stack)})},_navigate003ToPar002Reject:function(e){var i=e.routerParams.de_003;if(n.isUndefined(i))this._consoleErrorRoutingAbort("routerParams.de_003");else if(n.isUndefined(i.partyId)||n.isUndefined(i.number))this._consoleErrorRoutingAbort("routerParams.de_003.partyId | .number");else{i=e.routerParams.de_003;t.createInstance("apiAParties").changeWeapon(i.partyId,i.number,null).then(function(e){t.createInstance("router").navigate("party/par_002",{tab:"weapons"})}.bind(this)).fail(function(e){console.error(e.stack)})}},_navigate003ToPar013:function(e){var i=e.routerParams.de_003;return n.isUndefined(i)?void this._consoleErrorRoutingAbort("routerParams.de_003"):n.isUndefined(i.id)||n.isUndefined(i.partyId)||n.isUndefined(i.number)?void this._consoleErrorRoutingAbort("routerParams.de_003.id | .partyId | .number"):void t.createInstance("router").navigate("party/par_013",{party_id:i.partyId,par_013:{number:i.number,id:i.id}})},_navigate004ToPar003Equip:function(e){var i=e.routerParams.de_004;return n.isUndefined(i)?void this._consoleErrorRoutingAbort("routerParams.de_004"):n.isUndefined(i.id)||n.isUndefined(i.partyId)||n.isUndefined(i.number)?void this._consoleErrorRoutingAbort("routerParams.de_004.id | .partyId | .number"):void t.createInstance("apiAParties").changeSummon(i.partyId,i.number,i.id).then(function(e){t.createInstance("router").navigate("party/par_003",{tab:"summons",par_before:{before_hp:e.body.pre_hp,before_attack:e.body.pre_attk}},{par_003:{newnumber:e.body.set_num}})}.bind(this)).fail(function(e){console.error(e.stack)})},_navigate004ToPar003Reject:function(e){var i=e.routerParams.de_004;return n.isUndefined(i)?void this._consoleErrorRoutingAbort("routerParams.de_004"):n.isUndefined(i.partyId)||n.isUndefined(i.number)?void this._consoleErrorRoutingAbort("routerParams.de_004.partyId | .number"):void t.createInstance("apiAParties").changeSummon(i.partyId,i.number,null).then(function(e){t.createInstance("router").navigate("party/par_003",{tab:"summons"})}.bind(this)).fail(function(e){console.error(e.stack)})},_navigate004ToPar015:function(e){var i=e.routerParams.de_004;return n.isUndefined(i)?void this._consoleErrorRoutingAbort("routerParams.de_004"):n.isUndefined(i.id)||n.isUndefined(i.partyId)||n.isUndefined(i.number)?void this._consoleErrorRoutingAbort("routerParams.de_004.id | .partyId | .number"):void t.createInstance("router").navigate("party/par_015",{party_id:i.partyId,par_015:{number:i.number,id:i.id}})},_navigateToPrf001SetSupportSummon:function(e,n){t.createInstance("router").navigate("profile/prf_001a",{prf_001:{id:"me",type:"own",support_summon:{element_type:e,a_summon:n}},tab:"status"})},_navigateToPrf001ReleaseSupportSummon:function(e){t.createInstance("router").navigate("profile/prf_001a",{prf_001:{id:"me",type:"own",support_summon:{element_type:e,a_summon:null}},tab:"status"})},_navigateToSupportSummonConfigTop:function(e){t.createInstance("router").navigate("profile/prf_support_summon_config",{support_summon:{element_type:e}})},_verifyRouterParams001:function(e){n.isUndefined(e.routerParams.de_001_002)&&(e.routerParams.de_001_002={},e.routerParams.de_001_002.id=1,this._consoleErrorRouterParams("routerParams.de_001_002"))},_verifyRouterParams003:function(e){n.isUndefined(e.routerParams.de_003)&&(e.routerParams.de_003={},e.routerParams.de_003.id=1,this._consoleErrorRouterParams("routerParams.de_003"))},_verifyRouterParams004:function(e){n.isUndefined(e.routerParams.de_004)&&(e.routerParams.de_004={},e.routerParams.de_004.id=1,this._consoleErrorRouterParams("routerParams.de_004"))}},n.assign(t.pc.detail.roles.Routing,t.pc.roles.RoutingCommon)}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);t.createNameSpaceIfNotExists("detail.view"),t.detail.view.LiSumsellCheckPopup=t.ImplantedPopup.extend({_initContents:function(e,n){this.setButtonEvents({btn_cancel:!1,btn_sell:!0});var i=e.body.gem,a=n.body.total_sell_price,o=e.body.summon_orb,r=n.body.total_summon_orb,s=n.body.total_sell_sphere;0!=s&&this.getNode().setAppearance("exp"),this.getNode().setHtmlStrings({get_jem_labelimg:this.GET_JEM_LABELIMG_TEMPLATE({getJem:a}),have_jem_labelimg:this.HAVE_JEM_LABELIMG_TEMPLATE({beforeJem:i,afterJem:i+a}),have_summon_orb_labelimg:this.HAVE_SUMMON_LABELIMG_TEMPLATE({beforeOrb:o,afterOrb:o+r}),get_summon_orb_labelimg:this.GET_SUMMON_ORB_LABELIMG({getOrb:r}),get_exp_labelimg:this.GET_EXP_LABELIMG_TEMPLATE({getExp:s})},t.GameConfig.POPUP_CSS)},GET_SUMMON_ORB_LABELIMG:n.template("<div class='comSellNumbox'><span class=\"white\"><%=getOrb%></span></div>"),GET_JEM_LABELIMG_TEMPLATE:n.template("<div class='comSellNumbox'><span class=\"white\"><%=getJem%></span></div>"),HAVE_JEM_LABELIMG_TEMPLATE:n.template('<div class=\'comSellNumbox\'><span class="white"><%=beforeJem%>&emsp;&ensp;</span><span class="yellow"><%=afterJem%></span></div>'),GET_EXP_LABELIMG_TEMPLATE:n.template("<div class='comSellNumbox'><span class=\"white\"><%=getExp%></span></div>"),HAVE_SUMMON_LABELIMG_TEMPLATE:n.template('<div class=\'comSellNumbox\'><span class="white"><%=beforeOrb%>&emsp;&ensp;</span><span class="yellow"><%=afterOrb%></span></div>')}),t.dictx.registerWithProtoStrategy("LiSumsellCheckPopup",t.detail.view.LiSumsellCheckPopup)}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);t.createNameSpaceIfNotExists("detail.view"),t.detail.view.LiWeasellCheckPopup=t.ImplantedPopup.extend({_initContents:function(e,n,i){this.setButtonEvents({btn_cancel:!1,btn_sell:!0}),0!=i&&this.getNode().setAppearance("exp"),this.getNode().setHtmlStrings({get_jem_labelimg:this.GET_JEM_LABELIMG_TEMPLATE({getJem:n}),have_jem_labelimg:this.HAVE_JEM_LABELIMG_TEMPLATE({beforeJem:e,afterJem:e+n}),get_exp_labelimg:this.GET_EXP_LABELIMG_TEMPLATE({getExp:i})},t.GameConfig.POPUP_CSS)},GET_JEM_LABELIMG_TEMPLATE:n.template("<div class='comSellNumbox'><span class=\"white\"><%=getJem%></span></div>"),HAVE_JEM_LABELIMG_TEMPLATE:n.template('<div class=\'comSellNumbox\'><span class="white"><%=beforeJem%>&emsp;&ensp;</span><span class="yellow"><%=afterJem%></span></div>'),GET_EXP_LABELIMG_TEMPLATE:n.template("<div class='comSellNumbox'><span class=\"white\"><%=getExp%></span></div>")}),t.dictx.registerWithProtoStrategy("LiWeasellCheckPopup",t.detail.view.LiWeasellCheckPopup)}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);t.createNameSpaceIfNotExists("detail.view"),t.detail.view.LiSumsellResultPopup=t.ImplantedPopup.extend({_initContents:function(e,n){this.setButtonEvents({btn_ok:!0});var i=e.body.gem,a=n.body.total_sell_price,o=e.body.summon_orb,r=n.body.total_summon_orb,s=n.body.total_sell_sphere;0!=s&&this.getNode().setAppearance("exp"),this.getNode().setHtmlStrings({get_jem_labelimg:this.GET_JEM_LABELIMG_TEMPLATE({getJem:a}),have_jem_labelimg:this.HAVE_JEM_LABELIMG_TEMPLATE({beforeJem:i,afterJem:i+a}),have_summon_orb_labelimg:this.HAVE_SUMMON_LABELIMG_TEMPLATE({beforeOrb:o,afterOrb:o+r}),get_summon_orb_labelimg:this.GET_SUMMON_ORB_LABELIMG({getOrb:r}),get_exp_labelimg:this.GET_EXP_LABELIMG_TEMPLATE({getExp:s})},t.GameConfig.POPUP_CSS)},GET_SUMMON_ORB_LABELIMG:n.template("<div class='comSellNumbox'><span class=\"white\"><%=getOrb%></span></div>"),GET_JEM_LABELIMG_TEMPLATE:n.template("<div class='comSellNumbox'><span class=\"white\"><%=getJem%></span></div>"),HAVE_JEM_LABELIMG_TEMPLATE:n.template('<div class=\'comSellNumbox\'><span class="white"><%=beforeJem%>&emsp;&ensp;</span><span class="yellow"><%=afterJem%></span></div>'),GET_EXP_LABELIMG_TEMPLATE:n.template("<div class='comSellNumbox'><span class=\"white\"><%=getExp%></span></div>"),HAVE_SUMMON_LABELIMG_TEMPLATE:n.template('<div class=\'comSellNumbox\'><span class="white"><%=beforeOrb%>&emsp;&ensp;</span><span class="yellow"><%=afterOrb%></span></div>')}),t.dictx.registerWithProtoStrategy("LiSumsellResultPopup",t.detail.view.LiSumsellResultPopup)}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);t.createNameSpaceIfNotExists("detail.view"),t.detail.view.LiWeasellResultPopup=t.ImplantedPopup.extend({_initContents:function(e,n,i){this.setButtonEvents({btn_ok:!0}),0!=i&&this.getNode().setAppearance("exp"),this.getNode().setHtmlStrings({get_jem_labelimg:this.GET_JEM_LABELIMG_TEMPLATE({getJem:n}),have_jem_labelimg:this.HAVE_JEM_LABELIMG_TEMPLATE({beforeJem:e,afterJem:e+n}),get_exp_labelimg:this.GET_EXP_LABELIMG_TEMPLATE({getExp:i})},t.GameConfig.POPUP_CSS)},GET_JEM_LABELIMG_TEMPLATE:n.template("<div class='comSellNumbox'><span class=\"white\"><%=getJem%></span></div>"),HAVE_JEM_LABELIMG_TEMPLATE:n.template('<div class=\'comSellNumbox\'><span class="white"><%=beforeJem%>&emsp;&ensp;</span><span class="yellow"><%=afterJem%></span></div>'),GET_EXP_LABELIMG_TEMPLATE:n.template("<div class='comSellNumbox'><span class=\"white\"><%=getExp%></span></div>")}),t.dictx.registerWithProtoStrategy("LiWeasellResultPopup",t.detail.view.LiWeasellResultPopup)}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc=t.pc||{},t.pc.detail=t.pc.detail||{},t.pc.detail.de_001_002=t.pc.detail.de_001_002||{},t.pc.detail.de_001_002.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../de_popup_ui.json"],_popups:{popupAcceUnlockConfirm:{factoryName:"popupFactoryBlackBlue",title:"",content:"?",buttonLabels:{blueBtn:"OK",blackBtn:""},buttonSounds:{blueBtn:t.SoundList.BUTTON_TOUCHED_CONFIRMED},buttons:{blueBtn:function(e){this.dismiss(),e._unlockAcceDefer.resolve()},blackBtn:function(e){this.dismiss(),e._unlockAcceDefer=null}}},popupAcceUnlockComplete:{factoryName:"popupFactoryTextOnly",resource:"text_button_only.json",title:"",content:"!",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){this.dismiss()}}},popupAcceUnlockError:{factoryName:"popupFactoryTextOnly",resource:"text_button_only.json",title:"",content:"1</br>",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){this.dismiss()}}}},_isOwn:!0,_fromPartyPage:!1,_equipedSelf:!0,_aFavoriteMemberModel:null,onSceneInit:function(e){a.defer(),e.enableRestore(!1),this._verifyRouterParams001(e),this._disableAcceConfirmBtn(e),t.createInstance("DetailBackButtonsController").initialize(e),this._setBackBtn(e),this._setPropertires(e),this._loadACharacter(e.routerParams.de_001_002.id,this._isOwn).then(function(t){this._loadAccessories(e),this._initializeAcceTab(e),this._setSound(e),this._setChangeAppearanceBtn(e)}.bind(this)).then(function(){return this._enableAcceConfirmBtn(e),this._loadFavoriteMemberInfo()}.bind(this)).then(function(){var t=this._isFavorite();this._setFavoriteBtn(t,e)}.bind(this)).then(function(){"tab_0"!==e.tabDelegateList[0].selected&&this.cleanUpAvatar()}.bind(this)).fail(function(e){console.error(e.stack)});var n=e.tabDelegateList[0],i="tab_0";return e.temporaryRouterParams.de_001_002&&e.temporaryRouterParams.de_001_002.tab&&(i=e.temporaryRouterParams.de_001_002.tab,delete e.temporaryRouterParams.de_001_002.tab),n.selectTab(n._getContainerNode().seekWidgetByName(i)),a.resolve()},onSceneEnter:function(e){return a.defer(),a.resolve()},onSceneExit:function(e){return a.defer(),a.resolve()},onPageInAnimationEnd:function(e){return a.defer(),a.resolve()},_loadFavoriteMemberInfo:function(){return t.createInstance("apiAFavoriteMember").get().then(function(e){var n=e.body;this._aFavoriteMemberModel=t.createInstance("AFavoriteMemberModel",[n])}.bind(this)).fail(function(e){console.error(e.stack)})},_setFavoriteBtn:function(e,t){i.isUndefined(t)&&(t=n.director.getRunningScene());var a=t.seekWidgetByName("setting_icon"),o=t.seekWidgetByName("btn_favorite_ui");o.setVisible(this._isOwn),a.setVisible(this._isOwn&&e),this._isOwn&&(e?o.setAppearance("favorite_on"):o.setAppearance("favorite_off"))},_updateAFavoriteMember:function(e,t){this._aFavoriteMemberModel.updateAFavoriteMember("character",e,t);var n=this._isFavorite();this._setFavoriteBtn(n)},tabCallbackTab0:function(e){if(this._setToPartyButton(e),this._character){var t=this._character.character_id;this.updateAvatar(t)}},tabCallbackTab1:function(e){this._setToPartyButton(e),this.cleanUpAvatar()},tabCallbackTab2:function(e){this._setConfirmButton(e),this.cleanUpAvatar()},btnCallbackAbilityListEpBtn:function(e){var t=a.defer();return t.resolve(),t.promise},btnCallbackBtnDisabled:function(e){var n=a.defer();n.reject(this._override);var i=t.ImplantedPopup.createOrGet(e,"book_request_rank","CanNotUseAccessoryPopup");return i.setButtonEvents({btn_ok:!0}),i.open(),n.promise},btnCallbackBtnCancel:function(e){var n=a.defer();return n.reject(this._override),e.routerParams.de_001_002.fromPartyTopPage?(t.createInstance("router").navigate("party/par_001",{tab:"members"}),n.promise):(this._navigate001ToPar009(e),n.promise)},btnCallbackBtnOrganize:function(e){var t=a.defer();return t.reject(this._override),this._navigate001ToPar001Equip(e),t.promise},btnCallbackBtnReject:function(e){var t=a.defer();return t.reject(this._override),this._navigate001ToPar001Reject(e),t.promise},btnCallbackBtnConfirm:function(e){var t=a.defer();return(t=a.defer()).reject(this._override),this._openAcceInfoPopup(e),t.promise},btnCallbackBtnEnh:function(e){var t=a.defer();return t.reject(this._override),this._touchEnhButton(),t.promise},btnCallbackBtnEvo:function(e){var t=a.defer();return t.reject(this._override),this._touchEvoButton(),t.promise},btnCallbackBtnArousal:function(e){var t=a.defer();return t.reject(this._override),this._touchArouseButton(),t.promise},btnCallbackBtnAllOver:function(e){var t=a.defer();return t.reject(this._override),this._showImageZoomPopup(),t.promise},btnCallbackBtnFavoriteUiBtnFavorite:function(e){var n=a.defer();return n.reject(this._override),i.isNull(this._aFavoriteMemberModel)?n.promise:this._aFavoriteMemberModel.isFirstAccess()?(t.createInstance("apiAFavoriteMember").firstAccess().then(function(t){t.body.result&&(this._aFavoriteMemberModel.updateIsFirstAccess(!1),this._showFirstAccessPopup(e))}.bind(this)).fail(function(e){console.error(e.stack)}),n.promise):this._aFavoriteMemberModel.existFavoriteMember()?this._isFavorite()?(this._releaseFavorite(),n.promise):(this._showFavoriteConfigPopup(e),n.promise):(this._onTouchSetFavoriteBtn(),n.promise)},_releaseFavorite:function(){return t.createInstance("apiAFavoriteMember").update(null,"character").then(function(e){e.body.result&&this._updateAFavoriteMember(null,"")}.bind(this)).fail(function(e){console.error(e.stack)})},_isFavorite:function(){var e=this._getAppearanceCharacterId();return this._aFavoriteMemberModel.isFavorite("character",e)},_showFirstAccessPopup:function(e){var n=t.ImplantedPopup.createOrGet(e,"com_favorite_info","FavoriteInfoPopup");n.setButtonEvents({btn_cancel:!1,btn_ok:!0}),n.open(!1,this._aFavoriteMemberModel).then(function(){}.bind(this)).then(function(){this._onTouchSetFavoriteBtn()}.bind(this)).fail(function(e){console.error(e.stack)})},_showFavoriteConfigPopup:function(e){var n=t.ImplantedPopup.createOrGet(e,"com_favorite_confirm","FavoriteInfoPopup");n.setButtonEvents({btn_cancel:!1,btn_ok:!0}),n.open(!0,this._aFavoriteMemberModel).then(function(){}.bind(this)).then(function(){this._onTouchSetFavoriteBtn()}.bind(this)).fail(function(e){console.error(e.stack)})},_onTouchSetFavoriteBtn:function(){return t.createInstance("apiAFavoriteMember").update(this._character.character_id,"character").then(function(e){if(e.body.result){var t=this._getAppearanceCharacterId();this._updateAFavoriteMember(t,this._character.name)}}.bind(this)).fail(function(e){console.error(e.stack)})},btnCallbackVisualChangeBtnUiBtnVisualChangeAfter:function(e){var t=a.defer();return t.reject(this._override),this._showChangeAppearancePopup(e,"after_arouse"),t.promise},btnCallbackVisualChangeBtnUiBtnVisualChangeBefore:function(e){var t=a.defer();return t.reject(this._override),this._showChangeAppearancePopup(e,"before_arouse"),t.promise},_setChangeAppearanceBtn:function(e){var t=e.seekWidgetByName("visual_change_btn_ui");return this._isOwn&&this._canChangeAppearance()?this._hasChangedAppearance()?void t.setAppearance("btn_after"):void t.setAppearance("btn_before"):void t.setAppearance("btn_off")},_hasChangedAppearance:function(){return!!this._character.is_aroused&&this._character.character_id!==this._getAppearanceCharacterId()},_getAppearanceCharacterId:function(){return this._character.appearance.used_character_id},_getUnusedAppearanceCharacterId:function(){return this._character.appearance.unused_character_id},_canChangeAppearance:function(){return null!==this._getUnusedAppearanceCharacterId()},_showChangeAppearancePopup:function(e,n){var i=t.ImplantedPopup.createOrGet(e,"visual_change_check","ChangeAppearancePopup");i.setButtonEvents({btn_cancel:!1,btn_ok:!0}),i.open(this._character).then(function(){}.bind(this)).then(function(){this._onTouchChangeAppearanceBtnOnPopup(n)}.bind(this)).fail(function(e){console.error(e.stack)})},_onTouchChangeAppearanceBtnOnPopup:function(e){return t.createInstance("apiACharacters").changeAppearance(this._character.a_character_id,e).then(function(e){e.body.result&&this._updateAppearance()}.bind(this)).fail(function(e){console.error(e.stack)})},_updateAppearance:function(){this._swapAppearanceId();var e=n.director.getRunningScene();this._setChangeAppearanceBtn(e);var t=this._getAppearanceCharacterId();this.updateAvatar(t),this.updateCharacterVoices(t),this.updateBackgroundImage()},_swapAppearanceId:function(){var e={used_character_id:this._getUnusedAppearanceCharacterId(),unused_character_id:this._getAppearanceCharacterId()};this._character.appearance=e},btnCallbackBtnBackList:function(e){return this._btnCallbackBtnCommon(e)},btnCallbackBtnBackSelect:function(e){return this._btnCallbackBtnCommon(e)},btnCallbackBtnBackConfirm:function(e){return this._btnCallbackBtnCommon(e)},btnCallbackBtnBackProfile:function(e){return this._btnCallbackBtnCommon(e)},_touchEndedBackBtnProcess:function(e){return this._btnCallbackBtnCommon(e)},_btnCallbackBtnCommon:function(e){var n=e.temporaryRouterParams.navigateFrom;if(i.isUndefined(n))return t.createInstance("router").navigate("book/book_001_character"),a.reject(this._override);var o={};i.isUndefined(n.routerParams)||(o=n.routerParams);var r={};return i.isUndefined(n.temporaryRouterParams)||(r=n.temporaryRouterParams),t.createInstance("router").navigate(n.routes,o,r),a.reject(this._override)},_setPropertires:function(e){this._fromPartyPage=e.routerParams.de_001_002.fromPartyPage,this._equipedSelf=e.routerParams.de_001_002.equipedSelf,this._isOwn=e.routerParams.de_001_002.isOwn},_setToPartyButton:function(e){var t=e.seekWidgetByName("de_chara_btn_ui");return this._isOwn?this._fromPartyPage?this._equipedSelf?void t.setAppearance("cancel_reject"):void t.setAppearance("cancel_organize"):void t.setAppearance("default_view"):void t.setVisible(!1)},_setConfirmButton:function(e){e.seekWidgetByName("de_chara_btn_ui").setAppearance("confirm")},_setSound:function(e){e.seekWidgetByName("btn_cancel").setSound(t.SoundList.BUTTON_TOUCHED_CANCEL)},_initializeAcceTab:function(e){var n=t.createInstance("accessoryInfoModel");n.prepare().then(function(){var t=!n.canBeUsed(),i=e.seekWidgetByName("btn_disabled");null!==i&&(i.setVisible(t),i.setEnabled(t))}.bind(this))},_loadAccessories:function(e){this._khCharacterAccessoriesModel=t.createInstance("characterAccessoriesModel");var n=e.routerParams.de_001_002.id;return this._khCharacterAccessoriesModel.prepare(n).then(function(){this._updateAcceView(e);var t=(e.temporaryRouterParams.de_001_002||{}).equipped_a_accessory_id;if(!i.isUndefined(t)||null!==t){var n=this._khCharacterAccessoriesModel.getAccessoryByAAccessoryId(t);null!==n&&(this._openAcceSetPopup(e,n),this._removeEquippedAccessoryTemporaryParam(e))}}.bind(this)).fail(function(e){console.error(e.stack)})},_updateAcceView:function(e){var t=this._getNodeByName("introduce_acce_status_ui",e),n=this._getUiNodes(t);n.rarity_icon.loadTexture(this._khCharacterAccessoriesModel.getRarityIconPath(),ccui.Widget.PLIST_TEXTURE),n.rarity_bar.loadTexture(this._khCharacterAccessoriesModel.getRarityBarPath(),ccui.Widget.PLIST_TEXTURE),n.name.setText(this._khCharacterAccessoriesModel.getName()),this._khCharacterAccessoriesModel.getBonus()>0?n.bonus.setText("+"+this._khCharacterAccessoriesModel.getBonus()):n.bonus.setText(""),n.hp.setText(this._khCharacterAccessoriesModel.getHp()),n.attack.setText(this._khCharacterAccessoriesModel.getAttack()),n.total_accessory_hp.setVisible(!0),n.total_accessory_hp.setText("+"+this._khCharacterAccessoriesModel.getTotalAccessoryHp()),n.total_accessory_attack.setVisible(!0),n.total_accessory_attack.setText("+"+this._khCharacterAccessoriesModel.getTotalAccessoryAttack()),this.__setSeriesEffect(n,this._khCharacterAccessoriesModel);var a=this._khCharacterAccessoriesModel.getAccessorySlotCount();i.each(i.range(0,a),function(t){this._setAccessorySlot(e,t)}.bind(this))},__setSeriesEffect:function(e,t){return t.hasSeriesEffect()?(e.series_name.setText(t.getSeriesEffectName()),void e.series_effect.setText(t.getSeriesEffectDescription())):(e.series_name.setText(""),void e.series_effect.setText(""))},_setAccessorySlot:function(e,t){var n="introduce_acce_status_card_ui_"+t,i=this._getNodeByName(n,e);return this._khCharacterAccessoriesModel.isAccessorySlotLocked(t)?void this._setLockSlot(e,i,t):this._khCharacterAccessoriesModel.isAccessorySlotEmpty(t)?void this._setEmptySlot(e,i,t):void this._setEquipedSlot(e,i,t)},_setLockSlot:function(e,t,n){this._setInvisibleNotEquippedMark(t),this._setAppearanceProtectedViewToNode(t,n),this._isOwn&&this._setTouchEvent(t,e,n)},_setEquipedSlot:function(e,t,n){this._setInvisibleNotEquippedMark(t),this._setAppearanceCoraCardViewToNode(t);var i=this._khCharacterAccessoriesModel.getAccessoryByIndex(n),a=t.getChildren().filter(function(e){return 0===(e.getName()||"").indexOf("corecard_acce_ui")})[0];if(!a)throw"";var o=a.getName();this._setAccessoryCoreCardFull(t,i,o),this._setTouchEvent(t,e,n)},_setEmptySlot:function(e,t,n){this._setInvisibleNotEquippedMark(t,!0),this._setAppearanceEquipViewToNode(t),this._isOwn&&this._setTouchEvent(t,e,n)},_setInvisibleNotEquippedMark:function(e,t){this._getNodeByName("equip",e).setVisible(!0===t)},_setAppearanceProtectedViewToNode:function(e,t){var n={3:"protected_0_view",4:"protected_1_view"};if(i.isUndefined(n[t]))console.error("SceneDelegate._setAccessorySlot(): lock animation for slot number "+t+" not found.");else{var a=n[t];e.setAppearance(a)}},_setAppearanceCoraCardViewToNode:function(e){e.setAppearance("corecard_view")},_setAppearanceEquipViewToNode:function(e){e.setAppearance("equip_view")},_setTouchEvent:function(e,n,i){var a=this._getNodeByName("touch_panel",e);a.setVisible(!0),a.setEnabled(!0),a.setSoundEnabled(!0),a.setSound(t.SoundList.BUTTON_TOUCHED_DEFAULT),a.setTouchEnabled(!0),a.addTouchEventListener(function(e,t){t===ccui.Widget.TOUCH_ENDED&&this._changeAccessory(n,i)}.bind(this))},_changeAccessory:function(e,t){if(this._khCharacterAccessoriesModel.isAccessorySlotLocked(t)){if(!this._isOwn)return;return t>1&&this._khCharacterAccessoriesModel.isAccessorySlotLocked(t-1)?void this._openLockedSlotSelectedPopup(e):void this._openUnlockSlotPopup(e)}if(this._isOwn){var n=this._khCharacterAccessoriesModel.getACharacterId(),i=this._khCharacterAccessoriesModel.getAccessoryByIndex(t),a=i?i.a_accessory_id:null;this._navigate001ToAcce007(e,n,t,a)}else this._openAcceDetailPopup(e,t)},_openLockedSlotSelectedPopup:function(e){e.popups.popupAcceUnlockError.open()},_openUnlockSlotPopup:function(e){var n=this._khCharacterAccessoriesModel,i=n.getACharacterId(),o=t.createInstance("apiACharacters");o.getAccessoryUnlockMaterials(i).then(function(e){return e.body}).then(function(n){return t.ImplantedPopup.createOrGet(e,"acce_unlock").open(n)}).then(function(){return e._unlockAcceDefer=a.defer(),e.popups.popupAcceUnlockConfirm.open(),e._unlockAcceDefer.promise}).then(o.unlockAccessoryEquip.bind(o,i)).then(function(t){var o=t.body;return o.error_info&&o.error_info.type?(console.error("UnlockAcceSlotError:"+o.error_info.type+" ACharacterId:"+i),a.reject()):(e.popups.popupAcceUnlockComplete.open(),n.unlockAccessorySlot(),a.resolve(o.result.max_accessory_equip_amount-1))}).then(this._setAccessorySlot.bind(this,e)).fail(function(e){e instanceof Error&&console.error(e)})},_openAcceDetailPopup:function(e,n){var i=this._khCharacterAccessoriesModel.getAccessoryByIndex(n);return t.ImplantedPopup.createOrGet(e,"acce_detail_protection_on_off","AcceOthersDetailPopup").open(i,this._khCharacterAccessoriesModel,n,!1)},_openAcceInfoPopup:function(e){return t.ImplantedPopup.createOrGet(e,"acce_info","AcceInfoPopup").open(this._khCharacterAccessoriesModel,!1)},_openAcceSetPopup:function(e,n){return t.ImplantedPopup.createOrGet(e,"acce_set","AcceSetPopup").open(n)},_removeEquippedAccessoryTemporaryParam:function(e){delete e.temporaryRouterParams.de_001_002.equipped_a_accessory_id,t.createInstance("router").permanentlyRemoveRouterParamByPath("de_001_002.equipped_a_accessory_id;",!0)},_getUiNodes:function(e){return i.mapValues({name:"name_label",bonus:"plus_no",rarity_icon:"rarity_icon",rarity_bar:"name_base",hp:"hp_no",attack:"attack_no",total_accessory_hp:"hp_plus_no",total_accessory_attack:"attack_plus_no",series_name:"series_name_label",series_effect:"series_effect_label"},function(t,n){return this._getNodeByName(t,e)}.bind(this))},_getNodeByName:function(e,t){i.isUndefined(t)&&(t=n.director.getRunningScene());var a=t.seekWidgetByName(e);return a||console.warn("SceneDelegate._getNodeByName(): node '"+e+"' not found"),a},_disableAcceConfirmBtn:function(e){var t=e.seekWidgetByName("btn_confirm");this._setEnableButton(t,!1)},_enableAcceConfirmBtn:function(e){var t=e.seekWidgetByName("btn_confirm");this._setEnableButton(t,!0)}}),i.assign(t.pc.detail.de_001_002.SceneDelegate.prototype._popups,t.acce.view.AcceDetailCommonPopup.prototype._popups),t.assignRoles(t.pc.detail.de_001_002.SceneDelegate,[t.pc.roles.UIUtility,t.pc.detail.roles.Routing,t.pc.roles.CoreCardCommon,t.pc.scene.roles.SceneCharacterCommon])}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.detail=t.pc.detail||{},t.pc.detail.de_001_002=t.pc.detail.de_001_002||{},t.pc.detail.de_001_002.Scene=t.BaseScene.extend({resourceFileName:"de_001_2/de_001_2.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[{tab1:{node:"tab_0","content-node":"introduce_chara_status_1_ui"},tab2:{node:"tab_1","content-node":"introduce_statuslist_list_7_ui"},tab3:{node:"tab_2","content-node":"introduce_acce_status_ui"}},{tab1:{node:"tab_blue","content-node":"tab_blue_node","container-node":"introduce_acce_status_ui"},tab2:{node:"tab_green","content-node":"tab_green_node","container-node":"introduce_acce_status_ui"}}],componentName:"detail",sceneName:"de_001_002",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"ability_list_ep_btn","btnCallbackAbilityListEpBtn",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"epi/epi_002")),this._initButtonEvent.call(this,this.seekWidgetByPath("introduce_acce_status_ui"),"btn_hint","btnCallbackIntroduceAcceStatusUiBtnHint",null,function(e){return t.ImplantedPopup.createOrGet(this,"acce_series_hint",void 0).open()}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_disabled","btnCallbackBtnDisabled",null,function(){alert("{{book_request_rank}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_cancel","btnCallbackBtnCancel",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"party/par_009")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_organize","btnCallbackBtnOrganize",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"party/par_001_2_3")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_reject","btnCallbackBtnReject",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"party/par_001_2_3")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_confirm","btnCallbackBtnConfirm",null,function(){alert("{{acce_info}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_enh","btnCallbackBtnEnh",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"enh_evo/enh_008")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_evo","btnCallbackBtnEvo",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"enh_evo/evo_013")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_arousal","btnCallbackBtnArousal",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"enh_evo/arousal_002")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_all_over","btnCallbackBtnAllOver",null,function(){alert("{{all over ui}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("btn_favorite_ui"),"btn_favorite","btnCallbackBtnFavoriteUiBtnFavorite",null,function(){alert("{{//com_favorite_info/com_favorite_confirm}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("visual_change_btn_ui"),"btn_visual_change_after","btnCallbackVisualChangeBtnUiBtnVisualChangeAfter",null,function(){alert("{{visual_change_checkto_arousal_nodeVisibleTrue}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("visual_change_btn_ui"),"btn_visual_change_before","btnCallbackVisualChangeBtnUiBtnVisualChangeBefore",null,function(){alert("{{visual_change_checkto_normal_nodeVisibleTrue}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._),i=e.Q;t.pc=t.pc||{},t.pc.detail=t.pc.detail||{},t.pc.detail.de_003=t.pc.detail.de_003||{},t.pc.detail.de_003.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../de_popup_ui.json"],_popups:{},_isOwn:!0,_fromPartyPage:!1,_fromEnhEvoPage:!1,_equipedSelf:!0,onSceneInit:function(e){return i.defer(),this._verifyRouterParams003(e),this._setProperties(e),t.createInstance("DetailBackButtonsController").initialize(e),this._setBackBtn(e),this._loadAWeapon(e.routerParams.de_003.id,this._isOwn).then(function(t){this._setButton(e),this._setSound(e)}.bind(this)).fail(function(e){console.error(e.stack)}),i.resolve()},onSceneEnter:function(e){return i.defer(),i.resolve()},onSceneExit:function(e){return i.defer(),i.resolve()},onPageInAnimationEnd:function(e){return i.defer(),i.resolve()},btnCallbackBtnCancel:function(e){var n=i.defer();return n.reject(this._override),e.routerParams.de_003.fromPartyTopPage?(t.createInstance("router").navigate("party/par_001",{tab:"weapons"}),n.promise):(this._navigate003ToPar013(e),n.promise)},btnCallbackBtnOrganize:function(e){var t=i.defer();return t.reject(this._override),this._navigate003ToPar002Equip(e),t.promise},btnCallbackBtnReject:function(e){var t=i.defer();return t.reject(this._override),this._navigate003ToPar002Reject(e),t.promise},btnCallbackBtnProtect:function(e){var t=i.defer();return t.reject(this._override),this._touchProtect(),t.promise},btnCallbackBtnSell:function(e){var n=i.defer();n.reject(this._override);var a=!this._fromEnhEvoPage;return t.createInstance("weaponSellButtonTouchEventHandler").handle(e,a),n.promise},btnCallbackBtnEnh:function(e){var t=i.defer();return t.reject(this._override),this._touchEnhButton(),t.promise},btnCallbackBtnEvo:function(e){var t=i.defer();return t.reject(this._override),this._touchEvoButton(),t.promise},btnCallbackBtnEvoFinal:function(e){var t=i.defer();return t.reject(this._override),this._touchFinalEvoButton(),t.promise},btnCallbackBtnAllOver:function(e){var t=i.defer();return t.reject(this._override),this._showImageZoomPopup(),t.promise},btnCallbackBtnBackList:function(e){return this._btnCallbackBtnCommon(e)},btnCallbackBtnBackSelect:function(e){return this._btnCallbackBtnCommon(e)},btnCallbackBtnBackConfirm:function(e){return this._btnCallbackBtnCommon(e)},btnCallbackBtnBackProfile:function(e){return this._btnCallbackBtnCommon(e)},_btnCallbackBtnCommon:function(e){var a=e.temporaryRouterParams.navigateFrom;if(!n.isUndefined(a)){var o={};n.isUndefined(a.routerParams)||(o=a.routerParams);var r={};return n.isUndefined(a.temporaryRouterParams)||(r=a.temporaryRouterParams),t.createInstance("router").navigate(a.routes,o,r),i.reject(this._override)}t.createInstance("router").navigate("book/book_001_weapon")},_setProperties:function(e){this._fromPartyPage=e.routerParams.de_003.fromPartyPage,this._equipedSelf=e.routerParams.de_003.equipedSelf,this._isOwn=e.routerParams.de_003.isOwn,n.isUndefined(e.routerParams.de_003.fromEnhEvoPage)?this._fromEnhEvoPage=!1:this._fromEnhEvoPage=e.routerParams.de_003.fromEnhEvoPage},_setButton:function(e){this._setToPartyButton(e)},_setToPartyButton:function(e){var t=e.seekWidgetByName("de_weapon_summon_btn_ui");return this._isOwn?this._fromPartyPage?this._equipedSelf?void t.setAppearance("cancel_reject"):void t.setAppearance("cancel_organize"):void t.setAppearance("default_view"):void t.setVisible(!1)},_setSound:function(e){e.seekWidgetByName("btn_cancel").setSound(t.SoundList.BUTTON_TOUCHED_CANCEL)},btnCallbackBtnLastEvoAble:function(e){var t=i.defer();return t.reject(this._override),this._openShWeaponInfoPopup(this._weapon.weapon_id),t.promise},_touchEndedBackBtnProcess:function(e){return this._btnCallbackBtnCommon(e)}}),n.assign(t.pc.detail.de_003.SceneDelegate.prototype,t.pc.roles.UIUtility,t.pc.detail.roles.Routing,t.pc.scene.roles.SceneWeaponCommon,t.pc.roles.ShInfoPopupInvoker)}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.detail=t.pc.detail||{},t.pc.detail.de_003=t.pc.detail.de_003||{},t.pc.detail.de_003.Scene=t.BaseScene.extend({resourceFileName:"de_003/de_003.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"detail",sceneName:"de_003",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_cancel","btnCallbackBtnCancel",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"party/par_013")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_organize","btnCallbackBtnOrganize",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"party/par_001_2_3")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_reject","btnCallbackBtnReject",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"party/par_001_2_3")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_protect","btnCallbackBtnProtect",null,function(){alert("{{com_protect_on/com_protect_off}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_sell","btnCallbackBtnSell",null,function(){alert("{{li_weasell_check}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_enh","btnCallbackBtnEnh",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"enh_evo/enh_007")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_evo","btnCallbackBtnEvo",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"enh_evo/evo_007")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_all_over","btnCallbackBtnAllOver",null,function(){alert("{{all over ui}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_last_evo_able","btnCallbackBtnLastEvoAble",null,function(){alert("{{sh_weapon_info}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_evo_final","btnCallbackBtnEvoFinal",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"enh_evo/evo_007")),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._),i=e.Q;t.pc=t.pc||{},t.pc.detail=t.pc.detail||{},t.pc.detail.de_004=t.pc.detail.de_004||{},t.pc.detail.de_004.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../de_popup_ui.json"],_popups:{},_isOwn:!0,_fromPartyPage:!1,_fromEnhEvoPage:!1,_supportSummonInfo:null,_equipedSelf:!0,_equipedMainSelf:!1,onSceneInit:function(e){return i.defer(),this._verifyRouterParams004(e),this._setProperties(e),t.createInstance("DetailBackButtonsController").initialize(e),this._setBackBtn(e),this._loadASummon(e.routerParams.de_004.id,this._isOwn).then(function(t){this._setButton(e),this._setSound(e)}.bind(this)).fail(function(e){console.error(e.stack)}),i.resolve()},onSceneEnter:function(e){return i.defer(),i.resolve()},onSceneExit:function(e){return i.defer(),i.resolve()},onPageInAnimationEnd:function(e){return i.defer(),i.resolve()},btnCallbackBtnCancel:function(e){var n=i.defer();if(n.reject(this._override),this._isFromSupportSummonPage()){var a=this._getSupportSummonElementType();return this._navigateToSupportSummonConfigTop(a),n.promise}return e.routerParams.de_004.fromPartyTopPage?(t.createInstance("router").navigate("party/par_001",{tab:"summons"}),n.promise):(this._navigate004ToPar015(e),n.promise)},btnCallbackBtnOrganize:function(e){var t=i.defer();return t.reject(this._override),this._navigate004ToPar003Equip(e),t.promise},btnCallbackBtnReject:function(e){var t=i.defer();return t.reject(this._override),this._navigate004ToPar003Reject(e),t.promise},btnCallbackBtnSetting:function(e){var n=i.defer();n.reject(this._override);var a=this._getSupportSummonElementType(),o=this._summon,r=o.a_summon_id;return t.createInstance("apiASupportSummonSetting").update(a,r).then(function(e){this._navigateToPrf001SetSupportSummon(a,o)}.bind(this)).fail(function(e){console.error(e.stack)}),n.promise},btnCallbackBtnRelease:function(e){var n=i.defer();n.reject(this._override);var a=this._getSupportSummonElementType();return t.createInstance("apiASupportSummonSetting").update(a,null).then(function(e){this._navigateToPrf001ReleaseSupportSummon(a)}.bind(this)).fail(function(e){console.error(e.stack)}),n.promise},btnCallbackBtnProtect:function(e){var t=i.defer();return t.reject(this._override),this._touchProtect(),t.promise},btnCallbackBtnSell:function(e){var n=i.defer();n.reject(this._override);var a=!this._fromEnhEvoPage;return t.createInstance("summonSellButtonTouchEventHandler").handle(e,a),n.promise},btnCallbackBtnEnh:function(e){var t=i.defer();return t.reject(this._override),this._touchEnhButton(),t.promise},btnCallbackBtnEvo:function(e){var t=i.defer();return t.reject(this._override),this._touchEvoButton(),t.promise},btnCallbackBtnAllOver:function(e){var t=i.defer();return t.reject(this._override),this._showImageZoomPopup(),t.promise},btnCallbackBtnBackList:function(e){return this._btnCallbackBtnCommon(e)},btnCallbackBtnBackSelect:function(e){return this._btnCallbackBtnCommon(e)},btnCallbackBtnBackConfirm:function(e){return this._btnCallbackBtnCommon(e)},btnCallbackBtnBackProfile:function(e){return this._btnCallbackBtnCommon(e)},_btnCallbackBtnCommon:function(e){var a=e.temporaryRouterParams.navigateFrom;if(!n.isUndefined(a)){var o={};n.isUndefined(a.routerParams)||(o=a.routerParams);var r={};return n.isUndefined(a.temporaryRouterParams)||(r=a.temporaryRouterParams),t.createInstance("router").navigate(a.routes,o,r),i.reject(this._override)}t.createInstance("router").navigate("book/book_001_summon")},_setProperties:function(e){this._fromPartyPage=e.routerParams.de_004.fromPartyPage,this._equipedSelf=e.routerParams.de_004.equipedSelf,this._isOwn=e.routerParams.de_004.isOwn,n.isUndefined(e.routerParams.de_004.fromEnhEvoPage)?this._fromEnhEvoPage=!1:this._fromEnhEvoPage=e.routerParams.de_004.fromEnhEvoPage,n.isUndefined(e.routerParams.de_004.supportSummonInfo)?this._supportSummonInfo=null:this._supportSummonInfo={elementType:e.routerParams.de_004.supportSummonInfo.elementType,aSummonId:e.routerParams.de_004.supportSummonInfo.aSummonId};var t=e.routerParams.de_004.number;return!this._equipedSelf||n.isUndefined(t)?void(this._equipedMainSelf=!1):void(this._equipedMainSelf=0===t)},_setButton:function(e){this._setToPartyButton(e)},_setToPartyButton:function(e){var t=e.seekWidgetByName("de_weapon_summon_btn_ui");if(this._isOwn)if(this._isFromSupportSummonPage())this._isDefaultSupportSummon()?t.setAppearance("cancel_release"):t.setAppearance("cancel_setting");else if(this._fromPartyPage)if(this._equipedSelf){if(t.setAppearance("cancel_reject"),this._equipedMainSelf){var n=t.seekWidgetByName("btn_reject");this._setEnableButton(n,!1)}}else t.setAppearance("cancel_organize");else t.setAppearance("default_view");else t.setVisible(!1)},_isFromSupportSummonPage:function(){return!n.isNull(this._supportSummonInfo)},_isDefaultSupportSummon:function(){return!!this._isFromSupportSummonPage()&&this._supportSummonInfo.aSummonId===this._summon.a_summon_id},_getSupportSummonElementType:function(){return this._isFromSupportSummonPage()?this._supportSummonInfo.elementType:""},_setSound:function(e){e.seekWidgetByName("btn_cancel").setSound(t.SoundList.BUTTON_TOUCHED_CANCEL)},_touchEndedBackBtnProcess:function(e){return this._btnCallbackBtnCommon(e)}}),n.assign(t.pc.detail.de_004.SceneDelegate.prototype,t.pc.roles.UIUtility,t.pc.detail.roles.Routing,t.pc.scene.roles.SceneSummonCommon,t.detail.view.LiSumsellCheckPopup.prototype._popups,t.detail.view.LiSumsellResultPopup.prototype._popups)}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.detail=t.pc.detail||{},t.pc.detail.de_004=t.pc.detail.de_004||{},t.pc.detail.de_004.Scene=t.BaseScene.extend({resourceFileName:"de_004/de_004.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"detail",sceneName:"de_004",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_cancel","btnCallbackBtnCancel",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"party/par_015")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_organize","btnCallbackBtnOrganize",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"party/par_001_2_3")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_reject","btnCallbackBtnReject",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"party/par_001_2_3")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_setting","btnCallbackBtnSetting",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"profile/prf_001_myself")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_release","btnCallbackBtnRelease",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"profile/prf_001_myself")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_protect","btnCallbackBtnProtect",null,function(){alert("{{com_protect_on/com_protect_off}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_sell","btnCallbackBtnSell",null,function(){alert("{{li_sumsell_check}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_enh","btnCallbackBtnEnh",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"enh_evo/enh_009")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_evo","btnCallbackBtnEvo",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"enh_evo/evo_010")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_all_over","btnCallbackBtnAllOver",null,function(){alert("{{all over ui}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;e.Q,t.pc.list=t.pc.list||{},t.pc.list.roles=t.pc.list.roles||{},t.pc.list.roles.ListCharactersCommon={_setCharacterHeaderLabel:function(){var e=n.director.getRunningScene();return null===e.seekWidgetByName("header_sub_label")?void console.debug("[NOTICE] Could not find count label name."):void t.createInstance("apiAPlayers").get("me").then(function(t){var n=t.body;return i.isUndefined(n.character_num)?void console.debug("[NOTICE] Could not find character_num."):void e.setStrings({header_sub_label:":"+n.character_num})}.bind(this)).fail(function(e){console.error(e.stack)})}}}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;e.Q,t.pc.list=t.pc.list||{},t.pc.list.roles=t.pc.list.roles||{},t.pc.list.roles.ListWeaponsCommon={_setWeaponHeaderLabel:function(){var e=n.director.getRunningScene();return null===e.seekWidgetByName("header_sub_label")?void console.debug("[NOTICE] Could not find count label name."):void t.createInstance("apiAPlayers").get("me").then(function(t){var n=t.body;return i.isUndefined(n.weapon_num)||i.isUndefined(n.max_weapon_num)?void console.debug("[NOTICE] Could not find weapon_num | max_weapon_num."):void e.setStrings({header_sub_label:":"+n.weapon_num+"/"+n.max_weapon_num})}.bind(this)).fail(function(e){console.error(e.stack)})}}}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;e.Q,t.pc.list=t.pc.list||{},t.pc.list.roles=t.pc.list.roles||{},t.pc.list.roles.ListSummonsCommon={_setSummonHeaderLabel:function(){var e=n.director.getRunningScene();return null===e.seekWidgetByName("header_sub_label")?void console.debug("[NOTICE] Could not find count label name."):void t.createInstance("apiAPlayers").get("me").then(function(t){var n=t.body;return i.isUndefined(n.summon_num)||i.isUndefined(n.max_summon_num)?void console.debug("[NOTICE] Could not find summon_num | max_summon_num."):void e.setStrings({header_sub_label:":"+n.summon_num+"/"+n.max_summon_num})}.bind(this)).fail(function(e){console.error(e.stack)})}}}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc,e.ccui,e._),i=e.console;t.createNameSpaceIfNotExists("core.model"),t.core.model.ASummon=t.core.pager.model.PlainData.extend({className:"ASummon",getAId:function(){return this._rawData.a_summon_id},getMasterId:function(){return this._rawData.summon_id},getExp:function(){return this._rawData.exp},getNextExp:function(){return this._rawData.next_exp},getLevel:function(){return this._rawData.level},getMaxLevel:function(){return this._rawData.max_level},equal:function(e){var t=e.getRawData().a_summon_id;return n.isNumber(t)?this.getAId()===t:(i.warn("a_summon_id"),!1)}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc,e.ccui,e._),i=e.console;t.createNameSpaceIfNotExists("core.model"),t.core.model.AWeapon=t.core.pager.model.PlainData.extend({className:"AWeapon",getAId:function(){return this._rawData.a_weapon_id},getMasterId:function(){return this._rawData.weapon_id},getExp:function(){return this._rawData.exp},getNextExp:function(){return this._rawData.next_exp},getLevel:function(){return this._rawData.level},getMaxLevel:function(){return this._rawData.max_level},equal:function(e){var t=e.getRawData().a_weapon_id;return n.isNumber(t)?this.getAId()===t:(i.warn("a_weapon_id"),!1)}})}((this||0).self||global),function(e){var t=e.kh,n=e._;t.createNameSpaceIfNotExists("enh_evo.view.popup"),t.enh_evo.view.popup.EvoMateCheckPopup=t.ImplantedPopup.extend({_initContents:function(e,t,n){this.setButtonEvents({btn_ok:!0,btn_cancel:!1});var i=this.getNode(),a=i.seekWidgetByName("corecard_ui");this._setProperCoreCardElementRarity(a.parent,n,a.name),this._setStarGauge(i,n);var o=(n["a_"+e+"_id"],{summon:"apiASummons",weapon:"apiAWeapons"}[e]);this._getConfirmEvolvePromise(o,t,n).then(function(e){this._displayConfirmText(e.body,n)}.bind(this)).fail(function(e){console.error(e)})},_displayConfirmText:function(e,n){var i=this.getNode(),a=khutil.getWidgetFromNode(i,"attention_label",function(e){console.warn("EvoMateCheckPopup: "+e)}.bind(this));a.setString("");var o=e.gem<e.need_gem,r=this._evolveConfirmHtmlString(e,o),s=khutil.getWidgetFromNode(i,"btn_ok",function(e){console.warn("EvoMateCheckPopup: "+e)}.bind(this));s.setColor(o?cc.color("#808080"):cc.color("#FFFFFF")),s.setEnabled(!o),i.setHtmlStrings({cost_labelimg:r},t.GameConfig.POPUP_CSS);var c=n.overlimit_count>0,u=o?"":c?"\n":"";a.setString(u)},_getConfirmEvolvePromise:function(e,i,a){if(!n.isUndefined(a.item_id))return t.createInstance(e).confirmEvolveByItem(i,a.item_id).fail(function(e){console.error(e)});var o=a.a_weapon_id||a.a_summon_id;return t.createInstance(e).confirmEvolveMaterial(i,o).fail(function(e){console.error(e)})},_setStarGauge:function(e,t){if(n.isUndefined(t.max_overlimit_count))n.each(n.range(3),function(t){e.seekWidgetByName("limit_base_"+t).setVisible(!1)});else{var i=Array(!1,!1,!1),a=0;t.max_overlimit_count<=3?(i[0]=!0,a="limit_base_0"):4===t.max_overlimit_count?(i[1]=!0,a="limit_base_1"):(i[2]=!0,a="limit_base_2"),n.each(n.range(3),function(t){e.seekWidgetByName("limit_base_"+t).setVisible(i[t])}),e.seekWidgetByName(a).seekWidgetByName("limit_gauge").percent=20*t.overlimit_count}},_evolveConfirmHtmlString:function(e,n){return"<style>td {line-height: 120%;}</style>"+t.htmlBuilder.makeTable([[["orange",""],["white",e.need_gem+"&nbsp;"+t.w("gem")]],[["orange",""],["white",e.before_max_level+"&nbsp;&rarr;&nbsp;<span class='yellow'>"+e.after_max_level+"</span>"]],[["orange",""],["white",e.gem+"&nbsp;"+t.w("gem")]]])}}),n.assign(t.enh_evo.view.popup.EvoMateCheckPopup.prototype,t.pc.roles.CoreCardCommon)}((this||0).self||global),function(e){var t=e._,n=e.kh;n.PopupFactoryEvoItemChoose=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-evo_item_choose",title:"",buttonLabels:{blueBtn:"",blackBtn:""},buttons:{blueBtn:function(e){(function(){try{var e=this._callbacks.onConfirmed(this);return e&&e.isFulfilled?e:Q.resolve(e)}catch(e){return Q.reject(e)}}).call(this).fail(function(e){return console.error(e),Q.reject(e)}).then(this.dismiss.bind(this)).then(this._callbacks.onDismissed.bind(this,this)).fail(function(e){return console.error(e),Q.reject(e)})},blackBtn:function(e){(function(){try{var e=this._callbacks.onCancelled(this);return e&&e.isFulfilled?e:Q.resolve(e)}catch(e){return Q.reject(e)}}).call(this).fail(function(e){return console.error(e),Q.reject(e)}).then(this.dismiss.bind(this)).then(this._callbacks.onDismissed.bind(this,this)).fail(function(e){return console.error(e),Q.reject(e)})}}},onPopupOpened:function(e,t){this._initPopup(e,t),e._callbacks={onConfirmed:this._onPopupConfirmed(t),onCancelled:function(e){console.debug("cancel popup")},onDismissed:this._onPopupDismissed(t)}},_initPopup:function(e,i){var a=i.evoItems;e.coreCards=t([{nodePath:"corecard_item_ui_0",item:a[0]},{nodePath:"corecard_item_ui_1",item:a[1]},{nodePath:"corecard_item_ui_2",item:a[2]}]).map(function(t){return t.node=e.seekWidgetByPath(t.nodePath),t}).reject(function(e){return!e.node}).map(function(e){var i=n.createInstance("CoreCardItemUI",[null,e.node]);i.setImg(e.item.getId());var a={};return a["TOUCH_ENDED item_img"]=function(e,i){t.each(e.parent.parent.parent.seekWidgets(function(e){return"focus_fla_blue"===e.name&&e.isVisible()}),function(e){e.setAppearance("hide")});var a=e.parent.seekWidgetByName("focus_fla_blue");a&&a.setVisible(!0),n.createInstance("notificationCenter").dispatchEvent("evoItemSelected",[this.itemId])}.bind({itemId:e.item.getId()}),e.item.canUse()?n.setTouchEventHandlers(e.node,a):i.setGrayout(!0),i}).value(),e.haveLabels=t([{nodePath:"have_base_0..have_label",item:a[0]},{nodePath:"have_base_1..have_label",item:a[1]},{nodePath:"have_base_2..have_label",item:a[2]}]).map(function(t){return t.node=e.seekWidgetByPath(t.nodePath),t}).reject(function(e){return!e.node}).map(function(e){return e.node.setString(e.item.getNum().toString()),e.node}).value(),e.blueBtn.setColor(cc.color("#808080")),e.blueBtn.setTouchEnabled(!1),e.blackBtn.setSound(n.SoundList.BUTTON_TOUCHED_CANCEL),n.createInstance("notificationCenter").addEventListener("evoItemSelected",function(t){console.debug("[!! SELECTED !!] ",t),e.blueBtn.setTouchEnabled(!0),e.blueBtn.setColor(cc.color("#ffffff")),e.selectedItemId=t},e)},_onPopupConfirmed:function(){return function(e){n.createInstance("notificationCenter").dispatchEvent("useEvolutionItem",[e.selectedItemId]),e.selectedItemId=null}},_onPopupDismissed:function(){return function(e){t.each(e.coreCards,function(e){e.clearImg(),e.setGrayout(!1);var t=e.uiNode.seekWidgetByName("focus_fla_blue");t&&t.setAppearance("hide")}),t.each(e.haveLabels,function(e){e.setString("")}),n.createInstance("notificationCenter").removeEventListenersByEventName("evoItemSelected"),console.debug("on dismissed")}}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e._,t.createNameSpaceIfNotExists("enh_evo.model"),t.enh_evo.model.EnhanceItem=n.Class.extend({ctor:function(e){this._itemData=e},getItemId:function(){return this._itemData.item_id},getName:function(){return this._itemData.name},getDescription:function(){return this._itemData.description},getPerExp:function(){return this._itemData.exp},getAmount:function(){return this._itemData.amount},getUsableAmount:function(e){return this.getPerExp()*this.getAmount()<=e?this.getAmount():Math.ceil(e/this.getPerExp())}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e._,t.createNameSpaceIfNotExists("enh_evo.model"),t.enh_evo.model.EnhanceExpitem=n.Class.extend({ctor:function(e){this._itemData=e},getItemId:function(){return this._itemData.item_id},getName:function(){return this._itemData.name},getDescription:function(){return this._itemData.description},getAmount:function(){return this._itemData.own_exp},getUsableAmount:function(){return this._itemData.exp},getUseAmount:function(e){return Math.ceil(this._itemData.exp*e/100)},getPercent:function(e){return Math.round(e/this._itemData.exp*100)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;t.createNameSpaceIfNotExists("enh_evo.model"),t.enh_evo.model.ExperiencePoint=n.Class.extend({_experienceData:null,ctor:function(e){this._experienceData=e.data.sort(function(e,t){return e.point-t.point})},getNeedTotalExp:function(e){return i.find(this._experienceData,function(t){return t.level===e}).point},getMaxObtainablePoint:function(e,t,n){return e===n?0:t+this.getNeedTotalExp(n)-this.getNeedTotalExp(e+1)},getLevel:function(e){return i.findLast(this._experienceData,function(t){return t.point<=e}).level},getAfterLevelInfo:function(e,t,n,i){var a=this.getNeedTotalExp(e)+n+i,o=Math.min(t,this.getLevel(a)),r=this.getNeedTotalExp(o);return{level:o,oddExp:a-r,nextExp:this._nextExp(o,t,r)}},_nextExp:function(e,t,n){return e>=t?0:this.getNeedTotalExp(e+1)-n}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);t.createNameSpaceIfNotExists("evo.view.popup"),t.evo.view.popup.EnhUseItemsPopup=t.ImplantedPopup.extend({_smallPulldown:null,_largePulldown:null,_doUpdate:!1,_choice:null,open:function(e){var n=this._super.bind(this);return Q.all([t.createInstance("apiACharacters").getEnhanceItems(),t.createInstance("apiCharacters").getExperiencePointList()]).spread(function(i,a){var o=i.body.data.map(function(e){return new t.enh_evo.model.EnhanceItem(e)}),r=new t.enh_evo.model.ExperiencePoint(a.body);return n(e,o,r)})},_initContents:function(e,t,i){this._baseACharacterModel=e,this._experiencePointModel=i;var a={btn_cancel:!1,btn_enh:this._touchBtnEnh.bind(this)};this.setButtonEvents(a),this._drawBaseCharacter(e),this._setEnabledBtnEnh(!1),n.each(["small","large"],this._drawItemInformation.bind(this,t));var o=t[0],r=this._createPulldown(this._getNodeByName("btn_pulldown_small"),o,"small"),s=t[1],c=this._createPulldown(this._getNodeByName("btn_pulldown_large"),s,"large");this._smallPulldown=r,this._largePulldown=c},_drawBaseCharacter:function(e){t.createInstance("CoreCardCharacterUI",["e_r",this._getNodeByName("corecard_chara_ui")]).setData(e.getRawData()),this._updateLevelInformation(e,0)},LEVEL_LABEL_TEMPLATE:n.template('<div class="white" style=\'margin-top: 4px\'>Lv<%=level%>  <% if( !useItem ){%><%=afterLevel%><% } else if( afterLevel < maxLevel ){%><span class="yellow"><%=afterLevel%></span><% } else {%><span class="red"><%=afterLevel%>(Max)</span><% } %></div>'),GET_EXP_LABEL_TEMPLATE:n.template('<div class="white" style=\'margin-top: 20px\'><% if (exp > 0) {%><span class="orange"><%= exp %></span><% } else {%><%=exp%><% } %></div>'),_updateLevelInformation:function(e,n){var i=e.getRawData(),a=this._experiencePointModel.getAfterLevelInfo(e.getLevel(),e.getMaxLevel(),e.getExp(),n),o=a.level,r=a.oddExp;this.getNode().setHtmlStrings({level_labelimg:this.LEVEL_LABEL_TEMPLATE({level:i.level,maxLevel:i.max_level,useItem:n>0,afterLevel:o}),get_exp_labelimg:this.GET_EXP_LABEL_TEMPLATE({exp:n.toString()})},t.GameConfig.POPUP_CSS);var s=this._getNodeByName("exp_next_label"),c=this._getNodeByName("exp_over_label");if(o>=i.max_level)return s.setVisible(!1),0===n?void c.setVisible(!1):(c.setString(r+""),c.setVisible(!0),void(this._getNodeByName("exp-gauge").percent=100));c.setVisible(!1),s.setString("NEXT:"+(a.nextExp-a.oddExp)),s.setVisible(!0);var u=r/a.nextExp*100;this._getNodeByName("exp-gauge").percent=u},_drawItemInformation:function(e,n,i){var a=e[i];this._getNodeByName("corecard_item_"+n).loadTexture(t.itemImg(a.getItemId()));var o=(a.getAmount()||0).toString();this._getNodeByName(n+"_item_num_before").setString(o);var r=this._getNodeByName(n+"_item_num_after_white");r.setString(o),r.setVisible(!0),this._getNodeByName(n+"_item_num_after_red").setVisible(!1)},_touchBtnEnh:function(){var e=this._baseACharacterModel,t=this._experiencePointModel.getAfterLevelInfo(e.getLevel(),e.getMaxLevel(),e.getExp(),this._choice.value);this._dfd.resolve(n.extend({aCharacterModel:e,afterLevel:t.level},this._choice)),this.dismiss(!0)},_setEnabledBtnEnh:function(e){var n=this._getNodeByName("btn_enh");t.pc.roles.UIUtility._setGrayOutButton(n,e),n.setEnabled(e)},_update:function(e){var t=this.popup,i=this.enhanceItem,a=this.type;t._updateItemNum(t,a,i,e),t._doUpdate||(t._choice=n.extend({enhanceItem:i},e),t._updateLevelInformation(t._baseACharacterModel,e.value),t._setEnabledBtnEnh(e.value>0),t._updateOther(t,a))},_updateItemNum:function(e,t,n,i){var a=e._getNodeByName(t+"_item_num_after_white"),o=e._getNodeByName(t+"_item_num_after_red");return 0===i.num?(a.setVisible(!0),void o.setVisible(!1)):(o.setString((n.getAmount()-i.num).toString()),o.setVisible(!0),void a.setVisible(!1))},_updateOther:function(e,t){if(!e._doUpdate){switch(e._doUpdate=!0,t){case"small":e._largePulldown.selectValue(0);break;case"large":e._smallPulldown.selectValue(0)}e._doUpdate=!1}},_createPulldown:function(e,n,i){var a=this._createChoices(n),o=e.getUserData();if(o instanceof t.Pulldown)return o.selectValue(0),o.setTouchEnabled(!0),o;var r=e.getChildren()[0];return(o=new t.Pulldown({button:e,label:r},a)).selectValue(0),o.onChange(this._update,{popup:this,type:i,enhanceItem:n}),o.setTouchEnabled(!0),e.setUserData(o),o},_createChoices:function(e){var t=this._calcMaxUsableAmount(e);return n.map(n.range(0,t+1),function(t){return{value:t*e.getPerExp(),text:t.toString(),num:t}})},_calcMaxUsableAmount:function(e){var t=this._baseACharacterModel.getNextExp(),n=this._baseACharacterModel.getLevel(),i=this._baseACharacterModel.getMaxLevel(),a=this._experiencePointModel.getMaxObtainablePoint(n,t,i);return e.getUsableAmount(a)}}),t.dictx.registerWithProtoStrategy("EnhUseItemsPopup",t.evo.view.popup.EnhUseItemsPopup)}((this||0).self||global),function(e){var t=e.kh;e.cc,e._,t.createNameSpaceIfNotExists("evo.view.popup"),t.evo.view.popup.EnhUseItemsConfirmPopup=t.ImplantedPopup.extend({_initContents:function(e){var n={btn_cancel:!1,btn_ok:this._btnOk.bind(this,e)};this.setButtonEvents(n),this._getNodeByName("corecard_item").loadTexture(t.itemImg(e.enhanceItem.getItemId())),this.getNode().setStrings({title_label:"",have_num_before:e.enhanceItem.getAmount(),have_num_after:(e.enhanceItem.getAmount()-e.num).toString(),level_num_before:e.aCharacterModel.getLevel(),level_num_after_yellow:e.afterLevel,level_num_after_red:e.afterLevel+"(MAX)"});var i=e.afterLevel>=e.aCharacterModel.getMaxLevel();this._getNodeByName("level_num_after_yellow").setVisible(!i),this._getNodeByName("level_num_after_red").setVisible(i)},_btnOk:function(e){this._dfd.resolve(e),this.dismiss(!0)}}),t.dictx.registerWithProtoStrategy("EnhUseItemsConfirmPopup",t.evo.view.popup.EnhUseItemsConfirmPopup)}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;t.createNameSpaceIfNotExists("evo.view.popup"),t.evo.view.popup.EnhUseExpitemPopup=t.ImplantedPopup.extend({open:function(e){return this._super.bind(this)(e.baseModel,e.aEnhanceExpitemModel,e.experiencePointModel,e.useAmount)},_initContents:function(e,t,n,i){this._baseModel=e,this._experiencePointModel=n,this._enhanceExpitemModel=t,this._useAmount=i,this._showSubTutorialFirstAccess();var a={btn_cancel:!1,btn_enh:this._touchBtnEnh.bind(this),btn_hint:this._touchBtnHint.bind(this)};this.setButtonEvents(a),this._drawCoreCard(e),this._drawItemCoreCard(),this._drawExpitemText(t);var o=this.getNode().seekWidgetByName("exp_slider"),r=this.getNode().seekWidgetByName("exp_percent");if(t.getAmount())if(0===t.getUsableAmount()&&t.getAmount())o.setPercent(100),r.string="100%",this._updateInformationIfMax(e,this._enhanceExpitemModel.getUsableAmount());else{var s=this._enhanceExpitemModel.getPercent(this._useAmount);o.setPercent(s),r.string=s+"%",this._updateLevelInformation(e,this._useAmount)}else this._updateInformationIfEmpty(e),o.setPercent(0),r.string="0%";this._addSliderListener(o,r)},_updateInformationIfEmpty:function(e){var a=this._node.seekWidgetByName("btn_enh");a.setTouchEnabled(!1),a.setEnabled(!1);var o=this._node.seekWidgetByName("exp_slider");o.setEnabled(!1);var r=this._node.seekWidgetByName("exp_percent");i.invoke([o,a,r],"setColor",n.color("#808080"));var s=e.getRawData(),c=this._experiencePointModel.getAfterLevelInfo(e.getLevel(),e.getMaxLevel(),e.getExp(),0).level;this.getNode().setHtmlStrings({level_labelimg:this.LEVEL_LABEL_TEMPLATE({level:s.level,maxLevel:s.max_level,useItem:!1,afterLevel:c})},t.GameConfig.POPUP_CSS)},_updateInformationIfMax:function(e,a){var o=this._node.seekWidgetByName("btn_enh");o.setTouchEnabled(!1),o.setEnabled(!1);var r=this._node.seekWidgetByName("exp_slider");r.setEnabled(!1);var s=this._node.seekWidgetByName("exp_percent");i.invoke([r,o,s],"setColor",n.color("#808080")),this._getNodeByName("exp-gauge").percent=100;var c=e.getRawData(),u=this._experiencePointModel.getAfterLevelInfo(e.getLevel(),e.getMaxLevel(),e.getExp(),a).level;this.getNode().setHtmlStrings({level_labelimg:this.LEVEL_LABEL_TEMPLATE({level:c.level,maxLevel:c.max_level,useItem:a>0,afterLevel:u}),get_exp_labelimg:this.GET_EXP_LABEL_WARNING_TEMPLATE({})},t.GameConfig.POPUP_CSS)},_touchBtnEnh:function(){var e=this._baseModel,t=this._enhanceExpitemModel,n=this._experiencePointModel.getAfterLevelInfo(e.getLevel(),e.getMaxLevel(),e.getExp(),this._useAmount);this._dfd.resolve({baseModel:e,aEnhanceExpitemModel:t,experiencePointModel:this._experiencePointModel,useAmount:this._useAmount,levelInfo:n}),this.dismiss(!0)},_touchBtnHint:function(){var e=n.director.getRunningScene();return t.ImplantedPopup.createOrGet(e,"sub_tutorial_on_enh_use_expitem","SubTutorialOnEnhUseExpitemPopup").open(),Q.reject(this._override)},_showSubTutorialFirstAccess:function(){var e=t.createInstance("apiASubTutorialPages");return e.get("expitem").then(function(i){if(i.body.need_first_display){var a=n.director.getRunningScene();t.ImplantedPopup.createOrGet(a,"sub_tutorial_on_enh_use_expitem","SubTutorialOnEnhUseExpitemPopup").open(),e.visited("expitem")}}.bind(this)).fail(function(e){console.error(e)})},_drawCoreCard:function(e){this._setProperCoreCardElementRarity(this.getNode(),e.getRawData(),"corecard_ui")},_drawItemCoreCard:function(){this._getNodeByName("corecard_item").loadTexture(t.itemImg(this._enhanceExpitemModel.getItemId()))},_drawExpitemText:function(e){var t=this._getNodeByName("have_exp_label"),n=e.getAmount()?e.getAmount():0;t.setString("EXP:"+n)},LEVEL_LABEL_TEMPLATE:i.template('<div class="white" style=\'margin-top: 4px\'>Lv<%=level%>  <% if( !useItem ){%><%=afterLevel%><% } else if( afterLevel < maxLevel ){%><span class="yellow"><%=afterLevel%></span><% } else {%><span class="red"><%=afterLevel%>(Max)</span><% } %></div>'),GET_EXP_LABEL_TEMPLATE:i.template('<div class="white" style=\'margin-top: 20px\'>EXP<% if (exp > 0) {%><span class="orange"><%= exp %></span><% } else {%><%=exp%><% } %></div>'),GET_EXP_LABEL_WARNING_TEMPLATE:i.template("<div class=\"orange\" style='margin-top: 20px'>MAXLv</div>"),_updateLevelInformation:function(e,i){var a=e.getRawData(),o=this._experiencePointModel.getAfterLevelInfo(e.getLevel(),e.getMaxLevel(),e.getExp(),i),r=o.level,s=o.oddExp;this.getNode().setHtmlStrings({level_labelimg:this.LEVEL_LABEL_TEMPLATE({level:a.level,maxLevel:a.max_level,useItem:i>0,afterLevel:r}),get_exp_labelimg:this.GET_EXP_LABEL_TEMPLATE({exp:i.toString()})},t.GameConfig.POPUP_CSS);var c=this._node.seekWidgetByName("btn_enh");c.setEnabled(!0),c.setColor(n.color("#FFFFFF")),0==i&&(c.setEnabled(!1),c.setColor(n.color("#808080")));var u=this._getNodeByName("exp_next_label");if(r>=a.max_level){if(u.setVisible(!1),0===i)return;this._getNodeByName("exp-gauge").percent=100}else{u.setString("NEXT:"+(o.nextExp-o.oddExp)),u.setVisible(!0);var l=s/o.nextExp*100;this._getNodeByName("exp-gauge").percent=l}},_addSliderListener:function(e,t){var n=this._updatePercent.bind(this,e,t);e.addEventListenerSlider(function(e){e.unschedule(n),e.scheduleOnce(n,.25)},this)},_updatePercent:function(e,t){var n=Math.round(e.getPercent());this._percent!==n&&(this._percent=n,t.string=n+"%",e.string=n,this._useAmount=this._enhanceExpitemModel.getUseAmount(n),this._updateLevelInformation(this._baseModel,this._useAmount))}}),t.assignRoles(t.evo.view.popup.EnhUseExpitemPopup,[t.pc.roles.CoreCardCommon]),t.dictx.registerWithProtoStrategy("EnhUseExpitemPopup",t.evo.view.popup.EnhUseExpitemPopup)}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);t.createNameSpaceIfNotExists("evo.view.popup"),t.evo.view.popup.EnhUseExpitemConfirmPopup=t.ImplantedPopup.extend({_initContents:function(e){var n={btn_cancel:this._btnCancel.bind(this,e),btn_ok:this._btnOk.bind(this,e)};this.setButtonEvents(n),this._getNodeByName("corecard_item").loadTexture(t.itemImg(e.aEnhanceExpitemModel.getItemId())),this.getNode().setStrings({title_label:""}),this._setHtmlStrings(e)},_setHtmlStrings:function(e){var n=e.aEnhanceExpitemModel.getAmount(),i=n-e.useAmount,a=e.levelInfo.level,o=e.baseModel.getRawData().level,r=e.baseModel.getRawData().max_level;this.getNode().setHtmlStrings({have_exp_labelimg:this.HAVE_EXP_LABELIMG_TEMPLATE({beforeExpitem:n,afterExpitem:i}),level_labelimg:this.LEVEL_LABELIMG_TEMPLATE({afterLevel:a,beforeLevel:o,maxLevel:r})},t.GameConfig.POPUP_CSS)},HAVE_EXP_LABELIMG_TEMPLATE:n.template('<div class="white text_common_left" style=\'margin-top: 4px\'><span class="white"><%=beforeExpitem%></span> <span class="orange"><%=afterExpitem%></span></div>'),LEVEL_LABELIMG_TEMPLATE:n.template('<div class="white text_common_left " style=\'margin-top: 4px\'><span class="white"><%=beforeLevel%></span> <% if( afterLevel < maxLevel ){%><span class="yellow"><%=afterLevel%></span><% } else {%><span class="orange"><%=afterLevel%>(Max)</span><% } %></div>'),_btnOk:function(e){this._dfd.resolve(e),this.dismiss(!0)},_btnCancel:function(e){this._dfd.reject(e),this.dismiss(!1)}}),t.dictx.registerWithProtoStrategy("EnhUseExpitemConfirmPopup",t.evo.view.popup.EnhUseExpitemConfirmPopup)}((this||0).self||global),function(e){var t=e.kh;e.cc,e._,t.createNameSpaceIfNotExists("evo.view.popup"),t.evo.view.SubTutorialOnEnhUseExpitemPopup=t.core.view.ImplantedSubTutorialPopup.extend({_dismissAnimationName:"enh_use_expitem",_closeAnimationEndHandler:function(){this._uiNode.setVisible(!0)},_initContents:function(){this._super("expitem",2)}}),t.dictx.registerWithProtoStrategy("SubTutorialOnEnhUseExpitemPopup",t.evo.view.SubTutorialOnEnhUseExpitemPopup)}((this||0).self||global),function(e){var t=e.kh,n=e._;t.createNameSpaceIfNotExists("enh_evo.view.popup"),t.enh_evo.view.popup.EnhRareCheckPopup=t.core.item.comConsumptionCheckResult.extend({BUTTON_VISIBLE:{btn_enh:!0,btn_cancel:!0},TITLE_LABEL:"",CONFIRM_MESSAGE_NORMAL:"\n",CONFIRM_MESSAGE_RARE_TEMPLATE:"<%= rare %>\n",CONFIRM_LABEL_NODE_NAME:"attention_label",BUTTON_EVENT_MAPPING:{btn_cancel:!1,btn_enh:!0},__initContents:function(e){this._materials=e.materials,this._animateCorecardSize()},_animateCorecardSize:function(){var e=this.getNode(),n=(t.env.isSp?"sp":"pc")+"_corecard_size";e.setAppearance(n)},getMaterialRecords:function(){return this._materials},_createConfirmLabel:function(e){var t=this._getHighestRearityInSelectedMaterials(e);return"N"===t?this.CONFIRM_MESSAGE_NORMAL:n.template(this.CONFIRM_MESSAGE_RARE_TEMPLATE)({rare:t})},_setBottomLabel:function(e){if(null!==e.seekWidgetByName("shadow_base")){var t=this._consumptionParameter;e.seekWidgetByName("skill_lvup_label").setVisible(!0),e.setStrings({exp_num_label:""+t.gained_exp,success_num_label:t.great_success_percent+""});var i=e.seekWidgetByName("skill_lvup_label"),a=e.seekWidgetByName("skill_lvup_num_label");if(n.isUndefined(t.gain_skill_exp))return i.setVisible(!1),void a.setVisible(!1);a.setString(""+t.gain_skill_exp),a.setVisible(!0),i.setVisible(!0)}}})}((this||0).self||global),function(e){var t=e.kh,n=e._;t.createNameSpaceIfNotExists("enh_evo.view.popup"),t.enh_evo.view.popup.EnhRecommendSettingPopup=t.ImplantedPopup.extend({UI_NODE_NAMES:{btnOk:"btn_ok",btnCancel:"btn_cancel",btnNormalOnly:"btn_rarity_n_only",btnRareOrLess:"btn_rarity_r_or_less",btnBuildUpOnly:"btn_enh_meterial_only"},MATERIAL_TARGET_STATUS:{normalOnly:"normal",rareOrLess:"rare",buildUpOnly:"build_up"},_currentTarget:{},_uiNodes:{},_initContents:function(){this._currentTarget=t.createInstance("playerGameConfig").getEnhanceMaterialsTarget(),this._uiNodes=this._getUINodes(),this.__updateBtnNode(),this._setBtns()},_setBtns:function(){var e=this.MATERIAL_TARGET_STATUS;this._uiNodes.btnCancel.addTouchEventListener(function(e,n){n===ccui.Widget.TOUCH_ENDED&&(t.createInstance("playerGameConfig").setEnhanceMaterialsTarget(this._currentTarget),this.dismiss())}.bind(this)),this._uiNodes.btnOk.addTouchEventListener(function(e,n){n===ccui.Widget.TOUCH_ENDED&&(t.createInstance("playerGameConfig").updateGameConfig(),this.dismiss())}.bind(this)),this._uiNodes.btnNormalOnly.addTouchEventListener(function(n,i){i===ccui.Widget.TOUCH_ENDED&&(t.createInstance("playerGameConfig").setEnhanceMaterialsTarget(e.normalOnly),this.__updateBtnNode())}.bind(this)),this._uiNodes.btnRareOrLess.addTouchEventListener(function(n,i){i===ccui.Widget.TOUCH_ENDED&&(t.createInstance("playerGameConfig").setEnhanceMaterialsTarget(e.rareOrLess),this.__updateBtnNode())}.bind(this)),this._uiNodes.btnBuildUpOnly.addTouchEventListener(function(n,i){i===ccui.Widget.TOUCH_ENDED&&(t.createInstance("playerGameConfig").setEnhanceMaterialsTarget(e.buildUpOnly),this.__updateBtnNode())}.bind(this))},__setBrightColorTargetNodes:function(e){var t=cc.director.getRunningScene();n.each(e,function(e,n){var i=t.seekWidgetByName(n);i.setBright(!e),i.setColor(cc.color(e?"#FFFFFF":"#808080"))})},__updateBtnNode:function(){var e=this.MATERIAL_TARGET_STATUS,n=t.createInstance("playerGameConfig").getEnhanceMaterialsTarget(),i={btn_rarity_n_only:n===e.normalOnly,btn_rarity_r_or_less:n===e.rareOrLess,btn_enh_meterial_only:n===e.buildUpOnly};this.__setBrightColorTargetNodes(i)},_getUINodes:function(){return n.mapValues(this.UI_NODE_NAMES,function(e){return this._getNodeByName(e)}.bind(this))},_getNodeByName:function(e,t){(n.isUndefined(t)||null===t)&&(t=this._node);var i=t.seekWidgetByName(e);return i||console.warn("AcceNonOfferPopup._getByNode(): node '"+e+"' not found"),i}})}((this||0).self||global),function(e){var t=e.kh,n=e._;t.createNameSpaceIfNotExists("enh_evo.view.popup"),t.enh_evo.view.popup.ArouseMateCheckPopup=t.ImplantedPopup.extend({_initContents:function(e){var n=e[0];this.setButtonEvents({btn_ok:!0,btn_cancel:!1});var i=this.getNode();i.loadTextures({item_img:this._getImageUrl(n.item_id)});var a=n.num||0,o=n.num-n.need_num;i.setHtmlStrings({item_use_result_labelimg:this._getLabelText(a,o)},t.GameConfig.POPUP_CSS),this._setSEButtonCancel(i)},_getImageUrl:function(e){return t.Img("corecard","item",n.padZero(e,4)).jpg},_getLabelText:function(e,t){return n.template('<div><span class="white"><%= before %></span><span class="yellow"><%= after %></span></div>')({before:e,after:t})},setButtonEvents:function(e){var i={};n.each(e,function(e,t){var a=e;n.isBoolean(e)&&(a=function(e){return function(){this.dismiss(e)}}(e)),i["TOUCH_ENDED "+t]=a},this),t.setTouchEventHandlers(this.getNode(),i,this)},_setSEButtonCancel:function(e){var n=this._getButtonCancel(e);n&&n.setSound(t.SoundList.BUTTON_TOUCHED_CANCEL)},_getButtonCancel:function(e){return e.seekWidgetByName("btn_cancel")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);e.Q,t.pc.enh_evo=t.pc.enh_evo||{},t.pc.enh_evo.roles=t.pc.enh_evo.roles||{},t.pc.enh_evo.roles.Routing={_verifyRouterParamsENH001002006EVO001002003:function(e){},_navigateENH001To008:function(e,i){return n.isUndefined(i)||n.isUndefined(i.a_character_id)?void this._consoleErrorRoutingAbort("record.a_character_id"):void t.createInstance("router").navigate("enh_evo/enh_008",{enh_008:{id:i.a_character_id}})},_navigateENH002To007:function(e,i){return n.isUndefined(i)||n.isUndefined(i.a_weapon_id)?void this._consoleErrorRoutingAbort("record.a_weapon_id"):void t.createInstance("router").navigate("enh_evo/enh_007",{enh_007:{id:i.a_weapon_id}})},_navigateENH006To009:function(e,i){return n.isUndefined(i)||n.isUndefined(i.a_summon_id)?void this._consoleErrorRoutingAbort("record.a_summon_id"):void t.createInstance("router").navigate("enh_evo/enh_009",{enh_009:{id:i.a_summon_id}})},_navigateEVO001To013:function(e,i){return n.isUndefined(i)||n.isUndefined(i.a_character_id)?void this._consoleErrorRoutingAbort("record.a_character_id"):void t.createInstance("router").navigate("enh_evo/evo_013",{evo_013:{id:i.a_character_id}})},_navigateEVO002To007:function(e,i){return n.isUndefined(i)||n.isUndefined(i.a_weapon_id)?void this._consoleErrorRoutingAbort("record.a_weapon_id"):void t.createInstance("router").navigate("enh_evo/evo_007",{evo_007:{id:i.a_weapon_id}})},_navigateEVO002To008:function(e,i){return n.isUndefined(i)||n.isUndefined(i.a_weapon_id)?void this._consoleErrorRoutingAbort("record.a_weapon_id"):void t.createInstance("router").navigate("enh_evo/evo_008",{evo_008:{id:i.a_weapon_id}})},_navigateEVO003To010:function(e,i){return n.isUndefined(i)||n.isUndefined(i.a_summon_id)?void this._consoleErrorRoutingAbort("record.a_summon_id"):void t.createInstance("router").navigate("enh_evo/evo_010",{evo_010:{id:i.a_summon_id}})},_verifyRouterParamsENH003:function(e){n.isUndefined(e.routerParams.enh_003)&&(e.routerParams.enh_003={},e.routerParams.enh_003.id=1,e.routerParams.enh_003.from="enh_007",this._consoleErrorRouterParams("routerParams.enh_003, .id, .from"))},_navigateENH003ToEVO007:function(e){if(n.isUndefined(e.routerParams.enh_003))this._consoleErrorRoutingAbort("routerParams.enh_003");else if(n.isUndefined(e.routerParams.enh_003.id))this._consoleErrorRoutingAbort("routerParams.enh_003.id");else{var i=e.routerParams.enh_003;t.createInstance("router").navigate("enh_evo/evo_007",{evo_007:{id:i.id}})}},_navigateENH003ToENH002:function(e){t.createInstance("router").navigate("enh_evo",{},{enhevo_home:{tab:"enh",kind:"weapon"}})},_verifyRouterParamsENH004:function(e){n.isUndefined(e.routerParams.enh_004)&&(e.routerParams.enh_004={},e.routerParams.enh_004.id=2,e.routerParams.enh_004.from="enh_009",this._consoleErrorRouterParams("routerParams.enh_004, .id, .from"))},_navigateENH004ToEVO010:function(e){if(n.isUndefined(e.routerParams.enh_004))this._consoleErrorRoutingAbort("routerParams.enh_004");else if(n.isUndefined(e.routerParams.enh_004.id))this._consoleErrorRoutingAbort("routerParams.enh_004.id");else{var i=e.routerParams.enh_004;t.createInstance("router").navigate("enh_evo/evo_010",{evo_010:{id:i.id}})}},_navigateENH004ToENH006:function(e){t.createInstance("router").navigate("enh_evo",{},{enhevo_home:{tab:"enh",kind:"summon"}})},_verifyRouterParamsENH005:function(e){n.isUndefined(e.routerParams.enh_005)&&(e.routerParams.enh_005={},e.routerParams.enh_005.id=1,e.routerParams.enh_005.from="enh_008",this._consoleErrorRouterParams("routerParams.enh_005, .id, .from"))},_navigateENH005ToEVO013:function(e){if(n.isUndefined(e.routerParams.enh_005))this._consoleErrorRoutingAbort("routerParams.enh_005");else if(n.isUndefined(e.routerParams.enh_005.id))this._consoleErrorRoutingAbort("routerParams.enh_005.id");else{var i=e.routerParams.enh_005;t.createInstance("router").navigate("enh_evo/evo_013",{evo_013:{id:i.id}})}},_navigateENH005ToENH001:function(e){t.createInstance("router").navigate("enh_evo",{},{enhevo_home:{tab:"enh",kind:"chara"}})},_verifyRouterParamsENH007:function(e){n.isUndefined(e.routerParams.enh_007)&&(e.routerParams.enh_007={},e.routerParams.enh_007.id=1,this._consoleErrorRouterParams("routerParams.enh_007, .id"))},_navigateENH007ToENH001:function(){t.createInstance("router").navigate("enh_evo",{},{enhevo_home:{tab:"enh",kind:"weapon"}})},_navigateENH007ToENH003:function(e){return n.isUndefined(e)||n.isUndefined(e.a_weapon_id)?void this._consoleErrorRoutingAbort("record.a_weapon_id"):void t.createInstance("router").navigate("enh_evo/detail/de_003",{de_003:{id:e.a_weapon_id,isOwn:!0,fromPartyPage:!1,fromEnhEvoPage:!0,equipedSelf:!1}},{ignoreImplicitRoute:!0,navigateFrom:{routes:"enh_evo/enh_007",routerParams:{enh_007:{id:e.a_weapon_id}}}})},_navigateENH007ToENH014:function(e,i,a){var o;n.isUndefined(i)?this._consoleErrorRoutingAbort("result"):(o=a[0].item_id?this._makeEnhEvoAnimationMaterialItems(a):this._makeEnhEvoAnimationMaterialWeapons(a),t.createInstance("router").navigate("enh_evo/enh_014",{enh_014:{id:e.routerParams.enh_007.id,result:i}},{enh_014:{materials:o}}))},_verifyRouterParamsENH008:function(e){n.isUndefined(e.routerParams.enh_008)&&(e.routerParams.enh_008={},e.routerParams.enh_008.id=1,this._consoleErrorRouterParams("routerParams.enh_008, .id"))},_navigateENH008ToENH002:function(){t.createInstance("router").navigate("enh_evo",{},{enhevo_home:{tab:"enh",kind:"chara"}})},_navigateENH008ToENH005:function(e){return n.isUndefined(e)||n.isUndefined(e.a_character_id)?void this._consoleErrorRoutingAbort("record.a_character_id"):void t.createInstance("router").navigate("enh_evo/detail/de_001",{de_001_002:{id:e.a_character_id,isOwn:!0,fromPartyPage:!1,equipedSelf:!1}},{ignoreImplicitRoute:!0,navigateFrom:{routes:"enh_evo/enh_008",routerParams:{enh_008:{id:e.a_character_id}}}})},_navigateENH008ToENH013:function(e,i,a,o){var r;n.isUndefined(a)?this._consoleErrorRoutingAbort("result"):(r=o[0].item_id?this._makeEnhEvoAnimationMaterialItems(o):this._makeEnhEvoAnimationMaterialWeapons(o),t.createInstance("router").navigate("enh_evo/enh_013",{enh_013:{id:i,result:a}},{enh_013:{materials:r}}))},_verifyRouterParamsENH009:function(e){n.isUndefined(e.routerParams.enh_009)&&(e.routerParams.enh_009={},e.routerParams.enh_009.id=2,this._consoleErrorRouterParams("routerParams.enh_009, .id"))},_navigateENH009ToENH006:function(){t.createInstance("router").navigate("enh_evo",{},{enhevo_home:{tab:"enh",kind:"summon"}})},_navigateENH009ToENH004:function(e){return n.isUndefined(e)||n.isUndefined(e.a_summon_id)?void this._consoleErrorRoutingAbort("record.a_summon_id"):void t.createInstance("router").navigate("enh_evo/detail/de_004",{de_004:{id:e.a_summon_id,isOwn:!0,fromPartyPage:!1,fromEnhEvoPage:!0,equipedSelf:!1,equipedMainSelf:!1}},{ignoreImplicitRoute:!0,navigateFrom:{routes:"enh_evo/enh_009",routerParams:{enh_009:{id:e.a_summon_id}}}})},_navigateENH009ToENH015:function(e,i,a){var o;n.isUndefined(i)?this._consoleErrorRoutingAbort("result"):(o=a[0].item_id?this._makeEnhEvoAnimationMaterialItems(a):this._makeEnhEvoAnimationMaterialSummons(a),t.createInstance("router").navigate("enh_evo/enh_015",{enh_015:{id:e.routerParams.enh_009.id,result:i}},{enh_015:{materials:o}}))},_verifyRouterParamsENH013:function(e){n.isUndefined(e.routerParams.enh_013)&&(e.routerParams.enh_013={},e.routerParams.enh_013.id=1,e.routerParams.enh_013.result={result:{success_type:"success",gained_exp:600,before:{level:1,gauge:0,hp:210,attack:850,max:!1},after:{level:6,gauge:83,hp:273,attack:1105,max:!1},new_abilities_gained:[{ability_type:1,ability_name:"1"},{ability_type:2,ability_name:"2"},{ability_type:3,ability_name:"3"},{ability_type:4,ability_name:"4"},{ability_type:5,ability_name:"5"},{ability_type:6,ability_name:"6"}]},character:{character_id:26,a_character_id:28,rare:"SR",element_type:1,character_type:"heal",name:"",level:6,max_level:80,is_equipped:!1,bonus:0,overlimit_count:1,max_overlimit_count:4,skin:0}},this._consoleErrorRouterParams("routerParams.enh_013, .id, .result"))},_navigateENH013ToENH002:function(e){t.createInstance("router").navigate("enh_evo",{},{enhevo_home:{tab:"enh",kind:"chara"}})},_navigateENH013ToEVO010:function(e){t.createInstance("router").navigate("enh_evo/enh_008",{enh_008:{id:e.routerParams.enh_013.id}})},_verifyRouterParamsENH014:function(e){n.isUndefined(e.routerParams.enh_014)&&(e.routerParams.enh_014={},e.routerParams.enh_014.result={result:{success_type:"great_success",gained_exp:600,before:{level:10,skill_level:0,gauge:40,hp:210,attack:850,max:!1},after:{level:22,skill_level:1,gauge:70,hp:273,attack:1105,max:!1}},weapon:{weapon_id:2,a_weapon_id:2,rare:"SR",element_type:1,weapon_type:"staff",name:"",level:22,max_level:80,is_equipped:!1,bonus:0,overlimit_count:1,max_overlimit_count:4,skin:0}},e.routerParams.enh_014.id=1,this._consoleErrorRouterParams("routerParams.enh_014, .id"))},_navigateENH014ToENH001:function(e){t.createInstance("router").navigate("enh_evo",{},{enhevo_home:{tab:"enh",kind:"weapon"}})},_navigateENH014ToENH007:function(e){t.createInstance("router").navigate("enh_evo/enh_007",{enh_007:{id:e.routerParams.enh_014.id}})},_verifyRouterParamsENH015:function(e){n.isUndefined(e.routerParams.enh_015)&&(e.routerParams.enh_015={},e.routerParams.enh_015.id=1,e.routerParams.enh_015.result={result:{success_type:"success",gained_exp:600,before:{level:1,gauge:0,hp:210,attack:850,max:!1},after:{level:6,gauge:83,hp:273,attack:1105,max:!1}},summon:{summon_id:2,a_summon_id:2,rare:"SR",element_type:1,name:"",level:6,max_level:80,is_equipped:!1,bonus:0,overlimit_count:1,max_overlimit_count:4,skin:0}},this._consoleErrorRouterParams("routerParams.enh_015, .id"))},_navigateENH015ToENH006:function(e){t.createInstance("router").navigate("enh_evo",{},{enhevo_home:{tab:"enh",kind:"summon"}})},_navigateENH015ToENH009:function(e){t.createInstance("router").navigate("enh_evo/enh_009",{enh_009:{id:e.routerParams.enh_015.id}})},_verifyRouterParamsEVO004:function(e){n.isUndefined(e.routerParams.evo_004)&&(e.routerParams.evo_004={},e.routerParams.evo_004.id=1,e.routerParams.evo_004.from="evo_007",this._consoleErrorRouterParams("routerParams.evo_004, .id, .from"))},_navigateEVO004ToENH007:function(e){if(n.isUndefined(e.routerParams.evo_004))this._consoleErrorRoutingAbort("routerParams.evo_004");else if(n.isUndefined(e.routerParams.evo_004.id))this._consoleErrorRoutingAbort("routerParams.evo_004.id");else{var i=e.routerParams.evo_004;t.createInstance("router").navigate("enh_evo/enh_007",{enh_007:{id:i.id}})}},_navigateEVO004ToENH002:function(e){t.createInstance("router").navigate("enh_evo",{},{enhevo_home:{tab:"evo",kind:"weapon"}})},_verifyRouterParamsEVO005:function(e){n.isUndefined(e.routerParams.evo_005)&&(e.routerParams.evo_005={},e.routerParams.evo_005.id=2,e.routerParams.evo_005.from="evo_010",this._consoleErrorRouterParams("routerParams.evo_005, .id, .from"))},_navigateEVO005ToENH009:function(e){if(n.isUndefined(e.routerParams.evo_005))this._consoleErrorRoutingAbort("routerParams.evo_005");else if(n.isUndefined(e.routerParams.evo_005.id))this._consoleErrorRoutingAbort("routerParams.evo_005.id");else{var i=e.routerParams.evo_005;t.createInstance("router").navigate("enh_evo/enh_009",{enh_009:{id:i.id}})}},_navigateEVO005ToEVO003:function(e){t.createInstance("router").navigate("enh_evo",{},{enhevo_home:{tab:"evo",kind:"summon"}})},_verifyRouterParamsEVO006:function(e){n.isUndefined(e.routerParams.evo_006)&&(e.routerParams.evo_006={},e.routerParams.evo_006.id=1,e.routerParams.evo_006.from="evo_013",this._consoleErrorRouterParams("routerParams.evo_006, .id, .from"))},_navigateEVO006ToENH008:function(e){if(n.isUndefined(e.routerParams.evo_006))this._consoleErrorRoutingAbort("routerParams.evo_006");else if(n.isUndefined(e.routerParams.evo_006.id))this._consoleErrorRoutingAbort("routerParams.evo_006.id");else{var i=e.routerParams.evo_006;t.createInstance("router").navigate("enh_evo/enh_008",{enh_008:{id:i.id}})}},_navigateEVO006ToEVO001:function(e){t.createInstance("router").navigate("enh_evo",{},{enhevo_home:{tab:"evo",kind:"chara"}})},_verifyRouterParamsEVO007:function(e){n.isUndefined(e.routerParams.evo_007)&&(e.routerParams.evo_007={},e.routerParams.evo_007.id=26,e.routerParams.evo_007.from="evo_001",this._consoleErrorRouterParams("routerParams.evo_007, .id, .from"))},_navigateEVO007ToEVO004:function(e){return n.isUndefined(e)||n.isUndefined(e.a_weapon_id)?void this._consoleErrorRoutingAbort("record.a_weapon_id"):void t.createInstance("router").navigate("enh_evo/detail/de_003",{de_003:{id:e.a_weapon_id,isOwn:!0,fromPartyPage:!1,fromEnhEvoPage:!0,equipedSelf:!1}},{ignoreImplicitRoute:!0,navigateFrom:{routes:"enh_evo/evo_007",routerParams:{evo_007:{id:e.a_weapon_id}}}})},_navigateEVO007ToEVO001:function(e){t.createInstance("router").navigate("enh_evo",{},{enhevo_home:{tab:"evo",kind:"weapon"}})},_navigateEVO007ToEVO009:function(e,i,a){if(n.isUndefined(i))this._consoleErrorRoutingAbort("result");else{a=n.map(a,function(e){return e.item_id?this._makeEnhEvoAnimationMaterialItem(e):this._makeEnhEvoAnimationMaterialWeapon(e)},this);t.createInstance("router").navigate("enh_evo/evo_009",{evo_009:{id:e,result:i,arouse:!1}},{evo_009:{materials:a}})}},_verifyRouterParamsEVO008:function(e){n.isUndefined(e.routerParams.evo_008)&&(e.routerParams.evo_008={},e.routerParams.evo_008.id=16,e.routerParams.evo_008.evomate={weapon_id:4,a_weapon_id:293,rare:"SSR",element_type:3,weapon_type:"ax",is_locked:!1,is_equipped:!1,bonus:1,overlimit_count:3,max_overlimit_count:4,skin:0},e.routerParams.evo_008.from="evo_007",this._consoleErrorRouterParams("routerParams.evo_008, .id, .evomate, .from"))},_navigateEVO008ToEVO001:function(e){t.createInstance("router").navigate("enh_evo",{},{enhevo_home:{tab:"evo",kind:"weapon"}})},_navigateEVO008ToEVO007:function(e){t.createInstance("router").navigate("enh_evo/evo_007",{},{enhevo_home:{tab:"evo",kind:"weapon"}})},_navigateEVO008ToEVO004:function(e){return n.isUndefined(e)||n.isUndefined(e.a_weapon_id)?void this._consoleErrorRoutingAbort("record.a_weapon_id"):void t.createInstance("router").navigate("enh_evo/detail/de_003",{de_003:{id:e.a_weapon_id,isOwn:!0,fromPartyPage:!1,fromEnhEvoPage:!0,equipedSelf:!1}},{ignoreImplicitRoute:!0,navigateFrom:{routes:"enh_evo/evo_008",routerParams:{evo_008:{id:e.a_weapon_id}}}})},_navigateEVO008ToEVO009:function(e,i,a){if(n.isUndefined(i))this._consoleErrorRoutingAbort("result");else{a=n.map(a,function(e){return e.item_id?this._makeEnhEvoAnimationMaterialItem(e):this._makeEnhEvoAnimationMaterialWeapon(e)},this);t.createInstance("router").navigate("enh_evo/evo_009",{evo_009:{id:e.routerParams.evo_008.id,result:i,arouse:!0}},{evo_009:{materials:a}})}},_verifyRouterParamsEVO009:function(e){n.isUndefined(e.routerParams.evo_009)&&(e.routerParams.evo_009={},e.routerParams.evo_009.id=1,e.routerParams.evo_009.result={result:{is_full_max_level:!0,before:{max_level:80},after:{max_level:100}},weapon:{weapon_id:4,a_weapon_id:4,rare:"SSR",element_type:3,name:"",is_locked:!1,is_equipped:!0,bonus:1,overlimit_count:3,max_overlimit_count:4,skin:0}},this._consoleErrorRouterParams("routerParams.evo_009, .id, .result"))},_navigateEVO009ToEVO001:function(e){t.createInstance("router").navigate("enh_evo",{},{enhevo_home:{tab:"evo",kind:"weapon"}})},_navigateEVO009ToEVO007:function(e){t.createInstance("router").navigate("enh_evo/evo_007",{evo_007:{id:e.routerParams.evo_009.id}})},_navigateToENH007:function(e){t.createInstance("router").navigate("enh_evo/enh_007",{enh_007:{id:e}})},_verifyRouterParamsEVO010:function(e){n.isUndefined(e.routerParams.evo_010)&&(e.routerParams.evo_010={},e.routerParams.evo_010.id=4,this._consoleErrorRouterParams("routerParams.evo_010, .id"))},_navigateEVO010ToEVO005:function(e){return n.isUndefined(e)||n.isUndefined(e.a_summon_id)?void this._consoleErrorRoutingAbort("record.a_summon_id"):void t.createInstance("router").navigate("enh_evo/detail/de_004",{de_004:{id:e.a_summon_id,isOwn:!0,fromPartyPage:!1,fromEnhEvoPage:!0,equipedSelf:!1,equipedMainSelf:!1}},{ignoreImplicitRoute:!0,navigateFrom:{routes:"enh_evo/evo_010",routerParams:{evo_010:{id:e.a_summon_id}}}})},_navigateEVO010ToEVO003:function(e){t.createInstance("router").navigate("enh_evo",{},{enhevo_home:{tab:"evo",kind:"summon"}})},_navigateEVO010ToEVO012:function(e,i,a){if(n.isUndefined(i))this._consoleErrorRoutingAbort("result");else{a=n.map(a,function(e){return e.item_id?this._makeEnhEvoAnimationMaterialItem(e):this._makeEnhEvoAnimationMaterialSummon(e)},this);t.createInstance("router").navigate("enh_evo/evo_012",{evo_012:{id:e,result:i,arouse:!0}},{evo_012:{materials:a}})}},_verifyRouterParamsEVO012:function(e){n.isUndefined(e.routerParams.evo_012)&&(e.routerParams.evo_012={},e.routerParams.evo_012.id=1,e.routerParams.evo_012.result={result:{is_full_max_level:!1,before:{max_level:80},after:{max_level:100}},summon:{summon_id:4,a_summon_id:4,rare:"SSR",element_type:3,name:"",is_locked:!1,is_equipped:!0,bonus:1,overlimit_count:3,max_overlimit_count:4,skin:0}},this._consoleErrorRouterParams("routerParams.evo_012, .id, .result"))},_navigateEVO012ToEVO003:function(e){t.createInstance("router").navigate("enh_evo",{},{enhevo_home:{tab:"evo",kind:"summon"}})},_navigateEVO012ToEVO010:function(e){t.createInstance("router").navigate("enh_evo/evo_010",{evo_010:{id:e.routerParams.evo_012.id}})},_navigateToENH009:function(e){t.createInstance("router").navigate("enh_evo/enh_009",{enh_009:{id:e}})},_verifyRouterParamsEVO013:function(e){n.isUndefined(e.routerParams.evo_013)&&(e.routerParams.evo_013={},e.routerParams.evo_013.id=1,this._consoleErrorRouterParams("routerParams.evo_013, .id"))},_navigateEVO013ToEVO002:function(e){t.createInstance("router").navigate("enh_evo",{},{enhevo_home:{tab:"evo",kind:"chara"}})},_navigateEVO013ToEVO006:function(e){return n.isUndefined(e)||n.isUndefined(e.a_character_id)?void this._consoleErrorRoutingAbort("record.a_character_id"):void t.createInstance("router").navigate("enh_evo/detail/de_001",{de_001_002:{id:e.a_character_id,isOwn:!0,fromPartyPage:!1,equipedSelf:!1}},{ignoreImplicitRoute:!0,navigateFrom:{routes:"enh_evo/evo_013",routerParams:{evo_013:{id:e.a_character_id}}}})},_navigateEVO013ToEVO014:function(e,i,a){return n.isUndefined(i)?void this._consoleErrorRoutingAbort("result"):void t.createInstance("router").navigate("enh_evo/evo_014",{evo_014:{id:e.routerParams.evo_013.id,result:i}},{evo_014:{materials:this._makeEnhEvoAnimationMaterialItems(a)}})},_verifyRouterParamsEVO014:function(e){n.isUndefined(e.routerParams.evo_014)&&(e.routerParams.evo_014={},e.routerParams.evo_014.id=1,e.routerParams.evo_014.result={result:{is_full_max_level:!1,before:{max_level:30},after:{max_level:40}},character:{character_id:26,a_character_id:28,rare:"SR",element_type:1,character_type:"heal",name:"",bonus:0,is_equipped:!1,overlimit_count:1,max_overlimit_count:4,skin:0}},this._consoleErrorRouterParams("routerParams.evo_014, .id, .result"))},_navigateEVO014ToEVO002:function(e){t.createInstance("router").navigate("enh_evo",{},{enhevo_home:{tab:"evo",kind:"chara"}})},_navigateEVO014ToEVO013:function(e){t.createInstance("router").navigate("enh_evo/evo_013",{evo_013:{id:e.routerParams.evo_014.id}})},_navigateToENH008:function(e){t.createInstance("router").navigate("enh_evo/enh_008",{enh_008:{id:e}})},_navigateToEnhTop:function(e,n){t.createInstance("router").navigate("enh_evo",{},{enhevo_home:{tab:"enh",kind:n}})},_navigateToEvoTop:function(e,n){t.createInstance("router").navigate("enh_evo",{},{enhevo_home:{tab:"evo",kind:n}})},_makeEnhEvoAnimationMaterialWeapons:function(e){return n.map(e,this._makeEnhEvoAnimationMaterialWeapon,this)},_verifyRouterParamsAROUSAL002:function(e){n.isUndefined(e.temporaryRouterParams.arousal_002)&&this._consoleErrorRouterParams("routerParams.arousal_002.id")},_navigateAROUSAL001To002:function(e,n){t.createInstance("router").navigate("enh_evo/arousal_002",{},{arousal_002:{id:n.a_character_id}})},_navigateAROUSAL002To001:function(e){t.createInstance("router").navigate("enh_evo/arousal_001",{},{enhevo_home:{tab:"arousal",kind:"chara"},ignoreImplicitRoute:!0})},_navigateAROUSAL002To003:function(e,n,i){t.createInstance("router").navigate("enh_evo/arousal_003",{},{arousal_003:{id:n,result:i}})},_navigateAROUSAL002ToLI004:function(e,n){t.createInstance("router").navigate("enh_evo/detail/de_001",{de_001_002:{id:n,isOwn:!0,fromPartyPage:!1,equipedSelf:!1}},{ignoreImplicitRoute:!0,navigateFrom:{routes:"enh_evo/arousal_002",temporaryRouterParams:{arousal_002:{id:n}}}})},_navigateAROUSAL003To001:function(e){t.createInstance("router").navigate("enh_evo/arousal_001",{},{enhevo_home:{tab:"arousal",kind:"chara"}})},_navigateAROUSAL003ToENH008:function(e,n){t.createInstance("router").navigate("enh_evo/enh_008",{enh_008:{id:n.a_character_id}})},_navigateAROUSAL003ToEVO013:function(e,n){t.createInstance("router").navigate("enh_evo/evo_013",{evo_013:{id:n.a_character_id}})},_makeEnhEvoAnimationMaterialWeapon:function(e){return{weapon_id:e.weapon_id,skin:e.skin,bonus:e.bonus,element_type:e.element_type,rare:e.rare,overlimit_count:e.overlimit_count,max_overlimit_count:e.max_overlimit_count,is_aroused:e.is_aroused}},_makeEnhEvoAnimationMaterialSummons:function(e){return n.map(e,this._makeEnhEvoAnimationMaterialSummon,this)},_makeEnhEvoAnimationMaterialSummon:function(e){return{summon_id:e.summon_id,skin:e.skin,bonus:e.bonus,element_type:e.element_type,rare:e.rare,overlimit_count:e.overlimit_count,max_overlimit_count:e.max_overlimit_count}},_makeEnhEvoAnimationMaterialItems:function(e){return n.map(e,this._makeEnhEvoAnimationMaterialItem,this)},_makeEnhEvoAnimationMaterialItem:function(e){return{item_id:e.item_id}},_navigateToBook001:function(e){switch(e){case"character":default:t.createInstance("router").navigate("book/book_001_character");break;case"summon":t.createInstance("router").navigate("book/book_001_summon");break;case"weapon":t.createInstance("router").navigate("book/book_001_weapon");break;case"accessory":t.createInstance("router").navigate("book/book_001_accessory")}},_navigateToEnh001:function(){t.createInstance("router").navigate("enh_evo/enh_001")},_navigateToEnh002:function(){t.createInstance("router").navigate("enh_evo/enh_002")},_navigateToEnh006:function(){t.createInstance("router").navigate("enh_evo/enh_006")},_navigateToEvo001:function(){t.createInstance("router").navigate("enh_evo/evo_001")},_navigateToEvo002:function(){t.createInstance("router").navigate("enh_evo/evo_002")},_navigateToEvo003:function(){t.createInstance("router").navigate("enh_evo/evo_003")}},n.assign(t.pc.enh_evo.roles.Routing,t.pc.roles.RoutingCommon)}((this||0).self||global),function(e){var t=e.kh,n=e._,i=t.pc.enh_evo.roles.Routing;t.pc.enh_evo.roles.RoutingIE=n.assign(n.cloneDeep(i),{_makeEnhEvoAnimationMaterialWeapons:function(e){var t=i._makeEnhEvoAnimationMaterialWeapons.call(this,e);return this._convertEnhEvoAnimationMaterialRecords(t)},_makeEnhEvoAnimationMaterialSummons:function(e){var t=i._makeEnhEvoAnimationMaterialSummons.call(this,e);return this._convertEnhEvoAnimationMaterialRecords(t)},_makeEnhEvoAnimationMaterialItems:function(e){var t=i._makeEnhEvoAnimationMaterialItems.call(this,e);return this._convertEnhEvoAnimationMaterialRecords(t)},_convertEnhEvoAnimationMaterialRecords:function(e){return t.createInstance("QueryParameterDataConverter").convertRecordCollection(e)}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._),i=e.Q;t.pc.enh_evo=t.pc.enh_evo||{},t.pc.enh_evo.roles=t.pc.enh_evo.roles||{},t.pc.enh_evo.roles.EnhEvoCommon={_setNothingBtnEvent:function(e){var n=e.seekWidgetByName("nothing_node");if(null!==n){var i={"TOUCH_ENDED btn_present":function(){this._navigateToPresent()},"TOUCH_ENDED btn_quest":function(){this._navigateToQuest()}};-1===t.createInstance("router").getCurrentFragment().search(/\/evo_[0-9]{3}$/)?i["TOUCH_ENDED btn_gacha"]=function(){this._navigateToGemGacha()}:i["TOUCH_ENDED btn_gacha"]=function(){this._navigateToGachaTop()},t.setTouchEventHandlers(n,i,this)}else console.warn("[ERROR] Could not find nothing_node.")},_setCharacterBasePanel:function(e,i,a){return n.isUndefined(a)||n.isUndefined(a.a_character_id)?t.createInstance("apiACharacters").get(i).then(function(t){return this._chara=t.body,this._setCharacterBasePanelOrg(e,this._chara,!0),this._chara}.bind(this)).fail(function(e){console.error(e.stack)}):this._setCharacterBasePanelWithoutApi(e,a)},_setCharacterBasePanelWithoutApi:function(e,t){return this._setCharacterBasePanelOrg(e,t,!1),i.resolve(t)},_setCharacterBasePanelOrg:function(e,i,a){"enh_evo/evo_013"!==t.createInstance("router").getCurrentFragment()&&t.createInstance("enhEvoButtons")._setCharacterEnhEvoButtonStates(e,i.a_character_id);var o=e.seekWidgetByName("status_window");if(null!==o)if(n.isUndefined(i)||null===i)console.warn("[ERROR] Could not read a record.");else if(this._setExpGauge(o,i),this._setCardStrings(o,i),this._setCharacterCoreCardFull(o,i,"corecard_chara_ui"),this._setLevelString(o,i),this._setMaxLevelString(o,i),null!==o.seekWidgetByName("chara_img")){if((n.isUndefined(a)||n.isNull(a))&&(a=!1),!0===a&&!n.isUndefined(this._touchHeaderCoreCard)&&n.isFunction(this._touchHeaderCoreCard)){var r=o.seekWidgetByName("chara_img");r.setSoundEnabled(!0),r.setSound(t.SoundList.BUTTON_TOUCHED_DECIDE),t.setTouchEventHandlers(o,{"TOUCH_ENDED chara_img":function(){this._touchHeaderCoreCard(i)}},this)}}else console.warn("[ERROR] Could not find chara_img.");else console.warn("[ERROR] Could not find status_window.")},_setWeaponBasePanel:function(e,a,o){return n.isUndefined(o)||n.isUndefined(o.a_weapon_id)?t.createInstance("apiAWeapons").get(a).then(function(t){this._weapon=t.body,this._setWeaponBasePanelOrg(e,this._weapon,!0)}.bind(this)).fail(function(e){console.error(e.stack)}):(this._setWeaponBasePanelWithoutApi(e,o),i.resolve())},_setWeaponBasePanelWithoutApi:function(e,t){this._setWeaponBasePanelOrg(e,t,!1)},_setWeaponBasePanelOrg:function(e,i,a){"enh_evo/evo_008"!==t.createInstance("router").getCurrentFragment()&&t.createInstance("enhEvoButtons")._setWeaponEnhEvoButtonStates(e,i.a_weapon_id);var o=e.seekWidgetByName("status_window");if(null!==o)if(n.isUndefined(i)||null===i)console.warn("[ERROR] Could not read a record.");else if(this._setExpGauge(o,i),this._setSkillExpGauge(o,i),this._setCardStrings(o,i),this._setWeaponSkillBase(o,i),this._setWeaponCoreCardFull(o,i,"corecard_weapon_ui"),this._setLevelString(o,i),this._setMaxLevelString(o,i),null!==o.seekWidgetByName("weapon_img")){if((n.isUndefined(a)||n.isNull(a))&&(a=!1),!0===a&&!n.isUndefined(this._touchHeaderCoreCard)&&n.isFunction(this._touchHeaderCoreCard)){var r=o.seekWidgetByName("weapon_img");r.setSoundEnabled(!0),r.setSound(t.SoundList.BUTTON_TOUCHED_DECIDE),t.setTouchEventHandlers(o,{"TOUCH_ENDED weapon_img":function(){this._touchHeaderCoreCard(i)}},this)}}else console.warn("[ERROR] Could not find weapon_img.");else console.warn("[ERROR] Could not find status_window.")},_setSummonBasePanel:function(e,i,a){return n.isUndefined(a)||n.isUndefined(a.a_summon_id)?void t.createInstance("apiASummons").get(i).then(function(t){this._summon=t.body,this._setSummonBasePanelOrg(e,this._summon,!0)}.bind(this)).fail(function(e){console.error(e.stack)}):this._setSummonBasePanelWithoutApi(e,a)},_setSummonBasePanelWithoutApi:function(e,t){this._setSummonBasePanelOrg(e,t,!1)},_setSummonBasePanelOrg:function(e,i,a){t.createInstance("enhEvoButtons")._setSummonEnhEvoButtonStates(e,i.a_summon_id);var o=e.seekWidgetByName("status_window");if(null!==o)if(n.isUndefined(i)||null===i)console.warn("[ERROR] Could not read a record.");else if(this._setExpGauge(o,i),this._setCardStrings(o,i),this._setSummonCoreCardFull(o,i,"corecard_summon_ui"),this._setLevelString(o,i),this._setMaxLevelString(o,i),null!==o.seekWidgetByName("summon_img")){if((n.isUndefined(a)||n.isNull(a))&&(a=!1),!0===a&&!n.isUndefined(this._touchHeaderCoreCard)&&n.isFunction(this._touchHeaderCoreCard)){var r=o.seekWidgetByName("summon_img");r.setSoundEnabled(!0),r.setSound(t.SoundList.BUTTON_TOUCHED_DECIDE),t.setTouchEventHandlers(o,{"TOUCH_ENDED summon_img":function(){this._touchHeaderCoreCard(i)}},this)}}else console.warn("[ERROR] Could not find summon_img.");else console.warn("[ERROR] Could not find status_window.")},_selectRecommendMaterals:function(e,n){t.createInstance(e).getRecommendEnhanceMaterials(n).then(function(e){if(0===e.body.max_record_count)this._showNoRecommendMaterialsPopup();else{var t=e.body.data;this._confirmEnhance(t,!0)}}.bind(this)).fail(function(e){console.error(e.stack)})},_setLevelString:function(e,t){var i=e.seekWidgetByName("level_label");i&&!n.isUndefined(t.level)&&i.setString("Lv "+t.level)},_setMaxLevelString:function(e,t){var i=e.seekWidgetByName("max_level_label");i&&!n.isUndefined(t.max_level)&&i.setString("MAX "+t.max_level)}},n.assign(t.pc.enh_evo.roles.EnhEvoCommon,t.pc.roles.ImagesCommon,t.pc.roles.IconsCommon,t.pc.roles.StringsCommon,t.pc.roles.GaugesCommon,t.pc.roles.CoreCardCommon,t.pc.status.roles.WeaponSkillCommon)}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc.enh_evo=t.pc.enh_evo||{},t.pc.enh_evo.roles=t.pc.enh_evo.roles||{},t.pc.enh_evo.roles.EnhEvoConfirmList={_setConfirmListCharacter:function(e,t,n,i){return this._setConfirmListOrg(e,t,n,i,"apiACharacters","weapon")},_setConfirmListWeapon:function(e,t,n,i){return this._setConfirmListOrg(e,t,n,i,"apiAWeapons","weapon")},_setConfirmListSummon:function(e,t,n,i){return this._setConfirmListOrg(e,t,n,i,"apiASummons","summon")},_setConfirmListOrg:function(e,n,a,o,r,s){if(i.isUndefined(n))console.warn("[ERROR] Could not find id.");else if(i.isUndefined(a))console.warn("[ERROR] Could not find materialIds.");else{o=o||"corecard_blank_5_4_ui";var c=e.seekWidgetByName(o);if(null!==c){var u=t.createInstance("ListManager",[c.getChildren(),null,this._recordWidgetInitFunc[s].bind(this)]),l=i.invert(a||{});return a=i.keys(l).sort(function(e,t){return e==t?0:e<t?-1:1}).map(function(e){return l[e]}),this._materialIds=a,t.createInstance(r).confirmEnhanceMaterials(n,a).then(function(e){this._enhMaterials=e.body;var t=i(e.body.materials).map(function(e){return[e.a_weapon_id||e.a_summon_id,e]}).zipObject().value();return t=i.map(a,function(e){return t[e]}),this._enhMaterials.materials=t,u.setRecords(t,!0),c.setVisible(!0),this._enhMaterials}.bind(this)).fail(function(e){console.error(e.stack)})}console.warn("[ERROR] Could not find list_node: "+c)}},_recordWidgetInitFunc:{weapon:function(e,t){e.parent.setVisible(!0),this._setWeaponCoreCardFull(e.parent,t)},summon:function(e,t){e.parent.setVisible(!0),this._setSummonCoreCardFull(e.parent,t)}},_getHighestRearityInSelectedMaterials:function(){var e=t.w("ORDERD_RARELITIES"),n=0;return i.find(this._enhMaterials.materials,function(t){n=Math.max(n,e.indexOf(t.rare))}),e[n]},_clearList:function(e){i.each(this._listCells||[],function(e){e.parent.parent.setVisible(!1),e.removeFromParent()}),this._listCells=[]},_setCharacterEvolveMaterials:function(e,o,r){this._clearList(e);var s=e.seekWidgetByName("corecard_blank_5_4_ui");if(null!==s)return(i.isUndefined(r)?t.createInstance("apiACharacters").getEvolveMaterials(o):a.resolve(r)).then(function(a){var c,u,l;i.isUndefined(r)?(this._confirmEvo=a.body,c=a.body.result.items,u=this._initCharacterEvolveMaterialItemWidget.bind(this),l=function(e){return e.num<e.need_num}):(c=r,u=this._initCharacterEvolutionItemWidget.bind(this),l=function(e){return!e.canUse()});var _=[0,1,2,3,4,6,7,8],p=!1;return i.each(c,function(e,t){if(!(_.length<=t)){var i=s.seekWidgetByName("list_blank_"+_[t]);if(null===i)return void console.warn("[ERROR] Could not find a parent node: list_blank_"+_[t]);u(i,e),i.setVisible(!0),l(e)&&(p=!0,i.seekWidgetByName("item_img")&&i.seekWidgetByName("item_img").setColor(n.color("#808080")))}},this),p?this._changeSeenCancel(e):t.createInstance("enhEvoButtons")._setCharacterEnhEvoButtonStates(e,o),this._confirmEvo}.bind(this)).fail(function(e){console.error(e.stack)});console.warn("[ERROR] Could not find confirm list.")},_loadCharacterEvolveItems:function(e){return this._getEvolveItemsPromise(e).then(function(e){return e.body.data})},_getEvolveItemsPromise:function(e){return t.createInstance("apiACharacters").getEvolveItems(e).fail(function(e){console.error(e)})},_initCharacterEvolveMaterialItemWidget:function(e,n){this._listCells=this._listCells||[];var a=e.seekWidgetByName("corecard_ui"),o=!0;if(null===a){if(!e.seekWidgetByName("item_img")||"item_img"!==e.name)return void console.warn("[ERROR] Could not find a corecard ui node.");a=e,e=e.parent,o=!1}var r=t.createInstance("CoreCardItemUI");i.isUndefined(n.item_id)||r.setImg(n.item_id),i.isUndefined(n.num)||i.isUndefined(n.need_num)||r.setAmount(n.num+"/"+n.need_num,!0),this._listCells.push(r.uiNode);var s=r.getResult();a.addChild(s),a.setVisible(!0),o&&t.setTouchEventHandlers(e,{"TOUCH_ENDED item_img":function(){!i.isUndefined(this._touchEvolveMaterial)&&i.isFunction(this._touchEvolveMaterial)&&this._touchEvolveMaterial(n)}},this)},_initCharacterEvolutionItemWidget:function(e,n){this._listCells=this._listCells||[];var a=e.seekWidgetByName("corecard_ui"),o=!0;if(null===a){if(!e.seekWidgetByName("item_img")||"item_img"!==e.name)return void console.warn("[ERROR] Could not find a corecard ui node.");a=e,e=e.parent,o=!1}var r=t.createInstance("CoreCardItemUI");r.setImg(n.getId());r.setAmount(n.getNum()+"/1",!0);var s=r.getResult();a.addChild(s),a.setVisible(!0),this._listCells.push(r.uiNode),o&&t.setTouchEventHandlers(e,{"TOUCH_ENDED item_img":function(){!i.isUndefined(this._touchEvolveMaterial)&&i.isFunction(this._touchEvolveMaterial)&&this._touchEvolveItem(n)}},this)},_setCharacterArouseMaterials:function(e,o){var r=e.seekWidgetByName("corecard_blank_5_4_ui");return null===r?void console.warn("[ERROR] Could not find confirm list."):t.createInstance("apiACharacters").getArouseMaterials(o).then(function(e){var t=e.body.result.items,o=[0,1,2,3,4,6,7,8],s=!1;return i.each(t,function(e,t){if(!(o.length<=t)){var i=r.seekWidgetByName("list_blank_"+o[t]);if(null===i)return void console.warn("[ERROR] Could not find a parent node: list_blank_"+o[t]);this._initCharacterEvolveMaterialItemWidget(i,e),i.setVisible(!0),e.num<e.need_num&&(s=!0,i.seekWidgetByName("item_img")&&i.seekWidgetByName("item_img").setColor(n.color("#808080")))}},this),a.all([a.resolve(t),a.resolve(s)])}.bind(this)).fail(function(e){console.error(e.stack)})},_setWeaponFinalEvolveMaterials:function(e,o,r){this._clearList(e);var s=e.seekWidgetByName("corecard_blank_5_4_ui");if(null!==s)return(i.isUndefined(r)?t.createInstance("apiAWeapons").getArouseMaterials(o):a.resolve(r)).then(function(a){var c,u,l;i.isUndefined(r)?(this._confirmEvo=a.body,c=a.body.result.items,u=this._initCharacterEvolveMaterialItemWidget.bind(this),l=function(e){return e.num<e.need_num}):(c=r,u=this._initCharacterEvolutionItemWidget.bind(this),l=function(e){return!e.canUse()});var _=[0,1,2,3,4,6,7,8],p=!1;return i.each(c,function(e,t){if(!(_.length<=t)){var i=s.seekWidgetByName("list_blank_"+_[t]);if(null===i)return void console.warn("[ERROR] Could not find a parent node: list_blank_"+_[t]);u(i,e),i.setVisible(!0),l(e)&&(p=!0,i.seekWidgetByName("item_img")&&i.seekWidgetByName("item_img").setColor(n.color("#808080")))}},this),p?this._changeSeenCancel(e):t.createInstance("enhEvoButtons")._setWeaponEnhEvoButtonStates(e,o),this._confirmEvo}.bind(this)).fail(function(e){console.error(e.stack)});console.warn("[ERROR] Could not find confirm list.")},_changeSeenCancel:function(e){e.seekWidgetByName("nothing_label")&&e.seekWidgetByName("nothing_label").setVisible(!0);var t=e.seekWidgetByName("btn_evo");t&&(t.setEnabled(!1),t.setColor(n.color("#808080")))}},i.assign(t.pc.enh_evo.roles.EnhEvoConfirmList,t.pc.roles.CoreCardCommon)}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc.enh_evo=t.pc.enh_evo||{},t.pc.enh_evo.roles=t.pc.enh_evo.roles||{},t.pc.enh_evo.roles.EnhPopupCommon={_popups:{popupNonOffer:{factoryName:"popupFactoryPopupCommon",resourceName:"core-popup-com_non_offer",title:"",buttonLabels:{blackBtn:""},buttons:{blackBtn:function(e){this.dismiss()}}}},_showNoRecommendMaterialsPopup:function(){var e=n.director.getRunningScene().popups.popupNonOffer;e.open().then(function(){t.setTouchEventHandlers(e,{"TOUCH_ENDED btn_present":function(){this._navigateToPresent()},"TOUCH_ENDED btn_gacha":function(){this._navigateToGemGacha()},"TOUCH_ENDED btn_quest":function(){this._navigateToQuest()}},this)}.bind(this)).fail(function(e){console.error(e.stack)})},_showRecommendSettingPopup:function(){var e=n.director.getRunningScene();t.ImplantedPopup.createOrGet(e,"enh_auto_select","EnhRecommendSettingPopup").open()},_showRareCheckPopup:function(e,o,r){var s=a.defer();return t.createInstance(e).confirmEnhanceMaterials(o,r).then(function(e){var a=e.body,o=i(e.body.materials).map(function(e){return[e.a_weapon_id||e.a_summon_id,e]}).zipObject().value();o=i.map(r,function(e){return o[e]}),a.materials=o;var c=n.director.getRunningScene(),u=t.ImplantedPopup.createOrGet(c,"enh_rare_check","EnhRareCheckPopup");return u?u.open(a).then(function(e){s.resolve(u.getMaterialRecords())}).fail(function(){s.reject()}):void s.reject()}.bind(this)).fail(function(e){console.error(e.stack),s.reject()}),s.promise},_enhanceResultHtmlString:function(){return"<div style='font-size:26px;line-height:1.4;margin-top:10px'><span class='orange'></span><span class='white'>"+this._enhMaterials.gained_exp+"</span><br /><span class='orange'></span><span class='white'>"+this._enhMaterials.great_success_percent+"</span><br />"+(i.isUndefined(this._enhMaterials.skill_level_up_percent)||0==this._enhMaterials.skill_level_up_percent?"":"<div class='yellow' style='line-height:1.6;font-size:36px'>Lv&nbsp;"+Math.round(this._enhMaterials.skill_level_up_percent)+"</div></div>")}},i.assign(t.pc.enh_evo.roles.EnhPopupCommon,t.pc.roles.StringsCommon)}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;e.Q,t.pc.enh_evo=t.pc.enh_evo||{},t.pc.enh_evo.roles=t.pc.enh_evo.roles||{},t.pc.enh_evo.roles.EvoPopupCommon={_popups:{popupMoneyCheck:{factoryName:"popupFactoryPopupCommon",resourceName:"core-popup-evo_money_check",title:"",buttonLabels:{blueBtn:"OK",blackBtn:""},buttons:{blueBtn:function(e){this.dismiss(),e._delegate._executeEvolution.apply(e._delegate,[e])},blackBtn:function(e){this.dismiss()}}},popupItemChoose:{factoryName:"popupFactoryEvoItemChoose"},popupNeedMate1:{factoryName:"popupFactoryPopupCommon",resourceName:"core-popup-com_need_mate",title:"",buttonLabels:{blackBtn:""},buttons:{blackBtn:function(e){this.dismiss()}}},popupNeedMate2:{factoryName:"popupFactoryPopupCommon",resourceName:"core-popup-com_need_mate",title:"",buttonLabels:{blueBtn:"",blackBtn:""},buttons:{blueBtn:function(e){t.createInstance("router").navigate("quest/q_special_top",{q_special_top:{category:"elemental"}}),this.dismiss()},blackBtn:function(e){this.dismiss()}}}},_showItemChoosePopup:function(e){e.getItemsPromise().then(function(e){n.director.getRunningScene().popups.popupItemChoose.open({evoItems:e})})},_showConfirmationPopups:function(e,i,a){var o=n.director.getRunningScene();return t.ImplantedPopup.createOrGet(o,"evo_mate_check","EvoMateCheckPopup").open(e,i,a)},_showMoneyCheckPopup:function(){var e=n.director.getRunningScene();if(i.isUndefined(this._confirmEvo)){var a=e.routerParams[this._routerParamsKey],o=a.id,r=a.evomate["a_"+this._type+"_id"],s={summon:"apiASummons",weapon:"apiAWeapons"}[this._type];this._selectedEvolutionItemId?this._getConfirmEvolveByItemPromise(s,o,this._selectedEvolutionItemId).then(function(t){this._showMoneyCheckPopupCore(e,t.body)}.bind(this)).fail(function(e){console.error(e)}):this._getConfirmEvolveByMaterialPromise(s,o,r).then(function(t){this._showMoneyCheckPopupCore(e,t.body)}.bind(this)).fail(function(e){console.error(e)})}else t.createInstance("myselfInfoRepository").getMyCurrency().then(function(t){var n=this._confirmEvo.result;n.gem=t.getGemAmount(),n.before_max_level=(this._chara||this._weapon).max_level,n.after_max_level=n.after_max_level||n.next_max_level,this._showMoneyCheckPopupCore(e,n)}.bind(this)).catch(function(e){console.error(e)})},_getConfirmEvolveByItemPromise:function(e,n,i){return t.createInstance(e).confirmEvolveByItem(n,i).fail(function(e){console.error(e)})},_getConfirmEvolveByMaterialPromise:function(e,n,i){return t.createInstance(e).confirmEvolveMaterial(n,i).fail(function(e){console.error(e)})},_showMoneyCheckPopupCore:function(e,i){var a=e.popups.popupMoneyCheck;a.open().then(function(){var e=i.gem<i.need_gem,o=this._evolveConfirmHtmlString(i,e);a.blueBtn.setColor(e?n.color("#808080"):n.color("#FFFFFF")),a.blueBtn.setEnabled(!e),a.setHtmlStrings({gemcheck_labelimg:o},t.GameConfig.POPUP_CSS)}.bind(this)).fail(function(e){console.error(e.stack)})},_evolveConfirmHtmlString:function(e,n){return"<span class='orange'></span><span class='white'>"+e.need_gem+t.w("gem")+"</span><br /><span class='orange'>Lv</span><span class='white'>"+e.before_max_level+"&rarr;</span><span class='yellow'>"+e.after_max_level+"</span><br /><span class='orange'></span><span class='white'>"+e.gem+"</span><br />"+(n?"<span class='red'></span>":"")},_showNeedMatePopup:function(e){var t=n.director.getRunningScene(),i=1==e.is_today_sp_quest?t.popups.popupNeedMate2:t.popups.popupNeedMate1;i.open().then(function(){var t=e.obtainment_description||"";i.setStrings({item_label:e.name,item_detail_label:e.description,item_quest_label:t});var n=i.seekWidgetByName("item_img");this._initCharacterEvolveMaterialItemWidget(n,e)}.bind(this)).fail(function(e){console.error(e.stack)})}},i.assign(t.pc.enh_evo.roles.EvoPopupCommon,t.pc.roles.ImagesCommon,t.pc.roles.IconsCommon,t.pc.roles.StringsCommon,t.pc.roles.GaugesCommon,t.pc.roles.CoreCardCommon,t.pc.status.roles.WeaponSkillCommon)}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc.enh_evo=t.pc.enh_evo||{},t.pc.enh_evo.roles=t.pc.enh_evo.roles||{},t.pc.enh_evo.roles.EnhEvoAnimation={_abort_animation:!1,_initPlayer:function(){t.createInstance("soundPlayer").init(t.createInstance("playerGameConfig"))},_showAnimationMaterials:function(e,t,n){var a=e.seekWidgetByName("corecard_blank_5_4_ui"),o={weapon:"_setWeaponCoreCardFull",summon:"_setSummonCoreCardFull",item:"_setItemCoreCard",acce:"_setAccessoryCoreCardFull"}[t];i.each(n,function(e,t){var n=a.seekWidgetByName("list_blank_"+t);this[o](n,e,"corecard_ui"),n.setVisible(!0)},this),a.setVisible(!0)},_playEnhAnimations2:function(e,n,o,r){var s=n.before,c=n.after;if(i.isUndefined(s)||i.isUndefined(c))return console.warn("[ERROR] invalid arg result: (Should contains 'before' an 'after' as a result of enhance API)."),a.resolve();var u=0,l=0,_=0;!i.isUndefined(s.skill_level)&&(u=c.skill_level-s.skill_level,l=s.skill_max?100:s.skill_gauge,_=c.skill_max?100:c.skill_gauge);var p=c.level-s.level,d=s.max?100:s.gauge,h=c.max?100:c.gauge;return this._initPlayer(),t.createInstance("myselfInfoRepository").allCacheClear(),this._playEnhAnimations(e,d,h,p,l,_,u,o,r)},_playEnhAnimations:function(e,n,i,o,r,s,c,u,l){l=l||600,u=u||!1;var _=this._getExpGaugeNode(e);if(null===_)return console.warn("[ERROR] Could not find levelup gauge."),a.resolve();if(i<0||i>100)return console.warn("[ERROR] Invalid arg afterExp: "+i),a.resolve();if(o<0)return console.warn("[ERROR] Invalid arg maxCount: "+o),a.resolve();_.percent=n;var p=e.seekWidgetByName("ani_great_success_node"),d=e.seekWidgetByName("ani_success_node");if(u&&null!==p)p.setVisible(!0);else{if(null===d)return console.warn("[ERROR] Could not find success image node."),a.resolve();d.setVisible(!0)}var h=100*o;0===i&&o--;var m=100*c;0===s&&(c=Math.max(0,c-1));var g=this._getSkillExpGaugeNode(e);return null!==g&&(g.percent=r),a.delay(l).then(function(){if(this._animationIsAbort())return a.resolve();var t="sound2_s_"+(u?"great_":"")+"success";this._attachSoundEffectEvent(e,"enh_start",t),this._playEnhEvoAnimation(e,"enh_start",!0,!1);var n=e.getAnimInfo("enh_start"),i=this._calcSpendMillisec(n.action);return a.delay(i)}.bind(this)).then(function(){if(this._animationIsAbort())return a.resolve();this._showEnhEndAnimation(e,0);var u=i+h,p=s+m,d=a.defer(),f=d.promise.then(this._showEnhEndAnimation.bind(this,e,!1,l)),b=this._createGaugeAnimationParam(u,n),v=this._createGaugeAnimationParam(p,r),E=[this._animateRecursive(_,b,this._getLvUpGaugeAnimationFunc(e,o,i,"ani_levelup_plate","level_up",d),this)];g&&E.push(this._animateRecursive(g,v,this._getLvUpGaugeAnimationFunc(e,c,s,"ani_skillup_plate","skill_level_up",d),this));var y=this.__stopPlayedAnim.bind(this,E,d);return t.setTouchEventHandlers(e,{"TOUCH_ENDED result_window":y,"TOUCH_ENDED exp_gauge":y},this),g&&t.setTouchEventHandlers(e,{"TOUCH_ENDED skill_gauge":y},this),f}.bind(this)).fail(function(e){console.error(e.stack)})},_getLvUpGaugeAnimationFunc:function(e,t,n,i,a,o){return function(r){var s=t-r;if(0===n||s>0){var c=e.seekWidgetByName(i);this._attachSoundEffectEvent(c,a,"sound2_s");var u=c.getAnimInfo(a).animInfo;c.getAction().gotoFrameAndPlay(u.startIndex,u.endIndex,!1)}if(0===s)return o.resolve()}.bind(this)},_createGaugeAnimationParam:function(e,t){var n=Math.ceil(e/100);return i.map(i.range(n),function(i){var a=100,o=0;0===i&&(a-=o=t);var r=150;return i>=n-1&&(a=(e%100||100)-o),r*=Math.min(5,Math.max(1,n-i-2)),[Math.abs(a)/r,o,o+a,i]},this)},_animateRecursive:function(e,t,o,r){var s=function(){};e.updateTweenAction=function(t){e.percent=t};var c=t.pop();return i.map(t,function(t){return function(t,i,o,r){var c=a.defer(),u=n.actionTween(t,"percent",i,o),l=n.callFunc(function(){r(),c.resolve()}),_=n.sequence(u,l);return e.runAction(_),s=function(t){t&&e.stopAction(_),c.reject(e._name+": animateRecursive interrupted")},c.promise}.bind(e,t[0],t[1],t[2],o.bind(r,t[3]))}.bind(this)).reduce(a.when,a()).finally(function(){if(c){var t=n.actionTween(c[0],"percent",c[1],c[2]),i=n.callFunc(function(){o(c[3]),a.defer().resolve()}),r=n.sequence(t,i);e.runAction(r)}}),function(e){s(e)}},_getExpGaugeNode:function(e){return e.seekWidgetByPath("result_window.exp_gauge")},_getSkillExpGaugeNode:function(e){return e.seekWidgetByPath("result_window.skill_gauge")},__stopPlayedAnim:function(e,t){t.promise.isPending()&&(i.each(e,function(e,t){e(!0)}),t.resolve())},_playEnhEvoAnimation:function(e,t,n,o){if(this._animationIsAbort())return a.resolve();var r=null;if(i.isUndefined(e)||i.isUndefined(e.resource))console.warn("[ERROR] Could not find resource in the scene.");else{var s=e.resource.action,c=s.animationInfo[t];if(!i.isUndefined(c)){if(n){var u=this._calcSpendMillisec(s)+100;r=a.delay(u)}return s.gotoFrameAndPlay(c.startIndex,c.endIndex,null,o),r}console.warn("[ERROR] Could not find animation: "+t)}},_setResultMessage:function(e,n){return null===e.seekWidgetByName("result_labelimg")?void console.warn("[ERROR] Could not find a label node"):void e.setHtmlStrings({result_labelimg:n},t.GameConfig.POPUP_CSS)},_setResultStatus:function(e,n){return null===e.seekWidgetByName("statusup_labelimg")?void console.warn("[ERROR] Could not find a status label node"):void e.setHtmlStrings({statusup_labelimg:n},t.GameConfig.POPUP_CSS)},_setResultShadowVisible:function(e,t){var n=khutil.getWidgetFromNode(e,"result_window",function(e){console.warn("EnhEvoAnimation: "+e)}.bind(this));khutil.getWidgetFromNode(n,"shadow_base",function(e){console.warn("EnhEvoAnimation: "+e)}.bind(this)).setVisible(t)},_showEnhEndAnimation:function(e,t){return this._updateHeader(),a.delay(t).then(function(){return this._playEnhEvoAnimation(e,"enh_end",!1,!1)}.bind(this))},_playEvoAnimations:function(e,n){this._initPlayer(),t.createInstance("myselfInfoRepository").allCacheClear();var i=e.getAnimInfo("evo_start").action,o=this._calcSpendMillisec(i);n=n||1500,a.delay(n).then(function(){this._animationIsAbort()||(this._attachSoundEffectEvent(e,"evo_start"),this._playEnhEvoAnimation(e,"evo_start",!0,!1).then(function(t){a.delay(o+100).then(function(){this._animationIsAbort()||this._showEvoEndAnimation(e)}.bind(this)).fail(function(e){console.error(e.stack)})}.bind(this)))}.bind(this))},_showEvoEndAnimation:function(e){this._updateHeader(),this._playEnhEvoAnimation(e,"evo_end",!1,!1)},_attachSoundEffectEvent:function(e,n,a){var o=e.getAnimInfo(n);if(o&&o.action){var r=t.createInstance("AnimationEventHandlerCcs_2_0").init(o.action);i.isUndefined(a)?t.createInstance("Sound2Event",[r]):t.createInstance("Sound2Event",[r,a])}},_calcSpendMillisec:function(e,t){return t=t||0,Math.floor(e.getDuration()*e.getTimeSpeed()*1e3/60)+t},_abortAnimation:function(){this._abort_animation=!0},_animationIsAbort:function(){return this._abort_animation},_updateHeader:function(){var e=n.director.getRunningScene();e.headerDelegate&&e.headerDelegate.updateCurrency()}},i.assign(t.pc.enh_evo.roles.EnhEvoAnimation,t.pc.roles.AnimationCommon,t.pc.roles.CoreCardCommon)}((this||0).self||global),function(e){var t=e.kh,n=e._,i=t.pc.enh_evo.roles.EnhEvoAnimation;t.pc.enh_evo.roles.EnhEvoAnimationIE=n.assign(n.cloneDeep(i),{_showAnimationMaterials:function(e,n,a){var o=t.createInstance("QueryParameterDataConverter").revertRecordCollection(a);i._showAnimationMaterials.call(this,e,n,o)}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);e.Q,t.pc.enh_evo=t.pc.enh_evo||{},t.pc.enh_evo.roles=t.pc.enh_evo.roles||{},t.pc.enh_evo.roles.EnhStatusCommon={_enhanceExpHtmlString:function(e,t){var i=e[t],a=e.result,o="<span class='red'>"+a.gained_exp+"</span>";"weapon"===t&&(o+="<br /><span class = 'red'>"+a.gained_skill_exp+"</span>");var r=a.before,s=a.after;if(n.isUndefined(r.skill_level)||n.isUndefined(s.skill_level)||r.skill_level===s.skill_level||(o+="<br/>Lv<span class='red'>"+s.skill_level+"</span>"),r.level!==s.level&&(o+="<br/>"+i.name+"Lv<span class='red'>"+i.level+"</span>"),"accessory"===t&&s.max&&!n.isUndefined(i.sub_effects)&&i.sub_effects.length>0){o+="<br/><span class='red'></span>"}return"<br/>"+o},_enhanceGrowthHtmlString:function(e){var t=e.result.before,n=e.result.after;return"<span class='white'>"+t.hp+" &rarr; </span><span class='orange'>"+n.hp+"</span>"+"<br/>"+("<div class='white'>"+t.attack+" &rarr; </span><span class='orange'>"+n.attack+"</span>")}},n.assign(t.pc.enh_evo.roles.EnhStatusCommon)}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;t.createNameSpaceIfNotExists("enh_evo.model"),t.enh_evo.model.EvolutionItems=n.Class.extend({_items:null,prepare:function(e,t){return this._prepared?this._prepared:(this._items=null,this._prepared=this._getEvolutionItemsPromise(e,t).then(function(e){return e.body.result?(this._result=e.body.result,this._items=e.body.result.items):e.body.data&&(this._items=e.body.data),console.debug("[!! DEBUG !!]",e.body.data),this}.bind(this)),this._prepared)},getUsableEvolutionItemsPromise:function(){return this._prepared.then(function(){return i.filter(this._items,function(e){return e.can_use_for_evolution_base}).map(function(e){return t.createInstance("EvolutionItemModel",[e])})}.bind(this))},getItemsPromise:function(){return this._prepared.then(function(){return i.map(this._items,function(e){return t.createInstance("EvolutionItemModel",[e])})}.bind(this))},getRawItemsPromise:function(){return this._prepared.then(function(){return this._items}.bind(this))},getRawResultPromise:function(){return this._prepared.then(function(){return this._result}.bind(this))},_getEvolutionItemsPromise:function(e,t){return this._createApi(e).getEvolutionItems(t).fail(function(e){console.error(e)})},_createApi:function(e){return t.createInstance({character:"apiACharacters",summon:"apiASummons",weapon:"apiAWeapons"}[e])}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;t.createNameSpaceIfNotExists("enh_evo.model"),t.enh_evo.model.EvolutionItem=n.Class.extend({ctor:function(e){this._param=e},_getProperty:function(e,t){return i.isUndefined(this._param[e])||i.isNull(this._param[e])?(console.debug("[!! EvolutionItem !!] property not found: ",e),i.isUndefined(t)?"":t):this._param[e]},getId:function(){return this._getProperty("item_id",-1)},getName:function(){return this._getProperty("name","")},getNum:function(){return this._getProperty("num",0)},canUse:function(){return this._getProperty("can_use_for_evolution_base",!1)}})}((this||0).self||global),function(e){var t=e.kh||{};t.enh_evo=t.enh_evo||{},t.enh_evo.view=t.enh_evo.view||{};t.enh_evo.view.ArouseAnimation=t.SceneObject.extend({_voiceId:27,ctor:function(e,t){this._arousedCharacterId=t,this._loading=this._load(e,t)},play:function(){return this._alreadyPlayed?Q.resolve():(this._alreadyPlayed=!0,this._loading.then(this._playAnimation.bind(this)).fail(function(e){throw console.error(e),e}))},_playAnimation:function(e){var n=e[0],i=e[1],a=e[2],o=cc.director.getRunningScene(),r=t.createInstance("WindowVisualEffect").init(n);i&&t.createInstance("Sound2EventCustom",[r,"sound2v_s",{sound2v_s:i}]),t.createInstance("Sound2Event",[r]);var s=function(){this.playByName("arousal_ani",o,cc.p(0,0),100,!1)}.bind(r),c=function(){this.playByName("touch_ani",o,cc.p(0,0),100,!0)}.bind(r);r.setAnimationNameEndCallback("arousal_ani",function(){r.removeAnimationNameEndCallback(),c()});var u=r.getNode();if(!u)return Q.reject(new Error("Animation Node not found"));try{this._setupTextures(u,a.base,["chara_panel_0","aura_panel_0"]),this._setupTextures(u,a.aroused,["chara_panel_1","aura_panel_1","moji_panel"]),s()}catch(e){return Q.reject(e)}var l=Q.defer();return t.setTouchEventHandlers(u,{"TOUCH_ENDED touch_btn":function(e){return function(){e.cleanUp(),l.resolve(!0)}}(r)},u),this._disableSETouchButton(o),this._anim=r,l.promise},_setupTextures:function(e,t,n){_(n).map(function(t){var n=e.seekWidgetByName(t);return n||(console.warn("node not found: "+t),null)}).compact().map(function(e){var n="arousal-ani_chara",i=e.seekWidgetByName(n);return i?void(_.isFunction(i.loadTexture)?i.loadTexture(t):_.isFunction(i.setTexture)?i.setTexture(t):alert("NO METHOD")):void console.warn("image node not found: "+e.getName()+".."+n)})},_load:function(e,t){return Q.all([this._preloadAnimation(),this._loadVoice(t),this._preloadTextures(e,t)])},_preloadAnimation:function(){return t.loader.load(["../enh_evo/res/arousal_ani/arousal_ani.json","../enh_evo/res/arousal_ani/arousal_ani_atlas.plist","../enh_evo/res/arousal_ani/arousal_ani_bg_0.jpg","../enh_evo/res/arousal_ani/arousal_ani_bg_1.jpg","../enh_evo/res/arousal_ani/se_arousal.mp3","../party/res/jobchange_ani/jobchange_atlas.plist"]).fail(function(e){throw console.error("load failed"),e}).thenResolve("res/arousal_ani/arousal_ani.json")},_loadVoice:function(e){var t=this._getVoiceId();return this._getVoiceLoader().loadAvatarVoices(e,!1,t,t+1).fail(function(e){throw console.error("Error: "+e.message),e}).then(function(e){return e[0]})},_preloadTextures:function(e,n){var i={base:this._getTexturePath(e),aroused:this._getTexturePath(n)};return t.loader.load(_.values(i)).fail(function(e){throw console.error("Error: "+e.message),e}).thenResolve(i)},_onDispose:function(){this._anim.cleanUp(),this._unloadVoice(this._arousedCharacterId)},_unloadVoice:function(e){var t=this._getVoiceId();return this._getVoiceLoader().unloadAvatorVoices(e,!1,t,t+1)},_getVoiceLoader:function(){return t.createInstance("voiceLoader")},_getVoiceId:function(){return this._voiceId},_getTexturePath:function(e){return t.Img("arousal-ani","chara",_.padZero(e,4),0).png},_disableSETouchButton:function(e){var t=this._getTouchButton(e);t&&t.setSoundEnabled(!1)},_getTouchButton:function(e){return e.seekWidgetByName("touch_btn")}})}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.enh_evo=t.pc.enh_evo||{},t.pc.enh_evo.enh_001_002_006_evo_001_002_003=t.pc.enh_evo.enh_001_002_006_evo_001_002_003||{},t.pc.enh_evo.enh_001_002_006_evo_001_002_003.Scene=t.BaseScene.extend({resourceFileName:"enh_001_2_6_evo_001_2_3/enh_001_2_6_evo_001_2_3.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[{tab1:{node:"tab_0","content-node":"enh_node"},tab2:{node:"tab_1","content-node":"evo_node"},tab3:{node:"tab_2","content-node":"arousal_node"}},{tab4:{node:"btn_chara","content-node":"chara_node","container-node":"enh_node"},tab5:{node:"btn_weapon","content-node":"weapon_node","container-node":"enh_node"},tab6:{node:"btn_summon","content-node":"summon_node","container-node":"enh_node"}},{tab7:{node:"btn_chara","content-node":"chara_node","container-node":"evo_node"},tab8:{node:"btn_weapon","content-node":"weapon_node","container-node":"evo_node"},tab9:{node:"btn_summon","content-node":"summon_node","container-node":"evo_node"}}],componentName:"enh_evo",sceneName:"enh_001_002_006_evo_001_002_003",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath("arousal_node"),"btn_gacha","btnCallbackArousalNodeBtnGacha",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"gacha/ga_000")),this._initButtonEvent.call(this,this.seekWidgetByPath("chara_node"),"filter_btn","btnCallbackCharaNodeFilterBtn",null,function(){alert("{{com_filter_chara}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("weapon_node"),"filter_btn","btnCallbackWeaponNodeFilterBtn",null,function(){alert("{{com_filter_weapon}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("summon_node"),"filter_btn","btnCallbackSummonNodeFilterBtn",null,function(){alert("{{com_filter_other}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("arousal_node"),"filter_btn","btnCallbackArousalNodeFilterBtn",null,function(){alert("{{com_filter_chara}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._),i=e.Q;t.pc=t.pc||{},t.pc.enh_evo=t.pc.enh_evo||{},t.pc.enh_evo.enh_001_002_006_evo_001_002_003=t.pc.enh_evo.enh_001_002_006_evo_001_002_003||{},t.pc.enh_evo.enh_001_002_006_evo_001_002_003.PagerSetting={enh_001:{baseName:"enh_node.weapon_node",cardType:"weapon",cardFrame:"full",apiName:"apiAWeapons",apiMethod:"getListEnhanceBase",apiParams:["enhance",t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE],sortKey:"enhance_base_weapons",sortEvent:"pulldown_enh_weapon",touchFuncName:"_touchEnhWeapon"},enh_002:{baseName:"enh_node.chara_node",cardType:"chara",cardFrame:"full",apiName:"apiACharacters",apiMethod:"getListEnhanceBase",apiParams:["enhance",t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE],sortKey:"enhance_base_characters",sortEvent:"pulldown_enh_chara",touchFuncName:"_touchEnhChara"},enh_006:{baseName:"enh_node.summon_node",cardType:"summon",cardFrame:"full",apiName:"apiASummons",apiMethod:"getListEnhanceBase",apiParams:["enhance",t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE],sortKey:"enhance_base_summons",sortEvent:"pulldown_enh_summon",touchFuncName:"_touchEnhSummon"},evo_001:{baseName:"evo_node.weapon_node",cardType:"weapon",cardFrame:"full",apiName:"apiAWeapons",apiMethod:"getListEvolveBase",apiParams:["evolve",t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE],sortKey:"evolve_base_weapons",sortEvent:"pulldown_evo_weapon",touchFuncName:"_touchEvoWeapon"},evo_002:{baseName:"evo_node.chara_node",cardType:"chara",cardFrame:"full",apiName:"apiACharacters",apiMethod:"getListEvolveBase",apiParams:["evolve",t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE],sortKey:"evolve_base_characters",sortEvent:"pulldown_evo_chara",touchFuncName:"_touchEvoChara"},evo_003:{baseName:"evo_node.summon_node",cardType:"summon",cardFrame:"full",apiName:"apiASummons",apiMethod:"getListEvolveBase",apiParams:["evolve",t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE],sortKey:"evolve_base_summons",sortEvent:"evolve_base_summons",touchFuncName:"_touchEvoSummon"},arousal_001:{baseName:"arousal_node.chara_node",cardType:"chara",cardFrame:"full",apiName:"apiACharacters",apiMethod:"getListArouseBase",apiParams:["arousal",t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE],sortKey:"arousal_base_characters",sortEvent:"arousal_base_characters",touchFuncName:"_touchArouseChara"}},t.pc.enh_evo.enh_001_002_006_evo_001_002_003.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../enh_evo_popup_ui.json"],_tabsForScene:{enh_001:{tab:"enh",kind:"weapon"},enh_002:{tab:"enh",kind:"chara"},enh_006:{tab:"enh",kind:"summon"},evo_001:{tab:"evo",kind:"weapon"},evo_002:{tab:"evo",kind:"chara"},evo_003:{tab:"evo",kind:"summon"},arousal_001:{tab:"arousal",kind:"chara"}},_createDisplayFilterSettings:function(){return{"enh_node.chara_node":[t.displayFilter.enums.FILTER_NAME.ENH_BASE_CHARA,"com_filter_chara"],"enh_node.weapon_node":[t.displayFilter.enums.FILTER_NAME.ENH_BASE_WEAPON,"com_filter_weapon"],"enh_node.summon_node":[t.displayFilter.enums.FILTER_NAME.ENH_BASE_SUMMON,"com_filter_other"],"evo_node.chara_node":[t.displayFilter.enums.FILTER_NAME.EVO_BASE_CHARA,"com_filter_chara"],"evo_node.weapon_node":[t.displayFilter.enums.FILTER_NAME.EVO_BASE_WEAPON,"com_filter_weapon"],"evo_node.summon_node":[t.displayFilter.enums.FILTER_NAME.EVO_BASE_SUMMON,"com_filter_other"],"arousal_node.chara_node":[t.displayFilter.enums.FILTER_NAME.AROUSAL_CHARA,"com_filter_chara"]}},_popups:{},_controller:null,onSceneInit:function(e){this._syncTab=!1,this._initialized=!1,this._verifyRouterParamsENH001002006EVO001002003(e),this._createDisplayFilterController(e),e.tabDelegateList.forEach(function(e){e.preventInitialization()}),this._initialized=!0;var n=e.temporaryRouterParams.enhevo_home||this._tabsForScene[t.createInstance("router").getCurrentSceneName()];return this._setTabFromRoutingParams(e,n),this._setBackBtn(e),t.createInstance("apiASubTutorialPages").get("enh_evo").then(function(n){0==n.body.visited&&(this._openSubTutorialPopup(e),t.createInstance("apiASubTutorialPages").visited("enh_evo"))}.bind(this)).fail(function(e){console.error(e.stack)}),this._setSubHeaderLabels(e),this._syncTab=!0,i.resolve()},onSceneEnter:function(e){return this._controller={},t.createInstance("apiAPlayers").getSortConfig().then(function(e){this._sortConfig=e.body.sort_config}.bind(this)),i.resolve()},onPageInAnimationEnd:function(e){return i.resolve()},_setTabFromRoutingParams:function(e,t){n.isUndefined(t)&&(t=this._tabsForScene.enh_001);var i=Array("enh","evo","arousal").indexOf(t.tab);if(i<0&&i>1)console.error("Invalid enhevo_home:tab value, "+t.tab);else{var a=e.tabDelegateList[0];if(a.selectTab(a._getContainerNode().seekWidgetByName("tab_"+i)),-1!==Array("chara","weapon","summon").indexOf(t.kind)){var o=Array("chara","weapon","summon").indexOf(t.kind),r=e.tabDelegateList[i+1];r&&r.selectTab(r._getContainerNode().seekWidgetByName("btn_"+t.kind));return 3*i+o}console.error("Invalid enhevo_home:kind value, "+t.kind)}},_setSubHeaderLabels:function(e){this._getMePromise().then(function(t){var i=t.body,a=n([this._getHeaderEnhNode(e),this._getHeaderEvoNode(e),this._getHeaderArousalNode(e)]).filter(function(e){return e}).value();this._setHeaderLabelSummon(a,this._getHeaderTextSummon(i)),this._setHeaderLabelWeapon(a,this._getHeaderTextWeapon(i)),this._setHeaderLabelCharacter(a,this._getHeaderTextCharacter(i))}.bind(this)).fail(function(e){console.error(e.stack)})},_getMePromise:function(){return t.createInstance("apiAPlayers").get("me").fail(function(e){console.error(e.stack)})},_getHeaderEnhNode:function(e){return e.seekWidgetByName("enh_node")},_getHeaderEvoNode:function(e){return e.seekWidgetByName("evo_node")},_getHeaderArousalNode:function(e){return e.seekWidgetByName("arousal_node")},_setHeaderLabelSummon:function(e,t){this._setHeaderLabelBase(e,"summon_node.header_sub_label",t)},_setHeaderLabelWeapon:function(e,t){this._setHeaderLabelBase(e,"weapon_node.header_sub_label",t)},_setHeaderLabelCharacter:function(e,t){this._setHeaderLabelBase(e,"chara_node.header_sub_label",t)},_setHeaderLabelBase:function(e,t,i){n(e).map(function(e){return e.seekWidgetByPath(t)}).filter(function(e){return e}).invoke("setString",i)},_getHeaderTextSummon:function(e){return n.isUndefined(e.summon_num)||n.isUndefined(e.max_summon_num)?(console.debug("[NOTICE] Could not find summon_num | max_summon_num."),""):""+t.w("summon")+":"+e.summon_num+"/"+e.max_summon_num},_getHeaderTextWeapon:function(e){return n.isUndefined(e.weapon_num)||n.isUndefined(e.max_weapon_num)?(console.debug("[NOTICE] Could not find weapon_num | max_weapon_num."),""):""+t.w("weapon")+":"+e.weapon_num+"/"+e.max_weapon_num},_getHeaderTextCharacter:function(e){return n.isUndefined(e.character_num)?(console.debug("[NOTICE] Could not find character_num."),""):":"+e.character_num},onSceneExit:function(e){return n.each(this._controller,function(e){e.dispose()}),delete this._controller,this._displayFilterClean(),i.resolve()},_touchEnhChara:function(e,t){var n=t.getRawData();this._navigateENH001To008(e,n)},_touchEnhWeapon:function(e,t){var n=t.getRawData();this._navigateENH002To007(e,n)},_touchEnhSummon:function(e,t){var n=t.getRawData();this._navigateENH006To009(e,n)},_touchEvoChara:function(e,t){var n=t.getRawData();this._navigateEVO001To013(e,n)},_touchEvoWeapon:function(e,t){var n=t.getRawData();n.arousable?this._navigateEVO002To008(e,n):this._navigateEVO002To007(e,n)},_touchEvoSummon:function(e,t){var n=t.getRawData();this._navigateEVO003To010(e,n)},_touchArouseChara:function(e,t){var n=t.getRawData();this._navigateAROUSAL001To002(e,n)},_fillupBySceneName:function(e,i){if(i&&this._initialized&&!this._controller[i]){var a=t.pc.enh_evo.enh_001_002_006_evo_001_002_003.PagerSetting[i],o=n.extend({sortConfig:this._sortConfig},a),r=new t.core.eventHandling.BaseEventHandler(this[o.touchFuncName].bind(this,e),this),s=t.core.pager.helper.coreCardListUI(e,o,r);this._controller[i]=s;var c=e.seekWidgetByPath(o.baseName);return this._initNoDataNoticeControls(c.seekWidgetByName("nothing_node")),s.show(),s.initialize()}},_initNoDataNoticeControls:function(e){t.setTouchEventHandlers(e,{"TOUCH_ENDED btn_present":function(){this._navigateToPresent()},"TOUCH_ENDED btn_gacha":function(){this._navigateToGachaTop()},"TOUCH_ENDED btn_quest":function(){this._navigateToQuest()}},this)},_openSubTutorialPopup:function(e){return t.ImplantedPopup.createOrGet(e,"sub_tutorial","ImplantedSubTutorialPopup").open("enh",4)},tabCallbackTab0:function(e){var t=e.tabDelegateList[1];this._syncListTab(e,t,"evolve")},tabCallbackTab1:function(e){var t=e.tabDelegateList[2];this._syncListTab(e,t,"enhance")},tabCallbackTab2:function(e){this._clearListType(e),this._initializeDisplayFilterController("arousal_node.chara_node"),this._fillupBySceneName(e,"arousal_001")},tabCallbackBtnCharaEnhNode:function(e){this._initializeDisplayFilterController("enh_node.chara_node"),this._fillupBySceneName(e,"enh_002")},tabCallbackBtnWeaponEnhNode:function(e){this._initializeDisplayFilterController("enh_node.weapon_node"),this._fillupBySceneName(e,"enh_001")},tabCallbackBtnSummonEnhNode:function(e){this._initializeDisplayFilterController("enh_node.summon_node"),this._fillupBySceneName(e,"enh_006")},tabCallbackBtnCharaEvoNode:function(e){this._initializeDisplayFilterController("evo_node.chara_node"),this._fillupBySceneName(e,"evo_002")},tabCallbackBtnWeaponEvoNode:function(e){this._initializeDisplayFilterController("evo_node.weapon_node"),this._fillupBySceneName(e,"evo_001")},tabCallbackBtnSummonEvoNode:function(e){this._initializeDisplayFilterController("evo_node.summon_node"),this._fillupBySceneName(e,"evo_003")},_syncListTab:function(e,t,i){var a=this._getCurrentListTypeByTabType(e,i);n.isNull(a)&&(a="character");var o=this._getListTabNodeNameByListType(a),r=t._getContainerNode().seekWidgetByName(o);t.selectTab(r)},_touchEndedBackBtnProcess:function(e){var t=this._getCurrentTabType(e);switch(t+"-"+this._getCurrentListTypeByTabType(e,t)){default:case"enhance-character":case"evolve-character":case"arousal-character":this._navigateToBook001("character");break;case"enhance-summon":case"evolve-summon":this._navigateToBook001("summon");break;case"enhance-weapon":case"evolve-weapon":this._navigateToBook001("weapon")}},_getCurrentListTypeByTabType:function(e,t){var n;switch(t){case"enhance":n=e.tabDelegateList[1].selected;break;case"evolve":n=e.tabDelegateList[2].selected;break;case"arousal":n="arousal"}switch(n){case"enh_node..btn_chara":case"evo_node..btn_chara":case"arousal":return"character";case"enh_node..btn_summon":case"evo_node..btn_summon":return"summon";case"enh_node..btn_weapon":case"evo_node..btn_weapon":return"weapon";default:return null}},_getCurrentTabType:function(e){switch(e.tabDelegateList[0].selected){case"tab_0":return"enhance";case"tab_1":return"evolve";case"tab_2":return"arousal"}},_getListTabNodeNameByListType:function(e){switch(e){case"character":return"btn_chara";case"summon":return"btn_summon";case"weapon":return"btn_weapon";default:return"btn_chara"}},_clearListType:function(e){e.tabDelegateList[1].selected="",e.tabDelegateList[2].selected=""}}),t.assignRoles(t.pc.enh_evo.enh_001_002_006_evo_001_002_003.SceneDelegate,[t.pc.roles.UIUtility,t.pc.enh_evo.roles.Routing,t.displayFilter.roles.DisplayFilterSceneController])}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.enh_evo=t.pc.enh_evo||{},t.pc.enh_evo.enh_007=t.pc.enh_evo.enh_007||{},t.pc.enh_evo.enh_007.Scene=t.BaseScene.extend({resourceFileName:"enh_007/enh_007",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"enh_evo",sceneName:"enh_007",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_base_change","btnCallbackBtnBaseChange",null,function(){alert("{{enh_001_2_6_evo_001_2_3enh_001}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_recommend","btnCallbackBtnRecommend",null,function(){alert("{{enh_rare_check}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_decision","btnCallbackBtnDecision",null,function(){alert("{{enh_rare_check}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_setting","btnCallbackBtnSetting",null,function(){alert("{{enh_auto_select}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"filter_btn","btnCallbackFilterBtn",null,function(){alert("{{com_filter_weapon}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_expitem","btnCallbackBtnExpitem",null,function(){alert("{{enh_use_expitem}}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc=t.pc||{},t.pc.enh_evo=t.pc.enh_evo||{},t.pc.enh_evo.enh_007=t.pc.enh_evo.enh_007||{},t.pc.enh_evo.enh_007.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../enh_evo_popup_ui.json"],_popups:{},_controller:null,_createDisplayFilterSettings:function(){return{list_node:[t.displayFilter.enums.FILTER_NAME.ENH_MATERIAL_WEAPON,"com_filter_weapon"]}},onSceneInit:function(e){this._verifyRouterParamsENH007(e),this._setWeaponHeaderLabel(),this._setWeaponBasePanel(e,e.routerParams.enh_007.id),this._createDisplayFilterController(e),this._initializeDisplayFilterController("list_node"),this._setBackBtn(e);var n=t.core.pager.helper.coreCardListUI(e,{baseName:"window_gray",cardType:"weapon",cardFrame:"full",apiName:"apiAWeapons",apiMethod:"getEnhanceMaterials",apiParams:[e.routerParams.enh_007.id,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE],apiModel:t.core.model.AWeapon,sortKey:"enhance_weapon_materials",maxSelectCount:20});return n.addUpdateEventListener(function(e,n,i,a){t.pc.roles.UIUtility._setEnableButton(this,a.getSelectedData().length>0)},e.seekWidgetByName("btn_decision")),n.addUpdateEventListener(function(e,n,i,a){var o=this.baseCoreCardNode.getUserData();o instanceof t.CoreCardUI&&o.setTotalLabel(o.getTotalLabel(this.self._weapon,i))},{self:this,baseCoreCardNode:e.seekWidgetByName("status_window").seekWidgetByName("corecard_weapon_ui")}),this._controller=n,n.initialize().then(this._setNothingBtnEvent.bind(this,e))},onSceneEnter:function(e){var n=(a.defer(),e.routerParams.enh_007.id);return this._baseWeaponPromise=t.createInstance("apiAWeapons").get(n).then(function(e){return new t.core.model.AWeapon(e.body)}),a.resolve()},onSceneExit:function(e){return a.defer(),this._displayFilterClean(),this._controller&&(this._controller.dispose(),this._controller=null),a.resolve()},btnCallbackBtnBaseChange:function(e){var t=a.defer();return t.reject(this._override),this._navigateENH007ToENH001(),t.promise},btnCallbackBtnExpitem:function(e){return this._baseWeaponPromise?(this._baseWeaponPromise.then(this._expitemPromise).then(this._startEnhanceByExpSphereProcess.bind(this)).then(function(e){return a.all([e,t.createInstance("apiAWeapons").enhanceByExpitem(e.baseModel.getAId(),e.useAmount)])}.bind(this)).spread(function(t,n){this._navigateENH007ToENH014(e,n.body,[{item_id:t.aEnhanceExpitemModel.getItemId()}])}.bind(this)),a.reject(this._override)):a.reject(this._override)},_startEnhanceByExpSphereProcess:function(e){if(i.isUndefined(e))return a.reject();var o=n.director.getRunningScene(),r=t.ImplantedPopup.createOrGet(o,"enh_use_expitem"),s=t.ImplantedPopup.createOrGet(o,"enh_use_expitem_confirm");return r.open(e).then(s.open.bind(s)).fail(this._startEnhanceByExpSphereProcess.bind(this))},_expitemPromise:function(e){return a.all([t.createInstance("apiAWeapons").getExpitem(e.getAId()),t.createInstance("apiWeapons").getExperiencePointList()]).spread(function(n,i){var a=n.body,o=new t.enh_evo.model.EnhanceExpitem(a),r=new t.enh_evo.model.ExperiencePoint(i.body);return{baseModel:e,aEnhanceExpitemModel:o,experiencePointModel:r,useAmount:o.getUsableAmount()}})},btnCallbackBtnRecommend:function(e){var t=a.defer();return t.reject(this._override),this._selectRecommendMaterals("apiAWeapons",e.routerParams.enh_007.id),t.promise},btnCallbackBtnDecision:function(e){var t=a.defer();return t.reject(this._override),this._confirmEnhance(this._controller.getSelectedData().map(function(e){return e.getAId()})),t.promise},btnCallbackBtnSetting:function(e){var t=a.defer();return t.reject(this._override),this._showRecommendSettingPopup(),t.promise},_touchHeaderCoreCard:function(e){this._navigateENH007ToENH003(e)},_confirmEnhance:function(e,t){var i=n.director.getRunningScene();this._showRareCheckPopup("apiAWeapons",i.routerParams.enh_007.id,e).then(function(t){this._executeEnhance(i,e,t)}.bind(this))},_executeEnhance:function(e,n,i){t.createInstance("router").removeCurrentTemporaryParamsFromHistory();var a=e.routerParams.enh_007.id;t.createInstance("apiAWeapons").enhance(a,n).then(function(t){this._navigateENH007ToENH014(e,t.body,i)}.bind(this)).fail(function(e){console.error(e.stack)})},_touchEndedBackBtnProcess:function(e){this._navigateToEnh001()}}),t.assignRoles(t.pc.enh_evo.enh_007.SceneDelegate,[t.pc.roles.UIUtility,t.pc.enh_evo.roles.Routing,t.pc.enh_evo.roles.EnhEvoCommon,t.pc.enh_evo.roles.EnhPopupCommon,t.pc.list.roles.ListWeaponsCommon,t.displayFilter.roles.DisplayFilterSceneController])}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.enh_evo=t.pc.enh_evo||{},t.pc.enh_evo.enh_008=t.pc.enh_evo.enh_008||{},t.pc.enh_evo.enh_008.Scene=t.BaseScene.extend({resourceFileName:"enh_008/enh_008",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"enh_evo",sceneName:"enh_008",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_base_change","btnCallbackBtnBaseChange",null,function(){alert("{{enh_001_2_6_evo_001_2_3enh_002}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_recommend","btnCallbackBtnRecommend",null,function(){alert("{{enh_rare_check}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_decision","btnCallbackBtnDecision",null,function(){alert("{{enh_rare_check}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_setting","btnCallbackBtnSetting",null,function(){alert("{{enh_auto_select}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"filter_btn","btnCallbackFilterBtn",null,function(){alert("{{com_filter_chara}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_expitem","btnCallbackBtnExpitem",null,function(){alert("{{enh_use_expitem}}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_item_enh","btnCallbackBtnItemEnh",null,function(){alert("{{enh_use_items}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_present","btnCallbackBtnPresent",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"present/prs_001_2_3")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_gacha","btnCallbackBtnGacha",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"gacha/ga_004")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_quest","btnCallbackBtnQuest",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"quest/q_001")),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc=t.pc||{},t.pc.enh_evo=t.pc.enh_evo||{},t.pc.enh_evo.enh_008=t.pc.enh_evo.enh_008||{},t.pc.enh_evo.enh_008.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../enh_evo_popup_ui.json"],_popups:{},_createDisplayFilterSettings:function(){return{list_node:[t.displayFilter.enums.FILTER_NAME.ENH_MATERIAL_CHARA,"com_filter_weapon"]}},_controller:null,_baseCharacterPromise:null,onSceneInit:function(e){this._verifyRouterParamsENH008(e),this._setCharacterHeaderLabel(),this._baseCharacterPromise.then(function(t){this._setCharacterBasePanelOrg(e,t.getRawData(),!0)}.bind(this)),this._setBackBtn(e),this._createDisplayFilterController(e),this._initializeDisplayFilterController("list_node");var n=t.core.pager.helper.coreCardListUI(e,{baseName:"window_gray",cardType:"weapon",cardFrame:"full",apiName:"apiACharacters",apiMethod:"getEnhanceMaterials",apiParams:[e.routerParams.enh_008.id,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE],apiModel:t.core.model.AWeapon,sortKey:"enhance_character_materials",maxSelectCount:20});return n.addUpdateEventListener(function(e,n,i,a){t.pc.roles.UIUtility._setEnableButton(this,a.getSelectedData().length>0)},e.seekWidgetByName("btn_decision")),this._controller=n,n.initialize()},onSceneEnter:function(e){var n=e.routerParams.enh_008.id;return this._baseCharacterPromise=t.createInstance("apiACharacters").get(n).then(function(e){return new t.core.model.ACharacter(e.body)}),a.resolve()},onSceneExit:function(e){return a.defer(),this._displayFilterClean(),this._controller&&(this._controller.dispose(),this._controller=null),a.resolve()},btnCallbackBtnBaseChange:function(e){var t=a.defer();return t.reject(this._override),this._navigateENH008ToENH002(),t.promise},btnCallbackBtnRecommend:function(e){var t=a.defer();return t.reject(this._override),this._selectRecommendMaterals("apiACharacters",e.routerParams.enh_008.id),t.promise},btnCallbackBtnDecision:function(e){var t=a.defer();return t.reject(this._override),this._confirmEnhance(this._controller.getSelectedData().map(function(e){return e.getAId()})),t.promise},btnCallbackBtnSetting:function(e){var t=a.defer();return t.reject(this._override),this._showRecommendSettingPopup(),t.promise},btnCallbackBtnItemEnh:function(e){if(this._baseCharacterPromise){var n=t.ImplantedPopup.createOrGet(e,"enh_use_items"),i=t.ImplantedPopup.createOrGet(e,"enh_use_items_confirm");return this._baseCharacterPromise.then(n.open.bind(n)).then(i.open.bind(i)).then(function(e){return a.all([e,t.createInstance("apiACharacters").enhanceByItem(e.aCharacterModel.getAId(),e.enhanceItem.getItemId(),e.num)])}.bind(this)).spread(function(t,n){this._navigateENH008ToENH013(e,t.aCharacterModel.getAId(),n.body,[{item_id:t.enhanceItem.getItemId()}])}.bind(this)).fail(function(e){if(e instanceof Error)throw e}),a.reject(this._override)}},btnCallbackBtnExpitem:function(e){return this._baseCharacterPromise?(this._baseCharacterPromise.then(this._expitemPromise).then(this._startEnhanceByExpSphereProcess.bind(this)).then(function(e){return a.all([e,t.createInstance("apiACharacters").enhanceByExpitem(e.baseModel.getAId(),e.useAmount)])}.bind(this)).spread(function(t,n){this._navigateENH008ToENH013(e,t.baseModel.getAId(),n.body,[{item_id:t.aEnhanceExpitemModel.getItemId()}])}.bind(this)),a.reject(this._override)):a.reject(this._override)},_startEnhanceByExpSphereProcess:function(e){if(i.isUndefined(e))return a.reject();var o=n.director.getRunningScene(),r=t.ImplantedPopup.createOrGet(o,"enh_use_expitem"),s=t.ImplantedPopup.createOrGet(o,"enh_use_expitem_confirm");return r.open(e).then(s.open.bind(s)).fail(this._startEnhanceByExpSphereProcess.bind(this))},_expitemPromise:function(e){return a.all([t.createInstance("apiACharacters").getExpitem(e.getAId()),t.createInstance("apiCharacters").getExperiencePointList()]).spread(function(n,i){var a=n.body,o=new t.enh_evo.model.EnhanceExpitem(a),r=new t.enh_evo.model.ExperiencePoint(i.body);return{baseModel:e,aEnhanceExpitemModel:o,experiencePointModel:r,useAmount:o.getUsableAmount()}})},_touchHeaderCoreCard:function(e){this._navigateENH008ToENH005(e)},_confirmEnhance:function(e,t){var i=n.director.getRunningScene();this._showRareCheckPopup("apiACharacters",i.routerParams.enh_008.id,e).then(function(t){this._executeEnhance(i,e,t)}.bind(this))},_executeEnhance:function(e,n,i){t.createInstance("router").removeCurrentTemporaryParamsFromHistory();var a=e.routerParams.enh_008.id;t.createInstance("apiACharacters").enhance(a,n).then(function(t){this._navigateENH008ToENH013(e,a,t.body,i)}.bind(this)).fail(function(e){console.error(e)})},_touchEndedBackBtnProcess:function(e){this._navigateToEnh002()}}),t.assignRoles(t.pc.enh_evo.enh_008.SceneDelegate,[t.pc.roles.UIUtility,t.pc.enh_evo.roles.Routing,t.pc.enh_evo.roles.EnhEvoCommon,t.pc.enh_evo.roles.EnhPopupCommon,t.pc.list.roles.ListCharactersCommon,t.displayFilter.roles.DisplayFilterSceneController])}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.enh_evo=t.pc.enh_evo||{},t.pc.enh_evo.enh_009=t.pc.enh_evo.enh_009||{},t.pc.enh_evo.enh_009.Scene=t.BaseScene.extend({resourceFileName:"enh_009/enh_009",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"enh_evo",sceneName:"enh_009",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_base_change","btnCallbackBtnBaseChange",null,function(){alert("{{enh_001_2_6_evo_001_2_3enh_006}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_recommend","btnCallbackBtnRecommend",null,function(){alert("{{enh_rare_check}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_decision","btnCallbackBtnDecision",null,function(){alert("{{enh_rare_check}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_setting","btnCallbackBtnSetting",null,function(){alert("{{enh_auto_select}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"filter_btn","btnCallbackFilterBtn",null,function(){alert("{{com_filter_other}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_expitem","btnCallbackBtnExpitem",null,function(){alert("{{enh_use_expitem}}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc=t.pc||{},t.pc.enh_evo=t.pc.enh_evo||{},t.pc.enh_evo.enh_009=t.pc.enh_evo.enh_009||{},t.pc.enh_evo.enh_009.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../enh_evo_popup_ui.json"],_popups:{},_controller:null,_baseSummonPromise:null,_createDisplayFilterSettings:function(){return{list_node:[t.displayFilter.enums.FILTER_NAME.ENH_MATERIAL_SUMMON,"com_filter_other"]}},onSceneInit:function(e){this._verifyRouterParamsENH009(e),this._setSummonHeaderLabel(),this._setSummonBasePanel(e,e.routerParams.enh_009.id),this._setBackBtn(e),this._createDisplayFilterController(e),this._initializeDisplayFilterController("list_node");var n=t.core.pager.helper.coreCardListUI(e,{baseName:"window_gray",cardType:"summon",cardFrame:"full",apiName:"apiASummons",apiMethod:"getEnhanceMaterials",apiParams:[e.routerParams.enh_009.id,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE],apiModel:t.core.model.ASummon,sortKey:"enhance_summon_materials",maxSelectCount:20});return n.addUpdateEventListener(function(e,n,i,a){t.pc.roles.UIUtility._setEnableButton(this,a.getSelectedData().length>0)},e.seekWidgetByName("btn_decision")),this._controller=n,n.initialize().then(this._setNothingBtnEvent.bind(this,e))},onSceneEnter:function(e){var n=(a.defer(),e.routerParams.enh_009.id);return this._baseSummonPromise=t.createInstance("apiASummons").get(n).then(function(e){return new t.core.model.ASummon(e.body)}),a.resolve()},onSceneExit:function(e){return a.defer(),this._displayFilterClean(),this._controller&&(this._controller.dispose(),this._controller=null),a.resolve()},btnCallbackBtnBaseChange:function(e){var t=a.defer();return t.reject(this._override),this._navigateENH009ToENH006(),t.promise},btnCallbackBtnRecommend:function(e){var t=a.defer();return t.reject(this._override),this._selectRecommendMaterals("apiASummons",e.routerParams.enh_009.id),t.promise},btnCallbackBtnDecision:function(e){var t=a.defer();return t.reject(this._override),this._confirmEnhance(this._controller.getSelectedData().map(function(e){return e.getAId()})),t.promise},btnCallbackBtnSetting:function(e){var t=a.defer();return t.reject(this._override),this._showRecommendSettingPopup(),t.promise},btnCallbackBtnExpitem:function(e){return this._baseSummonPromise?(this._baseSummonPromise.then(this._expitemPromise).then(this._startEnhanceByExpSphereProcess.bind(this)).then(function(e){return a.all([e,t.createInstance("apiASummons").enhanceByExpitem(e.baseModel.getAId(),e.useAmount)])}.bind(this)).spread(function(t,n){this._navigateENH009ToENH015(e,n.body,[{item_id:t.aEnhanceExpitemModel.getItemId()}])}.bind(this)),a.reject(this._override)):a.reject(this._override)},_startEnhanceByExpSphereProcess:function(e){if(i.isUndefined(e))return a.reject();var o=n.director.getRunningScene(),r=t.ImplantedPopup.createOrGet(o,"enh_use_expitem"),s=t.ImplantedPopup.createOrGet(o,"enh_use_expitem_confirm");return r.open(e).then(s.open.bind(s)).fail(this._startEnhanceByExpSphereProcess.bind(this))},_expitemPromise:function(e){return a.all([t.createInstance("apiASummons").getExpitem(e.getAId()),t.createInstance("apiSummons").getExperiencePointList()]).spread(function(n,i){var a=n.body,o=new t.enh_evo.model.EnhanceExpitem(a),r=new t.enh_evo.model.ExperiencePoint(i.body);return{baseModel:e,aEnhanceExpitemModel:o,experiencePointModel:r,useAmount:o.getUsableAmount()}})},_touchHeaderCoreCard:function(e){this._navigateENH009ToENH004(e)},_confirmEnhance:function(e,t){var i=n.director.getRunningScene();this._showRareCheckPopup("apiASummons",i.routerParams.enh_009.id,e).then(function(t){this._executeEnhance(i,e,t)}.bind(this))},_executeEnhance:function(e,n,i){t.createInstance("router").removeCurrentTemporaryParamsFromHistory();var a=e.routerParams.enh_009.id;t.createInstance("apiASummons").enhance(a,n).then(function(t){this._navigateENH009ToENH015(e,t.body,i)}.bind(this)).fail(function(e){console.error(e.stack)})},_touchEndedBackBtnProcess:function(e){this._navigateToEnh006()}}),t.assignRoles(t.pc.enh_evo.enh_009.SceneDelegate,[t.pc.roles.UIUtility,t.pc.enh_evo.roles.Routing,t.pc.enh_evo.roles.EnhEvoCommon,t.pc.enh_evo.roles.EnhPopupCommon,t.pc.list.roles.ListSummonsCommon,t.displayFilter.roles.DisplayFilterSceneController])}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.enh_evo=t.pc.enh_evo||{},t.pc.enh_evo.enh_013=t.pc.enh_evo.enh_013||{},t.pc.enh_evo.enh_013.Scene=t.BaseScene.extend({resourceFileName:"enh_013/enh_013",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"enh_evo",sceneName:"enh_013",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_continue_enh","btnCallbackBtnContinueEnh",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"enh_evo/enh_008")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_base_change","btnCallbackBtnBaseChange",null,function(){alert("{{enh_001_2_6_evo_001_2_3enh_002}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_item_enh","btnCallbackBtnItemEnh",null,function(){alert("{{enh_use_items}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._),i=e.Q;t.pc=t.pc||{},t.pc.enh_evo=t.pc.enh_evo||{},t.pc.enh_evo.enh_013=t.pc.enh_evo.enh_013||{},t.pc.enh_evo.enh_013.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../enh_evo_popup_ui.json"],_popups:{popupAbilityAcquired:{title:"",factoryName:"popupFactoryAbilityAcquired",onPopupOpened:function(e,t){e._setData(t,"character")},buttons:{blueBtn:function(e){var t=e._delegate;this.dismiss().then(t._showPopupGainedAbilityIfExists.bind(t,e))}}},characterAbilityImproved:{factoryName:"popupCharacterAbilityImproved",onPopupOpened:function(e,t){e.setData(t)},buttons:{blueBtn:function(e){var t=e._delegate;this.dismiss().then(t._showPopupAbilityImprovedIfExists.bind(t,e))}}}},onSceneInit:function(e){this._verifyRouterParamsENH013(e);var t=e.routerParams.enh_013.result,a=t.character;n.isUndefined(a)&&console.error("routerParams.enh_013.result.character is empty."),this._setCharacterBasePanelWithoutApi(e,a),this._setResultMessage(e,this._enhanceExpHtmlString(t,"character")),this._setResultStatus(e,this._enhanceGrowthHtmlString(t));var o=e.temporaryRouterParams.enh_013.materials;this._showAnimationMaterials(e,o[0].item_id?"item":"weapon",o);var r=t.result,s="great_success"===r.success_type;return this._setBackBtn(e),this.upgradedAbilities=r.character_ability_upgrades,this.new_abilities_gained=r.new_abilities_gained,this._playEnhAnimations2(e,r,s).then(function(){this._showPopupGainedAbilityIfExists(e)}.bind(this)),this._setCharacterHeaderLabel(),i.resolve()},_showPopupGainedAbilityIfExists:function(e){if(n.isUndefined(this.new_abilities_gained))this._showPopupAbilityImprovedIfExists(e);else if(0!==this.new_abilities_gained.length){var t=this.new_abilities_gained.shift();e.popups.popupAbilityAcquired.open(t)}else this._showPopupAbilityImprovedIfExists(e)},_showPopupAbilityImprovedIfExists:function(e){if(!n.isUndefined(this.upgradedAbilities)&&0!==this.upgradedAbilities.length){var t=this.upgradedAbilities.shift();e.popups.characterAbilityImproved.open(t)}},onSceneEnter:function(e){return i.defer(),i.resolve()},onSceneExit:function(e){return i.defer(),this._abortAnimation(),i.resolve()},btnCallbackBtnContinueEnh:function(e){var t=i.defer();return t.reject(this._override),this._navigateENH013ToEVO010(e),t.promise},btnCallbackBtnBaseChange:function(e){var t=i.defer();return t.reject(this._override),this._navigateENH013ToENH002(e),t.promise},btnCallbackBtnItemEnh:function(e){var n=t.ImplantedPopup.createOrGet(e,"enh_use_items"),a=t.ImplantedPopup.createOrGet(e,"enh_use_items_confirm"),o=e.routerParams.enh_013.result,r=new t.core.model.ACharacter(o.character);return n.open(r).then(a.open.bind(a)).then(function(e){return i.all([e,t.createInstance("apiACharacters").enhanceByItem(e.aCharacterModel.getAId(),e.enhanceItem.getItemId(),e.num)])}.bind(this)).spread(function(t,n){this._navigateENH008ToENH013(e,t.aCharacterModel.getAId(),n.body,[{item_id:t.enhanceItem.getItemId()}])}.bind(this)).fail(function(e){if(e instanceof Error)throw e}),i.reject(this._override)},_touchEndedBackBtnProcess:function(e){this._navigateToEnh002()}}),n.assign(t.pc.enh_evo.enh_013.SceneDelegate.prototype,t.pc.roles.UIUtility,t.pc.enh_evo.roles.Routing,t.pc.enh_evo.roles.EnhEvoCommon,t.env.isIE?t.pc.enh_evo.roles.EnhEvoAnimationIE:t.pc.enh_evo.roles.EnhEvoAnimation,t.pc.enh_evo.roles.EnhStatusCommon,t.pc.list.roles.ListCharactersCommon)}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.enh_evo=t.pc.enh_evo||{},t.pc.enh_evo.enh_014=t.pc.enh_evo.enh_014||{},t.pc.enh_evo.enh_014.Scene=t.BaseScene.extend({resourceFileName:"enh_014/enh_014",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"enh_evo",sceneName:"enh_014",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_continue_enh","btnCallbackBtnContinueEnh",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"enh_evo/enh_007")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_base_change","btnCallbackBtnBaseChange",null,function(){alert("{{enh_001_2_6_evo_001_2_3enh_001}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._),i=e.Q;t.pc=t.pc||{},t.pc.enh_evo=t.pc.enh_evo||{},t.pc.enh_evo.enh_014=t.pc.enh_evo.enh_014||{},t.pc.enh_evo.enh_014.SceneDelegate=t.pc.BaseSceneDelegate.extend({_popups:{},onSceneInit:function(e){this._verifyRouterParamsENH014(e);var t=e.routerParams.enh_014.result,a=t.weapon;n.isUndefined(a)&&console.error("routerParams.enh_014.result.weapon is empty."),this._setWeaponBasePanelWithoutApi(e,a);var o=e.seekWidgetByName("status_window").seekWidgetByName("corecard_weapon_ui").getUserData();o.setTotalLabel(o.getTotalLabel(a,"total_asc")),this._setResultMessage(e,this._enhanceExpHtmlString(t,"weapon")),this._setResultStatus(e,this._enhanceGrowthHtmlString(t));var r=e.temporaryRouterParams.enh_014.materials;this._showAnimationMaterials(e,r[0].item_id?"item":"weapon",r),this._setBackBtn(e);var s=t.result,c="great_success"===s.success_type;return this._initPlayer(),this._playEnhAnimations2(e,s,c,2e3),i.resolve()},onSceneEnter:function(e){return i.defer(),i.resolve()},onSceneExit:function(e){return i.defer(),this._abortAnimation(),i.resolve()},btnCallbackBtnContinueEnh:function(e){var t=i.defer();return t.reject(this._override),this._navigateENH014ToENH007(e),t.promise},btnCallbackBtnBaseChange:function(e){var t=i.defer();return t.reject(this._override),this._navigateENH014ToENH001(e),t.promise},_touchEndedBackBtnProcess:function(e){this._navigateToEnh001()}}),n.assign(t.pc.enh_evo.enh_014.SceneDelegate.prototype,t.pc.roles.UIUtility,t.pc.enh_evo.roles.Routing,t.pc.enh_evo.roles.EnhEvoCommon,t.env.isIE?t.pc.enh_evo.roles.EnhEvoAnimationIE:t.pc.enh_evo.roles.EnhEvoAnimation,t.pc.enh_evo.roles.EnhStatusCommon,t.pc.list.roles.ListWeaponsCommon)}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.enh_evo=t.pc.enh_evo||{},t.pc.enh_evo.enh_015=t.pc.enh_evo.enh_015||{},t.pc.enh_evo.enh_015.Scene=t.BaseScene.extend({resourceFileName:"enh_015/enh_015",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"enh_evo",sceneName:"enh_015",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_continue_enh","btnCallbackBtnContinueEnh",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"enh_evo/enh_009")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_base_change","btnCallbackBtnBaseChange",null,function(){alert("{{enh_001_2_6_evo_001_2_3enh_006}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._),i=e.Q;t.pc=t.pc||{},t.pc.enh_evo=t.pc.enh_evo||{},t.pc.enh_evo.enh_015=t.pc.enh_evo.enh_015||{},t.pc.enh_evo.enh_015.SceneDelegate=t.pc.BaseSceneDelegate.extend({_popups:{},onSceneInit:function(e){this._verifyRouterParamsENH015(e);var t=e.routerParams.enh_015.result,a=t.summon;n.isUndefined(a)&&console.error("routerParams.enh_015.result.summon is empty."),this._setSummonBasePanelWithoutApi(e,a),this._setResultMessage(e,this._enhanceExpHtmlString(t,"summon")),this._setResultStatus(e,this._enhanceGrowthHtmlString(t));var o=e.temporaryRouterParams.enh_015.materials;this._showAnimationMaterials(e,o[0].item_id?"item":"summon",o),this._setBackBtn(e);var r=t.result,s="great_success"===r.success_type;return this._playEnhAnimations2(e,r,s),i.resolve()},onSceneEnter:function(e){return i.defer(),i.resolve()},onSceneExit:function(e){return i.defer(),this._abortAnimation(),i.resolve()},btnCallbackBtnContinueEnh:function(e){var t=i.defer();return t.reject(this._override),this._navigateENH015ToENH009(e),t.promise},btnCallbackBtnBaseChange:function(e){var t=i.defer();return t.reject(this._override),this._navigateENH015ToENH006(e),t.promise},_touchEndedBackBtnProcess:function(e){this._navigateToEnh006()}}),n.assign(t.pc.enh_evo.enh_015.SceneDelegate.prototype,t.pc.roles.UIUtility,t.pc.enh_evo.roles.Routing,t.pc.enh_evo.roles.EnhEvoCommon,t.env.isIE?t.pc.enh_evo.roles.EnhEvoAnimationIE:t.pc.enh_evo.roles.EnhEvoAnimation,t.pc.enh_evo.roles.EnhStatusCommon,t.pc.list.roles.ListSummonsCommon)}((this||0).self||global),function(e){var t=e.kh,n=e._;t.pc=t.pc||{};var i=(e.Q,{evo_item_choose:{factoryName:"popupFactoryPopupCommon",resourceName:function(){var e=n.findKey(res,function(e){return 0<e.indexOf("evo_item_choose")});return e||alert(": evo_item_choose"),e||""}(),title:"",buttonLabels:{blackBtn:"",blueBtn:""},buttons:{blackBtn:function(){this.dismiss()},blueBtn:function(){this.dismiss().then(function(){t.createInstance("router").navigate("enh_evo/evo_008")})}}}});t.pc.enh_evo=t.pc.enh_evo||{},t.pc.enh_evo.evo_007=t.pc.enh_evo.evo_007||{},t.pc.enh_evo.evo_007.Scene=t.BaseScene.extend({resourceFileName:"evo_007/evo_007.json",isLoopDefaultView:!1,_popups:i,tabDelegateConfig:[],componentName:"enh_evo",sceneName:"evo_007",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_base_change","btnCallbackBtnBaseChange",null,function(){alert("{{enh_001_2_6_evo_001_2_3evo_001}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_use_item","btnCallbackBtnUseItem",null,function(){alert("{{evo_item_choose}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"filter_btn","btnCallbackFilterBtn",null,function(){alert("{{com_filter_orher}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._,e.Q);t.pc=t.pc||{},t.pc.enh_evo=t.pc.enh_evo||{},t.pc.enh_evo.evo_007=t.pc.enh_evo.evo_007||{},t.pc.enh_evo.evo_007.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../enh_evo_popup_ui.json"],_popups:{},_createDisplayFilterSettings:function(){return{list_node:[t.displayFilter.enums.FILTER_NAME.EVO_MATERIAL_WEAPON,"com_filter_other"]}},onSceneInit:function(e){this._verifyRouterParamsEVO007(e);var n=e.routerParams.evo_007.id;this._aWeaponId=n,this._setWeaponBasePanel(e,e.routerParams.evo_007.id),this._evolutionItems=t.createInstance("EvolutionItemsModel"),this._evolutionItems.prepare("weapon",n),this._initCtrlButtons(e),this._setBackBtn(e),this._createDisplayFilterController(e),this._initializeDisplayFilterController("list_node");var i=t.core.pager.helper.coreCardListUI(e,{baseName:"window_gray",panelName:t.BtnsPageListParams.ENH_EVO_007.panelName,cardType:"weapon",cardFrame:"full",apiName:"apiAWeapons",apiMethod:"getEvolveMaterials",apiParams:[e.routerParams.evo_007.id,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE],apiModel:t.core.model.AWeapon,sortKey:"evolve_weapon_materials"},new t.core.eventHandling.BaseEventHandler(this._touchListCoreCard,this));return this._controller=i,i.initialize().then(this._setNothingBtnEvent.bind(this,e))},_getAWeaponId:function(){return this._aWeaponId},onSceneEnter:function(e){return n.defer(),n.resolve()},onSceneExit:function(e){return n.defer(),t.createInstance("notificationCenter").removeEventListenersByEventName("useEvolutionItem"),this._displayFilterClean(),this._controller&&(this._controller.dispose(),this._controller=null),n.resolve()},btnCallbackBtnBaseChange:function(e){var t=n.defer();return t.reject(this._override),this._navigateEVO007ToEVO001(),t.promise},btnCallbackBtnUseItem:function(e){return this._showItemChoosePopup(this._evolutionItems),t.createInstance("notificationCenter").addEventListener("useEvolutionItem",function(e){this._showConfirmationPopups("weapon",this._getAWeaponId(),{item_id:e}).then(function(){this._executeEvolutionByItem(e)}.bind(this))}.bind(this)),n.reject(this._override)},_touchHeaderCoreCard:function(e){this._navigateEVO007ToEVO004(e)},_touchListCoreCard:function(e){var t=e.getRawData();this._showConfirmationPopups("weapon",this._getAWeaponId(),t).then(function(){this._executeEvolution(t)}.bind(this))},_executeEvolution:function(e){var t=this._getAWeaponId(),n=e.a_weapon_id;this._evolveByMaterial(t,n).then(function(n){this._navigateEVO007ToEVO009(t,n.body,[e])}.bind(this)).fail(function(e){console.error(e.stack)})},_evolveByMaterial:function(e,n){return t.createInstance("apiAWeapons").evolve(e,n).fail(function(e){console.error(e)})},_executeEvolutionByItem:function(e){var t=this._getAWeaponId();this._evolveByItem(t,e).then(function(n){this._navigateEVO007ToEVO009(t,n.body,[{item_id:e}])}.bind(this)).fail(function(e){console.error(e.stack)})},_evolveByItem:function(e,n){return t.createInstance("apiAWeapons").evolveByItem(e,n).fail(function(e){console.error(e)})},_setAppearanceEvolveButtonsItemView:function(e){this._setAppearanceEvolveButtonsBase(e,"item_view")},_setAppearanceEvolveButtonsNothingView:function(e){this._setAppearanceEvolveButtonsBase(e,"nothing_view")},_setAppearanceEvolveButtonsBase:function(e,t){var n=this._getEvolveButtonsUINode(e);n&&n.setAppearance(t)},_initCtrlButtons:function(e){this._evolutionItems.getUsableEvolutionItemsPromise().then(function(t){0<t.length?this._setAppearanceEvolveButtonsItemView(e):this._setAppearanceEvolveButtonsNothingView(e)}.bind(this))},_getEvolveButtonsUINode:function(e){return e.seekWidgetByName("evo_btn_ui")},_touchEndedBackBtnProcess:function(e){this._navigateToEvo001()}}),t.assignRoles(t.pc.enh_evo.evo_007.SceneDelegate,[t.pc.roles.UIUtility,t.pc.enh_evo.roles.Routing,t.pc.enh_evo.roles.EnhEvoCommon,t.pc.enh_evo.roles.EvoPopupCommon,t.displayFilter.roles.DisplayFilterSceneController])}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.enh_evo=t.pc.enh_evo||{},t.pc.enh_evo.evo_008=t.pc.enh_evo.evo_008||{},t.pc.enh_evo.evo_008.Scene=t.BaseScene.extend({resourceFileName:"evo_008/evo_008",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"enh_evo",sceneName:"evo_008",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_base_change","btnCallbackBtnBaseChange",null,function(){alert("{{enh_001_2_6_evo_001_2_3enh_001}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_evo","btnCallbackBtnEvo",null,function(){alert("{{1evo_mate_checkevo_money_check}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_cancel","btnCallbackBtnCancel",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"enh_evo/evo_007")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_change_item","btnCallbackBtnChangeItem",null,function(){alert("{{}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_change_material","btnCallbackBtnChangeMaterial",null,function(){alert("{{}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._),i=e.Q;t.pc=t.pc||{},t.pc.enh_evo=t.pc.enh_evo||{},t.pc.enh_evo.evo_008=t.pc.enh_evo.evo_008||{},t.pc.enh_evo.evo_008.LIST_TYPE={MATERIALS:"materials",ITEMS:"items"},t.pc.enh_evo.evo_008.SceneDelegate=t.pc.BaseSceneDelegate.extend({_popups:{},onSceneInit:function(e){this._verifyRouterParamsEVO008(e),this._type="weapon",this._listType=t.pc.enh_evo.evo_013.LIST_TYPE.MATERIALS;var n=this._aWeaponId=e.routerParams.evo_008.id;return this._evolutionItems=t.createInstance("EvolutionItemsModel"),this._evolutionItems.prepare("weapon",n),this._initCtrlButtons(e,n),this._setWeaponBasePanel(e,n).then(function(){this._setWeaponFinalEvolveMaterials(e,n)}.bind(this)),this._setShortageLabels(e),this._setWeaponHeaderLabel(),e.seekWidgetByName("btn_cancel").setSound(t.SoundList.BUTTON_TOUCHED_CANCEL),this._setBackBtn(e),t.createInstance("notificationCenter").addEventListener("useEvolutionItem",function(t){this._selectedEvolutionItemId=t,this._updateListBySelectedItemId(e,t),this._showMoneyCheckPopup()}.bind(this)),i.resolve()},_getSelectedItemId:function(){return this._selectedEvolutionItemId},_initCtrlButtons:function(e){var t=khutil.getWidgetFromNode(e,"btn_change_material",function(e){console.warn("evo_008: "+e)}.bind(this));e.seekWidgetByName("btn_change_material");var n=khutil.getWidgetFromNode(e,"btn_change_item",function(e){console.warn("evo_008: "+e)}.bind(this));n.setVisible(this._listTypeIsMaterials()),t.setVisible(this._listTypeIsItems()),i.all([this._evolutionItems.getUsableEvolutionItemsPromise(),this._getEvolvablePromise()]).spread(function(e,t){var i=0<e.length;this._setEnableButton(n,t&&i)}.bind(this))},_getEvolvablePromise:function(){return t.createInstance("apiAWeapons").getEnhanceEvolveInfo(this._getAWeaponId()).then(function(e){var t=e.body;return!0!==t.arousable?t.evolvable:n.reduce(t.arouse_condition,function(e,t){return e&&t},!0)})},onSceneEnter:function(e){return i.defer(),i.resolve()},onSceneExit:function(e){return i.defer(),t.createInstance("notificationCenter").removeEventListenersByEventName("useEvolutionItem"),i.resolve()},btnCallbackBtnBaseChange:function(e){var t=i.defer();return t.reject(this._override),this._navigateEVO008ToEVO001(),t.promise},btnCallbackBtnEvo:function(e){var t=i.defer();return t.reject(this._override),this._routerParamsKey="evo_008",this._showMoneyCheckPopup(),t.promise},btnCallbackBtnCancel:function(e){var t=i.defer();return t.reject(this._override),this._navigateEVO008ToEVO007(),t.promise},_touchHeaderCoreCard:function(e){this._navigateEVO008ToEVO004(e)},_executeEvolution:function(e){var t=this._aWeaponId;if(n.isUndefined(this._getSelectedItemId()))this._evolveByMaterial(t,null).then(function(t){console.log(t);var n=this._confirmEvo.result.items;this._navigateEVO008ToEVO009(e,t.body,n)}.bind(this)).fail(function(e){console.error(e.stack)});else{var i=this._getSelectedItemId();this._evolveByItem(t,i).then(function(t){console.log(t),this._navigateEVO008ToEVO009(e,t.body,[{item_id:i}])}.bind(this)).fail(function(e){console.error(e.stack)})}},_evolveByMaterial:function(e,n){return t.createInstance("apiAWeapons").evolve(e,n).fail(function(e){console.error(e)})},_evolveByItem:function(e,n){return t.createInstance("apiAWeapons").evolveByItem(e,n).fail(function(e){console.error(e)})},_getAWeaponId:function(){return this._aWeaponId},btnCallbackBtnChangeItem:function(e){return i.defer(),this._showItemChoosePopup(this._evolutionItems),i.reject(this._override)},btnCallbackBtnChangeMaterial:function(e){var t=i.defer();return t.reject(this._override),this._selectedEvolutionItemId=null,this._updateListByMaterials(e),t.promise},_updateListByMaterials:function(e){this._clearShortageLabels(e),this._setListTypeMaterials(),this._initCtrlButtons(e),this._setWeaponFinalEvolveMaterials(e,this._getAWeaponId()),this._setShortageLabels(e)},_updateListBySelectedItemId:function(e,t){this._clearShortageLabels(e),this._setListTypeItems(),this._initCtrlButtons(e),this._evolutionItems.getItemsPromise().then(function(i){var a=n.filter(i,function(e){return e.getId()===t});this._setWeaponFinalEvolveMaterials(e,this._getAWeaponId(),a)}.bind(this))},_shortageLabels:{materials:"shortage_material_label",level:"shortage_level_label",skill_level:"shortage_skill_label",gem:"shortage_gem_label"},_clearShortageLabels:function(e){var t=khutil.getWidgetFromNode(e,"shortage_label",function(e){console.warn("evo_008: "+e)}.bind(this));t.setString(""),t.setVisible(!1)},_setShortageLabels:function(e){t.createInstance("apiAWeapons").getEnhanceEvolveInfo(this._getAWeaponId()).then(function(i){var a=khutil.getWidgetFromNode(e,"shortage_label",function(e){console.warn("evo_008: "+e)}.bind(this)),o=[];n.each(i.body.arouse_condition,function(e,i){if(!0!==e){var a=this._shortageLabels[i];n.isUndefined(a)||o.push(t.WordBook.WEAPON_AROUSE_CONDITION_UNSATISFIED_MESSAGE[i])}}.bind(this)),a.setString(o.join("\n")),a.setVisible(!0)}.bind(this))},_touchEvolveMaterial:function(e){this._showNeedMatePopup(e)},_touchEvolveItem:function(e){},_listTypeIsMaterials:function(){return this._listType===t.pc.enh_evo.evo_008.LIST_TYPE.MATERIALS},_listTypeIsItems:function(){return this._listType===t.pc.enh_evo.evo_008.LIST_TYPE.ITEMS},_setListTypeMaterials:function(){this._listType=t.pc.enh_evo.evo_008.LIST_TYPE.MATERIALS},_setListTypeItems:function(){this._listType=t.pc.enh_evo.evo_008.LIST_TYPE.ITEMS},_touchEndedBackBtnProcess:function(e){this._navigateToEvo001()}}),n.assign(t.pc.enh_evo.evo_008.SceneDelegate.prototype,t.pc.roles.UIUtility,t.env.isIE?t.pc.enh_evo.roles.RoutingIE:t.pc.enh_evo.roles.Routing,t.pc.enh_evo.roles.EnhEvoCommon,t.pc.enh_evo.roles.EvoPopupCommon,t.pc.enh_evo.roles.EnhEvoConfirmList,t.pc.list.roles.ListWeaponsCommon)}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.enh_evo=t.pc.enh_evo||{},t.pc.enh_evo.evo_009=t.pc.enh_evo.evo_009||{},t.pc.enh_evo.evo_009.Scene=t.BaseScene.extend({resourceFileName:"evo_009/evo_009",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"enh_evo",sceneName:"evo_009",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_base_change","btnCallbackBtnBaseChange",null,function(){alert("{{enh_001_2_6_evo_001_2_3evo_001}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_continue_evo","btnCallbackBtnContinueEvo",null,function(){alert("{{evo_007}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_continue_enh","btnCallbackBtnContinueEnh",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"enh_evo/enh_007")),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._),i=e.Q;t.pc=t.pc||{},t.pc.enh_evo=t.pc.enh_evo||{},t.pc.enh_evo.evo_009=t.pc.enh_evo.evo_009||{},t.pc.enh_evo.evo_009.SceneDelegate=t.pc.BaseSceneDelegate.extend({_popups:{},onSceneInit:function(e){this._verifyRouterParamsEVO009(e);var t=e.routerParams.evo_009.result,a=t.weapon;return n.isUndefined(a)&&console.error("routerParams.evo_009.result.weapon is empty."),this._setWeaponBasePanelWithoutApi(e,a),!0===e.routerParams.evo_009.arouse?(this._setResultMessage(e,this._arouseResultHtmlString(t)),this._setResultShadowVisible(e,!0)):(this._setResultMessage(e,this._evolveResultHtmlString(t)),this._setResultShadowVisible(e,!1)),e.temporaryRouterParams.evo_009.materials[0].item_id?this._showAnimationMaterials(e,"item",e.temporaryRouterParams.evo_009.materials):this._showAnimationMaterials(e,"weapon",e.temporaryRouterParams.evo_009.materials),this._setBackBtn(e),this._playEvoAnimations(e),i.resolve()},_evolveResultHtmlString:function(e){var t=e.weapon.name,n=e.result;return"<br/><br/><br/>"+(t+"Lv<br/><span class='red'>"+(0==n.is_full_max_level?n.before.max_level+"&rarr;"+n.after.max_level:"MAX")+"</span>")},_arouseResultHtmlString:function(e){var i=e.weapon.name+"<span class='red'></span>",a=e.result,o=[];o.push(this._arouseDetailTableRow("",a,!1,"max_level")),o.push(this._arouseDetailTableRow("",a,!0,"burst","description")),o.push(this._arouseDetailTableRow("",a,!0,"skills","name")),o.push(this._arouseDetailTableRow("",a,!1,"max_weapon_skill_level"));return i=i+"<br/><br/><style>td{ line-height: 110%; vertical-align: top;  font-size: 15px;} td.r{ width: 36%;} td.l{ width: 64%;}</style>"+t.htmlBuilder.makeTable(n.without(o,void 0)),t.env.isSp||(i="<br/>"+i),i},_arouseDetailTableRow:function(e,t,i,a,o){if(n.isNumber(t.after[a])||!n.isEmpty(t.after[a])){var r=i?"<br/>":"";return[["orange",e+""],["white",this._getParamAsString(t.before[a],o,r)+"&nbsp;&rarr;&nbsp;<span class='yellow'>"+r+this._getParamAsString(t.after[a],o,r)+"<span>"]]}},_getParamAsString:function(e,t,i){if(n.isString(e)||n.isNumber(e))return e;if(!n.isArray(e)){var a=""+(n.isUndefined(t)?e:e[t]);return a.replace("/","/"+i).replace("",i+"")}return n.map(e,function(e){return n.isUndefined(t)?e:e[t]}).join(i)},onSceneExit:function(e){return this._abortAnimation(),i.resolve()},btnCallbackBtnContinueEnh:function(e){return this._navigateToENH007(e.routerParams.evo_009.id),i.reject(this._override)},btnCallbackBtnBaseChange:function(e){var t=i.defer();return t.reject(this._override),this._navigateEVO009ToEVO001(e),t.promise},btnCallbackBtnContinueEvo:function(e){var t=i.defer();return t.reject(this._override),this._navigateEVO009ToEVO007(e),t.promise},_touchEndedBackBtnProcess:function(e){this._navigateToEvo001()}}),n.assign(t.pc.enh_evo.evo_009.SceneDelegate.prototype,t.pc.roles.UIUtility,t.pc.enh_evo.roles.Routing,t.pc.enh_evo.roles.EnhEvoCommon,t.env.isIE?t.pc.enh_evo.roles.EnhEvoAnimationIE:t.pc.enh_evo.roles.EnhEvoAnimation,t.pc.list.roles.ListWeaponsCommon)}((this||0).self||global),function(e){var t=e.kh,n=e._;t.pc=t.pc||{};var i=(e.Q,{evo_item_choose:{factoryName:"popupFactoryPopupCommon",resourceName:function(){var e=n.findKey(res,function(e){return 0<e.indexOf("evo_item_choose")});return e||alert(": evo_item_choose"),e||""}(),title:"",buttonLabels:{blackBtn:"",blueBtn:""},buttons:{blackBtn:function(){this.dismiss()},blueBtn:function(){this.dismiss().then(function(){t.createInstance("router").navigate("enh_evo/evo_011")})}}}});t.pc.enh_evo=t.pc.enh_evo||{},t.pc.enh_evo.evo_010=t.pc.enh_evo.evo_010||{},t.pc.enh_evo.evo_010.Scene=t.BaseScene.extend({resourceFileName:"evo_010/evo_010.json",isLoopDefaultView:!1,_popups:i,tabDelegateConfig:[],componentName:"enh_evo",sceneName:"evo_010",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_base_change","btnCallbackBtnBaseChange",null,function(){alert("{{enh_001_2_6_evo_001_2_3evo_003}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_use_item","btnCallbackBtnUseItem",null,function(){alert("{{evo_item_choose}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"filter_btn","btnCallbackFilterBtn",null,function(){alert("{{com_filter_other}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._,e.Q);t.pc=t.pc||{},t.pc.enh_evo=t.pc.enh_evo||{},t.pc.enh_evo.evo_010=t.pc.enh_evo.evo_010||{},t.pc.enh_evo.evo_010.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../enh_evo_popup_ui.json"],_popups:{},_createDisplayFilterSettings:function(){return{list_node:[t.displayFilter.enums.FILTER_NAME.EVO_MATERIAL_SUMMON,"com_filter_other"]}},onSceneInit:function(e){this._verifyRouterParamsEVO010(e);var n=e.routerParams.evo_010.id;this._aSummonId=n,this._setSummonBasePanel(e,e.routerParams.evo_010.id),this._evolutionItems=t.createInstance("EvolutionItemsModel"),this._evolutionItems.prepare("summon",n),this._initCtrlButtons(e),this._setBackBtn(e),this._createDisplayFilterController(e),this._initializeDisplayFilterController("list_node");var i=t.core.pager.helper.coreCardListUI(e,{baseName:"window_gray",panelName:t.BtnsPageListParams.ENH_EVO_010.panelName,cardType:"summon",cardFrame:"full",apiName:"apiASummons",apiMethod:"getEvolveMaterials",apiParams:[e.routerParams.evo_010.id,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE],apiModel:t.core.model.ASummon,sortKey:"evolve_summon_materials"},new t.core.eventHandling.BaseEventHandler(this._touchListCoreCard,this));return this._controller=i,i.initialize().then(this._setNothingBtnEvent.bind(this,e))},_getASummonId:function(){return this._aSummonId},onSceneEnter:function(e){return n.defer(),n.resolve()},onSceneExit:function(e){return n.defer(),t.createInstance("notificationCenter").removeEventListenersByEventName("useEvolutionItem"),this._displayFilterClean(),this._controller&&(this._controller.dispose(),this._controller=null),n.resolve()},btnCallbackBtnBaseChange:function(e){var t=n.defer();return t.reject(this._override),this._navigateEVO010ToEVO003(),t.promise},btnCallbackBtnUseItem:function(e){return this._showItemChoosePopup(this._evolutionItems),t.createInstance("notificationCenter").addEventListener("useEvolutionItem",function(e){this._showConfirmationPopups("summon",this._getASummonId(),{item_id:e}).then(function(){this._executeEvolutionByItem(e)}.bind(this))}.bind(this)),n.reject(this._override)},_touchHeaderCoreCard:function(e){this._navigateEVO010ToEVO005(e)},_touchListCoreCard:function(e){var t=e.getRawData();this._showConfirmationPopups("summon",this._getASummonId(),t).then(function(){this._executeEvolution(t)}.bind(this))},_executeEvolution:function(e){var t=this._getASummonId(),n=e.a_summon_id;this._evolveByMaterial(t,n).then(function(n){this._navigateEVO010ToEVO012(t,n.body,[e])}.bind(this)).fail(function(e){console.error(e.stack)})},_evolveByMaterial:function(e,n){return t.createInstance("apiASummons").evolve(e,n).fail(function(e){console.error(e)})},_executeEvolutionByItem:function(e){var t=this._getASummonId();this._evolveByItem(t,e).then(function(n){this._navigateEVO010ToEVO012(t,n.body,[{item_id:e}])}.bind(this)).fail(function(e){console.error(e.stack)})},_evolveByItem:function(e,n){return t.createInstance("apiASummons").evolveByItem(e,n).fail(function(e){console.error(e)})},_setAppearanceEvolveButtonsItemView:function(e){this._setAppearanceEvolveButtonsBase(e,"item_view")},_setAppearanceEvolveButtonsNothingView:function(e){this._setAppearanceEvolveButtonsBase(e,"nothing_view")},_setAppearanceEvolveButtonsBase:function(e,t){var n=this._getEvolveButtonsUINode(e);n&&n.setAppearance(t)},_initCtrlButtons:function(e){this._evolutionItems.getUsableEvolutionItemsPromise().then(function(t){0<t.length?this._setAppearanceEvolveButtonsItemView(e):this._setAppearanceEvolveButtonsNothingView(e)}.bind(this))},_getEvolveButtonsUINode:function(e){return e.seekWidgetByName("evo_btn_ui")},_touchEndedBackBtnProcess:function(e){this._navigateToEvo003()}}),t.assignRoles(t.pc.enh_evo.evo_010.SceneDelegate,[t.pc.roles.UIUtility,t.pc.enh_evo.roles.Routing,t.pc.enh_evo.roles.EnhEvoCommon,t.pc.enh_evo.roles.EvoPopupCommon,t.displayFilter.roles.DisplayFilterSceneController])}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.enh_evo=t.pc.enh_evo||{},t.pc.enh_evo.evo_012=t.pc.enh_evo.evo_012||{},t.pc.enh_evo.evo_012.Scene=t.BaseScene.extend({resourceFileName:"evo_012/evo_012",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"enh_evo",sceneName:"evo_012",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_base_change","btnCallbackBtnBaseChange",null,function(){alert("{{enh_001_2_6_evo_001_2_3evo_003}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_continue_evo","btnCallbackBtnContinueEvo",null,function(){alert("{{evo_010}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_continue_enh","btnCallbackBtnContinueEnh",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"enh_evo/enh_009")),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._),i=e.Q;t.pc=t.pc||{},t.pc.enh_evo=t.pc.enh_evo||{},t.pc.enh_evo.evo_012=t.pc.enh_evo.evo_012||{},t.pc.enh_evo.evo_012.SceneDelegate=t.pc.BaseSceneDelegate.extend({_popups:{},onSceneInit:function(e){this._verifyRouterParamsEVO012(e);var t=e.routerParams.evo_012.result,a=t.summon;return n.isUndefined(a)&&console.error("routerParams.evo_012.result.summon is empty."),this._setSummonBasePanelWithoutApi(e,a),this._setResultMessage(e,this._evolveResultHtmlString(t)),e.temporaryRouterParams.evo_012.materials[0].item_id?this._showAnimationMaterials(e,"item",e.temporaryRouterParams.evo_012.materials):this._showAnimationMaterials(e,"summon",e.temporaryRouterParams.evo_012.materials),this._setBackBtn(e),this._playEvoAnimations(e),i.resolve()},_evolveResultHtmlString:function(e){var t=e.summon.name,n=e.result;return"<br/><br/><br/>"+(t+"Lv<br/><span class='red'>"+(0==n.is_full_max_level?n.before.max_level+"&rarr;"+n.after.max_level:"MAX")+"</span>")},onSceneExit:function(e){return this._abortAnimation(),i.resolve()},btnCallbackBtnContinueEnh:function(e){return this._navigateToENH009(e.routerParams.evo_012.id),i.reject(this._override)},btnCallbackBtnBaseChange:function(e){var t=i.defer();return t.reject(this._override),this._navigateEVO012ToEVO003(e),t.promise},btnCallbackBtnContinueEvo:function(e){var t=i.defer();return t.reject(this._override),this._navigateEVO012ToEVO010(e),t.promise},_touchEndedBackBtnProcess:function(e){this._navigateToEvo003()}}),n.assign(t.pc.enh_evo.evo_012.SceneDelegate.prototype,t.pc.roles.UIUtility,t.pc.enh_evo.roles.Routing,t.pc.enh_evo.roles.EnhEvoCommon,t.env.isIE?t.pc.enh_evo.roles.EnhEvoAnimationIE:t.pc.enh_evo.roles.EnhEvoAnimation,t.pc.list.roles.ListSummonsCommon)}((this||0).self||global),function(e){var t=e.kh,n=e._;t.pc=t.pc||{};var i=(e.Q,{evo_item_choose:{factoryName:"popupFactoryPopupCommon",resourceName:function(){var e=n.findKey(res,function(e){return 0<e.indexOf("evo_item_choose")});return e||alert(": evo_item_choose"),e||""}(),title:"",buttonLabels:{blackBtn:"",blueBtn:""},buttons:{blackBtn:function(){this.dismiss()},blueBtn:function(){this.dismiss().then(function(){t.createInstance("router").navigate("enh_evo/evo_015")})}}},evo_money_check:{factoryName:"popupFactoryPopupCommon",resourceName:function(){var e=n.findKey(res,function(e){return 0<e.indexOf("evo_money_check")});return e||alert(": evo_money_check"),e||""}(),title:"",buttonLabels:{blackBtn:"",blueBtn:"OK"},buttons:{blackBtn:function(){this.dismiss()},blueBtn:function(){this.dismiss().then(function(){t.createInstance("router").navigate("enh_evo/evo_014")})}}}});t.pc.enh_evo=t.pc.enh_evo||{},t.pc.enh_evo.evo_013=t.pc.enh_evo.evo_013||{},t.pc.enh_evo.evo_013.Scene=t.BaseScene.extend({resourceFileName:"evo_013/evo_013.json",isLoopDefaultView:!1,_popups:i,tabDelegateConfig:[],componentName:"enh_evo",sceneName:"evo_013",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_use_item","btnCallbackBtnUseItem",null,function(){alert("{{evo_item_choose}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_evo","btnCallbackBtnEvo",null,function(e){this.popups.evo_money_check.open(e)}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_use_material","btnCallbackBtnUseMaterial",null,function(){alert("{{}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_base_change","btnCallbackBtnBaseChange",null,function(){alert("{{enh_001_2_6_evo_001_2_3evo_002}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._),i=e.Q;t.pc=t.pc||{},t.pc.enh_evo=t.pc.enh_evo||{},t.pc.enh_evo.evo_013=t.pc.enh_evo.evo_013||{},t.pc.enh_evo.evo_013.LIST_TYPE={MATERIALS:"materials",ITEMS:"items"},t.pc.enh_evo.evo_013.SceneDelegate=t.pc.BaseSceneDelegate.extend({_popups:{},_listType:null,onSceneInit:function(e){var n=e.routerParams.evo_013.id;return this._aCharacterId=n,this._verifyRouterParamsEVO013(e),this._setCharacterBasePanel(e,n),this._setCharacterEvolveMaterials(e,n),this._listType=t.pc.enh_evo.evo_013.LIST_TYPE.MATERIALS,this._evolutionItems=t.createInstance("EvolutionItemsModel"),this._evolutionItems.prepare("character",n),this._initCtrlButtons(e,n),this._setCharacterHeaderLabel(),this._setBackBtn(e),t.createInstance("notificationCenter").addEventListener("useEvolutionItem",function(t){this._selectedEvolutionItemId=t,this._updateListBySelectedItemId(e,t),this._evolutionItems.getRawResultPromise().then(function(e){this._confirmEvo.result.items=e.items,this._showMoneyCheckPopup()}.bind(this))}.bind(this)),i.resolve()},_getACharacterId:function(){return this._aCharacterId},onSceneEnter:function(e){return i.defer(),i.resolve()},onSceneExit:function(e){return i.defer(),t.createInstance("notificationCenter").removeEventListenersByEventName("useEvolutionItem"),i.resolve()},btnCallbackBtnUseItem:function(e){return i.defer(),this._showItemChoosePopup(this._evolutionItems),i.reject(this._override)},btnCallbackBtnEvo:function(e){var t=i.defer();return t.reject(this._override),this._routerParamsKey="evo_013",this._selectedEvolutionItemId?this._evolutionItems.getRawResultPromise().then(function(e){this._confirmEvo.result.items=e.items,this._showMoneyCheckPopup()}.bind(this)):this._showMoneyCheckPopup(),t.promise},btnCallbackBtnUseMaterial:function(e){var t=i.defer();return t.reject(this._override),this._selectedEvolutionItemId=null,this._updateListByMaterials(e),t.promise},_updateListByMaterials:function(e){this._setListTypeMaterials(),this._updateAppearanceEvolveButtons(e),this._setCharacterEvolveMaterials(e,this._getACharacterId())},_updateListBySelectedItemId:function(e,t){this._setListTypeItems(),this._updateAppearanceEvolveButtons(e),this._evolutionItems.getItemsPromise().then(function(i){var a=n.filter(i,function(e){return e.getId()===t});this._setCharacterEvolveMaterials(e,this._getACharacterId(),a)}.bind(this))},btnCallbackBtnBaseChange:function(e){var t=i.defer();return t.reject(this._override),this._navigateEVO013ToEVO002(e),t.promise},_touchHeaderCoreCard:function(e){this._navigateEVO013ToEVO006(e)},_executeEvolution:function(e){var t=this._getACharacterId();this._selectedEvolutionItemId?this._evolveByItem(t,this._selectedEvolutionItemId).then(function(t){console.log(t),this._navigateEVO013ToEVO014(e,t.body,[{item_id:this._selectedEvolutionItemId}]),this._selectedEvolutionItemId=null}.bind(this)):this._evolve(t).then(function(t){console.log(t),this._navigateEVO013ToEVO014(e,t.body,this._confirmEvo.result.items)}.bind(this)).fail(function(e){console.error(e.stack)})},_evolve:function(e){return this._consoleErrorIfFailed(t.createInstance("apiACharacters").evolve(e))},_evolveByItem:function(e,n){return this._consoleErrorIfFailed(t.createInstance("apiACharacters").evolveByItem(e,this._selectedEvolutionItemId))},_consoleErrorIfFailed:function(e){return e.fail(function(e){return console.error(e),i.reject(e)})},_touchEvolveMaterial:function(e){this._showNeedMatePopup(e)},_touchEvolveItem:function(e){},_updateAppearanceEvolveButtons:function(e){this._listTypeIsMaterials()?this._setAppearanceEvolveButtonsItemEvoView(e):this._listTypeIsItems()?this._setAppearanceEvolveButtonsMaterialEvoView(e):console.warn("")},_listTypeIsMaterials:function(){return this._listType===t.pc.enh_evo.evo_013.LIST_TYPE.MATERIALS},_listTypeIsItems:function(){return this._listType===t.pc.enh_evo.evo_013.LIST_TYPE.ITEMS},_setListTypeMaterials:function(){this._listType=t.pc.enh_evo.evo_013.LIST_TYPE.MATERIALS},_setListTypeItems:function(){this._listType=t.pc.enh_evo.evo_013.LIST_TYPE.ITEMS},_setAppearanceEvolveButtonsItemEvoView:function(e){this._setAppearanceEvolveButtonsBase(e,"item_evo_view")},_setAppearanceEvolveButtonsMaterialEvoView:function(e){this._setAppearanceEvolveButtonsBase(e,"material_evo_view")},_setAppearanceEvolveButtonsEvoView:function(e){this._setAppearanceEvolveButtonsBase(e,"evo_view")},_setAppearanceEvolveButtonsBase:function(e,t){var n=this._getEvolveButtonsUINode(e);n&&n.setAppearance(t)},_initCtrlButtons:function(e){this._evolutionItems.getUsableEvolutionItemsPromise().then(function(t){0<t.length?this._setAppearanceEvolveButtonsItemEvoView(e):this._setAppearanceEvolveButtonsEvoView(e)}.bind(this))},_getEvolveButtonsUINode:function(e){return e.seekWidgetByName("evo_btn_ui")},_touchEndedBackBtnProcess:function(e){this._navigateToEvo002()}}),n.assign(t.pc.enh_evo.evo_013.SceneDelegate.prototype,t.pc.roles.UIUtility,t.env.isIE?t.pc.enh_evo.roles.RoutingIE:t.pc.enh_evo.roles.Routing,t.pc.enh_evo.roles.EnhEvoCommon,t.pc.enh_evo.roles.EvoPopupCommon,t.pc.enh_evo.roles.EnhEvoConfirmList,t.pc.list.roles.ListCharactersCommon)}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.enh_evo=t.pc.enh_evo||{},t.pc.enh_evo.evo_014=t.pc.enh_evo.evo_014||{},t.pc.enh_evo.evo_014.Scene=t.BaseScene.extend({resourceFileName:"evo_014/evo_014",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"enh_evo",sceneName:"evo_014",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_base_change","btnCallbackBtnBaseChange",null,function(){alert("{{enh_001_2_6_evo_001_2_3evo_002}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_continue_evo","btnCallbackBtnContinueEvo",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"enh_evo/evo_013")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_continue_enh","btnCallbackBtnContinueEnh",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"enh_evo/enh_008")),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._),i=e.Q;t.pc=t.pc||{},t.pc.enh_evo=t.pc.enh_evo||{},t.pc.enh_evo.evo_014=t.pc.enh_evo.evo_014||{},t.pc.enh_evo.evo_014.SceneDelegate=t.pc.BaseSceneDelegate.extend({_popups:{},onSceneInit:function(e){this._verifyRouterParamsEVO014(e);var t=e.routerParams.evo_014.result,a=t.character;return n.isUndefined(a)&&console.error("routerParams.evo_012.result.character is empty."),this._setCharacterBasePanelWithoutApi(e,a),this._setResultMessage(e,this._evolveResultHtmlString(t)),this._showAnimationMaterials(e,"item",e.temporaryRouterParams.evo_014.materials),this._setBackBtn(e),this._playEvoAnimations(e),this._setCharacterHeaderLabel(),i.resolve()},_evolveResultHtmlString:function(e){var t=e.character.name,n=e.result;return"<br/><br/><br/>"+(t+"Lv<br/><span class='red'>"+(0==n.is_full_max_level?n.before.max_level+"&rarr;"+n.after.max_level:"MAX")+"</span>")},onSceneExit:function(e){return this._abortAnimation(),i.resolve()},btnCallbackBtnContinueEnh:function(e){return this._navigateToENH008(e.routerParams.evo_014.id),i.reject(this._override)},btnCallbackBtnBaseChange:function(e){var t=i.defer();return t.reject(this._override),this._navigateEVO014ToEVO002(e),t.promise},btnCallbackBtnContinueEvo:function(e){var t=i.defer();return t.reject(this._override),this._navigateEVO014ToEVO013(e),t.promise},_touchEndedBackBtnProcess:function(e){this._navigateToEvo002()}}),n.assign(t.pc.enh_evo.evo_014.SceneDelegate.prototype,t.pc.roles.UIUtility,t.pc.enh_evo.roles.Routing,t.pc.enh_evo.roles.EnhEvoCommon,t.env.isIE?t.pc.enh_evo.roles.EnhEvoAnimationIE:t.pc.enh_evo.roles.EnhEvoAnimation,t.pc.list.roles.ListCharactersCommon)}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.enh_evo=t.pc.enh_evo||{},t.pc.enh_evo.arousal_002=t.pc.enh_evo.arousal_002||{},t.pc.enh_evo.arousal_002.Scene=t.BaseScene.extend({resourceFileName:"arousal_002/arousal_002.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"enh_evo",sceneName:"arousal_002",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_arousal","btnCallbackBtnArousal",null,function(){alert("{{arousal_mate_check}}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_base_change","btnCallbackBtnBaseChange",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"enh_evo/enh_001_2_6_evo_001_2_3")),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc=t.pc||{},t.pc.enh_evo=t.pc.enh_evo||{},t.pc.enh_evo.arousal_002=t.pc.enh_evo.arousal_002||{},t.pc.enh_evo.arousal_002.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../arousal_popup_ui.json"],_popups:{},onSceneInit:function(e){this._verifyRouterParamsAROUSAL002(e);var t=this._getACharacterId(e);return this._setBackBtn(e),this._charaPromise=this._setCharacterBasePanel(e,t).then(function(t){return t.can_arouse||this._changeStateCannotArouse(e,"cannot_arouse"),t}.bind(this)),this._materialPromise=this._setCharacterArouseMaterials(e,t).spread(function(t,n){return n&&this._changeStateCannotArouse(e,"lack_of_materials"),t}.bind(this)),this._setCharacterHeaderLabel(),a.resolve()},_getACharacterId:function(e){return e.temporaryRouterParams.arousal_002.id},_changeStateCannotArouse:function(e,t){if("cannot_arouse"!==this._state){this._state=t;var n=this.__getCannotArouseMessage(t);this.__showMessageCannotArouse(e,n),this.__disableArouseButton(e)}},__getCannotArouseMessage:function(e){return{cannot_arouse:["","Lv",""].join("\n"),lack_of_materials:void 0}[e]},__showMessageCannotArouse:function(e,t){var n=this.__getNothingLabelNode(e);n&&(i.isUndefined(t)||n.setString(t),n.setAppearance("show"))},__getNothingLabelNode:function(e){return e.seekWidgetByName("nothing_label")},__disableArouseButton:function(e){var t=this.__getArouseButton(e);t&&this._setEnableButton(t,!1)},__getArouseButton:function(e){return e.seekWidgetByName("btn_arousal")},onSceneEnter:function(e){return a.resolve()},onSceneExit:function(e){return a.resolve()},onPageInAnimationEnd:function(e){return a.resolve()},btnCallbackBtnArousal:function(e){return this._confirm(e).then(this._arouseCharacter.bind(this,e,this._getACharacterId(e)),this._cancel.bind(this)).spread(function(t,n){this._navigateAROUSAL002To003(e,t,n)}.bind(this)),a.reject(this._override)},_confirm:function(e){var t=this.__getConfirmationPopup(e);return this._materialPromise.then(t.open.bind(t))},__getConfirmationPopup:function(e){return t.ImplantedPopup.createOrGet(e,"arousal_mate_check","ArouseMateCheckPopup")},_arouseCharacter:function(e,n){return(new t.BGM).stop(),this.__arouse(n).then(function(i){return this._playArouseAnimation(e,i).then(function(){(new t.BGM).play()}).thenResolve([n,i])}.bind(this))},__arouse:function(e){return t.createInstance("apiACharacters").arouse(e).then(function(e){return e.body}).fail(function(e){return console.error(e),a.reject(e)})},_playArouseAnimation:function(e,n){var i=n.result.before.character_id,o=n.result.after.character_id;return(n.character.a_character_id,new t.enh_evo.view.ArouseAnimation(i,o)).play().fail(function(e){return console.error(e),a.reject(e)})},_cancel:function(){console.log("")},btnCallbackBtnBaseChange:function(e){return this._navigateAROUSAL002To001(e),a.reject(this._override)},_touchHeaderCoreCard:function(e){var t=n.director.getRunningScene();this._navigateAROUSAL002ToLI004(t,e.a_character_id)},_touchEvolveMaterial:function(e){(new t.SE).play(t.SoundList.BUTTON_TOUCHED_DECIDE),this._showNeedMatePopup(e)},_touchEndedBackBtnProcess:function(e){this._navigateAROUSAL002To001(e)}}),i.assign(t.pc.enh_evo.arousal_002.SceneDelegate.prototype,t.pc.roles.UIUtility,t.pc.enh_evo.roles.Routing,t.pc.enh_evo.roles.EnhEvoCommon,t.pc.enh_evo.roles.EvoPopupCommon,t.pc.enh_evo.roles.EnhEvoConfirmList,t.pc.list.roles.ListCharactersCommon)}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.enh_evo=t.pc.enh_evo||{},t.pc.enh_evo.arousal_003=t.pc.enh_evo.arousal_003||{},t.pc.enh_evo.arousal_003.Scene=t.BaseScene.extend({resourceFileName:"arousal_003/arousal_003.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"enh_evo",sceneName:"arousal_003",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_base_change","btnCallbackBtnBaseChange",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"enh_evo/enh_001_2_6_evo_001_2_3")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_enh","btnCallbackBtnEnh",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"enh_evo/enh_008")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_evo","btnCallbackBtnEvo",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"enh_evo/evo_013")),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._),i=e.Q;t.pc=t.pc||{},t.pc.enh_evo=t.pc.enh_evo||{},t.pc.enh_evo.arousal_003=t.pc.enh_evo.arousal_003||{},t.pc.enh_evo.arousal_003.SceneDelegate=t.pc.BaseSceneDelegate.extend({_popups:{},onSceneInit:function(e){var t=this._getResult(e).character;if(!t)throw new Error("");return this._setBackBtn(e),this._setCharacterBasePanelWithoutApi(e,t),this._showResultMessage(e,t),this._setCharacterHeaderLabel(),i.resolve()},_getACharacterId:function(e){return e.temporaryRouterParams.arousal_003.id},_getResult:function(e){return e.temporaryRouterParams.arousal_003.result},_showResultMessage:function(e,n){var i=this._getResultMessage(n);e.setHtmlStrings({result_labelimg:i},t.GameConfig.POPUP_CSS)},_getResultMessage:function(e){return n.template("<br /><br /><br /><p><%= name.split('[')[0] %><span class=\"red\"></span></p>")({name:e.name})},onSceneEnter:function(e){return i.defer(),i.resolve()},onSceneExit:function(e){return i.defer(),i.resolve()},onPageInAnimationEnd:function(e){return i.defer(),i.resolve()},btnCallbackBtnBaseChange:function(e){return this._navigateAROUSAL003To001(e),i.reject(this._override)},btnCallbackBtnEnh:function(e){return this._navigateAROUSAL003ToENH008(e,this._getResult(e).character),i.reject(this._override)},btnCallbackBtnEvo:function(e){return i.defer(),this._navigateAROUSAL003ToEVO013(e,this._getResult(e).character),i.reject(this._override)},_touchEndedBackBtnProcess:function(e){this._navigateAROUSAL003To001(e)}}),n.assign(t.pc.enh_evo.arousal_003.SceneDelegate.prototype,t.pc.roles.UIUtility,t.pc.enh_evo.roles.Routing,t.pc.enh_evo.roles.EnhEvoCommon,t.pc.list.roles.ListCharactersCommon)}((this||0).self||global),function(e){var t=e.kh,n=e._,i=e.cc,a=e.ccui;t.epi=t.epi||{};var o={};t.epi.QuestButton=i.Class.extend({type:"",aQuest:null,popupDelegate:null,ctor:function(e,t,n){this.type=e,this.aQuest=t,this.storyIsEncounter=n},setPopupDelegate:function(e){this.popupDelegate=e},createListener:function(){return function(e,t){t===a.Widget.TOUCH_ENDED&&this._selectEpisode()}.bind(this)},_selectEpisode:function(){if(!this.popupDelegate)throw new Error("popupDelegate ");var e=new t.epi.model.AHaremEpisode(this.aQuest);if(e.isOpened()){var n=i.director.getRunningScene();return n.routerParams.episode_type=e.isStoryOfEncounter?"encounter":"",e.isExHaremEpisode()?this.showPopupEpiChapterSelect(e):this.aQuest.is_restricted&&this.aQuest.is_r18?e.isCleared()?this.showPopupComAgeLimitCleared():this.showPopupComAgeLimitNotCleared(n,this._episodeStart.bind(this)):e.isCleared()?this.aQuest.is_r18?this.showPopupEpiSceneCheck(this.type,this.aQuest):this.showPopupEpiStoryCheck(this.type,this.aQuest):this._episodeStart()}},_episodeStart:function(){t.createInstance("aQuestInfo").get().then(function(e){var t=e.getInProgressQuest();return t?this.showPopupComApRestart(t):e.hasUnverified()?this.showPopupComRaidCheck():this.startEpisode()}.bind(this)).fail(function(t){e.console.error(t)})},_onUseApItem:function(e){this._selectEpisode()},_fetch:function(e,n,i,a){if(e&&o[e])return Q.resolve(o[e]);var r=t.createInstance(n);return r[i].apply(r,a||[]).then(function(t){return e&&(o[e]=t.body),t.body}.bind(this))},showPopupComApRestart:function(e){return this.popupDelegate.getPopup("comApRestart").open({questTitle:e.title,aQuestId:e.a_quest_id,questType:e.type,type:e.type})},showPopupComRaidCheck:function(){return this.popupDelegate.getPopup("comRaidCheck").open()},showPopupEpiSceneCheck:function(e,t){var n=this.popupDelegate.getPopup("epiSceneCheck"),i=this.popupDelegate.getReturnBackParams();return n.open({type:e,record:t,returnBackParams:i})},startEpisode:function(){t.createInstance("apiAQuests").getCheckUserAP(this.aQuest.a_quest_id,this.aQuest.type),t.createInstance("router").navigate("scenario/episode-play",{"scenario/play":{episode_id:this.aQuest.harem_episode_info.episode_id,harem_only:!0,returnBackParams:this.popupDelegate.getReturnBackParams()}})},showPopupEpiStoryCheck:function(e,t){var i;i=n.isEmpty(t.description)?this.popupDelegate.getPopup("epiReplayCheck"):this.popupDelegate.getPopup("epiStoryCheck");var a=this.popupDelegate.getReturnBackParams();i.open({type:e,record:t,returnBackParams:a})},showPopupComAgeLimitCleared:function(){this.popupDelegate.getPopup("comAgeLimitB").open()},showPopupComAgeLimitNotCleared:function(e,n){t.ImplantedPopup.createOrGet(e,"com_age_limit_a","ComAgeLimitAPopup").open(n)},showPopupEpiChapterSelect:function(e){this.popupDelegate._showEpiChapterSelectPopup(e)}})}((this||0).self||global),function(e){var t=e.kh,n=e._,i=e.cc,a=e.ccui;t.epi=t.epi||{},t.epi.EpisodeButton=i.Class.extend({type:"",aQuest:null,popupDelegate:null,_cached:{},ctor:function(e,t){this.type=e,this.aQuest=t},setPopupDelegate:function(e){this.popupDelegate=e},createListener:function(){return function(e,n){if(n===a.Widget.TOUCH_ENDED){if(!this.popupDelegate)throw new Error("popupDelegate ");return this.aQuest.is_cleared?this.showPopupEpiStoryCheck(this.type,this.aQuest):void t.createInstance("questStateManager").startQuest(this.aQuest.quest_id,this.aQuest.type)}}.bind(this)},showPopupEpiStoryCheck:function(e,t){if(n.isEmpty(t.description))var i=this.popupDelegate.getPopup("epiReplayCheck");else i=this.popupDelegate.getPopup("epiStoryCheck");var a=this.popupDelegate.getReturnBackParams();i.open({type:e,record:t,returnBackParams:a})}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;e.Q,t.pc.roles=t.pc.roles||{},t.pc.roles.AllOverUI={_openAllOverPanel:function(e,a,o){var r=n.director.getRunningScene().seekWidgetByName("all_over_ui");if(null!==r){if(i.contains(["chara","weapon","summon","job","guardian","npc"],o)){var s=r.seekWidgetByName("illustzoom");return null===s?void console.warn("[ERROR] Could not find illustzoom | btn_faceup."):(this._initializeToImage(s),a=a||0,s.loadTexture(t.Img("illustzoom",o,i.padZero(e,4),a).png),r.setVisible(!0),this.eventListener=t.env.isSp?this._createTouchEvent(r,s):this._createMouseEvent(r,s),void n.eventManager.addListener(this.eventListener,r))}console.error("Invalid image type: "+o)}else console.warn("[ERROR] Could not find all_over_ui.")},_createTouchEvent:function(e,t){var i=!1;return n.EventListener.create({event:n.EventListener.TOUCH_ALL_AT_ONCE,swallowTouches:!0,onTouchesBegan:function(e,t){i=!0},onTouchesMoved:function(e,n){if(2==e.length){i=!1;var a=e[0].getLocationX()<e[1].getLocationX()?e[0]:e[1],o=e[0].getLocationX()<e[1].getLocationX()?e[1]:e[0],r=Math.abs(a.getLocationX()-a.getPreviousLocation().x);this._isPinchIn(a,o)?this._pinchInImage(t,r):this._isPinchOut(a,o)&&this._pinchOutImage(t,r)}var s=(e[0].getLocationX()-e[0].getPreviousLocation().x)*(.5*t.getScaleX()),c=(e[0].getLocationY()-e[0].getPreviousLocation().y)*(.5*t.getScaleY());i=i?this._isEnableTap(s,c):i;var u=this._clampImagePosition(t,s,c);t.setPosition(t.x+u.x,t.y+u.y)}.bind(this),onTouchesEnded:function(t,n){1==t.length&&i&&(e.setVisible(!1),this._onTouchClose(e))}.bind(this)})},_createMouseEvent:function(e,t){var i=!1,a=0,o=0,r={x:0,y:0};return n.EventListener.create({event:n.EventListener.MOUSE,onMouseMove:function(e){if(i){var n=(e.getLocationX()-o.x)/t.getScaleX(),a=(e.getLocationY()-o.y)/t.getScaleY(),s=this._clampImagePosition(t,n,a);r.x+=s.x,r.y+=s.y,t.setPosition(t.x+s.x,t.y+s.y),o=e.getLocation()}}.bind(this),onMouseDown:function(e){i=!0,a=e.getLocation(),o=e.getLocation()}.bind(this),onMouseUp:function(t){i=!1,e.isVisible()&&n.pointEqualToPoint(a,o)&&(e.setVisible(!1),this._onTouchClose(e))}.bind(this),onMouseScroll:function(e){var n=Math.max(1,Math.min(t.getScaleX()+.001*e._scrollY,3));t.setScale(n);var i=this._getImageMargin(t),a=i.width/2*-1,o=i.height/2*-1,s={x:a+r.x,y:o+r.y};t.setPosition(s.x,s.y)}.bind(this)})},_onTouchClose:function(e){e.setVisible(!1),n.eventManager.removeListener(this.eventListener)},_getImageMargin:function(e){return{width:e.width*e.getScaleX()-e.width,height:e.height*e.getScaleY()-e.height}},_clampImagePosition:function(e,t,n){var i=this._getImageMargin(e);return e.x+t<-1*i.width?t=-1*i.width-e.x:e.x+t>0&&(t=-1*e.x),e.y+n<-1*i.height?n=-1*i.height-e.y:e.y+n>0&&(n=-1*e.y),{x:t,y:n}},_initializeToImage:function(e){e.setPosition(0,0),e.setScale(1,1)},_isEnableTap:function(e,t){return Math.pow(e,2)+Math.pow(t,2)<.01},_pinchInImage:function(e,t){e.setScale(Math.min(e.getScaleX()+.01*t,4),Math.min(e.getScaleY()+.01*t,4)),e.setPosition(e.x-t,e.y-t)},_pinchOutImage:function(e,t){e.setScale(Math.max(e.getScaleX()-.01*t,1),Math.max(e.getScaleY()-.01*t,1)),e.setPosition(e.x+t,e.y+t)},_isPinchIn:function(e,t){return e.getLocationX()<e.getPreviousLocation().x&&t.getLocationX()>t.getPreviousLocation().x},_isPinchOut:function(e,t){return e.getLocationX()>e.getPreviousLocation().x&&t.getLocationX()<t.getPreviousLocation().x}}}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.createNameSpaceIfNotExists("pc.view"),t.pc.view.ComAgeLimitAPopup=t.ImplantedPopup.extend({className:"ComAgeLimitAPopup",_initContents:function(e){this.setButtonEvents({btn_cancel:!0,btn_all_ages:e,btn_r18:this._navigateToR18})},_navigateToR18:function(){var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null);var n=document.createElement("a");n.target="_top",n.href=t.env.R18GameURL,n.dispatchEvent(e)}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);e.Q,t.pc.epi=t.pc.epi||{},t.pc.epi.roles=t.pc.epi.roles||{},t.pc.epi.roles.Routing={_navigateToMy001:function(){t.createInstance("router").navigate("epi/epi_001")},_navigateToEpi001:function(){t.createInstance("router").navigate("epi/epi_001")},_verifyRouterParams002:function(e){n.isUndefined(e.routerParams.epi_001)&&(e.routerParams.epi_001={character_id:1},this._consoleErrorRouterParams("routerParams.epi_001, .character_id"))},_verifyRouterParams003:function(e){n.isUndefined(e.routerParams.epi_001)&&(e.routerParams.epi_001={summon_id:1},this._consoleErrorRouterParams("routerParams.epi_001, .summon_id"))},_verifyRouterParams004:function(e){n.isUndefined(e.routerParams.epi_001)&&(e.routerParams.epi_001={job_id:1},this._consoleErrorRouterParams("routerParams.epi_001, .job_id"))}}}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.epi=n.epi||{},n.epi.model=n.epi.model||{},n.epi.model.HaremGameItemReward=function(e){this._haremGameItemReward=e},n.epi.model.HaremGameItemReward.prototype={getRewardType:function(){return this._getPropertyOrDefault("reward_type")},getShortRewardType:function(){var e=this.getRewardType();return"accessory"===e?"acce":e},getItemId:function(){return this._getPropertyOrDefault("item_id")},getImgPath:function(){return n.Img("rewardicon",this.getShortRewardType(),t.padZero(this.getItemId(),4)).png},_getPropertyOrDefault:function(e,n){return t.isUndefined(n)&&(n=null),this._haremGameItemReward?this._haremGameItemReward[e]:n}}}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.epi=t.epi||{},t.epi.model=t.epi.model||{},t.epi.model.HaremClearedBonus=function(e){this._type=e},t.epi.model.HaremClearedBonus.prototype={isAcquireAbility:function(){return"acquire_ability"===this._type},isStrengthenAbility:function(){return"strengthen_ability"===this._type},isNone:function(){return!this._type||"none"===this._type}}}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.epi=n.epi||{},n.epi.model=n.epi.model||{},n.epi.model.AHaremChapter=function(e,t){this._aHaremChapter=e,this._questType=t},n.epi.model.AHaremChapter.prototype={getAHaremChapterId:function(){return this._getPropertyOrDefault("a_chapter_id")},getHaremChapterId:function(){return this._getPropertyOrDefault("chapter_id")},getQuestType:function(){return this._questType},getTitle:function(){return this._getPropertyOrDefault("title","")},getDescription:function(){return this._getPropertyOrDefault("description","")},isCleared:function(){return this._getPropertyOrDefault("is_cleared",!1)},isOpened:function(){return this._getPropertyOrDefault("is_opened",!1)},_getPropertyOrDefault:function(e,n){return t.isUndefined(n)&&(n=null),this._aHaremChapter?this._aHaremChapter[e]:n}}}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.epi=n.epi||{},n.epi.model=n.epi.model||{},n.epi.model.HaremHeroine=function(e){this._haremHeroine=e},n.epi.model.HaremHeroine.prototype={getHaremHeroineId:function(){return this._getPropertyOrDefault("heroine_id")},getHeroineType:function(){return this._getPropertyOrDefault("heroine_type")},getShortHeroineType:function(){var e=this._getPropertyOrDefault("heroine_type");return"character"===e?"chara":e},getName:function(){return this._getPropertyOrDefault("name")},_getPropertyOrDefault:function(e,n){return t.isUndefined(n)&&(n=null),this._haremHeroine?this._haremHeroine[e]:n}}}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.epi=n.epi||{},n.epi.model=n.epi.model||{},n.epi.model.AHaremEpisode=n.core.pager.model.PlainData.extend({ctor:function(e){this._aHaremEpisode=e;var i=e.harem_episode_info;this._aChapterModels=t.map(i.chapters,function(e){return new n.epi.model.AHaremChapter(e,this.getQuestType())}.bind(this)),this._heroineModels=t.map(i.heroines,function(e){return new n.epi.model.HaremHeroine(e)});var a=this._aHaremEpisode.reward_info;this._gameItemRewardModel=a?new n.epi.model.HaremGameItemReward(a):null,this._clearedBonusModel=new n.epi.model.HaremClearedBonus(i.cleared_bonus_type),this._super(e)},getAHaremEpisodeId:function(){return this._getPropertyOrDefault("a_quest_id")},getHaremEpisodeId:function(){return this._aHaremEpisode.harem_episode_info.episode_id},getQuestType:function(){return this._getPropertyOrDefault("type")},isExHaremEpisode:function(){return"harem-ex"===this.getQuestType()},getRawRecord:function(){return this._aHaremEpisode},getShortQuestType:function(){var e=this._getPropertyOrDefault("type");return"harem-character"===e?"harem-chara":e},getTitle:function(){return this._getPropertyOrDefault("title","")},getTitleForDisplay:function(){return this.getTitle()},getDescription:function(){return this._getPropertyOrDefault("description","")},isNew:function(){return this._getPropertyOrDefault("is_new",!1)},isCleared:function(){return this._getPropertyOrDefault("is_cleared",!1)},isOpened:function(){return this._getPropertyOrDefault("is_opened",!1)},isStoryOfEncounter:function(){return this._aHaremEpisode.harem_episode_info.is_story_of_encounter},isR18Episode:function(){return this._aHaremEpisode.is_r18},isHeroineAroused:function(){return this._aHaremEpisode.harem_episode_info.heroine_is_aroused},getAChapters:function(){return this._aChapterModels},getHeroines:function(){return this._heroineModels},getMainHeroine:function(){return this._heroineModels[0]},getGameItemReward:function(){return this._gameItemRewardModel},hasGameItemReward:function(){return!t.isNull(this._gameItemRewardModel)&&!t.isUndefined(this._gameItemRewardModel)},getClearedBonus:function(){return this._clearedBonusModel},getResourceDirectory:function(){return this._aHaremEpisode.harem_episode_info.resource_directory},_getPropertyOrDefault:function(e,n){return t.isUndefined(n)&&(n=null),this._aHaremEpisode?this._aHaremEpisode[e]:n},playAChapterAsAQuest:function(e){this.confirmAndOpenErrorPopup(e).then(this.startAExHaremChapterByIndex.bind(this,e))},confirmAndOpenErrorPopup:function(e){var t=cc.director.getRunningScene();return this._confirmStartAExHaremChapterByIndex(e||1).fail(function(e){if("object"!=typeof e||!e.type)return Q.reject(e);("has_a_quest_in_progress"===e.type&&t._delegate._showPopupComApRestart(e.inProgress),"has_unverified"===e.type)&&t.popups.comRaidCheck.open().open();return Q.reject()}.bind(this))},_confirmStartAExHaremChapterByIndex:function(e){return n.createInstance("aQuestInfo").get().then(function(e){var t=e.getInProgressQuest();return t?Q.reject({type:"has_a_quest_in_progress",inProgress:t}):e.hasUnverified()?Q.reject({type:"has_unverified",inProgress:t}):this}.bind(this))},startAExHaremChapterByIndex:function(e){if(!this._aChapterModels[e])return Q.reject()}})}((this||0).self||global),function(e){var t=e.kh;e.cc,t.CoreCardMainQuestUI=t.CoreCardUI.extend({className:"KHCoreCardMainQuestUI",ctor:function(e,t){null===t&&this.loadResource()},loadResource:function(){this.uiNode=new ccui.ImageView,this.uiNode.setTouchEnabled(!0),this.uiNode.setSoundEnabled(!0),this.uiNode.setSound(t.SoundList.BUTTON_TOUCHED_DEFAULT),this.uiAction=null},initAction:function(e){},setImg:function(e,n){var i=this.uiNode.parent.getAnchorPoint();this.uiNode.setAnchorPoint(i),this.uiNode.loadTexture(t.Img("corecard","main-quest-battle",_.padZero(e,4),n).jpg)},setData:function(e){this.setImg(e.quest_id,e.battle_no)},addTouchEventListener:function(e,t){this.uiNode.addTouchEventListener(e,t)},setIconProtected:function(e){console.warn("setIconProtected is not supported")},setIconEquipped:function(e){console.warn("setIconEquipped is not supported")},setPlusNo:function(){console.warn("setPlusNo is not supported")},setPlusNoVisible:function(){console.warn("setPlusNoVisible is not supported")},setStarGauge:function(){console.warn("setStarGauge is not supported")},setTotalLabel:function(){console.warn("setTotalLabel is not supported")},setIconOrganized:function(){console.warn("setIconOrganized is not supported")},setIconRarity:function(){console.warn("setIconRarity is not supported")},_getCardId:function(e){return e.quest_id}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.epi=n.epi||{},n.epi.view=n.epi.view||{},n.epi.view.EpiCommonPanelView=n.core.pager.view.page.BasePageUi.extend({_scene:null,_resourceNode:null,ctor:function(e,t){this._super(e),this._scene=t},_updateOne:function(e,n){var i=this._getResourceNode(e,n);t.invoke(e.getChildren(),"setVisible",!1),this._setRewardNode(i,n),this._setQuestButton(i,n),this._setHeaderLabelNode(i,n),this._setQuestImage(i,n),i.setVisible(!0),e.setVisible(!0)},_getResourceName:function(){return console.log("please implement"),""},_getResourceNode:function(e,n){var i=this._getResourceName(n),a=e.getUserData()||{};if(a[i])return a[i];var o=ccs.load($dynamicRes(i)),r=o.node;return t.each(r.seekWidgets(function(e){return"clip_panel"===e._name}),function(e){e.setTouchEnabled(!1)}),r.runAction(o.action),e.addChild(r),a[i]=r,e.setUserData(a),r},_setRewardNode:function(e,t){var n=t.getClearedBonus(),i=e.seekWidgetByName("quest_reward"),a=e.seekWidgetByName("quest_reward_ability",e);return a&&a.setVisible(!1),i&&i.setVisible(!1),t.hasGameItemReward()?(i.loadTexture(t.getGameItemReward().getImgPath()),void i.setVisible(!0)):void((n.isAcquireAbility()||n.isStrengthenAbility())&&a.setVisible(!0))},_setHeaderLabelNode:function(e,t){e.setStrings({quest_header_label:t.getTitleForDisplay()})},_setQuestButton:function(e,t){var i=this._getNodeByName("questlist_epi_base",e);if(!t.isOpened())return i.setColor(cc.color("#808080")),void i.setTouchEnabled(!1);i.setColor(cc.color("#FFFFFF"));var a=t.getMainHeroine().getShortHeroineType(),o=n.createInstance("EpiQuestButton",[a,t.getRawRecord(),t.isStoryOfEncounter()]);o.setPopupDelegate(this._scene._delegate),i.setTouchEnabled(!0),i.addTouchEventListener(o.createListener())},_setQuestImage:function(e,t){throw new Error("Require Implements _setQuestImage")},_getNodeByName:function(e,n){t.isUndefined(n)&&(n=this._rootWidget);var i=n.seekWidgetByName(e);return i||console.warn("EpiCommonView._getNodeByName(): node '"+e+"' not found"),i}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.epi=n.epi||{},n.epi.view=n.epi.view||{},n.epi.view.EpiExPanelView=n.epi.view.EpiCommonPanelView.extend({_getResourceName:function(){return $staticRes(res["epi-epi_001-questlist_epi_yellow_ui"])},_updateOne:function(e,t){this._super.apply(this,arguments);var n=this._getResourceNode(e,t);this._setRewardNode(n,t),this._setHeroineImages(n,t),this._setCompletedIcon(n,t),n.setVisible(!0)},_setHeroineImages:function(e,i){var a=i.getHeroines();this._getNodeByName("clip_panel",e).getChildren().forEach(function(e,o){e.setTouchEnabled(!1);var r=this._getNodeByName("chara_img",e);r.setTouchEnabled(!1);var s=a[o];if(s){var c=s.getHaremHeroineId(),u=s.getShortHeroineType(),l=n.Img("corecard",u,t.padZero(c,4),0).jpg;r.loadTexture(l),r.setVisible(!0),r.setColor(i.isOpened()?cc.color(255,255,255):cc.color(128,128,128))}else r.setVisible(!1)}.bind(this))},_setRewardNode:function(e,t){this._super.apply(this,arguments);var n=e.seekWidgetByName("quest_reward");n&&t.hasGameItemReward()&&n.setColor(t.isCleared()?cc.color(128,128,128):cc.color(255,255,255))},_setQuestImage:function(e,t){},_setCompletedIcon:function(e,t){this._getNodeByName("completed_icon",e).setVisible(t.isCleared())}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.epi=t.epi||{},t.epi.view=t.epi.view||{},t.epi.view.EpiCharaStoryPanelView=t.epi.view.EpiCommonPanelView.extend({_getResourceName:function(e){return e.isR18Episode()?$staticRes(res["epi-questlist_epi_pink_ui"]):$staticRes(res["epi-epi_001-questlist_epi_blue_ui"])},_setQuestImage:function(e,n){var i=n.getShortQuestType(),a=n.getHaremEpisodeId(),o=t.createInstance("episodeImage"),r=this._getNodeByName("questimg",e),s=1;if(n.getResourceDirectory()){var c=t.Img("questimg",i.replace(/cter$/,"")+"-quest",n.getResourceDirectory(),s).png;r.loadTexture(c)}else r.setVisible(!1),o.loadTextureToImageView(r,i,a,s).then(function(){r.setVisible(!0)})}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.epi=n.epi||{},n.epi.view=n.epi.view||{},n.epi.view.EpiChapterSelectPopup=n.ImplantedPopup.extend({_aHaremEpisodeModel:null,_initContents:function(e){this._aHaremEpisodeModel=e,this._clearContents(),this._setTitle(),this._setAChapters(),this._setActionBtns()},_clearContents:function(){this._clearTitle(),this._clearAChapters()},_setTitle:function(){var e=this._getNodeByName("title_label");e.setVisible(!0),e.setString(this._aHaremEpisodeModel.getTitleForDisplay())},_setAChapters:function(){var e=this._aHaremEpisodeModel.getAChapters();t.range(10).forEach(function(t){var n="epi_btn_chapter_"+t.toString(),i=this._getNodeByName(n),a=e[t];if(a){i.setVisible(!0),this._getNodeByName("icon_clear",i).setVisible(a.isCleared());var o=this._getNodeByName("btn_chapter",i);return o.setTitleText(a.getTitle()),a.isOpened()?void o.addTouchEventListener(function(e,n){if(n===ccui.Widget.TOUCH_ENDED){if(a.isCleared())return this.dismiss(),void this._playAChapter(t);this.dismiss(),this._aHaremEpisodeModel.playAChapterAsAQuest(t)}}.bind(this)):(o.setColor(cc.color("#808080")),void o.setTouchEnabled(!1))}i.setVisible(!1)}.bind(this))},_playAChapter:function(e){var t={tab_0:"chara",tab_1:"ex",tab_2:"new"}[this._getScene().tabDelegateList[0].selected];n.createInstance("router").navigate("scenario/episode-play",{"scenario/play":{episode_id:this._aHaremEpisodeModel.getHaremEpisodeId(),chapter_number:e+1,returnBackParams:{scene:"epi/epi_001",routerParams:{epi_001:{tab:t}}}}})},_setActionBtns:function(){this.setButtonEvents({btn_close:function(){this._clearContents(),this.dismiss()}.bind(this)})},_clearTitle:function(){var e=this._getNodeByName("title_label");e.setVisible(!1),e.setString("")},_clearAChapters:function(){t.range(10).forEach(function(e){var t="epi_btn_chapter_"+e.toString(),n=this._getNodeByName(t);n.setVisible(!1);var i=this._getNodeByName("btn_chapter",n);i.setColor(cc.color("#FFFFFF")),i.setTouchEnabled(!0)}.bind(this))},_getNodeByName:function(e,n){t.isUndefined(n)&&(n=this._node);var i=n.seekWidgetByName(e);return i||console.warn("EpiChapterSelectPopup._getByNode(): node '"+e+"' not found"),i}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.epi=t.epi||{},t.epi.view=t.epi.view||{},t.epi.view.EpiNewPanelView=t.core.pager.view.page.BasePageUi.extend({_charaStoryView:null,_exStoryView:null,ctor:function(e,n){this._super(e),this._charaStoryView=new t.epi.view.EpiCharaStoryPanelView(e,n),this._exStoryView=new t.epi.view.EpiExPanelView(e,n)},_updateOne:function(e,t){return t?t.isExHaremEpisode()?void this._exStoryView._updateOne(e,t):void this._charaStoryView._updateOne(e,t):void e.setVisible(!1)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("epi.settings"),t.epi.settings.CharacterPageSettings=n.Class.extend({pageList:{baseName:"epi_001_a_1_node",panelName:t.BtnsPageListParams.EPI_CHARA_LIST.panelName,cardType:"chara",cardFrame:"e_r",apiName:"apiALibrary",apiMethod:"getHaremCharacters",apiParams:[t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE,t.displayFilter.enums.FILTER_NAME.EPI_CHARA]},sortArgs:{sortValue:"attack_desc",sortButton:"btn_sort",sortLabel:"sort_label",sortMenuBase:"sortlist",sortChoice:"core-pages-sort_list_0_ui",parentNodeName:"epi_001_a_1_node",changeEventName:"pulldown_list_chara",sortKey:"episode_characters"}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("epi.settings"),t.epi.settings.JobPageSettings=n.Class.extend({pageList:{baseName:"epi_001_a_3_node",panelName:t.BtnsPageListParams.EPI_CHARA_LIST.panelName,cardType:"job",cardFrame:"plain",apiName:"apiALibrary",apiMethod:"getHaremJobs",apiParams:[t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE]}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("epi.settings"),t.epi.settings.SummonPageSettings=n.Class.extend({pageList:{baseName:"epi_001_a_2_node",panelName:t.BtnsPageListParams.EPI_CHARA_LIST.panelName,cardType:"summon",cardFrame:"e_r",apiName:"apiALibrary",apiMethod:"getHaremSummons",apiParams:[t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE,t.displayFilter.enums.FILTER_NAME.EPI_SUMMON]},sortArgs:{sortValue:"attack_desc",sortButton:"btn_sort",sortLabel:"sort_label",sortMenuBase:"sortlist",sortChoice:"core-pages-sort_list_0_ui",parentNodeName:"epi_001_a_2_node",changeEventName:"pulldown_list_summon",sortKey:"episode_summons"}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("epi.settings"),t.epi.settings.MainQuestPageSettings=n.Class.extend({pageList:{baseName:"epi_001_a_4_node",panelName:t.BtnsPageListParams.EPI_CHARA_LIST.panelName,cardType:"main",cardFrame:"plain",apiName:"apiALibrary",apiMethod:"getHaremMainQuests",apiParams:[t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE]}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("epi.settings"),t.epi.settings.PageSettingsFactory=n.Class.extend({CLASSES:{chara:"CharacterPageSettings",summon:"SummonPageSettings",job:"JobPageSettings",main:"MainQuestPageSettings"},create:function(e){var n=this.CLASSES[e];return null==n&&console.error("No episode page settings found for episode type: "+e),t.createInstance(n)}})}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.epi=t.pc.epi||{},t.pc.epi.epi_001=t.pc.epi.epi_001||{},t.pc.epi.epi_001.Scene=t.BaseScene.extend({resourceFileName:"epi_001/epi_001.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[{tab1:{node:"tab_0","content-node":"epi_001_a_node"},tab2:{node:"tab_1","content-node":"epi_001_b_node"},tab3:{node:"tab_2","content-node":"epi_001_c_node"}},{tab1:{node:"btn_chara","content-node":"epi_001_a_1_node"},tab2:{node:"btn_summon","content-node":"epi_001_a_2_node"},tab3:{node:"btn_job","content-node":"epi_001_a_3_node"},tab4:{node:"btn_main","content-node":"epi_001_a_4_node"}}],componentName:"epi",sceneName:"epi_001",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_epi_info","btnCallbackBtnEpiInfo",null,function(){alert("{{popup com_tutorial}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("epi_001_a_1_node"),"filter_btn","btnCallbackEpi001A1NodeFilterBtn",null,function(){alert("{{com_filter_chara}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("epi_001_a_2_node"),"filter_btn","btnCallbackEpi001A2NodeFilterBtn",null,function(){alert("{{com_filter_other}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc=t.pc||{},t.pc.epi=t.pc.epi||{},t.pc.epi.epi_001=t.pc.epi.epi_001||{},t.pc.epi.epi_001.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../epi_popup_ui.json"],_popups:{epiSceneCheck:{factoryName:"popupFactoryEpiSceneCheck"},epiStoryCheck:{factoryName:"popupFactoryEpiStoryCheck"},epiReplayCheck:{factoryName:"popupFactoryEpiReplayCheck"},epiApCheck:{factoryName:"popupFactoryEpiApCheck"},comRaidCheck:{factoryName:"popupFactoryComRaidCheck"},comNeedApBp1:{factoryName:"popupFactoryComNeedApBp1"},comNeedApBp2:{factoryName:"popupFactoryComNeedApBp2"},comApRestart:{factoryName:"popupFactoryComApRestart"},comAgeLimitB:{factoryName:"popupFactoryComAgeLimitB"},comCaution2:{factoryName:"popupFactoryBlue",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(){this.dismiss()}}}},_tabNode:{epi_001_a:"tab_0",epi_001_b:"tab_1",epi_001_c:"tab_2"},_controllers:null,_createDisplayFilterSettings:function(){return{epi_001_a_1_node:[t.displayFilter.enums.FILTER_NAME.EPI_CHARA,"com_filter_other"],epi_001_a_2_node:[t.displayFilter.enums.FILTER_NAME.EPI_SUMMON,"com_filter_other"]}},onSceneInit:function(e){a.defer(),this._controllers={},t.createInstance("router").permanentlyRemoveRouterParam("payment_id"),this._hideNothingLabel(e),this._checkNewEpisode().then(function(t){return t?this._showNewBadge(e):this._hideNewBadge(e),t}.bind(this)).fail(function(e){console.error(e)}),this._owner=e,this._setBackBtn(e),this._createDisplayFilterController(e);var n=t.createInstance("router");if(/_[abc]$/.test(n.getCurrentSceneName())){if(!i.isUndefined(this._tabNode[n.getCurrentSceneName()])){var o=e.seekWidgetByName(this._tabNode[n.getCurrentSceneName()]);i.isUndefined(o)||e.tabDelegateList[0].selectTab(o)}}else this._initializeTab(e,e.routerParams.epi_001),this._restorePage(e,e.routerParams.epi_001),this._initializeKind(e,e.routerParams.epi_001),delete e.routerParams.epi_001,e.enableRestore(!1);return this._showSubTutorialFirstAccess(e),a.resolve()},_showSubTutorialFirstAccess:function(e){var n=t.createInstance("apiASubTutorialPages");return n.get("harem").then(function(t){t.body.need_first_display&&(this._openSubTutorialPopup(e),n.visited("harem"))}.bind(this)).fail(function(e){console.error(e.stack)})},_initializeTab:function(e,t){if(t&&t.tab){var n=e.seekWidgetByName({chara:"tab_0",ex:"tab_1",new:"tab_2"}[t.tab]);n&&e.tabDelegateList[0].selectTab(n)}},_restoreIndex:null,_restorePage:function(e,t){t&&t.kind&&t.index&&(this._restoreIndex=t.index)},_initializeKind:function(e,t){if(t&&t.kind){var n=e.seekWidgetByName({chara:"btn_chara",summon:"btn_summon",job:"btn_job",main:"btn_main"}[t.kind]);i.isUndefined(n)||e.tabDelegateList[1].selectTab(n)}},_adjustTabForGeneral:function(e){var t=e.seekWidgetByName("tab_1");if(t){var n=e.seekWidgetByName("tab_label_1");if(n){var i=e.seekWidgetByName("tab_2");if(i){var a=e.seekWidgetByName("tab_label_2");if(a){var o=e.seekWidgetByName("new_icon");if(o){var r=i.x-t.x;i.x-=r,a.x-=r,o.x-=r,t.setVisible(!1),n.setVisible(!1)}}}}}},onSceneEnter:function(e){return a.defer(),a.resolve()},onSceneExit:function(e){return a.defer(),this._owner=null,i.invoke(this._controllers,"dispose"),a.resolve()},onPageInAnimationEnd:function(e){return a.defer(),a.resolve()},tabCallbackTab0:function(e){},tabCallbackTab1:function(e){this._fillupExHaremEpiBtnsList(e)},tabCallbackTab2:function(e){this._fillupHaremEpiNewBtnsList(e)},tabCallbackBtnChara:function(e){this._fillupHaremEpiBtnsList(e,"chara","_touchEpiCharaCard")},tabCallbackBtnSummon:function(e){this._fillupHaremEpiBtnsList(e,"summon","_touchEpiSummonCard")},tabCallbackBtnJob:function(e){this._fillupHaremEpiBtnsList(e,"job","_touchEpiJobCard")},tabCallbackBtnMain:function(e){this._fillupHaremEpiBtnsList(e,"main","_touchEpiMainStoryCard")},btnCallbackBtnEpiInfo:function(e){return this._openSubTutorialPopup(e),a.reject(this._override)},_openSubTutorialPopup:function(e){return t.ImplantedPopup.createOrGet(e,"sub_tutorial","ImplantedSubTutorialPopup").open("epi",2)},_checkNewEpisode:function(){return t.createInstance("aQuestInfo").get().then(function(e){return e.hasNewHarem()})},_showNewBadge:function(e){e.seekWidgetByName("tab_ui").seekWidgetByName("new_icon").setVisible(!0)},_hideNewBadge:function(e){e.seekWidgetByName("tab_ui").seekWidgetByName("new_icon").setVisible(!1)},_touchEpiMainStoryCard:function(e){var a=e.getRawData(),o=i.merge({is_opened:!0,harem_episode_info:{episode_id:a.episode_id}},a),r=t.createInstance("EpiQuestButton",["main_story",o]);r.setPopupDelegate(n.director.getRunningScene()._delegate),r._selectEpisode()},_getRestoreIndex:function(e){return this._controllers[e].getCurrentPageNumber()},_touchEpiCharaCard:function(e){var n=this.__getVirtualCharacterId(e.getRawData());t.createInstance("router").navigate("epi/epi_002",{epi_001:{tab:"chara",kind:"chara",character_id:n,index:this._getRestoreIndex("chara")}})},__getVirtualCharacterId:function(e){return i.isNumber(e.aroused_character_id)&&-1<e.aroused_character_id?e.aroused_character_id:e.character_id},_touchEpiSummonCard:function(e){t.createInstance("router").navigate("epi/epi_003",{epi_001:{tab:"chara",kind:"summon",summon_id:e.getRawData().summon_id,index:this._getRestoreIndex("summon")}})},_touchEpiJobCard:function(e){t.createInstance("router").navigate("epi/epi_004",{epi_001:{tab:"chara",kind:"job",job_id:e.getRawData().job_id,index:this._getRestoreIndex("job")}})},_touchEndedBackBtnProcess:function(e){this._navigateToMy001()},getPopup:function(e){if(!this._owner.popups[e])throw new Error("no such popup: ",e);return this._owner.popups[e]},getReturnBackParams:function(){var e=n.director.getRunningScene().tabDelegateList[0].selected;return{scene:"epi/epi_001",routerParams:{epi_001:{tab:"tab_1"===e?"main_story":"tab_2"===e?"new":"ex"}}}},_showEpiChapterSelectPopup:function(e){return e.confirmAndOpenErrorPopup(1).then(function(){var i=n.director.getRunningScene();return t.ImplantedPopup.createOrGet(i,"epi_chapter_select","EpiChapterSelectPopup").open(e)})},_showPopupComApRestart:function(e){return this.getPopup("comApRestart").open({questTitle:e.title,aQuestId:e.a_quest_id,questType:e.type,type:e.type})},_fillupHaremEpiBtnsList:function(e,n,o){if(!this._controllers[n]){var r=t.createInstance("PageSettingsFactory").create(n),s=this[o],c=t.core.pager.helper.coreCardListUI(e,r.pageList,new t.core.eventHandling.BaseEventHandler(s,this));e.seekWidgetByName(r.pageList.baseName).seekWidgetByName(r.pageList.panelName).setVisible(!0),this._controllers[n]=c;var u=c.initialize_(this._restoreIndex||1);this._restoreIndex=null,i.isUndefined(r.sortArgs)||(a.all([t.createInstance("PulldownSortConfig").init(r.sortArgs),u]).spread(c.setPulldownSortConfig.bind(c)),this._initializeDisplayFilterController(r.pageList.baseName))}},_fillupExHaremEpiBtnsList:function(e){if(!this._controllers.exHarem){var n=t.core.pager.model.ApiDataListFactory("apiAQuests","getListExHarem",[t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE],t.epi.model.AHaremEpisode),i=e.seekWidgetByName("epi_001_b_node"),a=i.seekWidgetByName(t.BtnsPageListParams.EPI_EX_LIST.panelName),o=new t.epi.view.EpiExPanelView(a,e),r=new t.core.pager.controller.PagerController(i,n,[o],a),s=i.seekWidgetByName("viewpage_ui");new t.core.pager.view.button.ViewPageUi(s,r).initialize(),r.initialize(),this._controllers.exHarem=r}},_fillupHaremEpiNewBtnsList:function(e){if(!this._controllers.new){var n=t.core.pager.model.ApiDataListFactory("apiAQuests","getUnconfirmedHaremEpisodes",[t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE],t.epi.model.AHaremEpisode),i=e.seekWidgetByName("epi_001_c_node"),a=i.seekWidgetByName(t.BtnsPageListParams.EPI_NEW_LIST.panelName),o=new t.epi.view.EpiNewPanelView(a,e),r=new t.core.pager.controller.PagerController(i,n,[o],a),s=i.seekWidgetByName("viewpage_ui"),c=new t.core.pager.view.button.ViewPageUi(s,r),u=this;r.addUpdateEventListener(function(t,n,i,a){0===n.getExistsRecordCount()&&u._showNothingLabel(e)}),c.initialize(),r.initialize(),i.setVisible(!0),a.setVisible(!0),this._controllers.new=r}},_showNothingLabel:function(e){e.seekWidgetByName("nothing_label").setVisible(!0)},_hideNothingLabel:function(e){e.seekWidgetByName("nothing_label").setVisible(!1)}}),i.assign(t.pc.epi.epi_001.SceneDelegate.prototype,t.pc.roles.UIUtility,t.displayFilter.roles.DisplayFilterSceneController,t.pc.epi.roles.Routing)}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.epi=t.pc.epi||{},t.pc.epi.epi_002_003_004=t.pc.epi.epi_002_003_004||{},t.pc.epi.epi_002_003_004.Scene=t.BaseScene.extend({resourceFileName:"epi_002_3_4/epi_002_3_4.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"epi",sceneName:"epi_002_003_004",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_all_over","btnCallbackBtnAllOver",null,function(){alert("{{all_over_ui}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_arousal_after","btnCallbackBtnArousalAfter",null,function(){alert("{{UI}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_arousal_before","btnCallbackBtnArousalBefore",null,function(){alert("{{UI}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc=t.pc||{};var o=function(){return function(){alert("not implemented")}};t.pc.epi=t.pc.epi||{},t.pc.epi.epi_002_003_004=t.pc.epi.epi_002_003_004||{};var r={getSceneName:o(),getTargetEpisodes:o(),getTargetType:o(),getTargetMainImagePath:o(),getTargetHaremEpisodes:o(),getTargetCloseUPImagePath:o()};t.pc.epi.epi_002_003_004.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../epi_popup_ui.json"],_popups:{illustUp:{factoryName:"popupFactoryIllustUp",buttonLabels:{blackBtn:""},buttons:{blackBtn:function(){this.dismiss()}},onPopupOpened:function(e,t){e.setTitle(t.title),e.setImage(t.image)}},epiSceneCheck:{factoryName:"popupFactoryEpiSceneCheck"},epiStoryCheck:{factoryName:"popupFactoryEpiStoryCheck"},epiReplayCheck:{factoryName:"popupFactoryEpiReplayCheck"},epiApCheck:{factoryName:"popupFactoryEpiApCheck"},comRaidCheck:{factoryName:"popupFactoryComRaidCheck"},comNeedApBp1:{factoryName:"popupFactoryComNeedApBp1"},comNeedApBp2:{factoryName:"popupFactoryComNeedApBp2"},comApRestart:{factoryName:"popupFactoryComApRestart"},comAgeLimitB:{factoryName:"popupFactoryComAgeLimitB"},comCaution2:{factoryName:"popupFactoryBlue",title:"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(){this.dismiss()}},onPopupOpened:function(e,t){var n='<p style="padding: 0;margin: 0"><br /> </p><p class="red" style="pargin:0;margin:8px 0 0">[]<br />{{name}}Lv{{lv}}<br />{{prerequired}} </p>'.replace(/\{\{([^\}]+?)\}\}/g,function(e,n){return t[n]||""});e.setContent(n)}}},onSceneInit:function(e){t.createInstance("router").permanentlyRemoveRouterParam("payment_id");var n=function(){var e=t.createInstance("router").getCurrentFragment();return{epi_002:{delegateName:"epi002Delegate",paramKey:"character_id",verifyRouterParams:"_verifyRouterParams002"},epi_003:{delegateName:"epi003Delegate",paramKey:"summon_id",verifyRouterParams:"_verifyRouterParams003"},epi_004:{delegateName:"epi004Delegate",paramKey:"job_id",verifyRouterParams:"_verifyRouterParams004"}}[i.find(["epi_002","epi_003","epi_004"],function(t){return 0<e.indexOf(t)})]}();this[n.verifyRouterParams](e),this._owner=e;var o=e.routerParams.epi_001[n.paramKey];return this._params=n,this._subDelegate=this.__createSubDelegate(this._params.delegateName,o),this._setBackBtn(e),a.all([this._loadArousalInfo(),this._loadEpisodes()]).then(this._updateSubViews.bind(this,e))},__createSubDelegate:function(e,n){return t.createInstance(e,[n])||r},_loadArousalInfo:function(){return this._subDelegate.getArousalPromise().then(function(e){return this._arousalInfo=e,e}.bind(this))},_loadEpisodes:function(){return this._subDelegate.getTargetEpisodes().then(function(e){return this._episodeList=e,e}.bind(this))},_updateSubViews:function(e){return this._subDelegate.getTargetEpisodes().then(function(t){if(!(t.length<1)){var n=(t[0].harem_episode_info.heroines[0]||{name:""}).name;return this._updateHeader(e,n),this._updateBackground(e),this._updateEpisodes(e,t),this._updateButtons(e),t}console.error("")}.bind(this))},_changeHeroine:function(e,n){return this._subDelegate=this.__createSubDelegate(this._params.delegateName,n),this._updateSelectedId(e,this._params.paramKey,n),t.env.isSp?a.resolve().then(this._updateSubViews.bind(this,e)).then(e.animate.bind(e,"page_in",!1)):e.animate("page_out",!1).then(this._updateSubViews.bind(this,e)).then(e.animate.bind(e,"page_in",!1))},_updateSelectedId:function(e,n,a){var o=t.createInstance("router"),r=o.getCurrentFragment(),s=i.clone(e.routerParams);s.epi_001[n]=a,o.historyReplace(r,s)},onSceneEnter:function(e){return a.defer(),a.resolve()},onSceneExit:function(e){return a.defer(),this._subDelegate=null,this._owner=null,a.resolve()},btnCallbackBtnAllOver:function(e){var t=a.defer();t.reject(this._override);var n=this._subDelegate.getId(),i=this._subDelegate.getTargetType();return this._openAllOverPanel(n,0,i),t.promise},btnCallbackBtnArousalAfter:function(e){return this.__canChangeHeroineToAroused()&&this._changeHeroine(e,this._arousalInfo.arousedId),a.reject(this._override)},btnCallbackBtnArousalBefore:function(e){return this.__heroineIsAroused()&&this._changeHeroine(e,this._arousalInfo.baseId),a.reject(this._override)},_updateHeader:function(e,t){e.seekWidgetByName("header_base").setStrings({header_label:[" ",t||""," "].join("")})},_updateBackground:function(e){e.loadTextures({epimain:this._subDelegate.getTargetMainImagePath()})},_updateButtons:function(e){this._hideArousalAfterBtn(e),this._hideArousalBeforeBtn(e),this.__heroineIsAroused()?this._showArousalBeforeBtn(e):this.__canChangeHeroineToAroused()&&this._showArousalAfterBtn(e)},__heroineIsAroused:function(){return this._subDelegate.getId()===this._arousalInfo.arousedId},__canChangeHeroineToAroused:function(){return i.isNumber(this._arousalInfo.arousedId)&&0<this._arousalInfo.arousedId},_showArousalBeforeBtn:function(e){this.__showBtn(this._getArousalBeforeBtn(e))},_showArousalAfterBtn:function(e){this.__showBtn(this._getArousalAfterBtn(e))},_hideArousalBeforeBtn:function(e){this.__hideBtn(this._getArousalBeforeBtn(e))},_hideArousalAfterBtn:function(e){this.__hideBtn(this._getArousalAfterBtn(e))},_getArousalBeforeBtn:function(e){return e.seekWidgetByName("btn_arousal_before")},_getArousalAfterBtn:function(e){return e.seekWidgetByName("btn_arousal_after")},__showBtn:function(e){e&&e.setAppearance("show")},__hideBtn:function(e){e&&e.setAppearance("hide")},_updateEpisodes:function(e,o){var r=[],s=i.zipObject(["encounter","harem"],i.partition(o,function(e){return!!e.harem_episode_info&&e.harem_episode_info.is_story_of_encounter})),c={},u=i.map(["questlist_epi_ui_3","questlist_epi_ui_2","questlist_epi_ui_1","questlist_epi_ui_0"],function(t){return e.seekWidgetByName(t)},this);return c.harem=i.range(0,s.harem.length).map(function(){return u.pop()}).reverse(),c.encounter=i.range(0,s.encounter.length).map(function(){return u.pop()}).reverse(),i.each(u,function(e){e.removeAllChildren()}),i.each(i.zip([s.encounter,c.encounter]),function(e){var n=e[0],a=n.reward_info||{},o=e[1];o.removeAllChildren();var r=ccs.load(res["epi-epi_002_3_4-quest_list_white_ui"]),s=r.node;s.runAction(r.action),o.addChild(s),o.setVisible(!0),o.setStrings({quest_header_label:n.harem_episode_info.heroines[0].name+(this.__heroineIsAroused()?"\n":"\n")}),a.item_id&&o.seekWidgetByName("quest_reward").loadTexture(t.Img("rewardicon","item",i.padZero(a.item_id,4)).png);var c=t.createInstance("EpiQuestButton",[this._subDelegate.getTargetType(),n,!0]);c.setPopupDelegate(this);var u=o.seekWidgetByName("questlist_epi_base");u.addTouchEventListener(c.createListener()),u.setSound(t.SoundList.BUTTON_TOUCHED_DECIDE),u.setSoundEnabled(!0),n.is_cleared&&s.animate("cleared",!0)}.bind(this)),i.each(i.zip([s.harem,c.harem]),function(a,o){var s,c=a[0]||{quest_id:0},u=c.harem_episode_info||{},l=c.reward_info||{},_=a[1];_.removeAllChildren();var p=(s=c.is_r18?ccs.load(res["epi-questlist_epi_pink_ui"]):ccs.load(res["epi-epi_001-questlist_epi_blue_ui"])).node;p.runAction(s.action),_.addChild(p),_.setVisible(!0),_.setStrings({quest_header_label:c.title});var d=t.createInstance("episodeImage");r.push(d.loadTextureToImageView(_.seekWidgetByName("questimg"),c.type.replace(/cter$/,""),u.episode_id,1)),i.each(_.seekWidgets(function(e){return"clip_panel"===e._name}),function(e){e.setTouchEnabled(!1)});var h=_.seekWidgetByName("quest_reward"),m=_.seekWidgetByName("quest_reward_ability");if(l.item_id){var g="accessory"===l.reward_type?"acce":l.reward_type;h.setVisible(!0),h.loadTexture(t.Img("rewardicon",g,i.padZero(l.item_id,4)).png),m.setVisible(!1)}else"acquire_ability"===u.cleared_bonus_type?m.setVisible(!0):"strengthen_ability"===u.cleared_bonus_type&&m.setVisible(!0);if(_.seekWidgetByName("completed_icon").setVisible(!0),c.is_cleared?p.changeFrameWithAnimInfo("cleared","start"):p.changeFrameWithAnimInfo("not_clear","start"),c.is_opened){var f=t.createInstance("EpiQuestButton",[this._subDelegate.getTargetType(),c]);f.setPopupDelegate(this),_.seekWidgetByName("questlist_epi_base").setTouchEnabled(!0),_.seekWidgetByName("questlist_epi_base").addTouchEventListener(f.createListener())}else{i.invoke(i.map(["questlist_epi_base"],function(e){return _.seekWidgetByName(e)}),"setColor",n.color("#808080"));var b=u.condition_to_unlock||{heroine_name:u.heroines[0].name,level:9999999999};_.seekWidgetByName("questlist_epi_base").setTouchEnabled(!0),t.setTouchEventHandlers(_,{"TOUCH_ENDED questlist_epi_base":function(){e.popups.comCaution2.open({name:b.heroine_name,lv:b.level,prerequired:b.episode_title})}},this)}},this),a.all(r)},_showPopupIllustUp:function(){this.popups.illustUp.open({title:this._subDelegate.getTargetName(),image:this._subDelegate.getTargetCloseUpImagePath()})},_touchEndedBackBtnProcess:function(e){this._navigateToEpi001()},getPopup:function(e){if(!this._owner.popups[e])throw new Error("no such popup: ",e);return this._owner.popups[e]},getReturnBackParams:function(){return{scene:this._subDelegate.getSceneName(),routerParams:{epi_001:this._owner.routerParams.epi_001}}}}),i.assign(t.pc.epi.epi_002_003_004.SceneDelegate.prototype,t.pc.roles.RoutingCommon,t.pc.epi.roles.Routing,t.pc.roles.AllOverUI)}((this||0).self||global),function(e){var t=e.kh;t.pc.epi.epi_002_003_004=t.pc.epi.epi_002_003_004||{},t.pc.epi.epi_002_003_004.epi_002=t.pc.epi.epi_002_003_004.epi_002||{},t.pc.epi.epi_002_003_004.epi_002.SceneDelegate=cc.Class.extend({_characterId:0,ctor:function(e){this._characterId=e},getId:function(){return this._characterId},getSceneName:function(){return"epi/epi_002"},getTargetType:function(){return"chara"},getTargetMainImagePath:function(){return t.Img("illust-com-kneeshot","chara",_.padZero(this._characterId,4),0).png},getTargetEpisodes:function(){return t.createInstance("apiAQuests").getListHaremByCharacter(this._characterId).then(function(e){return e.body.data})},getArousalPromise:function(){return t.createInstance("apiALibrary").getCharacterArousal(this._characterId).then(function(e){return _(["base","aroused"]).map(function(t){return[t+"Id",e.body[t+"_character_id"]]}).zipObject().value()})}})}((this||0).self||global),function(e){var t=e.kh;t.pc.epi.epi_002_003_004=t.pc.epi.epi_002_003_004||{},t.pc.epi.epi_002_003_004.epi_003=t.pc.epi.epi_002_003_004.epi_003||{},t.pc.epi.epi_002_003_004.epi_003.SceneDelegate=cc.Class.extend({_summonId:0,ctor:function(e){this._summonId=e},getId:function(){return this._summonId},getSceneName:function(){return"epi/epi_003"},getTargetType:function(){return"summon"},getTargetMainImagePath:function(){return t.Img("illust-com-kneeshot","summon",_.padZero(this._summonId,4),0).png},getTargetEpisodes:function(){return t.createInstance("apiAQuests").getListHaremBySummon(this._summonId).then(function(e){return e.body.data})},getArousalPromise:function(){return Q.resolve({baseId:this.getId(),arousedId:-1})}})}((this||0).self||global),function(e){var t=e.kh;t.pc.epi.epi_002_003_004=t.pc.epi.epi_002_003_004||{},t.pc.epi.epi_002_003_004.epi_004=t.pc.epi.epi_002_003_004.epi_004||{},t.pc.epi.epi_002_003_004.epi_004.SceneDelegate=cc.Class.extend({_jobId:0,ctor:function(e){this._jobId=e},getId:function(){return this._jobId},getSceneName:function(){return"epi/epi_004"},getTargetType:function(){return"job"},getTargetMainImagePath:function(){return t.Img("illust-com-kneeshot","job",_.padZero(this._jobId,4),0).png},getTargetEpisodes:function(){return t.createInstance("apiAQuests").getListHaremByJob(this._jobId).then(function(e){return e.body.data})},getArousalPromise:function(){return Q.resolve({baseId:this.getId(),arousedId:-1})}})}((this||0).self||global),function(e){var t=e._,n=e.kh,i=1;n.PopupFactoryEpiSceneCheck=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-epi_scene_check",title:"",buttonLabels:{blackBtn:""},buttons:{blackBtn:function(){this.dismiss()}}},WIDGET_NAMES:{},POPUP_METHODS:{},_setup:{chara:function(e,t){n.createInstance("episodeImage").loadTextureToImageView(this.contentNode.seekWidgetByName("scene_img"),e.type.replace(/cter$/,""),e.harem_episode_info.episode_id,i)},summon:function(e){n.createInstance("episodeImage").loadTextureToImageView(this.contentNode.seekWidgetByName("scene_img"),e.type.replace(/cter$/,""),e.harem_episode_info.episode_id,i)},job:function(e){n.createInstance("episodeImage").loadTextureToImageView(this.contentNode.seekWidgetByName("scene_img"),e.type.replace(/cter$/,""),e.harem_episode_info.episode_id,i)},main_story:function(e){var i=this.contentNode.seekWidgetByName("scene_img");i&&i.loadTexture(n.Img("questimg","main-quest-battle",t.padZero(e.quest_id,4),e.battle_no).png)}},onPopupOpened:function(t,i){this._setup[i.type].call(t,i.record||{}),t.contentNode.setStrings({synopsis_label:i.record.description}),n.setTouchEventHandlers(t.contentNode,{"TOUCH_ENDED btn_play_scenario":function(){this.dismiss().then(function(){n.createInstance("router").navigate("scenario/episode-play",{"scenario/play":{episode_id:i.record.harem_episode_info.episode_id,harem_only:!0,returnBackParams:i.returnBackParams}})}.bind(this)).fail(function(t){e.console.error(t)})},"TOUCH_ENDED btn_play_scene":function(){this.dismiss().then(function(){n.createInstance("router").navigate("scenario/episode-play",{"scenario/play":{episode_id:i.record.harem_episode_info.episode_id,harem_only:!0,hscene_only:!0,returnBackParams:i.returnBackParams}})}.bind(this)).fail(function(t){e.console.error(t)})}},t)},create:function(e,i){return n.PopupFactory.prototype.create.call(this,t.assign(e,this.POPUP_PROPERTIES),i)},_addMethodsToPopup:function(e){n.PopupFactoryPopupCommon.prototype._addMethodsToPopup.call(this,e),t.assign(e,this.POPUP_METHODS)}})}((this||0).self||global),function(e){var t=e._,n=e.kh,i=1;n.PopupFactoryEpiStoryCheck=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-epi_story_check",title:"",buttonLabels:{blackBtn:"",blueBtn:""},buttons:{blackBtn:function(){this.dismiss()},blueBtn:function(){this.dismiss().then(function(){n.createInstance("router").navigate("scenario/episode-play",{"scenario/play":{episode_id:this.param.record.harem_episode_info.episode_id,harem_only:!0,returnBackParams:this.param.returnBackParams}})}.bind(this)).fail(function(t){e.console.error(t)})}},buttonSounds:{blueBtn:n.SoundList.BUTTON_TOUCHED_CONFIRMED}},POPUP_METHODS:{},_setup:{chara:function(e,t){n.createInstance("episodeImage").loadTextureToImageView(this.contentNode.seekWidgetByName("scene_img"),e.type.replace(/cter$/,""),e.harem_episode_info.episode_id,i)},summon:function(e){n.createInstance("episodeImage").loadTextureToImageView(this.contentNode.seekWidgetByName("scene_img"),e.type.replace(/cter$/,""),e.harem_episode_info.episode_id,i)},job:function(e){n.createInstance("episodeImage").loadTextureToImageView(this.contentNode.seekWidgetByName("scene_img"),e.type.replace(/cter$/,""),e.harem_episode_info.episode_id,i)},main_story:function(e){var i=this.contentNode.seekWidgetByName("scene_img");i&&i.loadTexture(n.Img("questimg","main-quest-battle",t.padZero(e.quest_id,4),e.battle_no).png)}},onPopupOpened:function(e,t){this._setup[t.type].call(e,t.record||{}),e.contentNode.setStrings({synopsis_label:t.record.description}),e.param=t},create:function(e,i){return n.PopupFactory.prototype.create.call(this,t.assign(e,this.POPUP_PROPERTIES),i)},_addMethodsToPopup:function(e){n.PopupFactoryPopupCommon.prototype._addMethodsToPopup.call(this,e),t.assign(e,this.POPUP_METHODS)}})}((this||0).self||global),function(e){var t=(e._,e.kh);$staticRes(res["core-popup-epi_replay_check"]),t.PopupFactoryEpiReplayCheck=t.PopupFactoryEpiStoryCheck.extend({onPopupOpened:function(e,t){this._setup[t.type].call(e,t.record||{}),e.param=t},_setupContentNode:function(e,t){console.debug(e,t),(t||{}).resourceName="core-popup-epi_replay_check",this._super(e,t)}})}((this||0).self||global),function(e){var t=e._,n=e.kh;n.PopupFactoryEpiApCheck=n.PopupFactoryTextOnly.extend({POPUP_PROPERTIES:{title:"",buttonLabels:{blackBtn:"",blueBtn:"OK"},buttons:{blackBtn:function(){this.dismiss()},blueBtn:function(){this.dismiss().then(function(){n.createInstance("questStateManager").startQuest(this.questId,this.questType)}.bind(this)).fail(function(t){e.console.error(t)})}},buttonSounds:{blueBtn:n.SoundList.BUTTON_TOUCHED_CONFIRMED}},onPopupOpened:function(e,i){var a;a=n.env.isR18?"<br /> {{episodeTitle}}<br /> ":"{{episodeTitle}}<br /> ",a=(a+='<br /><table class="nb"><tr><td class="numbox_middle_long" style="margin: 0 auto"><span class="white">{{beforeAP}}&rarr;</span><span class="yellow">{{afterAP}}</span></td></tr></table><br />').replace(/{{([^}]+?)}}/g,function(e,n){return t.isUndefined(i[n])?"":i[n]}),e.setContent(a),e.questId=i.questId,e.questType=i.questType},_addMethodsToPopup:function(e){n.PopupFactoryTextOnly.prototype._addMethodsToPopup.call(this,e),t.assign(e,this.POPUP_METHODS)}})}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="AJobs",o={get:function(e){return this._http.get({url:"/a_jobs/"+e})},getList:function(){return this._http.get({url:"/a_jobs"})},compare:function(e,t){return this._http.get({url:["/a_jobs",e,"compare_to",t].join("/")})},release:function(e){return this._http.post({url:"/a_jobs",json:{job_id:e}})},getADevice:function(){return this._http.get({url:"/a_jobs/laboratory"})},getADeviceLastPhase:function(e,t){return this._http.get({url:"/a_jobs/laboratory/final_phase_materials",json:{weapon_id:e,job_group_id:t}})},develop:function(e,t,n){return this._http.post({url:"/a_jobs/laboratory/"+e,json:{phase:t,a_weapon_id:n}})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiAJobs",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},o)),n.env.useApiMock){n.MockApi=n.MockApi||{};var r={};t.each(o,function(e,t){r[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi.AJobs."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},r))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="ALibrary",o={getCharacters:function(e,n){return this._http.get({url:"/a_library/characters",json:{page:e,per_page:n}}).then(function(e){var n=e.body.data;return t.each(n,function(e){delete e.aroused_character_id}),e})},getCharacter:function(e){return this._http.get({url:"/a_library/characters/"+e})},getOtherCharacters:function(e,t){return this._http.get({url:"/a_library/other_characters",json:{page:e,per_page:t}})},getOtherCharacter:function(e){return this._http.get({url:"/a_library/other_characters/"+e})},getSummons:function(e,t,n){var i={page:t,per_page:n};return void 0!==e&&(i.element_type=e),this._http.get({url:"/a_library/summons",json:i})},getSummon:function(e){return this._http.get({url:"/a_library/summons/"+e})},getWeapons:function(e,t,n,i){var a={page:n,per_page:i};return void 0!==e&&(a.weapon_type=e),void 0!==t&&(a.element_type=t),this._http.get({url:"/a_library/weapons",json:a})},getWeapon:function(e){return this._http.get({url:"/a_library/weapons/"+e})},getHaremCharacters:function(e,t,n){return this._http.get({url:"/a_library/character_episodes",json:{harem:!0,page:e,per_page:t,display_filter_name:n}})},getHaremJobs:function(e,t){return this._http.get({url:"/a_library/jobs",json:{harem:!0,page:e,per_page:t}})},getHaremSummons:function(e,t,n){return this._http.get({url:"/a_library/summon_episodes",json:{harem:!0,page:e,per_page:t,display_filter_name:n}})},getHaremMainQuests:function(e,t){return this._http.get({url:"/a_library/harem_main_quests",json:{page:e,per_page:t}})},getMainStories:function(){return this._http.get({url:"/a_library/main_stories"})},getStoryEpisodes:function(e,t){return this._http.get({url:"/a_library/story_episodes",json:{quest_id:e,quest_type:t}})},getEvents:function(){return this._http.get({url:"/a_library/event_stories"})},getEventEpisodes:function(e){return this._http.get({url:"/a_library/event_story_episodes",json:{event_id:e}})},getCharacterArousal:function(e){return this._http.get({url:["/a_library/characters",e,"arousal"].join("/"),json:{}})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiALibrary",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},o)),n.env.useApiMock){n.MockApi=n.MockApi||{};var r={};t.each(o,function(e,t){r[t]=function(){if(console.debug("[mock api]",t,JSON.stringify(arguments,null,"")),!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi."+a+"."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},r))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="HaremScenes",o={get:function(e){return this._http.get({url:"/harem_scenes/"+e})},getWithScenarioData:function(e){var t=Q.defer();return Q.all([this.get(e),n.createInstance("apiAPlayers").get("me")]).spread(function(e,i){if(e.body.is_r18&&!n.env.isR18)return e.body.scene_data="",void t.resolve(e);var a=n.env.scenarioRootBase+"/"+e.body.scenario_path,o=n._playerName,r=new XMLHttpRequest;r.open("GET",a,!0),r.onreadystatechange=function(){if(4===r.readyState){if(200!==r.status)return void t.reject(r.responseText);var n=r.responseText.replace(/](;[\s\n]*)/m,"]");o=o.replace(/[\"\'\\\\[\]]/g," ");var i=n.replace(/{{}}/g,o);e.body.scene_data=JSON5.parse(i),t.resolve(e)}},r.send(null)}).fail(function(e){console.error(e),t.reject(e)}),t.promise}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiHaremScenes",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},o)),n.env.useApiMock){n.MockApi=n.MockApi||{};var r={};t.each(o,function(e,t){r[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi."+a+"."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},r))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="Quests",o={getBattleInfo:function(e,t){return this._http.get({url:"/quests/"+t+"/battle_info",json:{type:e}})}};n.Api[a]=i.Class.extend(t.assign({className:"KHApiQuests",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},o));var r=["TutorialApi"];if(n.env.useApiMock&&r.push("MockApi"),t.each(r,function(e){n[e]=n[e]||{};var r={};t.each(o,function(t,i){r[i]=function(){if(!n[e])throw"kh."+e+"is not defined";if(!n[e][a][i+"JSON"])throw"not implemented: kh."+e+"."+a+"."+i;var t=Q.defer();return t.resolve({body:n[e][a][i+"JSON"].apply(this,arguments)}),t.promise}}),n[e][a]=i.Class.extend(t.assign({},r))}),"undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,n){n+="JSON";var i="tutorialMock";t.each(["mock",i],function(e){var t="./"+e+"/"+n+".js";if(s.existsSync(t))console.log("skip: file exists: "+t);else{console.log("generate: "+t);var o=c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,n);e===i&&(o=o.replace(/MockApi/g,"TutorialApi")),s.writeFileSync(t,o)}})}),process.exit()}}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="AMissions",o={getDaily:function(){return this._http.get({url:"/a_missions/daily"})},getWeekly:function(){return this._http.get({url:"/a_missions/weekly"})},getEvent:function(){return this._http.get({url:"/a_missions/event"})},receiveMissionReward:function(e,t){return this._http.post({url:["/a_missions",e,t,"receive"].join("/")})},getSummary:function(){return this._http.get({url:"/a_missions/summary"})},getTowerMissions:function(e,t){return this._http.get({url:"/a_missions/"+e+"/"+t})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiAMissions",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},o)),n.env.useApiMock){n.MockApi=n.MockApi||{};var r={};t.each(o,function(e,t){r[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi."+a+"."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},r))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="AEpicSubject",o={getEpicStatus:function(){return this._http.get({url:"/a_epic_subject"}).then(function(e){return new n.epic.model.EpicStatues(e.body)}).fail(function(e){console.error(e)})},getAEpicDetail:function(e){return this._http.get({url:"/a_epic_subject/"+e}).then(function(e){return new n.epic.model.AEpicDetail(e.body)}).fail(function(e){console.error(e)})},getAQuest:function(e){return this._http.get({url:"/a_quests",json:{type:n.quest.QUEST_TYPE.EPIC_QUEST,event_id:e}})},postUnlock:function(e){return this._http.post({url:"/a_epic_subject/"+e})}};n.Api[a]=i.Class.extend(t.assign({className:"KHApiAEpicSubject",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},o));var r=["TutorialApi"];if(n.env.useApiMock&&r.push("MockApi"),t.each(r,function(e){n[e]=n[e]||{};var r={};t.each(o,function(t,i){r[i]=function(){if(!n[e])throw"kh."+e+"is not defined";if(!n[e][a][i+"JSON"])throw"not implemented: kh."+e+"."+a+"."+i;var t=Q.defer();return t.resolve({body:n[e][a][i+"JSON"].apply(this,arguments)}),t.promise}}),n[e][a]=i.Class.extend(t.assign({},r))}),"undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,n){n+="JSON";var i="tutorialMock";t.each(["mock",i],function(e){var t="./"+e+"/"+n+".js";if(!s.existsSync(t)){var o=c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,n);e===i&&(o=o.replace(/MockApi/g,"TutorialApi")),s.writeFileSync(t,o)}})}),process.exit()}}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);e.Q,t.pc.list=t.pc.list||{},t.pc.list.roles=t.pc.list.roles||{},t.pc.list.roles.PageListControllerCommon={_fillupList:function(e,i,a,o,r,s,c){if(n.isUndefined(a))console.debug("[ERROR] Could not read record.");else if(n.isUndefined(o))console.debug("[ERROR] Could not read recordMax.");else if(n.isUndefined(i)&&(i={}),n.isUndefined(i.viewParent)&&(i.viewParent="page_list"),n.isUndefined(i.subPageRes))console.debug("[ERROR] not found resource. "+i.viewParent);else if(n.isUndefined(res[i.subPageRes]))console.debug("[ERROR] Could not find resource. "+i.subPageRes);else{n.isUndefined(i.panelsPerPage)&&(i.panelsPerPage=3);var u=e.seekWidgetByName(i.viewParent);if(null!==u){(g=u.getUserData())instanceof t.PageView&&g.cleanup();var l=i.panelsPerPage,_=Math.ceil(o/l),p=Math.min(_,5),d=this.__initPageUiNodes(u,i,p),h=this.__initPageList(d,_,p,i,s,r),m=Math.min(o,l*p);n.each(a.slice(0,m),this.__initRecord.bind(this,l,h)),n.each(n.range(m,l*p),this.__initRecord.bind(this,l,h,null));var g=this.__createPageListView(e,u,h,c);g.gotoFirstPage(),p>=_||g.addOnPageChangeCallback(function(e,t,n,i){for(var a=t-2,o=0;o<5;o++){var r=a+o;if(r<1){if(!i.isLoopContent())continue;r=n.length-r}if(r>n.length){if(!i.isLoopContent())continue;r-=n.length}n[r-1].setRecords(this.record,(r-1)*l)}},{record:a,perPage:l})}else console.debug("[ERROR] Could not find page view parent.")}},__initPageList:function(e,i,a,o,r,s){var c=this;return n.map(n.range(0,i),function(n){var i=e[n%a],u=new t.core.pager.view.page.ScrollPageLayer(i,r,s,c);return u.setName(o.subPageRes+"-"+n),u})},__initPageUiNodes:function(e,i,a){var o=e;return e.getChildren()[0]instanceof t.ScrollViewAbstract&&(o=e.getChildren()[0]),n.map(n.range(0,a),function(e){var n=o.getChildren()[e];return!n||0===n.getChildren().length||n.getContentSize().width<=0?ccs.load($dynamicRes(res[i.subPageRes])).node:n instanceof t.core.pager.view.page.ScrollPageLayer?n.getPageNode():n})},__initRecord:function(e,t,n,i){t[Math.floor(i/e)].setRecord(n,i)},__createPageListView:function(e,i,a,o){var r=new t.PageView;r.initialize(a,function(e,t){!n.isUndefined(o)&&n.isFunction(o)&&o(e,t)},this),i.removeAllChildrenWithCleanup(!0),i.addChild(r),i.setUserData(r);var s=[];return s[t.PAGE_CONTROLLER_CONTROLS.NEXT_BUTTON]="btn_down",s[t.PAGE_CONTROLLER_CONTROLS.PREVIOUS_BUTTON]="btn_up",s[t.PAGE_CONTROLLER_CONTROLS.NUMBER_DISPLAY]="page_current_num.page_max_num",(new t.PageControllerEx).init(e,s,r),r}}}((this||0).self||global),function(e){var t=e.kh;e.cc,e._,t.createNameSpaceIfNotExists("epic.view"),t.epic.view.EpicCheckPopup=t.ImplantedPopup.extend({_hasRequiredItems:!1,_initContents:function(e){this.setButtonEvents({btn_cancel:!1,btn_ok:!0});var n=this.getNode();n.bfsWidgetByName("eventimg_banner").loadTexture(e.getBannerURI()),n.bfsWidgetByName("btn_ok").setVisible(!1);var i=e.getRequiredItemModel();return this._hasRequiredItems=i.hasEnoughRequiredItems(),this._hasRequiredItems?void n.setHtmlStrings({need_item_labelimg:'<div class="text_common white"><div style="margin: 2px auto 4px;padding: 4px 0;">'+e.getEventName()+'</div><div style="margin: 2px auto 4px;padding: 4px 0;"><span class="yellow">'+i.getItemName()+'</span><span class="red">'+i.getRequiredAmount()+'</span></div><div style="margin: 16px auto 4px;padding: 4px 0;"><span class="orange"></span>'+i.getPossessedAmount()+'  <span class="red">'+(i.getPossessedAmount()-i.getRequiredAmount())+"</span></div></div>"},t.GameConfig.POPUP_CSS):(n.setStrings({shortage_label:i.getItemName()+""}),void n.setHtmlStrings({need_item_labelimg:'<div class="text_common white" style="margin: 2px auto 4px;padding: 4px 0;"><div style="margin: 2px auto 4px;padding: 4px 0;">'+e.getEventName()+'</div><div style="margin: 2px auto 4px;padding: 4px 0;"><span class="yellow">'+i.getItemName()+'</span><span class="red">'+i.getRequiredAmount()+'</span></div><div style="margin: 16px auto 4px;padding: 4px 0;"><span class="orange"></span>'+i.getPossessedAmount()+"</div></div>"},t.GameConfig.POPUP_CSS))},_openAnimation:function(){this._super.apply(this,arguments).then(function(){this.getNode().setAppearance(this._hasRequiredItems?"default_view":"item_shortage",!1)}.bind(this))},dismiss:function(){this._super.apply(this,arguments),this.getNode().bfsWidgetByName("need_item_labelimg").loadTexture(null),this.getNode().bfsWidgetByName("shortage_label").setString(" ")}}),t.dictx.registerWithProtoStrategy("EpicCheckPopup",t.epic.view.EpicCheckPopup)}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc.epic=t.pc.epic||{},t.pc.epic.controller=t.pc.epic.controller||{},t.pc.epic.controller.QuestPageListController={_popups:{comQuestInfo:{factoryName:"popupFactoryComQuestInfo"}},__fillupQuestList:function(e,n,i,a){var o=e.seekWidgetByName(n);if(null!==o){var r=this._initFuncPanel.bind(this);this._in_progress_id=this._pickInProgressAQuestId(this._questInfo);var s={targetNode:"quest_base",touchEventFuncName:i};if(this._fillupList(o,{viewParent:t.PageListParams.EPIC_QUEST_LIST.viewParent,subPageRes:t.PageListParams.EPIC_QUEST_LIST.subPageRes,panelsPerPage:t.PageListParams.EPIC_QUEST_LIST.perPage},a.data||[],a.max_record_count||0,s,r),0!==a.max_record_count){var c=o.seekWidgetByName("page_quest_list");null===c?console.warn("[ERROR] Not Found listNode"):c.setVisible(!0)}}else console.warn("[ERROR] Could not find a list parent node.")},_pickInProgressAQuestId:function(e){if(i.isEmpty(e)||i.isEmpty(e.in_progress))return null;var n=e.in_progress.own_quest;if(i.isEmpty(n))return null;switch(n.type){case t.quest.QUEST_TYPE.EPIC_QUEST:case t.quest.QUEST_TYPE.EPIC_BATTLE_QUEST:case t.quest.QUEST_TYPE.EPIC_SCENARIO_QUEST:return n.a_quest_id;default:return null}},_initFuncPanel:function(e,n){var a=n.type===t.quest.QUEST_TYPE.EPIC_SCENARIO_QUEST?"story":"battle";e.animate(a);var o=e.seekWidgetByName("questimg");if(null!==o&&!i.isUndefined(n.quest_id)){var r=t.Img("questimg","epic-quest",i.padZero(n.quest_id,4)).jpg;o.loadTexture(r)}var s=e.seekWidgetByName("quest_header_label");null===s||i.isUndefined(n.title)||s.setString(n.title);var c=e.seekWidgetByName("cons_ap_label");null===c||i.isUndefined(n.quest_ap)||c.setString("AP"+n.quest_ap);var u=e.seekWidgetByName("quest_reward");if(null!==u)if(n.is_cleared||i.isUndefined(n.reward_info)||i.isUndefined(n.reward_info.item_id))u.setVisible(!1);else{var l=t.Img("rewardicon","item",i.padZero(n.reward_info.item_id,4)).png;u.loadTexture(l),u.setVisible(!0)}var _=e.seekWidgetByName("cons_label");_.setVisible(!1),null===_||i.isUndefined(n.event_info)||i.isUndefined(n.event_info.type)||"quest_ap_half"===n.event_info.type&&(_.setString(t.WordBook.quest_ap_half),_.setVisible(!0));var p=e.seekWidgetByName("quest_time_label");null!==p&&(i.isString(n.time_left)&&n.time_left.length>0?(p.setString(n.time_left),p.setVisible(!0)):p.setVisible(!1));var d=e.seekWidgetByName("img_quest_info_icon");d&&this._initQuestInfoIcon(d,n)},_initQuestInfoIcon:function(e,t){var n=e.getParent();if(!i.isUndefined(t.is_new)&&!i.isUndefined(t.is_cleared)){var a=t.is_new||t.is_cleared,o=t.is_new?"core/res/icon/queststatusicon_new.png":t.is_cleared?"core/res/icon/queststatusicon_clear.png":"";e.loadTexture(o,ccui.Widget.PLIST_TEXTURE),e.setVisible(a),n.setVisible(a),t.is_new?n.animate("new",!0):n.animate("default",!1)}t.in_progress&&(e.setVisible(!0),n.setVisible(!0),e.loadTexture("core/res/icon/queststatusicon_now.png",ccui.Widget.PLIST_TEXTURE),n.animate("default",!1))},__setBalloonButtonEventHandler:function(e,t){var i=function(e,i){if(i===ccui.Widget.TOUCH_ENDED){var a=n.director.getRunningScene();"event_quest_main"===t.type?this._showQInfoPopup(a,t):this._qCaution3Popup(a,t)}}.bind(this);e.addTouchEventListener(i)},_showQInfoPopup:function(e,t){var n=e.popups.comQuestInfo,a=t.title,o=t.limit_info,r="";if(!i.isEmpty(o)){var s=[];i.isNumber(o.elixir)&&o.elixir>=0&&s.push(0!==o.elixir?":"+o.elixir+"":""),i.isNumber(o.rank)&&o.rank>=0&&s.push("Rank "+t.limit_info.rank+""),i.isNumber(o.remaining_challenge_count)&&o.remaining_challenge_count>=0&&s.push("  "+t.limit_info.remaining_challenge_count+""),r="[] "+s.join("\n")}n.open({title:a,description:t.description,start_condition:r}).fail(function(e){console.error(e)})},startQuest:function(e,n,i,a){return this._selectQuest.type===t.quest.QUEST_TYPE.EPIC_SCENARIO_QUEST?void this._startStoryQuest(e,n.a_quest_id,n.quest_id):void t.createInstance("router").navigate("quest/q_002",{q_002:{target:"quest",quest_id:n.quest_id,owner_account_id:n.owner_account_id,epic_id:this._getEpicId(e),quest_type:t.quest.QUEST_TYPE.EPIC_QUEST,episode_num:i,recommended_element_type:a}})},_startStoryQuest:function(e,n,a,o){this._targetParam={a_quest_id:n,quest_id:a,quest_type:t.quest.QUEST_TYPE.EPIC_QUEST,epic_subject_id:this._getEpicId(e)},this._supporterData={summon_info:{a_summon_id:0}},this.selectedEpisode={num:o},this._isLatestEpisode=!i.isUndefined(o),this._startQuest(e,0,this._supporterData)},_updateOtherInformation:function(){var e=t.createInstance("apiAQuestInfo"),n=t.createInstance("myselfInfoRepository");return a.all([e.get(),n.getQuestPoints(),n.getMe()]).spread(function(e,t,n){this._questInfo=e.body,this._questPoints=t.getAsObject(),this._player=n.body}.bind(this)).fail(function(e){console.error(e)})},clearOwnQuest:function(){delete this._questInfo.in_progress.own_quest}},i.assign(t.pc.epic.controller.QuestPageListController,t.pc.roles.CoreCardCommon,t.pc.list.roles.PageListControllerCommon)}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc,e.ccui,e._);e.console,t.createNameSpaceIfNotExists("epic.model"),t.epic.model.EpicBanner=t.core.pager.model.PlainData.extend({className:"EpicBanner",ctor:function(e){this._requiredItem=t.createInstance("QuestRequiredItemModel",[e.required_item]),this._super.apply(this,arguments)},getBannerId:function(){return this._rawData.banner_id},getEpicId:function(){return this._rawData.epic_id},isFirstAccess:function(){return!0===this._rawData.first_access},getPrologueQuestId:function(){return this._rawData.prologue_quest_id},getBannerURI:function(){return t.Img("eventimg","banner",n.padZero(this.getBannerId(),4)).png},getEventName:function(){return this._rawData.event_name},getRequiredItemModel:function(){return this._requiredItem},isUnlocked:function(){return this._rawData.is_unlocked||!1},unlock:function(){return this.isUnlocked()?Q.resolve():t.createInstance("apiAEpicSubject").postUnlock(this.getEpicId()).then(function(e){return this._rawData.is_unlocked=!0,e}.bind(this))}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc,e.ccui,e._);e.console,t.createNameSpaceIfNotExists("epic.model"),t.epic.model.EpicBannerList=t.core.pager.model.PlainDataList.extend({ctor:function(e,i){this._elementType=e,this._cachedModels=n.map(i||{},function(e){return new t.epic.model.EpicBanner(e)})}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc,e.ccui,e._),i=e.console;t.createNameSpaceIfNotExists("epic.model"),t.epic.model.EpicStatues=t.core.pager.model.PlainDataList.extend({ctor:function(e){this._subtutorialComponent="epic",this._description_images=[1,2],this._list={},n.each(e,function(e,n){return"description_images"===n?void(this._description_images=e):"sub_tutorial"===n?void(this._subtutorialComponent=e):void(this._list[n]=new t.epic.model.EpicBannerList(n,e))}.bind(this))},_list:null,getQuestList:function(e){return this._list[e]?this._list[e]:(i.warn("ElementType:"+e),new t.epic.model.EpicBannerList(e))},getSubturorialInfo:function(){return{component:this._subtutorialComponent,length:this._description_images.length}}})}((this||0).self||global),function(e){var t=e.kh;e.khutil,e.cc,e.ccui,e._,e.console,t.createNameSpaceIfNotExists("epic.model"),t.epic.model.AEpicDetail=t.core.pager.model.PlainData.extend({className:"AEpicDetail",getEpicId:function(){return this._rawData.epic_id},getEventId:function(){return this._rawData.event_id},getEpisodeId:function(){return this._rawData.introduction_episode_id},getEventName:function(){return this._rawData.event_name},getShopId:function(){return this._rawData.shop_id},getExistExchangeableItems:function(){return!0===this._rawData.exists_exchangeable_items},isFirstAccess:function(){return!0===this._rawData.first_access},firstAccess:function(){return this._rawData.first_access?Q.resolve():(this._rawData.first_access=!0,Q.resolve())},getInterChangeItem:function(e){return this._rawData.inter_change_items[e]},getJoinCharacters:function(){return this._rawData.join_characters||[]}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;t.createNameSpaceIfNotExists("epic.view"),t.epic.view.MaterialPanel=n.Class.extend({ctor:function(e){this._baseNode=e},display:function(e){var n=this._baseNode;[0,1].forEach(function(a){var o=n.bfsWidgetByName("material_panel_"+a),r=e.getInterChangeItem(a);if(i.isEmpty(r))o.setVisible(!1);else{var s=o.seekWidgetByName("corecard_item_ui_64"),c=t.createInstance("CoreCardItemUI",["plain",s]);c.setData({item_id:r.item_id}),o.setStrings({have_label:String(r.amount||0)});var u=o.seekWidgetByName("name_label");u&&u.setString(r.name),c.setVisible(!0),o.setVisible(!0)}})}})}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.epic=t.pc.epic||{},t.pc.epic.epic_quest_list=t.pc.epic.epic_quest_list||{},t.pc.epic.epic_quest_list.Scene=t.BaseScene.extend({resourceFileName:"epic_quest_list/epic_quest_list.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"epic",sceneName:"epic_quest_list",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_back_quest_top","btnCallbackBtnBackQuestTop",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"epic/epic_quest_top")),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.epic=t.pc.epic||{},t.pc.epic.epic_quest_top=t.pc.epic.epic_quest_top||{},t.pc.epic.epic_quest_top.Scene=t.BaseScene.extend({resourceFileName:"epic_quest_top/epic_quest_top.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"epic",sceneName:"epic_quest_top",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_quest","btnCallbackBtnQuest",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"epic/epic_quest_list")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_interchange","btnCallbackBtnInterchange",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"shop/sh_102")),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.epic=t.pc.epic||{},t.pc.epic.epic_select=t.pc.epic.epic_select||{},t.pc.epic.epic_select.Scene=t.BaseScene.extend({resourceFileName:"epic_select/epic_select.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[{tab1:{node:"tab_0","content-node":"tab_0_node"},tab2:{node:"tab_1","content-node":"tab_1_node"},tab3:{node:"tab_2","content-node":"tab_2_node"},tab4:{node:"tab_3","content-node":"tab_3_node"},tab5:{node:"tab_4","content-node":"tab_4_node"},tab6:{node:"tab_5","content-node":"tab_5_node"},tab7:{node:"tab_6","content-node":"tab_6_node"}}],componentName:"epic",sceneName:"epic_select",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_epic_info","btnCallbackBtnEpicInfo",null,function(){alert("{{}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc=t.pc||{},t.pc.epic=t.pc.epic||{},t.pc.epic.epic_quest_list=t.pc.epic.epic_quest_list||{},t.pc.epic.epic_quest_list.SceneDelegate=t.pc.BaseSceneDelegate.extend({_popups:{comBackCheck:{factoryName:"popupFactoryComBackCheck"}},onSceneInit:function(e){this._setBackBtn(e);var n=this._epicDetailModel,o=t.Img("raid-bg002","event",i.padZero(n.getEventId(),4)).jpg,r=e.seekWidgetByName("Scene");r.getChildByName("raid-bg002").loadTexture(o);var s=r.getChildByName("raid-bg003");return s&&(o=t.Img("raid-bg003","event",i.padZero(n.getEventId(),4)).jpg,s.loadTexture(o)),new t.epic.view.MaterialPanel(r.seekWidgetByName("bg_shadow_1")).display(n),this.questCommonDelegate=t.createInstance("questSceneCommonDelegate"),this.questCommonDelegate.owner=e,this.__fillupQuestList(e,"window_gray","_touchQuestPanel",this._aQuestList),a.resolve()},onSceneEnter:function(e){var n=this._getEpicId(e);if(!n)return t.createInstance("router").navigate("epic"),a.defer().promise;t.createInstance("router").permanentlyRemoveRouterParam("payment_id"),t.createInstance("popupFactoryComNeedApBp2").setEpicId(n);var i=this;return a.all([t.createInstance("apiAEpicSubject").getAEpicDetail(n).then(function(e){return i._epicDetailModel=e,t.createInstance("apiAEpicSubject").getAQuest(e.getEventId())}).then(function(e){i._aQuestList=e.body}),this._updateOtherInformation()])},onSceneExit:function(e){return a.resolve()},_touchQuestPanel:function(e,t){this.questCommonDelegate.restartCheckInProgressQuest(t,this._questInfo)||this.startCheckQuestState(n.director.getRunningScene(),t)},update:function(){t.createInstance("sceneManager").reloadScene()},_touchEndedBackBtnProcess:function(e){t.createInstance("router").navigate("epic/epic_quest_top",{},{epic_quest_top:{epicId:this._getEpicId(e)}})},_getEpicId:function(e){var t=e.temporaryRouterParams.epic_quest_list;return t&&t.epicId||e.routerParams.epic_id},btnCallbackBtnBackQuestTop:function(e){return this._touchEndedBackBtnProcess(e),a.reject(this._override)}}),t.assignRoles(t.pc.epic.epic_quest_list.SceneDelegate,[t.pc.roles.UIUtility,t.pc.epic.controller.QuestPageListController,t.pc.quest.roles.QuestStart,t.pc.quest.roles.QuestSelectCommon.methods,t.pc.quest.roles.QuestSelectCommon.popups])}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._,e.Q);t.pc=t.pc||{},t.pc.epic=t.pc.epic||{},t.pc.epic.epic_quest_top=t.pc.epic.epic_quest_top||{},t.pc.epic.epic_quest_top.SceneDelegate=t.pc.BaseSceneDelegate.extend({_popups:{},_epicDetailModel:null,onSceneInit:function(e){this._setBackBtn(e);var i=t.Img("epic-quest-top-bg","epic",this._getEpicId(e)).jpg;return e.seekWidgetByName("epic-quest-top-bg").loadTexture(i),this._epicDetailModel.then(function(i){return this._epicDetailModel=i,i.isFirstAccess()?(t.createInstance("router").navigate("epic"),n.defer().promise):(this._showInterChangeItems(e,i),this._showExchangeableLabelNode(e,i),void e.seekWidgetByName("header_label").setString(i.getEventName()))}.bind(this)).fail(function(e){e&&console.error(e)})},onSceneEnter:function(e){return e.temporaryRouterParams.epic_quest_top?(this._epicDetailModel=t.createInstance("apiAEpicSubject").getAEpicDetail(this._getEpicId(e)),n.resolve()):(t.createInstance("router").navigate("epic"),n.defer().promise)},onSceneExit:function(e){return n.resolve()},_touchEndedBackBtnProcess:function(e){t.createInstance("router").navigate("epic/epic_select")},_getEpicId:function(e){return e.temporaryRouterParams.epic_quest_top.epicId},_showInterChangeItems:function(e,n){var i=e.seekWidgetByName("interchange_base");new t.epic.view.MaterialPanel(i).display(n)},_showExchangeableLabelNode:function(e,t){var n=e.seekWidgetByName("attention_textimg");return null===n?void console.error("conquest.Treasure _showExchangeableLabelNode attentionTextImgNode is null"):void n.setVisible(t.getExistExchangeableItems())},btnCallbackBtnQuest:function(e){return t.createInstance("router").navigate("epic/epic_quest_list",{},{epic_quest_list:{epicId:this._getEpicId(e)}}),n.reject(this._override)},btnCallbackBtnInterchange:function(e){return t.createInstance("router").navigate("shop/sh_102",{sh_102:{shop_id:this._epicDetailModel.getShopId()}},{sh_102:{returnPageRoute:"epic/epic_quest_top",temporaryRouterParams:e.temporaryRouterParams}}),n.reject(this._override)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc=t.pc||{},t.pc.epic=t.pc.epic||{},t.pc.epic.epic_select=t.pc.epic.epic_select||{},t.pc.epic.epic_select.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../epic_popup_ui.json"],_popups:{},onSceneInit:function(e){return this._setBackBtn(e),this._firstAccessPromise.then(this.btnCallbackBtnEpicInfo.bind(this,e)).fin(function(){this._firstAccessPromise=null}.bind(this)),a.resolve()},onSceneEnter:function(e){this._epicStatuesModel=t.createInstance("apiAEpicSubject").getEpicStatus();var n=t.createInstance("apiASubTutorialPages");return this._firstAccessPromise=n.get("epic_select").then(function(e){return e.body.visited?a.reject():n.visited("epic_select")}.bind(this)).fail(function(e){return e&&console.error(e),a.reject()}),a.resolve()},onSceneExit:function(e){return a.resolve()},_touchEndedBackBtnProcess:function(e){t.createInstance("router").navigate("quest/q_portal_top")},tabCallbackTab0:function(e){this.createBannerList(e,0,t.WordBook.ELEMENT_TYPE_LIST.flame.num)},tabCallbackTab1:function(e){this.createBannerList(e,1,t.WordBook.ELEMENT_TYPE_LIST.water.num)},tabCallbackTab2:function(e){this.createBannerList(e,2,t.WordBook.ELEMENT_TYPE_LIST.wind.num)},tabCallbackTab3:function(e){this.createBannerList(e,3,t.WordBook.ELEMENT_TYPE_LIST.thunder.num)},tabCallbackTab4:function(e){this.createBannerList(e,4,t.WordBook.ELEMENT_TYPE_LIST.darkness.num)},tabCallbackTab5:function(e){this.createBannerList(e,5,t.WordBook.ELEMENT_TYPE_LIST.light.num)},tabCallbackTab6:function(e){this.createBannerList(e,6,t.WordBook.ELEMENT_TYPE_LIST.phantom.num)},btnCallbackBtnEpicInfo:function(e){return this._epicStatuesModel.then(function(n){var i=n.getSubturorialInfo();t.ImplantedPopup.createOrGet(e,"sub_tutorial","ImplantedSubTutorialPopup").open(i.component,i.length)}),a.reject(this._override)},createBannerList:function(e,n,i,a){var o=e.seekWidgetByName("tab_"+n+"_node"),r=o.getParent().bfsWidgetByName("nothing_label");r.setVisible(!1);var s=o.bfsWidgetByName(t.PageListParams.EPIC_SELECT_LIST.viewParent);!a&&s.getUserData()instanceof t.PageView||this._epicStatuesModel.then(function(e){return e.getQuestList(i).getAllContent()}).then(function(n){if(!e.disposed)return 0===n.length?(r.setVisible(!0),void o.bfsWidgetByName("btn_change_page_a_ui").setVisible(!1)):void this._fillupList(o,{viewParent:t.PageListParams.EPIC_SELECT_LIST.viewParent,subPageRes:t.PageListParams.EPIC_SELECT_LIST.subPageRes,panelsPerPage:t.PageListParams.EPIC_SELECT_LIST.perPage},n,n.length,{targetNode:"eventimg_banner",touchEventFuncName:"_touchBanner"},this._panelAppearanceForCommon)}.bind(this))},_touchBanner:function(e,o){if(o.isUnlocked())this._navigateEpicQuestTop(o);else{var r=n.director.getRunningScene();t.ImplantedPopup.createOrGet(r,"epic_check").open(o).then(function(){return o.unlock()}).then(function(e){if(!1===e.body.result&&!i.isEmpty(e.body.reason))return t.createInstance("popupFactoryTextOnly").create({title:"",content:e.body.reason,buttonLabels:{blackBtn:""},buttons:{blackBtn:function(){this.dismiss()}}}),a.reject()}).then(this._panelAppearanceForCommon.bind(this,e,o)).then(this._navigateEpicQuestTop.bind(this,o)).fail(function(e){e&&console.error(e)})}},_navigateEpicQuestTop:function(e){return e.isFirstAccess()?void t.createInstance("questStateManager").startQuest(e.getPrologueQuestId(),t.quest.QUEST_TYPE.EPIC_QUEST):void t.createInstance("router").navigate("epic/epic_quest_top",{},{epic_quest_top:{epicId:e.getEpicId()}})},_panelAppearanceForCommon:function(e,n,i){var a=n.getBannerURI(),o=e.seekWidgetByName("eventimg_banner");return null===o?void console.warn("[ERROR] Could not find eventimg_banner"):(o.loadTextures(a,a,a),e.seekWidgetByName("lock_icon").setVisible(!n.isUnlocked()),void t.pc.roles.UIUtility._setGrayShader(o,!n.isUnlocked()))}}),i.assign(t.pc.epic.epic_select.SceneDelegate.prototype,t.pc.list.roles.PageListControllerCommon)}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.router=n.router||{},n.router.routes=n.router.routes||{},t.merge(n.router.routes,{epic:{epic:"epic_select","epic/epic_quest_list":"epic_quest_list","epic/epic_select":"epic_select","epic/epic_quest_top":"epic_quest_top"}})}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.event=t.pc.event||{},t.pc.event.ev_000=t.pc.event.ev_000||{},t.pc.event.ev_000.Scene=t.BaseScene.extend({resourceFileName:"ev_000/ev_000.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[{tab1:{node:"tab_0","content-node":"tab_0_node"},tab2:{node:"tab_1","content-node":"tab_1_node"}}],componentName:"event",sceneName:"ev_000",_delegate:null,_init:function(){this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._),i=e.Q;t.pc=t.pc||{},t.pc.event=t.pc.event||{},t.pc.event.ev_000=t.pc.event.ev_000||{},$staticRes(res["event-ev_000-ev_000_eventlist_page_ui"]),t.pc.event.ev_000.SceneDelegate=t.pc.BaseSceneDelegate.extend({_popups:{},onSceneInit:function(e){return this._setBackBtn(e),i.resolve()},_fillupEventBannerList:function(e,n,i){var a;a=n>0?t.createInstance("apiABanners").getEventAfterPeriodBanners():t.createInstance("apiABanners").getEventOnPeriodBanners();var o=e.seekWidgetByName("tab_"+n+"_node");return a.then(function(e){var n={touchEventFuncName:i};this._fillupList(o,{viewParent:t.PageListParams.EVENT_BANNER.viewParent,subPageRes:t.PageListParams.EVENT_BANNER.subPageRes,panelsPerPage:t.PageListParams.EVENT_BANNER.perPage},e.body.data,e.body.max_record_count,n,this._panelAppearanceForCommon)}.bind(this)).fail(function(e){console.error(e.stack)})},_panelAppearanceForCommon:function(e,i,a){var o=t.Img("eventimg","banner",n.padZero(i.banner_id,4)).png,r=a%4,s=e.seekWidgetByName("eventimg_banner_"+r);return null===s?void console.debug("[ERROR] Could not find eventimg_banner"):void s.loadTextures(o,o,o)},onSceneEnter:function(e){return i.defer(),i.resolve()},onSceneExit:function(e){return i.defer(),i.resolve()},onPageInAnimationEnd:function(e){return i.defer(),i.resolve()},tabCallbackTab0:function(e){this._fillupEventBannerList(e,0,"_eventBannerTouchEvent")},tabCallbackTab1:function(e){this._fillupEventBannerList(e,1,"_eventBannerTouchEvent")},_eventBannerTouchEvent:function(e,i){console.log(e,i);var a=i.navigate_page;console.log(a);var o={};o[n.last(a.split("/"))]={id:i.banner_id,navigate_page:i.navigate_page,event_id:i.event_id,item_id:i.item_id},t.createInstance("router").navigate(a,o,{event_id:i.event_id,item_id:i.item_id})},_touchEndedBackBtnProcess:function(e){t.createInstance("router").navigate("mypage/my_001")}}),n.assign(t.pc.event.ev_000.SceneDelegate.prototype,t.pc.list.roles.PageListControllerCommon)}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="AExchangeItemShop",o="/a_exchange_item_shop",r={getDetail:function(e){return this._http.get({url:o+"/detail",json:{item_id:e}})},getSummonContents:function(e,t,n){return this._http.get({url:o,json:{item_id:e,type:"summon",page:t,per_page:n}})},getWeaponContents:function(e,t,n){return this._http.get({url:o,json:{item_id:e,type:"weapon",page:t,per_page:n}})},postExchange:function(e,t,n){return this._http.post({url:o+"/exchange",json:{content_id:e,kind:t,exchange_item_id:n}})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiAExchangeItemShop",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},r)),n.env.useApiMock){n.MockApi=n.MockApi||{};var s={};t.each(r,function(e,t){s[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi."+a+"."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},s))}if("undefined"!=typeof process&&"undefined"!=typeof require){var c=require("fs"),u=c.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(r,function(e,t){var n="./mock/"+(t+="JSON")+".js";return c.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void c.writeFileSync(n,u.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.router=n.router||{},n.router.routes=n.router.routes||{},t.merge(n.router.routes,{exchangeitem:{exchangeitem:"exchit_001","exchangeitem/exchit_001":"exchit_001"}})}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.exchangeitem=t.pc.exchangeitem||{},t.pc.exchangeitem.exchit_001=t.pc.exchangeitem.exchit_001||{},t.pc.exchangeitem.exchit_001.Scene=t.BaseScene.extend({resourceFileName:"exchit_001/exchit_001.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[{tab1:{node:"tab_0","content-node":"tab_0_node"},tab2:{node:"tab_1","content-node":"tab_1_node"}}],componentName:"exchangeitem",sceneName:"exchit_001",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_gacha","btnCallbackBtnGacha",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"gacha/ga_000")),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc=t.pc||{},t.pc.exchangeitem=t.pc.exchangeitem||{},t.pc.exchangeitem.exchit_001=t.pc.exchangeitem.exchit_001||{},t.pc.exchangeitem.exchit_001.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../exchit_popup_ui.json"],_popups:{},_detailPromise:null,_weaponListModel:null,onSceneInit:function(e){this._setBackBtn(e);var t=this._getItemId();return this.hasSummonContents=!1,this._setWeaponContents(e,t),a.all([this._disableAllExchangeBtnsIfNoTicket(e,t),this._detailPromise.then(function(t){var n=t.body;this._setEventId(n.gacha_event_id),this._setTicketAmount(e,n.exchange_item_amount),this._setGachaBtn(e,n.can_excec_gacha,n.gacha_event_id)}.bind(this))]).fail(function(e){console.error(e)})},_disableAllExchangeBtnsIfNoTicket:function(e,t){return this._getTicketList().then(function(e){return e.filter(function(e){return e.item_id===t})}).then(function(t){0<t.length||this._disableAllExchangeBtns(e)}.bind(this))},_getTicketList:function(){return t.createInstance("apiAItems").getTicket().then(function(e){return e.body.data}).fail(function(e){console.error(e),a.reject(e)})},_disableAllExchangeBtns:function(e){this._eachAllExchangeBtns(e,function(e){e.setColor(n.color("#808080")),e.setEnabled(!1)})},_eachAllExchangeBtns:function(e,t){i.each(e.seekWidgets(function(e){return"btn_exchange"===e.name}),t)},_getItemId:function(){var e=n.director.getRunningScene();return e.routerParams.exchit_001.item_id||e.routerParams.exchit_001.id},_getEventId:function(){return this.eventId},_setEventId:function(e){this.eventId=e},onSceneEnter:function(e){var n=this._getItemId();return this._detailPromise=t.createInstance("apiAExchangeItemShop").getDetail(n),this._weaponListModel=t.core.pager.model.ApiDataListFactory("apiAExchangeItemShop","getWeaponContents",[n,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE]),this._weaponListModel.initialize()},tabCallbackTab0:function(e){},tabCallbackTab1:function(e){if(!this.hasSummonContents){var t=this._getItemId();this._setSummonContents(e,t),this.hasSummonContents=!0}},btnCallbackBtnGacha:function(e){var n=a.defer();return n.reject(this._override),t.createInstance("router").navigate("gacha"),n.promise},_setTouchWeaponEvent:function(e,i){var a=n.director.getRunningScene();t.setTouchEventHandlers(e,{"TOUCH_ENDED btn_exchange":function(){this._onTouchExchangeBtn(a,i)}.bind(this)},this),t.setTouchEventHandlers(e,{"TOUCH_ENDED weapon_img":function(){this._onTouchWeaponImg(a,i)}.bind(this)},this),t.setTouchEventHandlers(e,{"TOUCH_ENDED chara_img":function(){this._onTouchCharacterImg(a,i)}.bind(this)},this)},_onTouchExchangeBtn:function(e,n){var i=this._getItemId(),a=t.createInstance("ExchangeContentItemModel",[n]);t.createInstance("ExchangeController",[a,i]).beginExchangeProcess()},_onTouchWeaponImg:function(e,n){var i=this._getItemId(),a=this._getNavigateFromStatus(e);t.createInstance("router").navigate("status/status_002",{status_002:{id:n.content_id,exchitItemId:i,isFromExchange:!0}},a)},_onTouchCharacterImg:function(e,n){var i=this._getItemId(),a=t.createInstance("router").getCurrentFragment(),o=this._getReturnParams(e);t.createInstance("router").navigate("status/status_001",{status_001:{id:n.release_character.character_id,exchitItemId:i,isFromExchange:!0,returnRoute:a,returnParams:o}})},_onTouchSummonImg:function(e,n){var i=this._getItemId(),a=this._getNavigateFromStatus(e);t.createInstance("router").navigate("status/status_003",{status_003:{id:n.content_id,exchitItemId:i,isFromExchange:!0}},a)},_getNavigateFromStatus:function(e){var n=e.tabDelegateList[0].selected;return e.temporaryRouterParams.restoreParams={tabs:[n]},{routes:t.createInstance("router").getCurrentFragment(),temporaryRouterParams:e.temporaryRouterParams}},_getReturnParams:function(e){var t=e.tabDelegateList[0].selected;return e.temporaryRouterParams.restoreParams={tabs:[t]},e.temporaryRouterParams},_setTicketAmount:function(e,t){e.seekWidgetByName("header_sub_label").setText(":"+t+"")},_setGachaBtn:function(e,t,n){var i=e.seekWidgetByName("btn_gacha");return t?void i.setVisible(!0):void i.setVisible(!1)},_setWeaponContents:function(e,n){var i=e.seekWidgetByName("tab_0_node"),a=i.seekWidgetByName("exchit_001_exchangeitemlist_page_ui"),o=new t.exchangeitem.exchange.view.WeaponPagerUi(a,e,this),r=this._weaponListModel;this._weaponListModel=null;var s=new t.core.pager.controller.PagerController(i,r,[o],a),c=i.seekWidgetByName("viewpage_ui");return new t.core.pager.view.button.ViewPageUi(c,s).initialize(),a.setVisible(!0),i.seekWidgetByName("list_node").setVisible(!0),s.initialize()},_setSummonContents:function(e,n){var i=e.seekWidgetByName("tab_1_node"),a=i.seekWidgetByName("exchit_001_exchangeitemlist_page_ui"),o=new t.exchangeitem.exchange.view.SummonPagerUi(a,e,this),r=t.core.pager.model.ApiDataListFactory("apiAExchangeItemShop","getSummonContents",[n,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE]),s=new t.core.pager.controller.PagerController(i,r,[o],a),c=i.seekWidgetByName("viewpage_ui");return new t.core.pager.view.button.ViewPageUi(c,s).initialize(),a.setVisible(!0),i.seekWidgetByName("list_node").setVisible(!0),s.initialize()},_touchEndedBackBtnProcess:function(e){t.createInstance("router").navigate("gacha/ga_000")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=(e.ccui,e._),a=e.console;t.createNameSpaceIfNotExists("exchangeitem.exchange.view"),t.exchangeitem.exchange.view.SummonPagerUi=t.core.pager.view.page.BasePageUi.extend({_scene:null,_sceneDelegate:null,ctor:function(e,t,n){this._super(e),this._scene=t,this._sceneDelegate=n},_updateOne:function(e,t,n){var i=t.getRawData();this._setSummonImg(e,i),this._setSummonName(e,i),this._unsetCharacterNode(e),this._setSummonCaution(e,i),this._setTouchSummonEvent(e,i),e.setVisible(!0)},_setSummonImg:function(e,n){var i=e.seekWidgetByName("corecard_summon_ui"),a=t.createInstance("CoreCardSummonUI",["e_r",i]);a.setImg(n.content_id,0),a.setIconElement(n.element_type),a.setIconRarity(n.rare),e.seekWidgetByName("corecard_summon_ui").setVisible(!0),e.seekWidgetByName("summon_node").setVisible(!0)},_setSummonName:function(e,t){this._getNodeByName("exchit_header_label",e).setText(t.name)},_unsetCharacterNode:function(e){this._getNodeByName("corecard_base",e).setVisible(!1),this._getNodeByName("red_shadow",e).setVisible(!1),this._getNodeByName("exchit_arrow",e).setVisible(!1)},_setSummonCaution:function(e,t){var n=this._getNodeByName("summon_node",e),i=this._getNodeByName("cons_label",n);t.is_owned?i.setVisible(!0):i.setVisible(!1)},_setTouchSummonEvent:function(e,n){var i=this._scene,a=this._sceneDelegate;t.setTouchEventHandlers(e,{"TOUCH_ENDED btn_exchange":a._onTouchExchangeBtn.bind(a,i,n)},a),t.setTouchEventHandlers(e,{"TOUCH_ENDED summon_img":a._onTouchSummonImg.bind(a,i,n)},a)},_getNodeByName:function(e,t){i.isUndefined(t)&&(t=n.director.getRunningScene());var o=t.seekWidgetByName(e);return o||a.warn("SummonPagerUi: node '"+e+"' not found"),o},dispose:function(){this._scene=null,this._sceneDelegate=null,this._super()}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=(e.ccui,e._),a=e.console;t.createNameSpaceIfNotExists("exchangeitem.exchange.view"),t.exchangeitem.exchange.view.WeaponPagerUi=t.core.pager.view.page.BasePageUi.extend({_scene:null,_sceneDelegate:null,ctor:function(e,t,n){this._super(e),this._scene=t,this._sceneDelegate=n},_updateOne:function(e,t,n){var i=t.getRawData();this._setWeaponImg(e,i),this._setWeaponName(e,i),this._setTouchWeaponEvent(e,i),this._setCharacter(e,i.release_character),e.setVisible(!0)},_setWeaponImg:function(e,n){var i=e.seekWidgetByName("corecard_weapon_ui"),a=t.createInstance("CoreCardWeaponUI",["e_r",i]);a.setAroused(!1),a.setImg(n.content_id,0),a.setIconElement(n.element_type),a.setIconRarity(n.rare),e.seekWidgetByName("corecard_weapon_ui").setVisible(!0)},_setWeaponName:function(e,t){this._getNodeByName("exchit_header_label",e).setText(t.name)},_setTouchWeaponEvent:function(e,n){var i=this._scene,a=this._sceneDelegate;t.setTouchEventHandlers(e,{"TOUCH_ENDED btn_exchange":a._onTouchExchangeBtn.bind(a,i,n)},a),t.setTouchEventHandlers(e,{"TOUCH_ENDED weapon_img":a._onTouchWeaponImg.bind(a,i,n)},a),t.setTouchEventHandlers(e,{"TOUCH_ENDED chara_img":a._onTouchCharacterImg.bind(a,i,n)},a)},_setCharacter:function(e,t){this._setCharacterImg(e,t),this._setCharacterName(e,t),this._setCharacterCaution(e,t)},_setCharacterImg:function(e,n){var i=e.seekWidgetByName("corecard_chara_ui"),a=t.createInstance("CoreCardCharacterUI",["e_r",i]);return n?(a.setAroused(!1),a.setImg(n.character_id,n.skin||0),a.setIconElement(n.element_type),a.setIconRarity(n.rare),void e.seekWidgetByName("corecard_chara_ui").setVisible(!0)):void a.setVisible(!1)},_setCharacterName:function(e,t){var n=this._getNodeByName("chara_name_label",e);return t?void n.setText(t.name):void n.setText("")},_setCharacterCaution:function(e,t){this._getNodeByName("cons_label",e).setVisible(t&&t.is_owned)},_getNodeByName:function(e,t){i.isUndefined(t)&&(t=n.director.getRunningScene());var o=t.seekWidgetByName(e);return o||a.warn("WeaponPagerUi: node '"+e+"' not found"),o},dispose:function(){this._scene=null,this._sceneDelegate=null,this._super()}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e.console;t.createNameSpaceIfNotExists("exchangeitem.exchange"),t.exchangeitem.exchange.Controller=n.Class.extend({className:"ExchangeController",ctor:function(e,t){this._contentItemModel=e,this._exchangeItemId=t},beginExchangeProcess:function(){return this._showExchangePopup().then(this._exchange.bind(this)).then(this._showResult.bind(this)).fail(function(e){e&&i.error(e&&e.stack?e.stack:e)})},_showExchangePopup:function(){return this._createExhangePopupController().showExchangePopup(this._contentItemModel)},_exchange:function(){var e=this._contentItemModel.getId(),t=this._contentItemModel.getKind();return this._createExchangeItemApi().postExchange(e,t,this._exchangeItemId).fail(function(e){i.error(e&&e.stack?e.stack:e)})},_showResult:function(e){return e?this._createExchangeResultController().showExchangeResult(this._contentItemModel):Q.reject("KHExchangeController._showResultPopup: exchange failed!")},_createExhangePopupController:function(){return t.createInstance("ExchangePopupController")},_createExchangeResultController:function(){return t.createInstance("ExchangeResultController")},_createExchangeItemApi:function(){return t.createInstance("apiAExchangeItemShop")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("exchangeitem.exchange"),t.exchangeitem.exchange.ContentItemModel=n.Class.extend({className:"ExchangeContentItemModel",ctor:function(e){this._rawExchangeItemData=e},getKind:function(){return this._rawExchangeItemData.kind},getId:function(){return this._rawExchangeItemData.content_id},getName:function(){return this._rawExchangeItemData.name},getRarity:function(){return this._rawExchangeItemData.rare},getElementType:function(){return this._rawExchangeItemData.element_type},isOwned:function(){return this._rawExchangeItemData.is_owned},getSkin:function(){return this._rawExchangeItemData.skin||0},getReleasedCharacter:function(){return this._rawExchangeItemData.release_character?t.createInstance("ExchangeReleaseCharacterModel",[this._rawExchangeItemData.release_character]):null},getRawData:function(){return this._rawExchangeItemData}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("exchangeitem.exchange"),t.exchangeitem.exchange.ReleaseCharacterModel=n.Class.extend({className:"ExchangeReleaseCharacterModel",ctor:function(e){this._rawCharacterData=e},getId:function(){return this._rawCharacterData.character_id},getKind:function(){return"character"},getName:function(){return this._rawCharacterData.name},getRarity:function(){return this._rawCharacterData.rare},getElementType:function(){return this._rawCharacterData.element_type},isOwned:function(){return this._rawCharacterData.is_owned},getSkin:function(){return this._rawCharacterData.skin||0},getRawData:function(){return this._rawCharacterData}})}((this||0).self||global),function(e){var t=(e._,e.kh);e.console,t.createNameSpaceIfNotExists("exchangeitem.exchange"),t.exchangeitem.exchange.CoreCardView=cc.Class.extend({className:"ExchangeCoreCardView",ctor:function(e,t){this._contentItemModel=e,this._parentWidget=t},show:function(){this._showCoreCard(this._contentItemModel)},clearContents:function(){this._clearCoreCard()},getWidget:function(){return null==this._coreCard?null:this._coreCard.getResult()},_showCoreCard:function(e){var t=e.getKind(),n=this._getCoreCardByKind(t),i=e.getId(),a=e.getSkin(),o=e.getElementType(),r=e.getRarity();n.setImg(i,a),n.setIconElement(o),n.setIconRarity(r),this._coreCard=n},_clearCoreCard:function(){this._coreCard.clearImg(),this._coreCard.initAction("plain"),this._coreCard=null},_getCoreCardByKind:function(e){var n={summon:"CoreCardSummonUI",weapon:"CoreCardWeaponUI",character:"CoreCardCharacterUI"}[e];return t.createInstance(n,["e_r",this._parentWidget])}})}((this||0).self||global),function(e){var t=(e._,e.kh),n=e.console;t.createNameSpaceIfNotExists("exchangeitem.exchange.confirm"),t.exchangeitem.exchange.confirm.ContentItemView=cc.Class.extend({className:"ExchangeContentItemView",WIDGET_NAMES:{CORECARD:"",NAME:""},ctor:function(e,t){this._parentWidget=e,this._contentItemModel=t},show:function(){this._showCoreCard(),this._showName()},clearContents:function(){this._clearCoreCard(),this._clearName()},_showCoreCard:function(){this._coreCardView=this._createCoreCardView(),this._coreCardView.show()},_clearCoreCard:function(){this._coreCardView.clearContents(),this._coreCardView=null},_showName:function(){var e=this._contentItemModel.getName();this._setStringToWidget(e,this.WIDGET_NAMES.NAME)},_clearName:function(){this._setStringToWidget("",this.WIDGET_NAMES.NAME)},_createCoreCardView:function(){var e=this._getCoreCardRootWidget();return this._coreCardView=t.createInstance("ExchangeItemCoreCardView",[this._contentItemModel,e])},_getCoreCardRootWidget:function(){var e=this._parentWidget.seekWidgetByName(this.WIDGET_NAMES.CORECARD);return null==e?(n.warn("KHExchangeContentItemView._getCorecardRootWidget: widget not found"),null):e},_setStringToWidget:function(e,t){var i=this._parentWidget.seekWidgetByName(t);return null==i?void n.warn("KHExchangeContentItemView._setStringToWidget: widget {"+t+"} not found"):void i.setString(e)},_getCoreCardByKind:function(e,n){var i={summon:"CoreCardSummonUI",weapon:"CoreCardWeaponUI",character:"CoreCardCharacterUI"}[n];return t.createInstance(i,["e_r",e])}})}((this||0).self||global),function(e){var t=(e._,e.kh);t.createNameSpaceIfNotExists("exchangeitem.exchange.confirm"),t.exchangeitem.exchange.confirm.ContentSummonView=t.exchangeitem.exchange.confirm.ContentItemView.extend({className:"ExchangeContentSummonView",WIDGET_NAMES:{CORECARD:"corecard_summon_ui",NAME:"summon_name_label"}})}((this||0).self||global),function(e){var t=(e._,e.kh);t.createNameSpaceIfNotExists("exchangeitem.exchange.confirm"),t.exchangeitem.exchange.confirm.ContentWeaponView=t.exchangeitem.exchange.confirm.ContentItemView.extend({className:"ExchangeContentWeaponView",WIDGET_NAMES:{CORECARD:"corecard_weapon_ui",NAME:"weapon_name_label"}})}((this||0).self||global),function(e){var t=(e._,e.kh);t.createNameSpaceIfNotExists("exchangeitem.exchange.confirm"),t.exchangeitem.exchange.confirm.ContentCharacterView=t.exchangeitem.exchange.confirm.ContentItemView.extend({className:"ExchangeContentCharacterView",WIDGET_NAMES:{CORECARD:"corecard_chara_ui",NAME:"chara_name_label"}})}((this||0).self||global),function(e){var t=(e._,e.kh);t.createNameSpaceIfNotExists("exchangeitem.exchange.confirm"),t.exchangeitem.exchange.confirm.PopupExchangeSummon=t.ImplantedPopup.extend({className:"popupExchangeSummon",POPUP_NAME:"exchit_002_check",BUTTON_NAMES:{CANCEL:"btn_cancel",EXCHANGE:"btn_exchange"},ctor:function(){this._super(this.POPUP_NAME),this._initButtons()},_initButtons:function(){var e={};e[this.BUTTON_NAMES.CANCEL]=this._close.bind(this,!1),e[this.BUTTON_NAMES.EXCHANGE]=this._close.bind(this,!0),this.setButtonEvents(e)},_initContents:function(e){this._exchangeContentSummonView=this._createExchangeContentSummonView(e),this._exchangeContentSummonView.show()},_clearContents:function(){this._exchangeContentSummonView.clearContents(),this._exchangeContentSummonView=null},_createExchangeContentSummonView:function(e){return t.createInstance("ExchangeContentSummonView",[this.getNode(),e])},_close:function(e){this._clearContents(),this.dismiss(e)}})}((this||0).self||global),function(e){var t=(e._,e.kh);t.createNameSpaceIfNotExists("exchangeitem.exchange.confirm"),t.exchangeitem.exchange.confirm.PopupExchangeWeapon=t.ImplantedPopup.extend({className:"popupExchangeWeapon",POPUP_NAME:"exchit_001_check",BUTTON_NAMES:{CANCEL:"btn_cancel",EXCHANGE:"btn_exchange"},ctor:function(){this._super(this.POPUP_NAME),this._initButtons()},_initButtons:function(){var e={};e[this.BUTTON_NAMES.CANCEL]=this._close.bind(this,!1),e[this.BUTTON_NAMES.EXCHANGE]=this._close.bind(this,!0),this.setButtonEvents(e)},_initContents:function(e){this._exchangeContentWeaponView=this._createExchangeContentWeaponView(e),this._exchangeContentWeaponView.show(e);var t=e.getReleasedCharacter();null!=t&&(this._exchangeContentCharacterView=this._createExchangeContentCharacterView(t),this._exchangeContentCharacterView.show(t))},_clearContents:function(){this._exchangeContentWeaponView.clearContents(),this._exchangeContentCharacterView.clearContents()},_createExchangeContentWeaponView:function(e){return t.createInstance("ExchangeContentWeaponView",[this.getNode(),e])},_createExchangeContentCharacterView:function(e){return t.createInstance("ExchangeContentCharacterView",[this.getNode(),e])},_close:function(e){this._clearContents(),this.dismiss(e)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("exchangeitem.exchange.confirm"),t.exchangeitem.exchange.confirm.PopupController=n.Class.extend({className:"ExchangePopupController",showExchangePopup:function(e){var i={weapon:t.exchangeitem.exchange.confirm.PopupExchangeWeapon,summon:t.exchangeitem.exchange.confirm.PopupExchangeSummon}[e.getKind()];if(null==i)return Q.reject("KHExchangePopupController.showExchangePopup: invalid content item kind");var a=n.director.getRunningScene();return t.ImplantedPopup.createOrGet(a,i.prototype.POPUP_NAME,i).open(e)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("exchangeitem.exchange.result"),t.exchangeitem.exchange.result.Controller=n.Class.extend({className:"ExchangeResultController",showExchangeResult:function(e){this._showUnlockEpisodeResult(e).then(this._showExchangeResultPopup.bind(this)).then(this._onShowResultEnd.bind(this))},_showExchangeResultPopup:function(e){return this._createResultPopup().open(e).then(this._setOnShowResultDoneCallback.bind(this)).thenResolve(e)},_showUnlockEpisodeResult:function(e){var t={weapon:this._showUnlockCharacterEpisodeResult,summon:this.__showUnlockEpisodeResult}[e.getKind()];return null==t?Q.resolve(e):t.call(this,e)},_showUnlockCharacterEpisodeResult:function(e){var t=e.getReleasedCharacter();return null==t?Q.resolve(e):this.__showUnlockEpisodeResult(t).thenResolve(e)},__showUnlockEpisodeResult:function(e){return e.isOwned()?Q.resolve(e):this._createUnlockEpisodePopup().open(e).thenResolve(e)},_setOnShowResultDoneCallback:function(e){this._onShowResultEndCallback=e},_onShowResultEnd:function(){_.isFunction(this._onShowResultEndCallback)&&this._onShowResultEndCallback()},_createResultPopup:function(){return new t.exchangeitem.exchange.result.PopupExchangeResult},_createUnlockEpisodePopup:function(){return new t.exchangeitem.exchange.result.PopupExchangeResultHaremUnlocked}})}((this||0).self||global),function(e){var t=e._,n=e.kh;n.createNameSpaceIfNotExists("exchangeitem.exchange.result"),n.exchangeitem.exchange.result.PopupExchangeResult=n.ImplantedPopup.extend({className:"popupExchangeSummon",POPUP_NAME:"exchit_result",BUTTON_NAMES:{MYPAGE:"btn_mypage",PRESENT:"btn_present"},WIDGET_NAMES:{CORECARD:"corecard_ui",NAME:"result_label"},ctor:function(){this._super(this.POPUP_NAME),this._initButtons()},open:function(){return n.ImplantedPopup.prototype.open.apply(this,arguments).thenResolve(this._navigate.bind(this))},_initButtons:function(){var e={};e[this.BUTTON_NAMES.MYPAGE]=this._onTouchMypageButtonCallback.bind(this),e[this.BUTTON_NAMES.PRESENT]=this._onTouchPresentButtonCallback.bind(this),this.setButtonEvents(e)},_initContents:function(e){this._showCoreCard(e),this._showName(e)},_clearContents:function(){this._clearCoreCard(),this._clearName(),this._contentItemModel=null},_showCoreCard:function(e){this._contentItemModel=e,this._coreCardView=this._createCoreCardView(),this._coreCardView.show(),this._coreCardWidget=this._coreCardView.getWidget(),this._getCoreCardParentWidget().addChild(this._coreCardWidget)},_clearCoreCard:function(){this._coreCardWidget.removeFromParent(),this._coreCardView=null},_showName:function(e){var t=e.getName()+"";this._setStringToWidget(t,this.WIDGET_NAMES.NAME)},_clearName:function(){this._setStringToWidget("",this.WIDGET_NAMES.NAME)},_createCoreCardView:function(){return this._coreCardView=n.createInstance("ExchangeItemCoreCardView",[this._contentItemModel])},_onTouchMypageButtonCallback:function(){this._onNavigateCallback=this._navigateMypage,this._close()},_onTouchPresentButtonCallback:function(){this._onNavigateCallback=this._navigatePresentBox,this._close()},_navigate:function(){t.isFunction(this._onNavigateCallback)&&this._onNavigateCallback()},_navigateMypage:function(){n.createInstance("router").navigate("mypage")},_navigatePresentBox:function(){n.createInstance("router").navigate("present/prs_001")},_getCoreCardParentWidget:function(){var e=this.getNode().seekWidgetByName(this.WIDGET_NAMES.CORECARD);return null==e?(console.warn("KHPopupExchangeResult._getCorecardRootWidget: widget not found"),null):e},_setStringToWidget:function(e,t){var n=this.getNode().seekWidgetByName(t);return null==n?void console.warn("KHPopupExchangeResult._setStringToWidget: widget {"+t+"} not found"):void n.setString(e)},_close:function(){this._clearContents(),this.dismiss(!0)}})}((this||0).self||global),function(e){var t=e._,n=e.kh;n.createNameSpaceIfNotExists("exchangeitem.exchange.result"),n.exchangeitem.exchange.result.PopupExchangeResultHaremUnlocked=n.pc.view.ComOpenEpisodePopup.extend({className:"PopupExchangeResultHaremUnlocked",POPUP_NAME:"com_open_episode",ctor:function(){this._super(this.POPUP_NAME)},_initContents:function(e){var t=this._translateData(e),i=e.getKind();n.pc.view.ComOpenEpisodePopup.prototype._initContents.call(this,t,i)},_translateData:function(e){var n=e.getRawData(),i=e.getKind(),a={summon:{summon_id:e.getId()},character:{character_id:e.getId()}}[i]||{};return t.assign(t.clone(n),a)}})}((this||0).self||global),function(e){var t=e._,n=e.kh,i=e.cc;e.ccui,n.PopupFactoryComGreeting=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-com_edit_greed",title:"",buttonLabels:{blueBtn:"",blackBtn:""},buttons:{blueBtn:function(e){},blackBtn:function(){this.dismiss()}}},POPUP_METHODS:{},TEXT_RESTRICTION_LABEL:" XX ",onPopupOpened:function(e,i){this._popup=e,this._inputMaxLength=i.inputMaxLength||60,this._target="chat",t.isUndefined(i.friend)||(this._friend=i.friend,this._target="greet");var a=this._popup.seekWidgetByName("btn_node"),o=a.actionManager.getActionByTag(a.tag,a);t.isNull(o)||(this._action=o),n.setTouchEventHandlers(e,{"TOUCH_ENDED tab_chat":function(){this._changeView(0)},"TOUCH_ENDED tab_stamp":function(){this._changeView(1)},"TOUCH_ENDED blue_btn":function(){this._clickSendButton()}},this),e.seekWidgetByName("tab_chat").setSound(n.SoundList.BUTTON_TOUCHED_SWITCH),e.seekWidgetByName("tab_stamp").setSound(n.SoundList.BUTTON_TOUCHED_SWITCH),this._loadStamps(),this._changeView(0,e),this._createEditbox(e)},_createEditbox:function(e){t.isUndefined(this._chatEditBox)||this._chatEditBox.getParent().removeAllChildrenWithCleanup();var i=e.seekWidgetByName("text_restriction_label");if(i){var a=this.TEXT_RESTRICTION_LABEL.replace("XX",this._inputMaxLength);i.setString(a)}this._chatEditBox=n.EditBox.createEditBox(e,"comment_base","",this._inputMaxLength,"",{fontSize:22}),this._chatEditBox.setOnEditBoxReturnCallback(this._clickSendButton,this)},_loadStamps:function(){n.createInstance("StampList").init(this._popup.seekWidgetByName("com_edit_stamp_page_ui"),this._popup,function(e){"chat"===this._target?this._sendStamp(e):this._sendStamp(this._friend.a_player_id,e)}.bind(this)).loadStamps()},_changeView:function(e){var n=[!1,!1];n[e]=!0,this._popup.seekWidgetByName("com_edit_greed_a_ui").setVisible(n[0]),this._popup.seekWidgetByName("com_edit_greed_b_ui").setVisible(n[1]),t.each(["tab_chat","tab_stamp"],function(t,n){var i=this._popup.seekWidgetByName(t);i.setBright(e!==n),i.setEnabled(e!==n)},this),this._changeButtonPos(e)},_changeButtonPos:function(e){this._action.gotoFrameAndPause(0==e?1:2),this._popup.seekWidgetByName("black_btn").setTitleText(0==e?"":"")},_enableButton:function(e,t){var n=this._popup.seekWidgetByName(e);n.setEnabled(t),n.setColor(1==t?i.color("#FFFFFF"):i.color("#808080"))},_invoke:function(e,n){var a=i.director.getRunningScene(),o=[];a._delegate&&(a._delegate.greetingDelegate&&o.push(a._delegate.greetingDelegate),o.push(a._delegate)),o.push(a);var r=t.find(o,function(n){return t.isFunction(n[e])});if(r)return r[e].apply(r,n)},_clickSendButton:function(){0===this._chatEditBox.getText().length?this._invoke("_showPopupNoText"):"chat"===this._target?this._invoke("_sendMessage",[this._popup,void 0,this._chatEditBox.getText()]):this._invoke("_sendMessage",[this._popup,this._friend.a_player_id,this._chatEditBox.getText()])},_sendStamp:function(e,t){this._invoke("_sendStamp",[this._popup,e,t])},_sendStamp4Chat:function(e){this._invoke("_sendStamp",[this._popup,e])}})}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="AFriends",o={getList:function(e,t,n){return this._http.get({url:"/a_friends",json:{type:e,page:t,per_page:n}})},getRecommended:function(){return this._http.get({url:"/a_friends",json:{recommended:!0}})},getByAPlayerId:function(e){return this._http.get({url:"/a_friends",json:{a_player_id:e}})},delete:function(e,t){return this._http.del({url:"/a_friends",json:{ids:e,friendPlayerIds:t}})},accept:function(e,t){return this._http.post({url:"/a_friends",json:{from_a_player_id:e,a_friend_offer_id:t}})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiAFriends",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},o)),n.env.useApiMock){n.MockApi=n.MockApi||{};var r={};t.each(o,function(e,t){r[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi."+a+"."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},r))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="AGreets",o={getList:function(e,t,n){return this._http.get({url:"/a_greets",json:{a_player_id:e,page:t,per_page:n}})},sendMessage:function(e,t){return n.createInstance("inspectionApiDelegate").createInspection(t).then(function(n){return this._http.post({url:"/a_greets",json:{to_a_player_id:e,message:t,text_id:n.getTextId()}})}.bind(this))},sendStamp:function(e,t){return this._http.post({url:"/a_greets",json:{to_a_player_id:e,stamp_id:t}})},deleteGreet:function(e){return this._http.del({url:"/a_greets/"+e})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiAGreets",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},o)),n.env.useApiMock){n.MockApi=n.MockApi||{};var r={};t.each(o,function(e,t){r[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi."+a+"."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},r))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){e.kh=e.kh||{};var t=e.kh;t.GreetingDelegate=cc.Class.extend({ctor:function(){},owner:null,afterSendMessage:null,_sendInterval:!1,onExit:function(){this.owner=null},_sendMessage:function(e,n,i){return!0===this._sendInterval?void this._showPopupSendingLimit():t.createInstance("apiAGreets").sendMessage(n,i).then(function(t){return this._showPopupSentMessage(),e.dismiss(),this._sendInterval=!0,Q.delay(5e3).then(function(){this._sendInterval=!1}.bind(this))}.bind(this)).fail(function(e){console.error(e)})},_sendStamp:function(e,n,i){return!0===this._sendInterval?void this._showPopupSendingLimit():void t.createInstance("apiAGreets").sendStamp(n,i).then(function(t){return this._showPopupSentStamp(),e.dismiss(),this._sendInterval=!0,Q.delay(5e3).then(function(){this._sendInterval=!1}.bind(this))}.bind(this)).fail(function(e){console.error(e)})},_showPopupNoText:function(){var e=this.owner.popups.popupResult;e.open().then(function(){e.setTitle(""),e.setContent("<span class='red'></span>")}.bind(this)).fail(function(e){console.error(e)})},_showPopupSendingLimit:function(){var e=this.owner.popups.popupResult;e.open().then(function(){e.setTitle(""),e.setContent("5<br />")}.bind(this)).fail(function(e){console.error(e)})},_showPopupSentMessage:function(){var e=this.owner.popups.popupResult;e.open().then(function(){e.setTitle(""),e.setContent(""),_.isFunction(this.afterSendMessage)&&e.blueBtn.addTouchEventListener(function(t,n){n===ccui.Widget.TOUCH_ENDED&&(this.afterSendMessage(),e.dismiss())},this)}.bind(this)).fail(function(e){console.error(e)})},_showPopupSentStamp:function(){var e=this.owner.popups.popupResult;e.open().then(function(){e.setTitle(""),e.setContent(""),_.isFunction(this.afterSendMessage)&&e.blueBtn.addTouchEventListener(function(t,n){n===ccui.Widget.TOUCH_ENDED&&(this.afterSendMessage(),e.dismiss())},this)}.bind(this)).fail(function(e){console.error(e)})}})}((this||0).self||global),function(e){e.kh=e.kh||{};var t=e.kh;t.MakeFriendOfferDelegate=cc.Class.extend({TEMPLATE_PLAYER_NAME:"TEMPLATE_PLAYER_NAME",SUCCESS_MSG:{title:"",message:"<span class='red'>TEMPLATE_PLAYER_NAME</span><br /> "},ERROR_MSG:{toListFull:{title:"",message:"<span class='red'>TEMPLATE_PLAYER_NAME</span><br /> "},fromListFull:{title:"",message:""},requestAlreadyPending:{title:"",message:"<p><br /></p><p></p>"},alreadyFriend:{title:"",message:""}},ctor:function(){},owner:null,_sendInterval:!1,onExit:function(){this.owner=null},makeFriendOffer:function(e){return t.createInstance("apiAFriendOffers").makeOffer(e.a_player_id).then(function(t){if(t.body.offer_made)this._showPopupWithOk(this.SUCCESS_MSG,e);else{var n=t.body.error;this.ERROR_MSG[n]||console.warn(""),this._showPopupWithOk(this.ERROR_MSG[n],e)}}.bind(this)).fail(function(e){console.error(e)})},_showPopupWithOk:function(e,t){var n=this.owner.popups.popupWithOk;n.open().then(function(){n.setTitle(e.title),n.setContent(e.message.replace(this.TEMPLATE_PLAYER_NAME,t.name))}.bind(this)).fail(function(e){console.error(e)})}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);e.Q,t.pc.friend=t.pc.friend||{},t.pc.friend.roles=t.pc.friend.roles||{},t.pc.friend.roles.Routing={_verifyRouterParams001:function(e){},_navigateToPrf001:function(e,n){t.createInstance("router").navigate("profile/prf_001b",{prf_001:{id:e.a_player_id},tab:n},{return_to_profile:{routes:"friend/fr_001",params:{fr_001:{}}}})},_navigateFr002ToPrf001:function(e,n){t.createInstance("router").navigate("profile/prf_001b",{prf_001:{id:e.a_player_id}},{return_to_profile:{routes:"friend/fr_002",params:{fr_002:{tab:n}}}})},_navigateToMy001:function(){t.createInstance("router").navigate("mypage/my_001")},_verifyRouterParams002:function(e){n.isUndefined(e.routerParams.fr_002)&&(e.routerParams.fr_002={},e.routerParams.fr_002.tab="tab_0")},_navigateToFr001:function(e){t.createInstance("router").navigate("friend/fr_001")},_navigateToFri002:function(e){t.createInstance("router").navigate("friend/fr_002",{fr_002:{tab:"tab_0"}})},_verifyRouterParams003:function(e){}},n.assign(t.pc.friend.roles.Routing,t.pc.roles.RoutingCommon)}((this||0).self||global),function(e){var t=e.kh;e.khutil,e.cc,e.ccui,e._,e.console,t.createNameSpaceIfNotExists("core.pager.model"),t.core.pager.model.UserListData=t.core.pager.model.PlainData.extend({className:"UserListData",getId:function(){return this._rawData.a_player_id},getUserInfo:function(){return this._rawData.player||this._rawData}})}((this||0).self||global),function(e){var t=e.kh;e.khutil,e.cc,e.ccui,e._,e.console,t.createNameSpaceIfNotExists("friend.model"),t.friend.model.FriendListData=t.core.pager.model.UserListData.extend({className:"OfferListData",getId:function(){return this._rawData.a_friend_id},getUserInfo:function(){return this._rawData}})}((this||0).self||global),function(e){var t=e.kh;e.khutil,e.cc,e.ccui,e._,e.console,t.createNameSpaceIfNotExists("friend.model"),t.friend.model.OfferListData=t.core.pager.model.UserListData.extend({className:"OfferListData",getId:function(){return this._rawData.a_friend_offer_id},getUserInfo:function(){return this._rawData.to}})}((this||0).self||global),function(e){var t=e.kh;e.khutil,e.cc,e.ccui,e._,e.console,t.createNameSpaceIfNotExists("friend.model"),t.friend.model.OfferUnapprovedListData=t.core.pager.model.UserListData.extend({className:"OfferUnapprovedListData",getId:function(){return this._rawData.a_friend_offer_id},getUserInfo:function(){return this._rawData.from}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=(e.ccui,e._),a=e.console;t.createNameSpaceIfNotExists("core.pager.view.page"),t.core.pager.view.page.UserListPagerUi=t.core.pager.view.page.BasePageUi.extend({className:"UserListPagerUi",BUTTON_PATTERN:{BLUE_ONLY:"blue_only",RED_ONLY:"red_only",BLUE_RED:"blue_red",GUILD_BLUE_ONLY:"guild_blue_only",GUILD_RED_ONLY:"guild_red_only",GUILD_PLAIN:"guild_plain"},ctor:function(e,t,n,o){return this._super(e),i.contains(this.BUTTON_PATTERN,n)?(this._btnPattern=n,this._touchFuncNames=o,void(this._sceneDelegate=t)):void a.warn("[ERROR] Invalid button pattern type: "+n)},_updateOne:function(e,n,o){var r=this._btnPattern,s=e.getActionByTag(e.tag);if(s){if(i.isUndefined(s.animationInfo[r]))return void a.warn("[ERROR] Could not find button animation in userlist: "+r);s.gotoFrameAndPause(s.animationInfo[r].startIndex)}var c=n.getUserInfo();!i.isUndefined(c.name)&&e.seekWidgetByName("username_label")&&e.setStrings({username_label:c.name+" Rank"+c.rank});var u=c.last_login_date_time||c.login_date;!i.isUndefined(u)&&e.seekWidgetByName("login_label")&&e.setStrings({login_label:""+u}),!i.isUndefined(c.summon_id)&&e.seekWidgetByName("playercard_summon")&&e.loadTextures({playercard_summon:t.Img("playercard","summon",i.padZero(c.summon_id,4),0).png}),!i.isUndefined(c.job_id)&&e.seekWidgetByName("playercard_job")&&e.loadTextures({playercard_job:t.Img("playercard","job",i.padZero(c.job_id,4),0).png}),this._setButtonEvents(e,n,o),e.setVisible(!0)},_setButtonEvents:function(e,a,o){if(!i.isEmpty(this._touchFuncNames)){var r=n.director.getRunningScene(),s=this._touchFuncNames,c=this._sceneDelegate,u={};i.isFunction(c[s.user])&&(u["TOUCH_ENDED btn_user"]=c[s.user].bind(c,e,a,r)),i.isFunction(c[s.blue])&&(u["TOUCH_ENDED btn_blue_s"]=c[s.blue].bind(c,e,a,r)),i.isFunction(c[s.red])&&(u["TOUCH_ENDED btn_red_s"]=c[s.red].bind(c,e,a,r)),u["TOUCH_ENDED CheckBox_1"]=function(e,t,a,r){if(o.toggleSelect(a),i.isFunction(e[s.check])){var c=n.director.getRunningScene(),u=!r.selected;e[s.check].call(e,t,a,u,c)}o.refresh()}.bind(this,c,e,a),i.isEmpty(u)||t.setTouchEventHandlers(e,u,c)}}})}((this||0).self||global),function(e){var t=e.kh;e.khutil,e.cc,e.ccui,e._,e.console,t.createNameSpaceIfNotExists("friend.view"),t.friend.view.FriendOfferPanel=t.core.pager.view.page.UserListPagerUi.extend({className:"FriendOfferPanel",TOUCH_FUNC_NAMES:{red:"_onTouchOfferRedButton",user:"_onTouchUserButton"},_selectMode:!1,_headerSubLabel:null,ctor:function(e,t){this._super(e,t,"red_only",this.TOUCH_FUNC_NAMES);var n=this._rootWidget.getParent().getParent();this._headerSubLabel=n.seekWidgetByName("header_sub_label")},update:function(e,n,i,a){var o=this._rootWidget.getParent();this._selectMode=!o.seekWidgetByName("default_btn_node").isVisible(),this._super.apply(this,arguments),this._headerSubLabel.setString(""+n.getExistsRecordCount().toString());var r=o.seekWidgetByName("btn_friend_select_confirm");t.pc.roles.UIUtility._setEnableButton(r,a.getSelectedData().length>0)},_updateOne:function(e,t,n){this._super.apply(this,arguments),e.seekWidgetByName("btn_red_s").setTitleText("");var i=e.seekWidgetByName("check_box_base");i.setVisible(this._selectMode),this._selectMode&&(i.seekWidgetByName("CheckBox_1").selected=n.getSelectNumber(t)>0)}})}((this||0).self||global),function(e){var t=e.kh;e.khutil,e.cc,e.ccui,e._,e.console,t.createNameSpaceIfNotExists("friend.view"),t.friend.view.FriendOfferUnapprovedPanel=t.core.pager.view.page.UserListPagerUi.extend({className:"FriendOfferUnapprovedPanel",TOUCH_FUNC_NAMES:{blue:"_onTouchUnapprovedBlueButton",user:"_onTouchUserButton"},_selectMode:!1,_headerSubLabel:null,ctor:function(e,t){this._super(e,t,"blue_only",this.TOUCH_FUNC_NAMES);var n=this._rootWidget.getParent().getParent();this._headerSubLabel=n.seekWidgetByName("header_sub_label")},update:function(e,n,i,a){var o=this._rootWidget.getParent();this._selectMode=!o.seekWidgetByName("default_btn_node").isVisible(),this._super.apply(this,arguments),this._headerSubLabel.setString(""+n.getExistsRecordCount().toString());var r=o.seekWidgetByName("btn_friend_select_confirm");t.pc.roles.UIUtility._setEnableButton(r,a.getSelectedData().length>0)},_updateOne:function(e,t,n){this._super.apply(this,arguments),e.seekWidgetByName("btn_blue_s").setTitleText("");var i=e.seekWidgetByName("check_box_base");i.setVisible(this._selectMode),this._selectMode&&(i.seekWidgetByName("CheckBox_1").selected=n.getSelectNumber(t)>0)}})}((this||0).self||global),function(e){var t=e.kh;e.khutil,e.cc,e.ccui,e._,e.console,t.createNameSpaceIfNotExists("friend.view"),t.friend.view.FriendPanel=t.core.pager.view.page.UserListPagerUi.extend({className:"FriendPanel",TOUCH_FUNC_NAMES:{blue:"_onTouchFriendBlueButton",user:"_onTouchUserButton"},_selectMode:!1,_headerSubLabel:null,ctor:function(e,t){this._super(e,t,"blue_only",this.TOUCH_FUNC_NAMES);var n=this._rootWidget.getParent().getParent();this._headerSubLabel=n.seekWidgetByName("header_sub_label")},update:function(e,n,i,a){var o=this._rootWidget.getParent();this._selectMode=!o.seekWidgetByName("default_btn_node").isVisible(),this._super.apply(this,arguments);var r=o.seekWidgetByName("btn_friend_select_confirm");t.pc.roles.UIUtility._setEnableButton(r,a.getSelectedData().length>0),this._sceneDelegate&&this._sceneDelegate._maxFriendNumberPromise&&this._sceneDelegate._maxFriendNumberPromise.then(function(e){this.setString(""+n.getExistsRecordCount().toString()+"/"+e)}.bind(this._headerSubLabel))},_updateOne:function(e,t,n){this._super.apply(this,arguments),e.seekWidgetByName("btn_blue_s").setTitleText("");var i=e.seekWidgetByName("check_box_base");i.setVisible(this._selectMode),this._selectMode&&(i.seekWidgetByName("CheckBox_1").selected=n.getSelectNumber(t)>0)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;e.Q,t.pc.friend=t.pc.friend||{},t.pc.friend.roles=t.pc.friend.roles||{},t.pc.friend.roles.FriendPageListController={_fillupFriendSeachList:function(e,n){var i=e.seekWidgetByName("tab_0_node");if(null!==i){var a=i.seekWidgetByName("change_page_panel");if(null!==a)return a.removeAllChildren(),t.createInstance("apiAFriends").getRecommended().then(function(n){console.log(n.body);var a=n.body.max_record_count;if(this._fillupList(i,{viewParent:t.PageListParams.FRIEND_SEARCH.viewParent,subPageRes:t.PageListParams.FRIEND_SEARCH.subPageRes,panelsPerPage:t.PageListParams.FRIEND_SEARCH.perPage},n.body.data,n.body.max_record_count,void 0,this._friendPaneInitFunc.bind(this)),0===a);else{var o=e.seekWidgetByPath("tab_0_node.list_node");null!==o&&o.setVisible(!0)}return n.body}.bind(this)).fail(function(e){console.error(e.stack)});console.warn("[ERROR] Could not find a list parent node.")}else console.warn("[ERROR] Could not find a parent node.")},_friendPaneInitFunc:function(e,t,i){var a=n.director.getRunningScene();this._setUserList(e,t,"blue_only"),e.bfsWidgetByName("btn_user").addTouchEventListener(function(n,i){i===ccui.Widget.TOUCH_ENDED&&this._onTouchUserButton(e,t,a)},this),e.bfsWidgetByName("btn_blue_s").addTouchEventListener(function(n,i){i===ccui.Widget.TOUCH_ENDED&&this._onTouchOfferBlueButton(e,t,a)},this),null!==e.seekWidgetByName("btn_blue_s")&&e.seekWidgetByName("btn_blue_s").setTitleText(""),e.setVisible(!0)}},i.assign(t.pc.friend.roles.FriendPageListController,t.pc.list.roles.PageListControllerCommon,t.pc.list.roles.UserListCommon)}((this||0).self||global),function(e){var t=e.kh;e._,t.fr_002_003=t.fr_002_003||{},t.fr_002_003.Message={NO_PLAYER:"",MY_ID:""}}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{fr_001_a_delete_check:{factoryName:"popupFactoryTextOnly",content:"<br />",title:"",buttonLabels:{blackBtn:"Black",blueBtn:"Blue"},buttons:{blackBtn:function(){this.dismiss()},blueBtn:function(){alert("popup,fr_001_a_delete_result")}}},fr_001_a_delete_result:{factoryName:"popupFactoryTextOnly",content:"<br />",title:"",buttonLabels:{blueBtn:"Blue"},buttons:{blueBtn:function(){alert("{{fr_001_a_1}}")}}},fr_001_b_allcheck:{factoryName:"popupFactoryTextOnly",content:"<br  />",title:"",buttonLabels:{blackBtn:"Black",blueBtn:"Blue"},buttons:{blackBtn:function(){this.dismiss()},blueBtn:function(){alert("popup,fr_001_b_allresult")}}},fr_001_b_allresult:{factoryName:"popupFactoryTextOnly",content:"<br />",title:"",buttonLabels:{blueBtn:"Blue"},buttons:{blueBtn:function(){alert("{{fr_001_c_1}}")}}},com_offerdel_allcheck:{factoryName:"popupFactoryTextOnly",content:"<br />",title:"",buttonLabels:{blackBtn:"Black",blueBtn:"Blue"},buttons:{blackBtn:function(){this.dismiss()},blueBtn:function(){alert("popup,com_offerdel_allresult")}}}});t.pc.friend=t.pc.friend||{},t.pc.friend.fr_001=t.pc.friend.fr_001||{},t.pc.friend.fr_001.Scene=t.BaseScene.extend({resourceFileName:"fr_001/fr_001.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[{tab1:{node:"tab_0","content-node":"tab_0_node"},tab2:{node:"tab_1","content-node":"tab_1_node"},tab3:{node:"tab_2","content-node":"tab_2_node"}}],componentName:"friend",sceneName:"fr_001",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath("tab_0_node"),"btn_friend_select","btnCallbackTab0NodeBtnFriendSelect",null,function(){alert("{{fr_001fr_001_a_2}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("tab_0_node"),"btn_friend_select_confirm","btnCallbackTab0NodeBtnFriendSelectConfirm",null,function(e){this.popups.fr_001_a_delete_check.open(e)}),this._initButtonEvent.call(this,this.seekWidgetByPath("tab_0_node"),"btn_cancel","btnCallbackTab0NodeBtnCancel",null,function(){alert("{{fr_001fr_001_a_1}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("tab_1_node"),"btn_friend_select","btnCallbackTab1NodeBtnFriendSelect",null,function(){alert("{{fr_001fr_001_b_2}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("tab_1_node"),"btn_friend_select_confirm","btnCallbackTab1NodeBtnFriendSelectConfirm",null,function(e){this.popups.fr_001_b_allcheck.open(e)}),this._initButtonEvent.call(this,this.seekWidgetByPath("tab_1_node"),"btn_cancel","btnCallbackTab1NodeBtnCancel",null,function(){alert("{{fr_001fr_001_b_1}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("tab_2_node"),"btn_friend_select","btnCallbackTab2NodeBtnFriendSelect",null,function(){alert("{{fr_001fr_001_c_2}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("tab_2_node"),"btn_friend_select_confirm","btnCallbackTab2NodeBtnFriendSelectConfirm",null,function(e){this.popups.com_offerdel_allcheck.open(e)}),this._initButtonEvent.call(this,this.seekWidgetByPath("tab_2_node"),"btn_cancel","btnCallbackTab2NodeBtnCancel",null,function(){alert("{{fr_001fr_001_c_1}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("window_gray"),"btn_friend_search","btnCallbackWindowGrayBtnFriendSearch",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"friend/fr_002")),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc=t.pc||{},t.pc.friend=t.pc.friend||{},t.pc.friend.fr_001=t.pc.friend.fr_001||{},t.pc.friend.fr_001.SceneDelegate=t.pc.BaseSceneDelegate.extend({_popups:{fr_001_a_delete_check:{factoryName:"popupFactoryTextOnly",content:"<br />",title:"",buttonLabels:{blackBtn:"",redBtn:""},buttonSounds:{redBtn:t.SoundList.BUTTON_TOUCHED_CONFIRMED},buttons:{blackBtn:function(){this.dismiss()},redBtn:function(e){this.dismiss(),e._delegate._deleteSelectedFriends(e)}}},fr_001_a_delete_result:{factoryName:"popupFactoryTextOnly",content:"<br />",title:"",buttonLabels:{blueBtn:"OK"},buttonSounds:{blueBtn:t.SoundList.BUTTON_TOUCHED_CONFIRMED},buttons:{blueBtn:function(e){this.dismiss()}}},fr_001_b_allcheck:{factoryName:"popupFactoryTextOnly",content:"<br  />",title:"",buttonLabels:{blackBtn:"",redBtn:""},buttonSounds:{redBtn:t.SoundList.BUTTON_TOUCHED_CONFIRMED},buttons:{blackBtn:function(){this.dismiss()},redBtn:function(e){this.dismiss(),e._delegate._deleteSelectUnapproveOffer(e,1)}}},com_offerdel_allcheck:{factoryName:"popupFactoryTextOnly",content:"<br />",title:"",buttonLabels:{blackBtn:"",redBtn:""},buttonSounds:{redBtn:t.SoundList.BUTTON_TOUCHED_CONFIRMED},buttons:{blackBtn:function(){this.dismiss()},redBtn:function(e){this.dismiss(),e._delegate._deleteSelectUnapproveOffer(e,2)}}},popupGreeting:{factoryName:"popupFactoryComGreeting"},popupReqDelete:{factoryName:"popupFactoryBlackRed",title:"",buttonLabels:{blackBtn:"",redBtn:""},buttonSounds:{redBtn:t.SoundList.BUTTON_TOUCHED_CONFIRMED},buttons:{blackBtn:function(e){this.dismiss()},redBtn:function(e){this.dismiss()}}},popupConfirm:{factoryName:"popupFactoryBlackBlue",title:"",buttonLabels:{blackBtn:"",blueBtn:"OK"},buttonSounds:{blueBtn:t.SoundList.BUTTON_TOUCHED_CONFIRMED},buttons:{blackBtn:function(e){this.dismiss()},blueBtn:function(e){this.dismiss()}}},popupResult:{factoryName:"popupFactoryBlue",title:"",buttonLabels:{blueBtn:"OK"},buttonSounds:{blueBtn:t.SoundList.BUTTON_TOUCHED_CONFIRMED},onPopupOpened:function(){var e=n.director.getRunningScene().seekWidgetByPath("popupLayer..editbox_0");e&&e.setVisible(!1)},buttons:{blueBtn:function(e){this.dismiss();var t=e.seekWidgetByPath("popupLayer..editbox_0");t&&t.setVisible(!0)}}},popupCheckUnapproveOffer:{factoryName:"popupFactoryPopupCommon",resourceName:"core-popup-com_req_check",title:"",buttonLabels:{blackBtn:""},buttons:{blackBtn:function(e){this.dismiss()}}}},greetingDelegate:new t.GreetingDelegate,_controllers:null,_maxFriendNumberPromise:null,onSceneInit:function(e){if(a.defer(),this._setBackBtn(e),this.greetingDelegate.owner=e,this._setSound(e),this._controllers={},e.routerParams.tab){var t=e.seekWidgetByName(e.routerParams.tab);t&&e.tabDelegateList[0].selectTab(t),delete e.routerParams.tab}else this.tabCallbackTab0(e);return a.resolve()},_setSound:function(e){e.seekWidgetByPath("tab_0_node..btn_cancel").setSound(t.SoundList.BUTTON_TOUCHED_CANCEL),e.seekWidgetByPath("tab_1_node..btn_cancel").setSound(t.SoundList.BUTTON_TOUCHED_CANCEL),e.seekWidgetByPath("tab_2_node..btn_cancel").setSound(t.SoundList.BUTTON_TOUCHED_CANCEL)},onSceneEnter:function(e){return this._updateFriendMaxNumber(e)},onSceneExit:function(e){return a.defer(),this.greetingDelegate.onExit(),this._maxFriendNumberPromise=null,i.invoke(this._controllers,"dispose"),a.resolve()},_fillupFriendListBtnsList:function(e,n){if(this._controllers){if(this._controllers[n])return void this._controllers[n].refresh();var i=[{baseNode:"tab_0_node",panelName:t.BtnsPageListParams.FRIEND_SEARCH.panelName,apiName:"apiAFriends",methodName:"getList",modelClass:t.friend.model.FriendListData,params:["all"],viewClass:t.friend.view.FriendPanel},{baseNode:"tab_1_node",panelName:t.BtnsPageListParams.FRIEND_SEARCH.panelName,apiName:"apiAFriendOffers",methodName:"getList",modelClass:t.friend.model.OfferListData,params:["from"],viewClass:t.friend.view.FriendOfferPanel},{baseNode:"tab_2_node",panelName:t.BtnsPageListParams.FRIEND_SEARCH.panelName,apiName:"apiAFriendOffers",methodName:"getList",modelClass:t.friend.model.OfferUnapprovedListData,params:["to"],viewClass:t.friend.view.FriendOfferUnapprovedPanel}][n],a=e.seekWidgetByName(i.baseNode),o=a.seekWidgetByName("userlist_page_ui"),r=new i.viewClass(o,this),s=t.core.pager.model.ApiDataListFactory(i.apiName,i.methodName,i.params.concat([t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE]),i.modelClass),c=new t.core.pager.controller.SelectablePagerController(a,s,[r],o,999,!0),u=a.seekWidgetByName("viewpage_ui");new t.core.pager.view.button.ViewPageUi(u,c).initialize(),c.initialize(),this._controllers[n]=c}},_updateFriendMaxNumber:function(e){return this._maxFriendNumberPromise=t.createInstance("myselfInfoRepository").getMe(!0).then(function(e){return e.body.friend_max_num}.bind(this)).fail(function(e){console.error(e)}),this._maxFriendNumberPromise},_toggleSelectButton:function(e,t){var n=e.seekWidgetByName("tab_"+t+"_node");if(null!==n){var i=n.seekWidgetByName("default_btn_node"),a=n.seekWidgetByName("select_btn_node"),o=e.seekWidgetByName("btn_friend_search");if(null!==i)if(null!==a)if(null!==o){var r=i.isVisible();i.setVisible(!r),o.setVisible(!r),a.setVisible(r),this._controllers[t].refresh(!0,!0)}else console.warn("[ERROR] Could not find search button node.");else console.warn("[ERROR] Could not find select button node.");else console.warn("[ERROR] Could not find default button node.")}else console.warn("[ERROR] Could not find the parent node: "+parentNodeName)},tabCallbackTab0:function(e){this._fillupFriendListBtnsList(e,0)},tabCallbackTab1:function(e){this._fillupFriendListBtnsList(e,1)},tabCallbackTab2:function(e){this._fillupFriendListBtnsList(e,2)},btnCallbackTab0NodeBtnFriendSelect:function(e){var t=a.defer();return t.reject(this._override),this._toggleSelectButton(e,0),t.promise},btnCallbackWindowGrayBtnFriendSearch:function(e){var t=a.defer();return t.reject(this._override),this._navigateToFri002(e),t.promise},btnCallbackTab0NodeBtnCancel:function(e){var t=a.defer();return t.reject(this._override),this._toggleSelectButton(e,0),t.promise},btnCallbackTab1NodeBtnFriendSelect:function(e){var t=a.defer();return t.reject(this._override),this._toggleSelectButton(e,1),t.promise},btnCallbackTab1NodeBtnCancel:function(e){var t=a.defer();return t.reject(this._override),this._toggleSelectButton(e,1),t.promise},btnCallbackTab2NodeBtnFriendSelect:function(e){var t=a.defer();return t.reject(this._override),this._toggleSelectButton(e,2),t.promise},btnCallbackTab2NodeBtnCancel:function(e){var t=a.defer();return t.reject(this._override),this._toggleSelectButton(e,2),t.promise},_onTouchUserButton:function(e,t,n){var i=n.tabDelegateList[0].selected;this._navigateToPrf001(t.getUserInfo(),i)},_onTouchFriendBlueButton:function(e,t,i){n.director.getRunningScene().popups.popupGreeting.open({friend:t.getUserInfo(),scene:this.greetingDelegate,inputMaxLength:60})},_onTouchOfferRedButton:function(e,t,n){var i=n.popups.popupConfirm;i.open().then(function(){i.setTitle(""),i.setContent("<span class='red'>"+t.getUserInfo().name+"</span><br /> "),i.blueBtn.addTouchEventListener(function(e,a){a===ccui.Widget.TOUCH_ENDED&&(this._deleteUnapproveOffer(n,t.getId()),i.dismiss())},this)}.bind(this)).fail(function(e){console.error(e.stack)})},_onTouchUnapprovedBlueButton:function(e,t,n){var i=n.popups.popupCheckUnapproveOffer;i.open().then(function(){i.setStrings({friend_name_label:t.getUserInfo().name}),i.seekWidgetByName("btn_rejection").addTouchEventListener(function(e,a){a===ccui.Widget.TOUCH_ENDED&&this._rejectOfferConfirm(n,t.getId(),t.getUserInfo().name,i)},this),i.seekWidgetByName("btn_agreement").addTouchEventListener(function(e,a){a===ccui.Widget.TOUCH_ENDED&&(this._approveOffer(n,t.getUserInfo().a_player_id,t.getId(),t.getUserInfo().name),i.dismiss())},this)}.bind(this)).fail(function(e){console.error(e.stack)})},_getSelectedIds:function(e){return this._controllers[e].getSelectedData().map(function(e){return e.getId()})},_getSelectedPlayerIds:function(e){return this._controllers[e].getSelectedData().map(function(e){return e.getUserInfo().a_player_id})},_deleteSelectedFriends:function(e){t.createInstance("apiAFriends").delete(this._getSelectedIds(0),this._getSelectedPlayerIds(0)).then(function(e){return!1===e.body.result?a.reject():a.resolve()}).then(this._updateFriendMaxNumber.bind(e)).then(function(){return this._controllers[0].refresh(!1,!0)}.bind(this)).then(function(){this._toggleSelectButton(e,0);var t=e.popups.fr_001_a_delete_result;return t.open().then(function(){t.blueBtn.addTouchEventListener(function(e,n){n===ccui.Widget.TOUCH_ENDED&&t.dismiss()},this)}.bind(this))}.bind(this)).fail(function(e){e instanceof Error&&console.error(e.stack)})},_deleteSelectUnapproveOffer:function(e,n){t.createInstance("apiAFriendOffers").deleteOffers(this._getSelectedIds(n)).then(function(e){return!1===e.body.result?a.reject():a.resolve()}).then(this._updateFriendMaxNumber.bind(e)).then(function(){return this._controllers[n].refresh(!1,!0)}.bind(this)).then(function(){this._toggleSelectButton(e,n);var t=e.popups.popupResult,i=1===n?"":"",a=i+"",o="<br />"+i+"";return t.setTitle(a),t.setContent(o),t.open().then(function(){t.blueBtn.addTouchEventListener(function(e,n){n===ccui.Widget.TOUCH_ENDED&&t.dismiss()},this)}.bind(this))}.bind(this)).fail(function(e){e instanceof Error&&console.error(e.stack)})},_deleteUnapproveOffer:function(e,n){t.createInstance("apiAFriendOffers").deleteOffers([n]).then(function(e){return!1===e.body.result?a.reject():a.resolve()}).then(this._updateFriendMaxNumber.bind(e)).then(function(){return this._controllers[1].refresh(!1,!0)}.bind(this)).then(function(){var t=e.popups.popupResult;return t.open().then(function(){t.setTitle(""),t.setContent(""),t.blueBtn.addTouchEventListener(function(e,n){n===ccui.Widget.TOUCH_ENDED&&t.dismiss()},this)}.bind(this))}.bind(this)).fail(function(e){e instanceof Error&&console.error(e.stack)})},_approveOffer:function(e,n,o,r){var s=t.createInstance("apiAFriends").accept(n,o).then(function(e){return!1===e.body.result?a.reject(e):(this._controllers[0]&&this._controllers[0].clearCache(!0),a.resolve(e))}.bind(this));s.then(this._updateFriendMaxNumber.bind(e)).then(function(){return this._controllers[2].refresh(!1,!0)}.bind(this)).fail(function(e){e instanceof Error&&console.error(e.stack)}),s.then(function(t){var n;return i.isUndefined(t.body.error)||"toListFull"!==t.body.error?i.isUndefined(t.body.error)||"fromListFull"!==t.body.error?(n=e.popups.popupResult).open().then(function(){n.setTitle(""),n.setContent("<span class='red'>"+r+"</span><br /> "),n.blueBtn.addTouchEventListener(function(e,t){t===ccui.Widget.TOUCH_ENDED&&n.dismiss()},this)}.bind(this)):(n=e.popups.popupResult).open().then(function(){n.setTitle(""),n.setContent("")}):(n=e.popups.popupResult).open().then(function(){n.setTitle(""),n.setContent("<span class='red'>"+r+"</span><br /> ")})}.bind(this)).fail(function(e){e instanceof Error&&console.error(e.stack)})},_rejectOfferConfirm:function(e,t,n,i){var a=e.popups.popupReqDelete;a.open().then(function(){a.setContent("<span class='red'>"+n+"</span><br /> "),a.redBtn.addTouchEventListener(function(n,o){o===ccui.Widget.TOUCH_ENDED&&(this._rejectOffer(e,t),i.dismiss(),a.dismiss())},this)}.bind(this)).fail(function(e){e instanceof Error&&console.error(e.stack)})},_rejectOffer:function(e,n){t.createInstance("apiAFriendOffers").deleteOffers([n]).then(function(e){return!1===e.body.result?a.reject():a.resolve()}).then(this._updateFriendMaxNumber.bind(e)).then(function(){return this._controllers[2].refresh(!1,!0)}.bind(this)).then(function(){var t=e.popups.popupResult;return t.open().then(function(){t.setTitle(""),t.setContent(""),t.blueBtn.addTouchEventListener(function(e,n){n===ccui.Widget.TOUCH_ENDED&&t.dismiss()},this)}.bind(this))}.bind(this)).fail(function(e){e instanceof Error&&console.error(e.stack)})},_touchEndedBackBtnProcess:function(e){this._navigateToMy001()}}),i.assign(t.pc.friend.fr_001.SceneDelegate.prototype,t.pc.roles.UIUtility,t.pc.friend.roles.Routing)}((this||0).self||global),function(e){var t=e.kh;e.ccui,e.res,t.fr_002_003=t.fr_002_003||{},t.fr_002_003.Popups={_popups:{popupWithOk:{factoryName:"popupFactoryBlue",title:"",buttonLabels:{blueBtn:"OK"},buttonSounds:{blueBtn:t.SoundList.BUTTON_TOUCHED_CONFIRMED},buttons:{blueBtn:function(e){this.dismiss()}}}}}}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.friend=t.pc.friend||{},t.pc.friend.fr_002_003=t.pc.friend.fr_002_003||{},t.pc.friend.fr_002_003.Scene=t.BaseScene.extend({resourceFileName:"fr_002_3/fr_002_3.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[{tab1:{node:"tab_0","content-node":"tab_0_node"},tab2:{node:"tab_1","content-node":"tab_1_node"}}],componentName:"friend",sceneName:"fr_002_003",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath("tab_0_node"),"btn_reload_list","btnCallbackTab0NodeBtnReloadList",null,function(){alert("{{fr_002}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("tab_1_node"),"btn_re-search","btnCallbackTab1NodeBtnReSearch",null,function(){alert("{{fr_002_3fr_003_a}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_search","btnCallbackBtnSearch",null,function(){alert("{{UI}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._),i=e.Q;t.pc=t.pc||{},t.pc.friend=t.pc.friend||{},t.pc.friend.fr_002_003=t.pc.friend.fr_002_003||{},t.pc.friend.fr_002_003.SceneDelegate=t.pc.BaseSceneDelegate.extend({_popups:{},makeFriendOfferDelegate:new t.MakeFriendOfferDelegate,onSceneInit:function(e){return i.defer(),this._verifyRouterParams002(e),this._setBackBtn(e),i.all([this._getRecommendFriendList(e),this._initSearchPage(e)]).then(function(){var t="tab_0";t=e.routerParams.fr_002&&e.routerParams.fr_002.tab||t,e.tabDelegateList[0].selectTab(e.seekWidgetByName(t)),e.enableRestore(!1),this.makeFriendOfferDelegate.owner=e}.bind(this)),i.resolve()},onSceneEnter:function(e){return i.defer(),i.resolve()},onSceneExit:function(e){return i.defer(),this.makeFriendOfferDelegate.onExit(),i.resolve()},onPageInAnimationEnd:function(e){return i.defer(),i.resolve()},tabCallbackTab0:function(e){var t=e.seekWidgetByName("editbox_0");t&&t.setVisible(!1)},tabCallbackTab1:function(e){var t=e.seekWidgetByName("editbox_0");t&&t.setVisible(!0)},btnCallbackTab0NodeBtnReloadList:function(e){return this._getRecommendFriendList(e),i.reject(this._override)},btnCallbackTab0NodeBtnUp:function(e){var t=i.defer();return t.resolve(),t.promise},btnCallbackTab0NodeBtnDown:function(e){var t=i.defer();return t.resolve(),t.promise},btnCallbackTab1NodeBtnReSearch:function(e){var t=i.defer();return t.reject(this._override),this._switchSearchPanels(e,"input"),t.promise},btnCallbackBtnSearch:function(e){var t=i.defer();return t.reject(this._override),this._findFriendById(e),t.promise},_getRecommendFriendList:function(e){var i=e.seekWidgetByPath("tab_0_node.search_node");return i.setVisible(!0),t.createInstance("myselfInfoRepository").getMe(!0).then(function(t){if(n.isUndefined(t.body.a_player_id)||(this._aPlayerId=t.body.a_player_id,this._setPlayerId(e,this._aPlayerId)),!n.isUndefined(t.body.friend_num)&&!n.isUndefined(t.body.friend_max_num)){if(!(t.body.friend_num>=t.body.friend_max_num))return this._fillupFriendSeachList(e).then(function(){i.setVisible(!1)}.bind(this));var a=e.seekWidgetByPath("tab_0_node.full_node");return null===a?void console.warn("[ERROR] Could not find full node."):(i.setVisible(!1),a.setVisible(!0),void(this._friendMax=!0))}console.warn("[ERROR] Could not find friend_num | friend_max_num")}.bind(this)).fail(function(e){console.error(e)})},_onTouchUserButton:function(e,t,n){var i=n.tabDelegateList[0].selected;this._navigateFr002ToPrf001(t,i)},_onTouchOfferBlueButton:function(e,t,n){this.makeFriendOfferDelegate.makeFriendOffer(t)},_initSearchPage:function(e){if(!n.isUndefined(this._searchBox))return this._searchBox.setText(""),void this._searchBox.setVisible(!0);var i=e.contentLayer,a=i.seekWidgetByName("input_node");if(null!==a){if(null!==i.seekWidgetByName("editbox_0"))return null===i.seekWidgetByName("text_window")?void console.warn("[ERROR] Could not find text_window."):(this._searchBox=t.EditBox.createEditBox(i,"text_window","editbox_0",20,"",{fontSize:24}),this._searchBox.setOnEditBoxReturnCallback(this.btnCallbackBtnSearch.bind(this,e),this),void a.setVisible(!0));console.warn("[ERROR] Could not find editbox_0.")}else console.warn("[ERROR] Could not find search UI.")},_setPlayerId:function(e,t){var n=e.seekWidgetByPath("tab_1_node.id_label");null===n&&console.warn("[ERROR] Could not find id_label."),n.setString(t)},_findFriendById:function(e){var n=this._searchBox.getString();if(n.length>0){if(n=n.replaceFullWidthNumberToHalfWidth().replace(/\s/g,""),this._searchBox.setString(n),n==this._aPlayerId)return void this._switchSearchPanels(e,"input",t.fr_002_003.Message.MY_ID);this._switchSearchPanels(e,"search"),t.createInstance("apiAFriends").getByAPlayerId(n).then(function(n){var i=n.body;0===i.max_record_count?this._switchSearchPanels(e,"input",t.fr_002_003.Message.NO_PLAYER):(this._fillupResultPanel(e,i.data[0]),this._switchSearchPanels(e,"result"))}.bind(this)).fail(function(e){console.error(e.stack)})}},_switchSearchPanels:function(e,t,i){var a=e.seekWidgetByPath("tab_1_node.input_node"),o=e.seekWidgetByPath("tab_1_node.result_node"),r=e.seekWidgetByPath("tab_1_node.search_node");return null===a||null===o||null===r?void console.warn("[ERROR] Could not find panel for switching."):(a.setVisible("input"==t),o.setVisible("result"==t),r.setVisible("search"==t),void("input"!=t||n.isUndefined(i)?"input"==t?this._searchBox.setText(""):a.seekWidgetByName("nothing_label")&&a.seekWidgetByName("nothing_label").setVisible(!1):a.seekWidgetByName("nothing_label")&&(a.seekWidgetByName("nothing_label").setVisible(!0),a.seekWidgetByName("nothing_label").setString(i))))},_fillupResultPanel:function(e,t){var n=e.seekWidgetByPath("tab_1_node.userlist_0_ui");return null===n?void console.warn("[ERROR] Could not find userlist panel."):void this._friendPaneInitFunc(n,t,0)},_touchEndedBackBtnProcess:function(e){this._navigateToFr001(e)}}),n.assign(t.pc.friend.fr_002_003.SceneDelegate.prototype,t.fr_002_003.Popups,t.pc.roles.UIUtility,t.pc.friend.roles.Routing,t.pc.friend.roles.FriendPageListController)}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.router=n.router||{},n.router.routes=n.router.routes||{},t.merge(n.router.routes,{friend:{friend:"fr_001","friend/fr_001":"fr_001","friend/fr_002":"fr_002_003","friend/fr_003":"fr_002_003"}})}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="AGacha",o={getAppearance:function(e){return this._http.get({url:"/a_gacha/"+e+"/current"})},getAppearanceById:function(e){return this._http.get({url:"/a_gacha/event/appearance",json:{id:e}})},getCategory:function(e){return this._http.get({url:"/a_gacha/"+e})},getEventCategory:function(e){return this._http.get({url:"/a_gacha/event/"+e})},getCheckUsing:function(e){return this._http.get({url:"/a_gacha/check_use",json:{gacha_id:e}})},getSliderDetail:function(e){return this._http.get({url:"/a_gacha/detail",json:{slider_id:e}})},getRatio:function(e){return this._http.get({url:"/a_gacha/"+e+"/ratio"})},getRatioById:function(e){return this._http.get({url:"/a_gacha/event",json:{ratio:e}})},playGacha:function(e,t){return this._http.post({url:"/a_gacha/"+e,json:{gacha_id:t}})},playEventGacha:function(e,t){return this._http.post({url:"/a_gacha/event/"+e,json:{gacha_id:t}})}};n.Api[a]=i.Class.extend(t.assign({className:"KHApiAGacha",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},o));var r=["TutorialApi"];if(n.env.useApiMock&&r.push("MockApi"),t.each(r,function(e){n[e]=n[e]||{};var r={};t.each(o,function(t,i){r[i]=function(){if(!n[e])throw"kh."+e+"is not defined";if(!n[e][a][i+"JSON"])throw"not implemented: kh."+e+"."+a+"."+i;var t=Q.defer();return t.resolve({body:n[e][a][i+"JSON"].apply(this,arguments)}),t.promise}}),n[e][a]=i.Class.extend(t.assign({},r))}),"undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,n){n+="JSON";var i="tutorialMock";t.each(["mock",i],function(e){var t="./"+e+"/"+n+".js";if(s.existsSync(t))console.log("skip: file exists: "+t);else{console.log("generate: "+t);var o=c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,n);e===i&&(o=o.replace(/MockApi/g,"TutorialApi")),s.writeFileSync(t,o)}})}),process.exit()}}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="GachaCategory",o={get:function(e){return this._http.get({url:"/gacha_category/"+e})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiGachaCategory",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},o)),n.env.useApiMock){n.MockApi=n.MockApi||{};var r={};t.each(o,function(e,t){r[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi."+a+"."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},r))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="GachaCategories",o={getGachaCategories:function(){return this._http.get({url:"/gacha_categories"})},getGachaContentsSummary:function(e){return this._http.get({url:"/gacha_categories/"+e+"/contents_summary"})},getContentsList:function(e){return this._http.get({url:"/gacha_category/"+e+"/contents"})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiGachaCategories",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},o)),n.env.useApiMock){n.MockApi=n.MockApi||{};var r={};t.each(o,function(e,t){r[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi."+a+"."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},r))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="AGachaResult",o={putGachaResult:function(e){return this._http.put({url:"/a_gacha_result",json:{payment_id:e}})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiAGachaResult",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},o)),n.env.useApiMock){n.MockApi=n.MockApi||{};var r={};t.each(o,function(e,t){r[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi."+a+"."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},r))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q,o=e.res;t.pc.scene=t.pc.scene||{},t.pc.scene.roles=t.pc.scene.roles||{},t.pc.scene.roles.ResourcePath={0:"res/ga_ani/ga_ani_00.json",1:"res/ga_ani/ga_ani_01.json",2:"res/ga_ani/ga_ani_02.json",3:"res/ga_ani/ga_ani_03.json",4:"res/ga_ani/ga_ani_04_{multi}{promotion}.json",5:"res/ga_ani/ga_ani_05.json",6:"res/ga_ani/ga_ani_06{promotion}.json"},t.pc.scene.roles.GachaBgImg={a:"res/ga_ani/ga_ani_bg_a.png",b:"res/ga_ani/ga_ani_bg_b.png",c:"res/ga_ani/ga_ani_bg_c.png"},$staticRes("res/ga_ani/ga_ani_00.json"),$staticRes("res/ga_ani/ga_ani_01.json"),$staticRes("res/ga_ani/ga_ani_02.json"),$staticRes("res/ga_ani/ga_ani_03.json"),$staticRes("res/ga_ani/ga_ani_04_0.json"),$staticRes("res/ga_ani/ga_ani_04_0_promotion.json"),$staticRes("res/ga_ani/ga_ani_04_1.json"),$staticRes("res/ga_ani/ga_ani_05.json"),$staticRes("res/ga_ani/ga_ani_06.json"),$staticRes("res/ga_ani/ga_ani_06_promotion.json"),t.pc.scene.roles.GachaDoorColor={ss_rare:"rainbow",s_rare:"gold",rare:"white",other:"white"},t.pc.scene.roles.SceneGachaAnimation={_maxStepAmount:7,_skipSt4ForCharReleaseWeapons:!0,_checkPointStep:-1,_initialize:function(e,o){if(!i.isUndefined(e)&&!i.isUndefined(e.animation_data)&&i.isArray(e.obtained_info)){this._actions={},this._promoActions={},this._animationInfo=e.animation_data,this._obtainedArray=e.obtained_info,this._rarityBgImgPath=this._getRarityBgImgName(this._animationInfo.direction_type),this._cachedUrls=[],this._setupDefers=[],this._loadTasks=[],this._hasCharacterResult=!1,i.each(this._obtainedArray,function(e,t){this._loadTasks[t]=a.defer();var n=e.weapon_info;i.isUndefined(n)||i.isUndefined(n.character_joined_info)||(this._hasCharacterResult=!0)},this),t.createInstance("soundPlayer").init(t.createInstance("playerGameConfig")),n.director.getRunningScene().removeAllChildrenWithCleanup();var r=0;return o&&(this._hasCharacterResult||console.error("Invalid gacha result data. In simple animation, But not has Character Result"),r=6),i.each(i.range(r,this._maxStepAmount),function(e){var t=i.padZero(e,2);this._prepareStepNode(e);var n=this["_setupStep"+t];i.isUndefined(n)?this._setupDefers.push(a.resolve()):this._setupDefers.push(n.apply(this,[this._getStepRootNode(e)]))},this),6===r?(this._obtainedArray.forEach(function(e,t){this._loadImgForObtained(t)}.bind(this)),this.__waitForImageLoaded().then(function(){this._playStep06()}.bind(this))):void this._playStep00()}console.error("Invalid gacha result data. Both animation_data and obtained_info are required.")},_getRarityBgImgName:function(e){var n="a";i.isUndefined(e)||(n=(this._isPromotion()?{rare:"a",s_rare:"b",ss_rare:"b"}:{rare:"a",s_rare:"b",ss_rare:"c"})[e]);return i.isUndefined(n)&&(console.warn("Invalid gacha result data. animation_data.direction_type is wrong. "+e),n="a"),t.pc.scene.roles.GachaBgImg[n]},_shouldShow1By1:function(){return 1===this._obtainedArray.length||this._animationInfo.one_by_one},_isPromotion:function(){return!0===this._animationInfo.is_promotion_target},_isPromotionTarget:function(e){var t=e.weapon_info||e.summon_info||e.item_info;return this._isPromotion()&&"SSR"===t.rare},_getStepResourcePath:function(e){var n=t.pc.scene.roles.ResourcePath[e],i=this._shouldShow1By1()?"0":"1";return n.replace(/\{multi\}/g,i).replace(/\{promotion\}/g,"")},_getStepPromotionResourcePath:function(e){var n=t.pc.scene.roles.ResourcePath[e],i="0";this._isPromotion()||this._shouldShow1By1()||(i="1");var a=this._isPromotion()?"_promotion":"";return n.replace(/\{multi\}/g,i).replace(/\{promotion\}/g,a)},_getStepRootNode:function(e){return i.isEmpty(this._actions)?{seekWidgetByName:function(){return null},seekWidgetByPath:function(){return null}}:this._actions[e].node},_getStepPromoRootNode:function(e){return i.isEmpty(this._promoActions)?{seekWidgetByName:function(){return null},seekWidgetByPath:function(){return null}}:this._promoActions[e].node},_preLoadResultImages:function(){var e=this._shouldShow1By1()?250:0;i.each(this._obtainedArray,function(t,n){var i=1e3+e*n;a.delay(i).then(function(){this._obtainedArray&&this._loadImgForObtained(n)}.bind(this))},this)},_prepareStepNode:function(e){var t=this._getStepResourcePath(e);console.debug("play step "+e+" -> res="+t);var i=n.director.getRunningScene(),a=ccs.load($dynamicRes(t)),o=a.action,r=a.node,s=new n.Node;s.setName("normal_"+e),r.setVisible(!0),s.setVisible(!1),s.addChild(r),i.addChild(s),r.runAction(o),o.gotoFrameAndPlay(0,o.getDuration(),!1),this.__setRarityBgImg(e,r),a.node=s,this._actions[e]=a;var c=new n.Node;if(c.setName("promotion_"+e),this._isPromotion()){var u=this._getStepPromotionResourcePath(e),l=ccs.load($dynamicRes(u)),_=l.node,p=l.action;_.setVisible(!0),c.setVisible(!1),c.addChild(_),i.addChild(c),_.runAction(p),this.__setRarityBgImg(e,_),l.node=c,this._promoActions[e]=l}else i.addChild(c)},__setRarityBgImg:function(e,t){return 0===(""+t.getName()).indexOf("ga_ani_bg_"+e+"_")?void t.setTexture(this._rarityBgImgPath):void t.getChildren().forEach(this.__setRarityBgImg.bind(this,e))},_resetStep:function(e,t){var n=t?this._promoActions[e]:this._actions[e];if(i.isUndefined(n))return console.error("Resource not loaded for step "+e+" animation. Please call _prepareStepNode(n);"),null;var a=n.action;return a.gotoFrameAndPause(0),a},_playStep:function(e,n,o,r){if(!(this._checkPointStep>e)){console.debug("animate step "+e);var s=this._resetStep(e,r);if(null!==s)return this._soundEvent&&(this._soundEvent.unregisterEvent(),delete this._soundEvent),i.each(i.range(7),function(t){var n;if(r){if(!this._promoActions[t])return;n=this._promoActions[t].node}else{if(!this._actions[t])return;n=this._actions[t].node}n&&n.setVisible(t===e)},this),a.delay(1).then(function(){var i=t.createInstance("AnimationEventHandlerCcs_2_0").init(s),a=t.createInstance("Sound2Event",[i]);this._soundEvent=a;var r=i.getPromiseWhenAnimationEnd(s.getDuration());s.gotoFrameAndPlay(0,s.getDuration(),n),r.then(function(){if(!(this._checkPointStep>e)){o&&o.apply(this,[{getEvent:function(){return"animation_e"}}])}}.bind(this))}.bind(this)).fail(this._defaultErrorHandler),!0}},_playStepAndWait:function(e,t,n){if(this._checkPointStep>e)return a.reject(!1);t=t||"animation_e";var i=a.defer();return this._playStep(e,!1,function(e){return e.getEvent()===t&&(i.resolve(),!0)},n),i.promise},_defaultErrorHandler:function(e){console.warn("catch!",e.stack),e&&!n.director.getRunningScene().disposed?console.error(e):console.debug("abort")},_playStepAndEnableTouchEvent:function(e,t,n){this._playStepAndWait(e,null,n).then(function(){this._setTouchCallback(e,t,n)}.bind(this)).fail(this._defaultErrorHandler)},_setupStep00:function(e){var t=a.defer();return console.log("step00"),this._preLoadResultImages(),t.resolve(),t.promise},_setupStep01:function(e){var t=a.defer();console.log("step01");var n=this._animationInfo.direction_type;return this.__loadDoorTextures(n).then(function(){this._setTouchCallback(0,function(){this._stopStep00(),this._playStep01()}),t.resolve()}.bind(this)),t.promise},_setupStep02:function(e){console.log("step02")},_setupStep03:function(e){console.log("step03")},_setupStep04:function(e){return n.spriteFrameCache.addSpriteFrames(o["gacha-ga_ani-ga_ani_rarity_atlas.plist"]),a.resolve()},_setupStep05:function(e){console.log("step05")},_setupStep06:function(e){console.log("step06")},__waitForSetups:function(){return this._checkPointStep>=0?a.reject(!1):(0==arguments.length?e=this._setupDefers:(e=[],i.each(arguments,function(t){e.push(this._setupDefers[t])},this)),console.debug("wait setup:"+e),a.all(e).fail(function(e){console.error(e.stack)}));var e},__waitForImageLoaded:function(e){var t=[];return(i.isUndefined(e)||e>this._loadTasks.length)&&(e=this._loadTasks.length),i.each(i.range(e),function(e){t.push(this._loadTasks[e].promise)},this),console.debug("wait image load:"+t),a.all(t).fail(function(e){console.error(e.stack)})},__backgroundType2GachaID:function(e){return{normal:3,premium:1,premium_ticket:4,stone:2,event:5}[e]||parseInt("1"+e)},_loadImgForObtained:function(e){if(i.isArray(this._obtainedArray)&&e<this._obtainedArray.length){var o=this._obtainedArray[e],r=null,s=null;if(i.isUndefined(o.weapon_info))i.isUndefined(o.summon_info)?i.isUndefined(o.item_info)||(r=t.Img("gachaget","item",i.padZero(o.item_info.id,4)).png):r=t.Img("gachaget","summon",i.padZero(o.summon_info.id,4)).png;else{r=t.Img("gachaget","weapon",i.padZero(o.weapon_info.id,4)).png;var c=o.weapon_info.character_joined_info;i.isUndefined(c)||(s=t.Img("illust-com-kneeshot","chara",i.padZero(c.character_id,4),0).png)}var u=function(){return this._loadTasks&&this._loadTasks[e].resolve(),a.defer().resolve()}.bind(this);if(null!==r){var l={purgeRule:t.core.repository.PurgeRule.makeComponentChange()};this._cachedUrls[e]=[r];var _=a.defer();if(n.loader.loadImg(r,l,function(e,t){_.resolve()}),null!==s){this._cachedUrls[e].push(s);var p=a.defer();return n.loader.loadImg(s,l,function(e,t){p.resolve()}),a.all([_.promise,p.promise]).then(u)}return _.promise.then(u)}}else i.isArray(this._obtainedArray)?console.error("Invalid index for obtainedArray :"+e+", should be between 0 and "+this._obtainedArray.length):this._checkPointStep<4&&console.error("The gacha result obtaindArray is missing.")},__loadDoorTextures:function(e){var i=a.defer(),o=this.__getBgImageURLByDirType(e);return n.loader.loadImg(o,{purgeRule:t.core.repository.PurgeRule.makeToMypage()},function(e,t){e?i.reject(o):i.resolve(o)}.bind(this)),i.promise.then(function(e){this.__setDoorTexture(0,e),this.__setDoorTexture(1,e)}.bind(this),function(e){console.warn("[bgImage] load failed: "+e)})},__setDoorTexture:function(e,t){var n=this._getStepRootNode(e);n&&i.each([0,1,2],function(i){var a=n.seekWidgetByName("gachadoor_gacha_"+e+"_"+i);a&&a.setTexture(t)})},__getBgImageURLByDirType:function(e){var n=t.pc.scene.roles.GachaDoorColor,i=this._isPromotion()?n.s_rare:n[e];return t.Img("gachadoor",i||"white").png},_setTouchCallback:function(e,n,i){var a={};a["TOUCH_ENDED btn_clear_"+e+"_0"]=n,i?t.setTouchEventHandlers(this._getStepPromoRootNode(e),a,this):t.setTouchEventHandlers(this._getStepRootNode(e),a,this),console.debug("Touch callback attached: step="+e)},_resetTouchCallback:function(e){var t=this._getStepRootNode(e).seekWidgetByName("btn_clear_"+e+"_0");null!==t&&t.setTouchEnabled(!1)},_setSkipButtonEvent:function(e){var n={};n["TOUCH_ENDED btn_skip"]=this._onSkipButtonPressed,t.setTouchEventHandlers(this._getStepRootNode(e),n,this),console.debug("Skip button stand by on step="+e)},_onSkipButtonPressed:function(){var e=n.director.getRunningScene().seekWidgetByName("btn_skip");null!==e&&e.setEnabled(!1),this._shouldShow1By1()||this._checkPointStep>=4?this._playStep05OrFinish():this._playStep04()},_playStep00:function(){console.log("play step00"),this._setSkipButtonEvent(0);a.all([this.__waitForSetups(1,2),this.__waitForImageLoaded(4)]).then(function(){this._playStep(0,!0)}.bind(this))},_stopStep00:function(){console.log("stop step00"),this._resetStep(0)},_playStep01:function(){console.log("play step01"),this._setSkipButtonEvent(1),this._playStepAndWait(1).then(function(){console.debug("play step01 complete"),this.__waitForSetups(2,3).then(function(){this._shouldShow1By1()?this._playStep02():this.__waitForImageLoaded().then(function(){this._playStep02()}.bind(this))}.bind(this))}.bind(this)).fail(this._defaultErrorHandler)},_playStep02:function(){console.log("play step02"),this._setSkipButtonEvent(2);var e=this._getStepRootNode(2).seekWidgetByName("ga_ani_ball_2_0");this.__playStep02Core(e,0)},__playStep02Core:function(e,t){console.debug("play step02 - "+t);var n=this._obtainedArray[t],a=function(){i.isNull(this._obtainedArray)||(t++,this._obtainedArray.length>t?this.__playStep02Core(e,t):this._playStep03())}.bind(this);this._setBallTextureByRarity(e,n),this._playStepAndWait(2).then(function(){a()}.bind(this)).fail(this._defaultErrorHandler)},_playStep03:function(){console.log("play step03"),this._setSkipButtonEvent(3),this._playStepAndWait(3).then(function(){console.debug("play step03 complete"),this.__waitForSetups(4).then(function(){console.log("next step!"),this._playStep04()}.bind(this))}.bind(this)).fail(this._defaultErrorHandler)},_playStep04:function(){console.log("play step04"),this._setSkipButtonEvent(4);var e=this._getStepRootNode(4);if(this._shouldShow1By1()){var t=this._getStepPromoRootNode(4);this.__playStep04OneByOne(e,t,0)}else this.__playStep04AllInOne(e)},__shouldSkipStep04:function(e){return this._skipSt4ForCharReleaseWeapons&&!i.isUndefined(e.weapon_info)&&!i.isUndefined(e.weapon_info.character_joined_info)},__playStep04OneByOne:function(e,t,n){console.debug("play step02 - "+n);var i=e.seekWidgetByName("ga_ani_ball_4_0"),a=e.seekWidgetByName("normal_4"),o=t.seekWidgetByName("promotion_4"),r=this._obtainedArray[n],s=!1,c=e;this._isPromotionTarget(r)?(a.setVisible(!1),o.setVisible(!0),c=t,s=!0):(a.setVisible(!0),o&&o.setVisible(!1));var u=function(){n++,this._obtainedArray.length>n?this.__playStep04OneByOne(e,t,n):this._playStep05OrFinish()}.bind(this);this.__shouldSkipStep04(r)?u():(this._setBallTextureByRarity(i,r),this._setGachaResultImageAndLabel(c,"_4_0",n),this._setRarityLabelsByRarity(c,r),this._playStepAndEnableTouchEvent(4,u,s))},__playStep04AllInOne:function(e){this._checkPointStep=4;var t=0;i.each(i.range(10),function(n){var i="_4_"+n,a=e.seekWidgetByName("ga_ani_ball"+i);if(t>=this._obtainedArray.length)a.setOpacity(0);else{for(var o;o=this._obtainedArray[t],this.__shouldSkipStep04(o);)if(++t>=this._obtainedArray.length){o=null;break}null===o?a.setOpacity(0):(a.setOpacity(255),this._setBallTextureByRarity(a,o),this._setGachaResultImageAndLabel(e,i,t++))}},this),this._playStepAndEnableTouchEvent(4,function(){this._playStep05OrFinish()}.bind(this))},_playStep05OrFinish:function(){this._checkPointStep=5,this._hasCharacterResult?this.__waitForImageLoaded().then(function(){this._playStep05()}.bind(this)):this._disposeAndLeave()},_playStep05:function(){console.log("play step05"),this._playStepAndWait(5).then(function(){this._playStep06()}.bind(this)).fail(this._defaultErrorHandler)},_playStep06:function(){console.log("play step06");var e=this._getStepRootNode(6),t=this._getStepPromoRootNode(6),n=e.seekWidgetByName("ga_ani_ball_6_0");this.__playStep06Core(e,t,n,0)},__playStep06Core:function(e,t,n,a){console.debug("play step06 - "+a),this._resetTouchCallback(6);var o=e.seekWidgetByName("normal_6"),r=t.seekWidgetByName("promotion_6"),s=this._obtainedArray[a],c=!1,u=e;this._isPromotionTarget(s)?(o.setVisible(!1),r.setVisible(!0),u=t,c=!0):(o.setVisible(!0),r&&r.setVisible(!1));var l=function(){a++,this._resetTouchCallback(6),this._obtainedArray.length>a?this.__playStep06Core(e,t,n,a):this._disposeAndLeave()}.bind(this);i.isUndefined(s.weapon_info)||i.isUndefined(s.weapon_info.character_joined_info)?l():(this._setBallTextureByRarity(n,s),this._setGachaResultImageAndLabel(u,"",a),this._setRarityLabelsByRarity(u,s),this._playStepAndEnableTouchEvent(6,l,c))},_setGachaResultImageAndLabel:function(e,t,n){var a=this._obtainedArray[n],o=a.weapon_info||a.summon_info||a.item_info,r=this._cachedUrls[n];e.seekWidgetByName("gachaget"+t).setTexture(r[0]);var s=e.seekWidgetByName("name_label");if(null!==s){var c=o.name;o.bonus>0&&(c+=" +"+o.bonus),s.setString(c),s.setVisible(!0)}i.isUndefined(o.character_joined_info)||""!==t||(e.seekWidgetByName("gachaget_chara_6_0").setTexture(r[1]),e.seekWidgetByName("chara_get_label").setString(o.character_joined_info.character_name+" \n"))},_setBallTextureByRarity:function(e,t){var n="R";this._isPromotionTarget(t)?n="SR":n=(t.weapon_info||t.summon_info||{rare:"N"}).rare;var i="gacha/res/ga_ani/ga_ani_ball_"+n.toLowerCase()+".png";console.debug("try loading image "+i),e.initWithSpriteFrameName(i)},_setRarityLabelsByRarity:function(e,t){var i=(t.weapon_info||t.summon_info||{rare:"item"}).rare.toLowerCase();"item"!==i&&n.spriteFrameCache.getSpriteFrame("gacha/res/ga_ani/ga_ani_rarity_left_"+i+".png")||(i="clear"),["ga_ani_rarity_left","ga_ani_rarity_right","ga_ani_rarity_text"].forEach(function(t){e.seekWidgetByName(t).initWithSpriteFrameName("gacha/res/ga_ani/"+t+"_"+i+".png",ccui.Widget.PLIST_TEXTURE)})},_disposeAndLeave:function(){this._animationInfo=null,this._obtainedArray=null,this._cachedUrls=null,this._setupDefers=null,this._loadTasks=null,this._actions=null,n.director.getRunningScene().removeAllChildrenWithCleanup(),this._navigateToResultScene()}}}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e._,t.EmptyDelegate=n.Class.extend({ctor:function(){},initializeUI:function(){},getEvents:function(){return{}},getMouseEvents:function(){return{}},onExit:function(){},fetch:function(){},updateBattlePower:function(){return t.createInstance("myselfInfoRepository").getBattlePower(!0)},updateCurrency:function(){return t.createInstance("myselfInfoRepository").getMyCurrency(!0)},updateQuestPoints:function(){return t.createInstance("myselfInfoRepository").getQuestPoints(!0).then(function(e){return e.getAsObject()})},stopCharacterVoice:function(){},reload:function(){t.createInstance("myselfInfoRepository").allCacheClear()}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);e.Q,t.pc.gacha=t.pc.gacha||{},t.pc.gacha.roles=t.pc.gacha.roles||{},t.pc.gacha.roles.Routing={_verifyRouterParams000:function(e){},_navigate000ToGacha:function(e,i){if(n.isUndefined(i)||n.isUndefined(i.category_id))this._consoleErrorRoutingAbort("record.category_id");else{var a={ga_100:{category_id:i.category_id,id:i.banner_id,event_id:i.event_id,isContinueGacha:!1}};t.createInstance("router").navigate("gacha/ga_100",a)}},_navigateStatusDetail:function(e,t,i,a){return n.isUndefined(t)||n.isUndefined(t.type)?void this._consoleErrorRoutingAbort("record.type"):void("character"===t.type?this._navigateCharacterStatus(t.character_id,i,a):"weapon"===t.type?this._navigateWeaponStatus(t.weapon_id,i,a):"summon"===t.type&&this._navigateSummonStatus(t.summon_id,i,a))},_navigateCharacterStatus:function(e,n,i){t.createInstance("router").navigate("status/status_001",{status_001:{id:e,isFromGacha:!0,returnRoute:n,returnParams:i}})},_navigateWeaponStatus:function(e,n,i){t.createInstance("router").navigate("status/status_002",{status_002:{id:e,isFromGacha:!0}},{routes:n,temporaryRouterParams:i})},_navigateSummonStatus:function(e,n,i){t.createInstance("router").navigate("status/status_003",{status_003:{id:e,isFromGacha:!0}},{routes:n,temporaryRouterParams:i})},_navigate001_004ToGaAni:function(e,n,i,a,o,r){var s={100:"legend","002":"stone","003":"ticket","004":"normal"}[a.slice(-3)];t.createInstance("router").navigate("gacha/ga_ani",{ga_ani:{data:e,gacha_id:n,event_id:i,navigate:a,present:!r,category:s,category_id:o},payment_id:null})},_navigateToGachaAnimation:function(e,n,i,a,o){var r=this._getEventId();switch(n){case t.gacha.gacha_category.GachaCategoryModel.prototype.CATEGORY_TYPES.STONE:this._navigate001_004ToGaAni(e,a,r,"gacha/ga_002",i,!1);break;case t.gacha.gacha_category.GachaCategoryModel.prototype.CATEGORY_TYPES.TICKET:this._navigate001_004ToGaAni(e,a,r,"gacha/ga_003",i,!1);break;case t.gacha.gacha_category.GachaCategoryModel.prototype.CATEGORY_TYPES.NORMAL:if(o)return void this._navigateGaAniToResult(e,"gacha/ga_004",!1,a,r,n,i,!0,!1);this._navigate001_004ToGaAni(e,a,r,"gacha/ga_004",i,!0);break;case t.gacha.gacha_category.GachaCategoryModel.prototype.CATEGORY_TYPES.LEGEND:case t.gacha.gacha_category.GachaCategoryModel.prototype.CATEGORY_TYPES.EVENT:this._navigate100ToGaAni(e,a,"gacha/ga_100",r,i,"event");break;default:console.error("Invalid navigate Parameter: "+n+" - ID:"+a)}},_navigateToGaContentList:function(e,n){t.createInstance("router").navigate("gacha/ga_contents_list",{ga_contents_list:{category_id:e,event_id:n}})},_verifyRouterParams100:function(e){n.isUndefined(e.routerParams.ga_100)&&(e.routerParams.ga_100={id:1,event_id:1,isContinueGacha:!1,category:"event"},this._consoleErrorRouterParams("routerParams.ga_100, .id, .isContinueGacha"))},_navigate100ToGaAni:function(e,n,i,a,o,r){var s=r||"event";t.createInstance("router").navigate("gacha/ga_ani",{ga_ani:{data:e,gacha_id:n,navigate:i,present:!0,event_id:a,category:s,category_id:o},payment_id:null})},_navigate100ToExchangeItemShop:function(e){t.createInstance("router").navigate("exchangeitem/exchit_001",{exchit_001:{item_id:e}})},_navigateContinueGacha010:function(e,i){if(n.isUndefined(e.routerParams.ga_010))this._consoleErrorRoutingAbort("routerParams.ga_010");else if(n.isUndefined(e.routerParams.ga_010.navigate))this._consoleErrorRoutingAbort("routerParams.ga_010.navigate");else{var a=e.routerParams.ga_010;t.createInstance("router").navigate(a.navigate)}},_verifyRouterParamsAni:function(e){n.isUndefined(e.routerParams.ga_ani)&&(e.routerParams.ga_ani={},e.routerParams.ga_ani.navigate="",e.routerParams.ga_ani.data={},this._consoleErrorRouterParams("routerParams.ga_ani, .navigate, .data"))},_navigateGaAniToResult:function(e,n,i,a,o,r,s,c,u){var l=new t.gacha.model.GachaResult(e);t.createInstance("router").navigate("gacha/ga_010",{ga_010:{results:l.getGachaResults(),navigate:n,type:l.getType(),params:{gacha_id:a,event_id:o,present:i,category:r,category_id:s},getItemNoArray:l.getItemNoArray(),getItemNameArray:l.getItemNameArray(),useSimpleAnimation:!0===c,fromAnimation:u}},{animationData:l.getAnimationData()})},_navigateGaAniToSpecialResult:function(e,n){var i=n.params||{},a=n.tempParams||{};a.results=e.obtained_info,t.createInstance("router").navigate(n.navigate,i,a)},_navigate010ToGaAni:function(e,n,i,a,o,r,s){t.createInstance("router").navigate("gacha/ga_ani",{ga_ani:{data:e,gacha_id:n,navigate:i,present:a,event_id:o,category:r,category_id:s,isSimple:!0},payment_id:null})},_navigateToMy001:function(){t.createInstance("router").navigate("mypage/my_001")},_navigateToGacha_000:function(e){t.createInstance("router").navigate("gacha/ga_000",{},{ga_000:{event_id:e}})},navigateGacha10ToPrs001:function(){t.createInstance("router").navigate("present/prs_001",{},{prs_001_002_003:{returnRoute:"gacha/ga_000"}})}},n.assign(t.pc.gacha.roles.Routing,t.pc.roles.RoutingCommon)}((this||0).self||global),function(e){var t=e._,n=e.kh;n.PopupFactoryGaCheckUseStoneTicket=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-ga_check_stone-ticket",title:"",buttonLabels:{blackBtn:"",blueBtn:"OK"},buttons:{blackBtn:function(e){this.dismiss()},blueBtn:function(e){(this._okBtnCallback||function(){})(),this.dismiss()}}},onPopupOpened:function(e,t){var n=t.gachaId,i=t.beforeNum,a=t.afterNum,o=t.type;e._okBtnCallback=t.okBtnCallback,this._setContentForTicketPopup(e,n,o,i,a)},_setContentForTicketPopup:function(e,i,a,o,r){e.loadTextures({stone_or_ticket_img:n.Img("corecard","gacha",t.padZero(i,4)).jpg}),e.setHtmlStrings({confirm_labelimg:this._ticketCountConfirmHtmlString(a,o,r)},n.GameConfig.POPUP_CSS)},_ticketCountConfirmHtmlString:function(e,t,i){var a={stone:{label:n.w("stone"),unit:""},ticket:{label:n.w("ticket"),unit:""}}[e];return"<span class='white'>"+a.label+"</span><br /><span class='orange'>"+a.unit+"</span><span class='white'>"+t+"&rarr;</span><span class='red'>"+i+"</span><br /><span class='white'></span>"}})}((this||0).self||global),function(e){var t=(e._,e.kh);t.PopupFactoryGaTips=t.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-ga_tips",title:"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(){this.dismiss()}}},onPopupOpened:function(e,t){var n=e.seekWidgetByName("ga_tips_label");n.fontSize=22,0===n.y&&(n.y=-20),n.height=590,e.seekWidgetByName("popup_base").height=770,e.seekWidgetByName("title_label").y=740,e.seekWidgetByName("top_pin_node").y=620}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.createNameSpaceIfNotExists("gacha.view"),t.gacha.view.GaTipsPopup=t.ImplantedPopup.extend({_initContents:function(e){this.setButtonEvents({btn_ok:!0}),this.getNode().seekWidgetByName("arrival_panel").setVisible(!0===e)}})}((this||0).self||global),function(e){var t=e._,n=e.kh,i=e.cc;n.createNameSpaceIfNotExists("gacha.gacha_category"),n.gacha.gacha_category.GachaCategoryModel=i.Class.extend({className:"GachaCategoryModel",PAYMENT_TYPES:{PSEUDO_CURRENCY:"pseudo_currency",TICKET:"ticket",STONE:"stone",GEM:"normal"},CATEGORY_TYPES:{LEGEND:"legend",STONE:"stone",TICKET:"ticket",EVENT:"event",NORMAL:"normal"},ctor:function(e){this._gachaCategoryData=e,this._gachas=this._createGachaModels(e.groups),this._gachaInfos=this._createGachaModels(e.gacha_information||[])},getGachas:function(){return this._gachas},existsGacha:function(){return 0!==this.getGachas().length},getGachaById:function(e){return t.find(this.getGachas(),function(t){return t.getGachaId()===e})},getCategoryId:function(){return this._gachaCategoryData.category_id},getCategoryType:function(){return this._gachaCategoryData.category_type},getPaymentType:function(){return this._gachaCategoryData.payment_type},isPseudoCurrencyPaymentType:function(){return this.getPaymentType()===this.PAYMENT_TYPES.PSEUDO_CURRENCY},isTicketPaymentType:function(){return this.getPaymentType()===this.PAYMENT_TYPES.TICKET},isStonePaymentType:function(){return this.getPaymentType()===this.PAYMENT_TYPES.STONE},isGemPaymentType:function(){return this.getPaymentType()===this.PAYMENT_TYPES.GEM},isNormalGacha:function(){return this.getCategoryType()===this.CATEGORY_TYPES.NORMAL},getRemainAmount:function(){return this._gachaCategoryData.rest_times||0},getGachaInformation:function(){return this._gachaInfos},hasReachedItemStockLimit:function(){return this._gachaCategoryData.is_max_weapon_or_summon},_createGachaModels:function(e){return t.map(e,this._createGachaModel.bind(this))},_createGachaModel:function(e){return n.createInstance("GachaModel",[e,this.getCategoryType(),this.getPaymentType()])}})}((this||0).self||global),function(e){var t=e._,n=e.kh,i=e.cc;n.createNameSpaceIfNotExists("gacha.gacha_category"),n.gacha.gacha_category.GachaModel=i.Class.extend({className:"GachaModel",ctor:function(e,t,n){this._gachaData=e,this._gachaCategoryType=t,this._paymentType=n},getGachaId:function(){return this._gachaData.gacha_id},getCategoryType:function(){return this._gachaCategoryType},getPaymentType:function(){return this._paymentType},getDrawCount:function(){return this._gachaData.gacha_count},isEnabled:function(){return this._gachaData.enabled},getPrice:function(){return this._gachaData.price},getCurrencyItemName:function(){return this._gachaData.currency_item_name},getCurrencyItemId:function(){return this._gachaData.currency_item_id},isNormalGacha:function(){return this.getCategoryType()===n.gacha.gacha_category.GachaCategoryModel.prototype.CATEGORY_TYPES.NORMAL},isFreeNormalGacha:function(){return!!this.isNormalGacha()&&0===this.getPrice()},getBonusItemId:function(){return this.hasBonusExchangeItem()||console.error("GachaModel.getBonusItemId: no bonus item found!"),this._gachaData.bonus.bonus_id},hasBonusExchangeItem:function(){return!t.isEmpty(this._gachaData.bonus)&&this._gachaData.bonus.is_exchange_item}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=(e.ccui,e._);e.console,t.createNameSpaceIfNotExists("gacha.exchangeItem"),t.gacha.exchangeItem.ExchangeItemController=n.Class.extend({className:"ExchangeItemController",CACHE_KEY:"gacha_{gachaId}_exchange_item",cacheExchangeItemData:function(e){if(e.hasBonusExchangeItem()){var n=e.getGachaId(),i=this._getCacheKey(n),a=e.getBonusItemId();t.createInstance("componentCache").cache(i,a)}},initializeExchangeItemButton:function(e){var n=this._getExchangeItemId(e);null!=n&&t.createInstance("ExchangeItemButtonController",[n]).enable()},initializeExchangeItemButtonBeforeBuying:function(e){var n=e.getGachas();i.each(n,function(e){if(e.hasBonusExchangeItem()){var n=e.getBonusItemId();t.createInstance("ExchangeItemButtonController",[n]).enable()}},this)},_getExchangeItemId:function(e){var n=this._getCacheKey(e);return t.createInstance("componentCache").get(n)},_getCacheKey:function(e){return this.CACHE_KEY.replace("{gachaId}",e)}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=e.ccui,o=(e._,e.console);t.createNameSpaceIfNotExists("gacha.exchangeItem"),t.gacha.exchangeItem.ExchangeItemButtonController=i.Class.extend({className:"ExchangeItemButtonController",BUTTON_NAME:"btn_exchange",BUTTON_UI_NAME:"ga_btn_ui",BUTTON_APPEARANCE:"arrival_list_exchange",ctor:function(e){this._exchangeItemId=e},enable:function(){var e=n.getWidget(this.BUTTON_NAME,function(e){o.warn(this.className+": "+e)}.bind(this));e.addTouchEventListener(this._exchangeItemButtonOnTouchEventCallback,this),e.setVisible(!0);var t=n.getWidget(this.BUTTON_UI_NAME,function(e){o.warn(this.className+": "+e)}.bind(this));null!==t&&t.setAppearance(this.BUTTON_APPEARANCE)},_exchangeItemButtonOnTouchEventCallback:function(e,n){n===a.Widget.TOUCH_ENDED&&t.createInstance("router").navigate("exchangeitem/exchit_001",{exchit_001:{item_id:this._exchangeItemId}})}})}((this||0).self||global),function(e){var t=(e._,e.kh),n=e.cc;e.console,t.createNameSpaceIfNotExists("gacha.vending_machine"),t.gacha.vending_machine.PriceModel=n.Class.extend({className:"PriceModel",PRICE_SUFFIX_BY_PAYMENT_TYPE:{pseudo_currency:"",stone:"",ticket:"",normal:""},ctor:function(e,t){this._gachaModel=e,this._gachaUseCheckData=t},getGachaId:function(){return this._gachaModel.getGachaId()},getPrice:function(){return this._gachaModel.getPrice()},getPriceText:function(){return this._gachaModel.getPrice()+this.PRICE_SUFFIX_BY_PAYMENT_TYPE[this.getPaymentType()]},getCurrencyItemName:function(){return this._gachaModel.getCurrencyItemName()},getCurrencyItemId:function(){return this._gachaModel.getCurrencyItemId()},getPaymentType:function(){return this._gachaModel.getPaymentType()},getDrawCount:function(){return this._gachaModel.getDrawCount()},getCurrencyItemNameForDisplay:function(){return this.getPaymentType()===t.gacha.gacha_category.GachaCategoryModel.prototype.PAYMENT_TYPES.TICKET?"":this.getCurrencyItemName()},getCurrentCurrencyAmount:function(){return this._gachaUseCheckData.before_num},getCurrencyAmountAfterTransaction:function(){return this._gachaUseCheckData.after_num},hasSufficientCurrency:function(){return this.getCurrencyAmountAfterTransaction()>=0}})}((this||0).self||global),function(e){var t=(e._,e.kh),n=e.cc,i=e.console;t.createNameSpaceIfNotExists("gacha.vending_machine"),t.gacha.vending_machine.PriceRepository=n.Class.extend({className:"PriceRepository",getByGachaModel:function(e){return this._createPriceModel(e)},_createPriceModel:function(e){return this._getCurrencyData(e.getGachaId()).then(function(n){return t.createInstance("PriceModel",[e,n])})},_getCurrencyData:function(e){return t.createInstance("apiAGacha").getCheckUsing(e).then(function(e){return e.body},function(e){i.error(e&&e.stack?e.stack:e)})}})}((this||0).self||global),function(e){var t=e._,n=e.kh,i=e.cc;n.createNameSpaceIfNotExists("gacha.vending_machine.currency_amount_label"),n.gacha.vending_machine.currency_amount_label.Controller=i.Class.extend({className:"CurrencyAmountLabelController",WIDGET_NAMES:{ROOT_NODE:"have_base",LABEL:"have_label"},_setupLabelTextByPaymentType:function(e){this.LABEL_TEXTS={},this.LABEL_TEXTS[e.PSEUDO_CURRENCY]="",this.LABEL_TEXTS[e.TICKET]="",this.LABEL_TEXTS[e.STONE]="",this.LABEL_TEXTS[e.GEM]=""},ctor:function(e){this._gachaCategoryModel=e,this._setupLabelTextByPaymentType(e.PAYMENT_TYPES)},initializeLabelText:function(){this._createPriceModel().then(this._createLabelText.bind(this)).then(this._setLabelText.bind(this))},_createPriceModel:function(){var e=t.first(this._gachaCategoryModel.getGachas());if(null!=e||t.isEmpty(this._gachaCategoryModel.getGachaInformation())||(e=t.first(this._gachaCategoryModel.getGachaInformation())),null==e)throw new Error("CurrencyAmountLabelController: gacha category {"+this._gachaCategoryModel.getCategoryId()+"} has no groups set!");return n.createInstance("PriceRepository").getByGachaModel(e)},_createLabelText:function(e){var t=this._gachaCategoryModel.getPaymentType();return this.LABEL_TEXTS[t]+e.getCurrentCurrencyAmount()},_setLabelText:function(e){var t=this._getLabelNode(),i=n.createInstance("GachaCurrencyAmountLabelView",[t]);i.setLabelText(e),i.cleanUp(),this._getRootNode().setZOrder(10)},_getRootNode:function(){return this._getWidgetByName(this.WIDGET_NAMES.ROOT_NODE)},_getLabelNode:function(){return this._getWidgetByName(this.WIDGET_NAMES.LABEL)},_getWidgetByName:function(e){var t=i.director.getRunningScene().seekWidgetByName(e);return null==t&&console.warn("CurrencyAmountLabelController: widget {"+e+"} not found!"),t}})}((this||0).self||global),function(e){var t=(e._,e.kh),n=e.cc;e.console,t.createNameSpaceIfNotExists("gacha.vending_machine.currency_amount_label"),t.gacha.vending_machine.currency_amount_label.View=n.Class.extend({className:"CurrencyAmountView",ctor:function(e){this._label=e},setLabelText:function(e){this._label.setString(e)},cleanUp:function(){this._label=null}})}((this||0).self||global),function(e){var t=e._,n=e.kh,i=e.cc;n.createNameSpaceIfNotExists("gacha.vending_machine.currency_amount_label"),n.gacha.vending_machine.currency_amount_label.SeparateController=i.Class.extend({className:"CurrencyAmountSeparateLabelController",WIDGET_NAMES:{CURRENCY_LABEL:"have_name_label",AMOUNT_LABEL:"have_no_label"},_setupLabelTextByPaymentType:function(e){this.LABEL_TEXTS={},this.LABEL_TEXTS[e.PSEUDO_CURRENCY]="",this.LABEL_TEXTS[e.TICKET]="",this.LABEL_TEXTS[e.STONE]="",this.LABEL_TEXTS[e.GEM]=""},ctor:function(e,t){this._gachaCategoryModel=e,this._gachaId=t,this._setupLabelTextByPaymentType(e.PAYMENT_TYPES)},initializeLabelText:function(){this._createPriceModel().then(this._initLabel.bind(this))},_createPriceModel:function(){var e=t.first(this._gachaCategoryModel.getGachas());if(null!=e||t.isEmpty(this._gachaCategoryModel.getGachaInformation())||(e=t.first(this._gachaCategoryModel.getGachaInformation())),null==e){var i={gacha_id:this._gachaId};e=n.createInstance("GachaModel",[i,this._gachaCategoryModel.getCategoryType(),this._gachaCategoryModel.getPaymentType()])}return n.createInstance("PriceRepository").getByGachaModel(e)},_initLabel:function(e){var t=this._createView(),n=this._gachaCategoryModel.getPaymentType(),i=this.LABEL_TEXTS[n];t.setCurrencyLabelText(i);var a=e.getCurrentCurrencyAmount();t.setAmountLabelText(a),t.cleanUp()},_createView:function(){var e=this._getCurrencyNode(),t=this._getAmountNode();return n.createInstance("GachaCurrencyAmountSeparateLabelView",[e,t])},_getCurrencyNode:function(){return this._getWidgetByName(this.WIDGET_NAMES.CURRENCY_LABEL)},_getAmountNode:function(){return this._getWidgetByName(this.WIDGET_NAMES.AMOUNT_LABEL)},_getWidgetByName:function(e){var t=i.director.getRunningScene().seekWidgetByName(e);return null==t&&console.warn("CurrencyAmountSeparateLabelController: widget {"+e+"} not found!"),t}})}((this||0).self||global),function(e){var t=(e._,e.kh),n=e.cc;e.console,t.createNameSpaceIfNotExists("gacha.vending_machine.currency_amount_label"),t.gacha.vending_machine.currency_amount_label.SeparateView=n.Class.extend({className:"CurrencyAmountSeparateView",ctor:function(e,t){this._currencyLabel=e,this._amountLabel=t},setCurrencyLabelText:function(e){this._currencyLabel.setString(e)},setAmountLabelText:function(e){this._amountLabel.setString(e.toString())},cleanUp:function(){this._currencyLabel=null,this._amountLabel=null}})}((this||0).self||global),function(e){var t=e._,n=e.kh,i=e.console;n.createNameSpaceIfNotExists("gacha.vending_machine.vending_process"),n.gacha.vending_machine.vending_process.PopupGaCheckUseStone=n.ImplantedPopup.extend({className:"PopupGaCheckUseStone",ROOT_NODE:"ga_check_usestone",DI_NAME:"PopupGaCheckUseStone",WIDGET_NAMES:{IMAGE:"corecard_gacha",CONTENT_LABEL:"have_count_labelimg"},BUTTON_NAMES:{CONFIRM:"btn_ok",CANCEL:"btn_cancel"},CONTENT_HTML_TEMPLATE:'<div style="margin-top: 20px;" class="white"><div style="margin: 10px auto;">{currencyItemName}{price}</div><div style="margin: 10px auto;">{drawCount}</div><div style="margin: 20px auto;"><span class="orange"></span>{currencyAmountBefore}<span class="yellow">{currencyAmountAfter}</span></div></div>',_initContents:function(e){this._setGachaImage(e),this._setContentLabelText(e),this._initButtons()},_clearContents:function(){this._clearGachaImage(),this._clearContentLabelText()},_setGachaImage:function(e){var i=e.getCurrencyItemId(),a=n.Img("corecard","item",t.padZero(i,4)).jpg;this._setTextureToWidget(this.WIDGET_NAMES.IMAGE,a)},_clearGachaImage:function(){this._setTextureToWidget(this.WIDGET_NAMES.IMAGE,"")},_setContentLabelText:function(e){var t=e.getCurrencyItemNameForDisplay(),i=e.getPriceText(),a=e.getDrawCount(),o=e.getCurrentCurrencyAmount(),r=e.getCurrencyAmountAfterTransaction(),s=this.CONTENT_HTML_TEMPLATE.replace("{currencyItemName}",t).replace("{price}",i).replace("{drawCount}",a).replace("{currencyAmountBefore}",o).replace("{currencyAmountAfter}",r),c={};c[this.WIDGET_NAMES.CONTENT_LABEL]=s,this.getNode().setHtmlStrings(c,n.GameConfig.POPUP_CSS)},_clearContentLabelText:function(){this._setTextureToWidget(this.WIDGET_NAMES.CONTENT_LABEL,"")},_initButtons:function(){var e={};e[this.BUTTON_NAMES.CONFIRM]=this._close.bind(this,!0),e[this.BUTTON_NAMES.CANCEL]=this._close.bind(this,!1),this.setButtonEvents(e)},_close:function(e){this._clearContents(),this.dismiss(e)},_setTextureToWidget:function(e,t){var n=this.getNode().seekWidgetByName(e);return null==n?void i.warn("PopupGaCheckUseStone._setTextureToWidget: Widget {"+e+"} not found!"):void n.loadTexture(t)},_setStringToWidget:function(e,t){var n=this.getNode().seekWidgetByName(e);return null==n?void i.warn("PopupGaCheckUseStone._setStringToWidget: Widget {"+e+"} not found!"):void n.setString(t)}})}((this||0).self||global),function(e){var t=e._,n=e.kh,i=e.console;n.createNameSpaceIfNotExists("gacha.vending_machine.vending_process"),n.gacha.vending_machine.vending_process.PopupGaNeedUseStone=n.ImplantedPopup.extend({className:"PopupGaNeedUseStone",ROOT_NODE:"ga_need_usestone",DI_NAME:"PopupGaNeedUseStone",WIDGET_NAMES:{IMAGE:"corecard_gacha",CONTENT_LABEL:"have_count_labelimg"},BUTTON_NAMES:{CONFIRM:"btn_buy",CANCEL:"btn_cancel"},CONTENT_HTML_TEMPLATE:'<div style="margin-top: 20px;" class="white"><div style="margin: 10px auto;"><div/><div style="margin: 10px auto;"><div/><div style="margin: 20px auto;"><span class=\'orange\'></span><span class=\'yellow\'>{itemAmount}</span></div></div>',_initContents:function(e){this._setGachaImage(e),this._setCurrencyAmount(e),this._initButtons()},_clearContents:function(){this._clearGachaImage(),this._clearCurrencyAmount()},_setGachaImage:function(e){var i=e.getCurrencyItemId(),a=n.Img("corecard","item",t.padZero(i,4)).jpg;this._setTextureToWidget(this.WIDGET_NAMES.IMAGE,a)},_clearGachaImage:function(){this._setTextureToWidget(this.WIDGET_NAMES.IMAGE,"")},_setCurrencyAmount:function(e){var t=e.getCurrentCurrencyAmount(),i=this.CONTENT_HTML_TEMPLATE.replace("{itemAmount}",t),a={};a[this.WIDGET_NAMES.CONTENT_LABEL]=i,this.getNode().setHtmlStrings(a,n.GameConfig.POPUP_CSS)},_clearCurrencyAmount:function(){this._setTextureToWidget(this.WIDGET_NAMES.CONTENT_LABEL,"")},_initButtons:function(){var e={};e[this.BUTTON_NAMES.CONFIRM]=this._navigateToShop.bind(this),e[this.BUTTON_NAMES.CANCEL]=this._close.bind(this,!1),this.setButtonEvents(e)},_close:function(e){this._clearContents(),this.dismiss(e)},_navigateToShop:function(){var e=n.createInstance("router"),t=e.getCurrentFragment();e.navigate("shop/sh_002",{},{sh_002:{returnPageRoute:t}}),this.dismiss(!1)},_setTextureToWidget:function(e,t){var n=this.getNode().seekWidgetByName(e);return null==n?void i.warn("PopupGaCheckUseStone._setTextureToWidget: Widget {"+e+"} not found!"):void n.loadTexture(t)},_setStringToWidget:function(e,t){var n=this.getNode().seekWidgetByName(e);return null==n?void i.warn("PopupGaCheckUseStone._setStringToWidget: Widget {"+e+"} not found!"):void n.setString(t)}})}((this||0).self||global),function(e){var t=(e._,e.kh),n=e.cc;e.console,t.createNameSpaceIfNotExists("gacha.vending_machine.vending_process"),t.gacha.vending_machine.vending_process.VendingController=n.Class.extend({className:"VendingController",buy:function(e){return e.isNormalGacha()?Q.resolve(!0):this._createPriceModel(e).then(this._showCurrencyPopup.bind(this))},_createPriceModel:function(e){return t.createInstance("PriceRepository").getByGachaModel(e)},_showCurrencyPopup:function(e){return this._createCurrencyPopup(e).open(e)},_createCurrencyPopup:function(e){var i,a,o=n.director.getRunningScene(),r=t.gacha.vending_machine.vending_process;return e.hasSufficientCurrency()?(i=r.PopupGaCheckUseStone.prototype.ROOT_NODE,a=r.PopupGaCheckUseStone.prototype.DI_NAME):(i=r.PopupGaNeedUseStone.prototype.ROOT_NODE,a=r.PopupGaNeedUseStone.prototype.DI_NAME),t.ImplantedPopup.createOrGet(o,i,a)}})}((this||0).self||global),function(e){var t=e._,n=e.kh,i=e.cc;n.createNameSpaceIfNotExists("gacha.vending_machine.buy_buttons"),n.gacha.vending_machine.buy_buttons.BuyButtonController=i.Class.extend({className:"BuyButtonController",BUTTON_NAMES:{SINGLE_DRAW_BUTTON:"btn_gacha_bottom",MULTIPLE_DRAW_BUTTON:"btn_gacha_top"},initializeBuyButtons:function(e){var n=t.sortBy(e.getGachas(),function(e){return-1*e.getDrawCount()});t.each(n,function(t,n){this._initializeBuyButton(t,e,n)},this),this._animateButtonView(e,n)},initializeDisabledGachaButton:function(e){var n=t.sortBy(e.getGachaInformation(),function(e){return-1*e.getDrawCount()});this._animateButtonView(e,n),t.each(n,function(e,t){var n=this._getButtonName(t),i=this._getButtonByName(n),a=this._createButtonView(i,e);a.showImage(),a.setEnabled(!1)},this)},_animateButtonView:function(e,t){var n=i.director.getRunningScene().seekWidgetByName("ga_main_btn_ui");return e.isNormalGacha()?e.getRemainAmount()>0&&e.hasReachedItemStockLimit()?void n.setAppearance("default_view"):void n.setAppearance("normal_gacha_btn"):0===t.length?void n.setAppearance("default_view"):1===t.length?void n.setAppearance("single_btn"):void(2===t.length&&n.setAppearance("double_btn"))},setOnBuySucceededCallback:function(e,t){this._onBuySucceeded=e.bind(t)},_initializeBuyButton:function(e,t,n){var i=this._getButtonName(n),a=this._getButtonByName(i),o=this._createButtonView(a,e);o.showImage(),this._setButtonTouchEvent(a,e),this._updateButtonEnabledState(a,o,t,e)},_getButtonName:function(e){return 0===e?this.BUTTON_NAMES.MULTIPLE_DRAW_BUTTON:this.BUTTON_NAMES.SINGLE_DRAW_BUTTON},_getButtonByName:function(e){var t=i.director.getRunningScene().seekWidgetByName(e);if(null==t)throw new Error("BuyButtonController._getButtonByName: button {"+e+"} not found!");return t},_createButtonView:function(e,t){return n.createInstance("BuyButtonView",[e,t])},updateButtonsEnabledState:function(e){var n=t.sortBy(e.getGachas(),function(e){return-1*e.getDrawCount()});t.each(n,function(t,n){var i=this._getButtonName(n),a=this._getButtonByName(i),o=this._createButtonView(a,t);this._updateButtonEnabledState(a,o,e,t)},this)},_updateButtonEnabledState:function(e,t,n,i){return i.isEnabled()?void t.setEnabled(!0):n.isPseudoCurrencyPaymentType()?void t.setEnabled(!0):void t.setEnabled(!1)},_setButtonTouchEvent:function(e,t){e.setUserData(t),e.addTouchEventListener(this._onTouchButton,this)},_onTouchButton:function(e,t){if(t===ccui.Widget.TOUCH_ENDED){var n=e.getUserData(),i=this._createVendingController(),a=this._onBuySucceeded||function(){};i.buy(n).then(function(){a(n,this)}.bind(this))}},_createVendingController:function(){return n.createInstance("VendingController")},setEnable:function(e){t.each(this.BUTTON_NAMES,function(t){var i=this._getButtonByName(t);n.pc.roles.UIUtility._setEnableButton(i,e)}.bind(this))}})}((this||0).self||global),function(e){var t=e._,n=e.kh,i=e.cc;e.console,n.createNameSpaceIfNotExists("gacha.vending_machine.buy_buttons"),n.gacha.vending_machine.buy_buttons.BuyButtonView=i.Class.extend({className:"BuyButtonView",ctor:function(e,t){this._button=e,this._gachaModel=t},showImage:function(){var e=this._gachaModel.getGachaId(),t=this._gachaModel.getDrawCount();this._setGachaButtonImage(this._button,e,t),this._button.setVisible(!0)},_setGachaButtonImage:function(e,i,a){var o=n.Img("gacha-btn1","gacha",t.padZero(i,4),a).png,r=n.Img("gacha-btn2","gacha",t.padZero(i,4),a).png;e.loadTextures(o,r,o)},setGrayOut:function(e){n.pc.roles.UIUtility._setGrayOutButton.call(null,this._button,e),this._button.setVisible(!0)},setEnabled:function(e){n.pc.roles.UIUtility._setEnableButton.call(null,this._button,e),this._button.setVisible(!0)}})}((this||0).self||global),function(e){var t=(e._,e.kh),n=e.cc;t.createNameSpaceIfNotExists("gacha.rate_button"),t.gacha.rate_button.Controller=n.Class.extend({className:"RateButtonController",BUTTON_NAME:"btn_rate",ctor:function(e){this._gachaCategoryModel=e},initializeButtonVisibility:function(){var e=this._getRateButton(),n=t.createInstance("RateButtonView",[e]),i=!this._gachaCategoryModel.isTicketPaymentType()&&!this._gachaCategoryModel.isGemPaymentType();n.setVisible(i),n.cleanUp()},_getRateButton:function(){var e=n.director.getRunningScene().seekWidgetByName(this.BUTTON_NAME);if(!e)throw new Error("RateButtonController: button {"+this.BUTTON_NAME+"} not found!");return e}})}((this||0).self||global),function(e){var t=(e._,e.kh),n=e.cc;e.console,t.createNameSpaceIfNotExists("gacha.rate_button"),t.gacha.rate_button.View=n.Class.extend({className:"RateButtonView",ctor:function(e){this._button=e},setVisible:function(e){var t=e?"show":"hide";this._button.setAppearance(t)},cleanUp:function(){this._button=null}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.gacha=t.gacha||{},t.gacha.model=t.gacha.model||{},t.gacha.model.GachaContents=cc.Class.extend({_contents:null,ctor:function(e){this._contents=e}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.gacha=n.gacha||{},n.gacha.model=n.gacha.model||{},n.gacha.model.GachaTypeContentsList=cc.Class.extend({CONTENT_TYPE_LIST:["character_weapon","weapon","summon","item"],_characterWeaponList:null,_weaponList:null,_summonList:null,_itemList:null,ctor:function(e){t.each(this.CONTENT_TYPE_LIST,function(t){this._updateContentsList(e,t)}.bind(this))},getGachaContentsModels:function(e){switch(e){case"character_weapon":return this._characterWeaponList;case"weapon":return this._weaponList;case"summon":return this._summonList;case"item":return this._itemList;default:console.error("type")}},existsContents:function(){return this.existsCharacterWeapon()||this.existsWeapon()||this.existsSummon()},existsCharacterWeapon:function(){return 0!==this._characterWeaponList.length},existsWeapon:function(){return 0!==this._weaponList.length},existsSummon:function(){return 0!==this._summonList.length},_updateContentsList:function(e,t){var n=this._createContentsList(e,t);switch(t){case"character_weapon":this._characterWeaponList=n;break;case"weapon":this._weaponList=n;break;case"summon":this._summonList=n;break;case"item":this._itemList=n;break;default:console.error("type")}},_createContentsList:function(e,i){var a=t.filter(e,function(e){return e.type===i},this);return t.map(a,function(e){return n.createInstance("GachaContents",[e])})}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.gacha=n.gacha||{},n.gacha.model=n.gacha.model||{},n.gacha.model.GachaContentsInfo=cc.Class.extend({RARITY_LIST:["SSR","SR","R","N"],_gachaId:null,_displayRate:null,_gachaName:null,_rarityRate:null,_ssrContentsList:null,_srContentsList:null,_rContentsList:null,_nContentsList:null,ctor:function(e,n){this._gachaId=e.gacha_id,this._displayRate=n,this._gachaName=e.gacha_name,this._rarityRate=e.rarity_rate,t.each(this.RARITY_LIST,function(t){this._updateContentsList(e.contents,t)}.bind(this))},getGachaId:function(){return this._gachaId},getGachaName:function(){return this._gachaName},getRarityRate:function(e){return t.find(this._rarityRate,function(t,n){return n===e},this)},shouldDisplayRate:function(){return this._displayRate},equalGachaId:function(e){return this._gachaId===e},getGachaContentsModels:function(e,t){return this.getRarityContentsList(e).getGachaContentsModels(t)},existsSsrContents:function(){return this._ssrContentsList.existsContents()},existsSrContents:function(){return this._srContentsList.existsContents()},existsRContents:function(){return this._rContentsList.existsContents()},getRarityContentsList:function(e){switch(e){case"SSR":return this._ssrContentsList;case"SR":return this._srContentsList;case"R":return this._rContentsList;case"N":return this._nContentsList;default:console.error("Rarity")}},_updateContentsList:function(e,t){var n=this._createContentsList(e,t);switch(t){case"SSR":this._ssrContentsList=n;break;case"SR":this._srContentsList=n;break;case"R":this._rContentsList=n;break;case"N":this._nContentsList=n;break;default:console.error("Rarity")}},_createContentsList:function(e,i){var a=t.filter(e,function(e){return("character_weapon"===e.type?e.weapon.rare:e.rare)===i},this);return n.createInstance("GachaTypeContentsList",[a])}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.gacha=n.gacha||{},n.gacha.model=n.gacha.model||{},n.gacha.model.GachaContentsInfoList=cc.Class.extend({_gachaContentsInfoList:null,ctor:function(e,i){this._gachaContentsInfoList=t.map(e,function(e){return n.createInstance("GachaContentsInfo",[e,i])},this)},getGachaContentsInfoByGachaId:function(e){return t.find(this._gachaContentsInfoList,function(t){return t.equalGachaId(e)},this)},getFirstGachaContentsInfo:function(){return this._gachaContentsInfoList[0]},getAll:function(){return this._gachaContentsInfoList},getLength:function(){return this._gachaContentsInfoList.length}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=(e._,e.console);t.createNameSpaceIfNotExists("gacha.controller"),t.gacha.view.GachaContentsPageViewAbstract=n.Class.extend({className:"GachaContentsPageViewAbstract",BASE_NODE_NAME:"sample_base_node_name",LIST_NODE_NAME:"sample_list_node_name",PICK_UP_LABEL_NAME:"icon_arrival-up",RATE_LABEL:"arrival_rate_label",BLACK_FILTER_NODE_NAME:"filter",_scene:null,_controller:null,_displayRate:null,init:function(e,n){this._scene=e,this._displayRate=!1;var i=this._getBaseNode(),a=i.seekWidgetByName(this.LIST_NODE_NAME),o=new t.core.pager.view.page.BasePageUiFactory(a,this._initPanel.bind(this)),r=new t.core.pager.model.PlainDataList(n),s=new t.core.pager.controller.PagerController(i,r,[o],a),c=i.seekWidgetByName("viewpage_ui");return new t.core.pager.view.button.ViewPageUi(c,s).initialize(),this._controller=s,this._controller.initialize().then(function(){this.hide()}.bind(this))},updateContents:function(e,n){var i=(this._getSelectedGachaId(),this._getSelectedContentType()),a=this._getSelectedRarity(),o=this._getGachaContents(e,a,i),r=new t.core.pager.model.PlainDataList(o);this._controller.setDataList(r),this._controller.setCurrentPageNumber(n),this._controller.refresh(!1),this._displayRate=e.shouldDisplayRate()},show:function(){this._getBaseNode().setVisible(!0)},hide:function(){this._getBaseNode().setVisible(!1)},_getSelectedGachaId:function(){return t.createInstance("gachaContentsPulldownController").getSelectedGachaId()},_getSelectedRarity:function(){return t.createInstance("gachaContentsRarityTabController").getSelectedRarity()},_getSelectedContentType:function(){return t.createInstance("gachaContentsTypeTabController").getSelectedContentType()},_getSelectedPageNumber:function(){return this._controller.getCurrentPageNumber()},_getReturnRoute:function(){return t.createInstance("router").getCurrentFragment()},_getReturnParams:function(){var e=t.createInstance("routerParams").getRouterParams();return e.selected_rarity=this._getSelectedRarity(),e.selected_conent_type=this._getSelectedContentType(),e.selected_page_number=this._getSelectedPageNumber(),e.selected_gacha_id=this._getSelectedGachaId(),e.category_id||(e.category_id=this._scene._delegate._getCategoryId()),e.event_id||(e.event_id=t.createInstance("routerParams").getTemporaryRouterParams().event_id),e},_getBaseNode:function(){return this._scene.seekWidgetByName(this.BASE_NODE_NAME)},_shouldDisplayRate:function(){return this._displayRate},_initPanel:function(e,t){i.error("")},_getGachaContents:function(e,t,n){var a=e.getGachaContentsModels(t,n);return a||void i.error(": rarity:"+t+", type:"+n)}}),t.assignRoles(t.gacha.view.GachaContentsPageViewAbstract,[t.pc.roles.UIUtility,t.pc.roles.CoreCardCommon,t.pc.gacha.roles.Routing])}((this||0).self||global),function(e){var t=e.kh;e.cc,e._,e.console,t.createNameSpaceIfNotExists("gacha.controller"),t.gacha.view.GachaContentsCharacterWeaponPageView=t.gacha.view.GachaContentsPageViewAbstract.extend({className:"GachaContentsCharacterWeaponPageView",BASE_NODE_NAME:"chara_node",LIST_NODE_NAME:"ga_contents_chara_list_page_ui",CHARACTER_CORE_CARD_NODE_NAME:"corecard_chara_ui",CHARACTER_IMG_NODE_NAME:"chara_img",WEAPON_CORE_CARD_NODE_NAME:"corecard_weapon_ui",WEAPON_IMG_NODE_NAME:"weapon_img",_initPanel:function(e,t){var n=t.getRawData()._contents,i=n.character,a=n.weapon,o=n.rate,r=n.pickup;this._setCharacter(e,i),this._setWeapon(e,a,o,r)},_setCharacter:function(e,t){this._setCharcterImg(e,t),this._setCharacterTouchEvent(e,t)},_setWeapon:function(e,t,n,i){this._setWeaponImg(e,t,n,i),this._setWeaponTouchEvent(e,t)},_setCharcterImg:function(e,t){t.kind="character",this._setCharacterCoreCardElementRarity(e,t,this.CHARACTER_CORE_CARD_NODE_NAME)},_setCharacterTouchEvent:function(e,t){var n=e.seekWidgetByName(this.CHARACTER_IMG_NODE_NAME);n.setTouchEnabled(!0),n.addTouchEventListener(function(e,n){if(n===ccui.Widget.TOUCH_ENDED){var i=this._getReturnRoute(),a=this._getReturnParams();this._navigateCharacterStatus(t.id,i,a)}}.bind(this))},_setWeaponImg:function(e,t,n,i){t.kind="weapon";var a=e.seekWidgetByName(this.RATE_LABEL),o=e.seekWidgetByName(this.PICK_UP_LABEL_NAME);if(o.setVisible(i),o.setZOrder(10),this._shouldDisplayRate())return a.setString(n),a.setVisible(!0),this._setWeaponCoreCardFull(e,t,this.WEAPON_CORE_CARD_NODE_NAME),void e.seekWidgetByName(this.BLACK_FILTER_NODE_NAME).setVisible(!0);a.setVisible(!1),this._setWeaponCoreCardElementRarity(e,t,this.WEAPON_CORE_CARD_NODE_NAME),e.seekWidgetByName(this.BLACK_FILTER_NODE_NAME).setVisible(!1)},_setWeaponTouchEvent:function(e,t){var n=e.seekWidgetByName(this.WEAPON_IMG_NODE_NAME);n.setTouchEnabled(!0),n.addTouchEventListener(function(e,n){if(n===ccui.Widget.TOUCH_ENDED){var i=this._getReturnRoute(),a=this._getReturnParams();this._navigateWeaponStatus(t.id,i,a)}}.bind(this))}})}((this||0).self||global),function(e){var t=e.kh;e.cc,e._,e.console,t.createNameSpaceIfNotExists("gacha.controller"),t.gacha.view.GachaContentsWeaponPageView=t.gacha.view.GachaContentsPageViewAbstract.extend({className:"GachaContentsWeaponPageView",BASE_NODE_NAME:"weapon_node",LIST_NODE_NAME:"ga_contents_weapon_summon_list_page_ui",CORE_CARD_NODE_NAME:"corecard_weapon_summon_ui",IMG_NODE_NAME:"weapon_img",_initPanel:function(e,t){var n=t.getRawData()._contents;this._setImg(e,n),this._setTouchEvent(e,n)},_setImg:function(e,t){t.kind="weapon";var n=e.seekWidgetByName(this.RATE_LABEL),i=e.seekWidgetByName(this.PICK_UP_LABEL_NAME);if(i.setVisible(t.pickup),i.setZOrder(10),this._shouldDisplayRate())return n.setString(t.rate),n.setZOrder(10),n.setVisible(!0),this._setWeaponCoreCardFull(e,t,this.CORE_CARD_NODE_NAME),void e.seekWidgetByName(this.BLACK_FILTER_NODE_NAME).setVisible(!0);n.setVisible(!1),this._setWeaponCoreCardElementRarity(e,t,this.CORE_CARD_NODE_NAME),e.seekWidgetByName(this.BLACK_FILTER_NODE_NAME).setVisible(!1)},_setTouchEvent:function(e,t){var n=e.seekWidgetByName(this.IMG_NODE_NAME);n.setTouchEnabled(!0),n.addTouchEventListener(function(e,n){if(n===ccui.Widget.TOUCH_ENDED){var i=this._getReturnRoute(),a=this._getReturnParams();this._navigateWeaponStatus(t.id,i,a)}}.bind(this))}})}((this||0).self||global),function(e){var t=e.kh;e.cc,e._,e.console,t.createNameSpaceIfNotExists("gacha.controller"),t.gacha.view.GachaContentsSummonPageView=t.gacha.view.GachaContentsPageViewAbstract.extend({className:"GachaContentsSummonPageView",BASE_NODE_NAME:"summon_node",LIST_NODE_NAME:"ga_contents_weapon_summon_list_page_ui",CORE_CARD_NODE_NAME:"corecard_weapon_summon_ui",IMG_NODE:"summon_img",_initPanel:function(e,t){var n=t.getRawData()._contents;this._setImg(e,n),this._setTouchEvent(e,n)},_setImg:function(e,t){t.kind="summon";var n=e.seekWidgetByName(this.RATE_LABEL),i=e.seekWidgetByName(this.PICK_UP_LABEL_NAME);if(i.setVisible(t.pickup),i.setZOrder(10),this._shouldDisplayRate())return n.setString(t.rate),n.setZOrder(10),n.setVisible(!0),this._setSummonCoreCardFull(e,t,this.CORE_CARD_NODE_NAME),void e.seekWidgetByName(this.BLACK_FILTER_NODE_NAME).setVisible(!0);n.setVisible(!1),this._setSummonCoreCardElementRarity(e,t,this.CORE_CARD_NODE_NAME),e.seekWidgetByName(this.BLACK_FILTER_NODE_NAME).setVisible(!1)},_setTouchEvent:function(e,t){var n=e.seekWidgetByName(this.IMG_NODE);n.setTouchEnabled(!0),n.addTouchEventListener(function(e,n){if(n===ccui.Widget.TOUCH_ENDED){var i=this._getReturnRoute(),a=this._getReturnParams();this._navigateSummonStatus(t.id,i,a)}}.bind(this))}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.console;t.createNameSpaceIfNotExists("gacha.controller"),t.gacha.controller.GachaContentsViewController=n.Class.extend({className:"GachaContentsViewController",_selectedGachaContentsInfo:null,_characterWeaponPageView:null,_weaponPageView:null,_summonPageView:null,_gachaContentsInfoList:null,init:function(e,n){this._gachaContentsInfoList=n,this._characterWeaponPageView=t.createInstance("gachaContentsCharacterWeaponPageView"),this._weaponPageView=t.createInstance("gachaContentsWeaponPageView"),this._summonPageView=t.createInstance("gachaContentsSummonPageView");var i=this._gachaContentsInfoList.getFirstGachaContentsInfo();this._selectedGachaContentsInfo=i;var a=i.getGachaContentsModels("SSR","character_weapon"),o=i.getGachaContentsModels("SSR","weapon"),r=i.getGachaContentsModels("SSR","summon");return Q.all([this._characterWeaponPageView.init(e,a),this._weaponPageView.init(e,o),this._summonPageView.init(e,r)]).spread(function(){}.bind(this))},updateContents:function(){var e=n.director.getRunningScene(),t=this._getSelectedGachaId(),i=this._getSelectedContentType(),o=this._getInitPageNumber(e);delete e.temporaryRouterParams.selected_page_number;var r=this._gachaContentsInfoList.getGachaContentsInfoByGachaId(t);if(r)switch(this._selectedGachaContentsInfo=r,i){case"character_weapon":this._characterWeaponPageView.updateContents(r,o),this._showCharacterWeapon();break;case"weapon":this._weaponPageView.updateContents(r,o),this._showWeapon();break;case"summon":this._summonPageView.updateContents(r,o),this._showSummon();break;default:a.warn(" contentType:"+i)}else a.warn(" gachaId:"+t)},_getSelectedGachaId:function(){return t.createInstance("gachaContentsPulldownController").getSelectedGachaId()},_getSelectedRarity:function(){return t.createInstance("gachaContentsRarityTabController").getSelectedRarity()},_getSelectedContentType:function(){return t.createInstance("gachaContentsTypeTabController").getSelectedContentType()},_getInitPageNumber:function(e){var t=e.temporaryRouterParams;return i.isUndefined(t.selected_page_number)?1:e.temporaryRouterParams.selected_page_number},_showCharacterWeapon:function(){this._weaponPageView.hide(),this._summonPageView.hide(),this._characterWeaponPageView.show()},_showWeapon:function(){this._characterWeaponPageView.hide(),this._summonPageView.hide(),this._weaponPageView.show()},_showSummon:function(){this._characterWeaponPageView.hide(),this._weaponPageView.hide(),this._summonPageView.show()}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;e.console,t.createNameSpaceIfNotExists("gacha.controller"),t.gacha.controller.GachaContentsTypeTabController=n.Class.extend({className:"GachaContentsTypeTabController",TAB_NODE_NAME:"tab_btn_ui",TAB_NODE_INFO_LIST:[{amount:1,animationName:"tab_one",btn_node_name_list:["tab_one"]},{amount:2,animationName:"tab_two",btn_node_name_list:["tab_two_0","tab_two_1"]},{amount:3,animationName:"tab_three",btn_node_name_list:["tab_three_0","tab_three_1","tab_three_2"]}],TAB_TEXT_LIST:{character_weapon:"",weapon:"",summon:""},_selectedContentType:null,init:function(e,t){var n=this._getSelectedRarity(),a=t.getRarityContentsList(n),o=this._getDisplayTypeList(a),r=this._getTabNodeInfo(o.length),s=e.seekWidgetByName(this.TAB_NODE_NAME);s.setAppearance(r.animationName);var c=r.btn_node_name_list;i.each(o,function(t,n){this._setBtnAppearance(t,s,c,n),this._setTouchEvent(e,s,t,c,n)},this);var u=this._getInitContentTypeKey(e,o);delete e.temporaryRouterParams.selected_conent_type,this._selectGacha(s,c[u],c,o[u])},getSelectedContentType:function(){return this._selectedContentType},_getSelectedRarity:function(){return t.createInstance("gachaContentsRarityTabController").getSelectedRarity()},_setSelectedContentType:function(e){this._selectedContentType=e},_getInitContentTypeKey:function(e,t){var n=e.temporaryRouterParams;return i.isUndefined(n.selected_conent_type)?0:i.findIndex(t,function(e){return e===n.selected_conent_type})},_setBtnAppearance:function(e,t,n,i){var a=n[i];t.seekWidgetByName(a).setTitleText(this.TAB_TEXT_LIST[e])},_setTouchEvent:function(e,t,n,i,a){var o=i[a];t.seekWidgetByName(o).addTouchEventListener(function(e,a){a===ccui.Widget.TOUCH_ENDED&&this._touchEvent(t,o,i,n)}.bind(this))},_selectGacha:function(e,n,i,a){this._setSelectedContentType(a),t.createInstance("gachaContentsViewController").updateContents(),this._setBtnBright(e,n,i)},_touchEvent:function(e,n,i,a){this._setSelectedContentType(a),t.createInstance("gachaContentsViewController").updateContents(),this._setBtnBright(e,n,i)},_setBtnBright:function(e,t,n){i.each(n,function(n){n!==t&&e.seekWidgetByName(n).setBright(!0)},this),e.seekWidgetByName(t).setBright(!1)},_getTabNodeInfo:function(e){return i.find(this.TAB_NODE_INFO_LIST,function(t){return t.amount===e},this)},_getDisplayTypeList:function(e){var t=e.existsCharacterWeapon(),n=e.existsWeapon(),i=e.existsSummon(),a=[];return t&&a.push("character_weapon"),n&&a.push("weapon"),i&&a.push("summon"),a}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;e.console,t.createNameSpaceIfNotExists("gacha.controller"),t.gacha.controller.GachaContentsRarityTabController=n.Class.extend({className:"GachaContentsRarityTabController",TAB_NODE_NAME:"tab_ui",TAB_NODE_INFO_LIST:[{amount:1,animationName:"tab_one",btn_node_name_list:["tab_one_two_0"]},{amount:2,animationName:"tab_two",btn_node_name_list:["tab_one_two_0","tab_two_1"]},{amount:3,animationName:"tab_three",btn_node_name_list:["tab_three_0","tab_three_1","tab_three_2"]}],_selectedGachaContentsInfo:null,_selectedRarity:null,init:function(e,t){var n=this._getDisplayRarityList(t),a=this._getTabNodeInfo(n.length),o=e.seekWidgetByName(this.TAB_NODE_NAME);o.setAppearance(a.animationName);var r=a.btn_node_name_list;i.each(n,function(n,i){this._setBtnAppearance(t,n,o,r,i),this._setTouchEvent(e,t,o,n,r,i)},this);var s=this._getInitRarityKey(e,n);delete e.temporaryRouterParams.selected_rarity,this._touchEvent(e,t,n[s],r[s],r)},getSelectedRarity:function(){return this._selectedRarity},_setSelectedRarity:function(e){this._selectedRarity=e},_getInitRarityKey:function(e,t){var n=e.temporaryRouterParams;return i.isUndefined(n.selected_rarity)?0:i.findIndex(t,function(e){return e===n.selected_rarity})},_setBtnAppearance:function(e,t,n,i,a){var o=i[a],r=n.seekWidgetByName(o);r.seekWidgetByName("rarity_icon").loadTexture("core/res/icon/rarityicon_"+t+".png",ccui.Widget.PLIST_TEXTURE);var s=r.seekWidgetByName("rate_label"),c=e.getRarityRate(t);s.setString(c)},_getTabNode:function(e){return e.seekWidgetByName(this.TAB_NODE_NAME)},_setTouchEvent:function(e,t,n,i,a,o){var r=a[o];n.seekWidgetByName(r).addTouchEventListener(function(n,o){o===ccui.Widget.TOUCH_ENDED&&this._touchEvent(e,t,i,r,a)}.bind(this))},_touchEvent:function(e,t,n,i,a){var o=this._getTabNode(e);this._shouldUpdateDisplay(o,i,t)&&(this._selectedGachaContentsInfo=t,this._initContentTab(e,this._selectedGachaContentsInfo,n),this._setBtnBright(o,i,a))},_shouldUpdateDisplay:function(e,t,n){return!this._equalSelectedRarity(e,t)||!this._equalSelectedGacha(n)},_equalSelectedRarity:function(e,t){return!i.isNull(this._selectedGachaContentsInfo)&&!e.seekWidgetByName(t).isBright()},_equalSelectedGacha:function(e){return!i.isNull(this._selectedGachaContentsInfo)&&this._selectedGachaContentsInfo.equalGachaId(e.getGachaId())},_initContentTab:function(e,n,i){this._setSelectedRarity(i),t.createInstance("gachaContentsTypeTabController").init(e,n)},_setBtnBright:function(e,t,n){i.each(n,function(n){n!==t&&e.seekWidgetByName(n).setBright(!0)},this),e.seekWidgetByName(t).setBright(!1)},_getTabNodeInfo:function(e){return i.find(this.TAB_NODE_INFO_LIST,function(t){return t.amount===e},this)},_getDisplayRarityList:function(e){var t=e.existsSsrContents(),n=e.existsSrContents(),i=e.existsRContents(),a=[];return t&&a.push("SSR"),n&&a.push("SR"),i&&a.push("R"),a}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.console;t.createNameSpaceIfNotExists("gacha.controller"),t.gacha.controller.GachaContentsPulldownController=n.Class.extend({className:"GachaContentsPulldownController",PULLDOWN_BASE_NODE_NAME:"title_base",PULLDOWN_NODE_NAME:"btn_pulldown_category",_pulldown:null,_selectedGachaId:null,init:function(e,n){this._setPulldownVisible(e,n.getLength()>1),this._pulldown=this._createPulldown(e,n),t.createInstance("gachaContentsViewController").init(e,n).then(function(){var a=t.createInstance("gachaContentsRarityTabController"),o=this._getInitGachaId(e);if(delete e.temporaryRouterParams.selected_gacha_id,i.isNull(o))var r=n.getFirstGachaContentsInfo();else r=n.getGachaContentsInfoByGachaId(o);a.init(e,r)}.bind(this)).fail(function(e){a.error(e)})},_getInitGachaId:function(e){return i.isUndefined(e.temporaryRouterParams.selected_gacha_id)?null:e.temporaryRouterParams.selected_gacha_id},getSelectedGachaId:function(){return this._selectedGachaId},_setSelectedGachaId:function(e){this._selectedGachaId=e},_getPulldownNode:function(e){return e.seekWidgetByName(this.PULLDOWN_NODE_NAME)},_setPulldownVisible:function(e,t){e.seekWidgetByName(this.PULLDOWN_BASE_NODE_NAME).setVisible(t)},_createPulldown:function(e,n){var a=this._getPulldownNode(e),o=this._getInitGachaId(e);if(i.isNull(o))var r=n.getFirstGachaContentsInfo().getGachaId();else r=o;this._setSelectedGachaId(r);var s=a.getUserData();if(s instanceof t.Pulldown)return s.selectValue(r),s.setTouchEnabled(!0),s;var c=this._createChoices(n),u=a.getChildren()[0];(s=new t.Pulldown({button:a,label:u,diffFromAnchorPoint:!0},c)).selectValue(r),s.onChange(function(t){this._selectGacha(e,n,t)}.bind(this));var l=this._isTouchedEnablePulldown(n);return s.setTouchEnabled(l),a.setUserData(s),s},_createChoices:function(e){return i.map(e.getAll(),function(e){return{value:e.getGachaId(),text:e.getGachaName()}})},_isTouchedEnablePulldown:function(e){return e.getAll().length>1},_selectGacha:function(e,n,i){var a=n.getGachaContentsInfoByGachaId(i.value),o=t.createInstance("gachaContentsRarityTabController");this._setSelectedGachaId(a.getGachaId()),o.init(e,a)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("gacha.enum"),t.createNameSpaceIfNotExists("gacha.model"),t.gacha.model.GachaBanners=n.Class.extend({className:"GachaBanners",_promise:null,_tabList:null,_isDisplayProbability:!1,_bannerList:null,initialize:function(){return this._eventIdtoTabIndex={},this._promise=t.createInstance("apiGachaCategories").getGachaCategories().then(function(e){return this._bannerList=[],this._tabList=e.body.tabs.map(function(e,n){return this._eventIdtoTabIndex[e.event_id]=n,Array.prototype.push.apply(this._bannerList,e.banners),{tabName:e.name,list:new t.core.pager.model.PlainDataList(e.banners)}}.bind(this)),this._isDisplayProbability=!0===e.body.display_probability,this}.bind(this)),this._promise},isInitialized:function(){return null===this._promise&&(this._promise=this.initialize()),this._promise},getTabs:function(){return this._tabList},getTabIndex:function(e){return this._eventIdtoTabIndex[e]},getCategoryId:function(e){return this._bannerList?(_.find(this._bannerList,function(t){return t.event_id===e})||{}).category_id:null},getAllBanner:function(){return this._bannerList},isDisplayProbability:function(){return this._isDisplayProbability}})}((this||0).self||global),(this||0).self||global,kh.createNameSpaceIfNotExists("gacha.model"),kh.gacha.model.GachaResult=cc.Class.extend({className:"GachaResult",ctor:function(e){for(var t=e,n=t.obtained_info.length,i=[],a=[],o=0;o<n;o++)if(!_.isUndefined(t.obtained_info[o].weapon_info)){var r=t.obtained_info[o].weapon_info;_.isUndefined(r.item_gained_info)||(i.push(r.item_gained_info.item_id),a.push(r.item_gained_info.item_name))}this._results=t.obtained_info,this._itemNoArray=i,this._itemNameArray=a,this._type=n,this._animationData=t.animation_data},getGachaResults:function(){return _.cloneDeep(this._results)},getItemNoArray:function(){return _.cloneDeep(this._itemNoArray)},getItemNameArray:function(){return _.cloneDeep(this._itemNameArray)},getType:function(){return this._type},getAnimationData:function(){return this._animationData}}),function(e){var t=e.kh,n=(e.cc,e._);e.Q,t.pc.gacha=t.pc.gacha||{},t.pc.gacha.controller=t.pc.gacha.controller||{},t.pc.gacha.controller.GachaBannerPageListController=t.SceneObject.extend({_scene:null,_listModel:null,TOUCH_SET:{targetNode:"eventimg_banner",touchEventFuncName:"_gachaBannerTouchEvent"},ctor:function(e,t){this._scene=e,this._listModel=t},show:function(){this._listModel.getAllContent().then(this._fillupGachaBannerList.bind(this))},_fillupGachaBannerList:function(e){$staticRes(res["gacha-ga_000-ga_bannerlist_page_ui"]),this._fillupList(this._scene,{viewParent:t.PageListParams.GACHA_BANNER.viewParent,subPageRes:t.PageListParams.GACHA_BANNER.subPageRes,panelsPerPage:t.PageListParams.GACHA_BANNER.perPage},e.map(function(e){return e.getRawData()}),e.length,this.TOUCH_SET,this._panelAppearanceForCommon)},_panelAppearanceForCommon:function(e,i,a){var o=t.Img("eventimg","banner",n.padZero(i.banner_id,4)).png,r=e.seekWidgetByName("eventimg_banner");return null===r?void console.warn("[ERROR] Could not find eventimg_banner"):void r.loadTextures(o,o,o)},_gachaBannerTouchEvent:function(e,t){this._navigate000ToGacha(this._scene,t)}}),n.assign(t.pc.gacha.controller.GachaBannerPageListController.prototype,t.pc.gacha.roles.Routing,t.pc.list.roles.PageListControllerCommon)}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);e.Q,t.pc.gacha=t.pc.gacha||{},t.pc.gacha.roles=t.pc.gacha.roles||{},t.pc.gacha.roles.PlayGachaBase={_setGachaHeaderImage:function(e,i){var a=i.category_id,o=t.Img("gachatitle","gacha-category",n.padZero(a,4)).png;return null===e.seekWidgetByName("gachatitle_event")?void console.warn("[ERROR] Could not find gachatitle_event."):void e.loadTextures({gachatitle_event:o})},_setGachaHeaderDescription:function(e){return n.isUndefined(this._gachaData)||n.isUndefined(this._gachaData.sliders)?void console.warn("[ERROR] Could not read gacha data."):null===e.seekWidgetByName("sub_title_label")?void console.warn("[ERROR] Could not find gachatitle_event."):void e.setStrings({sub_title_label:this._gachaData.description})},_setGachaSlider:function(e){if(n.isUndefined(this._gachaData)||n.isUndefined(this._gachaData.sliders))console.warn("[ERROR] Could not read gacha data.");else{this._setSlider(e,"slider_panel",this._gachaData.sliders,"gacha-ga_001_2_3_4-ga_top_slider_ui","_setGachaSliderPanel",{nodeName:"gachatop_slider",funcName:"_onTouchSliderPanel"},"_slideGachaPanel",{interval:t.GameConfig.ANIMETION_WAIT_SETTINGS.GACHA_MAIN_SLIDER_INTERVAL});var i=this._gachaData.sliders.length>1,a=e.seekWidgetByName("window_gray");a.scheduleOnce(function(){a.bfsWidgetByName("btn_next").setVisible(!i),a.bfsWidgetByName("btn_prev").setVisible(!i),a.bfsWidgetByName("btn_next").setVisible(i),a.bfsWidgetByName("btn_prev").setVisible(i)},.5)}},_setGachaSliderPanel:function(e,i,a){return null===i.seekWidgetByName("gachatop_slider")?void console.warn("[ERROR] Could not find image node: gachatop_slider"):n.isUndefined(a.slider_id)?void console.warn("[ERROR] Could not find slider id."):void i.loadTextures({gachatop_slider:t.Img("gachatop","slider",n.padZero(a.slider_id,4)).jpg})},_slideGachaPanel:function(e,t){},_onTouchSliderPanel:function(e,n,i){var a=t.createInstance("router").getCurrentFragment(),o=t.createInstance("routerParams").getRouterParams();this._navigateStatusDetail(e,i,a,o)}},n.assign(t.pc.gacha.roles.PlayGachaBase,t.pc.list.roles.SliderCommon)}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._),i=e.Q;t.pc.gacha=t.pc.gacha||{},t.pc.gacha.roles=t.pc.gacha.roles||{},t.pc.gacha.roles.GachaToGachaSlider={_setGachaToGachaSlider:function(e,n){var a=t.createInstance("router").getCurrentFragment(),o=a.replace(/^gacha\//g,""),r=e.routerParams[o];return r?n.then(function(t){this._setGachaToGachaNumber(e,r.event_id,t.getAllBanner()),this._setGachaToGachaButtonSound(e)}.bind(this)):(console.warn(a,o),i.reject("Expected routerParam not found."))},_setGachaToGachaNumber:function(e,t,i){var a=i.length,o=n.findIndex(i,function(e){return e.event_id===t},this);0!==o?this._prevGachaCategory=i[o-1]:0===o&&(this._prevGachaCategory=i[a-1]),o!==a-1?this._nextGachaCategory=i[o+1]:o===a-1&&(this._nextGachaCategory=i[0]),e.setStrings({page_num:o+1+"/"+a})},_setGachaToGachaButtonSound:function(e){var n=e.seekWidgetByName("btn_next_gacha"),i=e.seekWidgetByName("btn_prev_gacha");n.setSound(t.SoundList.BUTTON_TOUCHED_SWITCH),i.setSound(t.SoundList.BUTTON_TOUCHED_SWITCH)},_getNextGachaCategory:function(){return n.isUndefined(this._nextGachaCategory)?"":this._nextGachaCategory},_getPrevGachaCategory:function(){return n.isUndefined(this._prevGachaCategory)?"":this._prevGachaCategory}}}((this||0).self||global),function(e){var t=e.kh,n=e._,i=e.blowfish,a=i.decrypt;t.EpisodeImage=cc.Class.extend({_episodeRecordCache:{},loadTextureToImageView:function(o,r,s,c){return n.isUndefined(s)?(console.warn("episode_id is not specified"),Q.resolve()):(this._episodeRecordCache[s]?Q.resolve(this._episodeRecordCache[s]):t.createInstance("apiEpisodes").get(s).then(function(e){return this._episodeRecordCache[s]=e,e}.bind(this))).then(function(t){var i=t.body.chapters[0].harem_scenes;if(n.isArray(i)&&0<i.length){var a=i[0];if(n.isUndefined(a))return e.console.warn(" 1"),"";var o=a.harem_scene_id;return n.isUndefined(o)?(e.console.warn(" 2"),""):a.resource_directory||""}var r=t.body.chapters[0].scenarios;if(n.isArray(r)&&0<r.length){var s=r[0];if(n.isUndefined(s))return e.console.warn(" 1"),"";var c=s.scenario_id;return n.isUndefined(c)?(e.console.warn(" 2"),""):s.resource_directory||""}}.bind(this)).then(function(e){var u=e.match(/[^\/]+$/);if(u){var l;if((u=u[0]).indexOf("-")<0&&(u=a.call(i,u,"bLoWfIsH",{outputType:1,cipherMode:0})),u=u.replace(/^[\w-_]+_(\d{4}-\d{1}-\d{1})-[HS]$/,function(e,t){return t}),/main/.test(r)){var _=s,p=c;l=t.Img("questimg",r,n.padZero(_,4),p).png,console.debug("[!! DEBUG IMG POPUP MAIN STORY !!]",l)}else l=t.Img("questimg",r.replace(/cter$/,"")+"-quest",u,c).png,console.debug("[!! DEBUG IMG POPUP CHARA STORY !!]",l);return o.loadTexture(l),Q.resolve()}}.bind(this)).fail(function(t){e.console.warn(t)})}})}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.gacha=t.pc.gacha||{},t.pc.gacha.ga_000=t.pc.gacha.ga_000||{},t.pc.gacha.ga_000.Scene=t.BaseScene.extend({resourceFileName:"ga_000/ga_000.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"gacha",sceneName:"ga_000",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_hint","btnCallbackBtnHint",null,function(){alert("{{popup com_tutorial}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_notice","btnCallbackBtnNotice",null,function(e){return t.ImplantedPopup.createOrGet(this,"ga_tips",void 0).open()}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._),i=e.Q;t.pc=t.pc||{},t.pc.gacha=t.pc.gacha||{},t.pc.gacha.ga_000=t.pc.gacha.ga_000||{},t.pc.gacha.ga_000.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../ga_popup_ui.json"],_popups:{},onSceneInit:function(e){return this._verifyRouterParams000(e),this._setBackBtn(e),this._gachaInitialize.then(function(){var t=this._gachaBanners.getTabs();if(this._initializeTabUi(e,t),e.temporaryRouterParams.ga_000&&n.isNumber(e.temporaryRouterParams.ga_000.event_id)){var i=this._gachaBanners.getTabIndex(e.temporaryRouterParams.ga_000.event_id)||0;this._selectTab(e,i),this._gachaInitialize=null}else this._selectTab(e,0)}.bind(this))},_initializeTabUi:function(e,t){var n=e.bfsWidgetByName("tab_ui");this._initializeTabButton(n,t),this._initializeTabAnimation(n,t),this._initializeBannerPageControllers(e,t)},_initializeTabButton:function(e,t){e.getChildren().forEach(function(n){var i=/_([0-9]+)$/.exec(n.getName());if(i){var a=parseInt(i[1]);if(!t[a])return void n.setVisible(!1);n.setTitleText(t[a].tabName),n.addTouchEventListener(this.__tabTouchCallback,{self:this,tabUiNode:e,tabNumber:a})}}.bind(this))},_initializeTabAnimation:function(e,t){var n;switch(t.length){case 2:n="tab_two";break;case 3:n="tab_three";break;case 4:n="tab_four";break;default:n="tab_nothing"}e.setAppearance(n)},_initializeBannerPageControllers:function(e,n){this._bannerPageControllers=n.map(function(n){return new t.pc.gacha.controller.GachaBannerPageListController(e,n.list)})},_selectTab:function(e,t){var n=new RegExp("_"+t+"$");e.getChildren()[0].bfsWidgetByName("tab_ui").getChildren().forEach(function(e){var t=null!==n.exec(e.getName());e.setBright(!t),e.setEnabled(!t)}),this._bannerPageControllers[t].show()},__tabTouchCallback:function(e,t){t===ccui.Widget.TOUCH_ENDED&&(this.tabUiNode.getChildren().forEach(function(t){var n=t===e;t.setBright(!n),t.setEnabled(!n)}),this.self._bannerPageControllers[this.tabNumber].show())},onSceneEnter:function(e){this._gachaBanners=new t.gacha.model.GachaBanners,this._tutorialPromise=t.tutorial.startTutorialIfNeed(e),this._gachaInitialize=this._tutorialPromise.fail(function(){}).then(this._gachaBanners.initialize.bind(this._gachaBanners))},onSceneExit:function(e){return this._gachaBanners=null,i.resolve()},_openSubTutorialPopup:function(e){return t.ImplantedPopup.createOrGet(e,"sub_tutorial","ImplantedSubTutorialPopup").open("gacha",2)},btnCallbackBtnHint:function(e){return this._openSubTutorialPopup(e),i.reject(this._override)},btnCallbackBtnNotice:function(e){var n=this._gachaBanners;return t.ImplantedPopup.createOrGet(e,"ga_tips").open(n.isDisplayProbability()),i.reject(this._override)},_touchEndedBackBtnProcess:function(e){this._navigateToMy001()}}),n.assign(t.pc.gacha.ga_000.SceneDelegate.prototype,t.pc.gacha.roles.Routing)}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.gacha=t.pc.gacha||{},t.pc.gacha.ga_010=t.pc.gacha.ga_010||{},t.pc.gacha.ga_010.Scene=t.BaseScene.extend({resourceFileName:"ga_010/ga_010.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"gacha",sceneName:"ga_010",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_exchange","btnCallbackBtnExchange",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"exchangeitem/exchit_001")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_present","btnCallbackBtnPresent",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"present/prs_001")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_simple","btnCallbackBtnSimple",null,function(){alert("{{}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_enh_evo","btnCallbackBtnEnhEvo",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"enh_evo/enh_001")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_sell","btnCallbackBtnSell",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"list/li_007")),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc=t.pc||{},t.pc.gacha=t.pc.gacha||{},t.pc.gacha.ga_010=t.pc.gacha.ga_010||{},t.pc.gacha.ga_010.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../ga_popup_ui.json"],_popups:{popupOpenEpisode:{factoryName:"popupFactoryPopupCommon",resourceName:"core-popup-com_open_episode",title:"",buttonLabels:{blackBtn:""},onPopupOpened:function(e,t){var i=e.seekWidgetByName("harlem_release_label");i&&(i.setTextVerticalAlignment(n.VERTICAL_TEXT_ALIGNMENT_CENTER),i.setString(t.name+"\r\n")),t.setCoreCardFunc(e,t,"core_img")},buttons:{blackBtn:function(e){var t=e._delegate;this.dismiss().then(t._showPopupReleasedEpisodeIfExists.bind(t,e))}}},popupSSRText:{factoryName:"popupFactoryPopupCommon",resourceName:"core-popup-ga_item_info",content:"",title:"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){}}}},onSceneInit:function(e){var n=!0===e.routerParams.ga_010.useSimpleAnimation&&!0!==e.routerParams.ga_010.fromAnimation;t.createInstance("myselfInfoRepository").allCacheClear();var a=this._showGachaResult(e,n);return this._setBackBtn(e),i.isUndefined(e.routerParams.ga_010)||i.isUndefined(e.routerParams.ga_010.params)||this._setEventId(e.routerParams.ga_010.params.event_id),this._showGachaMenu(e,a)},onSceneEnter:function(e){var n=e.routerParams.ga_010;return t.createInstance("soundPlayer").init(t.createInstance("playerGameConfig")),this._categoryId=n.params.category_id,this._apiGachaDfd=t.tutorial.startTutorialIfNeed(e).then(this._getApiGachaDfd.bind(this,n),this._getApiGachaDfd.bind(this,n)),a.resolve()},_refreshGachaInformation:function(e,t){var n=e.routerParams.ga_010;this._apiGachaDfd=this._getApiGachaDfd(n),this._showGachaMenu(e,t)},_showGachaMenu:function(e,n){var i=e.routerParams.ga_010;return this._apiGachaDfd.then(function(a){var o=t.createInstance("GachaCategoryModel",[a.body]),r=i.params.gacha_id;this._showOtherNavigateBtn(e,o),this._showRemainingAmount(e,o),this._showSimpleAnimationSetting(e,o),this._setExchangeItemId(o),t.createInstance("ExchangeItemController").initializeExchangeItemButton(r),t.createInstance("GachaCurrencyAmountSeparateLabelController",[o,r]).initializeLabelText();var s=t.createInstance("BuyButtonController");return o.existsGacha()?(s.initializeBuyButtons(o),s.setOnBuySucceededCallback(this._playGacha,this),void(this._playingNikeLeverAnimation&&n&&!o.hasReachedItemStockLimit()&&(s.setEnable(!1),n.then(s.updateButtonsEnabledState.bind(s,o))))):void(o.isNormalGacha()&&s.initializeDisabledGachaButton(o))}.bind(this)).fail(this._errorHandling)},_showGachaResult:function(e,t){this._setItemInfo(e);var n=this._isNormalGacha(e)&&t;return e.seekWidgetByName("result_panel").setVisible(!n),this._fillupResultCards(e,"result_panel"),function(){return n?(this._fillupResultCards(e,"gacha_ball_panel"),this._apiGachaDfd.then(this._playSimpleAnimation.bind(this,e))):a.resolve()}.bind(this)().then(function(){this._setItemPopup(e),this._showPopupReleasedEpisodeIfExists(e)}.bind(this)).fail(this._errorHandling)},_playSimpleAnimation:function(e){var t=e.seekWidgetByName("Scene"),n=t.bfsWidgetByName("result_panel");n.setVisible(!1);var i=t.bfsWidgetByName("ga_ani_nike"),o=t.bfsWidgetByName("ga_ani_effect");return this._fillupSimpleGachaBall(e,o),o.bfsWidgetByName("gacha_ball_panel").setVisible(!0),o.setVisible(!0),this._playingNikeLeverAnimation=!0,a.all([this._playLeverOnAnimation(i).then(function(e){var t=this._useSimpleAnimation;i.animate(t?"normal":"wait",!0),this._playingNikeLeverAnimation=!1}.bind(this)),this._playLeverOnAnimation(o).then(function(e){n.setVisible(!0),e.getTarget().animate("default",!1)})]).then(function(){var t=e.routerParams.ga_010.results,n=e.temporaryRouterParams.animationData;if(!n||!this._conatinsCharacterJoinedInfo(t))return a.resolve();var i=e.routerParams.ga_010.params;return this._navigate010ToGaAni({obtained_info:t,animation_data:n},i.gacha_id,e.routerParams.ga_010.navigate,i.present,i.event_id,i.category,i.category_id),a.reject()}.bind(this))},_conatinsCharacterJoinedInfo:function(e){return i.findIndex(e,function(e){var t=e.weapon_info;return i.isObject(t)&&!i.isUndefined(t.character_joined_info)},this)>-1},_fillupSimpleGachaBall:function(e,t){var n=e.routerParams.ga_010.results,a=/^gacha_ball_(\d+)/;t.seekWidgets(function(e){return a.test(e.getName())}).sort(function(e,t){return Number(a.exec(e.getName())[1])>Number(a.exec(t.getName())[1])}).forEach(function(e,t){var a=n[t];if(a){var o="gacha/res/ga_010/ga_simple_ani_nike/gacha_ball_"+(i.values(a)[0].rare||"N").toUpperCase()+".png";e.initWithSpriteFrameName(o)}})},_playLeverOnAnimation:function(e){var n=e.getAnimInfo("lever_on"),i=n.action,o=n.animInfo.endIndex-1,r=a.defer(),s=new ccs.Timeline,c=new ccs.EventFrame;c.setEvent("endAnimation"),c.setFrameIndex(o),s.addFrame(c),i.addTimeline(s),i.gotoFrameAndPlay(n.animInfo.startIndex,o,!1);var u=t.createInstance("AnimationEventHandlerCcs_2_0").init(i),l=t.createInstance("Sound2Event",[u]);return u.addAnimationEventCallback("endAnimation",function(){i.removeTimeline(s),l.unregisterEvent(),r.resolve(i)},this),r.promise},_fillupResultCards:function(e,t){var n=e.routerParams.ga_010.results;e.seekWidgetByName(t).getChildren().filter(function(e){return 0===e.getName().indexOf("ga_result_corecard_ui_")}).forEach(function(e,t){var a,o=n[t];o?(i.isUndefined(o.summon_info)?i.isUndefined(o.weapon_info)?i.isUndefined(o.item_info)||((a=o.item_info).item_id=a.id,this._setProperCoreCardElementRarity(e,a).addTouchEventListener(function(e,t){t===ccui.Widget.TOUCH_ENDED&&this._onTouchItemCard(a)},this)):((a=o.weapon_info).weapon_id=a.id,this._setProperCoreCardElementRarity(e,a).addTouchEventListener(function(e,t){t===ccui.Widget.TOUCH_ENDED&&this._onTouchWeaponCard(a)},this)):((a=o.summon_info).summon_id=a.id,this._setProperCoreCardElementRarity(e,a).addTouchEventListener(function(e,t){t===ccui.Widget.TOUCH_ENDED&&this._onTouchSummonCard(a)},this)),i.isUndefined(a.is_new)?e.seekWidgetByName("icon_new").setVisible(!1):e.seekWidgetByName("icon_new").setVisible(a.is_new),e.setVisible(!0)):e.setVisible(!1)}.bind(this))},_onTouchSummonCard:function(e){t.createInstance("apiSummons").get(e.id).then(function(e){var i=n.director.getRunningScene();t.ImplantedPopup.createOrGet(i,"sh_summon_info").open(e.body)}).fail(function(e){console.error(e.stack)})},_onTouchWeaponCard:function(e){this._openShWeaponInfoPopup(e.id)},_onTouchItemCard:function(e){t.createInstance("apiItems").get(e.id).then(function(e){var n=t.createInstance("popupFactoryShItemInfo").create();n.open().then(function(){n.setData(e.body)}.bind(this))}).fail(function(e){console.error(e.stack)})},_setCoreCard:function(e,n,a,o){$staticRes(res["core-corecard_chara-corecard_chara_ui"]),$staticRes(res["core-corecard_summon-corecard_summon_ui"]),$staticRes(res["core-corecard_weapon-corecard_weapon_ui"]),e.seekWidgetByName("corecard_ui").addChild(ccs.load($dynamicRes(res["core-corecard_"+n+"-corecard_"+n+"_ui"])).node),e.seekWidgetByName(n+"_img").loadTexture(t.Img("corecard",n,i.padZero(a.id,4),0).jpg),e.seekWidgetByName("icon_new").setVisible(a.is_new),e.setVisible(!0),e.seekWidgetByName("icon_rarity").loadTexture("core/res/icon/rarityicon_"+a.rare+".png",ccui.Widget.PLIST_TEXTURE),e.seekWidgetByName("icon_element").loadTexture("core/res/icon/elementicon_"+a.element_type+".png",ccui.Widget.PLIST_TEXTURE),e.seekWidgetByName(n+"_img").addTouchEventListener(function(e,n){if(n===ccui.Widget.TOUCH_ENDED){var i={};i[o]={id:a.id,navigate:this.routerParams.ga_010.navigate,getItemNoArray:[],getItemNameArray:[]},t.createInstance("router").navigate("gacha/"+o,i)}},this)},_setItemInfo:function(e){var t="";e.routerParams.ga_010.params.present?t="\r\n":e.seekWidgetByName("btn_present").setVisible(!1);var n=!1;i.each(e.routerParams.ga_010.results,function(e){if(i.isUndefined(e.item_info)&&(i.isUndefined(e.weapon_info)||!i.isUndefined(e.weapon_info.character_joined_info))){var a=e.summon_info||e.weapon_info;n||!0!==a.is_new||(t+="\r\n",n=!0)}},this),ccui.helper.seekWidgetByName(e,"get_label").setString(t)},_setItemPopup:function(e){if(!i.isUndefined(e.routerParams.ga_010.getItemNameArray)&&0!==e.routerParams.ga_010.getItemNameArray.length){var n=e.popups.popupSSRText;n.open().then(function(){this._setItemPopupContent(e,n),t.setTouchEventHandlers(n,{"TOUCH_ENDED blue_btn":function(){e.routerParams.ga_010.getItemNameArray.shift(),e.routerParams.ga_010.getItemNoArray.shift(),e.routerParams.ga_010.getItemNameArray.length>0?this._setItemPopupContent(e,n):n.dismiss()}.bind(this)},this)}.bind(this))}},_setItemPopupContent:function(e,n){n.loadTextures({item_img:t.Img("corecard","item",i.padZero(e.routerParams.ga_010.getItemNoArray[0],4)).jpg});var a=n.seekWidgetByName("labelimg_0"),o='<div class="text_common" style="font-size:18px;word-break:break-all;">SSR<br />'+e.routerParams.ga_010.getItemNameArray[0]+"<br />1</div>";a.setHtmlStrings({labelimg_0:o},t.GameConfig.POPUP_CSS)},_getRecordsReleasedEpisode:function(e){if(!(e=e||{}).ga_010)return[];if(!e.ga_010.results)return[];var t=e.ga_010.results||[];return i.filter(t,function(e){return e.weapon_info?(e.weapon_info.character_joined_info||{}).is_episode_release:e.summon_info?(e.summon_info||{}).is_episode_release:void 0}).map(function(e){if(e.weapon_info){var t=e.weapon_info.character_joined_info;return{setCoreCardFunc:this._setProperCoreCardElementRarity.bind(this),id:t.character_id,name:t.character_name,element_type:t.element_type,rare:t.rare,kind:"character"}}if(e.summon_info){t=e.summon_info;return{setCoreCardFunc:this._setProperCoreCardElementRarity.bind(this),id:t.id,name:t.name,element_type:t.element_type,rare:t.rare,kind:"summon"}}return console.warn("invalid parameter"),{}},this)},_showPopupReleasedEpisodeIfExists:function(e){this._recordsReleasedEpisode||(this._recordsReleasedEpisode=this._getRecordsReleasedEpisode(e.routerParams));var t=this._recordsReleasedEpisode.shift();t&&e.popups.popupOpenEpisode.open(t)},_setEventId:function(e){this._eventId=e},_getEventId:function(){return this._eventId},_isNormalGacha:function(e){return e.routerParams.ga_010.params.category===t.gacha.gacha_category.GachaCategoryModel.prototype.CATEGORY_TYPES.NORMAL},_getApiGachaDfd:function(){return t.createInstance("apiGachaCategory").get(this._categoryId)},_playGacha:function(e,i){i.setEnable(!1),t.createInstance("ExchangeItemController").cacheExchangeItemData(e);var o=e.getGachaId(),r=e.getCategoryType();return a.all([t.createInstance("apiAGacha").playGacha(r,o)]).spread(function(e){if(this._useSimpleAnimation){var i=n.director.getRunningScene(),a=new t.gacha.model.GachaResult(e.body),s=i.routerParams.ga_010;s.results=a.getGachaResults(),s.getItemNoArray=a.getItemNoArray(),s.getItemNameArray=a.getItemNameArray(),s.type=a.getType(),i.temporaryRouterParams.animationData=a.getAnimationData();var c=this._showGachaResult(i,this._useSimpleAnimation);this._refreshGachaInformation(i,c)}else{var u=t.createInstance("playerGameConfig").isGachaSimpleAnimationEnabled();this._navigateToGachaAnimation(e.body,r,this._getCategoryId(),o,u)}}.bind(this)).fail(function(e){console.error(e&&e.stack?e.stack:e)})},btnCallbackBtnPresent:function(e){var t=a.defer();return t.reject(this._override),this.navigateGacha10ToPrs001(),t.promise},_showOtherNavigateBtn:function(e,t){var n=e.seekWidgetByName("ga_sub_btn_ui");return t.isNormalGacha()?0===t.getRemainAmount()?void n.setAppearance("normal_gacha"):t.hasReachedItemStockLimit()?void n.setAppearance("normal_gacha_shortage"):void n.setAppearance("normal_gacha"):!!i.find(t.getGachaInformation(),function(e){return e.hasBonusExchangeItem()})?void n.setAppearance("miracle_ticket_gacha"):void n.setAppearance("default_gacha")},_showRemainingAmount:function(e,n){n.isNormalGacha()&&e.seekWidgetByName("remain_label").setString(""+n.getRemainAmount()+""+(t.env.isSp?"":"\n")+"5:00")},_showSimpleAnimationSetting:function(e,t){if(t.isNormalGacha()){if(e.seekWidgetByName("ga_ani_nike").setVisible(!0),0===t.getRemainAmount())return void this._setUseSimpleAnimation(e,!1);if(t.hasReachedItemStockLimit())return void this._setUseSimpleAnimation(e,!1);var n=this._useSimpleAnimation;i.isBoolean(n)||(n=!0===e.routerParams.ga_010.useSimpleAnimation),this._setUseSimpleAnimation(e,n)}},_setUseSimpleAnimation:function(e,t){this._useSimpleAnimation=t;var n=e.seekWidgetByName("ga_ani_nike");this._playingNikeLeverAnimation||n.animate(t?"normal":"wait",!0)},_setExchangeItemId:function(e){var t=i.find(e.getGachaInformation(),function(e){return e.hasBonusExchangeItem()});return t?void(this._exchangeItemId=t.getBonusItemId()):void(this._exchangeItemId=null)},_getExchangeItemId:function(){return this._exchangeItemId},btnCallbackBtnExchange:function(e){var t=this._getExchangeItemId();return this._navigate100ToExchangeItemShop(t),a.reject(this._override)},_touchEndedBackBtnProcess:function(e){this._navigateToGacha_000(this._getEventId())},_getCategoryId:function(){return this._categoryId},_errorHandling:function(e){if(e){if(e instanceof Error)throw e.message="kh.pc.gacha.ga_010.SceneDelegate:"+e.message,e;console.error(e)}}}),t.assignRoles(t.pc.gacha.ga_010.SceneDelegate,[t.pc.roles.UIUtility,t.pc.roles.CoreCardCommon,t.pc.roles.ShInfoPopupInvoker,t.pc.gacha.roles.Routing])}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.gacha=t.pc.gacha||{},t.pc.gacha.ga_100=t.pc.gacha.ga_100||{},t.pc.gacha.ga_100.Scene=t.BaseScene.extend({resourceFileName:"ga_001_2_3_4/ga_002.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"gacha",sceneName:"ga_100",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_detail","btnCallbackBtnDetail",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"gacha/ga_contents_list")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_exchange","btnCallbackBtnExchange",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"exchangeitem/exchit_001")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_simple","btnCallbackBtnSimple",null,function(){alert("{{}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_prev_gacha","btnCallbackBtnPrevGacha",null,function(){alert("{{}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_next_gacha","btnCallbackBtnNextGacha",null,function(){alert("{{}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_enh_evo","btnCallbackBtnEnhEvo",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"enh_evo/enh_001")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_sell","btnCallbackBtnSell",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"list/li_007")),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._),i=e.Q;t.pc=t.pc||{},t.pc.gacha=t.pc.gacha||{},t.pc.gacha.ga_100=t.pc.gacha.ga_100||{},t.pc.gacha.ga_100.SceneDelegate=t.pc.BaseSceneDelegate.extend({_categoryId:null,_dfd:null,_exchangeItemId:null,onSceneInit:function(e){this._setBackBtn(e);var n=e.seekWidgetByName("btn_detail");return n.setVisible(!1),this._dfd.then(function(i){var a=i.body;this._gachaData=a;var o=t.createInstance("GachaCategoryModel",[a]);if(o.existsGacha()||o.isNormalGacha()){this._setGachaToGachaSlider(e,this._gachaBannersPromise),this._setExchangeItemId(o),this._showOtherNavigateBtn(e,o),this._showRemainingAmount(e,o),n.setVisible(!0===a.gacha_content_displayable),this._setGachaHeaderImage(e,a),this._setGachaHeaderDescription(e),this._setGachaSlider(e),t.createInstance("GachaCurrencyAmountLabelController",[o]).initializeLabelText();var r=t.createInstance("BuyButtonController");return o.existsGacha()?(r.initializeBuyButtons(o),void r.setOnBuySucceededCallback(this._playGacha,this)):void r.initializeDisabledGachaButton(o)}this._navigateToGacha_000()}.bind(this)).fail(function(e){e&&console.error(e)})},onSceneEnter:function(e){var a=i.defer();return this._dfd=a.promise,t.tutorial.startTutorialIfNeed(e).fin(function(){var n=(new t.gacha.model.GachaBanners).initialize();this._getGachaCategory(e,n).then(function(e){a.resolve(e)}),this._gachaBannersPromise=n}.bind(this)),n.isObject(e.routerParams.ga_100)&&(this._setCategoryId(e.routerParams.ga_100.category_id),this._setEventId(e.routerParams.ga_100.event_id)),i.resolve()},_getGachaCategory:function(e,a){var o=t.createInstance("router").getCurrentSceneName();if("ga_004"===o)return this._setNormalGachaData(e,o,a);var r=this._getCategoryId();if(n.isNumber(r))return t.createInstance("apiGachaCategory").get(r);var s=(e.routerParams[o]||{}).event_id;return n.isNumber(s)?(this._setEventId(s),a.then(function(e){var a=e.getCategoryId(s);return n.isNumber(a)?(this._setCategoryId(a),t.createInstance("apiGachaCategory").get(a)):(this._navigateToGacha_000(),i.reject())}.bind(this))):(this._navigateToGacha_000(),i.reject())},_setNormalGachaData:function(e,a,o){return o.then(function(o){var r=n.find(o.getAllBanner(),function(e){return!0===e.is_normal_gacha});return r?(e.routerParams[a]={category_id:r.category_id,event_id:r.event_id,id:r.banner_id},this._setEventId(r.event_id),this._setCategoryId(r.category_id),t.createInstance("apiGachaCategory").get(r.category_id)):(this._navigateToGacha_000(),i.reject())}.bind(this))},_setCategoryId:function(e){this._categoryId=e},_getCategoryId:function(){return this._categoryId},onSceneExit:function(e){return i.defer(),this._stopAutoScroll(),i.resolve()},btnCallbackBtnPrev:function(e){var t=i.defer();return t.resolve(),t.promise},btnCallbackBtnNext:function(e){var t=i.defer();return t.resolve(),t.promise},btnCallbackBtnPrevGacha:function(e){return this._navigateGachaByBanner(e,this._getPrevGachaCategory()),i.reject(this._override)},btnCallbackBtnNextGacha:function(e){return this._navigateGachaByBanner(e,this._getNextGachaCategory()),i.reject(this._override)},_navigateGachaByBanner:function(e,i){(new t.gacha.model.GachaBanners).initialize().then(function(t){this._navigate000ToGacha(e,n.extend({category_id:t.getCategoryId(i.event_id)},i))}.bind(this))},_setEventId:function(e){this._eventId=e},_getEventId:function(){return this._eventId},_playGacha:function(e,n){var a=e.getGachaId(),o=e.getCategoryType(),r=t.createInstance("playerGameConfig").isGachaSimpleAnimationEnabled();n.setEnable(!1),i.all([t.createInstance("apiAGacha").playGacha(o,a)]).spread(function(e){this._navigateToGachaAnimation(e.body,o,this._getCategoryId(),a,r)}.bind(this),function(e){console.error(e&&e.stack?e.stack:e)})},btnCallbackBtnDetail:function(e){return this._navigateToGaContentList(this._getCategoryId(),this._getEventId()),i.reject(this._override)},btnCallbackBtnExchange:function(e){var t=i.defer();t.reject(this._override);var n=this._getExchangeItemId();return this._navigate100ToExchangeItemShop(n),t.promise},_setExchangeItemId:function(e){var t=n.find(e.getGachas(),function(e){return e.hasBonusExchangeItem()});return t?void(this._exchangeItemId=t.getBonusItemId()):void(this._exchangeItemId=null)},_getExchangeItemId:function(){return this._exchangeItemId},_showOtherNavigateBtn:function(e,t){var i=e.seekWidgetByName("ga_sub_btn_ui");return t.isNormalGacha()?0===t.getRemainAmount()?void i.setAppearance("normal_gacha"):t.hasReachedItemStockLimit()?void i.setAppearance("normal_gacha_shortage"):void i.setAppearance("normal_gacha"):!!n.find(t.getGachas(),function(e){return e.hasBonusExchangeItem()})?void i.setAppearance("miracle_ticket_gacha"):void i.setAppearance("default_gacha")},_showRemainingAmount:function(e,n){n.isNormalGacha()&&e.seekWidgetByName("remain_label").setString(""+n.getRemainAmount()+""+(t.env.isSp?"":"\n")+"5:00")},_touchEndedBackBtnProcess:function(e){this._navigateToGacha_000(this._getEventId())}}),n.assign(t.pc.gacha.ga_100.SceneDelegate.prototype,t.pc.roles.UIUtility,t.pc.gacha.roles.Routing,t.pc.gacha.roles.PlayGachaBase,t.pc.gacha.roles.GachaToGachaSlider)}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.gacha=t.pc.gacha||{},t.pc.gacha.ga_ani=t.pc.gacha.ga_ani||{},t.pc.gacha.ga_ani.Scene=t.BaseScene.extend({resourceFileName:"ga_ani/ga_ani.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"gacha",sceneName:"ga_ani",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_skip","btnCallbackBtnSkip",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"gacha/ga_010")),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc=t.pc||{},t.pc.gacha=t.pc.gacha||{},t.pc.gacha.ga_ani=t.pc.gacha.ga_ani||{},t.pc.gacha.ga_ani.SceneDelegate=t.pc.BaseSceneDelegate.extend({_popups:{},onSceneInit:function(e){return a.defer(),e._disable_sharpness_filter=!0,e.footerDelegate=e.headerDelegate=e.mainMenuDelegate=e.subMenuDelegate=new t.EmptyDelegate,this._verifyRouterParamsAni(e),t.createInstance("myselfInfoRepository").allCacheClear(),this._initialize(e.routerParams.ga_ani.data,!0===e.routerParams.ga_ani.isSimple),a.resolve()},onSceneEnter:function(e){return a.defer(),a.resolve()},onSceneExit:function(e){return a.defer(),a.resolve()},onPageInAnimationEnd:function(e){return a.defer(),a.resolve()},_navigateToResultScene:function(){var e=n.director.getRunningScene(),t=e.routerParams.ga_ani,a=t.data;if(i.isEmpty(e.temporaryRouterParams)||i.isEmpty(e.temporaryRouterParams.result_to)){var o=t.navigate,r=!1!==t.present,s=t.event_id,c=t.gacha_id,u=t.category,l=t.category_id,_=!0===t.isSimple;this._navigateGaAniToResult(a,o,r,c,s,u,l,_,!0)}else this._navigateGaAniToSpecialResult(a,e.temporaryRouterParams.result_to)},_showIOSSoundTouchFieldWithoutNavigation:function(){t.env.needSoundTouchField&&t.postMessage("showIOSSoundTouchField",[])}}),i.assign(t.pc.gacha.ga_ani.SceneDelegate.prototype,t.pc.roles.UIUtility,t.pc.gacha.roles.Routing,t.pc.scene.roles.SceneGachaAnimation)}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.gacha=t.pc.gacha||{},t.pc.gacha.ga_contents_list=t.pc.gacha.ga_contents_list||{},t.pc.gacha.ga_contents_list.Scene=t.BaseScene.extend({resourceFileName:"ga_contents_list/ga_contents_list.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"gacha",sceneName:"ga_contents_list",_delegate:null,_init:function(){this._initScene("page_in")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._,e.Q);t.pc=t.pc||{},t.pc.gacha=t.pc.gacha||{},t.pc.gacha.ga_contents_list=t.pc.gacha.ga_contents_list||{},t.pc.gacha.ga_contents_list.SceneDelegate=t.pc.BaseSceneDelegate.extend({_popups:{},_categoryId:null,_dfd:null,onSceneInit:function(e){return n.defer(),this._setBackBtn(e),this._dfd.then(function(n){var i=t.createInstance("GachaContentsInfoList",[n.body.gacha_contents_list,n.body.display_probability]);t.createInstance("gachaContentsPulldownController").init(e,i)}.bind(this)).fail(function(e){console.error(e)})},onSceneEnter:function(e){this._setCategoryId(e);var i=this._getCategoryId();return this._dfd=t.createInstance("apiGachaCategories").getContentsList(i),n.resolve()},_setCategoryId:function(e){this._categoryId=(e.routerParams.ga_contents_list||e.temporaryRouterParams).category_id},_getCategoryId:function(e){return this._categoryId},onSceneExit:function(e){return n.defer(),n.resolve()},onPageInAnimationEnd:function(e){return n.defer(),n.resolve()},_touchEndedBackBtnProcess:function(e){this._navigate000ToGacha(e,e.routerParams.ga_contents_list||e.temporaryRouterParams)}}),t.assignRoles(t.pc.gacha.ga_contents_list.SceneDelegate,[t.pc.gacha.roles.Routing])}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="AUnionAuthority",o={get:function(){return this._http.get({url:"/a_union_authority",json:{}})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiAUnionAuthority",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},o)),n.env.useApiMock){n.MockApi=n.MockApi||{};var r={};t.each(o,function(e,t){r[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi."+a+"."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},r))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="AUnionCheck",o={get:function(e){return this._http.get({url:"/a_union_check",json:{a_player_id:e}})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiAUnionCheck",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},o)),n.env.useApiMock){n.MockApi=n.MockApi||{};var r={};t.each(o,function(e,t){r[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi."+a+"."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},r))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="AUnionJoinConditions",o={get:function(){return this._http.get({url:"/a_union_join_conditions/me",json:{}})},delete:function(e){return this._http.del({url:"/a_union_join_conditions/"+e,json:{}})},update:function(e,t,n,i){return this._http.put({url:"/a_union_join_conditions/"+e,json:{rank_type:t,playstyle_type:n,auto_join:i}})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiAUnionJoinConditions",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},o)),n.env.useApiMock){n.MockApi=n.MockApi||{};var r={};t.each(o,function(e,t){r[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi."+a+"."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},r))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="AUnionJoinRequests",o={get:function(e,t){return this._http.get({url:"/a_union_join_requests",json:{page:e,per_page:t}})},getMe:function(){return this._http.get({url:"/a_union_join_requests",json:{a_player_id:"me"}})},reject:function(e){return this._http.del({url:"/a_union_join_requests",json:{ids:e,type:"refuse"}})},cancel:function(e){return this._http.del({url:"/a_union_join_requests",json:{ids:[e],type:"cancel"}})},create:function(e){return this._http.post({url:"/a_union_join_requests",json:{a_union_id:e}})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiAUnionJoinRequests",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},o)),n.env.useApiMock){n.MockApi=n.MockApi||{};var r={};t.each(o,function(e,t){r[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi."+a+"."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},r))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="AUnionScoutsSearch",o={get:function(e){return this._http.get({url:"/a_union_scouts_search",json:{recommended:e}})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiAUnionScoutsSearch",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},o)),n.env.useApiMock){n.MockApi=n.MockApi||{};var r={};t.each(o,function(e,t){r[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi."+a+"."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},r))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="AUnionScouts",o={getListForMe:function(){return this.getListForPlayer("me")},getListForPlayer:function(e){return this._http.get({url:"/a_union_scouts",json:{a_player_id:e}})},check:function(e){return this._http.get({url:"/a_union_scouts",json:{a_union_id:e,to_a_player_id:"me"}})},getList:function(e,t){return this._http.get({url:"/a_union_scouts",json:{page:e,per_page:t}})},cancel:function(e,t,n){return this._http.del({url:"/a_union_scouts",json:{a_union_id:e,to_a_player_id:t,type:n}})},create:function(e){return this._http.post({url:"/a_union_scouts",json:{to_a_player_id:e}})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiAUnionScouts",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},o)),n.env.useApiMock){n.MockApi=n.MockApi||{};var r={};t.each(o,function(e,t){r[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi."+a+"."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},r))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="AUnionSearch",o={get:function(e,t,n,i,a,o,r){return this._http.get({url:"/a_union_search",json:{rank_type:e,playstyle_type:t,auto_join:n,union_id:i,union_name:a,page:o,per_page:r}})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiAUnionSearch",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},o)),n.env.useApiMock){n.MockApi=n.MockApi||{};var r={};t.each(o,function(e,t){r[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi."+a+"."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},r))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="UnionUnavailableOperation",o={get:function(){return this._http.get({url:"/union_unavailable_operation"})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiUnionUnavailableOperation",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},o)),n.env.useApiMock){n.MockApi=n.MockApi||{};var r={};t.each(o,function(e,t){r[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi."+a+"."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},r))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e._,t.BurstTimeSubTutorialPanel=n.Node.extend({_popups:{},_widgets:{},_khBurstTime:null,_subTutorialPopup:null,show:function(e){var i=n.director.getRunningScene();i.addChild(this),this._widgets.base=i.seekWidgetByName("bursttime_period_base_1"),this._widgets.label1=i.seekWidgetByName("bursttime_period_0_label"),this._widgets.label2=i.seekWidgetByName("bursttime_period_1_label"),this._widgets.reserved=i.seekWidgetByName("bursttime_period_textimg"),this._widgets.button=i.seekWidgetByName("btn_burstinfo"),this._widgets.button.addClickEventListener(this._openSubTutorialPopup.bind(this)),this._khBurstTime=t.createInstance("burstTime"),this._khBurstTime.prepare(e).then(function(){this._khBurstTime.addEventListener("UPDATE_SUCCESS",this.updateDisplay.bind(this)),this._initWidgets()}.bind(this))},_initWidgets:function(){this._khBurstTime.isEnabled()&&(this._widgets.base.setVisible(!0),this._widgets.label1.setString("1"+this._khBurstTime.getFirstSelectedBurstTimeInfo().description),this._widgets.label2.setString("2"+this._khBurstTime.getSecondSelectedBurstTimeInfo().description),this._khBurstTime.isReserved()&&this._widgets.reserved.setVisible(!0))},updateDisplay:function(){this._widgets.reserved.setVisible(!1),this._widgets.base.setVisible(!1),this._widgets.label1.setString(""),this._widgets.label2.setString(""),this._initWidgets()},onExit:function(){this._khBurstTime.removeEventListenersByEventName("UPDATE_SUCCESS"),this._super()},_openSubTutorialPopup:function(){if(null===this._subTutorialPopup){var e=n.director.getRunningScene();this._subTutorialPopup=t.ImplantedPopup.createOrGet(e,"sub_tutorial","ImplantedSubTutorialPopup")}this._subTutorialPopup.open("bursttime",1)},showSubTutorialFirstAccess:function(){var e="bursttime",n=t.createInstance("apiASubTutorialPages");return n.get(e).then(function(t){t.body.need_first_display&&(this._openSubTutorialPopup(),n.visited(e))}.bind(this)).fail(function(e){console.error(e)})}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=e.ccui,a=e._,o=e.console;t.createNameSpaceIfNotExists("guild.view"),t.guild.view.GuildMemberPanelCommon=t.core.pager.view.page.UserListPagerUi.extend({className:"GuildMemberPanelCommon",_unionPosition:null,UNION_POSITION_LEADER:"leader",UNION_POSITION_SUB_LEADER:"sub_leader",UNION_POSITION_OFFICER:"officer",UNION_POSITION_MEMBER:"member",ctor:function(e,t,n,i,a){this._super.apply(this,arguments),this._unionPosition=a},_updateOne:function(e,t){this._super.apply(this,arguments);var r=t.getRawData();if(this._setBtnText(e,r),!a.isUndefined(r.union_position)&&e.seekWidgetByName("icon_guild_position"))if(a.contains(["leader","member","officer","sub_leader"],r.union_position)){n.spriteFrameCache.addSpriteFrames(res["guild-icon_guild_position.plist"]);var s=e.seekWidgetByName("icon_guild_position");s.setVisible(!0),s.loadTexture("guild/res/icon_guild_position_"+r.union_position+".png",i.Widget.PLIST_TEXTURE)}else o.error("Invalid union position type: "+r.union_position);e.setVisible(!0)},_setBtnText:function(e,t){}})}((this||0).self||global),function(e){var t=e.kh;e.khutil,e.cc,e.ccui,e._,e.console,t.createNameSpaceIfNotExists("guild.view"),t.guild.view.GuildMemberPanel=t.guild.view.GuildMemberPanelCommon.extend({className:"GuildMemberPanel",_setBtnText:function(e,t){var n=e.seekWidgetByName("btn_blue_s");null!==n&&(n.setTitleText(""),"leader"===t.union_position?n.setVisible(!1):n.setVisible(this._unionPosition===this.UNION_POSITION_LEADER))}})}((this||0).self||global),function(e){var t=e.kh;e.khutil,e.cc,e.ccui,e._,e.console,t.createNameSpaceIfNotExists("guild.view"),t.guild.view.GuildMemberJoinPanel=t.guild.view.GuildMemberPanelCommon.extend({className:"GuildMemberJoinPanel",_selectMode:null,update:function(e,t,n,i){this._setEnableButton("btn_decision",i.getSelectedData().length>0),this._selectMode=!0===this._sceneDelegate._join_select_mode,this._super.apply(this,arguments)},_updateOne:function(e,t,n){var i=e.seekWidgetByName("check_box_base");i.setVisible(this._selectMode),this._selectMode&&(i.seekWidgetByName("CheckBox_1").selected=n.getSelectNumber(t)>0),this._super.apply(this,arguments)},_setBtnText:function(e,t){e.seekWidgetByName("btn_red_s").setTitleText(""),e.seekWidgetByName("btn_blue_s").setTitleText("")}}),t.assignRoles(t.guild.view.GuildMemberJoinPanel,[t.pc.roles.UIUtility])}((this||0).self||global),function(e){var t=e.kh;e.khutil,e.cc,e.ccui,e._,e.console,t.createNameSpaceIfNotExists("guild.view"),t.guild.view.GuildMemberScoutPanel=t.guild.view.GuildMemberPanelCommon.extend({className:"GuildMemberScoutPanel",_setBtnText:function(e,t){var n=e.seekWidgetByName("btn_red_s");null!==n&&n.setTitleText("")}})}((this||0).self||global),function(e){var t=e.kh;e.khutil,e.cc,e.ccui,e._,e.console,t.createNameSpaceIfNotExists("guild.view"),t.guild.view.GuildMemberChangeLeaderPanel=t.guild.view.GuildMemberPanelCommon.extend({className:"GuildMemberChangeLeaderPanel",_setBtnText:function(e,t){var n=e.seekWidgetByName("btn_blue_s");null!==n&&n.setTitleText("")}})}((this||0).self||global),function(e){var t=e.kh;e.khutil,e.cc,e.ccui,e._,e.console,t.createNameSpaceIfNotExists("guild.view"),t.guild.view.GuildMemberFirePanel=t.guild.view.GuildMemberPanelCommon.extend({className:"GuildMemberFirePanel",_setBtnText:function(e,t){var n=e.seekWidgetByName("btn_red_s");null!==n&&n.setTitleText("")}})}((this||0).self||global),function(e){var t=e.kh;e.khutil,e.cc,e.ccui,e._,e.console,t.createNameSpaceIfNotExists("guild.view"),t.guild.view.GuildMemberFriendScoutPanel=t.guild.view.GuildMemberPanelCommon.extend({className:"GuildMemberFriendScoutPanel",_setBtnText:function(e,t){var n=e.seekWidgetByName("btn_blue_s");null!==n&&n.setTitleText("")}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.createNameSpaceIfNotExists("guild.view.popup"),t.guild.view.popup.GuildRequestSetConditionPopup=t.ImplantedPopup.extend({conditionId:null,isSearchable:!1,remainTime:null,_initContents:function(e){this._initParams(e),this._initPulldown(),this._initButtons(),this._initRemainTime()},_initParams:function(e){this.conditionId=e.a_union_join_condition_id,this.isSearchable=e.is_searchable,this.remainTime=e.remain_time||null,this._node.conditionRank=e.rank_type||"non_specified",this._node.conditionPlaystyle=e.playstyle_type||"non_specified",this._node.conditionAutoJoin=e.auto_join||"non_specified"},_initPulldown:function(){var e=this._getScene();this._node.seekWidgetByName("btn_pulldown_rank").setTouchEnabled(!0),this._node.seekWidgetByName("btn_pulldown_playstyle").setTouchEnabled(!0),this._node.seekWidgetByName("btn_pulldown_autojoin").setTouchEnabled(!0),e._preparePulldown({baseWidget:this._node,wbMenuItemsName:"UNION_SEARCH_RANK",widgetSelectorBody:"btn_pulldown_rank",widgetPulldownPlaceholder:"rank_sort_ui",listItemResource:"core-sort-sort_list_ui_long",selected:this._node.conditionRank,callback:function(e){this.conditionRank=e.value}.bind(this._node)}),e._preparePulldown({baseWidget:this._node,wbMenuItemsName:"UNION_SEARCH_PLAYSTYLE",widgetSelectorBody:"btn_pulldown_playstyle",widgetPulldownPlaceholder:"playstyle_sort_ui",listItemResource:"core-sort-sort_list_ui_long",selected:this._node.conditionPlaystyle,callback:function(e){this.conditionPlaystyle=e.value}.bind(this._node)}),e._preparePulldown({baseWidget:this._node,wbMenuItemsName:"UNION_SETTING_AUTOJOIN",widgetSelectorBody:"btn_pulldown_autojoin",widgetPulldownPlaceholder:"autojoin_sort_ui",listItemResource:"core-sort-sort_list_ui_long",selected:this._node.conditionAutoJoin,callback:function(e){this.conditionAutoJoin=e.value}.bind(this._node)})},_initButtons:function(){this.setButtonEvents({btn_cancel:!0,btn_ok:this._setRequestGuildCondition.bind(this),withdraw_btn:this._closeGuildCondition.bind(this)})},_initRemainTime:function(){this.isSearchable&&this._node.seekWidgetByName("time_label").setString(this.remainTime)},_setRequestGuildCondition:function(){t.createInstance("apiAUnionJoinConditions").update(this.conditionId,this._node.conditionRank,this._node.conditionPlaystyle,this._node.conditionAutoJoin).then(function(){this.dismiss(),t.createInstance("popupFactoryGudRequestEnd").create({}).open({conditionRank:this._node.conditionRank,conditionPlaystyle:this._node.conditionPlaystyle,conditionAutoJoin:this._node.conditionAutoJoin})}.bind(this)).fail(function(t){e.console.error(t)})},_closeGuildCondition:function(){t.createInstance("popupFactoryGudRequestDelete").create({}).open({conditionId:this.conditionId,callerPopup:this})}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;e.Q,t.pc.guild=t.pc.guild||{},t.pc.guild.model=t.pc.guild.model||{},t.pc.guild.model.GuildControlPermissions=n.Class.extend({forbiddenOperations:{},prepare:function(){return this.forbiddenOperations={},this._getUnionUnavailableOperationPromise().then(function(e){var t=e.body;return i.each(t.unavailable_operation,function(e){this.forbiddenOperations[e]=!0},this),this}.bind(this))},_getUnionUnavailableOperationPromise:function(){return t.createInstance("apiUnionUnavailableOperation").get().fail(function(e){console.error(e)})},canAppointLeaderUnion:function(){return!this.forbiddenOperations.appoint_leader},canRenameUnion:function(){return!this.forbiddenOperations.change_name},canChangeBurstTime:function(){return!this.forbiddenOperations.change_burst_time},canLeave:function(){return!this.forbiddenOperations.leave},canFireMember:function(){return!this.forbiddenOperations.fire_member},canDismissUnion:function(){return!this.forbiddenOperations.dismiss_union},canJoinUnion:function(){return!this.forbiddenOperations.join_union},canCreateUnion:function(){return!this.forbiddenOperations.create_union},canSearchUnion:function(){return!this.forbiddenOperations.search_union}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("guild.model"),t.pc.guild.model.GuildSearchInfoData=n.Class.extend({className:"GuildSearchInfoData",_joinConditions:{rank_type:"non_specified",playstyle_type:"non_specified",auto_join:"non_specified"},_unionInfo:{union_id:null,union_name:null},getSearchInfo:function(){var e={};return Object.assign(e,this._joinConditions),Object.assign(e,this._unionInfo),e},getJoinConditions:function(){return this._joinConditions},getUnionInfo:function(){return this._unionInfo},updateSearchInfo:function(e,t){this._joinConditions=e,this._unionInfo=t},cleaerSearchInfo:function(){this._joinConditions.rank_type="non_specified",this._joinConditions.playstyle_type="non_specified",this._joinConditions.auto_join="non_specified",this._unionInfo.union_id=null,this._unionInfo.union_name=null},setSearchRankType:function(e){this._joinConditions.rank_type=e},setSearchPlaystyleType:function(e){this._joinConditions.playstyle_type=e},getSearchApiParams:function(){return[this._joinConditions.rank_type,this._joinConditions.playstyle_type,this._joinConditions.auto_join,this._unionInfo.union_id,this._unionInfo.union_name,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE]}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._),i=e.Q;t.pc.guild=t.pc.guild||{},t.pc.guild.roles=t.pc.guild.roles||{},t.pc.guild.roles.GuildCommon={_setGuildStrings:function(e,i){var a=i.union_me||i.union,o=n.isUndefined(a)?i.guardian_info:a.guardian_info||i.guardian_info;if(!n.isUndefined(o)){var r=this._toGuardianFullName(o);if(!n.isUndefined(o.level)){null!==e.seekWidgetByName("guardian_lv_label")&&e.setStrings({guardian_lv_label:o.level}),n.isUndefined(o.name)||null===e.seekWidgetByName("guardian_name_lv_label")||e.setStrings({guardian_name_lv_label:r});var s=e.seekWidgetByName("name_label");n.isUndefined(o.name)||null===s||"gud_comment_ui"===s.parent.name||e.setStrings({name_label:r})}n.isUndefined(o.price)||null===e.seekWidgetByName("price_no")||e.setStrings({price_no:" "+o.price+t.w("gem")});var c,u=o.detail_info;if(!n.isUndefined(u)&&(n.isUndefined(u.custom_pt)||(null!==e.seekWidgetByName("total_pt_label")&&e.setStrings({total_pt_label:" "+u.custom_pt}),null!==e.seekWidgetByName("total_custom_point_no_label")&&e.setStrings({total_custom_point_no_label:" "+u.custom_pt}),null!==e.seekWidgetByName("custom_pt_label_set")&&e.setStrings({custom_pt_label_set:"Pt: "+u.custom_pt})),n.isUndefined(u.next_level_pt)||(null!==e.seekWidgetByName("lv_next_label")&&e.setStrings({lv_next_label:" "+u.next_level_pt+"Pt"}),null!==e.seekWidgetByName("lv_next_label_set")&&e.setStrings({lv_next_label_set:"Lv: "+u.next_level_pt+"Pt"})),!n.isUndefined(u.effects)))n.each(u.effects,function(e,t){e.is_acquired&&!n.isUndefined(e.description)&&(c=e.description)}),null===e.seekWidgetByName("guardian_effect_label_0")||n.isUndefined(c)||e.seekWidgetByName("guardian_effect_label_0").setString(c),null===e.seekWidgetByName("guardian_effect_label")||n.isUndefined(c)||e.seekWidgetByName("guardian_effect_label").setString(c)}n.isUndefined(a)||(n.isUndefined(a.name)||null===e.seekWidgetByName("union_name_label")||e.setStrings({union_name_label:a.name}),n.isUndefined(a.rank)||null===e.seekWidgetByName("union_rank_no")||e.setStrings({union_rank_no:a.rank}),n.isUndefined(a.member_count)||null===e.seekWidgetByName("union_menber_label")||e.setStrings({union_menber_label:a.member_count}),n.isUndefined(a.leader)||n.isUndefined(a.leader.name)||n.isUndefined(a.comment)||(null!==e.seekWidgetByName("gud_comment_ui")&&e.seekWidgetByName("gud_comment_ui").setStrings({name_label:a.leader.name,leader_comment_label:a.comment}),null!==e.seekWidgetByName("prf_comment_ui")&&e.seekWidgetByName("prf_comment_ui").setStrings({name_label:a.leader.name,leader_comment_label:a.comment})));var l=i.donation;n.isUndefined(l)||n.isUndefined(l.union_data)||n.isUndefined(l.union_data.current_donation_amount)||null===e.seekWidgetByName("union_jem_label")||e.setStrings({union_jem_label:l.union_data.current_donation_amount.toString()})},_setDonationHeader:function(e,i){return i=i||"header_sub_label",t.createInstance("apiAUnions").getDonationInfo().then(function(a){var o=e.seekWidgetByPath(i);return o&&!n.isUndefined(a.body.union_data.current_donation_amount)&&o.setString(a.body.union_data.current_donation_amount+t.w("gem")),a.body}.bind(this)).fail(function(e){console.error(e.stack)})},_getUnionInfoAboutMe:function(){var e=t.createInstance("apiAUnions").getMember("me"),n=t.createInstance("apiAUnions").get("me");return i.all([e,n]).then(function(e){return this._myUnionInfo=e[0].body,this._maxNumber=e[1].body.max_member_count,this._totalNumber=e[1].body.member_count,this._unionId=e[1].body.a_union_id,e}.bind(this)).fail(function(e){console.error(e.stack)})},_getUnionInfoAboutOther:function(e){return t.createInstance("apiAUnions").get(e).then(function(e){return this._myUnionInfo=e.body,this._maxNumber=e.body.max_member_count,this._totalNumber=e.body.member_count,this._unionId=e.body.a_union_id,e}.bind(this)).fail(function(e){console.error(e.stack)})},_setUnionHeaderMemberNum:function(e,t){if(t=t||"header_sub_label",n.isUndefined(this._myUnionInfo))console.warn("[ERROR] You should call _getUnionInfoAboutMe() as an union base info.");else{var i=e.seekWidgetByPath(t);!i||n.isUndefined(this._totalNumber)||n.isUndefined(this._maxNumber)||i.setString(""+this._totalNumber+"/"+this._maxNumber)}},_setFriendHeaderNum:function(e,i){return i=i||"header_sub_label",t.createInstance("myselfInfoRepository").getMe().then(function(t){var a=e.seekWidgetByPath(i);return!a||n.isUndefined(t.body.friend_num)||n.isUndefined(t.body.friend_max_num)||a.setString(""+t.body.friend_num+"/"+t.body.friend_max_num),t.body}.bind(this)).fail(function(e){console.error(e)})},_setSelectedGuardianHeader:function(e,t){t=t||"header_sub_label";var i=this._myUnionInfo||this._getUnionData();if(n.isUndefined(i))console.warn("[ERROR] You should call _getUnionInfoAboutMe() or _request('union_me') as an union base info.");else{var a=i.guardian_info,o=e.seekWidgetByPath(t);null===o||n.isUndefined(a)||o.setString(a.name+" Lv"+a.level)}},_setPositionIconsVisibility:function(e,i){var a=t.w("unionRoles");n.each(a,function(t,n){var a=e.seekWidgetByName("icon_guild_position_"+n);null!==a&&a.setVisible("all"===i||i.indexOf(n)>=0||i.indexOf(t)>=0)})},_toGuardianFullName:function(e){if(!e)return console.warn("Guardian data is required."),"";var t=e.guardian_info||e;if(n.isUndefined(t.name))return console.warn("Invalid guardian record.",t),"";var i=t.name;return(t.prefix_name||"")+""+i+""+(n.isUndefined(t.level)?"":"Lv"+t.level)}}}((this||0).self||global);!function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc.guild=t.pc.guild||{},t.pc.guild.roles=t.pc.guild.roles||{},t.pc.guild.roles.GuildScout={_errorPopupMap:{alreadyJoinRequested:"alreadyJoinRequested"},_scoutMember:function(e){t.createInstance("apiAUnionScouts").create(e.a_player_id).then(function(n){var a=n.body.scout_made?null:i.camelize(n.body.error),o={title:t.WordBook.UNION_SCOUNT_ERROR_TITLE[a]||"",content:t.WordBook.UNION_SCOUNT_ERROR_MESSAGE[a]||e.name+""};this._openPopupResult(o.title,o.content,this._errorPopupMap[a])}.bind(this)).fail(function(e){console.error(e.stack)})},_checkBeforeScout:function(e){var o=a.defer(),r=t.createInstance("apiAUnions").getMembers(),s=t.createInstance("apiAUnionScouts").getList(),c=t.createInstance("apiAUnionScouts").getListForPlayer(e.a_player_id),u=t.createInstance("apiAUnionJoinRequests").get(),l=t.createInstance("apiAUnions").getMe();return a.all([r,s,c,u,l]).spread(function(a,r,s,c,u){var l;if(i.isUndefined(a.body.data)||i.each(a.body.data,function(t){t.a_player_id===e.a_player_id&&(l="alreadyMember")},this),i.isUndefined(l)&&!i.isUndefined(r.body.data)&&i.each(r.body.data,function(t){t.player.a_player_id===e.a_player_id&&(l="scoutPending")},this),i.isUndefined(l)&&!i.isUndefined(s.body.max_record_count)&&s.body.max_record_count>0&&(l="scoutedByOthers"),i.isUndefined(l)&&!i.isUndefined(c.body.data)&&i.each(c.body.data,function(t){t.player.a_player_id===e.a_player_id&&(l="alreadyJoinRequested")},this),i.isUndefined(l)&&!i.isUndefined(u.body)){var _=u.body.member_count||0;(u.body.max_member_count||0)<=_&&(l="memberMaxReached")}if(i.isUndefined(l))o.resolve();else{var p=(n.director.getRunningScene(),t.WordBook.UNION_SCOUNT_ERROR_TITLE[l]),d=t.WordBook.UNION_SCOUNT_ERROR_MESSAGE[l];this._openPopupResult(p,d,this._errorPopupMap[l]),o.reject(l)}}.bind(this)),o.promise},_openPopupResult:function(e,t,i){i=i||"popupResult";var a=n.director.getRunningScene().popups[i];a.open().then(function(){a.setTitle(e),a.setContent(t)}.bind(this)).fail(function(e){console.error(e.stack)})}}}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc.guild=t.pc.guild||{},t.pc.guild.roles=t.pc.guild.roles||{},t.pc.guild.roles.GuildJoinCheck={_joinCheckAndGoSearchUnion:function(e){return this._checkJoinTimeLimitation(e).then(function(){t.createInstance("apiAUnionJoinRequests").getMe().then(function(e){if(0===e.body.max_record_count)this._navigateTo000b();else{var t=e.body.data[0].union.a_union_id;this._navigateTo0001ById(t)}}.bind(this))}.bind(this))},_joinCheckAndGoFormUnion:function(){return this._checkJoinTimeLimitation().then(function(){this._navigateTo000c()}.bind(this))},_sendJoinRequest:function(e,a){var o=n.director.getRunningScene();this._checkBeforeJoinRequest(e.a_union_id).then(function(){t.createInstance("apiAUnionJoinRequests").create(e.a_union_id).then(function(t){var n=t.body,r=n.error;n.request_made?o._openMessagePopup({title:"",content:"<div>"+e.name+"<br /></div>",buttons:[["blueBtn","OK",!0]]}).then(function(){i.isFunction(a)&&a.call(this)}.bind(this)):n.a_union_id===e.a_union_id?o._openMessagePopup({title:"",content:"<div>"+e.name+"<br /></div>",buttons:[["blueBtn","OK",!0]]}).then(function(){i.isFunction(a)&&a.call(this)}.bind(this)):r&&this._openErrorPopup(r)}.bind(this))}.bind(this))},_deleteJoinRequest:function(e,o){var r=n.director.getRunningScene(),s=r._openMessagePopup({title:"",content:"<div>"+e.name+"<br/></div>",buttons:[["blackBtn",""],["blueBtn","OK",!0]]}),c=this._request("joinRequests");a.all([s,c]).then(function(n){var a=n[1].data,s=t.createInstance("apiAUnionJoinRequests");try{s.cancel([a[0].a_union_join_request_id]).then(function(t){r._openMessagePopup({title:"",content:"<div>"+e.name+"<br/></div>",buttons:[["blackBtn","",!0]]}).then(function(){i.isFunction(o)&&o.call(this)}.bind(this))}.bind(this))}catch(e){console.error(e)}}.bind(this))},_checkJoinTimeLimitation:function(e){var i=a.defer();return t.createInstance("apiAPlayers").getUnionJoinedLimitState().then(function(t){var a=t.body.union_joined_limit_state.clear_time,o=n.director.getRunningScene();a?(o.popups.popupForbidden.openEx(a),i.reject("")):!0!==e?o.popups.popupAttention.openEx(function(){i.resolve()}):i.resolve()}.bind(this)),i.promise},_checkBeforeJoinRequest:function(e,o){var r=n.director.getRunningScene(),s=a.defer(),c=t.createInstance("apiAUnions").get(e),u=t.createInstance("apiAUnions").get("me"),l=t.createInstance("apiAUnionScouts").getListForMe(),_=t.createInstance("apiAUnionJoinRequests").getMe(),p=t.createInstance("apiAPlayers").getUnionJoinedLimitState();return a.all([c,u,l,_,p]).spread(function(t,n,a,c,u){var l,_;if(!i.isUndefined(t.body)){var p=t.body.member_count||0;(t.body.max_member_count||0)<=p&&(l="member_max_reached")}if(i.isUndefined(l)&&!i.isUndefined(n.body)&&(i.isEmpty(n.body)||(l="already_union_member")),i.isUndefined(l)&&!i.isUndefined(a.body.data)&&i.each(a.body.data,function(t){i.isUndefined(t.union)||t.union.a_union_id===e||(l="already_scouted")},this),i.isUndefined(l)&&!i.isUndefined(c.body.max_record_count)&&c.body.max_record_count>0&&(l="request_pending"),i.isUndefined(l)&&!i.isUndefined(u.body.union_joined_limit_state)){var d=u.body.union_joined_limit_state.clear_time;d&&(l="join_time_limited",_=function(){r.popups.popupForbidden.openEx(d)},s.reject(""))}if(i.isUndefined(l))if(!0!==o){r.popups.popupAttention.openEx(function(){s.resolve()})}else s.resolve();else i.isFunction(_)?_.apply(this):this._openErrorPopup(l,a.body),s.reject(l)}.bind(this)),s.promise},_openErrorPopup:function(e,n){var a=(t.WordBook.UNION_JOIN_ERROR_MESSAGE[e],t.WordBook.UNION_JOIN_ERROR_MESSAGE[e]);if("already_scouted"==e)if(i.isUndefined(n)){t.createInstance("apiAUnionScouts").getListForMe().then(function(e){var t=e.body.data[0].union.name;this.__openErrorPopupCore(a,t)}.bind(this)).fail(function(e){this.__openErrorPopupCore(a,'<span class="red"></span>')})}else this.__openErrorPopupCore(a,n.data[0].union.name);else this.__openErrorPopupCore(a)},__openErrorPopupCore:function(e,t){i.isUndefined(t)||(e=e.replace(/\$union_name\$/g,t)),n.director.getRunningScene()._openMessagePopup({title:"",content:'<div style="line-height: 1.3em">'+e+"</div>",buttons:[["blueBtn","OK"]]})}}}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc.guild=t.pc.guild||{},t.pc.guild.roles=t.pc.guild.roles||{},t.pc.guild.roles.GuildApiCache={_apiSettings:{union_me:{module:"apiAUnions",method:"get",args:["me"]},union:{module:"apiAUnions",method:"get",args:[]},newInfo:{module:"apiAUnions",method:"getNewInfo"},donation:{module:"apiAUnions",method:"getDonationInfo"},me:{module:"apiAPlayers",method:"getMe"},check:{module:"apiAUnionScouts",method:"check",args:[]},joinRequests:{module:"apiAUnionJoinRequests",method:"getMe"},authority:{module:"apiAUnionAuthority",method:"get"}},_data:{},_requestAll:function(e){var t=[];return i.each(e,function(e){var n=this._request(e);t.push(n)}.bind(this)),a.all(t).fail(function(e){console.error(e)})},_request:function(e){var n=this._data[e],o=a.defer();if(i.isUndefined(n)||i.isNull(n)){var r=this._apiSettings[e];if(-1!==["union","check"].indexOf(e)&&(r.args[0]=this._getGuildId()),i.isUndefined(r)){var s="Unknown data key: "+e;o.reject(new Error(s))}else{var c=t.createInstance(r.module);c[r.method].apply(c,r.args).then(function(t){n=t.body,this._data[e]=n,o.resolve(n)}.bind(this)).fail(function(e){o.reject(e)}.bind(this))}}else o.resolve(n);return o.promise},_getGuildId:function(){var e=this._data.a_union_id;if(i.isUndefined(e)){if(i.isUndefined(this._data.union_me)){var a=n.director.getRunningScene(),o=t.createInstance("router").getCurrentFragment().replace(/_[abcd]$/,"");e=(a.routerParams[o.substring(o.indexOf("/")+1)]||a.temporaryRouterParams).id||"me"}else e="me";this._data.a_union_id=e}return e},_getUnionData:function(){var e=this._data.union_me||this._data.union;return i.isUndefined(e)?void console.error("Plz call _requestBykeys(['union|union_me']) previously."):e},_updateUnionData:function(e){i.isUndefined(this._data.union_me)||(this._data.union_me=e),i.isUndefined(this._data.union)||(this._data.union=e)},_amILeader:function(){return"me"===this._getUnionData().leader.a_player_id},_amISubLeader:function(){var e=this._getUnionData(),t=i.find(e.sub_leaders,{a_player_id:"me"});return!i.isUndefined(t)}}}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q,o=e.res;t.pc.guild=t.pc.guild||{},t.pc.guild.roles=t.pc.guild.roles||{},t.pc.guild.roles.GuardianPageListController={_prefetchGuardian:function(){var e=t.createInstance("apiAUnions");return this._prefetchedGuardianPromise=this._prefetchedGuardianPromise||a.all([e.getGuardians(!0),e.getGuardians(!1)]).then(function(e){return e.forEach(function(e){e.body.data.forEach(function(e){n.textureCache.addImage(t.Img("unionguardian","guardian",i.padZero(e.guardian_id,4),0).png),n.textureCache.addImage(t.Img("illust-com-kneeshot","guardian",i.padZero(e.guardian_id,4),0).png)})}),e},function(e){e&&console.error(e)}),this._prefetchedGuardianPromise},_fillupGuardianList:function(e){return $staticRes(o["guild-gud_003-gud_guardianlist_1_page_ui"]),$staticRes(o["guild-gud_003-gud_guardianlist_0_page_ui"]),this._prefetchGuardian().spread(function(n,i){this._fillupGuardianListCore(e,"tab_0_node",n,t.PageListParams.GUILD_GUARDIAN.subPageRes,"_guardianListPanelInitFunc"),this._fillupGuardianListCore(e,"tab_1_node",i,t.PageListParams.GUILD_BUY_GUARDIAN.subPageRes,"_guardianListPanelInitFunc"),this._prefetchedGuardianPromise=null}.bind(this))},_fillupGuardianListCore:function(e,n,i,a,o){var r=e.seekWidgetByName(n);if(null!==r)if(null!==r.seekWidgetByName("change_page_panel")){var s,c=i.body.max_record_count;if(this._fillupList(r,{viewParent:t.PageListParams.GUILD_GUARDIAN_COMMON.viewParent,subPageRes:a,panelsPerPage:t.PageListParams.GUILD_GUARDIAN_COMMON.perPage},i.body.data,i.body.max_record_count,null,this[o].bind(this,e)),0===c)null!==(s=r.seekWidgetByName("nothing_node"))&&s.setVisible(!0);else null!==(s=r.seekWidgetByName("list_node"))&&s.setVisible(!0)}else console.warn("[ERROR] Could not find a list parent node.");else console.warn("[ERROR] Could not find a parent node.")},_guardianListPanelInitFunc:function(e,n,a,o){if(!e.disposed){if(i.isUndefined(a.guardian_id))return void console.warn("[ERROR] Could not find guardian id.");this._setGuildStrings(n,{guardian_info:a});var r=t.Img("unionguardian","guardian",i.padZero(a.guardian_id,4),0).png,s=n.seekWidgetByName("unionguardian_guardian");if(null!==s&&s.setBackGroundImage(r),null!==n.seekWidgetByName("guardian_effect_label")&&n.setStrings({guardian_effect_label:this.__getCurrentEffect(a)}),!i.isUndefined(a.detail_info)&&!i.isUndefined(a.detail_info.custom_pt)&&!i.isUndefined(a.detail_info.next_level_pt)&&null!==n.seekWidgetByName("total_custom_point_gauge")){var c=a.detail_info.custom_pt,u=c+a.detail_info.next_level_pt;n.seekWidgetByName("total_custom_point_gauge").setPercent(100*c/u)}var l=n.seekWidgetByName("btn_protection"),_=n.seekWidgetByName("icon_protection"),p=n.seekWidgetByName("btn_buy");if(l&&(a.is_equipped?this._setEnableButton(l,!1):i.isUndefined(this._unionMemberMe)?i.isUndefined(this._data.union_me)||i.isUndefined(this._data.me)?this._setEnableButton(l,!1):this._setEnableButton(l,this._amILeader()||this._amISubLeader()):this._setEnableButton(l,"leader"===this._unionMemberMe.union_position)),_&&a.is_equipped&&_.setVisible(!0),l&&l.addTouchEventListener(this._onTouchBtnProtection.bind(this,e,a),this),p){if(i.isUndefined(this._unionMemberMe))i.isUndefined(this._data.union_me)||i.isUndefined(this._data.me)?this._setEnableButton(p,!1):this._setEnableButton(p,this._amILeader()||this._amISubLeader());else{var d=this._unionMemberMe.union_position;this._setEnableButton(p,"leader"===d||"sub_leader"===d)}p.addTouchEventListener(this._onTouchBtnBuy.bind(this,e,a),this)}var h=n.seekWidgetByName("btn_guardian");h&&h.addTouchEventListener(this._onTouchGuardianPanel.bind(this,e,a),this),n.setVisible(!0)}},__getCurrentEffect:function(e){if(!i.isUndefined(e.detail_info)){var t="";return e.detail_info.effects.forEach(function(e){e.is_acquired&&(t=e.description)}),t}}},i.assign(t.pc.guild.roles.GuardianPageListController,t.pc.list.roles.PageListControllerCommon,t.pc.list.roles.UserListCommon)}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._),i=e.Q;t.pc.list=t.pc.list||{},t.pc.list.roles=t.pc.list.roles||{},t.pc.list.roles.ChatPageListBtnsController={__reloadChatListFunction:null,_fillupChatBtnsList:function(e,n,i,a){var o="window_gray",r=e.seekWidgetByName(o);if(null!==r){this.__reloadChatListFunction=this._fillupChatBtnsList.bind(this,e,n,i,a);var s=t.createInstance(n);return s[i].apply(s,a).then(this.__fillupChatPageList.bind(this,e,r)).fail(function(e){console.error(e)})}console.debug("[ERROR] Could not find the node: "+o)},__fillupChatPageList:function(e,n,i){var a=n.seekWidgetByName("btn_chat_stamp");null!==a&&a.setVisible(!0);var o=i.body.max_record_count<=0,r=n.seekWidgetByName("nothing_node");if(null!==r&&r.setVisible(o),!o){this._fillupList(e,{viewParent:t.PageListParams.CHAT_LIST.viewParent,subPageRes:t.PageListParams.CHAT_LIST.subPageRes,panelsPerPage:t.PageListParams.CHAT_LIST.perPage},i.body.data,i.body.max_record_count,void 0,this._setChatPanel.bind(this,e));var s=n.seekWidgetByName("list_node");null!==s&&s.setVisible(!0)}},_setChatPanel:function(e,i,a){var o=i.seekWidgetByName("btn_player"),r=a.from_player_info;if(o&&!n.isUndefined(r)&&!n.isUndefined(r.job_id)){var s=t.Img("iconcircle","job",n.padZero(r.job_id,4),0).png;o.loadTextures(s,s,s)}o.addTouchEventListener(function(t,n){n===ccui.Widget.TOUCH_ENDED&&this._onTouchChatPlayer(e,a)},this);var c=!1;n.isUndefined(r)||(c="me"===r.a_player_id,!n.isUndefined(this._playerInfo)&&this._playerInfo.is_me&&(c=this._playerInfo.is_me));var u=i.seekWidgetByName("btn_delete");u.setVisible(c),c&&u.addTouchEventListener(function(t,n){n===ccui.Widget.TOUCH_ENDED&&this._onTouchDeleteChat(e,a)},this);var l="";n.isUndefined(r)||n.isUndefined(r.name)||(l=r.name+" Rank "+r.rank),i.setStrings({username_label:l,date_time_label:a.date||""}),this._setChatPanelLabelStamp(i,a),i.setVisible(!0)},_setChatPanelLabelStamp:function(e,i){var a="chat_only";if(n.isUndefined(i.stamp_id)||(a="stamp_only"),e.setAppearance(a),"stamp_only"===a){var o=e.seekWidgetByName("coreimg_stamp"),r=t.Img("coreimg","stamp",n.padZero(i.stamp_id,4)).png;o.loadTexture(r)}else{e.seekWidgetByName("chat_label").setString(i.message)}},btnCallbackBtnReload:function(e){var t=e.seekWidgetByName("list_node");return null!==t&&t.setVisible(!1),this.__reloadChatListFunction(),i.reject(this._override)}},n.assign(t.pc.list.roles.ChatPageListBtnsController,t.pc.list.roles.PageListControllerCommon)}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);e.Q,t.pc.guild=t.pc.guild||{},t.pc.guild.roles=t.pc.guild.roles||{},t.pc.guild.roles.Routing={_navigateTo000b:function(e){t.createInstance("router").navigate("guild/gud_000_b")},_navigateTo000c:function(e){t.createInstance("router").navigate("guild/gud_000_c")},_navigateTo0001ById:function(e){t.createInstance("router").navigate("guild/gud_001",{},{id:e})},_navigate000To001:function(e,n){t.createInstance("router").navigate("guild/gud_001",{},n)},_verifyRouterParams001:function(e){n.isUndefined(e.routerParams.gud_001)||n.isUndefined(e.routerParams.gud_001.id)||(e.temporaryRouterParams.id=e.routerParams.gud_001.id,delete e.routerParams.gud_001,console.warn(new Error(" 'gud_001:id'  temporaryRouterParams  'id' ").stack)),n.isUndefined(e.temporaryRouterParams.id)&&(e.temporaryRouterParams.id="me")},_navigate001To001a:function(e){e.routerParams.gud_001,t.createInstance("router").navigate("guild/gud_001",{},{})},_navigate001aTo007:function(e,n,i){e.routerParams.gud_001,n?t.createInstance("router").navigate("guild/gud_007_a",{gud_007:{id:"me",selectedTab:"tab_0"}},i):t.createInstance("router").navigate("guild/gud_007_b",{gud_007:{id:"me"}},i)},_navigate001To007:function(e,i){n.isUndefined(e.temporaryRouterParams.id)?this._consoleErrorRoutingAbort("temporaryRouterParams.id"):(e.routerParams.gud_001,t.createInstance("router").navigate("guild/gud_007_b",{gud_007:{id:e.temporaryRouterParams.id}},i))},_navigate001ToMyPage:function(e){t.createInstance("router").navigate("mypage")},_navigate001To010:function(e){t.createInstance("router").navigate("guild/gud_010")},_verifyRouterParams002:function(e){n.isUndefined(e.routerParams.gud_002)&&(e.routerParams.gud_002={},e.routerParams.gud_002.id="me")},_navigate002To003:function(e,n){t.createInstance("router").navigate("guild/gud_003",{gud_003:{}})},_navigate002To005:function(e){return n.isUndefined(e.routerParams.gud_002)?void this._consoleErrorRoutingAbort("routerParams.gud_002"):n.isUndefined(e.routerParams.gud_002.id)?void this._consoleErrorRoutingAbort("routerParams.gud_002.id"):void t.createInstance("router").navigate("guild/gud_005",{gud_005:{id:e.routerParams.gud_002.id}})},_verifyRouterParams003:function(e){},_verifyRouterParams005:function(e){n.isUndefined(e.routerParams.gud_005)&&(e.routerParams.gud_005={},e.routerParams.gud_005.id=1,this._consoleErrorRouterParams("routerParams.gud_005, .id"))},_verifyRouterParams007:function(e){n.isUndefined(e.routerParams.gud_007)&&(e.routerParams.gud_007={},e.routerParams.gud_007.id="me",e.routerParams.gud_007.selectedTab="tab_0")},_navigate007ToPRF001:function(e,t,n,i){this._commonNavigateToPRF001(e,t,n,i)},_verifyRouterParams009:function(e){},_navigate008ToPRF001:function(e,t,n,i){this._commonNavigateToPRF001(e,t,n,i)},_verifyRouterParams010_011_012:function(e){n.isUndefined(e.routerParams.gud_010)&&(e.routerParams.gud_010={},e.routerParams.gud_010.selectedTab="tab_0")},_navigate010_011_012ToPRF001:function(e,t,n,i){this._commonNavigateToPRF001(e,t,n,i)},_verifyRouterParams013:function(e){},_navigate013ToPRF001:function(e,t,n,i){this._commonNavigateToPRF001(e,t,n,i)},_commonNavigateToPRF001:function(e,i,a,o){if(n.isUndefined(i))this._consoleErrorRoutingAbort("player_id");else{var r="profile/prf_001"+("me"===i?"a":"b");t.createInstance("router").navigate(r,a,o)}},_navigateToMyPage:function(){t.createInstance("router").navigate("mypage/my_001")},_navigateToGuildTop:function(){t.createInstance("router").navigate("guild/gud_001")},_navigateToUnionGuardian:function(){t.createInstance("router").navigate("guild/gud_002")},_navigateToUnionMembers:function(){t.createInstance("router").navigate("guild/gud_007_a")},_navigateFrom:function(e){var i=t.createInstance("router").getCurrentFragment();return n.isUndefined(e)||n.isUndefined(e.routes)||i===e.routes?void this._navigateToMyPage():void t.createInstance("router").navigate(e.routes,e.routerParams,e.temporaryRouterParams)}},n.assign(t.pc.guild.roles.Routing,t.pc.roles.RoutingCommon)}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;e.Q,t.pc.guild=t.pc.guild||{},t.pc.guild.roles=t.pc.guild.roles||{},t.pc.guild.roles.GuildControlPopupPermissions={__buttonAndPermission:{btn_dissolution:"canDismissUnion",btn_dismissal:"canFireMember",btn_change_name:"canRenameUnion",btn_bursttime:"canChangeBurstTime",btn_appoint:"canAppointLeaderUnion",btn_leave:"canLeave"},_setupButtons:function(e){this.__resetButtons(e),t.createInstance("GuildControlPermissionModel").prepare().then(function(t){this.__setButtonsAccordingToPermissions(e,t)}.bind(this))},__resetButtons:function(e){i.each(this.__buttonAndPermission,function(t,n){var i=e.seekWidgetByName(n);null!==i&&this.__setButtonEnabled(i,!1)},this)},__setButtonsAccordingToPermissions:function(e,t){i.each(this.__buttonAndPermission,function(n,i){var a=e.seekWidgetByName(i);null!==a&&this.__setButtonEnabled(a,t[n]())},this)},__setButtonEnabled:function(e,t){e.setEnabled(t),e.setColor(t?n.color.WHITE:n.color("#808080"))}}}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e.ccs,e._,e.res,t.Gud001ControlAnimation=n.Class.extend({_popup:null,_burstTimeButton:null,_targetNode:null,_khBurstTime:null,ctor:function(e){this._popup=e,this._khBurstTime=t.createInstance("burstTime"),this._burstTimeButton=this._popup.seekWidgetByName("btn_bursttime"),this._targetNode=this._getTargetNode(this._popup)},show:function(){this._khBurstTime.prepare().then(function(){var e=this._khBurstTime.isEnabled()&&this._khBurstTime.isReservable()?"bursttime_view":"nothing_view";this._targetNode.animate(e)}.bind(this))},_getTargetNode:function(e){return e.seekWidgetByName("top_pin_node").getChildren()[0]}})}((this||0).self||global),function(e){var t=e._,n=e.kh;n.PopupFactoryGud000Attention=n.PopupFactoryTextOnly.extend({POPUP_PROPERTIES:{resourceName:"core-popup-text_button_only",title:""+n.w("joinedUnion")+"",buttonLabels:{blackBtn:"",blueBtn:"OK"},buttons:{blackBtn:function(e){this.dismiss()},blueBtn:function(e){this.dismiss(),"function"==typeof this._okCallback&&this._okCallback.call(e._delegate||e)}}},POPUP_METHODS:{openEx:function(e){var t=this.open(),i='<div class="red">'+n.w("joinedUnion")+"<br />24"+n.w("joinedUnion")+"</div>";return this.setContent(i),"function"==typeof e?this._okCallback=e:e&&(this._okCallback=function(){n.createInstance("router").navigate(e)}),t}},create:function(e,i){return n.PopupFactory.prototype.create.call(this,t.assign(e,this.POPUP_PROPERTIES),i)},_addMethodsToPopup:function(e){n.PopupFactoryTextOnly.prototype._addMethodsToPopup.call(this,e),t.assign(e,this.POPUP_METHODS)}})}((this||0).self||global),function(e){var t=e._,n=e.kh;n.PopupFactoryGud000Forbidden=n.PopupFactoryTextOnly.extend({POPUP_PROPERTIES:{resourceName:"core-popup-text_button_only",title:n.w("joinedUnion")+"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){this.dismiss()}}},POPUP_METHODS:{openEx:function(e){var t=this.open(),i="<div>"+n.w("joinedUnion")+'<br/><span class="red">';return i+=e+"</span> <br/>",i+=""+n.w("joinedUnion")+"</div>",this.setContent(i),t}},create:function(e,i){return n.PopupFactory.prototype.create.call(this,t.assign(e,this.POPUP_PROPERTIES),i)},_addMethodsToPopup:function(e){n.PopupFactoryTextOnly.prototype._addMethodsToPopup.call(this,e),t.assign(e,this.POPUP_METHODS)}})}((this||0).self||global),function(e){var t=e._,n=e.kh;n.PopupFactoryGud001Control=n.PopupFactoryPopupCommon.extend(t.assign(n.pc.guild.roles.GuildControlPopupPermissions,{POPUP_PROPERTIES:{resourceName:"core-popup-gud_001_control",title:"",buttonLabels:{blackBtn:""},buttons:{blackBtn:function(e){this.dismiss()}}},POPUP_METHODS:{},onPopupOpened:function(e,t){this._setupButtons(e),this.unionData=t.data;var i={"TOUCH_ENDED btn_dissolution":function(){e.dismiss(),this._confirmBreak.call(this)}.bind(this),"TOUCH_ENDED btn_status":function(){e.dismiss(),this._openMyStatusPopup.call(this)}.bind(this),"TOUCH_ENDED btn_set_condition":function(){e.dismiss(),this._openSetConditionPopup.call(this)}.bind(this),"TOUCH_ENDED btn_appoint":function(){e.dismiss(),this._gotoAppointRolePage.call(this)}.bind(this),"TOUCH_ENDED btn_dismissal":function(){e.dismiss(),this._gotoDismissalMemberPage.call(this)}.bind(this),"TOUCH_ENDED btn_change_introduction":function(){e.dismiss(),this._openEditCommentPopup.call(this)}.bind(this),"TOUCH_ENDED btn_change_name":function(){e.dismiss(),this._openNameChangePopup.call(this)}.bind(this),"TOUCH_ENDED btn_bursttime":function(){e.dismiss(),this._openBurstTimePopup.call(this)}.bind(this)};if(n.setTouchEventHandlers(e,i,e),n.createInstance("Gud001ControlAnimation",[e]).show(),this.unionData.member_count===this.unionData.max_member_count){var a=e.seekWidgetByName("btn_set_condition");a.setColor(cc.color("#808080")),a.setEnabled(!1)}},_openNameChangePopup:function(){var e=cc.director.getRunningScene(),t=(e._delegate||e)._data.union||{name:"Error"};n.createInstance("popupFactoryGudNameCha").create({}).open({name:t.name,nameTextId:t.name_text_id})},_openEditCommentPopup:function(){var e=cc.director.getRunningScene(),t=e._delegate||e;t._editComment.call(t)},_openMyStatusPopup:function(){n.createInstance("popupFactoryGudMyStatus").create({}).open()},_openSetConditionPopup:function(){n.createInstance("apiAUnionJoinConditions").get().then(function(e){try{var t=cc.director.getRunningScene(),i=e.body.is_searchable?"gud_request_set_b":"gud_request_set_a";n.ImplantedPopup.createOrGet(t,i,"GuildRequestSetConditionPopup").open(e.body)}catch(e){console.error(e)}}.bind(this))},_gotoAppointRolePage:function(){var e=cc.director.getRunningScene();t.isUndefined(e._delegate)?n.createInstance("router").navigate("guild/gud_013",{gud_013:{type:"change"}}):n.createInstance("router").navigate("guild/gud_013_b",{gud_013_b:{}})},_gotoDismissalMemberPage:function(){var e=cc.director.getRunningScene();t.isUndefined(e._delegate)?n.createInstance("router").navigate("guild/gud_013",{gud_013:{type:"fire"}}):n.createInstance("router").navigate("guild/gud_013_a",{gud_013_a:{}})},_confirmBreak:function(){n.createInstance("popupFactoryGud001Break").create({}).openWithActions(null,{blackBtn:!1,blueBtn:!0}).then(this._confirmBreakAgain.bind(this))},_confirmBreakAgain:function(){cc.director.getRunningScene()._openMessagePopup({title:"",content:'<div><span class="red"></span></div>',buttons:[["blackBtn",""],["redBtn","",!0]]}).then(this._processBreak.bind(this))},_processBreak:function(){var e=cc.director.getRunningScene();n.createInstance("apiAUnions").dissolution().then(function(t){e._openMessagePopup({title:"",content:"<div></div>",buttons:[["blueBtn","OK",!0]]}).then(function(){n.createInstance("router").navigate("mypage")})}.bind(this))},_openBurstTimePopup:function(e){n.createInstance("popupFactoryGud001BurstTimeChange").create({}).open()},create:function(e,i){return n.PopupFactory.prototype.create.call(this,t.assign(e,this.POPUP_PROPERTIES),i)},_addMethodsToPopup:function(e){n.PopupFactoryPopupCommon.prototype._addMethodsToPopup.call(this,e),t.assign(e,this.POPUP_METHODS)}}))}((this||0).self||global),function(e){var t=e._,n=e.kh;n.PopupFactoryGud001UncontrolBurstTime=n.PopupFactoryPopupCommon.extend(t.assign(n.pc.guild.roles.GuildControlPopupPermissions,{POPUP_PROPERTIES:{resourceName:"core-popup-gud_001_uncontrol_a",title:"",buttonLabels:{blackBtn:""},buttons:{blackBtn:function(e){this.dismiss()}}},POPUP_METHODS:{},onPopupOpened:function(e,t){this._setupButtons(e);var i={"TOUCH_ENDED btn_leave":function(){e.dismiss(),this._confirmLeave.call(this)}.bind(this),"TOUCH_ENDED btn_status":function(){e.dismiss(),this._myStatus.call(this)}.bind(this),"TOUCH_ENDED btn_bursttime":function(){e.dismiss(),this._openBurstTimePopup.call(this)}.bind(this)};n.createInstance("Gud001ControlAnimation",[e]).show(),n.setTouchEventHandlers(e,i,e)},_myStatus:function(){n.createInstance("popupFactoryGudMyStatus").create({}).open()},_confirmLeave:function(){n.createInstance("popupFactoryGud001Leave").create({}).openWithActions(null,{blackBtn:!1,blueBtn:!0}).then(this._confirmLeaveAgain.bind(this))},_confirmLeaveAgain:function(){cc.director.getRunningScene()._openMessagePopup({title:"",content:'<div><span class="red"></span></div>',buttons:[["blackBtn",""],["redBtn","",!0]]}).then(this._processLeave.bind(this))},_processLeave:function(){var e=cc.director.getRunningScene();n.createInstance("apiAUnions").leave().then(function(t){e._openMessagePopup({title:"",content:"<div></div>",buttons:[["blueBtn","",!0]]}).then(function(){n.createInstance("router").navigate("mypage")})}.bind(this))},_openBurstTimePopup:function(e){n.createInstance("popupFactoryGud001BurstTimeChange").create({}).open()},create:function(e,i){return n.PopupFactory.prototype.create.call(this,t.assign(e,this.POPUP_PROPERTIES),i)},_addMethodsToPopup:function(e){n.PopupFactoryPopupCommon.prototype._addMethodsToPopup.call(this,e),t.assign(e,this.POPUP_METHODS)}}))}((this||0).self||global),function(e){var t=e._,n=e.kh;n.PopupFactoryGud001Uncontrol=n.PopupFactoryPopupCommon.extend(t.assign(n.pc.guild.roles.GuildControlPopupPermissions,{POPUP_PROPERTIES:{resourceName:"core-popup-gud_001_uncontrol_b",title:"",buttonLabels:{blackBtn:""},buttons:{blackBtn:function(e){this.dismiss()}}},POPUP_METHODS:{},onPopupOpened:function(e,t){this._setupButtons(e);var i={"TOUCH_ENDED btn_leave":function(){e.dismiss(),this._confirmLeave.call(this)}.bind(this),"TOUCH_ENDED btn_status":function(){e.dismiss(),this._myStatus.call(this)}.bind(this)};n.setTouchEventHandlers(e,i,e)},_myStatus:function(){n.createInstance("popupFactoryGudMyStatus").create({}).open()},_confirmLeave:function(){n.createInstance("popupFactoryGud001Leave").create({}).openWithActions(null,{blackBtn:!1,blueBtn:!0}).then(this._confirmLeaveAgain.bind(this))},_confirmLeaveAgain:function(){cc.director.getRunningScene()._openMessagePopup({title:"",content:'<div><span class="red"></span></div>',buttons:[["blackBtn",""],["redBtn","",!0]]}).then(this._processLeave.bind(this))},_processLeave:function(){var e=cc.director.getRunningScene();n.createInstance("apiAUnions").leave().then(function(t){e._openMessagePopup({title:"",content:"<div></div>",buttons:[["blueBtn","",!0]]}).then(function(){n.createInstance("router").navigate("mypage")})}.bind(this))},create:function(e,i){return n.PopupFactory.prototype.create.call(this,t.assign(e,this.POPUP_PROPERTIES),i)},_addMethodsToPopup:function(e){n.PopupFactoryPopupCommon.prototype._addMethodsToPopup.call(this,e),t.assign(e,this.POPUP_METHODS)}}))}((this||0).self||global),function(e){var t=e._,n=e.kh;n.PopupFactoryGud001Edit=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-gud_001_edit",title:"",buttonLabels:{blackBtn:"",blueBtn:"OK"},buttons:{}},POPUP_METHODS:{dismiss:function(){null!=this.editBox&&(n.EditBox.prototype.cleanup.apply(this.editBox),this.editBox=null),n.Popup.prototype.dismiss.apply(this)}},create:function(e,i){return n.PopupFactory.prototype.create.call(this,t.assign(e,this.POPUP_PROPERTIES),i)},_addMethodsToPopup:function(e){n.PopupFactoryPopupCommon.prototype._addMethodsToPopup.call(this,e),t.assign(e,this.POPUP_METHODS)}})}((this||0).self||global),function(e){var t=e._,n=e.kh;n.PopupFactoryGud001Leave=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-gud_001_break_leave",title:"",buttonLabels:{blackBtn:"",blueBtn:"OK"},buttons:{}},POPUP_METHODS:{},onPopupOpened:function(e,t){e.setHtmlStrings({break_leave_labelimg:'<div><span class="red"></span><br/></div>'},n.GameConfig.POPUP_CSS),e.seekWidgetByName("caution_label").setString("\n\n\n"+n.w("joinedUnion")+"\n24\n"+n.w("joinedUnion")+"")},create:function(e,i){return n.PopupFactory.prototype.create.call(this,t.assign(e,this.POPUP_PROPERTIES),i)},_addMethodsToPopup:function(e){n.PopupFactoryPopupCommon.prototype._addMethodsToPopup.call(this,e),t.assign(e,this.POPUP_METHODS)}})}((this||0).self||global),function(e){var t=e._,n=e.kh;n.PopupFactoryGud001Break=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-gud_001_break_leave",title:"",buttonLabels:{blackBtn:"",blueBtn:"OK"},buttons:{}},POPUP_METHODS:{},onPopupOpened:function(e,t){e.setHtmlStrings({break_leave_labelimg:'<div><span class="red"></span><br/></div>'},n.GameConfig.POPUP_CSS);var i=e.seekWidgetByName("caution_label");i.setString("\n\n"+n.w("gem")+"\n\n24\n"+n.w("joinedUnion")+""),i.fontSize=20,setTimeout(function(){i.setVisible(!0)},10)},create:function(e,i){var a=n.PopupFactory.prototype.create.call(this,t.assign(e,this.POPUP_PROPERTIES),i);return a.contentNode.seekWidgetByName("caution_label").setVisible(!1),a},_addMethodsToPopup:function(e){n.PopupFactoryPopupCommon.prototype._addMethodsToPopup.call(this,e),t.assign(e,this.POPUP_METHODS)}})}((this||0).self||global),function(e){var t=e._,n=e.kh,i=e.cc,a=e.res;n.PopupFactoryGud001BurstTimeChange=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-gud_001_bursttime_change",title:"",buttonLabels:{blackBtn:"",blueBtn:"OK"},buttons:{blackBtn:function(e){this.dismiss()},blueBtn:function(e){this.updateBurstTime()}}},POPUP_METHODS:{},_khBurstTime:null,_widgets:{labels:[],pulldowns:[]},_pulldowns:[],_pulldownEventListeners:[],_selectedValues:[],_popup:null,onPopupOpened:function(e,t){this._popup=e,this._widgets.labels[0]=e.seekWidgetByName("bursttime_period_label_0"),this._widgets.labels[1]=e.seekWidgetByName("bursttime_period_label_1"),this._widgets.pulldowns[0]=e.seekWidgetByName("group_panel_0"),this._widgets.pulldowns[1]=e.seekWidgetByName("group_panel_1"),this._widgets.okButton=e.seekWidgetByName("blue_btn"),this._khBurstTime=n.createInstance("burstTime"),this._khBurstTime.prepare().then(this._initWidgets.bind(this))},_initWidgets:function(){this._widgets.okButton.setEnabled(!1),this._widgets.okButton.setColor(i.color("#808080")),t.each(this._widgets.labels,function(e,t){var n=this._khBurstTime.getSelectedBurstTimeInfo(t).description;e.setString(""+(t+1).toString()+""+n)}.bind(this));var e=this._khBurstTime.getSelectableBurstTimes();t.each(this._widgets.pulldowns,function(n,a){this._selectedValues[a]=this._khBurstTime.getReservedBurstTimeInfo(a).type,t.isNumber(this._selectedValues[a])||(this._selectedValues[a]=this._khBurstTime.getSelectedBurstTimeInfo(a).type),this._khBurstTime.changePreReservedBurstTime(a,this._selectedValues[a]),this._pulldowns[a]=this._createBurstTimePullDown(n,e,this._selectedValues[a]),this._pulldownEventListeners[a]=function(e){return this._selectedValues[a]=e.value,this._khBurstTime.changePreReservedBurstTime(a,this._selectedValues[a]),t.filter(this._selectedValues,function(t){return t===e.value}).length>1?(this._widgets.okButton.setEnabled(!1),void this._widgets.okButton.setColor(i.color("#808080"))):(this._widgets.okButton.setEnabled(!0),void this._widgets.okButton.setColor(i.color("#FFFFFF")))}.bind(this),this._pulldowns[a].onChange(this._pulldownEventListeners[a])}.bind(this))},_createBurstTimePullDown:function(e,i,o){var r=t.map(i,function(e){var t={value:e.type,text:e.type.toString()+":00"};return t.value===o&&(t.selected=!0),t});return new n.Pulldown({button:e.seekWidgetByName("btn_pulldown_bursttime"),label:e.seekWidgetByName("bursttime_label"),menuBase:e,choice:ccs.load(a["core-sort-sort_list_ui"]).node},r)},_updateBurstTime:function(){this._khBurstTime.update().then(this._onUpdateSuccess.bind(this),this._onUpdateFail.bind(this))},_onUpdateSuccess:function(e){this._popup.dismiss(),(i.director.getRunningScene(),n.createInstance("popupFactoryGud001BurstTimeResult").create({})).open()},_onUpdateFail:function(e){this._popup.dismiss(),i.director.getRunningScene()._openMessagePopup({title:"",content:"",buttons:[["blueBtn","OK",!0]]}).then(this._goToMyPage.bind(this))},_goToMyPage:function(){n.createInstance("router").navigate("mypage")},create:function(e,i){return n.PopupFactoryPopupCommon.prototype.create.call(this,t.assign(e,this.POPUP_PROPERTIES),i)},_addMethodsToPopup:function(e){this.POPUP_METHODS.updateBurstTime=this._updateBurstTime.bind(this),n.PopupFactoryPopupCommon.prototype._addMethodsToPopup.call(this,e),t.assign(e,this.POPUP_METHODS)}})}((this||0).self||global),function(e){var t=e._,n=e.kh;n.PopupFactoryGud001BurstTimeResult=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-gud_001_bursttime_result",title:"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){this.dismiss()}}},POPUP_METHODS:{},_khBurstTime:null,onPopupOpened:function(e,t){this._khBurstTime=n.createInstance("burstTime");var i=e.seekWidgetByName("bursttime_period_label_0"),a=e.seekWidgetByName("bursttime_period_label_1");i.setString(this._getReservedBurstTimeText(0)),a.setString(this._getReservedBurstTimeText(1))},_getReservedBurstTimeText:function(e){var n=this._khBurstTime.getReservedBurstTimeInfo(e);if(n&&t.isNumber(n.type))var i=n.description;else i=this._khBurstTime.getSelectedBurstTimeInfo(e).description;return""+(e+1).toString()+""+i},create:function(e,i){return n.PopupFactoryPopupCommon.prototype.create.call(this,t.assign(e,this.POPUP_PROPERTIES),i)},_addMethodsToPopup:function(e){n.PopupFactoryPopupCommon.prototype._addMethodsToPopup.call(this,e),t.assign(e,this.POPUP_METHODS)}})}((this||0).self||global),function(e){var t=e._,n=e.kh;n.PopupFactoryGudGemAmount=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-gud_gem_amount",title:n.w("gem")+"",buttonLabels:{blackBtn:"",blueBtn:""},buttons:{}},POPUP_METHODS:{cleanup:function(){null!=this.editBox&&(this.editBox.cleanup(),this.editBox=null),n.Popup.prototype.cleanup.apply(this,arguments)},dismiss:function(){null!=this.editBox&&(n.EditBox.prototype.cleanup.apply(this.editBox),this.editBox=null),n.Popup.prototype.dismiss.apply(this)}},create:function(e,i){return n.PopupFactory.prototype.create.call(this,t.assign(e,this.POPUP_PROPERTIES),i)},_addMethodsToPopup:function(e){n.PopupFactoryPopupCommon.prototype._addMethodsToPopup.call(this,e),t.assign(e,this.POPUP_METHODS)}})}((this||0).self||global),function(e){var t=e._,n=e.kh;n.PopupFactoryGud002Detail=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-gud_002_detail",title:"",buttonLabels:{blackBtn:""},buttons:{blackBtn:function(e){console.log("Blk btn clicked"),this.dismiss()}}},POPUP_METHODS:{setEffects:function(e){for(var t,n=e.detail_info.effects,i=0;i<5&&(t=this.seekWidgetByName("learn_effect_label_"+i));i++)if(n.length>i){var a=n[i];t.setString("Lv"+a.level+""+(a.is_acquired?"":"")+"\n"+a.description),t.setTextColor(a.is_acquired?cc.color("#ffE000"):cc.color("#dddddd")),t.enableOutline(cc.color("#444444"),2)}else t.setString("")}},create:function(e,i){return n.PopupFactory.prototype.create.call(this,t.assign(e,this.POPUP_PROPERTIES),i)},_addMethodsToPopup:function(e){n.PopupFactoryPopupCommon.prototype._addMethodsToPopup.call(this,e),t.assign(e,this.POPUP_METHODS)}})}((this||0).self||global),function(e){var t=e._,n=e.kh;n.PopupFactoryGudGuardianDetail=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-gud_guardian_detail_nomoney",title:"{{}}",buttonLabels:{blackBtn:""},buttons:{blackBtn:function(e){console.log("Blk btn clicked"),this.dismiss()}}},POPUP_METHODS:{},create:function(e,i){return n.PopupFactory.prototype.create.call(this,t.assign(e,this.POPUP_PROPERTIES),i)},_addMethodsToPopup:function(e){n.PopupFactoryPopupCommon.prototype._addMethodsToPopup.call(this,e),t.assign(e,this.POPUP_METHODS)}})}((this||0).self||global),function(e){var t=e._,n=e.kh;n.PopupFactoryGudGuardianDetailB=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-gud_guardian_detail_b",title:"{{}}",buttonLabels:{blackBtn:""},buttons:{blackBtn:function(e){this.dismiss()}}},POPUP_METHODS:{},create:function(e,i){return n.PopupFactory.prototype.create.call(this,t.assign(e,this.POPUP_PROPERTIES),i)},_addMethodsToPopup:function(e){n.PopupFactoryPopupCommon.prototype._addMethodsToPopup.call(this,e),t.assign(e,this.POPUP_METHODS)}})}((this||0).self||global),function(e){var t=e._,n=e.kh,i=e.cc;e.ccui,n.PopupFactoryComRoleChange=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-gud_auth_change",title:"",buttonLabels:{blackBtn:"",blueBtn:"OK"},buttons:{blackBtn:function(e){this.dismiss()},blueBtn:function(e){this.dismiss()}}},POPUP_METHODS:{},onPopupOpened:function(e,a){this._popup=e,this._record=a.record,n.setTouchEventHandlers(e,{"TOUCH_ENDED blue_btn":function(){var e=i.director.getRunningScene(),n=e._delegate||e;t.isFunction(n._changeRole)&&n._changeRole(this._record,this._pulldown.selected.value),this._popup.dismiss()}},this),this._loadContent()},_loadContent:function(){this._initPulldown(),this._initLabels()},_initPulldown:function(){var e=JSON.parse(JSON.stringify(n.WordBook.UNION_ROLE_LIST)),t=this._popup;this._pulldown=new n.Pulldown({button:t.seekWidgetByName("btn_pulldown"),label:t.seekWidgetByName("pulldown_label"),menuBase:t.seekWidgetByName("gud_auth_change_sort"),choice:ccs.load(res["core-popup-gud_sh_sort_list_ui"]).node},e)},_initLabels:function(){var e=n.w("unionRoles");console.log(e[this._record.union_position]),this._popup.seekWidgetByName("top_label").setString(this._record.name+""),this._popup.seekWidgetByName("position_label").setString(e[this._record.union_position]),this._popup.seekWidgetByName("by_label").setString("")}})}((this||0).self||global),function(e){var t=e._,n=e.kh;n.PopupFactoryGudGuardianBuy=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-gud_guardian_change_buy",title:"{{}}"},POPUP_METHODS:{},create:function(e,i){return n.PopupFactory.prototype.create.call(this,t.assign(e,this.POPUP_PROPERTIES),i)},_addMethodsToPopup:function(e){n.PopupFactoryPopupCommon.prototype._addMethodsToPopup.call(this,e),t.assign(e,this.POPUP_METHODS)}})}((this||0).self||global),function(e){var t=e._,n=e.kh;n.PopupFactoryGudGuardianChange=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-gud_guardian_change_buy",title:"{{}}"},POPUP_METHODS:{},create:function(e,i){return n.PopupFactory.prototype.create.call(this,t.assign(e,this.POPUP_PROPERTIES),i)},_addMethodsToPopup:function(e){n.PopupFactoryPopupCommon.prototype._addMethodsToPopup.call(this,e),t.assign(e,this.POPUP_METHODS)}})}((this||0).self||global),function(e){var t=e._,n=e.kh;n.PopupFactoryGudGuardianNomoney=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-gud_guardian_detail_nomoney",title:"{{}}",buttonLabels:{blackBtn:""},buttons:{blackBtn:function(e){this.dismiss()}}},POPUP_METHODS:{},create:function(e,i){return n.PopupFactory.prototype.create.call(this,t.assign(e,this.POPUP_PROPERTIES),i)},_addMethodsToPopup:function(e){n.PopupFactoryPopupCommon.prototype._addMethodsToPopup.call(this,e),t.assign(e,this.POPUP_METHODS)}})}((this||0).self||global),function(e){var t=e._,n=e.kh;n.PopupFactoryGudGuardianResult=n.PopupFactoryTextOnly.extend({POPUP_PROPERTIES:{resourceName:"core-popup-text_button_only",title:"",buttonLabels:{blueBtn:""},buttons:{blueBtn:function(e){this.dismiss()}}},POPUP_METHODS:{},create:function(e,i){return n.PopupFactory.prototype.create.call(this,t.assign(e,this.POPUP_PROPERTIES),i)},_addMethodsToPopup:function(e){n.PopupFactoryTextOnly.prototype._addMethodsToPopup.call(this,e),t.assign(e,this.POPUP_METHODS)}})}((this||0).self||global),function(e){var t=e._,n=e.kh;n.PopupFactoryGudChangeResult=n.PopupFactoryTextOnly.extend({POPUP_PROPERTIES:{resourceName:"core-popup-text_button_only",title:"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){this.dismiss()}}},POPUP_METHODS:{},create:function(e,i){return n.PopupFactory.prototype.create.call(this,t.assign(e,this.POPUP_PROPERTIES),i)},_addMethodsToPopup:function(e){n.PopupFactoryTextOnly.prototype._addMethodsToPopup.call(this,e),t.assign(e,this.POPUP_METHODS)}})}((this||0).self||global),function(e){var t=e._,n=e.kh,i=e.cc;e.ccui,n.PopupFactoryComMemberFire=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-gud_013_fire_top_change_end",title:"",buttonLabels:{blackBtn:"",blueBtn:"OK"},buttons:{blackBtn:function(e){this.dismiss()},blueBtn:function(e){}}},POPUP_METHODS:{},onPopupOpened:function(e,t){console.log(t),n.setTouchEventHandlers(e,{"TOUCH_ENDED blue_btn":function(){this._clickBlueButton(e,t.record)}},this),this._loadContent(e,t.record)},_loadContent:function(e,t){var i=e.seekWidgetByName("corecard_job_ui");n.createInstance("CoreCardJobUI",[null,i]).setImg(t.job_id,0),e.setStrings({username_label:t.name+" Rank"+t.rank}),e.setHtmlStrings({confirm_labelimg:"<span class='red'></span>"},n.GameConfig.POPUP_CSS),this._initializedPopup=!0},_clickBlueButton:function(e,n){var a=i.director.getRunningScene(),o=a._delegate||a;t.isFunction(o._confirmFireMember)&&o._confirmFireMember.apply(o,[n]),e.dismiss()}})}((this||0).self||global),function(e){var t=e._,n=e.kh,i=e.cc;e.ccui,n.PopupFactoryComLeaderChange=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-gud_013_fire_top_change_end",title:"",buttonLabels:{blackBtn:"",blueBtn:"OK"},buttons:{blackBtn:function(e){this.dismiss()},blueBtn:function(e){}}},POPUP_METHODS:{},onPopupOpened:function(e,t){n.setTouchEventHandlers(e,{"TOUCH_ENDED blue_btn":function(){this._clickBlueButton(e,t.record)}},this),this._loadContent(e,t.record)},_loadContent:function(e,t){var i=e.seekWidgetByName("corecard_job_ui"),a=i.getUserData();a instanceof n.CoreCardUI||((a=n.createInstance("CoreCardJobUI",["plain"])).setImg(t.job_id,0),i.addChild(a.getResult()),i.setUserData(a)),e.setStrings({username_label:t.name+" Rank"+t.rank}),e.setHtmlStrings({confirm_labelimg:"<br /><span class='red'>"+n.w("unionMember")+"</span>"},n.GameConfig.POPUP_CSS),this._initializedPopup=!0},_clickBlueButton:function(e,n){var a=i.director.getRunningScene(),o=(a._delegate||a)._changeLeader;t.isFunction(o)&&o(n),e.dismiss()}})}((this||0).self||global),function(e){var t=e._,n=e.kh;e.cc,e.ccui,n.PopupFactoryComLeaderChangeDone=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-gud_013_fire_top_change_end",title:"",buttonLabels:{blueBtn:""},buttons:{blueBtn:function(e){this.dismiss(),t.isFunction(e.gotoGuildTop)?e.gotoGuildTop():n.createInstance("unionRouter").navigateToTopScene("me")}}},POPUP_METHODS:{},onPopupOpened:function(e,t){this._loadContent(e,t.record)},_loadContent:function(e,t){var i=e.seekWidgetByName("corecard_job_ui"),a=n.createInstance("CoreCardJobUI",["plain",i]);if(a.setImg(t.job_id,0),0===i.getChildren().length){var o=a.getResult();i.addChild(o)}e.setStrings({username_label:t.name+" Rank"+t.rank}),e.setHtmlStrings({confirm_labelimg:""},n.GameConfig.POPUP_CSS),this._initializedPopup=!0}})}((this||0).self||global),function(e){var t=e._,n=e.kh;n.PopupFactoryComEditNocom=n.PopupFactoryTextOnly.extend({POPUP_PROPERTIES:{title:"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(){this.dismiss()}}},onPopupOpened:function(e,t){t.openedByGudGemAmount?(e.setTitle(""),e.setContent('<div style="text-align: center"><span class="red"></span></div>')):e.setContent('<div style="text-align: center"><span class="red"></span></div>')},create:function(e,i){return n.PopupFactory.prototype.create.call(this,t.assign(e,this.POPUP_PROPERTIES),i)},_addMethodsToPopup:function(e){n.PopupFactoryTextOnly.prototype._addMethodsToPopup.call(this,e),t.assign(e,this.POPUP_METHODS)}})}((this||0).self||global),function(e){var t=e._,n=e.kh;n.PopupFactoryGudMyStatus=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-gud_mystatus",title:"",buttonLabels:{blackBtn:""},buttons:{blackBtn:function(){this.dismiss()}}},POPUP_METHODS:{},onPopupOpened:function(e){e._data={};var i=[{api:"apiAUnions",args:["me"],method:"getMember",callback:function(e){this._data.member=e}.bind(e)},{api:"apiAUnions",method:"getDonationInfo",callback:function(e){this._data.donate=e}.bind(e)}],a=[];t.each(i,function(e,t){var i,o=n.createInstance(e.api),r=e.args||[];i=o[e.method].apply(o,r).then(function(t){e.callback.call(this,t.body)}.bind(this)).fail(function(e){console.error(e.stack)}),a.push(i)},this),Q.all(a).done(this._onCallApisFinished.bind(e))},_onCallApisFinished:function(){var e=this._data.donate,t=this._data.member,i=n.w("unionRoles")[t.union_position],a=n.htmlBuilder.makeDivAndSpans([[["white",":"],["yellow",i]],[["white",":"],["yellow",e.my_data.total_donation_amount+n.w("gem")]]]);this.setHtmlStrings({gud_status_label:a},n.GameConfig.POPUP_CSS),this.seekWidgetByName("name_label").setString(""+t.name+"")},create:function(e,i){return n.PopupFactory.prototype.create.call(this,t.assign(e,this.POPUP_PROPERTIES),i)},_addMethodsToPopup:function(e){n.PopupFactoryPopupCommon.prototype._addMethodsToPopup.call(this,e),t.assign(e,this.POPUP_METHODS)}})}((this||0).self||global),function(e){var t=e._,n=e.kh;n.PopupFactoryGudRequestEnd=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-gud_request_end",title:"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(){this.dismiss()}}},onPopupOpened:function(e,t){var i={condition1:n.w("filterUnionRanks")[t.conditionRank||"non-specified"],condition2:n.w("filterUnionPlaystyles")[t.conditionPlaystyle||"non-specified"]};e.setStrings({condition_detail_label:"{{condition1}}\n{{condition2}}".replace(/{{([^\}]+?)}}/g,function(e,t){return i[t]})})},create:function(e,i){return n.PopupFactory.prototype.create.call(this,t.assign(e,this.POPUP_PROPERTIES),i)},_addMethodsToPopup:function(e){n.PopupFactoryPopupCommon.prototype._addMethodsToPopup.call(this,e),t.assign(e,this.POPUP_METHODS)}})}((this||0).self||global),function(e){var t=(e._,e.cc,e.kh);t.PopupFactoryGudRequestDelete=t.PopupFactoryTextOnly.extend({POPUP_PROPERTIES:{title:"",content:"",buttonLabels:{blackBtn:"",redBtn:""},buttons:{blackBtn:function(){this.dismiss()},redBtn:function(){t.createInstance("apiAUnionJoinConditions").delete(this.conditionId).then(function(t){t.body.result?this.caller&&this.caller.dismiss():e.console.debug(""),this.dismiss()}.bind(this))}}},onPopupOpened:function(e,t){e.conditionId=t.conditionId,e.caller=t.callerPopup}})}((this||0).self||global),function(e){var t=e._,n=e.kh;n.PopupFactoryGudNameCha=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-gud_name_cha",title:"",buttonLabels:{blueBtn:"",blackBtn:""},buttons:{blueBtn:function(){var e=this.inputNode.getText();return e.length<1?void n.createInstance("popupFactoryComEditNocom").create({}).open({}):void n.createInstance("apiAUnions").changeUnionName(e,this.nameTextId).then(function(){this.dismiss(),n.createInstance("popupFactoryGudNameEnd").create({}).open({});var t=cc.director.getRunningScene(),i=t._delegate||t;i.updateUnionName.apply(i,[e])}.bind(this))},blackBtn:function(){this.dismiss()}}},POPUP_METHODS:{},onPopupOpened:function(e,t){e.seekWidgetByName("union_name_label").setString("\n["+t.name+"]"),e.nameTextId=t.nameTextId,e.inputNode=n.EditBox.createEditBox(e.contentNode,"comment_base","editbox_0",10,"",{fontSize:24,textAlign:"center"}),e.inputNode.setOnEditBoxReturnCallback(this.POPUP_PROPERTIES.buttons.blueBtn,e)},create:function(e,i){return n.PopupFactory.prototype.create.call(this,t.assign(e,this.POPUP_PROPERTIES),i)},_addMethodsToPopup:function(e){n.PopupFactoryPopupCommon.prototype._addMethodsToPopup.call(this,e),t.assign(e,this.POPUP_METHODS)}})}((this||0).self||global),function(e){var t=(e._,e.kh),n=e.cc;t.PopupFactoryGudNameEnd=n.Class.extend({create:function(){return t.createInstance("popupFactoryTextOnly").create({title:"",content:"",buttonLabels:{blueBtn:""},buttons:{blueBtn:function(){this.dismiss()}}})}})}((this||0).self||global),function(e){var t=e._,n=e.kh;n.PopupFactoryGudGemCheck=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-gud_gem_check",title:"",buttonLabels:{blueBtn:"OK",blackBtn:""},buttons:{blueBtn:function(){n.createInstance("apiAUnions").donation(this.value).then(function(e){var t=e.body.rank_up_info,i=e.body.total_donation_info;t.before_rank<t.after_rank?n.createInstance("popupFactoryGudGemRankup").create({}).open({rank:{before:t.before_rank,after:t.after_rank},donationAmount:{before:i.before_amount,after:i.after_amount},memberLimit:{before:t.member_max_num_info.before_num,after:t.member_max_num_info.after_num}}):n.createInstance("popupFactoryGudGemResult").create({}).open({donationAmount:{before:i.before_amount,after:i.after_amount}})}).fail(function(t){e.console.error(t)}),this.dismiss()},blackBtn:function(){this.dismiss()}}},POPUP_METHODS:{},onPopupOpened:function(e,t){var i={};e.value=i.value=t.value,i.before=t.amount,i.after=i.before+i.value,i.gem=n.w("gem"),e.setHtmlStrings({donation_num_check_label:'<span class="red">{{value}}{{gem}}</span><br /> '.replace(/{{([^\}]+?)}}/g,function(e,t){return i[t]}),donation_numtotal_labelimg:'<span class="white"><br />{{before}}&rarr;<span class="yellow">{{after}}</span>'.replace(/{{([^\}]+?)}}/g,function(e,t){return i[t]})},n.GameConfig.POPUP_CSS)},create:function(e,i){return n.PopupFactory.prototype.create.call(this,t.assign(e,this.POPUP_PROPERTIES),i)},_addMethodsToPopup:function(e){n.PopupFactoryPopupCommon.prototype._addMethodsToPopup.call(this,e),t.assign(e,this.POPUP_METHODS)}})}((this||0).self||global),function(e){var t=e._,n=e.kh;n.PopupFactoryGudGemRankup=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-gud_gem_rankup",title:"",buttonLabels:{blueBtn:""},buttons:{blueBtn:function(){this.dismiss(),cc.director.getRunningScene().headerDelegate.updateCurrency(),n.createInstance("sceneManager").reloadScene()}}},POPUP_METHODS:{},onPopupOpened:function(e,i){console.debug(i);var a=t.clone(i.donationAmount);a.gem=n.w("gem");var o={rankup_imglabel:'<span class="blue">Rank<br /><span class="white">{{before}}&rarr;</span><span class="yellow">{{after}}</span>'.replace(/{{([^\}]+?)}}/g,function(e,t){return i.rank[t]}),donation_numtotal_labelimg:'<span class="blue"><br /><span class="white">{{before}}&rarr;</span><span class="yellow">{{after}}</span>'.replace(/{{([^\}]+?)}}/g,function(e,t){return a[t]})},r=i.memberLimit;r.before<r.after?o.member_limit_labelimg='<span class="blue"><br /><span class="white">{{before}}&rarr;</span><span class="yellow">{{after}}</span>'.replace(/{{([^\}]+?)}}/g,function(e,t){return r[t]}):o.member_limit_labelimg='<span class="blue"><br /><span class="white">{{before}}</span>'.replace(/{{([^\}]+?)}}/g,function(e,t){return r[t]}),e.setHtmlStrings(o,n.GameConfig.POPUP_CSS)},create:function(e,i){return n.PopupFactory.prototype.create.call(this,t.assign(e,this.POPUP_PROPERTIES),i)},_addMethodsToPopup:function(e){n.PopupFactoryPopupCommon.prototype._addMethodsToPopup.call(this,e),t.assign(e,this.POPUP_METHODS)}})}((this||0).self||global),function(e){var t=e._,n=e.kh;n.PopupFactoryGudGemResult=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-gud_gem_result",title:"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(){this.dismiss(),cc.director.getRunningScene().headerDelegate.updateCurrency(),n.createInstance("sceneManager").reloadScene()}}},POPUP_METHODS:{},onPopupOpened:function(e,i){var a=t.clone(i.donationAmount);a.gem=n.w("gem"),e.setHtmlStrings({donation_num_labelimg:'<span class="white"><br /> {{before}}&rarr;</span><spna class="yellow">{{after}}</span> '.replace(/{{([^\}]+?)}}/g,function(e,t){return a[t]})},n.GameConfig.POPUP_CSS)},create:function(e,i){return n.PopupFactory.prototype.create.call(this,t.assign(e,this.POPUP_PROPERTIES),i)},_addMethodsToPopup:function(e){n.PopupFactoryPopupCommon.prototype._addMethodsToPopup.call(this,e),t.assign(e,this.POPUP_METHODS)}})}((this||0).self||global),function(e){var t=(e.cc,e._),n=e.kh;n.createNameSpaceIfNotExists("guild.popup"),n.guild.popup.comEnhGuardian=n.core.item.comConsumptionCheckResult.extend({BUTTON_VISIBLE:{btn_enhance:!0,btn_sell:!1,btn_ok:!1,btn_cancel:!0},USE_SET_CORECARD_METHOD:"_setWeaponCoreCardElementRarity",TITLE_LABEL:"",CONFIRM_MESSAGE_NORMAL:"\n",CONFIRM_MESSAGE_INCLUDE_RARE:"R\n",_earnNum:null,_hasNum:null,__initContents:function(e){this._hasNum=e.guardianPt,this._earnNum=t.reduce(e.materials,function(e,t,n){return{guardian_custom_pt:e.guardian_custom_pt+t.guardian_custom_pt}}).guardian_custom_pt},_createConfirmLabel:function(e){return this._isIncludedMoreThanRare(e)?this.CONFIRM_MESSAGE_INCLUDE_RARE:this.CONFIRM_MESSAGE_NORMAL},_setBottomLabel:function(){this.getNode().setStrings({get_jem_custom_point_label:this.createGetJemCustomePointLabel(),have_jem_custom_point_label:this.createHaveJemCustomPointLabel()}),this.getNode().setHtmlStrings({get_jem_custom_point_labelimg:this.createGetJemCustomPointLabelImg(),have_jem_custom_point_labelimg:this.createHaveJemCustomPointLabelImg()},n.GameConfig.POPUP_CSS)},createGetJemCustomePointLabel:function(){return"Pt"},createHaveJemCustomPointLabel:function(){return"Pt"},createGetJemCustomPointLabelImg:function(){return this.LABEL_SIMPLE_BODY_TEMPLATE({color:"white",text:this._earnNum})},createHaveJemCustomPointLabelImg:function(){return this.LABEL_FLUCTUATE_BODY_TEMPLATE({before_text:this._hasNum,after_text:this._hasNum+this._earnNum,after_number_color:"yellow"})}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc,e.ccui,e._);e.console,t.createNameSpaceIfNotExists("guild.popup"),t.guild.popup.GudSearchSetting=t.ImplantedPopup.extend({className:"GudSearchSetting",SEARCH_SETTING_UI_NODE_NAME:"gud_search_setting",NODE_NAMES:{CONDITIONS_BUTTON:"tab_conditions",NAME_ID_BUTTON:"tab_name_id",CONDITIONS_TAB_NODE:"tab_0_node",NAME_ID_TAB_NODE:"tab_1_node",PULLDOWN_RANK_BUTTON:"btn_pulldown_rank",PULLDOWN_PLAYSTYLE_BUTTON:"btn_pulldown_playstyle",PULLDOWN_AUTOJOIN_BUTTON:"btn_pulldown_autojoin",RANK_SORT_UI:"rank_sort_ui",PLAYSTYLE_SORT_UI:"playstyle_sort_ui",AUTOJOIN_SORT_UI:"autojoin_sort_ui",UNION_SEARCH_RANK:"sort_rank_label",UNION_SEARCH_PLAYSTYLE:"sort_playstyle_label",UNION_SEARCH_AUTOJOIN:"sort_autojoin_label",union_name:"name_search_window",union_id:"id_search_window"},TAB_CHANGE_BUTTON_NAMES:["CONDITIONS_BUTTON","NAME_ID_BUTTON"],TAB_NAMES:["CONDITIONS_TAB_NODE","NAME_ID_TAB_NODE"],PULLDOWN_BUTTON_NAMES:["PULLDOWN_RANK_BUTTON","PULLDOWN_PLAYSTYLE_BUTTON","PULLDOWN_AUTOJOIN_BUTTON"],PULLDOWN_NAMES:["RANK_SORT_UI","PLAYSTYLE_SORT_UI","AUTOJOIN_SORT_UI"],PULLDOWN_LABELS:["UNION_SEARCH_RANK","UNION_SEARCH_PLAYSTYLE","UNION_SEARCH_AUTOJOIN"],PULLDOWN_OPTIONS:["rank_type","playstyle_type","auto_join"],EDIT_SEARCH_BOXS:["union_name","union_id"],_nodes:{},_joinConditions:null,_unionInfo:null,_pulldown:[],_searchBox:[],_initContents:function(){null===this._joinConditions&&(this._joinConditions=t.createInstance("GuildSearchInfoDataModel").getJoinConditions()),null===this._unionInfo&&(this._unionInfo=t.createInstance("GuildSearchInfoDataModel").getUnionInfo()),Object.keys(this.NODE_NAMES).forEach(function(e){this._nodes[e]=this.getNode().seekWidgetByName(this.NODE_NAMES[e])},this);this.setButtonEvents({btn_ok:this.callbackBtnOk.bind(this),btn_cancel:this.callbackBtnCancel.bind(this),tab_conditions:this._tabChange.bind(this,0),tab_name_id:this._tabChange.bind(this,1)}),this._tabChange(0),this._initPulldown(0,function(e){this._joinConditions.rank_type=e.value}.bind(this)),this._initPulldown(1,function(e){this._joinConditions.playstyle_type=e.value}.bind(this)),this._initPulldown(2,function(e){this._joinConditions.auto_join=e.value}.bind(this)),this.getNode().scheduleOnce(this._tabChange.bind(this,0),.1)},callbackBtnOk:function(){this._unionInfo.union_name=this._getEditBoxText(0),this._unionInfo.union_id=this._getEditBoxText(1),t.createInstance("GuildSearchInfoDataModel").updateSearchInfo(this._joinConditions,this._unionInfo),this.dismiss()},callbackBtnCancel:function(){this._joinConditions=null,this._unionInfo=null,t.createInstance("GuildSearchInfoDataModel").cleaerSearchInfo(),this.dismiss()},_getEditBoxText:function(e){var t=this._searchBox&&this._searchBox[e];return t?t.getText():""},_initEditBox:function(e){n.isUndefined(this._searchBox[e])&&(this._searchBox[e]=t.EditBox.createEditBox(this.getNode(),this.NODE_NAMES[this.EDIT_SEARCH_BOXS[e]],"editbox_"+e,30,this._unionInfo[this.EDIT_SEARCH_BOXS[e]],{fontSize:22,internalName:null}))},_initPulldown:function(e,i){var a=this.PULLDOWN_BUTTON_NAMES[e],o=this.PULLDOWN_NAMES[e],r=this.PULLDOWN_LABELS[e],s=n.cloneDeep(t.WordBook[r]),c=this._joinConditions[this.PULLDOWN_OPTIONS[e]];n.isUndefined(c)||n.each(s,function(e){e.value===c?e.selected=!0:delete e.selected},this),(n.isUndefined(this._pulldown[e])||this._pulldown[e].selected.value!==c)&&(this._pulldown[e]=new t.Pulldown({button:this._nodes[a],label:this._nodes[r],menuBase:this._nodes[o],choice:ccs.load(res["core-sort-sort_list_ui_long"]).node,bottomMargin:0},s)),this._pulldown[e].onChange(i.bind(this)),this._pulldown[e].setTouchEnabled(!0)},_tabChange:function(e,t){var n=this._nodes,i=this.TAB_NAMES[e],a=this.TAB_CHANGE_BUTTON_NAMES[e];this.TAB_NAMES.forEach(function(e){n[e].setVisible(!1)},this),this.TAB_CHANGE_BUTTON_NAMES.forEach(function(e){n[e].setBright(!0)},this),n[i].setVisible(!0),n[a].setBright(!1),e>0&&(this._initEditBox(0),this._initEditBox(1))},clearPopup:function(){n.each(this._pulldown,function(e,t){n.isUndefined(e)||(e.releaseMenu(),delete this._pulldown[t])},this),n.each(this._searchBox,function(e,t){n.isUndefined(e)||(e.cleanup(),delete this._searchBox[t])},this)}})}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.guild=t.pc.guild||{},t.pc.guild.gud_000_a=t.pc.guild.gud_000_a||{},t.pc.guild.gud_000_a.Scene=t.BaseScene.extend({resourceFileName:"gud_000/gud_000_a.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"guild",sceneName:"gud_000_a",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_union_search","btnCallbackBtnUnionSearch",null,function(){alert("{{24gud_000_forbiddengud_001_bgud_000_b}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_union_form","btnCallbackBtnUnionForm",null,function(){alert("{{24gud_000_forbiddengud_000_attention}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc=t.pc||{},t.pc.guild=t.pc.guild||{},t.pc.guild.gud_000_a=t.pc.guild.gud_000_a||{},t.pc.guild.gud_000_a.SceneDelegate=t.pc.BaseSceneDelegate.extend({_popups:{popupAttention:{factoryName:"popupFactoryGud000Attention"},popupForbidden:{factoryName:"popupFactoryGud000Forbidden"}},onSceneInit:function(e){return a.defer(),this._setBackBtn(e),a.resolve()},onSceneEnter:function(e){return a.defer(),a.resolve()},onSceneExit:function(e){return a.defer(),a.resolve()},onPageInAnimationEnd:function(e){return(a.defer(),e.seekWidgetByName("btn_union_search")).setColor(n.color("#ffffff")),e.seekWidgetByName("btn_union_form").setColor(n.color("#ffffff")),a.resolve()},btnCallbackBtnUnionSearch:function(e){var t=a.defer();return t.reject(this._override),this._joinCheckAndGoSearchUnion(),t.promise},btnCallbackBtnUnionForm:function(e){var t=a.defer();return t.reject(this._override),this._joinCheckAndGoFormUnion(),t.promise},_touchEndedBackBtnProcess:function(e){this._navigateToMyPage()}}),i.assign(t.pc.guild.gud_000_a.SceneDelegate.prototype,t.pc.guild.roles.Routing,t.pc.guild.roles.GuildApiCache,t.pc.guild.roles.GuildJoinCheck)}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.guild=t.pc.guild||{},t.pc.guild.gud_000_b=t.pc.guild.gud_000_b||{},t.pc.guild.gud_000_b.Scene=t.BaseScene.extend({resourceFileName:"gud_000/gud_000_b.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"guild",sceneName:"gud_000_b",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_search","btnCallbackBtnSearch",null,function(){alert("{{}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_filter","btnCallbackBtnFilter",null,function(){alert("{{gud_search_setting}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc=t.pc||{},t.pc.guild=t.pc.guild||{},t.pc.guild.gud_000_b=t.pc.guild.gud_000_b||{},t.pc.guild.gud_000_b.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../gud_popup_ui.json"],_popups:{popupAttention:{factoryName:"popupFactoryGud000Attention"},popupForbidden:{factoryName:"popupFactoryGud000Forbidden"}},_searchCondition:null,_searchPopup:null,onSceneInit:function(e){return this._setBackBtn(e),this.__waitForNodesLoaded().then(function(){this._searchPopup=t.ImplantedPopup.create(e,"gud_search_setting","GudSearchSettingPopup")}.bind(this)),this._prepareList(e)},onSceneEnter:function(e){this._searchCondition=t.createInstance("GuildSearchInfoDataModel");var n=t.core.pager.model.ApiDataListFactory("apiAUnionSearch","get",this._searchCondition.getSearchApiParams());return n.initialize(),this._listModel=n,a.resolve()},onSceneExit:function(e){return this._controller&&this._controller.dispose(),this._searchPopup&&this._searchPopup.clearPopup(),a.resolve()},btnCallbackBtnSearch:function(e){return this._updateList(),a.reject(this._override)},btnCallbackBtnFilter:function(e){if(this._searchPopup)return this._searchPopup.open().fail(function(e){e instanceof Error&&console.error(e)}),a.reject(this._override)},pulldownCallbackSortUi0SortCon1:function(e){this._searchCondition.setSearchRankType(e.value)},pulldownChoiceCallbackSortUi0SortCon1:function(){return i.cloneDeep(t.WordBook.UNION_SEARCH_RANK)},pulldownCallbackSortUi1SortCon2:function(e){this._searchCondition.setSearchPlaystyleType(e.value)},pulldownChoiceCallbackSortUi1SortCon2:function(){return i.cloneDeep(t.WordBook.UNION_SEARCH_PLAYSTYLE)},_updateList:function(){this._controller&&(this._controller.getDataList().updateOption(this._searchCondition.getSearchApiParams()),this._controller.setCurrentPageNumber(1,!1))},_prepareList:function(e){var n=e.seekWidgetByName("window_gray"),i=n.seekWidgetByName("gud_unionlist_page_ui"),a=new t.core.pager.view.page.BasePageUiFactory(i,this.__setupListItemPanel.bind(this)),o=new t.core.pager.controller.PagerController(n,this._listModel,[a],i),r=n.seekWidgetByName("viewpage_ui");return new t.core.pager.view.button.ViewPageUi(r,o).initialize(),this._controller=o,this._listModel=null,o.initialize()},__setupListItemPanel:function(e,n){var a=n.getRawData(),o=a.guardian_info,r=t.Img("unionlist","guardian",i.padZero(o.guardian_id,4),0).png,s={union_name_label:a.name,union_menber_label:a.member_count+"",union_rank_no:a.rank,guardian_name_lv_label:this._toGuardianFullName(o)},c={"TOUCH_ENDED btn_join_request":this.__onJoinClicked.bind(this,a),"TOUCH_ENDED btn_join_auto":this.__onJoinClicked.bind(this,a),"TOUCH_ENDED btn_introduce_union":this.__onUnionImageClicked.bind(this,a)},u=e.seekWidgetByName("btn_join_request"),l=e.seekWidgetByName("btn_join_auto");u.setVisible(!0),l.setVisible(!1),a.auto_join===t.WordBook.UNION_SETTING_AUTOJOIN[1].value&&(u.setVisible(!1),l.setVisible(!0));var _=e.seekWidgetByName("unionlist_guardian");_.loadTexture(r),_.setStrings(s),t.setTouchEventHandlers(_,c,_),e.setVisible(!0)},__onUnionImageClicked:function(e){var t=n.director.getRunningScene(),i=this._getNavigateFrom(t,e);this._navigate000To001(t,i)},_getNavigateFrom:function(e,n){return{id:n.a_union_id,routes:t.createInstance("router").getCurrentFragment(),routerParams:e.routerParams,temporaryRouterParams:e.temporaryRouterParams}},__onJoinClicked:function(e){this._sendJoinRequest(e)},_touchEndedBackBtnProcess:function(e){this._navigateToMyPage()}}),i.assign(t.pc.guild.gud_000_b.SceneDelegate.prototype,t.pc.guild.roles.GuildCommon,t.pc.guild.roles.GuildJoinCheck,t.pc.guild.roles.Routing)}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.guild=t.pc.guild||{},t.pc.guild.gud_000_c=t.pc.guild.gud_000_c||{},t.pc.guild.gud_000_c.Scene=t.BaseScene.extend({resourceFileName:"gud_000/gud_000_c.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"guild",sceneName:"gud_000_c",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_union_form","btnCallbackBtnUnionForm",null,function(){alert("{{gud_000_namecheckcom_edit_nocom}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc=t.pc||{},t.pc.guild=t.pc.guild||{},t.pc.guild.gud_000_c=t.pc.guild.gud_000_c||{},t.pc.guild.gud_000_c.SceneDelegate=t.pc.BaseSceneDelegate.extend({_popups:{popupBlankName:{factoryName:"popupFactoryTextOnly",title:"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){this.dismiss(),e._delegate._nameEditBox.setVisible(!0)}}},popupConfirm:{factoryName:"popupFactoryTextOnly",title:"",buttonLabels:{blackBtn:"",blueBtn:""},buttons:{blackBtn:function(e){this.dismiss(),e._delegate._nameEditBox.setVisible(!0)},blueBtn:function(e){this.dismiss();var n=e._delegate._nameEditBox.getText();t.createInstance("apiAUnions").create(n).then(function(t){e._delegate._navigateTo0001ById("me")}.bind(this))}}}},onSceneInit:function(e){return a.defer(),this._setBackBtn(e),a.resolve()},onPageInAnimationEnd:function(e){return a.defer(),this._createEditbox(e),a.resolve()},btnCallbackBtnUnionForm:function(e){var t=a.defer();t.reject(this._override);var i,o,r=this._nameEditBox.getText();e=n.director.getRunningScene();return 0==r.length?(i=e.popups.popupBlankName,o='<div class="red"></div>'):(i=e.popups.popupConfirm,o="<div>"+r+"<br/></div>"),this._nameEditBox.setVisible(!1),i.open().then(function(){i.setContent(o)}),t.promise},_createEditbox:function(e){return i.isUndefined(this._nameEditBox)?(this._nameEditBox=t.EditBox.createEditBox(e.contentLayer,"text_window","editbox_0",10,"",{fontSize:22}),void this._nameEditBox.setOnEditBoxReturnCallback(this.btnCallbackBtnUnionForm.bind(this,e),this)):void this._nameEditBox.setText("")},_touchEndedBackBtnProcess:function(e){this._navigateToMyPage()}}),i.assign(t.pc.guild.gud_000_c.SceneDelegate.prototype,t.pc.guild.roles.Routing)}((this||0).self||global),function(e){var t=e.kh,n=e._;t.pc=t.pc||{};var i=(e.Q,{gud_001_edit:{factoryName:"popupFactoryPopupCommon",resourceName:function(){var e=n.findKey(res,function(e){return 0<e.indexOf("gud_001_edit.json")});return e||alert(": gud_001_edit.json"),e||""}(),title:"",buttonLabels:{blackBtn:"",blueBtn:"OK"},buttons:{blackBtn:function(){this.dismiss()},blueBtn:function(){alert("{{com_edit_nocom.gud_001_editgud_edit_result}}")}}},gud_gem_amount:{factoryName:"popupFactoryPopupCommon",resourceName:function(){var e=n.findKey(res,function(e){return 0<e.indexOf("gud_gem_amount.json")});return e||alert(": gud_gem_amount.json"),e||""}(),title:"",buttonLabels:{blackBtn:"",blueBtn:"OK"},buttons:{blackBtn:function(){this.dismiss()},blueBtn:function(){alert("{{com_edit_nocomgud_gem_amountgud_gem_check}}")}}}});t.pc.guild=t.pc.guild||{},t.pc.guild.gud_001=t.pc.guild.gud_001||{},t.pc.guild.gud_001.Scene=t.BaseScene.extend({resourceFileName:"gud_001/gud_001.json",isLoopDefaultView:!1,_popups:i,tabDelegateConfig:[],componentName:"guild",sceneName:"gud_001",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_all_over","btnCallbackBtnAllOver",null,function(){alert("{{all_over_ui}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("btn_burstinfo"),"btn_burstinfo","btnCallbackBtnBurstinfoBtnBurstinfo",null,function(){alert("{{sub_tutorial.json}}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_edit","btnCallbackBtnEdit",null,function(e){this.popups.gud_001_edit.open(e)}),this._initButtonEvent.call(this,this.seekWidgetByPath("gud_001_a_ui"),"btn_guardian","btnCallbackGud001AUiBtnGuardian",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"guild/gud_002")),this._initButtonEvent.call(this,this.seekWidgetByPath("gud_001_a_ui"),"btn_unionnews","btnCallbackGud001AUiBtnUnionnews",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"guild/gud_009")),this._initButtonEvent.call(this,this.seekWidgetByPath("gud_001_a_ui"),"btn_unionchat","btnCallbackGud001AUiBtnUnionchat",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"guild/gud_008")),this._initButtonEvent.call(this,this.seekWidgetByPath("gud_001_a_ui"),"btn_admin_union","btnCallbackGud001AUiBtnAdminUnion",null,function(){alert("{{gud_001_control.gud_001_uncontrol_a.gud_001_uncontrol_b}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("gud_001_a_ui"),"btn_donation","btnCallbackGud001AUiBtnDonation",null,function(e){this.popups.gud_gem_amount.open(e)}),this._initButtonEvent.call(this,this.seekWidgetByPath("gud_001_a_ui"),"btn_member","btnCallbackGud001AUiBtnMember",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"guild/gud_009")),this._initButtonEvent.call(this,this.seekWidgetByPath("gud_001_b_ui"),"btn_member","btnCallbackGud001BUiBtnMember",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"guild/gud_009")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_application","btnCallbackBtnApplication",null,function(){alert("{{}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_autojoin","btnCallbackBtnAutojoin",null,function(){alert("{{gud_000_attention}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("gud_001_c_ui"),"btn_refuse","btnCallbackGud001CUiBtnRefuse",null,function(){alert("{{my_001}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("gud_001_c_ui"),"btn_join","btnCallbackGud001CUiBtnJoin",null,function(){alert("{{24gud_000_forbiddengud_000_attention}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("gud_001_c_ui"),"btn_union_form","btnCallbackGud001CUiBtnUnionForm",null,function(){alert("{{24gud_000_forbiddengud_000_attention}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("gud_001_c_ui"),"btn_union_search","btnCallbackGud001CUiBtnUnionSearch",null,function(){alert("{{24gud_000_forbiddengud_000_b}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("gud_001_c_ui"),"btn_member","btnCallbackGud001CUiBtnMember",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"guild/gud_009")),this._initButtonEvent.call(this,this.seekWidgetByPath("gud_001_d_ui"),"btn_refuse","btnCallbackGud001DUiBtnRefuse",null,function(){alert("{{my_001,}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("gud_001_d_ui"),"btn_my_union","btnCallbackGud001DUiBtnMyUnion",null,function(){alert("{{gud_001gud_001_a}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("gud_001_d_ui"),"btn_member","btnCallbackGud001DUiBtnMember",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"guild/gud_009")),this._initMouseOver.call(this,this.seekWidgetByPath(""),"btn_guardian","btn_guardian_ui","mouse_over"),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc=t.pc||{},t.pc.guild=t.pc.guild||{},t.pc.guild.gud_001=t.pc.guild.gud_001||{},t.pc.guild.gud_001.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../gud_popup_ui.json"],_popups:{popupEditComment:{factoryName:"popupFactoryGud001Edit"},popupInputDonation:{factoryName:"popupFactoryGudGemAmount"},popupConfirmDonation:{factoryName:"popupFactoryGudGemCheck"},popupAdminConfig:{factoryName:"popupFactoryGud001Control"},popupNormalBurstTimeConfig:{factoryName:"popupFactoryGud001UncontrolBurstTime"},popupNormalConfig:{factoryName:"popupFactoryGud001Uncontrol"},popupAttention:{factoryName:"popupFactoryGud000Attention"},popupForbidden:{factoryName:"popupFactoryGud000Forbidden"}},onSceneInit:function(e){a.defer(),this._setBackBtn(e),this._verifyRouterParams001(e),this._data={};var n=e.temporaryRouterParams.id,o=["union_me","newInfo","donation"],r=["union","me","check"];i.isUndefined(n)||"me"===n?(this.isMe=!0,this._requestAll(o).then(function(t){this._onCallApisFinished(e)}.bind(this))):this._request(["me"]).then(function(t){this.isMe=t.a_union_id===n;var i=this.isMe?o:r;this._requestAll(i).then(function(t){this._onCallApisFinished(e)}.bind(this))}.bind(this));var s=t.createInstance("BurstTimeSubTutorialPanel");return s.show(n),s.showSubTutorialFirstAccess(),a.resolve()},onSceneEnter:function(e){return a.defer(),a.resolve()},onSceneExit:function(e){return a.defer(),a.resolve()},onPageInAnimationEnd:function(e){return a.defer(),a.resolve()},_isScoutReceived:function(){if(this.isMe)return!1;var e=this._data.check.scout_info;return!i.isUndefined(e)&&!i.isUndefined(e.a_scout_id)},_onCallApisFinished:function(e){if(i.isUndefined(this._data.union_me)||(this._data.union=this._data.union_me),this._setGuildStrings(e,this._data),this.__setBackgroundImage(e),e.seekWidgetByName("union_id_no").setText(this._data.union.a_union_id),this.isMe)return this.__setupMyUnionInfo(e);var t,n=this._data.me.a_union_id;t=this._isScoutReceived()?n?"d":"c":"b",this.__setupOutsideUnionInfo(e,t)},__setupMyUnionInfo:function(e){var t=(this.__loadUI("a"),this._data.newInfo);this.__setNewIconVisible(e,"btn_unionnews",t.unchecked_news),this.__setNewIconVisible(e,"btn_unionchat",t.is_new_chat),this.__setCommentEditBox(e)},__setCommentEditBox:function(e){var t=(this._getUnionData(),e.seekWidgetByName("gud_comment_ui")),n=t.seekWidgetByName("btn_edit"),i=this._amILeader();n.setVisible(i),n.setEnabled(i),i?t.changeFrameWithAnimInfo("leader","end"):t.changeFrameWithAnimInfo("not_leader","end")},__setNewIconVisible:function(e,t,n){e.seekWidgetByName(t).seekWidgetByName("new_icon").setVisible(n)},__setBackgroundImage:function(e){var t=this._getUnionData().guardian_info;this._setIntroduceGuardianImage(t)},__setScountedNoticeLabel:function(e){var n=this._getUnionData();e.seekWidgetByName("union_name_scout_label").setString(""+n.name+""+(t.env.isSp?"":"\n")+"")},__setupOutsideUnionInfo:function(e,n){var a=this.__loadUI(n),o=this._getUnionData();this._setGuildStrings(e,o),this._isScoutReceived()&&this.__setScountedNoticeLabel(a);var r=e.seekWidgetByName("btn_application");if(null!==r){var s=e.seekWidgetByName("btn_autojoin");r.setVisible(!1),s.setVisible(!1),this._request("joinRequests").then(function(e){var n=e.data,a=this._getUnionData();return i.isUndefined(n)||0===n.length||n[0].union.a_union_id!=a.a_union_id?s&&a.auto_join===t.WordBook.UNION_SETTING_AUTOJOIN[1].value?void s.setVisible(!0):(r.setTitleText(""),void r.setVisible(!0)):(r.setTitleText(""),void r.setVisible(!0))}.bind(this))}},btnCallbackBtnAllOver:function(e){var t=a.defer();t.reject(this._override);var n=this._getUnionData();return this._openAllOverPanel(n.guardian_info.guardian_id,0,"guardian"),t.promise},btnCallbackBtnEdit:function(e){var t=a.defer();return t.reject(this._override),this._editComment(),t.promise},btnCallbackGud001AUiBtnGuardian:function(e){var t=a.defer();return t.resolve(),t.promise},btnCallbackGud001AUiBtnUnionnews:function(e){var t=a.defer();return t.resolve(),t.promise},btnCallbackGud001AUiBtnUnionchat:function(e){var t=a.defer();return t.resolve(),t.promise},btnCallbackGud001AUiBtnAdminUnion:function(e){var t=a.defer();t.reject(this._override);var n=this._getUnionData(),i="popupNormalConfig";return this._amILeader()?i="popupAdminConfig":this._amISubLeader()&&(i="popupNormalBurstTimeConfig"),e.popups[i].open({scene:e,data:n}),t.promise},btnCallbackGud001AUiBtnDonation:function(e){var t=a.defer();return t.reject(this._override),this._openDonationForm(),t.promise},btnCallbackGud001AUiBtnMember:function(e){var t=a.defer();t.reject(this._override);var n=this._getNavigateFrom(e);return this._navigate001aTo007(e,this._amILeader()||this._amISubLeader(),n),t.promise},btnCallbackGud001BUiBtnMember:function(e){var t=a.defer();t.reject(this._override);var n=this._getNavigateFrom(e);return this._navigate001To007(e,n),t.promise},btnCallbackBtnApplication:function(e){var t=a.defer();t.reject(this._override);var n=this._data.union;return this._request("joinRequests").then(function(e){var t=e.data;i.isUndefined(t)||0===t.length||t[0].union.a_union_id!=n.a_union_id?this._sendJoinRequest(n,this.__reload):this._deleteJoinRequest(n,this.__reload)}.bind(this)),t.promise},btnCallbackBtnAutojoin:function(e){var t=a.defer();t.reject(this._override);var n=this._data.union;return this._request("joinRequests").then(function(e){this._sendJoinRequest(n,this.__reload)}.bind(this)),t.promise},btnCallbackGud001CUiBtnRefuse:function(e){var t=a.defer();return t.reject(this._override),this._rejectScout(),t.promise},btnCallbackGud001CUiBtnJoin:function(e){var t=a.defer();return t.reject(this._override),this._acceptScout(),t.promise},btnCallbackGud001CUiBtnUnionForm:function(e){var t=a.defer();return t.reject(this._override),this._joinCheckAndGoFormUnion(),t.promise},btnCallbackGud001CUiBtnUnionSearch:function(e){var t=a.defer();return t.reject(this._override),this._joinCheckAndGoSearchUnion(!0),t.promise},btnCallbackGud001CUiBtnMember:function(e){var t=a.defer();t.reject(this._override);var n=this._getNavigateFrom(e);return this._navigate001To007(e,n),t.promise},btnCallbackGud001DUiBtnRefuse:function(e){var t=a.defer();return t.reject(this._override),this._rejectScout(),t.promise},btnCallbackGud001DUiBtnMyUnion:function(e){var t=a.defer();t.reject(this._override);e=n.director.getRunningScene();return this._navigate001To001a(e),t.promise},btnCallbackGud001DUiBtnMember:function(e){var t=a.defer();t.reject(this._override);var n=this._getNavigateFrom(e);return this._navigate001To007(e,n),t.promise},btnCallbackBtnBurstinfoBtnBurstinfo:function(e){var t=a.defer();return t.reject(this._override),t.promise},__loadUI:function(e){var a=n.director.getRunningScene();if(i.contains(["a","b","c","d"],e)){var o=a.seekWidgetByName("gud_001_"+e+"_ui");return null===o?(console.warn("[ERROR] Could not find gud node."),null):(t.env.isSp&&("c"===e||"d"===e?a.animate("gud_001_c_d"):a.animate("default_view")),o.setVisible(!0),o)}console.warn("Invalid node type: "+e)},updateUnionName:function(e){this._getUnionData().name=e,n.director.getRunningScene().seekWidgetByName("union_name_label").setString(e)},__reload:function(){t.createInstance("sceneManager").reloadScene()},_rejectScout:function(){try{var e=t.createInstance("apiAUnionScouts"),i=this._data.union.a_union_id;e.cancel(i,"me","refuse").then(function(e){console.log(""),console.log(e.body);var t=n.director.getRunningScene();this._navigate001ToMyPage(t)}.bind(this))}catch(e){console.error(e)}},_acceptScout:function(){var e=this._data.union.a_union_id;this._checkBeforeJoinRequest(e).then(function(){t.createInstance("apiAUnions").acceptScout(e).then(function(e){console.debug("",e.body),this._navigateTo0001ById("me")}.bind(this))}.bind(this))},_editComment:function(){var e=n.director.getRunningScene(),i=e.popups.popupEditComment;i.openWithActions(function(){var e=this._data.union.comment;i.editBox=t.EditBox.createEditBox(i,"comment_base","editbox_0",40,e,{fontSize:22}),i.editBox.setOnEditBoxReturnCallback(i.blueBtn.extractCurrentTouchEvent().emulateTouchEnded,this)}.bind(this),{blackBtn:!1,blueBtn:function(){var n=i.editBox.getText();0==n.length?e._openMessagePopup({title:"",content:'<div class="red"></div>',buttons:[["blueBtn","OK"]]}):(i.dismiss(),t.createInstance("apiAUnions").changeUnionComment(n).then(function(t){this._updateUnionData(t.body),e._openMessagePopup({title:"",content:"<div></div>",buttons:[["blueBtn","OK",!0]]}).then(function(){this._setGuildStrings(e,this._data)}.bind(this))}.bind(this)))}.bind(this)}).then(function(e){console.log("Resoloved:"+e)},function(e){console.log("Rejected:"+e)})},_openDonationForm:function(){var e=n.director.getRunningScene(),i=e.popups.popupInputDonation;this._data.union,i.openWithActions(function(){i.editBox=t.EditBox.createEditBox(i,"comment_base","editbox_0",9,"",{fontSize:22}),i.editBox.setOnEditBoxReturnCallback(i.blueBtn.extractCurrentTouchEvent().emulateTouchEnded,i),t.createInstance("myselfInfoRepository").getMyCurrency().then(function(e){var n=this._data.donation;i.setHtmlStrings({donation_labelimg:this._buildDonationPopupHtml(n.union_data.total_donation_amount,n.next_rank_point,e.getGemAmount())},t.GameConfig.POPUP_CSS),i.editBox.setOnInputCallback(this._getOnInputCallback(n.union_data.total_donation_amount,n.next_rank_point,e.getGemAmount()),this)}.bind(this))}.bind(this),{blackBtn:function(){i.setHtmlStrings({donation_labelimg:""}),i.dismiss()},blueBtn:function(){t.createInstance("myselfInfoRepository").getMyCurrency().then(function(t){var n=parseInt(i.editBox.getText()),a=t.getGemAmount();!(n>0)||n>a?(i.dismiss(),e._openMessagePopup({title:"",content:'<div class="red"></div>',buttons:[["blueBtn","OK"]]})):(i.setHtmlStrings({donation_labelimg:""}),i.dismiss(),this.__openPopupConfirm(n))}.bind(this))}.bind(this)}).then(function(e){console.log("Resoloved:"+e)},function(e){console.log("Rejected:"+e)})},_getOnInputCallback:function(e,i,a){return function(o,r){var s=n.director.getRunningScene().popups.popupInputDonation,c=r.replace(/\D+/g,"");c=Math.min(a,Number(c)),o.setString(c),s.setHtmlStrings({donation_labelimg:this._buildDonationPopupHtml(e,i,a,c)},t.GameConfig.POPUP_CSS)}},_buildDonationPopupHtml:function(e,n,i,a){var o=[[["white",""],["white",e]],[["white","Rank"],["white",n]]],r=[[["yellow",""],["yellow",i]]];a&&(r=r.concat([[["red",""],["red","-"+a]]]));return t.htmlBuilder.makeTable(o)+"<div>&nbsp;</div>\r\n"+t.htmlBuilder.makeTable(r)},__openPopupConfirm:function(e){var t=n.director.getRunningScene().popups.popupConfirmDonation,i=this._data.donation.union_data.total_donation_amount;t.open({value:e,amount:i})},_touchEndedBackBtnProcess:function(e){var t=e.temporaryRouterParams;this._navigateFrom(t)},_getNavigateFrom:function(e){return e.temporaryRouterParams,{id:e.temporaryRouterParams.id,routes:t.createInstance("router").getCurrentFragment(),routerParams:e.routerParams,temporaryRouterParams:e.temporaryRouterParams}}}),i.assign(t.pc.guild.gud_001.SceneDelegate.prototype,t.pc.guild.roles.Routing,t.pc.guild.roles.GuildApiCache,t.pc.guild.roles.GuildJoinCheck,t.pc.guild.roles.GuildCommon,t.pc.roles.ImagesCommon,t.pc.roles.AllOverUI)}((this||0).self||global),function(e){var t=e.kh,n=e._;t.pc=t.pc||{};var i=(e.Q,{gud_002_detail:{factoryName:"popupFactoryPopupCommon",resourceName:function(){var e=n.findKey(res,function(e){return 0<e.indexOf("gud_002_detail.json")});return e||alert(": gud_002_detail.json"),e||""}(),title:"",buttonLabels:{blackBtn:""},buttons:{blackBtn:function(){this.dismiss()}}}});t.pc.guild=t.pc.guild||{},t.pc.guild.gud_002=t.pc.guild.gud_002||{},t.pc.guild.gud_002.Scene=t.BaseScene.extend({resourceFileName:"gud_002/gud_002.json",isLoopDefaultView:!1,_popups:i,tabDelegateConfig:[],componentName:"guild",sceneName:"gud_002",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_guardian_list","btnCallbackBtnGuardianList",null,function(){alert("{{gud_003gud_003_a}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_guardian_enh","btnCallbackBtnGuardianEnh",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"guild/gud_005")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_all_over","btnCallbackBtnAllOver",null,function(){alert("{{all_over_ui}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_guardian_detail","btnCallbackBtnGuardianDetail",null,function(e){this.popups.gud_002_detail.open(e)}),this._initButtonEvent.call(this,this.seekWidgetByPath("bottom_btn_panel"),"btn_black_s","btnCallbackBottomBtnPanelBtnBlackS",null,function(){alert("{{com_tutorial}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc=t.pc||{},t.pc.guild=t.pc.guild||{},t.pc.guild.gud_002=t.pc.guild.gud_002||{},t.pc.guild.gud_002.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../gud_popup_ui.json"],_popups:{popupGuardianDetail:{factoryName:"popupFactoryGud002Detail"}},onSceneInit:function(e){a.defer(),this._setBackBtn(e),this._verifyRouterParams002(e),this._data={},e.seekWidgetByName("btn_guardian_enh").setVisible(!1);var t=e.routerParams.gud_002.id,n=["union_me","donation"],o=["union"];return i.isUndefined(t)||"me"===t?(this.isMe=!0,this._requestAll(n).then(function(t){this._onCallApisFinished(e)}.bind(this))):this._request(["me"]).then(function(i){this.isMe=i.a_union_id===t;var a=this.isMe?n:o;this._requestAll(a).then(function(t){this._onCallApisFinished(e)}.bind(this))}.bind(this)),a.resolve()},onSceneEnter:function(e){return a.defer(),a.resolve()},onSceneExit:function(e){return a.defer(),a.resolve()},onPageInAnimationEnd:function(e){return a.defer(),a.resolve()},_onCallApisFinished:function(e){i.isUndefined(this._data.union_me)||(this._data.union=this._data.union_me),this._setGuildStrings(e,this._data),this.__setBackgroundImage(e);var t=this._getUnionData(),a=e.seekWidgetByName("btn_guardian_enh");a.setVisible(this.isMe);var o=t.guardian_info.detail_info.next_level_pt>0;a.setEnabled(o),a.setColor(o?n.color.WHITE:n.color("#808080"))},__setBackgroundImage:function(e){var t=this._getUnionData().guardian_info;this._setIntroduceGuardianImage(t)},btnCallbackBtnGuardianList:function(e){var t=a.defer();return t.reject(this._override),this._navigate002To003(e),t.promise},btnCallbackBtnGuardianEnh:function(e){var t=a.defer();return t.reject(this._override),this._navigate002To005(e),t.promise},btnCallbackBtnAllOver:function(e){var t=a.defer();t.reject(this._override);var n=this._getUnionData();return this._openAllOverPanel(n.guardian_info.guardian_id,0,"guardian"),t.promise},btnCallbackBtnGuardianDetail:function(e){var t=a.defer();t.reject(this._override);var n=this._getUnionData().guardian_info;return e.popups.popupGuardianDetail.open().then(function(){e.popups.popupGuardianDetail.setEffects(n)}.bind(this)),t.promise},btnCallbackBottomBtnPanelBtnBlackS:function(e){return this._openSubTutorialPopup(e),a.reject(this._override)},_openSubTutorialPopup:function(e){return t.ImplantedPopup.createOrGet(e,"sub_tutorial","ImplantedSubTutorialPopup").open("guardian",1)},_touchEndedBackBtnProcess:function(e){this._navigateToGuildTop()}}),i.assign(t.pc.guild.gud_002.SceneDelegate.prototype,t.pc.guild.roles.Routing,t.pc.guild.roles.GuildApiCache,t.pc.guild.roles.GuildCommon,t.pc.roles.ImagesCommon,t.pc.roles.AllOverUI)}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.guild=t.pc.guild||{},t.pc.guild.gud_003=t.pc.guild.gud_003||{},t.pc.guild.gud_003.Scene=t.BaseScene.extend({resourceFileName:"gud_003/gud_003.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[{tab1:{node:"tab_0","content-node":"tab_0_node"},tab2:{node:"tab_1","content-node":"tab_1_node"}}],componentName:"guild",sceneName:"gud_003",_delegate:null,_init:function(){this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc=t.pc||{},t.pc.guild=t.pc.guild||{},t.pc.guild.gud_003=t.pc.guild.gud_003||{},t.pc.guild.gud_003.SceneDelegate=t.pc.BaseSceneDelegate.extend({_popups:{popupGuardianDetail:{factoryName:"popupFactoryGudGuardianDetail"},popupGuardianDetailB:{factoryName:"popupFactoryGudGuardianDetailB"},popupGuardianChange:{factoryName:"popupFactoryGudGuardianChange",buttonLabels:{blackBtn:"",blueBtn:"OK"},buttons:{blueBtn:function(e){this.dismiss();try{e._delegate._changeGuardian.apply(e._delegate,[this.getTag()])}catch(e){console.error(e)}},blackBtn:function(e){this.dismiss()}}},popupGuardianNoMoney:{factoryName:"popupFactoryGudGuardianNomoney"},popupGuardianBuy:{factoryName:"popupFactoryGudGuardianBuy",buttonLabels:{blackBtn:"",blueBtn:""},buttons:{blueBtn:function(e){this.dismiss();try{e._delegate._buyGuardian.apply(e._delegate,[this.getTag()])}catch(e){console.error(e)}},blackBtn:function(e){this.dismiss()}}},popupBuyResult:{factoryName:"popupFactoryGudGuardianResult"},popupChangeResult:{factoryName:"popupFactoryGudChangeResult"}},onSceneInit:function(e){a.defer(),this._setBackBtn(e),this._verifyRouterParams003(e);var t=e.seekWidgetByName("tab_0_node");this._setPositionIconsVisibility(t,["leader","sub_leader"]);var n=e.seekWidgetByName("tab_1_node");return this._setPositionIconsVisibility(n,["leader","sub_leader"]),e.restoreParams||e.tabDelegateList[0].selectTab(e.seekWidgetByName("tab_0")),this._requestAll(["union_me","me","authority"]).then(function(){return this._setDonationHeader(e),this._fillupGuardianList(e)}.bind(this))},onSceneEnter:function(e){return this._prefetchGuardian()},tabCallbackTab0:function(e){},tabCallbackTab1:function(e){},_onTouchBtnProtection:function(e,t,n,i){i===ccui.Widget.TOUCH_ENDED&&this.__showChangePopup(t)},_onTouchBtnBuy:function(e,t,n,i){i===ccui.Widget.TOUCH_ENDED&&this.__checkPriceAndPopup(t)},_onTouchGuardianPanel:function(e,t,n,a){if(a===ccui.Widget.TOUCH_ENDED)return-1===this._data.authority.authority.indexOf("guardian_buy")?void this.__showNotOwnedGuardianDetailPopup(t):void(null===t.a_guardian_id||i.isUndefined(t.a_guardian_id)?this.__checkPriceAndPopup(t):this.__showDetailPopup(t))},__showImagePopupBase:function(e,n){return e.setTitle(n.name),e.open().then(function(){e.seekWidgetByName("guardian_intro_label")?e.setStrings({guardian_intro_label:n.description}):e.setStrings({main_label:n.description}),e.loadTextures({"illust-com-kneeshot_guardian":t.Img("illust-com-kneeshot","guardian",i.padZero(n.guardian_id,4),0).png})}.bind(this))},__showNotOwnedGuardianDetailPopup:function(e){var t=n.director.getRunningScene().popups.popupGuardianDetailB;this.__showImagePopupBase(t,e)},__showDetailPopup:function(e){var i=n.director.getRunningScene().popups.popupGuardianDetail;this.__showImagePopupBase(i,e).then(function(){var n=t.htmlBuilder.makeDivAndSpans([[["orange","Pt:"],["white",e.detail_info.custom_pt]],[["orange","Lv:"],["white",e.detail_info.next_level_pt]]]);i.setHtmlStrings({pt_level_labelimg:n},t.GameConfig.POPUP_CSS)}.bind(this))},__showChangePopup:function(e){var i=n.director.getRunningScene().popups.popupGuardianChange;this.__showImagePopupBase(i,e).then(function(){var n=t.htmlBuilder.makeDivAndSpans([[["orange","Pt:"],["white",e.detail_info.custom_pt]],[["orange","Lv:"],["white",e.detail_info.next_level_pt]]]);i.setHtmlStrings({pt_labelimg:n},t.GameConfig.POPUP_CSS),i.setTag(e.a_guardian_id)}.bind(this))},__checkPriceAndPopup:function(e){t.createInstance("apiAUnions").getDonationInfo().then(function(t){this._totalGems=t.body.union_data.current_donation_amount;var n=e.price;this._totalGems<n?this.__showNoMoneyPopup(e):this.__showBuyPopup(e)}.bind(this))},__showBuyPopup:function(e){var i=n.director.getRunningScene().popups.popupGuardianBuy;this.__showImagePopupBase(i,e).then(function(){var n=t.w("gem"),a=this._totalGems-e.price,o=t.htmlBuilder.makeDivAndSpans([[["orange",":"],["white",""+e.price+n]],[["orange",n+":"],["white",this._totalGems+""],["red",a]]]);i.setHtmlStrings({pt_labelimg:o},t.GameConfig.POPUP_CSS),i.setTag(e.guardian_id)}.bind(this))},__showNoMoneyPopup:function(e){var i=n.director.getRunningScene().popups.popupGuardianNoMoney;this.__showImagePopupBase(i,e).then(function(){var n="",a=t.htmlBuilder.makeDivAndSpans([[["orange",":"],["white",""+e.price+n]],[["red",n+""]]]);i.setHtmlStrings({pt_level_labelimg:a},t.GameConfig.POPUP_CSS)}.bind(this))},_changeGuardian:function(e){t.createInstance("apiAUnions").setSelectedGuardian(e).then(function(e){var t=n.director.getRunningScene();this._fillupGuardianList(t),this._showChangeResult()}.bind(this))},_buyGuardian:function(e){var a=t.createInstance("apiAUnions"),o=n.director.getRunningScene();a.guardianBuy(e).then(function(e){this._fillupGuardianList(o),this._setDonationHeader(o),this._showBuyResult()}.bind(this)).fail(function(n){500===n.status?a.getGuardians(!0).then(function(n){var a=n.body.data,r="",s="<div></div>";i.isUndefined(i.find(a,{guardian_id:e}))||(r="",s="<div></div>"),o._openMessagePopup({title:r,content:s,buttons:[["blackBtn","",!0]]}).then(function(){t.createInstance("sceneManager").reloadScene()})}.bind(this)).fail(function(e){console.error(e)}):console.error(n)}.bind(this))},_showChangeResult:function(){var e=n.director.getRunningScene().popups.popupChangeResult;e.setContent(""),e.open()},_showBuyResult:function(){var e=n.director.getRunningScene().popups.popupBuyResult;e.setContent(""),e.open()},_touchEndedBackBtnProcess:function(e){this._navigateToUnionGuardian()}}),i.assign(t.pc.guild.gud_003.SceneDelegate.prototype,t.pc.roles.UIUtility,t.pc.guild.roles.Routing,t.pc.guild.roles.GuildApiCache,t.pc.guild.roles.GuildCommon,t.pc.guild.roles.GuardianPageListController)}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.guild=t.pc.guild||{},t.pc.guild.gud_005=t.pc.guild.gud_005||{},t.pc.guild.gud_005.Scene=t.BaseScene.extend({resourceFileName:"gud_005/gud_005.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"guild",sceneName:"gud_005",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_recommended","btnCallbackBtnRecommended",null,function(){alert("{{gud_005_checkcom_non_offer}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_decision","btnCallbackBtnDecision",null,function(){alert("{{gud_005_checkgud_005_rarecheck}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"filter_btn","btnCallbackFilterBtn",null,function(){alert("{{com_filter_weapon}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc=t.pc||{},t.pc.guild=t.pc.guild||{},t.pc.guild.gud_005=t.pc.guild.gud_005||{},t.pc.guild.gud_005.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../gud_popup_ui.json"],_popups:{popupConfirm:{factoryName:"popupFactoryBlackBlue",title:"",buttonLabels:{blackBtn:"",blueBtn:"OK"},buttons:{blackBtn:function(e){this.dismiss()},blueBtn:function(e){this.dismiss()}}},popupResult:{factoryName:"popupFactoryBlue",title:"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){this.dismiss()}}},popupNonOffer:{factoryName:"popupFactoryPopupCommon",resourceName:"core-popup-com_non_offer",title:"",buttonLabels:{blackBtn:""},buttons:{blackBtn:function(e){this.dismiss(),t.createInstance("notificationCenter").dispatchEvent("menu_close")}}},popupEnhResultLevelUp:{factoryName:"popupFactoryPopupCommon",resourceName:"core-popup-gud_005_levelup",title:"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){this.dismiss(),t.createInstance("notificationCenter").dispatchEvent("menu_close")}}},popupEnhResult:{factoryName:"popupFactoryPopupCommon",resourceName:"core-popup-gud_005_result",title:"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){this.dismiss(),t.createInstance("notificationCenter").dispatchEvent("menu_close")}}}},_createDisplayFilterSettings:function(){return{list_node:[t.displayFilter.enums.FILTER_NAME.GUILD_WEAPON,"com_filter_weapon"]}},_controller:null,onSceneInit:function(e){this._setBackBtn(e),this._verifyRouterParams005(e),this._data={},this._request("union_me").then(function(){this._setSelectedGuardianHeader(e),this._setGuildStrings(e,this._data)}.bind(this));var n=t.core.pager.helper.coreCardListUI(e,{baseName:e,panelName:t.BtnsPageListParams.GUILD_005.panelName,cardType:"weapon",cardFrame:"full",apiName:"apiAUnions",apiMethod:"getGuardianDonationMaterials",apiParams:[e.routerParams.gud_005.id,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE],apiModel:t.core.model.AWeapon,sortKey:"enhance_guardian_weapon_materials",maxSelectCount:20});return n.addUpdateEventListener(function(e,n,i,a){t.pc.roles.UIUtility._setEnableButton(this,a.getSelectedData().length>0)},e.seekWidgetByName("btn_decision")),this._controller=n,this._createDisplayFilterController(e),this._initializeDisplayFilterController("list_node"),n.initialize()},onSceneEnter:function(e){return a.defer(),a.resolve()},onSceneExit:function(e){return a.defer(),this._controller&&(this._controller.dispose(),this._controller=null),this._displayFilterClean(),a.resolve()},onPageInAnimationEnd:function(e){return a.defer(),a.resolve()},btnCallbackBtnRecommended:function(e){var t=a.defer();return t.reject(this._override),this._setRecommendedEnhWeapons(),t.promise},btnCallbackBtnDecision:function(e){var n=a.defer();return n.reject(this._override),t.createInstance("apiAUnions").confirmGuardianEnhanceMaterials(this._controller.getSelectedData().map(function(e){return e.getAId()})).then(function(e){var t=e.body.materials;this._popupEnhGuardian(t)}.bind(this)).fail(function(e){console.error(e.stack)}),n.promise},_popupEnhGuardian:function(e){if(i.isUndefined(e))console.error("Invalid argument materials, undefined given.");else{var a=i.pluck(e,"a_weapon_id"),o=this._getUnionData();if(i.isUndefined(o))console.error("Plz call union api first.");else{var r,s=n.director.getRunningScene();r=a.length>10?t.ImplantedPopup.createOrGet(s,"com_consumption_check_result_2","ComEnhGuardianCheckPopup"):t.ImplantedPopup.createOrGet(s,"com_consumption_check_result_1","ComEnhGuardianCheckPopup"),this.disablePulldown(),r.open({scene:s,materials:e,guardianPt:o.guardian_info.detail_info.custom_pt}).then(this._popupEnhGuardianConfirm.bind(this,a),function(e){e&&e.stack&&console.error(e.stack)})}}},_popupEnhGuardianConfirm:function(e){t.createInstance("apiAUnions").guardianDonationWeapons(e).then(function(e){var t=e.body.rank_up_info,i=n.director.getRunningScene(),a=i._delegate||i;if(t.before_rank<t.after_rank){var o=[e.body.before_custom_pt,e.body.after_custom_pt,t.before_rank,t.after_rank,t.effect_info.description];a._popupGuardianLevelUp.apply(a,o)}else{o=[e.body.before_custom_pt,e.body.after_custom_pt];a._popupGuardianEnhResult.apply(a,o)}this._controller&&this._controller.refresh(!1,!0)}.bind(this)).fail(function(e){console.error(e.stack)}),this.enabledPulldown()},_setRecommendedEnhWeapons:function(){t.createInstance("apiAWeapons").getRecommendGuardianDonationMaterials().then(function(e){return 0===e.body.max_record_count?void this._popupNoOffer():void this._popupConfirmRecommendedEnhWpn(e.body.data)}.bind(this)).fail(function(e){console.error(e.stack)})},_popupConfirmRecommendedEnhWpn:function(e){this.disablePulldown();var i=n.director.getRunningScene().popups.popupConfirm;i.setTitle(""),i.setContent("R<br />"),i.open().then(function(){t.setTouchEventHandlers(i,{"TOUCH_ENDED blue_btn":function(){this._popupEnhGuardian(e),i.dismiss()}.bind(this),"TOUCH_ENDED black_btn":function(){i.dismiss(),this.enabledPulldown()}.bind(this)},this)}.bind(this)).fail(function(e){console.error(e.stack)})},_popupNoOffer:function(){this.disablePulldown();var e=n.director.getRunningScene().popups.popupNonOffer;e.open().then(function(){t.setTouchEventHandlers(e,{"TOUCH_ENDED btn_present":function(){this._navigateToPresent()},"TOUCH_ENDED btn_gacha":function(){this._navigateToGemGacha()},"TOUCH_ENDED btn_quest":function(){this._navigateToQuest()}},this)}.bind(this)).fail(function(e){console.error(e.stack)})},_popupGuardianLevelUp:function(e,i,a,o,r){var s=n.director.getRunningScene().popups.popupEnhResultLevelUp;this.disablePulldown(),s.open().then(function(){s.setHtmlStrings({pt_up_labelimg:this._guardianPtUpHtmlString(e,i),levelup_labelimg:this._guardianLvUpHtmlString(a,o,r)},t.GameConfig.POPUP_CSS)}.bind(this)).fail(function(e){console.error(e.stack)})},_guardianPtUpHtmlString:function(e,t){return"<span class='white'></span><br /><span class='orange'>Pt:</span><span class='white'>"+e+"&rarr;</span><span class='yellow'>"+t+"</span>"},_guardianLvUpHtmlString:function(e,t,n){return"<span class='white'>Lv</span><br /><span class='orange'>Lv:</span><span class='white'>"+e+"&rarr;</span><span class='yellow'>"+t+"<br />"+n+"</span>"},_popupGuardianEnhResult:function(e,i){this.disablePulldown();var a=n.director.getRunningScene().popups.popupEnhResult;this._getUnionData().guardian_info.detail_info.custom_pt=i,a.open().then(function(){a.setHtmlStrings({enhance_labelimg:this._guardianPtUpHtmlString(e,i)},t.GameConfig.POPUP_CSS)}.bind(this)).fail(function(e){console.error(e.stack)})},enabledPulldown:function(){t.createInstance("notificationCenter").dispatchEvent("menu_close")},disablePulldown:function(){t.createInstance("notificationCenter").dispatchEvent("menu_open")},_touchEndedBackBtnProcess:function(e){this._navigateToUnionGuardian()}}),t.assignRoles(t.pc.guild.gud_005.SceneDelegate,[t.displayFilter.roles.DisplayFilterSceneController,t.pc.roles.UIUtility,t.pc.guild.roles.Routing,t.pc.guild.roles.GuildApiCache,t.pc.guild.roles.GuildCommon])}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{com_offerdel_allcheck:{factoryName:"popupFactoryTextOnly",content:"<br />",title:"",buttonLabels:{blackBtn:"",blueBtn:"OK"},buttons:{blackBtn:function(){this.dismiss()},blueBtn:function(){alert("popup,com_offerdel_allresult")}}},com_offerdel_allresult:{factoryName:"popupFactoryTextOnly",content:"<br />",title:"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(){alert("{{com_offerdel_allresultgud_007_b_1}}")}}}});t.pc.guild=t.pc.guild||{},t.pc.guild.gud_007_leader=t.pc.guild.gud_007_leader||{},t.pc.guild.gud_007_leader.Scene=t.BaseScene.extend({resourceFileName:"gud_007/gud_007_leader",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[{tab1:{node:"tab_0","content-node":"tab_0_node"},tab2:{node:"tab_1","content-node":"tab_1_node"},tab3:{node:"tab_2","content-node":"tab_2_node"}}],componentName:"guild",sceneName:"gud_007_leader",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath("tab_0_node"),"btn_member_scout","btnCallbackTab0NodeBtnMemberScout",null,function(){alert("{{gud_010}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("tab_1_node"),"btn_member_scout","btnCallbackTab1NodeBtnMemberScout",null,function(){alert("{{gud_010}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("tab_1_node"),"btn_member_select","btnCallbackTab1NodeBtnMemberSelect",null,function(){alert("gud_007_b_2")}),this._initButtonEvent.call(this,this.seekWidgetByPath("tab_1_node"),"btn_decision","btnCallbackTab1NodeBtnDecision",null,function(e){this.popups.com_offerdel_allcheck.open(e)}),this._initButtonEvent.call(this,this.seekWidgetByPath("tab_1_node"),"btn_cancel","btnCallbackTab1NodeBtnCancel",null,function(){alert("{{gud_007_b_1}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("tab_1_node"),"btn_member_scout_0","btnCallbackTab1NodeBtnMemberScout0",null,function(){alert("{{gud_010}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("tab_2_node"),"btn_member_scout","btnCallbackTab2NodeBtnMemberScout",null,function(){alert("{{gud_010}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc=t.pc||{},t.pc.guild=t.pc.guild||{},t.pc.guild.gud_007_leader=t.pc.guild.gud_007_leader||{},t.pc.guild.gud_007_leader.SceneDelegate=t.pc.BaseSceneDelegate.extend({_popups:{com_offerdel_allcheck:{factoryName:"popupFactoryTextOnly",content:"<br />",title:"",buttonLabels:{blackBtn:"",redBtn:""},buttonSounds:{redBtn:t.SoundList.BUTTON_TOUCHED_CONFIRMED},buttons:{blackBtn:function(){this.dismiss()},redBtn:function(e){this.dismiss(),e._delegate._rejectSelectedRequest.call(e._delegate)}}},popupScoutNo:{factoryName:"popupFactoryBlackRed",buttonLabels:{blackBtn:"",redBtn:""},buttons:{blackBtn:function(e){this.dismiss()},redBtn:function(e){this.dismiss()}}},popupScoutCancel:{factoryName:"popupFactoryBlackRed",buttonLabels:{blackBtn:"",redBtn:""},buttons:{blackBtn:function(e){this.dismiss()},redBtn:function(e){this.dismiss()}}},popupScoutOk:{factoryName:"popupFactoryBlackBlue",buttonLabels:{blackBtn:"",blueBtn:""},buttons:{blackBtn:function(e){this.dismiss()},blueBtn:function(e){this.dismiss()}}},popupConfirm:{factoryName:"popupFactoryBlackBlue",buttonLabels:{blackBtn:"",blueBtn:"OK"},buttons:{blackBtn:function(e){this.dismiss()},blueBtn:function(e){this.dismiss()}}},popupResult:{factoryName:"popupFactoryBlue",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){this.dismiss(),e._delegate.refreshPage(1)}}},popupRoleChange:{factoryName:"popupFactoryComRoleChange"}},_controllers:null,onSceneInit:function(e){this._setBackBtn(e),this._verifyRouterParams007(e),this._setUnionHeaderMemberNum(e);return i.each(["tab_0_node..btn_member_scout","tab_1_node..btn_member_scout","tab_1_node..btn_member_scout_0","tab_2_node..btn_member_scout"],function(t){var i=e.seekWidgetByPath(t);if(null!==i){var a=this._maxNumber>this._totalNumber;i.setEnabled(a),i.setColor(a?n.color("#FFFFFF"):n.color("#808080"))}},this),this._controllers={},e.tabDelegateList[0].selectTab(e.seekWidgetByName(e.routerParams.gud_007.selectedTab)),a.resolve()},_fillupGuildMemberBtnsList:function(e,n){if(this._controllers&&!this._controllers[n]){var i,a=[{baseNode:"tab_0_node",apiName:"apiAUnions",methodName:"getMembers",btnPattern:"guild_blue_only",viewClass:t.guild.view.GuildMemberPanel,touchFuncNames:{blue:"_onTouchGuildBlueButton",user:"_onTouchUserButton"}},{baseNode:"tab_1_node",apiName:"apiAUnionJoinRequests",methodName:"get",btnPattern:"blue_red",viewClass:t.guild.view.GuildMemberJoinPanel,touchFuncNames:{red:"_onTouchMemberJoinRedButton",blue:"_onTouchMemberJoinBlueButton",user:"_onTouchUserButton"}},{baseNode:"tab_2_node",apiName:"apiAUnionScouts",methodName:"getList",btnPattern:"red_only",viewClass:t.guild.view.GuildMemberScoutPanel,touchFuncNames:{red:"_onTouchMemberScoutRedButton",user:"_onTouchUserButton"}}][n],o=e.seekWidgetByName(a.baseNode),r=o.seekWidgetByName("userlist_page_ui"),s=new a.viewClass(r,this,a.btnPattern,a.touchFuncNames,this._myUnionInfo.union_position),c=t.core.pager.model.ApiDataListFactory(a.apiName,a.methodName,[t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE],t.core.pager.model.UserListData);i=1===n?new t.core.pager.controller.SelectablePagerController(o,c,[s],r,999,!0):new t.core.pager.controller.PagerController(o,c,[s],r);var u=o.seekWidgetByName("viewpage_ui");new t.core.pager.view.button.ViewPageUi(u,i).initialize(),i.initialize(),this._controllers[n]=i}},onSceneEnter:function(e){return this._getUnionInfoAboutMe()},onSceneExit:function(e){return i.invoke(this._controllers,"dispose"),this._controllers=null,a.resolve()},onPageInAnimationEnd:function(e){return a.defer(),a.resolve()},tabCallbackTab0:function(e){this._fillupGuildMemberBtnsList(e,0)},tabCallbackTab1:function(e){this._fillupGuildMemberBtnsList(e,1)},tabCallbackTab2:function(e){this._fillupGuildMemberBtnsList(e,2)},btnCallbackTab0NodeBtnMemberScout:function(e){var t=a.defer();return t.reject(this._override),this._navigate001To010(),t.promise},btnCallbackTab1NodeBtnMemberScout:function(e){var t=a.defer();return t.reject(this._override),this._navigate001To010(),t.promise},btnCallbackTab1NodeBtnMemberSelect:function(e){var t=a.defer();t.reject(this._override);var n=this._controllers[1];return n?(e.seekWidgetByPath("tab_1_node..default_btn_node").setVisible(!0),e.seekWidgetByPath("tab_1_node..select_btn_node").setVisible(!0),this._join_select_mode=!0,n.refresh(),t.promise):t.promise},btnCallbackTab1NodeBtnDecision:function(e){var t=a.defer();return t.resolve(),t.promise},btnCallbackTab1NodeBtnCancel:function(e){var t=a.defer();t.reject(this._override);var n=this._controllers[1];return n?(e.seekWidgetByPath("tab_1_node..default_btn_node").setVisible(!0),e.seekWidgetByPath("tab_1_node..select_btn_node").setVisible(!1),this._join_select_mode=!1,n.refresh(),t.promise):t.promise},btnCallbackTab1NodeBtnMemberScout0:function(e){var t=a.defer();return t.reject(this._override),this._navigate001To010(),t.promise},btnCallbackTab2NodeBtnMemberScout:function(e){var t=a.defer();return t.reject(this._override),this._navigate001To010(),t.promise},refreshPage:function(e,t){this._controllers[e]&&this._controllers[e].refresh(!1,t)},_onTouchUserButton:function(e,t,n){var i=t.getRawData(),a=i.a_player_id||i.player.a_player_id,o={prf_001:{id:a}},r={return_to_profile:{routes:"guild/gud_007_a",params:{gud_007:{id:n.routerParams.gud_007.id,selectedTab:n.tabDelegateList[0].selected}}}};this._navigate007ToPRF001(n,a,o,r)},_onTouchGuildBlueButton:function(e,t,i){var a=t.getRawData();n.director.getRunningScene().popups.popupRoleChange.open({record:a})},_onTouchMemberJoinRedButton:function(e,t,n){var i=t.getRawData();this._confirmRejectRequest(i)},_onTouchMemberJoinBlueButton:function(e,t,n){var i=t.getRawData();this._confirmAcceptRequest(i.player)},_onTouchMemberScoutRedButton:function(e,t,n){var i=t.getRawData();this._confirmCancelScout(i)},_changeRole:function(e,a){e.union_position!==a&&t.createInstance("apiAUnions").changeMemberUnionPosition(e.a_union_member_id,a).then(function(e){var a=e.body.error;if(i.isUndefined(a))this.refreshPage(0);else{var o={positionFull:{title:"",content:"3<br/>"}},r=n.director.getRunningScene().popups.popupResult;r.open().then(function(){r.setTitle(o[a].title),r.setContent(o[a].content),t.setTouchEventHandlers(r,{"TOUCH_ENDED blue_btn":function(){this.refreshPage(0),r.dismiss()}.bind(this)},this)}.bind(this)).fail(function(e){console.error(e.stack)})}}.bind(this)).fail(function(e){console.error(e.stack)})},_confirmRejectRequest:function(e){var i=n.director.getRunningScene().popups.popupScoutNo;i.open().then(function(){i.setTitle(""),i.setContent(e.player.name+""+t.w("joinedUnion")+""),t.setTouchEventHandlers(i,{"TOUCH_ENDED red_btn":function(){this._rejectRequest(e),i.dismiss()}.bind(this)},this)}.bind(this)).fail(function(e){console.error(e.stack)})},_rejectRequest:function(e){t.createInstance("apiAUnionJoinRequests").reject([e.a_union_join_request_id]).then(function(i){var a="",o="";"success"===i.body.error_code?(a="",o=e.player.name+""):(a="",o="");var r=n.director.getRunningScene().popups.popupResult;r.open().then(function(){r.setTitle(a),r.setContent(o),t.setTouchEventHandlers(r,{"TOUCH_ENDED blue_btn":function(){this.refreshPage(1),r.dismiss()}.bind(this)},this)}.bind(this)).fail(function(e){console.error(e.stack)})}.bind(this)).fail(function(e){console.error(e.stack)})},_rejectSelectedRequest:function(){var e=this._controllers[1].getSelectedData().map(function(e){return e.getRawData().a_union_join_request_id});t.createInstance("apiAUnionJoinRequests").reject(e).then(function(e){var i=n.director.getRunningScene().popups.popupResult;i.open().then(function(){i.setTitle(""),i.setContent("<br />"),t.setTouchEventHandlers(i,{"TOUCH_ENDED blue_btn":function(){this.refreshPage(1,!0),i.dismiss()}.bind(this)},this)}.bind(this)).fail(function(e){console.error(e.stack)})}.bind(this)).fail(function(e){console.error(e.stack)})},_confirmAcceptRequest:function(e){var i=n.director.getRunningScene().popups.popupScoutOk;i.open().then(function(){i.setTitle(""),i.setContent(e.name+""+t.w("joinedUnion")+""),t.setTouchEventHandlers(i,{"TOUCH_ENDED blue_btn":function(){this._acceptRequest(e),i.dismiss()}.bind(this)},this)}.bind(this)).fail(function(e){console.error(e.stack)})},_acceptRequest:function(e){t.createInstance("apiAUnions").accept([e.a_player_id]).then(function(i){var a=n.director.getRunningScene().popups.popupResult,o=i.body.error||"none",r={none:{title:"",content:e.name+""+t.w("joinedUnion")+""},member_max_reached:{title:""+t.w("unionMember")+"",content:""+t.w("unionMember")+"<br />"+t.w("unionMember")+"<br />"+t.w("joinedUnion")+"<br />"},already_member:{title:""+t.w("joinedUnion")+"",content:""+t.w("joinedUnion")+""},already_refused_request:{title:"",content:""}};a.open().then(function(){a.setTitle(r[o].title),a.setContent(r[o].content),t.setTouchEventHandlers(a,{"TOUCH_ENDED blue_btn":function(){a.dismiss()}.bind(this)},this),this.refreshPage(0),this.refreshPage(1)}.bind(this)).fail(function(e){console.error(e.stack)})}.bind(this)).fail(function(e){console.error(e.stack)})},_confirmCancelScout:function(e){var i=n.director.getRunningScene().popups.popupScoutCancel;i.open().then(function(){i.setTitle(""),i.setContent(""),t.setTouchEventHandlers(i,{"TOUCH_ENDED red_btn":function(){this._cancelScout(e),i.dismiss()}.bind(this)},this)}.bind(this)).fail(function(e){console.error(e.stack)})},_cancelScout:function(e){t.createInstance("apiAUnionScouts").cancel(this._unionId,e.player.a_player_id,"cancel").then(function(e){if(e.body.result)this.refreshPage(2);else{var i=n.director.getRunningScene().popups.popupResult,a={already_member:{title:""+t.w("joinedUnion")+"",content:""+t.w("joinedUnion")+""},already_canceled:{title:"",content:"<br />"}},o=e.body.error;i.open().then(function(){i.setTitle(a[o].title),i.setContent(a[o].content)}.bind(this)).fail(function(e){console.error(e.stack)})}}.bind(this)).fail(function(e){console.error(e.stack)})},_touchEndedBackBtnProcess:function(e){var t=e.temporaryRouterParams;return i.isUndefined(t)||i.isUndefined(t.routes)?void this._navigateToGuildTop():void this._navigateFrom(t)},_getNavigateFrom:function(e){return{routes:t.createInstance("router").getCurrentFragment(),routerParams:e.routerParams,temporaryRouterParams:e.temporaryRouterParams}}}),i.assign(t.pc.guild.gud_007_leader.SceneDelegate.prototype,t.pc.roles.UIUtility,t.pc.guild.roles.Routing,t.pc.guild.roles.GuildCommon,t.pc.guild.roles.GuildMemberBtnsListController)}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.guild=t.pc.guild||{},t.pc.guild.gud_007_not_leader=t.pc.guild.gud_007_not_leader||{},t.pc.guild.gud_007_not_leader.Scene=t.BaseScene.extend({resourceFileName:"gud_007/gud_007_not_leader",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"guild",sceneName:"gud_007_not_leader",_delegate:null,_init:function(){this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._),i=e.Q;t.pc=t.pc||{},t.pc.guild=t.pc.guild||{},t.pc.guild.gud_007_not_leader=t.pc.guild.gud_007_not_leader||{},t.pc.guild.gud_007_not_leader.SceneDelegate=t.pc.BaseSceneDelegate.extend({_popups:{},onSceneInit:function(e){i.defer(),this._setBackBtn(e),this._verifyRouterParams007(e);var t=e.routerParams.gud_007.id;return n.isUndefined(t)||"me"===t?this._getUnionInfoAboutMe().then(function(t){this._setUnionHeaderMemberNum(e),this._fillupGuildMemberBtnsListForMember(e)}.bind(this)).fail(function(e){console.error(e.stack)}):this._getUnionInfoAboutOther(t).then(function(n){this._setUnionHeaderMemberNum(e),this._fillupGuildMemberBtnsListForMember(e,t)}.bind(this)).fail(function(e){console.error(e.stack)}),i.resolve()},_fillupGuildMemberBtnsListForMember:function(e,i){if(!this._controller){var a={baseNode:"window_gray",apiName:"apiAUnions",methodName:"getMembers",touchFuncNames:{user:"_onTouchUserButton"}},o=[t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE];n.isUndefined(i)||(o.push(i),a.methodName="getMembersExternal");var r=e.seekWidgetByName(a.baseNode),s=r.seekWidgetByName("userlist_page_ui"),c=new t.guild.view.GuildMemberPanel(s,this,"guild_plain",a.touchFuncNames,"no_leader"),u=t.core.pager.model.ApiDataListFactory(a.apiName,a.methodName,o,t.core.pager.model.UserListData),l=new t.core.pager.controller.PagerController(r,u,[c],s),_=r.seekWidgetByName("viewpage_ui");new t.core.pager.view.button.ViewPageUi(_,l).initialize(),l.initialize(),this._controller=l}},onSceneEnter:function(e){return i.defer(),i.resolve()},onSceneExit:function(e){return i.defer(),i.resolve()},onPageInAnimationEnd:function(e){return i.defer(),i.resolve()},_onTouchUserButton:function(e,t,n){var i=t.getRawData(),a=i.a_player_id||i.player.a_player_id,o={prf_001:{id:a}},r={return_to_profile:{routes:"guild/gud_007_b",params:{gud_007:{id:n.routerParams.gud_007.id,selectedTab:"tab_0"}}}};this._navigate007ToPRF001(n,a,o,r)},_touchEndedBackBtnProcess:function(e){var t=e.temporaryRouterParams;return n.isUndefined(t)||n.isUndefined(t.routes)?void this._navigateToGuildTop():void this._navigateFrom(t)},_getNavigateFrom:function(e){return{routes:t.createInstance("router").getCurrentFragment(),routerParams:e.routerParams,temporaryRouterParams:e.temporaryRouterParams}}}),n.assign(t.pc.guild.gud_007_not_leader.SceneDelegate.prototype,t.pc.roles.UIUtility,t.pc.guild.roles.Routing,t.pc.guild.roles.GuildCommon)}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.guild=t.pc.guild||{},t.pc.guild.gud_008=t.pc.guild.gud_008||{},t.pc.guild.gud_008.Scene=t.BaseScene.extend({resourceFileName:"gud_008/gud_008.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"guild",sceneName:"gud_008",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_chat_stamp","btnCallbackBtnChatStamp",null,function(){alert("{{ popupcom_edit_greed_a}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_reload","btnCallbackBtnReload",null,function(){alert("{{}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc=t.pc||{},t.pc.guild=t.pc.guild||{},t.pc.guild.gud_008=t.pc.guild.gud_008||{},t.pc.guild.gud_008.SceneDelegate=t.pc.BaseSceneDelegate.extend({_popups:{popupDeleteConfirm:{factoryName:"popupFactoryBlackRed",title:"",buttonLabels:{blackBtn:"",redBtn:""},buttons:{blackBtn:function(e){this.dismiss()},redBtn:function(e){this.dismiss()}}},popupResult:{factoryName:"popupFactoryBlue",title:"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){this.dismiss(),e._delegate._refreshPage()}}},popupChat:{factoryName:"popupFactoryComChat"},popupSendLimit:{factoryName:"popupFactoryBlue",title:"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){this.dismiss();var t=n.director.getRunningScene().seekWidgetByPath("popupLayer..editbox_0");t&&t.setVisible(!0)}}}},onSceneInit:function(e){return a.defer(),this._setBackBtn(e),this._fillupChatBtnsList(e,"apiAUnions","getChats",[]),a.resolve()},onSceneEnter:function(e){return a.defer(),a.resolve()},onSceneExit:function(e){return a.defer(),a.resolve()},onPageInAnimationEnd:function(e){return a.defer(),a.resolve()},btnCallbackBtnChatStamp:function(e){var t=a.defer();return t.reject(this._override),e.popups.popupChat.open({scene:e,inputMaxLength:60}),t.promise},_onTouchChatPlayer:function(e,t){var n=t.from_player_info.a_player_id,i={prf_001:{id:n}};this._navigate008ToPRF001(e,n,i,{return_to_profile:{routes:"guild/gud_008",params:{gud_008:{}}}})},_onTouchDeleteChat:function(e,t){this._confirmChatDelete(t.a_union_chat_id)},_refreshPage:function(){var e=n.director.getRunningScene();this.btnCallbackBtnReload(e)},_confirmChatDelete:function(e){var i=n.director.getRunningScene().popups.popupDeleteConfirm;i.open().then(function(){i.setTitle(""),i.setContent("ChatStamp<br /><span class='red'></span>"),t.setTouchEventHandlers(i,{"TOUCH_ENDED red_btn":function(){this._chatDelete(e),i.dismiss()}.bind(this)})}.bind(this)).fail(function(e){console.error(e.stack)})},_chatDelete:function(e){t.createInstance("apiAUnions").deleteChat(e).then(function(e){if(console.log(e.body),!0===e.body.result){var t=n.director.getRunningScene().popups.popupResult;t.open().then(function(){t.setTitle(""),t.setContent("")}.bind(this)).fail(function(e){console.error(e.stack)})}}.bind(this)).fail(function(e){console.error(e.stack)})},_sendMessage:function(e,n,i){t.createInstance("apiAUnions").comment(i).then(function(t){return console.log(t.body),!0===this._sendInterval?void this._showPopupSendingLimit():(this._showPopupSentMessage(),e.dismiss(),this._sendInterval=!0,void a.delay(5e3).then(function(){this._sendInterval=!1}.bind(this)).fail(function(e){console.error(e.stack)}))}.bind(this)).fail(function(e){console.error(e.stack)})},_sendStamp:function(e,n){return!0===this._sendInterval?void this._showPopupSendingLimit():void t.createInstance("apiAUnions").stamp(n).then(function(t){this._showPopupSentStamp(),e.dismiss(),this._sendInterval=!0,a.delay(5e3).then(function(){this._sendInterval=!1}.bind(this)).fail(function(e){console.error(e.stack)})}.bind(this)).fail(function(e){console.error(e.stack)})},_showPopupNoText:function(){var e=n.director.getRunningScene().popups.popupResult;e.open().then(function(){e.setTitle(""),e.setContent("<span class='red'></span>")}.bind(this)).fail(function(e){console.error(e.stack)})},_showPopupSendingLimit:function(){var e=n.director.getRunningScene().popups.popupSendLimit;e.open().then(function(){e.setTitle(""),e.setContent("5<br />");var t=n.director.getRunningScene().seekWidgetByPath("popupLayer..editbox_0");t&&t.setVisible(!1)}.bind(this)).fail(function(e){console.error(e.stack)})},_showPopupSentMessage:function(){var e=n.director.getRunningScene().popups.popupResult;e.open().then(function(){e.setTitle(""),e.setContent("")}.bind(this)).fail(function(e){console.error(e.stack)})},_showPopupSentStamp:function(){var e=n.director.getRunningScene().popups.popupResult;e.open().then(function(){e.setTitle(""),e.setContent("")}.bind(this)).fail(function(e){console.error(e.stack)})},_touchEndedBackBtnProcess:function(e){var t=e.temporaryRouterParams;return i.isUndefined(t)||i.isUndefined(t.routes)?void this._navigateToGuildTop():void this._navigateFrom(t)}}),i.assign(t.pc.guild.gud_008.SceneDelegate.prototype,t.pc.roles.UIUtility,t.pc.guild.roles.Routing,t.pc.guild.roles.GuildCommon,t.pc.list.roles.ChatPageListBtnsController)}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.guild=t.pc.guild||{},t.pc.guild.gud_009=t.pc.guild.gud_009||{},t.pc.guild.gud_009.Scene=t.BaseScene.extend({resourceFileName:"gud_009/gud_009.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"guild",sceneName:"gud_009",_delegate:null,_init:function(){this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._),i=e.Q;t.pc=t.pc||{},t.pc.guild=t.pc.guild||{},t.pc.guild.gud_009=t.pc.guild.gud_009||{},t.pc.guild.gud_009.SceneDelegate=t.pc.BaseSceneDelegate.extend({_popups:{},_controller:null,onSceneInit:function(e){i.defer(),this._setBackBtn(e),this._verifyRouterParams009(e);var n=e.seekWidgetByName("window_gray"),a=t.core.pager.model.ApiDataListFactory("apiAUnions","getNews",[t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE]),o=n.seekWidgetByName(t.BtnsPageListParams.GUILD_NEWS.panelName),r=new t.core.pager.controller.PagerController(n,a,[],o),s=n.seekWidgetByName("viewpage_ui");return new t.core.pager.view.button.ViewPageUi(s,r).initialize(),r.addUpdateEventListener(this._update,o),r.initialize(),this._controller=r,r.initialize()},_update:function(e,t,n,i){this.getChildren().forEach(function(t,n){var i=e[n];if(i){var a=i.getRawData();t.setStrings({date_label:a.date,news_label:a.title}),t.setVisible(!0)}else t.setVisible(!1)})},onSceneExit:function(e){return i.defer(),this._controller&&this._controller.dispose(),i.resolve()},_touchEndedBackBtnProcess:function(e){this._navigateToGuildTop()}}),n.assign(t.pc.guild.gud_009.SceneDelegate.prototype,t.pc.guild.roles.Routing)}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.guild=t.pc.guild||{},t.pc.guild.gud_010_011_012=t.pc.guild.gud_010_011_012||{},t.pc.guild.gud_010_011_012.Scene=t.BaseScene.extend({resourceFileName:"gud_010_011_012/gud_010_011_012.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[{tab1:{node:"tab_0","content-node":"tab_0_node"},tab2:{node:"tab_1","content-node":"tab_1_node"},tab3:{node:"tab_2","content-node":"tab_2_node"}}],componentName:"guild",sceneName:"gud_010_011_012",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath("tab_0_node"),"btn_friend_search","btnCallbackTab0NodeBtnFriendSearch",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"friend/fr_002")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_update_list","btnCallbackBtnUpdateList",null,function(){alert("{{}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_search","btnCallbackBtnSearch",null,function(){alert("{{gud_011_dIDgud_011_b}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_re_search","btnCallbackBtnReSearch",null,function(){alert("{{gud_011_dIDgud_011_b}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._),i=e.Q;t.pc=t.pc||{},t.pc.guild=t.pc.guild||{},t.pc.guild.gud_010_011_012=t.pc.guild.gud_010_011_012||{},t.pc.guild.gud_010_011_012.SceneDelegate=t.pc.BaseSceneDelegate.extend({_popups:{popupConfirm:{factoryName:"popupFactoryBlackBlue",buttonLabels:{blackBtn:"",blueBtn:""},buttons:{blackBtn:function(e){this.dismiss()},blueBtn:function(e){this.dismiss()}}},popupResult:{factoryName:"popupFactoryBlue",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){this.dismiss()}}},alreadyJoinRequested:{factoryName:"popupFactoryBlue",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){this.dismiss().then(function(){t.createInstance("router").navigate("guild/gud_007_a",{gud_007:{id:"me",selectedTab:"tab_1"}})})}}}},LIST_SETTING:{baseNode:"tab_0_node",panelName:t.BtnsPageListParams.GUILD_FRIEND_SCOUT_FRIEND.panelName,apiName:"apiAFriends",methodName:"getList",apiParams:["all",t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE],viewClass:t.guild.view.GuildMemberFriendScoutPanel,btnPattern:"blue_only",touchFuncNames:{blue:"_onTouchFriendScoutBlueButton",user:"_onTouchUserButton"}},onSceneInit:function(e){this._setBackBtn(e),this._verifyRouterParams010_011_012(e),this._setFriendHeaderNum(e),this._checkAttentionLabel().then(function(t){if(t){var n=e.seekWidgetByPath("tab_0_node.attention_node");null!==n&&n.setVisible(!0);var i=e.seekWidgetByPath("tab_0_node.btn_friend_search");null!==i&&i.setVisible(!1);var a=e.seekWidgetByPath("tab_1_node.full_node");null!==a&&a.setVisible(!0)}}.bind(this)).fail(function(e){console.error(e.stack)}),this._initSearchPage(e);var t=e.routerParams.gud_010.selectedTab,n=e.tabDelegateList[0];return t?(n.selectTab(n._getContainerNode().seekWidgetByName(t)),i.resolve()):(n.selectTab(n._getContainerNode().getChildren()[0]),i.resolve())},onSceneEnter:function(e){return e.enableRestore(!1),e.tabDelegateList.forEach(function(e){e.preventInitialization()}),t.createInstance("apiAPlayers").getMeNumeric().then(function(e){return this.__waitForNodesLoaded().thenResolve(e)}.bind(this)).then(function(t){var n=t.body.a_player_id;this._setPlayerId(e.contentLayer,n)}.bind(this)).fail(function(e){console.error(e)}),i.resolve()},onSceneExit:function(e){return i.defer(),i.resolve()},onPageInAnimationEnd:function(e){return i.defer(),i.resolve()},tabCallbackTab0:function(e){if(!this._controller){var n=this.LIST_SETTING,i=e.seekWidgetByName(n.baseNode),a=i.seekWidgetByName(n.panelName),o=new n.viewClass(a,this,n.btnPattern,n.touchFuncNames,""),r=t.core.pager.model.ApiDataListFactory(this.LIST_SETTING.apiName,this.LIST_SETTING.methodName,this.LIST_SETTING.apiParams,t.core.pager.model.UserListData),s=new t.core.pager.controller.PagerController(i,r,[o],a),c=i.seekWidgetByName("viewpage_ui");new t.core.pager.view.button.ViewPageUi(c,s).initialize(),s.initialize(),this._controller=s}},tabCallbackTab1:function(e){this.btnCallbackBtnUpdateList(e)},tabCallbackTab2:function(e){},btnCallbackTab0NodeBtnFriendSearch:function(e){var t=i.defer();return t.resolve(),t.promise},btnCallbackBtnUpdateList:function(e){var t=i.defer();t.reject(this._override);var n=e.seekWidgetByPath("tab_1_node.search_node"),a=e.seekWidgetByPath("tab_1_node.full_node"),o=e.seekWidgetByPath("tab_1_node.list_node");return a.setVisible(!1),o.setVisible(!1),n.setVisible(!0),this._fillupGuildFriendScoutList(e).then(function(){n.setVisible(!1)}),t.promise},btnCallbackBtnSearch:function(e){var t=i.defer();return t.reject(this._override),this._findFriendById(e),t.promise},btnCallbackBtnReSearch:function(e){var t=i.defer();return t.reject(this._override),this._switchSearchPanels(e,"input"),t.promise},_checkAttentionLabel:function(){var e=t.createInstance("apiAUnions").getMe(),n=t.createInstance("apiAUnionScouts").getList();return i.all([e,n]).then(function(e){var t=e[0].body,n=e[1].body,i=t.member_count;return t.max_member_count<=i+n.max_record_count})},_onTouchUserButton:function(e,n,i){var a=n;n instanceof t.core.pager.model.PlainData&&(a=n.getRawData());var o=i.tabDelegateList[0].selected,r={prf_001:{id:a.a_player_id}},s={return_to_profile:{routes:"guild/gud_010",params:{gud_010:{selectedTab:o}}}};this._navigate010_011_012ToPRF001(i,a.a_player_id,r,s)},_onTouchFriendScoutBlueButton:function(e,t,n){var i=t.getRawData();this._confirmScoutMember(n,i)},_onTouchRecommendedBlueButton:function(e,t,n){this._confirmScoutMember(n,t)},_initSearchPage:function(e){if(n.isUndefined(this._searchBox)){var i=e.contentLayer.seekWidgetByName("input_node");if(null!==i){if(null!==i.seekWidgetByName("editbox_0"))return null===i.seekWidgetByName("text_window")?void console.warn("[ERROR] Could not find text_window."):(this._searchBox=t.EditBox.createEditBox(i,"text_window","editbox_0",20,"",{fontSize:24}),this._searchBox.setOnEditBoxReturnCallback(this.btnCallbackBtnSearch.bind(this,e),this),void i.setVisible(!0));console.warn("[ERROR] Could not find editbox_0.")}else console.warn("[ERROR] Could not find search UI.")}else this._searchBox.setText("")},_setPlayerId:function(e,t){var n=e.seekWidgetByPath("tab_2_node.id_label");null===n&&console.warn("[ERROR] Could not find id_label."),n.setString(t)},_findFriendById:function(e){var n=this._searchBox.getString();n=n.replaceFullWidthNumberToHalfWidth().replace(/\s/g,""),this._searchBox.setString(n),n.length>0&&(this._switchSearchPanels(e,"search"),t.createInstance("apiAFriends").getByAPlayerId(n).then(function(t){console.log(t.body);var n=t.body;0===n.max_record_count?this._switchSearchPanels(e,"input",!0):(this._fillupResultPanel(e,n.data[0]),this._switchSearchPanels(e,"result"))}.bind(this)).fail(function(e){console.error(e.stack)}))},_switchSearchPanels:function(e,t,i){var a=e.seekWidgetByPath("tab_2_node.input_node"),o=e.seekWidgetByPath("tab_2_node.result_node"),r=e.seekWidgetByPath("tab_2_node.search_node");return null===a||null===o||null===r?void console.warn("[ERROR] Could not find panel for switching."):(a.setVisible("input"==t),o.setVisible("result"==t),r.setVisible("search"==t),void("input"!=t||n.isUndefined(i)?"input"==t?this._searchBox.setText(""):a.seekWidgetByName("nothing_label")&&a.seekWidgetByName("nothing_label").setVisible(!1):a.seekWidgetByName("nothing_label")&&a.seekWidgetByName("nothing_label").setVisible(i)))},_fillupResultPanel:function(e,t){var n=e.seekWidgetByPath("tab_2_node.result_node.userlist_0_ui");return null===n?void console.warn("[ERROR] Could not find userlist panel."):void this._guildRecommendedPanelInitFunc(n,t,0)},_confirmScoutMember:function(e,n){this._checkBeforeScout(n).then(function(){var i=e.popups.popupConfirm;i.open().then(function(){i.setTitle(t.w("unionMember")+""),i.setContent(""+n.name+"<br /><span class='mini'><br />"+t.w("unionMember")+"</span>"),t.setTouchEventHandlers(i,{"TOUCH_ENDED blue_btn":function(){this._scoutMember(n),i.dismiss()}.bind(this)},this)}.bind(this)).fail(function(e){console.error(e.stack)})}.bind(this))},_fillupGuildFriendScoutList:function(e){var n=e.seekWidgetByName("tab_1_node");if(null!==n){var i=n.seekWidgetByName("change_page_panel");if(null!==i)return i.removeAllChildren(),t.createInstance("apiAUnionScoutsSearch").get(!0).then(function(i){var a=i.body.max_record_count;if(this._fillupList(n,{viewParent:t.PageListParams.GUILD_FRIEND_SCOUT_RECOMMEND.viewParent,subPageRes:t.PageListParams.GUILD_FRIEND_SCOUT_RECOMMEND.subPageRes,panelsPerPage:t.PageListParams.GUILD_FRIEND_SCOUT_RECOMMEND.perPage},i.body.data,i.body.max_record_count,void 0,this._guildRecommendedPanelInitFunc.bind(this)),0===a);else{var o=e.seekWidgetByPath("tab_1_node.list_node");null!==o&&o.setVisible(!0)}return i.body}.bind(this)).fail(function(e){console.error(e.stack)});console.warn("[ERROR] Could not find a list parent node.")}else console.warn("[ERROR] Could not find a parent node.")},_guildRecommendedPanelInitFunc:function(e,t,n){this._setUserList(e,t,"blue_only",{blue:"_onTouchRecommendedBlueButton",user:"_onTouchUserButton"}),null!==e.seekWidgetByName("btn_blue_s")&&e.seekWidgetByName("btn_blue_s").setTitleText(""),e.setVisible(!0)},_touchEndedBackBtnProcess:function(e){this._navigateToUnionMembers()}}),n.assign(t.pc.guild.gud_010_011_012.SceneDelegate.prototype,t.pc.roles.UIUtility,t.pc.guild.roles.Routing,t.pc.guild.roles.GuildCommon,t.pc.guild.roles.GuildScout,t.pc.guild.roles.GuildMemberBtnsListController,t.pc.list.roles.PageListControllerCommon,t.pc.list.roles.UserListCommon)}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.guild=t.pc.guild||{},t.pc.guild.gud_013_a=t.pc.guild.gud_013_a||{},t.pc.guild.gud_013_a.Scene=t.BaseScene.extend({resourceFileName:"gud_013/gud_013_a.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"guild",sceneName:"gud_013_a",_delegate:null,_init:function(){this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc=t.pc||{},t.pc.guild=t.pc.guild||{},t.pc.guild.gud_013_a=t.pc.guild.gud_013_a||{},t.pc.guild.gud_013_a.SceneDelegate=t.pc.BaseSceneDelegate.extend({_popups:{popupConfirm:{factoryName:"popupFactoryBlackBlue",buttonLabels:{blackBtn:"",blueBtn:"OK"},buttons:{blackBtn:function(e){this.dismiss()},blueBtn:function(e){this.dismiss()}}},popupResult:{factoryName:"popupFactoryBlue",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){this.dismiss()}}},popupMemberFire:{factoryName:"popupFactoryComMemberFire"}},LIST_SETTING:{baseNode:"window_gray",apiName:"apiAUnions",methodName:"getMembersForFire",viewClass:t.guild.view.GuildMemberFirePanel,btnPattern:"red_only",touchFuncNames:{red:"_onTouchMemberFireButton",user:"_onTouchUserButton"}},onSceneEnter:function(e){var n=t.core.pager.model.ApiDataListFactory(this.LIST_SETTING.apiName,this.LIST_SETTING.methodName,[t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE],t.core.pager.model.UserListData);return this._promise=a.all([n.initialize(1).thenResolve(n),this._getUnionInfoAboutMe()]),a.resolve()},onSceneInit:function(e){return a.defer(),this._setBackBtn(e),this._verifyRouterParams013(e),this._promise.spread(function(t){this._setUnionHeaderMemberNum(e),this._fillupGuildMemberBtnsListForFire(e,t)}.bind(this)).fail(function(e){if(e instanceof Error)throw e}).fin(function(){this._promise=null}.bind(this))},_fillupGuildMemberBtnsListForFire:function(e,n){if(!this._controller){var i=this.LIST_SETTING,a=e.seekWidgetByName(i.baseNode),o=a.seekWidgetByName("userlist_page_ui"),r=new i.viewClass(o,this,i.btnPattern,i.touchFuncNames,this._myUnionInfo.union_position),s=new t.core.pager.controller.PagerController(a,n,[r],o),c=a.seekWidgetByName("viewpage_ui");new t.core.pager.view.button.ViewPageUi(c,s).initialize(),s.initialize(),this._controller=s}},onSceneExit:function(e){return this._controller&&this._controller.dispose(),a.resolve()},onPageInAnimationEnd:function(e){return a.defer(),a.resolve()},_onTouchUserButton:function(e,t,n){var i=t.getRawData(),a={prf_001:{id:i.a_player_id}};this._navigate013ToPRF001(n,i.a_player_id,a,{return_to_profile:{routes:"guild/gud_013_a",params:{}}})},_onTouchMemberFireButton:function(e,t,i){var a=t.getRawData();(i=n.director.getRunningScene()).popups.popupMemberFire.open({scene:i,record:a}),console.log(a)},_confirmFireMember:function(e){var i=n.director.getRunningScene().popups.popupConfirm;i.open().then(function(){i.setTitle(""),i.setContent("<span class='red'></span>"),t.setTouchEventHandlers(i,{"TOUCH_ENDED blue_btn":function(){i.dismiss(),this._fireMember(e)}.bind(this)},this)}.bind(this)).fail(function(e){console.error(e.stack)})},_fireMember:function(e){t.createInstance("apiAUnions").fireMember(e.a_union_member_id).then(function(e){var t=n.director.getRunningScene(),i=t.popups.popupResult;i.open().then(function(){i.setTitle(""),i.setContent("")}.bind(this)).fail(function(e){console.error(e.stack)}),this._getUnionInfoAboutMe().then(function(e){this._setUnionHeaderMemberNum(t)}.bind(this)),this._controller.refresh(!1)}.bind(this)).fail(function(e){console.error(e.stack)})},_touchEndedBackBtnProcess:function(e){this._navigateToGuildTop()}}),i.assign(t.pc.guild.gud_013_a.SceneDelegate.prototype,t.pc.roles.UIUtility,t.pc.guild.roles.Routing,t.pc.guild.roles.GuildCommon,t.pc.guild.roles.GuildMemberBtnsListController)}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.guild=t.pc.guild||{},t.pc.guild.gud_013_b=t.pc.guild.gud_013_b||{},t.pc.guild.gud_013_b.Scene=t.BaseScene.extend({resourceFileName:"gud_013/gud_013_b.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"guild",sceneName:"gud_013_b",_delegate:null,_init:function(){this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc=t.pc||{},t.pc.guild=t.pc.guild||{},t.pc.guild.gud_013_b=t.pc.guild.gud_013_b||{},t.pc.guild.gud_013_b.SceneDelegate=t.pc.BaseSceneDelegate.extend({_popups:{popupConfirm:{factoryName:"popupFactoryBlackBlue",buttonLabels:{blackBtn:"",blueBtn:"OK"},buttons:{blackBtn:function(e){this.dismiss()},blueBtn:function(e){this.dismiss()}}},popupResult:{factoryName:"popupFactoryBlue",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){this.dismiss()}}},popupLeaderChange:{factoryName:"popupFactoryComLeaderChange"},popupLeaderChangeDone:{factoryName:"popupFactoryComLeaderChangeDone"}},LIST_SETTING:{baseNode:"window_gray",apiName:"apiAUnions",methodName:"getMembersForLeader",viewClass:t.guild.view.GuildMemberChangeLeaderPanel,btnPattern:"blue_only",touchFuncNames:{blue:"_onTouchSelectLeaderButton",user:"_onTouchUserButton"}},onSceneEnter:function(e){var n=t.core.pager.model.ApiDataListFactory(this.LIST_SETTING.apiName,this.LIST_SETTING.methodName,[t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE],t.core.pager.model.UserListData);return this._promise=a.all([n.initialize(1).thenResolve(n),this._getUnionInfoAboutMe()]),a.resolve()},onSceneInit:function(e){return this._setBackBtn(e),this._verifyRouterParams013(e),this._promise.spread(function(t){this._setUnionHeaderMemberNum(e),this._fillupGuildMemberBtnsListForLeader(e,t)}.bind(this)).fail(function(e){if(e instanceof Error)throw e}).fin(function(){this._promise=null}.bind(this))},_fillupGuildMemberBtnsListForLeader:function(e,n){if(!this._controller){var i=this.LIST_SETTING,a=e.seekWidgetByName(i.baseNode),o=a.seekWidgetByName("userlist_page_ui"),r=new i.viewClass(o,this,i.btnPattern,i.touchFuncNames,this._myUnionInfo.union_position),s=new t.core.pager.controller.PagerController(a,n,[r],o),c=a.seekWidgetByName("viewpage_ui");new t.core.pager.view.button.ViewPageUi(c,s).initialize(),s.initialize(),this._controller=s}},onSceneExit:function(e){return this._controller&&this._controller.dispose(),a.resolve()},_onTouchUserButton:function(e,t,n){var i=t.getRawData(),a={prf_001:{id:i.a_player_id}};this._navigate013ToPRF001(n,i.a_player_id,a,{return_to_profile:{routes:"guild/gud_013_b",params:{}}})},_onTouchSelectLeaderButton:function(e,t,i){var a=t.getRawData();(i=n.director.getRunningScene()).popups.popupLeaderChange.open({scene:i,record:a})},_changeLeader:function(e){t.createInstance("apiAUnions").changeLeader(e.a_union_member_id).then(function(t){var i=n.director.getRunningScene();i.popups.popupLeaderChangeDone.open({scene:i,record:e})}.bind(this)).fail(function(e){console.error(e.stack)})},_touchEndedBackBtnProcess:function(e){this._navigateToGuildTop()}}),i.assign(t.pc.guild.gud_013_b.SceneDelegate.prototype,t.pc.roles.UIUtility,t.pc.guild.roles.Routing,t.pc.guild.roles.GuildCommon)}((this||0).self||global),function(e){var t=e._,n=e.kh;e.cc,e.ccui,n.PopupFactoryComOpenJobEpisode=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-com_open_episode",title:"",buttonLabels:{blackBtn:""},buttons:{blackBtn:function(e){this.dismiss()}}},POPUP_METHODS:{},onPopupOpened:function(e,i){this._popup=e,this._job=i.job,console.log(i);var a=n.createInstance("voiceLoader"),o=n.IDList.VOICES.JOIN_PARTY;a.loadJobVoices(this._job.job_id,o.LOWER,o.UPPER).then(function(e){n.createInstance("soundPlayer").playVoice(t.sample(e))}),this._loadContent()},_loadContent:function(){var e=this._popup,t=this._job,i=n.createInstance("CoreCardJobUI");i.setImg(t.job_id,0);var a=i.getResult();e.seekWidgetByName("core_img").addChild(a),e.seekWidgetByName("core_img").setVisible(!0),e.setStrings({harlem_release_label:t.name+""})}})}((this||0).self||global),function(e){var t=e.kh;t.WordBook=t.WordBook||{},t.WordBook.highjob={PHASE_NAME:["","","","","",""]}}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);t.createNameSpaceIfNotExists("highjob.view"),t.highjob.view.HighjobChangePopup=t.ImplantedPopup.extend(t.pc.list.roles.PageListControllerCommon).extend({_initContents:function(e){this.setButtonEvents({btn_close:!1}),this.getNode().bfsWidgetByName("btn_close").setSound(t.SoundList.BUTTON_TOUCHED_CANCEL),this.getNode().bfsWidgetByName("btn_up").setSound(t.SoundList.BUTTON_TOUCHED_SWITCH),this.getNode().bfsWidgetByName("btn_down").setSound(t.SoundList.BUTTON_TOUCHED_SWITCH),this._fillupList(this.getNode(),t.PageListParams.HIGHJOB_CHANGE_LIST,e.getAllContent(),e.getMaxRecordCount(),{targetNode:"joblist_job",touchEventFuncName:"_touchJobList"},this._updateJobListView.bind(this))},_touchJobList:function(e,t){this._dfd.resolve(e.getUserData().index),this.dismiss(!0)},_updateJobListView:function(e,i,a){var o=i.getClassSJob(),r=o.skin||0,s=t.Img("joblist","job",n.padZero(o.job_id,4),r).png,c=e.seekWidgetByName("joblist_job");c.loadTextures(s,s,s),c.getParent().setAppearance(o.is_acquired?"released":"default_view"),e.setUserData({index:a})}}),t.dictx.registerWithProtoStrategy("HighjobChangePopup",t.highjob.view.HighjobChangePopup)}((this||0).self||global),function(e){var t=e.kh;e.cc,e._,t.createNameSpaceIfNotExists("highjob.view"),t.highjob.view.HighjobStepCheckDoPopup=t.ImplantedPopup.extend({FINAL_PHASE:5,_initContents:function(e,n,i){this.setButtonEvents({btn_cancel:!1,btn_ok:!0,btn_close:!1});var a=this.getNode();a.bfsWidgetByName("btn_cancel").setSound(t.SoundList.BUTTON_TOUCHED_CANCEL),a.bfsWidgetByName("btn_close").setSound(t.SoundList.BUTTON_TOUCHED_CANCEL);var o=e.getSelectedRestoreData(),r=o.canUseWeapon(n);this._setPopupType(a,o,r,i);var s=o.getMaterialInfo(i);a.bfsWidgetByName("need_item_panel").getChildren().filter(function(e){return 0===e.getName().indexOf("corecard_item_ui_")}).forEach(this._updateItemCoreCard.bind(this,o,r,i),this);var c="";if(i!==this.FINAL_PHASE||r?o.getPhase()===i&&(c=this._checkAttention(e,i)):c=o.getNeedJobName()+"\n",a.setStrings({title_label:t.WordBook.highjob.PHASE_NAME[i],attention_label:c}),t.pc.roles.UIUtility._setEnableButton(a.bfsWidgetByName("btn_ok"),!c),r){var u=a.bfsWidgetByName("corecard_weapon_ui_before"),l=t.createInstance("CoreCardWeaponUI",["e_r",u]);n.updateCoreCard(o,l),l.setPlusNoVisible(!1),l.addTouchEventListener(this._touchWeaponCoreCard.bind(this,n.getRawWeaponData()));var _=o.getWeaponInfo().getByBaseWeaponId(n.getWeaponId()),p=a.bfsWidgetByName("corecard_weapon_ui_after"),d=t.createInstance("CoreCardWeaponUI",["e_r",p]);d.setData(_),d.addTouchEventListener(this._touchWeaponCoreCard.bind(this,_))}var h=a.bfsWidgetByName("need_gem_labelimg");h.setVisible(!1),a.setHtmlStrings({need_gem_labelimg:'<div style="padding-top:0.5em"><span class="orange"></span><span class="white">'+s.getNeedGem()+"</span></div>"},t.GameConfig.POPUP_CSS).then(h.setVisible.bind(h,!0))},_setPopupType:function(e,t,n,i){return n&&5===i&&5===t.getPhase()?void e.setAppearance("highjob_step_do_b"):i===this.FINAL_PHASE?void e.setAppearance("highjob_step_check_b"):i===t.getPhase()?void e.setAppearance("highjob_step_do_a"):void e.setAppearance("highjob_step_check_a")},_updateItemCoreCard:function(e,n,i,a,o){var r=e.getMaterialInfo(i).getMaterials()[o];if(r){var s=t.createInstance("CoreCardItemUI",["plain",a]);return s.setData(r),s.addTouchEventListener(this._touchItemCoreCard.bind(this,r)),s.setVisible(!0),s.setGrayout(!1),e.getPhase()!==i||i===this.FINAL_PHASE&&!n?void s.setAmount(String(r.need_amount),!0):(s.setGrayout(r.has_amount<r.need_amount),void s.setAmount(r.has_amount+"/"+r.need_amount,!0))}a.setVisible(!1)},_touchItemCoreCard:function(e,n,i){if(i===ccui.Widget.TOUCH_ENDED){var a=this._getScene();t.ImplantedPopup.create(a,"sh_item_info_on_highjob_step_check_do","ItemInfoOnStepCheckDoPopup").open(e)}},_touchWeaponCoreCard:function(e,n,i){if(i===ccui.Widget.TOUCH_ENDED){var a=this._getScene();t.ImplantedPopup.create(a,"sh_weapon_info_on_highjob_step_check_do","WeaponInfoOnStepCheckDoPopup").open(e)}},_checkAttention:function(e,t){var n=[],i=e.getSelectedRestoreData().getMaterialInfo(t);return i.enoughAll()||n.push(""),e.enoughGem(i.getNeedGem())||n.push(""),n.join("\n")}}),t.dictx.registerWithProtoStrategy("HighjobStepCheckDoPopup",t.highjob.view.HighjobStepCheckDoPopup)}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;t.createNameSpaceIfNotExists("highjob.view"),t.highjob.view.HighjobWeaponCheckPopup=t.ImplantedPopup.extend({_restoreWeaponInfoModel:null,_initContents:function(e){this._restoreWeaponInfoModel=e;this.setButtonEvents({btn_close:!1}),this.getNode().bfsWidgetByName("btn_close").setSound(t.SoundList.BUTTON_TOUCHED_CANCEL);var n=e.getWeaponTypes();1===n.length?this.getNode().setStrings({label_weapon_type_1:this._getWeaponTypeString(n[0])+"1",label_weapon_type_2:this._getWeaponTypeString(n[0])+"2"}):this.getNode().setStrings({label_weapon_type_1:this._getWeaponTypeString(n[0]),label_weapon_type_2:this._getWeaponTypeString(n[1])});var i=this.getNode().bfsWidgetByName("tab_weapon_type_1"),a=this.getNode().bfsWidgetByName("tab_weapon_type_2");i.addTouchEventListener(this._touchTab.bind(this,1,a),this),a.addTouchEventListener(this._touchTab.bind(this,2,i),this),this._touchTab(1,a,i,ccui.Widget.TOUCH_ENDED)},_getWeaponTypeString:function(e){return i.find(t.WordBook.WEAPON_TYPE_FILTER_CONDITION,function(t){return t.value===e},{}).text},_touchTab:function(e,i,a,o){if(o===ccui.Widget.TOUCH_ENDED){a.setBright(!1),i.setBright(!0);var r,s=this.getNode().getChildren().filter(function(e){return 0===e.getName().indexOf("corecard_weapon_ui_")}),c=this._restoreWeaponInfoModel.getWeaponTypes()[e-1];2!==e||c?r=this._restoreWeaponInfoModel.getWeaponArray(c):r=(r=this._restoreWeaponInfoModel.getWeaponArray(this._restoreWeaponInfoModel.getWeaponTypes()[0])).slice(s.length),s.forEach(function(e,i){if(r[i]){var a=t.createInstance("CoreCardWeaponUI",["e_r",e]);a.setData(r[i]),a.addTouchEventListener(function(){var e=n.director.getRunningScene();t.ImplantedPopup.create(e,"sh_weapon_info_on_highjob_weapon_check","WeaponInfoOnWeaponCheckPopup").open(r[i])}),a.setVisible(!0)}else e.setVisible(!1)},this)}}}),t.dictx.registerWithProtoStrategy("HighjobWeaponCheckPopup",t.highjob.view.HighjobWeaponCheckPopup)}((this||0).self||global),function(e){var t=e.kh;e.cc,e._,t.createNameSpaceIfNotExists("highjob.view"),t.highjob.view.HighjobWeaponGetPopup=t.ImplantedPopup.extend({_initContents:function(e){var n=e.getReleasedWeapon().getRawData();this.setButtonEvents({btn_ok:!0});var i=this.getNode().bfsWidgetByName("corecard_weapon_ui");t.createInstance("CoreCardWeaponUI",["e_r",i]).setData(n);var a=this.getNode().bfsWidgetByName("get_labelimg");a.setVisible(!1),a.getParent().setHtmlStrings({get_labelimg:'<div style="padding-top:0.5em"><span class="yellow">'+n.name+'</span><span class="white"></span></div>'},t.GameConfig.POPUP_CSS).then(a.setVisible.bind(a,!0))}}),t.dictx.registerWithProtoStrategy("HighjobWeaponGetPopup",t.highjob.view.HighjobWeaponGetPopup)}((this||0).self||global),function(e){var t=e.kh;e.cc,e._,t.createNameSpaceIfNotExists("highjob.view"),t.highjob.view.HighjobStepDoConfirmPopup=t.ImplantedPopup.extend({FINAL_PHASE:5,_initContents:function(e){var n={btn_cancel:function(){this._dismissAnimationName="highjob_step_check_do",this._closeAnimationEndHandler=function(){this._uiNode.setVisible(!0)},this.dismiss(!1)}.bind(this),btn_ok:!0};this.setButtonEvents(n),this.getNode().bfsWidgetByName("phase_name_label").setString(t.WordBook.highjob.PHASE_NAME[e]),this.getNode().setAppearance(e<this.FINAL_PHASE?"preparation_phase":"final_phase")}}),t.dictx.registerWithProtoStrategy("HighjobStepDoConfirmPopup",t.highjob.view.HighjobStepDoConfirmPopup)}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.createNameSpaceIfNotExists("highjob.view"),t.highjob.view.WeaponInfoOnWeaponCheckPopup=t.core.item.ShWeaponInfoPopup.extend({_dismissAnimationName:"highjob_weapon_check",_closeAnimationEndHandler:function(){this._uiNode.setVisible(!0)}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.createNameSpaceIfNotExists("highjob.view"),t.highjob.view.ItemInfoOnStepCheckDo=t.core.item.ShItemInfoPopup.extend({_dismissAnimationName:"highjob_step_check_do",_closeAnimationEndHandler:function(){this._uiNode.setVisible(!0)}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.createNameSpaceIfNotExists("highjob.view"),t.highjob.view.WeaponInfoOnStepCheckDo=t.core.item.ShWeaponInfoPopup.extend({_dismissAnimationName:"highjob_step_check_do",_closeAnimationEndHandler:function(){this._uiNode.setVisible(!0)}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.highjob=t.highjob||{},t.highjob.model=t.highjob.model||{},t.highjob.model.ADeviceRepository={get:function(e){return t.createInstance("apiAJobs").getADevice().then(function(n){var i=Number(n.body.account_id||n.headers["kh-player-id"]||0),a=e||Number(cc.sys.localStorage.getItem("ADevice-SelectedJobId-"+i));return new t.highjob.model.ADevice(n.body,i,a)})},getLastPhase:function(e,n){return t.createInstance("apiAJobs").getADeviceLastPhase(e,n).then(function(e){return e.body[0]})},develop:function(e,n,i){return t.createInstance("apiAJobs").develop(e,n,i).then(function(e){return new t.highjob.model.AJobDevelop(e.body)}).fail(function(a){var o=t.createInstance("smartBeat");return o.log("jobGroupId:"+e),o.log("phase:"+n),o.log("aWeaponId:"+i),o.log("headers:"+JSON.stringify(a.headers)),o.sendError(a),new t.highjob.model.AJobDevelop({result:!1,reason:a.status+": Error"})})},persistSelect:function(e,t){cc.sys.localStorage.setItem("ADevice-SelectedJobId-"+e,t.getSelectedRestoreData().getClassSJob().job_id)}}}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.highjob=n.highjob||{},n.highjob.model=n.highjob.model||{},n.highjob.model.ADevice=n.EventSubject.extend({className:"ADevice",EVENT_PREFIX:"a_device_",EVENT_NAME:{MODEL_UPDATED:"model_update"},_fetchComplete:!0,_hasGem:null,_selectIndex:0,_episodeId:null,ctor:function(e,i,a){this._super(),this._hasGem=e.gem||0,this._cachedModels=e.device_info.map(function(e){return new n.highjob.model.ARestoreData(e)}),this._accountId=i,this._episodeId=e.episode_id,a&&(this._selectIndex=Math.max(t.findIndex(e.device_info,function(e){return e.job.job_id===a}),0))},getFirstEpisodeId:function(){return this._episodeId||"4901_prologue"},isFirstDevelopEnd:function(){return this._cachedModels.filter(function(e){return e.getPhase()>1}).length>0},getSelectedRestoreData:function(){return this._cachedModels[this._selectIndex]},selectByIndex:function(e){var t=this.getMaxRecordCount();this._selectIndex=(t+e)%t,this.notifyModelUpdate(),this.saveSelectJob()},prev:function(){this.selectByIndex(this._selectIndex-1)},next:function(){this.selectByIndex(this._selectIndex+1)},notifyModelUpdate:function(){this.dispatchEvent("MODEL_UPDATED",[this.getSelectedRestoreData(),this.createPageNumString()])},createPageNumString:function(){return this._selectIndex+1+"/"+this._cachedModels.length},enoughGem:function(e){return this._hasGem>=e},getAllContent:function(){return[].concat(this._cachedModels)},getMaxRecordCount:function(){return this._cachedModels.length},forEach:function(e){this._cachedModels.forEach(e)},update:function(e){this._hasGem=e._hasGem,this._cachedModels=e._cachedModels,this.notifyModelUpdate()},updatePhaseMaterials:function(e,t){this._cachedModels[this._selectIndex].updateMaterialInfo(e,t)},saveSelectJob:function(){n.highjob.model.ADeviceRepository.persistSelect(this._accountId,this)},dispose:function(){this.removeAllEventListeners(),n.cleanupProperties(this)}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.highjob=t.highjob||{},t.highjob.model=t.highjob.model||{},t.highjob.model.ARestoreData=t.core.pager.model.PlainData.extend({_restoreWeaponInfo:null,_restoreMaterialInfo:null,ctor:function(e){this._super(e),this._jobGroupId=e.job_group_id,this.canRestore()&&(this._restoreWeaponInfo=new t.highjob.model.RestoreWeaponInfo(e.weapon_info),this._restoreMaterialInfo=e.material_info.map(function(e){return new t.highjob.model.RestoreMaterialInfo(e)}))},getJobGroupId:function(){return this._jobGroupId},getClassSJob:function(){return this._rawData.job},getNeedJobName:function(){return this._rawData.need_job_name},canRestore:function(){return!0===this._rawData.can_restore},getPhase:function(){return this._rawData.phase||0},getWeaponInfo:function(){return this._restoreWeaponInfo},getMaterialInfo:function(e){return this._restoreMaterialInfo.filter(function(t){return t.equalPhase(e)})[0]},develop:function(e){return t.highjob.model.ADeviceRepository.develop(this.getJobGroupId(),this.getPhase(),e)},updateMaterialInfo:function(e,n){this._restoreMaterialInfo[n-1]=new t.highjob.model.RestoreMaterialInfo(e)},getByBaseWeaponId:function(e){return this.getWeaponInfo().getByBaseWeaponId(e)},canUseWeapon:function(e){return!(!e||e.isEmpty())&&e.getJobGroupId()===this.getJobGroupId()&&this.getWeaponInfo().containsBaseWeapon(e.getWeaponId())}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.highjob=t.highjob||{},t.highjob.model=t.highjob.model||{},t.highjob.model.RestoreMaterialInfo=cc.Class.extend({_rawData:null,ctor:function(e){this._rawData=e},getNeedGem:function(){return this._rawData.need_gem||0},getMaterials:function(){return this._rawData.materials.map(function(e){return Object.assign({has_amount:e.has_amount,need_amount:e.need_amount},e.game_item)})},enoughAll:function(){return 0===this._rawData.materials.filter(function(e){return e.has_amount<e.need_amount}).length},equalPhase:function(e){return this._rawData.phase===e}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.highjob=t.highjob||{},t.highjob.model=t.highjob.model||{},t.highjob.model.RestoreWeaponInfo=cc.Class.extend({_weaponTypes:null,_rawData:null,ctor:function(e){this._rawData=e,this._weaponTypes=this._rawData.map(function(e){return e.weapon_type}).filter(function(e,t,n){return n.indexOf(e)===t})},getWeaponTypes:function(){return this._weaponTypes},getWeaponArray:function(e){return this._rawData.filter(function(t){return t.weapon_type===e})},getByBaseWeaponId:function(e){return this._rawData.filter(function(t){return t.base_weapon_id===e})[0]},containsBaseWeapon:function(e){return!!this.getByBaseWeaponId(e)}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.highjob=t.highjob||{},t.highjob.model=t.highjob.model||{},t.highjob.model.AJobDevelop=cc.Class.extend({ctor:function(e){this._data=e},isSuccess:function(){return!0===this._data.result},getErrorReason:function(){return this._data.reason},isReleaseHighJob:function(){return this._data.is_release},getReleasedWeapon:function(){return new t.core.model.AWeapon(this._data.released_weapon)},getADevice:function(){return new t.highjob.model.ADevice(this._data||[])}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.highjob=t.highjob||{},t.highjob.model=t.highjob.model||{},t.highjob.model.SelectAWeapon=cc.Class.extend({ctor:function(e,t){this._aWeaponId=e.a_weapon_id||null,this._aWeaponId&&(this._weaponData=e,this._jobGroupId=t)},isEmpty:function(){return null===this._aWeaponId},getAWeaponId:function(){return this._aWeaponId},getJobGroupId:function(){return this._jobGroupId},getWeaponId:function(){return this._weaponData.weapon_id},getRawWeaponData:function(){return Object.assign({},this._weaponData)},updateCoreCard:function(e,t){return this.isEmpty()||!e.canUseWeapon(this)?void t.setVisible(!1):void t.setData(this._weaponData)},clear:function(){this._aWeaponId=null}}),t.highjob.model.SelectAWeaponRepository={get:function(e,n){return n&&n.a_weapon_id?n.rare&&n.weapon_id&&"number"==typeof n.element_type&&n.burst&&n.skills?Q.resolve(new t.highjob.model.SelectAWeapon(n,e)):t.createInstance("apiAWeapons").get(n.a_weapon_id).then(function(n){return new t.highjob.model.SelectAWeapon(n.body,e)},function(e){var i=t.createInstance("smartBeat");return i.log("highjob_main: getSelectAWeapon Response/"+JSON.stringify(e.body)),i.log("highjob_main: getSelectAWeapon Request/"+JSON.stringify(n)),i.sendError("highjob_main: getSelectAWeapon - Error"),new t.highjob.model.SelectAWeapon({},null)}):Q.resolve(new t.highjob.model.SelectAWeapon({},null))}}}((this||0).self||global);var KHRouter;__extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();!function(e){var t=function(t){function n(e,n,i,a,o,r,s){void 0===a&&(a=-1);var c=t.call(this)||this;return c._sceneClassName="HighJobNavigate",c._sceneName=e,c._aPartyId=n,c._returnSceneNavigate=i,c._selectJobId=a||null,c._classAJobName=o,c._jobGroupId=r,c._aWeapon=s,c}return __extends(n,t),n.makeToMain=function(t,i,a,o){return i instanceof e.SceneNavigate?new n("highjob_main",t,i,o):new n("highjob_main",t,new kh.router.PartyNavigate(i.split("/")[1],t,a),o)},n.makeFromHistory=function(e){var t=e._returnSceneNavigate,n=kh.router[t._sceneClassName].makeFromHistory(t);return new this(e._sceneName,e._aPartyId,n,e._selectJobId,e._classAJobName,e._jobGroupId)},n.makeFromTemporaryRouterParams=function(e){return void 0===e&&(e={}),new n("highjob_main",e.party_id,new kh.router.PartyNavigate(e.returnRoute.split("/")[1],e.returnRouterParams.party_id,e.returnRouterParams))},n.prototype.getAPartyId=function(){return this._aPartyId},n.prototype.getSelectJobId=function(){return this._selectJobId},n.prototype.getClassAJobName=function(){return this._classAJobName},n.prototype.getJobGroupId=function(){return this._jobGroupId},n.prototype.getSelectedAWeapon=function(){return this._aWeapon||{}},n.prototype.getFragment=function(){return"highjob/"+this.getSceneName()},n.prototype.getSceneName=function(){return this._sceneName},n.prototype.canHistory=function(){return"highjob_main"===this.getSceneName()},n.prototype.toMain=function(e){return new n("highjob_main",this._aPartyId,this._returnSceneNavigate,void 0,void 0,this._jobGroupId,e||this._aWeapon)},n.prototype.toWeaponSelect=function(e,t){return new n("highjob_weapon_select",this._aPartyId,this._returnSceneNavigate,void 0,t,e,this._aWeapon)},n.prototype.toDetail=function(e){return kh.router.PartyNavigate.makeTo008(this._aPartyId,e,{isFromHighJob:!0,highjob_main:this.getTemporaryRouterParams()})},n.prototype.back=function(){kh.createInstance("router").navigate(this._returnSceneNavigate.toParty007("S"))},n.prototype.getReturnSceneNavigate=function(){return this._returnSceneNavigate},n.prototype.getTemporaryRouterParams=function(){return{party_id:this._aPartyId,returnRoute:this._returnSceneNavigate.getFragment(),returnRouterParams:this._returnSceneNavigate.getTemporaryRouterParams()}},n}(e.SceneNavigate);kh.router.HighJobNavigate=t}(KHRouter||(KHRouter={})),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.highjob=t.pc.highjob||{},t.pc.highjob.highjob_main=t.pc.highjob.highjob_main||{},t.pc.highjob.highjob_main.Scene=t.BaseScene.extend({resourceFileName:"highjob_main/highjob_main.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"highjob",sceneName:"highjob_main",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_detail","btnCallbackBtnDetail",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"party/par_004")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_job-select","btnCallbackBtnJobSelect",null,function(){alert("{{highjob_change}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_hint","btnCallbackBtnHint",null,function(){alert("{{}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_prev","btnCallbackBtnPrev",null,function(){alert("{{}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_next","btnCallbackBtnNext",null,function(){alert("{{}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_1st_phase","btnCallbackBtn1StPhase",null,function(){alert("{{1highjob_step_dohighjob_step_check}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_2nd_phase","btnCallbackBtn2NdPhase",null,function(){alert("{{2highjob_step_dohighjob_step_check}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_3rd_phase","btnCallbackBtn3RdPhase",null,function(){alert("{{3highjob_step_dohighjob_step_check}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_4th_phase","btnCallbackBtn4ThPhase",null,function(){alert("{{4highjob_step_dohighjob_step_check}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_5th_phase","btnCallbackBtn5ThPhase",null,function(){alert("{{5highjob_step_dohighjob_step_check}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_weapon_check","btnCallbackBtnWeaponCheck",null,function(){alert("{{highjob_weapon_check}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"corecard_touch_panel","btnCallbackCorecardTouchPanel",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"highjob/highjob_weapon_select")),this._initScene("page_in")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q,o=e.res;t.pc=t.pc||{},t.pc.highjob=t.pc.highjob||{},t.pc.highjob.highjob_main=t.pc.highjob.highjob_main||{},$staticRes(o["highjob-highjob_ani-emblem_ui"]),$staticRes(o["highjob-highjob_ani-highjob_ani"]),t.pc.highjob.highjob_main.SceneDelegate=t.pc.BaseSceneDelegate.extend({_popups:{popupOpenEpisode:{factoryName:"popupFactoryComOpenJobEpisode"}},onSceneInit:function(e){this._setBackBtn(e);var n=e.seekWidgetByName("Scene");this._aDeviceModel.addEventListener("MODEL_UPDATED",this._updateView,{contentLayer:n,sceneDelegate:this}),this._aDeviceModel.notifyModelUpdate();var i=e.bfsWidgetByName("change_base"),o=i.getChildByName("btn_prev"),r=i.getChildByName("btn_next");return o.setSound(t.SoundList.BUTTON_TOUCHED_SWITCH),o.setLockTimeout(.3),r.setSound(t.SoundList.BUTTON_TOUCHED_SWITCH),r.setLockTimeout(.3),e.temporaryRouterParams.playedEpisode?t.createInstance("apiASubTutorialPages").visited("highjob").then(function(){this.btnCallbackBtnHint(e)}.bind(this)):this._subTutorialPromise?this._subTutorialPromise.then(this._firstAccessInit.bind(this,e)):a.resolve()},onSceneEnter:function(e){var n=e.temporaryRouterParams.highjob_main;!n&&e._sceneNavigate instanceof t.router.HighJobNavigate||(e._sceneNavigate=t.router.HighJobNavigate.makeFromTemporaryRouterParams(n));var i=e._sceneNavigate,o=t.highjob.model.ADeviceRepository.get(i.getSelectJobId()).then(function(n){return this._aDeviceModel=n,!this._aDeviceModel.getFirstEpisodeId()||n.isFirstDevelopEnd()||e.temporaryRouterParams.playedEpisode||(this._subTutorialPromise=t.createInstance("apiASubTutorialPages").get("highjob")),a.all([this._subTutorialPromise,this._preLoadImage(n)])}.bind(this)),r=t.highjob.model.SelectAWeaponRepository.get(i.getJobGroupId(),i.getSelectedAWeapon()).then(function(e){this._selectAWeaponModel=e}.bind(this));return a.all([o,r])},_firstAccessInit:function(e,n){var i=this._aDeviceModel.getFirstEpisodeId();if(!n.body.visited&&null!==i)return t.createInstance("router").navigate("scenario/episode-play",{"scenario/play":{episode_id:i,returnBackParams:{scene:"highjob/highjob_main",routerParams:e.routerParams,temporaryRouterParams:{playedEpisode:!0,highjob_main:e._sceneNavigate.getTemporaryRouterParams()}}}}),a.reject()},_preLoadImage:function(e){var o=[];return e.forEach(function(e){var r=e.getClassSJob(),s=t.Img("illust-com-kneeshot","job",i.padZero(r.job_id,4),0).png,c=t.Img("joblist","job",i.padZero(r.job_id,4),r.skin||0).png,u=a.defer();n.loader.loadImg(s,function(){u.resolve()});var l=a.defer();n.loader.loadImg(c,function(){l.resolve()}),o.push(u.promise),o.push(l.promise)}),a.all(o)},onSceneExit:function(e){return this._aDeviceModel&&this._aDeviceModel.dispose(),this._selectAWeaponModel&&this._selectAWeaponModel.clear(),t.createInstance("router").permanentlyRemoveRouterParamByPath("highjob_main.selectWeapon",!0),a.resolve()},_updateView:function(e,n){var a=e.getClassSJob();this.contentLayer.setStrings({header_sub_label:a.name,page_num:n});var o=t.Img("illust-com-kneeshot","job",i.padZero(a.job_id,4),0).png;this.contentLayer.bfsWidgetByName("illust-com-kneeshot_job").loadTexture(o);var r=this.contentLayer.bfsWidgetByName("attention_base");r.setVisible(!e.canRestore());var s=5===e.getPhase(),c=this.contentLayer.bfsWidgetByName("highjob_main_phase_ui");c.setAppearance(s?"final_phase":e.canRestore()?"preparation_phase":"prohibited");var u=c.bfsWidgetByName("corecard_weapon_ui");if(u.setVisible(!1),e.canRestore()){if(this.sceneDelegate._updatePhaseButton(e,c.getChildByName("btn_1st_phase"),1),this.sceneDelegate._updatePhaseButton(e,c.getChildByName("btn_2nd_phase"),2),this.sceneDelegate._updatePhaseButton(e,c.getChildByName("btn_3rd_phase"),3),this.sceneDelegate._updatePhaseButton(e,c.getChildByName("btn_4th_phase"),4),this.sceneDelegate._updatePhaseButton(e,c.getChildByName("btn_5th_phase"),5),s){u.setVisible(!0);var l=t.createInstance("CoreCardWeaponUI",["e_r",u]);this.sceneDelegate._selectAWeaponModel.updateCoreCard(e,l)}}else r.bfsWidgetByName("attention_label").setString(e.getNeedJobName()+" Lv20")},_touchEndedBackBtnProcess:function(e){e._sceneNavigate.back()},_updatePhaseButton:function(e,t,n){var i=e.getPhase(),a="highjob/res/highjob_"+t.getName();return i>n||5===n&&e.getClassSJob().is_acquired?(t.loadTextureNormal(a+"_blue_1.png",ccui.Widget.PLIST_TEXTURE),void t.loadTexturePressed(a+"_blue_2.png",ccui.Widget.PLIST_TEXTURE)):i===n?(t.loadTextureNormal(a+"_red_1.png",ccui.Widget.PLIST_TEXTURE),void t.loadTexturePressed(a+"_red_2.png",ccui.Widget.PLIST_TEXTURE)):(t.loadTextureNormal(a+"_gray_1.png",ccui.Widget.PLIST_TEXTURE),void t.loadTexturePressed(a+"_gray_2.png",ccui.Widget.PLIST_TEXTURE))},btnCallbackBtnDetail:function(e){var t=this._aDeviceModel.getSelectedRestoreData().getClassSJob();return e._sceneNavigate.toDetail(t.job_id).navigate(),a.reject(this._override)},btnCallbackBtnJobSelect:function(e){return t.ImplantedPopup.createOrGet(e,"highjob_change","HighjobChangePopup").open(this._aDeviceModel).then(function(e){this._aDeviceModel.selectByIndex(e)}.bind(this)).fail(function(e){e&&console.error(e)}),a.reject(this._override)},btnCallbackBtnHint:function(e){return t.ImplantedPopup.createOrGet(e,"sub_tutorial","ImplantedSubTutorialPopup").open("highjob",2),a.reject(this._override)},btnCallbackBtnPrev:function(e){return this._aDeviceModel.prev(),a.reject(this._override)},btnCallbackBtnNext:function(e){return this._aDeviceModel.next(),a.reject(this._override)},btnCallbackBtn1StPhase:function(e){return this._doBtn(e,1),a.reject(this._override)},btnCallbackBtn2NdPhase:function(e){return this._doBtn(e,2),a.reject(this._override)},btnCallbackBtn3RdPhase:function(e){return this._doBtn(e,3),a.reject(this._override)},btnCallbackBtn4ThPhase:function(e){return this._doBtn(e,4),a.reject(this._override)},btnCallbackBtn5ThPhase:function(e){if(this._aDeviceModel.getSelectedRestoreData().canUseWeapon(this._selectAWeaponModel)){var n=this._selectAWeaponModel.getWeaponId(),i=this._selectAWeaponModel.getJobGroupId();t.highjob.model.ADeviceRepository.getLastPhase(n,i).then(function(t){this._updateLastPhase(t),this._doBtn(e,5)}.bind(this)).fail(function(e){console.error(e)})}else this._doBtn(e,5);return a.reject(this._override)},_updateLastPhase:function(e){this._aDeviceModel.updatePhaseMaterials(e,5)},_doBtn:function(e,n){t.ImplantedPopup.create(e,"highjob_step_check_do").open(this._aDeviceModel,this._selectAWeaponModel,n).then(function(){var i=t.ImplantedPopup.create(e,"highjob_step_do_confirm_on_highjob_step_check_do","HighjobStepDoConfirmPopup").open(n);return i.fail(this._doBtn.bind(this,e,n)),i}.bind(this)).then(function(){var t=this._aDeviceModel.getSelectedRestoreData(),n=this._selectAWeaponModel;return t.canUseWeapon(n)?t.develop(n.getAWeaponId()).then(function(t){return n.clear(),e._sceneNavigate=e._sceneNavigate.toMain({}),t}):t.develop()}.bind(this)).then(function(i){if(i.isSuccess()){var o=i.getADevice();if(this._aDeviceModel.update(o),5!==n)return;return a.fcall(function(){if(!i.isReleaseHighJob())return t.ImplantedPopup.create(e,"highjob_weapon_get").open(i),a.reject();var n=this._aDeviceModel.getSelectedRestoreData();return this._playHighJobReleaseAnimation(e,n.getClassSJob())}.bind(this)).then(function(){return t.ImplantedPopup.create(e,"highjob_weapon_get").open(i)}).then(function(){var t=this._aDeviceModel.getSelectedRestoreData();return e.popups.popupOpenEpisode.open({job:t.getClassSJob()})}.bind(this))}var r=t.createInstance("popupFactoryTextOnly"),s={title:"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(){this.dismiss()}},content:i.getErrorReason()};return r.create(s).open()}.bind(this)).fail(function(e){e&&console.error(e)})},_playHighJobReleaseAnimation:function(e,r){var s=o["highjob-highjob_ani-highjob_ani"],c=t.createInstance("WindowVisualEffect").init(s),u=c.getNode();if(!u)return a.reject(new Error("HighJobReleaseAnimationNode is not found."));t.createInstance("soundPlayer").init(t.createInstance("playerGameConfig")),t.createInstance("Sound2Event",[c]),u.bfsWidgetByName("light_spread_1").setBlendFunc(1,1),u.bfsWidgetByName("light_up_line").setBlendFunc(1,1),u.bfsWidgetByName("light_open_line").setBlendFunc(1,1),u.bfsWidgetByName("light_circle_back_1").setBlendFunc(1,1),u.bfsWidgetByName("light_circle_back_2").setBlendFunc(1,1),u.bfsWidgetByName("light_circle_front_1").setBlendFunc(1,1),u.bfsWidgetByName("light_circle_front_2").setBlendFunc(1,1),u.bfsWidgetByName("light_spread_2").setBlendFunc(1,1),u.bfsWidgetByName("gauge_red_light").setBlendFunc(1,1),u.bfsWidgetByName("light_particle_1").setBlendFunc(1,1),u.bfsWidgetByName("light_particle_2").setBlendFunc(1,1),u.bfsWidgetByName("magic_circle_1").setBlendFunc(1,769),u.bfsWidgetByName("magic_circle_2").setBlendFunc(1,769),u.bfsWidgetByName("emblem_img").setBlendFunc(1,769),u.bfsWidgetByName("label_light_1").setBlendFunc(1,769),u.bfsWidgetByName("label_light_2").setBlendFunc(1,769),c.setAnimationNameEndCallback("release_ani",function(){this.removeAnimationNameEndCallback(),this.playByName("touch_ani",e,n.p(0,0),100,!0)}.bind(c));var l=a.defer();t.setTouchEventHandlers(u,{"TOUCH_ENDED touch_btn":function(e,t){return function(){e.cleanUp(),t.resolve()}}(c,l)},u);try{var _=u.seekWidgetByName("highjob_get_job_1"),p=u.seekWidgetByName("highjob_get_job_2"),d=t.Img("highjob-get","job",i.padZero(r.job_id,4)).png;_.loadTexture(d),p.loadTexture(d),c.playByName("release_ani",e,n.p(0,0),100,!1)}catch(e){return a.reject(e)}return l.promise},btnCallbackBtnWeaponCheck:function(e){var n=this._aDeviceModel.getSelectedRestoreData().getWeaponInfo();return t.ImplantedPopup.create(e,"highjob_weapon_check").open(n),a.reject(this._override)},btnCallbackCorecardTouchPanel:function(e){var t=this._aDeviceModel.getSelectedRestoreData();return e._sceneNavigate.toWeaponSelect(t.getJobGroupId(),t.getNeedJobName(),t.canUseWeapon(this._selectAWeaponModel)?this._selectAWeaponModel.getRawWeaponData():null).navigate(),a.reject(this._override)},btnCallbackBtnBackJobChange:function(e){return e._sceneNavigate._returnSceneNavigate.toParty006().navigate(),a.reject(this._override)}})}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.highjob=t.pc.highjob||{},t.pc.highjob.highjob_weapon_select=t.pc.highjob.highjob_weapon_select||{},t.pc.highjob.highjob_weapon_select.Scene=t.BaseScene.extend({resourceFileName:"highjob_weapon_select/highjob_weapon_select.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"highjob",sceneName:"highjob_weapon_select",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_back_laboratory","btnCallbackBtnBackLaboratory",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"highjob/highjob_main")),this._initScene("page_in")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=(e._,e.Q);t.pc=t.pc||{},t.pc.highjob=t.pc.highjob||{},t.pc.highjob.highjob_weapon_select=t.pc.highjob.highjob_weapon_select||{},t.pc.highjob.highjob_weapon_select.SceneDelegate=t.pc.BaseSceneDelegate.extend({_popups:{},onSceneInit:function(e){return this._createDisplayFilterController(e),this._setBackBtn(e),this.setWeaponList(e)},onSceneEnter:function(e){var t=e._sceneNavigate;return this._selectAWeaponId=t.getSelectedAWeapon().a_weapon_id,this._selectJobGroupId=t.getJobGroupId(),this._selectJobGroupId?i.resolve():(this._touchEndedBackBtnProcess(e),i.reject())},onSceneExit:function(e){return i.resolve()},_createDisplayFilterSettings:function(){return[]},setWeaponList:function(e){var n=t.core.pager.helper.coreCardListUI(e,{baseName:e,panelName:t.BtnsPageListParams.HIGHJOB_WEAPON_LIST.panelName,panelsPerPage:t.BtnsPageListParams.HIGHJOB_WEAPON_LIST.perPage,apiName:"apiAWeapons",apiMethod:"getHighReleaseWeaponList",apiParams:[t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE,this._selectJobGroupId],cardType:"weapon",cardFrame:"full",sortKey:"job_restore_weapons",sortEvent:"pulldown_list_weapon"},new t.core.eventHandling.BaseEventHandler(this._corecardTouchEvent,this));return this._controller=n,n.initialize().then(function(){this._showWarningWordIfDataNotExist(e)}.bind(this))},_corecardTouchEvent:function(e){n.director.getRunningScene()._sceneNavigate.toMain(e.getRawData()).navigate()},_showWarningWordIfDataNotExist:function(e){this._isDataExist()||this._showWarningWord(e)},_showWarningWord:function(e){var t=e.seekWidgetByName("nothing_label"),n=e._sceneNavigate.getClassAJobName();t.setString((n?n+"":"")+"\nLv125Lv20"),t.setVisible(!0),e.seekWidgetByName("btn_back_laboratory").setVisible(!0)},_isDataExist:function(){return 0!==this._controller.getDataList().getExistsRecordCount()},_touchEndedBackBtnProcess:function(e){e._sceneNavigate.toMain(null).navigate()},btnCallbackBtnBackLaboratory:function(e){return this._touchEndedBackBtnProcess(e),i.reject(this._override)}}),t.assignRoles(t.pc.highjob.highjob_weapon_select.SceneDelegate,[t.displayFilter.roles.DisplayFilterSceneController,t.pc.roles.CoreCardCommon])}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.router=n.router||{},n.router.routes=n.router.routes||{},t.merge(n.router.routes,{highjob:{highjob:"highjob_main","highjob/highjob_main":"highjob_main","highjob/highjob_weapon_select":"highjob_weapon_select"}})}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="AGuildOrder",o={get:function(){return this._http.get({url:"/a_guild_order"})},getMissions:function(e,t){return this._http.get({url:"/a_guild_order/missions",json:{page:e,per_page:t}})},getRewards:function(e,t){return this._http.get({url:"/a_guild_order/rewards",json:{page:e,per_page:t}})},receiveMissionReward:function(e){return this._http.post({url:"/a_guild_order/missions/"+e})},receiveAllMissionRewards:function(e){return this._http.post({url:"/a_guild_order/missions/receive"})},receivePointReward:function(e){return this._http.post({url:"/a_guild_order/rewards/"+e})},receiveAllPointRewards:function(e){return this._http.post({url:"/a_guild_order/rewards/receive/"+e})},firstAccess:function(){return this._http.put({url:"/a_guild_order",json:{first_access:!1}})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiAGuildOrder",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},o)),n.env.useApiMock){n.MockApi=n.MockApi||{};var r={};t.each(o,function(e,t){r[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi."+a+"."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},r))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc.present=t.pc.present||{},t.pc.present.roles=t.pc.present.roles||{},$staticRes(res["core-popup-prs_receive_check_result"]),$staticRes(res["core-popup-prs_carry_limit"]),t.pc.present.roles.PRESENT_TYPE_BY_DIRECTION={weapon:{direction:"enh_evo/enh_001",label:""},summon:{direction:"enh_evo/enh_006",label:""},accessory:{direction:"book/book_001_accessory",label:""},item:{direction:"quest/q_001",label:""},stone:{direction:"gacha/ga_001",label:""},gem:{direction:"gacha/ga_001",label:""},treasure:{direction:"shop/sh_001",label:""},job_point:{direction:"party/par_001",label:""}},t.pc.present.roles.PresentPopups={_popups:{popupReceivePresentConfirm:{factoryName:"popupFactoryPopupCommon",resourceName:"core-popup-prs_receive_check_result",title:"",buttonLabels:{blackBtn:"",blueBtn:"OK"},buttons:{blackBtn:function(e){var t=this.seekWidgetByName("contents_panel");t&&t.removeAllChildren(),this.dismiss()},blueBtn:function(e){var t=e._delegate,n=this.getUserData();t._receiveAllPresent.apply(t,[n]);var i=this.seekWidgetByName("contents_panel");i&&i.removeAllChildren(),this.dismiss()}}},popupReceivePresentResult:{factoryName:"popupFactoryPopupCommon",resourceName:"core-popup-prs_receive_check_result",title:"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){var t=this.seekWidgetByName("contents_panel");t&&t.removeAllChildren(),this.dismiss()}}},popupCarryLimitConfirm:{factoryName:"popupFactoryPopupCommon",resourceName:"core-popup-prs_carry_limit",title:"",buttonLabels:{blackBtn:""},buttons:{blackBtn:function(e){this.dismiss();var t=this.seekWidgetByName("contents_panel");t&&t.removeAllChildren()}}}},_openReceiveConfirmPopup:function(e,n,i){return i=i||"",t.ImplantedPopup.createOrGet(e,"prs_receive").open(i,n)},_initVariablePopup:function(e){e.seekWidgetByName("popup_base").height=274,e.seekWidgetByName("main_panel").y=123,e.seekWidgetByName("title_label").y=244,e.seekWidgetByName("contents_panel").height=8},__prepareLabelLine:function(e,t){var i=e.clone(),a=i.seekWidgetByName("prs_label");a.setString(t),a.setColor(new n.Color(255,255,255,255)),a.setTextColor(new n.Color(255,170,0,255));var o=i.seekWidgetByName("btn_transition");return null!==o&&(o.y=o.y-2,o.scale=1.5),a.y=a.y-5,i},_showReceiveConfirmPopup:function(e){var t=e.received_info,a=e.not_received_info,o=n.director.getRunningScene().popups.popupReceivePresentConfirm;o.open().then(function(){o.setStrings({check_or_result_label:"\r\n"}),o.setUserData(a),this._initVariablePopup(o);var e=o.seekWidgetByName("contents_panel");e.setLayoutType(ccui.Layout.LINEAR_VERTICAL);var n=ccs.load(res["core-popup-prs_receive_list_ui"]).node;i.each(t,function(t){var i=this.__prepareLabelLine(n,t.name+"  "+t.count);e.height=e.height+i.height,e.addChild(i),o.seekWidgetByName("popup_base").height=o.seekWidgetByName("popup_base").height+i.height,o.seekWidgetByName("main_panel").y=o.seekWidgetByName("main_panel").y+i.height,o.seekWidgetByName("title_label").y=o.seekWidgetByName("title_label").y+i.height},this)}.bind(this)).fail(function(e){console.error(e.stack)})},_showCarryLimitConfirmPopup:function(e,a){var o=n.director.getRunningScene().popups.popupCarryLimitConfirm;o.open().then(function(){this._initVariablePopup(o),i.isObject(a)&&t.setTouchEventHandlers(o,{"TOUCH_ENDED black_btn":function(){o.dismiss(),a.resolve()}.bind(this)},this);var n=o.seekWidgetByName("contents_panel");n.setLayoutType(ccui.Layout.LINEAR_VERTICAL),n.removeAllChildren();var r=ccs.load(res["core-popup-prs_non_receive_list_ui"]).node;i.each(e,function(e){var a=this.__prepareLabelLine(r,e.name+"  "+(i.isUndefined(e.count)?"":e.count));n.height=n.height+a.height,n.addChild(a),i.find(t.pc.present.roles.PRESENT_TYPE_BY_DIRECTION,function(n,i){if(e.type===i)return a.seekWidgetByName("btn_transition").setTitleText(n.label),a.seekWidgetByName("btn_transition").addTouchEventListener(function(e,i){t.createInstance("router").navigate(n.direction,{})},this),!0},this),o.seekWidgetByName("popup_base").height=o.seekWidgetByName("popup_base").height+a.height,o.seekWidgetByName("main_panel").y=o.seekWidgetByName("main_panel").y+a.height,o.seekWidgetByName("title_label").y=o.seekWidgetByName("title_label").y+a.height},this)}.bind(this)).fail(function(e){console.error(e.stack)})},_receiveAllPresentShowResult:function(e,o,r){var s=a.defer(),c=n.director.getRunningScene().popups.popupReceivePresentResult;return c.open().then(function(){c.setStrings({check_or_result_label:r}),t.setTouchEventHandlers(c,{"TOUCH_ENDED blue_btn":function(){c.dismiss(),i.isEmpty(o)?s.resolve():this._showCarryLimitConfirmPopup(o,s)}.bind(this)},this),this._initVariablePopup(c);var n=c.seekWidgetByName("contents_panel");n.removeAllChildren(),n.setLayoutType(ccui.Layout.LINEAR_VERTICAL);var a=ccs.load(res["core-popup-prs_receive_list_ui"]).node;i.each(e,function(e){var t=this.__prepareLabelLine(a,e.name+"  "+e.count);n.height=n.height+t.height,n.addChild(t),c.seekWidgetByName("popup_base").height=c.seekWidgetByName("popup_base").height+t.height,c.seekWidgetByName("main_panel").y=c.seekWidgetByName("main_panel").y+t.height,c.seekWidgetByName("title_label").y=c.seekWidgetByName("title_label").y+t.height},this)}.bind(this)).fail(function(e){console.error(e.stack)}),s.promise}}}((this||0).self||global),function(e){var t=e.kh;e.khutil,e.cc,e.ccui,e._,e.console,t.createNameSpaceIfNotExists("core.reward"),t.core.reward.REWARD_STATUS={RECEIVED:0,RECEIVABLE:1,INSUFFICIENT_FUNDS:2,UNDETERMINED:3}}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=e.ccui,o=(e._,e.console);t.createNameSpaceIfNotExists("core.reward"),t.core.reward.RewardButtonController=i.Class.extend({className:"RewardButtonController",BUTTON_NAME:"btn_get",ctor:function(e,t,i){this._buttonWidget=n.getWidgetFromNode(e,this.BUTTON_NAME,function(e){o.warn(this.className+": "+e)}.bind(this)),this._updateButtonState(t),this._initializeOnTouchEvent(i,t)},_updateButtonState:function(e){t.createInstance("RewardButtonView",[this._buttonWidget]).updateButtonState(e)},_initializeOnTouchEvent:function(e,t){this._buttonWidget.addTouchEventListener(function(n,i){i===a.Widget.TOUCH_ENDED&&e.handle(t)})}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc,e.ccui,e._);e.console,t.createNameSpaceIfNotExists("core.reward"),t.core.reward.RewardModel=t.core.pager.model.PlainData.extend({className:"RewardModel",ITEM_TYPE_BY_KIND:{item:t.core.item.ITEM_TYPE.ITEM,summon:t.core.item.ITEM_TYPE.SUMMON,weapon:t.core.item.ITEM_TYPE.WEAPON,accessory:t.core.item.ITEM_TYPE.ACCE,package:t.core.item.ITEM_TYPE.PACKAGE},RARITY_TYPE_BY_RARITY:{N:t.core.rarity.RARITY_TYPE.N,R:t.core.rarity.RARITY_TYPE.R,SR:t.core.rarity.RARITY_TYPE.SR,SSR:t.core.rarity.RARITY_TYPE.SSR},ctor:function(e){this._rewardData=e,this._super(e)},getItemName:function(){return this._rewardData.reward_name},getItemId:function(){return this._rewardData.id},getRewardId:function(){return this._rewardData.reward_id},getRewardAmount:function(){return this._rewardData.reward_amount},getItemType:function(){var e=this._rewardData.kind;return this.ITEM_TYPE_BY_KIND[e]},getPrice:function(){return this._rewardData.required_item_amount},getCurrencyName:function(){return this._rewardData.required_item_name},getRewardStatus:function(){return this._rewardData.receivable?t.core.reward.REWARD_STATUS.RECEIVABLE:this._rewardData.received?t.core.reward.REWARD_STATUS.RECEIVED:t.core.reward.REWARD_STATUS.INSUFFICIENT_FUNDS},getElementType:function(){return this._rewardData.element_type},getRarityType:function(){return this.RARITY_TYPE_BY_RARITY[this._rewardData.rare]},getSkin:function(){return this.getItemType()===t.core.item.ITEM_TYPE.ITEM?null:0},getRawPresentData:function(){var e=n.clone(this._rewardData);return e.a_present_id=e.reward_id,e.present_name=e.reward_name,e.count=e.reward_amount,e}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=(e.ccui,e._),o=e.console;t.createNameSpaceIfNotExists("core.reward"),t.core.reward.RewardPageListController=i.Class.extend({className:"RewardPageListController",LIST_ITEM_CONTROLLER:"RewardController",LIST_PANEL_VIEW:"RewardPanelView",REWARD_MODEL:null,ctor:function(e,t){this._rewardPageListSettings=e.getSettings(),this._receiveRewardButtonTouchEventHandler=t},displayRewards:function(){return this._makePageList(this._rewardPageListSettings)},refresh:function(e){this._paginatorUI.refresh(e)},_makePageList:function(e){var i=n.getWidget(e.baseName,this._onNodeNotFound.bind(this));this._createPageListItems(e,i);var a=i.seekWidgetByName(e.panelName),o=new t.core.pager.view.page.BasePageUiFactory(a,this._onInitializeRewardPanel.bind(this)),r=t.core.pager.model.ApiDataListFactory(e.apiName,e.apiMethod,e.apiParams),s=new t.core.pager.controller.PagerController(i,r,[o],a),c=i.seekWidgetByName(e.paginatorNode)||i.seekWidgets(function(e){return"viewpage_ui"===e.getName()||"viewpage_s_ui"===e.getName()})[0];return new t.core.pager.view.button.ViewPageUi(c,s).initialize(),this._paginatorUI=s,a.setVisible(!0),s.initialize()},_createPageListItems:function(e,i){var o=n.getWidgetFromNode(i,e.panelName,this._onNodeNotFound.bind(this));this._pageListItems=a.map(o.getChildren(),function(e){e.setUserData({rewardController:t.createInstance(this.LIST_ITEM_CONTROLLER,[e,this.LIST_PANEL_VIEW,this.REWARD_MODEL])})}.bind(this))},_onInitializeRewardPanel:function(e,t){var n=e.getUserData().rewardController;return null==t?void n.clear():(n.initializeModel(t.getRawData()),n.displayPanel(),void n.initializeReceiveRewardButton(this._receiveRewardButtonTouchEventHandler))},_onNodeNotFound:function(e){o.warn(this.className+": "+e)}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=e.ccui,o=(e._,e.console);t.createNameSpaceIfNotExists("core.reward"),t.core.reward.RewardController=i.Class.extend({className:"RewardController",DETAILED_INFORMATION_API_BY_ITEM_TYPE:function(e,t){return e[t.ITEM]="apiItems",e[t.WEAPON]="apiWeapons",e[t.SUMMON]="apiSummons",e[t.ACCE]="apiAccessories",e[t.PACKAGE]="apiPackageItems",e}({},t.core.item.ITEM_TYPE),DETAILED_INFORMATION_POPUP_BY_ITEM_TYPE:function(e,t){return e[t.ITEM]="sh_item_info",e[t.WEAPON]="sh_weapon_info",e[t.SUMMON]="sh_summon_info",e[t.ACCE]="acce_data",e[t.PACKAGE]="sh_package_item_info",e}({},t.core.item.ITEM_TYPE),ctor:function(e,n,i){this._rootNode=e,this._rewardPanelView=t.createInstance(n||"RewardPanelView",[e]),this._rewardModelClassName=i||"RewardModel"},displayPanel:function(){this._rewardPanelView.display(this._rewardModel),this._initializeImageOnTouchEvent()},_displayDetailedInformation:function(){var e=this._rewardModel.getItemType(),n=this.DETAILED_INFORMATION_API_BY_ITEM_TYPE[e],a=this.DETAILED_INFORMATION_POPUP_BY_ITEM_TYPE[e],r=this._rewardModel.getItemId();t.createInstance(n).get(r).then(function(e){var n=i.director.getRunningScene();t.ImplantedPopup.createOrGet(n,a).open(e.body)}).fail(function(e){o.error(e&&e.stack?e.stack:e)})},initializeModel:function(e){this._rewardModel=t.createInstance(this._rewardModelClassName,[e])},initializeReceiveRewardButton:function(e){t.createInstance("RewardButtonController",[this._rootNode,this._rewardModel,e])},clear:function(){this._rewardPanelView.clear()},_initializeImageOnTouchEvent:function(){var e=n.getCoreCardDINameByRecord(this._rewardModel.getRawData()),t=this._rewardPanelView.CORECARD_NODE_NAME,i=n.getWidgetFromNode(this._rootNode,t,function(e){o.warn(this.className+": "+e)}.bind(this)).getUserData()[e];i.addTouchEventListener(function(e,t){t===a.Widget.TOUCH_ENDED&&this._displayDetailedInformation()},this),i.setTouchEnabled(!0)}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=(e.ccui,e._),o=e.console;t.createNameSpaceIfNotExists("core.reward"),t.core.reward.RewardPanelView=i.Class.extend({className:"RewardPanelView",CORECARD_NODE_NAME:"corecard_ui_65",PRICE_LABEL_NAME:"item_label",PRICE_LABEL_TEXT:"{currencyName}x{price}",REWARD_INFORMATION_LABEL_NAME:"received_have_label",REWARD_INFORMATION_TEXT:"{itemName}x{rewardAmount}",RARITY_TYPE_TO_RARITY:function(e,t){return e[t.N]="N",e[t.R]="R",e[t.SR]="SR",e[t.SSR]="SSR",e}({},t.core.rarity.RARITY_TYPE),ctor:function(e){this._rootNode=e},display:function(e){this._rootNode.setVisible(!0),this._displayCorecard(e),this._displayRewardInformation(e),this._displayPrice(e)},clear:function(){var e=corecardNode.seekWidgetByName(this.CORECARD_NODE_NAME).getUserData()||{};a.invoke(e,"setVisible",!1),this._getWidget(this.REWARD_INFORMATION_LABEL_NAME).setString(""),this._getWidget(this.PRICE_LABEL_NAME).setString(""),this._rootNode.setVisible(!1)},_displayCorecard:function(e){var i=this._rootNode,o=e.getRawPresentData(),r=n.getCoreCardDINameByRecord(o),s=i.seekWidgetByName(this.CORECARD_NODE_NAME),c=s.getUserData()||{};a.invoke(c,"setVisible",!1);var u=c[r];if(u instanceof t.CoreCardUI)return u.setData(o),void u.setVisible(!0);var l=/ItemUI$/.test(r)?"plain":"e_r";(u=t.createInstance(r,[l])).setData(o),s.addChild(u.getResult()),c[r]=u,s.setUserData(c)},_displayPrice:function(e){var t=e.getCurrencyName(),n=e.getPrice(),i=this.PRICE_LABEL_TEXT.replace("{currencyName}",t).replace("{price}",n);this._getWidget(this.PRICE_LABEL_NAME).setString(i)},_displayRewardInformation:function(e){var t=e.getItemName(),n=e.getRewardAmount(),i=this.REWARD_INFORMATION_TEXT.replace("{itemName}",t).replace("{rewardAmount}",n);this._getWidget(this.REWARD_INFORMATION_LABEL_NAME).setString(i)},_getWidget:function(e){return n.getWidgetFromNode(this._rootNode,e,function(e){o.warn(this.className+": "+e)}.bind(this))}}),a.assign(t.core.reward.RewardPanelView.prototype,t.pc.roles.CoreCardCommon)}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("core.reward"),t.core.reward.RewardButtonView=n.Class.extend({className:"RewardButtonView",APPEARANCE_NAME_BY_REWARD_STATUS:function(e,t){return e[t.RECEIVED]="received_in_full",e[t.RECEIVABLE]="no_received",e[t.INSUFFICIENT_FUNDS]="nonattainment",e[t.UNDETERMINED]="default_view",e}({},t.core.reward.REWARD_STATUS),ctor:function(e){this._buttonWidget=e},updateButtonState:function(e){var t=e.getRewardStatus(),n=this.APPEARANCE_NAME_BY_REWARD_STATUS[t];this._buttonWidget.getParent().setAppearance(n)}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("core.reward"),t.core.reward.RewardAllButtonController=n.Class.extend({className:"RewardAllButtonController",ctor:function(e){this._rewardExchangeInformationRepository=e},updateButtonState:function(){this._getRewardExchangeInformationModel().then(function(e){t.createInstance("RewardAllButtonView").updateButtonState(e)})},_getRewardExchangeInformationModel:function(){return this._rewardExchangeInformationRepository.import()}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=(e.ccui,e._,e.console);t.createNameSpaceIfNotExists("core.reward"),t.core.reward.RewardAllButtonView=i.Class.extend({className:"RewardAllButtonView",BUTTON_NODE_NAME:"btn_receive",updateButtonState:function(e){var i=e.canExchangeForRewards(),o=n.getWidget(this.BUTTON_NODE_NAME,function(e){a.warn(this.className+": "+e)}.bind(this));t.pc.roles.UIUtility._setEnableButton(o,i)}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=(e.ccui,e._);e.console,t.createNameSpaceIfNotExists("core.reward"),t.core.reward.ReceiveRewardButtonTouchEventHandler=i.Class.extend({className:"ReceiveRewardButtonTouchEventHandler",handle:function(e){var n=i.director.getRunningScene();t.ImplantedPopup.createOrGet(n,"prs_receive").open("",e.getRawPresentData(e)).then(function(){this._receiveConfirmed(e),t.createInstance("myselfInfoRepository").allCacheClear()}.bind(this))},_receiveConfirmed:function(e){},_showNewMemberPopups:function(e){return a.isArray(e)?n.runSequence(e,this._showNewMemberPopup.bind(this)):this._showNewMemberPopup(e)},_showNewMemberPopup:function(e){if(a.isArray(e))var n=e.shift();else{n=e;e=[]}var o=i.director.getRunningScene().popups.comNewMember;o.open().then(function(i){var a=t.createInstance("CoreCardCharacterUI",["e_r"]);a.setData(n),o.seekWidgetByName("corecard_chara_ui").addChild(a.getResult());var r=o.seekWidgetByName("party_join_label");null!==r&&r.setString(n.name+"\n"),t.setTouchEventHandlers(o,{"TOUCH_ENDED black_btn":function(){o.dismiss(),e.length>0&&this._showNewMemberPopup(e)}.bind(this)},this)}.bind(this))}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.createNameSpaceIfNotExists("pc.view"),n.pc.view.PrsReceivePopup=n.ImplantedPopup.extend({_clear:function(){var e=this.getNode();e.setStrings({item_label:""}),e.setHtmlStrings({receive_labelimg:""},n.GameConfig.POPUP_CSS)},_initContents:function(e,t){this.setTitle(e),this.setButtonEvents({btn_cancel:!1,btn_ok:!0});var i=this.getNode(),a=this._adjustData(t);this._setProperCoreCardElementRarity(i,a),i.setStrings({item_label:a.reward_name});var o=" "+a.reward_amount;i.setHtmlStrings({receive_labelimg:"<table class='nb'><tr><td class='numbox_slong'><span class='white'>"+o+"</span></td></tr></table>"},n.GameConfig.POPUP_CSS)},dismiss:function(e){this._super(e),this._clear()},_adjustData:function(e){if(t.isNumber(e.a_present_id)?e=t.extend({},e,{reward_id:e.a_present_id,reward_name:e.present_name,reward_amount:e.count}):t.isNumber(e.reward_id)||(e=t.extend({},e,{reward_id:e.id,reward_name:e.name,reward_amount:e.count})),t.isUndefined(e.kind))return e;var n=e[e.kind+"_info"];return t.isUndefined(n)?e:t.extend({},e,n)}}),n.assignRoles(n.pc.view.PrsReceivePopup,[n.pc.roles.CoreCardCommon])}((this||0).self||global),function(e){var t=e.cc,n=(e.ccui,e.kh),i=(e.res,e.gResources,e._);n.createNameSpaceIfNotExists("hlbattle.roles"),n.hlbattle.roles.ReceiveResponseCommon={_showExpiredPopup:function(e){var t=n.hlbattle.controller.HLBattleGetErrorPopupController.prototype;return n.ImplantedPopup.createOrGet(e,t.ROOT_NODE,t.className).open()},_showNewMemberPopups:function(e){return i.isArray(e)?khutil.runSequence(e,this._showNewMemberPopup.bind(this)):this._showNewMemberPopup(e)},_showNewMemberPopup:function(e){var i=Q.defer(),a=t.director.getRunningScene().popups.comNewMember;return a.open().then(function(t){this._setCharacterCoreCardElementRarity(a,e,"corecard_chara_ui");var o=a.seekWidgetByName("party_join_label");null!==o&&o.setString(e.name+"\n"),n.setTouchEventHandlers(a,{"TOUCH_ENDED black_btn":function(){a.dismiss(),i.resolve()}},this)}.bind(this)),i.promise}},i.assign(n.hlbattle.roles.ReceiveResponseCommon,n.pc.roles.CoreCardCommon)}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=(e.ccui,e._,e.console);t.createNameSpaceIfNotExists("hlbattle.view"),t.hlbattle.view.MissionPanelView=i.Class.extend({className:"MissionPanelView",TITLE_NODE:"mission_title_label",DESCRIPTION_NODE:"mission_detail_label",REMAIN_TIME_NODE:"time_label",PROGRESS_STATUS_NODE:"achievement_status_label",ctor:function(e){this._rootNode=e},display:function(e){this._rootNode.setVisible(!0),this._rootNode.setAppearance(e.isCleared()?"clear":"achievement_status");var t={};t[this.TITLE_NODE]=e.getTitle(),t[this.DESCRIPTION_NODE]=e.getDescription(),t[this.REMAIN_TIME_NODE]=e.getRemainingTimeText(),t[this.PROGRESS_STATUS_NODE]=e.getProgressText(),this._rootNode.setStrings(t)},clear:function(){this._rootNode.setVisible(!1);var e={};e[this.TITLE_NODE]="",e[this.DESCRIPTION_NODE]="",e[this.REMAIN_TIME_NODE]="",e[this.PROGRESS_STATUS_NODE]="",this._rootNode.setStrings(e)},_getWidget:function(e){return n.getWidgetFromNode(this._rootNode,e,function(e){a.warn(this.className+": "+e)}.bind(this))}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("hlbattle.model"),t.hlbattle.model.MissionModel=n.Class.extend({className:"MissionModel",ctor:function(e){this._missionData=e},getTitle:function(){return this._missionData.title},getDescription:function(){return this._missionData.description},getRemainingTimeText:function(){return this._missionData.remaining_time},getProgressText:function(){return this._missionData.now_progress+"/"+this._missionData.max_progress},getRewardId:function(){return this._missionData.reward_id},getRewardStatus:function(){return this._missionData.receivable?t.core.reward.REWARD_STATUS.RECEIVABLE:this._missionData.received?t.core.reward.REWARD_STATUS.RECEIVED:t.core.reward.REWARD_STATUS.INSUFFICIENT_FUNDS},isCleared:function(){return this._missionData.receivable||this._missionData.received}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("hlbattle.settings"),t.hlbattle.settings.MissionPageListSettings=n.Class.extend({className:"MissionPageListSettings",SETTINGS:{panelName:t.BtnsPageListParams.GUILD_ORDER_MISSION_LIST.panelName,panelsPerPage:t.BtnsPageListParams.GUILD_ORDER_MISSION_LIST.perPage,paginatorNode:"viewpage_s_ui",apiName:"apiAGuildOrder",apiMethod:"getMissions",apiParams:[t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE],baseName:"tab_0_node",fillEmptyRecord:!0},getSettings:function(){return this.SETTINGS}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=(e.ccui,e._,e.console);t.createNameSpaceIfNotExists("hlbattle.controller"),t.hlbattle.controller.MissionController=n.Class.extend({className:"MissionController",ctor:function(e){this._rootNode=e,this._missionPanelView=t.createInstance("MissionPanelView",[e])},displayPanel:function(){this._missionPanelView.display(this._missionModel)},_displayDetailedInformation:function(){var e=this._rewardModel.getItemType(),a=this.DETAILED_INFORMATION_API_BY_ITEM_TYPE[e],o=this.DETAILED_INFORMATION_POPUP_BY_ITEM_TYPE[e],r=this._rewardModel.getItemId();t.createInstance(a).get(r).then(function(e){var i=n.director.getRunningScene();t.ImplantedPopup.createOrGet(i,o).open(e.body)}).fail(function(e){i.error(e&&e.stack?e.stack:e)})},initializeModel:function(e){this._missionModel=t.createInstance("MissionModel",[e])},initializeReceiveRewardButton:function(e){t.createInstance("RewardButtonController",[this._rootNode,this._missionModel,e])},clear:function(){this._missionPanelView.clear()}})}((this||0).self||global),function(e){var t=e.kh;e.khutil,e.cc,e.ccui,e._,e.console,t.createNameSpaceIfNotExists("hlbattle.controller"),t.hlbattle.controller.MissionPageListController=t.core.reward.RewardPageListController.extend({className:"MissionPageListController",LIST_ITEM_CONTROLLER:"MissionController"})}((this||0).self||global),function(e){var t=e.kh;e.khutil,e.cc,e.ccui,e._,e.console,t.createNameSpaceIfNotExists("hlbattle.controller"),t.hlbattle.controller.PointPageListController=t.core.reward.RewardPageListController.extend({className:"PointPageListController",LIST_PANEL_VIEW:"PointRewardPanelView"})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("hlbattle.settings"),t.hlbattle.settings.PointPageListSettings=n.Class.extend({className:"PointPageListSettings",SETTINGS:{panelName:t.BtnsPageListParams.GUILD_ORDER_REWARD_LIST.panelName,panelsPerPage:t.BtnsPageListParams.GUILD_ORDER_REWARD_LIST.perPage,paginatorNode:"viewpage_s_ui",apiName:"apiAGuildOrder",apiMethod:"getRewards",apiParams:[t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE],baseName:"tab_1_node",fillEmptyRecord:!0},getSettings:function(){return this.SETTINGS}})}((this||0).self||global),function(e){var t=e.kh;e.khutil,e.cc,e.ccui,e._,e.console,t.createNameSpaceIfNotExists("hlbattle.view"),t.hlbattle.view.PointRewardPanelView=t.core.reward.RewardPanelView.extend({className:"PointRewardPanelView",CORECARD_NODE_NAME:"corecard_ui_56",PRICE_LABEL_NAME:"mission_point_label",PRICE_LABEL_TEXT:"x{price}",REWARD_INFORMATION_LABEL_NAME:"reward_name_label",REWARD_INFORMATION_TEXT:"{itemName}x{rewardAmount}"})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=(e.ccui,e._),o=e.console;t.createNameSpaceIfNotExists("hlbattle.view"),t.hlbattle.view.RecommendedElementView=i.Class.extend({className:"RecommendedElementView",ICON_NODE:"element_icon",display:function(e){var t=this._getImageNode(this.ICON_NODE);this._setElementIconCommonRes(t,{element_type:e})},_getImageNode:function(e){return n.getWidget(e,function(e){o.warn(this.className+": "+e)}.bind(this))}}),a.assign(t.hlbattle.view.RecommendedElementView.prototype,t.pc.roles.IconsCommon)}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=(e.ccui,e._),o=e.console;t.createNameSpaceIfNotExists("hlbattle.view"),t.hlbattle.view.BountiesBtnView=i.Class.extend({className:"BountiesBtnView",BTN_NODE:"btn_bounties_check",display:function(e){var t=this._getImageNode(this.BTN_NODE);this._setEnableButton(t,e)},_getImageNode:function(e){return n.getWidget(e,function(e){o.warn(this.className+": "+e)}.bind(this))}}),a.assign(t.hlbattle.view.BountiesBtnView.prototype,t.pc.roles.UIUtility)}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=(e.ccui,e._,e.console);t.createNameSpaceIfNotExists("hlbattle.repository"),t.hlbattle.repository.AGuildOrderRepository=n.Class.extend({className:"AGuildOrderRepository",ctor:function(){this._api=t.createInstance("apiAGuildOrder")},import:function(){return this._api.get().then(this._createModel.bind(this)).fail(function(e){i.error(e&&e.stack?e.stack:e)})},_createModel:function(e){return t.createInstance("AGuildOrderModel",[e.body])}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("hlbattle.model"),t.hlbattle.model.AGuildOrderModel=n.Class.extend({className:"AGuildOrderModel",ctor:function(e){this._aGuildOrder=e,this._bountyQuestModel=t.createInstance("BountyQuestModel",[e.quest_info,e.enemy_info])},getEventName:function(){return this._aGuildOrder.event_name},getPointAmount:function(){return this._aGuildOrder.point_amount},getEventId:function(){return this._aGuildOrder.event_id},getEventPeriodText:function(){return this._aGuildOrder.event_date},getRewardExchangeDeadline:function(){return this._aGuildOrder.receive_point_reward_limit},isFirstAccess:function(){return this._aGuildOrder.first_access},hasReceivableMissionRewards:function(){return this._aGuildOrder.exist_receivable_mission_rewards},hasReceivablePointRewards:function(){return this._aGuildOrder.exist_receivable_point_rewards},getIntroductionEpisodeId:function(){return this._aGuildOrder.introduction_episode_id},getBountyQuestModel:function(){return this._bountyQuestModel}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("hlbattle.model"),t.hlbattle.model.BountyQuestModel=n.Class.extend({className:"BountyQuestModel",ctor:function(e,t){this._questInfo=e,this._enemyInfo=t},getQuestId:function(){return this._questInfo.a_quest_id},getQuestMasterId:function(){return this._questInfo.quest_id},getRequireAP:function(){return this._questInfo.quest_ap},getRecommendedElementTypeIndex:function(){return this._questInfo.recommended_element_type},getEnemyName:function(){return this._enemyInfo.name},getEnemyLevel:function(){return this._enemyInfo.level},getChallengeStatusText:function(){return this._questInfo.limit_info.challenged_count+"/"+this._questInfo.limit_info.max_challenge_count},isOverCanChallengeCount:function(){return this._questInfo.limit_info.challenged_count>=this._questInfo.limit_info.max_challenge_count},getRawQuestData:function(){return this._questInfo}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=(e.ccui,e._),o=e.console;t.createNameSpaceIfNotExists("hlbattle.view"),t.hlbattle.view.BackgroundView=i.Class.extend({className:"BackgroundView",BACKGROUND_IMAGE_PATH:"hlbattle-bg001_event_{eventId}",BACKGROUND_EXTENSION:"jpg",BACKGROUND_NODE:"hlbattle-bg001",displayBackground:function(e){var t=this._getBackgroundNode(this.BACKGROUND_NODE),n=e.getEventId(),i=this._getImagePath(this.BACKGROUND_IMAGE_PATH,n);t.loadTexture(i)},_getBackgroundNode:function(e){return n.getWidget(e,function(e){o.warn(this.className+": "+e)}.bind(this))},_getImagePath:function(e,n){return e=e.replace("{eventId}",a.padZero(n,4)),t.img.apply(t,e.split("_"))[this.BACKGROUND_EXTENSION]}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=(e.ccui,e._),o=e.console;t.createNameSpaceIfNotExists("hlbattle.view"),t.hlbattle.view.EnemyImageView=i.Class.extend({className:"EnemyImageView",IMAGE_PATH:"hlbattle-wanted_hlbattle-quest_{questId}",IMAGE_EXTENSION:"png",IMAGE_NODE:"hlbattle-wanted",displayTexture:function(e){var t=this._getImageNode(this.IMAGE_NODE),n=e.getQuestMasterId(),i=this._getImagePath(this.IMAGE_PATH,n);t.loadTexture(i)},_getImageNode:function(e){return n.getWidget(e,function(e){o.warn(this.className+": "+e)}.bind(this))},_getImagePath:function(e,n){return e=e.replace("{questId}",a.padZero(n,4)),t.img.apply(t,e.split("_"))[this.IMAGE_EXTENSION]}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=(e.ccui,e._,e.console);t.createNameSpaceIfNotExists("hlbattle.view"),t.hlbattle.view.ExclamationIconView=i.Class.extend({className:"ExclamationIconView",ctor:function(e){this._nodeName=e},setVisible:function(e){n.getWidget(this._nodeName,function(e){a.warn(this.className+": "+e)}.bind(this)).setVisible(e)}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=(e.ccui,e._,e.console);t.createNameSpaceIfNotExists("hlbattle.controller"),t.hlbattle.controller.ReceivableStatusUIController=i.Class.extend({className:"ReceivableStatusUIController",ctor:function(e){this._missionTabIcon=t.createInstance("ExclamationIconView",["icon_0"]),this._rewardTabIcon=t.createInstance("ExclamationIconView",["icon_1"]);var n=i.director.getRunningScene();this._setReceiveButtonEnable(n,!1)},update:function(e,t){this._missionTabIcon.setVisible(t.hasReceivableMissionRewards()),this._rewardTabIcon.setVisible(t.hasReceivablePointRewards());var n="tab_0"===e.tabDelegateList[0].selected?t.hasReceivableMissionRewards():t.hasReceivablePointRewards();this._setReceiveButtonEnable(e,n)},_setReceiveButtonEnable:function(e,i){var o=n.getWidgetFromNode(e,"btn_receive",function(e){a.warn(this.className+": "+e)}.bind(this));t.pc.roles.UIUtility._setEnableButton(o,i)}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=(e.ccui,e._,e.console);t.createNameSpaceIfNotExists("hlbattle.controller"),t.hlbattle.controller.AGuildOrderLabelsController=i.Class.extend({className:"AGuildOrderLabelsController",HEADER:{node:"header_sub_label",format:":<%text%>"},EVENT_PERIOD:{node:"date_label",format:"<%text%>"},REQUIRE_AP:{node:"ap_label",format:"AP:<%text%>"},CHALLENGE_COUNT:{node:"today_challenging_time_label",format:":<%text%>"},RECEIVE_DEADLINE:{node:"limit_date_label",format:"<%text%>"},display:function(e,t){this._displayLabel(e,this.HEADER,t.getPointAmount()),this._displayLabel(e,this.EVENT_PERIOD,t.getEventPeriodText()),this._displayLabel(e,this.REQUIRE_AP,t.getBountyQuestModel().getRequireAP()),this._displayLabel(e,this.CHALLENGE_COUNT,t.getBountyQuestModel().getChallengeStatusText()),this._displayLabel(e,this.RECEIVE_DEADLINE,t.getRewardExchangeDeadline())},_displayLabel:function(e,t,i){var o=n.getWidgetFromNode(e,t.node,function(e){a.warn(this.className+": "+e)}.bind(this));null!==o&&o.setString(t.format.replace("<%text%>",i))}})}((this||0).self||global),function(e){var t=e.kh;e.khutil,e.cc,e.ccui,e._,e.console,t.createNameSpaceIfNotExists("hlbattle.controller"),t.hlbattle.controller.HLBattleWantedPopupController=t.ImplantedPopup.extend({className:"HLBattleWantedPopupController",ROOT_NODE:"hlbattle_wanted",open:function(e){return t.ImplantedPopup.prototype.open.apply(this,arguments)},_initContents:function(e){this.setButtonEvents({btn_cancel:!1,btn_subdue:!0}),this._displayEnemyInfo(e),t.createInstance("EnemyImageView").displayTexture(e)},_displayEnemyInfo:function(e){this.getNode().setStrings({enemy_label:"Lv:"+e.getEnemyLevel()+" "+e.getEnemyName()})}})}((this||0).self||global),function(e){var t=e.kh;e.khutil,e.cc,e.ccui,e._,e.console,t.createNameSpaceIfNotExists("hlbattle.controller"),t.hlbattle.controller.HLBattleGetErrorPopupController=t.ImplantedPopup.extend({className:"HLBattleGetErrorPopupController",ROOT_NODE:"hlbattle_get_error",_initContents:function(e){this.setButtonEvents({btn_ok:!0})}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=(e.ccui,e._);e.console,t.createNameSpaceIfNotExists("hlbattle.eventHandling"),t.hlbattle.eventHandling.ReceiveConfirmedEventHandler=t.core.reward.ReceiveRewardButtonTouchEventHandler.extend({className:"ReceiveConfirmedEventHandler",ctor:function(){this._api=t.createInstance("apiAGuildOrder")},_receiveConfirmed:function(e){var t=n.director.getRunningScene();this._api.receivePointReward(e.getRewardId()).then(function(e){var n=e.body;if(!0===n.is_expired)return this._showExpiredPopup(t);var a=n.new_characters_gained;return i.isEmpty(a)?Q.resolve():this._showNewMemberPopups(a)}.bind(this)).then(function(){t.refresh()})}}),i.assign(t.hlbattle.eventHandling.ReceiveConfirmedEventHandler.prototype,t.hlbattle.roles.ReceiveResponseCommon)}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=(e.ccui,e._);e.console,t.createNameSpaceIfNotExists("hlbattle.eventHandling"),t.hlbattle.eventHandling.ReceiveMissionRewardButtonTouchEventHandler=n.Class.extend({className:"ReceiveMissionRewardButtonTouchEventHandler",ctor:function(){this._api=t.createInstance("apiAGuildOrder")},handle:function(e){var t=n.director.getRunningScene();this._api.receiveMissionReward(e.getRewardId()).then(function(e){if(!0===e.body.is_expired)return this._showExpiredPopup(t)}.bind(this)).then(function(){t.refresh()})}}),i.assign(t.hlbattle.eventHandling.ReceiveMissionRewardButtonTouchEventHandler.prototype,t.hlbattle.roles.ReceiveResponseCommon)}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc,e.ccui,e._);e.console,t.createNameSpaceIfNotExists("hlbattle.eventHandling"),t.hlbattle.eventHandling.ReceiveAllButtonTouchEventHandler=t.core.reward.ReceiveRewardButtonTouchEventHandler.extend({className:"ReceiveAllButtonTouchEventHandler",ctor:function(){this._api=t.createInstance("apiAGuildOrder")},handle:function(e,i){var a=e.tabDelegateList[0].selected,o="tab_0"===a?"receiveAllMissionRewards":"receiveAllPointRewards";t.createInstance("myselfInfoRepository").allCacheClear(),this._api[o](i).then(function(t){var i=t.body;if(!0===i.is_expired)return this._showExpiredPopup(e);if("tab_0"===a)return Q.resolve();return this._receiveAllPresentShowResult(i.received_info,i.not_received_info,"\r\n").then(function(){var e=i.new_character_gained_list;return n.isEmpty(e)?Q.resolve():this._showNewMemberPopups(e)}.bind(this))}.bind(this)).then(function(){e.refresh()})}}),n.assign(t.hlbattle.eventHandling.ReceiveAllButtonTouchEventHandler.prototype,t.hlbattle.roles.ReceiveResponseCommon,t.pc.present.roles.PresentPopups)}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;t.createNameSpaceIfNotExists("hlbattle.interrupt"),t.hlbattle.interrupt.OpeningEpisode=n.Class.extend({ctor:function(e){this._episodeId=e.isFirstAccess()?e.getIntroductionEpisodeId():null},playable:function(){return i.isString(this._episodeId)},play:function(){t.createInstance("apiAGuildOrder").firstAccess().then(function(){t.createInstance("router").navigate("scenario/episode-play",{"scenario/play":{episode_id:this._episodeId,returnBackParams:{scene:"hlbattle/hlbattle_001",routerParams:{},temporaryRouterParams:{}}}})}.bind(this))}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=(e._,e.Q);t.pc=t.pc||{},t.pc.quest=t.pc.quest||{},t.pc.quest.roles.RaidQuestPanel={_touchRaidPanel:function(e,a){var o=n.director.getRunningScene();if(a.is_joined)t.createInstance("router").navigate("battle",{quest_type:a.quest_type,a_quest_id:a.a_quest_id,a_battle_id:a.a_battle_id,is_own_raid:a.is_own_raid,a_player_id:this.playerId});else if(this.joinCount>=3)this._showPopupReachedRaidMax(o);else if(this.unverifyCount)this._showPopupExistUnconfirmBattle(o);else{if(!(this.questPoint.bp<a.battle_bp))return void this._navigateRaidBtnToQ009(a,this.playerId);var r=t.createInstance("apiAItems");i.all([r.getBpGain(),this.updateQuestPoints()]).spread(function(n,i){this._needApBpPopupFactory=t.createInstance("popupFactoryComNeedApBp"),this._needApBpPopupFactory.create({property:"BP",questTitle:"Lv"+a.enemy_level+" "+a.enemy_name,questPoints:this.questPoint,items:n.body,component:"quest",onUse:this._onUseBpItem.bind(this,e,a),needBattleBp:a.battle_bp}).open()}.bind(this)).fail(function(e){console.error(e.stack)})}},_onUseBpItem:function(e,t,n){this.questPoint.bp=n,this._touchRaidPanel(e,t)},_showPopupReachedRaidMax:function(e){e.popups.popupReachedRaidMax.open()},_showPopupExistUnconfirmBattle:function(e){e.popups.popupExistUnconfirmBattle.open()},updateQuestPoints:function(){return n.director.getRunningScene().headerDelegate.updateQuestPoints().then(function(e){return this.questPoint=e,e}.bind(this))}}}((this||0).self||global),function(e){var t=e._,n=e.kh;e.ccui,$staticRes(res["core-popup-ra_quest_appearance"]),n.PopupFactoryRaQuestAppearance=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-ra_quest_appearance",title:"",buttonLabels:{blueBtn:"OK"}},POPUP_METHODS:{setData:function(e){this._setQuestImage(e.quest_id),this._setRemainingTimeLabel(e.time_left)},_setQuestImage:function(e){var i=this.seekWidgetByName("questimg");if(null!==i){var a=n.Img("questimg","event-quest",t.padZero(e,4),1).jpg;i.loadTexture(a)}},_setRemainingTimeLabel:function(e){this.setHtmlStrings({limit_no_labelimg:"<span class='white'></span><span class='yellow'>"+e+"</span>"},n.GameConfig.POPUP_CSS)},clearData:function(){}},onPopupOpened:function(e,t){null!=t&&e.setData(t)},_addMethodsToPopup:function(e){n.PopupFactoryPopupCommon.prototype._addMethodsToPopup.call(this,e),t.assign(e,this.POPUP_METHODS)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e._,e.Q,t.pc=t.pc||{},t.pc.hlbattle=t.pc.hlbattle||{},t.pc.hlbattle.hlbattle_001=t.pc.hlbattle.hlbattle_001||{},t.pc.hlbattle.hlbattle_001.MissionPageDelegate=n.Class.extend({className:"MissionPageDelegate",ctor:function(){var e=t.createInstance("MissionPageListSettings"),n=t.createInstance("ReceiveMissionRewardButtonTouchEventHandler");this._rewardPageListController=t.createInstance("MissionPageListController",[e,n])},initialize:function(){this._rewardPageListController.displayRewards()},refresh:function(){this._rewardPageListController.refresh()}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e._,e.Q,t.pc=t.pc||{},t.pc.hlbattle=t.pc.hlbattle||{},t.pc.hlbattle.hlbattle_001=t.pc.hlbattle.hlbattle_001||{},t.pc.hlbattle.hlbattle_001.PointPageDelegate=n.Class.extend({className:"PointPageDelegate",ctor:function(){var e=t.createInstance("PointPageListSettings"),n=t.createInstance("ReceiveConfirmedEventHandler");this._rewardPageListController=t.createInstance("PointPageListController",[e,n])},initialize:function(){this._rewardPageListController.displayRewards()},refresh:function(){this._rewardPageListController.refresh()}})}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.hlbattle=t.pc.hlbattle||{},t.pc.hlbattle.hlbattle_001=t.pc.hlbattle.hlbattle_001||{},t.pc.hlbattle.hlbattle_001.Scene=t.BaseScene.extend({resourceFileName:"hlbattle_001/hlbattle_001.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[{tab1:{node:"tab_0","content-node":"tab_0_node"},tab2:{node:"tab_1","content-node":"tab_1_node"}}],componentName:"hlbattle",sceneName:"hlbattle_001",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_receive","btnCallbackBtnReceive",null,function(){alert("{{}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_present","btnCallbackBtnPresent",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"present/prs_001_2_3")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_bounties_check","btnCallbackBtnBountiesCheck",null,function(){alert("{{hlbattle_wanted}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc=t.pc||{},t.pc.hlbattle=t.pc.hlbattle||{},t.pc.hlbattle.hlbattle_001=t.pc.hlbattle.hlbattle_001||{},t.pc.hlbattle.hlbattle_001.SceneDelegate=t.pc.BaseSceneDelegate.extend(i.assign({},t.pc.roles.UIUtility,t.pc.quest.roles.QuestSelectCommon.methods,{_delayNodes:["../hlbattle_popup_ui.json"],_popups:{comNewMember:{factoryName:"popupFactoryPopupCommon",resourceName:"core-popup-com_new_member",title:"",buttonLabels:{blackBtn:""},buttons:{blackBtn:function(e){this.dismiss()}}},comBackCheck:{factoryName:"popupFactoryComBackCheck"},comApRestart:{factoryName:"popupFactoryComApRestart"},q_001_ap_next:{factoryName:"popupFactoryPopupCommon",resourceName:"core-popup-q_001_ap_next",title:"",buttonLabels:{blueBtn:"OK",blackBtn:""},buttons:{blueBtn:function(e){this.dismiss(),e._delegate.startCheckQuestState(e,this._selectQuestData)},blackBtn:function(e){this.dismiss()}}},q_001_ap_open:{factoryName:"popupFactoryBlue",title:""+t.w("release")+"!",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){this.dismiss()}}},q_newworld:{factoryName:"popupFactoryBlue",title:""+t.w("release")+"!",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){this.dismiss(),t.createInstance("router").navigate("quest/q_005")}}},q_quest_stop:{factoryName:"popupFactoryBlue",title:"",content:"<br />",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){this.dismiss()}}}},questCommonDelegate:new t.QuestSceneCommonDelegate,onSceneInit:function(e){return a.defer(),this._setBackBtn(e),this._missionPage=t.createInstance("MissionPageDelegate"),this._pointPage=t.createInstance("PointPageDelegate"),this._receivableStatusUI=t.createInstance("ReceivableStatusUIController"),t.createInstance("aGuildOrderRepository").import().then(function(n){var i=t.createInstance("OpeningEpisode",[n]);return i.playable()?void i.play():(this.questCommonDelegate.owner=e,t.createInstance("BackgroundView").displayBackground(n),t.createInstance("AGuildOrderLabelsController").display(e,n),this._aGuildOrder=n,this._bountyQuest=n.getBountyQuestModel(),this._loadQuestInfo(e).then(function(){t.createInstance("BountiesBtnView").display(this._isEnabledBountiesBtn())}.bind(this)),t.createInstance("RecommendedElementView").display(this._bountyQuest.getRecommendedElementTypeIndex()),void this._receivableStatusUI.update(e,n))}.bind(this)),this._missionPage.initialize(),this._pointPage.initialize(),a.resolve()},onSceneEnter:function(e){return a.defer(),a.resolve()},onSceneExit:function(e){return a.defer(),a.resolve()},onPageInAnimationEnd:function(e){return a.defer(),a.resolve()},tabCallbackTab0:function(e){t.createInstance("aGuildOrderRepository").import().then(function(t){this._receivableStatusUI.update(e,t),this._missionPage.refresh()}.bind(this))},tabCallbackTab1:function(e){t.createInstance("aGuildOrderRepository").import().then(function(t){this._receivableStatusUI.update(e,t)}.bind(this))},btnCallbackBtnReceive:function(e){var n=a.defer();n.reject(this._override);var i=this._getGuildOrderId();return t.createInstance("ReceiveAllButtonTouchEventHandler").handle(e,i),n.promise},btnCallbackBtnPresent:function(e){var n=a.defer();return n.reject(this._override),t.createInstance("router").navigate("present/prs_001",{},{prs_001_002_003:{returnRoute:"hlbattle/hlbattle_001"}}),n.promise},btnCallbackBtnBountiesCheck:function(e){var t=a.defer();return t.reject(this._override),this._rankLimitPopup(e)?t.promise:(this._showWantedPopup().then(function(){this._doDefaultQuestStartingProcess()}.bind(this)),t.promise)},_isEnabledBountiesBtn:function(){if(!this._bountyQuest.isOverCanChallengeCount())return!0;var e=this._questInfo.in_progress;return!!e.own_quest&&"mission"===e.own_quest.type},_rankLimitPopup:function(e){var t=this._bountyQuest.getRawQuestData();if(!t.limit_info||"number"!=typeof t.limit_info.rank)return!1;var n=t.limit_info.rank;if(n<=this._player.rank)return!1;var i=e.popups.com_caution_2;return i.open().then(function(){var e="<p>Rank"+n+"<br /></p><p class='red'>[]<br />Rank"+n+"</p>";i.setContent(e)}.bind(this)).fail(function(e){console.error(e)}),!0},_showWantedPopup:function(){if(!i.isEmpty(this._bountyQuest)){var e=t.hlbattle.controller.HLBattleWantedPopupController.prototype,a=n.director.getRunningScene();return t.ImplantedPopup.createOrGet(a,e.ROOT_NODE,e.className).open(this._bountyQuest)}},_doDefaultQuestStartingProcess:function(){var e=this._bountyQuest.getRawQuestData(),t=n.director.getRunningScene();this.questCommonDelegate.restartCheckInProgressQuest(e,this._questInfo)||this.startCheckQuestState(t,e)},_loadQuestInfo:function(e){var n=[t.createInstance("apiAQuestInfo").get(),t.createInstance("myselfInfoRepository").getQuestPoints(),t.createInstance("myselfInfoRepository").getMe()];return a.all(n).spread(function(e,t,n){this._questInfo=e.body,this._questPoints=t.getAsObject(),this._player=n.body}.bind(this))},_allModelPrepare:function(e){var n=t.createInstance("questInfoModel"),i=t.createInstance("playerQuestPointsModel"),o=t.createInstance("playerMeModel");return a.all([n.prepare(),i.prepare(),o.prepare()])},startQuest:function(e,n,i,a){t.createInstance("router").navigate("quest/q_002",{q_002:{target:"quest",quest_id:n.quest_id,owner_account_id:n.owner_account_id,quest_type:"mission",episode_num:i,recommended_element_type:this._bountyQuest.getRecommendedElementTypeIndex()}})},update:function(){t.createInstance("sceneManager").reloadScene()},clearOwnQuest:function(){delete this._questInfo.in_progress.own_quest,t.createInstance("BountiesBtnView").display(this._isEnabledBountiesBtn())},_getGuildOrderId:function(){return this._aGuildOrder._aGuildOrder.guild_order_id},refreshPage:function(){t.createInstance("notificationCenter").dispatchEvent(t.core.pager.controller.PagerController.prototype.REFRESH_EVENT,[]);var e=n.director.getRunningScene();t.createInstance("aGuildOrderRepository").import().then(function(n){t.createInstance("AGuildOrderLabelsController").display(e,n),this._receivableStatusUI.update(e,n)}.bind(this)),this._pointPage.initialize()},_touchEndedBackBtnProcess:function(e){t.createInstance("router").navigate("quest/q_portal_top")}})),i.assign(t.pc.hlbattle.hlbattle_001.SceneDelegate.prototype._popups,t.pc.quest.q_001.SceneDelegate.prototype._popups,t.pc.quest.roles.QuestSelectCommon.popups._popups,t.pc.quest.roles.QuestMainPageListPopups._popups,t.pc.present.roles.PresentPopups._popups)}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);e.Q,t.pc.item=t.pc.item||{},t.pc.item.roles=t.pc.item.roles||{},t.pc.item.roles.Routing={_verifyRouterParams001:function(e){}},n.assign(t.pc.item.roles.Routing,t.pc.roles.RoutingCommon)}((this||0).self||global),function(e){var t=e._,n=e.kh;n.PopupFactoryItInfo=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-it_use_info",title:"",buttonLabels:{blackBtn:""},buttons:{blackBtn:function(){this.dismiss()}}},onPopupOpened:function(e,i){e.loadTextures({item_img:n.Img("corecard","item",t.padZero(i.item_id,4)).jpg});var a=t.clone(i);a.description=n.htmlBuilder.insertBrTagForText(a.description,30),e.setHtmlStrings({item_labelimg:['<span class="red" style="font-size: 20px">{{name}}</span><br />','<div style="margin: 0 0 4px; font-size: 20px">{{description}}</div>'].join("").replace().replace(/{{([^\}]+?)}}/g,function(e,t){return a[t]})},n.GameConfig.POPUP_CSS)}})}((this||0).self||global),function(e){var t=e._,n=e.kh;n.PopupFactoryItUseCheck=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-it_use_check",title:"",buttonLabels:{blackBtn:"",blueBtn:""},buttons:{blackBtn:function(){this.dismiss()},blueBtn:function(){n.createInstance("apiAItems").useItem(this.record.a_item_id,1).then(function(){this.dismiss(),n.createInstance("popupFactoryItUseResult").create({}).open(this.record),n.createInstance("notificationCenter").dispatchEvent("refreshItemList",[]),n.createInstance("myselfInfoRepository").allCacheClear()}.bind(this)).fail(function(t){e.console.error(t)})}}},onPopupOpened:function(e,i){e.contentNodes=t.map(["item_img","item_labelimg","ap_labelimg"],function(t){return e.seekWidgetByName(t)}),e.loadTextures({item_img:n.Img("corecard","item",t.padZero(i.item_id,4)).jpg});var a=t.merge({after:i.num-1,type_str:"ap_gain"===i.type?"AP":"BP",current_value:"ap_gain"===i.type?i.current_ap:i.current_bp,recovered_value:i.recovered_amount},i);a.description=n.htmlBuilder.insertBrTagForText(a.description,30),e.record=i,e.setHtmlStrings({item_labelimg:['<span class="red" style="font-size: 20px">{{name}}</span><br />','<div style="margin: 0 0 4px; font-size: 20px">{{description}}</div>','<div style="font-size: 20px"></div>','<div style="margin: 6px auto 0; font-size: 20px">','  <div style="display: inline-block;margin-right: 5px"></div><table class="nb"><tr><td class="numbox"><span class="white">{{num}}&rarr;</span><span class="yellow">{{after}}</span></td></tr></table>',"</div>"].join("").replace(/{{([^\}]+?)}}/g,function(e,t){return a[t]}),ap_labelimg:['<span class="orange">{{type_str}}</span><span class="white">{{current_value}}&rarr;</span><span class="red">{{recovered_value}}</span>'].join("").replace(/{{([^\}]+?)}}/g,function(e,t){return a[t]})},n.GameConfig.POPUP_CSS).then(function(){t.each(e.contentNodes,function(e){e&&e.setVisible(!0)})}),e._clearContents=function(){t.each(this.contentNodes,function(e){e&&e.setVisible(!1)})}}})}((this||0).self||global),function(e){var t=e._,n=e.kh;n.PopupFactoryItUseResult=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-it_use_info",title:"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(){var e=cc.director.getRunningScene();!t.isUndefined(e._delegate)&&t.isFunction(e._delegate._closeItemUsePopup)&&e._delegate._closeItemUsePopup(e),this.dismiss()}}},onPopupOpened:function(e,i){e.loadTextures({item_img:n.Img("corecard","item",t.padZero(i.item_id,4)).jpg});var a=t.clone(i);a.description=n.htmlBuilder.insertBrTagForText(a.description,30),e.setHtmlStrings({item_labelimg:['<span class="red" style="font-size: 20px">{{name}}</span><br />','<div style="margin: 0 0 4px; font-size: 20px">{{description}}</div>','<span style="font-size: 20px"></span>'].join("").replace(/{{([^\}]+?)}}/g,function(e,t){return a[t]})},n.GameConfig.POPUP_CSS)}})}((this||0).self||global),function(e){var t=e._,n=e.kh;n.PopupFactoryItTicketCheck=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-it_use_info",title:"",buttonLabels:{blackBtn:""},buttons:{blackBtn:function(){this.dismiss()}}},onPopupOpened:function(e,i){i.event_info?e.eventId=i.event_info.id:e.eventId=null,e.loadTextures({item_img:n.Img("corecard","item",t.padZero(i.item_id,4)).jpg});var a=t.clone(i);a.description=n.htmlBuilder.insertBrTagForText(a.description,30),e.setHtmlStrings({item_labelimg:['<span class="red" style="font-size: 20px">{{name}}</span><br />','<div style="margin: 0 0 4px; font-size: 20px">{{description}}</div>','<div style="margin: 6px auto 0; font-size: 20px">','  <div style="display: inline-block;margin-right: 5px"></div><table class="nb"><tr><td class="numbox_mini"><span class="white">{{num}}</span></td></tr></table>',"</div>"].join("").replace(/{{([^\}]+?)}}/g,function(e,t){return a[t]})},n.GameConfig.POPUP_CSS)}})}((this||0).self||global),function(e){var t=e._,n=e.kh;n.item=n.item||{},n.item.view=n.item.view||{},n.item.view.ItemExpireDateTimeList=n.SceneObject.extend({ctor:function(e,i,a){if(!e||!t.isFunction(e.addChild))throw new Error("invalid controllerParentNode");if(!i||!t.isFunction(i.addChild))throw new Error("invalid pageViewParentNode");this._controllerParentNode=e,this._pageViewParentNode=i,this._perPage=a||5,this._pageView=n.createInstance("PageView"),this._pageController=n.createInstance("PageController")},init:function(e){var t=this._calcMaxPageCount(e.length,this._perPage),n=this._getPageNodes(t);this._pageViewParentNode.removeAllChildren();var i={data:e,perPage:this._perPage};this._pageView.initialize(n,this._onPageViewChange.bind(i)),this._pageView.setDirection(ccui.ScrollView.DIR_HORIZONTAL),this._pageViewParentNode.addChild(this._pageView);var a=this._getPageControlsConf();return this._pageController.init(this._controllerParentNode,a,this._pageView),this._pageView.gotoFirstPage(),this._pageView},_onPageViewChange:function(e,n){if(!e.initialized){var i=(n-1)*this.perPage,a=i+this.perPage,o=this.data.slice(i,a);t(o.length).times().map(function(t){var n=e.seekWidgetByName("time_limit_ui_"+t);if(!n)throw new Error("Node not found: time_limit_ui_"+t);return n}).each(function(e,t){e.setStrings({limit_date_label:o[t].date,have_label:o[t].amount+""}),e.setAppearance("show")}),e.initialized=!0}},_onDispose:function(){var e=ths._getPageControlsConf();this._pageController.removeCallbacks(e)},_getPageControlsConf:function(){var e={};return e[n.PAGE_CONTROLLER_CONTROLS.NEXT_BUTTON]="btn_next_page",e[n.PAGE_CONTROLLER_CONTROLS.PREVIOUS_BUTTON]="btn_prev_page",e},_calcMaxPageCount:function(e,t){return Math.ceil(e/t)},_loadPageUINode:function(){var e=ccs.load(res["core-popup_layer-time_limit_page_ui"]);return e.node.runAction(e.action),e.node},_getPageNodes:function(e){return t(e).times().map(function(){return this._loadPageUINode()}.bind(this)).value()}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.item=n.item||{},n.item.view=n.item.view||{},n.item.view.ItTimeLimitTicketCheckPopup=n.ImplantedPopup.extend({APPEARANCE_NAMES:{TICKET:"ticket",EXCHANGE_ITEM:"exchangeitem"},_initContents:function(e){var t=this.getNode();this._isExchangeItem(e)?this._initExchangeItemView(e):this._initTicketView(),this._setCorecard(t,e.item_id),this._setItemName(t,e.name),this._setItemDescription(t,e.description)},_isExchangeItem:function(e){return"exchange_ticket"===e.type},_initExchangeItemView:function(e){this._setAppearanceByName(this.APPEARANCE_NAMES.EXCHANGE_ITEM),this.setButtonEvents({btn_cancel:!0,btn_exchange:this._onTouchExchangeButton.bind(this,e)})},_initTicketView:function(){this.setButtonEvents({btn_popup_close:!0}),this._setAppearanceByName(this.APPEARANCE_NAMES.TICKET)},_onTouchExchangeButton:function(e){n.createInstance("router").navigate("exchangeitem",{exchit_001:{item_id:e.item_id}})},_setCorecard:function(e,i){var a=e.seekWidgetByName("item_img");if(null!==a){var o=n.Img("corecard","item",t.padZero(i,4)).jpg;a.setVisible(!0),a.loadTexture(o)}},_setItemName:function(e,t){var n=e.seekWidgetByName("item_name_label");null!==n&&n.setString(t)},_setItemDescription:function(e,t){var n=e.seekWidgetByName("item_description_label");null!==n&&(n.setTextHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),n.setString(t))},_setAppearanceByName:function(e){this.getNode().setAppearance(e)}})}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.item=t.pc.item||{},t.pc.item.it_001=t.pc.item.it_001||{},t.pc.item.it_001.Scene=t.BaseScene.extend({resourceFileName:"it_001/it_001.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[{tab1:{node:"tab_0","content-node":"tab_0_node"},tab2:{node:"tab_1","content-node":"tab_1_node"},tab3:{node:"tab_2","content-node":"tab_2_node"}}],componentName:"item",sceneName:"it_001",_delegate:null,_init:function(){this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc=t.pc||{},t.pc.item=t.pc.item||{},t.pc.item.it_001=t.pc.item.it_001||{},t.pc.item.it_001.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../it_popup_ui.json"],_popups:{itInfo:{factoryName:"popupFactoryItInfo"},itUseCheck:{factoryName:"popupFactoryItUseCheck"},itTicketCheck:{factoryName:"popupFactoryItTicketCheck"}},_controllerInitialized:null,onSceneInit:function(e){return this._setBackBtn(e),a.resolve()},onSceneEnter:function(e){return this._controllerInitialized={},t.createInstance("myselfInfoRepository").getQuestPoints(!0)},tabCallbackTab0:function(e){this._controllerInitialized.tab_0||(t.core.pager.helper.coreCardListUI(e,{baseName:"tab_0_node",cardType:"misc",cardFrame:"amount",apiName:"apiAItems",apiMethod:"getCureEvolution",apiParams:[t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE]},new t.core.eventHandling.BaseEventHandler(this._touchCureEvolutionCoreCard,this)).initialize(),this._controllerInitialized.tab_0=!0)},tabCallbackTab1:function(e){this._controllerInitialized.tab_1||(t.core.pager.helper.coreCardListUI(e,{baseName:"tab_1_node",cardType:"misc",cardFrame:"amount",apiName:"apiAItems",apiMethod:"getTreasure",apiParams:[t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE]},new t.core.eventHandling.BaseEventHandler(this._touchTreasureCoreCard,this)).initialize(),this._controllerInitialized.tab_1=!0)},tabCallbackTab2:function(e){this._controllerInitialized.tab_2||(t.core.pager.helper.coreCardListUI(e,{baseName:"tab_2_node",cardType:"misc",cardFrame:"amount",apiName:"apiAItems",apiMethod:"getTicket",apiParams:[t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE]},new t.core.eventHandling.BaseEventHandler(this._touchTicketCoreCard,this)).initialize(),this._controllerInitialized.tab_2=!0)},_touchCureEvolutionCoreCard:function(e){var t=n.director.getRunningScene(),i=e.getRawData();switch(i.type){case"evolution":this._onTouchItemEvolution(t,i);break;default:this._onTouchItemCure(t,i)}},_touchTreasureCoreCard:function(e){var t=n.director.getRunningScene();this._onTouchItemTreasure(t,e.getRawData())},_touchTicketCoreCard:function(e){var t=n.director.getRunningScene();this._onTouchItemTicket(t,e.getRawData())},_onTouchItemCure:function(e,n){return n.num<1?void e.popups.itInfo.open(n):void t.createInstance("myselfInfoRepository").getQuestPoints().then(function(t){return"ap_gain"===n.type&&t.getMaxAP()<=t.getAP()?void e.popups.itInfo.open(n):"bp_gain"===n.type&&t.getMaxBP()<=t.getBP()?void e.popups.itInfo.open(n):void e.popups.itUseCheck.open(i.merge({current_ap:t.getAP(),current_bp:t.getBP()},n))},console.error)},_onTouchItemEvolution:function(e,t){e.popups.itInfo.open(t)},_closeItemUsePopup:function(n){t.createInstance("myselfInfoRepository").getQuestPoints().then(function(e){this._playerInfo=e.getAsObject()}.bind(this)).catch(function(t){e.console.error()}),t.createInstance("notificationCenter").dispatchEvent(t.core.pager.controller.PagerController.prototype.REFRESH_EVENT,[1])},_onTouchItemTreasure:function(e,t){e.popups.itInfo.open(t)},_onTouchItemTicket:function(e,n){null===n.expire_info[0].date?e.popups.itTicketCheck.open(n):(t.ImplantedPopup.createOrGet(e,"it_time_limit_ticket_check","ItTimeLimitTicketCheckPopup").open(n),this._initExpireDateTimeList(e,n))},_initExpireDateTimeList:function(e,n){if(!this._expireDateTimeList){var i=this._getPopupUiNode(e);if(!i)return;var a=this._getPagePanelNode(i);if(!a)return;this._expireDateTimeList=t.createInstance("ItemExpireDateTimeList",[i,a,5])}this._expireDateTimeList.init(n.expire_info)},_getPopupUiNode:function(e){return e.seekWidgetByName("popup_ui")},_getPagePanelNode:function(e){return e.seekWidgetByName("page_panel")},_touchEndedBackBtnProcess:function(e){t.createInstance("router").navigate("mypage/my_001")}}),i.assign(t.pc.item.it_001.SceneDelegate.prototype,t.pc.roles.UIUtility,t.pc.item.roles.Routing)}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.router=n.router||{},n.router.routes=n.router.routes||{},t.merge(n.router.routes,{item:{item:"it_001","item/it_001":"it_001"}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);e.Q,t.pc.list=t.pc.list||{},t.pc.list.roles=t.pc.list.roles||{},t.pc.list.roles.Routing={_verifyRouterParams007_008:function(e){if(n.isUndefined(e.routerParams.li_007_008))switch(t.createInstance("router").getCurrentSceneName()){default:case"list/li_007":e.routerParams.li_007_008={},e.routerParams.li_007_008.direction="tab_0";break;case"list/li_008":e.routerParams.li_007_008={},e.routerParams.li_007_008.direction="tab_1"}},_navigateToBook001:function(e){t.createInstance("router").navigate("book/book_001_"+e)}},n.assign(t.pc.list.roles.Routing,t.pc.roles.RoutingCommon)}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.list=t.pc.list||{},t.pc.list.li_007_008=t.pc.list.li_007_008||{},t.pc.list.li_007_008.Scene=t.BaseScene.extend({resourceFileName:"li_007_8/li_007_8.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[{tab1:{node:"tab_0","content-node":"tab_0_node"},tab2:{node:"tab_1","content-node":"tab_1_node"}}],componentName:"list",sceneName:"li_007_008",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath("tab_0_node"),"btn_recommended","btnCallbackTab0NodeBtnRecommended",null,function(){alert("{{popupli_auto_chooseNpopupcom_non_offer}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("tab_0_node"),"btn_decision","btnCallbackTab0NodeBtnDecision",null,function(){alert("{{}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("tab_0_node"),"filter_btn","btnCallbackTab0NodeFilterBtn",null,function(){alert("{{com_filter_weapon}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("tab_1_node"),"btn_recommended","btnCallbackTab1NodeBtnRecommended",null,function(){alert("{{popupli_auto_chooseNpopupcom_non_offer}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("tab_1_node"),"btn_decision","btnCallbackTab1NodeBtnDecision",null,function(){alert("{{}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("tab_1_node"),"filter_btn","btnCallbackTab1NodeFilterBtn",null,function(){alert("{{com_filter_other}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc=t.pc||{},t.pc.list=t.pc.list||{},t.pc.list.li_007_008=t.pc.list.li_007_008||{},t.pc.list.li_007_008.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../li_popup_ui.json"],REPLICATION_DELAY:100,_popups:{popupResult:{factoryName:"popupFactoryBlue",title:"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){this.dismiss()}}},popupConfirm:{factoryName:"popupFactoryBlackBlue",title:"",buttonLabels:{blackBtn:"",blueBtn:"OK"},buttons:{blackBtn:function(e){this.dismiss()},blueBtn:function(e){this.dismiss()}}},popupNonOffer:{factoryName:"popupFactoryPopupCommon",resourceName:"core-popup-com_non_offer",title:"",buttonLabels:{blackBtn:""},buttons:{blackBtn:function(e){this.dismiss()}}}},_createDisplayFilterSettings:function(){return{tab_0_node:[t.displayFilter.enums.FILTER_NAME.SELL_WEAPON,"com_filter_weapon"],tab_1_node:[t.displayFilter.enums.FILTER_NAME.SELL_SUMMON,"com_filter_other"]}},onSceneInit:function(e){return this._verifyRouterParams007_008(e),this._summonOrbLabel=t.createInstance("SummonOrbAmountLabelController"),this._setBackBtn(e),this._createDisplayFilterController(e),a.resolve()},onSceneExit:function(e){return a.defer(),i.each(this._eventListeners,function(e){t.createInstance("notificationCenter").removeEventListener(e)}),this._displayFilterClean(),this._weaponSellableListController&&this._weaponSellableListController.dispose(),this._summonSellableListController&&this._summonSellableListController.dispose(),a.resolve()},onPageInAnimationEnd:function(e){var t=e.routerParams.li_007_008.direction;return e.tabDelegateList[0].selectTab(e.seekWidgetByName(t)),this._setSubHeaderLabels(e,{weapon:0,summon:1}),a.resolve()},tabCallbackTab0:function(e){if(this._initializeDisplayFilterController("tab_0_node"),!this._weaponSellableListController){var n=t.core.pager.helper.coreCardListUI(e,{baseName:"tab_0_node",cardType:"weapon",cardFrame:"full",apiName:"apiAWeapons",apiMethod:"getSellableList",apiParams:[t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE],apiModel:t.core.model.AWeapon,sortKey:"list_sell_weapons",maxSelectCount:20});n.addUpdateEventListener(function(e,n,i,a){t.pc.roles.UIUtility._setEnableButton(this,a.getSelectedData().length>0)},e.seekWidgetByPath("tab_0_node..btn_decision")),n.initialize(),this._weaponSellableListController=n}},tabCallbackTab1:function(e){if(this._summonOrbLabel.display(),this._initializeDisplayFilterController("tab_1_node"),!this._summonSellableListController){var n=t.core.pager.helper.coreCardListUI(e,{baseName:"tab_1_node",cardType:"summon",cardFrame:"full",apiName:"apiASummons",apiMethod:"getSellableList",apiParams:[t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE],apiModel:t.core.model.ASummon,sortKey:"list_sell_summons",maxSelectCount:20});n.addUpdateEventListener(function(e,n,i,a){t.pc.roles.UIUtility._setEnableButton(this,a.getSelectedData().length>0)},e.seekWidgetByPath("tab_1_node..btn_decision")),n.initialize(),this._summonSellableListController=n}},btnCallbackTab0NodeBtnRecommended:function(e){var n=a.defer();return n.reject(this._override),t.createInstance("apiAWeapons").getRecommendSellableList().then(function(n){if(0!==n.body.max_record_count){var i=n.body.data.map(function(e){return new t.core.model.AWeapon(e)});this._popupConfirmRareSell(e,"decisionWeapon",i)}else this._popupNoOffer(e)}.bind(this)).fail(function(e){console.error(e.stack)}),n.promise},btnCallbackTab0NodeBtnDecision:function(e){return this._weaponSellableListController&&this.decisionWeapon(e,this._weaponSellableListController.getSelectedData()),a.reject(this._override)},decisionWeapon:function(e,n){var i,o=n.map(function(e){return e.getAId()}),r=t.createInstance("myselfInfoRepository").getMyCurrency(),s=t.createInstance("apiAWeapons").confirmSellPrice(o);i=o.length>10?t.ImplantedPopup.create(e,"com_consumption_check_result_2","ComSellWeaponsPopup"):t.ImplantedPopup.create(e,"com_consumption_check_result_1","ComSellWeaponsPopup"),a.all([r,s]).then(function(t){var a=t[0].getGemAmount(),r=t[1].body.total_sell_price,s=t[1].body.total_sell_sphere,c=n.map(function(e){return e.getRawData()});return i.open({scene:e,materials:c,ids:o,myGem:a,earnGem:r,earnExpitem:s})}.bind(this)).then(this._popupComSellWeaponsConfirm.bind(this,o)).then(i.reopenByResultMode.bind(i)).catch(function(e){e&&e.stack&&console.error(e)}.bind(this))},_popupComSellWeaponsConfirm:function(e){return t.createInstance("apiAWeapons").sell(e).delay(this.REPLICATION_DELAY).then(this._completeSoldWeapons.bind(this))},btnCallbackTab1NodeBtnRecommended:function(e){var n=a.defer();return n.reject(this._override),t.createInstance("apiASummons").getRecommendSellableList().then(function(n){if(0!==n.body.max_record_count){var i=n.body.data.map(function(e){return new t.core.model.ASummon(e)});this._popupConfirmRareSell(e,"decisionSummon",i)}else this._popupNoOffer(e)}.bind(this)).fail(function(e){console.error(e.stack)}),n.promise},btnCallbackTab1NodeBtnDecision:function(e){return this._summonSellableListController&&this.decisionSummon(e,this._summonSellableListController.getSelectedData()),a.reject(this._override)},decisionSummon:function(e,n){var i,o=n.map(function(e){return e.getAId()}),r=t.createInstance("myselfInfoRepository").getMyCurrency(),s=t.createInstance("apiASummons").confirmSellPrice(o);i=o.length>10?t.ImplantedPopup.create(e,"com_consumption_check_result_4","ComSellSummonsPopup"):t.ImplantedPopup.create(e,"com_consumption_check_result_3","ComSellSummonsPopup"),a.all([r,s]).then(function(t){var a=t[0].getGemAmount(),r=t[1].body.total_sell_price,s=t[1].body.total_sell_sphere,c=t[0].getSummonOrbAmount(),u=t[1].body.total_summon_orb,l=n.map(function(e){return e.getRawData()});return i.open({scene:e,materials:l,ids:o,myGem:a,earnGem:r,earnExpitem:s,myOrb:c,earnOrb:u})}.bind(this)).then(this._popupComSellSummonsConfirm.bind(this,o)).then(i.reopenByResultMode.bind(i)).catch(function(e){e&&e.stack&&console.error(e)}.bind(this))},_popupComSellSummonsConfirm:function(e){return t.createInstance("apiASummons").sell(e).delay(this.REPLICATION_DELAY).then(this._completeSoldSummons.bind(this))},_completeSoldWeapons:function(){return this._refreshCurrency(),this._refreshHeaderLabels(),this._weaponSellableListController.refresh(!1,!0)},_completeSoldSummons:function(){return this._refreshCurrency(),this._refreshHeaderLabels(),this._summonSellableListController.refresh(!1,!0)},_refreshCurrency:function(){var e=n.director.getRunningScene();null!=e.headerDelegate&&e.headerDelegate.updateCurrency()},_refreshHeaderLabels:function(){this._refreshSubHeaderLabels(n.director.getRunningScene(),{weapon:0,summon:1})},_popupNoOffer:function(e){var n=e.popups.popupNonOffer;n.open().then(function(){t.setTouchEventHandlers(n,{"TOUCH_ENDED btn_present":function(){this._navigateToPresent()},"TOUCH_ENDED btn_gacha":function(){this._navigateToGachaTop()},"TOUCH_ENDED btn_quest":function(){this._navigateToQuest()}},this)}.bind(this)).fail(function(e){console.error(e.stack)})},_popupConfirmRareSell:function(e,n,i){var a=e.popups.popupConfirm;a.setTitle(""),a.setContent("N<br />"),a.open().then(function(){t.setTouchEventHandlers(a,{"TOUCH_ENDED blue_btn":function(){this[n](e,i),a.dismiss()}.bind(this),"TOUCH_ENDED black_btn":function(){a.dismiss()}.bind(this)},this)}.bind(this)).fail(function(e){console.error(e.stack)})},_refreshSubHeaderLabels:function(e,t){delete this._playerInfo,this._setSubHeaderLabels(e,t)},_setSubHeaderLabels:function(e,n){i.isUndefined(e._delegate)||i.isUndefined(e._delegate._playerInfo)?t.createInstance("apiAPlayers").get("me").then(function(t){this._playerInfo=t.body,this._setSubHeaderLabelsCore(e,n)}.bind(this)).fail(function(e){console.error(e.stack)}):(this._playerInfo=e._delegate._playerInfo,this._setSubHeaderLabelsCore(e,n))},_setSubHeaderLabelsCore:function(e,t){null==t&&(console.warn("list/src/roles/ListCommon._setSubHeaderLabelsCore: no tabNumbers specified, using default values"),t={character:0,weapon:1,summon:2}),this._setCharacterNumberHeaderLabel(e,t.character),this._setWeaponNumberHeaderLabel(e,t.weapon),this._setSummonNumberHeaderLabel(e,t.summon)},_setCharacterNumberHeaderLabel:function(e,t){if(null!=t){if(i.isUndefined(this._playerInfo.character_num))return void console.warn("[NOTICE] Could not find character_num.");var n=":"+this._playerInfo.character_num,a=e.seekWidgetByPath("tab_"+t+"_node.header_sub_label");a&&a.setString(n)}},_setWeaponNumberHeaderLabel:function(e,n){if(null!=n){if(i.isUndefined(this._playerInfo.weapon_num)||i.isUndefined(this._playerInfo.max_weapon_num))return void console.warn("[NOTICE] Could not find weapon_num | max_weapon_num.");var a=""+t.w("weapon")+":"+this._playerInfo.weapon_num+"/"+this._playerInfo.max_weapon_num,o=e.seekWidgetByPath("tab_"+n+"_node.header_sub_label");o&&o.setString(a)}},_setSummonNumberHeaderLabel:function(e,n){if(null!=n){if(i.isUndefined(this._playerInfo.summon_num)||i.isUndefined(this._playerInfo.max_summon_num))return void console.warn("[NOTICE] Could not find summon_num | max_summon_num.");var a=""+t.w("summon")+":"+this._playerInfo.summon_num+"/"+this._playerInfo.max_summon_num,o=e.seekWidgetByPath("tab_"+n+"_node.header_sub_label");o&&o.setString(a)}},_touchEndedBackBtnProcess:function(e){var t=this._getCurrentTabType(e);this._navigateToBook001(t)},_getCurrentTabType:function(e){switch(e.tabDelegateList[0].selected){case"tab_0":return"weapon";case"tab_1":return"summon"}}}),i.assign(t.pc.list.li_007_008.SceneDelegate.prototype,t.pc.roles.UIUtility,t.pc.list.roles.Routing,t.displayFilter.roles.DisplayFilterSceneController)}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.router=n.router||{},n.router.routes=n.router.routes||{},t.merge(n.router.routes,{list:{"list/li_007":"li_007_008","list/li_008":"li_007_008","list/detail/de_001":"de_001_002","list/detail/de_003":"de_003","list/detail/de_004":"de_004"}})}((this||0).self||global),function(e){var t=(e.cc,e.kh),n=e._;t.mission=t.mission||{},t.mission.model=t.mission.model||{},t.mission.model.MissionList=t.SceneObject.extend({prepare:function(){return n.isEmpty(this._data)?this.update():this._promise},update:function(){throw new Error("Not Implemented")},updateByData:function(e){this._setData(e),this._setCompleteReward(),this._setMissions()},promise:function(){return n.isEmpty(this._data)&&window.alert("You must call prepare first!"),this._promise},getType:function(){throw new Error("Not Implemented")},_setData:function(e){this._data=e},_setCompleteReward:function(){n.isEmpty(this._data)&&window.alert("You must call prepare first!"),this._completeReward=t.createInstance("MissionRewardModel",[this._data.complete_reward])},_setMissions:function(){n.isEmpty(this._data)&&window.alert("You must call prepare first!"),this._missions=n.map(this._data.missions,function(e){return t.createInstance("MissionModel",[e,this.getType()])}.bind(this))},isComplete:function(){return n.isEmpty(this._data)&&window.alert("You must call prepare first!"),this._data.complete},getMaxMissionNum:function(){return n.isEmpty(this._data)&&window.alert("You must call prepare first!"),this._data.max_missions},getClearMissionNum:function(){return n.isEmpty(this._data)&&window.alert("You must call prepare first!"),this._data.clear_missions},hasReward:function(){return n.isEmpty(this._data)&&window.alert("You must call prepare first!"),this._data.has_reward},getCompleteReward:function(){return n.isEmpty(this._data)&&window.alert("You must call prepare first!"),this._completeReward},getMissions:function(){return n.isEmpty(this._data)&&window.alert("You must call prepare first!"),this._missions}})}((this||0).self||global),function(e){var t=(e.cc,e.kh);e._,t.mission=t.mission||{},t.mission.model=t.mission.model||{},t.mission.model.DailyMissionList=t.mission.model.MissionList.extend({update:function(){var e=t.createInstance("apiAMissions");return this._promise=e.getDaily().then(function(e){this.updateByData(e.body)}.bind(this)),this._promise},getType:function(){return"daily"}})}((this||0).self||global),function(e){var t=(e.cc,e.kh);e._,t.mission=t.mission||{},t.mission.model=t.mission.model||{},t.mission.model.WeeklyMissionList=t.mission.model.MissionList.extend({update:function(){var e=t.createInstance("apiAMissions");return this._promise=e.getWeekly().then(function(e){this.updateByData(e.body)}.bind(this)),this._promise},getType:function(){return"weekly"}})}((this||0).self||global),function(e){var t=(e.cc,e.kh);e._,t.createNameSpaceIfNotExists("mission.model"),t.mission.model.EventMissionList=t.mission.model.MissionList.extend({update:function(){return this._promise=this._getAMissionsEventPromise().then(function(e){this.updateByData(e.body)}.bind(this)),this._promise},_getAMissionsEventPromise:function(){return t.createInstance("apiAMissions").getEvent().fail(function(e){console.warn(e.stack)})},getType:function(){return"event"}})}((this||0).self||global),function(e){var t=(e.cc,e.kh);e._,t.mission=t.mission||{},t.mission.model=t.mission.model||{},t.mission.model.Mission=t.SceneObject.extend({ctor:function(e,n){this._data=e,this._type=n,this._reward=t.createInstance("MissionRewardModel",[this._data.reward])},getAMissionId:function(){if(null==this._data)throw new Error("[Mission::getAMissionId] _data is null");return this._data.a_mission_id},getTitle:function(){if(null==this._data)throw new Error("[Mission::getTitle] _data is null");return this._data.title},getDescription:function(){if(null==this._data)throw new Error("[Mission::getDescription] _data is null");return this._data.description},isComplete:function(){if(null==this._data)throw new Error("[Mission::isComplete] _data is null");return this._data.clear},getMaxProgress:function(){if(null==this._data)throw new Error("[Mission::getMaxProgress] _data is null");return this._data.max_progress},getNowProgress:function(){if(null==this._data)throw new Error("[Mission::getNowProgress] _data is null");return this._data.now_progress},getRoutingPage:function(){if(null==this._data)throw new Error("[Mission::getRoutingPage] _data is null");return this._data.routing_page},getState:function(){return this._data.state},getUnlockCondition:function(){return this._data.unlock_condition},getReward:function(){if(null==this._data)throw new Error("[Mission::getReward] _data is null");return this._reward},getType:function(){if(null==this._type)throw new Error("[Mission::getType] _type is null");return this._type},isEventDaily:function(){if(null==this._data)throw new Error("[Mission::isEventDaily] _data is null");return!0===this._data.is_daily},getEventId:function(){if(null==this._data)throw new Error("[Mission::getEventId] _data is null");return this._data.event_id}})}((this||0).self||global),function(e){var t=(e.cc,e.kh),n=e._;t.mission=t.mission||{},t.mission.model=t.mission.model||{},t.mission.model.Reward=t.SceneObject.extend({ctor:function(e){this._data=e},getId:function(){if(null==this._data)throw new Error("[Reward::getGameItemId] _data is null");return this._data.id},getType:function(){if(null==this._data)throw new Error("[Reward::getRewardType] _data is null");return this._data.kind},getName:function(){if(null==this._data)throw new Error("[Reward::getGameItemName] _data is null");return this._data.name},getCount:function(){if(null==this._data)throw new Error("[Reward::getCount] _data is null");return this._data.count},getRawData:function(){if(null==this._data)throw new Error("[Reward::getGameItemRecord] _data is null");return n.cloneDeep(this._data)}})}((this||0).self||global),function(e){var t=(e.cc,e.ccui,e.kh),n=(e.res,e.gResources,e._);t.mission=t.mission||{},t.mission.view=t.mission.view||{},t.mission.view.CompleteReward=t.SceneObject.extend({show:function(e){this._setRewardTitle(e.getCompleteReward()),this._setProgress(e.getClearMissionNum(),e.getMaxMissionNum()),this._showCompleteStamp(e.isComplete()),this._setRewardCoreCard(e.getCompleteReward())},_getRewardCompleteBase:function(){throw new Error("Not Implemented")},_getRewardLabel:function(){return this._getRewardCompleteBase().seekWidgetByName("complete_reward_label")},_getStatusLabel:function(){return this._getRewardCompleteBase().seekWidgetByName("mission_status_label")},_getRewardCompleteNode:function(){return this._getRewardCompleteBase().seekWidgetByName("mission_complete_reward_ui")},play:function(){this._getRewardCompleteNode().animate("stamp_animation",!1)},_showCompleteStamp:function(e){var t=e?"received_in_full":"default_view";this._getRewardCompleteNode().setAppearance(t)},_setRewardTitle:function(e){var t=e.getName()+""+e.getCount();this._getRewardLabel().setString(t)},_setProgress:function(e,t){this._getStatusLabel().setString(e+"/"+t)},_setRewardCoreCard:function(e){var t=this._getRewardCompleteBase(),n=e.getRawData();this._setProperCoreCardElementRarity(t,n)}}),n.assign(t.mission.view.CompleteReward.prototype,t.pc.roles.CoreCardCommon)}((this||0).self||global),function(e){var t=e.cc,n=e.kh;e._,n.mission=n.mission||{},n.mission.view=n.mission.view||{},n.mission.view.DailyCompleteReward=n.mission.view.CompleteReward.extend({_getRewardCompleteBase:function(){return t.director.getRunningScene().seekWidgetByName("complete_reward_base_daily")}})}((this||0).self||global),function(e){var t=e.cc,n=e.kh;e._,n.mission=n.mission||{},n.mission.view=n.mission.view||{},n.mission.view.WeeklyCompleteReward=n.mission.view.CompleteReward.extend({_getRewardCompleteBase:function(){return t.director.getRunningScene().seekWidgetByName("complete_reward_base_weekly")}})}((this||0).self||global),function(e){var t=e.cc,n=(e.ccui,e.kh);e.res,e.gResources,e._,n.createNameSpaceIfNotExists("mission.view"),n.mission.view.EventCharacter=n.SceneObject.extend({show:function(e){return e.isComplete()?void this._setAppearanceComplete():0===e.getMaxMissionNum()?void this._setAppearanceEventNotHeld():void this._setAppearanceEventNowInProgress()},hide:function(){this._setAppearanceHide()},_getAnimationNode:function(){return t.director.getRunningScene().seekWidgetByName("mission_001_amon_ui")},_setAppearanceComplete:function(){var e=this._getAnimationNode();null!=e&&e.setAppearance("complete_view")},_setAppearanceEventNotHeld:function(){var e=this._getAnimationNode();null!=e&&e.setAppearance("non_holding_view")},_setAppearanceEventNowInProgress:function(){var e=this._getAnimationNode();null!=e&&e.setAppearance("opening_view")},_setAppearanceHide:function(){var e=this._getAnimationNode();null!=e&&e.setAppearance("nothing_view")}})}((this||0).self||global),function(e){var t=e.cc,n=(e.ccui,e.kh);e.res,e.gResources,e._,n.createNameSpaceIfNotExists("mission.view"),n.mission.view.EventAttention=n.SceneObject.extend({show:function(){var e=this._getAttentionLabel();if(null!=e){e.setText(["AM500",""].join("\n"))}},_getAttentionLabel:function(){return t.director.getRunningScene().seekWidgetByName("mission_attention_label")}})}((this||0).self||global),function(e){var t=e.cc,n=(e.ccui,e.kh);e.res,e.gResources,e._,n.createNameSpaceIfNotExists("mission.view"),n.mission.view.NormalAttention=n.SceneObject.extend({show:function(){var e=this._getAttentionLabel();if(null!=e){e.setText(["AM500",""].join("\n"))}},_getAttentionLabel:function(){return t.director.getRunningScene().seekWidgetByName("mission_attention_label")}})}((this||0).self||global),function(e){var t=(e.cc,e.ccui),n=e.kh,i=e.res,a=(e.gResources,e._);n.pc=n.pc||{},n.pc.mission=n.pc.mission||{},n.pc.mission.roles=n.pc.mission.roles||{},n.pc.mission.roles.MissionPageListController={_fillupMissionList:function(e,t,o,r,s){a.isUndefined(this._missionGroupsSettings[s])&&console.warn(""+s),$staticRes(i["mission-mission_001-mission_001_missionlist_daily_page_ui"]),$staticRes(i["mission-mission_001-mission_001_missionlist_weekly_page_ui"]),$staticRes(i["mission-mission_001-mission_001_missionlist_event_page_ui"]);var c=e.seekWidgetByName(o);r.promise().then(function(){var e=r.getMissions().length;"event"===s&&(r.isComplete()?this._setCompleteMessageToNothingNode(c):this._setNotHeldMessageToNothingNode(c)),e>0?this._showListPage(c):this._showNothingNode(c);this._fillupList(c,{viewParent:n.PageListParams.MISSION_LIST.viewParent,subPageRes:n.PageListParams.MISSION_LIST.subPageRes[s],panelsPerPage:n.PageListParams.MISSION_LIST.perPage},r.getMissions(),e,{},this._initMissionWidget.bind(this))}.bind(this))},_setCompleteMessageToNothingNode:function(e){var t=this._getNothingLabel(e);null!=t&&t.setString("")},_setNotHeldMessageToNothingNode:function(e){var t=this._getNothingLabel(e);null!=t&&t.setString("")},_initMissionWidget:function(e,t,n){t.isComplete()?(this._setMissionWidgetClear(e),this._setReceiveBtnCallback(e,t)):(this._setMissionWidgetDefault(e),this._setChallengeBtnCallback(e,t)),this._setMissionTitle(e,t),this._setMissionDescription(e,t),this._setMissionProgress(e,t),this._setEventDailyIcon(e,t.isEventDaily());var i=t.getReward();this._setMissionRewardDescription(e,i);var a=this._initRewardCoreCard(e,i,"corecard_ui_68");this._setRewardCoreCardCallback(a,t)},_setEventDailyIcon:function(e,t){var n=this._getEventDailyIcon(e);null!=n&&n.setVisible(t)},_setMissionTitle:function(e,t){var n=this._getMissionTitleLabel(e);null!=n&&n.setString(t.getTitle())},_setMissionDescription:function(e,t){var n=this._getMissionDescriptionLabel(e);null!=n&&n.setString(t.getDescription())},_setMissionProgress:function(e,t){var n=this._getMissionProgressLabel(e);null!=n&&n.setString(t.getNowProgress()+"/"+t.getMaxProgress())},_setMissionRewardDescription:function(e,t){var n=this._getMissionRewardLabel(e);null!=n&&n.setString(t.getName()+""+t.getCount())},_setMissionWidgetDefault:function(e){e.setAppearance("default_view");var t=this._getMissionReceiveUI(e);null!=t&&t.setAppearance("btn_challenge")},_setMissionWidgetClear:function(e){e.setAppearance("clear_view");var t=this._getMissionReceiveUI(e);null!=t&&t.setAppearance("btn_get")},_showListPage:function(e){var t=this._getListNode(e);if(null!=t){t.setVisible(!0);var n=this._getNothingNode(e);return null==n?void console.warn("[MissionPageListController::_showListPage] Can not find nothing_node"):void n.setVisible(!1)}console.warn("[MissionPageListController::_showListPage] Can not find List Page node")},_showNothingNode:function(e){var t=this._getNothingNode(e);if(null!=t){t.setVisible(!0);var n=this._getListNode(e);return null==n?void console.warn("[MissionPageListController::_showNothingNode] Can not find List Page node"):void n.setVisible(!1)}console.warn("[MissionPageListController::_showNothingNode] Can not find nothing_node")},_setRewardCoreCardCallback:function(e,n){e.addTouchEventListener(function(e,i){i===t.Widget.TOUCH_ENDED&&this.rewardCoreCardCallback(e,n)},this)},_setReceiveBtnCallback:function(e,n){var i=this._getReceiveBtn(e);return null==i?void console.warn("[ERROR] Could not access btn_get."):void i.addTouchEventListener(function(i,a){a===t.Widget.TOUCH_ENDED&&this.btnGetCallback(e,n)}.bind(this))},_setChallengeBtnCallback:function(e,n){var i=this._getChallengeBtn(e);return null==i?void console.warn("[ERROR] Could not access btn_challenge."):void i.addTouchEventListener(function(i,a){a===t.Widget.TOUCH_ENDED&&this.btnChallengeCallback(e,n)}.bind(this))},_initRewardCoreCard:function(e,t,n){var i=t.getRawData();return this._setProperCoreCardElementRarity(e,i,n)},_getMissionTitleLabel:function(e){return e.seekWidgetByName("mission_header_label")},_getMissionDescriptionLabel:function(e){return e.seekWidgetByName("explanation_label")},_getMissionProgressLabel:function(e){return e.seekWidgetByName("achievement_status_label")},_getMissionRewardLabel:function(e){return e.seekWidgetByName("mission_reward_label")},_getMissionReceiveUI:function(e){return e.seekWidgetByName("mission_receive_ui")},_getListNode:function(e){return e.seekWidgetByName("list_node")},_getNothingNode:function(e){return e.seekWidgetByName("nothing_node")},_getNothingLabel:function(e){return e.seekWidgetByName("nothing_label")},_getReceiveBtn:function(e){return e.seekWidgetByName("btn_get")},_getChallengeBtn:function(e){return e.seekWidgetByName("btn_challenge")},_getEventDailyIcon:function(e){return e.seekWidgetByName("mission_icon_event_daily")}},a.assign(n.pc.mission.roles.MissionPageListController,n.pc.list.roles.PageListControllerCommon,n.pc.roles.UIUtility)}((this||0).self||global),function(e){var t=(e.cc,e.ccui,e.kh);e.res,e.gResources,e._,t.pc=t.pc||{},t.pc.mission=t.pc.mission||{},t.pc.mission.roles=t.pc.mission.roles||{},t.pc.mission.roles.MissionListTab={_tabIconToMissionListType:{daily:"icon_0",weekly:"icon_1",event:"icon_2"},_updateNotifyIcon:function(e,t){var n=this._getIconNode(e,t.getType());return null==n?void console.warn("[MissionListTab::_updateNotifyIcon] can not find iconNode"):void n.setVisible(t.hasReward())},_getIconNode:function(e,t){var n=this._tabIconToMissionListType[t];return e.seekWidgetByName(n)}}}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.mission=t.pc.mission||{},t.pc.mission.mission_001=t.pc.mission.mission_001||{},t.pc.mission.mission_001.Scene=t.BaseScene.extend({resourceFileName:"mission_001/mission_001.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[{tab1:{node:"tab_0","content-node":"tab_0_node"},tab2:{node:"tab_1","content-node":"tab_1_node"},tab3:{node:"tab_2","content-node":"tab_2_node"}}],componentName:"mission",sceneName:"mission_001",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_present","btnCallbackBtnPresent",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"present")),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc=t.pc||{},t.pc.mission=t.pc.mission||{},t.pc.mission.mission_001=t.pc.mission.mission_001||{},t.pc.mission.mission_001.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../mission_popup_ui.json"],_popups:{com_caution_2:{factoryName:"popupFactoryBlue",title:"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){this.dismiss()}}},com_caution_wait_update:{factoryName:"popupFactoryBlue",title:"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){this.dismiss()}}},com_caution_progress_locked:{factoryName:"popupFactoryBlue",title:"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){this.dismiss()}}}},_missionGroupsSettings:{daily:{modelName:"dailyMissionListModel",viewName:"DailyCompleteRewardView",tabName:"tab_0_node"},weekly:{modelName:"weeklyMissionListModel",viewName:"WeeklyCompleteRewardView",tabName:"tab_1_node"},event:{modelName:"eventMissionListModel",tabName:"tab_2_node"}},_tabNode:{mission_001:"tab_0",mission_001_a:"tab_0",mission_001_b:"tab_1",mission_001_c:"tab_2"},_settingKey:{mission_001:"daily",mission_001_a:"daily",mission_001_b:"weekly",mission_001_c:"event"},onSceneInit:function(e){a.defer(),this._setBackBtn(e),i.each(this._missionGroupsSettings,function(n){var i=t.createInstance(n.modelName);i.update().then(function(){this._updateNotifyIcon(e,i)}.bind(this))},this);var n=t.createInstance("router").getCurrentSceneName();this._showTabByCurrentScene(n);var o=this._settingKey[n]||"daily";this._initMissionList(e,o);var r="event"===o,s=r?"EventAttentionView":"NormalAttentionView";return t.createInstance(s).show(),this._showEventCharacter(r),a.resolve()},_initMissionList:function(e,n){var i=this._missionGroupsSettings[n],a=t.createInstance(i.modelName);this._hideMissionListViewParent(e,n),a.update().then(function(){i.viewName&&t.createInstance(i.viewName).show(a);this._fillupMissionList(e,"",i.tabName,a,n),this._updateNotifyIcon(e,a),this._showMissionListViewParent(e,n)}.bind(this))},_showMissionListViewParent:function(e,t){var n=this._getMissionViewParent(e,t);n&&n.setVisible(!0)},_hideMissionListViewParent:function(e,t){var n=this._getMissionViewParent(e,t);n&&n.setVisible(!1)},_getMissionViewParent:function(e,n){var i=this._missionGroupsSettings[n].tabName;return e.seekWidgetByPath(i+".."+t.PageListParams.MISSION_LIST.viewParent)},onSceneEnter:function(e){return a.defer(),a.resolve()},onSceneExit:function(e){return a.defer(),a.resolve()},_showTabByCurrentScene:function(e){var t=this._tabNode[e];if(!i.isUndefined(t)){var a=n.director.getRunningScene(),o=a.seekWidgetByName(t);null!=o&&a.tabDelegateList[0].selectTab(o)}},_showEventCharacter:function(e){var n=t.createInstance("EventCharacterView");if(e){var i=t.createInstance("eventMissionListModel");i.prepare().then(function(){n.show(i)}.bind(this))}else n.hide()},onPageInAnimationEnd:function(e){return a.defer(),a.resolve()},tabCallbackTab0:function(e){t.createInstance("NormalAttentionView").show(),this._showEventCharacter(!1),this._initMissionList(e,"daily")},tabCallbackTab1:function(e){t.createInstance("NormalAttentionView").show(),this._showEventCharacter(!1),this._initMissionList(e,"weekly")},tabCallbackTab2:function(e){t.createInstance("EventAttentionView").show(),this._showEventCharacter(!0),this._initMissionList(e,"event")},btnCallbackBtnPresent:function(e){var n=a.defer();return n.reject(this._override),t.createInstance("router").navigate("present/prs_001",{},{prs_001_002_003:{returnRoute:"mission/mission_001"}}),n.promise},btnChallengeCallback:function(e,i){var a=i.getRoutingPage();if("locked"!==i.getState())if("guild"===a)t.createInstance("unionRouter").navigateToTopScene("me");else if(a.startsWith("mission/mission_001")){var o=a.substring("mission/".length);this._showTabByCurrentScene(o)}else if(a.startsWith("gacha/ga_004"))t.createInstance("router").navigate(a,{ga_100:{}});else if(/(q_accessories_top|q_material_top|q_element_type_top)/.test(a))t.createInstance("QuestListRouter").route(a);else{var r=i.getEventId();if(r){var s={};s[a.replace(/^.*\//g,"")]={event_id:r},t.createInstance("router").navigate(a,s,{event_id:r})}else t.createInstance("router").navigate(a)}else{var c=i.getUnlockCondition();new QuestPortal.UnlockCondition(c).render(n.director.getRunningScene())}},btnGetCallback:function(e,i){var a=n.director.getRunningScene(),o=t.ImplantedPopup.createOrGet(a,"prs_receive"),r=i.getReward().getRawData();o.open("",r).then(function(){a._delegate.receiveReward(i)}.bind(this))},rewardCoreCardCallback:function(e,t){var i=t.getReward(),a=i.getType(),o=i.getRawData(),r=n.director.getRunningScene();this._showItemDetailPopup(r,o,a)},receiveReward:function(e){this.getAMissionsReceiveMissionRewardPromise(e).then(function(i){var a=e.getType(),o=this._missionGroupsSettings[a],r=o.modelName,s=t.createInstance(r);s.updateByData(i.body);var c=n.director.getRunningScene();this._fillupMissionList(c,"",o.tabName,s,a),this._updateNotifyIcon(c,s);var u="event"===a,l=u?"EventAttentionView":"NormalAttentionView";t.createInstance(l).show(),this._showEventCharacter(u);var _=o.viewName;if(_){var p=t.createInstance(_);p.show(s),s.isComplete()&&p.play()}}.bind(this))},getAMissionsReceiveMissionRewardPromise:function(e){var n=t.createInstance("apiAMissions"),i=e.getType(),a=e.getAMissionId();return n.receiveMissionReward(i,a).fail(function(e){console.error(e.stack)})},_popupClose:function(e){var t=e.seekWidgetByName("popup_ui");null!=t&&(t.setVisible(!1),t.animate("default_view",!1))},btnCallbackShWeaponInfoBtnPopupClose:function(e){var t=a.defer();return t.reject(this._override),this._popupClose(e),t.promise},btnCallbackShSummonInfoBtnPopupClose:function(e){var t=a.defer();return t.reject(this._override),this._popupClose(e),t.promise},btnCallbackShItemInfoBtnPopupClose:function(e){var t=a.defer();return t.reject(this._override),this._popupClose(e),t.promise},_touchEndedBackBtnProcess:function(e){t.createInstance("router").navigate("mypage/my_001")}}),i.assign(t.pc.mission.mission_001.SceneDelegate.prototype,t.pc.roles.UIUtility,t.pc.mission.roles.MissionPageListController,t.pc.mission.roles.MissionListTab,t.pc.conquest.roles.Treasure,t.pc.roles.CoreCardCommon)}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="News",o="/news",r={get:function(e){return this._http.get({url:o+"/"+e})},getList:function(e,t){return this._http.get({url:o,json:{page:e,per_page:t}})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiNews",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},r)),n.env.useApiMock){n.MockApi=n.MockApi||{};var s={};t.each(r,function(e,t){s[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi.News."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},s))}if("undefined"!=typeof process&&"undefined"!=typeof require){var c=require("fs"),u=c.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(r,function(e,t){var n="./mock/"+(t+="JSON")+".js";return c.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void c.writeFileSync(n,u.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="AMail",o="/a_mail",r={getList:function(){return this._http.get({url:o})},read:function(e){return this._http.post({url:o+"/"+e+"/already_read"})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiAMail",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},r)),n.env.useApiMock){n.MockApi=n.MockApi||{};var s={};t.each(r,function(e,t){s[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi.AMail."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},s))}if("undefined"!=typeof process&&"undefined"!=typeof require){var c=require("fs"),u=c.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(r,function(e,t){var n="./mock/"+(t+="JSON")+".js";return c.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void c.writeFileSync(n,u.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="AMypage",o="/a_mypage",r={put:function(){return this._http.put({url:o})},getNextAnimation:function(){return this._http.get({url:o+"/next_animation"})},putNextLoginBonus:function(){return this._http.put({url:o+"/next_login_bonus"})},putNextNotice:function(){return this._http.put({url:o+"/next_notice"})},getBackground:function(){return this._http.get({url:o+"/background"})},putExpireInfo:function(e,t){return this._http.put({url:o+"/expire_info",json:{item_id:e,expire_date:t}})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiAMymage",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},r)),n.env.useApiMock){n.MockApi=n.MockApi||{};var s={};t.each(r,function(e,t){s[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi."+a+"."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},s))}if("undefined"!=typeof process&&"undefined"!=typeof require){var c=require("fs"),u=c.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(r,function(e,t){var n="./mock/"+(t+="JSON")+".js";return c.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void c.writeFileSync(n,u.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="APresents",o={getPresentList:function(e,t,n){return this._http.get({url:["/a_presents"].join("/"),json:{type:e,page:t,per_page:n}})},checkAvailablePresents:function(e){return this._http.get({url:["/a_presents_receive"].join("/"),json:{type:e}})},receiveAllPresent:function(e){return this._http.post({url:["/a_presents_receive"].join("/"),json:{type:e}})},receivePresent:function(e){return this._http.post({url:["/a_presents",e,"receive"].join("/")})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiAPresents",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},o)),n.env.useApiMock){n.MockApi=n.MockApi||{};var r={};t.each(o,function(e,t){r[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi.presentMock."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},r))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="ANoticePopups",o="/a_notice_popups",r={getNoticePopups:function(){return this._http.get({url:o})},postMarkNoticePopupAsRead:function(e){return this._http.post({url:o+"/"+e+"/mark_as_read"})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiANoticePopups",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},r)),n.env.useApiMock){n.MockApi=n.MockApi||{};var s={};t.each(r,function(e,t){s[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi."+a+"."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},s))}if("undefined"!=typeof process&&"undefined"!=typeof require){var c=require("fs"),u=c.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(r,function(e,t){var n="./mock/"+(t+="JSON")+".js";return c.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void c.writeFileSync(n,u.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){e.kh=e.kh||{};var t=e.kh;t.SoundChangeBtnDelegate=cc.Class.extend({updateSoundNode:function(){var e=t.createInstance("playerGameConfig");cc.director.getRunningScene().seekWidgetByName("btn_sound").setBright(e.isSoundOn())},changeSound:function(){var e=t.createInstance("playerGameConfig");e.setSoundOn(!e.isSoundOn()),e.updateGameConfig().then(function(){this.updateSoundNode(),e.isSoundOn()&&e.isBgmOn()?(new t.BGM).play():(new t.BGM).stop()}.bind(this)).fail(function(e){console.error(e.stack)})}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.mypage=t.mypage||{},t.mypage.roles=t.mypage.roles||{},t.mypage.roles.MypageFirstEventInfo={_playFirstAnimationIfFound:function(){var t=a.defer(),n=function(){this.__playAnimation().then(function(e){e?t.resolve():n()}.bind(this)).fail(function(t){i.isUndefined(t)||e.console.error(t)})}.bind(this);return n(),t.promise},__playAnimation:function(){return t.createInstance("apiAMypage").getNextAnimation().then(function(e){var t=n.director.getRunningScene();switch(e.body.type){case"none":return a.resolve(!0);case"login_bonus":return this.__playLoginBonusAnimation(t);case"notice":return this.__playNoticeAnimation(t);default:console.error("getNextAnimationType ("+e.body.type+") ")}}.bind(this))},__playLoginBonusAnimation:function(e){return t.createInstance("apiAMypage").putNextLoginBonus().then(function(n){return t.createInstance("LoginBonus",[e,n.body.login_bonus]).play().thenResolve(!1)}.bind(this))},__playNoticeAnimation:function(e){return t.createInstance("apiAMypage").putNextNotice().then(function(n){var a=i.capitalize(i.camelize(n.body.event.animation_type));return t.dictx.has(a)||(a=null,console.error("Not defined: Animation ClassName: "+a)),t.createInstance(a,[e,n.body.event]).play().thenResolve(!1)}.bind(this))},_loadMypageData:function(){return t.createInstance("apiAMypage").put().then(function(e){this.__setMypageData(e.body)}.bind(this))},__setMypageData:function(e){this._mypage=e||{}}}}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.mypage=n.mypage||{},n.mypage.view=n.mypage.view||{},n.mypage.view.BeginnerSupportWindow={display:function(e,n,i){var a=e.bfsWidgetByName("my_mainbtn_ui").bfsWidgetByName("my_beginner_support_window");if(a&&!t.isEmpty(n.beginner_support)){a.setVisible(!1);var o=n.beginner_support.main||{},r=n.beginner_support.raid||{};if((o.enabled||r.enabled)&&(!i.isEnabled()||!i.isInBurstTime())){var s=new cc.Color(170,170,170,255);if(!o.enabled){var c=a.seekWidgetByName("main_free_label");c.setCascadeColorEnabled(!0),c.setColor(s)}if(!r.enabled){var u=a.seekWidgetByName("raid_label");u.setCascadeColorEnabled(!0),u.setColor(s)}a.setStrings({main_free_rank_label:o.rank,raid_rank_label:r.rank}),a.setVisible(!0)}}}}}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{my_001_news_a:{factoryName:"popupFactoryTextOnly",content:"my_001_news_a",title:"POPUP",buttonLabels:{blackBtn:"Black",blueBtn:"Blue"},buttons:{blackBtn:function(){this.dismiss()},blueBtn:function(){this.dismiss().then(function(){t.createInstance("router").navigate("party/par_001_2_3")})}}}});t.pc.mypage=t.pc.mypage||{},t.pc.mypage.my_001=t.pc.mypage.my_001||{},t.pc.mypage.my_001.Scene=t.BaseScene.extend({resourceFileName:"my_001/my_001.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"mypage",sceneName:"my_001",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath("my_mainbtn_ui"),"btn_quest_normal","btnCallbackMyMainbtnUiBtnQuestNormal",null,function(){alert("{{quest_select_ui}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("my_mainbtn_ui"),"btn_quest_raid","btnCallbackMyMainbtnUiBtnQuestRaid",null,function(){alert("{{quest_select_ui}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_raid","btnCallbackBtnRaid",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"quest/q_006")),this._initButtonEvent.call(this,this.seekWidgetByPath("my_mainbtn_ui"),"btn_party","btnCallbackMyMainbtnUiBtnParty",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"party/par_001")),this._initButtonEvent.call(this,this.seekWidgetByPath("my_mainbtn_ui"),"btn_enhance","btnCallbackMyMainbtnUiBtnEnhance",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"book/book_001")),this._initButtonEvent.call(this,this.seekWidgetByPath("my_mainbtn_ui"),"btn_union","btnCallbackMyMainbtnUiBtnUnion",null,function(){alert("{{gud_001gud_000}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("my_mainbtn_ui"),"btn_gacha","btnCallbackMyMainbtnUiBtnGacha",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"gacha")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"my_btn_event","btnCallbackMyBtnEvent",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"event/ev_000")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"my_btn_mi","btnCallbackMyBtnMi",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"beginner_mission/beginner_mission_main")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_mission","btnCallbackBtnMission",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"mission/mission_001")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_present","btnCallbackBtnPresent",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"present/prs_001")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_new","btnCallbackBtnNew",null,function(e){this.popups.my_001_news_a.open(e)}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_chara_change","btnCallbackBtnCharaChange",null,function(){alert("{{chara_img_outchara_img_in}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_harem","btnCallbackBtnHarem",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"epi/epi_001")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_episode","btnCallbackBtnEpisode",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"epi/epi_001")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_next","btnCallbackBtnNext",null,function(){alert("{{}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_prev","btnCallbackBtnPrev",null,function(){alert("{{}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"eventimg_banner","btnCallbackEventimgBanner",null,function(e){this.popups.my_ev_banner.open(e)}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_ap_recover","btnCallbackBtnApRecover",null,function(){alert("{{com_need_ap_bp}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_bp_recover","btnCallbackBtnBpRecover",null,function(){alert("{{com_need_ap_bp}}")}),this._initMouseOver.call(this,this.seekWidgetByPath(""),"btn_quest_normal","my_quest_normal","mouse_over"),this._initMouseOver.call(this,this.seekWidgetByPath(""),"btn_quest_raid","my_quest_raid","mouse_over"),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc=t.pc||{},t.pc.mypage=t.pc.mypage||{},t.pc.mypage.my_001=t.pc.mypage.my_001||{},t.pc.mypage.my_001.SceneDelegate=t.pc.BaseSceneDelegate.extend({MIN_RANK_TO_HIDE_HELP_ASSISTANT_UI:30,_delayNodes:["../my_popup_ui.json"],_noticePopupController:null,_soundPlayer:null,_playingCharacterVoiceResource:null,_partyMembersFileNameList:[],_partyMemberIndex:0,_playingCurrentCharacterVoiceResource:"",_initSelectedPartyPromise:null,_isTutorial:!0,_popups:{my_001_news_b:{factoryName:"popupFactoryBlue",title:"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){this.dismiss().then(function(){this.getUserData().resolve()}.bind(this))}}}},onSceneInit:function(e){return e.seekWidgetByName("Scene").setVisible(!1),t.env.isSp||((new t.SoundChangeBtnDelegate).updateSoundNode(),this._noticePopupController=t.createInstance("NoticePopupController")),this._needApBpPopupFactory=t.createInstance("popupFactoryComNeedApBp"),t.createInstance("beginnerMissionInformationModel").get().then(function(e){this._setPanelMissionButtonVisible(e.hasMission(),e.hasGettableReward())}.bind(this)),t.mypage.view.BeginnerSupportWindow.display(e,this._mypage,this._burstTimeModel),function(){return t.createInstance("tutorialProgress").isFinish()?this._playFirstAnimationIfFound():a.resolve()}.bind(this)().then(function(){return a.all([this._initSelectedParty(e),this._mypageCallApis(e)])}.bind(this)).then(function(){e.seekWidgetByName("Scene").setVisible(!0),this.__playVoice(),(t.env.isSp?a.resolve():this._showNoticePopups()).then(this.__showSupportPopup.bind(this,e)).then(this._showLimitedItemPopups.bind(this))}.bind(this)).fail(function(e){i.isString(e)?console.debug(e):console.error(e)}),a.resolve()},_initSelectedParty:function(e){return this._initSelectedPartyPromise.spread(function(n,i){var a=t.createInstance("AFavoriteMemberModel",[i.body]);this._apiAPartiesGetSelectedDeckCallback(e,n.body,a)}.bind(this)).fail(function(e){console.error(e)})},_mypageCallApis:function(e){e._onCallApisFinished=this._onCallApisFinished.bind(this);var t=[{api:"apiAPresents",method:"getPresentList",args:["normal",1,1],callback:this._apiAPresentGetCallback.bind(this)},{api:"apiAPresents",method:"getPresentList",args:["timelimit",1,1],callback:this._apiAPresentGetCallback.bind(this)},{api:"apiAQuestInfo",method:"getRaidAndHarem",callback:this._apiAQuestInfoGetCallback.bind(e)},{api:"apiAMypage",method:"getBackground",callback:this._apiAMypageBackgroundGetCallback.bind(e)},{api:"apiABanners",method:"getMypageBanners",callback:this._apiABannersGetMypageBannersCallback.bind(e)},{api:"apiAMail",method:"getList",callback:this._apiAMailGetListCallback.bind(e)},{api:"apiAMissions",method:"getSummary",callback:this._apiAMissionGetSummaryCallback.bind(this)}];e._callApis(t)},onSceneEnter:function(e){return t.tutorial.startTutorialIfNeed(e).fail(function(){this._isTutorial=!1}.bind(this)).then(function(){var e=t.createInstance("apiAParties"),n=t.createInstance("apiAFavoriteMember");return this._initSelectedPartyPromise=a.all([e.getSelectedDeck(),n.get()]),this._burstTimeModel=t.createInstance("burstTime"),a.all([this._loadMypageData(),this._initSelectedPartyPromise,this._burstTimeModel.prepare()])}.bind(this))},onSceneExit:function(e){return a.defer(),this._stopVoiceIfPlaying(),this._needApBpPopupFactory&&(this._needApBpPopupFactory.cleanup(),this._needApBpPopupFactory=null),a.resolve()},onPageInAnimationEnd:function(e){return a.defer(),this._initSelectedPartyPromise.then(function(){var n=this;t.setTouchEventHandlers(e,{"TOUCH_ENDED chara_img":"__playCharaAnime","TOUCH_ENDED btn_ap_recover":function(){n._openApBp(!0)},"TOUCH_ENDED btn_bp_recover":function(){n._openApBp(!1)}},this)}.bind(this)),a.resolve()},_openApBp:function(e){var n=t.createInstance("apiAItems"),i=[n.getBpGain(),this.updateQuestPoints()];return e&&(i=[n.getApGain(),this.updateQuestPoints()]),a.all(i).spread(function(n,i){var a=t.createInstance("router").getCurrentComponent();this._needApBpPopupFactory.create({property:e?"AP":"BP",questTitle:"",questPoints:i,items:n.body,component:a,onUse:this._onUseItem.bind(this),needBattleBp:0}).open()}.bind(this)).fail(function(e){console.error(e.stack)}),!0},_onUseItem:function(e){},_onCallApisFinished:function(){var e=n.director.getRunningScene();this.__updateNewIconAndCountLabel(e,"btn_present",this._presentCount),t.createInstance("BurstTimeCountDownPanel").show(this._burstTimeModel)},_showLimitedItemPopups:function(){return t.createInstance("TimeLimitItemController",[this._mypage.item_expire_info]).showMyTimeLimitTicketCautionPopups()},_apiAPresentGetCallback:function(e){this.__addPresentCount(e)},__addPresentCount:function(e){this._presentCount=this._presentCount||0,this._presentCount+=e.max_record_count},_apiAPartiesGetSelectedDeckCallback:function(e,t,n){var a=[];if(n.existFavoriteMember()){var o=this.__getAFavoriteMemberFile(n);a.push(o)}var r=this.__getPartyMemberFile(e,t);if(a=a.concat(r),a=i.uniq(a,!1,function(e){return e.img}),n.existFavoriteMember())var s=0;else s=i.random(0,a.length-1);this._partyMembersFileNameList=a,this.__displayPartyMemberImg(e,s)},__getAFavoriteMemberFile:function(e){var t=e.getMemberId();if(e.isJob())return{img:this.__getJobImg(t,0),voice:this.__getJobVoiceParam(t)};if(e.isCharacter())return{img:this.__getCharacterImg(t,0),voice:this.__getCharacterVoiceParam(t)};var n=e.getType();console.error(" type:"+n+", ID:"+t)},__getPartyMemberFile:function(e,t){var n=[],i=this.__getJobFileByDeck(t),a=this.__getCharacterFilesByDeck(t);return n.push(i),n.concat(a)},__getJobFileByDeck:function(e){return{img:this.__getJobImgByDeck(e),voice:this.__getJobVoiceParamByDeck(e)}},__getCharacterFilesByDeck:function(e){return i.chain(e.deck.characters).reject(function(e){return!e.character_id}).map(function(e){return this.__getCharacterFileByDeck(e)}.bind(this)).value()},__getCharacterFileByDeck:function(e){return{img:this.__getCharacterImgByCharacter(e),voice:this.__getCharacterVoiceParamByCharacter(e)}},__getCharacterImgByCharacter:function(e){var t=this._getAppearanceCharacterId(e),n=e.skin||0;return this.__getCharacterImg(t,n)},__getCharacterVoiceParamByCharacter:function(e){var t=this._getAppearanceCharacterId(e);return this.__getCharacterVoiceParam(t)},_getAppearanceCharacterId:function(e){return e.appearance.used_character_id},__getJobImgByDeck:function(e){var t=e.deck.job.job_id,n=e.deck.job.skin||0;return this.__getJobImg(t,n)},__getJobImg:function(e,n){return t.Img("illust-com-kneeshot","job",i.padZero(e,4),n).png},__getCharacterImg:function(e,n){return t.Img("illust-com-kneeshot","chara",i.padZero(e,4),n).png},__displayPartyMemberImg:function(e,t){t>=this._partyMembersFileNameList.length&&(t=0),this._partyMemberIndex=t,e.seekWidgetByName("chara_img").loadTexture(this.__getMemberImgFileName(t)),e.seekWidgetByName("my_chara_page_ui").animate("chara_img_in",!1)},__getMemberImgFileName:function(e){return this._partyMembersFileNameList[e].img},__getJobVoiceParamByDeck:function(e){return this.__getJobVoiceParam(e.deck.job.job_id)},__getJobVoiceParam:function(e){var t=[1,2,3];return this._mypage.voice_info&&i.isArray(this._mypage.voice_info.hero)&&(t=this._mypage.voice_info.hero),{type:"jobSound",id:e,skin:t}},__getCharacterVoiceParam:function(e){var t=[1,2,3];return this._mypage.voice_info&&i.isArray(this._mypage.voice_info.character)&&(t=this._mypage.voice_info.character),{type:"charaSound",id:e,skin:t}},__playCharaAnime:function(){this.__playVoice(),n.director.getRunningScene().seekWidgetByName("my_chara_page_ui").animate("chara_img_tap",!1)},__playVoice:function(){this._isTutorial||(this._stopVoiceIfPlaying(),this._playingCurrentCharacterVoiceResource=this._getCurrentCharacterVoicePath(),this._getSoundPlayer().playVoice(this._playingCurrentCharacterVoiceResource))},_getCurrentCharacterVoicePath:function(){var e=this._partyMemberIndex,n=this.__getMemberVoiceParam(e),a=i.shuffle(n.skin)[0];return t.generateResourcePath(n.type,n.id,a).mp3},__getMemberVoiceParam:function(e){return this._partyMembersFileNameList[e].voice},_getSoundPlayer:function(){return null===this._soundPlayer&&(this._soundPlayer=t.createInstance("soundPlayer").init(t.createInstance("playerGameConfig"))),this._soundPlayer},_stopVoiceIfPlaying:function(){null!==this._playingCurrentCharacterVoiceResource&&this._getSoundPlayer().stopVoice(this._playingCurrentCharacterVoiceResource)},_apiAQuestInfoGetCallback:function(e){this._delegate.__setQuestInfoData(e),this._delegate.__showRaidBattleButton(this),this._delegate.__updateHaremUI(this)},__setQuestInfoData:function(e){this._questInfo=e||{}},_apiAMypageBackgroundGetCallback:function(e){this._delegate.__updateBackgroundImage(this,e)},__updateBackgroundImage:function(e,n){var a,o=e.seekWidgetByName("mypagebg_area");return i.isUndefined(n.special)?(a=n.default.img_id,void o.loadTexture(t.Img("mypagebg","area",i.padZero(a,4),0).jpg)):(a=n.special.img_id,void o.loadTexture(t.Img("mypage","bg",i.padZero(a,4)).jpg))},_apiAMissionGetSummaryCallback:function(e){var t=e.has_reward;this.__setMissionExclamationIconVisible(t)},__setMissionExclamationIconVisible:function(e){var t=n.director.getRunningScene().seekWidgetByName("my_mission_ui");if(null!==t){var i=e?"exclamation":"no_exclamation";t.setAppearance(i)}},_apiAPlayersGetMeCallback:function(e){e.rank<this.MIN_RANK_TO_HIDE_HELP_ASSISTANT_UI&&this.__setHelpAssistantVisible(!0)},__setHelpAssistantVisible:function(e){var t=n.director.getRunningScene().seekWidgetByName("my_help_assist_ui");null!==t&&(t.setVisible(e),t.animate("default_view",e))},__showRaidBattleButton:function(e){if(!this._questInfo.has_new_raid_request)return e.seekWidgetByName("my_quest_normal").setVisible(!0),e.seekWidgetByName("my_quest_raid").setVisible(!1),e.seekWidgetByName("raid_btn_ui").setVisible(!1),void this._revaluateWorldPosition(e.seekWidgetByName("btn_quest_normal"));e.seekWidgetByName("my_quest_normal").setVisible(!1);var t=e.seekWidgetByName("my_quest_raid");t.setVisible(!0);var n=t.seekWidgetByName("btn_quest_raid");this._revaluateWorldPosition(n),n.loadTextureNormal(n._normalFileName,ccui.Widget.PLIST_TEXTURE),e.seekWidgetByName("raid_btn_ui").setVisible(!0);var i=e.seekWidgetByName("btn_raid");i.ignoreShrinkEffect=!1,i.loadTextureNormal(i._normalFileName,ccui.Widget.PLIST_TEXTURE),i.loadTexturePressed(i._clickedFileName,ccui.Widget.PLIST_TEXTURE),e.seekWidgetByName("raid_btn_ui").setAppearance("mypage")},_revaluateWorldPosition:function(e){t.env.isSp||(e.opacity=0,e.setVisible(!0),e.scheduleOnce(function(){e.setVisible(!1),e.opacity=255},.05))},__updateHaremUI:function(e){var t=e.seekWidgetByName("my_harem_ui");t.animate(this._getAnimationNameForHaremBtn(),!0),this._questInfo&&!this._questInfo.has_new_harem||(t.seekWidgetByName("new_icon").setVisible(!0),t.animate(this._getAnimationNameForNewEpisode(),!0))},_getAnimationNameForHaremBtn:function(){return"default_view"},_getAnimationNameForNewEpisode:function(){return"new_episode"},_apiABannersGetMypageBannersCallback:function(e){this._delegate.__setBanners(e),this._delegate.__updateBanners(this)},__setBanners:function(e){this._banners=e||{}},__updateBanners:function(e){var n=e.seekWidgetByName("my_event-info_ui");if(this._banners.max_record_count){n.setVisible(!0);var a=n.seekWidgetByName("event-info_panel"),o=a.seekWidgetByName("my_event-info_page_ui").getScale();a.removeAllChildren();var r=[];i.each(this._banners.data,function(e,n){var i=this.__createBannerNode(e,n);i.setScale(o),t.env.isSp?i.setAnchorPoint(-.2,-.15):i.setAnchorPoint(-.2,-.25),r.push(i)},this);var s=new t.PageView;s.initialize(r),s.setDirection(ccui.ScrollView.DIR_HORIZONTAL),s.setLoopContent(!0),a.addChild(s);var c=[];c[t.PAGE_CONTROLLER_CONTROLS.NEXT_BUTTON]="btn_next",c[t.PAGE_CONTROLLER_CONTROLS.PREVIOUS_BUTTON]="btn_prev",(new t.PageController).init(n,c,s),n.seekWidgetByName("btn_next").setTouchEnabled(!0),n.seekWidgetByName("btn_prev").setTouchEnabled(!0)}else n.setVisible(!1)},__createBannerNode:function(e,n){var a=ccs.load(res["mypage-my_001-my_event-info_page_ui"]).node,o=a.seekWidgetByName("eventimg_banner"),r=t.Img("eventimg","banner",i.padZero(e.banner_id,4)).png;o.loadTextures(r,r,r);var s=function(){t.createInstance("popupFactoryEvBanner").create({}).open({}).then(function(){})};return o.addTouchEventListener(function(e,t){t===ccui.Widget.TOUCH_ENDED&&s()},this),a},_apiAMailGetListCallback:function(e){this._delegate.__setMailData(e),this._delegate.__updateNewIconAndCountLabel(this,"btn_new",this._delegate._mail.length)},__setMailData:function(e){this._mail=e.data},__updateNewIconAndCountLabel:function(e,t,n){var a=khutil.getWidgetFromNode(e,t,function(e){console.warn("SceneDelegate: "+e)}.bind(this));if(null!==a){var o=khutil.getWidgetFromNode(a,"new_icon",function(e){console.warn("SceneDelegate: "+e)}.bind(this)),r=khutil.getWidgetFromNode(a,"new_num_label",function(e){console.warn("SceneDelegate: "+e)}.bind(this));if(!i.isNumber(n)||n<=0)return o.setVisible(!1),void r.setVisible(!1);o.setVisible(!0),r.setVisible(!0),r.setString(n>999?999:n)}},_showNoticePopups:function(){return this._noticePopupController.showNoticePopups()},__showSupportPopup:function(e){if(!this._mypage||!this._mypage.support_info||0===this._mypage.support_info.friend_num&&0===this._mypage.support_info.other_num)return a.resolve();var t=this._mypage.support_info,n="";0<t.friend_num&&0<t.other_num?(n+="<p>"+t.friend_num+"<br />",n+=t.other_num+"<br /></p>"):0<t.friend_num?n+="<p>"+t.friend_num+"<br /></p>":0<t.other_num&&(n+="<p>"+t.other_num+"<br /></p>"),n+="<p>"+t.gained_gem+"</p>";var i=a.defer(),o=e.popups.my_001_news_b;return o.setUserData(i),o.open().then(function(){o.setContent(n)}.bind(this)).fail(function(e){console.error(e.stack)}),i.promise},btnCallbackMyMainbtnUiBtnParty:function(e){var t=a.defer();return t.resolve(),t.promise},btnCallbackMyMainbtnUiBtnEnhance:function(e){var n=a.defer();return n.reject(this._override),t.createInstance("router").navigate("book"),n.promise},btnCallbackMyMainbtnUiBtnQuestNormal:function(e){return t.createInstance("router").navigate("quest/q_portal_top"),a.reject(this._override)},btnCallbackMyMainbtnUiBtnQuestRaid:function(e){return t.createInstance("router").navigate("quest/q_portal_top"),a.reject(this._override)},btnCallbackBtnRaid:function(e){var t=a.defer();return t.resolve(),t.promise},btnCallbackMyMainbtnUiBtnUnion:function(e){var n=a.defer();return t.createInstance("unionRouter").navigateToTopScene("me"),n.reject(this._override),n.promise},btnCallbackMyMainbtnUiBtnGacha:function(e){var t=a.defer();return t.resolve(),t.promise},btnCallbackBtnPresent:function(e){var t=a.defer();return t.resolve(),t.promise},btnCallbackBtnNew:function(e){var n=a.defer();return t.createInstance("popupFactoryNewsA").create({}).open({mail:this._mail}).then(function(){}),n.reject(this._override),n.promise},btnCallbackBtnCharaChange:function(e){var t=a.defer();return this._stopVoiceIfPlaying(),null!=this._characterImageChangeAnimationProgress&&this._characterImageChangeAnimationProgress.isPending()?(this._characterImageChangeAnimationProgress=this._characterImageChangeAnimationProgress.then(this._playCharacterChangeAnimation.bind(this,e)),this._skipCurrentCharacterChangeAnimationPhase(e)):this._characterImageChangeAnimationProgress=this._playCharacterChangeAnimation(e),t.reject(this._override),t.promise},_playCharacterChangeAnimation:function(e){var t=e.seekWidgetByName("chara_img");t.setEnabled(!1);var i=e.seekWidgetByName("my_chara_page_ui"),o=this._partyMemberIndex+1;o==this._partyMembersFileNameList.length&&(o=0);var r=a.defer(),s=this.__getMemberImgFileName(o);return n.loader.loadImg(s,function(e,t){r.resolve(t)}),a.all([i.animate("chara_img_out",!1),r.promise]).then(function(){return this.__displayPartyMemberImg(e,o),this._charaImgInToSkipCount?(this._charaImgInToSkipCount--,i.changeFrameWithAnimInfo("chara_img_in","end",!0),a.resolve()):i.animate("chara_img_in",!1)}.bind(this)).fail(function(e){console.error(e.stack)}).done(function(){t.setEnabled(!0)})},_skipCurrentCharacterChangeAnimationPhase:function(e){var t=e.seekWidgetByName("my_chara_page_ui");"chara_img_out"===t.getCurrentlyPlayingAnimation()&&(this._charaImgInToSkipCount=this._charaImgInToSkipCount||0,this._charaImgInToSkipCount++),t.skipCurrentlyPlayingAnimation()},btnCallbackBtnSetting:function(e){var t=a.defer();return t.resolve(),t.promise},btnCallbackBtnHarem:function(e){var t=a.defer();return t.resolve(),t.promise},btnCallbackBtnEpisode:function(e){var t=a.defer();return t.resolve(),t.promise},btnCallbackBtnNext:function(e){var t=a.defer();return t.reject(this._override),t.promise},btnCallbackBtnPrev:function(e){var t=a.defer();return t.reject(this._override),t.promise},btnCallbackEventimgBanner:function(e){var t=a.defer();return t.reject(this._override),t.promise},_setPanelMissionButtonVisible:function(e,t){var i=n.director.getRunningScene().seekWidgetByName("my_btn_mi");null!=i?(i.setVisible(e),i.getParent().getChildByName("beginner_mission_new_icon").setVisible(e&&t)):console.warn("MyPage/sceneDelegate._setPannelMissionButtonVisible: widget 'my_btn_mi' not found!")},updateQuestPoints:function(){return n.director.getRunningScene().headerDelegate.updateQuestPoints().then(function(e){return this.questPoint=e,e}.bind(this))}}),i.assign(t.pc.mypage.my_001.SceneDelegate.prototype,t.mypage.roles.MypageFirstEventInfo)}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e._,e.Q,t.pc.mypage=t.pc.mypage||{},t.pc.mypage.controller=t.pc.mypage.controller||{},t.pc.mypage.controller.NoticePopupController=n.Class.extend({_noticePopupView:null,ctor:function(){var e=n.director.getRunningScene();this._noticePopupView=t.ImplantedPopup.createOrGet(e,"my_visual","NoticePopupView")},showNoticePopups:function(){return this._getNoticePopupRecords().then(function(e){if(0!==e.body.data.length){var t=this._createNoticePopupModels(e.body.data);return t.forEach(function(e){n.loader.loadImg(e.getNoticeImageUrl())}),khutil.runSequence(t,function(e,t){return this._showNoticePopup(e)}.bind(this))}}.bind(this)).fail(function(e){console.error(e)})},_getNoticePopupRecords:function(){return t.createInstance("apiANoticePopups").getNoticePopups()},_createNoticePopupModels:function(e){for(var t=[],n=0;n<e.length;++n)t.push(this._createNoticePopupModel(e[n]));return t},_createNoticePopupModel:function(e){return t.createInstance("NoticePopupModel",[e])},_getNoticePopupView:function(){return this._noticePopupView},_showNoticePopup:function(e){return this._getNoticePopupView().open(e).then(function(){if(this._getNoticePopupView().isCheckboxEnabled())return n.loader.release(e.getNoticeImageUrl()),this._markNoticePopupAsRead(e)}.bind(this))},_markNoticePopupAsRead:function(e){return t.createInstance("apiANoticePopups").postMarkNoticePopupAsRead(e.getNoticePopupId())}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.console;t.mypage=t.mypage||{},t.mypage.controller=t.mypage.controller||{},t.mypage.controller.TimeLimitItem=n.Class.extend({ctor:function(e){this._itemExpireInfoModel=this._createItemExpireInfoModel(e),this._myTimeLimitTicketCautionPopup=this._initMyTimeLimitTicketCautionPopup()},showMyTimeLimitTicketCautionPopups:function(){var e=this._itemExpireInfoModel.getTimeLimitItemModels();return i.map(e,function(e){return this._showMyTimeLimitTicketCautionPopup.bind(this,e)},this).reduce(Q.when,Q())},_showMyTimeLimitTicketCautionPopup:function(e){return this._myTimeLimitTicketCautionPopup.open(e)},_initMyTimeLimitTicketCautionPopup:function(){var e=t.createInstance("MyTimeLimitTicketCautionPopup");return e.setOnOkCallback(this._onTouchOk,this),e.setOnUseCallback(this._onTouchUseItem,this),e.setOnCancelCallback(this._onTouchCancel,this),e},_createItemExpireInfoModel:function(e){return t.createInstance("ItemExpireInfoModel",[e])},_reportItemRecordAsViewed:function(e){return t.createInstance("apiAMypage").putExpireInfo(e.getItemId(),e.getExpireDate()).fail(function(e){a.error(e&&e.stack?e.stack:e)})},_navigateToGachaTop:function(){return t.createInstance("router").navigate("gacha/ga_001"),Q.resolve()},_onTouchOk:function(e){return this._reportItemRecordAsViewed(e)},_onTouchUseItem:function(e){return this._reportItemRecordAsViewed(e).then(this._navigateToGachaTop.bind(this))},_onTouchCancel:function(e){return this._reportItemRecordAsViewed(e)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.mypage=t.mypage||{},t.mypage.model=t.mypage.model||{},t.mypage.model.ItemExpireInfo=n.Class.extend({ctor:function(e){this._timeLimitItemModels=this._createTimeLimitItemModels(e)},getTimeLimitItemModels:function(){return this._timeLimitItemModels},_createTimeLimitItemModels:function(e){return _.map(e||[],this._createTimeLimitItemModel,this)},_createTimeLimitItemModel:function(e){return t.createInstance("TimeLimitItemModel",[e])}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.mypage=t.mypage||{},t.mypage.model=t.mypage.model||{},t.mypage.model.TimeLimitItem=n.Class.extend({ctor:function(e){this._timeLimitItemRecord=e},getItemId:function(){return this._timeLimitItemRecord.item_id},getName:function(){return this._timeLimitItemRecord.name},getDescription:function(){return this._timeLimitItemRecord.description},getExpireDate:function(){return this._timeLimitItemRecord.expire_date},getNum:function(){return this._timeLimitItemRecord.num},getCategory:function(){return this._timeLimitItemRecord.category}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.pc=t.pc||{},t.pc.mypage=t.pc.mypage||{},t.pc.mypage.model=t.pc.mypage.model||{},t.pc.mypage.model.NoticePopup=n.Class.extend({_noticePopupRecord:{},ctor:function(e){this._noticePopupRecord=e},_getProperty:function(e,t){return _.isUndefined(this._noticePopupRecord[e])||_.isNull(this._noticePopupRecord[e])?(console.debug("[!! NoticePopup !!] property not found: ",e),_.isUndefined(t)?"":t):this._noticePopupRecord[e]},getNoticePopupId:function(){return this._getProperty("notice_popup_id",0)},getNoticeImageUrl:function(){return t.Img("eventimg","event-slider",_.padZero(this.getNoticePopupId(),4)).jpg}})}((this||0).self||global),function(e){var t=e._,n=e.kh,i=e.console;n.mypage=n.mypage||{},n.mypage.view=n.mypage.view||{},n.mypage.view.MyTimeLimitTicketCautionPopup=n.ImplantedPopup.extend({POPUP_NAME:"my_time_limit_ticket_caution",BUTTON_VISIBLE_GACHATICKET:{btn_popup_close:!0,btn_use:!0,btn_ok:!1},BUTTON_VISIBLE_OTHER:{btn_popup_close:!1,btn_use:!1,btn_ok:!0},BUTTON_NAMES:{CLOSE:"btn_popup_close",USE:"btn_use",OK:"btn_ok"},WIDGET_NAMES:{CORECARD:"corecard_item_ui",NAME:"item_name_label",DESCRIPTION:"item_description_label",AMOUNT:"have_label",EXPIRATION_DATE:"limit_date_label"},ctor:function(){this._super(this.POPUP_NAME),this._waitForInit().then(function(){this._initButtons(),this._corecard=this._initCorecard()}.bind(this))},setOnCancelCallback:function(e,t){this._onCancelCallback=e.bind(t)},setOnUseCallback:function(e,t){this._onUseCallback=e.bind(t)},setOnOkCallback:function(e,t){this._onOkCallback=e.bind(t)},_initButtons:function(){var e={};e[this.BUTTON_NAMES.CLOSE]=this._onBtnPopupClose.bind(this),e[this.BUTTON_NAMES.USE]=this._onBtnUse.bind(this),e[this.BUTTON_NAMES.OK]=this._onBtnOk.bind(this),this.setButtonEvents(e)},_initCorecard:function(){var e=this._getCorecardNode();return n.createInstance("CoreCardItemUI",["plain",e])},_initContents:function(e){this._itemExpireInfoModel=e,this._setCorecardImage(e.getItemId()),this._setItemName(e.getName()),this._setItemDescription(e.getDescription()),this._setExpirationDate(e.getExpireDate()),this._setAmount(e.getNum()),"gacha_ticket"==e.getCategory()?this._setButtonVisible(!0):this._setButtonVisible(!1)},_clearContents:function(){this._itemExpireInfoModel=null,this._corecard.clearImg(),this._setItemName(""),this._setItemDescription(""),this._setExpirationDate(""),this._setAmount("")},_onBtnPopupClose:function(){this._onButtonClick(this._onCancelCallback,!0)},_onBtnUse:function(){this._onButtonClick(this._onUseCallback,!1)},_onBtnOk:function(){this._onButtonClick(this._onOkCallback,!0)},_onButtonClick:function(e,n){var i;return t.isFunction(e)&&(i=e(this._itemExpireInfoModel,this)),i&&i.then?void i.then(function(){this._clearContents(),this.dismiss(n)}.bind(this)):(this._clearContents(),void this.dismiss(n))},_setCorecardImage:function(e){return null==this._corecard?void i.warn("KHMyTimeLimitTicketCautionPopup._setCorecardImage: corecard not properly initialized."):void this._corecard.setImg(e)},_setItemName:function(e){var t=this._getNameNode();this._setNodeString(t,e)},_setItemDescription:function(e){var t=this._getDescriptionNode();this._setNodeString(t,e)},_setExpirationDate:function(e){var t=this._getExpirationDateNode();this._setNodeString(t,e)},_setAmount:function(e){var t=this._getAmountNode();this._setNodeString(t,e.toString())},_setNodeString:function(e,t){return null==e?void i.warn("KHMyTimeLimitTicketCautionPopup._setNodeString: attempting to set the string value of a non existent node to '"+t+"'."):void e.setString(t)},_setButtonVisible:function(e){var n=e?this.BUTTON_VISIBLE_GACHATICKET:this.BUTTON_VISIBLE_OTHER;t.each(n,function(e,t){var n=this._getNodeByName(t);null!==n&&n.setVisible(e)},this)},_getCorecard:function(){return this._corecard},_getCorecardNode:function(){return this._getNodeByName(this.WIDGET_NAMES.CORECARD)},_getNameNode:function(){return this._getNodeByName(this.WIDGET_NAMES.NAME)},_getDescriptionNode:function(){return this._getNodeByName(this.WIDGET_NAMES.DESCRIPTION)},_getAmountNode:function(){return this._getNodeByName(this.WIDGET_NAMES.AMOUNT)},_getExpirationDateNode:function(){return this._getNodeByName(this.WIDGET_NAMES.EXPIRATION_DATE)},_getNodeByName:function(e){var t=this.getNode().seekWidgetByName(e);return null==t&&i.warn("KHMyTimeLimitTicketCautionPopup._getNode: node '"+e+"' not found."),t}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.mypage=t.mypage||{},t.mypage.view=t.mypage.view||{},t.mypage.view.NoticePopupView=t.ImplantedPopup.extend({APPEARANCE_NAMES:{MARK_CHECK:"check",NO_MARK_CHECK:"no_check"},WIDGET_NAMES:{CHECK_ICON:"check_icon",CHECKBOX_PANEL:"check_box_panel",EVENT_SLIDER_IMAGE:"eventimg_event-slider",CLOSE_BUTTON:"btn_close",CLOSE_BUTTON_IMAGE:"close_img"},_checkboxEnabled:!1,isCheckboxEnabled:function(){return this._checkboxEnabled},_initContents:function(e){this._clearContents(),this._enableTouchScreenEvent(),this._setNoticeImage(e.getNoticeImageUrl()),this._setCheckboxAppearanceEnabled(),this._getCheckboxPanel().addTouchEventListener(this._onTouchCheckbox.bind(this)),this._getCloseButton().addTouchEventListener(this._onTouchScreen.bind(this))},_setNoticeImage:function(e){this._getNoticeImage().loadTexture(e)},_enableTouchScreenEvent:function(){this._getCloseButton().setTouchEnabled(!0)},_onTouchScreen:function(e,n){var i=this._getCloseButtonImage();n===ccui.Widget.TOUCH_BEGAN?i.setScale(t.GameConfig.BUTTON_SCALE.MIN_SCALE):n===ccui.Widget.TOUCH_ENDED&&(i.setScale(t.GameConfig.BUTTON_SCALE.MAX_SCALE),this.dismiss(!0))},_onTouchCheckbox:function(e,t){t===ccui.Widget.TOUCH_ENDED&&this._toggleCheckboxEnabled()},_getNoticeImage:function(){var e=this.getNode().seekWidgetByName(this.WIDGET_NAMES.EVENT_SLIDER_IMAGE);return null==e&&console.error(""),e},_getCheckbox:function(){var e=this.getNode().seekWidgetByName(this.WIDGET_NAMES.CHECK_ICON);return null==e&&console.error(""),e},_getCheckboxPanel:function(){var e=this.getNode().seekWidgetByName(this.WIDGET_NAMES.CHECKBOX_PANEL);return null==e&&console.error(""),e},_getCloseButton:function(){var e=this.getNode().seekWidgetByName(this.WIDGET_NAMES.CLOSE_BUTTON);return null==e&&console.error(""),e},_getCloseButtonImage:function(){var e=this.getNode().seekWidgetByName(this.WIDGET_NAMES.CLOSE_BUTTON_IMAGE);return null==e&&console.error(""),e},_setNodeAppearance:function(e,t){e.setAppearance(t)},_toggleCheckboxEnabled:function(){this._checkboxEnabled=!this._checkboxEnabled,this._checkboxEnabled?this._setCheckboxAppearanceEnabled():this._setCheckboxAppearanceDisabled()},_setCheckboxAppearanceEnabled:function(){this._checkboxEnabled=!0,this._setNodeAppearance(this.getNode(),this.APPEARANCE_NAMES.MARK_CHECK)},_setCheckboxAppearanceDisabled:function(){this._checkboxEnabled=!1,this._setNodeAppearance(this.getNode(),this.APPEARANCE_NAMES.NO_MARK_CHECK)},_clearContents:function(){this._setCheckboxAppearanceDisabled(),this._getNoticeImage().loadTexture("")},_disableTouchScreenEvent:function(){this._getCloseButton().setTouchEnabled(!1)}})}((this||0).self||global),function(e){e.kh=e.kh||{};var t=e.kh;t.BaseMypageAnimation=t.BaseMypageAnimation||{},t.BaseMypageAnimation=cc.Class.extend({className:"KHBaseMypageAnimation",animationDfd:null,play:function(){return this.animationDfd=Q.defer(),this.animationDfd.promise}})}((this||0).self||global),function(e){e.kh=e.kh||{};var t=e.kh,n=e.res;e._,$staticRes(n["mypage-loginbonus-item_stamp"]),$staticRes(n["mypage-loginbonus-loginbonus_item_second"]),t.LoginBonus=cc.Class.extend({ctor:function(e,n){var i=new t.LoginBonusData(n),a=new t.LoginBonusResource(i.getRewardLayoutId(),i.getCharacterAnimationId());this._delegate=new t.LoginBonusAnimation(a,e,i)},play:function(){return this._delegate.play()}})}((this||0).self||global),function(e){var t=e.kh,n=e._;t.LoginBonusData=cc.Class.extend({className:"LoginBonusData",ctor:function(e){this._loginbonusData=e,this._id=e.id,this._animationData=e.animation_data,this._todayData=e.animation_data.today_bonus_info,this._nextData=e.animation_data.next_bonus_info,this._daily_reward_items=e.animation_data.daily_reward_items},isLastDay:function(){return!n.isUndefined(this._animationData.is_last_day)&&this._animationData.is_last_day},getCharacterFirstMessage:function(){return this.isLastDay()?this._animationData.character_last_day_first_message:this._animationData.character_first_message},getCharacterSecondMessage:function(){return this.isLastDay()?this._animationData.character_last_day_second_message:this._animationData.character_second_message},hasNextItem:function(){return!n.isEmpty(this._nextData)},getLoginBonusId:function(){return this._id},getTodayNo:function(){return this._todayData.day},getNextDayNo:function(){return n.isEmpty(this._nextData)?-1:this._nextData.day},getTodayItemName:function(){return this._todayData.name},getNextItemName:function(){return this._nextData.name},getItemAnimationNameByDay:function(e){if(e+1===this.getTodayNo())return"bonus_normal";var t=this._daily_reward_items[e];return n.isUndefined(t)?"bonus_normal":t.acquired?"bonus_get":"bonus_normal"},getRewardLayoutId:function(){return this._animationData.reward_layout_id},getCharacterAnimationId:function(){return this._animationData.character_animation_id},getBackgroundId:function(){return this._animationData.background_id},getRewardItemCount:function(){return this._daily_reward_items.length},getRewardItemId:function(e){return this._daily_reward_items[e].id},getRewardItemType:function(e){return this.getItemTypeBy(this._daily_reward_items[e].type)},getRewardItemAmount:function(e){return this._daily_reward_items[e].amount},getTodayItemId:function(){return this._todayData.id},getTodayItemType:function(){return this.getItemTypeBy(this._todayData.type)},getTodayItemAmount:function(){return this._todayData.amount},getNextItemId:function(){return this._nextData.id},getNextItemType:function(){return this.getItemTypeBy(this._nextData.type)},getNextItemAmount:function(){return this._nextData.amount},getItemTypeBy:function(e){return"accessory"===e?"acce":"character"===e?"chara":e}})}((this||0).self||global),function(e){var t=e.kh,n=e._;t.LoginBonusResource=cc.Class.extend({className:"LoginBonusResource",ctor:function(e,t,n){this._resourceNames=this._getResourceNames(e),this._resourceRelationshipInfo=this._getRelationshipNodeResourceInfo(t),this._backgroundId=n},fetch:function(){return t.loader.load(this._getAllResourceNames()).then(function(e){var i=e[0];return this._animation=t.createInstance("WindowVisualEffect").init(i),(n.isUndefined(this._animation)||n.isNull(this._animation))&&console.error("animation is not found"),this._resolveRelationshipNode()}.bind(this))},_getResourceNames:function(e){return n.map(["../mypage/res/loginbonus/loginbonus_layout/loginbonus_layout_[% rewardLayoutId %].json","../mypage/res/loginbonus/loginbonus_item_stamp_ui.json","../mypage/res/loginbonus/loginbonus_item_ui.json","../mypage/res/loginbonus/loginbonus_login_text_ui.json","../mypage/res/loginbonus/loginbonus_item_second_ui.json","../mypage/res/loginbonus/loginbonus_get_no_font.fnt","../mypage/res/loginbonus/loginbonus_get_no_font.png"],function(t){return t.replace(/\[% rewardLayoutId %\]/g,e)})},_getRelationshipNodeResourceInfo:function(e){return n.map([{parentNodeName:"loginbonus_chara_ui",path:"../mypage/res/loginbonus/loginbonus_chara/loginbonus_chara_[% characterAnimationId %]/loginbonus_chara_[% characterAnimationId %]_ui.json"}],function(t){return t.path=t.path.replace(/\[% characterAnimationId %\]/g,e),t})},_getAllResourceNames:function(){var e=n.map(this._resourceRelationshipInfo,function(e){return e.path});return this._resourceNames.concat(e)},_resolveRelationshipNode:function(){var e=n.map(this._resourceRelationshipInfo,function(e){return e.path}),i=this.getAnimation()._node;n.each(e,function(e){var a=t.createInstance("WindowVisualEffect").init(e)._node,o=n.find(this._resourceRelationshipInfo,function(t){return t.path==e});(n.isUndefined(o)||n.isNull(o))&&console.error("targetNodeInfo is not found : "+e),i.seekWidgetByPath(o.parentNodeName).addChild(a)}.bind(this))},setTouchEventListener:function(e,t){this._getTouchNode().addTouchEventListener(e,t)},_getTouchNode:function(){return this._animation._node.seekWidgetByName("loginbonus_comment_0000")},getAnimation:function(){return this._animation}})}((this||0).self||global),function(e){var t=e.kh,n=e._,i=e.khutil;t.LoginBonusAnimation=t.BaseMypageAnimation.extend({className:"KHLoginBonusAnimation",_zOrder:100,_itemZOrder:20,LOGIN_ANIME_SPRITE:t.env.isSp?"animesprite":"animespritepc",LOGIN_ANIME_IMG:"animeimg",_MIN_DISPLAYABLE_AMOUNT:2,HAS_SKIN_ITEM_TYPE:["chara","weapon","summon"],ctor:function(e,t,n){this._resource=e,this._targetLayer=t,this._loginbonusData=n},play:function(){return n.isUndefined(this._targetLayer)||n.isNull(this._targetLayer)?(console.warn("this._targetLayer is not found"),Q.resolve()):n.isUndefined(this._loginbonusData)||n.isNull(this._loginbonusData)?(console.warn("this._loginbonusData is not found"),Q.resolve()):Q.all([this._resource.fetch(),this._preload()]).spread(function(e,t){this._setBackgroundImage(t),this._setBaseUploadImage.call(this,t)}.bind(this)).then(this._prepareItems.bind(this)).then(this.__playTodayItemAnimation.bind(this)).then(this.__playNextDayItemAnimation.bind(this)).then(this.__playExitAnimation.bind(this)).fail(function(e){return console.error(e),Q.reject(e)})},_getAnimation:function(){return this._resource.getAnimation()},_getAnimationNode:function(){return this._getAnimation()._node},_seekAnimationNode:function(e){return this._getAnimationNode().seekWidgetByPath(e)},_replaceBoardText:function(e,t){var i=this._seekAnimationNode(e);if(n.isNull(i))console.warn("node not found: "+e);else{var a=n.clone(t);a.item1=a.item2=a.name;var o=i.getString().replace(/\[%\s*(\S+)\s*%\]/g,function(e,t){return n.isUndefined(a[t])?"":a[t]});i.setString(o)}},_preload:function(){for(var e=t.Img(this.LOGIN_ANIME_SPRITE,"loginbonus-bg",n.padZero(this._loginbonusData.getBackgroundId(),4)).png,i={purgeRule:t.core.repository.PurgeRule.makeSceneChange()},a=[cc.loader.loadImg(e,i)],o=this._loginbonusData.getRewardItemCount()-1;o>=0;o--)a.push(cc.loader.loadImg(this._createRewardItemImageURL(o),i));return this._loginbonusData.hasNextItem()&&a.push(cc.loader.loadImg(this._createNextItemImageURL(),i)),a.push(cc.loader.loadImg(this._createTodayItemImageURL(),i)),Q.all(a).thenResolve(e)},_prepareItems:function(){if(null!=this._loginbonusData){var e=this._getAnimationNode().seekWidgets(function(e){return/^loginbonus_item_ui_\d+$/.test(e.getName())});n.chain(e).first(this._loginbonusData.getRewardItemCount()).each(function(e,t){this._setTargetNodeImage(e,t)}.bind(this)),this._setTodayNodeImage(),this._loginbonusData.hasNextItem()&&this._setNextNodeImage()}else console.warn("this._loginbonusData is not found")},_setBaseUploadImage:function(e){n.each(["loginbonus_upload_115","loginbonus_upload_1","loginbonus_logo_0_r.loginbonus_upload_76","loginbonus_logo_r.loginbonus_upload_76","loginbonus_upload_152","loginbonus_upload_2"],function(t){var i=this._seekAnimationNode(t);return n.isNull(i)?void alert(t+"is not found"):void i.setTexture(e)},this)},_setBackgroundImage:function(e){if(!t.env.isSp&&!cc.sys.isNative){var n=this._seekAnimationNode("loginbonus_bg_r"),i=t.env.isSp?1.43:1.6;if(n.setBackGroundImage){n.setVisible(!1);var a=n,o=a.getLocalZOrder()-1;(n=new ccui.ImageView).setContentSize(cc.game.config.designWidth,cc.game.config.designHeight),a.getParent().addChild(n,o,"loginbonus_bg_img"),n.setAnchorPoint(0,0),n.setPosition(0,0)}n.loadTexture(e);var r=n.getVirtualRenderer();return r.textureLoaded()?void this._setupBackgroundImageRenderer(n,i):void r.addEventListener("load",this._setupBackgroundImageRenderer.bind(this,n,i))}},_setupBackgroundImageRenderer:function(e,n){var i,a=e.getVirtualRenderer();t.env.isSp?(i=cc.rect(10,10,450,630),a.setAnchorPoint(0,0),a.setPosition(0,0)):(i=cc.rect(-160,-355,cc.game.config.designHeight,cc.game.config.designWidth+40),a.setRotation(90)),a.setTextureRect(i,!1),a.setScale(n),e.schedule(function(){a.getScale()!==n&&(a.setScale(n),t.env.isSp&&(a.setAnchorPoint(0,0),a.setPosition(0,0)))},0,3*cc.game.config[cc.game.CONFIG_KEY.frameRate])},_showArrow:function(e){this._seekAnimationNode("loginbonus_arrow_360_1").setVisible(!!e)},__playToDayItemGetAnimation:function(){var e=Q.defer(),t=this._loginbonusData.getTodayNo()-1,i=this._seekAnimationNode("loginbonus_item_stamp_ui_"+t);if(n.isNull(i))return Q.reject(new Error("todayItemNode is not found: "+t));var a=i.getAction(),o=a.animationInfo.bonus_lock,r=this._itemZOrder,s=this._getAnimation(),c=this._getAnimationNode(),u=function(){s.removeAnimationEventCallback("item_stamp_s"),a.setFrameEventCallFunc(null,null),a.gotoFrameAndPause(o.endIndex),c.setLocalZOrder(r)},l=function(){s.removeAnimationEndCallback(),e.reject()};this._resource.setTouchEventListener(function(e,t){t===ccui.Widget.TOUCH_ENDED&&(e.addTouchEventListener(null),u(),l())}.bind(this)),s.addAnimationEventCallback("item_stamp_s",function(){i.setLocalZOrder(10);var e=i.getAction();e.gotoFrameAndPlay(o.startIndex,o.endIndex,!1),e.setFrameEventCallFunc(function(e){"item_lock_e"===e._event&&u()}.bind(this))},this);var _="loginbonus_1";return s.setAnimationNameEndCallback(_,function(){s.removeAnimationEndCallback(),e.resolve()}),this._playAnimation(_,!1),this._setText(this._loginbonusData.getCharacterFirstMessage(),{day:this._loginbonusData.getTodayNo(),name:this._loginbonusData.getTodayItemName()}),e.promise},__playToDayItemGetLoopAnimation:function(){var e=Q.defer();return this._resource.setTouchEventListener(function(t,n){n===ccui.Widget.TOUCH_ENDED&&(this._showArrow(!1),t.addTouchEventListener(null),e.resolve())}.bind(this)),this._playAnimation("loginbonus_1_loop",!0),this._showArrow(!0),e.promise},__playTodayItemAnimation:function(){return Q.when("").then(this.__playToDayItemGetAnimation.bind(this)).then(this.__playToDayItemGetLoopAnimation.bind(this)).fail(function(e){return Q.resolve()})},__playNextDayItemGetAnimation:function(){var e=Q.defer(),t=this._getAnimation(),n="loginbonus_2",i=function(){t.removeAnimationEndCallback(),e.reject()};return this._resource.setTouchEventListener(function(e,t){t===ccui.Widget.TOUCH_ENDED&&(e.addTouchEventListener(null),i())}.bind(this)),t.addAnimationEventCallback("text_change",function(){t.removeAnimationEventCallback("text_change");var e=this._loginbonusData.hasNextItem()?{day:this._loginbonusData.getNextDayNo(),name:this._loginbonusData.getNextItemName()}:{};this._setText(this._loginbonusData.getCharacterSecondMessage(),e)},this),t.setAnimationNameEndCallback(n,function(){t.removeAnimationEndCallback(),e.resolve()}),this._playAnimation(n,!1),this._playNextItemAnimation(n,!1),e.promise},__playNextDayItemGetLoopAnimation:function(){var e=Q.defer(),t="loginbonus_2_loop";return this._resource.setTouchEventListener(function(t,n){n===ccui.Widget.TOUCH_ENDED&&(this._showArrow(!1),t.addTouchEventListener(null),e.resolve())}.bind(this)),this._playAnimation(t,!0),this._playNextItemAnimation(t),this._showArrow(!0),e.promise},__playNextDayItemAnimation:function(){return Q.when("").then(this.__playNextDayItemGetAnimation.bind(this)).then(this.__playNextDayItemGetLoopAnimation.bind(this)).fail(function(e){return Q.resolve()})},__playExitAnimation:function(){var e=Q.defer(),t="loginbonus_3";return this._getAnimation().setAnimationNameEndCallback(t,function(){e.resolve(),this._getAnimation().cleanUp()},this),this._playAnimation(t,!1),this._playNextItemAnimation(t),e.promise},_playAnimation:function(e,t){this._getAnimation().playByName(e,this._targetLayer,cc.p(0,0),this._zOrder,t),this._seekAnimationNode("loginbonus_chara_ui.Layer").animate(e,t)},_playNextItemAnimation:function(e,t){this._loginbonusData.isLastDay()&&!this._loginbonusData.hasNextItem()?this._seekAnimationNode("loginbonus_item_second").animate("lastday_view",t):this._seekAnimationNode("loginbonus_item_second").animate(e,t)},_getTextNodeName:function(){return(this._loginbonusData.isLastDay()?"second":"first")+"_tap_label"},_setText:function(e,t){var n=this._getTextNodeName(),i=this._getTextNodeName();this._seekAnimationNode(n).string=e,this._replaceBoardText(n,t),this._seekAnimationNode("loginbonus_login_text_ui").animate(i)},_setTargetNodeImage:function(e,a){var o=this._createRewardItemImageURL(a),r=i.getWidgetFromNode(e,"loginbonus_item01");r.loadTexture(o),this._setAmountString("loginbonus_get_no_font",r,this._loginbonusData.getRewardItemAmount(a)),e.setVisible(!0);var s=i.getWidgetFromNode(this._getAnimationNode(),"loginbonus_item_stamp_ui_"+a),c=this._loginbonusData.getItemAnimationNameByDay(a);s.setAppearance(c),s.setVisible(!0);var u=t.Img(this.LOGIN_ANIME_SPRITE,"loginbonus-bg",n.padZero(this._loginbonusData.getBackgroundId(),4)).png,l=i.getWidgetFromNode(s,"loginbonus_upload_55");l.setTexture(u),(l=i.getWidgetFromNode(s,"loginbonus_upload_56")).setTexture(u)},_setTodayNodeImage:function(){var e=this._seekAnimationNode("loginbonus_item02"),t=this._createTodayItemImageURL();e.loadTexture(t),this._setAmountString("loginbonus_get_no_font",e,this._loginbonusData.getTodayItemAmount())},_setNextNodeImage:function(){var e=this._seekAnimationNode("loginbonus_item02_0"),t=this._createNextItemImageURL();e.loadTexture(t),this._setAmountString("loginbonus_get_no_font",e,this._loginbonusData.getNextItemAmount())},_setAmountString:function(e,t,n){n<this._MIN_DISPLAYABLE_AMOUNT||i.getWidgetFromNode(t,e).setString(""+n)},_createRewardItemImageURL:function(e){var t=this._loginbonusData.getRewardItemType(e),i=n.padZero(this._loginbonusData.getRewardItemId(e),4);return this._createItemImageURL(t,i)},_createTodayItemImageURL:function(){var e=this._loginbonusData.getTodayItemType(),t=n.padZero(this._loginbonusData.getTodayItemId(),4);return this._createItemImageURL(e,t)},_createNextItemImageURL:function(){var e=this._loginbonusData.getNextItemType(),t=n.padZero(this._loginbonusData.getNextItemId(),4);return this._createItemImageURL(e,t)},_createItemImageURL:function(e,i){return n.contains(this.HAS_SKIN_ITEM_TYPE,e)?t.Img(this.LOGIN_ANIME_IMG,e,i,"0").png:t.Img(this.LOGIN_ANIME_IMG,e,i).png}})}((this||0).self||global),function(e){e.kh=e.kh||{};var t=e.kh;t.AddGachaContents=t.AddGachaContents||{},$staticRes(res["mypage-gacha_add-gacha_add_ani"]),t.AddGachaContents=t.BaseMypageAnimation.extend({className:"KHAddGachaContents",addGachaAnimationInfo:{animation:null,zOrder:100,resource:"mypage-gacha_add-gacha_add_ani"},ctor:function(n,i){t.createInstance("soundPlayer").init(t.createInstance("playerGameConfig")),this._targetLayer=n,this._data=i,this.addGachaAnimationInfo.animation=t.createInstance("WindowVisualEffect").init(e.res[this.addGachaAnimationInfo.resource]),this.baseNode=this.addGachaAnimationInfo.animation._node},play:function(){var e=this._super();if(null==this._targetLayer)return console.warn("this._targetLayer is not found"),this.animationDfd.resolve(),e;if(null==this._data)return console.warn("this._data is not found"),this.animationDfd.resolve(),e;var t=[this.baseNode.seekWidgetByPath("step_01.btn_skip"),this.baseNode.seekWidgetByPath("step_02.btn_skip"),this.baseNode.seekWidgetByPath("step_03.btn_skip"),this.baseNode.seekWidgetByPath("step_04.btn_skip"),this.baseNode.seekWidgetByPath("step_05.btn_skip")];return _.each(t,function(e){this._setSkipBtn(e)}.bind(this)),Q.all([this.__playGachaAddTitle(),this.__preloadImage()]).then(this.__playMainWeapons.bind(this)).then(this.__playMainSummons.bind(this)).then(this.__playSubWeapons.bind(this)).fail(function(e){e&&e.stack&&console.error(e)}).fin(this._destroy.bind(this)),e},__preloadImage:function(){var e=[];this._data.animation_data.main_release_weapons.forEach(function(n){e.push(t.Img("gacha-add-main","weapon",_.padZero(n.id,4)).png)}),this._data.animation_data.main_summons.forEach(function(n){e.push(t.Img("gacha-add-main","summon",_.padZero(n.id,4)).png)}),this._data.animation_data.sub_release_weapons.forEach(function(n){e.push(t.Img("gacha-add-sub","weapon",_.padZero(n.id,4)).png)});var n={purgeRule:t.core.repository.PurgeRule.makeSceneChange()};return Q.all(e.map(function(e){return cc.loader.loadImg(e,n)}))},__playGachaAddTitle:function(){var e=t.Img("gacha-add-top","gacha-add",_.padZero(this._data.animation_id,4)).png,n=this.baseNode.seekWidgetByPath("step_01.group_panel_0.gacha-add-top_gacha-add_0");return cc.loader.loadImg(e,{purgeRule:t.core.repository.PurgeRule.makeSceneChange()}).then(function(){return n.setTexture(e),this._playStepAnimation("step_01")}.bind(this))},__playMainWeapons:function(){var e=this._data.animation_data.main_release_weapons,t=Q.resolve();return _.each(e,function(e){t=t.then(this.__setMainWeaponPage.bind(this,e)).then(this._playStepAnimation.bind(this,"step_02")).then(this._playStepAnimation.bind(this,"step_03"))},this),t},__setMainWeaponPage:function(e){var n=[this.baseNode.seekWidgetByPath("step_02.group_panel_0.gacha-add-main_weapon_0"),this.baseNode.seekWidgetByPath("step_02.group_panel_1.gacha-add-main_weapon_0"),this.baseNode.seekWidgetByPath("step_03.group_panel_0.gacha-add-main_weapon_0"),this.baseNode.seekWidgetByPath("step_03.group_panel_0.gacha-add-main_weapon_1"),this.baseNode.seekWidgetByPath("step_03.group_panel_1.gacha-add-main_weapon_0")],i=t.Img("gacha-add-main","weapon",_.padZero(e.id,4)).png;_.each(n,function(e){e.setTexture(i)}.bind(this))},__playMainSummons:function(){var e=this._data.animation_data.main_summons,t=Q.resolve();return _.each(e,function(e){t=t.then(this.__setMainSummonPage.bind(this,e)).then(this._playStepAnimation.bind(this,"step_04"))},this),t},__setMainSummonPage:function(e){var n=this.baseNode.seekWidgetByPath("step_04.group_panel_0.gacha-add-main_summon_0"),i=this.baseNode.seekWidgetByPath("step_04.group_panel_0.gacha-add-main_summon_1"),a=[n,this.baseNode.seekWidgetByPath("step_04.group_panel_1.gacha-add-main_summon_0"),i],o=t.Img("gacha-add-main","summon",_.padZero(e.id,4)).png;return _.each(a,function(e){e.setTexture(o)}.bind(this)),Q.resolve()},__playSubWeapons:function(){var e=this._data.animation_data.sub_release_weapons,t=e.length/2;t=Math.ceil(t);for(var n=Q.resolve(),i=0;i<t;i++){var a=e[2*i],o=e[2*i+1],r=i+1===t;n=n.then(this.__setSubWeaponPage.bind(this,a,o,r)).then(this._playStepAnimation.bind(this,"step_05"))}return n},__setSubWeaponPage:function(e,t,n){var i=this.baseNode.seekWidgetByPath("step_05.group_panel_0"),a=this.baseNode.seekWidgetByPath("step_05.group_panel_1.gacha-add-sub_weapon_0"),o=this.baseNode.seekWidgetByPath("step_05.group_panel_2"),r=this.baseNode.seekWidgetByPath("step_05.group_panel_3.gacha-add-sub_weapon_0");return this.__setSubWeaponImage(e,i,a),this.__setSubWeaponImage(t,o,r),n&&this.baseNode.seekWidgetByPath("step_05.btn_skip").setVisible(!1),Q.resolve()},__setSubWeaponImage:function(e,n,i){if(_.isUndefined(e))return n.setVisible(!1),void i._parent.setVisible(!1);var a=t.Img("gacha-add-sub","weapon",_.padZero(e.id,4)).png;n.setVisible(!0),i._parent.setVisible(!0),n.children[0].setTexture(a),n.children[1].setTexture(a),i.setTexture(a)},_playStepAnimation:function(e){var n=Q.defer(),i=this.addGachaAnimationInfo.animation,a="layer_in",o=i.getChildEffect(e),r=o.getNode(),s=r.seekWidgetByName("btn_clear");s.addTouchEventListener(function(e,t){t===ccui.Widget.TOUCH_ENDED&&(s.addTouchEventListener(null),n.resolve())}.bind(this)),i.playByName(e,this._targetLayer,cc.p(0,0),this.addGachaAnimationInfo.zOrder,!1),i.showAnimationLastFrame(e,this._targetLayer,cc.p(0,0),this.addGachaAnimationInfo.zOrder);var c=t.createInstance("Sound2Event",[o]);return o.setAnimationNameEndCallback(a,function(){return c.unregisterEvent(),r.animate("default_view",!0)}),o.playByName(a,this.baseNode,cc.p(0,0),this.addGachaAnimationInfo.zOrder,!1),n.promise},_setSkipBtn:function(e){e.addTouchEventListener(function(t,n){n===ccui.Widget.TOUCH_ENDED&&(e.addTouchEventListener(null),this._destroy())}.bind(this))},_destroy:function(){this.addGachaAnimationInfo.animation.cleanUp(),this.addGachaAnimationInfo.animation=null,this.baseNode=null,this.animationDfd.resolve()}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e._,t.BurstTimeCountDownPanel=n.Node.extend({UPDATE_INTERVAL:.5,_timerId:null,_widget:null,_label:null,_khBurstTime:null,show:function(e){var i=n.director.getRunningScene();return i.addChild(this),this._widget=i.seekWidgetByName("bursttime_remaining_ui"),this._widget.setVisible(!1),this._label=i.seekWidgetByName("bursttime_remaining_label"),e instanceof t.BurstTime?(this._khBurstTime=e,void this._initWidget()):(this._khBurstTime=t.createInstance("burstTime"),void this._khBurstTime.prepare().then(this._initWidget.bind(this)))},_initWidget:function(){this._khBurstTime.isEnabled()&&this._khBurstTime.isInBurstTime()&&(this._updateCount(),this._startCountDown(),this._widget.setVisible(!0),t.env.isSp||this._widget.addChild(new n.Sprite))},_updateCount:function(){var e=this._khBurstTime.getRemainingTime();this._label.setString(e)},_startCountDown:function(){this.schedule(this._updateCount,this.UPDATE_INTERVAL)},_stopCountDown:function(){this.unschedule(this._updateCount)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;e.Q,t.pc.note=t.pc.note||{},t.pc.note.roles=t.pc.note.roles||{},t.pc.note.roles.NotePageListController={_fillupMainStoryList:function(e){return t.createInstance("apiALibrary").getMainStories().then(function(n){$staticRes(res["note-no_002-worldlist_page_ui"]);var i=e.seekWidgetByName("tab_0_node"),a=n.body.areas,o=t.PageListParams.NOTE_MAINSTORY.subPageRes,r=t.PageListParams.NOTE_MAINSTORY.perPage,s=this._initMainStoryPanel.bind(this);return this._fillupList(i,{viewParent:t.PageListParams.NOTE_MAINSTORY.viewParent,subPageRes:o,panelsPerPage:r,dontClone:!0},a,a.length,void 0,s),n.body}.bind(this)).fail(function(e){console.error(e)})},_initMainStoryPanel:function(e,a,o){if(console.log(e,a,o),e.seekWidgetByName("name_label")&&e.seekWidgetByName("name_label").setString(a.name),e.seekWidgetByName("noteimg_area")){var r=t.Img("noteimg","area",i.padZero(a.area_id,4),0).png;e.seekWidgetByName("noteimg_area").loadTexture(r)}e.setVisible(!0),i.each(a.quests,function(a,o){var r=e.seekWidgetByName("chapterlist_ui_"+o);if(null!==r){if(r.setStrings({chapter_label:""+a.quest_number+"",chapter_title_label:a.title}),r.setSound(t.SoundList.BUTTON_TOUCHED_DECIDE),i.isFunction(this._onTouchMainStoryTitle)){var s=n.director.getRunningScene();r.bfsWidgetByName("chapter_btn").addTouchEventListener(function(e,t){t===ccui.Widget.TOUCH_ENDED&&this._onTouchMainStoryTitle(s,a)},this)}r.setTouchEnabled(!0),r.setVisible(!0)}},this)}},i.assign(t.pc.note.roles.NotePageListController,t.pc.list.roles.PageListControllerCommon)}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q,o=e.res;t.pc.note=t.pc.note||{},t.pc.note.roles=t.pc.note.roles||{},t.pc.note.roles.EventEpisodeListController={_fillupEpisodeList:function(e,n){$staticRes(o["note-no_012-no_012_episodelist_page_ui"]);var i=e.seekWidgetByName("no_012_episodelist_page_ui");return null===i?(console.warn("[ERROR] Could not find a list parent node."),a.reject()):(i.removeAllChildren(),t.createInstance("apiALibrary").getEventEpisodes(n).then(function(t){var n=e.seekWidgetByName("world_title_label");n&&n.setString(t.body.title);var i=t.body.episodes;return this._fillupList(e,{viewParent:"change_page_panel",subPageRes:"note-no_012-no_012_episodelist_page_ui",panelsPerPage:5},i,i.length,void 0,this._episodePanelInitFunc.bind(this)),t.body}.bind(this)).fail(function(e){console.error(e.stack)}))},_episodePanelInitFunc:function(e,t,a){if(console.log(e,t,a),i.isUndefined(t.episode_id))console.warn("[ERROR] Could not find episode_id.");else{var o=e.seekWidgetByName("title_label");null!==o&&o.setString(t.title),e.bfsWidgetByName("btn_episodelist").addTouchEventListener(function(e,i){if(i===ccui.Widget.TOUCH_ENDED){var a=n.director.getRunningScene();this._navigate012ToEpi(a,t)}},this),e.setVisible(!0)}}},i.assign(t.pc.note.roles.EventEpisodeListController,t.pc.list.roles.PageListControllerCommon)}((this||0).self||global),function(e){var t=e.kh;e.khutil,e.cc,e.ccui,e._,e.console,t.createNameSpaceIfNotExists("core.pager.model"),t.core.pager.model.ApiEventStoryList=t.core.pager.model.ApiDataList.extend({className:"ApiEventStoryList",ctor:function(e,n,i,a,o){var r=t.createInstance(e),s=r[n].bind(r);this._super(s,i,a||t.core.pager.model.PlainData,o)},_updateModels:function(e,t,n){this._maxRecordCount=n.body.events.length,this._existsRecordCount=this._maxRecordCount;var i=n.body.events.map(function(e){return new this._modelClass(e)}.bind(this));return this._cachedModels=i,this._fetchComplete=!0,i}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc,e.ccui,e._),i=e.console;t.createNameSpaceIfNotExists("core.pager.view.page"),t.core.pager.view.page.EventBannerPageUi=t.core.pager.view.page.BasePageUi.extend({className:"EventBannerPageUi",ctor:function(e,t,n){this._rootWidget=e,this._touchMethod=t,this._sceneDelegate=n},_updateOne:function(e,a){var o=a.getRawData(),r=t.Img("eventimg","banner",n.padZero(o.banner_id,4)).png,s=e.seekWidgetByName("eventimg_banner");return s&&(s.loadTextures(r,r,r),s.setSound(t.SoundList.BUTTON_TOUCHED_DECIDE)),this._touchMethod?void t.setTouchEventHandlers(e,{"TOUCH_ENDED eventimg_banner":this._touchMethod.bind(this._sceneDelegate,o)},this._sceneDelegate):void i.warn("EventBannerPageUi : touchMethod Not Found")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);e.Q,t.pc.note=t.pc.note||{},t.pc.note.roles=t.pc.note.roles||{},t.pc.note.roles.Routing={_verifyRouterParams001:function(e){},_navigate001To002:function(e){t.createInstance("router").navigate("note/no_002")},_navigate001To004:function(e){t.createInstance("router").navigate("note/no_004")},_verifyRouterParams002:function(e){n.isUndefined(e.routerParams.no_002)&&(e.routerParams.no_002={})},_navigate002To003:function(e,i){return n.isUndefined(i)||n.isUndefined(i.quest_id)?void this._consoleErrorRoutingAbort("record.quest_id"):void t.createInstance("router").navigate("note/no_003",{no_003:{quest_type:"main",quest_id:i.quest_id}})},_navigate002To012:function(e,n){var i={no_012:{event_type:n.event_type,event_id:n.event_id}};t.createInstance("router").navigate("note/no_012",i)},_navigate002ToBannerDestinaton:function(e,n){var i=n.navigate_page,a={};a[i.replace(/^note\//g,"")]={id:n.banner_id,isContinueGacha:!1,event_id:n.event_id},t.createInstance("router").navigate(i,a)},_verifyRouterParams003:function(e){n.isUndefined(e.routerParams.no_003)&&(e.routerParams.no_003={},e.routerParams.no_003.quest_type="main",e.routerParams.no_003.quest_id=1,this._consoleErrorRouterParams("routerParams.no_003, .quest_type, .quest_id"))},_navigate003ToEpi:function(e,i){return n.isUndefined(i)||n.isUndefined(i.episode_id)?void this._consoleErrorRoutingAbort("record.episode_id"):void t.createInstance("router").navigate("scenario/episode-play",{"scenario/play":{episode_id:i.episode_id,returnBackParams:{scene:"note/no_003",routerParams:{no_003:e.routerParams.no_003}}}})},_navigate003To003:function(e,i){if(n.isUndefined(e.routerParams.no_003))this._consoleErrorRoutingAbort("routerParams.no_003");else if(n.isUndefined(e.routerParams.no_003.quest_type))this._consoleErrorRoutingAbort("routerParams.no_003.quest_type");else{var a=e.routerParams.no_003;t.createInstance("router").navigate("note/no_003",{no_003:{quest_type:a.quest_type,quest_id:i}})}},_verifyRouterParams004:function(e){},_navigate004ToWeponStatus:function(e,i){return n.isUndefined(i)||n.isUndefined(i.weapon_id)?void this._consoleErrorRoutingAbort("record.weapon_id"):void t.createInstance("router").navigate("status/status_002",{status_002:{id:i.weapon_id,isFromNote:!0}})},_navigate004ToSummonStatus:function(e,i){return n.isUndefined(i)||n.isUndefined(i.summon_id)?void this._consoleErrorRoutingAbort("record.summon_id"):void t.createInstance("router").navigate("status/status_003",{status_003:{id:i.summon_id,isFromNote:!0}})},_navigate004To007:function(e,i){return n.isUndefined(i)||n.isUndefined(i.other_character_id)?void this._consoleErrorRoutingAbort("record.other_character_id"):void t.createInstance("router").navigate("note/no_007",{no_007:{id:i.other_character_id}})},_navigate004ToCharacterStatus:function(e,i){return n.isUndefined(i)||n.isUndefined(i.character_id)?void this._consoleErrorRoutingAbort("record.character_id"):void t.createInstance("router").navigate("status/status_001",{status_001:{id:i.character_id,isFromNote:!0}})},_verifyRouterParams005:function(e){n.isUndefined(e.routerParams.no_005)&&(e.routerParams.no_005={},e.routerParams.no_005.id=1,this._consoleErrorRouterParams("routerParams.no_005, .id"))},_verifyRouterParams006:function(e){n.isUndefined(e.routerParams.no_006)&&(e.routerParams.no_006={},e.routerParams.no_006.id=1,this._consoleErrorRouterParams("routerParams.no_006, .id"))},_navigate006ToEpi:function(e,i){return n.isUndefined(i)||n.isUndefined(i.summon_id)?void this._consoleErrorRoutingAbort("record.summon_id"):void t.createInstance("router").navigate("epi/epi_003",{epi_001:{tab:"chara",kind:"summon",summon_id:i.summon_id}})},_verifyRouterParams007:function(e){n.isUndefined(e.routerParams.no_007)&&(e.routerParams.no_007={},e.routerParams.no_007.id=1,this._consoleErrorRouterParams("routerParams.no_007, .id"))},_navigate007To007:function(e,i){return n.isUndefined(i)?void this._consoleErrorRoutingAbort("charaId"):void t.createInstance("router").navigate("note/no_007",{no_007:{id:i}})},_verifyRouterParams008:function(e){n.isUndefined(e.routerParams.no_008)&&(e.routerParams.no_008={},e.routerParams.no_008.id=1,this._consoleErrorRouterParams("routerParams.no_008, .id"))},_navigate008ToEpi:function(e,i){return n.isUndefined(i)||n.isUndefined(i.character_id)?void this._consoleErrorRoutingAbort("record.character_id"):void t.createInstance("router").navigate("epi/epi_002",{epi_001:{tab:"chara",kind:"chara",character_id:i.character_id}})},_verifyRouterParams012:function(e){n.isUndefined(e.routerParams.no_012)&&(e.routerParams.no_012={},e.routerParams.no_012.event_type="raidevent",e.routerParams.no_012.event_id=2002,this._consoleErrorRouterParams("routerParams.no_012, .event_type, .event_id"))},_navigate012ToEpi:function(e,i){if(n.isUndefined(i)||n.isUndefined(i.episode_id))this._consoleErrorRoutingAbort("record.episode_id");else{var a=e.routerParams.no_012,o=a.event_id,r=a.event_type;t.createInstance("router").navigate("scenario/episode-play",{"scenario/play":{episode_id:i.episode_id,returnBackParams:{scene:"note/no_012",routerParams:{no_012:{event_type:r,event_id:o}}}}})}},_navigate012to002b:function(e){t.createInstance("router").navigate("note/no_002",{no_002:{tab:"tab_1"}})},_navigate008To004:function(e){t.createInstance("router").navigate("note/no_004",{no_004:{tab:"tab_0"}})},_navigate007To004:function(e){t.createInstance("router").navigate("note/no_004",{no_004:{tab:"tab_0",subTab:"btn_npc"}})},_navigate005To004:function(e){t.createInstance("router").navigate("note/no_004",{no_004:{tab:"tab_1"}})},_navigate006To004:function(e){t.createInstance("router").navigate("note/no_004",{no_004:{tab:"tab_2"}})}},n.assign(t.pc.note.roles.Routing,t.pc.roles.RoutingCommon)}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.note=t.pc.note||{},t.pc.note.no_001=t.pc.note.no_001||{},t.pc.note.no_001.Scene=t.BaseScene.extend({resourceFileName:"no_001/no_001.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"note",sceneName:"no_001",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_category_0","btnCallbackBtnCategory0",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"note/no_002")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_category_1","btnCallbackBtnCategory1",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"note/no_004")),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._),i=e.Q;t.pc=t.pc||{},t.pc.note=t.pc.note||{},t.pc.note.no_001=t.pc.note.no_001||{},t.pc.note.no_001.SceneDelegate=t.pc.BaseSceneDelegate.extend({_popups:{},onSceneInit:function(e){return i.defer(),this._verifyRouterParams001(e),n.each(n.range(4),function(n){var i=e.seekWidgetByName("btn_category_"+n);i&&i.setSound(t.SoundList.BUTTON_TOUCHED_DECIDE)}),this._setBackBtn(e),i.resolve()},onSceneEnter:function(e){return i.defer(),i.resolve()},onSceneExit:function(e){return i.defer(),i.resolve()},onPageInAnimationEnd:function(e){return i.defer(),i.resolve()},btnCallbackBtnCategory0:function(e){var t=i.defer();return t.reject(this._override),this._navigate001To002(e),t.promise},btnCallbackBtnCategory1:function(e){var t=i.defer();return t.reject(this._override),this._navigate001To004(e),t.promise},_touchEndedBackBtnProcess:function(e){t.createInstance("router").navigate("mypage/my_001")}}),n.assign(t.pc.note.no_001.SceneDelegate.prototype,t.pc.note.roles.Routing)}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.note=t.pc.note||{},t.pc.note.no_002=t.pc.note.no_002||{},t.pc.note.no_002.Scene=t.BaseScene.extend({resourceFileName:"no_002/no_002.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[{tab1:{node:"tab_0","content-node":"tab_0_node"},tab2:{node:"tab_1","content-node":"tab_1_node"}}],componentName:"note",sceneName:"no_002",_delegate:null,_init:function(){this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc=t.pc||{},t.pc.note=t.pc.note||{},t.pc.note.no_002=t.pc.note.no_002||{},t.pc.note.no_002.SceneDelegate=t.pc.BaseSceneDelegate.extend({_popups:{},_controllers:null,onSceneInit:function(e){return this._verifyRouterParams002(e),this._fillupMainStoryList(e),this._selectTab(e),this._setBackBtn(e),a.resolve()},_selectTab:function(e){if(e.restoreParams)e.restore(e.getRestoreParams());else{var t=e.tabDelegateList[0],n="tab_0";e.routerParams.no_002&&e.routerParams.no_002.tab&&(n=e.routerParams.no_002.tab,delete e.routerParams.no_002.tab),t.selectTab(t._getContainerNode().seekWidgetByName(n))}},onSceneEnter:function(e){return this._controllers={},e.tabDelegateList.forEach(function(e){e.preventInitialization()}),a.resolve()},onSceneExit:function(e){return i.invoke(this._controllers,"dispose"),a.resolve()},tabCallbackTab0:function(e){},tabCallbackTab1:function(e){if(console.info(this),!this._controllers.tab1){var n=new t.core.pager.model.ApiDataListFactory("apiABanners","getStoryEventBanners",[t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE]),i=e.seekWidgetByName("tab_1_node"),a=i.seekWidgetByName("no_event_bannerlist_ui"),o=new t.core.pager.view.page.EventBannerPageUi(a,this._onTouchEventBanner,this),r=new t.core.pager.controller.PagerController(i,n,[o],a),s=i.seekWidgetByName("viewpage_ui");new t.core.pager.view.button.ViewPageUi(s,r).initialize(),r.initialize(),this._controllers.tab1=r}},_onTouchEventBanner:function(e){var t=n.director.getRunningScene();this._navigate002To012(t,e)},_onTouchMainStoryTitle:function(e,t){this._navigate002To003(e,t)},_touchEndedBackBtnProcess:function(e){t.createInstance("router").navigate("note/no_001")}}),i.assign(t.pc.note.no_002.SceneDelegate.prototype,t.pc.note.roles.NotePageListController,t.pc.note.roles.Routing)}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.note=t.pc.note||{},t.pc.note.no_003=t.pc.note.no_003||{},t.pc.note.no_003.Scene=t.BaseScene.extend({resourceFileName:"no_003/no_003.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"note",sceneName:"no_003",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_prev","btnCallbackBtnPrev",null,function(){alert("{{}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_next","btnCallbackBtnNext",null,function(){alert("{{}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._),i=e.Q;t.pc=t.pc||{},t.pc.note=t.pc.note||{},t.pc.note.no_003=t.pc.note.no_003||{},t.pc.note.no_003.SceneDelegate=t.pc.BaseSceneDelegate.extend({_popups:{},onSceneInit:function(e){return this._setBackBtn(e),this._updateChapterDisplay(e)},onSceneEnter:function(e){this._verifyRouterParams003(e);var n=e.routerParams.no_003.quest_id,i=e.routerParams.no_003.quest_type;return t.createInstance("apiALibrary").getStoryEpisodes(n,i).then(function(e){this._chapter=e.body}.bind(this))},btnCallbackBtnPrev:function(e){var t=i.defer();t.reject(this._override);var n=this._chapter.prev_quest_id;return n?(this._navigate003To003(e,n),t.promise):t.promise},btnCallbackBtnNext:function(e){var t=i.defer();t.reject(this._override);var n=this._chapter.next_quest_id;return n?(this._navigate003To003(e,n),t.promise):t.promise},_updateChapterDisplay:function(e){var t=e.contentLayer.bfsWidgetByName("world_title_label");t&&t.setString(this._chapter.area_title);var i=e.contentLayer.bfsWidgetByName("chapter_title_label");i&&i.setString(""+this._chapter.quest_number+" "+this._chapter.quest_title),n.each(n.range(this._chapter.episodes.length),function(t){this._updateEpisodeDisplay(e,this._chapter.episodes[t],e.contentLayer.bfsWidgetByName("no_episodelist_ui_"+t))},this),this._chapter.next_quest_id||e.seekWidgetByName("btn_next")&&e.contentLayer.bfsWidgetByName("btn_next").setVisible(!1),this._chapter.prev_quest_id||e.seekWidgetByName("btn_prev")&&e.contentLayer.bfsWidgetByName("btn_prev").setVisible(!1)},_updateEpisodeDisplay:function(e,n,i){if(null!==i){i.setVisible(!0);var a=i.seekWidgetByName("btn_episodelist");a&&(a.getTitleRenderer().disableStroke(),a.titleText=n.title,a.setSound(t.SoundList.BUTTON_TOUCHED_DECIDE)),t.setTouchEventHandlers(i,{"TOUCH_ENDED btn_episodelist":this._navigate003ToEpi.bind(this,e,n)},this)}},_touchEndedBackBtnProcess:function(e){t.createInstance("router").navigate("note/no_002")}}),n.assign(t.pc.note.no_003.SceneDelegate.prototype,t.pc.note.roles.Routing)}((this||0).self||global),function(e){var t=e.kh,n=e._;t.pc=t.pc||{};var i=(e.Q,{});t.pc.note=t.pc.note||{},t.pc.note.no_004=t.pc.note.no_004||{},t.pc.note.no_004.Scene=t.BaseScene.extend({resourceFileName:"no_004/no_004.json",isLoopDefaultView:!1,_popups:i,tabDelegateConfig:[{tab1:{node:"tab_0","content-node":"tab_0_node"},tab2:{node:"tab_1","content-node":"tab_1_node"},tab3:{node:"tab_2","content-node":"tab_2_node"}},{tab4:{node:"btn_chara","content-node":"chara_node"},tab5:{node:"btn_npc","content-node":"npc_node"}}],componentName:"note",sceneName:"no_004",_delegate:null,_init:function(){var e;this._initPulldown.call(this,"sort_ui_0","btn_sort","sort_label","sortlist",((e=n.findKey(res,function(e){return 0<e.indexOf("sort_list_0_ui.json")}))||alert(": sort_list_0_ui.json"),e||""),"pulldownCallbackSortUi0SortCon1","pulldownChoiceCallbackSortUi0SortCon1"),this._initPulldown.call(this,"sort_ui_1","btn_sort","sort_label","sortlist",function(){var e=n.findKey(res,function(e){return 0<e.indexOf("sort_list_0_ui.json")});return e||alert(": sort_list_0_ui.json"),e||""}(),"pulldownCallbackSortUi1SortCon1","pulldownChoiceCallbackSortUi1SortCon1"),this._initPulldown.call(this,"sort_ui_2","btn_sort","sort_label","sortlist",function(){var e=n.findKey(res,function(e){return 0<e.indexOf("sort_list_0_ui.json")});return e||alert(": sort_list_0_ui.json"),e||""}(),"pulldownCallbackSortUi2SortCon1","pulldownChoiceCallbackSortUi2SortCon1"),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc=t.pc||{},t.pc.note=t.pc.note||{},t.pc.note.no_004=t.pc.note.no_004||{},t.pc.note.no_004.PULLDOWN_KEY={WEAPON_TYPE:"filter.weapon_type",WEAPON_ELEMENT_TYPE:"filter.weapon_element_type",SUMMON_ELEMENT_TYPE:"filter.summon_element_type"},t.pc.note.no_004.SceneDelegate=t.pc.BaseSceneDelegate.extend({_popups:{},LIST_NUMBER_CHARA:0,LIST_NUMBER_WEAPON:1,LIST_NUMBER_SUMMON:2,LIST_NUMBER_NPC:3,_getListSetting:function(e,n){var i=t.core.pager.enum.API_OPTION;return[{baseName:"tab_0_node.chara_node",cardType:"chara",cardFrame:"e_r",isFillEmptyRecord:!0,apiName:"apiALibrary",apiMethod:"getCharacters",touchHandler:this._touchNoteChara},{baseName:"tab_1_node.list_node",cardType:"weapon",cardFrame:"e_r",apiName:"apiALibrary",apiMethod:"getWeapons",apiParams:this._getFilterForWeapon(e).concat([i.REPLACE_OPTION_PAGE,i.REPLACE_OPTION_PER_PAGE]),isFillEmptyRecord:!0,touchHandler:this._touchNoteWeapon},{baseName:"tab_2_node.list_node",cardType:"summon",cardFrame:"e_r",apiName:"apiALibrary",apiMethod:"getSummons",apiParams:this._getFilterForSummon(e).concat([i.REPLACE_OPTION_PAGE,i.REPLACE_OPTION_PER_PAGE]),isFillEmptyRecord:!0,touchHandler:this._touchNoteSummon},{baseName:"tab_0_node.npc_node",cardType:"npc",isFillEmptyRecord:!0,apiName:"apiALibrary",apiMethod:"getOtherCharacters",touchHandler:this._touchNoteCharaOther}][n]},_listController:null,onSceneInit:function(e){return a.defer(),this._selectTab(e),this._setBackBtn(e),a.resolve()},_selectTab:function(e){if(!e.restoreParams){var t=e.tabDelegateList[0],n="tab_0";if(e.routerParams.no_004&&e.routerParams.no_004.tab&&(n=e.routerParams.no_004.tab,delete e.routerParams.no_004.tab),t.selectTab(t._getContainerNode().seekWidgetByName(n)),e.routerParams.no_004&&e.routerParams.no_004.subTab){var i=e.tabDelegateList[1],a=this._getSelectedSubTab(e);i.selectTab(i._getContainerNode().seekWidgetByName(a)),delete e.routerParams.no_004.subTab}}},_getSelectedSubTab:function(e){return e.routerParams.no_004&&e.routerParams.no_004.subTab?e.routerParams.no_004.subTab:"btn_chara"},_initListController:function(e,n){if(!this._listController[n]){var i=this._getListSetting(e,n),a=new t.core.eventHandling.BaseEventHandler(i.touchHandler.bind(this,e),this);this._listController[n]=t.core.pager.helper.coreCardListUI(e,i,a),this._listController[n].initialize()}},onSceneEnter:function(e){return a.defer(),e.tabDelegateList.forEach(function(e){e.preventInitialization()}),this._noteWeaponOption1=this.__getFilter("WEAPON_TYPE"),this._noteWeaponOption2=this.__getFilter("WEAPON_ELEMENT_TYPE"),this._noteSummonOption1=this.__getFilter("SUMMON_ELEMENT_TYPE"),this._listController=[],a.resolve()},onSceneExit:function(e){return a.defer(),t.createInstance("router").permanentlyRemoveRouterParam("no_004"),a.resolve()},onPageInAnimationEnd:function(e){return a.defer(),a.resolve()},tabCallbackTab0:function(e){var t=e.tabDelegateList[1],n=this._getSelectedSubTab(e);t.selectTab(t._getContainerNode().seekWidgetByName(n))},tabCallbackTab1:function(e){this._initListController(e,this.LIST_NUMBER_WEAPON)},tabCallbackTab2:function(e){this._initListController(e,this.LIST_NUMBER_SUMMON)},tabCallbackBtnChara:function(e){this._initListController(e,this.LIST_NUMBER_CHARA)},tabCallbackBtnNpc:function(e){this._initListController(e,this.LIST_NUMBER_NPC)},__getFilter:function(e){var a=n.director.getRunningScene().routerParams;return i.isUndefined(a.no_004)&&(a.no_004={}),a.no_004[t.pc.note.no_004.PULLDOWN_KEY[e]]},_getFilterForWeapon:function(e){return[this.__getFilter("WEAPON_TYPE"),this.__getFilter("WEAPON_ELEMENT_TYPE")]},_getFilterForSummon:function(e){return[this.__getFilter("SUMMON_ELEMENT_TYPE")]},__saveFilter:function(e,a){var o=n.director.getRunningScene().routerParams;i.isUndefined(o.no_004)&&(o.no_004={}),o.no_004[t.pc.note.no_004.PULLDOWN_KEY[e]]=a;var r=t.createInstance("router");r.historyReplace(r.getCurrentFragment(),o)},_saveFilterForWeaponType:function(e){this.__saveFilter("WEAPON_TYPE",e)},_saveFilterForWeaponElementType:function(e){this.__saveFilter("WEAPON_ELEMENT_TYPE",e)},_saveFilterForSummonElementType:function(e){this.__saveFilter("SUMMON_ELEMENT_TYPE",e)},__getChoices:function(e,t){return i.isUndefined(t)||i.isNull(t)?e:i.map(i.cloneDeep(e),function(e){return e.selected=e.value==t||void 0,e})},pulldownCallbackSortUi0SortCon1:function(e){this._noteWeaponOption1=e.value,this._saveFilterForWeaponType(e.value),this._updateSort(this.LIST_NUMBER_WEAPON)},pulldownChoiceCallbackSortUi0SortCon1:function(){var e=this._noteWeaponOption1;return this.__getChoices(t.WordBook.WEAPON_TYPE_FILTER_CONDITION,e)},pulldownCallbackSortUi1SortCon1:function(e){this._noteWeaponOption2=e.value,this._saveFilterForWeaponElementType(e.value),this._updateSort(this.LIST_NUMBER_WEAPON)},pulldownChoiceCallbackSortUi1SortCon1:function(){var e=this._noteWeaponOption2;return this.__getChoices(t.WordBook.ELEMENT_TYPE_FILTER_CONDITION,e)},pulldownCallbackSortUi2SortCon1:function(e){this._noteSummonOption1=e.value,this._saveFilterForSummonElementType(e.value),this._updateSort(this.LIST_NUMBER_SUMMON)},pulldownChoiceCallbackSortUi2SortCon1:function(){var e=this._noteSummonOption1;return this.__getChoices(t.WordBook.ELEMENT_TYPE_FILTER_CONDITION,e)},_updateSort:function(e){var t=this._listController[e];if(t){var i=this._getListSetting(n.director.getRunningScene(),e).apiParams;t.getDataList().updateOption(i),t.setCurrentPageNumber(1,!1)}},_touchNoteChara:function(e,t){this._navigate004ToCharacterStatus(e,t.getRawData())},_touchNoteCharaOther:function(e,t){this._navigate004To007(e,t.getRawData())},_touchNoteWeapon:function(e,t){this._navigate004ToWeponStatus(e,t.getRawData())},_touchNoteSummon:function(e,t){this._navigate004ToSummonStatus(e,t.getRawData())},_touchEndedBackBtnProcess:function(e){t.createInstance("router").navigate("note/no_001")}}),t.assignRoles(t.pc.note.no_004.SceneDelegate,[t.pc.note.roles.Routing])}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.note=t.pc.note||{},t.pc.note.no_007=t.pc.note.no_007||{},t.pc.note.no_007.Scene=t.BaseScene.extend({resourceFileName:"no_007/no_007.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"note",sceneName:"no_007",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_all_over","btnCallbackBtnAllOver",null,function(){alert("{{all_over_ui}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_prev","btnCallbackBtnPrev",null,function(){alert("{{1}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_next","btnCallbackBtnNext",null,function(){alert("{{1}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._),i=e.Q;t.pc=t.pc||{},t.pc.note=t.pc.note||{},t.pc.note.no_007=t.pc.note.no_007||{},t.pc.note.no_007.SceneDelegate=t.pc.BaseSceneDelegate.extend({_popups:{},onSceneInit:function(e){return this._setBackBtn(e),this._dfd},onSceneEnter:function(e){return this._verifyRouterParams007(e),this._dfd=t.createInstance("apiALibrary").getOtherCharacter(e.routerParams.no_007.id).then(function(i){this._character=i.body,this.setFlavor(e);var a=e.seekWidgetByName("btn_prev");a&&(n.isUndefined(this._character.prev_other_character_id)?a.setVisible(!1):a.setSound(t.SoundList.BUTTON_TOUCHED_SWITCH));var o=e.seekWidgetByName("btn_next");o&&(n.isUndefined(this._character.next_other_character_id)?o.setVisible(!1):o.setSound(t.SoundList.BUTTON_TOUCHED_SWITCH))}.bind(this)).fail(function(e){console.error(e.stack)}),i.resolve()},onSceneExit:function(e){return i.defer(),this._dfd=null,i.resolve()},onPageInAnimationEnd:function(e){return i.defer(),i.resolve()},btnCallbackBtnAllOver:function(e){var t=i.defer();return t.reject(this._override),this._showImageZoomPopup(),t.promise},btnCallbackBtnPrev:function(e){var t=i.defer();return t.reject(this._override),n.isUndefined(this._character)||n.isUndefined(this._character.prev_other_character_id)?(console.warn("[ERROR] Could not find prev_other_character_id."),t.promise):(this._navigate007To007(e,this._character.prev_other_character_id),t.promise)},btnCallbackBtnNext:function(e){var t=i.defer();return t.reject(this._override),n.isUndefined(this._character)||n.isUndefined(this._character.next_other_character_id)?(console.warn("[ERROR] Could not find next_other_character_id."),t.promise):(this._navigate007To007(e,this._character.next_other_character_id),t.promise)},setFlavor:function(e){if(n.isUndefined(this._character))console.warn("[ERROR] Could not access character data.");else{var i=e.seekWidgetByName("introduceimg_npc");i&&!n.isUndefined(this._character.other_character_id)&&i.loadTexture(t.Img("introduceimg","npc",n.padZero(this._character.other_character_id,4),0).jpg);var a=e.seekWidgetByName("name_label");a&&!n.isUndefined(this._character.name)&&a.setString(this._character.name);var o=e.seekWidgetByName("flavor_label");o&&!n.isUndefined(this._character.description)&&o.setString(this._character.description)}},btnCallbackBtnBackNoteChara:function(e){var t=i.defer();return t.reject(this._override),this._navigate007To004(e),t.promise},_showImageZoomPopup:function(){this._openAllOverPanel(this._character.other_character_id,this._character.skin,"npc")},_touchEndedBackBtnProcess:function(e){t.createInstance("router").navigate("note/no_004",{no_004:{tab:"tab_0",subTab:"btn_npc"}})}}),t.assignRoles(t.pc.note.no_007.SceneDelegate,[t.pc.roles.UIUtility,t.pc.note.roles.Routing,t.pc.roles.AllOverUI])}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.note=t.pc.note||{},t.pc.note.no_012=t.pc.note.no_012||{},t.pc.note.no_012.Scene=t.BaseScene.extend({resourceFileName:"no_012/no_012.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"note",sceneName:"no_012",_delegate:null,_init:function(){this._initScene("page_in")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._),i=e.Q;t.pc=t.pc||{},t.pc.note=t.pc.note||{},t.pc.note.no_012=t.pc.note.no_012||{},t.pc.note.no_012.SceneDelegate=t.pc.BaseSceneDelegate.extend({_popups:{},onSceneInit:function(e){this._verifyRouterParams012(e),this._setHeaderTitle(e);var t=e.routerParams.no_012,n=t.event_id,a=t.event_type;return this._setBackground(e,a,n),this._fillupEpisodeList(e,n),this._setBackBtn(e),i.defer(),i.resolve()},onSceneEnter:function(e){return i.defer(),i.resolve()},onSceneExit:function(e){return i.defer(),i.resolve()},onPageInAnimationEnd:function(e){return i.defer(),i.resolve()},btnCallbackBtnBackEventList:function(e){var t=i.defer();return t.reject(this._override),this._navigate012to002b(e),t.promise},_setHeaderTitle:function(e){var t=e.seekWidgetByPath("header_node..header_label");null!=t&&t.setString("")},_setBackground:function(e,i,a){var o=t.env.isSp?"003":"002",r=e.seekWidgetByName("raid-bg"+o);if(null!=r){if("raidevent"===i){var s=t.Img("raid-bg"+o,"event",n.padZero(a,4)).jpg;return void r.loadTexture(s)}if("quest_story_event"===i){s=t.Img("conquest-bg005","event",n.padZero(a,4)).jpg;return void r.loadTexture(s)}}},_touchEndedBackBtnProcess:function(e){var n=e.temporaryRouterParams;n.navigationFrom?t.createInstance("router").navigate(n.navigationFrom,n.returnParams):t.createInstance("router").navigate("note/no_002",{no_002:{tab:"tab_1"}})}}),n.assign(t.pc.note.no_012.SceneDelegate.prototype,t.pc.note.roles.EventEpisodeListController,t.pc.roles.UIUtility,t.pc.note.roles.Routing)}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.router=n.router||{},n.router.routes=n.router.routes||{},t.merge(n.router.routes,{note:{note:"no_001","note/no_001":"no_001","note/no_002":"no_002","note/no_003":"no_003","note/no_004":"no_004","note/no_007":"no_007","note/no_012":"no_012"}})}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="AJobEnergyRelease",o={getSummary:function(e){return this._http.get({url:"/a_job_energy_release/"+e+"/summary"})},getStatus:function(e,t,n,i){return this._http.get({url:"/a_job_energy_release/"+e+"/status/"+t,json:{page:n,per_page:i}})},confirmEnhanceStatus:function(e,t){return this._http.get({url:"/a_job_energy_release/"+e+"/status/confirm_enhance/"+t})},confirmRemoveStatus:function(e,t){return this._http.get({url:"/a_job_energy_release/"+e+"/status/confirm_remove/"+t})},enhance:function(e,t){return this._http.post({url:"/a_job_energy_release/"+e+"/status/enhance_status/"+t})},remove:function(e,t,n){return this._http.post({url:"/a_job_energy_release/"+e+"/status/remove_status/"+t,json:{type:n}})},getAbilities:function(e,t,n){return this._http.get({url:"/a_job_energy_release/"+e+"/ability",json:{page:t,per_page:n}})},acquire:function(e,t){return this._http.post({url:"/a_job_energy_release/"+e+"/acquire_ability/"+t})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiAJobEnergyRelease",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},o)),n.env.useApiMock){n.MockApi=n.MockApi||{};var r={};t.each(o,function(e,t){r[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi."+a+"."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},r))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="AJobParameter",o={getAJobParameterList:function(e){return this._http.get({url:"/a_job_parameter/"+e})},applyAJobParameter:function(e,t){return this._http.put({url:"/a_job_parameter/"+e,json:{apply_parameter_a_job_id:t}})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiAJobParameter",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},o)),n.env.useApiMock){n.MockApi=n.MockApi||{};var r={};t.each(o,function(e,t){r[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi."+a+"."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},r))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e._,n=e.kh,i=(e.cc,e.ccui);n.PopupFactoryComConfirmBonus=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-p_bonus_info",title:"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){this.dismiss()}}},POPUP_METHODS:{},onPopupOpened:function(e,t){this._popup=e,this._bonus=t.bonus,console.log(t),this._initPopupLayout(),this._loadBonusList()},_loadBonusList:function(){var e=this._popup.seekWidgetByName("contents_panel");e.setLayoutType(i.Layout.LINEAR_VERTICAL),e.removeAllChildren();var a=ccs.load(res["core-popup-p_bonus_list_ui"]).node;t.each(this._bonus,function(i,o){var r=a.clone();r.seekWidgetByName("bonus_img").loadTexture(n.Img("coreimg","job-bonusicon",t.padZero(i.type,4)).png),r.seekWidgetByName("bonus_label").setString(i.description),e.height=e.height+r.height,e.addChild(r),this._adjustPopupLayout(r)},this),this._initializedPopup=!0},_initPopupLayout:function(){this._popup.seekWidgetByName("popup_base").height=274,this._popup.seekWidgetByName("main_panel").y=123,this._popup.seekWidgetByName("title_label").y=244,this._popup.seekWidgetByName("contents_panel").height=8},_adjustPopupLayout:function(e){this._popup.seekWidgetByName("popup_base").height=this._popup.seekWidgetByName("popup_base").height+e.height,this._popup.seekWidgetByName("main_panel").y=this._popup.seekWidgetByName("main_panel").y+e.height,this._popup.seekWidgetByName("title_label").y=this._popup.seekWidgetByName("title_label").y+e.height}})}((this||0).self||global),function(e){var t=e._,n=e.kh;e.cc,e.ccui,n.PopupFactoryComCharChange=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-p_chara_change",title:"",buttonLabels:{blueBtn:"OK"},buttonSounds:{blueBtn:n.SoundList.BUTTON_TOUCHED_CONFIRMED},buttons:{blueBtn:function(e){this.dismiss()}}},POPUP_METHODS:{},onPopupOpened:function(e,i){this._popup=e,this._character=i.character,console.log(i);var a=n.createInstance("voiceLoader"),o=n.IDList.VOICES.JOIN_PARTY,r=this._getAppearanceCharacterId(this._character);a.loadCharacterVoices(r,o.LOWER,o.UPPER).then(function(e){n.createInstance("soundPlayer").playVoice(t.sample(e))}),this._loadContent()},_loadContent:function(){var e=this._character,t=n.createInstance("CoreCardCharacterUI",["e_r"]),i=this._getAppearanceCharacterId(this._character);t.setAroused(e.is_aroused),t.setImg(i,0),t.setIconElement(e.element_type),t.setIconRarity(e.rare);var a=t.getResult();this._popup.seekWidgetByName("chara_img").addChild(a),this._popup.seekWidgetByName("formation_label").setString(e.name+"\n"),this._initializedPopup=!0},_getAppearanceCharacterId:function(e){var n=e.character_id;return t.isUndefined(e.appearance)?n:e.appearance.used_character_id||n}})}((this||0).self||global),function(e){var t=e._,n=e.kh,i=(e.cc,e.ccui);n.PopupFactoryComPartyAutoOrg=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-p_001_autoorg",title:"",buttonLabels:{blackBtn:"",blueBtn:""},buttons:{blackBtn:function(e){},blueBtn:function(e){}}},POPUP_METHODS:{},onPopupOpened:function(e,n){console.log(n),t.isUndefined(this._initializedPopup)&&this._initPopup(e,n)},_initPopup:function(e,i){i.autoOrgButtonHandler(),this._clearElementSelector(e),this._updateElementSelector(e.seekWidgetByName("btn_set_element_0"),!1),this._addEventElementSelector(e),this._addEventExtraOption(e,"btn_with_weapon"),this._addEventExtraOption(e,"btn_with_summon"),n.setTouchEventHandlers(e,{"TOUCH_ENDED blue_btn":function(){t.isUndefined(i.doneEventName)||n.createInstance("notificationCenter").dispatchEvent(i.doneEventName,["character",e])}.bind(this),"TOUCH_ENDED black_btn":function(){n.createInstance("notificationCenter").removeEventListenersByEventName(i.doneEventName),e.dismiss()}.bind(this)},this)},_updateElementSelector:function(e,t){e.setEnabled(t),e.setBright(t)},_clearElementSelector:function(e){t.each(t.range(7),function(t){this._updateElementSelector(e.seekWidgetByName("btn_set_element_"+t),!0)},this)},_addEventElementSelector:function(e){t.each(t.range(7),function(t){e.seekWidgetByName("btn_set_element_"+t).addTouchEventListener(function(t,n){n===i.Widget.TOUCH_ENDED&&(this._clearElementSelector(e),this._updateElementSelector(t,!1))},this)},this)},_addEventExtraOption:function(e,t){e.seekWidgetByName(t).addTouchEventListener(function(e,t){t===i.Widget.TOUCH_ENDED&&e.setBright(!e.bright)},this)}})}((this||0).self||global),function(e){var t=e._,n=e.kh,i=e.cc,a=e.ccui;n.PopupFactoryComWeaponSummonAutoOrg=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-p_autoorg",title:"",buttonLabels:{blackBtn:"",blueBtn:""},buttonSounds:{blueBtn:n.SoundList.BUTTON_TOUCHED_CONFIRMED},buttons:{blackBtn:function(e){},blueBtn:function(e){}}},POPUP_METHODS:{},onPopupOpened:function(e,n){this._target=n.target,console.log(n),t.isUndefined(this._initializedPopup)&&this._initPopup(e,n)},_initPopup:function(e,a){a.autoOrgButtonHandler(),e.setTitle(n.w(this._target)+"");var o=i.director.getRunningScene();t.isFunction(o._showPopupAutoOrgDescription)&&o._showPopupAutoOrgDescription(e),this._clearElementSelector(e),this._updateElementSelector(e.seekWidgetByName("btn_set_element_0"),!1),this._addEventElementSelector(e),n.setTouchEventHandlers(e,{"TOUCH_ENDED blue_btn":function(){t.isUndefined(a.doneEventName)||(n.createInstance("notificationCenter").dispatchEvent(a.doneEventName,[this._target,e]),e.dismiss())}.bind(this),"TOUCH_ENDED black_btn":function(){n.createInstance("notificationCenter").removeEventListenersByEventName(a.doneEventName),e.dismiss()}.bind(this)},this)},_updateElementSelector:function(e,t){e.setEnabled(t),e.setBright(t)},_clearElementSelector:function(e){t.each(t.range(7),function(t){this._updateElementSelector(e.seekWidgetByName("btn_set_element_"+t),!0)},this)},_addEventElementSelector:function(e){t.each(t.range(7),function(t){e.seekWidgetByName("btn_set_element_"+t).addTouchEventListener(function(t,n){n===a.Widget.TOUCH_ENDED&&(this._clearElementSelector(e),this._updateElementSelector(t,!1))},this)},this)},_addEventExtraOption:function(e,t){e.seekWidgetByName(t).addTouchEventListener(function(e,t){t===a.Widget.TOUCH_ENDED&&e.setBright(!e.bright)},this)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc.popup=t.pc.popup||{},t.pc.popup.roles=t.pc.popup.roles||{},t.pc.popup.roles.PopupCharacterCommon={_loadACharacter:function(e,n){return this._isOwn=!!i.isUndefined(n)||n,t.createInstance("apiACharacters").get(e).then(function(e){return this._character=e.body,this._loadCompleteACharacter=!0,this._setCharaRarityBar(e.body),this._fillupACharacterStatus().thenResolve(e.body)}.bind(this)).fail(function(e){console.error(e)})},_setCharaRarityBar:function(e){var t=n.director.getRunningScene();if(!i.isUndefined(e.rare)&&null!==t.seekWidgetByName("chara_raritybar_ui")){var a=e.rare;if(!i.contains(["N","R","SR","SSR"],a))return void console.error("Invalid rarity type: "+a);var o="rarity_"+a;e.is_aroused&&(o+="_arousal");var r=t.seekWidgetByName("chara_raritybar_ui");r.animate(o);var s=r.seekWidgetByName("title_label"),c=r.seekWidgetByName("plus_no");s.setText(e.name),c.setText(0<e.bonus?"+"+e.bonus:"")}},_fillupACharacterStatus:function(e){return i.isUndefined(this._loadCompleteACharacter)||!1===this._loadCompleteACharacter?void console.error("You should call _loadACharacter method first."):(this._setStatusBonusRecord(e),this._setStatusBurstAbilityAssist(),a.resolve())},_setStatusBonusRecord:function(e){i.isUndefined(e)&&(e="introduce_popup_chara_status_ui");var t=n.director.getRunningScene().seekWidgetByName(e);if(null!==t){this._setCharacterCoreCard(t,this._character,"corecard_chara_ui"),this._setElementIcon(t,this._character),this._setStatustypeIcon(t,this._character),this._setExpGauge(t,this._character),this._setCardStrings(t,this._character);var a=t.bfsWidgetByName("mainparts_star_gauge_ui");this._setStarGauge(a,this._character)}else console.debug("Could not find "+e+".")},_setStatusBurstAbilityAssist:function(){var e=n.director.getRunningScene().seekWidgetByName("introduce_popup_statuslist_list_7_ui");this._clearAbilityList();var t=0;t+=this._appendBurst(e,this._character),t+=this._appendAbility(e,this._character,t),t+=this._appendAssist(e,this._character,t)},_clearAbilityList:function(){var e=n.director.getRunningScene();i(i.range(0,7)).map(function(t){return e.seekWidgetByName("statuslist_ui_"+t)}).filter(function(e){return e}).invoke("removeAllChildren").value()}},i.assign(t.pc.popup.roles.PopupCharacterCommon,t.pc.roles.CoreCardCommon,t.pc.roles.UIUtility,t.pc.roles.ImagesCommon,t.pc.roles.IconsCommon,t.pc.roles.StringsCommon,t.pc.roles.GaugesCommon,t.pc.status.roles.BurstCommon,t.pc.status.roles.AbilityCommon,t.pc.status.roles.AssistCommon,t.pc.roles.AllOverUI)}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);e.Q,t.pc.party=t.pc.party||{},t.pc.party.roles=t.pc.roles||{},t.pc.party.roles.Routing={_navigateToPrf001:function(){t.createInstance("router").navigate("profile/prf_001a",{prf_001:{id:"me",type:"own"},tab:"status"})},_navigateToPickAcce:function(e,t){e._sceneNavigate.toPartyPickAcce(t).navigate()},_navigateToPickMember:function(e,t){e._sceneNavigate.toPartyPickMember(t).navigate()},_verifyRouterParams004:function(e){},_navigate004To006:function(e,t){return n.isUndefined(t)||n.isUndefined(t.a_job_id)?void this._consoleErrorRoutingAbort("record.a_job_id"):void e._sceneNavigate.toParty006(t.a_job_id).navigate()},_navigate004ToEnergyRelease:function(e,t){e._sceneNavigate.toEnergyRelease(t.a_job_id,t).navigate()},_verifyRouterParams005:function(e){n.isUndefined(e.routerParams.party_id)},_verifyRouterParams006:function(e){},_navigate007To008:function(e,t){return n.isUndefined(t)||n.isUndefined(t.job_id)?void this._consoleErrorRoutingAbort("record.a_job_id"):void e._sceneNavigate.toParty008(t.job_id).navigate()},_verifyRouterParams008:function(e){n.isUndefined(e.routerParams.par_008)&&(e.routerParams.par_008={},e.routerParams.par_008.id=1,this._consoleErrorRouterParams("routerParams.par_008, .id"))},_verifyRouterParams009:function(e){n.isUndefined(e.routerParams.party_id)&&(e.routerParams.party_id=1,this._consoleErrorRouterParams("routerParams.party_id")),n.isUndefined(e.routerParams.par_009)&&(e.routerParams.par_009={},e.routerParams.par_009.number=1,this._consoleErrorRouterParams("routerParams.par_009, .number"))},_navigate009ToDetail:function(e,i,a){if(n.isUndefined(e.routerParams.par_009))this._consoleErrorRoutingAbort("routerParams.par_009");else if(n.isUndefined(e.routerParams.par_009.number))this._consoleErrorRoutingAbort("routerParams.par_009.number");else if(n.isUndefined(i)||n.isUndefined(i.a_character_id))this._consoleErrorRoutingAbort("record.a_character_id");else{var o=e.routerParams.par_009,r=e.routerParams.party_id;t.createInstance("router").navigate("detail/de_001",{de_001_002:{id:i.a_character_id,isOwn:!0,fromPartyPage:!0,equipedSelf:a,partyId:r,number:o.number}},{navigateFrom:{routes:"party/par_009",routerParams:{party_id:r,par_009:{number:o.number,id:i.a_character_id}}}})}},_verifyRouterParams010:function(e){n.isUndefined(e.routerParams.party_id)&&(e.routerParams.party_id=1,this._consoleErrorRouterParams("routerParams.party_id")),n.isUndefined(e.routerParams.par_010)&&(e.routerParams.par_010={},e.routerParams.par_010.id=1,e.routerParams.par_010.number=2,this._consoleErrorRouterParams("routerParams.par_010, .id, .number"))},_move010To001:function(e){if(n.isUndefined(e.routerParams.par_010))this._consoleErrorRoutingAbort("routerParams.par_010");else if(n.isUndefined(e.routerParams.par_010.id)||n.isUndefined(e.routerParams.par_010.number))this._consoleErrorRoutingAbort("routerParams.par_010.id | .number");else{var i=e.routerParams.par_010;t.createInstance("apiAParties").changeCharacter(e.routerParams.party_id,i.number,i.id).then(function(t){e._sceneNavigate.toMemberInTop({par_001:{number:t.body.set_num,id:i.id}}).navigate()}.bind(this)).fail(function(e){console.error(e)})}},_verifyRouterParams011:function(e){n.isUndefined(e.routerParams.party_id)&&(e.routerParams.party_id=1,this._consoleErrorRouterParams("routerParams.party_id")),n.isUndefined(e.routerParams.par_011)&&(e.routerParams.par_011={},e.routerParams.par_011.id=1,e.routerParams.par_011.number=2,this._consoleErrorRouterParams("routerParams.par_011, .id, .number"))},_move011To001:function(e){if(n.isUndefined(e.routerParams.par_011))this._consoleErrorRoutingAbort("routerParams.par_011");else if(n.isUndefined(e.routerParams.par_011.id)||n.isUndefined(e.routerParams.par_011.number))this._consoleErrorRoutingAbort("routerParams.par_011.id | .number");else{var i=e.routerParams.par_011;t.createInstance("apiAParties").changeCharacter(e.routerParams.party_id,i.number,null).then(function(t){e._sceneNavigate.toMemberInTop()}.bind(this)).fail(function(e){console.error(e)})}},_move011To009:function(e){if(n.isUndefined(e.routerParams.par_011))this._consoleErrorRoutingAbort("routerParams.par_011");else if(n.isUndefined(e.routerParams.par_011.id)||n.isUndefined(e.routerParams.par_011.number))this._consoleErrorRoutingAbort("routerParams.par_011.id | .number");else{var t=e.routerParams.par_011;e._sceneNavigate.toParty009(t.number).navigate()}},_verifyRouterParams012:function(e){n.isUndefined(e.routerParams.party_id)&&(e.routerParams.party_id=1,this._consoleErrorRouterParams("routerParams.party_id")),n.isUndefined(e.routerParams.par_012)&&(e.routerParams.par_012={},e.routerParams.par_012.id=1,e.routerParams.par_012.number=2,this._consoleErrorRouterParams("routerParams.par_012, .id, .number"))},_move012To002:function(e){if(n.isUndefined(e.routerParams.par_012))this._consoleErrorRoutingAbort("routerParams.par_012");else if(n.isUndefined(e.routerParams.par_012.id)||n.isUndefined(e.routerParams.par_012.number))this._consoleErrorRoutingAbort("routerParams.par_012.id | .number");else{var i=e.routerParams.par_012;t.createInstance("apiAParties").changeWeapon(e.routerParams.party_id,i.number,null).then(function(t){e._sceneNavigate.toWeaponInTop()}.bind(this)).fail(function(e){console.error(e)})}},_move012To013:function(e){if(n.isUndefined(e.routerParams.par_012))this._consoleErrorRoutingAbort("routerParams.par_012");else if(n.isUndefined(e.routerParams.par_012.id)||n.isUndefined(e.routerParams.par_012.number))this._consoleErrorRoutingAbort("routerParams.par_012.id | .number");else{var t=e.routerParams.par_012;e._sceneNavigate.toParty013(t.number).navigate()}},_verifyRouterParams013:function(e){n.isUndefined(e.routerParams.party_id)&&(e.routerParams.party_id=1,this._consoleErrorRouterParams("routerParams.party_id")),n.isUndefined(e.routerParams.par_013)&&(e.routerParams.par_013={},e.routerParams.par_013.number=1,this._consoleErrorRouterParams("routerParams.par_013, .number"))},_navigate013ToDetail:function(e,i,a){if(n.isUndefined(e.routerParams.par_013))this._consoleErrorRoutingAbort("routerParams.par_013");else if(n.isUndefined(e.routerParams.par_013.number))this._consoleErrorRoutingAbort("routerParams.par_013.number");else if(n.isUndefined(i)||n.isUndefined(i.a_weapon_id))this._consoleErrorRoutingAbort("record.a_weapon_id");else{var o=e.routerParams.par_013,r=e.routerParams.party_id;t.createInstance("router").navigate("detail/de_003",{de_003:{id:i.a_weapon_id,isOwn:!0,fromPartyPage:!0,equipedSelf:a,partyId:r,number:o.number}},{navigateFrom:{routes:"party/par_013",routerParams:{party_id:r,par_013:{number:o.number,id:i.a_weapon_id}}}})}},_verifyRouterParams014:function(e){n.isUndefined(e.routerParams.party_id)&&(e.routerParams.party_id=1,this._consoleErrorRouterParams("routerParams.party_id")),n.isUndefined(e.routerParams.par_014)&&(e.routerParams.par_014={},e.routerParams.par_014.id=1,e.routerParams.par_014.number=2,this._consoleErrorRouterParams("routerParams.par_014, .id, .number"))},_move014To002:function(e){if(n.isUndefined(e.routerParams.par_014))this._consoleErrorRoutingAbort("routerParams.par_014");else if(n.isUndefined(e.routerParams.par_014.id)||n.isUndefined(e.routerParams.par_014.number))this._consoleErrorRoutingAbort("routerParams.par_014.id | .number");else{var i=e.routerParams.par_014;t.createInstance("apiAParties").changeWeapon(e.routerParams.party_id,i.number,i.id).then(function(n){t.createInstance("router").navigate("party/par_002",{tab:"weapons",party_id:e.routerParams.party_id,par_before:{before_hp:n.body.pre_hp,before_attack:n.body.pre_attk}},{par_002:{newnumber:n.body.set_num}}).navigate()}.bind(this)).fail(function(e){console.error(e)})}},_verifyRouterParams015:function(e){n.isUndefined(e.routerParams.party_id)&&(e.routerParams.party_id=1,this._consoleErrorRouterParams("routerParams.party_id")),n.isUndefined(e.routerParams.par_015)&&(e.routerParams.par_015={},e.routerParams.par_015.number=1,this._consoleErrorRouterParams("routerParams.par_015, .number"))},_navigate015ToDetail:function(e,i,a){if(n.isUndefined(e.routerParams.par_015))this._consoleErrorRoutingAbort("routerParams.par_015");else if(n.isUndefined(e.routerParams.par_015.number))this._consoleErrorRoutingAbort("routerParams.par_015.number");else if(n.isUndefined(i)||n.isUndefined(i.a_summon_id))this._consoleErrorRoutingAbort("record.a_summon_id");else{var o=e.routerParams.par_015,r=e.routerParams.party_id;t.createInstance("router").navigate("detail/de_004",{de_004:{id:i.a_summon_id,isOwn:!0,fromPartyPage:!0,equipedSelf:a,partyId:r,number:o.number}},{navigateFrom:{routes:"party/par_015",routerParams:{party_id:r,par_015:{number:o.number,id:i.a_summon_id}}}})}},_verifyRouterParams016:function(e){n.isUndefined(e.routerParams.party_id)&&(e.routerParams.party_id=1,this._consoleErrorRouterParams("routerParams.party_id")),n.isUndefined(e.routerParams.par_016)&&(e.routerParams.par_016={},e.routerParams.par_016.id=1,e.routerParams.par_016.number=2,this._consoleErrorRouterParams("routerParams.par_016, .id, .number"))},_move016To003:function(e){if(n.isUndefined(e.routerParams.par_016))this._consoleErrorRoutingAbort("routerParams.par_016");else if(n.isUndefined(e.routerParams.par_016.id)||n.isUndefined(e.routerParams.par_016.number))this._consoleErrorRoutingAbort("routerParams.par_016.id | .number");else{var i=e.routerParams.par_016;t.createInstance("apiAParties").changeSummon(e.routerParams.party_id,i.number,null).then(function(t){e._sceneNavigate.toSummonInTop().navigate()}.bind(this)).fail(function(e){console.error(e)})}},_move016To015:function(e){if(n.isUndefined(e.routerParams.par_016))this._consoleErrorRoutingAbort("routerParams.par_016");else if(n.isUndefined(e.routerParams.par_016.id)||n.isUndefined(e.routerParams.par_016.number))this._consoleErrorRoutingAbort("routerParams.par_016.id | .number");else{var t=e.routerParams.par_016;e._sceneNavigate.toParty015(t.number).navigate()}},_verifyRouterParams017:function(e){n.isUndefined(e.routerParams.party_id)&&(e.routerParams.party_id=1,this._consoleErrorRouterParams("routerParams.party_id")),n.isUndefined(e.routerParams.par_017)&&(e.routerParams.par_017={},e.routerParams.par_017.id=1,e.routerParams.par_017.number=2,this._consoleErrorRouterParams("routerParams.par_017, .id, .number"))},_move017To003:function(e){if(n.isUndefined(e.routerParams.par_017))this._consoleErrorRoutingAbort("routerParams.par_017");else if(n.isUndefined(e.routerParams.par_017.id)||n.isUndefined(e.routerParams.par_017.number))this._consoleErrorRoutingAbort("routerParams.par_017.id | .number");else{var i=e.routerParams.par_017;t.createInstance("apiAParties").changeSummon(e.routerParams.party_id,i.number,i.id).then(function(e){t.createInstance("router").navigate("party/par_003",{tab:"summons",par_before:{before_hp:e.body.pre_hp,before_attack:e.body.pre_attk}},{par_003:{newnumber:e.body.set_num}})}.bind(this)).fail(function(e){console.error(e)})}},_navigateTo001:function(e,t,n){var i=null;t&&(i={par_001:{number:n.body.set_num,id:t}}),e._sceneNavigate.toMemberInTop(i).navigate()},_navigateTo002:function(e,n){var i={tab:"weapons"},a=null;e&&(i.par_before={before_hp:n.body.pre_hp,before_attack:n.body.pre_attk},a={par_002:{newnumber:n.body.set_num}}),t.createInstance("router").navigate("party/par_002",i,a)},_navigateTo003:function(e,n){var i={tab:"summons"},a=null;e&&(i.par_before={before_hp:n.body.pre_hp,before_attack:n.body.pre_attk},a={par_003:{newnumber:n.body.set_num}}),t.createInstance("router").navigate("party/par_003",i,a)},_navigateToParty004:function(e,t){e._sceneNavigate.toParty004(t).navigate()},_navigateToMy001:function(){t.createInstance("router").navigate("mypage/my_001")},_navigateToQ002:function(){t.createInstance("router").navigate("quest/q_002")},_navigateToParty001_2_3:function(e){t.createInstance("router").navigate("party",{tab:e})},_navigateToParty007:function(e,t){switch(t){default:case"basic":e._sceneNavigate.toParty007("c").navigate();break;case"upper":e._sceneNavigate.toParty007("b").navigate();break;case"uppermost":e._sceneNavigate.toParty007("a").navigate();break;case"highjob":e._sceneNavigate.toParty007("s").navigate()}}},n.assign(t.pc.party.roles.Routing,t.pc.roles.RoutingCommon)}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._),i=e.Q;t.pc.party=t.pc.party||{},t.pc.party.roles=t.pc.party.roles||{},t.pc.party.roles.ExAbilityPageListController={_fillupExAbilityList:function(e,a){var o=e.seekWidgetByName("introduce_statuslist_list_7_ui");return null!==o&&o.removeFromParent(),(n.isUndefined(e.routerParams.party_id)?t.createInstance("myselfInfoRepository").getMe().then(function(t){return e.routerParams.party_id=t.body.selected_party.a_party_id,i.resolve(t.body.selected_party.a_party_id)},function(e){console.error(e)}):i.resolve(e.routerParams.party_id)).then(function(e){return t.createInstance("apiAParties").getExAbilitiesByParty(e)}).then(function(t){if(!e.disposed)return e.initSceneUILoadPromise.thenResolve(t)}).then(function(n){var i={targetNode:"ex_ability_list_base",touchEventFuncName:a};return this._fillupList(e,{viewParent:t.PageListParams.EX_ABILITY_LIST.viewParent,subPageRes:t.PageListParams.EX_ABILITY_LIST.subPageRes,panelsPerPage:t.PageListParams.EX_ABILITY_LIST.perPage},n.body.data,n.body.max_record_count,i,this._initExAbilityWidget.bind(this)),n.body}.bind(this)).fail(function(e){console.error(e)})},_initExAbilityWidget:function(e,n,i){var a=e.seekWidgetByName("ex_ability_list_base");if(null==a){var o=ccs.load(res["core-statuslist-statuslist_ex-ability_ui"]).node;e.children[0].addChild(o),a=o.seekWidgetByName("ex_ability_list_base")}a.setSoundEnabled(!0),a.setSound(t.SoundList.BUTTON_TOUCHED_DECIDE),this._setExAbilityPanelStrings(e,n),this._setExAbilityIsSet(e,n),this._setExAbilityIcon(e,n)}},n.assign(t.pc.party.roles.ExAbilityPageListController,t.pc.list.roles.PageListControllerCommon,t.pc.status.roles.AbilityCommon)}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);e.Q,t.pc.party=t.pc.party||{},t.pc.party.roles=t.pc.party.roles||{},t.pc.party.roles.JobPageListController={_fillupJobList:function(e,i,a,o,r){var s=e.seekWidgetByName(a),c={targetNode:"joblist_job",touchEventFuncName:i},u=o?"_initAccquiredJobWidget":"_initUnaccquiredJobWidget";this._fillupList(s,{viewParent:t.PageListParams.JOB_LIST.viewParent,subPageRes:t.PageListParams.JOB_LIST.subPageRes,panelsPerPage:t.PageListParams.JOB_LIST.perPage},r,r.length,c,this[u].bind(this)),r.length>0||(n.isFunction(this._showNothingLabel)?this._showNothingLabel(s):console.warn("[ERROR] You should assign UIUtility role."))},_initAccquiredJobWidget:function(e,i,a){var o=i.skin||0,r=t.Img("joblist","job",n.padZero(i.job_id,4),o).png;if(e.seekWidgetByName("joblist_job").loadTextures(r,r,r),i.mex_level===i.level)e.seekWidgetByName("master_icon").setVisible(!0);else{var s=e.seekWidgetByName("level_no");s.setVisible(!0),s.setString("lv"+i.level)}this._currentJobId===i.a_job_id&&(e.seekWidgetByName("current_job_icon").setVisible(!0),this._currentJobWidget=e,this._currentJob=i)},_initUnaccquiredJobWidget:function(e,i,a){var o=i.skin||0,r=t.Img("joblist","job",n.padZero(i.job_id,4),o).png;e.seekWidgetByName("joblist_job").loadTextures(r,r,r),i.is_acquirable&&"highjob"!==i.rank?(e.seekWidgetByName("can_learn_icon").setVisible(!0),this._setGrayOutButton(e,!0)):(this._setGrayOutButton(e,!1),e.seekWidgetByName("can_learn_icon").setVisible(!1))}},n.assign(t.pc.party.roles.JobPageListController,t.pc.list.roles.PageListControllerCommon,t.pc.roles.UIUtility)}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;t.createNameSpaceIfNotExists("party.view"),t.party.view.StatusWindowInPartyList=n.Class.extend({className:"StatusWindowInPartyList",_statusWindowNode:null,_coreCardNode:null,_coreCardUI:null,_onCardInitExtension:null,_onStatusWindowInitExtension:null,UI_NODE_NAMES:{NAME_LABEL:"name_label",LEVEL_LABEL:"level_label",FILTER_IN_CORECARD:"filter",STATUS_PANEL_BASE:"status_base",HP_NODE:"hp_no",ATTACK_NODE:"attack_no",EXP_BASE:"status_base",EXP_GAUGE_NODE:"exp-gauge",EXP_NEXT_LABEL:"exp_next_label",BTN_DETAIL:"btn_detail",SKILL_BASE_PREFIX:"skill_base_"},ctor:function(e,n,i,a,o){this._statusWindowNode=e.seekWidgetByName("status_window"),this._coreCardNode=this._statusWindowNode.seekWidgetByPath(n),this._coreCardUI=t.createInstance(i,["full",this._coreCardNode]),this._onCardInitExtension=a,this._onStatusWindowInitExtension=o},update:function(e,t){return i.isEmpty(e)?void this.clear():(this._setStatusPanel(e),this._setExpBase(e),this._setHeader(e),this._setCoreCard(e,t),this._setVisibleBtn(e),this._hideAllWeaponSkillBase(),void(i.isFunction(this._onStatusWindowInitExtension)&&this._onStatusWindowInitExtension(this._statusWindowNode,e)))},_setHeader:function(e){var t=this._statusWindowNode;t.seekWidgetByName(this.UI_NODE_NAMES.NAME_LABEL).setString(e.name||""),t.seekWidgetByName(this.UI_NODE_NAMES.LEVEL_LABEL).setString(e.level?"Lv "+e.level:"")},_setCoreCard:function(e,t){var n=this._coreCardUI;i.isUndefined(n.setAroused)||n.setAroused(e.is_aroused||!1),n.setPlusNo(0<e.bonus?"+"+e.bonus:""),n.setIconElement(e.element_type),n.setIconRarity(e.rare),n.setStarGauge(20*e.max_overlimit_count,20*e.overlimit_count),this.setTotalLabel(e,t),i.isFunction(this._onCardInitExtension)&&this._onCardInitExtension(n,e);var a=this._coreCardNode,o=a.seekWidgetByName(this.UI_NODE_NAMES.FILTER_IN_CORECARD);o&&o.setVisible(!0),a.setVisible(!0)},setTotalLabel:function(e,t){var n=this._coreCardUI;n.setTotalLabel(n.getTotalLabel(e,t))},_setStatusPanel:function(e){var t=this._statusWindowNode.seekWidgetByName(this.UI_NODE_NAMES.STATUS_PANEL_BASE);t.seekWidgetByName(this.UI_NODE_NAMES.HP_NODE).setString(e.hp),t.seekWidgetByName(this.UI_NODE_NAMES.ATTACK_NODE).setString(e.attack),t.setVisible(!0)},_setExpBase:function(e){var t=this._statusWindowNode.seekWidgetByName(this.UI_NODE_NAMES.EXP_BASE);if("number"==typeof e.next_exp&&"number"==typeof e.exp){var n=e.level===e.max_level,i=n?100:e.exp/(e.next_exp+e.exp)*100;t.seekWidgetByName(this.UI_NODE_NAMES.EXP_GAUGE_NODE).percent=i;var a=t.seekWidgetByName(this.UI_NODE_NAMES.EXP_NEXT_LABEL);a.setString("NEXT:"+e.next_exp),a.setVisible(!n),t.setVisible(!0)}else t.setVisible(!1)},_setVisibleBtn:function(e){var n=!1;e&&(n=!0);var i=this._statusWindowNode.getChildByName(this.UI_NODE_NAMES.BTN_DETAIL);i&&t.pc.roles.UIUtility._setEnableButton(i,n)},_hideAllWeaponSkillBase:function(){for(var e=0;;){var t=this._statusWindowNode.seekWidgetByName(this.UI_NODE_NAMES.SKILL_BASE_PREFIX+e);if(!t)break;t.setVisible(!1),e++}},clear:function(){this._setHeader({}),this._statusWindowNode.seekWidgetByName(this.UI_NODE_NAMES.STATUS_PANEL_BASE).setVisible(!1),this._setVisibleBtn(null),this._coreCardUI&&this._coreCardUI.setVisible(!1)},clean:function(){this._statusWindowNode=null,this._coreCardNode=null,this._coreCardUI=null,this._onCardInitExtension=null,this._onStatusWindowInitExtension=null}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e._,t.createNameSpaceIfNotExists("party.view"),t.party.view.ActionButton=n.Class.extend({className:"ActionButton",_scene:null,ctor:function(e){this._scene=e},update:function(e,n,i){var a=!1;e&&(a=!0);var o=this._scene.seekWidgetByName("btn_remove_party"),r=this._scene.seekWidgetByName("btn_organize");r.setVisible(!n),o.setVisible(n),t.pc.roles.UIUtility._setEnableButton(r,a),t.pc.roles.UIUtility._setEnableButton(o,!i)},clear:function(){this.update(null)},clean:function(){this._scene=null}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("party.eventHandling"),t.party.eventHandling.StatusWindowUpdateEventHandler=n.Class.extend({className:"StatusWindowUpdateEventHandler",_controller:null,_statusWindowView:null,_initializeModel:null,ctor:function(e,t,n){this._controller=e,this._statusWindowView=t,this._initializeModel=n},handle:function(e,t,n){if(this._controller.isOnly()){var i=this._controller.getSelectedData()[0],a=i&&i.getRawData()||{};this._statusWindowView.update(a,n)}else this._statusWindowView.update(this._initializeModel.getRawData(),n)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.createNameSpaceIfNotExists("party.controller"),t.party.controller.PartyListAbstract=n.Class.extend({className:"PartyListControllerAbstract",_scene:null,_defaultRecord:null,_statusWindowView:null,_actionButtonView:null,_defaultRecordId:null,_controller:null,ctor:function(e,n){this._scene=e,this._actionButtonView||(this._actionButtonView=new t.party.view.ActionButton(e)),this._sortCondition=this._sortCondition||this._defaultSortCondition,this._initSelectedRecord(n)},_initSelectedRecord:function(e){i.isEmpty(e)||(this._defaultRecord=e,this._defaultRecordId=this._getRecordId(e))},getSelectedRecord:function(){if(this._controller){var e=this._controller.getSelectedData()[0];return e&&e.getRawData()||{}}return i.extend({},this._defaultRecord)},setPageList:function(){var e=this.setting,n=t.core.pager.helper.coreCardListUI(this._scene,e),o=new(e.apiModel||t.core.pager.model.PlainData)(this._defaultRecord),r=new t.party.eventHandling.StatusWindowUpdateEventHandler(n,this._statusWindowView,o);return n.addUpdateEventListener(r.handle,r),n.addSelectEventHandler(this._updateActionView,this),e.setHeaderLabelFunction&&e.setHeaderLabelFunction.call(this),n.initialize().then(function(){if(!i.isEmpty(this._defaultRecord))return n.isOnly()?void n.toggleSelect(o):void this._updateActionView(o)}.bind(this)).fail(this._outputError),this._controller=n,a.resolve(n)},_updateActionView:function(e,t){var n=e.getRawData(),i=this._isDefaultRecord(n),a=this._canNotRemove(n);this._actionButtonView.update(n,i,a)},_outputError:function(e){console.error(e.stack)},_getRecordId:function(e){return e.a_character_id||e.a_weapon_id||e.a_summon_id},_isDefaultRecord:function(e){return!!i.isNumber(this._defaultRecordId)&&this._getRecordId(e)===this._defaultRecordId},_canNotRemove:function(e){return i.isEmpty(e)},clean:function(){this._scene=null,this.setting=null,this._statusWindowView.clean(),this._statusWindowView=null,this._actionButtonView.clean(),this._actionButtonView=null,this._controller&&this._controller.dispose(),this._controller=null,t.createInstance("notificationCenter").removeEventListenersByEventName("pulldown_sort_config")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;e.Q,t.createNameSpaceIfNotExists("party.controller"),t.party.controller.Par009CharacterList=t.party.controller.PartyListAbstract.extend({className:"Par009CharacterListController",ctor:function(e,n){this.setting={setHeaderLabelFunction:this._setCharacterHeaderLabel,baseName:"window_gray",panelName:t.BtnsPageListParams.CHARACTER_LIST.panelName,apiName:"apiAParties",apiMethod:"getSelectableCharactersByParty",apiParams:[e.routerParams.party_id,e.routerParams.par_009.number,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE],apiModel:t.core.model.ACharacter,cardType:"chara",cardFrame:"full",sortArgs:{sortKey:"selectable_characters",sortValue:"attack_desc",sortButton:"btn_sort",sortLabel:"sort_label",sortMenuBase:"sortlist",sortChoice:"core-pages-sort_list_0_ui",changeEventName:"pulldown_sort_config"},maxSelectCount:1,canDeselect:!1},this._statusWindowView=new t.party.view.StatusWindowInPartyList(e,"corecard_chara_ui","CoreCardCharacterUI",this._setCoreCardInStatusWindow),this._super.apply(this,arguments)},setPageList:function(){this._super.apply(this,arguments);var e=this._scene,n=t.createInstance("router").getCurrentSceneName();(e.routerParams.party||e.routerParams[n]||{}).from_tower&&this._controller.addUpdateEventListener(function(e,t,n,i,a){e.getChildren().forEach(this._setTowerQuestFilter.bind(this,a,t))}.bind(this,e.seekWidgetByName(this.setting.panelName)))},_setTowerQuestFilter:function(e,t,n,i){var a=n.getUserData(),o=t[i];if(!o)return a.setAlreadyEntryLabel(null),void this._setGrayOutForTowerEvent(a,!1);var r=o.getRawData().cannot_tower_enter;return r?(this._setGrayOutForTowerEvent(a,r),void a.setAlreadyEntryLabel(o.getRawData().cannot_tower_enter_endat+"\n\n")):(a.setAlreadyEntryLabel(null),this._setGrayOutForTowerEvent(a,r),void a.setGrayout(e.getSelectNumber(o)>0))},_setCoreCardInStatusWindow:function(e,t){var n=t.aroused_character_id>-1?t.aroused_character_id:t.character_id;i.isUndefined(t.appearance)||(n=t.appearance.used_character_id||n),e.setImg(n,0),e.setIconOrganized(t.is_equipped),e.setBattleType(t.character_type)},_setGrayOutForTowerEvent:function(e,t){var n=e.getResult().seekWidgets(function(e){return"already_entry_label"!==e.getName()&&"selecting_frame"!==e.getName()&&"selected_label"!==e.getName()&&"btn_detail"!==e.getName()&&0===e.getChildren().length}),i="#FFFFFF";t&&(i="#808080"),this._applySetColorForTowerEvent(n,i)},_applySetColorForTowerEvent:function(e,t){i.each(e,function(e){e.setColor(n.color(t))})}}),i.assign(t.party.controller.Par009CharacterList.prototype,t.pc.list.roles.ListCharactersCommon)}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);e.Q,t.createNameSpaceIfNotExists("party.controller"),t.party.controller.Par013WeaponList=t.party.controller.PartyListAbstract.extend({className:"Par013WeaponListController",ctor:function(e,n){this.setting={setHeaderLabelFunction:this._setWeaponHeaderLabel,baseName:"window_gray",panelName:t.BtnsPageListParams.WEAPON_LIST.panelName,apiName:"apiAParties",apiMethod:"getSelectableWeaponsByParty",apiParams:[e.routerParams.party_id,e.routerParams.par_013.number,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE],apiModel:t.core.model.AWeapon,cardType:"weapon",cardFrame:"full",sortArgs:{sortKey:"selectable_weapons",sortValue:"attack_desc",sortButton:"btn_sort",sortLabel:"sort_label",sortMenuBase:"sortlist",sortChoice:"core-pages-sort_list_0_ui",changeEventName:"pulldown_sort_config"},maxSelectCount:1,canDeselect:!1},this._statusWindowView=new t.party.view.StatusWindowInPartyList(e,"corecard_weapon_ui","CoreCardWeaponUI",this._setCoreCardInStatusWindow,this._setWeaponSkillBase),this._super.apply(this,arguments)},_getRecordId:function(e){return e.a_weapon_id},_setCoreCardInStatusWindow:function(e,t){e.setImg(t.weapon_id,t.skin||0),e.setIconEquipped(t.is_equipped),e.setIconProtected(t.is_locked)}}),n.assign(t.party.controller.Par013WeaponList.prototype,t.pc.party.roles.Routing,t.pc.list.roles.ListWeaponsCommon,t.pc.status.roles.WeaponSkillCommon)}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e._,e.Q,t.createNameSpaceIfNotExists("party.controller"),t.party.controller.Par015SummonList=t.party.controller.PartyListAbstract.extend({className:"Par015SummonListController",ctor:function(e,n){this.setting={setHeaderLabelFunction:this._setSummonHeaderLabel,baseName:"window_gray",panelName:t.BtnsPageListParams.SUMMON_LIST.panelName,apiName:"apiAParties",apiMethod:"getSelectableSummonsByParty",apiParams:[e.routerParams.party_id,e.routerParams.par_015.number,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE],apiModel:t.core.model.ASummon,cardType:"summon",cardFrame:"full",sortArgs:{sortKey:"selectable_summons",sortValue:"attack_desc",sortButton:"btn_sort",sortLabel:"sort_label",sortMenuBase:"sortlist",sortChoice:"core-pages-sort_list_0_ui",changeEventName:"pulldown_sort_config"},maxSelectCount:1,canDeselect:!1},this._statusWindowView=new t.party.view.StatusWindowInPartyList(e,"corecard_summon_ui","CoreCardSummonUI",this._setCoreCardInStatusWindow),this._super.apply(this,arguments)},_getRecordId:function(e){return e.a_summon_id},_canNotRemove:function(e){var t=n.director.getRunningScene().routerParams.par_015.number,i=this._isDefaultRecord(e);return 0===t&&i},_setCoreCardInStatusWindow:function(e,t){e.setImg(t.summon_id,t.skin||0),e.setIconEquipped(t.is_equipped),e.setIconProtected(t.is_locked)}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.party=n.party||{},n.party.view=n.party.view||{},n.party.view.JobParameterChangePopup=n.ImplantedPopup.extend({_initContents:function(e,t){this.getNode().setAppearance(e.getJobs().length>=4?"four":"three"),this._setJobs(e,t.a_job_id),this._setBaseJobName(t.name);var n=e.canApply();this._setLabels(n),this._setEnableButton(this.getNode().seekWidgetByName("btn_execute"),n)},_setLabels:function(e){var t=this.getNode(),n=t.seekWidgetByName("explain_label"),i=t.seekWidgetByName("attention_label");n.setVisible(e),i.setVisible(!e)},_setJobs:function(e,i){var a=e.getJobs();t.each(["class_c","class_b","class_a","class_s"],function(t,i){var o=a[i];if(o){var r=this.getNode().bfsWidgetByName(t),s=r.seekWidgetByName("corecard_job_ui"),c=n.createInstance("CoreCardJobUI",["plain",s]);c.setImg(o.jobId,0),e.equalParameterJobId(o.jobId)&&this.updateSelectJobFrame(e,o),c.addTouchEventListener(function(t,n){n===ccui.Widget.TOUCH_ENDED&&this.updateSelectJobFrame(e,o)},this),r.seekWidgetByName("label_name").setString(o.name);var u=r.seekWidgetByName("label_level");u.setString("Lv : "+o.level),o.isAcquired||u.setString("")}}.bind(this))},updateSelectJobFrame:function(e,n){var i=e.getJobs();e.updateSelectJob(n),t.each(["class_c","class_b","class_a","class_s"],function(e,t){var a=i[t];a&&this.getNode().bfsWidgetByName(e).seekWidgetByName("selecting_frame").setVisible(n.aJobId===a.aJobId)}.bind(this))},_setBaseJobName:function(e){this.getNode().seekWidgetByName("job_name_label").setString(e)}}),n.assignRoles(n.party.view.JobParameterChangePopup,[n.pc.roles.UIUtility,n.pc.roles.CoreCardCommon])}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.party=t.party||{},t.party.view=t.party.view||{},t.party.view.JobParameterChangeHintPopup=t.ImplantedPopup.extend({_parentNodeName:"par_energy_change_help",_dismissAnimationName:"par_energy_change",_closeAnimationEndHandler:function(){this._uiNode.setVisible(!0)}})}((this||0).self||global),function(e){var t=e._,n=e.kh,i=e.ccui;n.party.view.ComPartyAutoOrgPopup=n.ImplantedPopup.extend({_initContents:function(e){if(t.isUndefined(this._initializedPopup)){var i=this.getNode();this._initCheckBox(i),this._clearElementSelector(i),this._updateElementSelector(i.seekWidgetByName("btn_set_element_0"),!1),this._addEventElementSelector(i),this._addEventExtraOption(i,"btn_checkbox_include_weapon"),this._addEventExtraOption(i,"btn_checkbox_include_summon"),this._addBtnGrayOutEventListener(i,"btn_checkbox_ssr"),this._addBtnGrayOutEventListener(i,"btn_checkbox_sr"),this._addBtnGrayOutEventListener(i,"btn_checkbox_r");var a={btn_organize:function(){n.createInstance("notificationCenter").dispatchEvent("popupAutoOrgAll",["character",i]),this.dismiss()}.bind(this),btn_cancel:function(){n.createInstance("notificationCenter").removeEventListenersByEventName("popupAutoOrgAll"),this.dismiss()}.bind(this),btn_hint:this._openHintPopup.bind(this,e)};this.setButtonEvents(a)}},_initCheckBox:function(e){e.seekWidgetByName("btn_checkbox_include_weapon").setBright(!0),e.seekWidgetByName("btn_checkbox_include_summon").setBright(!0),e.seekWidgetByName("btn_checkbox_ssr").setBright(!1),e.seekWidgetByName("btn_checkbox_sr").setBright(!1),e.seekWidgetByName("btn_checkbox_r").setBright(!1);var t=e.seekWidgetByName("btn_organize");t.setEnabled(!0),n.pc.roles.UIUtility._setGrayOutButton(t,!0)},_updateElementSelector:function(e,t){e.setEnabled(t),e.setBright(t)},_clearElementSelector:function(e){t.each(t.range(7),function(t){this._updateElementSelector(e.seekWidgetByName("btn_set_element_"+t),!0)},this)},_addEventElementSelector:function(e){t.each(t.range(7),function(t){e.seekWidgetByName("btn_set_element_"+t).addTouchEventListener(function(t,n){n===i.Widget.TOUCH_ENDED&&(this._clearElementSelector(e),this._updateElementSelector(t,!1))},this)},this)},_addEventExtraOption:function(e,t){e.seekWidgetByName(t).addTouchEventListener(function(e,t){t===i.Widget.TOUCH_ENDED&&e.setBright(!e.bright)},this)},_addBtnGrayOutEventListener:function(e,t){e.seekWidgetByName(t).addTouchEventListener(function(t,n){n===i.Widget.TOUCH_ENDED&&t.setBright(!t.bright);var a=this._getCheckedRarities(e);this._setBtnAutoOrgEnable(e,a)},this)},_getCheckedRarities:function(e){var t=[];return e.seekWidgetByName("btn_checkbox_ssr").bright||t.push("ssrare"),e.seekWidgetByName("btn_checkbox_sr").bright||t.push("srare"),e.seekWidgetByName("btn_checkbox_r").bright||t.push("rare"),t},_setBtnAutoOrgEnable:function(e,t){var i=e.seekWidgetByName("btn_organize"),a=!1;t.length>0&&(a=!0),i.setEnabled(a),n.pc.roles.UIUtility._setGrayOutButton(i,a)},_openHintPopup:function(e){var t=e;t.open().then(function(){t.setTitle("");var e='<div style="text-align: left;"><br /><br /><br />'+n.w("chara")+","+n.w("weapon")+","+n.w("summon")+"<br /><br />"+n.w("weapon")+""+n.w("weapon")+"<br />"+n.w("weapon")+"</div>";t.setContent(e),t.seekWidgetByName("popup_base").height=354,t.seekWidgetByName("title_label").y=280,t.seekWidgetByName("popup_labelimg").y=214}).fail(function(e){console.error(e)})}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.party=n.party||{},n.party.model=n.party.model||{},n.party.model.AJobParameter=cc.Class.extend({_canApply:!1,_jobs:[],_selectedJob:null,_parameterJobId:null,ctor:function(e,t){this.updateAJobParameter(e,t)},updateAJobParameter:function(e,n){this._canApply=e.can_apply,this._parameterJobId=n,this._jobs=t.map(e.jobs,function(e){return{aJobId:e.a_job_id,jobId:e.job_id,name:e.name,level:e.level,isAcquired:e.is_acquired}})},canApply:function(){return this._canApply},getJobs:function(){return this._jobs},getSelectJob:function(){return this._selectedJob},equalParameterJobId:function(e){return this._parameterJobId===e},updateParameterJobId:function(){this._parameterJobId=this._selectedJob.jobId},updateSelectJob:function(e){this._selectedJob=e}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.party=n.party||{},n.party.view=n.party.view||{},n.party.view.ChangePartyPopup=n.ImplantedPopup.extend({_parentNodeName:"p_party_change",_aParties:null,_defaultAPartyIndex:null,_showAPartyIndex:null,_scene:null,_from_tower:null,_pageView:null,_initContents:function(e,t){this._aParties=t,this._scene=e;var i=this._scene.routerParams[n.createInstance("router").getCurrentSceneName()];this._from_tower=(this._scene.routerParams.party||i||{}).from_tower,this._initAParties().then(function(){this.setButtonEvents({btn_cancel:!1,btn_ok:this._changeSelectedParty.bind(this)});var e=this.getNode().bfsWidgetByName("btn_cancel");e.setSoundEnabled(!0),e.setSound(n.SoundList.BUTTON_TOUCHED_CANCEL)}.bind(this)).fail(function(e){console.error(e)})},_isLoadedAParties:function(){return!t.isNull(this._aParties)},_selectedPartyIsLast:function(){return this._showAPartyIndex+1===this._aParties.length},_selectedPartyIsFirst:function(){return 0===this._showAPartyIndex},_selectedPartyIsDefault:function(){return this._showAPartyIndex===this._defaultAPartyIndex},_getShowParty:function(){return this._aParties[this._showAPartyIndex]},_initAParties:function(){return Q.defer(),this._defaultAPartyIndex=t.findIndex(this._aParties,function(e){return e.selected}),this._initAPartiesView(),this._setAPartiesIconBtn(),Q.resolve()},_setTitle:function(e){this._getNodeByName("title_label").setString("["+e+"/"+this._aParties.length+"]")},_setAPartiesIconBtn:function(){t.each(this._aParties,function(e,t){var i="touch_panel_btn_"+(t+1),a=this._getNodeByName(i),o=this._getNodeByName("btn_"+(t+1));a.addTouchEventListener(function(e,i){n.pressButtonEmulate(e,o,i),i===ccui.Widget.TOUCH_ENDED&&this._goToPageByIndex(t)},this)}.bind(this))},_setAPartiesIconView:function(e){t.each(this._aParties,function(t,n){var i=n===e;this._getNodeByName("select_light_"+(n+1)).setVisible(i)}.bind(this))},_initAPartiesView:function(){var e=this.getNode(),i=e.seekWidgetByName("page_panel"),a=this.__initPageUiNodes(i,$staticRes(res["core-popup_layer-party_change_page_ui"]),3),o=t.map(this._aParties,function(e,t){var i=new n.core.pager.view.page.ScrollPageLayer(a[t%3],this._setAPartyView.bind(this));return i.setName("party_change_page_ui-"+t),i},this);i.removeAllChildren(),this._pageView=new n.PageView,this._pageView.initialize(o,this.__updateSelectedPartyUi,this),this._pageView.setLoopContent(!0),this._pageView.setDirection(ccui.ScrollView.DIR_HORIZONTAL),i.addChild(this._pageView);var r=[];r[n.PAGE_CONTROLLER_CONTROLS.NEXT_BUTTON]="btn_page_next",r[n.PAGE_CONTROLLER_CONTROLS.PREVIOUS_BUTTON]="btn_page_back",(new n.PageController).init(e,r,this._pageView),this._pageView.addOnPageChangeCallback(function(e,t,i,a){n.pc.roles.UIUtility._setEnableButton(e,!this._selectedPartyIsDefault())}.bind(this,this.getNode().bfsWidgetByName("btn_ok"))),this._aParties.forEach(function(e,t){this._setAPartyIconColor(e.job.element_type,e.is_equipped_main_weapon,t)}.bind(this)),this._pageView.addOnPageChangeCallback(function(e,t,n,i){for(var a=t-1,o=0;o<3;o++){var r=a+o;r<1&&(r=n.length),r>n.length&&(r=1),n[r-1].setRecords(this.record,r-1)}},{record:this._aParties}),this._goToPageByIndex(this._defaultAPartyIndex)},__updateSelectedPartyUi:function(e,t){this._showAPartyIndex=t-1,this._setAPartiesIconView(this._showAPartyIndex),this._setTitle(t);var n=this._getShowParty();this._setAPartyMainSummonView(this.getNode(),n.leader_summon)},__initPageUiNodes:function(e,i,a){var o=e;return e.getChildren()[0]instanceof n.ScrollViewAbstract&&(o=e.getChildren()[0]),t.map(t.range(0,a),function(e){var t=o.getChildren()[e];if(!t||0===t.getChildren().length||t.getContentSize().width<=0){var a=ccs.load(i).node;return a.setAnchorPoint(-.1,0),a}return t instanceof n.core.pager.view.page.ScrollPageLayer?t.getPageNode():t})},_goToPageByIndex:function(e){t.isNull(this._pageView)||this._pageView.gotoPageByIndex(e)},_setAPartyView:function(e,t,n){return this._setAPartyJobView(e,t.job),this._setAPartyCharactersView(e,t.characters),this._setAPartyIconColor(t.job.element_type,t.is_equipped_main_weapon,n),e},_setAPartyIconColor:function(e,i,a){var o="btn_"+(a+1),r=this._getNodeByName(o),s=t.findKey(n.ELEMENT_TYPE,function(t){return t===e});"PHANTOM"===s&&(s="illusion"),!1===i&&(s="nothing");var c="core/res/popup/popup_layer/party_change_btn_"+s.toLowerCase()+".png";r.loadTextureNormal(c,ccui.Widget.PLIST_TEXTURE),r.loadTexturePressed(c,ccui.Widget.PLIST_TEXTURE)},_setAPartyJobView:function(e,t){this._setJobCoreCard(e,t,"corecard_job_ui")},_setAPartyMainSummonView:function(e,t){var n=this._setSummonCoreCardElementRarity(e,t,"corecard_summon_ui");n.setPlusNoVisible(!0),n.setPlusNo(0<t.bonus?"+"+t.bonus:""),e.setStrings({summon_name_level:"Lv"+t.level+" "+t.name,summon_attack:t.attack_description,summon_support:t.effect_description})},_setAPartyCharactersView:function(e,n){t.each(n,function(t,n){this._setAPartyCharacterView(e,t,n)}.bind(this))},_setAPartyCharacterView:function(e,n,i){var a="corecard_chara_ui_"+i;if(t.isEmpty(n))e.bfsWidgetByName(a).setVisible(!1);else{var o=this._setCharacterCoreCardElementRarity(e,n,a);o.setPlusNoVisible(!0),o.setPlusNo(0<n.bonus?"+"+n.bonus:""),this._setAPartyCharacterEventFilter(e,a,n,i)}},_setAPartyCharacterEventFilter:function(e,t,i,a){if(this._from_tower){var o=e.seekWidgetByName(t),r=o.seekWidgetByName("already_entry_label"),s=o.seekWidgetByName("corecard_chara_ui_"+a);return i.cannot_tower_enter?void this._filterCoreCardNodeForTowerEvent(i,r,s,!0):(this._filterCoreCardNodeForTowerEvent(i,r,s,!1),void n.pc.roles.UIUtility._setGrayOutButton(s,!0))}},_filterCoreCardNodeForTowerEvent:function(e,n,i,a){var o=i.getChildren().filter(function(e){return"already_entry_label"!==e.getName()&&"selecting_frame"!==e.getName()&&"selected_label"!==e.getName()&&"btn_detail"!==e.getName()&&0===e.getChildren().length});t.each(o,function(e){e.setColor(a?cc.color("#808080"):cc.color("#FFFFFF"))}),n.setVisible(a),a&&(n.setString(e.cannot_tower_enter_endat+"\n\n"),n.setZOrder(10))},_changeSelectedParty:function(){if(!this._selectedPartyIsDefault()){var e=this._getShowParty();return n.createInstance("apiAParties").changeDeck(e.a_party_id).then(function(e){return e.body.result}.bind(this)).then(function(){this.dismiss(!0),t.isUndefined(this._scene.routerParams.party)||(this._scene.routerParams.party.party_id=e.a_party_id,this._updatePartyIdInForRouterParams(this._scene))}.bind(this)).fail(function(e){console.error(e)})}},_updatePartyIdInForRouterParams:function(e){var i=n.createInstance("router"),a=i.getCurrentFragment(),o=t.clone(e.routerParams);o.party.party_id=e.routerParams.party.party_id,i.historyReplace(a,o)}}),n.assignRoles(n.party.view.ChangePartyPopup,[n.pc.roles.UIUtility,n.pc.roles.CoreCardCommon])}((this||0).self||global);__extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();!function(e){var t,n;!function(e){e.MEMBER="members",e.WEAPON="weapons",e.SUMMON="summons"}(t||(t={})),function(e){e.S="S",e.A="A",e.B="B",e.C="C"}(n||(n={})),e.JOB_CLASS=n;var i=function(e){function n(t,n,i,a,o){var r=e.call(this,"party/"+t,i,a,!0)||this;return r._sceneClassName="PartyNavigate",r._partyId=n,r._returnQuestParams=o,r._deckInUse=!0===(i&&i.deck_in_use),r}return __extends(n,e),n.makeFromHistory=function(e){return new n(e._fragment.split("/")[1],e._partyId,e._routerParams,e._temporaryRouterParams,e._returnQuestParams)},n.prototype.canHistory=function(){return!0},n.prototype.getRouterParams=function(){return _.merge(e.prototype.getRouterParams.call(this),{party:{from_tower:this.isFromTower},deck_in_use:this._deckInUse,party_id:this._partyId})},Object.defineProperty(n.prototype,"party_id",{get:function(){return this._partyId},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isFromQuest",{get:function(){return!(!this._returnQuestParams||!this._returnQuestParams.returnQuestRoute)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isFromTower",{get:function(){return!!this._returnQuestParams&&this._returnQuestParams.isFromTower},enumerable:!0,configurable:!0}),n.prototype.changeParty=function(e){this._partyId=e},n.makeFromLegacyNavigate=function(e){return e instanceof n?(n._lastPartyNavigate=e,e):(n._lastPartyNavigate=this._makePartyNavigate(e),n._lastPartyNavigate)},n._makePartyNavigate=function(e){var t,i=e.getSceneName(),a=e.getRouterParams(),o=e.getTemporaryRouterParams();return void 0!==n._lastPartyNavigate?n._lastPartyNavigate._toNavigate(i,a,o):a.party?(t={returnQuestRoute:a.party.returnQuestRoute,isFromTower:a.party.from_tower,selectedElementType:e.getTemporaryRouterParams().selected_element_type,returnRouterParams:a.party.returnRouterParams},new n(i,a.party.party_id,a,o,t)):new n(i,0,a,o)},n.makeTo001Member=function(e,i,a,o,r){void 0===e&&(e=!1);var s={tab:t.MEMBER};return"number"==typeof a&&a>0&&(s.party={party_id:a}),i&&void 0!==r&&void 0!==o?new n("par_001",a||0,s,{},{returnQuestRoute:i,isFromTower:e,selectedElementType:o,returnRouterParams:r}):new n("",a||0,s).toMemberInTop()},n.makeTo001Weapon=function(e,t){return void 0===e&&(e={}),void 0===t&&(t={}),new n("",0,e,t).toWeaponInTop()},n.makeTo001Summon=function(e,t){return void 0===e&&(e={}),void 0===t&&(t={}),new n("",0,e,t).toSummonInTop()},n.makeTo008=function(e,t,i){return new n("par_008",e,{},i).toParty008(t)},n.prototype.toMemberInTop=function(e){return this._toTop("par_001",t.MEMBER,e)},n.prototype.toWeaponInTop=function(){return this._toTop("par_002",t.WEAPON)},n.prototype.toSummonInTop=function(){return this._toTop("par_003",t.SUMMON)},n.prototype._toTop=function(e,t,i){return new n(e,this._partyId,Object.assign({tab:t},this.getRouterParams()),Object.assign({},this.getTemporaryRouterParams(),i),this._returnQuestParams)},n.prototype.toParty004=function(e,t){return this._toNavigate("par_004",{par_004:{id:e},deck_in_use:t})},n.prototype.toParty005=function(e){return this._toNavigate("par_005",{},{a_job_id:e})},n.prototype.toParty006=function(e){return this._toNavigate("par_006",{par_006_007:{id:e}})},n.prototype.toParty007=function(e){return this._toNavigate("par_007_"+e.toLocaleLowerCase())},n.prototype.toParty008=function(e){return this._toNavigate("par_008",{par_006_007:this.getRouterParams().par_006_007,par_008:{id:e},party_id:this._partyId},this.getTemporaryRouterParams())},n.prototype.toParty009=function(e){return this._toNavigate("par_009",{par_009:{number:e},party_id:this._partyId})},n.prototype.toParty013=function(e){return this._toNavigate("par_013",{par_013:{number:e},party_id:this._partyId})},n.prototype.toParty015=function(e){return this._toNavigate("par_015",{par_015:{number:e},party_id:this._partyId})},n.prototype.toPartyPickMember=function(){return this._toNavigate("par_pick_member_acce",{par_pick_member_acce:{mode:kh.pc.party.par_pick_member_acce.MODE.MEMBER,a_party_id:this._partyId}})},n.prototype.toPartyPickAcce=function(e){return this._toNavigate("par_pick_member_acce",{par_pick_member_acce:{mode:kh.pc.party.par_pick_member_acce.MODE.ACCE,a_party_id:this._partyId}},{par_pick_member_acce:{deck:e}})},n.prototype.toEnergyRelease=function(e,t){return this._toNavigate("par_energy_release",{par_energy_release:{id:e}},{par_energy_release:{job_id:t.job_id,name:t.name,rank:t.rank}})},n.prototype._toNavigate=function(e,t,i){return void 0===t&&(t={}),void 0===i&&(i={}),new n(e,this._partyId,t,i,this._returnQuestParams)},n.prototype.toBackOutside=function(){if(void 0===this._returnQuestParams)return new KHRouter.MyPageRedirect;var e={};return e[this._returnQuestParams.returnQuestRoute.split("/")[1]]={selected_element_type:this._returnQuestParams.selectedElementType},new KHRouter.LegacyNavigate(this._returnQuestParams.returnQuestRoute,this._returnQuestParams.returnRouterParams,e)},n.prototype.navigate=function(){e.prototype.navigate.call(this),n._lastPartyNavigate=this},n}(KHRouter.LegacyNavigate);e.PartyNavigate=i}(kh.router||(kh.router={})),function(e){var t=e.kh,n=(e.khutil,e.cc,e.ccui,e._);e.console,t.createNameSpaceIfNotExists("party.model"),t.party.model.APartyRemnant=t.core.pager.model.PlainData.extend({className:"APartyRemnant",getAId:function(){return null},getMasterId:function(){return null},getRawData:function(){return{}},getGroupId:function(){return null},getHp:function(){return null},getAttackPoint:function(){return null},equal:function(e){return!n.isUndefined(e)&&this.__instanceId===e.__instanceId}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.party=n.party||{},n.party.model=n.party.model||{},n.party.model.APartyDeck=cc.Class.extend({_aPartyId:null,_aCharacterList:null,ctor:function(e,i){if(this._aPartyId=e,t.isArray(i.characters)){var a=i.characters.map(function(e){return t.isEmpty(e)?new n.party.model.APartyRemnant:new n.core.model.ACharacter(e)});this._aCharacterList=new n.party.model.OrganizationDataList(a)}},prepare:function(){return n.createInstance("apiAParties").getDeck(this._aPartyId).then(function(e){return this.ctor(e.body.a_party_id,e.body.deck),this}.bind(this))},getAId:function(){return this._aPartyId},getACharacterList:function(){return this._aCharacterList},assignACharacters:function(){return this._aCharacterList.getAllContent().then(function(e){var i=t.sortBy(e,function(e){return e.getMasterId()?0:1}).map(function(e,t){return{pos:t,character_id:e.getMasterId()}});return n.createInstance("apiAParties").assignCharacters(this._aPartyId,i)}.bind(this))}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.party=t.party||{},t.party.model=t.party.model||{},t.party.model.AJobs=t.core.pager.model.PlainDataList.extend({ctor:function(e){this._data=e},getList:function(e,t){return this._data.filter(function(n){return n.is_acquired===e&&n.rank===t})},existsRank:function(e){return this._data.filter(function(t){return t.rank===e}).length>0}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.party=t.party||{},t.party.model=t.party.model||{},t.party.model.AJobsRepository={get:function(){return t.createInstance("apiAJobs").getList().then(function(e){return new t.party.model.AJobs(e.body.data)})}}}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.party=t.party||{},t.party.view=t.party.view||{},t.party.view.SupportSummonInfoPopup=t.ImplantedPopup.extend({_parentNodeName:"p_support_summon_config_description",_initContents:function(){this.setButtonEvents({btn_cancel:!1,btn_setting:!0})}})}((this||0).self||global),function(e){var t=e.kh;e.cc,e._,t.createNameSpaceIfNotExists("core.characterStatusPopup"),t.core.characterStatusPopup.BookRequestRankPopup=t.ImplantedPopup.extend({_initContents:function(){this.setButtonEvents({btn_ok:!0})},_dismissAnimationName:"com_character_status",_closeAnimationEndHandler:function(){this._uiNode.setVisible(!0)}}),t.dictx.registerWithProtoStrategy("BookRequestRankPopup",t.core.characterStatusPopup.BookRequestRankPopup)}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;t.createNameSpaceIfNotExists("core.characterStatusPopup"),t.core.characterStatusPopup.ComCharacterStatusPopup=t.ImplantedPopup.extend({TAB_BUTTON_NAMES:["tab_status","tab_ability","tab_acce"],TAB_NAMES:["tab_0_node","tab_1_node","tab_2_node"],modeParam:null,_equipAccessory:null,_isChangedAccessory:null,MODE:{MEMBER:0,ACCE:1},open:function(e,t,n){return this.modeParam=t,this._equipAccessory=n,Q.all([this._loadACharacter(e,this._isOwn),this._loadAccessories(e).then(this._initializeAcceTab.bind(this))]).then(this._super.bind(this,e,t))},_initContents:function(e,n){var a={btn_close:!0,tab_status:this._tabChange.bind(this,0),btn_to_detail:this._btnToDetail.bind(this,e),tab_ability:this._tabChange.bind(this,1),tab_acce:this._tabChange.bind(this,2),tab_blue:this._toggleAcceTab.bind(this,!0),tab_green:this._toggleAcceTab.bind(this,!1),btn_confirm:this._openAcceInfoPopup.bind(this),btn_disabled:this._touchBtnDisabled.bind(this),btn_hint:this._openHintPopup.bind(this)};return this.setButtonEvents(a),this._toggleAcceTab(!0),this._isChangedAccessory=!1,this.getNode().getParent().bfsWidgetByName("filter_black_com_character_status").setTouchEnabled(!0),t.env.isSp||i.range(7).forEach(function(e){this._getNodeByName("statuslist_ui_"+e).setScale(1.25)},this),this.modeParam===this.MODE.MEMBER?void this._tabChange(1):this.modeParam===this.MODE.ACCE?void this._tabChange(2):void this._tabChange(0)},_openHintPopup:function(){var e=n.director.getRunningScene();t.ImplantedPopup.createOrGet(e,"acce_series_hint_on_com_character_status","AcceSeriesHintPopup").open(!0)},_initializeAcceTab:function(){var e=t.createInstance("accessoryInfoModel");e.prepare().then(function(){var i=!e.canBeUsed(),a=this.getNode().seekWidgetByName("btn_disabled");null!==a&&(a.setVisible(i),a.setEnabled(i),i&&a.addTouchEventListener(function(e,i){if(i===ccui.Widget.TOUCH_ENDED){var a=n.director.getRunningScene();t.ImplantedPopup.createOrGet(a,"book_request_rank_on_com_character_status","BookRequestRankPopup").open()}},this))}.bind(this))},_isAcceEquipMode:function(){return this.modeParam===t.pc.party.par_pick_member_acce.MODE.ACCE&&null!=this._equipAccessory},_loadAccessories:function(e){this._khCharacterAccessoriesModel=t.createInstance("characterAccessoriesModel");var i=n.director.getRunningScene();return this._khCharacterAccessoriesModel.prepare(e).then(function(){this._updateAcceView(i)}.bind(this)).fail(function(e){console.error(e.stack)})},_toggleAcceTab:function(e){var t=this._getNodeByName("introduce_popup_acce_status_ui",this.getNode());t.seekWidgetByName("tab_blue_node").setVisible(e),t.seekWidgetByName("tab_green_node").setVisible(!e),t.seekWidgetByName("tab_blue").setBright(!e),t.seekWidgetByName("tab_blue").setTouchEnabled(!e),t.seekWidgetByName("tab_green").setBright(e),t.seekWidgetByName("tab_green").setTouchEnabled(e)},_updateAcceView:function(e){var t=this._getNodeByName("introduce_popup_acce_status_ui",e),n=this._getUiNodes(t);n.hp.setText(this._khCharacterAccessoriesModel.getHp()),n.attack.setText(this._khCharacterAccessoriesModel.getAttack()),n.total_accessory_hp.setVisible(!0),n.total_accessory_hp.setText("+"+this._khCharacterAccessoriesModel.getTotalAccessoryHp()),n.total_accessory_attack.setVisible(!0),n.total_accessory_attack.setText("+"+this._khCharacterAccessoriesModel.getTotalAccessoryAttack()),this.__setSeriesEffect(n,this._khCharacterAccessoriesModel);var a=this._khCharacterAccessoriesModel.getAccessorySlotCount();i.each(i.range(0,a),function(t){this._setAccessorySlot(e,t)}.bind(this))},__setSeriesEffect:function(e,t){return t.hasSeriesEffect()?(e.series_name.setText(t.getSeriesEffectName()),void e.series_effect.setText(t.getSeriesEffectDescription())):(e.series_name.setText(""),void e.series_effect.setText(""))},_setAccessorySlot:function(e,t){var n="introduce_acce_status_card_ui_"+t,i=this._getNodeByName(n);if(this._getNodeByName("touch_panel",i).setTouchEnabled(!1),this._khCharacterAccessoriesModel.isAccessorySlotLocked(t))return this._setLockSlot(e,i,t),void i.seekWidgetByName("selecting_frame").setVisible(!1);var a=this._isAcceEquipMode();return i.seekWidgetByName("selecting_frame").setVisible(a),this._khCharacterAccessoriesModel.isAccessorySlotEmpty(t)?void this._setEmptySlot(e,i,t):void this._setEquipedSlot(e,i,t)},_setLockSlot:function(e,t,n){this._setInvisibleNotEquippedMark(t),this._setAppearanceProtectedViewToNode(t,n),this._isOwn&&this._setTouchEvent(t,e,n)},_setEquipedSlot:function(e,t,n){this._setInvisibleNotEquippedMark(t),this._setAppearanceCoraCardViewToNode(t);var i=this._khCharacterAccessoriesModel.getAccessoryByIndex(n);this._setAccessoryCoreCardFull(t,i,"corecard_acce_ui"),this._setTouchEvent(t,e,n)},_setEmptySlot:function(e,t,n){var i=this._isAcceEquipMode();this._setInvisibleNotEquippedMark(t,i),this._setAppearanceEquipViewToNode(t),this._isOwn&&this._setTouchEvent(t,e,n)},_setInvisibleNotEquippedMark:function(e,t){this._getNodeByName("equip",e).setVisible(!0===t)},_setAppearanceProtectedViewToNode:function(e,t){var n={3:"protected_0_view",4:"protected_1_view"};if(i.isUndefined(n[t]))console.error("SceneDelegate._setAccessorySlot(): lock animation for slot number "+t+" not found.");else{var a=n[t];e.setAppearance(a)}},_setAppearanceCoraCardViewToNode:function(e){e.setAppearance("corecard_view")},_setAppearanceEquipViewToNode:function(e){e.setAppearance("equip_view")},_setTouchEvent:function(e,n,i){var a=this._getNodeByName("touch_panel",e);a.setVisible(!0),a.setEnabled(!0),a.setSoundEnabled(!0),a.setSound(t.SoundList.BUTTON_TOUCHED_DEFAULT),a.setTouchEnabled(!0),a.addTouchEventListener(function(e,t){t===ccui.Widget.TOUCH_ENDED&&this._changeAccessory(n,i)}.bind(this))},_changeAccessory:function(e,t){if(!this._khCharacterAccessoriesModel.isAccessorySlotLocked(t))return this._isAcceEquipMode()?void this._khCharacterAccessoriesModel.changeAccessoryByIndex(t,this._equipAccessory.getAAccessoryId()).then(function(){this._isChangedAccessory=t,this._dfd.resolve([t,this._equipAccessory]),this.dismiss(!0)}.bind(this)):void(this._khCharacterAccessoriesModel.isAccessorySlotEmpty(t)||this._openAcceDetailPopup(e,t))},dismiss:function(){i.isNumber(this._isChangedAccessory)&&this._dfd.resolve([this._isChangedAccessory]),this._super.apply(this,arguments)},_btnToDetail:function(e){t.createInstance("router").navigate("detail/de_001",{de_001_002:{id:e,isOwn:this._isOwn,fromPartyPage:!1,equipedSelf:!1}},{navigateFrom:{routes:"book/book_001_character"}})},_tabChange:function(e){var t=this.getNode().seekWidgetByName("tab_"+e+"_node"),n=this.getNode().seekWidgetByName(this.TAB_BUTTON_NAMES[e]);this.TAB_NAMES.forEach(function(e){this.getNode().seekWidgetByName(e).setVisible(!1)},this),this.TAB_BUTTON_NAMES.forEach(function(e){this.getNode().seekWidgetByName(e).setBright(!0)},this),t.setVisible(!0),n.setBright(!1)},_openAcceDetailPopup:function(e,n){var a=i.extend({equipped_character:{slot_num:n}},{equipped_character:this._character},this._khCharacterAccessoriesModel.getAccessoryByIndex(n)),o="AcceDetailSwapPopup";return this._isOwn||(o="AcceOthersDetailPopup"),t.ImplantedPopup.createOrGet(e,"acce_detail_protection_on_off",o).open(a,this._khCharacterAccessoriesModel,n,!0).then(function(t){i.isNumber(t)&&(this._setAccessorySlot(e,t),this._isChangedAccessory=t)}.bind(this))},_openAcceInfoPopup:function(){var e=n.director.getRunningScene();return t.ImplantedPopup.createOrGet(e,"acce_info_on_com_character_status","AcceInfoPopup").open(this._khCharacterAccessoriesModel,!0)},_touchBtnDisabled:function(){},_getUiNodes:function(e){return i.mapValues({name:"name_label",bonus:"plus_no",rarity_icon:"rarity_icon",rarity_bar:"name_base",hp:"hp_no",attack:"attack_no",total_accessory_hp:"hp_plus_no",total_accessory_attack:"attack_plus_no",series_name:"series_name_label",series_effect:"series_effect_label"},function(t,n){return this._getNodeByName(t,e)}.bind(this))},_getNodeByName:function(e,t){i.isUndefined(t)&&(t=n.director.getRunningScene());var a=t.seekWidgetByName(e);return a||console.warn("SceneDelegate._getNodeByName(): node '"+e+"' not found"),a}}),t.assignRoles(t.core.characterStatusPopup.ComCharacterStatusPopup,[t.pc.roles.UIUtility,t.pc.roles.CoreCardCommon,t.pc.popup.roles.PopupCharacterCommon]),t.dictx.registerWithProtoStrategy("ComCharacterStatusPopup",t.core.characterStatusPopup.ComCharacterStatusPopup)}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.createNameSpaceIfNotExists("core.view"),t.core.view.HintCommonPopup=t.ImplantedPopup.extend({_initContents:function(){var e={};this.getNode().seekWidgets(function(e){return 0===(""+e.name).indexOf("btn_")}).forEach(function(t){e[t.name]=!0}),this.setButtonEvents(e)}})}((this||0).self||global),function(e){var t=e.kh;e.cc,e._,t.createNameSpaceIfNotExists("party.view"),t.party.view.ParEnergyBonusPopup=t.ImplantedPopup.extend({_initContents:function(){var e={};this.getNode().seekWidgets(function(e){return 0===(""+e.name).indexOf("btn_")}).forEach(function(t){e[t.name]=!0}),this.setButtonEvents(e)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e._,t.createNameSpaceIfNotExists("party.view"),t.party.view.ParExchangeMpPopup=t.ImplantedPopup.extend({_currentRateInfo:null,_selectType:null,_selectValues:null,_initContents:function(e){if(e){this._aHeroMasterPointModel=e;var n={btn_cancel:!1,btn_exchange:!0,tab_job_point:this._callbackTab.bind(this),tab_purgatory_job_point:this._callbackTab.bind(this)};this.setButtonEvents(n),this._selectionUIController=new t.party.controller.MpExchangeAmountSelectionUIController(this.getNode()),this._tabJobPointNode=this.getNode().seekWidgetByName("tab_job_point"),this._tabPurgatoryJobPointNode=this.getNode().seekWidgetByName("tab_purgatory_job_point"),this._btnExchangeNode=this.getNode().seekWidgetByName("btn_exchange"),this._selectValues={},this._callbackTab("tab_job_point")}},dismiss:function(e){e&&this._dfd.resolve({model:this._aHeroMasterPointModel,type:this._selectType,selectedAmount:this._selectionUIController.getSelectedAmount()}),this._super.apply(this,arguments)},_callbackTab:function(e,i){var a=this._aHeroMasterPointModel,o=e;e instanceof n.Node&&(o=e.getName());var r=o.substr(4),s=a.getRateInfo(r);this._currentRateInfo=s,t.createInstance("CoreCardItemUI",[null,this.getNode().seekWidgetByName("corecard_item_ui")]).setImg(s.getItemId()),this.getNode().setStrings({name_label:s.getName()+" x "+s.getRate(),job_point_label_before:s.getHasPoint()}),this._setBright(this._tabJobPointNode,o),this._setBright(this._tabPurgatoryJobPointNode,o),this._selectType&&(this._selectValues[this._selectType]=this._selectionUIController.getSelectedAmount());var c=this._selectValues[r]||0;this._selectionUIController.updateRateInfo(s,c),this._selectType=r;var u=s.calculateExchangeAmountSelectionLimit(c)>0;t.pc.roles.UIUtility._setEnableButton(this._btnExchangeNode,u)},_setBright:function(e,t){var n=e.getName()!==t;e.setBright(n),e.setTouchEnabled(n)}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);t.createNameSpaceIfNotExists("party.view"),t.party.view.ParExchangeMpConfirmPopup=t.ImplantedPopup.extend({CANCEL:1,_currentSelectInfo:null,MP_LABELIMG_TEMPLATE:'<div class="white text_common" style=\'margin-top: 18px\'><div>MP<%= beforeMP %><span class="yellow"> <%= afterMP %></span></div></div>',_initContents:function(e){var i=e.model,a=e.type,o=e.selectedAmount,r=i.getRateInfo(a);t.createInstance("CoreCardItemUI",[null,this.getNode().seekWidgetByName("corecard_item_ui")]).setImg(r.getItemId());this.setButtonEvents({btn_cancel:!1,btn_exchange:!0}),this.getNode().setStrings({name_label:r.getName(),job_point_label_before:r.getHasPoint().toString(),job_point_label_after:r.calculateAfterAmount(o).toString()});var s=this.calculateExchangeMasterPoint(i,r,o);this.getNode().setHtmlStrings({mp_labelimg:n.template(this.MP_LABELIMG_TEMPLATE)({beforeMP:i.getHasMasterPoint(),afterMP:s})},t.GameConfig.POPUP_CSS),this._currentSelectInfo=e},calculateExchangeMasterPoint:function(e,t,n){return e.getHasMasterPoint()+t.calculateExchangeMasterPoint(n)},dismiss:function(e){return e?(this._dfd.resolve(this._currentSelectInfo),this._super.apply(this,arguments),void(this._currentSelectInfo=null)):void this._dfd.reject(this.CANCEL)}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.party=t.party||{},t.party.model=t.party.model||{},t.party.model.MpExchangeRate=cc.Class.extend({ctor:function(e){this._itemId=e.item_id,this._name=e.name,this._rate=e.rate,this._hasPoint=e.has_point,this._amount=e.amount},getItemId:function(){return this._itemId},getName:function(){return this._name},getRate:function(){return this._rate},getHasPoint:function(){return this._hasPoint},calculateExchangeAmountSelectionLimit:function(e){return Math.min(e||0,this._calculateLimitAmount())},hasReachedAmountSelectionLimit:function(e){return this._calculateLimitAmount()<=e},calculateCostPoint:function(e){return(e=this.calculateExchangeAmountSelectionLimit(e))*this._rate},calculateAfterAmount:function(e){return this.getHasPoint()-this.calculateCostPoint(e)},_calculateLimitAmount:function(){return Math.floor(this.getHasPoint()/this.getRate())},calculateExchangeMasterPoint:function(e){return e*this._amount}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.party=t.party||{},t.party.model=t.party.model||{},t.party.model.AHeroMasterPoint=cc.Class.extend({_hasMasterPoint:0,_rateInformation:null,ctor:function(e){for(var n in this._hasMasterPoint=e.hero_master_point,this._rateInformation={},e)"object"==typeof e[n]&&(this._rateInformation[n]=new t.party.model.MpExchangeRate(e[n]))},getHasMasterPoint:function(){return this._hasMasterPoint},getRateInfo:function(e){return this._rateInformation[e]}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=e.ccui,o=e._,r=e.console;t.createNameSpaceIfNotExists("party.controller"),t.party.controller.MpExchangeAmountSelectionUIController=i.Class.extend({className:"MpExchangeAmountSelectionUIController",SELECTED_AMOUNT_DISPLAY_NAME:"poll_number_label",AFTER_AMOUNT_LABEL:"job_point_label_after",BUTTON_EXCHANGE:"btn_exchange",BUTTON_NAMES:{MINUS_TEN:"btn_minus_ten",MINUS_ONE:"btn_minus_one",PLUS_ONE:"btn_plus_one",PLUS_TEN:"btn_plus_ten",SELECT_MAX:"btn_use_all"},BUTTON_VALUES:{MINUS_TEN:-10,MINUS_ONE:-1,PLUS_ONE:1,PLUS_TEN:10,SELECT_MAX:9999},EXCHANGE_AMOUNT_LOWER_SELECTION_LIMIT:0,ctor:function(e,t){this._rootWidget=e,this._selectedAmount=Math.max(t||0,this.EXCHANGE_AMOUNT_LOWER_SELECTION_LIMIT),this._selectionAmountLabel=this._getWidget(this.SELECTED_AMOUNT_DISPLAY_NAME),this._afterLabel=this._getWidget(this.AFTER_AMOUNT_LABEL),this._initializeButtons()},getSelectedAmount:function(){return this._selectedAmount},updateRateInfo:function(e,t){this._rateInfo=e,this._updateSelectedAmount(t)},_updateSelectedAmount:function(e){e=this._applySelectedAmountLimits(e),this._selectedAmount=e,this._selectionAmountLabel.setString(e.toString()),this._afterLabel.setString(this._calculateAfterAmount(e).toString()),this._updateButtonStatus(e)},_initializeButtons:function(){this._buttons=o.transform(this.BUTTON_NAMES,function(e,t,n){var i=this._getWidget(t);i.setUserData(this.BUTTON_VALUES[n]),i.addTouchEventListener(this._onTouchButton,this),i.setLockTimeout(0),e[n]=i}.bind(this),{})},_getWidget:function(e){return n.getWidgetFromNode(this._rootWidget,e,function(e){r.warn(this.className+": "+e)}.bind(this))},_onTouchButton:function(e,t){if(t===a.Widget.TOUCH_ENDED){var n=this.getSelectedAmount();n+=e.getUserData(),this._updateSelectedAmount(n)}},_applySelectedAmountLimits:function(e){return e=this._rateInfo.calculateExchangeAmountSelectionLimit(e),Math.max(e,this.EXCHANGE_AMOUNT_LOWER_SELECTION_LIMIT)},_calculateAfterAmount:function(e){return this._rateInfo.calculateAfterAmount(e)},_updateButtonStatus:function(e){var n=e===this.EXCHANGE_AMOUNT_LOWER_SELECTION_LIMIT,i=this._rateInfo.hasReachedAmountSelectionLimit(e);this._setButtonEnabled(this._buttons.MINUS_ONE,!n),this._setButtonEnabled(this._buttons.MINUS_TEN,!n),this._setButtonEnabled(this._buttons.PLUS_TEN,!i),this._setButtonEnabled(this._buttons.PLUS_ONE,!i);var a=this.getSelectedAmount()>0;t.pc.roles.UIUtility._setEnableButton(this._rootWidget.seekWidgetByName(this.BUTTON_EXCHANGE),a)},_setButtonEnabled:function(e,n){t.pc.roles.UIUtility._setEnableButton(e,n)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.createNameSpaceIfNotExists("party.controller"),t.party.controller.JobEnergyReleaseSummaryController=n.Class.extend({className:"JobEnergyReleaseSummaryController",_scene:null,_aJobId:null,_masterPointModelPromise:null,_summary:null,ctor:function(e,t){this._scene=e,this._aJobId=t},updateSummary:function(){t.createInstance("apiAJobEnergyRelease").getSummary(this._aJobId).then(function(e){return this._setSummary(e.body)}.bind(this)).fail(function(e){console.error(e.stack)}),this.updateMasterPointModelPromise(),this._masterPointModelPromise.then(this._setMasterPointInfo.bind(this))},getMasterPointModelPromise:function(){return this._masterPointModelPromise},updateMasterPointModelPromise:function(){this._masterPointModelPromise=t.createInstance("apiAPlayers").getMasterPoint().then(function(e){return new t.party.model.AHeroMasterPoint(e.body)})},_setSummary:function(e){this._scene.seekWidgetByName("status_enhance_num").setString(e.status.current_count+"/"+e.status.max_count),this._scene.seekWidgetByName("ability_get_num").setString(e.ability.current_count.toString()),this._summary=e},hasReachedEnhanceLimit:function(){return!!this._summary&&this._summary.status.current_count>=this._summary.status.max_count},updateMasterPointAfterExchangePoint:function(e){var n=new t.party.model.AHeroMasterPoint(e);this._masterPointModelPromise=a.resolve(n),this._setMasterPointInfo(n)},_setMasterPointInfo:function(e){this._scene.setStrings({have_mp_num:e.getHasMasterPoint().toString()})}}),i.assign(t.party.controller.JobEnergyReleaseSummaryController.prototype,t.pc.party.roles.Routing)}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;e.Q,t.createNameSpaceIfNotExists("party.controller"),t.party.controller.EnhanceStatusListController=n.Class.extend({className:"EnhanceStatusListController",_scene:null,_aJobId:null,_summaryController:null,_mode:0,_controller:null,ctor:function(e,t,n){this._scene=e,this._aJobId=t,this._summaryController=n},init:function(){this._updateStatusPanelList(),this._summaryController.updateSummary()},_updateStatusPanelList:function(){var e=this._isEnhanceMode()?"all":"enhanced",n=[this._aJobId,e],i=this._scene.seekWidgetByName("tab_0_node");if(this._controller)return i.getChildren().forEach(function(e){"list_node"!==e.getName()&&"nothing_node"!==e.getName()||e.setVisible(!1)}),this._controller.getDataList().updateOption(n),void this._controller.setCurrentPageNumber(1,!1);var a=i.seekWidgetByName("par_energy_release_statuslist_page_ui"),o=new t.core.pager.view.page.BasePageUiFactory(a,this._initStatusPanel.bind(this)),r=t.core.pager.model.ApiDataListFactory("apiAJobEnergyRelease","getStatus",n),s=new t.core.pager.controller.PagerController(i,r,[o],a),c=i.seekWidgetByName("viewpage_three_ui");new t.core.pager.view.button.ViewPageUi(c,s).initialize(),s.initialize(),this._controller=s},changeMode:function(e){this._mode=e,this.init()},_isEnhanceMode:function(){return this._mode===t.pc.party.par_energy_release.SceneDelegate.prototype.MODE_STATUS_ENHANCE},_initStatusPanel:function(e,t){var n=t.getRawData();this._setStatusPanelImage(e,n),this._setTouchEvent(e,n)},_setStatusPanelImage:function(e,n){var a=e.seekWidgetByName("coreimg_statusicon"),o=t.Img("coreimg","statusicon",i.padZero(n.icon_id,4)).png;a.loadTexture(o),a.setVisible(!0);var r=e.seekWidgetByName("level_label"),s=e.seekWidgetByName("max_level_label");n.is_level_max?this._setLevelNode(s,r,n.level):this._setLevelNode(r,s,n.level),e.seekWidgetByName("name_label").setString(n.category_name)},_setLevelNode:function(e,t,n){t.setVisible(!1);var i=0===n?"-":"Lv."+n;e.setString(i),e.setVisible(!0)},_setTouchEvent:function(e,t){e.seekWidgetByName("status_base").addTouchEventListener(function(e,n){n===ccui.Widget.TOUCH_ENDED&&this._openPopup(t)}.bind(this))},_openPopup:function(e){return this._isEnhanceMode()?e.is_level_max?void this._openCanNotEnhancePopup(e):void this._openEnhancePopup(e):void this._openRemovePopup(e)},_openEnhancePopup:function(e){var n=t.ImplantedPopup.create(this._scene,"par_status_enhance","EnhanceStatusPopup");this._summaryController.getMasterPointModelPromise().then(function(t){var i=t.getHasMasterPoint(),a=this._summaryController.hasReachedEnhanceLimit();n.open(e,this._aJobId,i,a).then(function(){this.init()}.bind(this)).fail(function(e){console.error(e.stack)})}.bind(this))},_openCanNotEnhancePopup:function(e){t.ImplantedPopup.create(this._scene,"par_status_enhance","CanNotEnhanceStatusPopup").open(e).then(function(){this.init()}.bind(this)).fail(function(e){console.error(e.stack)})},_openRemovePopup:function(e){var n=t.ImplantedPopup.create(this._scene,"par_status_reset","RemoveStatusPopup");this._summaryController.getMasterPointModelPromise().then(function(t){n.open(e,this._aJobId,this._scene).then(function(){this.init()}.bind(this)).fail(function(e){console.error(e.stack)})}.bind(this))}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e._,e.Q,t.createNameSpaceIfNotExists("party.controller"),t.party.controller.AcquireAbilityListController=n.Class.extend({className:"AcquireAbilityListController",LIST_NODE_NAME:t.env.isSp?"par_energy_release_abilitylist_page_ui":"par_energy_release_abilitylist_page_ui_0",_scene:null,_aJobId:null,_summaryController:null,_controller:null,ctor:function(e,t,n){this._scene=e,this._aJobId=t,this._summaryController=n},init:function(){this._controller||this._updateAbilityPanelList()},_updateSummary:function(){this._summaryController.updateSummary()},_updateAbilityPanelList:function(){var e=this._scene.seekWidgetByName("tab_1_node"),n=[this._aJobId],i=e.seekWidgetByName(this.LIST_NODE_NAME),a=new t.core.pager.view.page.BasePageUiFactory(i,this._initAbilityPanel.bind(this)),o=t.core.pager.model.ApiDataListFactory("apiAJobEnergyRelease","getAbilities",n),r=new t.core.pager.controller.PagerController(e,o,[a],i),s=e.seekWidgetByName("viewpage_three_ui");new t.core.pager.view.button.ViewPageUi(s,r).initialize(),r.initialize(),this._controller=r},_initAbilityPanel:function(e,t){var n=t.getRawData();this._setAbilityPanelImage(e,n),this._setTouchEvent(e,n)},_setAbilityPanelImage:function(e,n){t.createInstance("AbilityIcon",[e,n.icon_id,n.category,!0]).show();var i=n.is_acquired?"learned_label":"hyphen",a=e.seekWidgetByName(i),o=n.is_acquired?"":"-";a.setString(o),a.setVisible(!0)},_setTouchEvent:function(e,t){var n=e.seekWidgetByName("ability_base");n.setTouchEnabled(!0),n.addTouchEventListener(function(e,n){n===ccui.Widget.TOUCH_ENDED&&this._openPopup(t)}.bind(this)),e.seekWidgetByName("coreimg_abilityicon").setTouchEnabled(!1)},_openPopup:function(e){var n=t.ImplantedPopup.create(this._scene,"par_ability_get","AcquireAbilityPopup");this._summaryController.getMasterPointModelPromise().then(function(t){var i=t.getHasMasterPoint();n.open(e,this._aJobId,i).then(function(){this._updateAbilityPanelList(),this._updateSummary()}.bind(this))}.bind(this)).fail(function(e){console.error(e)})}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.party=n.party||{},n.party.view=n.party.view||{},n.party.view.EnhanceStatusPopup=n.ImplantedPopup.extend({_parentNodeName:"par_status_enhance",MP_LABEL_TEMPLATE:'<div class="white text_common" style=\'margin-top: 12px\'><div class="white">\n<div>MP<span class="yellow"><%= requiredPoint %></span></div>\n</div></div>',_initContents:function(e,t,n,i){this._initDescription(e,t,n,i),this.setButtonEvents({btn_cancel:!1,btn_execute:this._enhance.bind(this,e,t)})},_initDescription:function(e,t,i,a){return n.createInstance("apiAJobEnergyRelease").confirmEnhanceStatus(t,e.category_id).then(function(e){return this._setDescription(e.body,i,a),!0}.bind(this)).fail(function(e){console.error(e.stack)})},_setDescription:function(e,t,n){this._setBeforeDescription(e.before_status),this._setAfterDescription(e.after_status),this._setRequiredPoint(e.required_master_point),this._setMessage(e,t,n),this._setBtn(e,t,n)},_setBeforeDescription:function(e){var i=this.getNode();i.seekWidgetByName("level_label_before").setString("Lv."+e.level+"");var a=i.seekWidgetByName("bonus_img_before"),o=i.seekWidgetByName("bonus_label_before");if(0===e.level)return a.setVisible(!1),void o.setString("");var r=n.Img("coreimg","statusicon",t.padZero(e.icon_id,4)).png;a.loadTexture(r),a.setVisible(!0),o.setString(e.description)},_setAfterDescription:function(e){var i=this.getNode();i.seekWidgetByName("level_label_after").setString("Lv."+e.level+"");var a=i.seekWidgetByName("bonus_img_after"),o=i.seekWidgetByName("bonus_label_after"),r=n.Img("coreimg","statusicon",t.padZero(e.icon_id,4)).png;a.loadTexture(r),a.setVisible(!0),o.setString(e.description)},_setRequiredPoint:function(e){this.getNode().setHtmlStrings({mp_labelimg:t.template(this.MP_LABEL_TEMPLATE)({requiredPoint:e})},n.GameConfig.POPUP_CSS)},_setMessage:function(e,t,n){var i=this.getNode(),a=i.seekWidgetByName("attention_label"),o=i.seekWidgetByName("question_label");return e.required_master_point>t?(o.setVisible(!1),a.setString("MP"),void a.setVisible(!0)):n?(o.setVisible(!1),a.setString(""),void a.setVisible(!0)):(a.setVisible(!1),void o.setVisible(!0))},_setBtn:function(e,t,i){var a=this.getNode().seekWidgetByName("btn_execute");return i||e.required_master_point>t?void n.pc.roles.UIUtility._setEnableButton(a,!1):void n.pc.roles.UIUtility._setEnableButton(a,!0)},_enhance:function(e,t){return n.createInstance("apiAJobEnergyRelease").enhance(t,e.category_id).then(function(e){return e.body.result}.bind(this)).then(function(){this.dismiss(!0)}.bind(this)).fail(function(e){console.error(e.stack)})}}),n.assignRoles(n.party.view.EnhanceStatusPopup,[n.pc.roles.UIUtility,n.pc.roles.CoreCardCommon])}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.party=n.party||{},n.party.view=n.party.view||{},n.party.view.CanNotEnhanceStatusPopup=n.ImplantedPopup.extend({_parentNodeName:"par_status_enhance",MP_LABEL_TEMPLATE:'<div class="white text_common" style=\'margin-top: 12px\'><div class="white">\n<div>MP<span class="yellow">-</span></div>\n</div></div>',_initContents:function(e){this.setButtonEvents({btn_cancel:!1,btn_execute:!0}),this._initDescription(e)},_initDescription:function(e){this._setDescription(e)},_setDescription:function(e){this._setBeforeDescription(e),this._setAfterDescription(),this._setRequiredPoint(),this._setMessage(),this._setBtn()},_setBeforeDescription:function(e){var i=this.getNode();i.seekWidgetByName("level_label_before").setString("Lv."+e.level+"");var a=i.seekWidgetByName("bonus_img_before"),o=i.seekWidgetByName("bonus_label_before");if(0===e.level)return a.setVisible(!1),void o.setString("");var r=n.Img("coreimg","statusicon",t.padZero(e.icon_id,4)).png;a.loadTexture(r),a.setVisible(!0),o.setString(e.description)},_setAfterDescription:function(){var e=this.getNode();e.seekWidgetByName("level_label_after").setString("Lv.-");var t=e.seekWidgetByName("bonus_img_after"),n=e.seekWidgetByName("bonus_label_after");t.setVisible(!1),n.setString("-")},_setRequiredPoint:function(){this.getNode().setHtmlStrings({mp_labelimg:t.template(this.MP_LABEL_TEMPLATE)({})},n.GameConfig.POPUP_CSS)},_setMessage:function(){var e=this.getNode();e.seekWidgetByName("question_label").setVisible(!1);var t=e.seekWidgetByName("attention_label");t.setString("Lv"),t.setVisible(!0)},_setBtn:function(){var e=this.getNode().seekWidgetByName("btn_execute");n.pc.roles.UIUtility._setEnableButton(e,!1)}}),n.assignRoles(n.party.view.CanNotEnhanceStatusPopup,[n.pc.roles.UIUtility,n.pc.roles.CoreCardCommon])}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.party=n.party||{},n.party.view=n.party.view||{},n.party.view.RemoveStatusPopup=n.ImplantedPopup.extend({_parentNodeName:"par_status_reset",_scene:null,_confirm:null,_initContents:function(e,t,n){this._scene=n,this._initSelectModeBtn(),this._initDescription(e,t),this.setButtonEvents({btn_cancel:!1,btn_execute:this._removeConfirm.bind(this,e,t)})},_initSelectModeBtn:function(){var e=this._getStepRemoveModeBtn();e.setBright(!1);var t=this._getAllRemoveModeBtn();t.setBright(!0),e.addTouchEventListener(function(e,t){t===ccui.Widget.TOUCH_ENDED&&this._isAllRemoveMode()&&this._changeSelectedMode()}.bind(this)),t.addTouchEventListener(function(e,t){t===ccui.Widget.TOUCH_ENDED&&(this._isAllRemoveMode()||this._changeSelectedMode())}.bind(this))},_changeSelectedMode:function(){var e=this._getAllRemoveModeBtn(),t=this._getStepRemoveModeBtn();e.setBright(!e.isBright()),t.setBright(!t.isBright()),this._setDescription(this._confirm)},_getAllRemoveModeBtn:function(){return this.getNode().seekWidgetByName("btn_all_step")},_getStepRemoveModeBtn:function(){return this.getNode().seekWidgetByName("btn_one_step")},_initDescription:function(e,t){return n.createInstance("apiAJobEnergyRelease").confirmRemoveStatus(t,e.category_id).then(function(e){return this._confirm=e.body,this._setDescription(e.body),!0}.bind(this)).fail(function(e){console.error(e.stack)})},_setDescription:function(e){this._setBeforeDescription(e.before_status),this._setAfterDescription(e.after_status)},_setBeforeDescription:function(e){var i=this.getNode();i.seekWidgetByName("level_label_before").setString("Lv."+e.level+"");var a=i.seekWidgetByName("bonus_img_before"),o=i.seekWidgetByName("bonus_label_before"),r=n.Img("coreimg","statusicon",t.padZero(e.icon_id,4)).png;a.loadTexture(r),a.setVisible(!0),o.setString(e.description)},_setAfterDescription:function(e){var i=this.getNode(),a=i.seekWidgetByName("level_label_after"),o=this._isAllRemoveMode()?0:e.level;a.setString("Lv."+o+"");var r=i.seekWidgetByName("bonus_img_after"),s=i.seekWidgetByName("bonus_label_after");if(0===o)return r.setVisible(!1),void s.setString("");var c=n.Img("coreimg","statusicon",t.padZero(e.icon_id,4)).png;r.loadTexture(c),r.setVisible(!0),s.setString(e.description)},_isAllRemoveMode:function(){return!this._getAllRemoveModeBtn().isBright()},_removeConfirm:function(e,t){return this._isAllRemoveMode()?this._openAllRemovePopup(e,t):this._remove(e,t)},_openAllRemovePopup:function(e,t){return n.ImplantedPopup.create(this._scene,"par_status_allreset_confirm","AllRemoveStatusPopup").open(e,t).then(function(){this.dismiss(!0)}.bind(this)).fail(function(e){console.error(e.stack)})},_remove:function(e,t){return n.createInstance("apiAJobEnergyRelease").remove(t,e.category_id,"step").then(function(e){return e.body.result}.bind(this)).then(function(){this.dismiss(!0)}.bind(this)).fail(function(e){console.error(e.stack)})}}),n.assignRoles(n.party.view.RemoveStatusPopup,[n.pc.roles.UIUtility,n.pc.roles.CoreCardCommon])}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.party=n.party||{},n.party.view=n.party.view||{},n.party.view.AllRemoveStatusPopup=n.ImplantedPopup.extend({_parentNodeName:"par_status_allreset_confirm",_initContents:function(e,t){this._initDescription(e),this.setButtonEvents({btn_cancel:!1,btn_ok:this._remove.bind(this,e,t)})},_initDescription:function(e){var i=this.getNode();i.seekWidgetByName("level_label").setString("Lv."+e.level+"");var a=i.seekWidgetByName("bonus_img"),o=i.seekWidgetByName("bonus_label"),r=n.Img("coreimg","statusicon",t.padZero(e.icon_id,4)).png;a.loadTexture(r),a.setVisible(!0),o.setString(e.description)},_remove:function(e,t){return n.createInstance("apiAJobEnergyRelease").remove(t,e.category_id,"all").then(function(e){return e.body.result}.bind(this)).then(function(){this.dismiss(!0)}.bind(this)).fail(function(e){console.error(e.stack)})}}),n.assignRoles(n.party.view.AllRemoveStatusPopup,[n.pc.roles.UIUtility,n.pc.roles.CoreCardCommon])}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.party=n.party||{},n.party.view=n.party.view||{},n.party.view.ActiveStatusListPopup=n.ImplantedPopup.extend({_parentNodeName:"par_energy_bonus",STATUS_NODE_AMOUNT:15,_activeStatusList:null,_statusListIndex:0,_initContents:function(e){this._activeStatusList=e,this._statusListIndex=0,this._setStatusList(),this._initUpBtn(),this._initDownBtn(),this.setButtonEvents({btn_close:!0})},_setStatusList:function(){t.each(t.range(this.STATUS_NODE_AMOUNT),function(e){this._initStatus(e)}.bind(this)),this._setUpBtn(),this._setDownBtn()},_initStatus:function(e){var i=this._activeStatusList[e+this._statusListIndex],a=this.getNode().seekWidgetByName("par_energy_bonus_list_ui_"+e);if(t.isUndefined(i))a.setVisible(!1);else{var o=a.seekWidgetByName("coreimg_statusicon"),r=n.Img("coreimg","statusicon",t.padZero(i.icon_id,4)).png;o.loadTexture(r),o.setVisible(!0),a.seekWidgetByName("acce_effect_label").setString(i.description),a.setVisible(!0)}},_initUpBtn:function(){this.getNode().seekWidgetByName("btn_up").addTouchEventListener(function(e,t){t===ccui.Widget.TOUCH_ENDED&&(this._statusListIndex--,this._setStatusList())}.bind(this))},_setUpBtn:function(){var e=this.getNode().seekWidgetByName("btn_up"),t=0!==this._statusListIndex;n.pc.roles.UIUtility._setEnableButton(e,t)},_initDownBtn:function(){this.getNode().seekWidgetByName("btn_down").addTouchEventListener(function(e,t){t===ccui.Widget.TOUCH_ENDED&&(this._statusListIndex++,this._setStatusList())}.bind(this))},_setDownBtn:function(){var e=this.getNode().seekWidgetByName("btn_down"),t=this._activeStatusList.length-this._statusListIndex>this.STATUS_NODE_AMOUNT;n.pc.roles.UIUtility._setEnableButton(e,t)}}),n.assignRoles(n.party.view.ActiveStatusListPopup,[n.pc.roles.UIUtility,n.pc.roles.CoreCardCommon])}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.party=n.party||{},n.party.view=n.party.view||{},n.party.view.AcquireAbilityPopup=n.ImplantedPopup.extend({_parentNodeName:"par_ability_get",MP_LABEL_TEMPLATE:'<div class="white text_common" style=\'margin-top: 12px\'><div class="white">\n<div>MP<span class="yellow"><%= requiredPoint %></span></div>\n</div></div>',_initContents:function(e,t,n){this._setDescription(e,n),this.setButtonEvents({btn_cancel:!1,btn_learn:this._acquire.bind(this,e,t)})},_setDescription:function(e,t){var n=e.is_acquired,i=e.required_master_point;this._setAbilityInfo(e),this._setRequiredPoint(i),this._setMessage(n,i,t),this._setBtn(n,i,t)},_setAbilityInfo:function(e){var i=this.getNode();n.createInstance("AbilityIcon",[i,e.icon_id,e.category,!1]).show(),i.seekWidgetByName("ability_name").setString(e.name),i.seekWidgetByName("ability_effect").setString(e.description),i.seekWidgetByName("interval_label").setString(e.recast+"");var a=e.duration,o=a.turn,r=a.second,s=i.seekWidgetByName("duration_base");if(t.isNull(o)&&t.isNull(r))s.setVisible(!1);else{var c=t.isNull(r)?"":r+" ";c+=t.isNull(o)?"":o+"",i.seekWidgetByName("duration_label").setString(c),s.setVisible(!0)}},_setRequiredPoint:function(e){this.getNode().setHtmlStrings({mp_labelimg:t.template(this.MP_LABEL_TEMPLATE)({requiredPoint:e})},n.GameConfig.POPUP_CSS)},_setMessage:function(e,t,n){var i=this.getNode(),a=i.seekWidgetByName("attention_label"),o=i.seekWidgetByName("question_label");return e?(o.setVisible(!1),a.setString(""),void a.setVisible(!0)):t>n?(o.setVisible(!1),a.setString("MP"),void a.setVisible(!0)):(a.setVisible(!1),void o.setVisible(!0))},_setBtn:function(e,t,i){var a=this.getNode().seekWidgetByName("btn_learn");return e||t>i?void n.pc.roles.UIUtility._setEnableButton(a,!1):void n.pc.roles.UIUtility._setEnableButton(a,!0)},_acquire:function(e,t){return n.createInstance("apiAJobEnergyRelease").acquire(t,e.ability_id).then(function(e){return e.body.result}.bind(this)).then(function(){this.dismiss(!0)}.bind(this)).fail(function(e){console.error(e.stack)})}}),n.assignRoles(n.party.view.AcquireAbilityPopup,[n.pc.roles.UIUtility,n.pc.roles.CoreCardCommon])}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.party=n.party||{},n.party.controller=n.party.controller||{},n.party.controller.PickMember=cc.Class.extend({_rootWidget:null,_partyModelPromise:null,_listModel:null,_pulldownConfigPromise:null,ctor:function(e,t){this._rootWidget=e,this._partyModelPromise=t},_createDisplayFilterSettings:function(){return{window_gray:[n.displayFilter.enums.FILTER_NAME.PARTY_PICK_CHARA,"com_filter_chara"]}},onSceneEnter:function(e){var t=e.routerParams;return void 0===t.party&&(t.party={from_tower:!1}),this._listModel=new n.core.pager.model.ApiDataListFactory("apiACharacters","getPickMembers",[n.displayFilter.enums.FILTER_NAME.PARTY_PICK_CHARA,n.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,n.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE,t.party.from_tower],n.core.model.ACharacter),this._pulldownConfigPromise=this._createPulldownConfig(),Q.all([this._listModel.initialize(),this._pulldownConfigPromise])},onSceneInit:function(e){this._createDisplayFilterController(e),this._initializeDisplayFilterController("window_gray"),e.setStrings({header_label:""}),this._setVisible(e,{btn_release_chara:!0,btn_cancel:!0,btn_organize:!0,btn_back_to_organize:!1});var t=[this._createCandidatePagerController(e,this._pulldownConfigPromise),this._partyModelPromise.then(this._createPartyOrganizationController.bind(this,e,this._pulldownConfigPromise))];return this._partyModelPromise.then(this._setMultiUpdateEventListener.bind(this)),this._partyModelPromise.then(this._initializeCharacterReleaseButton.bind(this,e)),Q.all(t).spread(this._setCoreCardTouchEvent).fail(function(e){if(e instanceof Error)throw e})},_setCoreCardTouchEvent:function(e,t){var i=e[0],a=e[1],o=t[0],r=t[1];a.setTouchEventHandler(new n.party.eventHandling.PartyCandidateTouchEvent(i,o)),r.setTouchEventHandler(new n.party.eventHandling.PartyOrginizationTouchEvent(i,o))},_setMultiUpdateEventListener:function(){var e=this._pagerController,t=this._partyController,n=this._rootWidget.seekWidgetByName("list_blank_0").getParent();if(e.addUpdateEventListener(this._candidatePagerUpdateEvent.bind(this,n)),this._listModel.getCurrentPageData(e.getParPage()).then(function(t){this._candidatePagerUpdateEvent(n,t,this._listModel,void 0,e)}.bind(this)),cc.director.getRunningScene().routerParams.party.from_tower){var i=this._rootWidget.seekWidgetByName("status_window");t.addUpdateEventListener(function(e,t,n,i,a){e.getChildren().filter(function(e){return e.getUserData()}).forEach(this._setTowerQuestFilter.bind(this,a,t))}.bind(this,i))}},_candidatePagerUpdateEvent:function(e,t,n,i,a){e.disposed||e.getChildren().forEach(function(e,n){var i=t[n];if(i){var o=this._partyController,r=e.getUserData(),s=o.getDataList().contains(i);if(r.setIconOrganized(s),i.getRawData().cannot_tower_enter)return void this._setTowerQuestFilter(a,t,e,n);r.getAlreadyEntryLabel()&&this._setTowerQuestFilter(a,t,e,n),r.setAlreadyEntryLabel(null),r.setGrayout(a.getSelectNumber(i)>0)}}.bind(this))},_initializeCharacterReleaseButton:function(e){var t=e.seekWidgetByName("btn_release_chara");this._partyController.addUpdateEventListener(function(e,i,a,o){var r=o.getSelectedData()[0],s=r&&r instanceof n.core.model.ACharacter;n.pc.roles.UIUtility._setEnableButton(t,s)},this),t.addTouchEventListener(function(e,t){if(t===ccui.Widget.TOUCH_ENDED){var n=this._partyController,i=this._pagerController,a=n.getSelectedData()[0],o=n.getDataList();o.change(o.getPos(a)),n.refresh(!0,!0),i.refresh()}},this)},_createPulldownConfig:function(){return n.createInstance("PulldownSortConfig").init({sortValue:"attack_desc",sortButton:"btn_sort",sortLabel:"sort_label",sortMenuBase:"sortlist",sortChoice:"core-pages-sort_list_0_ui",parentNodeName:this._rootWidget,changeEventName:"pulldown_sort_config",sortKey:"assignable_characters"})},_createCandidatePagerController:function(e,t){var i=this._rootWidget,a=i.seekWidgetByName("corecard_blank_5_4_ui"),o=new n.core.pager.view.page.SelectableCoreCardUi(a,"CoreCardCharacterUI",{actionName:"full"});o.setDetailMode(n.pc.party.par_pick_member_acce.MODE.MEMBER);var r=new n.core.pager.controller.SelectablePagerController(i,this._listModel,[o],a,1,!0);t.then(r.setPulldownSortConfig.bind(r)),o.setPagerController(r);var s=i.seekWidgetByName("viewpage_ui");s&&new n.core.pager.view.button.ViewPageUi(s,r).initialize();return this._pagerController=r,t.then(r.setPulldownSortConfig.bind(r)).then(r.initialize.bind(r)).then(function(){var t=r.getDataList().getExistsRecordCount();return e.setStrings({header_sub_label:""+t.toString()}),[r,o]}.bind(this))},_createPartyOrganizationController:function(e,t,i){var a=e.seekWidgetByName("status_window"),o=new n.party.view.PartyOrganizationUi(a,"CoreCardCharacterUI",{actionName:"full",isFillEmptyRecord:!0});o.setCandidatePagerController(this._pagerController);var r=new n.core.pager.controller.SelectablePagerController(a,i.getACharacterList(),[o],a,1,!0);return t.then(r.setPulldownSortConfig.bind(r)),o.setPagerController(r),this._partyController=r,t.then(r.setPulldownSortConfig.bind(r)).then(r.initialize.bind(r)).thenResolve([r,o])},_setTowerQuestFilter:function(e,t,n,i){var a=t[i],o=n.getUserData();if(o){if(!a)return o.setAlreadyEntryLabel(null),void this._setGrayOutForTowerEvent(o,!1);var r=a.getRawData().cannot_tower_enter;if(r)return this._setGrayOutForTowerEvent(o,r),void o.setAlreadyEntryLabel(a.getRawData().cannot_tower_enter_endat+"\n\n");o.setAlreadyEntryLabel(null),this._setGrayOutForTowerEvent(o,r),o.setGrayout(e.getSelectNumber(a)>0)}},_setGrayOutForTowerEvent:function(e,t){var n=e.getResult().seekWidgets(function(e){return"already_entry_label"!==e.getName()&&"selecting_frame"!==e.getName()&&"selected_label"!==e.getName()&&"btn_detail"!==e.getName()&&0===e.getChildren().length}),i="#FFFFFF";t&&(i="#808080"),this._applySetColorForTowerEvent(n,i)},_applySetColorForTowerEvent:function(e,n){t.each(e,function(e){e.setColor(cc.color(n))})},assign:function(e){return this._partyModelPromise.then(function(e){return e.assignACharacters()}).then(this._navigateTo001.bind(this,e,null))},cancel:function(e){this._navigateTo001(e)},_setVisible:function(e,t){e.seekWidgets(function(e){var n=t[e.getName()];"boolean"==typeof n&&e.setVisible(n)})}}),n.assignRoles(n.party.controller.PickMember,[n.displayFilter.roles.DisplayFilterSceneController,n.pc.party.roles.Routing])}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.party=n.party||{},n.party.controller=n.party.controller||{},n.party.controller.EquipAcce=cc.Class.extend({_rootWidget:null,_partyModelPromise:null,_listModel:null,_pulldownConfigPromise:null,SORT_KEY:"pick_accessories",ctor:function(e,t){this._rootWidget=e,this._partyModelPromise=t},_createDisplayFilterSettings:function(){return{window_gray:[n.displayFilter.enums.FILTER_NAME.PARTY_ACCESSORY,"com_filter_other"]}},onSceneEnter:function(e){return this._listModel=new n.core.pager.model.ApiDataListFactory("apiAAccessories","getPickAccessoryList",[n.displayFilter.enums.FILTER_NAME.PARTY_ACCESSORY,n.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,n.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE,"pick",e.routerParams.par_pick_member_acce.a_party_id],n.acce.model.Accessory),this._pulldownConfigPromise=this._createPulldownConfig(),Q.all([this._listModel.initialize(),this._pulldownConfigPromise])},onSceneInit:function(e){this._createDisplayFilterController(e),this._initializeDisplayFilterController("window_gray"),e.setStrings({header_label:""}),this._setVisible(e.seekWidgetByName("window_gray"),{btn_release_chara:!1,btn_cancel:!1,btn_organize:!1,btn_back_to_organize:!0});var t=[this._partyModelPromise.then(this._createCandidatePagerController.bind(this,e,this._pulldownConfigPromise)),this._partyModelPromise.then(this._createPartyOrganizationController.bind(this,e))];return Q.all(t).spread(this._setCoreCardTouchEvent.bind(this)).fail(function(e){if(e instanceof Error)throw e})},_setCoreCardTouchEvent:function(e,i){var a=e[0],o=e[1],r=i[0],s=i[1];o.setTouchEventHandler(new n.core.eventHandling.BaseEventHandler(function(e,t,n){a.toggleSelect(e),r.refresh()})),s.setTouchEventHandler(new n.core.eventHandling.BaseEventHandler(function(e,i,o){var s=a.getSelectedData()[0],c=s&&r.getDataList().canEquip(o,s);s&&!c||e.openDetailPopup(n.pc.party.par_pick_member_acce.MODE.ACCE,s).spread(function(e,n){return t.isNumber(e)?this.updateAll():Q.reject()}.bind(this)).fail(function(e){e&&console.error(e)})},this))},_createPulldownConfig:function(){return n.createInstance("PulldownSortConfig").init({sortValue:"attack_desc",sortButton:"btn_sort",sortLabel:"sort_label",sortMenuBase:"sortlist",sortChoice:"core-pages-sort_list_0_ui",parentNodeName:this._rootWidget,changeEventName:"pulldown_sort_config",sortKey:this.SORT_KEY})},_createCandidatePagerController:function(e,t,i){var a=this._rootWidget,o=a.seekWidgetByName("corecard_blank_5_4_ui"),r=new n.party.view.AcceOutlineUi(o,"CoreCardAccessoryUI",{actionName:"full",aPartyId:i.getAId(),sceneController:this});r.setDetailMode(n.pc.party.par_pick_member_acce.MODE.ACCE);var s=new n.core.pager.controller.SelectablePagerController(a,this._listModel,[r],o,1,!0);t.then(s.setPulldownSortConfig.bind(s)),r.setPagerController(s);var c=a.seekWidgetByName("viewpage_ui");c&&new n.core.pager.view.button.ViewPageUi(c,s).initialize();return this._pagerController=s,t.then(s.setPulldownSortConfig.bind(s)).then(s.initialize.bind(s)).then(function(){var t=s.getDataList().getExistsRecordCount();return e.setStrings({header_sub_label:""+t.toString()}),[s,r]}.bind(this))},_createPartyOrganizationController:function(e,t){var i=e.seekWidgetByName("status_window"),a=new n.party.view.PartyAcceOrganizationUi(i,"CoreCardCharacterUI",{actionName:"full",isFillEmptyRecord:!0});a.setCandidatePagerController(this._pagerController);var o=new n.core.pager.controller.PagerController(i,t.getACharacterList(),[a],i);return this._partyController=o,o.initialize().thenResolve([o,a])},updateAll:function(){this._pagerController.refresh(!1,!0),this._partyModelPromise.then(function(e){return this._partyModelPromise=e.prepare(),this._partyModelPromise}.bind(this)).then(function(e){this._partyController.setDataList(e.getACharacterList()),this._partyController.refresh()}.bind(this))},cancel:function(e){this._navigateTo001(e)},_setVisible:function(e,t){e.seekWidgets(function(e){var n=t[e.getName()];"boolean"==typeof n&&e.setVisible(n)})}}),n.assignRoles(n.party.controller.EquipAcce,[n.displayFilter.roles.DisplayFilterSceneController,n.pc.party.roles.Routing])}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=e.ccui;e._,e.console,t.createNameSpaceIfNotExists("kh.party.view"),t.party.view.PartyOrganizationUi=t.core.pager.view.page.SelectableCoreCardUi.extend({className:"PartyOrganizationUi",_candidateController:null,_updateOne:function(e,n,i,a){var o=e[a],r=this._createOrGetCoreCardUI(i.getChildByName("corecard_chara_ui"),a);if(this._super.apply(this,arguments),r.setIconOrganized(!1),this._updateTotalLabel(r,o,n),this._updateBlankTouchPanel(o,i,r),this._candidateController){var s=this._controller,c=this._controller.getSelectedData()[0];if(c){var u=o instanceof t.party.model.APartyRemnant,l=o!==c;return l&&u&&c instanceof t.party.model.APartyRemnant&&(l=!1),void i.seekWidgetByName("selecting_frame").setVisible(l)}var _=(c=this._candidateController.getSelectedData()[0])&&s.getDataList().canOrganize(a,c);i.seekWidgetByName("selecting_frame").setVisible(_)}},_updateBlankTouchPanel:function(e,a,o){var r=o.getResult(),s=r.seekWidgetByName("blank_touch_panel");if(!e||e instanceof t.party.model.APartyRemnant){o.clearImg(),o.initAction("plain");var c=this._controller.getSelectNumber(e)>0;return o.setIconSelected(c),s.setVisible(!0),s.setBackGroundColorType(i.Layout.BG_COLOR_SOLID),s.setBackGroundColor(n.color.BLACK),s.setBackGroundColorOpacity(c?80:0),a.getChildByName("empty_node").setVisible(!c),void r.setVisible(!0)}s.setVisible(!1),o.initAction(this._coreCardActionName),o.setIconOrganized(!1),r.seekWidgetByName(o.IMG_NODE_NAME).setVisible(!0)},_getDetailMode:function(){return t.pc.party.par_pick_member_acce.MODE.MEMBER},_updateTotalLabel:function(e,t,n){var i=t.getRawData();i.hp=t.getHp(),i.attack=t.getAttackPoint(),e.setTotalLabel(e.getTotalLabel(i,n))},_getCoreCardUINodes:function(){return this._rootWidget.getChildren().filter(function(e){var t=e.getName()||"";return 0===t.indexOf("corecard_")&&t.indexOf("_ui")>0})},_createOrGetCoreCardUI:function(e,n){var i=e.getUserData();if(i instanceof t.CoreCardUI)return i;var a=this._createCoreCardUI(e,e),o={handler:this._touchHandler,view:this,index:n};return e.seekWidgetByName("blank_touch_panel").addTouchEventListener(this._touchEvent,o),a.addTouchEventListener(this._touchEvent,o),a},setCandidatePagerController:function(e){this._candidateController=e}})}((this||0).self||global),function(e){var t=e.kh;e.khutil,e.cc,e.ccui,e._,e.console,t.createNameSpaceIfNotExists("kh.party.view"),t.party.view.PartyAcceOrganizationUi=t.core.pager.view.page.CoreCardUi.extend({className:"PartyAcceOrganizationUi",_candidateController:null,_listModel:null,update:function(e,t,n){this._rootWidget&&!this._rootWidget.dispose&&(this._listModel=t,this._super.apply(this,arguments))},_updateOne:function(e,t,n,i){var a=e[i],o=this._createOrGetCoreCardUI(n.getChildByName("corecard_chara_ui"),i);if(this._super.apply(this,arguments),o.setIconOrganized(!1),this._updateTotalLabel(o,a,t),this._updateBlankTouchPanel(a,n,o),this._updateAcceEquipStatus(a,n,o),this._candidateController){var r=this._candidateController.getSelectedData()[0];if(!r)return void n.seekWidgetByName("selecting_frame").setVisible(!1);var s=r&&this._listModel.canEquip(i,r);n.seekWidgetByName("selecting_frame").setVisible(s)}},_updateBlankTouchPanel:function(e,n,i){return!e||e instanceof t.party.model.APartyRemnant?(i.clearImg(),i.initAction("plain"),n.seekWidgetByName("blank_touch_panel").setVisible(!0),void n.setVisible(!0)):(n.seekWidgetByName("blank_touch_panel").setVisible(!1),i.setIconOrganized(!1),void n.seekWidgetByName(i.IMG_NODE_NAME).setVisible(!0))},_updateAcceEquipStatus:function(e,t,n){var i=t.seekWidgetByName("filter");if(i.getChildren().forEach(function(e){/acce_(lock|equip)/.test(e.getName())&&e.setVisible(!1)}),e.getMaxAccessoryEquipCount){var a=e.getMaxAccessoryEquipCount();e.getAccessories().forEach(function(e,t){return e?void i.seekWidgetByName("acce_equip_red_"+(t+1)).setVisible(!0):t<a?void i.seekWidgetByName("acce_equip_black_"+(t+1)).setVisible(!0):3===t?void i.seekWidgetByName("acce_lock_blue").setVisible(!0):void i.seekWidgetByName("acce_lock_red").setVisible(!0)})}},_getDetailMode:function(){return t.pc.party.par_pick_member_acce.MODE.ACCE},_updateTotalLabel:function(e,t,n){var i=t.getRawData();i.hp=t.getHp(),i.attack=t.getAttackPoint(),e.setTotalLabel(e.getTotalLabel(i,n))},_getCoreCardUINodes:function(){return this._rootWidget.getChildren().filter(function(e){var t=e.getName()||"";return 0===t.indexOf("corecard_")&&t.indexOf("_ui")>0})},_createOrGetCoreCardUI:function(e,n){var i=e.getUserData();if(i instanceof t.CoreCardUI)return i;var a=this._createCoreCardUI(e,e),o={handler:this._touchHandler,view:this,index:n};return a.addTouchEventListener(this._touchEvent,o),a},setCandidatePagerController:function(e){this._candidateController=e}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc,e.ccui,e._);e.console,t.createNameSpaceIfNotExists("kh.party.view"),t.party.view.AcceOutlineUi=t.core.pager.view.page.SelectableCoreCardUi.extend({className:"AcceOutlineUi",_aPartyId:null,_sceneController:null,ctor:function(e,t,n){this._super.apply(this,arguments),this._aPartyId=n.aPartyId,this._sceneController=n.sceneController},_updateOne:function(e,n,i,a){var o=e[a];if(this._super.apply(this,arguments),o){var r=this._createOrGetCoreCardUI(i,a),s=o.getEquippedPartyStatus(this._aPartyId),c=t.acce.enum.PARTY_STATUS;r.setIconEquipped(s===c.UNKNOWN);var u=r.getResult();u.getChildByName("icon_self_party").setVisible(s===c.SELF_PARTY),u.getChildByName("icon_other_party").setVisible(s===c.OTHER_PARTY),u.getChildByName("icon_out_of_party").setVisible(s===c.OUT_OF_PARTY),this._updateDetailButton(u,o)}},_updateDetailButton:function(e,i){var a=this._controller.getSelectNumber(i),o=e.seekWidgetByName("btn_detail");if(o){if(a<=0)return void o.setVisible(!1);o.setVisible(!0),t.setTouchEventHandlers(o.getParent(),{"TOUCH_ENDED btn_detail":function(){i.openDetailPopup().then(function(e){(n.isArray(e)||n.isNumber(e))&&this._sceneController.updateAll()}.bind(this))}.bind(this)})}}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc,e.ccui,e._),i=e.console;t.createNameSpaceIfNotExists("party.model"),t.party.model.OrganizationDataList=t.core.pager.model.BaseList.extend({className:"OrganizationDataList",_fetchComplete:!0,ctor:function(e){return n.isArray(e)?void(this._cachedModels=[].concat(e)):void i.error("PlainDataList construct need array",e)},change:function(e,n){if(!this.canOrganize(e,n))throw new Error(":"+n.getAId()+"=>pos:"+e+" "+this._cachedModels.map(function(e){return e.getAId()+"-"+e.getGroupId()}));var i=this.getPos(n);if(i>-1)this.changePos(e,i);else{var a=n||new t.party.model.APartyRemnant;this._cachedModels.splice(e,1,a)}},changePos:function(e,t){if(e===t||!n.isNumber(e)||!n.isNumber(t))throw new Error("OrganizationDataList.changePos : "+e+"-"+t);var i=this._cachedModels[e],a=this._cachedModels[t];this._cachedModels.splice(e,1,a),this._cachedModels.splice(t,1,i)},getPos:function(e){return n.findIndex(this._cachedModels,function(t){return t.equal(e)})},canOrganize:function(e,i){return!i||!(i instanceof t.party.model.APartyRemnant&&this._cachedModels[e]instanceof t.party.model.APartyRemnant)&&-1===n.findIndex(this._cachedModels,function(t,n){return!(e!==n||!t.equal(i))||e!==n&&i.getGroupId()===t.getGroupId()&&i.getAId()!==t.getAId()})},canEquip:function(e,n){return!n||!(this._cachedModels[e]instanceof t.party.model.APartyRemnant)&&this._cachedModels[e].canEquip(n)},contains:function(e){return this._cachedModels.filter(function(t){return t.equal(e)}).length>0},getMaxRecordCount:function(){return this._cachedModels.length},clearCache:function(){}})}((this||0).self||global),function(e){var t=e.kh;e.cc,t.createNameSpaceIfNotExists("party.eventHandling"),t.party.eventHandling.PartyCandidateTouchEvent=t.core.eventHandling.BaseEventHandler.extend({className:"PartyCandidateTouchEventHandler",_candidatePagerController:null,_partyController:null,ctor:function(e,t){this._candidatePagerController=e,this._partyController=t},handle:function(e){var t=this._candidatePagerController.getSelectedData()[0],n=this._partyController.getSelectedData()[0];if(!n||e===t)return this._candidatePagerController.toggleSelect(e),this._candidatePagerController.refresh(),void this._partyController.refresh(!0,!0);var i=this._partyController.getDataList(),a=i.getPos(n);i.canOrganize(a,e)&&(i.change(a,e),this._candidatePagerController.refresh(!0,!0),this._partyController.refresh(!0,!0))}})}((this||0).self||global),function(e){var t=e.kh;e.cc,t.createNameSpaceIfNotExists("party.eventHandling"),t.party.eventHandling.PartyOrginizationTouchEvent=t.core.eventHandling.BaseEventHandler.extend({className:"PartyOrganizationTouchEventHandler",_candidatePagerController:null,_partyController:null,ctor:function(e,t){this._candidatePagerController=e,this._partyController=t},handle:function(e,n,i){var a=this._candidatePagerController.getSelectedData()[0],o=this._partyController.getSelectedData()[0];if(!a&&!o||o===e)return this._partyController.toggleSelect(e),this._partyController.refresh(),void this._candidatePagerController.refresh(!0,!0);if(e instanceof t.party.model.APartyRemnant&&o instanceof t.party.model.APartyRemnant)return!1;var r=this._partyController.getDataList();return o?(r.changePos(i,r.getPos(o)),void this._partyController.refresh(!0,!0)):void(r.canOrganize(i,a)&&(r.change(i,a),this._candidatePagerController.refresh(!0,!0),this._partyController.refresh(!0,!0)))}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;t.ListManager=n.Class.extend({resource:null,ctor:function(t,n,i){var a=e.res;n&&(this.resource=ccs.load($dynamicRes(a[n])),null==this.resource.node&&console.error("resource.node is undefined: ",n)),this.listNodes=t,this.addedWidgetList=[],this.recordWidgetInitializeFunc=i},clear:function(e){i.each(this.addedWidgetList,function(t){e&&t.parent&&t.parent.setVisible(!1),t.removeFromParent()}),this.addedWidgetList=[],clearTimeout(this.listTimerId)},setRecords:function(e,t){this.clear(t),this._setRecord(e,0)},_setRecord:function(e,n){0===(n=n||0)&&t.createInstance("notificationCenter").dispatchEvent("listUpdate:Start",[i.clone(this.listNodes)]),this.listTimerId=i.delay(function(){var a=e[n];if(i.isUndefined(a))t.createInstance("notificationCenter").dispatchEvent("listUpdate:End",[i.clone(this.listNodes)]);else{var o=new ccui.Widget;this.resource&&o.addChild(this.resource.node.clone()),this.listNodes[n].addChild(o);try{this.recordWidgetInitializeFunc(o,a,n)}catch(e){console.error(e)}this.addedWidgetList.push(o),this._setRecord(e,n+1)}}.bind(this),5)}})}((this||0).self||global),function(e){var t=e.kh,n=e._;t.party.PartyListManager=t.ListManager.extend({_setRecord:function(e,i){0===(i=i||0)&&t.createInstance("notificationCenter").dispatchEvent("listUpdate:Start",[n.clone(this.listNodes)]),this.listTimerId=n.delay(function(){var a=e[i];if(n.isUndefined(a))t.createInstance("notificationCenter").dispatchEvent("listUpdate:End",[n.clone(this.listNodes)]);else{var o=this.listNodes[i].getChildren()[0];o||(o=new ccui.Widget,this.listNodes[i].addChild(o),this.resource&&o.addChild(this.resource.node.clone()));try{this.recordWidgetInitializeFunc(o,a,i)}catch(e){console.error(e)}this.addedWidgetList.push(o),this._setRecord(e,i+1)}}.bind(this),5)}})}((this||0).self||global),function(e){var t=e.kh;e.cc,e._,t.createNameSpaceIfNotExists("party.view"),t.party.view.ParAbilityChangeCheckPopup=t.ImplantedPopup.extend(t.pc.status.roles.AbilityCommon).extend({_initContents:function(e,n){this.setButtonEvents({btn_close:!1}),this.getNode().bfsWidgetByName("btn_close").setSound(t.SoundList.BUTTON_TOUCHED_CANCEL),this.getNode().bfsWidgetByName("title_label").setString(!n&&e.learned()?"":"");var i=e.getAllContent(),a=e.getSelectedAbility();this.getNode().bfsWidgetByName("introduce_popup_statuslist_list_3_ui").getChildren().forEach(function(t,o){var r=i[o];if(t.setVisible(!!r),r){this._setAbilityPanelStrings(t,r),r.createAbilityIconView(t).show(),t.bfsWidgetByName("ability_list_setting_up").setVisible(!n&&a.equal(r));var s=t.bfsWidgetByName("ability_list_base");if(!e.learned())return void s.setTouchEnabled(!1);s.setTouchEnabled(!0),s.addTouchEventListener(this._touchAbilityPanel,{abilityModel:r,abilitySlotModel:e,scene:this._getScene(),self:this})}},this)},_touchAbilityPanel:function(e,t){if(t===ccui.Widget.TOUCH_ENDED){var n=this.scene.popups.popupSelectAbilityChange,i=this.abilityModel,a=this.abilitySlotModel,o=this.self;n.openWithActions(function(){n.bfsWidgetByName("set_confirm_label").setVisible(!0),n.bfsWidgetByName("remove_confirm_label").setVisible(!1),this.self._fillAbilityPopup(n,i)}.bind(this),{blackBtn:function(){this.dismiss()},blueBtn:function(){this.dismiss(),o._dfd.resolve({abilityModel:i,abilitySlotModel:a}),o.dismiss(!0)}})}}}),t.dictx.registerWithProtoStrategy("ParAbilityChangeCheckPopup",t.party.view.ParAbilityChangeCheckPopup)}((this||0).self||global),function(e){var t=e.kh,n=e._;t.pc=t.pc||{};var i=(e.Q,{p_bonus_info:{factoryName:"popupFactoryPopupCommon",resourceName:function(){var e=n.findKey(res,function(e){return 0<e.indexOf("p_bonus_info.json")});return e||alert(": p_bonus_info.json"),e||""}(),title:"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(){this.dismiss()}}},q_002_sup_3:{factoryName:"popupFactoryPopupCommon",resourceName:function(){var e=n.findKey(res,function(e){return 0<e.indexOf("q_002_sup")});return e||alert(": q_002_sup"),e||""}(),title:"[]",buttonLabels:{blackBtn:"",blueBtn:""},buttons:{blackBtn:function(){this.dismiss()},blueBtn:function(){alert("{{a_q_002 q_caution_1q_002_over}}")}}},p_skill_info:{factoryName:"popupFactoryTextOnly",content:"",title:"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(){this.dismiss()}}},p_001_autoorg:{factoryName:"popupFactoryPopupCommon",resourceName:function(){var e=n.findKey(res,function(e){return 0<e.indexOf("p_001_autoorg")});return e||alert(": p_001_autoorg"),e||""}(),title:"",buttonLabels:{blackBtn:"",blueBtn:""},buttons:{blackBtn:function(){this.dismiss()},blueBtn:function(){alert("popup,p_001_orgend")}}},p_001_orgend:{factoryName:"popupFactoryPopupCommon",resourceName:function(){var e=n.findKey(res,function(e){return 0<e.indexOf("p_orgend")});return e||alert(": p_orgend"),e||""}(),title:"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(){this.dismiss()}}},p_002_autoorg:{factoryName:"popupFactoryPopupCommon",resourceName:function(){var e=n.findKey(res,function(e){return 0<e.indexOf("p_autoorg")});return e||alert(": p_autoorg"),e||""}(),title:"",buttonLabels:{blackBtn:"",blueBtn:""},buttons:{blackBtn:function(){this.dismiss()},blueBtn:function(){alert("popup,p_002_orgend")}}},p_002_orgend:{factoryName:"popupFactoryPopupCommon",resourceName:function(){var e=n.findKey(res,function(e){return 0<e.indexOf("p_orgend")});return e||alert(": p_orgend"),e||""}(),title:"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(){this.dismiss()}}},p_003_autoorg:{factoryName:"popupFactoryPopupCommon",resourceName:function(){var e=n.findKey(res,function(e){return 0<e.indexOf("p_autoorg")});return e||alert(": p_autoorg"),e||""}(),title:"",buttonLabels:{blackBtn:"",blueBtn:""},buttons:{blackBtn:function(){this.dismiss()},blueBtn:function(){alert("popup,p_003_orgend")}}},p_003_orgend:{factoryName:"popupFactoryPopupCommon",resourceName:function(){var e=n.findKey(res,function(e){return 0<e.indexOf("p_orgend")});return e||alert(": p_orgend"),e||""}(),title:"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(){this.dismiss()}}},menu_list:{factoryName:"popupFactoryPopupCommon",resourceName:function(){var e=n.findKey(res,function(e){return 0<e.indexOf("menu_chat")});return e||alert(": menu_chat"),e||""}(),title:"",buttonLabels:{blackBtn:""},buttons:{blackBtn:function(){this.dismiss()}}}});t.pc.party=t.pc.party||{},t.pc.party.par_001_002_003=t.pc.party.par_001_002_003||{},t.pc.party.par_001_002_003.Scene=t.BaseScene.extend({resourceFileName:"par_001_2_3/par_001_2_3.json",isLoopDefaultView:!1,_popups:i,tabDelegateConfig:[{tab1:{node:"tab_0","content-node":"par_001_ui"},tab2:{node:"tab_1","content-node":"par_002_ui"},tab3:{node:"tab_2","content-node":"par_003_ui"}}],componentName:"party",sceneName:"par_001_002_003",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"par_001_party_change","btnCallbackPar001PartyChange",null,function(){alert("{{popup p_party_change}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_party_switch","btnCallbackBtnPartySwitch",null,function(){alert("{{}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_back_quest","btnCallbackBtnBackQuest",null,function(){alert("{{parq_002_sup_1_2_3}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_back_acce","btnCallbackBtnBackAcce",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"acce/acce_006")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_back_tower","btnCallbackBtnBackTower",null,function(){alert("{{parq_002_sup_1_2_3}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"par_btn_advice","btnCallbackParBtnAdvice",null,function(){alert("{{}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_bonus","btnCallbackBtnBonus",null,function(){alert("pupup")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_skill","btnCallbackBtnSkill",null,function(e){this.popups.p_skill_info.open(e)}),this._initButtonEvent.call(this,this.seekWidgetByPath("par_001_ui"),"btn_detail","btnCallbackPar001UiBtnDetail",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"party/par_004")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_acce_change","btnCallbackBtnAcceChange",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"party/par_pick_member_acce")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_organize_all","btnCallbackBtnOrganizeAll",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"party/par_pick_member_acce")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_support_summon","btnCallbackBtnSupportSummon",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"profile/prf_001_myself")),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._),i=e.Q;t.pc=t.pc||{},t.pc.party=t.pc.party||{},t.pc.party.par_001_002_003=t.pc.party.par_001_002_003||{},t.pc.party.par_001_002_003.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../par_popup_ui.json"],_popups:{p_bonus_info:{factoryName:"popupFactoryPopupCommon",resourceName:function(){var e=n.findKey(res,function(e){return 0<e.indexOf("p_bonus_info.json")});return e||alert(": p_bonus_info.json"),e||""}(),title:"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(){this.dissmiss()}}},q_002_sup_3:{factoryName:"popupFactoryPopupCommon",resourceName:function(){var e=n.findKey(res,function(e){return 0<e.indexOf("q_002_sup")});return e||alert(": q_002_sup"),e||""}(),title:"[]",buttonLabels:{blackBtn:"",blueBtn:""},buttons:{blackBtn:function(){this.dissmiss()},blueBtn:function(){alert("{{a_q_002 q_caution_1q_002_over}}")}}},p_skill_info:{factoryName:"popupFactoryTextOnly",content:"",title:"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(){this.dissmiss()}}},p_001_autoorg:{factoryName:"popupFactoryPopupCommon",resourceName:function(){var e=n.findKey(res,function(e){return 0<e.indexOf("p_001_autoorg")});return e||alert(": p_001_autoorg"),e||""}(),title:"",buttonLabels:{blackBtn:"",blueBtn:""},buttons:{blackBtn:function(){this.dissmiss()},blueBtn:function(){alert("popup,p_001_orgend")}}},p_001_orgend:{factoryName:"popupFactoryPopupCommon",resourceName:function(){var e=n.findKey(res,function(e){return 0<e.indexOf("p_orgend")});return e||alert(": p_orgend"),e||""}(),title:"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(){this.dissmiss()}}},p_002_autoorg:{factoryName:"popupFactoryPopupCommon",resourceName:function(){var e=n.findKey(res,function(e){return 0<e.indexOf("p_autoorg")});return e||alert(": p_autoorg"),e||""}(),title:t.w("weapon")+"",buttonLabels:{blackBtn:"",blueBtn:""},buttons:{blackBtn:function(){this.dissmiss()},blueBtn:function(){alert("popup,p_002_orgend")}}},p_002_orgend:{factoryName:"popupFactoryPopupCommon",resourceName:function(){var e=n.findKey(res,function(e){return 0<e.indexOf("p_orgend")});return e||alert(": p_orgend"),e||""}(),title:t.w("weapon")+"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(){this.dissmiss()}}},popupPartyInUse:{factoryName:"popupFactoryTextOnly",title:"",content:'<p style="line-height: 1.3"><br /><br /><br /></p>',buttonLabels:{redBtn:"",blueBtn:""},buttons:{redBtn:function(e){this.dismiss(),e._delegate._popupPartyInUse=null,t.createInstance("router").navigate("quest/q_001",{})},blueBtn:function(e){this.dismiss(),e._delegate._popupPartyInUse=null,e._delegate.btnCallbackPar001PartyChange(e)}}},popupConfirmBonus:{factoryName:"popupFactoryComConfirmBonus"},popupConfirmSkillInfo:{factoryName:"popupFactoryTextOnlyVariableSize",title:"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){this.dismiss()}}},popupPartyAutoOrg:{factoryName:"popupFactoryComPartyAutoOrg"},popupWeaponSummonAutoOrg:{factoryName:"popupFactoryComWeaponSummonAutoOrg"},popupAutoOrgResult:{factoryName:"popupFactoryPopupCommon",resourceName:"core-popup-p_orgend",title:"",buttonLabels:{blueBtn:"OK"},buttonSounds:{blueBtn:t.SoundList.BUTTON_TOUCHED_CONFIRMED},buttons:{blueBtn:function(e){this.dismiss()}}},popupWhatIsAutoOrg:{factoryName:"popupFactoryBlue",buttonLabels:{blueBtn:"OK"},buttonSounds:{blueBtn:t.SoundList.BUTTON_TOUCHED_CONFIRMED},buttons:{blueBtn:function(e){this.dismiss()}}},popupCharChange:{factoryName:"popupFactoryComCharChange"},popupWeaponSummonChange:{factoryName:"popupFactoryPopupCommon",resourceName:"core-popup-p_weapon_summon_change",buttonLabels:{blueBtn:"OK"},buttonSounds:{blueBtn:t.SoundList.BUTTON_TOUCHED_CONFIRMED},buttons:{blueBtn:function(e){this.dismiss()}}},popupWeaponMain:{factoryName:"popupFactoryPopupCommon",title:""+t.w("weapon")+"",resourceName:"core-popup-p_weapon_main",buttonLabels:{blackBtn:"",blueBtn:""},buttons:{blackBtn:function(e){this.dismiss()},blueBtn:function(e){e._sceneNavigate.toParty013(0).navigate(),this.dismiss()}}}},_popupPartyInUse:null,onSceneInit:function(e){var n=(i.defer(),this.getDefaulTab(e)),a="selected";e.routerParams.party&&isFinite(e.routerParams.party.party_id)&&(a=e.routerParams.party.party_id,t.createInstance("apiAParties").changeDeck(a),e._sceneNavigate.changeParty(a)),this._setBackBtn(e),e.seekWidgetByName("btn_back_quest").setSound(t.SoundList.BUTTON_TOUCHED_CANCEL);var o=this._tutorialPromiss.then(function(){return this._loadPartyData(e,!1,n,a)}.bind(this),function(){return this._loadPartyData(e,!1,n,a)}.bind(this));this._accessoryInfoPromise&&this._accessoryInfoPromise.then(function(n){t.pc.roles.UIUtility._setGrayOutButton(e.seekWidgetByName("btn_acce_change"),n.canBeUsed())});var r=t.createInstance("apiASubTutorialPages"),s=this._tutorialPromiss.fail(r.get.bind(r,"party")).then(function(e){return e&&e.body?e.body.visited?i.reject():r.visited("party"):i.reject()}.bind(this)).then(function(){this.__waitForNodesLoaded().then(this._openSubTutorialPopup.bind(this,e))}.bind(this)).fail(function(e){e&&t.createInstance("smartBeat").sendError(e)});return i.all([o.promise,s])},onSceneEnter:function(e){this._tutorialPromiss=t.tutorial.startTutorialIfNeed(e);var n=t.createInstance("accessoryInfoModel");return this._accessoryInfoPromise=n.prepare().then(function(){return n}),i.resolve()},onSceneExit:function(e){return this._accessoryInfoPromise=null,i.resolve()},tabCallbackTab0:function(e){e.routerParams.tab="members"},tabCallbackTab1:function(e){this._activeWeaponTab(e),e.routerParams.tab="weapon"},tabCallbackTab2:function(e){e.routerParams.tab="summon"},btnCallbackParBtnAdvice:function(e){switch(this._getCurrentTabType(e)){case"members":this.showPopupP001Autoorg(e);break;case"weapon":this._showPopupP002Autoorg(e);break;case"summon":this._showPopupP003Autoorg(e)}return i.reject(this._override)},btnCallbackBtnAcceChange:function(e){return this._accessoryInfoPromise?(this._accessoryInfoPromise.then(function(n){if(n.canBeUsed())this._navigateToPickAcce(e,this._deck);else{var i=t.ImplantedPopup.createOrGet(e,"book_request_rank","CanNotUseAccessoryPopup");i.setButtonEvents({btn_ok:!0}),i.open()}}.bind(this)).fail(function(e){e&&console.error(e)}),i.reject(this._override)):i.reject(this._override)},btnCallbackBtnOrganizeAll:function(e){return this._navigateToPickMember(e,this._deck),i.reject(this._override)},btnCallbackPar001PartyChange:function(e){return t.createInstance("apiAParties").getDecks().then(function(i){return t.ImplantedPopup.createOrGet(e,"p_party_change","ChangePartyPopup").open(e,i.body.decks).then(function(){var t=this.getDefaulTab(e);return this._loadPartyData(e,!0,t,"selected")}.bind(this)).fail(function(t){n.isBoolean(t)||(this._deck.in_use?this._showPopupP001Doing(e):this._popupPartyInUse&&this._popupPartyInUse.dismiss())}.bind(this))}.bind(this)).fail(function(e){e&&e.stack&&console.error(e)}),i.reject(this._override)},btnCallbackBtnPartySwitch:function(e){var t=i.defer();return t.reject(this._override),t.promise},btnCallbackBtnSupportSummon:function(e){var n=i.defer();n.reject(this._override);var a=t.createInstance("apiASubTutorialPages");return a.get("support_summon").then(function(t){t.body.visited?this._navigateToPrf001():(a.visited("support_summon"),this._showSupportSummonInfoPopup(e))}.bind(this)).fail(function(e){console.error(e.stack)}),n.promise},_showSupportSummonInfoPopup:function(e){return t.ImplantedPopup.createOrGet(e,"p_support_summon_config_description","SupportSummonInfoPopup").open().then(function(){}.bind(this)).then(function(){this._navigateToPrf001()}.bind(this)).fail(function(e){console.error(e.stack)})},btnCallbackBtnBackQuest:function(e){return e._sceneNavigate.toBackOutside().navigate(),i.reject(this._override)},btnCallbackBtnBonus:function(e){var t=i.defer();return t.reject(this._override),this.__showPopupPBonus(e),t.promise},btnCallbackPar001UiBtnDetail:function(e){return this.__gotoPar004A(e),i.reject(this._override)},btnCallbackBtnSkill:function(e){var t=i.defer();return t.reject(this._override),t.promise},getDefaulTab:function(e){var i;if(e.routerParams=e.routerParams||{},"members"===e.routerParams.tab?i="tab_0":"weapons"===e.routerParams.tab?i="tab_1":"summons"===e.routerParams.tab?i="tab_2":e.restoreParams||(i="tab_0"),n.isString(e.routerParams.tab))return delete e.routerParams.tab,i;switch(t.createInstance("router").getCurrentSceneName()){case"par_001":return"tab_0";case"par_002":return"tab_1";case"par_003":return"tab_2";default:return i}},_loadPartyData:function(e,n,i,a){return t.createInstance("apiAParties").getDeck(a).then(function(t){this._deck=t.body.deck,this._a_party_id=t.body.a_party_id,"selected"===a&&e._sceneNavigate.changeParty(this._a_party_id),e.seekWidgetByName("header_sub_label").setString(this._deck.name||""),this._setupMemberTab(e,this._deck),this.__waitForNodesLoaded().then(function(){this._setupWeaponTab(e,this._deck),this._setupSummonTab(e,this._deck)}.bind(this)),this._deck.in_use?this._popupPartyInUse||this._showPopupP001Doing(e):this._popupPartyInUse&&this._popupPartyInUse.dismiss(),!1===n&&(this._prepareQuestBackButton(e),this._comeFromPar010(e,this._deck),this._comeFromPar014(e,this._deck),this._comeFromPar017(e,this._deck),e.restoreParams||e.tabDelegateList[0].selectTab(e.seekWidgetByName(i))),e.headerDelegate.updateBattlePower()}.bind(this)).fail(function(e){e&&e.stack&&console.error(e)})},btnCallbackBtnBackTower:function(e){return this._touchEndedBackBtnProcess(e),i.reject(this._override)},_touchEndedBackBtnProcess:function(e){e._sceneNavigate.toBackOutside().navigate()},_openSubTutorialPopup:function(e){return t.ImplantedPopup.createOrGet(e,"sub_tutorial","ImplantedSubTutorialPopup").open("party",4)},_getCurrentTabType:function(e){switch(e.tabDelegateList[0].selected){default:case"tab_0":return"members";case"tab_1":return"weapon";case"tab_2":return"summon"}}}),n.assign(t.pc.party.par_001_002_003.SceneDelegate.prototype,t.pc.roles.IconsCommon,t.pc.party.roles.Routing)}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;e.Q,i.assign(t.pc.party.par_001_002_003.SceneDelegate.prototype,{_prepareQuestBackButton:function(e){var t=e.seekWidgetByName("par_btn_back_quest_acce_ui");return e.routerParams,e._sceneNavigate.isFromTower?void t.setAppearance("back_tower"):e._sceneNavigate.isFromQuest?void t.setAppearance("back_quest"):void t.setAppearance("no_back")},_showPopupP001Doing:function(e){e.popups.popupPartyInUse.open(),this._popupPartyInUse=e.popups.popupPartyInUse},_comeFromPar010:function(e,n){var a=e.temporaryRouterParams.par_001;i.isEmpty(a)||i.isUndefined(a.number)||i.isUndefined(a.id)||(e.popups.popupCharChange.open({character:n.characters[a.number]}),t.createInstance("router").removeCurrentTemporaryParamsFromHistory())},_comeFromPar014:function(e,n){var a=e.temporaryRouterParams.par_002;if(!i.isEmpty(a)&&!i.isUndefined(a.newnumber)){var o=n.weapons[a.newnumber],r=e.popups.popupWeaponSummonChange;r.setTitle(t.w("weapon")+""),r.open().then(function(){var i=t.createInstance("CoreCardWeaponUI",["e_r"]);i.setAroused(o.is_aroused),i.setImg(o.weapon_id,o.skin),i.setIconElement(o.element_type),i.setIconRarity(o.rare);var a=i.getResult();r.seekWidgetByName("core_img").addChild(a),r.seekWidgetByName("core_img").setVisible(!0),r.seekWidgetByName("equipment_label").setString(o.name+"");var s=e.routerParams.par_before.before_hp,c=e.routerParams.par_before.before_attack,u=n.total_weapon_hp-s,l=n.total_weapon_attack-c;r.setHtmlStrings({hp_calc_labelimg:"<span class='white'>"+s+"</span><span class='gray'>"+n.total_weapon_hp+"("+(u>0?"+":"")+u+")</span>",attack_calc_labelimg:"<span class='white'>"+c+"</span><span class='gray'>"+n.total_weapon_attack+"("+(l>0?"+":"")+l+")</span>"},t.GameConfig.POPUP_CSS),t.createInstance("router").removeCurrentTemporaryParamsFromHistory()}.bind(this))}},_comeFromPar017:function(e,n){var a=e.temporaryRouterParams.par_003;if(!i.isEmpty(a)&&!i.isUndefined(a.newnumber)){var o=n.summons[a.newnumber],r=e.popups.popupWeaponSummonChange;r.setTitle(""),r.open().then(function(){var i=t.createInstance("CoreCardSummonUI");i.setImg(o.summon_id,o.skin),i.setIconElement(o.element_type),i.setIconRarity(o.rare);var a=i.getResult();r.seekWidgetByName("core_img").addChild(a),r.seekWidgetByName("core_img").setVisible(!0),r.seekWidgetByName("equipment_label").setString(o.name+"");var s=e.routerParams.par_before.before_hp,c=e.routerParams.par_before.before_attack,u=n.total_summon_hp-s,l=n.total_summon_attack-c;r.setHtmlStrings({hp_calc_labelimg:"<span class='white'>"+s+"</span><span class='gray'>"+n.total_summon_hp+"("+(u>0?"+":"")+u+")</span>",attack_calc_labelimg:"<span class='white'>"+c+"</span><span class='gray'>"+n.total_summon_attack+"("+(l>0?"+":"")+l+")</span>"},t.GameConfig.POPUP_CSS),t.createInstance("router").removeCurrentTemporaryParamsFromHistory()}.bind(this))}},_changeParty:function(e,n){this._loadPartyData(e,!0,null,n),t.createInstance("apiAParties").changeDeck(n)},showPopupP001Autoorg:function(e){var n=t.ImplantedPopup.createOrGet(e,"p_001_autoorg","ComPartyAutoOrgPopup"),i=e.popups.popupWhatIsAutoOrg;return this._setAutoorgAddEventListener("popupAutoOrgAll"),n.open(i)},_setAutoorgAddEventListener:function(e){var n=t.createInstance("notificationCenter").addEventListener(e,function(e,i){this._selectPartyAutoOrg(e,i),t.createInstance("notificationCenter").removeEventListener(n)},this)},_selectPartyAutoOrg:function(e,i){var a=null;"character"===e&&(a=this._getCheckedRarities(i),e+=i.seekWidgetByName("btn_checkbox_include_weapon").bright?"":"|weapon",e+=i.seekWidgetByName("btn_checkbox_include_summon").bright?"":"|summon");var o=this._findElementSelector(i);t.createInstance("apiAParties").makeRecommendedDeck(this._a_party_id,e,o,a).then(function(t){var i=n.director.getRunningScene(),a=t.body.deck;e.indexOf("character")>=0?(this._showPopupAutoorgResult("","",this._deck.job.hp,this._deck.job.attack,a.job.hp,a.job.attack),this._setupMemberTab(i,a),this._setupWeaponTab(i,a),this._setupSummonTab(i,a)):"weapon"===e?(this._showPopupAutoorgResult("","",this._deck.total_weapon_hp,this._deck.total_weapon_attack,a.total_weapon_hp,a.total_weapon_attack),this._setupWeaponTab(i,a),this._setupMemberTab(i,a)):"summon"===e&&(this._showPopupAutoorgResult("","",this._deck.total_summon_hp,this._deck.total_summon_attack,a.total_summon_hp,a.total_summon_attack),this._setupSummonTab(i,a),this._setupMemberTab(i,a)),this._deck=a,i.headerDelegate.updateBattlePower()}.bind(this)).fail(function(e){console.error(e)})},_findElementSelector:function(e){var t=0,n={0:0,1:1,2:2,3:3,4:5,5:4,6:9};return i.each(i.range(7),function(i){!1===e.seekWidgetByName("btn_set_element_"+i).bright&&(t=n[i])},this),t},_getCheckedRarities:function(e){var t=[];return e.seekWidgetByName("btn_checkbox_ssr").bright||t.push("ssrare"),e.seekWidgetByName("btn_checkbox_sr").bright||t.push("srare"),e.seekWidgetByName("btn_checkbox_r").bright||t.push("rare"),t},_showPopupAutoOrgDescription:function(e,n,i){return function(){t.setTouchEventHandlers(e,{"TOUCH_ENDED btn_org_hint":function(){var e=n;e.open().then(function(){e.setTitle("");var n="";"weapon"===i&&(n="");var a='<div style="text-align: left;"><br />'+n+"<br /><br />"+t.w("chara")+","+t.w("weapon")+","+t.w("summon")+"<br /><br />"+t.w("weapon")+""+t.w("weapon")+"<br />"+t.w("weapon")+"</div>";e.setContent(a),e.seekWidgetByName("popup_base").height=354,e.seekWidgetByName("title_label").y=280,e.seekWidgetByName("popup_labelimg").y=214}).fail(function(e){console.error(e)})}})}},_showPopupP002Autoorg:function(e){var t="popupAutoOrgWeapon",n=e.popups.popupWeaponSummonAutoOrg;n.open({target:"weapon",autoOrgButtonHandler:this._showPopupAutoOrgDescription(n,e.popups.popupWhatIsAutoOrg,"weapon"),doneEventName:t}),this._setAutoorgAddEventListener(t)},_showPopupP003Autoorg:function(e){var t="popupAutoOrgSummon",n=e.popups.popupWeaponSummonAutoOrg;n.open({target:"summon",autoOrgButtonHandler:this._showPopupAutoOrgDescription(n,e.popups.popupWhatIsAutoOrg,"summon"),doneEventName:t}),this._setAutoorgAddEventListener(t)},_showPopupAutoorgResult:function(e,i,a,o,r,s){var c=n.director.getRunningScene().popups.popupAutoOrgResult;c.open().then(function(){c.seekWidgetByName("title_label").setString(e),c.seekWidgetByName("orgend_label").setString(i),c.setHtmlStrings({hp_calc_labelimg:"<span class='white'>"+a+"</span><span class='gray'>"+r+"("+(r-a)+")</span>",attack_calc_labelimg:"<span class='white'>"+o+"</span><span class='gray'>"+s+"("+(s-o)+")</span>"},t.GameConfig.POPUP_CSS)}.bind(this)).fail(function(e){console.error(e)})}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;e.Q,i.assign(t.pc.party.par_001_002_003.SceneDelegate.prototype,{_setCardStrings:function(e,t){i.isUndefined(t.name)||null===e.seekWidgetByName("name_label")||e.setStrings({name_label:t.name}),i.isUndefined(t.attack)||null===e.seekWidgetByName("attack_no")||e.setStrings({attack_no:t.attack}),i.isUndefined(t.hp)||null===e.seekWidgetByName("hp_no")||e.setStrings({hp_no:t.hp}),i.isUndefined(t.level)||null===e.seekWidgetByName("level_label")||e.setStrings({level_label:"Lv "+t.level});var n=e.seekWidgetByName("plus_no");if(!i.isUndefined(t.bonus)&&null!==n){var a=t.bonus>0;n.setVisible(a),n.setString(a?"+"+t.bonus:"")}},_setForteIcon:function(e,t){return null===e?void console.error("iconNode is null."):i.isUndefined(t)?void console.error("weaponName is undefined."):void e.loadTexture("core/res/icon/weapontypeicon_"+t+".png",ccui.Widget.PLIST_TEXTURE)},_setupMemberTab:function(e,n){var i=n.job,a=e.seekWidgetByName("par_001_ui");this._setupJobPanel(a,i);var o,r,s=e.seekWidgetByName("par_001_membar_page"),c=s.getChildByName("default");c?(o=c.seekWidgetByName("main_member_labelbar").getParent(),r=c.seekWidgetByName("sub_member_labelbar").getParent(),o=this._setupMainMemberNode(o,n.characters.slice(0,4)),r=this._setupSubMemberNode(r,n.characters.slice(4,6)),c.initialize([o,r]),c.onEnter()):(c=new t.PageView,o=this._makeMainMemberNode(n.characters.slice(0,4)),r=this._makeSubMemberNode(n.characters.slice(4,6)),c.initialize([o,r]),s.addChild(c)),c.gotoFirstPage(),this._showMainView=!0,e.seekWidgetByName("btn_party_switch").addTouchEventListener(function(e,t){t===ccui.Widget.TOUCH_ENDED&&(this._showMainView?c.gotoNextPage():c.gotoPreviousPage(),this._showMainView=!this._showMainView)},this)},_setupJobPanel:function(e,a){var o=e.seekWidgetByName("partymain_job");o.getChildByName("illust-com-kneeshot_job").loadTexture(t.Img("illust-com-kneeshot","job",i.padZero(a.job_id,4),0).png),this._setCardStrings(e,a),this._setSkillButton(o,a.skill_info);var r="party/res/par_001_2_3/par_main_bg_"+{basic:"R",upper:"SR",uppermost:"SSR",highjob:"SSR_arousal"}[a.rank]+".jpg";e.seekWidgetByName("rarity_bg").loadTexture(r,ccui.Widget.PLIST_TEXTURE),e.seekWidgetByName("job_touch_panel").addTouchEventListener(function(e,i){t.pressButtonEmulate(e,"btn_job_blank",i),i===ccui.Widget.TOUCH_ENDED&&this.__gotoPar006A(n.director.getRunningScene())}.bind(this))},_makeMainMemberNode:function(e){var t=ccs.load(res["party-par_001-par_001_main_member_ui"]).node;return this._setupMainMemberNode(t,e)},_setupMainMemberNode:function(e,n){var a=i.map(i.range(0,n.length),function(t){return e.seekWidgetByName("main_member_blank_"+t).seekWidgetByName("par_001_chara_card_ui")});$staticRes(res["party-par_001-par_001_chara_card_ui"]),new t.party.PartyListManager(a,"party-par_001-par_001_chara_card_ui",this._memberRecordWidgetInit.bind(this)).setRecords(n);var o=i.reject(n,i.isEmpty).length;return i.each(i.range(o,t.GameConfig.PARTY_SETTINGS.MAX_CHARACTER_COUNT),function(t){var n=e.seekWidgetByName("main_member_blank_"+t).seekWidgetByName("btn_main_member_blank");this._setCharacterTouchEvent(n,t)},this),e},_makeSubMemberNode:function(e){var t=ccs.load(res["party-par_001-par_001_sub_member_ui"]).node;return this._setupSubMemberNode(t,e)},_setupSubMemberNode:function(e,n){var a=i.map(i.range(0,n.length),function(t){return e.seekWidgetByName("sub_member_blank_"+t).seekWidgetByName("par_001_chara_card_ui")});return $staticRes(res["party-par_001-par_001_chara_card_ui"]),new t.party.PartyListManager(a,"party-par_001-par_001_chara_card_ui",this._subMemberRecordWidgetInit.bind(this)).setRecords(n,!1),i.each(i.range(t.GameConfig.PARTY_SETTINGS.MAX_SUB_COUNT),function(n){var i=e.seekWidgetByName("sub_member_blank_"+n).seekWidgetByName("btn_sub_member_blank"),a=t.GameConfig.PARTY_SETTINGS.MAX_CHARACTER_COUNT+n;this._setCharacterTouchEvent(i,a)},this),e},_subMemberRecordWidgetInit:function(e,n,i){this._memberRecordWidgetInit(e,n,t.GameConfig.PARTY_SETTINGS.MAX_CHARACTER_COUNT+i)},_setCharacterIconBattletype:function(e,t){var n=e.seekWidgetByName("icon_battletype");if(null!=n){var a=t.character_type;if(!i.isString(a)||"all"===a)return void n.setVisible(!1);if(n.setVisible(!0),"defense"===a)return void n.loadTexture("core/res/icon/battletypeicon_defence.png",ccui.Widget.PLIST_TEXTURE);var o="core/res/icon/battletypeicon_"+a+".png";n.loadTexture(o,ccui.Widget.PLIST_TEXTURE)}},_memberRecordWidgetInit:function(e,a,o){if(i.isUndefined(a.name))e.setVisible(!1);else{e.setVisible(!0),this._setCardStrings(e,a);var r=e.seekWidgetByName("touch_panel");this._setCharacterTouchEvent(r,o),this._setSkillButton(e,a.skill_info),this._setCharacterDetailButton(e,a,o);var s=this._getAppearanceCharacterId(a),c=(a.rare||"r").toUpperCase();a.is_aroused&&(c+="_arousal");var u="party/res/par_001_2_3/par_chara_weapon_bg_"+c+".jpg";e.seekWidgetByName("rarity_bg").loadTexture(u,ccui.Widget.PLIST_TEXTURE),e.seekWidgetByName("arousal_frame").setVisible(a.is_aroused);var l="party/res/par_001_2_3/par_chara_base_top_"+(a.rare||"r").toUpperCase()+".png";e.seekWidgetByName("base_top").loadTexture(l,ccui.Widget.PLIST_TEXTURE),e.loadTextures({"illust-com-kneeshot-chara":t.Img("illust-com-kneeshot","chara",i.padZero(s,4),a.skin||0).png}),this._setElementIconCommonRes(e,a,"icon_element"),a.max_overlimit_count>=3&&a.max_overlimit_count<=5&&this._setStarGauge(e,a),this._setRarityIcon(e,a,"icon_rarity"),this._setCharacterIconBattletype(e,a);var _=n.director.getRunningScene(),p=t.createInstance("router").getCurrentSceneName();if((_.routerParams.party||_.routerParams[p]||{}).from_tower){var d=e.seekWidgetByName("already_entry_label"),h=n.color("#FFFFFF");d.setVisible(!1),a.cannot_tower_enter&&(h=n.color("#808080"),d.setVisible(!0),d.setString(a.cannot_tower_enter_endat+"\n\n"));var m=e.seekWidgetByName("partysub_chara").seekWidgets(function(e){return 0===e.getChildren().length});i.invoke(m,"setColor",h)}}},_getAppearanceCharacterId:function(e){var t=e.character_id;return i.isUndefined(e.appearance)?t:e.appearance.used_character_id||t},_setStarGauge:function(e,n){t.createInstance("starGauge").init(e,{isAroused:n.is_aroused,blank:n.max_overlimit_count,gauge:n.overlimit_count})},_setSkillButton:function(e,n){i.isUndefined(n)||((e.seekWidgetByName("btn_skill"),e.seekWidgetByName("skill_label")).setString(""+n.length),0===n.length?t.setTouchEventHandlers(e,{"TOUCH_ENDED btn_skill":this.__showPopupNoPSkillInfo.bind(this,n)},this):t.setTouchEventHandlers(e,{"TOUCH_ENDED btn_skill":this.__showPopupPSkillInfo.bind(this,n)},this))},__showPopupPBonus:function(e){e.popups.popupConfirmBonus.open({bonus:this._deck.bonus_info})},__gotoPar004A:function(e){e._sceneNavigate.toParty004(this._deck.job.job_id).navigate()},__gotoPar006A:function(e){e._sceneNavigate.toParty006(this._deck.job.a_job_id).navigate()},__showPopupPSkillInfo:function(e){var t=n.director.getRunningScene().popups.popupConfirmSkillInfo,a="",o=i.map(e,function(e){return e.description}),r=i.groupBy(o,function(e){return e});i.each(r,function(e,t){a+='<li style="line-height: 24px">'+t+(e.length>1?" x "+e.length:"")+"</li>"}),t.open().then(function(){var e="<ul style='list-style-type: disc'>"+a+"</ul>",i=n.size(600,600);t.setContent(e,i),t.contentNode.y=360}.bind(this)).fail(function(e){console.error(e.stack)})},__showPopupNoPSkillInfo:function(e){var t=n.director.getRunningScene().popups.popupConfirmSkillInfo;t.open().then(function(){var e=n.size(600,600);t.setContent("",e),t.contentNode.y=360}.bind(this)).fail(function(e){console.error(e.stack)})},_setCharacterTouchEvent:function(e,i){e.addTouchEventListener(function(e,a){if(t.pressButtonEmulate(e,"btn_",a),a===ccui.Widget.TOUCH_ENDED){var o=n.director.getRunningScene();o&&o._sceneNavigate instanceof t.router.PartyNavigate&&o._sceneNavigate.toParty009(i).navigate()}},this)},_setCharacterDetailButton:function(e,n,i){e.bfsWidgetByName("btn_detail").addTouchEventListener(function(e,n){n===ccui.Widget.TOUCH_ENDED&&t.createInstance("router").navigate("detail/de_001",{de_001_002:{id:this.record.a_character_id,isOwn:!0,partyId:this.a_party_id,number:this.number,fromPartyPage:!0,fromPartyTopPage:!0,equipedSelf:!0},tab:null},{navigateFrom:{routes:"party/par_001",routerParams:{tab:"members"}}})},{record:n,number:i,a_party_id:this._a_party_id})}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;e.Q,i.assign(t.pc.party.par_001_002_003.SceneDelegate.prototype,{_setupWeaponTab:function(e,t){var n=e.seekWidgetByName("par_002_ui");n.setStrings({calc_hp_no:""+t.total_weapon_hp,calc_attack_no:""+t.total_weapon_attack});var a=t.weapons,o=a[0]||{},r=n.seekWidgetByName("partymain_weapon");this._setMainWeaponPanel(r,o),this._setAppearanceWeaponPanel(n,o,!1),r.setVisible(!0);var s=n.getChildren(),c=1;i.each(s,function(e){if(e.getName()==="sub_weapon_blank_"+(c-1)){var t=a[c];null==t.weapon_id&&this._setWeaponTouchEvent(e.getChildByName("btn_sub_weapon_blank"),c),this._makeSubWeaponNode(e,t,c),c++}},this)},_setAppearanceWeaponPanel:function(e,n,i){i&&!t.env.isSp||!i&&t.env.isSp||"magic_item"===n.weapon_type?e.setAppearance("magic_item"):"bow"===n.weapon_type?e.setAppearance("bow"):e.setAppearance("normal")},_setMainWeaponPanel:function(e,n){var a=null!=n.weapon_id,o=e.getChildByName("clipping_panel");if(!a)return e.getChildByName("rarity_bg").setVisible(!1),i.invoke(o.getChildren(),"setVisible",!1),void this._setWeaponTouchEvent(o,0);e.getChildByName("rarity_bg").setVisible(!0),i.invoke(o.getChildren(),"setVisible",!0),this._setWeaponTouchEvent(e.seekWidgetByName("weapon_touch_panel"),0);var r=t.Img("illustzoom","weapon",i.padZero(n.weapon_id,4),n.skin||0).png,s="party/res/par_001_2_3/par_main_bg_"+(n.rare||"r").toUpperCase()+".jpg";e.getChildByName("rarity_bg").loadTexture(s,ccui.Widget.PLIST_TEXTURE),e.loadTextures({illustzoom_weapon:r}),this._setRarityIcon(e,n,"icon_rarity"),this._setElementIconCommonRes(e,n,"icon_element"),this._setCardStrings(e,n),this._setWeaponDetailButton(e,n,0)},_makeSubWeaponNode:function(e,n,a){var o,r=e.seekWidgetByName("par_002_sub_weapon_ui");if(0===r.getChildren().length){var s=ccs.load(res["party-par_002-par_002_sub_weapon_ui"]);s.node.runAction(s.action),r.addChild(s.node)}o=r.getChildren()[0];var c=null!=n.weapon_id;if(o.getChildren().forEach(function(e){"touch_panel"!==e.getName()&&e.setVisible(c)}),this._setWeaponTouchEvent(o.getChildByName("touch_panel"),a),c){var u=t.Img("illustzoom","weapon",i.padZero(n.weapon_id,4),n.skin||0).png,l="party/res/par_001_2_3/par_chara_weapon_bg_"+(n.rare||"r").toUpperCase()+".jpg";o.getChildByName("rarity_bg").loadTexture(l,ccui.Widget.PLIST_TEXTURE),o.loadTextures({illustzoom_weapon:u}),this._setRarityIcon(o,n,"icon_rarity"),this._setElementIconCommonRes(o,n,"icon_element"),this._setCardStrings(o,n),this._setWeaponDetailButton(o,n,a),this._setAppearanceWeaponPanel(o,n,!0)}},_setWeaponTouchEvent:function(e,i){e.setTouchEnabled(!0),e.addTouchEventListener(function(a,o){t.pressButtonEmulate(e,"btn_",o),o===ccui.Widget.TOUCH_ENDED&&n.director.getRunningScene()._sceneNavigate.toParty013(i).navigate()},this)},_activeWeaponTab:function(e){var t=this._deck.weapons[0]||{};if(i.isUndefined(t.weapon_id)){var n=e.popups.popupWeaponMain;n.open().then(function(){i.each(this._deck.job.familiar_weapon_types,function(e,t){this._setForteIcon(n.seekWidgetByName("forte_icon_"+t),e)},this)}.bind(this))}},_setWeaponDetailButton:function(e,n,i){e.bfsWidgetByName("btn_detail").addTouchEventListener(function(e,n){n===ccui.Widget.TOUCH_ENDED&&t.createInstance("router").navigate("detail/de_003",{de_003:{id:this.record.a_weapon_id,isOwn:!0,partyId:this.a_party_id,number:i,fromPartyPage:!0,fromPartyTopPage:!0,equipedSelf:!0},tab:null},{navigateFrom:{routes:"party/par_001",routerParams:{tab:"weapons"}}})},{record:n,a_party_id:this._a_party_id})}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;e.Q,i.assign(t.pc.party.par_001_002_003.SceneDelegate.prototype,{_setupSummonTab:function(e,t){var n=e.seekWidgetByName("par_003_ui");n.setStrings({calc_hp_no:t.total_summon_hp,calc_attack_no:t.total_summon_attack});var a=t.summons,o=a[0]||{},r=n.seekWidgetByName("partymain_summon");this._setupSummonPanel(r,o,0),r.setVisible(!0);var s=n.getChildren(),c=1;i.each(s,function(e){if(e.getName()==="sub_summon_blank_"+(c-1)){var t=a[c];this._makeSubSummonNode(e,t,c),c++}},this)},_makeSubSummonNode:function(e,t,n){var i,a=e.seekWidgetByName("par_003_sub_summon_ui");0===a.getChildren().length?(i=ccs.load(res["party-par_003-par_003_sub_summon_ui"]).node,a.addChild(i)):i=a.getChildren()[0],this._setupSummonPanel(i,t,n)},_setupSummonPanel:function(e,n,a){var o=0===a?"clipping_panel":"partysub_summon",r=e.seekWidgetByName(o);if(0===a){this._setSummonTouchEvent(r.seekWidgetByName("summon_touch_panel"),a);var s="party/res/par_001_2_3/par_main_bg_"+(n.rare||"r").toUpperCase()+".jpg"}else{this._setSummonTouchEvent(r,a);s="party/res/par_001_2_3/par_summon_bg_"+(n.rare||"r").toUpperCase()+".jpg"}if(null==n.summon_id)return i.invoke(e.getChildren(),"setVisible",!1),i.invoke(r.getChildren(),"setVisible",!1),void r.setVisible(!0);i.invoke(e.getChildren(),"setVisible",!0),i.invoke(r.getChildren(),"setVisible",!0);var c=t.Img("illust-com-kneeshot","summon",i.padZero(n.summon_id,4),n.skin||0).png;e.getChildByName("rarity_bg").loadTexture(s,ccui.Widget.PLIST_TEXTURE),e.loadTextures({"illust-com-kneeshot_summon":c}),this._setRarityIcon(r,n,"icon_rarity"),this._setElementIconCommonRes(r,n,"icon_element"),this._setCardStrings(r,n),this._setSummonDetailButton(e,n,a)},_setSummonTouchEvent:function(e,i){e.setTouchEnabled(!0),e.addTouchEventListener(function(a,o){t.pressButtonEmulate(e,"btn_",o),o===ccui.Widget.TOUCH_ENDED&&n.director.getRunningScene()._sceneNavigate.toParty015(i).navigate()},this)},_setSummonDetailButton:function(e,n,i){e.bfsWidgetByName("btn_detail").addTouchEventListener(function(e,n){n===ccui.Widget.TOUCH_ENDED&&t.createInstance("router").navigate("detail/de_004",{de_004:{id:this.record.a_summon_id,isOwn:!0,partyId:this.a_party_id,number:i,fromPartyPage:!0,fromPartyTopPage:!0,equipedSelf:!0},tab:null},{navigateFrom:{routes:"party/par_001",routerParams:{tab:"summons"}}})},{record:n,a_party_id:this._a_party_id})}})}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.party=t.pc.party||{},t.pc.party.par_004=t.pc.party.par_004||{},t.pc.party.par_004.Scene=t.BaseScene.extend({resourceFileName:"par_004/par_004.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[{tab1:{node:"tab_0","content-node":"introduce_job_status_1_ui"},tab2:{node:"tab_1","content-node":"introduce_statuslist_list_7_ui"}}],componentName:"party",sceneName:"par_004",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_all_over","btnCallbackBtnAllOver",null,function(){alert("{{all_over_ui}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("btn_favorite_ui"),"btn_favorite","btnCallbackBtnFavoriteUiBtnFavorite",null,function(){alert("{{//com_favorite_info/com_favorite_confirm}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_job-energy-change","btnCallbackBtnJobEnergyChange",null,function(){alert("{{par_energy_change}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_hint","btnCallbackBtnHint",null,function(){alert("{{com_tutoria}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_job-change","btnCallbackBtnJobChange",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"party/par_006_a")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_job-energy-release","btnCallbackBtnJobEnergyRelease",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"party/par_energy_release")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_orange_l","btnCallbackBtnOrangeL",null,function(){alert("{{EXp_ability_none par_005}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_blue_l","btnCallbackBtnBlueL",null,function(){alert("{{}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc=t.pc||{},t.pc.party=t.pc.party||{},t.pc.party.par_004=t.pc.party.par_004||{},t.pc.party.par_004.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../par_popup_ui.json"],_popups:{},_aFavoriteMemberModel:null,_aJobParameterModel:null,onSceneInit:function(e){a.defer(),this._verifyRouterParams004(e),this._setBackBtn(e),e.enableRestore(!1);var t=this._showJobInfo(e).then(function(){e.tabDelegateList[0].selectTab(e.seekWidgetByName("tab_0"))}.bind(this)).fail(function(e){e&&console.error(e)});return this._showSubTutorialFirstAccess(e,t),t},_showJobInfo:function(e){return this._setRouterParams004(e).then(function(){if(e.routerParams.deck_in_use)return t.createInstance("router").navigate("party"),a.defer().promise;var n=this._loadFavoriteMemberInfo(),i=this._loadJob(e,e.routerParams.par_004.id,e.routerParams.party_id);return i.then(this._loadJobParameterInfo.bind(this)),i.then(this._setJobParameterBtn.bind(this,e)).then(this._setUpControls.bind(this,e)),a.all([i,n])}.bind(this)).then(function(){if(this._job){var e=this._isFavorite();this._setFavoriteBtn(e)}}.bind(this))},_setRouterParams004:function(e){return i.isUndefined(e.routerParams.party_id)||i.isUndefined(e.routerParams.par_004)||i.isUndefined(e.routerParams.deck_in_use)?t.createInstance("apiAParties").getSelectedDeck().then(function(t){e.routerParams.deck_in_use=t.body.deck.in_use,e.routerParams.party_id=t.body.a_party_id,e.routerParams.par_004={},e.routerParams.par_004.id=t.body.deck.job.a_job_id}.bind(this)).fail(function(e){console.error(e.stack)}):a.resolve()},_loadFavoriteMemberInfo:function(){return t.createInstance("apiAFavoriteMember").get().then(function(e){var n=e.body;this._aFavoriteMemberModel=t.createInstance("AFavoriteMemberModel",[n])}.bind(this)).fail(function(e){console.error(e.stack)})},_setFavoriteBtn:function(e){var t=n.director.getRunningScene();t.seekWidgetByName("setting_icon").setVisible(e);var i=t.seekWidgetByName("btn_favorite_ui");e?i.setAppearance("favorite_on"):i.setAppearance("favorite_off")},_updateAFavoriteMember:function(e,t){this._aFavoriteMemberModel.updateAFavoriteMember("job",e,t);var n=this._isFavorite();this._setFavoriteBtn(n)},onSceneEnter:function(e){return a.defer(),a.resolve()},onSceneExit:function(e){return a.defer(),a.resolve()},btnCallbackBtnAllOver:function(e){var t=a.defer();return t.reject(this._override),this._showImageZoomPopup(),t.promise},btnCallbackBtnFavoriteUiBtnFavorite:function(e){var n=a.defer();return n.reject(this._override),i.isNull(this._aFavoriteMemberModel)?n.promise:this._aFavoriteMemberModel.isFirstAccess()?(t.createInstance("apiAFavoriteMember").firstAccess().then(function(t){t.body.result&&(this._aFavoriteMemberModel.updateIsFirstAccess(!1),this._showFirstAccessPopup(e))}.bind(this)).fail(function(e){console.error(e.stack)}),n.promise):this._aFavoriteMemberModel.existFavoriteMember()?this._isFavorite()?(this._releaseFavorite(),n.promise):(this._showFavoriteConfigPopup(e),n.promise):(this._onTouchSetFavoriteBtn(),n.promise)},_releaseFavorite:function(){return t.createInstance("apiAFavoriteMember").update(null,"job").then(function(e){e.body.result&&this._updateAFavoriteMember(null,"")}.bind(this)).fail(function(e){console.error(e.stack)})},_isFavorite:function(){var e=this._job.job_id;return this._aFavoriteMemberModel.isFavorite("job",e)},_showFirstAccessPopup:function(e){var n=t.ImplantedPopup.createOrGet(e,"com_favorite_info","FavoriteInfoPopup");n.setButtonEvents({btn_cancel:!1,btn_ok:!0}),n.open(!1,this._aFavoriteMemberModel).then(function(){}.bind(this)).then(function(){this._onTouchSetFavoriteBtn()}.bind(this)).fail(function(e){console.error(e.stack)})},_showFavoriteConfigPopup:function(e){var n=t.ImplantedPopup.createOrGet(e,"com_favorite_confirm","FavoriteInfoPopup");n.setButtonEvents({btn_cancel:!1,btn_ok:!0}),n.open(!0,this._aFavoriteMemberModel).then(function(){}.bind(this)).then(function(){this._onTouchSetFavoriteBtn()}.bind(this)).fail(function(e){console.error(e.stack)})},_onTouchSetFavoriteBtn:function(){return t.createInstance("apiAFavoriteMember").update(this._job.job_id,"job").then(function(e){e.body.result&&this._updateAFavoriteMember(this._job.job_id,this._job.name)}.bind(this)).fail(function(e){console.error(e.stack)})},_loadJobParameterInfo:function(){return i.isUndefined(this._job.parameter_a_job_id)?a.resolve():t.createInstance("apiAJobParameter").getAJobParameterList(this._job.a_job_id).then(function(e){var n=e.body;this._aJobParameterModel=t.createInstance("AJobParameterModel",[n,this._job.parameter_job_id])}.bind(this)).fail(function(e){console.error(e.stack)}.bind(this))},_setJobParameterBtn:function(e){var t=this._job.a_job_id,n=this._job.parameter_a_job_id,a=e.seekWidgetByName("setting_icon_energy-change");if(i.isUndefined(n))a.setVisible(!1);else{var o=t!==n;a.setVisible(o)}},btnCallbackBtnJobEnergyChange:function(e){var n=a.defer();if(n.reject(this._override),!i.isUndefined(this._aJobParameterModel)){var o=t.ImplantedPopup.createOrGet(e,"par_energy_change","JobParameterChangePopup");return o.setButtonEvents({btn_cancel:!1,btn_execute:this._aJobParameterModel.canApply(),btn_hint:function(){var n=t.ImplantedPopup.create(e,"par_energy_change_help_on_par_energy_change","JobParameterChangeHintPopup");n.setButtonEvents({btn_ok:!1}),n.open()}}),o.open(this._aJobParameterModel,this._job).then(function(){}.bind(this)).then(function(){var t=e.popups.popupJobEnergyChangeConfirm,n=""+this._job.name+"<br>"+this._aJobParameterModel.getSelectJob().name+"";return e._changeJobParameterDefer=a.defer(),t.setContent(n),t.open(),e._changeJobParameterDefer.promise}.bind(this)).then(function(){var e=this._job.a_job_id,n=this._aJobParameterModel.getSelectJob().aJobId;return t.createInstance("apiAJobParameter").applyAJobParameter(e,n)}.bind(this)).then(function(e){var t=e.body;return t.error_info&&t.error_info.type?(console.error("changeAJobParameterError:"+t.error_info.type+" aJobId:"+baseAJobId),a.reject()):(this._aJobParameterModel.updateParameterJobId(),a.resolve())}.bind(this)).then(this._showJobInfo.bind(this,e)).fail(function(e){e instanceof Error&&console.error(e)}),n.promise}},btnCallbackBtnHint:function(e){return this._openSubTutorialPopup(e),a.reject(this._override)},_showSubTutorialFirstAccess:function(e,n){var i=t.createInstance("apiASubTutorialPages");return a.all([i.get("job"),n,this.__waitForNodesLoaded()]).spread(function(t){t.body.need_first_display&&(this._openSubTutorialPopup(e),i.visited("job"))}.bind(this)).fail(function(e){console.error(e)})},_openSubTutorialPopup:function(e){return t.ImplantedPopup.createOrGet(e,"sub_tutorial","ImplantedSubTutorialPopup").open("job",3)},btnCallbackBtnJobChange:function(e){var t=a.defer();return t.reject(this._override),this._navigate004To006(e,this._job),t.promise},btnCallbackBtnOrangeL:function(e){var t=a.defer();return t.reject(this._override),this._showSetupExtraAbility(),t.promise},btnCallbackBtnBlueL:function(e){var t=a.defer();return t.reject(this._override),this._showPopupBonus(),t.promise},btnCallbackBtnJobEnergyRelease:function(e){return this._navigate004ToEnergyRelease(e,this._job),a.reject(this._override)},_touchEndedBackBtnProcess:function(e){this._navigateToParty001_2_3("members")}}),i.assign(t.pc.party.par_004.SceneDelegate.prototype,t.pc.roles.UIUtility,t.pc.party.roles.Routing,t.pc.scene.roles.SceneJobCommon)}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.party=t.pc.party||{},t.pc.party.par_005=t.pc.party.par_005||{},t.pc.party.par_005.Scene=t.BaseScene.extend({resourceFileName:"par_005/par_005.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"party",sceneName:"par_005",_delegate:null,_init:function(){this._initScene("page_in")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;e.Q,t.pc=t.pc||{},t.pc.party=t.pc.party||{},t.pc.party.par_005=t.pc.party.par_005||{},t.pc.party.par_005.SceneDelegate=t.pc.BaseSceneDelegate.extend({_popups:{popupExAbilityChange:{factoryName:"popupFactoryPopupCommon",resourceName:"core-popup-p_ability_puton_off",title:"EX",buttonLabels:{blackBtn:"",blueBtn:"OK"},buttonSounds:{blueBtn:t.SoundList.BUTTON_TOUCHED_CONFIRMED},onPopupOpened:function(e,t){e.bfsWidgetByName("remove_confirm_label").setVisible(!1),e.bfsWidgetByName("set_confirm_label").setString("EX")},buttons:{blackBtn:function(e){this.dismiss()},blueBtn:function(e){e._delegate.setSelectedExAbility(e),this.dismiss()}}},popupExAbilityRemove:{factoryName:"popupFactoryPopupCommon",resourceName:"core-popup-p_ability_puton_off",title:"EX",buttonLabels:{blackBtn:"",redBtn:""},buttonSounds:{redBtn:t.SoundList.BUTTON_TOUCHED_CONFIRMED},buttons:{blackBtn:function(e){this.dismiss()},redBtn:function(e){e._delegate.removeExAbility(e),this.dismiss()}}}},onSceneInit:function(e){return this._verifyRouterParams005(e),this._setBackBtn(e),this._promise.fail(function(e){console.error(e)})},onSceneEnter:function(e){this._promise=this._fillupExAbilityList(e,"btnCallbackExAbilityPanel").then(function(e,t){e.disposed||(this._setExAbility(t),this._updateRemoveExAbilityBtn(e))}.bind(this,e))},setSelectedExAbility:function(e){t.createInstance("apiAParties").setExAbility(e.routerParams.party_id,this._selectedExAbilityId).then(function(t){e._sceneNavigate.toParty004(e.temporaryRouterParams.a_job_id).navigate()}.bind(this)).fail(function(e){console.error(e)})},removeExAbility:function(e){t.createInstance("apiAParties").setExAbility(e.routerParams.party_id,null).then(function(t){e._sceneNavigate.toParty004(e.temporaryRouterParams.a_job_id).navigate()}.bind(this)).fail(function(e){console.error(e)})},_setExAbility:function(e){this._exAbility=i.find(e.data,function(e){return e.is_set})},_updateRemoveExAbilityBtn:function(e){var n=e.seekWidgetByName("btn_ex_ability_remove");if(n.setVisible(!0),null!=this._exAbility){this._setEnableButton(n,!0),n.setSound(t.SoundList.BUTTON_TOUCHED_SWITCH);var i={"TOUCH_ENDED btn_ex_ability_remove":this._openAbilityRemovePopup.bind(this,e)};t.setTouchEventHandlers(e,i,this)}else this._setEnableButton(n,!1)},btnCallbackExAbilityPanel:function(e,t){this._selectedExAbilityId=t.ability_id;var i=n.director.getRunningScene().popups.popupExAbilityChange;i.open().then(function(){i.seekWidgetByName("set_confirm_label").setVisible(!0),i.seekWidgetByName("remove_confirm_label").setVisible(!1),this._fillAbilityPopup(i,t)}.bind(this))},_openAbilityRemovePopup:function(e){var n=e.popups.popupExAbilityRemove;n.open().then(function(){n.seekWidgetByName("set_confirm_label").setVisible(!1),n.seekWidgetByName("remove_confirm_label").setVisible(!0),n.seekWidgetByName("remove_confirm_label").width=420,this._fillAbilityPopup(n,this._exAbility),n.setHtmlStrings({remove_confirm_label:"EX<span class='red'></span>"},t.GameConfig.POPUP_CSS)}.bind(this))},_touchEndedBackBtnProcess:function(e){this._navigateToParty004(e,e.temporaryRouterParams.a_job_id)}}),i.assign(t.pc.party.par_005.SceneDelegate.prototype,t.pc.roles.UIUtility,t.pc.party.roles.Routing,t.pc.party.roles.ExAbilityPageListController,t.pc.status.roles.AbilityCommon)}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.party=t.pc.party||{},t.pc.party.par_006_007=t.pc.party.par_006_007||{},t.pc.party.par_006_007.Scene=t.BaseScene.extend({resourceFileName:"par_006_7/par_006_7.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[{tab1:{node:"tab_0","content-node":"par_006_node"},tab2:{node:"tab_1","content-node":"par_007_node"}},{tab3:{node:"btn_c","content-node":"par_006_c_node","container-node":"par_006_node"},tab4:{node:"btn_b","content-node":"par_006_b_node","container-node":"par_006_node"},tab5:{node:"btn_a","content-node":"par_006_a_node","container-node":"par_006_node"},tab6:{node:"btn_s","content-node":"par_006_s_node","container-node":"par_006_node"}},{tab7:{node:"btn_c","content-node":"par_007_c_node","container-node":"par_007_node"},tab8:{node:"btn_b","content-node":"par_007_b_node","container-node":"par_007_node"},tab9:{node:"btn_a","content-node":"par_007_a_node","container-node":"par_007_node"},tab10:{node:"btn_s","content-node":"par_007_s_node","container-node":"par_007_node"}}],componentName:"party",sceneName:"par_006_007",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_to_highjob","btnCallbackBtnToHighjob",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"highjob/highjob_main")),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc=t.pc||{},t.pc.party=t.pc.party||{},t.pc.party.par_006_007=t.pc.party.par_006_007||{},$staticRes(res["party-jobchange_ani-jobchange_ani"]),t.pc.party.par_006_007.SceneDelegate=t.pc.BaseSceneDelegate.extend({_popups:{popupCurrentJob:{factoryName:"popupFactoryBlue",title:"",buttonLabels:{blueBtn:"OK"},buttonSounds:{blueBtn:t.SoundList.BUTTON_TOUCHED_CONFIRMED},buttons:{blueBtn:function(e){this.dismiss()}}},popupJobChange:{factoryName:"popupFactoryPopupCommon",resourceName:"core-popup-p_job_change",title:"",buttonLabels:{blackBtn:"",blueBtn:"OK"},buttons:{blackBtn:function(e){this.dismiss()},buttonSounds:{blueBtn:t.SoundList.BUTTON_TOUCHED_CONFIRMED},blueBtn:function(e){e._delegate._changeJob(e),this.dismiss()}}},popupAbility:{factoryName:"popupFactoryPopupCommon",resourceName:"core-popup-p_ability_assist_info",title:"",buttonLabels:{blueBtn:"OK"},buttonSounds:{blueBtn:t.SoundList.BUTTON_TOUCHED_CONFIRMED},buttons:{blueBtn:function(e){this.dismiss()}}},popupWeaponSet:{factoryName:"popupFactoryBlackBlue",title:"",buttonLabels:{blueBtn:"OK",blackBtn:""},buttonSounds:{blueBtn:t.SoundList.BUTTON_TOUCHED_CONFIRMED},buttons:{blueBtn:function(e){this.dismiss(),e._sceneNavigate.toWeaponInTop().navigate()},blackBtn:function(e){this.dismiss();var t=e._delegate;t._navigateToParty004(e,t._currentJob.a_job_id)}}},popupOpenEpisode:{factoryName:"popupFactoryComOpenJobEpisode"}},_nodeSetting:{par_006_c_node:{acquired:!0,rank:"basic"},par_006_b_node:{acquired:!0,rank:"upper"},par_006_a_node:{acquired:!0,rank:"uppermost"},par_006_s_node:{acquired:!0,rank:"highjob"},par_007_c_node:{acquired:!1,rank:"basic"},par_007_b_node:{acquired:!1,rank:"upper"},par_007_a_node:{acquired:!1,rank:"uppermost"},par_007_s_node:{acquired:!1,rank:"highjob"}},_tabsForScene:{par_006_c:{tab:"tab_0",tab2:"btn_c"},par_006_b:{tab:"tab_0",tab2:"btn_b"},par_006_a:{tab:"tab_0",tab2:"btn_a"},par_006_s:{tab:"tab_0",tab2:"btn_s"},par_007_c:{tab:"tab_1",tab2:"btn_c"},par_007_b:{tab:"tab_1",tab2:"btn_b"},par_007_a:{tab:"tab_1",tab2:"btn_a"},par_007_s:{tab:"tab_1",tab2:"btn_s"}},_currentJobId:null,_currentJob:{},_comparedJob:{},_currentJobWidget:{},_comparedJobWidget:{},onSceneInit:function(e){this._verifyRouterParams006(e),this._setBackBtn(e),e.restoreParams||this._selectTabsWithParams(e),this._updateJobPoint(e);var t=e.bfsWidgetByName("btn_to_highjob");return t&&t.setVisible(this._aPlayer.rank>=100&&this._aJobsModel.existsRank("highjob")),i.each(this._nodeSetting,function(t,n){var i=t.acquired?"acquiredJobCallback":"unacquiredJobCallback",a=this._aJobsModel.getList(t.acquired,t.rank);return this._fillupJobList(e,i,n,t.acquired,a)},this),a.resolve()},_selectTabsWithParams:function(e){var n=t.createInstance("router").getCurrentSceneName(),a=i.isUndefined(this._tabsForScene[n])?e.routerParams.par_006_007:this._tabsForScene[n],o=a.tab||a.tab1||"tab_0",r=e.seekWidgetByName(o);r&&e.tabDelegateList[0].selectTab(r);var s=parseInt(o.replace("tab_","")),c="par_00"+(6+s)+"_node",u=1+s,l=a.tab2||"btn_c";(r=e.seekWidgetByPath(c+".."+l))&&e.tabDelegateList[u].selectTab(r);var _=3^u,p="par_00"+(6+(1^s))+"_node";e.tabDelegateList[_].selectTab(e.seekWidgetByPath(p+"..btn_c"))},_setRouterParams006:function(e){return i.isUndefined(e.routerParams.party_id)||i.isUndefined(e.routerParams.par_006_007)||i.isUndefined(e.routerParams.par_006_007.id)||i.isUndefined(e.routerParams.deck_in_use)?t.createInstance("apiAParties").getSelectedDeck().then(function(t){e.routerParams.deck_in_use=t.body.deck.in_use,e.routerParams.party_id=t.body.a_party_id,e.routerParams.par_006_007={},e.routerParams.par_006_007.id=t.body.deck.job.a_job_id}.bind(this)).fail(function(e){console.error(e)}):a.resolve()},onSceneEnter:function(e){return e.routerParams.deck_in_use?(t.createInstance("router").navigate("party"),a.resolve()):a.all([this._setRouterParams006(e).then(function(){this._currentJobId=e.routerParams.par_006_007.id}.bind(this)),t.party.model.AJobsRepository.get().then(function(e){this._aJobsModel=e}.bind(this)),t.createInstance("apiAPlayers").getJobPoint("me").then(this._setJobPoint.bind(this)),t.createInstance("apiAPlayers").getMe().then(function(e){this._aPlayer=e.body}.bind(this))]).fail(function(e){console.error(e)})},onSceneExit:function(e){return a.defer(),a.resolve()},onPageInAnimationEnd:function(e){var n=(a.defer(),e.temporaryRouterParams.par_006_007);i.isEmpty(n)||i.isUndefined(n.released_job)||(e.popups.popupOpenEpisode.open({job:n.released_job}),t.createInstance("router").removeCurrentTemporaryParamsFromHistory());return a.resolve()},_setJobPoint:function(e){this._jobPoint=e.body.job_point},_updateJobPoint:function(e){e.seekWidgetByName("header_sub_label").setString("P:"+this._jobPoint)},acquiredJobCallback:function(e,t){var i=n.director.getRunningScene();return this._currentJobId===t.a_job_id?void this._openPopupJobCurrent(i):(this._comparedJob=t,this._comparedJobWidget=e,void this._openPopupJobChange(i,t))},_changeJob:function(e){t.createInstance("apiAParties").changeJob(e.routerParams.party_id,this._comparedJob.a_job_id).then(function(t){return this._playChangeJobAnimation(e,t),t}.bind(this)).fail(function(e){console.error(e)})},_playChangeJobAnimation:function(a,o){var r=t.createInstance("WindowVisualEffect").init(e.res["party-jobchange_ani-jobchange_ani"]),s=r.getNode();s.loadTextures({after_job_img:t.Img("jobchange-sp","job",i.padZero(this._currentJob.job_id,4),0).png}),s.loadTextures({before_job_img:t.Img("jobchange-sp","job",i.padZero(this._comparedJob.job_id,4),0).png}),s.seekWidgetByPath("after_panel_02.after_job_img").loadTexture(t.Img("jobchange-sp","job",i.padZero(this._comparedJob.job_id,4),0).png);var c=new n.Node;c.setName("aniRoot"),a.addChild(c);var u=t.createInstance("soundPlayer");u.init(t.createInstance("playerGameConfig"));var l=t.createInstance("voiceLoader"),_=t.IDList.VOICES.JOIN_PARTY,p=l.loadJobVoices(this._comparedJob.job_id,_.LOWER,_.UPPER).then(function(e){return e});t.createInstance("Sound2Event",[r]),r.play(c,n.p(0,0),100,!1),s.animate("change_ani",!1).then(function(){p.then(function(e){u.playVoice(i.sample(e))}.bind(this)).fail(function(e){console.error(e)}),r.playByName("touch_ani",c,n.p(0,0),100,!0),s.seekWidgetByName("touch_btn").setVisible(!0),t.setTouchEventHandlers(c,{"TOUCH_ENDED touch_btn":function(){c.removeFromParent(),r.cleanUp(),this._afterChange(a,o)}},this)}.bind(this))},_afterChange:function(e,n){this._currentJobWidget.seekWidgetByName("current_job_icon").setVisible(!1),this._comparedJobWidget.seekWidgetByName("current_job_icon").setVisible(!0),this._currentJob=this._comparedJob,this._currentJobWidget=this._comparedJobWidget,this._currentJobId=this._currentJob.a_job_id;var a=t.createInstance("router");return a.historyReplace(a.getCurrentFragment(),i.extend(e.routerParams,{par_006_007:{id:this._currentJob.a_job_id}})),e.routerParams.par_006_007.id=this._currentJob.a_job_id,n.body.reset_ex_ability?void e._openMessagePopup({title:"EX",content:"Ex",buttons:[["blueBtn","OK"]]}):void this._confirmGotoPar002(e)},_confirmGotoPar002:function(e){var n=e.popups.popupWeaponSet;n.setContent(""+t.w("weapon")+""),n.open()},_openPopupJobCurrent:function(e){var t=e.popups.popupCurrentJob;t.setContent(""),t.open()},_openPopupJobChange:function(e,n){t.createInstance("apiAJobs").compare(this._currentJobId,n.a_job_id).then(function(a){var o=e.popups.popupJobChange;o.open().then(function(){this._adjustPopupConfirmChangeJob(o);var r=a.body.before_job_info,s=a.body.after_job_info,c=n.skin||0;o.loadTextures({job_img:t.Img("joblist","job",i.padZero(n.job_id,4),c).png}),o.setHtmlStrings({job_name_ability_labelimg:"<div style='margin-top:0px'><span class='yellow'>"+n.name+"</span><span class='red'></span></div>"},t.GameConfig.POPUP_CSS),this._setAbilityInfo4JobChange(e,o,n),i.each({before:r,after:s},function(e,t){this._setPopupConfirmChangeJobBeforeAfter(o,e,t)},this)}.bind(this))}.bind(this)).fail(function(e){console.error(e.stack)})},_adjustPopupConfirmChangeJob:function(e){var t=e.seekWidgetByName("top_pin_node");t.removeAllChildren(),t.addChild(ccs.load(res["core-popup-p_job_change"]).node),t.children[0].x=t.children[0].width/2*-1,e.setInnerHeight(t.children[0].height+100),e.seekWidgetByName("main_panel").y=0},_setPopupConfirmChangeJobBeforeAfter:function(e,a,o){e.seekWidgetByName(o+"_job_name").setString(a.name);var r=e.seekWidgetByName(o+"_job_base"),s=ccs.load(res["core-popup-p_job_change_bonus_list_ui"]).node;i(i.range(0,2)).map(function(e){return r.seekWidgetByName("forte_weapon_"+e)}).invoke("setVisible",!1);var c=i.isUndefined(a.familiar_weapon_types)?a.weapons:a.familiar_weapon_types;i.each(c,function(e,t){var n=r.seekWidgetByName("forte_weapon_"+t);n.loadTexture("core/res/icon/weapontypeicon_"+e+".png",ccui.Widget.PLIST_TEXTURE),n.setVisible(!0)},this);var u=0;i.each(a.level_up_bonus,function(a,c){var l=s.clone();l.loadTextures({bonus_img:t.Img("coreimg","job-bonusicon",i.padZero(a.type,4)).png}),l.setStrings({bonus_label:a.description}),"after"===o&&l.seekWidgetByName("bonus_label").setColor(n.color("#FFDD33"));var _=r.seekWidgetByName("top_panel"),p=r.seekWidgetByName("contents_panel");p.addChild(l),r.height=r.height+l.height,_.y=r.height,p.y=c*l.height+p.height+4,l.y=c*l.height*-1,u<c&&(e.setInnerHeight(e.getInnerHeight()+l.height),u++)})},_setAbilityInfo4JobChange:function(e,i,a){var o=t.core.model.ability.AbilityListFactory.create(a.abilities,a.assists,a),r=i.bfsWidgetByName("job_status_bla").getChildren();r.forEach(function(e){e.setVisible(!1)});var s=r.filter(function(e){return 0===e.getName().indexOf("abilityicon_ui_")}),c=r.filter(function(e){return 0===e.getName().indexOf("learn_level_label_")});o.forEachBySelectedAbility(function(i,a){var o=i.createAbilityIconView(s[a],!0);if(o.addTouchEventListener(this._touchAbilityIconInJobChange,{scene:e,abilityModel:i}),o.setVisible(!0),i instanceof t.core.model.ability.Ability){var r=c.shift();r&&(r.setString(" Lv"+i.available_level),r.setVisible(!0),o.getIconNode().setColor(i.learned?n.color.WHITE:n.color("#808080")))}},this)},_touchAbilityIconInJobChange:function(e,t){if(t===ccui.Widget.TOUCH_ENDED){var n=this.scene,i=this.abilityModel,a=n.popups.popupAbility;a.open().then(function(){i.createAbilityIconView(a),a.setStrings({ability_assist_name:i.name,ability_assist_description:i.description})},this)}},unacquiredJobCallback:function(e,t){var i=n.director.getRunningScene();this._navigate007To008(i,t)},btnCallbackBtnToHighjob:function(e){return t.router.HighJobNavigate.makeToMain(e.routerParams.party_id,e._sceneNavigate).navigate(),a.reject(this._override)},_touchEndedBackBtnProcess:function(e){this._navigateToParty001_2_3("members")}}),i.assign(t.pc.party.par_006_007.SceneDelegate.prototype,t.pc.party.roles.Routing,t.pc.party.roles.JobPageListController,t.pc.status.roles.AbilityCommon,t.pc.status.roles.AssistCommon)}((this||0).self||global),function(e){var t=e.kh,n=e._;t.pc=t.pc||{};var i=(e.Q,{p_job_get:{factoryName:"popupFactoryPopupCommon",resourceName:function(){var e=n.findKey(res,function(e){return 0<e.indexOf("p_job_get")});return e||alert(": p_job_get"),e||""}(),title:"",buttonLabels:{blackBtn:"",blueBtn:"OK"},buttons:{blackBtn:function(){this.dismiss()},blueBtn:function(){alert("{{p_job_get  com_open_episode}}")}}}});t.pc.party=t.pc.party||{},t.pc.party.par_008=t.pc.party.par_008||{},t.pc.party.par_008.Scene=t.BaseScene.extend({resourceFileName:"par_008/par_008.json",isLoopDefaultView:!1,_popups:i,tabDelegateConfig:[{tab1:{node:"tab_0","content-node":"introduce_job_status_0_ui"},tab2:{node:"tab_1","content-node":"introduce_statuslist_list_7_ui"}}],componentName:"party",sceneName:"par_008",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_all_over","btnCallbackBtnAllOver",null,function(){alert("{{all_over_ui}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_job-release","btnCallbackBtnJobRelease",null,function(e){this.popups.p_job_get.open(e)}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_to_highjob","btnCallbackBtnToHighjob",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"highjob/highjob_main")),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc=t.pc||{},t.pc.party=t.pc.party||{},t.pc.party.par_008=t.pc.party.par_008||{},t.pc.party.par_008.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../par_popup_ui.json"],_popups:{},onSceneInit:function(e){return this._setBackBtn(e),this._promise.spread(function(n,i){return this._promise=null,n.body.is_acquired&&"highjob"!==n.body.rank?(t.createInstance("router").navigate("party/par_007_a"),a.resolve()):(this._player=i,e.tabDelegateList[0].selectTab(e.seekWidgetByName("tab_0")),this._job=n.body,void this._setJobReleaseInfo(e,this._job))}.bind(this)).fail(function(e){console.error(e)})},onSceneEnter:function(e){this._verifyRouterParams008(e);var n=this._loadJob(e,e.routerParams.par_008.id),i=this._getPlayerJobPoint();return this._promise=a.all([n,i,t.createInstance("apiAPlayers").getMe().then(function(e){this._aPlayer=e.body}.bind(this))]),a.resolve()},btnCallbackBtnAllOver:function(e){var t=a.defer();return t.reject(this._override),this._showImageZoomPopup(),t.promise},btnCallbackBtnJobRelease:function(e){var t=a.defer();return t.reject(this._override),this._job.need_item?this._showPopupConfirmGetJobWithNeedItem(this._job.need_item):this._showPJobGetOrPNeedPoint.bind(this)(),t.promise},_setJobReleaseInfo:function(e,t){var a=e.seekWidgetByName("introduce_job_condition_ui");if("basic"===t.rank)e.seekWidgetByName("par_condition_base_0").setVisible(!0),e.seekWidgetByName("par_condition_base_1").setVisible(!1);else{a.removeAllChildrenWithCleanup();var o=ccs.load("../core/res/introduce/introduce_job/introduce_job_condition_1_ui.json").node;a.addChild(o),a.seekWidgetByName("par_condition_base_0").setVisible("highjob"!==t.rank),a.seekWidgetByName("par_condition_base_1").setVisible(!0),a.seekWidgetByName("par_condition_base_2").setVisible("highjob"!==t.rank)}i.isEmpty(t.need_item)?this._setJobPoint(e,this._player.job_point,t.release_need_job_point):this._setSpecialItem(e,t.need_item);var r=0;t.need_jobs.forEach(function(t){var n=e.seekWidgetByName("par_condition_base_"+(r+1));n.seekWidgetByName("lv_label").setString(""+(t.is_acquired?"Lv"+t.level:"")),n.seekWidgetByName("job_label").setString("Lv20\n"+t.name),r++}.bind(this));var s=e.seekWidgetByName("btn_job-release"),c=e.seekWidgetByName("btn_to_highjob");return"highjob"===t.rank?(c.setEnabled(!0),c.setVisible(!0),s.setVisible(!1),void(this._enableBtnToHighjob()?c.setColor(n.color.WHITE):c.setColor(n.color("#808080")))):(c.setVisible(!1),s.setVisible(!0),void(t.is_acquirable?(s.setColor(n.color("#FFFFFF")),s.setEnabled(!0)):(s.setColor(n.color("#808080")),s.setEnabled(!1))))},_setJobPoint:function(e,t,n){e.setStrings({"job-point_label_0":"P "+t,"job-point_label_1":"P "+n})},_getPlayerJobPoint:function(){return t.createInstance("apiAPlayers").getJobPoint("me").then(function(e){return e.body}.bind(this)).fail(function(e){console.error(e)})},_setSpecialItem:function(e,t){var n=t.name+" ";e.setStrings({"job-point_label_0":n+t.have_num,"job-point_label_1":n+t.num})},_enableBtnToHighjob:function(){return this._aPlayer.rank>=100},btnCallbackBtnToHighjob:function(e){return this._enableBtnToHighjob()?(t.router.HighJobNavigate.makeToMain(e.routerParams.party_id,e._sceneNavigate).navigate(),a.reject(this._override)):(t.createInstance("popupFactoryBlue").create({title:"",content:"<p class='red' style='line-height:1.5em'>[]<br />Rank 100 </p>",buttonLabels:{blueBtn:""},buttons:{blueBtn:function(){this.dismiss()}}}).open(),a.reject(this._override))},_touchEndedBackBtnProcess:function(e){return e.temporaryRouterParams.isFromHighJob?void t.createInstance("router").back():void this._navigateToParty007(e,this._job.rank)}}),i.assign(t.pc.party.par_008.SceneDelegate.prototype,t.pc.roles.UIUtility,t.pc.party.roles.Routing,t.pc.scene.roles.SceneJobCommon)}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.party=t.pc.party||{},t.pc.party.par_009=t.pc.party.par_009||{},t.pc.party.par_009.Scene=t.BaseScene.extend({resourceFileName:"par_009/par_009.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"party",sceneName:"par_009",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_sort","btnCallbackBtnSort",null,function(){alert("{{sort_0_ui.jsonsort_list_0_ui.json}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_cancel","btnCallbackBtnCancel",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"party/par_001_2_3")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_organize","btnCallbackBtnOrganize",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"party/par_001_2_3")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_remove_party","btnCallbackBtnRemoveParty",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"party/par_001_2_3")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"filter_btn","btnCallbackFilterBtn",null,function(){alert("{{com_filter_chara}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._),i=e.Q;t.pc=t.pc||{},t.pc.party=t.pc.party||{},t.pc.party.par_009=t.pc.party.par_009||{},t.pc.party.par_009.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../par_popup_ui.json"],_popups:{},_controller:null,_createDisplayFilterSettings:function(){return{window_gray:[t.displayFilter.enums.FILTER_NAME.PARTY_CHARA,"com_filter_chara"]}},onSceneInit:function(e){return this._verifyRouterParams009(e),this._createDisplayFilterController(e),this._initializeDisplayFilterController("window_gray"),this._setBackBtn(e),e.seekWidgetByName("status_window").getChildByName("btn_detail").addTouchEventListener(function(t,n){n===ccui.Widget.TOUCH_ENDED&&this.btnCallbackBtnDetail(e)}.bind(this)),this._getInitSelectedCardData(e).then(this._initListController.bind(this,e))},_getInitSelectedCardData:function(e){var n=e.routerParams.par_009.number;return t.createInstance("apiAParties").getSelectedDeck().then(function(e){return e.body.deck.characters[n]||{}})},_initListController:function(e,n){return this._controller=new t.party.controller.Par009CharacterList(e,n),this._controller.setPageList()},onSceneEnter:function(e){return i.defer(),i.resolve()},onSceneExit:function(e){return this._displayFilterClean(),this._controller.clean(),this._controller=null,i.resolve()},btnCallbackBtnSort:function(e){var t=i.defer();return t.reject(this._override),t.promise},btnCallbackBtnDetail:function(e){var t=i.defer();return this._getInitSelectedCardData(e).then(function(t){var n=this._controller.getSelectedRecord(),i=t.a_character_id===n.a_character_id;this._navigate009ToDetail(e,n,i)}.bind(this)),t.reject(this._override),t.promise},btnCallbackBtnCancel:function(e){var t=i.defer();return this._navigateTo001(e),t.reject(this._override),t.promise},btnCallbackBtnRemoveParty:function(e){var t=this._controller.getSelectedRecord();this._callChangeAPI(e,t,!0).then(this._navigateTo001.bind(this,e,0));var n=i.defer();return n.reject(this._override),n.promise},btnCallbackBtnOrganize:function(e){var t=this._controller.getSelectedRecord();this._callChangeAPI(e,t,!1).then(this._navigateTo001.bind(this,e,t.a_character_id));var n=i.defer();return n.reject(this._override),n.promise},_callChangeAPI:function(e,a,o){if(n.isUndefined(e.routerParams.par_009))this._consoleErrorRoutingAbort("routerParams.par_009");else{if(!n.isUndefined(e.routerParams.par_009.number)&&!n.isUndefined(e.routerParams.party_id)){var r=n.extend({},e.routerParams.par_009,{id:a.a_character_id,party_id:e.routerParams.party_id}),s=null;return o&&(s=t.createInstance("apiAParties").getSelectedDeck().then(function(e){r.number=n.findIndex(e.body.deck.characters,function(e){return e.a_character_id===a.a_character_id}),r.id=null})),i.when(s,function(){return t.createInstance("apiAParties").changeCharacter(r.party_id,r.number,r.id)}).fail(function(e){console.error(e.stack)})}this._consoleErrorRoutingAbort("routerParams.par_009.number | party_id")}},_touchEndedBackBtnProcess:function(e){this._navigateToParty001_2_3("members")}}),t.assignRoles(t.pc.party.par_009.SceneDelegate,[t.displayFilter.roles.DisplayFilterSceneController,t.pc.roles.UIUtility,t.pc.party.roles.Routing])}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.party=t.pc.party||{},t.pc.party.par_013=t.pc.party.par_013||{},t.pc.party.par_013.Scene=t.BaseScene.extend({resourceFileName:"par_013/par_013.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"party",sceneName:"par_013",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_sort","btnCallbackBtnSort",null,function(){alert("{{sort_0_ui.jsonsort_list_0_ui.json}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_detail","btnCallbackBtnDetail",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"detail/de_003")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_cancel","btnCallbackBtnCancel",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"party/par_001_2_3")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_organize","btnCallbackBtnOrganize",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"party/par_001_2_3")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_remove_party","btnCallbackBtnRemoveParty",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"party/par_001_2_3")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_present","btnCallbackBtnPresent",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"present/prs_001_2_3")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_gacha","btnCallbackBtnGacha",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"gacha/ga_004")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_quest","btnCallbackBtnQuest",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"quest/q_001")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"filter_btn","btnCallbackFilterBtn",null,function(){alert("{{com_filter_weapon}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._),i=e.Q;t.pc=t.pc||{},t.pc.party=t.pc.party||{},t.pc.party.par_013=t.pc.party.par_013||{},t.pc.party.par_013.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../par_popup_ui.json"],_popups:{},_controller:null,_createDisplayFilterSettings:function(){return{window_gray:[t.displayFilter.enums.FILTER_NAME.PARTY_WEAPON,"com_filter_weapon"]}},onSceneInit:function(e){return this._verifyRouterParams013(e),this._createDisplayFilterController(e),this._initializeDisplayFilterController("window_gray"),this._setBackBtn(e),this._getInitSelectedCardData(e).then(this._initListController.bind(this,e))},_getInitSelectedCardData:function(e){var i=e.routerParams.par_013.number;return t.createInstance("apiAParties").getSelectedDeck().then(function(e){var a=e.body.deck.weapons[i];return n.isEmpty(a)?{}:t.createInstance("apiAWeapons").get(a.a_weapon_id).then(function(e){return e.body})})},_initListController:function(e,n){return this._controller=new t.party.controller.Par013WeaponList(e,n),this._controller.setPageList()},onSceneEnter:function(e){return i.defer(),i.resolve()},onSceneExit:function(e){return this._displayFilterClean(),this._controller.clean(),this._controller=null,i.resolve()},btnCallbackBtnSort:function(e){var t=i.defer();return t.reject(this._override),t.promise},btnCallbackBtnDetail:function(e){var t=i.defer();return this._getInitSelectedCardData(e).then(function(t){var n=this._controller.getSelectedRecord(),i=t.a_weapon_id===n.a_weapon_id;this._navigate013ToDetail(e,n,i)}.bind(this)),t.reject(this._override),t.promise},btnCallbackBtnCancel:function(e){var t=i.defer();return this._navigateTo002(),t.reject(this._override),t.promise},btnCallbackBtnRemoveParty:function(e){var t=i.defer(),n=this._controller.getSelectedRecord();return this._callChangeAPI(e,n,!0).then(this._navigateTo002.bind(this,!1)),t.reject(this._override),t.promise},btnCallbackBtnOrganize:function(e){var t=i.defer(),n=this._controller.getSelectedRecord();return this._callChangeAPI(e,n,!1).then(this._navigateTo002.bind(this,!0)),t.reject(this._override),t.promise},_callChangeAPI:function(e,a,o){if(n.isUndefined(e.routerParams.par_013))this._consoleErrorRoutingAbort("routerParams.par_013");else{if(!n.isUndefined(e.routerParams.par_013.number)&&!n.isUndefined(e.routerParams.party_id)){var r=n.extend({},e.routerParams.par_013,{id:a.a_weapon_id,party_id:e.routerParams.party_id}),s=null;return o&&(s=t.createInstance("apiAParties").getSelectedDeck().then(function(e){r.number=n.findIndex(e.body.deck.weapons,function(e){return e.a_weapon_id===a.a_weapon_id}),r.id=null})),i.when(s,function(){return t.createInstance("apiAParties").changeWeapon(r.party_id,r.number,r.id)}).fail(function(e){console.error(e.stack)})}this._consoleErrorRoutingAbort("routerParams.par_013.number | party_id")}},btnCallbackBtnPresent:function(e){this._navigateToPresent();var t=i.defer();return t.reject(this._override),t.promise},_touchEndedBackBtnProcess:function(e){this._navigateToParty001_2_3("weapons")}}),t.assignRoles(t.pc.party.par_013.SceneDelegate,[t.displayFilter.roles.DisplayFilterSceneController,t.pc.roles.UIUtility,t.pc.party.roles.Routing])}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.party=t.pc.party||{},t.pc.party.par_015=t.pc.party.par_015||{},t.pc.party.par_015.Scene=t.BaseScene.extend({resourceFileName:"par_015/par_015.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"party",sceneName:"par_015",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_sort","btnCallbackBtnSort",null,function(){alert("{{sort_0_ui.jsonsort_list_0_ui.json}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_detail","btnCallbackBtnDetail",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"detail/de_004")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_cancel","btnCallbackBtnCancel",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"party/par_001_2_3")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_organize","btnCallbackBtnOrganize",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"party/par_001_2_3")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_remove_party","btnCallbackBtnRemoveParty",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"party/par_001_2_3")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"filter_btn","btnCallbackFilterBtn",null,function(){alert("{{com_filter_orher}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._),i=e.Q;t.pc=t.pc||{},t.pc.party=t.pc.party||{},t.pc.party.par_015=t.pc.party.par_015||{},t.pc.party.par_015.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../par_popup_ui.json"],_popups:{},_controller:null,_createDisplayFilterSettings:function(){return{window_gray:[t.displayFilter.enums.FILTER_NAME.PARTY_SUMMON,"com_filter_other"]}},onSceneInit:function(e){return i.defer(),this._verifyRouterParams015(e),this._createDisplayFilterController(e),this._initializeDisplayFilterController("window_gray"),this._setBackBtn(e),this._getInitSelectedCardData(e).then(this._initListController.bind(this,e))},_getInitSelectedCardData:function(e){var n=e.routerParams.par_015.number;return t.createInstance("apiAParties").getSelectedDeck().then(function(e){return e.body.deck.summons[n]||{}})},_initListController:function(e,n){return this._controller=new t.party.controller.Par015SummonList(e,n),this._controller.setPageList()},onSceneEnter:function(e){return i.defer(),i.resolve()},onSceneExit:function(e){return this._displayFilterClean(),this._controller.clean(),this._controller=null,i.resolve()},btnCallbackBtnSort:function(e){var t=i.defer();return t.reject(this._override),t.promise},btnCallbackBtnDetail:function(e){this._getInitSelectedCardData(e).then(function(t){var n=this._controller.getSelectedRecord(),i=t.a_summon_id===n.a_summon_id;this._navigate015ToDetail(e,n,i)}.bind(this));var t=i.defer();return t.reject(this._override),t.promise},btnCallbackBtnCancel:function(e){var t=i.defer();return this._navigateTo003(),t.reject(this._override),t.promise},btnCallbackBtnRemoveParty:function(e){var t=this._controller.getSelectedRecord();this._callChangeAPI(e,t,!0).then(this._navigateTo003.bind(this,!1));var n=i.defer();return n.reject(this._override),n.promise},btnCallbackBtnOrganize:function(e){var t=this._controller.getSelectedRecord();this._callChangeAPI(e,t,!1).then(this._navigateTo003.bind(this,!0));var n=i.defer();return n.reject(this._override),n.promise},_callChangeAPI:function(e,a,o){if(n.isUndefined(e.routerParams.par_015))this._consoleErrorRoutingAbort("routerParams.par_015");else{if(!n.isUndefined(e.routerParams.par_015.number)&&!n.isUndefined(e.routerParams.party_id)){var r=n.extend({},e.routerParams.par_015,{id:a.a_summon_id,party_id:e.routerParams.party_id}),s=null;return o&&(s=t.createInstance("apiAParties").getSelectedDeck().then(function(e){r.number=n.findIndex(e.body.deck.summons,function(e){return e.a_summon_id===a.a_summon_id}),r.id=null})),i.when(s,function(){return t.createInstance("apiAParties").changeSummon(r.party_id,r.number,r.id)}).fail(function(e){console.error(e.stack)})}this._consoleErrorRoutingAbort("routerParams.par_015.number | party_id")}},_touchEndedBackBtnProcess:function(e){this._navigateToParty001_2_3("summons")}}),t.assignRoles(t.pc.party.par_015.SceneDelegate,[t.displayFilter.roles.DisplayFilterSceneController,t.pc.roles.UIUtility,t.pc.party.roles.Routing])}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.party=t.pc.party||{},t.pc.party.par_energy_release=t.pc.party.par_energy_release||{},t.pc.party.par_energy_release.Scene=t.BaseScene.extend({resourceFileName:"par_energy_release/par_energy_release.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[{tab1:{node:"tab_0","content-node":"tab_0_node"},tab2:{node:"tab_1","content-node":"tab_1_node"}}],componentName:"party",sceneName:"par_energy_release",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_active_bonus","btnCallbackBtnActiveBonus",null,function(e){return t.ImplantedPopup.createOrGet(this,"par_energy_bonus",void 0).open()}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_mp","btnCallbackBtnMp",null,function(e){return t.ImplantedPopup.createOrGet(this,"par_help_mp",void 0).open()}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_status_enhance","btnCallbackBtnStatusEnhance",null,function(e){return t.ImplantedPopup.createOrGet(this,"par_help_status_enhance",void 0).open()}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_ability_get","btnCallbackBtnAbilityGet",null,function(e){return t.ImplantedPopup.createOrGet(this,"par_help_ability_get",void 0).open()}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_mp_exchange","btnCallbackBtnMpExchange",null,function(e){return t.ImplantedPopup.createOrGet(this,"par_exchange_mp",void 0).open()}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_undo_status_enhance","btnCallbackBtnUndoStatusEnhance",null,function(){alert("{{}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_back_status_enhance","btnCallbackBtnBackStatusEnhance",null,function(){alert("{{}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=(e._,e.Q);t.pc=t.pc||{},t.pc.party=t.pc.party||{},t.pc.party.par_energy_release=t.pc.party.par_energy_release||{},t.pc.party.par_energy_release.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../par_energy_release_popup_ui.json"],MODE_STATUS_ENHANCE:0,MODE_STATUS_ANNULMENT:1,_uiNodes:{},_popups:{parExchangeMpResult:{factoryName:"popupFactoryBlue",buttonLabels:{blueBtn:"OK"},title:"MP",content:"",buttons:{blueBtn:function(e){this.dismiss()}}}},_summaryController:null,_enhanceStatusController:null,_acquireAbilityController:null,onSceneInit:function(e){return this._setBackBtn(e),this._setJobInformation(this._aJob),this._summaryController=t.createInstance("JobEnergyReleaseSummaryController",[e,this._getAJobId()]),this._enhanceStatusController=t.createInstance("EnhanceStatusListController",[e,this._getAJobId(),this._summaryController]),this._acquireAbilityController=t.createInstance("AcquireAbilityListController",[e,this._getAJobId(),this._summaryController]),this.changeMode(this.MODE_STATUS_ENHANCE,e),i.resolve()},_getAJobId:function(){return this._getRouterParams().id},onSceneEnter:function(e){this._uiNodes.baseNode=e;var t=e.temporaryRouterParams.par_energy_release;return i.when(this._getAJob(t)).then(function(e){this._aJob=e}.bind(this))},_getRouterParams:function(e){return(e=e||n.director.getRunningScene()).routerParams.par_energy_release||{}},_setJobInformation:function(e){this._setIntroduceJobImage(e),this._uiNodes.baseNode.setStrings({name_label:e.name})},_getAJob:function(e){return e&&e.job_id&&e.name?e:t.createInstance("apiAJobs").get(this._getRouterParams().id).then(function(e){return e.body})},tabCallbackTab0:function(e){},tabCallbackTab1:function(e){this._acquireAbilityController.init()},changeMode:function(e,t){var n=this._uiNodes.baseNode,i=e===this.MODE_STATUS_ENHANCE,a={tab_ui:i,btn_mp_exchange:i,btn_undo_status_enhance:i,btn_back_status_enhance:!i,undo_base:!i};for(var o in a)n.seekWidgetByName(o).setVisible(a[o]);t.tabDelegateList[0].selectTab(t.seekWidgetByName("tab_0")),this._enhanceStatusController.changeMode(e)},btnCallbackBtnUndoStatusEnhance:function(e){return this.changeMode(this.MODE_STATUS_ANNULMENT,e),i.reject(this._override)},btnCallbackBtnBackStatusEnhance:function(e){return this.changeMode(this.MODE_STATUS_ENHANCE,e),i.reject(this._override)},btnCallbackBtnActiveBonus:function(e){var n=i.defer();return n.reject(this._override),t.createInstance("apiAJobEnergyRelease").getStatus(this._getAJobId(),"enhanced").then(function(t){return this._openBonusListPopup(e,t.body.data)}.bind(this)).fail(function(e){console.error(e)}),n.promise},_openBonusListPopup:function(e,n){return t.ImplantedPopup.createOrGet(e,"par_energy_bonus","ActiveStatusListPopup").open(n).fail(function(e){console.error(e)})},_touchEndedBackBtnProcess:function(e){t.pc.party.roles.Routing._navigateToParty004(e,this._getAJobId())},btnCallbackBtnMpExchange:function(e){var n=t.ImplantedPopup.createOrGet(e,"par_exchange_mp");return this._setExchangeConfirmPopupPromise(e,this._summaryController.getMasterPointModelPromise().then(n.open.bind(n))),i.reject(this._override)},_setExchangeConfirmPopupPromise:function(e,n){var a=t.ImplantedPopup.createOrGet(e,"par_exchange_mp_confirm");return n.then(a.open.bind(a)).then(function(e){return t.createInstance("apiAPlayers").exchangeMasterPoint(e.type,e.selectedAmount)},function(n){if(n!==a.CANCEL)return i.reject(n);var o=t.ImplantedPopup.createOrGet(e,"par_exchange_mp");return this._setExchangeConfirmPopupPromise(e,o.open()),i.reject(n)}.bind(this)).then(function(t){e.popups.parExchangeMpResult.open(),this._summaryController.updateMasterPointAfterExchangePoint(t.body.result)}.bind(this)).fail(function(e){e instanceof Error&&console.error(e)})}}),t.assignRoles(t.pc.party.par_energy_release.SceneDelegate,[t.pc.roles.ImagesCommon])}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.party=t.pc.party||{},t.pc.party.par_pick_member_acce=t.pc.party.par_pick_member_acce||{},t.pc.party.par_pick_member_acce.Scene=t.BaseScene.extend({resourceFileName:"par_pick_member_acce/par_pick_member_acce",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"party",sceneName:"par_pick_member_acce",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_cancel","btnCallbackBtnCancel",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"party/par_001_2_3")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_organize","btnCallbackBtnOrganize",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"party/par_001_2_3")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_back_to_organize","btnCallbackBtnBackToOrganize",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"party/par_001_2_3")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"filter_btn","btnCallbackFilterBtn",null,function(){alert("{{com_filter_characom_filter_other}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("com_character_status"),"btn_disabled","btnCallbackComCharacterStatusBtnDisabled",null,function(){alert("{{book_request_rank_on_com_character_status}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("introduce_popup_chara_status_ui"),"btn_to_detail","btnCallbackIntroducePopupCharaStatusUiBtnToDetail",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"detail/de_001_2")),this._initButtonEvent.call(this,this.seekWidgetByPath("introduce_popup_acce_status_ui"),"btn_confirm","btnCallbackIntroducePopupAcceStatusUiBtnConfirm",null,function(){alert("{{acce_info_on_com_character_status}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("introduce_popup_acce_status_ui"),"btn_hint","btnCallbackIntroducePopupAcceStatusUiBtnHint",null,function(){alert("{{acce_series_hint_on_com_character_status}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._),i=e.Q;t.pc=t.pc||{},t.pc.party=t.pc.party||{},t.pc.party.par_pick_member_acce=t.pc.party.par_pick_member_acce||{},t.pc.party.par_pick_member_acce.MODE={MEMBER:0,ACCE:1},t.pc.party.par_pick_member_acce.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../par_pick_member_acce_popup_ui.json"],_popups:{com_protect_on:{factoryName:"popupFactoryTextOnly",resource:"text_button_only.json",title:"",content:"<br><br>",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){this.dismiss()}}},com_protect_off:{factoryName:"popupFactoryTextOnly",resource:"text_button_only.json",title:"",content:"<br><br>",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){this.dismiss()}}}},_controller:null,onSceneInit:function(e){return this._setBackBtn(e),this._controller.onSceneInit(e)||i.resolve()},onSceneEnter:function(e){var n=this._getPartyModel(e);switch(this._getMode(e)){case t.pc.party.par_pick_member_acce.MODE.MEMBER:this._controller=new t.party.controller.PickMember(e,n);break;case t.pc.party.par_pick_member_acce.MODE.ACCE:this._controller=new t.party.controller.EquipAcce(e,n);break;default:console.error("",e.routerParams.par_pick_member_acce)}return t.createInstance("router").removeCurrentTemporaryParamsFromHistory(),this._controller.onSceneEnter(e)||i.resolve()},_getPartyModel:function(e){var a=i.defer(),o=e.routerParams.par_pick_member_acce.a_party_id,r=(e.temporaryRouterParams.par_pick_member_acce||{}).deck;return n.isEmpty(r)?(t.createInstance("apiAParties").getSelectedDeck().then(function(e){a.resolve(new t.party.model.APartyDeck(e.body.a_party_id,e.body.deck))}),a.promise):(a.resolve(new t.party.model.APartyDeck(o,r)),a.promise)},btnCallbackBtnCancel:function(e){return this._controller.cancel(e),i.reject(this._override)},btnCallbackBtnOrganize:function(e){return this._controller.assign(e).fail(function(e){e instanceof Error&&console.error(e)}),i.reject(this._override)},btnCallbackBtnBackToOrganize:function(e){return this._controller.cancel(e),i.reject(this._override)},_getMode:function(e){return e.routerParams.par_pick_member_acce&&e.routerParams.par_pick_member_acce.mode},_touchEndedBackBtnProcess:function(e){this._controller.cancel(e)}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("core.reward"),t.core.reward.RewardExchangeDeadlineController=n.Class.extend({className:"RewardExchangeDeadlineController",ctor:function(e){this._rewardExchangeDeadlineRepository=e,this.bindView(t.createInstance("RewardExchangeDeadlineView"))},bindView:function(e){this._rewardExchangeDeadlineView=e},display:function(){this._rewardExchangeDeadlineRepository.import().then(function(e){this._rewardExchangeDeadlineView.display(e)}.bind(this))}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=(e.ccui,e._,e.console);t.createNameSpaceIfNotExists("core.reward"),t.core.reward.RewardExchangeDeadlineView=i.Class.extend({className:"RewardExchangeDeadlineView",DATE_LABEL_NAME:"limit_date_label",DATE_LABEL_TEXT:"{exchangeDeadline}",display:function(e){var t=e.getRewardExchangeDeadline(),i=n.getWidget(this.DATE_LABEL_NAME,function(e){a.warn(this.className+": "+e)}.bind(this)),o=this.DATE_LABEL_TEXT.replace("{exchangeDeadline}",t);i.setString(o)}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("core.reward"),t.core.reward.GotoRewardButtonController=n.Class.extend({className:"GotoRewardButtonController",ctor:function(e){this._rewardExchangeInformationRepository=e},updateButtonState:function(){this._getRewardExchangeInformationModel().then(function(e){t.createInstance("GotoRewardButtonView").updateButtonState(e)})},_getRewardExchangeInformationModel:function(){return this._rewardExchangeInformationRepository.import()}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=(e.ccui,e._,e.console);t.createNameSpaceIfNotExists("core.reward"),t.core.reward.GotoRewardButtonView=i.Class.extend({className:"GotoRewardButtonView",BUTTON_NODE_NAME:"btn_interchange",EXCLAMATION_ICON_NODE_NAME:"info_icon",updateButtonState:function(e){var t=this._getExclamationIcon(),n=e.canExchangeForRewards();t.setVisible(n)},_getExclamationIcon:function(){var e=n.getWidget(this.BUTTON_NODE_NAME,function(e){a.warn(this.className+": "+e)}.bind(this));return n.getWidgetFromNode(e,this.EXCLAMATION_ICON_NODE_NAME,function(e){a.warn(this.className+": "+e)}.bind(this))}})}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.poprank=t.pc.poprank||{},t.pc.poprank.poprank_000=t.pc.poprank.poprank_000||{},t.pc.poprank.poprank_000.Scene=t.BaseScene.extend({resourceFileName:"poprank_000/poprank_000.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"poprank",sceneName:"poprank_000",_delegate:null,_init:function(){this._initScene("page_in")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._,e.Q);t.pc=t.pc||{},t.pc.poprank=t.pc.poprank||{},t.pc.poprank.poprank_000=t.pc.poprank.poprank_000||{},t.pc.poprank.poprank_000.SceneDelegate=t.pc.BaseSceneDelegate.extend({_popups:{},onSceneInit:function(e){return this._setBackBtn(e),t.createInstance("BackgroundController").displayBackgroundWithAnnouncementLogo(),n.resolve()},onSceneEnter:function(e){return n.defer(),n.resolve()},onSceneExit:function(e){return n.defer(),n.resolve()},onPageInAnimationEnd:function(e){return n.defer(),n.resolve()},_touchEndedBackBtnProcess:function(){t.createInstance("InternalRouteController").navigateToMypage()}})}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.poprank=t.pc.poprank||{},t.pc.poprank.poprank_001=t.pc.poprank.poprank_001||{},t.pc.poprank.poprank_001.Scene=t.BaseScene.extend({resourceFileName:"poprank_001/poprank_001.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"poprank",sceneName:"poprank_001",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_poll_place","btnCallbackBtnPollPlace",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"poprank/poprank_002")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_rank_confirm","btnCallbackBtnRankConfirm",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"poprank/poprank_005")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_interchange","btnCallbackBtnInterchange",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"poprank/poprank_004")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_ticket_exchange","btnCallbackBtnTicketExchange",null,function(){alert("{{poprank_exchange}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_explain","btnCallbackBtnExplain",null,function(){alert("{{sub_tutorial}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._,e.Q);t.pc=t.pc||{},t.pc.poprank=t.pc.poprank||{},t.pc.poprank.poprank_001=t.pc.poprank.poprank_001||{},t.pc.poprank.poprank_001.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../poprank_popup_ui.json"],_popups:{},_updatePromise:null,onSceneInit:function(e){this._setBackBtn(e);var n=t.createInstance("ExchangePageInitializeEventHandler");return this._updatePromise.then(function(e){e.isFirstAccess()&&t.createInstance("SubtutorialController").displaySubtutorial(),n.handle()})},onSceneEnter:function(e){return this._updatePromise=t.createInstance("EventRepository").import().then(function(e){return e.fetch()}).then(function(e){return e.isFirstAccess()?t.createInstance("apiAEvents").updateStatus("poprank_event",e.getEventId()).thenResolve(e):e}),n.resolve()},onSceneExit:function(e){return this._updatePromise=null,n.resolve()},btnCallbackBtnPollPlace:function(e){return t.createInstance("InternalRouteController").navigateToVotePage(e),n.reject(this._override)},btnCallbackBtnRankConfirm:function(e){return t.createInstance("InternalRouteController").navigateToTentativeRankingPage(e),n.reject(this._override)},btnCallbackBtnInterchange:function(e){return t.createInstance("InternalRouteController").navigateToRewardPage(e),n.reject(this._override)},btnCallbackBtnTicketExchange:function(e){return n.reject(this._override)},btnCallbackBtnExplain:function(e){return t.createInstance("SubtutorialController").displaySubtutorial(),n.reject(this._override)},_touchEndedBackBtnProcess:function(){t.createInstance("InternalRouteController").navigateToEvent()}})}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.poprank=t.pc.poprank||{},t.pc.poprank.poprank_002=t.pc.poprank.poprank_002||{},t.pc.poprank.poprank_002.Scene=t.BaseScene.extend({resourceFileName:"poprank_002/poprank_002.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[{tab1:{node:"tab_0","content-node":"tab_0_node"},tab2:{node:"tab_1","content-node":"tab_1_node"},tab3:{node:"tab_2","content-node":"tab_2_node"}}],componentName:"poprank",sceneName:"poprank_002",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_detail","btnCallbackBtnDetail",null,function(){alert("{{status_001}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_vote","btnCallbackBtnVote",null,function(){alert("{{poprank_select}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_interchange","btnCallbackBtnInterchange",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"poprank/poprank_004")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_back_event_top","btnCallbackBtnBackEventTop",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"poprank/poprank_001")),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._,e.Q);t.pc=t.pc||{},t.pc.poprank=t.pc.poprank||{},t.pc.poprank.poprank_002=t.pc.poprank.poprank_002||{},t.pc.poprank.poprank_002.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../poprank_popup_ui.json"],RARITY_BY_TABINDEX:{0:"SSR",1:"SR",2:"R"},_popups:{},onSceneInit:function(e){this._setBackBtn(e);var i=t.createInstance("VoteController"),a=t.createInstance("VotePageInitializeEventHandler",[i]);return this._onTabChangeEventHandler=t.createInstance("VotePageOnTabChangeEventHandler",[i]),a.handle(),n.resolve()},onSceneEnter:function(e){return n.defer(),n.resolve()},onSceneExit:function(e){return t.createInstance("selectionController").deselectAll(),n.resolve()},onPageInAnimationEnd:function(e){return n.defer(),n.resolve()},tabCallbackTab0:function(e){this._fireOnTabChangeEvent(0)},tabCallbackTab1:function(e){this._fireOnTabChangeEvent(1)},tabCallbackTab2:function(e){this._fireOnTabChangeEvent(2)},_fireOnTabChangeEvent:function(e){var t=this._getRarityTypeByTabIndex(e);this._onTabChangeEventHandler.handle(t)},_getRarityTypeByTabIndex:function(e){return t.core.rarity.RARITY_TYPE[this.RARITY_BY_TABINDEX[e]]},btnCallbackBtnDetail:function(e){return n.reject(this._override)},btnCallbackBtnVote:function(e){return n.reject(this._override)},btnCallbackBtnInterchange:function(e){return t.createInstance("InternalRouteController").navigateToRewardPage(e),n.reject(this._override)},btnCallbackBtnBackEventTop:function(e){return t.createInstance("InternalRouteController").navigateToExchangePage(e),n.reject(this._override)},_touchEndedBackBtnProcess:function(e){t.createInstance("InternalRouteController").navigateToExchangePage(e)}})}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.poprank=t.pc.poprank||{},t.pc.poprank.poprank_003=t.pc.poprank.poprank_003||{},t.pc.poprank.poprank_003.Scene=t.BaseScene.extend({resourceFileName:"poprank_003/poprank_003.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[{tab1:{node:"tab_0","content-node":"tab_0_node"},tab2:{node:"tab_1","content-node":"tab_1_node"},tab3:{node:"tab_2","content-node":"tab_2_node"}}],componentName:"poprank",sceneName:"poprank_003",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_poll_place","btnCallbackBtnPollPlace",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"poprank/poprank_002")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_back_event_top","btnCallbackBtnBackEventTop",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"poprank/poprank_001")),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._,e.Q);t.pc=t.pc||{},t.pc.poprank=t.pc.poprank||{},t.pc.poprank.poprank_003=t.pc.poprank.poprank_003||{},t.pc.poprank.poprank_003.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../poprank_popup_ui.json"],RARITY_BY_TABINDEX:{0:"SSR",1:"SR",2:"R"},_popups:{},onSceneInit:function(e){this._setBackBtn(e);var i=new t.poprank.controller.RankingPageListCollectionController;return t.createInstance("TentativeRankingPageInitializeEventHandler").handle(),this._pageOnTabChangeEventHandler=t.createInstance("TentativeRankingPageOnTabChangeEventHandler",[i]),n.resolve()},onSceneEnter:function(e){return n.defer(),n.resolve()},onSceneExit:function(e){return n.defer(),n.resolve()},onPageInAnimationEnd:function(e){return n.defer(),n.resolve()},tabCallbackTab0:function(e){this._fireOnTabChangeEvent(0)},tabCallbackTab1:function(e){this._fireOnTabChangeEvent(1)},tabCallbackTab2:function(e){this._fireOnTabChangeEvent(2)},_fireOnTabChangeEvent:function(e){var t=this._getRarityTypeByTabIndex(e);this._pageOnTabChangeEventHandler.handle(t)},_getRarityTypeByTabIndex:function(e){return t.core.rarity.RARITY_TYPE[this.RARITY_BY_TABINDEX[e]]},btnCallbackBtnPollPlace:function(e){return t.createInstance("InternalRouteController").navigateToVotePage(e),n.reject(this._override)},btnCallbackBtnBackEventTop:function(e){return t.createInstance("InternalRouteController").navigateToExchangePage(e),n.reject(this._override)},_touchEndedBackBtnProcess:function(e){t.createInstance("InternalRouteController").navigateToExchangePage(e)}})}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.poprank=t.pc.poprank||{},t.pc.poprank.poprank_004=t.pc.poprank.poprank_004||{},t.pc.poprank.poprank_004.Scene=t.BaseScene.extend({resourceFileName:"poprank_004/poprank_004.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"poprank",sceneName:"poprank_004",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_back_event_top","btnCallbackBtnBackEventTop",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"poprank/poprank_001")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_present","btnCallbackBtnPresent",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"present/prs_001")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_receive","btnCallbackBtnReceive",null,function(){alert("{{prs_receive_result}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("poprank_004_receive_ui"),"btn_get","btnCallbackPoprank004ReceiveUiBtnGet",null,function(){alert("{{prs_receive}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc=t.pc||{},t.pc.poprank=t.pc.poprank||{},t.pc.poprank.poprank_004=t.pc.poprank.poprank_004||{},t.pc.poprank.poprank_004.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../poprank_popup_ui.json"],_popups:{comNewMember:{factoryName:"popupFactoryPopupCommon",resourceName:"core-popup-com_new_member",title:"",buttonLabels:{blackBtn:""},buttons:{blackBtn:function(e){this.dismiss()}}},popupEventEnd:{factoryName:"popupFactoryTextOnly",title:"",content:"<br />",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){t.createInstance("router").navigate("mypage/my_001")}}}},onSceneInit:function(e){this._setBackBtn(e);var n=t.createInstance("RewardPageListSettings"),i=t.createInstance("ReceiveRewardButtonTouchEventHandler"),o=t.createInstance("RewardPageListController",[n,i]);return this._rewardPageRefreshEventHandler=t.createInstance("RewardPageRefreshEventHandler",[o]),t.createInstance("RewardPageInitializeEventHandler",[o]).handle(),a.resolve()},btnCallbackBtnBackEventTop:function(e){return this._touchEndedBackBtnProcess(e),a.reject(this._override)},btnCallbackBtnPresent:function(e){return t.createInstance("EventRepository").import().then(function(e){t.createInstance("InternalRouteController").navigatePoprank004ToPrs001(e.getEventId())}),a.reject(this._override)},btnCallbackBtnReceive:function(e){return this._receiveAllPresent(),a.reject(this._override)},btnCallbackPoprank004ReceiveUiBtnGet:function(e){return a.reject(this._override)},refreshPage:function(){this._rewardPageRefreshEventHandler.handle()},_receiveAllPresent:function(){t.createInstance("apiAEvents").receiveAllPoprankRewards(this.event_id,this._currentType).then(function(e){if(!1!==e.body.result){var t=e.body;this.refreshPage();this._receiveAllPresentShowResult(t.received_info,t.not_received_info,"\r\n").then(function(){var e=t.new_character_gained_list;i.isEmpty(e)||this._showNewMemberPopup(e)}.bind(this))}else this._showReceiveFailPopup("all",e.body)}.bind(this)).fail(function(e){console.error(e)})},_showNewMemberPopup:function(e){if(i.isArray(e))var a=e.shift();else{a=e;e=[]}var o=n.director.getRunningScene().popups.comNewMember;o.open().then(function(n){this._setCharacterCoreCardElementRarity(o,a,"corecard_chara_ui");var i=o.seekWidgetByName("party_join_label");null!==i&&i.setString(a.name+"\n"),t.setTouchEventHandlers(o,{"TOUCH_ENDED black_btn":function(){o.dismiss(),e.length>0&&this._showNewMemberPopup(e)}.bind(this)},this)}.bind(this))},_receivePresent:function(e){t.createInstance("apiAEvents").receivePoprankReward(e).then(function(t){if(!t.body.result)return this._showReceiveFailPopup(e,t.body);n.director.getRunningScene().refresh();var a=t.body;if(!i.isUndefined(a)){var o=a.new_characters_gained;i.isEmpty(o)||this._showNewMemberPopup(o)}}.bind(this))},_showReceiveFailPopup:function(e,i){var a=n.director.getRunningScene();return"event_finished"===i.type?void a.popups.popupEventEnd.open():i.reason?void t.createInstance("popupFactoryTextOnly").create({title:"",content:i.reason,buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(){this.dismiss()}}}):(t.createInstance("smartBeat").log({reward_Id:e,response_headers:response.headers,response_body:i}),void console.error(""))},_touchEndedBackBtnProcess:function(e){return null!=e.routerParams.poprank_001&&null!=e.routerParams.poprank_001.navigate_page?void t.createInstance("InternalRouteController").navigateToExchangePage(e):null!=e.routerParams.poprank_005&&null!=e.routerParams.poprank_005.navigate_page?void t.createInstance("InternalRouteController").navigateToFinalRankingPage(e):void t.createInstance("EventRepository").import().then(function(n){return n.isReceivedReward()?void t.createInstance("InternalRouteController").navigateToFinalRankingPage(e):void t.createInstance("InternalRouteController").navigateToExchangePage(e)})}}),t.assignRoles(t.pc.poprank.poprank_004.SceneDelegate,[t.pc.present.roles.PresentPopups,t.pc.roles.CoreCardCommon])}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.poprank=t.pc.poprank||{},t.pc.poprank.poprank_005=t.pc.poprank.poprank_005||{},t.pc.poprank.poprank_005.Scene=t.BaseScene.extend({resourceFileName:"poprank_005/poprank_005.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[{tab1:{node:"tab_0","content-node":"tab_0_node"},tab2:{node:"tab_1","content-node":"tab_1_node"},tab3:{node:"tab_2","content-node":"tab_2_node"}}],componentName:"poprank",sceneName:"poprank_005",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_reward_receiving","btnCallbackBtnRewardReceiving",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"poprank/poprank_004")),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._,e.Q);t.pc=t.pc||{},t.pc.poprank=t.pc.poprank||{},t.pc.poprank.poprank_005=t.pc.poprank.poprank_005||{},t.pc.poprank.poprank_005.SceneDelegate=t.pc.BaseSceneDelegate.extend({RARITY_BY_TABINDEX:{0:"SSR",1:"SR",2:"R"},_popups:{},onSceneInit:function(e){return this._setBackBtn(e),t.createInstance("FinalRankingPageInitializeEventHandler").handle(),this._pageOnTabChangeEventHandler=t.createInstance("FinalRankingPageOnTabChangeEventHandler"),n.resolve()},onSceneEnter:function(e){return n.defer(),n.resolve()},onSceneExit:function(e){return n.defer(),n.resolve()},onPageInAnimationEnd:function(e){return n.defer(),n.resolve()},tabCallbackTab0:function(e){this._fireOnTabChangeEvent(0)},tabCallbackTab1:function(e){this._fireOnTabChangeEvent(1)},tabCallbackTab2:function(e){this._fireOnTabChangeEvent(2)},_fireOnTabChangeEvent:function(e){var t=this._getRarityTypeByTabIndex(e);this._pageOnTabChangeEventHandler.handle(t)},_getRarityTypeByTabIndex:function(e){return t.core.rarity.RARITY_TYPE[this.RARITY_BY_TABINDEX[e]]},btnCallbackBtnRewardReceiving:function(e){return t.createInstance("InternalRouteController").navigateToRewardPage(e),n.reject(this._override)},_touchEndedBackBtnProcess:function(e){t.createInstance("InternalRouteController").navigateToEvent()}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("poprank.eventHandling"),t.poprank.eventHandling.VotePageInitializeEventHandler=n.Class.extend({className:"VotePageInitializeEventHandler",ctor:function(e){this._voteController=e},handle:function(){t.createInstance("EventRepository").import().then(function(e){t.createInstance("apiAEvents").setEventIdDelegate(e.getEventId()),t.createInstance("BackgroundController").displayBackground(),this._voteController.initialize();var n=t.createInstance("RewardExchangeInformationRepository");t.createInstance("GotoRewardButtonController",[n]).updateButtonState()}.bind(this))}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("poprank.eventHandling"),t.poprank.eventHandling.VotePageOnTabChangeEventHandler=n.Class.extend({className:"VotePageOnTabChangeEventHandler",ctor:function(e){this._voteController=e},handle:function(e){this._voteController.changeTab(e)}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=e._,o=e.console;t.createNameSpaceIfNotExists("poprank.view"),t.poprank.view.PopularRankingAvatarView=i.Class.extend({className:"PopularRankingAvatarView",AVATAR_PEDESTAL_NODE_NAME:"avatar_position_node",AVATAR_CACHE_KEY:"poprank_avatar_cache",MAX_AVATAR_CACHE_COUNT:10,display:function(e){return this._getPedestalNode()?(this._popularRankingCharacterModel=e,this._getAvatar(e).then(this._displayAvatar.bind(this))):Q.resolve()},remove:function(){null!=this._popularRankingCharacterModel&&this._getAvatar(this._popularRankingCharacterModel).then(function(e){e.removeFromParent()})},playWinAnimation:function(){null!=this._popularRankingCharacterModel&&this._getAvatar(this._popularRankingCharacterModel).then(function(e){e.playWinAnimation()})},playIdleByAnimation:function(){null!=this._popularRankingCharacterModel&&this._getAvatar(this._popularRankingCharacterModel).then(function(e){e.playIdleByAnimation()})},_displayAvatar:function(e){var t=this._getPedestalNode();e.appendTo(t),e.playIdleByAnimation()},_getAvatar:function(e){var t=e.getId(),n=this._getAvatarFromCache(t);return null!=n&&null==n.getAvatar()&&(this._removeAvatarFromCache(t),n=null),null!=n?Q.resolve(n.getAvatar()):this._createAvatar(e).then(function(e,t){return this._cacheAvatar(e,t),t.getAvatar()}.bind(this,t))},_createAvatar:function(e){var n=e.getId(),i=e.isJob(),a=e.getSkin();return t.createInstance("BasicAvatarSceneObject").init(n,i,a).then(function(e){return e.getAvatar().disableTouchEvent(),e})},_getAvatarFromCache:function(e){var n=t.createInstance("componentCache").get(this.AVATAR_CACHE_KEY)||[];return(a.find(n,{id:e})||{}).avatarSceneObject},_cacheAvatar:function(e,n){var i=t.createInstance("componentCache"),a=i.get(this.AVATAR_CACHE_KEY)||[],o=a.length%this.MAX_AVATAR_CACHE_COUNT;null!=a[o]&&a[o].avatarSceneObject.dispose(),a[o]={id:e,avatarSceneObject:n},i.cache(this.AVATAR_CACHE_KEY,a)},_removeAvatarFromCache:function(e){var n=t.createInstance("componentCache").get(this.AVATAR_CACHE_KEY)||[];a.remove(n,{id:e})},_getPedestalNode:function(){return n.getWidget(this.AVATAR_PEDESTAL_NODE_NAME,function(e){o.warn(this.className+": "+e)}.bind(this))}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("poprank.eventHandling"),t.poprank.eventHandling.CharacterDetailButtonTouchEventHandler=n.Class.extend({className:"CharacterDetailButtonTouchEventHandler",handle:function(e){var n=e.getId(),i=t.createInstance("router").getCurrentFragment(),a=this._getReturnParams();t.createInstance("router").navigate("status/status_001",{status_001:{id:n,returnRoute:i,returnParams:a}})},_getReturnParams:function(){var e=t.createInstance("routerParams").getCurrentScene(),n=e.tabDelegateList[0].selected;return e.temporaryRouterParams.restoreParams={tabs:[n]},e.temporaryRouterParams}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("poprank.controller"),t.poprank.controller.VoteController=n.Class.extend({className:"VoteController",initialize:function(){var e=t.createInstance("ElectableCharacterPageListCollectionController"),n=t.createInstance("VoteVotingTicketCollectionController");t.createInstance("CharacterDetailButtonController"),this._voteButton=t.createInstance("VoteButtonController",[n]),this._pageLists=e,this._voteTickets=n},changeTab:function(e){t.createInstance("selectionController").changeSelectedRarityType(e),this._pageLists.showElectableCharacters(e),this._voteTickets.display(e),this._updateVoteButtonEnabledState(e)},_updateVoteButtonEnabledState:function(e){this._voteTickets.hasVotingTickets(e).then(function(e){e?this._voteButton.enable():this._voteButton.disable()}.bind(this))}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.console;t.createNameSpaceIfNotExists("poprank.controller"),t.poprank.controller.VotingTicketCollectionController=n.Class.extend({className:"VotingTicketCollectionController",display:function(e){return this._currentlyDisplayingRarityType=e,this._getVotingTicketControllerCollection().then(function(t){t[e].display()})},displayAll:function(){return this._getVotingTicketControllerCollection().then(function(e){i.invoke(e,"display")})},displayCurrentTicketOnView:function(e){var t=this._currentlyDisplayingRarityType;return this._getVotingTicketControllerCollection().then(function(n){n[t].displayOnView(e)})},updateAmount:function(e){var t=this._currentlyDisplayingRarityType;this._getVotingTicketControllerCollection().then(function(n){n[t].updateAmount(e)})},updateAmountByRarityType:function(e,t){this._getVotingTicketControllerCollection().then(function(n){n[t].updateAmount(e)})},calculateTicketAmountSelectionLimit:function(e){var t=this._getVotingTicketCollection(),n=this._currentlyDisplayingRarityType;return null==t||null==n?(a.warn(this.className+".calculateTicketAmountSelectionLimit: Could not obtain the amount of tickets owned, make sure the data is properly initialized."),0):t[n].calculateTicketAmountSelectionLimit(e)},hasReachedAmountSelectionLimit:function(e){var t=this._getVotingTicketCollection(),n=this._currentlyDisplayingRarityType;return null==t||null==n?(a.warn(this.className+".hasReachedAmountSelectionLimit: Could not obtain the amount of tickets owned, make sure the data is properly initialized."),!1):t[n].hasReachedAmountSelectionLimit(e)},hasVotingTickets:function(e){return this._getVotingTicketControllerCollection().then(function(t){return t[e].hasVotingTickets()})},_getVotingTicketControllerCollection:function(){return null!=this._votingTicketCollectionControllerInitializePromise?this._votingTicketCollectionControllerInitializePromise:(this._votingTicketCollectionControllerInitializePromise=this._getVotingTicketModelCollection().then(this._createVotingTicketCollectionController.bind(this)).then(this._setVotingTicketCollection.bind(this)).then(this._getVotingTicketCollection.bind(this)),this._votingTicketCollectionControllerInitializePromise)},_createVotingTicketCollectionController:function(e){return i.transform(e,function(e,n){e[n.getRarityType()]=t.createInstance("VotingTicketFactory").create(n)},{})},_getVotingTicketModelCollection:function(){return t.createInstance("VotingTicketRepository").import()},_setVotingTicketCollection:function(e){this._votingTicketCollection=e},_getVotingTicketCollection:function(){return this._votingTicketCollection}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.console;t.createNameSpaceIfNotExists("poprank.repository"),t.poprank.repository.VotingTicketRepository=n.Class.extend({className:"VotingTicketRepository",import:function(){return t.createInstance("apiAEvents").getVoteTickets().then(this._createModels.bind(this)).fail(function(e){a.error(e)})},_createModels:function(e){return i.map(e.body,this._createModel,this)},_createModel:function(e,n){var i=t.core.rarity.RARITY_TYPE[n];return t.createInstance("VotingTicketModel",[e,i])}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("poprank.controller"),t.poprank.controller.VotingTicketController=n.Class.extend({className:"VotingTicketController",ctor:function(e,t){this._votingTicketModel=e,this._votingTicketView=t},display:function(){this._votingTicketView.display(this._votingTicketModel)},displayOnView:function(e){e.display(this._votingTicketModel)},updateAmount:function(e){this._votingTicketModel.setAmount(e),this.display()},calculateTicketAmountSelectionLimit:function(e){var t=this._votingTicketModel.getAmount();return Math.min(e,t)},hasReachedAmountSelectionLimit:function(e){return this._votingTicketModel.getAmount()<=e},hasVotingTickets:function(){return this._votingTicketModel.getAmount()>0}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("poprank.factory"),t.poprank.factory.VotingTicketFactory=n.Class.extend({className:"VotingTicketFactory",VIEWS_BY_RARITY_TYPE:function(e,t){return e[t.R]="VotingTicketRView",e[t.SR]="VotingTicketSRView",e[t.SSR]="VotingTicketSSRView",e}({},t.core.rarity.RARITY_TYPE),create:function(e){var n=e.getRarityType(),i=this._createView(n);return t.createInstance("VotingTicketController",[e,i])},_createView:function(e){return t.createInstance(this.VIEWS_BY_RARITY_TYPE[e])}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("poprank.model"),t.poprank.model.VotingTicketModel=n.Class.extend({className:"VotingTicketModel",ctor:function(e,t){this._voteTicketData=e,this._rarityType=t},getRarityType:function(){return this._rarityType},getId:function(){return this._voteTicketData.item_id},getName:function(){return this._voteTicketData.name},getAmount:function(){return this._voteTicketData.num},setAmount:function(e){this._voteTicketData.num=e}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("poprank.controller"),t.poprank.controller.ElectableCharacterPageListCollectionController=n.Class.extend({className:"ElectableCharacterPageListCollectionController",ctor:function(){this._characterPageLists=this._initializeCharacterPageLists()},showElectableCharacters:function(e){this._characterPageLists[e].showElectableCharacters()},_initializeCharacterPageLists:function(){var e=t.core.rarity.RARITY_TYPE,n={};return n[e.R]=t.createInstance("ElectableCharacterPageListController",[e.R]),n[e.SR]=t.createInstance("ElectableCharacterPageListController",[e.SR]),n[e.SSR]=t.createInstance("ElectableCharacterPageListController",[e.SSR]),n}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("poprank.controller"),t.poprank.controller.ElectableCharacterPageListController=n.Class.extend({className:"ElectableCharacterPageListController",ctor:function(e){this._pageListSettings=this._initializePageListSettings(e)},showElectableCharacters:function(){var e=t.createInstance("selectionController").getSelected();if(null!=e&&(e.select(),e.displayAvatar()),!this._isShowing){this._isShowing=!0;var n=this._pageListSettings,i=khutil.getWidget(n.baseName,this._onNodeNotFound.bind(this)),a=i.seekWidgetByName(n.panelName),o=new t.poprank.view.ElectableCoreCardUi(a,"CoreCardCharacterUI",{actionName:"e_r"}),r=t.core.pager.model.ApiDataListFactory(n.apiName,n.apiMethod,n.apiParams),s=new t.core.pager.controller.PagerController(i,r,[o],a),c=i.seekWidgetByName(n.paginatorNode||"viewpage_three_ui");return new t.core.pager.view.button.ViewPageUi(c,s).initialize(),this._paginatorUI=s,s.initialize()}},_initializePageListSettings:function(e){return t.createInstance("ElectableCharacterPageListSettings").getSettings(e)},_onNodeNotFound:function(e){console.warn(this.className+": "+e)}})}((this||0).self||global),function(e){var t=e.kh;e.khutil,e.cc,e.ccui,e._,e.console,t.createNameSpaceIfNotExists("poprank.view"),t.poprank.view.ElectableCoreCardUi=t.core.pager.view.page.CoreCardUi.extend({className:"ElectableCoreCardUi",ctor:function(e,n,i){this._super.apply(this,arguments);var a=new t.core.eventHandling.BaseEventHandler(this._onTouchCharacter,this);this.setTouchEventHandler(a)},_updateOne:function(e,n,i,a){this._super.apply(this,arguments);var o=e[a];if(o){var r=o.getRawData(),s=t.createInstance("selectionController").getSelected(),c=this._createElectableCharacterController(i,r);if(null==s)return c.select(),void c.displayAvatar();i.seekWidgetByName("selecting_frame").setVisible(s.equalsId(c.getId()))}},_onTouchCharacter:function(e,n){var i=e.getRawData(),a=t.createInstance("ElectableCharacterTouchEventHandler"),o=this._createElectableCharacterController(n.getResult(),i);a.handle(o)},_createElectableCharacterController:function(e,n){return t.createInstance("ElectableCharacterFactory").create(e,n)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("poprank.eventHandling"),t.poprank.eventHandling.ElectableCharacterTouchEventHandler=n.Class.extend({className:"ElectableCharacterTouchEventHandler",handle:function(e){var n=t.createInstance("selectionController").getSelected(),i=e.getId();null!=n&&n.equalsId(i)||(e.select(),e.displayAvatar())}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;t.createNameSpaceIfNotExists("poprank.settings"),t.poprank.settings.ElectableCharacterPageListSettings=n.Class.extend({className:"ElectableCharacterPageListSettings",GENERAL_SETTINGS:{panelName:t.BtnsPageListParams.ELECTABLE_CHARACTER_LIST.panelName,panelsPerPage:t.BtnsPageListParams.ELECTABLE_CHARACTER_LIST.perPage,apiName:"apiAEvents",apiMethod:"getVoteTargets",cardType:"chara",cardFrame:"e_r"},SETTINGS_BY_RARITY:function(e,n){return e[n.SSR]={baseName:"tab_0_node",apiParams:["SSR",t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE]},e[n.SR]={baseName:"tab_1_node",apiParams:["SR",t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE]},e[n.R]={baseName:"tab_2_node",apiParams:["R",t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE]},e}({},t.core.rarity.RARITY_TYPE),getSettings:function(e){return i.assign({},this.GENERAL_SETTINGS,this.SETTINGS_BY_RARITY[e])}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("poprank.factory"),t.poprank.factory.ElectableCharacterFactory=n.Class.extend({className:"ElectableCharacterFactory",create:function(e,n){var i=t.createInstance("ElectableCharacterSelectionView",[e]),a=t.createInstance("ElectableCharacterModel",[n]);return t.createInstance("ElectableCharacterController",[i,a])}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=e.console;t.createNameSpaceIfNotExists("poprank.view"),t.poprank.view.ElectableCharacterSelectionView=i.Class.extend({className:"ElectableCharacterSelectionView",SELECTION_WIDGET_NAME:"selecting_frame",ctor:function(e){this._selectionWidget=n.getWidgetFromNode(e,this.SELECTION_WIDGET_NAME,function(e){a.warn(this.className+": "+e)}.bind(this))},display:function(){this._selectionWidget.setVisible(!0)},hide:function(){this._selectionWidget.setVisible(!1)}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("poprank.controller"),t.poprank.controller.ElectableCharacterController=n.Class.extend({className:"ElectableCharacterController",ctor:function(e,n){this._selectionView=e,this._electableCharacterModel=n,this._popularRankingAvatarView=t.createInstance("PopularRankingAvatarView"),this._electableCharacterAvatarView=t.createInstance("ElectableCharacterAvatarView",[this._popularRankingAvatarView])},select:function(){this._selectionView.display(),t.createInstance("selectionController").select(this)},deselect:function(){this._selectionView.hide(),this._displayAvatarPromise=this._getDisplayAvatarPromise().then(this._popularRankingAvatarView.remove.bind(this._popularRankingAvatarView))},displayAvatar:function(){this._displayAvatarPromise=this._getDisplayAvatarPromise().then(this._electableCharacterAvatarView.display.bind(this._electableCharacterAvatarView,this._electableCharacterModel))},displayGratitudeMessage:function(e){this._electableCharacterAvatarView.displayGratitudeMessage(e)},displayOnView:function(e){e.display(this._electableCharacterModel)},playWinAnimation:function(){this._popularRankingAvatarView.playWinAnimation()},getId:function(){return this._electableCharacterModel.getId()},equalsId:function(e){return this.getId()===e},_getDisplayAvatarPromise:function(){return null==this._displayAvatarPromise?Q.resolve():this._displayAvatarPromise.isFulfilled()?Q.resolve():this._displayAvatarPromise}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("poprank.controller"),t.poprank.controller.selectionController=n.Class.extend({className:"selectionController",ctor:function(){this._selectedCharacters={}},changeSelectedRarityType:function(e){null!=this._selectedCharacters[this._selectedRarityType]&&this._selectedCharacters[this._selectedRarityType].deselect(),this._selectedRarityType=e},select:function(e){var t=this._selectedCharacters[this._selectedRarityType];null!=t&&t!==e&&t.deselect(),this._selectedCharacters[this._selectedRarityType]=e},deselect:function(){null!=this._selectedCharacters[this._selectedRarityType]&&this._selectedCharacters[this._selectedRarityType].deselect(),this._selectedCharacters[this._selectedRarityType]=null},deselectAll:function(){_.invoke(this._selectedCharacters,"deselect"),this._selectedCharacters={}},getSelected:function(){return this._selectedCharacters[this._selectedRarityType]},getSelectedRarityType:function(){return this._selectedRarityType}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("poprank.model"),t.poprank.model.ElectableCharacterModel=n.Class.extend({className:"ElectableCharacterModel",ctor:function(e){this._electableCharacterData=e},getId:function(){return this._electableCharacterData.character_id},getName:function(){return this._electableCharacterData.name},getGratitudeMessage:function(){return this._electableCharacterData.message},getElementType:function(){return this._electableCharacterData.element_type},getRarity:function(){return this._electableCharacterData.rare},getSkin:function(){return 0},isJob:function(){return!1}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=e.console;t.createNameSpaceIfNotExists("poprank.view"),t.poprank.view.ElectableCharacterAvatarView=i.Class.extend({className:"ElectableCharacterAvatarView",WIDGET_NAMES:{CHARACTER_NAME:"name_label",GRATITUDE_MESSAGE_WIDGET:"poprank_002_balloon_ui",GRATITUDE_MESSAGE_LABEL:"balloon_label"},SHOW_GRATITUDE_MESSAGE_ANIMATION_NAME:"balloon",ctor:function(e){this._popularRankingAvatar=e},display:function(e){var t=e.getName();return this._getWidget(this.WIDGET_NAMES.CHARACTER_NAME).setString(t),this._hideGratitudeMessage(),this._popularRankingAvatar.display(e)},displayGratitudeMessage:function(e){var t=this._getWidget(this.WIDGET_NAMES.GRATITUDE_MESSAGE_WIDGET);this._getWidget(this.WIDGET_NAMES.GRATITUDE_MESSAGE_LABEL).setString(e),t.setVisible(!0),t.animate(this.SHOW_GRATITUDE_MESSAGE_ANIMATION_NAME,!1)},_hideGratitudeMessage:function(){this._getWidget(this.WIDGET_NAMES.GRATITUDE_MESSAGE_WIDGET).setVisible(!1)},_getWidget:function(e){return n.getWidget(e,function(e){a.warn(this.className+": "+e)}.bind(this))}})}((this||0).self||global),function(e){var t=e.kh,n=t.poprank.controller.VotingTicketCollectionController.prototype;t.createNameSpaceIfNotExists("poprank.controller"),t.poprank.controller.VoteVotingTicketCollectionController=t.poprank.controller.VotingTicketCollectionController.extend({className:"VoteVotingTicketCollectionController",ctor:function(){this._diConfig=t.poprank.config.VoteVotingTicketsDIConfig},display:function(e){return this._diConfig.apply(),n.display.apply(this,arguments)},displayAll:function(){return this._diConfig.apply(),n.displayAll.apply(this,arguments)},displayCurrentTicketOnView:function(e){return this._diConfig.apply(),n.displayCurrentTicketOnView.apply(this,arguments)},updateAmount:function(e){this._diConfig.apply(),n.updateAmount.apply(this,arguments)},calculateTicketAmountSelectionLimit:function(e){return n.calculateTicketAmountSelectionLimit.apply(this,arguments)},hasReachedAmountSelectionLimit:function(e){return n.hasReachedAmountSelectionLimit.apply(this,arguments)},hasVotingTickets:function(e){return n.hasVotingTickets.apply(this,arguments)}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=e.console;t.createNameSpaceIfNotExists("poprank.view"),t.poprank.view.VoteVotingTicketView=i.Class.extend({className:"VoteVotingTicketView",HEADER_LABEL_NAME:"header_sub_label",HEADER_LABEL_TEXT:"{name}{amount}",ctor:function(){this._headerLabel=this._getHeaderLabel()},display:function(e){var t=e.getName(),n=e.getAmount(),i=this.HEADER_LABEL_TEXT.replace("{name}",t).replace("{amount}",n);this._headerLabel.setString(i)},_getHeaderLabel:function(){return n.getWidget(this.HEADER_LABEL_NAME,function(e){a.warn(this.className+": "+e)}.bind(this))}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=e.ccui,o=e.console;t.createNameSpaceIfNotExists("poprank.controller"),t.poprank.controller.VoteButtonController=i.Class.extend({className:"VoteButtonController",BUTTON_NAME:"btn_vote",ctor:function(e){this._button=this._getButton(),this._view=t.createInstance("VoteButtonView",[this._button]),this._touchEvent=t.createInstance("VoteButtonTouchEventHandler",[e]),this._button.addTouchEventListener(this._onTouchButton,this)},enable:function(){this._button.setEnabled(!0),this._view.setGrayedOut(!1)},disable:function(){this._button.setEnabled(!1),this._view.setGrayedOut(!0)},_onTouchButton:function(e,t){t===a.Widget.TOUCH_ENDED&&this._touchEvent.handle(this)},_getButton:function(){return n.getWidget(this.BUTTON_NAME,function(e){o.warn(this.className+": "+e)}.bind(this))}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("poprank.view"),t.poprank.view.VoteButtonView=n.Class.extend({className:"VoteButtonView",ctor:function(e){this._buttonWidget=e},setGrayedOut:function(e){t.pc.roles.UIUtility._setGrayOutButton(this._buttonWidget,!e)}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=(e.ccui,e._,e.console);t.createNameSpaceIfNotExists("poprank.eventHandling"),t.poprank.eventHandling.VoteButtonTouchEventHandler=n.Class.extend({className:"VoteButtonTouchEventHandler",ctor:function(e){this._voteTickets=e},handle:function(e){t.createInstance("VoteProcessController",[this._voteTickets]).vote().then(function(){e.disable();var t=this._getSelectedRarityType();this._updateVoteButtonEnabledState(t,e)}.bind(this),function(e){e instanceof Error&&i.error(e)})},_getSelectedRarityType:function(){return t.createInstance("selectionController").getSelectedRarityType()},_updateVoteButtonEnabledState:function(e,t){this._voteTickets.hasVotingTickets(e).then(function(e){e?t.enable():t.disable()})}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=e.ccui,o=e.console;t.createNameSpaceIfNotExists("poprank.controller"),t.poprank.controller.CharacterDetailButtonController=i.Class.extend({className:"CharacterDetailButtonController",BUTTON_NAME:"btn_detail",ctor:function(){this._characterDetailButtonTouchEventHandler=t.createInstance("CharacterDetailButtonTouchEventHandler"),this._initTouchEventHandler()},_initTouchEventHandler:function(){n.getWidget(this.BUTTON_NAME,function(e){o.warn(this.className+": "+e)}.bind(this)).addTouchEventListener(this._onTouchButton,this)},_onTouchButton:function(e,n){if(n==a.Widget.TOUCH_ENDED){var i=t.createInstance("selectionController").getSelected();null!=i&&this._characterDetailButtonTouchEventHandler.handle(i)}}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("poprank.controller"),t.poprank.controller.VoteProcessController=n.Class.extend({className:"VoteProcessController",ctor:function(e){this._votingTickets=e},vote:function(){return this._cacheSelectedVoteTicketAmount(1),this._startVotingProcess()},_startVotingProcess:function(){var e=this._getSelectedCharacter();return this._promptUserForVoteTicketAmount(e).then(this._promptUserConfirmation.bind(this,e)).then(this._finalizeVote.bind(this,e)).then(this._applyVoteResult.bind(this,e))},_promptUserForVoteTicketAmount:function(e){return this._showVoteTicketAmountSelectionPopup(e).then(this._cacheSelectedVoteTicketAmount.bind(this))},_promptUserConfirmation:function(e){return this._showVoteConfirmationPopup(e).fail(function(){return this._startVotingProcess(),Q.reject()}.bind(this))},_applyVoteResult:function(e,t){this._updateNewTicketAmount(t),this._showVoteResultPopup(t,e).then(this._showCharacterGratitude.bind(this,e,t))},_finalizeVote:function(e){var n=this._getSelectedVoteTicketAmount();return t.createInstance("VoteResultRepository").finalizeVote(e,n)},_showVoteTicketAmountSelectionPopup:function(e){var i=this._getSelectedVoteTicketAmount(),a=t.poprank.controller.VoteTicketAmountSelectionPopupController.prototype,o=n.director.getRunningScene();return t.ImplantedPopup.createOrGet(o,a.ROOT_NODE,a.DI_NAME).open(e,this._votingTickets,i)},_showVoteConfirmationPopup:function(e){var i=this._getSelectedVoteTicketAmount(),a=t.poprank.controller.VoteConfirmationPopupController.prototype,o=n.director.getRunningScene();return t.ImplantedPopup.createOrGet(o,a.ROOT_NODE,a.DI_NAME).open(e,i)},_updateNewTicketAmount:function(e){var t=e.getTotalVoteTicketAmount();this._votingTickets.updateAmount(t)},_showVoteResultPopup:function(e,i){var a=t.poprank.controller.VoteResultPopupController.prototype,o=n.director.getRunningScene();return t.ImplantedPopup.createOrGet(o,a.ROOT_NODE,a.DI_NAME).open(e,i)},_showCharacterGratitude:function(e,t){var n=t.getGratitudeMessage();e.displayGratitudeMessage(n),e.playWinAnimation()},_cacheSelectedVoteTicketAmount:function(e){this._selectedVoteTicketAmount=e},_getSelectedVoteTicketAmount:function(){return this._selectedVoteTicketAmount},_getSelectedCharacter:function(){return t.createInstance("selectionController").getSelected()}})}((this||0).self||global),function(e){var t=e.kh;t.createNameSpaceIfNotExists("poprank.controller"),t.poprank.controller.VoteTicketAmountSelectionPopupController=t.ImplantedPopup.extend({className:"VoteTicketAmountSelectionPopupController",ROOT_NODE:"poprank_select",DI_NAME:"VoteTicketAmountSelectionPopupController",BUTTON_NAMES:{CONFIRM:"btn_ok",CANCEL:"btn_cancel"},open:function(e,n,i){return t.ImplantedPopup.prototype.open.apply(this,arguments).then(this._getSelectedTicketAmount.bind(this))},_initContents:function(e,t,n){this._initButtons(),this._initializeVoteTicketAmountSelectionUIController(t,n),this._displayVoteTicketAmount(t),this._displayCharacterInformation(e)},_displayVoteTicketAmount:function(e){this._voteTicketView=t.createInstance("VoteTicketAmountSelectVoteTicketAmountView",[this.getNode()]),e.displayCurrentTicketOnView(this._voteTicketView)},_displayCharacterInformation:function(e){this._electableCharacterView=t.createInstance("VoteTicketAmountSelectElectableCharacterView",[this.getNode()]),e.displayOnView(this._electableCharacterView)},_initializeVoteTicketAmountSelectionUIController:function(e,n){this._voteTicketAmountSelectionUIController=t.createInstance("VoteTicketAmountSelectionUIController",[this.getNode(),e,n])},_getSelectedTicketAmount:function(){return this._voteTicketAmountSelectionUIController.getSelectedAmount()},_initButtons:function(){var e={};e[this.BUTTON_NAMES.CONFIRM]=this._confirmSelection.bind(this),e[this.BUTTON_NAMES.CANCEL]=this._cancelVotingProcess.bind(this),this.setButtonEvents(e)},_confirmSelection:function(){this._clear(),this.dismiss(!0)},_cancelVotingProcess:function(){this._clear(),this.dismiss(!1)},_clear:function(){this._voteTicketView.clear(),this._electableCharacterView.clear()}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=e.ccui,o=e._,r=e.console;t.createNameSpaceIfNotExists("poprank.controller"),t.poprank.controller.VoteTicketAmountSelectionUIController=i.Class.extend({className:"VoteTicketAmountSelectionUIController",SELECTED_AMOUNT_DISPLAY_NAME:"poll_number_label",BUTTON_NAMES:{MINUS_TEN:"btn_minus_ten",MINUS_ONE:"btn_minus_one",PLUS_ONE:"btn_plus_one",PLUS_TEN:"btn_plus_ten",SELECT_MAX:"btn_use_all"},BUTTON_VALUES:{MINUS_TEN:-10,MINUS_ONE:-1,PLUS_ONE:1,PLUS_TEN:10,SELECT_MAX:9999},TICKET_AMOUNT_LOWER_SELECTION_LIMIT:1,ctor:function(e,t,n){this._rootWidget=e,this._votingTicketCollectionController=t,this._selectionAmountLabel=this._getWidget(this.SELECTED_AMOUNT_DISPLAY_NAME),this._initializeButtons(),this._updateSelectedAmount(n)},getSelectedAmount:function(){return this._selectedAmount},_updateSelectedAmount:function(e){e=this._applySelectedAmountLimits(e),this._selectedAmount=e,this._selectionAmountLabel.setString(e.toString()),this._updateButtonStatus(e)},_initializeButtons:function(){this._buttons=o.transform(this.BUTTON_NAMES,function(e,t,n){var i=this._getWidget(t);i.setUserData(this.BUTTON_VALUES[n]),i.addTouchEventListener(this._onTouchButton,this),i.setLockTimeout(0),e[n]=i}.bind(this),{})},_getWidget:function(e){return n.getWidgetFromNode(this._rootWidget,e,function(e){r.warn(this.className+": "+e)}.bind(this))},_onTouchButton:function(e,t){if(t===a.Widget.TOUCH_ENDED){var n=this.getSelectedAmount();r.log("SELECTED VALUE: "+n),n+=e.getUserData(),this._updateSelectedAmount(n)}},_applySelectedAmountLimits:function(e){return e=this._votingTicketCollectionController.calculateTicketAmountSelectionLimit(e),Math.max(e,this.TICKET_AMOUNT_LOWER_SELECTION_LIMIT)},_updateButtonStatus:function(e){var t=e===this.TICKET_AMOUNT_LOWER_SELECTION_LIMIT,n=this._votingTicketCollectionController.hasReachedAmountSelectionLimit(e);this._setButtonEnabled(this._buttons.MINUS_ONE,!t),this._setButtonEnabled(this._buttons.MINUS_TEN,!t),this._setButtonEnabled(this._buttons.PLUS_TEN,!n),this._setButtonEnabled(this._buttons.PLUS_ONE,!n)},_setButtonEnabled:function(e,n){t.pc.roles.UIUtility._setEnableButton(e,n)}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=e.console;t.createNameSpaceIfNotExists("poprank.view"),t.poprank.view.VoteTicketAmountSelectElectableCharacterView=i.Class.extend({className:"VoteTicketAmountSelectElectableCharacterView",IMAGE_VIEW:"corecard_chara_ui_90",NAME_LABEL:"poll_target_labelimg",NAME_TEXT:"<span class='white'></span><span class='yellow'>{name}</span>",ctor:function(e){this._rootWidget=e},display:function(e){this._displayImage(e),this._displayName(e)},clear:function(){this._coreCard.clearImg(),this._coreCard=null,this._getWidget(this.NAME_LABEL).loadTexture("")},_displayImage:function(e){var n=this._getWidget(this.IMAGE_VIEW),i=e.getId(),a=e.getSkin(),o=e.getElementType(),r=e.getRarity(),s=t.createInstance("CoreCardCharacterUI",["e_r",n]);s.setImg(i,a),s.setIconElement(o),s.setIconRarity(r),this._coreCard=s},_displayName:function(e){var n=e.getName(),i=this.NAME_TEXT.replace("{name}",n),a={};a[this.NAME_LABEL]=i,this._rootWidget.setHtmlStrings(a,t.GameConfig.POPUP_CSS)},_getWidget:function(e){return n.getWidgetFromNode(this._rootWidget,e,function(e){a.warn(this.className+": "+e)}.bind(this))}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=e.console;t.createNameSpaceIfNotExists("poprank.view"),t.poprank.view.VoteTicketAmountSelectVoteTicketAmountView=i.Class.extend({className:"VoteTicketAmountSelectVoteTicketAmountView",AMOUNT_LABEL:"poll_ticket_number_labelimg",AMOUNT_TEXT:"<span class='white'></span><span class='yellow'>{amount}</span>",ctor:function(e){this._rootWidget=e},display:function(e){var n=e.getAmount(),i=this.AMOUNT_TEXT.replace("{amount}",n),a={};a[this.AMOUNT_LABEL]=i,this._rootWidget.setHtmlStrings(a,t.GameConfig.POPUP_CSS)},clear:function(){n.getWidgetFromNode(this._rootWidget,this.AMOUNT_LABEL,function(e){a.warn(this.className+": "+e)}.bind(this)).loadTexture("")}})}((this||0).self||global),function(e){var t=e.kh;e.khutil,e.cc,e.ccui,e._,e.console,t.createNameSpaceIfNotExists("poprank.controller"),t.poprank.controller.VoteConfirmationPopupController=t.ImplantedPopup.extend({className:"VoteConfirmationPopupController",ROOT_NODE:"poprank_check",DI_NAME:"VoteConfirmationPopupController",BUTTON_NAMES:{CONFIRM:"btn_ok",CANCEL:"btn_cancel"},open:function(e,n){return t.ImplantedPopup.prototype.open.apply(this,arguments)},_initContents:function(e,t){this._selectedVoteTicketAmount=t,this._displayCharacterInformation(e),this._displaySelectedVoteTicketAmount(t),this._initButtons()},_displayCharacterInformation:function(e){this._electableCharacterView=t.createInstance("VoteConfirmationElectableCharacterView",[this.getNode()]),e.displayOnView(this._electableCharacterView)},_displaySelectedVoteTicketAmount:function(e){this._voteTicketAmountView=t.createInstance("VoteConfirmationVoteTicketAmountView",[this.getNode()]),this._voteTicketAmountView.display(e)},_initButtons:function(){var e={};e[this.BUTTON_NAMES.CONFIRM]=this._confirm.bind(this),e[this.BUTTON_NAMES.CANCEL]=this._cancelVotingProcess.bind(this),this.setButtonEvents(e)},_confirm:function(){this._clear(),this.dismiss(!0)},_cancelVotingProcess:function(){this._clear(),this.dismiss(!1)},_clear:function(){this._electableCharacterView.clear(),this._voteTicketAmountView.clear()}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=(e.ccui,e._,e.console);t.createNameSpaceIfNotExists("poprank.view"),t.poprank.view.VoteConfirmationElectableCharacterView=i.Class.extend({className:"VoteConfirmationElectableCharacterView",NAME_LABEL:"poll_target_labelimg",NAME_TEXT:"<span class='white'></span><span class='yellow'>{name}</span>",ctor:function(e){this._rootWidget=e},display:function(e){var n=e.getName(),i=this.NAME_TEXT.replace("{name}",n),a={};a[this.NAME_LABEL]=i,this._rootWidget.setHtmlStrings(a,t.GameConfig.POPUP_CSS)},clear:function(){this._getWidget(this.NAME_LABEL).loadTexture("")},_getWidget:function(e){return n.getWidgetFromNode(this._rootWidget,e,function(e){a.warn(this.className+": "+e)}.bind(this))}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=e.console;t.createNameSpaceIfNotExists("poprank.view"),t.poprank.view.VoteConfirmationVoteTicketAmountView=i.Class.extend({className:"VoteConfirmationVoteTicketAmountView",AMOUNT_LABEL:"poll_number_labelimg",AMOUNT_TEXT:"<span class='white'></span><span class='yellow'>{selectedVoteTicketAmount}</span>",ctor:function(e){this._rootWidget=e},display:function(e){var n=this.AMOUNT_TEXT.replace("{selectedVoteTicketAmount}",e.toString()),i={};i[this.AMOUNT_LABEL]=n,this._rootWidget.setHtmlStrings(i,t.GameConfig.POPUP_CSS)},clear:function(){this._getWidget(this.AMOUNT_LABEL).loadTexture("")},_getWidget:function(e){return n.getWidgetFromNode(this._rootWidget,e,function(e){a.warn(this.className+": "+e)}.bind(this))}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=(e.ccui,e._,e.console);t.createNameSpaceIfNotExists("poprank.repository"),t.poprank.repository.VoteResultRepository=n.Class.extend({className:"VoteResultRepository",finalizeVote:function(e,t){return this._postVote(e,t).then(this._createVoteResultModel)},_postVote:function(e,n){var a=e.getId();return t.createInstance("apiAEvents").postVote(a,"character",n).fail(function(e){i.error(e&&e.stack?e.stack:e)})},_createVoteResultModel:function(e){return t.createInstance("VoteResultModel",[e.body])}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("poprank.model"),t.poprank.model.VoteResultModel=n.Class.extend({className:"VoteResultModel",ctor:function(e){this._voteResultData=e},getTotalVoteTicketAmount:function(){return this._voteResultData.remaining_vote_tickets},getVoteTicketAmountSpend:function(){return this._voteResultData.vote_tickets_used},getVoteTicketAmountBefore:function(){return this.getTotalVoteTicketAmount()+this.getVoteTicketAmountSpend()},getVoteTicketAmountAfter:function(){return this.getTotalVoteTicketAmount()},getGratitudeMessage:function(){return this._voteResultData.message}})}((this||0).self||global),function(e){var t=e.kh;e.khutil,e.cc,e.ccui,e._,e.console,t.createNameSpaceIfNotExists("poprank.controller"),t.poprank.controller.VoteResultPopupController=t.ImplantedPopup.extend({className:"VoteResultPopupController",ROOT_NODE:"poprank_result",DI_NAME:"VoteResultPopupController",BUTTON_NAMES:{CONFIRM:"btn_ok"},open:function(e,n){return t.ImplantedPopup.prototype.open.apply(this,arguments)},_initContents:function(e,t){this._displayCharacterInformation(t),this._displayVoteTicketInformation(e),this._initButtons()},_displayCharacterInformation:function(e){this._electableCharacterView=t.createInstance("VoteResultElectableCharacterView",[this.getNode()]),e.displayOnView(this._electableCharacterView)},_displayVoteTicketInformation:function(e){this._voteResultView=t.createInstance("VoteResultView",[this.getNode()]),this._voteResultView.display(e)},_initButtons:function(){var e={};e[this.BUTTON_NAMES.CONFIRM]=this._confirm.bind(this),this.setButtonEvents(e)},_confirm:function(){this._clear(),this.dismiss(!0)},_clear:function(){this._voteResultView.clear(),this._electableCharacterView.clear()}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=(e.ccui,e._);e.console,t.createNameSpaceIfNotExists("poprank.view"),t.poprank.view.VoteResultView=i.Class.extend({className:"VoteResultView",WIDGET_NAMES:{USED_VOTE_TICKETS:"poll_number_labelimg",CHANGED_VOTE_TICKETS:"poll_ticket_number_labelimg"},USED_VOTE_TICKET_TEXT:"<span class='white'></span><span class='yellow'>{voteTicketAmountSpend}</span>",CHANGED_VOTE_TICKET_TEXT:"<span class='white'>{voteTicketAmountBefore}</span><span class='red'>{voteTicketAmountAfter}</span>",ctor:function(e){this._rootWidget=e},display:function(e){this._displayVoteTicketAmountSpend(e),this._displayVoteTicketAmountChanged(e)},clear:function(){a(this.WIDGET_NAMES).map(n.getWidgetFromNode.bind(n,this._rootWidget)).invoke("loadTexture","")},_displayVoteTicketAmountSpend:function(e){var t=e.getVoteTicketAmountSpend(),n=this.USED_VOTE_TICKET_TEXT.replace("{voteTicketAmountSpend}",t);this._setHtmlTextToWidget(this.WIDGET_NAMES.USED_VOTE_TICKETS,n)},_displayVoteTicketAmountChanged:function(e){var t=e.getVoteTicketAmountBefore(),n=e.getVoteTicketAmountAfter(),i=this.CHANGED_VOTE_TICKET_TEXT.replace("{voteTicketAmountBefore}",t).replace("{voteTicketAmountAfter}",n);this._setHtmlTextToWidget(this.WIDGET_NAMES.CHANGED_VOTE_TICKETS,i)},_setHtmlTextToWidget:function(e,n){var i={};i[e]=n,this._rootWidget.setHtmlStrings(i,t.GameConfig.POPUP_CSS)}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=(e.ccui,e._,e.console);t.createNameSpaceIfNotExists("poprank.view"),t.poprank.view.VoteResultElectableCharacterView=i.Class.extend({className:"VoteResultElectableCharacterView",NAME_LABEL:"poll_target_labelimg",NAME_TEXT:"<span class='white'></span><span class='yellow'>{name}</span>",ctor:function(e){this._rootWidget=e},display:function(e){var n=e.getName(),i=this.NAME_TEXT.replace("{name}",n),a={};a[this.NAME_LABEL]=i,this._rootWidget.setHtmlStrings(a,t.GameConfig.POPUP_CSS)},clear:function(){this._getWidget(this.NAME_LABEL).loadTexture("")},_getWidget:function(e){return n.getWidgetFromNode(this._rootWidget,e,function(e){a.warn(this.className+": "+e)}.bind(this))}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=e.ccui,o=(e._,e.console);t.createNameSpaceIfNotExists("poprank.controller"),t.poprank.controller.RankedCharacterController=i.Class.extend({className:"RankedCharacterController",CHARACTER_PORTRAIT_WIDGET_NAME:"chara_img",ctor:function(e){this._rankedCharacterView=t.createInstance("RankedCharacterPanelView",[e]),this._initializeOnCharacterTouchEvent(e)},initializeModel:function(e){this._rankedCharacterModel=t.createInstance("RankedCharacterModel",[e])},display:function(){this._rankedCharacterView.display(this._rankedCharacterModel)},clear:function(){this._rankedCharacterView.clear()},getId:function(){return this._rankedCharacterModel.getId()},_initializeOnCharacterTouchEvent:function(e){n.getWidgetFromNode(e,this.CHARACTER_PORTRAIT_WIDGET_NAME,function(e){o.warn(this.className+": "+e)}.bind(this)).addTouchEventListener(this._onTouchCharacter,this)},_onTouchCharacter:function(e,n){n===a.Widget.TOUCH_ENDED&&t.createInstance("RankedCharacterOnTouchEventHandler").handle(this)}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=(e.ccui,e._),o=e.console;e.res,t.createNameSpaceIfNotExists("core.ranking"),t.core.ranking.RankingPageListController=i.Class.extend({className:"RankingPageListController",GENERAL_SETTINGS:{baseName:"window_gray",panelName:null,paginatorNode:"viewpage_three_ui",apiName:"apiAEvents",apiMethod:"getEventRanking",apiParams:[]},LIST_ITEM_CONTROLLER:"RankingStatusController",ctor:function(e){this._rankingType=e,this._pageListSettings=this._initializePageListSettings(e)},showRanking:function(){this._isShowing||(this._isShowing=!0,this._makePageList(this._pageListSettings))},setOnPageRenderedCallback:function(e){this._onPageRenderedCallback=e},refresh:function(e){this._paginatorUI.refresh(e)},_makePageList:function(e){var i=n.getWidget(e.baseName,this._onNodeNotFound.bind(this));this._createPageListItems(e,i);var a=i.seekWidgetByName(e.panelName),o=new t.core.pager.view.page.BasePageUiFactory(a,this._initializeStatusPanel.bind(this)),r=t.core.pager.model.ApiDataListFactory(e.apiName,e.apiMethod,e.apiParams),s=new t.core.pager.controller.PagerController(i,r,[o],a);s.addUpdateEventListener(this._fireOnPageRenderedEvent,this);var c=i.seekWidgetByName(e.paginatorNode)||i.seekWidgets(function(e){return"viewpage_ui"===e.getName()||"viewpage_s_ui"===e.getName()})[0];return new t.core.pager.view.button.ViewPageUi(c,s).initialize(),this._paginatorUI=s,s.initialize()},_createPageListItems:function(e,t){var i=n.getWidgetFromNode(t,e.panelName,this._onNodeNotFound.bind(this));this._pageListItems=a.map(i.getChildren(),function(e){e.setUserData({rankingStatusController:this._instantiateStatusPanel(e)})}.bind(this))},_instantiateStatusPanel:function(e){o.error("MUST implement: _instantiateStatusPanel")},_initializeStatusPanel:function(e,t){var n=e.getUserData().rankingStatusController;return null==t?void n.hideStatusPanel():(n.initializeModel(t.getRawData()),void n.displayStatusPanel())},_initializePageListSettings:function(e){o.error("MUST implement:_initializePageListSettings")},_fireOnPageRenderedEvent:function(){a.isFunction(this._onPageRenderedCallback)&&this._onPageRenderedCallback()},_onNodeNotFound:function(e){o.warn(this.className+": "+e)},clean:function(){t.cleanupProperties(this)},dispose:function(){this.clean()}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=(e.ccui,e._),o=e.console;t.createNameSpaceIfNotExists("poprank.controller"),t.poprank.controller.RankingPageListController=t.core.ranking.RankingPageListController.extend({className:"RankingPageListController",showCharacters:function(){this.showRanking();var e=i.director.getRunningScene().seekWidgetByName("nothing_node");e&&this.setOnPageRenderedCallback(function(){var t=this._paginatorUI.getDataList().getExistsRecordCount()>0;e.setVisible(!t)}.bind(this))},_initializePageListSettings:function(e){return t.createInstance("RankingPageListSettings").getSettings(e)},_createPageListItems:function(e,t){var i=n.getWidgetFromNode(t,e.panelName,this._onNodeNotFound.bind(this));this._pageListItems=a.map(i.getChildren(),function(e){e.setUserData({rankedCharacterController:this._instantiateStatusPanel(e)})}.bind(this))},_instantiateStatusPanel:function(e){return t.createInstance("RankedCharacterController",[e])},_initializeStatusPanel:function(e,n){if(null!=n){var i=e.getUserData().rankedCharacterController;i.initializeModel(n.getRawData()),t.createInstance("RankedCharacterPanelInitializeEventHandler").handle(i),e.setVisible(!0)}else e.setVisible(!1)},_onNodeNotFound:function(e){o.warn(this.className+": "+e)}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("poprank.controller"),t.poprank.controller.RankingPageListCollectionController=n.Class.extend({className:"RankingPageListCollectionController",ctor:function(){this._characterPageLists=this._initializeCharacterPageLists()},showCharacters:function(e){this._characterPageLists[e].showCharacters()},_initializeCharacterPageLists:function(){var e=t.core.rarity.RARITY_TYPE,n={};return n[e.R]=t.createInstance("PoprankRankingPageListController",[e.R]),n[e.SR]=t.createInstance("PoprankRankingPageListController",[e.SR]),n[e.SSR]=t.createInstance("PoprankRankingPageListController",[e.SSR]),n}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("poprank.controller"),t.poprank.controller.RankingUpdateTimeController=n.Class.extend({className:"RankingUpdateTimeController",CACHE_KEY:"poprank_ranking_update_time",displayLastUpdateTime:function(){return this._getRankingUpdateTimeModel().then(function(e){this._getRankingUpdateTimeView().display(e)}.bind(this))},_getRankingUpdateTimeModel:function(){var e=this._getRankingUpdateTimeModelFromCache();return null!=e?Q.resolve(e):t.createInstance("RankingUpdateTimeRepository").import().then(this._cacheRankingUpdateTimeModel.bind(this))},_getRankingUpdateTimeView:function(){return t.createInstance("RankingUpdateTimeView")},_cacheRankingUpdateTimeModel:function(e){var n=t.createInstance("componentCache"),i=e.getTimeUntilNextUpdate();return n.cache(this.CACHE_KEY,e,i),e},_getRankingUpdateTimeModelFromCache:function(){t.createInstance("componentCache").get(this.CACHE_KEY)}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=(e.ccui,e._),o=e.console;t.createNameSpaceIfNotExists("poprank.view"),t.poprank.view.RankedCharacterPanelView=i.Class.extend({className:"RankedCharacterPanelView",IMAGE_VIEW:"corecard_chara_ui_70",NAME_LABEL:"name_label",VOTE_RATING_LABEL:"poll_rate_labelimg",RANK_LABEL:"rank_label",RANK_ARROW:"poprank_rank_arrow_ui",VOTE_RATING_TEXT:"{voteRating}",PANEL_APPEARANCES_BY_RANK:{"?":"random","1":"1st","2":"2nd","3":"3rd",default:"below"},ctor:function(e){this._rootWidget=e},display:function(e){this._rootWidget.setVisible(!0),this._displayImage(e),this._displayName(e),this._displayVoteRating(e),this._setPanelType(e),this._displayRank(e),this._displayRankArrow(e)},clear:function(){null!=this._coreCard&&this._coreCard.clearImg(),this._coreCard=null,this._getWidget(this.NAME_LABEL).setString(""),this._getWidget(this.RANK_LABEL).setString(""),this._rootWidget.setVisible(!1)},_displayImage:function(e){var n=this._getWidget(this.IMAGE_VIEW),i=e.getId(),a=e.getSkin(),o=e.getElementType(),r=e.getRarity(),s=t.createInstance("CoreCardCharacterUI",["e_r",n]);s.setImg(i,a),s.setIconElement(o),s.setIconRarity(r),this._coreCard=s},_displayName:function(e){var t=this._getWidget(this.NAME_LABEL),n=e.getName();t.setString(n)},_displayVoteRating:function(e){var n=this._getWidget(this.VOTE_RATING_LABEL),i=this._makeHtmlStringsForVoteRanking(e);n.setHtmlStrings({poll_rate_labelimg:i},t.GameConfig.POPUP_CSS)},_makeHtmlStringsForVoteRanking:function(e){var t=e.isTransitionPercentOfVoteUp(),n=e.isTransitionPercentOfVoteSame(),i=e.getPercentOfVote(),a=t?"+"+e.getTransitionPercentOfVote():e.getTransitionPercentOfVote(),o=this.VOTE_RATING_TEXT.replace("{voteRating}",i);return a="(<span style='color:"+(n?"white":t?"blue":"red")+"'>"+a+"</span>)","<div class='text_common_left' style='font-size: 18px;'>"+o+"% "+(n||e.isFirstUpdate()?"":a)+"</div>"},_setPanelType:function(e){var t=e.getRank(),n=a.find(this.PANEL_APPEARANCES_BY_RANK,function(e,n){return t===n});null==n&&(n=this.PANEL_APPEARANCES_BY_RANK.default),this._rootWidget.setAppearance(n)},_displayRank:function(e){var t=e.getRank()+"";this._getWidget(this.RANK_LABEL).setString(t)},_displayRankArrow:function(e){var t=this._getWidget(this.RANK_ARROW),n=e.getRank();if(e.isMasking(n))t.setVisible(!1);else if(t.setVisible(!0),e.isFirstUpdate())t.setAppearance("rankup_hyphen");else{var i=e.isRankSame(),a=e.isRankUp(),o=i?"rankstay":a?"rankup":"rankdown";if(t.setAppearance(o),!i){var r=a?"blue_label":"red_label";this._getWidget(r).setString(e.getPreviousRank())}}},_getWidget:function(e){return n.getWidgetFromNode(this._rootWidget,e,function(e){o.warn(this.className+": "+e)}.bind(this))}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=(e.ccui,e._,e.console);t.createNameSpaceIfNotExists("poprank.view"),t.poprank.view.RankedCharacterAvatarView=i.Class.extend({className:"RankedCharacterAvatarView",NAME_LABEL:"name_label",RANK_LABEL:"avatar_info_node",ctor:function(){this._popularRankingAvatarView=t.createInstance("PopularRankingAvatarView")},display:function(e){return this._setNameLabel(e),this._setRankLabelVisible(!0),this._popularRankingAvatarView.display(e).then(function(){this._popularRankingAvatarView.playWinAnimation()}.bind(this))},hide:function(){this._popularRankingAvatarView.remove(),this._clearNameLabel(),this._setRankLabelVisible(!1)},_setNameLabel:function(e){var t=this._getWidget(this.NAME_LABEL),n=e.getName();t.setString(n)},_setRankLabelVisible:function(e){this._getWidget(this.RANK_LABEL).setVisible(e)},_clearNameLabel:function(){this._getWidget(this.NAME_LABEL).setString("")},_getWidget:function(e){return n.getWidget(e,function(e){a.warn(this.className+": "+e)}.bind(this))}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("poprank.eventHandling"),t.poprank.eventHandling.RankedCharacterPanelInitializeEventHandler=n.Class.extend({className:"RankedCharacterPanelInitializeEventHandler",handle:function(e){e.display()}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("poprank.eventHandling"),t.poprank.eventHandling.RankedCharacterOnTouchEventHandler=n.Class.extend({className:"RankedCharacterOnTouchEventHandler",handle:function(e){var n=e.getId(),i=t.createInstance("router").getCurrentFragment(),a=this._getReturnParams();t.createInstance("router").navigate("status/status_001",{status_001:{id:n,returnRoute:i,returnParams:a}})},_getReturnParams:function(){var e=t.createInstance("routerParams").getCurrentScene(),n=e.tabDelegateList[0].selected;return e.temporaryRouterParams.restoreParams={tabs:[n]},e.temporaryRouterParams}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("poprank.eventHandling"),t.poprank.eventHandling.TentativeRankingPageInitializeEventHandler=n.Class.extend({className:"TentativeRankingPageInitializeEventHandler",handle:function(){t.createInstance("EventRepository").import().then(function(e){t.createInstance("apiAEvents").setEventIdDelegate(e.getEventId()),t.createInstance("BackgroundController").displayBackground(),t.createInstance("RankingUpdateTimeController").displayLastUpdateTime()})}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("poprank.eventHandling"),t.poprank.eventHandling.TentativeRankingPageOnTabChangeEventHandler=n.Class.extend({className:"TentativeRankingPageOnTabChangeEventHandler",ctor:function(e){this._rankingPageListCollectionController=e,this._rankedCharacterAvatarCollectionController=t.createInstance("RankedCharacterAvatarCollectionController")},handle:function(e){this._rankingPageListCollectionController.showCharacters(e),this._rankedCharacterAvatarCollectionController.displayAvatar(e)}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=(e.ccui,e._);e.console,t.createNameSpaceIfNotExists("poprank.model"),t.poprank.model.RankedCharacterModel=n.Class.extend({className:"RankedCharacterModel",ctor:function(e){this._rankedCharacterData=e},getId:function(){return this._rankedCharacterData.character_id},getName:function(){return this._rankedCharacterData.name},getRarity:function(){return this._rankedCharacterData.rare},getRarityType:function(){return t.core.rarity.RARITY_TYPE[this._rankedCharacterData.rare]},getElementType:function(){return this._rankedCharacterData.element_type},getRank:function(){return this.isMasking(this._rankedCharacterData.rank)?this._rankedCharacterData.rank:parseInt(this._rankedCharacterData.rank)},getPreviousRank:function(){return this._rankedCharacterData.previous_rank},isFirstUpdate:function(){return 0===this.getPreviousRank()},getPercentOfVote:function(){return this._rankedCharacterData.percent_of_vote},getTransitionPercentOfVote:function(){return parseFloat(this._rankedCharacterData.transition_percent_of_vote)},getSkin:function(){return 0},isJob:function(){return!1},isEmpty:function(){return i.isEmpty(this._rankedCharacterData)},isRankUp:function(){return this.getRank()<this.getPreviousRank()},isRankSame:function(){return this.getRank()===this.getPreviousRank()},isTransitionPercentOfVoteUp:function(){return this.getTransitionPercentOfVote()>0},isTransitionPercentOfVoteSame:function(){return 0===this.getTransitionPercentOfVote()},isMasking:function(e){return i.include(e,"?")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("poprank.model"),t.poprank.model.RankingUpdateTimeModel=n.Class.extend({className:"RankingUpdateTimeModel",ctor:function(e){this._rankingUpdateTimeData=e},getLastUpdateTime:function(){return this._rankingUpdateTimeData.last_update_time},getTimeUntilNextUpdate:function(){return this._rankingUpdateTimeData.time_until_next_update}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=(e.ccui,e._);e.console,t.createNameSpaceIfNotExists("poprank.settings"),t.poprank.settings.RankingPageListSettings=n.Class.extend({className:"RankingPageListSettings",GENERAL_SETTINGS:{panelName:t.BtnsPageListParams.CHARACTER_RANKING_LIST.panelName,panelsPerPage:t.BtnsPageListParams.CHARACTER_RANKING_LIST.perPage,paginatorNode:"viewpage_three_ui",apiName:"apiAEvents",apiMethod:"getRanking"},SETTINGS_BY_RARITY:function(e,n){return e[n.SSR]={baseName:"tab_0_node",apiParams:["SSR",t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE]},e[n.SR]={baseName:"tab_1_node",apiParams:["SR",t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE]},e[n.R]={baseName:"tab_2_node",apiParams:["R",t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE]},e}({},t.core.rarity.RARITY_TYPE),getSettings:function(e){return i.assign({},this.GENERAL_SETTINGS,this.SETTINGS_BY_RARITY[e])}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=(e.ccui,e._,e.console);t.createNameSpaceIfNotExists("poprank.repository"),t.poprank.repository.RankingUpdateTimeRepository=n.Class.extend({className:"RankingUpdateTimeRepository",import:function(){return t.createInstance("apiAEvents").getLastRankingUpdate().then(this._createModel.bind(this)).fail(function(e){i.error(e&&e.stack?e.stack:e)})},_createModel:function(e){return t.createInstance("RankingUpdateTimeModel",[e.body])}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=(e.ccui,e._,e.console);t.createNameSpaceIfNotExists("poprank.view"),t.poprank.view.RankingUpdateTimeView=i.Class.extend({className:"RankingUpdateTimeView",SUB_HEADER_LABEL:"header_sub_label",display:function(e){var t=n.getWidget(this.SUB_HEADER_LABEL,function(e){a.warn(this.className+": "+e)}.bind(this)),i=e.getLastUpdateTime();t.setString(i)}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=(e.ccui,e._);e.console,t.createNameSpaceIfNotExists("poprank.controller"),t.poprank.controller.RankedCharacterAvatarCollectionController=n.Class.extend({className:"RankedCharacterAvatarCollectionController",displayAvatar:function(e){this._displayPromise=this._getDisplayPromise().then(this._hideCurrentAvatar.bind(this)).then(this._displayNewAvatar.bind(this,e))},_getDisplayPromise:function(){return null==this._displayPromise?Q.resolve():this._displayPromise.isFulfilled()?Q.resolve():this._displayPromise},_displayNewAvatar:function(e){return this._getRankedCharacterAvatarCollection().then(function(t){return this._currentlyDisplayedAvatar=t[e],this._currentlyDisplayedAvatar.displayAvatar()}.bind(this))},_hideCurrentAvatar:function(){this._currentlyDisplayedAvatar&&this._currentlyDisplayedAvatar.hideAvatar()},_getRankedCharacterAvatarCollection:function(){return null!=this._rankedAvatarCollectionInitializePromise?this._rankedAvatarCollectionInitializePromise:(this._rankedAvatarCollectionInitializePromise=this._getRankedCharacterModelCollection().then(function(e){return i.transform(e,function(e,n,i){e[i]=t.createInstance("RankedCharacterAvatarController",[n])},{})}),this._rankedAvatarCollectionInitializePromise)},_getRankedCharacterModelCollection:function(){return t.createInstance("TopRankedCharacterRepository").import()}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("poprank.controller"),t.poprank.controller.RankedCharacterAvatarController=n.Class.extend({className:"RankedCharacterAvatarController",ctor:function(e){this._rankedCharacterModel=e,this._rankedCharacterAvatarView=t.createInstance("RankedCharacterAvatarView")},displayAvatar:function(){return this._rankedCharacterModel.isEmpty()?(this._rankedCharacterAvatarView.hide(),Q.resolve()):this._rankedCharacterAvatarView.display(this._rankedCharacterModel)},hideAvatar:function(){this._rankedCharacterAvatarView.hide()}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=(e.ccui,e._),a=e.console;t.createNameSpaceIfNotExists("poprank.repository"),t.poprank.repository.TopRankedCharacterRepository=n.Class.extend({className:"TopRankedCharacterRepository",import:function(){return t.createInstance("apiAEvents").getUpperRanks().then(this._createModels.bind(this)).fail(function(e){a.error(e&&e.stack?e.stack:e)})},_createModels:function(e){return i.transform(e.body,function(e,n,i){e[t.core.rarity.RARITY_TYPE[i]]=this._createModel(n)}.bind(this),{})},_createModel:function(e){return t.createInstance("RankedCharacterModel",[e])}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("poprank.controller"),t.poprank.controller.BackgroundController=n.Class.extend({className:"BackgroundController",displayBackground:function(){return this._getEventModel().then(function(e){t.createInstance("BackgroundView").displayBackground(e)})},displayBackgroundWithAnnouncementLogo:function(){return this._getEventModel().then(function(e){t.createInstance("BackgroundView").displayBackgroundWithAnnouncementLogo(e)})},displayBackgroundWithInSessionLogo:function(){return this._getEventModel().then(function(e){t.createInstance("BackgroundView").displayBackgroundWithInSessionLogo(e)})},_getEventModel:function(){return t.createInstance("EventRepository").import()}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=(e.ccui,e._),o=e.console;t.createNameSpaceIfNotExists("poprank.view"),t.poprank.view.BackgroundView=i.Class.extend({className:"BackgroundView",BACKGROUND_ANNOUNCEMENT_IMAGE_PATH:"poprank-bg000_event_{eventId}",BACKGROUND_IN_SESSION_IMAGE_PATH:"poprank-bg001_event_{eventId}",BACKGROUND_IMAGE_PATH:"poprank-bg002_event_{eventId}",BACKGROUND_EXTENSION:"jpg",BACKGROUND_ANNOUNCEMENT_NODE:"poprank-bg000",BACKGROUND_IN_SESSION_NODE:"poprank-bg001",BACKGROUND_NODE:"poprank-bg002",displayBackground:function(e){this._displayBackground(this.BACKGROUND_NODE,this.BACKGROUND_IMAGE_PATH,e)},displayBackgroundWithAnnouncementLogo:function(e){this._displayBackground(this.BACKGROUND_ANNOUNCEMENT_NODE,this.BACKGROUND_ANNOUNCEMENT_IMAGE_PATH,e)},displayBackgroundWithInSessionLogo:function(e){this._displayBackground(this.BACKGROUND_IN_SESSION_NODE,this.BACKGROUND_IN_SESSION_IMAGE_PATH,e)},_displayBackground:function(e,t,n){var i=this._getBackgroundNode(e),a=n.getEventId(),o=this._getImagePath(t,a);i.loadTexture(o)},_getBackgroundNode:function(e){return n.getWidget(e,function(e){o.warn(this.className+": "+e)}.bind(this))},_getImagePath:function(e,n){return e=e.replace("{eventId}",a.padZero(n,4)),t.img.apply(t,e.split("_"))[this.BACKGROUND_EXTENSION]}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=(e.ccui,e._,e.console);t.createNameSpaceIfNotExists("poprank.model"),t.poprank.model.EventModel=n.Class.extend({className:"EventModel",ctor:function(e){this._eventId=e},fetch:function(){return t.createInstance("apiAEvents").getDetail("poprank_event",this.getEventId()).then(function(e){var t=e.body;return this._isfirstAccess=t.first_access,this._isReceivedReward="poprank_event_ranking_announcement"===t.event_type,this}.bind(this))},getEventId:function(){return null==this._eventId&&i.error(this.className+".getEventId: No event id set!"),this._eventId},isFirstAccess:function(){return!0===this._isfirstAccess},isReceivedReward:function(){return this._isReceivedReward}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("poprank.repository"),t.poprank.repository.EventRepository=n.Class.extend({className:"EventRepository",EVENT_ID_CACHE_KEY:"poprank_event_id",import:function(){var e=this._getEventIdFromRouterParameters(),t=this._createEventModel(e);return Q.resolve(t)},_getEventIdFromRouterParameters:function(){return n.director.getRunningScene().temporaryRouterParams.event_id},_createEventModel:function(e){return t.createInstance("EventModel",[e])}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("poprank.controller"),t.poprank.controller.CheeringPointsController=n.Class.extend({className:"CheeringPointsController",exchangeForVotingTickets:function(){return t.createInstance("ExchangeResultRepository").exchange().then(function(e){return t.createInstance("PoprankExchangeResultController",[e])})},displayAmount:function(){this._getCheeringPointsModel().then(function(e){this._getCheeringPointsView().display(e)}.bind(this))},updateAmount:function(e){this._getCheeringPointsModel().then(function(t){t.setAmount(e),this._getCheeringPointsView().display(t)}.bind(this))},hasEnoughPointsForExchange:function(){return this._getCheeringPointsModel().then(function(e){return e.hasEnoughPointsForExchange()})},_getCheeringPointsView:function(){return null!=this._cheeringPointsView?this._cheeringPointsView:(this._cheeringPointsView=t.createInstance("CheeringPointsView"),this._cheeringPointsView)},_getCheeringPointsModel:function(){return this._cheeringPointsModelImportPromise?this._cheeringPointsModelImportPromise:(this._cheeringPointsModelImportPromise=t.createInstance("CheeringPointsRepository").import(),this._cheeringPointsModelImportPromise)}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=(e.ccui,e._);e.console,t.createNameSpaceIfNotExists("poprank.controller"),t.poprank.controller.ExchangeResultController=n.Class.extend({className:"ExchangeResultController",ctor:function(e){this._exchangeResultModel=e},displayVotingTicketAmountObtained:function(){this._createExchangeResultPopupView().open(this._exchangeResultModel)},updateTotalVotingTicketAmount:function(e){var n=[t.core.rarity.RARITY_TYPE.R,t.core.rarity.RARITY_TYPE.SR,t.core.rarity.RARITY_TYPE.SSR];i.each(n,function(t){var n=this._exchangeResultModel.getUpdatedTotalTicketAmount(t);e.updateAmountByRarityType(n,t)},this)},updateTotalCheeringPointsAmount:function(e){var t=this._exchangeResultModel.getRemainingCheeringPoints();e.updateAmount(t)},_createExchangeResultPopupView:function(){var e=t.poprank.view.ExchangeResultPopupView.prototype,i=e.ROOT_NODE,a=e.DI_NAME,o=n.director.getRunningScene();return t.ImplantedPopup.createOrGet(o,i,a)}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=(e.ccui,e._,e.console);t.createNameSpaceIfNotExists("poprank.view"),t.poprank.view.CheeringPointsView=i.Class.extend({className:"CheeringPointsView",AMOUNT_LABEL:"have_cheering_point_label",display:function(e){var t=n.getWidget(this.AMOUNT_LABEL,function(e){a.warn(this.className+": "+e)}.bind(this)),i=e.getAmount();t.setString(i.toString())}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=(e.cc,e.ccui,e._),a=e.console;t.createNameSpaceIfNotExists("poprank.view"),t.poprank.view.ExchangeResultPopupView=t.ImplantedPopup.extend({className:"ExchangeResultPopupView",ROOT_NODE:"poprank_exchange",DI_NAME:"ExchangeResultPopupView",TICKET_NAME_LABELS:function(e,t){return e[t.SSR]="item_label_0",e[t.SR]="item_label_1",e[t.R]="item_label_2",e}({},t.core.rarity.RARITY_TYPE),TICKET_NAME_TEXT:"{ticketName}",TICKET_AMOUNT_LABELS:function(e,t){return e[t.SSR]="number_label_0",e[t.SR]="number_label_1",e[t.R]="number_label_2",e}({},t.core.rarity.RARITY_TYPE),TICKET_AMOUNT_TEXT:"{ticketAmountObtained}",OK_BUTTON_NAME:"btn_ok",open:function(e){return t.ImplantedPopup.prototype.open.apply(this,arguments)},_initContents:function(e){i(this.TICKET_NAME_LABELS).keys().each(this._displayTicketName.bind(this,e)),this._displayTicketAmountObtained(e),this._initButtons()},_displayTicketName:function(e,t){var n=this._getWidget(this.TICKET_NAME_LABELS[t]),i=e.getVotingTicketName(t),a=this.TICKET_NAME_TEXT.replace("{ticketName}",i);n.setString(a)},_displayTicketAmountObtained:function(e){var t=e.getVotingTicketAmountObtained(),n=this.TICKET_AMOUNT_TEXT.replace("{ticketAmountObtained}",t);i.each(this.TICKET_AMOUNT_LABELS,function(e){this._getWidget(e).setString(n)},this)},_initButtons:function(){var e={};e[this.OK_BUTTON_NAME]=this.dismiss.bind(this,!0),this.setButtonEvents(e)},_getWidget:function(e){return n.getWidgetFromNode(this.getNode(),e,function(e){a.warn(this.className+": "+e)}.bind(this))}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("poprank.model"),t.poprank.model.CheeringPointsModel=n.Class.extend({className:"CheeringPointsModel",ctor:function(e){this._cheeringPointsData=e},getAmount:function(){return this._cheeringPointsData.amount},setAmount:function(e){this._cheeringPointsData.amount=e},hasEnoughPointsForExchange:function(){return this._cheeringPointsData.can_obtain_tickets}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=(e.ccui,e._);e.console,t.createNameSpaceIfNotExists("poprank.model"),t.poprank.model.ExchangeResultModel=n.Class.extend({className:"ExchangeResultModel",ctor:function(e){this._exchangeResultData=e,this._ticketAmountInfoCollection=i.transform(e.updated_total_ticket_amount_info,function(e,n,i){e[t.core.rarity.RARITY_TYPE[i]]=n})},getVotingTicketAmountObtained:function(){return this._exchangeResultData.ticket_amount_obtained},getUpdatedTotalTicketAmount:function(e){return this._ticketAmountInfoCollection[e].amount},getVotingTicketName:function(e){return this._ticketAmountInfoCollection[e].item_name},getRemainingCheeringPoints:function(){return this._exchangeResultData.remaining_cheering_points}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=(e.ccui,e._,e.console);t.createNameSpaceIfNotExists("poprank.repository"),t.poprank.repository.ExchangeResultRepository=n.Class.extend({className:"ExchangeResultRepository",exchange:function(){return t.createInstance("apiAEvents").postExchangeCheeringPoints().then(this._createModel.bind(this)).fail(function(e){i.error(e&&e.stack?e.stack:e)})},_createModel:function(e){return t.createInstance("ExchangeResultModel",[e.body])}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=(e.ccui,e._,e.console);t.createNameSpaceIfNotExists("poprank.repository"),t.poprank.repository.CheeringPointsRepository=n.Class.extend({className:"CheeringPointsRepository",import:function(){return t.createInstance("apiAEvents").getCheeringPoints().then(this._createModel.bind(this)).fail(function(e){i.error(e&&e.stack?e.stack:e)})},_createModel:function(e){return t.createInstance("CheeringPointsModel",[e.body])}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc,e.ccui,e._,e.console,t.poprank.controller.VotingTicketCollectionController.prototype);t.createNameSpaceIfNotExists("poprank.controller"),t.poprank.controller.ExchangeVotingTicketCollectionController=t.poprank.controller.VotingTicketCollectionController.extend({className:"ExchangeVotingTicketCollectionController",ctor:function(){this._diConfig=t.poprank.config.ExchangeVotingTicketsDIConfig},displayAll:function(){return this._diConfig.apply(),n.displayAll.apply(this,arguments)},updateAmountByRarityType:function(e,t){this._diConfig.apply(),n.updateAmountByRarityType.apply(this,arguments)}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=(e.ccui,e._),o=e.console;t.createNameSpaceIfNotExists("poprank.view"),t.poprank.view.ExchangeVotingTicketView=i.Class.extend({className:"ExchangeVotingTicketView",ROOT_NODE_NAME:"item_panel_{panelIndex}",IMAGE_VIEW_NAME:"item_img",AMOUNT_LABEL_NAME:"have_label",NAME_LABEL_NAME:"name_label",PANEL_INDEX_BY_RARITY_TYPE:function(e,t){return e[t.SSR]=0,e[t.SR]=1,e[t.R]=2,e}({},t.core.rarity.RARITY_TYPE),ITEM_IMAGE_PATH:"corecard_item_{itemId}",ITEM_IMAGE_EXTENSION:"jpg",display:function(e){this._initializeRootWidget(e),this._displayTicketImage(e),this._displayTicketItemName(e),this._displayTicketAmount(e)},_initializeRootWidget:function(e){var t=e.getRarityType(),i=this.PANEL_INDEX_BY_RARITY_TYPE[t],a=this.ROOT_NODE_NAME.replace("{panelIndex}",i);this._rootWidget=n.getWidget(a,function(e){o.warn(this.className+": "+e)}.bind(this))},_displayTicketImage:function(e){var n=this._getWidget(this.IMAGE_VIEW_NAME),i=e.getId(),o=this.ITEM_IMAGE_PATH.replace("{itemId}",a.padZero(i,4)),r=t.img.apply(t,o.split("_"))[this.ITEM_IMAGE_EXTENSION];n.loadTexture(r)},_displayTicketItemName:function(e){var t=this._getWidget(this.NAME_LABEL_NAME),n=e.getName();t.setString(n)},_displayTicketAmount:function(e){var t=this._getWidget(this.AMOUNT_LABEL_NAME),n=e.getAmount();t.setString(n.toString())},_getWidget:function(e){return n.getWidgetFromNode(this._rootWidget,e,function(e){o.warn(this.className+": "+e)}.bind(this))}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=e.ccui,o=(e._,e.console);t.createNameSpaceIfNotExists("poprank.controller"),t.poprank.controller.ExchangeButtonController=i.Class.extend({className:"ExchangeButtonController",BUTTON_NAME:"btn_ticket_exchange",ctor:function(e,t){this._buttonWidget=this._getButtonWidget(),this._initializeTouchEvent(e,t),this._view=this._createView()},showExclamationMark:function(){this._view.setExclamationMarkVisible(!0)},hideExclamationMark:function(){this._view.setExclamationMarkVisible(!1)},enable:function(){this._buttonWidget.setEnabled(!0),this._view.setGrayedOut(!0)},disable:function(){this._buttonWidget.setEnabled(!1),this._view.setGrayedOut(!1)},_getButtonWidget:function(){return n.getWidget(this.BUTTON_NAME,function(e){o.warn(this.className+": "+e)}.bind(this))},_initializeTouchEvent:function(e,n){var i=t.createInstance("ExchangeButtonTouchEventHandler",[e,n]);this._buttonWidget.addTouchEventListener(function(e,t){t===a.Widget.TOUCH_ENDED&&i.handle(this)},this)},_createView:function(){return t.createInstance("ExchangeButtonView",[this._buttonWidget])}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=(e.ccui,e._,e.console);t.createNameSpaceIfNotExists("poprank.view"),t.poprank.view.ExchangeButtonView=i.Class.extend({className:"ExchangeButtonView",EXCLAMATION_ICON_NAME:"info_icon",ctor:function(e){this._buttonWidget=e},setExclamationMarkVisible:function(e){n.getWidgetFromNode(this._buttonWidget,this.EXCLAMATION_ICON_NAME,function(e){a.warn(this.className+": "+e)}.bind(this)).setVisible(e)},setGrayedOut:function(e){t.pc.roles.UIUtility._setGrayOutButton(this._buttonWidget,e)}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("poprank.eventHandling"),t.poprank.eventHandling.ExchangeButtonTouchEventHandler=n.Class.extend({className:"ExchangeButtonTouchEventHandler",ctor:function(e,t){this._cheeringPointsController=e,this._votingTicketCollectionController=t},handle:function(e){e.hideExclamationMark(),e.disable(),t.createInstance("CheeringPointsController").exchangeForVotingTickets().then(function(e){e.displayVotingTicketAmountObtained(),e.updateTotalVotingTicketAmount(this._votingTicketCollectionController),e.updateTotalCheeringPointsAmount(this._cheeringPointsController)}.bind(this))}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("poprank.controller"),t.poprank.controller.SubtutorialController=n.Class.extend({className:"SubtutorialController",displaySubtutorial:function(){this._getEventId().then(this._getSubtutorialModel.bind(this)).then(this._openSubtutorialPopup.bind(this))},_getEventId:function(){return t.createInstance("EventRepository").import().then(function(e){return this._eventId=e.getEventId(),this._eventId}.bind(this))},_getSubtutorialModel:function(e){return t.createInstance("SubtutorialRepository").import(e)},_openSubtutorialPopup:function(e){var i=n.director.getRunningScene(),a=e.getPageLength();t.ImplantedPopup.createOrGet(i,"sub_tutorial","ImplantedSubTutorialPopup").open("poprank",a)}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("poprank.model"),t.poprank.model.SubtutorialModel=n.Class.extend({className:"SubtutorialModel",ctor:function(e){this._subtutorialData=e},getPageLength:function(){return this._subtutorialData.description_images.length}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=(e.ccui,e._,e.console);t.createNameSpaceIfNotExists("poprank.repository"),t.poprank.repository.SubtutorialRepository=n.Class.extend({className:"SubtutorialRepository",import:function(e){return t.createInstance("apiEvents").getPoprankDescriptionImages(e).then(this._createModel.bind(this)).fail(function(e){i.error(e)})},_createModel:function(e){return t.createInstance("SubtutorialModel",[e.body])}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("poprank.eventHandling"),t.poprank.eventHandling.ExchangePageInitializeEventHandler=n.Class.extend({className:"ExchangePageInitializeEventHandler",handle:function(){t.createInstance("EventRepository").import().then(function(e){t.createInstance("apiAEvents").setEventIdDelegate(e.getEventId()),t.createInstance("BackgroundController").displayBackgroundWithInSessionLogo();var n=t.createInstance("CheeringPointsController");n.displayAmount();var i=t.createInstance("ExchangeVotingTicketCollectionController");i.displayAll();var a=t.createInstance("ExchangeButtonController",[n,i]);n.hasEnoughPointsForExchange().then(function(e){e?(a.showExclamationMark(),a.enable()):(a.hideExclamationMark(),a.disable())});var o=t.createInstance("RewardExchangeInformationRepository");t.createInstance("GotoRewardButtonController",[o]).updateButtonState()})}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("poprank.eventHandling"),t.poprank.eventHandling.RewardPageInitializeEventHandler=n.Class.extend({className:"RewardPageInitializeEventHandler",ctor:function(e){this._rewardPageListController=e},handle:function(){t.createInstance("EventRepository").import().then(function(e){t.createInstance("apiAEvents").setEventIdDelegate(e.getEventId()),t.createInstance("BackgroundController").displayBackground(),this._rewardPageListController.displayRewards();var n=t.createInstance("RewardExchangeInformationRepository");t.createInstance("RewardExchangeDeadlineController",[n]).display(),t.createInstance("RewardAllButtonController",[n]).updateButtonState(),t.createInstance("VoteAmountController").displayVoteAmount()}.bind(this))}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("poprank.eventHandling"),t.poprank.eventHandling.RewardPageRefreshEventHandler=n.Class.extend({className:"RewardPageRefreshEventHandler",ctor:function(e){this._rewardPageListController=e},handle:function(){var e=t.createInstance("RewardExchangeInformationRepository");t.createInstance("RewardAllButtonController",[e]).updateButtonState(),this._rewardPageListController.refresh(!1)}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("poprank.eventHandling"),t.poprank.eventHandling.ReceiveRewardButtonTouchEventHandler=n.Class.extend({className:"ReceiveRewardButtonTouchEventHandler",handle:function(e){var i=e.getRewardId(),a=n.director.getRunningScene();t.ImplantedPopup.createOrGet(a,"prs_receive").open("",e.getRawPresentData()).then(function(){a._delegate._receivePresent(i),t.createInstance("myselfInfoRepository").allCacheClear()}.bind(this))}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("poprank.controller"),t.poprank.controller.VoteAmountController=n.Class.extend({className:"VoteAmountController",displayVoteAmount:function(){this._getRewardExchangeInformationModel().then(function(e){t.createInstance("VoteAmountView").display(e)})},_getRewardExchangeInformationModel:function(){return t.createInstance("RewardExchangeInformationRepository").import()}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("poprank.model"),t.poprank.model.RewardExchangeInformationModel=n.Class.extend({className:"RewardExchangeInformationModel",ctor:function(e){this._rewardExchangeInformationData=e},getVoteAmount:function(){return this._rewardExchangeInformationData.total_votes_made},canExchangeForRewards:function(){return this._rewardExchangeInformationData.can_exchange_for_rewards},getRewardExchangeDeadline:function(){return this._rewardExchangeInformationData.reward_receipt_deadline}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=(e.ccui,e._,e.console);t.createNameSpaceIfNotExists("poprank.view"),t.poprank.view.VoteAmountView=i.Class.extend({className:"VoteAmountView",AMOUNT_LABEL_NAME:"have_poll_label",display:function(e){var t=n.getWidget(this.AMOUNT_LABEL_NAME,function(e){a.warn(this.className+": "+e)}.bind(this)),i=e.getVoteAmount();t.setString(i.toString())}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("poprank.settings"),t.poprank.settings.RewardPageListSettings=n.Class.extend({className:"RewardPageListSettings",SETTINGS:{panelName:t.BtnsPageListParams.POPRANK_REWARD_LIST.panelName,panelsPerPage:t.BtnsPageListParams.POPRANK_REWARD_LIST.perPage,paginatorNode:"viewpage_ui",apiName:"apiAEvents",apiMethod:"getPoprankRewards",apiParams:[t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE],baseName:"Scene"},getSettings:function(){return this.SETTINGS}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=(e.ccui,e._,e.console);t.createNameSpaceIfNotExists("poprank.repository"),t.poprank.repository.RewardExchangeInformationRepository=n.Class.extend({className:"RewardExchangeInformationRepository",import:function(){return t.createInstance("apiAEvents").getRewardObtainmentInfo().then(this._createModel.bind(this)).fail(function(e){i.error(e)})},_createModel:function(e){return t.createInstance("RewardExchangeInformationModel",[e.body])}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=(e.ccui,e._,e.console);t.createNameSpaceIfNotExists("poprank.view"),t.poprank.view.ResultPageRewardExchangeDeadlineView=i.Class.extend({className:"ResultPageRewardExchangeDeadlineView",DATE_LABEL_NAME:"date_label",DATE_LABEL_TEXT:"{exchangeDeadline}",display:function(e){var t=e.getRewardExchangeDeadline(),i=n.getWidget(this.DATE_LABEL_NAME,function(e){a.warn(this.className+": "+e)}.bind(this)),o=this.DATE_LABEL_TEXT.replace("{exchangeDeadline}",t);i.setString(o)}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("poprank.eventHandling"),t.poprank.eventHandling.FinalRankingPageInitializeEventHandler=n.Class.extend({className:"FinalRankingPageInitializeEventHandler",handle:function(){t.createInstance("EventRepository").import().then(function(e){t.createInstance("apiAEvents").setEventIdDelegate(e.getEventId()),t.createInstance("BackgroundController").displayBackground();var n=t.createInstance("RewardExchangeInformationRepository"),i=t.createInstance("RewardExchangeDeadlineController",[n]),a=t.createInstance("ResultPageRewardExchangeDeadlineView");i.bindView(a),i.display(),t.createInstance("RankingUpdateTimeController").displayLastUpdateTime()})}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("poprank.eventHandling"),t.poprank.eventHandling.FinalRankingPageOnTabChangeEventHandler=n.Class.extend({className:"FinalRankingPageOnTabChangeEventHandler",ctor:function(){this._rankingPageListCollectionController=new t.poprank.controller.RankingPageListCollectionController,this._topRankedCharacterCollectionController=t.createInstance("TopRankedCharacterCollectionController")},handle:function(e){this._topRankedCharacterCollectionController.displayTopThree(e).then(function(){this._rankingPageListCollectionController.showCharacters(e)}.bind(this))}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=(e.ccui,e._);e.console,t.createNameSpaceIfNotExists("poprank.controller"),t.poprank.controller.TopRankedCharacterCollectionController=n.Class.extend({className:"TopRankedCharacterCollectionController",ctor:function(){this._rankedCharacterModelCollectionPromises={}},displayTopThree:function(e){return this._getTopRankedCharacterCollectionModel(e).then(function(e){i.each(e,this._displayTopRankedCharacter,this)}.bind(this))},_getTopRankedCharacterCollectionModel:function(e){return null!=this._rankedCharacterModelCollectionPromises[e]?this._rankedCharacterModelCollectionPromises[e]:(this._rankedCharacterModelCollectionPromises[e]=t.createInstance("TopFinalRankedCharacterRepository").import(e),this._rankedCharacterModelCollectionPromises[e])},_displayTopRankedCharacter:function(e){t.createInstance("TopRankedCharacterView").display(e)}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=(e.ccui,e._),o=e.console;t.createNameSpaceIfNotExists("poprank.view"),t.poprank.view.TopRankedCharacterView=i.Class.extend({className:"TopRankedCharacterView",NAME_LABEL_NAME:"name_label_{rankIndex}",IMAGE_VIEW_NAME:"battleburst_{rankIndex}",IMAGE_PATH:"battleburst_chara_{characterId}_0",IMAGE_EXTENSION:"jpg",MIN_RANK_INDEX:0,MAX_RANK_INDEX:2,display:function(e){var t=this._getRankIndex(e);t<this.MIN_RANK_INDEX||t>this.MAX_RANK_INDEX||(this._displayName(e,t),this._displayImage(e,t))},_displayName:function(e,t){var n=this.NAME_LABEL_NAME.replace("{rankIndex}",t),i=this._getWidget(n),a=e.getName();i.setString(a)},_displayImage:function(e,n){var i=e.getId(),o=this.IMAGE_PATH.replace("{characterId}",a.padZero(i,4)),r=t.img.apply(t,o.split("_"))[this.IMAGE_EXTENSION],s=this.IMAGE_VIEW_NAME.replace("{rankIndex}",n);this._getWidget(s).loadTexture(r)},_getRankIndex:function(e){var t=parseInt(e.getRank());return isNaN(t)?-1:t-1},_getWidget:function(e){return n.getWidget(e,function(e){o.warn(this.className+": "+e)}.bind(this))}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=(e.ccui,e._),a=e.console;t.createNameSpaceIfNotExists("poprank.repository"),t.poprank.repository.TopFinalRankedCharacterRepository=n.Class.extend({className:"TopFinalRankedCharacterRepository",RARITY_TYPE_TO_RARITY:function(e,t){return e[t.R]="R",e[t.SR]="SR",e[t.SSR]="SSR",e}({},t.core.rarity.RARITY_TYPE),import:function(e){var n=this.RARITY_TYPE_TO_RARITY[e],i=t.BtnsPageListParams.CHARACTER_RANKING_LIST.perPage;return t.createInstance("apiAEvents").getRanking(n,1,i).then(this._createModels.bind(this)).fail(function(e){a.error(e&&e.stack?e.stack:e)})},_createModels:function(e){return i.map(i.range(3),function(n){var i=e.body.data[n];return t.createInstance("RankedCharacterModel",[i])})}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("poprank.controller"),t.poprank.controller.InternalRouteController=n.Class.extend({className:"InternalRouteController",ROUTES:{EXCHANGE_PAGE:"poprank/poprank_001",VOTE_PAGE:"poprank/poprank_002",TENTATIVE_RANKING_PAGE:"poprank/poprank_003",REWARD_PAGE:"poprank/poprank_004",FINAL_RANKING_PAGE:"poprank/poprank_005"},navigateToExchangePage:function(e){this._navigate(this.ROUTES.EXCHANGE_PAGE,e)},navigateToVotePage:function(e){this._navigate(this.ROUTES.VOTE_PAGE,e)},navigateToTentativeRankingPage:function(e){this._navigate(this.ROUTES.TENTATIVE_RANKING_PAGE,e)},navigateToRewardPage:function(e){this._navigate(this.ROUTES.REWARD_PAGE,e)},navigateToFinalRankingPage:function(e){this._navigate(this.ROUTES.FINAL_RANKING_PAGE,e)},_navigate:function(e,n){t.createInstance("EventRepository").import().then(function(i){var a=i.getEventId();t.createInstance("router").navigate(e,n&&n.routerParams,{event_id:a})})},navigatePoprank004ToPrs001:function(e){t.createInstance("router").navigate("present/prs_001",{},{prs_001_002_003:{returnRoute:"poprank/poprank_004",eventId:e}})},navigateToMypage:function(){t.createInstance("router").navigate("mypage/my_001")},navigateToEvent:function(){t.createInstance("router").navigate("event/ev_000")}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=(e.ccui,e._);e.console,t.createNameSpaceIfNotExists("present.view"),t.present.view.PresentView=t.core.pager.view.PagerView.extend({className:"PresentView",_rootWidget:null,_notifyIconNode:null,_animationName:null,_touchMethod:null,ctor:function(e,t,n,i){this._rootWidget=e,this._animationName=t,this._notifyIconNode=n,this._touchMethod=i},initialize:function(){},setTouchEventHandler:function(e){},update:function(e,t,n){this._rootWidget&&!this._rootWidget.dispose&&(this._rootWidget.getChildren().forEach(this._updateOne.bind(this,e,n)),this._notifyIconNode&&this._notifyIconNode.setVisible(t.getExistsRecordCount()>0),this._lastPageModels=e)},_updateOne:function(e,t,n,a){var o=e[a];if(o){var r=o.getRawData();this._setPresentPanelCoreCard(n,r),n.setStrings({name_label:r.present_name||"",get_date_label:r.created_at?":"+r.created_at:"",received_date_label:r.received_at?":"+r.received_at:"",explanation_label:r.description||"",limit_date_label:r.expires?":"+r.expires:""});var s=n.seekWidgetByName("num_base");if(null!==s){var c=r.count>0;s.setVisible(c);var u=s.seekWidgetByName("num_label");u.setTextVerticalAlignment(i.TEXT_ALIGNMENT_CENTER),u.string=r.count||""}this._setButton(n,o,a),n.setVisible(!0),n.setAppearance(this._animationName)}else n.setVisible(!1)},_setPresentPanelCoreCard:function(e,i){var o=n.getCoreCardDINameByRecord(i),r=e.seekWidgetByName("corecard_ui"),s=a.extend({},i,i[i.kind+"_info"]),c=r.getUserData()||{};a.invoke(c,"setVisible",!1);var u=c[o];if(u instanceof t.CoreCardUI)return u.setData(s),void u.setVisible(!0);var l="CoreCardItemUI"!==o?"e_r":"plain";(u=t.createInstance(o,[l])).setData(s),r.addChild(u.getResult()),c[o]=u,r.setUserData(c)},_setButton:function(e,n,i){if("function"==typeof this._touchMethod){t.setTouchEventHandlers(e,{"TOUCH_ENDED btn_get":this._touchHandler.bind(this,i)});var a=e.seekWidgetByName("btn_get");this._setEnableButton(a,n.getRawData().can_receive),a.setVisible(!0)}},_touchHandler:function(e){var t=this._lastPageModels[e];t&&t.getRawData().can_receive&&this._touchMethod(t.getRawData())}}),t.assignRoles(t.present.view.PresentView,[t.pc.roles.UIUtility])}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.createNameSpaceIfNotExists("pc.view"),n.pc.view.PrsReceivePopup=n.ImplantedPopup.extend({_clear:function(){var e=this.getNode();e.setStrings({item_label:""}),e.setHtmlStrings({receive_labelimg:""},n.GameConfig.POPUP_CSS)},_initContents:function(e,t){this.setTitle(e),this.setButtonEvents({btn_cancel:!1,btn_ok:!0});var i=this.getNode(),a=this._adjustData(t);this._setProperCoreCardElementRarity(i,a),i.setStrings({item_label:a.reward_name});var o=" "+a.reward_amount;i.setHtmlStrings({receive_labelimg:"<table class='nb'><tr><td class='numbox_slong'><span class='white'>"+o+"</span></td></tr></table>"},n.GameConfig.POPUP_CSS)},dismiss:function(e){this._super(e),this._clear()},_adjustData:function(e){if(t.isNumber(e.a_present_id)?e=t.extend({},e,{reward_id:e.a_present_id,reward_name:e.present_name,reward_amount:e.count}):t.isNumber(e.reward_id)||(e=t.extend({},e,{reward_id:e.id,reward_name:e.name,reward_amount:e.count})),t.isUndefined(e.kind))return e;var n=e[e.kind+"_info"];return t.isUndefined(n)?e:t.extend({},e,n)}}),n.assignRoles(n.pc.view.PrsReceivePopup,[n.pc.roles.CoreCardCommon])}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);e.Q,t.pc.present=t.pc.present||{},t.pc.present.roles=t.pc.present.roles||{},t.pc.present.roles.Routing={_verifyRouterParams001:function(e){},_verifyRouterParams002:function(e){},_verifyRouterParams003:function(e){},_navigateToSceneBySceneRouterParams:function(e){return n.isUndefined(e)?void t.createInstance("router").navigate("mypage/my_001"):n.isUndefined(e.returnRoute)?void t.createInstance("router").navigate("mypage/my_001"):void t.createInstance("router").navigate(e.returnRoute,{},{event_id:e.eventId})}},n.assign(t.pc.present.roles.Routing,t.pc.roles.RoutingCommon)}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.present=t.pc.present||{},t.pc.present.prs_001_002_003=t.pc.present.prs_001_002_003||{},t.pc.present.prs_001_002_003.Scene=t.BaseScene.extend({resourceFileName:"prs_001_2_3/prs_001_2_3",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[{tab1:{node:"tab_0","content-node":"tab_0_node"},tab2:{node:"tab_1","content-node":"tab_1_node"},tab3:{node:"tab_2","content-node":"tab_2_node"}}],componentName:"present",sceneName:"prs_001_002_003",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath("tab_0_node"),"btn_all_receipt","btnCallbackTab0NodeBtnAllReceipt",null,function(){alert("{{ pre_carry_limitprs_receive_check}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("tab_1_node"),"btn_all_receipt","btnCallbackTab1NodeBtnAllReceipt",null,function(){alert("{{ pre_carry_limitprs_receive_check}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc=t.pc||{},t.pc.present=t.pc.present||{},t.pc.present.prs_001_002_003=t.pc.present.prs_001_002_003||{},t.pc.present.prs_001_002_003.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../prs_popup_ui.json"],_TARGET_LIST:{normal:{targetNode:"tab_0_node",apiName:"apiAPresents",methodName:"getPresentList",apiParams:["normal",t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE],touchFuncName:"_onTouchReceiveButton",notifyIcon:"new_icon_0",animationName:"no_limit"},timelimit:{targetNode:"tab_1_node",apiName:"apiAPresents",methodName:"getPresentList",apiParams:["timelimit",t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE],touchFuncName:"_onTouchLimitReceiveButton",notifyIcon:"new_icon_1",animationName:"has_limit"},received:{targetNode:"tab_2_node",apiName:"apiAPresents",methodName:"getPresentList",apiParams:["received",t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE],animationName:"received_log"}},_hasFilledUp:{},_popups:{},_controllers:{},onSceneInit:function(e){if(this._hasFilledUp={},this._controllers={},!e.restoreParams){var n=t.createInstance("router").getCurrentFragment(),o=parseInt(n.replace(/^[^1-9]*/,"")||"1");e.tabDelegateList[0].selectTab(e.seekWidgetByName("tab_"+--o))}return this._setBackBtn(e),a.all(i.values(this._listModels))},onSceneEnter:function(e){return this._listModels=i.mapValues(this._TARGET_LIST,this._prefetch.bind(this,e)),a.resolve()},onSceneExit:function(e){return i.invoke(this._controllers,"dispose"),a.resolve()},onPageInAnimationEnd:function(e){return a.defer(),a.resolve()},tabCallbackTab0:function(e){this._currentType="normal",e.seekWidgetByName("attention_label").setVisible(!1),this._hasFilledUp[this._currentType]||(this._fillupPresentBtnsList(e,this._currentType),this._hasFilledUp[this._currentType]=!0)},tabCallbackTab1:function(e){this._currentType="timelimit",e.seekWidgetByName("attention_label").setVisible(!1),this._hasFilledUp[this._currentType]||(this._fillupPresentBtnsList(e,this._currentType),this._hasFilledUp[this._currentType]=!0)},tabCallbackTab2:function(e){return this._currentType="received",e.seekWidgetByName("attention_label").setVisible(!0),this._hasFilledUp[this._currentType]?void this._controllers[this._currentType].refresh():(this._fillupPresentBtnsList(e,this._currentType),void(this._hasFilledUp[this._currentType]=!0))},_prefetch:function(e,n){var i=t.core.pager.model.ApiDataListFactory(n.apiName,n.methodName,n.apiParams,n.apiModel);return i.initialize(4).then(function(t){n.notifyIcon&&e.seekWidgetByName(n.notifyIcon).setVisible(t.length>0)}).thenResolve(i)},_fillupPresentBtnsList:function(e,n){this._listModels[n].then(function(i){var a=this._TARGET_LIST[n],o=e.seekWidgetByName(a.targetNode),r=o.seekWidgetByName("prs_cardlist_ui"),s=new t.present.view.PresentView(r,a.animationName,e.seekWidgetByName(a.notifyIcon),a.touchFuncName&&this[a.touchFuncName].bind(this,e)),c=new t.core.pager.controller.PagerController(o,i,[s],r),u=o.seekWidgetByName("viewpage_ui");new t.core.pager.view.button.ViewPageUi(u,c).initialize(),c.initialize(),this._controllers[n]=c}.bind(this))},btnCallbackTab0NodeBtnAllReceipt:function(e){var t=a.defer();return t.reject(this._override),this._confirmBeforeReceiveAll(),t.promise},btnCallbackTab1NodeBtnAllReceipt:function(e){var t=a.defer();return t.reject(this._override),this._confirmBeforeReceiveAll(),t.promise},_onTouchReceiveButton:function(e,t){this._openReceiveConfirmPopup(e,t,"").then(function(e){var n=t.a_present_id;return this._receivePresent(n)}.bind(this)).then(this._reload.bind(this,"normal"))},_onTouchLimitReceiveButton:function(e,t){this._openReceiveConfirmPopup(e,t,"").then(function(e){var n=t.a_present_id;return this._receivePresent(n)}.bind(this)).then(this._reload.bind(this,"timelimit"))},_receivePresent:function(e){return t.createInstance("apiAPresents").receivePresent(e).fail(function(e){console.error(e)})},_reload:function(e){var i=this._listModels.received;return i&&i.then(function(e){e.clearCache()}),this._controllers[e]?(this._controllers[e].refresh(!1),t.createInstance("myselfInfoRepository").allCacheClear(),void n.director.getRunningScene().headerDelegate.updateCurrency()):void console.warn("controller Not Found:"+e)},_confirmBeforeReceiveAll:function(){t.createInstance("apiAPresents").checkAvailablePresents(this._currentType).then(function(e){var t=e.body.received_info,n=e.body.not_received_info;t.length?this._showReceiveConfirmPopup(e.body):n.length&&this._showCarryLimitConfirmPopup(n,a.defer())}.bind(this)).fail(function(e){console.error(e)})},_receiveAllPresent:function(e){t.createInstance("apiAPresents").receiveAllPresent(this._currentType).then(function(t){return this._receiveAllPresentShowResult(t.body.received_info,e,"\r\n")}.bind(this)).then(this._reload.bind(this,this._currentType)).fail(function(e){console.error(e)})},_touchEndedBackBtnProcess:function(e){var t=e.temporaryRouterParams.prs_001_002_003;this._navigateToSceneBySceneRouterParams(t)}}),t.assignRoles(t.pc.present.prs_001_002_003.SceneDelegate,[t.pc.roles.UIUtility,t.pc.present.roles.Routing,t.pc.present.roles.PresentPopups])}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="APrizeHunt",o={getHuntProgress:function(e){return this._http.get({url:"/a_quests/prizehunt/"+e,json:{type:n.quest.QUEST_TYPE.PRIZE_HUNT}})},getResumableLaps:function(e){return this._http.get({url:"/a_quests/prizehunt/"+e+"/resumable_laps",json:{type:n.quest.QUEST_TYPE.PRIZE_HUNT}})},getHuntPrizeProgress:function(e){return this._http.get({url:"/a_quests/prizehunt/"+e+"/prize",json:{type:n.quest.QUEST_TYPE.PRIZE_HUNT}})},postAround:function(e){return this._http.post({url:"/a_quests/prizehunt/"+e+"/around",json:{type:n.quest.QUEST_TYPE.PRIZE_HUNT}})},confirmAround:function(e){return this._http.get({url:"/a_quests/prizehunt/"+e+"/around",json:{type:n.quest.QUEST_TYPE.PRIZE_HUNT}})},postNextState:function(e){return this._http.post({url:"/a_quests/prizehunt/"+e+"/next_state",json:{type:n.quest.QUEST_TYPE.PRIZE_HUNT}})},getPrizeList:function(e){return this._http.get({url:"/a_quests/prizehunt/"+e+"/getPrizeList"})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiAPrizeHunt",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},o)),n.env.useApiMock){n.MockApi=n.MockApi||{};var r={};t.each(o,function(e,t){r[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi."+a+"."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},r))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e.kh;e.cc,e._,t.createNameSpaceIfNotExists("prizehunt.view"),t.prizehunt.view.PrizehuntQuestCheckPopup=t.ImplantedPopup.extend({_aQuests:null,STANDARD:0,ULTIMATE:1,_initContents:function(e){var n={btn_close:!1,quest_base_top:this._touchQuestBaseStandard.bind(this),quest_base_bottom:this._touchQuestBaseUltimate.bind(this)};this.setButtonEvents(n);var i=this.getNode().bfsWidgetByName("btn_close");i.setSoundEnabled(!0),i.setSound(t.SoundList.BUTTON_TOUCHED_CANCEL),this._aQuests=e,this._setQuestInformation("top",this.STANDARD),this._setQuestInformation("bottom",this.ULTIMATE),this.getNode().seekWidgets(function(e){return 0===String(e.getName()).indexOf("questimg_prizehunt_")}).forEach(function(n,i){n.loadTexture(t.Img("questimg","prizehunt",e[i].difficulty).jpg)});var a=t.createInstance("prizeNoteBookModel");this.getNode().setStrings({remain_treasure_num:a.getRemainPrizeAmount()+" / "+a.getMaxPrizeAmount()+"",progress:a.getProgress()+"%"})},_touchQuestBaseStandard:function(){this._dfd.resolve(this._getAQuest(this.STANDARD)),this.dismiss(!0)},_touchQuestBaseUltimate:function(){this._dfd.resolve(this._getAQuest(this.ULTIMATE)),this.dismiss(!0)},_getAQuest:function(e){return this._aQuests[e]},_setQuestInformation:function(e,t){var n=this.getNode().bfsWidgetByName("quest_base_"+e),i=this._getAQuest(t);n.setStrings({quest_header_label:i.difficulty.toUpperCase(),quest_time_label:i.time_left,cons_ap_label:"AP"+i.quest_ap})}}),t.dictx.registerWithProtoStrategy("PrizehuntQuestCheckPopup",t.prizehunt.view.PrizehuntQuestCheckPopup)}((this||0).self||global),function(e){var t=e.kh;e.cc,e._,t.createNameSpaceIfNotExists("prizehunt.view"),t.prizehunt.view.PrizehuntResultPopup=t.ImplantedPopup.extend({_initContents:function(e){this.setButtonEvents({btn_ok:!0});var t=e.getPrizeProgress();this.getNode().setStrings({rainbow_have_label:t.getRainbowHaveAmountString(),gold_have_label:t.getGoldHaveAmountString(),silver_have_label:t.getSilverHaveAmountString(),bronze_have_label:t.getBronzeHaveAmountString(),total_stage_num:e.getTotalStageCount()+"",lap_num:e.getLaps()+"",total_point_num:e.getRankPoints(),total_exp_num:e.getExperiencePoint()})}}),t.dictx.registerWithProtoStrategy("PrizehuntResultPopup",t.prizehunt.view.PrizehuntResultPopup)}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);t.createNameSpaceIfNotExists("prizehunt.view"),t.prizehunt.view.PrizehuntResultItemCheckPopup=t.ImplantedPopup.extend(t.pc.list.roles.PageListControllerCommon).extend({TAB_BUTTON_PREFIX:"tab_treasure_",_resultModel:null,_selectedColors:null,_initContents:function(e){this._selectedColors=[];this.setButtonEvents({btn_ok:!0}),this._resultModel=e;var n=e.getPrizeProgress();this.getNode().setStrings({rainbow_have_label:n.getRainbowHaveAmountString(),gold_have_label:n.getGoldHaveAmountString(),silver_have_label:n.getSilverHaveAmountString(),bronze_have_label:n.getBronzeHaveAmountString()}),this.getNode().getChildByName("popup_base").getChildren().filter(function(e){return 0===e.getName().indexOf(this.TAB_BUTTON_PREFIX)}.bind(this)).forEach(function(e){e.setBright(!0),e.setSound(t.SoundList.BUTTON_TOUCHED_SWITCH),e.addTouchEventListener(this._tabButtonTouchEvent,this)}.bind(this)),this._updatePage()},_tabButtonTouchEvent:function(e,t){if(t===ccui.Widget.TOUCH_ENDED){var n=e.getName().substring(this.TAB_BUTTON_PREFIX.length);e.isBright()?this._selectedColors.push(n):this._selectedColors=this._selectedColors.filter(function(e){return n!==e}),e.setBright(!e.isBright()),this._updatePage()}},_updatePage:function(){var e=this._filter(this._resultModel.getPlainPrizeData());this._fillupList(this.getNode(),{viewParent:"page_item_panel",subPageRes:t.PageListParams.PRIZE_HUNT_RESULT_ITEM_CHECK.subPageRes,panelsPerPage:t.PageListParams.PRIZE_HUNT_RESULT_ITEM_CHECK.perPage},e,e.length,null,this._updatePrizeView.bind(this)),this.getNode().bfsWidgetByName("nothing_label").setVisible(0===e.length)},_filter:function(e){var t=this._selectedColors;return 0===this._selectedColors.length?e:e.filter(function(e){return t.indexOf(e.treasure_color_type)>-1})},_updatePrizeView:function(e,t,i){if(t&&!n.isEmpty(t)){var a=this._setProperCoreCardElementRarity(e,t,"corecard_ui");a.setGetNumber(t.amount>1?""+t.amount:""),a.setTreasureBox(t.treasure_color_type),e.getChildByName("corecard_ui").setVisible(!0)}else e.getChildByName("corecard_ui").setVisible(!1)},__initPageUiNodes:function(){var e=this._super.apply(this,arguments);if(0===e.length)return e;var t=this.getNode().bfsWidgetByName("page_item_panel").getContentSize(),n=e[0].getSize(),i=t.width/n.width,a=t.height/n.height;return e.forEach(function(e){e&&e.setScale(i,a)}),e}}),t.assignRoles(t.prizehunt.view.PrizehuntResultItemCheckPopup,[t.pc.roles.CoreCardCommon]),t.dictx.registerWithProtoStrategy("PrizehuntResultItemCheckPopup",t.prizehunt.view.PrizehuntResultItemCheckPopup)}((this||0).self||global),function(e){var t=e.kh;e.cc,e._,t.createNameSpaceIfNotExists("prizehunt.view"),t.prizehunt.view.PrizehuntExitCheckPopup=t.ImplantedPopup.extend({_initContents:function(){this.setButtonEvents({btn_cancel:!1,btn_ok:!0});var e=this.getNode().bfsWidgetByName("btn_cancel");e.setSoundEnabled(!0),e.setSound(t.SoundList.BUTTON_TOUCHED_CANCEL)}}),t.dictx.registerWithProtoStrategy("PrizehuntExitCheckPopup",t.prizehunt.view.PrizehuntExitCheckPopup)}((this||0).self||global),function(e){var t=e.kh;e.cc,e._,t.createNameSpaceIfNotExists("prizehunt.view"),t.prizehunt.view.PrizehuntStopCheckPopup=t.ImplantedPopup.extend({_initContents:function(){this.setButtonEvents({btn_cancel:!1,btn_ok:!0});var e=this.getNode().bfsWidgetByName("btn_cancel");e.setSoundEnabled(!0),e.setSound(t.SoundList.BUTTON_TOUCHED_CANCEL)}}),t.dictx.registerWithProtoStrategy("PrizehuntStopCheckPopup",t.prizehunt.view.PrizehuntStopCheckPopup)}((this||0).self||global),function(e){var t=e.kh;e.cc,e._,t.createNameSpaceIfNotExists("prizehunt.view"),t.prizehunt.view.PrizehuntNextCheckPopup=t.ImplantedPopup.extend({RETURN:1,_initContents:function(e,n){var i={btn_return:this._touchBtnReturn.bind(this),btn_to_next:!0,btn_close:!1};this.setButtonEvents(i);var a=this.getNode().bfsWidgetByName("btn_close");a.setSoundEnabled(!0),a.setSound(t.SoundList.BUTTON_TOUCHED_CANCEL),this.getNode().setStrings({cost_label:"AP:"+n.getRequireAp(),bonus_label:":"+n.getBonusAmount()}),this.getNode().setHtmlStrings({lap_num_labelimg:'<div class="text_common white" style="margin-top:30px"><div style="margin: 1em auto;"></div><div style="margin: 1em auto;">'+e.getLaps()+"  <span class=yellow>"+(Number(e.getLaps())+1)+"</span></div></div>"},t.GameConfig.POPUP_CSS)},_touchBtnReturn:function(){this._dfd.resolve(this.RETURN),this.dismiss(!0)}}),t.dictx.registerWithProtoStrategy("PrizehuntNextCheckPopup",t.prizehunt.view.PrizehuntNextCheckPopup)}((this||0).self||global),function(e){var t=e.kh,n=e._;t.createNameSpaceIfNotExists("prizehunt.view"),t.prizehunt.view.PRIZEHUNT_SELECT_STARTING_LAP_POPUP_NAME="prizehunt_around_select_on_prizehunt_quest_check",t.prizehunt.view.PrizeHuntSelectStartingLapPopup=t.ImplantedPopup.extend({_initContents:function(e){var i=this.getNode(),a=e.getResumableLaps(),o=n.map(a,function(e,t){var n={value:e,text:e.toString()};return 0===t&&(this._selectedLap=e,n.selected=!0),n},this),r=new t.Pulldown({button:i.seekWidgetByName("btn_sort"),label:i.seekWidgetByName("sort_label")},o);r.onChange(function(e){this._selectedLap=e.value}.bind(this)),this.setButtonEvents({btn_ok:function(){this.dismiss(!0),this.cleanUp()},btn_cancel:function(){this.dismiss(!1),this.cleanUp()}.bind(this)}),this._pulldown=r},getSelectedLap:function(){return this._selectedLap},cleanUp:function(){this._pulldown.cleanUp(),this._pulldown=null}})}((this||0).self||global),function(e){var t=e.kh;t.createNameSpaceIfNotExists("prizehunt.view"),t.prizehunt.view.PRIZEHUNT_HIGHEST_LAP_UPDATED_POPUP_NAME="prizehunt_around_save_check",t.prizehunt.view.PrizeHuntHighestLapUpdatedPopup=t.ImplantedPopup.extend({_initContents:function(e){var n=e.getHighestLap();this.getNode().setHtmlStrings({progress_labelimg:'<div class="text_common white" style="margin-top:30px"><div style="margin: 10px auto;"></div><div style="margin: 10px auto;"></div><div style="margin: 10px auto;"><span class="yellow">'+n+"</span></div></div>"},t.GameConfig.POPUP_CSS),this.setButtonEvents({btn_ok:!0})}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e._,t.createNameSpaceIfNotExists("prizehunt.controller"),t.prizehunt.controller.PrizeHuntQuestStateManager=n.Class.extend({_currentEvent:null,ctor:function(e){this._huntingProgressModel=e},getCurrentEvent:function(){return this._currentEvent||this._huntingProgressModel.getInitEvent()},returnQuest:function(){return t.createInstance("apiAQuests").giveupQuest(this._huntingProgressModel.getAQuestId(),t.quest.QUEST_TYPE.PRIZE_HUNT).then(function(e){return t.createInstance("aQuestInfo").dispose(),new t.prizehunt.model.PrizeHuntResult(e.body)}.bind(this))},goNextState:function(){return t.createInstance("apiAPrizeHunt").postNextState(this._huntingProgressModel.getQuestId()).then(function(e){this._huntingProgressModel.update(e.body.result);var n=new t.prizehunt.model.HuntNextState(e.body);return this._currentEvent=n.getCurrentEvent(),n}.bind(this))},confirmAround:function(){return t.createInstance("apiAPrizeHunt").confirmAround(this._huntingProgressModel.getQuestId()).then(function(e){return new t.prizehunt.model.AroundConfirm(e.body)})},goAround:function(){return t.createInstance("apiAPrizeHunt").postAround(this._huntingProgressModel.getQuestId()).then(function(e){var n=new t.prizehunt.model.AroundResult(e.body);return n.isSuccess()&&(this._currentEvent=n.getNextEvent(),this._huntingProgressModel.update(n.getPlainNextProgress())),n}.bind(this))}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e._,t.createNameSpaceIfNotExists("prizehunt.controller"),t.prizehunt.controller.QuestAnimation=t.EventSubject.extend({className:"QuestAnimationController",_scene:null,_arisaAnimNode:null,_prizeAnimNodes:null,_playingAnimPromise:Q.resolve(),_filterNode:null,SCENE_ANIM_NAME:{FADE_IN:"fade_in",FADE_OUT:"fade_out"},ARISA_ANIM_NAME:{APPEAR:"appear",WAIT:"wait",FIGHT:"fight",JOY:"joy",SAD:"sad",DISAPPEAR:"disappear"},ARISA_ANIM_SOUND:t.env.isSp?{appear:"res/prizehunt_quest/prizehunt_arisa_ani/se_prizehunt_enter_sp.mp3",disappear:"res/prizehunt_quest/prizehunt_arisa_ani/se_prizehunt_exit_sp.mp3"}:{appear:"res/prizehunt_quest/prizehunt_arisa_ani/se_prizehunt_enter_pc.mp3",disappear:"res/prizehunt_quest/prizehunt_arisa_ani/se_prizehunt_exit_pc.mp3"},TREASURE_ANIM_NAME:{PLAY:"treasure_get_ani",DEFAULT:"default"},LOGO_ANIM_NAME:{PLAY:"logo_ani",DEFAULT:"default"},LOGO:{WIN:"win",LOSE:"lose",NORMAL_BATTLE:"normal_battle",BOSS_BATTLE:"boss_battle"},EVENT_PREFIX:"a_prize_hunt_animation_",EVENT_NAME:{UPDATE_BRONZE:0,UPDATE_GOLD:1,UPDATE_SILVER:2,UPDATE_RAINBOW:3},ctor:function(e){this._super(),this._scene=e;var n=e.seekWidgetByName("Scene");this._arisaAnimNode=n.bfsWidgetByName("prizehunt_arisa_ani"),this._arisaAnimNode.setUserData({skip:!1}),this._prizeAnimNodes=this._findAnimNodes(n,"prizehunt_treasure_get_"),this._logoAnimNodes=this._findAnimNodes(n,"prizehunt_logo_"),this._filterNode=n.bfsWidgetByName("filter_black"),this._soundPlayer=t.createInstance("soundPlayer").init(t.createInstance("playerGameConfig"))},preload:function(){var e=Object.values(this.ARISA_ANIM_SOUND).map(function(e){var t=Q.defer();return n.loader.load(e,function(e,n){t.resolve()}),t});return Q.all(e)},playStart:function(e){return e instanceof t.prizehunt.model.event.Finish?(this._playingAnimPromise=this._playingAnimPromise.then(this._animateFadeIn.bind(this)),this._playingAnimPromise):(this._playingAnimPromise=this._playingAnimPromise.then(this._animateFadeIn.bind(this)).then(this._animateArisa.bind(this,this.ARISA_ANIM_NAME.APPEAR,!1)).then(this._beforeEventAnimate.bind(this,e)),this._playingAnimPromise)},_beforeEventAnimate:function(e){return e instanceof t.prizehunt.model.event.Battle?this._animateArisa(this.ARISA_ANIM_NAME.FIGHT,!0):this._animateArisa(this.ARISA_ANIM_NAME.WAIT,!0)},playNext:function(){return this._playingAnimPromise=this._playingAnimPromise.then(function(){return this._arisaAnimNode.animate(this.ARISA_ANIM_NAME.DISAPPEAR,!1).then(this._animateFadeOut.bind(this))}.bind(this)),this._playingAnimPromise},playBattle:function(e){return e.isBoss()?this._animateLogo(this.LOGO.BOSS_BATTLE):this._animateLogo(this.LOGO.NORMAL_BATTLE)},playBattleLose:function(){return this._playingAnimPromise=this._playingAnimPromise.then(function(){return this._animateArisa(this.ARISA_ANIM_NAME.SAD,!0),this._animateLogo(this.LOGO.LOSE)}.bind(this)),this._playingAnimPromise},playQuestEnd:function(){return this._playingAnimPromise=this._playingAnimPromise.then(function(){return Q.all([this._animateArisa(this.ARISA_ANIM_NAME.JOY,!0),this._animateLogo(this.LOGO.WIN)])}.bind(this)),this._playingAnimPromise},playGetPrize:function(e){return this._playingAnimPromise=this._playingAnimPromise.then(function(){var t=[];return e.hasRainbow()&&t.push(this._animateTreasure("rainbow")),e.hasGold()&&t.push(this._animateTreasure("gold")),e.hasSilver()&&t.push(this._animateTreasure("silver")),e.hasBronze()&&t.push(this._animateTreasure("bronze")),this._animateArisa(this.ARISA_ANIM_NAME.JOY,!0),t.push(this._animateArisa(this.ARISA_ANIM_NAME.DISAPPEAR,!1,1500)),Q.all(t).then(this._animateFadeOut.bind(this))}.bind(this)),this._playingAnimPromise},playBeforeAround:function(){return this._playingAnimPromise=this._playingAnimPromise.then(function(){return this._animateFadeIn()}.bind(this)),this._playingAnimPromise},playAround:function(e){this._playingAnimPromise=this._playingAnimPromise.then(this._animateArisa.bind(this,this.ARISA_ANIM_NAME.APPEAR,!1));var t=e.getBonusPrize();return t.hasPrize()?this.playGetPrize(t):this.playNext(),this._playingAnimPromise},skipAnimate:function(){for(var e in this._arisaAnimNode.setUserData({skip:!0}),this._arisaAnimNode.skipCurrentlyPlayingAnimation(),this._prizeAnimNodes)this._prizeAnimNodes[e].skipCurrentlyPlayingAnimation();for(var t in this._logoAnimNodes)this._logoAnimNodes[t].skipCurrentlyPlayingAnimation();this._playingAnimPromise.fin(function(){this._arisaAnimNode.setUserData({skip:!1})}.bind(this))},setFilterEnabled:function(e){this._filterNode.setTouchEnabled(e)},_animateArisa:function(e,t,n){return n?Q.delay(n).then(function(){if(!this._arisaAnimNode.getUserData().skip)return this._animateArisa(e,t);var n=this._arisaAnimNode.getAction();n.gotoFrameAndPause(n.animationInfo[e].endIndex)}.bind(this)):(this.ARISA_ANIM_SOUND[e]&&!this._arisaAnimNode.getUserData().skip&&this._soundPlayer.playSoundEffect(this.ARISA_ANIM_SOUND[e]),this._arisaAnimNode.animate(e,!0===t))},_animateTreasure:function(e){var t=this._prizeAnimNodes[e];return this._animateWithSound(t,this.TREASURE_ANIM_NAME.PLAY,!1).then(this.dispatchEvent.bind(this,"UPDATE_"+e.toUpperCase()))},_animateLogo:function(e){var t=this._logoAnimNodes[e];return this._animateWithSound(t,this.LOGO_ANIM_NAME.PLAY,!1)},_animateFadeIn:function(){return this._scene.animate("fade_in",!1)},_animateFadeOut:function(){return this._scene.animate("fade_out",!1)},_findAnimNodes:function(e,t){var n={};return e.getChildren().filter(function(e){return 0===e.getName().indexOf(t)}).forEach(function(e){n[e.getName().slice(t.length,-4)]=e}),n},_animateWithSound:function(e,n,i){var a=e.getAction(),o=a.animationInfo[n],r=t.createInstance("AnimationEventHandlerCcs_2_0").init(a);return t.createInstance("Sound2Event",[r,"sound2_s"]),a.gotoFrameAndPlay(o.startIndex,!0===i),i?Q.resolve():(e._currentlyPlayingAnimation=n,khutil.getPromiseWhenAnimationEnd(a,o.endIndex).then(function(){e._currentlyPlayingAnimation=null}))},dispose:function(){this.removeAllEventListeners(),t.cleanupProperties(this)}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);t.createNameSpaceIfNotExists("prizehunt.model"),t.prizehunt.model.PrizeNoteBook=t.EventSubject.extend({className:"PrizeNoteBook",EVENT_PREFIX:"a_hunting_prize_note_book",EVENT_NAME:{UPDATE_PROGRESS:0},_limitOfLottery:null,_sumOfLottery:null,_progress:null,_data:null,_promise:null,get:function(e,n){return!n&&this._promise||(this._promise=t.createInstance("apiAPrizeHunt").getPrizeList(e).then(function(e){this._limitOfLottery=e.body.limit_of_lottery,this._sumOfLottery=e.body.sum_of_lottery,this._data=e.body.data,this._progress=e.body.progress}.bind(this)).then(this.dispatchUpdateEvent.bind(this)).thenResolve(this)),this._promise},getProgress:function(){return 0===this.getRemainPrizeAmount()?"0":n.isNumber(this._progress)?String(this._progress):String(Math.floor(this._sumOfLottery/this._limitOfLottery*100))},getDataList:function(){return new t.core.pager.model.PlainDataList(this._data)},getRemainPrizeAmount:function(){return this._limitOfLottery-this._sumOfLottery||"0"},getMaxPrizeAmount:function(){return this._limitOfLottery||"0"},dispatchUpdateEvent:function(){this.dispatchEvent("UPDATE_PROGRESS",[this])},updateFromNextState:function(e){var t=e.getPrizeProgress();this._updateProgress(t.getAllAmount(),e.getBookProgress()),this.dispatchUpdateEvent()},updateFromAround:function(e){this._updateProgress(e.getBonusPrize().getAllAmount(),e.getBookProgress()),this.dispatchUpdateEvent()},_updateProgress:function(e,t){this._sumOfLottery=Math.min(this._sumOfLottery+e,this._limitOfLottery),this._progress=t},dispose:function(){this._promise=null}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);t.createNameSpaceIfNotExists("prizehunt.model"),t.prizehunt.model.HuntingProgress=t.EventSubject.extend({className:"HuntingProgress",EVENT_PREFIX:"a_hunting_progress",EVENT_NAME:{UPDATE_PROGRESS:0},_progress:null,_maxProgress:null,_lap:null,_haveBottleAmount:null,_haveMedicAmount:null,_huntMembers:[],_aQuestId:null,_questId:null,_currentEvent:null,get:function(e,n){return!n&&this._promise&&this._questId===e||(this._questId=e,this._promise=t.createInstance("apiAPrizeHunt").getHuntProgress(e).then(function(e){var n=e.body;return this._progress=n.now_progress,this._maxProgress=n.max_progress,this._lap=n.laps,this._huntMembers=n.hunt_members.map(function(e){return new t.prizehunt.model.HuntMember(e)}),this._haveBottleAmount=n.bottle_amount,this._haveMedicAmount=n.medic_amount,this._aQuestId=n.a_quest_id,this._currentEvent=t.prizehunt.model.event.factory(n.current_event),this._isBattleFinish=!0===n.is_battle_finished,this.dispatchEvent("UPDATE_PROGRESS",[this]),this}.bind(this))),this._promise},getQuestId:function(){return this._questId},getAQuestId:function(){return this._aQuestId},getProgress:function(){return this._progress||"0"},getMaxProgress:function(){return this._maxProgress||"0"},getLaps:function(){return this._lap||"0"},getLapString:function(){return n.isString(this._lap)?this._lap:this._lap>9999?this._lap+"+":this._lap+""},getHaveBottleAmount:function(){return this._haveBottleAmount||"0"},getHaveMedicAmount:function(){return this._haveMedicAmount||"0"},getHuntMember:function(e){return!this._huntMembers||this._huntMembers.length<=e?new t.prizehunt.model.HuntMember:this._huntMembers[e]},getInitEvent:function(){return this._currentEvent},isBattleFinished:function(){return this._isBattleFinish},update:function(e){e.gettable_progress>0&&(this._progress+=e.gettable_progress),this._progress=e.now_progress||this._progress,this._maxProgress=e.max_progress||this._maxProgress,this._lap=e.laps||this._lap,"object"==typeof e.current_event&&(this._currentEvent=t.prizehunt.model.event.factory(e.current_event),this._isBattleFinish=!1)},dispatchUpdateEvent:function(){this.dispatchEvent("UPDATE_PROGRESS",[this])},dispose:function(){this.removeAllEventListeners(),this._promise=null}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;t.createNameSpaceIfNotExists("prizehunt.model"),t.prizehunt.model.HuntMember=n.Class.extend({className:"HuntMember",ctor:function(e){this._member=e},getCoreCardData:function(){return{id:this._member.id,kind:this._member.kind}},getHp:function(){return this._member.hp||"0"},getMaxHp:function(){return this._member.max_hp},getHpGauge:function(){return 0==this._member.hp?0:this._member.hp_gauge||Math.floor(this._member.hp/this._member.max_hp*100)},isDead:function(){return!this._member.hp},getPos:function(){return this._member.pos},isEmpty:function(){return i.isEmpty(this._member)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e._,t.createNameSpaceIfNotExists("prizehunt.model"),t.prizehunt.model.HuntPrizeProgress=n.Class.extend({className:"HuntPrizeProgress",_promise:null,_rainbow_have_amount:null,_gold_have_amount:null,_silver_have_amount:null,_bronze_have_amount:null,ctor:function(e){if("object"!=typeof e)return this;var t=e.body||e;return this._rainbow_have_amount=t.rainbow||0,this._gold_have_amount=t.gold||0,this._silver_have_amount=t.silver||0,this._bronze_have_amount=t.bronze||0,this},get:function(e,n){return!n&&this._promise||(this._promise=t.createInstance("apiAPrizeHunt").getHuntPrizeProgress(e).then(this.ctor.bind(this))),this._promise},union:function(e){Q.all([this._promise,e._promise]).then(function(){this._rainbow_have_amount+=e._rainbow_have_amount||0,this._gold_have_amount+=e._gold_have_amount||0,this._silver_have_amount+=e._silver_have_amount||0,this._bronze_have_amount+=e._bronze_have_amount||0}.bind(this))},hasPrize:function(){return this.hasBronze()||this.hasSilver()||this.hasGold()||this.hasRainbow()},hasRainbow:function(){return this._rainbow_have_amount>0},hasGold:function(){return this._gold_have_amount>0},hasSilver:function(){return this._silver_have_amount>0},hasBronze:function(){return this._bronze_have_amount>0},getAllAmount:function(){return this._rainbow_have_amount+this._gold_have_amount+this._silver_have_amount+this._bronze_have_amount||0},getRainbowHaveAmountString:function(){return this._createHaveAmountString(this._rainbow_have_amount)},getGoldHaveAmountString:function(){return this._createHaveAmountString(this._gold_have_amount)},getSilverHaveAmountString:function(){return this._createHaveAmountString(this._silver_have_amount)},getBronzeHaveAmountString:function(){return this._createHaveAmountString(this._bronze_have_amount)},_createHaveAmountString:function(e){return e>999?"999+":0===e?"0":e},dispose:function(){this._promise=null}}),t.prizehunt.model.HuntPrizeProgressFactory={createFromList:function(e){var n={rainbow:0,gold:0,silver:0,bronze:0};return e.forEach(function(e){n[e.treasure_color_type]++}),new t.prizehunt.model.HuntPrizeProgress(n)}}}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e._,t.createNameSpaceIfNotExists("prizehunt.model"),t.prizehunt.model.PrizeHuntResult=n.Class.extend({className:"PrizeHuntResult",_eventId:null,_eventFinished:null,_experiencePoint:null,_laps:null,_rankPoint:null,_totalStageCount:null,_prizeProgress:null,_prizeData:null,ctor:function(e){this._eventId=e.event_id,this._eventFinished=!0===e.is_event_finished;var n=e.prize_hunt_result;this._experiencePoint=String(n.experience_point),this._laps=n.laps,this._rankPoints=String(n.rank_point),this._totalStageCount=String(n.total_stage_count),this._prizeData=n.prize.data,this._prizeProgress=t.prizehunt.model.HuntPrizeProgressFactory.createFromList(this._prizeData)},getEventId:function(){return this._eventId},isEventFinished:function(){return this._eventFinished},getExperiencePoint:function(){return this._experiencePoint},getLaps:function(){return this._laps},getRankPoints:function(){return this._rankPoints},getTotalStageCount:function(){return this._totalStageCount},getPrizeProgress:function(){return this._prizeProgress},getPlainPrizeData:function(){return[].concat(this._prizeData)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e._,t.createNameSpaceIfNotExists("prizehunt.model"),t.prizehunt.model.HuntNextState=n.Class.extend({className:"HuntNextState",_currentEventResult:null,_nextEvent:null,_highestLap:null,ctor:function(e){this._currentEventResult=t.prizehunt.model.event.factory(e.result),this._nextEvent=t.prizehunt.model.event.factory(e.next_event||e.result),this._gotPrize=new t.prizehunt.model.HuntPrizeProgress(e.prize),this._bookProgress=e.prize.progress||null,this._highestLap=e.highest_lap||null},getCurrentEvent:function(){return this._currentEventResult},getNextEvent:function(){return this._nextEvent},getPrizeProgress:function(){return this._gotPrize},getBookProgress:function(){return this._bookProgress},isHighestLapUpdated:function(){return null!==this._highestLap},getHighestLap:function(){return this._highestLap}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e._,t.createNameSpaceIfNotExists("prizehunt.model"),t.prizehunt.model.AroundResult=n.Class.extend({className:"AroundResult",_progress:null,_gotPrize:null,_bookProgress:null,ctor:function(e){return this._result=e.result,this._isEventFinished=e.is_event_finished,e.result?(this._progress=e.progress,this._gotPrize=new t.prizehunt.model.HuntPrizeProgress(e.prize),this._nextEvent=t.prizehunt.model.event.factory(e.progress.current_event),void(this._bookProgress=e.prize.progress||null)):(this._reason=e.reason,this._aQuests=e.a_quest,this._questPoints=e.quest_points,this)},isSuccess:function(){return this._result},isEventFinished:function(){return this._isEventFinished},getPlainNextProgress:function(){return this._progress},getBonusPrize:function(){return this._gotPrize},getNextEvent:function(){return this._nextEvent},getBookProgress:function(){return this._bookProgress},isApShortage:function(){return"does_not_have_enough_ap"===this._reason},getAQuest:function(){return this._aQuests||{}},getQuestPoint:function(){return this._questPoints||{}}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e._,t.createNameSpaceIfNotExists("prizehunt.model"),t.prizehunt.model.AroundConfirm=n.Class.extend({className:"AroundConfirm",_isEventFinished:null,_requireAp:null,_bonusAmount:null,ctor:function(e){this._isEventFinished=!0===e.is_event_finished,this._requireAp=String(e.require_ap),this._bonusAmount=String(e.bonus_amount)},isEventFinished:function(){return this._isEventFinished},getRequireAp:function(){return this._requireAp},getBonusAmount:function(){return this._bonusAmount}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("prizehunt.model"),t.prizehunt.model.ResumableLaps=n.Class.extend({className:"ResumableLaps",_promise:null,_resumableLaps:[],get:function(e){return this._promise=t.createInstance("apiAPrizeHunt").getResumableLaps(e).then(function(e){return this._resumableLaps=e.body,this}.bind(this)),this._promise},getResumableLaps:function(){return this._resumableLaps}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e._,t.createNameSpaceIfNotExists("prizehunt.model.event"),t.prizehunt.model.event.Blank=n.Class.extend({ctor:function(e){this._information=e.information,this._backgroundImagePath=e.background_image_path},getBackgroundImagePath:function(){return this._backgroundImagePath},getInformation:function(){return this._information}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e._,t.createNameSpaceIfNotExists("prizehunt.model.event"),t.prizehunt.model.event.Finish=n.Class.extend({className:"Finish",ctor:function(e){this._is_event_finished=!0===e.is_event_finished,this._backgroundImagePath=e.background_image_path},isEventFinished:function(){return this._is_event_finished},getBackgroundImagePath:function(){return this._backgroundImagePath}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e._,t.createNameSpaceIfNotExists("prizehunt.model.event"),t.prizehunt.model.event.Battle=n.Class.extend({className:"Battle",ctor:function(e){this._aBattleId=e.a_battle_id,this._typicalEnemyAnimationId=e.typical_enemy_animation_id,this._rank=e.rank,this._wave=e.wave,this._kind=e.kind,this._isBoss=e.is_boss||"boss_battle"===this._kind,this._battleResult=e.battle_result,this._backgroundImagePath=e.background_image_path},getABattleId:function(){return this._aBattleId},getTypicalEnemyAnimationId:function(){return this._typicalEnemyAnimationId},getRank:function(){return this._rank},getBattleStage:function(){return String(this._wave)},getBackgroundImagePath:function(){return this._backgroundImagePath},isBoss:function(){return this._isBoss},isBattleFinished:function(){return"in_battle"!==this._battleResult},isLose:function(){return"fail"===this._battleResult},isSuccess:function(){return this.isBattleFinished()&&!this.isLose()}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e._,t.createNameSpaceIfNotExists("prizehunt.model.event"),t.prizehunt.model.event.Treasure=n.Class.extend({className:"Treasure",ctor:function(e){this._information=e.information,this._backgroundImagePath=e.background_image_path},getInformation:function(){return this._information},getBackgroundImagePath:function(){return this._backgroundImagePath}})}((this||0).self||global),function(e){var t=e.kh;e.cc,e._,t.createNameSpaceIfNotExists("prizehunt.model.event");var n=t.prizehunt.model.event;t.prizehunt.model.event.factory=function(e){switch(e.kind){case"blank":return new n.Blank(e);case"treasure":return new n.Treasure(e);case"boss_battle":case"normal_battle":return new n.Battle(e);case"finish":return new n.Finish(e);default:throw"TODO Implement kind:"+e.kind}}}((this||0).self||global),function(e){var t=(e._,e.kh||{}),n=e.cc;t.createNameSpaceIfNotExists("prizehunt.model"),t.prizehunt.model.AEventDetail=n.Class.extend({_promise:null,_eventId:null,_eventName:null,_eventDate:null,_isFirstAccess:null,_introductionEpisodeId:null,_descriptionImages:null,prepare:function(){var e=n.director.getRunningScene()._delegate._getEventId();return this._promise=t.createInstance("apiAEvents").getDetail("prizehunt_event",e).then(function(e){var t=e.body;return this._eventId=t.event_id,this._eventName=t.event_name,this._eventDate=t.event_date,this._isFirstAccess=t.first_access,this._introductionEpisodeId=t.introduction_episode_id,this._descriptionImages=t.description_images,this._isFinished=t.is_finished,this}.bind(this)),this._promise},getPromise:function(){return this._promise?this._promise:this.prepare()},getEventId:function(){return this._eventId},getEventName:function(){return this._eventName},getEventDate:function(){return this._eventDate},isFirstAccess:function(){return this._isFirstAccess},firstAccess:function(){return this._isFirstAccess=!0,t.createInstance("apiAEvents").updateFirstAccessDatetime(t.quest.QUEST_TYPE.PRIZE_HUNT,this.getEventId())},getEpisodeId:function(){return this._introductionEpisodeId},getDescriptionImages:function(){return this._descriptionImages},isFinished:function(){return this._isFinished},dispose:function(){this._promise=null}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e._,t.createNameSpaceIfNotExists("prizehunt.view"),t.prizehunt.view.HuntPartyUI=n.Class.extend({ctor:function(e){if(this._rootWidget=e.bfsWidgetByName("party_base"),t.env.isSp){var n=this._rootWidget.bfsWidgetByName("btn_scroll_left"),i=this._rootWidget.bfsWidgetByName("btn_scroll_right");t.pc.roles.UIUtility._setEnableButton(n,!1),t.pc.roles.UIUtility._setEnableButton(i,!0);var a=this._rootWidget.seekWidgetByName("prizehunt_quest_partylist_page_ui");a.setAppearance("main"),n.addTouchEventListener(this._touchScrollButton,{pageUiNode:a,animationName:"sub_to_main",otherButton:i}),i.addTouchEventListener(this._touchScrollButton,{pageUiNode:a,animationName:"main_to_sub",otherButton:n})}},_touchScrollButton:function(e,n){n===ccui.Widget.TOUCH_ENDED&&(t.pc.roles.UIUtility._setEnableButton(e,!1),this.pageUiNode.animate(this.animationName,!1).then(function(){t.pc.roles.UIUtility._setEnableButton(this.otherButton,!0)}.bind(this)))},show:function(e){this._rootWidget.seekWidgetByName("scroll_panel").getChildren().filter(function(e){return 0===String(e.getName()).indexOf("prizehunt_quest_partylist_ui_")}).forEach(function(t,n){var i=e.getHuntMember(n);this._setPartylistUi(t,i)}.bind(this))},_setPartylistUi:function(e,t){if(!t.isEmpty()){this._setProperCoreCard(e,t.getCoreCardData(),"corecard_job_chara_ui","plain"),e.setAppearance(t.isDead()?"dead":"default"),e.getChildByName("hp_no").setString(t.getHp());var n=t.getHpGauge(),i=e.getChildByName("prizehunt_quest_gauge_ui");return i.seekWidgets(function(e){0===String(e.getName()).indexOf("hp_gauge_")&&(e.percent=n)}),t.isDead()?void i.setAppearance("default"):100===n?void i.setAppearance("blue"):n<=99&&n>=50?void i.setAppearance("green"):n<=49&&n>=25?void i.setAppearance("yellow"):void i.setAppearance("red")}e.setAppearance("blank")}}),t.assignRoles(t.prizehunt.view.HuntPartyUI,[t.pc.roles.CoreCardCommon])}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e._,t.createNameSpaceIfNotExists("prizehunt.view"),t.prizehunt.view.QuestMessage=n.Class.extend({ctor:function(e){this._labelWidget=e.bfsWidgetByName("message_label"),this._windowWidget=e.bfsWidgetByName("message_window")},show:function(e){return e.getInformation&&e.getInformation()?(this._labelWidget.setString(e.getInformation().replace(/\\n/g,"\n")),void this.setVisible(!0)):this.setVisible(!1)},setVisible:function(e){this._windowWidget.setVisible(e),this._labelWidget.setVisible(e)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e._,t.createNameSpaceIfNotExists("prizehunt.view"),t.prizehunt.view.EnemyBase=n.Class.extend({_avatar:null,PC_NORMALIZED_POS:{x:.28,y:-.15},SP_NORMALIZED_POS:{x:.28,y:-.2},ctor:function(e){this._rootWidget=e.bfsWidgetByName("enemy_base"),this._rootWidget.setZOrder(-1)},show:function(e){return e instanceof t.prizehunt.model.event.Battle&&!e.isSuccess()?null===this._avatar?void this.load(e).then(this.setVisible.bind(this,!0)):void this.setVisible(!0):this.setVisible(!1)},load:function(e){var n="rank_"+e.getRank();return this._rootWidget.getChildByName("prizehunt_quest_battle_rank_ui").setAppearance(n),this._rootWidget.getChildByName("battle_stage_num").setString(e.getBattleStage()),this._avatar&&this._avatar.cleanup(),this._avatar=new t.EnemyAvatar,this._avatar.init(e.getTypicalEnemyAnimationId()).then(function(){this._avatar.appendTo(this._rootWidget),this._avatar.setPosNormalized(t.env.isSp?this.SP_NORMALIZED_POS:this.PC_NORMALIZED_POS),this._avatar.setZOrder(-1)}.bind(this))},setVisible:function(e){this._rootWidget.setVisible(e)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e.console;e.khutil,t.EnemyAvatar=t.ArmatureVisualEffect.extend(t.SceneObject,{className:"KHEnemyAvatar",ANIMATION_NAMES:{IDLE:"avatar_normal",ATTACK:"avatar_attack",RAGING:"avatar_raging",DAMAGE:"avatar_damage",STANDBY:"avatar_standby",BURST:"avatar_burst",PINCH:"avatar_pinch",WIN:"avatar_win",ABILITY:"avatar_attack",ATTACK_DOUBLE:"avatar_attack_double",ATTACK_TRIPLE:"avatar_attack_triple",ATTACK_BY_COUNT:["avatar_attack","avatar_attack_double","avatar_attack_triple"]},init:function(e){return this._id=e,this._cleanUpTouchEvent=function(){},this._initProgress=this._initProgress||this._initAvatar(e).thenResolve(this).fail(function(e){return i.error(e.stack||e),Q.reject()})},cleanup:function(){this._cleanUpTouchEvent(),t.ArmatureVisualEffect.prototype.cleanUp.call(this),this._baseNode=null,this._initProgress=null},playIdleByAnimation:function(){return this._animation.play(this.ANIMATION_NAMES.IDLE),!0},appendTo:function(e){this._initProgress||i.warn("Before Call Init()"),this._initProgress.then(function(){e.addChild(this._armature),this._baseNode=e}.bind(this))},setZOrder:function(e){this._armature.setZOrder(e)},removeFromParent:function(){this._armature.removeFromParent()},disableTouchEvent:function(){this._cleanUpTouchEvent()},_initOnTouchCallback:function(){var e=this._onTouchCallback.bind(this),t={event:n.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!1,onTouchBegan:function(){return!0},onTouchEnded:e},i=n.eventManager.addListener(t,this._armature);return function(){n.eventManager.removeListener(i)}},_onTouchCallback:function(e){},_initAvatar:function(e){var n=t.generateEnemyAnimationPaths(e);return null==n||null==n.ExportJson?Q.reject("KHEnemyAvatar._initAvatar: resource not found"):t.loader.load([n.ExportJson]).then(function(){t.ArmatureVisualEffect.prototype.init.call(this,n.ExportJson),this._setupCustomCenterPosModifier(),this._animation.play("avatar_normal")}.bind(this)).fail(function(e){i.log(e)})},setPosNormalized:function(e){var t=n.p(e.x,e.y);t.x*=n.winSize.width,t.y*=n.winSize.height,this._centerPosModifier&&(t.x+=this._armature.width*(.5-this._centerPosModifier.x)),this._armature.setPosition(t)},_resetTouchEvent:function(){this._cleanUpTouchEvent(),this._cleanUpTouchEvent=this._initOnTouchCallback()},_setupCustomCenterPosModifier:function(){var e=this._armature.getBoneDic().position_config;if(e){var t=e.getDisplayManager().getDecorativeDisplayList()[0];return null==t?void i.warn("KHAvatar._setupCustomCenterPosModifier: position config bone found, but no texture is set"):void(this._centerPosModifier=t.getDisplay().getAnchorPoint())}},_getCenterPos:function(){var e,t,i=this._armature;return null==i?n.p(-1e3,-1e3):(this._centerPosModifier?(e=i.x+i.width*(this._centerPosModifier.x-i.anchorX),t=i.y+i.height*(this._centerPosModifier.y-i.anchorY)):(e=i.x,t=i.y+i.height*(.5-i.anchorY)),n.p(e,t))},_onDispose:function(){this._initProgress.then(this.cleanup.bind(this))}})}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.prizehunt=t.pc.prizehunt||{},t.pc.prizehunt.prizehunt_quest=t.pc.prizehunt.prizehunt_quest||{},t.pc.prizehunt.prizehunt_quest.Scene=t.BaseScene.extend({resourceFileName:"prizehunt_quest/prizehunt_quest.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"prizehunt",sceneName:"prizehunt_quest",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_return","btnCallbackBtnReturn",null,function(){alert("{{prizehunt_exit_check}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_go","btnCallbackBtnGo",null,function(){alert("{{}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_interruption","btnCallbackBtnInterruption",null,function(){alert("{{prizehunt_stop_check}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.prizehunt=t.pc.prizehunt||{},t.pc.prizehunt.prizehunt_top=t.pc.prizehunt.prizehunt_top||{},t.pc.prizehunt.prizehunt_top.Scene=t.BaseScene.extend({resourceFileName:"prizehunt_top/prizehunt_top.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"prizehunt",sceneName:"prizehunt_top",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_start","btnCallbackBtnStart",null,function(){alert("{{prizehunt_quest_check}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_present","btnCallbackBtnPresent",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"present/prs_001_2_3")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_explain","btnCallbackBtnExplain",null,function(){alert("{{}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.prizehunt=t.pc.prizehunt||{},t.pc.prizehunt.prizehunt_top_notice=t.pc.prizehunt.prizehunt_top_notice||{},t.pc.prizehunt.prizehunt_top_notice.Scene=t.BaseScene.extend({resourceFileName:"prizehunt_top_notice/prizehunt_top_notice.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"prizehunt",sceneName:"prizehunt_top_notice",_delegate:null,_init:function(){this._initScene("page_in")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e.ccui,a=e._,o=e.Q;t.pc=t.pc||{},t.pc.prizehunt=t.pc.prizehunt||{},t.pc.prizehunt.prizehunt_quest=t.pc.prizehunt.prizehunt_quest||{},t.pc.prizehunt.prizehunt_quest.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../prizehunt_popup_ui.json"],_popups:{a_q_003_eventend:{factoryName:"popupFactoryTextOnly",resource:"text_button_only.json",title:"",content:"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){this.dismiss(),t.createInstance("router").navigate("mypage")}}}},_huntPartyUIView:null,_questMessageView:null,onSceneInit:function(e){var n=t.createInstance("huntingProgressModel"),i=t.createInstance("huntPrizeProgressModel");return e.bfsWidgetByName("item_base").setStrings({book_progress_num:t.createInstance("prizeNoteBookModel").getProgress(),medic_have_label:n.getHaveMedicAmount(),bottle_have_label:n.getHaveBottleAmount(),rainbow_have_label:i.getRainbowHaveAmountString(),gold_have_label:i.getGoldHaveAmountString(),silver_have_label:i.getSilverHaveAmountString(),bronze_have_label:i.getBronzeHaveAmountString()}),e.bfsWidgetByName("prizehunt-quest-bg").setZOrder(-100),n.addEventListener("UPDATE_PROGRESS",this._updateProgressBase.bind(this,e)),this._updateProgressBase(e,n),this._questAnimationController=new t.prizehunt.controller.QuestAnimation(e),this._addUpdateEventTreasure(e,this._questAnimationController,i),this._questMessageView=new t.prizehunt.view.QuestMessage(e),this._huntPartyUIView=new t.prizehunt.view.HuntPartyUI(e),this._enemyBaseView=new t.prizehunt.view.EnemyBase(e),this._enemyBaseView.show(n.getInitEvent()),t.createInstance("soundPlayer").init(t.createInstance("playerGameConfig")),e.bfsWidgetByName("filter_black").addTouchEventListener(this.btnCallbackFilterBlack,this),t.createInstance("prizeNoteBookModel").addEventListener("UPDATE_PROGRESS",function(t){e.bfsWidgetByName("item_base").bfsWidgetByName("book_progress_num").setString(t.getProgress())}),e.setVisible(!1),this._imagePreloadPromises.push(this._questAnimationController.preload()),o.all(this._imagePreloadPromises).then(function(){var i=t.createInstance("huntingProgressModel").getInitEvent();this._updateEventBackgroundImage(e,i),this._huntPartyUIView.show(n),this._imagePreloadPromises=null}.bind(this))},onSceneEnter:function(e){this._imagePreloadPromises=[];var n=e.temporaryRouterParams;return this._questId=n.quest_id,this._eventId=n.event_id,this._stateManager=new t.prizehunt.controller.PrizeHuntQuestStateManager(t.createInstance("huntingProgressModel")),o.fcall(function(){if(n.a_quest_id&&!0===n.giveUp)return t.createInstance("apiAQuests").getCurrentState(n.a_quest_id,t.quest.QUEST_TYPE.PRIZE_HUNT).then(function(e){this._eventId=e.body.next_info.event_id,this._questId=e.body.next_info.quest_id}.bind(this))}.bind(this)).then(function(){return t.createInstance("popupFactoryComNeedApBp2").setEventId(this._eventId),t.createInstance("popupFactoryComNeedApBp2").setQuestId(this._questId),this._preloadImg(t.Img("prizehunt-quest-bg","event",this._eventId).jpg),o.all([t.createInstance("prizeNoteBookModel").get(this._eventId),t.createInstance("huntingProgressModel").get(this._questId,!0).then(this._preloadPartyImg.bind(this)),t.createInstance("huntPrizeProgressModel").get(this._questId)])}.bind(this))},_preloadPartyImg:function(e){for(var n=0;n<=6;n++){if(!e.getHuntMember(n).isEmpty()){var i=e.getHuntMember(n).getCoreCardData(),o="job"===i.kind?t.CoreCardJobUI.prototype.IMG_ID_TYPE:t.CoreCardCharacterUI.prototype.IMG_ID_TYPE;this._preloadImg(t.Img("corecard",o,a.padZero(i.id,4),i.skin||0).jpg)}}return e},_preloadImg:function(e){var t=o.defer();n.loader.loadImg(e,function(e,n){e?(t.reject(e.toString()),console.error(e)):t.resolve()}),this._imagePreloadPromises.push(t.promise)},onSceneExit:function(e){return this._imagePreloadPromises=null,t.createInstance("aQuestInfo").dispose(),["prizeNoteBookModel","huntingProgressModel","huntPrizeProgressModel"].filter(function(e){return t.dictx.has(e)}).forEach(function(e){t.dictx.entry(e).object(null)}),o.resolve()},doPageInAnimation:function(e){return this._questAnimationController.setFilterEnabled(!0),!0===e.temporaryRouterParams.giveUp?o.delay(200).then(function(){e.setVisible(!0),this._doReturn(e)}.bind(this)):o.delay(200).then(function(){e.setVisible(!0);var n=t.createInstance("huntingProgressModel"),i=n.getInitEvent();return i instanceof t.prizehunt.model.event.Battle&&n.isBattleFinished()?void this.btnCallbackBtnGo(e):this._questAnimationController.playStart(i).then(this._updateJourneryEventView.bind(this,i)).then(this._questAnimationController.setFilterEnabled.bind(this._questAnimationController,!1))}.bind(this))},_navigateTop:function(e){t.createInstance("router").navigate("prizehunt/prizehunt_top",{},{event_id:e})},_updateProgressBase:function(e,t){e.bfsWidgetByName("progress_base").setStrings({now_progress_num:t.getProgress(),max_progress_num:t.getMaxProgress(),lap_num:t.getLapString()})},_playLose:function(e,t){return this._questAnimationController.setFilterEnabled(!0),o.all([this._stateManager.returnQuest(),this._questAnimationController.playBattleLose()]).spread(function(t){return this._showResult(e,t)}.bind(this)).then(function(e){this._navigateTop(e.getEventId())}.bind(this))},_doReturn:function(e,t){return this._questAnimationController.setFilterEnabled(!0),o.all([this._stateManager.returnQuest(),this._questAnimationController.playQuestEnd()]).spread(function(t){return this._showResult(e,t)}.bind(this)).then(function(e){this._navigateTop(e.getEventId())}.bind(this))},btnCallbackBtnReturn:function(e){return this._return(e),o.reject(this._override)},_return:function(e,n){return t.ImplantedPopup.create(e,"prizehunt_exit_check").open().then(this._doReturn.bind(this,e)).fail(function(){return"function"==typeof n?n():o.reject()})},_showResult:function(e,n){return t.ImplantedPopup.create(e,"prizehunt_result").open(n).then(function(){return t.ImplantedPopup.create(e,"prizehunt_result_item_check").open(n)}).then(function(){return n.isEventFinished()?(e.popups.a_q_003_eventend.open(),o.reject()):n}).fail(this._logErrors)},_openHighestLapUpdatedPopup:function(e,n){return n.isHighestLapUpdated()?t.ImplantedPopup.createOrGet(e,t.prizehunt.view.PRIZEHUNT_HIGHEST_LAP_UPDATED_POPUP_NAME,"PrizeHuntHighestLapUpdatedPopup").open(n):o.resolve()},_openPrizeHuntNextCheck:function(e,n,i){if(n instanceof t.prizehunt.model.event.Finish&&n.isEventFinished())return this._returnByEventEnd(e);var a=t.ImplantedPopup.create(e,"prizehunt_next_check");return o.all([this._stateManager.confirmAround(),this._openHighestLapUpdatedPopup(e,i)]).spread(a.open.bind(a,t.createInstance("huntingProgressModel"))).then(function(t){return t===a.RETURN?this._return(e,this._openPrizeHuntNextCheck.bind(this,e,n,i)).then(o.reject):(this._questAnimationController.setFilterEnabled(!0),this._stateManager.goAround())}.bind(this)).then(this._showAroundResult.bind(this,e)).fail(this._logErrors)},_showAroundResult:function(e,n){if(!n.isSuccess())return n.isApShortage()?this._apShortPopup(e,n):this._returnByEventEnd(e);t.createInstance("huntingProgressModel").dispatchUpdateEvent(),e.bfsWidgetByName("progress_base").setStrings({now_progress_num:"0"}),t.createInstance("huntPrizeProgressModel").union(n.getBonusPrize());var i=n.getNextEvent(),a=t.createInstance("prizeNoteBookModel"),o=this._questAnimationController;return o.playAround(n).then(a.updateFromAround.bind(a,n)).then(this._updateJourneryEventView.bind(this,i)).then(this._updateEventBackgroundImage.bind(this,e,i)).then(o.playStart.bind(this._questAnimationController,i))},_returnByEventEnd:function(e){return this._stateManager.returnQuest().then(function(){return e.popups.a_q_003_eventend.open(),o.reject()})},_apShortPopup:function(e,n){return o.all([t.createInstance("apiAItems").getApGain()]).spread(function(i){var a=o.defer(),r=t.createInstance("router").getCurrentComponent();return this._needApBpPopupFactory=t.createInstance("popupFactoryComNeedApBp"),this._needApBpPopupFactory.create({property:"AP",questTitle:n.getAQuest().title,questPoints:n.getQuestPoint(),items:i.body,component:r,onUse:function(){this._stateManager.goAround().then(this._showAroundResult.bind(this,e)).then(a.resolve.bind(a))}.bind(this),onCancel:a.reject.bind(a),needBattleBp:0}).open(),a.promise}.bind(this)).fail(function(e){return e?void console.error(e):o.reject()})},btnCallbackBtnGo:function(e){return this._questAnimationController.setFilterEnabled(!0),this._stateManager.goNextState().then(function(n){this._questMessageView.setVisible(!1);var i=n.getCurrentEvent();return i instanceof t.prizehunt.model.event.Battle?i.isLose()?this._playLose(e,i).then(function(){return o.reject()}):i.isBattleFinished()?n:this._questAnimationController.playBattle(i).then(function(){return t.createInstance("router").navigate("battle",{a_battle_id:i.getABattleId(),quest_type:t.quest.QUEST_TYPE.PRIZE_HUNT,a_quest_id:t.createInstance("huntingProgressModel").getAQuestId()}),o.reject()}):i instanceof t.prizehunt.model.event.Finish?this._openPrizeHuntNextCheck(e,i,n).then(o.reject):n}.bind(this)).then(function(e){var n=e.getPrizeProgress();if(n.hasPrize()){var i=t.createInstance("prizeNoteBookModel");return t.createInstance("huntPrizeProgressModel").union(n),this._questAnimationController.playGetPrize(n).then(i.updateFromNextState.bind(i,e)).thenResolve(e)}return this._questAnimationController.playNext().thenResolve(e)}.bind(this)).then(function(n){this._questMessageView.setVisible(!1);var i=n.getNextEvent();return this._enemyBaseView.show(i),t.createInstance("huntingProgressModel").dispatchUpdateEvent(),i instanceof t.prizehunt.model.event.Finish?this._questAnimationController.playBeforeAround().then(this._openPrizeHuntNextCheck.bind(this,e,i,n)).then(o.reject):(this._updateEventBackgroundImage(e,i),this._questAnimationController.playStart(i).then(this._updateJourneryEventView.bind(this,i)))}.bind(this)).fail(this._logErrors).fin(this._questAnimationController.setFilterEnabled.bind(this._questAnimationController,!1)),o.reject(this._override)},_updateJourneryEventView:function(e){return t.createInstance("huntingProgressModel").dispatchUpdateEvent(),e?(this._questMessageView.show(e),void this._enemyBaseView.show(e)):(this._questMessageView.setVisible(!1),void this._enemyBaseView.setVisible(!1))},_updateEventBackgroundImage:function(e,n){var i=n.getBackgroundImagePath();a.isUndefined(i)||e.bfsWidgetByName("prizehunt-quest-bg").loadTexture(t.Img(i).jpg)},_addUpdateEventTreasure:function(e,t,n){var i=e.bfsWidgetByName("item_base");t.addEventListener("UPDATE_BRONZE",function(){i.setStrings({bronze_have_label:n.getBronzeHaveAmountString()})},this),t.addEventListener("UPDATE_SILVER",function(){i.setStrings({silver_have_label:n.getSilverHaveAmountString()})},this),t.addEventListener("UPDATE_GOLD",function(){i.setStrings({gold_have_label:n.getGoldHaveAmountString()})},this),t.addEventListener("UPDATE_RAINBOW",function(){i.setStrings({rainbow_have_label:n.getRainbowHaveAmountString()})},this)},_logErrors:function(e){return e&&e.stack?void console.log(e):o.reject()},btnCallbackBtnInterruption:function(e){return t.ImplantedPopup.create(e,"prizehunt_stop_check").open().then(function(){t.createInstance("router").navigate("mypage")}),o.reject(this._override)},btnCallbackFilterBlack:function(e,t){t===i.Widget.TOUCH_BEGAN&&this._questAnimationController.skipAnimate()}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e.ccui,a=e._,o=e.Q;t.pc=t.pc||{},t.pc.prizehunt=t.pc.prizehunt||{},t.pc.prizehunt.prizehunt_top=t.pc.prizehunt.prizehunt_top||{},t.pc.prizehunt.prizehunt_top.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../prizehunt_popup_ui.json"],_popups:{comBackCheck:{factoryName:"popupFactoryComBackCheck"},comRaidCheck:{factoryName:"popupFactoryComRaidCheck"},popupEventEnd:{factoryName:"popupFactoryTextOnly",title:"",content:"<br />",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){t.createInstance("router").navigate("mypage/my_001")}}}},onSceneInit:function(e){this._setBackgroundImage(e),this._initPager(e),this._setBackBtn(e);var n=t.createInstance("prizeNoteBookModel");return this._setRemainAmount(e,n.getRemainPrizeAmount(),n.getMaxPrizeAmount()),this._prizehuntEventDetail.isFinished()?(e.popups.popupEventEnd.open(),o.resolve()):this._subTutorialPromise?this._subTutorialPromise.then(this._firstAccessInit.bind(this,e)):o.resolve()},_firstAccessInit:function(e,n){return n.body.visited?this._prizehuntEventDetail.firstAccess():e.temporaryRouterParams.playedEpisode?o.all([t.createInstance("apiASubTutorialPages").visited(t.quest.QUEST_TYPE.PRIZE_HUNT),this._prizehuntEventDetail.firstAccess()]).then(function(){this.btnCallbackBtnExplain(e)}.bind(this)):(t.createInstance("router").navigate("scenario/episode-play",{"scenario/play":{episode_id:this._prizehuntEventDetail.getEpisodeId(),returnBackParams:{scene:"prizehunt/prizehunt_top",routerParams:{prizehunt_top:{event_id:this._getEventId()}},temporaryRouterParams:{playedEpisode:!0}}}}),o.defer().promise)},_initPager:function(e){var n=e.seekWidgetByName("list_panel"),i=n.seekWidgetByName("prizehunt_treasurelist_page_ui"),a=t.createInstance("prizeNoteBookModel").getDataList(),o=new t.core.pager.view.page.BasePageUiFactory(i,this._initPrizePanel.bind(this)),r=new t.core.pager.controller.PagerController(n,a,[o],i),s=n.getParent().seekWidgetByName("viewpage_s_ui");new t.core.pager.view.button.ViewPageUi(s,r).initialize(),r.initialize()},_initPrizePanel:function(e,t){var n=t.getRawData();this._setText(e,n),this._setCorecardImage(e,n)},_setText:function(e,t){var i=e.seekWidgetByName("max_label"),a=t.amount_of_set;i.setString(a),i.setVisible(!0);var o=e.seekWidgetByName("remain_label"),r=t.amount_of_set-t.number;return o.setString(r.toString()),o.setVisible(!0),0===r?void o.setColor(n.color(255,128,128)):r/a<=.25?void o.setColor(n.color("#FFDD33")):void o.setColor(n.color.WHITE)},_setCorecardImage:function(e,t){var a=t.game_item,o=this._setProperCoreCardElementRarity(e,a,"corecard_ui");o.setGetNumber(""),t.set_amount>1&&(o.setGetNumber(""+t.set_amount),o.setIconRarity()),o.addTouchEventListener(function(e,t){if(t===i.Widget.TOUCH_ENDED){var o=n.director.getRunningScene();this._setCorecardTouchEvent(o,a)}},this)},_setCorecardTouchEvent:function(e,n){switch(n.kind){case"weapon":t.ImplantedPopup.createOrGet(e,"sh_weapon_info","ShWeaponInfoPopup").open(n);break;case"summon":t.ImplantedPopup.createOrGet(e,"sh_summon_info","ShSummonInfoPopup").open(n);break;case"accessory":t.ImplantedPopup.createOrGet(e,"acce_data","AcceDataPopup").open(n);break;case"item":t.ImplantedPopup.createOrGet(e,"sh_item_info","ShItemInfoPopup").open(n);break;case"package":t.ImplantedPopup.createOrGet(e,"sh_package_item_info").open(n);break;case"character":t.createInstance("router").navigate("status/status_001",{status_001:{id:n.character_id,returnRoute:t.createInstance("router").getCurrentFragment(),returnParams:{prizehunt_top:{event_id:this._eventId}}}})}},_setRemainAmount:function(e,n,i){var a=e.seekWidgetByName("remain_num");if(t.env.isSp)return a.setString(" "+n+"/"+i+""),void a.setVisible(!0);a.setString(n.toString()+""),a.setVisible(!0);var o=e.seekWidgetByName("max_num");o.setString(i.toString()+""),o.setVisible(!0)},_setBackgroundImage:function(e){var n=t.Img("prizehunt-top-bg","event",a.padZero(this._eventId,4)).jpg;e.seekWidgetByName("prizehunt-top-bg").loadTexture(n)},onSceneEnter:function(e){var i=e.routerParams.prizehunt_top||e.routerParams;this._eventId=e.temporaryRouterParams.event_id||i.event_id,n.textureCache.addImage(t.Img("prizehunt-top-bg","event",this._eventId).jpg),this.questCommonDelegate=t.createInstance("questSceneCommonDelegate"),this.questCommonDelegate.owner=e,t.createInstance("popupFactoryComNeedApBp2").setEventId(this._eventId);var a=this;return o.all([t.createInstance("apiAQuests").getListEventQuest(this._eventId,"event").then(function(e){a._aQuests=e.body.data}),t.createInstance("apiAPlayers").getMeNumeric().then(function(e){this._player=e.body}.bind(this)),t.createInstance("aQuestInfo").get().then(function(e){this._questInfo=e.getRawData()}.bind(this)),this.updateQuestPoints(),t.createInstance("prizeNoteBookModel").get(this._getEventId(),!0),(new t.prizehunt.model.AEventDetail).prepare().then(function(e){if(this._prizehuntEventDetail=e,!e.isFinished()&&e.isFirstAccess())return this._subTutorialPromise=t.createInstance("apiASubTutorialPages").get(t.quest.QUEST_TYPE.PRIZE_HUNT),this._subTutorialPromise}.bind(this))]).fail(function(e){return e&&e.stack&&console.error(e),o.defer().promise})},onSceneExit:function(e){return o.resolve()},_touchEndedBackBtnProcess:function(e){t.createInstance("router").navigate("mypage/my_001")},btnCallbackBtnStart:function(e){var n=t.createInstance("aQuestInfo");return t.ImplantedPopup.createOrGet(e,"prizehunt_quest_check").open(this._aQuests).then(function(e){return o.all([o.resolve(e),n.get(),t.createInstance("ResumableLaps").get(e.quest_id)])}).spread(function(t,n,i){this.questCommonDelegate.restartCheckInProgressQuest(t,n.getRawData())||(this._selectQuest=t,this._openSelectStartingLapPopup(e,i,t))}.bind(this)).fail(function(e){e&&console.error(e)}),o.reject(this._override)},_openSelectStartingLapPopup:function(e,n,i){t.ImplantedPopup.createOrGet(e,t.prizehunt.view.PRIZEHUNT_SELECT_STARTING_LAP_POPUP_NAME,"PrizeHuntSelectStartingLapPopup").open(n).then(function(t){this._startingLap=t.getSelectedLap(),this.startCheckQuestState(e,i)}.bind(this))},startQuest:function(e,n,i){t.createInstance("router").navigate("quest/q_002",{q_002:{target:"quest",quest_id:n.quest_id,owner_account_id:n.owner_account_id,quest_type:t.quest.QUEST_TYPE.PRIZE_HUNT,episode_num:i,recommended_element_type:n.recommended_element_type||6,event_id:this._getEventId(),starting_lap:this._startingLap}})},btnCallbackBtnPresent:function(e){return t.createInstance("router").navigate("present/prs_001",{},{prs_001_002_003:{returnRoute:"prizehunt/prizehunt_top",eventId:this._getEventId()}}),o.reject(this._override)},btnCallbackBtnExplain:function(e){var n=t.ImplantedPopup.createOrGet(e,"sub_tutorial","ImplantedSubTutorialPopup");return this._prizehuntEventDetail.getPromise().then(function(e){n.open("prizehunt",e.getDescriptionImages().length)}),o.reject(this._override)},_getEventId:function(){return this._eventId}}),t.assignRoles(t.pc.prizehunt.prizehunt_top.SceneDelegate,[t.pc.quest.roles.QuestStart,t.pc.quest.roles.QuestSelectCommon.methods,t.pc.quest.roles.QuestSelectCommon.popups,t.pc.roles.CoreCardCommon])}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._),i=e.Q;t.pc=t.pc||{},t.pc.prizehunt=t.pc.prizehunt||{},t.pc.prizehunt.prizehunt_top_notice=t.pc.prizehunt.prizehunt_top_notice||{},t.pc.prizehunt.prizehunt_top_notice.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../prizehunt_popup_ui.json"],_popups:{},onSceneInit:function(e){var a=e.routerParams.prizehunt_top_notice||e.routerParams,o=e.temporaryRouterParams.event_id||a.event_id;this._setBackBtn(e);var r=t.Img("prizehunt-top-notice-bg","event",n.padZero(o,4)).jpg;return e.seekWidgetByName("prizehunt-top-notice-bg").loadTexture(r),i.resolve()},_touchEndedBackBtnProcess:function(e){t.createInstance("router").navigate("mypage")}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.router=n.router||{},n.router.routes=n.router.routes||{},t.merge(n.router.routes,{prizehunt:{prizehunt:"prizehunt_top","prizehunt/prizehunt_quest":"prizehunt_quest","prizehunt/prizehunt_top":"prizehunt_top","prizehunt/prizehunt_top_notice":"prizehunt_top_notice"}})}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="AFriendCheck",o={isFriend:function(e){return this._http.get({url:"/a_friend_check",json:{a_player_id:e}})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiAFriendCheck",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},o)),n.env.useApiMock){n.MockApi=n.MockApi||{};var r={};t.each(o,function(e,t){r[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi."+a+"."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},r))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e._,n=e.kh;e.cc,e.ccui,n.PopupFactoryComEditComment=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-prf_edit_com",title:"",buttonLabels:{blueBtn:"OK",blackBtn:""},buttons:{blueBtn:function(e){},blackBtn:function(){this.dismiss()}}},POPUP_METHODS:{},onPopupOpened:function(e,t){this._popup=e,this._scene=t.scene,n.setTouchEventHandlers(e,{"TOUCH_ENDED blue_btn":this._clickOkButton},this);var i=this._scene._playerInfo.description;this._createEditbox(e,i)},_createEditbox:function(e,i){return t.isUndefined(this._commentEditBox)?(this._commentEditBox=n.EditBox.createEditBox(e.contentNode,"comment_base","editbox_0",30,i,{fontSize:22}),void this._commentEditBox.setOnEditBoxReturnCallback(this._clickOkButton,this)):(this._commentEditBox.setText(i),void this._commentEditBox.setFontSize(22))},_clickOkButton:function(){return 0===this._commentEditBox.getText().length?void this._scene._showPopupNoText():this._commentEditBox.getText()===this._scene._playerInfo.description?void this._popup.dismiss():void n.createInstance("apiAPlayers").updateDescription(this._commentEditBox.getText(),this._scene._playerInfo.description_text_id).then(function(e){this._scene._playerInfo=e.body,this._scene._updateCommentTextBox(e.body.description),this._popup.dismiss()}.bind(this)).fail(function(e){console.error(e)})}})}((this||0).self||global),function(e){var t=e._,n=e.kh,i=e.cc;e.ccui,n.PopupFactoryComGreeting=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-com_edit_greed",title:"",buttonLabels:{blueBtn:"",blackBtn:""},buttons:{blueBtn:function(e){},blackBtn:function(){this.dismiss()}}},POPUP_METHODS:{},TEXT_RESTRICTION_LABEL:" XX ",onPopupOpened:function(e,i){this._popup=e,this._inputMaxLength=i.inputMaxLength||60,this._target="chat",t.isUndefined(i.friend)||(this._friend=i.friend,this._target="greet");var a=this._popup.seekWidgetByName("btn_node"),o=a.actionManager.getActionByTag(a.tag,a);t.isNull(o)||(this._action=o),n.setTouchEventHandlers(e,{"TOUCH_ENDED tab_chat":function(){this._changeView(0)},"TOUCH_ENDED tab_stamp":function(){this._changeView(1)},"TOUCH_ENDED blue_btn":function(){this._clickSendButton()}},this),e.seekWidgetByName("tab_chat").setSound(n.SoundList.BUTTON_TOUCHED_SWITCH),e.seekWidgetByName("tab_stamp").setSound(n.SoundList.BUTTON_TOUCHED_SWITCH),this._loadStamps(),this._changeView(0,e),this._createEditbox(e)},_createEditbox:function(e){t.isUndefined(this._chatEditBox)||this._chatEditBox.getParent().removeAllChildrenWithCleanup();var i=e.seekWidgetByName("text_restriction_label");if(i){var a=this.TEXT_RESTRICTION_LABEL.replace("XX",this._inputMaxLength);i.setString(a)}this._chatEditBox=n.EditBox.createEditBox(e,"comment_base","",this._inputMaxLength,"",{fontSize:22}),this._chatEditBox.setOnEditBoxReturnCallback(this._clickSendButton,this)},_loadStamps:function(){n.createInstance("StampList").init(this._popup.seekWidgetByName("com_edit_stamp_page_ui"),this._popup,function(e){"chat"===this._target?this._sendStamp(e):this._sendStamp(this._friend.a_player_id,e)}.bind(this)).loadStamps()},_changeView:function(e){var n=[!1,!1];n[e]=!0,this._popup.seekWidgetByName("com_edit_greed_a_ui").setVisible(n[0]),this._popup.seekWidgetByName("com_edit_greed_b_ui").setVisible(n[1]),t.each(["tab_chat","tab_stamp"],function(t,n){var i=this._popup.seekWidgetByName(t);i.setBright(e!==n),i.setEnabled(e!==n)},this),this._changeButtonPos(e)},_changeButtonPos:function(e){this._action.gotoFrameAndPause(0==e?1:2),this._popup.seekWidgetByName("black_btn").setTitleText(0==e?"":"")},_enableButton:function(e,t){var n=this._popup.seekWidgetByName(e);n.setEnabled(t),n.setColor(1==t?i.color("#FFFFFF"):i.color("#808080"))},_invoke:function(e,n){var a=i.director.getRunningScene(),o=[];a._delegate&&(a._delegate.greetingDelegate&&o.push(a._delegate.greetingDelegate),o.push(a._delegate)),o.push(a);var r=t.find(o,function(n){return t.isFunction(n[e])});if(r)return r[e].apply(r,n)},_clickSendButton:function(){0===this._chatEditBox.getText().length?this._invoke("_showPopupNoText"):"chat"===this._target?this._invoke("_sendMessage",[this._popup,void 0,this._chatEditBox.getText()]):this._invoke("_sendMessage",[this._popup,this._friend.a_player_id,this._chatEditBox.getText()])},_sendStamp:function(e,t){this._invoke("_sendStamp",[this._popup,e,t])},_sendStamp4Chat:function(e){this._invoke("_sendStamp",[this._popup,e])}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);t.BurstTime=t.EventSubject.extend({EVENT_PREFIX:"burst_time",EVENT_NAME:{UPDATE_SUCCESS:"update_success"},_burstTimeInfo:null,_preReservedBurstTimes:null,ctor:function(){this._super(),this._resetPreReservedBurstTimes()},_resetPreReservedBurstTimes:function(){this._preReservedBurstTimes=n.map(n.range(2),function(e){return new t.BurstTimeUnit})},prepare:function(e){return t.createInstance("apiAUnions").getBurstTimeInfo(e).then(function(e){this._burstTimeInfo=e.body.burst_time_info}.bind(this))},isEnabled:function(){return!!this._burstTimeInfo&&!0===this._burstTimeInfo.enabled},isInBurstTime:function(){if(!this._burstTimeInfo)return!1;if(!0!==this._burstTimeInfo.in_burst_time)return!1;var e=this.getEndDate();return null!==e&&e.getTime()-(new Date).getTime()>0},getFirstSelectedBurstTimeInfo:function(){return this.getSelectedBurstTimeInfo(0)},getSecondSelectedBurstTimeInfo:function(){return this.getSelectedBurstTimeInfo(1)},getSelectedBurstTimeInfo:function(e){return this._burstTimeInfo&&this._burstTimeInfo.selected_burst_times&&this._burstTimeInfo.selected_burst_times[e]?this._burstTimeInfo.selected_burst_times[e]:null},getFirstReservedBurstTimeInfo:function(){return this.getReservedBurstTimeInfo(0)},getSecondReservedBurstTimeInfo:function(){return this.getReservedBurstTimeInfo(1)},getReservedBurstTimeInfo:function(e){return this._burstTimeInfo&&this._burstTimeInfo.reserved_burst_times&&this._burstTimeInfo.reserved_burst_times[e]?this._burstTimeInfo.reserved_burst_times[e]:null},getEndDate:function(){return this._burstTimeInfo&&this._burstTimeInfo.end_date?new Date(this._burstTimeInfo.end_date):null},_getRemainingTime:function(){var e=this.getEndDate();if(null===e)return"";var t=e.getTime()-(new Date).getTime(),n=0,i=0;return t>0&&(n=Math.floor(t/1e3/60),i=Math.floor(t/1e3%60)),{minute:n,second:i}},getRemainingTime:function(){var e=this._getRemainingTime();return n.padZero(e.minute,2)+""+n.padZero(e.second,2)+""},getRemainingTimeSimple:function(){var e=this._getRemainingTime();return n.padZero(e.minute,2)+":"+n.padZero(e.second,2)},isReserved:function(){return!!this._burstTimeInfo&&(!(!this._burstTimeInfo.reserved_burst_times||0===this._burstTimeInfo.reserved_burst_times.length)&&n(this._burstTimeInfo.reserved_burst_times).filter(function(e){var t=e.type;return void 0!==t&&null!==t}).size()>0)},isReservable:function(){return!!this._burstTimeInfo&&!0===this._burstTimeInfo.reservable},update:function(){var e=Q.defer();if(null===this._preReservedBurstTimes||0===this._preReservedBurstTimes.length)return e.reject();var i=n.map(this._preReservedBurstTimes,function(e){return{type:e.getBurstTimeInfo().type}});return t.createInstance("apiAUnions").changeBurstTimeInfo(i).then(function(t){return t.body.error?(console.log(t.body.error),e.reject(t.body.error),void(e=null)):(this._burstTimeInfo=t.body.burst_time_info,this.dispatchEvent("UPDATE_SUCCESS"),e.resolve(t),void(e=null))}.bind(this)).fail(function(e){console.error(e.stack)}),e.promise},changePreReservedBurstTime:function(e,t){this._preReservedBurstTimes[e]||console.error("kh.BurstTime.changePreReservedBurstTime() ");var i=n.filter(this.getSelectableBurstTimes(),function(e){return e.type===t});return 0===i.length?void console.error("kh.BurstTime.changePreReservedBurstTime() "):void this._preReservedBurstTimes[e].setBurstTimeInfo(i[0])},getSelectableBurstTimes:function(){return this._burstTimeInfo?this._burstTimeInfo.selectable_burst_times:[]}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e._,t.BurstTimeUnit=n.Class.extend({_burstTimeInfo:{},ctor:function(){this.setBurstTimeInfo({type:null,description:""})},getBurstTimeInfo:function(){return this._burstTimeInfo},setBurstTimeInfo:function(e){this._burstTimeInfo=e}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e._,t.BurstTimeSubTutorialPanel=n.Node.extend({_popups:{},_widgets:{},_khBurstTime:null,_subTutorialPopup:null,show:function(e){var i=n.director.getRunningScene();i.addChild(this),this._widgets.base=i.seekWidgetByName("bursttime_period_base_1"),this._widgets.label1=i.seekWidgetByName("bursttime_period_0_label"),this._widgets.label2=i.seekWidgetByName("bursttime_period_1_label"),this._widgets.reserved=i.seekWidgetByName("bursttime_period_textimg"),this._widgets.button=i.seekWidgetByName("btn_burstinfo"),this._widgets.button.addClickEventListener(this._openSubTutorialPopup.bind(this)),this._khBurstTime=t.createInstance("burstTime"),this._khBurstTime.prepare(e).then(function(){this._khBurstTime.addEventListener("UPDATE_SUCCESS",this.updateDisplay.bind(this)),this._initWidgets()}.bind(this))},_initWidgets:function(){this._khBurstTime.isEnabled()&&(this._widgets.base.setVisible(!0),this._widgets.label1.setString("1"+this._khBurstTime.getFirstSelectedBurstTimeInfo().description),this._widgets.label2.setString("2"+this._khBurstTime.getSecondSelectedBurstTimeInfo().description),this._khBurstTime.isReserved()&&this._widgets.reserved.setVisible(!0))},updateDisplay:function(){this._widgets.reserved.setVisible(!1),this._widgets.base.setVisible(!1),this._widgets.label1.setString(""),this._widgets.label2.setString(""),this._initWidgets()},onExit:function(){this._khBurstTime.removeEventListenersByEventName("UPDATE_SUCCESS"),this._super()},_openSubTutorialPopup:function(){if(null===this._subTutorialPopup){var e=n.director.getRunningScene();this._subTutorialPopup=t.ImplantedPopup.createOrGet(e,"sub_tutorial","ImplantedSubTutorialPopup")}this._subTutorialPopup.open("bursttime",1)},showSubTutorialFirstAccess:function(){var e="bursttime",n=t.createInstance("apiASubTutorialPages");return n.get(e).then(function(t){t.body.need_first_display&&(this._openSubTutorialPopup(),n.visited(e))}.bind(this)).fail(function(e){console.error(e)})}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._),i=e.Q;t.pc.guild=t.pc.guild||{},t.pc.guild.roles=t.pc.guild.roles||{},t.pc.guild.roles.GuildCommon={_setGuildStrings:function(e,i){var a=i.union_me||i.union,o=n.isUndefined(a)?i.guardian_info:a.guardian_info||i.guardian_info;if(!n.isUndefined(o)){var r=this._toGuardianFullName(o);if(!n.isUndefined(o.level)){null!==e.seekWidgetByName("guardian_lv_label")&&e.setStrings({guardian_lv_label:o.level}),n.isUndefined(o.name)||null===e.seekWidgetByName("guardian_name_lv_label")||e.setStrings({guardian_name_lv_label:r});var s=e.seekWidgetByName("name_label");n.isUndefined(o.name)||null===s||"gud_comment_ui"===s.parent.name||e.setStrings({name_label:r})}n.isUndefined(o.price)||null===e.seekWidgetByName("price_no")||e.setStrings({price_no:" "+o.price+t.w("gem")});var c,u=o.detail_info;if(!n.isUndefined(u)&&(n.isUndefined(u.custom_pt)||(null!==e.seekWidgetByName("total_pt_label")&&e.setStrings({total_pt_label:" "+u.custom_pt}),null!==e.seekWidgetByName("total_custom_point_no_label")&&e.setStrings({total_custom_point_no_label:" "+u.custom_pt}),null!==e.seekWidgetByName("custom_pt_label_set")&&e.setStrings({custom_pt_label_set:"Pt: "+u.custom_pt})),n.isUndefined(u.next_level_pt)||(null!==e.seekWidgetByName("lv_next_label")&&e.setStrings({lv_next_label:" "+u.next_level_pt+"Pt"}),null!==e.seekWidgetByName("lv_next_label_set")&&e.setStrings({lv_next_label_set:"Lv: "+u.next_level_pt+"Pt"})),!n.isUndefined(u.effects)))n.each(u.effects,function(e,t){e.is_acquired&&!n.isUndefined(e.description)&&(c=e.description)}),null===e.seekWidgetByName("guardian_effect_label_0")||n.isUndefined(c)||e.seekWidgetByName("guardian_effect_label_0").setString(c),null===e.seekWidgetByName("guardian_effect_label")||n.isUndefined(c)||e.seekWidgetByName("guardian_effect_label").setString(c)}n.isUndefined(a)||(n.isUndefined(a.name)||null===e.seekWidgetByName("union_name_label")||e.setStrings({union_name_label:a.name}),n.isUndefined(a.rank)||null===e.seekWidgetByName("union_rank_no")||e.setStrings({union_rank_no:a.rank}),n.isUndefined(a.member_count)||null===e.seekWidgetByName("union_menber_label")||e.setStrings({union_menber_label:a.member_count}),n.isUndefined(a.leader)||n.isUndefined(a.leader.name)||n.isUndefined(a.comment)||(null!==e.seekWidgetByName("gud_comment_ui")&&e.seekWidgetByName("gud_comment_ui").setStrings({name_label:a.leader.name,leader_comment_label:a.comment}),null!==e.seekWidgetByName("prf_comment_ui")&&e.seekWidgetByName("prf_comment_ui").setStrings({name_label:a.leader.name,leader_comment_label:a.comment})));var l=i.donation;n.isUndefined(l)||n.isUndefined(l.union_data)||n.isUndefined(l.union_data.current_donation_amount)||null===e.seekWidgetByName("union_jem_label")||e.setStrings({union_jem_label:l.union_data.current_donation_amount.toString()})},_setDonationHeader:function(e,i){return i=i||"header_sub_label",t.createInstance("apiAUnions").getDonationInfo().then(function(a){var o=e.seekWidgetByPath(i);return o&&!n.isUndefined(a.body.union_data.current_donation_amount)&&o.setString(a.body.union_data.current_donation_amount+t.w("gem")),a.body}.bind(this)).fail(function(e){console.error(e.stack)})},_getUnionInfoAboutMe:function(){var e=t.createInstance("apiAUnions").getMember("me"),n=t.createInstance("apiAUnions").get("me");return i.all([e,n]).then(function(e){return this._myUnionInfo=e[0].body,this._maxNumber=e[1].body.max_member_count,this._totalNumber=e[1].body.member_count,this._unionId=e[1].body.a_union_id,e}.bind(this)).fail(function(e){console.error(e.stack)})},_getUnionInfoAboutOther:function(e){return t.createInstance("apiAUnions").get(e).then(function(e){return this._myUnionInfo=e.body,this._maxNumber=e.body.max_member_count,this._totalNumber=e.body.member_count,this._unionId=e.body.a_union_id,e}.bind(this)).fail(function(e){console.error(e.stack)})},_setUnionHeaderMemberNum:function(e,t){if(t=t||"header_sub_label",n.isUndefined(this._myUnionInfo))console.warn("[ERROR] You should call _getUnionInfoAboutMe() as an union base info.");else{var i=e.seekWidgetByPath(t);!i||n.isUndefined(this._totalNumber)||n.isUndefined(this._maxNumber)||i.setString(""+this._totalNumber+"/"+this._maxNumber)}},_setFriendHeaderNum:function(e,i){return i=i||"header_sub_label",t.createInstance("myselfInfoRepository").getMe().then(function(t){var a=e.seekWidgetByPath(i);return!a||n.isUndefined(t.body.friend_num)||n.isUndefined(t.body.friend_max_num)||a.setString(""+t.body.friend_num+"/"+t.body.friend_max_num),t.body}.bind(this)).fail(function(e){console.error(e)})},_setSelectedGuardianHeader:function(e,t){t=t||"header_sub_label";var i=this._myUnionInfo||this._getUnionData();if(n.isUndefined(i))console.warn("[ERROR] You should call _getUnionInfoAboutMe() or _request('union_me') as an union base info.");else{var a=i.guardian_info,o=e.seekWidgetByPath(t);null===o||n.isUndefined(a)||o.setString(a.name+" Lv"+a.level)}},_setPositionIconsVisibility:function(e,i){var a=t.w("unionRoles");n.each(a,function(t,n){var a=e.seekWidgetByName("icon_guild_position_"+n);null!==a&&a.setVisible("all"===i||i.indexOf(n)>=0||i.indexOf(t)>=0)})},_toGuardianFullName:function(e){if(!e)return console.warn("Guardian data is required."),"";var t=e.guardian_info||e;if(n.isUndefined(t.name))return console.warn("Invalid guardian record.",t),"";var i=t.name;return(t.prefix_name||"")+""+i+""+(n.isUndefined(t.level)?"":"Lv"+t.level)}}}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;e.Q,t.pc.profile=t.pc.profile||{},t.pc.profile.roles=t.pc.profile.roles||{},t.pc.profile.roles.ProfileCommon={_isDisplayForBtnScout:!1,_supportSummonList:null,_setProfileStrings:function(e,t){if(i.isUndefined(t.a_player_id)||null===e.seekWidgetByName("id_label")||e.setStrings({id_label:"ID:"+t.a_player_id}),i.isUndefined(t.name)||null===e.seekWidgetByName("usename")||e.setStrings({usename:t.name}),i.isUndefined(t.name)||null===e.seekWidgetByName("userstatus_label")||e.setStrings({userstatus_label:t.name}),i.isUndefined(t.total_hp)||null===e.seekWidgetByName("total_hp_no")||e.setStrings({total_hp_no:t.total_hp}),i.isUndefined(t.total_attack)||null===e.seekWidgetByName("total_attack_no")||e.setStrings({total_attack_no:t.total_attack}),i.isUndefined(t.description)||null===e.seekWidgetByName("usercomment_label")||e.setStrings({usercomment_label:t.description}),i.isUndefined(t.rank)||null===e.seekWidgetByName("rank_no")||e.setStrings({rank_no:t.rank}),i.isUndefined(t.next_exp)||null===e.seekWidgetByName("rank_next_label")||e.setStrings({rank_next_label:t.next_exp}),!i.isUndefined(t.job_info)){var n=t.job_info;i.isUndefined(n.name)||null===e.seekWidgetByName("name_label")||e.setStrings({name_label:n.name}),i.isUndefined(n.level)||null===e.seekWidgetByName("level_label")||e.setStrings({level_label:n.level}),i.isUndefined(n.next_exp)||null===e.seekWidgetByName("lv_next_label")||e.setStrings({lv_next_label:n.next_exp}),i.isUndefined(n.total_acquired_jobs)||null===e.seekWidgetByName("have_job_no")||e.setStrings({have_job_no:n.total_acquired_jobs})}i.isUndefined(t.job_point)||null===e.seekWidgetByName("have_job_p_no")||e.setStrings({have_job_p_no:t.job_point.toString()}),i.isUndefined(t.purgatory_job_point)||null===e.seekWidgetByName("have_rengoku_job_p_no")||e.setStrings({have_rengoku_job_p_no:t.purgatory_job_point.toString()}),i.isUndefined(t.friend_num)||i.isUndefined(t.friend_max_num)||null===e.seekWidgetByName("have_friend_no")||e.setStrings({have_friend_no:t.friend_num+"/"+t.friend_max_num}),i.isUndefined(t.character_num)||null===e.seekWidgetByName("have_chara_no")||e.setStrings({have_chara_no:t.character_num}),i.isUndefined(t.weapon_num)||i.isUndefined(t.max_weapon_num)||null===e.seekWidgetByName("have_weapon_no")||e.setStrings({have_weapon_no:t.weapon_num+"/"+t.max_weapon_num}),i.isUndefined(t.summon_num)||i.isUndefined(t.max_summon_num)||null===e.seekWidgetByName("have_summon_no")||e.setStrings({have_summon_no:t.summon_num+"/"+t.max_summon_num}),i.isUndefined(t.gem)||null===e.seekWidgetByName("have_jem_no")||e.setStrings({have_jem_no:t.gem.toString()}),i.isUndefined(t.pseudo_currency)||null===e.seekWidgetByName("have_coin_no")||e.setStrings({have_coin_no:t.pseudo_currency.toString()}),i.isUndefined(t.stone)||null===e.seekWidgetByName("stone_label")||e.setStrings({stone_label:t.stone.toString()})},_setPlayerInfo:function(e,n){return"me"===n?t.createInstance("myselfInfoRepository").getMyCurrency().then(function(t){return e.initSceneUILoadPromise.thenResolve(t)}.bind(this)).then(function(t){this._setProfileStrings(e,t.getPlainBody())}.bind(this)).catch(function(e){console.error(e)}):t.createInstance("apiAPlayers").getPlayerCurrency(n).then(function(t){return e.initSceneUILoadPromise.thenResolve(t)}.bind(this)).then(function(t){this._setProfileStrings(e,t.body)}.bind(this)).catch(function(e){console.error(e)}),this._getPlayerInfo(n).then(function(t){return this._playerInfo=t.body,e.initSceneUILoadPromise.thenResolve(t)}.bind(this)).then(function(n){if(!e.disposed){if(this._setProfileStrings(e,n.body),i.isUndefined(n.body.job_info.job_id)||null===e.seekWidgetByName("iconcircle_job")||e.seekWidgetByName("iconcircle_job").setTexture(t.Img("iconcircle","job",i.padZero(n.body.job_info.job_id,4),0).png),i.isUndefined(n.body.rank)||null===e.seekWidgetByName("rank_gauge")||(e.seekWidgetByName("rank_gauge").percent=0===n.body.next_exp?100:n.body.exp/(n.body.exp+n.body.next_exp)*100),!i.isUndefined(n.body.job_info)&&null!==e.seekWidgetByName("job_level_gauge")){var a=0===n.body.job_info.next_exp?100:n.body.job_info.exp/(n.body.job_info.exp+n.body.job_info.next_exp)*100;e.seekWidgetByName("job_level_gauge").percent=a}return i.isUndefined(n.body.job_info)||i.isUndefined(n.body.job_info.job_id)||!e.seekWidgetByName("prfimg_job")||e.seekWidgetByName("prfimg_job").loadTexture(t.Img("prfimg","job",i.padZero(n.body.job_info.job_id,4),n.body.job_info.skin||0).jpg),n.body}}.bind(this)).fail(function(e){console.error(e)})},_getPlayerInfo:function(e){return"me"===e?t.createInstance("myselfInfoRepository").getMe():t.createInstance("apiAPlayers").get(e)},_setPlayerPartyInfo:function(e,n){return t.createInstance("apiAPlayers").getSelectedPartyInfo(n).then(function(t){return this._playerPartyInfo=t.body,e.initSceneUILoadPromise.thenResolve(t)}.bind(this)).then(function(n){if(!e.disposed){var a=n.body.selected_party_info;if(!a)return void console.warn("[ERROR] Could not access selected_party_info.");if(this._setProfileStrings(e,a),i.isUndefined(a.main_member)||this._setProfileCharacters(e,a.main_member),i.isUndefined(a.sub_member)||this._setProfileCharacters(e,a.sub_member,"sub_chara_ui"),!i.isUndefined(a.weapon)&&(this._setWeaponCoreCardElementRarity(e,a.weapon,"corecard_weapon_ui_70.2"),i.isFunction(this._onTouchWeapon))){var o=e.seekWidgetByName("weapon_img");o.setSoundEnabled(!0),o.setSound(t.SoundList.BUTTON_TOUCHED_DECIDE),t.setTouchEventHandlers(e,{"TOUCH_ENDED weapon_img":function(){this._onTouchWeapon(e,a.weapon)}.bind(this)})}if(!i.isUndefined(a.summon)&&(this._setSummonCoreCardElementRarity(e,a.summon,"corecard_summon_ui_70.2"),i.isFunction(this._onTouchSummon))){var r=e.seekWidgetByName("summon_img");r.setSoundEnabled(!0),r.setSound(t.SoundList.BUTTON_TOUCHED_DECIDE),t.setTouchEventHandlers(e,{"TOUCH_ENDED summon_img":function(){this._onTouchSummon(e,a.summon)}.bind(this)})}return n.body}}.bind(this)).fail(function(e){e&&e.stack&&console.error(e)})},_setProfileCharacters:function(e,a,o){o=o||"main_chara_ui",i.each(a,function(a,r){var s=e.seekWidgetByName(o+"_"+r);if(s&&!i.isUndefined(a.character_id)&&(this._setCharacterCoreCardElementRarity(s,a,"corecard_chara_ui_70"),s.seekWidgetByName("plus_no").setVisible(!0),s.seekWidgetByName("level_base").setVisible(!0),s.setStrings({plus_no:0<a.bonus?"+"+a.bonus:"",level_label_no:"Lv"+a.level}),i.isFunction(this._onTouchCharacter))){var c=s.seekWidgetByName("chara_img");c.setSoundEnabled(!0),c.setSound(t.SoundList.BUTTON_TOUCHED_DECIDE);var u=n.director.getRunningScene();t.setTouchEventHandlers(s,{"TOUCH_ENDED chara_img":function(){this._onTouchCharacter(u,a)}.bind(this)})}},this)},_setChatInfo:function(e,n){return t.createInstance("apiAGreets").getList(n,1,1).then(function(t){return this._chatList=t.body,e.initSceneUILoadPromise.thenResolve(t)}.bind(this)).then(function(t){if(!e.disposed){var a=e.contentLayer.bfsWidgetByName("tab_0_node");if(i.isUndefined(t.body.max_record_count)||0!==t.body.max_record_count){if(!i.isUndefined(t.body.data)){var o=a.seekWidgetByName("list_node"),r=o.seekWidgetByName("balloonlist_ui");o.setVisible(!0),this._setChatPanel(e,r,t.body.data[0]),o.seekWidgetByName("btn_delete").setVisible(!1);var s=o.seekWidgetByName("btn_more");if(s){var c="me"!==n||t.body.max_record_count>1;s.setVisible(c)}}}else a.seekWidgetByName("nothing_node").setVisible(!0);return t.body}}.bind(this)).fail(function(e){console.error(e)})},_setPlayerUnionInfo:function(e,n){var a=e.seekWidgetByName("tab_2_node");if(!i.isUndefined(n)&&!i.isNull(n))return t.createInstance("apiAUnions").get(n).then(function(t){return this._unionInfo=t.body,e.initSceneUILoadPromise.thenResolve(t)}.bind(this)).then(function(t){if(!e.disposed){var n=a.seekWidgetByName("list_node");return n&&n.setVisible(!0),i.isUndefined(this._unionInfo.guardian_info)||this._setIntroduceGuardianImage(this._unionInfo.guardian_info),this._setGuildStrings(a,{union:this._unionInfo}),t.body}}.bind(this)).fail(function(e){console.error(e)});var o=a.seekWidgetByName("nothing_node");o&&o.setVisible(!0)},_setBtnScoutDisplayResult:function(e){this._isDisplayForBtnScout=e},_btnScoutDisplay:function(e){if(this._isDisplayForBtnScout){var t=this._scoutId?"member_scout_cancellation":"member_scout";return e.animate("btn_friend_scout",!1).then(function(){e.contentLayer.bfsWidgetByName("tab_2_node").bfsWidgetByName("prf_btn_scout").changeFrameWithAnimInfo(t,"start",!1)})}return e.animate("default_view",!1)},_setSupportSummonList:function(e,n){return t.createInstance("apiASupportSummonSetting").get(n).then(function(t){return this._supportSummonList=t.body,e.initSceneUILoadPromise.thenResolve(t)}.bind(this)).then(function(t){if(!e.disposed)return i.each(t.body,function(t,n){this._setSupportSummon(e,n,t)},this),t.body}.bind(this)).fail(function(e){console.error(e)})},_setSupportSummon:function(e,t,n){if(!i.isNull(n)){var a="corecard_summon_ui_"+(t="phantom"===t?"illusion":t),o=e.seekWidgetByName(a);o||console.warn(" element_type:"+t),this._setSummonCoreCardFull(e,n,a),o.seekWidgetByName("icon_equiping").setVisible(!1)}}},i.assign(t.pc.profile.roles.ProfileCommon,t.pc.roles.CoreCardCommon,t.pc.roles.StringsCommon,t.pc.list.roles.ChatPageListBtnsController,t.pc.guild.roles.GuildCommon,t.pc.roles.ImagesCommon)}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);e.Q,t.pc.profile=t.pc.profile||{},t.pc.profile.roles=t.pc.profile.roles||{},t.pc.profile.roles.Routing={_verifyRouterParams001:function(e){},_navigate001To002:function(e,n,i){var a=e.routerParams.prf_001.id,o="profile/prf_001"+(i?"a":"b");t.createInstance("router").navigate("profile/detail/de_003",{de_003:{id:n.a_weapon_id,isOwn:i,fromPartyPage:!1,equipedSelf:!1}},{navigateFrom:{routes:o,routerParams:{prf_001:{id:a}}}})},_navigate001To003:function(e,n,i){var a=e.routerParams.prf_001.id,o="profile/prf_001"+(i?"a":"b");t.createInstance("router").navigate("profile/detail/de_004",{de_004:{id:n.a_summon_id,isOwn:i,fromPartyPage:!1,equipedSelf:!1,equipedMainSelf:!1}},{ignoreImplicitRoute:!0,navigateFrom:{routes:o,routerParams:{prf_001:{id:a}}}})},_navigate001To004:function(e,n,i){var a=e.routerParams.prf_001.id,o="profile/prf_001"+(i?"a":"b");t.createInstance("router").navigate("profile/detail/de_001",{de_001_002:{id:n.a_character_id,isOwn:i,fromPartyPage:!1,equipedSelf:!1}},{navigateFrom:{routes:o,routerParams:{prf_001:{id:a}}}})},_navigateToProfileTop:function(e){if(e.routerParams.prf_001&&e.routerParams.prf_001.id){var n=e.routerParams.prf_001.id;this._navigateTo001ByAPlayerId(n)}else t.createInstance("router").back()},_navigateTo001ByAPlayerId:function(e){var n="profile/prf_001"+("me"===e?"a":"b");t.createInstance("router").navigate(n,{prf_001:{id:e}})},_navigateProf005ToProf001:function(e,n,i){var a=n.from_player_info.a_player_id,o="profile/prf_001"+("me"===a?"a":"b");t.createInstance("router").navigate(o,{prf_001:{id:a}},{return_to_profile:{routes:"profile/prf_005"+("me"===i?"a":"b"),params:{prf_005:{id:i}}}})},_navigatePrf001ToPrf001:function(e,n,i){var a=n.from_player_info.a_player_id,o="profile/prf_001"+("me"===a?"a":"b");t.createInstance("router").navigate(o,{prf_001:{id:a}},{return_to_profile:{routes:"profile/prf_001"+("me"===i?"a":"b"),params:{prf_001:{id:i}}}})},_navigateTo001Others:function(e,t){this._navigateTo001ByAPlayerId(t.from_player_info.a_player_id)},_navigate001To005Others:function(e){return n.isUndefined(e.routerParams.prf_001)?void this._consoleErrorRoutingAbort("routerParams.prf_001"):n.isUndefined(e.routerParams.prf_001.id)?void this._consoleErrorRoutingAbort("routerParams.prf_001.id"):void t.createInstance("router").navigate("profile/prf_005b",{prf_005:{id:e.routerParams.prf_001.id}})},_navigate001To005MySelf:function(e){t.createInstance("router").navigate("profile/prf_005a")},_navigateToSupportSummonConfig:function(e){t.createInstance("router").navigate("profile/prf_support_summon_config",{support_summon:{element_type:e}})},_navigateToReturnToBack:function(e){if(n.isUndefined(e))t.createInstance("router").navigate("mypage/my_001");else{var i={};n.isUndefined(e.temporaryRouterParams)||(i=e.temporaryRouterParams),t.createInstance("router").navigate(e.routes,e.params,i)}},_navigate001ToUnion:function(e,n){t.createInstance("router").navigate(n,{},e)},_verifyRouterParams005:function(e){n.isUndefined(e.routerParams.prf_005)&&(e.routerParams.prf_005={},e.routerParams.prf_005.id=1,this._consoleErrorRouterParams("routerParams.prf_005, .id"))},_navigateTo001Status:function(){t.createInstance("router").navigate("profile/prf_001a",{prf_001:{id:"me",type:"own"},tab:"status"})},_navigateTo001SetSupportSummon:function(e,n){t.createInstance("router").navigate("profile/prf_001a",{prf_001:{id:"me",type:"own",support_summon:{element_type:e,a_summon:n}},tab:"status"})},_navigateTo001ReleaseSupportSummon:function(e){t.createInstance("router").navigate("profile/prf_001a",{prf_001:{id:"me",type:"own",support_summon:{element_type:e,a_summon:null}},tab:"status"})},_navigateToDe004:function(e,n,i){t.createInstance("router").navigate("profile/detail/de_004",{de_004:{id:i,isOwn:!0,fromPartyPage:!1,equipedSelf:!1,equipedMainSelf:!1,supportSummonInfo:{elementType:e,aSummonId:n}}},{ignoreImplicitRoute:!0,navigateFrom:{routes:"profile/prf_support_summon_config",routerParams:{support_summon:{element_type:e}}}})}},n.assign(t.pc.profile.roles.Routing,t.pc.roles.RoutingCommon)}((this||0).self||global),function(e){var t=(e.cc,e.ccui),n=e.kh;e.res,e.gResources,e._,n.pc.profile=n.pc.profile||{},n.pc.profile.roles=n.pc.profile.roles||{},n.pc.profile.roles.DeleteGreeting={_popups:{popupDeleteConfirm:{factoryName:"popupFactoryBlackRed",title:"",content:"ChatStamp<br /><span class='red'></span>",buttonLabels:{blackBtn:"",redBtn:""},buttonSounds:{redBtn:n.SoundList.BUTTON_TOUCHED_CONFIRMED},buttons:{blackBtn:function(e){this.dismiss()},redBtn:function(e){this.dismiss()}}},deleteGreetingResult:{factoryName:"popupFactoryBlue",title:"",content:"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){n.createInstance("sceneManager").reloadScene(),this.dismiss()}}}},methods:{_greetDeleteConfirm:function(e,n){var i=e.popups.popupDeleteConfirm;i.open().then(function(){i.redBtn.addTouchEventListener(function(a,o){o===t.Widget.TOUCH_ENDED&&(this._greetDelete(e,n),i.dismiss())},this)}.bind(this)).fail(function(e){console.error(e.stack)})},_greetDelete:function(e,t){n.createInstance("apiAGreets").deleteGreet(t).then(function(t){!0===t.body.result&&e.popups.deleteGreetingResult.open()}.bind(this)).fail(function(e){console.error(e.stack)})}}}}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e._,t.createNameSpaceIfNotExists("profile.view"),t.profile.view.ActionButton=n.Class.extend({className:"ActionButton",_scene:null,ctor:function(e){this._scene=e},update:function(e,t){return this._scene.seekWidgetByName("btn_setting"),this._scene.seekWidgetByName("btn_release"),e?t?void this._setReleaseStatus():void this._setSettingStatus():void this._setCannotSettingStatus()},_setCannotSettingStatus:function(){var e=this._getReleaseBtn(),n=this._getSettingBtn();e.setVisible(!1),t.pc.roles.UIUtility._setEnableButton(n,!1),n.setVisible(!0)},_setReleaseStatus:function(){var e=this._getReleaseBtn(),t=this._getSettingBtn();e.setVisible(!0),t.setVisible(!1)},_setSettingStatus:function(){var e=this._getReleaseBtn(),n=this._getSettingBtn();e.setVisible(!1),t.pc.roles.UIUtility._setEnableButton(n,!0),n.setVisible(!0)},_getSettingBtn:function(){return this._scene.seekWidgetByName("btn_setting")},_getReleaseBtn:function(){return this._scene.seekWidgetByName("btn_release")},clear:function(){this.update(!1,!1)},clean:function(){this._scene=null}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;t.createNameSpaceIfNotExists("profile.view"),t.profile.view.StatusWindowInSummonList=n.Class.extend({className:"StatusWindowInSummonList",_statusWindowNode:null,_coreCardNode:null,_coreCardUI:null,_onCardInitExtension:null,_onStatusWindowInitExtension:null,UI_NODE_NAMES:{NAME_LABEL:"name_label",LEVEL_LABEL:"level_label",FILTER_IN_CORECARD:"filter",STATUS_PANEL_BASE:"status_base",HP_NODE:"hp_no",ATTACK_NODE:"attack_no",EXP_GAUGE_NODE:"exp-gauge",EXP_NEXT_LABEL:"exp_next_label",BTN_DETAIL:"btn_detail",SKILL_BASE_PREFIX:"skill_base_"},ctor:function(e,n,i,a,o){this._statusWindowNode=e.seekWidgetByName("status_window"),this._coreCardNode=this._statusWindowNode.seekWidgetByPath(n),this._coreCardUI=t.createInstance(i,["full",this._coreCardNode]),this._onCardInitExtension=a,this._onStatusWindowInitExtension=o},update:function(e,t){return i.isEmpty(e)?void this.clear():(this._setStatusPanel(e),this._setHeader(e),this._setCoreCard(e,t),this._setVisibleBtn(e),void(i.isFunction(this._onStatusWindowInitExtension)&&this._onStatusWindowInitExtension(this._statusWindowNode,e)))},_setHeader:function(e){var t=this._statusWindowNode;t.seekWidgetByName(this.UI_NODE_NAMES.NAME_LABEL).setString(e.name||""),t.seekWidgetByName(this.UI_NODE_NAMES.LEVEL_LABEL).setString(e.level?"Lv "+e.level:"")},_setCoreCard:function(e,t){var n=this._coreCardUI;i.isUndefined(n.setAroused)||n.setAroused(e.is_aroused||!1),n.setPlusNo(0<e.bonus?"+"+e.bonus:""),n.setIconElement(e.element_type),n.setIconRarity(e.rare),n.setStarGauge(20*e.max_overlimit_count,20*e.overlimit_count),this.setTotalLabel(e,t),i.isFunction(this._onCardInitExtension)&&this._onCardInitExtension(n,e);var a=this._coreCardNode,o=a.seekWidgetByName(this.UI_NODE_NAMES.FILTER_IN_CORECARD);o&&o.setVisible(!0),a.setVisible(!0)},setTotalLabel:function(e,t){var n=this._coreCardUI;n.setTotalLabel(n.getTotalLabel(e,t))},_setStatusPanel:function(e){var t=this._statusWindowNode.seekWidgetByName(this.UI_NODE_NAMES.STATUS_PANEL_BASE);t.seekWidgetByName(this.UI_NODE_NAMES.HP_NODE).setString(e.hp),t.seekWidgetByName(this.UI_NODE_NAMES.ATTACK_NODE).setString(e.attack);var n=e.level===e.max_level,i=n?100:e.exp/(e.next_exp+e.exp)*100;t.seekWidgetByName(this.UI_NODE_NAMES.EXP_GAUGE_NODE).percent=i;var a=t.seekWidgetByName(this.UI_NODE_NAMES.EXP_NEXT_LABEL);a.setString("NEXT:"+e.next_exp),a.setVisible(!n),t.setVisible(!0)},_setVisibleBtn:function(e){var n=!!e,i=this._statusWindowNode.seekWidgetByName(this.UI_NODE_NAMES.BTN_DETAIL);t.pc.roles.UIUtility._setEnableButton(i,n)},clear:function(){this._setHeader({}),this._statusWindowNode.seekWidgetByName(this.UI_NODE_NAMES.STATUS_PANEL_BASE).setVisible(!1),this._setVisibleBtn(null),this._coreCardUI&&this._coreCardUI.setVisible(!1)},clean:function(){this._statusWindowNode=null,this._coreCardNode=null,this._coreCardUI=null,this._onCardInitExtension=null,this._onStatusWindowInitExtension=null}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);e.Q,t.createNameSpaceIfNotExists("profile.controller"),t.profile.controller.SummonList=t.party.controller.PartyListAbstract.extend({className:"SummonList",ctor:function(e,n){this.setting={setHeaderLabelFunction:this._setSummonHeaderLabel,panelName:t.BtnsPageListParams.SUMMON_LIST.panelName,apiName:"apiASummons",apiMethod:"getList",sortKey:"list_summons",apiParams:[t.displayFilter.enums.FILTER_NAME.SUPPORT_SUMMON,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE],apiModel:t.core.model.ASummon,cardType:"summon",cardFrame:"full",sortArgs:{sortKey:"selectable_support_summons",sortValue:"attack_desc",sortButton:"btn_sort",sortLabel:"sort_label",sortMenuBase:"sortlist",sortChoice:"core-pages-sort_list_0_ui",changeEventName:"pulldown_sort_config"},maxSelectCount:1,canDeselect:!1},this._statusWindowView=new t.profile.view.StatusWindowInSummonList(e,"corecard_summon_ui","CoreCardSummonUI",this._setCoreCardInStatusWindow.bind(this)),this._actionButtonView=new t.profile.view.ActionButton(e),this._super.apply(this,arguments)},setPageList:function(){var e=this._super.apply(this,arguments);return this._controller.addUpdateEventListener(function(e,n,i){var a=this.summonList;this.panelNode.getChildren().forEach(function(n,i){var o=e[i];if(o){var r=n.getUserData();if(r instanceof t.CoreCardUI)r.setIconEquipped(!1),r.getResult().seekWidgetByName("icon_setting").setVisible(a._isDefaultRecord(o.getRawData()))}})},{summonList:this,panelNode:this._scene.seekWidgetByName(this.setting.panelName)}),e},_getRecordId:function(e){return e.a_summon_id},getDefaultRecordId:function(){return this._defaultRecordId},_canNotRemove:function(e){return!0},_setCoreCardInStatusWindow:function(e,t){e.setImg(t.summon_id,t.skin||0),e.setIconEquipped(!1),e.setIconProtected(t.is_locked),e.getResult().seekWidgetByName("icon_setting").setVisible(this._isDefaultRecord(t))}}),n.assign(t.profile.controller.SummonList.prototype,t.pc.profile.roles.Routing,t.pc.list.roles.ListSummonsCommon)}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.profile=t.profile||{},t.profile.view=t.profile.view||{},t.profile.view.SupportSummonSetResultPopup=t.ImplantedPopup.extend({_parentNodeName:"prf_support_summon_set_result",_initContents:function(e,t){this.setButtonEvents({btn_ok:!0}),this._showDescription(e,t)},_showDescription:function(e,t){e="phantom"===e?"illusion":e;var n=this.getNode();n.seekWidgetByName("element_"+e+"_label").setVisible(!0),n.seekWidgetByName("setting_label").setString(t.name+""),this._setSummonCoreCardFull(n,t,"summon_img")}}),t.assignRoles(t.profile.view.SupportSummonSetResultPopup,[t.pc.roles.UIUtility,t.pc.roles.CoreCardCommon])}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.profile=t.profile||{},t.profile.view=t.profile.view||{},t.profile.view.SupportSummonReleaseResultPopup=t.ImplantedPopup.extend({_parentNodeName:"prf_support_summon_unset_result",_initContents:function(e){this.setButtonEvents({btn_ok:!0}),this._showDescription(e)},_showDescription:function(e){e="phantom"===e?"illusion":e,this._getParentNode().seekWidgetByName("element_"+e+"_label").setVisible(!0)},_getParentNode:function(){return cc.director.getRunningScene().seekWidgetByName(this._parentNodeName)}}),t.assignRoles(t.profile.view.SupportSummonReleaseResultPopup,[t.pc.roles.UIUtility,t.pc.roles.CoreCardCommon])}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.profile=t.pc.profile||{},t.pc.profile.prf_001_myself=t.pc.profile.prf_001_myself||{},t.pc.profile.prf_001_myself.Scene=t.BaseScene.extend({resourceFileName:"prf_001/prf_001_myself",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[{tab1:{node:"tab_0","content-node":"tab_0_node"},tab2:{node:"tab_1","content-node":"tab_1_node"},tab3:{node:"tab_2","content-node":"tab_2_node"}}],componentName:"profile",sceneName:"prf_001_myself",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath("tab_0_node"),"btn_edit","btnCallbackTab0NodeBtnEdit",null,function(){alert("{{prf_edit_com}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("tab_0_node"),"btn_more","btnCallbackTab0NodeBtnMore",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"profile/prf_005a")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"touch_panel_flame","btnCallbackTouchPanelFlame",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"profile/prf_support_summon_config")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"touch_panel_water","btnCallbackTouchPanelWater",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"profile/prf_support_summon_config")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"touch_panel_wind","btnCallbackTouchPanelWind",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"profile/prf_support_summon_config")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"touch_panel_thunder","btnCallbackTouchPanelThunder",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"profile/prf_support_summon_config")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"touch_panel_light","btnCallbackTouchPanelLight",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"profile/prf_support_summon_config")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"touch_panel_darkness","btnCallbackTouchPanelDarkness",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"profile/prf_support_summon_config")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"touch_panel_illusion","btnCallbackTouchPanelIllusion",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"profile/prf_support_summon_config")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_all_over","btnCallbackBtnAllOver",null,function(){alert("{{all_over_ui}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("tab_2_node"),"btn_seemore","btnCallbackTab2NodeBtnSeemore",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"guild/gud_001_a")),this._initButtonEvent.call(this,this.seekWidgetByPath("tab_2_node"),"btn_union_search","btnCallbackTab2NodeBtnUnionSearch",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"guild/gud_000_a")),this._initButtonEvent.call(this,this.seekWidgetByPath("btn_burstinfo"),"btn_burstinfo","btnCallbackBtnBurstinfoBtnBurstinfo",null,function(){alert("{{sub_tutorial.json}}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc=t.pc||{},t.pc.profile=t.pc.profile||{},t.pc.profile.prf_001_myself=t.pc.profile.prf_001_myself||{},t.pc.profile.prf_001_myself.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../prf_popup_ui.json"],_popups:{popupEditComment:{factoryName:"popupFactoryComEditComment"},popupBlueCommon:{factoryName:"popupFactoryBlue",title:"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){this.dismiss()}}}},onSceneInit:function(e){this._verifyRouterParams001(e),this._setBackBtn(e);var n={profile:"tab_0",status:"tab_1",union:"tab_2"};e.routerParams.tab&&n[e.routerParams.tab]?(e.tabDelegateList[0].selectTab(e.seekWidgetByName(n[e.routerParams.tab])),delete e.routerParams.tab):e.tabDelegateList[0].selectTab(e.seekWidgetByName("tab_0")),t.createInstance("BurstTimeSubTutorialPanel").show();var o=(e.routerParams.prf_001||{}).support_summon;return i.isUndefined(o)||this._showSupportSummonPopup(e,o),a.resolve()},_showSupportSummonPopup:function(e,t){var n=t.element_type,a=t.a_summon;i.isNull(a)?this._showSupportSummonReleaseResultPopup(e,n):this._showSupportSummonSetResultPopup(e,n,a)},_showSupportSummonSetResultPopup:function(e,n,i){t.ImplantedPopup.createOrGet(e,"prf_support_summon_set_result","SupportSummonSetResultPopup").open(n,i)},_showSupportSummonReleaseResultPopup:function(e,n){t.ImplantedPopup.createOrGet(e,"prf_support_summon_unset_result","SupportSummonReleaseResultPopup").open(n)},onSceneEnter:function(e){return t.createInstance("myselfInfoRepository").getMe().then(function(t){this._setPlayerUnionInfo(e,t.getAUnionId()),this._setPlayerInfo(e,"me").then(function(e){this._playerInfo=e}.bind(this))}.bind(this)),this._setPlayerPartyInfo(e,"me"),this._setChatInfo(e,"me"),this._setSupportSummonList(e,"me"),a.resolve()},tabCallbackTab0:function(e){},tabCallbackTab1:function(e){},tabCallbackTab2:function(e){},btnCallbackTab0NodeBtnEdit:function(e){var t=a.defer();return t.reject(this._override),e.popups.popupEditComment.open({scene:this}),t.promise},btnCallbackTab0NodeBtnMore:function(e){var t=a.defer();return t.resolve(),t.promise},btnCallbackTouchPanelFlame:function(e){var t=a.defer();return t.reject(this._override),this._navigateToSupportSummonConfig("flame"),t.promise},btnCallbackTouchPanelWater:function(e){var t=a.defer();return t.reject(this._override),this._navigateToSupportSummonConfig("water"),t.promise},btnCallbackTouchPanelWind:function(e){var t=a.defer();return t.reject(this._override),this._navigateToSupportSummonConfig("wind"),t.promise},btnCallbackTouchPanelThunder:function(e){var t=a.defer();return t.reject(this._override),this._navigateToSupportSummonConfig("thunder"),t.promise},btnCallbackTouchPanelLight:function(e){var t=a.defer();return t.reject(this._override),this._navigateToSupportSummonConfig("light"),t.promise},btnCallbackTouchPanelDarkness:function(e){var t=a.defer();return t.reject(this._override),this._navigateToSupportSummonConfig("darkness"),t.promise},btnCallbackTouchPanelIllusion:function(e){var t=a.defer();return t.reject(this._override),this._navigateToSupportSummonConfig("phantom"),t.promise},btnCallbackBtnAllOver:function(e){var t=a.defer();if(t.reject(this._override),i.isUndefined(this._unionInfo)||i.isUndefined(this._unionInfo.guardian_info))console.warn("[ERROR] Could not read an union info.");else{var n=this._unionInfo.guardian_info;this._openAllOverPanel(n.guardian_id,n.skin||0,"guardian")}return t.promise},btnCallbackTab2NodeBtnSeemore:function(e){var t=a.defer();t.reject(this._override);var n=this._getNavigateFrom(e);return this._navigate001ToUnion(n,"guild/gud_001_a"),t.promise},btnCallbackTab2NodeBtnUnionSearch:function(e){var t=a.defer();return t.resolve(),t.promise},btnCallbackBtnBurstinfoBtnBurstinfo:function(e){var t=a.defer();return t.reject(this._override),t.promise},_onTouchCharacter:function(e,t){this._navigate001To004(e,t,!0)},_onTouchWeapon:function(e,t){this._navigate001To002(e,t,!0)},_onTouchSummon:function(e,t){this._navigate001To003(e,t,!0)},_onTouchChatPlayer:function(e,t){this._navigatePrf001ToPrf001(e,t,"me")},_updateCommentTextBox:function(e){n.director.getRunningScene().setStrings({usercomment_label:e})},_showPopupNoText:function(){var e=n.director.getRunningScene().popups.popupBlueCommon;e.open().then(function(){e.setTitle(""),e.setContent("<span class='red'></span>")}.bind(this)).fail(function(e){console.error(e.stack)})},_onTouchDeleteChat:function(e,t){this._greetDeleteConfirm(e,t.a_greet_id)},_touchEndedBackBtnProcess:function(e){var t=e.temporaryRouterParams.return_to_profile;this._navigateToReturnToBack(t)},_getNavigateFrom:function(e){var n=e.tabDelegateList[0].selected;e.temporaryRouterParams.restoreParams={tabs:[n]};var i=e.routerParams.prf_001,a=e.temporaryRouterParams;return a.id=this._unionInfo.a_union_id,{routes:t.createInstance("router").getCurrentFragment(),routerParams:i,temporaryRouterParams:a}}}),i.assign(t.pc.profile.prf_001_myself.SceneDelegate.prototype._popups,t.pc.profile.roles.DeleteGreeting._popups),i.assign(t.pc.profile.prf_001_myself.SceneDelegate.prototype,t.pc.roles.ImagesCommon,t.pc.profile.roles.Routing,t.pc.profile.roles.ProfileCommon,t.pc.roles.AllOverUI,t.pc.profile.roles.DeleteGreeting.methods)}((this||0).self||global),function(e){var t=e.kh,n=e._;t.pc=t.pc||{};var i=(e.Q,{com_offerdel_check:{factoryName:"popupFactoryTextOnly",content:"CSS",title:"",buttonLabels:{blackBtn:"",blueBtn:"OK"},buttons:{blackBtn:function(){this.dismiss()},blueBtn:function(){alert("{{popup/com_offerdel_result}}")}}},prf_fredel_check:{factoryName:"popupFactoryTextOnly",content:"",title:"",buttonLabels:{blackBtn:"",blueBtn:"OK"},buttons:{blackBtn:function(){this.dismiss()},blueBtn:function(){alert("{{popup/prf_fredel_result}}")}}},com_req_check:{factoryName:"popupFactoryPopupCommon",resourceName:function(){var e=n.findKey(res,function(e){return 0<e.indexOf("com_req_check")});return e||alert(": com_req_check"),e||""}(),title:"",buttonLabels:{blackBtn:""},buttons:{blackBtn:function(){this.dismiss()}}},com_req_delete:{factoryName:"popupFactoryTextOnly",content:"CSS",title:"",buttonLabels:{blueBtn:"OK",blackBtn:""},buttons:{blueBtn:function(){alert("{{popup/com_req_result}}")},blackBtn:function(){this.dismiss()}}},com_scout_cancel:{factoryName:"popupFactoryTextOnly",content:"",title:"",buttonLabels:{blueBtn:"",blackBtn:""},buttons:{blueBtn:function(){alert("{{}}")},blackBtn:function(){this.dismiss()}}}});t.pc.profile=t.pc.profile||{},t.pc.profile.prf_001_others=t.pc.profile.prf_001_others||{},t.pc.profile.prf_001_others.Scene=t.BaseScene.extend({resourceFileName:"prf_001/prf_001_others",isLoopDefaultView:!1,_popups:i,tabDelegateConfig:[{tab1:{node:"tab_0","content-node":"tab_0_node"},tab2:{node:"tab_1","content-node":"tab_1_node"},tab3:{node:"tab_2","content-node":"tab_2_node"}}],componentName:"profile",sceneName:"prf_001_others",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_friend_apply","btnCallbackBtnFriendApply",null,function(){alert("com_frioffer_endcom_friend_maxcom_friend_fullcom_text")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_friend_cancellation","btnCallbackBtnFriendCancellation",null,function(e){this.popups.com_offerdel_check.open(e)}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_friend_release","btnCallbackBtnFriendRelease",null,function(e){this.popups.prf_fredel_check.open(e)}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_friend_check","btnCallbackBtnFriendCheck",null,function(e){this.popups.com_req_check.open(e)}),this._initButtonEvent.call(this,this.seekWidgetByPath("tab_0_node"),"btn_greeting","btnCallbackTab0NodeBtnGreeting",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"profile/prf_005_others")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"touch_panel_flame","btnCallbackTouchPanelFlame",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"detail/de_004")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"touch_panel_water","btnCallbackTouchPanelWater",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"detail/de_004")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"touch_panel_wind","btnCallbackTouchPanelWind",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"detail/de_004")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"touch_panel_thunder","btnCallbackTouchPanelThunder",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"detail/de_004")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"touch_panel_light","btnCallbackTouchPanelLight",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"detail/de_004")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"touch_panel_darkness","btnCallbackTouchPanelDarkness",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"detail/de_004")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"touch_panel_illusion","btnCallbackTouchPanelIllusion",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"detail/de_004")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_all_over","btnCallbackBtnAllOver",null,function(){alert("{{all_over_ui}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("tab_2_node"),"btn_seemore","btnCallbackTab2NodeBtnSeemore",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"guild/gud_001_b")),this._initButtonEvent.call(this,this.seekWidgetByPath("tab_2_node"),"btn_member_scout","btnCallbackTab2NodeBtnMemberScout",null,function(){alert("{{}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_member_scout_cancellation","btnCallbackBtnMemberScoutCancellation",null,function(e){this.popups.com_scout_cancel.open(e)}),this._initButtonEvent.call(this,this.seekWidgetByPath("btn_burstinfo"),"btn_burstinfo","btnCallbackBtnBurstinfoBtnBurstinfo",null,function(){alert("{{sub_tutorial.json}}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._),i=e.Q;t.pc=t.pc||{},t.pc.profile=t.pc.profile||{},t.pc.profile.prf_001_others=t.pc.profile.prf_001_others||{},t.pc.profile.prf_001_others.SceneDelegate=t.pc.BaseSceneDelegate.extend({_popups:{com_offerdel_check:{factoryName:"popupFactoryTextOnly",title:"",buttonLabels:{blackBtn:"",redBtn:""},buttons:{blackBtn:function(){this.dismiss()},redBtn:function(e){this.dismiss(),e._delegate._deleteUnapproveOffer(e)}}},prf_fredel_check:{factoryName:"popupFactoryTextOnly",content:"",title:"",buttonLabels:{blackBtn:"",redBtn:""},buttons:{blackBtn:function(){this.dismiss()},redBtn:function(e){this.dismiss(),e._delegate.deleteFriend(e)}}},prf_fredel_result:{factoryName:"popupFactoryBlue",title:"",content:"",buttonLabels:{blueBtn:"OK"},buttonSounds:{blueBtn:t.SoundList.BUTTON_TOUCHED_CONFIRMED},buttons:{blueBtn:function(e){this.dismiss(),e._delegate._setFriendState(e)}}},com_req_check:{factoryName:"popupFactoryPopupCommon",resourceName:function(){var e=n.findKey(res,function(e){return 0<e.indexOf("com_req_check")});return e||alert(": com_req_check"),e||""}(),title:"",buttonLabels:{blackBtn:""},buttons:{blackBtn:function(){this.dismiss()}}},com_req_delete:{factoryName:"popupFactoryTextOnly",content:"CSS",title:"",buttonLabels:{redBtn:"",blackBtn:""},buttons:{redBtn:function(){alert("{{popup/com_req_result}}")},blackBtn:function(){this.dismiss()}}},com_scout_cancel:{factoryName:"popupFactoryTextOnly",content:"",title:"",buttonLabels:{redBtn:"",blackBtn:""},buttons:{redBtn:function(e){e._delegate.cancelScout(e),this.dismiss()},blackBtn:function(){this.dismiss()}}},com_scout_check:{factoryName:"popupFactoryTextOnly",content:"",title:t.w("unionMember")+"",buttonLabels:{blueBtn:"",blackBtn:""},buttons:{blueBtn:function(e){this.dismiss(),e._delegate.scoutPlayer()},blackBtn:function(){this.dismiss()}}},popupResult:{factoryName:"popupFactoryBlue",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){e._delegate._setScoutButtonDisplay(e,e.routerParams.prf_001.id),this.dismiss()}}}},makeFriendOfferDelegate:null,player:null,STATE_ALREADY_FRIEND:1,STATE_ALREADY_FRIEND_REQUEST:2,STATE_ALREADY_FRIEND_REQUEST_TO_ME:3,STATE_OTHER:4,onSceneInit:function(e){this._verifyRouterParams001(e),this.makeFriendOfferDelegate.owner=e,this._setBackBtn(e),e.tabDelegateList[0].selectTab(e.seekWidgetByName("tab_0"));var t=e.seekWidgetByName("btn_union_search");return null!==t&&t.setVisible(!1),this._setScoutButtonDisplay(e,e.routerParams.prf_001.id),i.resolve()},onSceneEnter:function(e){return this.makeFriendOfferDelegate=new t.MakeFriendOfferDelegate,this.player={},this._setFriendState(e),this._setPlayerInfo(e,e.routerParams.prf_001.id).then(function(n){this.player=n,this._setPlayerUnionInfo(e,n.a_union_id),t.createInstance("BurstTimeSubTutorialPanel").show(this.player.a_union_id)}.bind(this)).fail(function(e){console.error(e)}),this._setPlayerPartyInfo(e,e.routerParams.prf_001.id),this._setChatInfo(e,e.routerParams.prf_001.id),this._setSupportSummonList(e,e.routerParams.prf_001.id),i.resolve()},onSceneExit:function(e){return this.makeFriendOfferDelegate.onExit(),i.resolve()},tabCallbackTab0:function(e){},tabCallbackTab1:function(e){},tabCallbackTab2:function(e){},_setFriendState:function(e){return t.createInstance("apiAFriendCheck").isFriend(e.routerParams.prf_001.id).then(function(t){return this._friendState=t.body.state,this._friendState!==this.STATE_ALREADY_FRIEND_REQUEST&&this._friendState!==this.STATE_ALREADY_FRIEND_REQUEST_TO_ME||(this._friendOfferId=t.body.a_friend_offer_id),e.initSceneUILoadPromise.thenResolve(this._friendState)}.bind(this)).then(function(t){e.disposed||this._setFriendButton(e,t)}.bind(this)).fail(function(e){console.error(e)})},_setFriendButton:function(e,t){var i=e.contentLayer.bfsWidgetByName("prf_btn_friend");if(!n.isUndefined(i))switch(t){case this.STATE_ALREADY_FRIEND:i.changeFrameWithAnimInfo("release","start");break;case this.STATE_ALREADY_FRIEND_REQUEST:i.changeFrameWithAnimInfo("cancellation","start");break;case this.STATE_ALREADY_FRIEND_REQUEST_TO_ME:i.changeFrameWithAnimInfo("check","start");break;case this.STATE_OTHER:i.changeFrameWithAnimInfo("apply","start")}},_setScoutButtonDisplay:function(e,a){var o=e.seekWidgetByName("prf_btn_scout");n.isUndefined(o)||(o.setVisible(!1),t.createInstance("apiAUnions").getMe().then(function(e){var r=e.body;if(!(n.isUndefined(r.a_union_id)||!this._checkIsLeaderOrSubLeader(r)||r.max_member_count<=r.member_count))return i.all([t.createInstance("apiAUnions").getMembers(1,r.member_count),t.createInstance("apiAUnionScouts").getListForPlayer(a)]).spread(function(e,t){var i=n.find(e.body.data,function(e){return e.a_player_id===a}),s=n.find(t.body.data,function(e){return e.union.a_union_id===r.a_union_id});!n.isUndefined(i)||0!==t.body.max_record_count&&n.isUndefined(s)||(o.setVisible(!0),this._setBtnScoutDisplayResult(!0),0===t.body.max_record_count?(o.changeFrameWithAnimInfo("member_scout","start"),this._scout=null,this._scoutId=null):(o.changeFrameWithAnimInfo("member_scout_cancellation","start"),this._scout=s,this._scoutId=s.a_scout_id))}.bind(this))}.bind(this)).fail(function(e){console.error(e.stack)}))},_checkIsLeaderOrSubLeader:function(e){if("me"===e.leader.a_player_id)return!0;if(n.isUndefined(e.sub_leaders))return!1;var t=!1;return n.each(e.sub_leaders,function(e){"me"===e.a_player_id&&(t=!0)}),t},btnCallbackBtnFriendApply:function(e){return this.makeFriendOfferDelegate.makeFriendOffer(this.player).then(this._setFriendState.bind(this,e)),i.reject(this._override)},btnCallbackBtnFriendCancellation:function(e){var t=i.defer();t.reject(this._override);var n=e.popups.com_offerdel_check;return n.open().then(function(){n.setContent("<span class='red'>"+this.player.name+"</span><br /> ")}.bind(this)).fail(function(e){console.error(e)}),t.promise},btnCallbackBtnFriendRelease:function(e){var t=i.defer();return t.resolve(),t.promise},btnCallbackBtnFriendCheck:function(e){var t=i.defer();t.reject(this._override);var n=e.popups.com_req_check;return n.open().then(function(){n.setStrings({friend_name_label:this.player.name}),n.seekWidgetByName("btn_rejection").addTouchEventListener(function(t,i){i===ccui.Widget.TOUCH_ENDED&&this._rejectOfferConfirm(e,n)},this),n.seekWidgetByName("btn_agreement").addTouchEventListener(function(t,i){i===ccui.Widget.TOUCH_ENDED&&(this._approveOffer(e),n.dismiss())},this)}.bind(this)).fail(function(e){console.error(e.stack)}),t.promise},btnCallbackTab0NodeBtnGreeting:function(e){var t=i.defer();return this._navigate001To005Others(e),t.reject(this._override),t.promise},btnCallbackTouchPanelFlame:function(e){var t=i.defer();t.reject(this._override);var a=this._supportSummonList.flame;return n.isNull(a)||this._navigate001To003(e,a,!1),t.promise},btnCallbackTouchPanelWater:function(e){var t=i.defer();t.reject(this._override);var a=this._supportSummonList.water;return n.isNull(a)||this._navigate001To003(e,a,!1),t.promise},btnCallbackTouchPanelWind:function(e){var t=i.defer();t.reject(this._override);var a=this._supportSummonList.wind;return n.isNull(a)||this._navigate001To003(e,a,!1),t.promise},btnCallbackTouchPanelThunder:function(e){var t=i.defer();t.reject(this._override);var a=this._supportSummonList.thunder;return n.isNull(a)||this._navigate001To003(e,a,!1),t.promise},btnCallbackTouchPanelLight:function(e){var t=i.defer();t.reject(this._override);var a=this._supportSummonList.light;return n.isNull(a)||this._navigate001To003(e,a,!1),t.promise},btnCallbackTouchPanelDarkness:function(e){var t=i.defer();t.reject(this._override);var a=this._supportSummonList.darkness;return n.isNull(a)||this._navigate001To003(e,a,!1),t.promise},btnCallbackTouchPanelIllusion:function(e){var t=i.defer();t.reject(this._override);var a=this._supportSummonList.phantom;return n.isNull(a)||this._navigate001To003(e,a,!1),t.promise},btnCallbackBtnAllOver:function(e){var t=i.defer();if(t.reject(this._override),n.isUndefined(this._unionInfo)||n.isUndefined(this._unionInfo.guardian_info))console.warn("[ERROR] Could not read an union info.");else{var a=this._unionInfo.guardian_info;this._openAllOverPanel(a.guardian_id,a.skin||0,"guardian")}return t.promise},btnCallbackTab2NodeBtnSeemore:function(e){var t=i.defer();t.reject(this._override);var n=this._getNavigateFrom(e);return this._navigate001ToUnion(n,"guild/gud_001_b"),t.promise},btnCallbackTab2NodeBtnMemberScout:function(e){var n=i.defer();n.reject(this._override);var a=e.popups.com_scout_check;return a.open().then(function(){a.setContent(""+this.player.name+'<br /><span class="mini"><br />'+t.w("unionMember")+"</span>")}.bind(this)).fail(function(e){console.error(e)}),n.promise},btnCallbackBtnMemberScoutCancellation:function(e){var t=i.defer();return t.resolve(),t.promise},btnCallbackBtnBurstinfoBtnBurstinfo:function(e){var t=i.defer();return t.reject(this._override),t.promise},_onTouchCharacter:function(e,t){this._navigate001To004(e,t,!1)},_onTouchWeapon:function(e,t){this._navigate001To002(e,t,!1)},_onTouchSummon:function(e,t){this._navigate001To003(e,t,!1)},_onTouchChatPlayer:function(e,t){var n=e.routerParams.prf_001.id;this._navigatePrf001ToPrf001(e,t,n)},deleteFriend:function(e){t.createInstance("apiAFriends").getList("all").then(function(i){var a=n.find(i.body.data,function(e){return e.a_player_id==this.player.a_player_id}.bind(this));if(!n.isUndefined(a))return t.createInstance("apiAFriends").delete([a.a_friend_id],[a.a_player_id]).then(function(t){if(!1!==t.body.result)return e._delegate._setFriendState(e).then(function(){e.popups.prf_fredel_result.open()})}.bind(this))}.bind(this)).fail(function(e){console.error(e)})},_deleteUnapproveOffer:function(e){return n.isUndefined(this._friendOfferId)?void this._setFriendState(e):void t.createInstance("apiAFriendOffers").deleteOffers([this._friendOfferId]).then(function(t){if(!1!==t.body.result){var n=e.popups.popupWithOk;return n.open().then(function(){n.setTitle(""),n.setContent(""),n.blueBtn.addTouchEventListener(function(t,i){i===ccui.Widget.TOUCH_ENDED&&(n.dismiss(),this._setFriendState(e))},this)}.bind(this))}}.bind(this)).fail(function(e){console.error(e)})},_approveOffer:function(e){t.createInstance("apiAFriends").accept(this.player.a_player_id).then(function(t){var i;if(!1!==t.body.result)return n.isUndefined(t.body.error)||"toListFull"!==t.body.error?n.isUndefined(t.body.error)||"fromListFull"!==t.body.error?(i=e.popups.popupWithOk).open().then(function(){i.setTitle(""),i.setContent("<span class='red'>"+this.player.name+"</span><br /> "),i.blueBtn.addTouchEventListener(function(t,n){n===ccui.Widget.TOUCH_ENDED&&(this._setFriendState(e),i.dismiss())},this)}.bind(this)):(i=e.popups.popupWithOk).open().then(function(){i.setTitle(""),i.setContent("")}):(i=e.popups.popupWithOk).open().then(function(){i.setTitle(""),i.setContent("<span class='red'>"+this.player.name+"</span><br /> ")}.bind(this))}.bind(this)).fail(function(e){console.error(e)})},_rejectOfferConfirm:function(e,t){var n=e.popups.com_req_delete;n.open().then(function(){n.setContent("<span class='red'>"+this.player.name+"</span><br /> "),n.redBtn.addTouchEventListener(function(i,a){a===ccui.Widget.TOUCH_ENDED&&(this._rejectOffer(e),t.dismiss(),n.dismiss())},this)}.bind(this)).fail(function(e){console.error(e)})},_rejectOffer:function(e){t.createInstance("apiAFriendOffers").deleteOffers([this._friendOfferId]).then(function(t){if(!1!==t.body.result){var n=e.popups.popupWithOk;return n.open().then(function(){n.setTitle(""),n.setContent(""),n.blueBtn.addTouchEventListener(function(t,i){i===ccui.Widget.TOUCH_ENDED&&(this._setFriendState(e),n.dismiss())},this)}.bind(this))}}.bind(this)).fail(function(e){console.error(e)})},scoutPlayer:function(){this._scoutMember(this.player)},cancelScout:function(e){return n.isUndefined(this._scoutId)?void this._setScoutButtonDisplay(e,e.routerParams.prf_001.id):void t.createInstance("apiAUnionScouts").cancel(this._scout.union.a_union_id,e.routerParams.prf_001.id,"cancel").then(function(t){this._setScoutButtonDisplay(e,e.routerParams.prf_001.id)}.bind(this)).fail(function(e){console.error(e)})},_touchEndedBackBtnProcess:function(e){var t=e.temporaryRouterParams.return_to_profile;this._navigateToReturnToBack(t)},_getNavigateFrom:function(e){var n=e.tabDelegateList[0].selected;e.temporaryRouterParams.restoreParams={tabs:[n]};var i=e.routerParams.prf_001,a=e.temporaryRouterParams;return{id:this._unionInfo.a_union_id,routes:t.createInstance("router").getCurrentFragment(),routerParams:i,temporaryRouterParams:a}}}),t.assignRoles(t.pc.profile.prf_001_others.SceneDelegate,[t.pc.profile.roles.Routing,t.pc.profile.roles.ProfileCommon,t.pc.roles.AllOverUI,t.pc.guild.roles.GuildScout,t.fr_002_003.Popups])}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.profile=t.pc.profile||{},t.pc.profile.prf_005_myself=t.pc.profile.prf_005_myself||{},t.pc.profile.prf_005_myself.Scene=t.BaseScene.extend({resourceFileName:"prf_005/prf_005_myself",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"profile",sceneName:"prf_005_myself",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_reload","btnCallbackBtnReload",null,function(){alert("{{}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._),i=e.Q;t.pc=t.pc||{},t.pc.profile=t.pc.profile||{},t.pc.profile.prf_005_myself=t.pc.profile.prf_005_myself||{},t.pc.profile.prf_005_myself.SceneDelegate=t.pc.BaseSceneDelegate.extend({_popups:{},onSceneInit:function(e){return i.defer(),this._setBackBtn(e),i.resolve()},onSceneEnter:function(e){return this._setPlayerInfo(e,"me").then(function(t){this._fillupChatBtnsList(e,"apiAGreets","getList",["me"])}.bind(this)).fail(function(e){console.error(e)}),i.resolve()},_onTouchChatPlayer:function(e,t){this._navigateProf005ToProf001(e,t,"me")},_onTouchDeleteChat:function(e,t){this._greetDeleteConfirm(e,t.a_greet_id)},_touchEndedBackBtnProcess:function(e){this._navigateTo001ByAPlayerId("me")}}),n.assign(t.pc.profile.prf_005_myself.SceneDelegate.prototype._popups,t.pc.profile.roles.DeleteGreeting._popups),n.assign(t.pc.profile.prf_005_myself.SceneDelegate.prototype,t.pc.roles.UIUtility,t.pc.profile.roles.Routing,t.pc.profile.roles.ProfileCommon,t.pc.list.roles.ChatPageListBtnsController,t.pc.profile.roles.DeleteGreeting.methods)}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.profile=t.pc.profile||{},t.pc.profile.prf_005_others=t.pc.profile.prf_005_others||{},t.pc.profile.prf_005_others.Scene=t.BaseScene.extend({resourceFileName:"prf_005/prf_005_others",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"profile",sceneName:"prf_005_others",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_chat_stamp","btnCallbackBtnChatStamp",null,function(){alert("{{popup/com_edit_greed}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_reload","btnCallbackBtnReload",null,function(){alert("{{}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc=t.pc||{},t.pc.profile=t.pc.profile||{},t.pc.profile.prf_005_others=t.pc.profile.prf_005_others||{},t.pc.profile.prf_005_others.SceneDelegate=t.pc.BaseSceneDelegate.extend({_popups:{popupGreeting:{factoryName:"popupFactoryComGreeting"},popupResult:{factoryName:"popupFactoryBlue",buttonLabels:{blueBtn:"OK"},onPopupOpened:function(){var e=n.director.getRunningScene().seekWidgetByPath("popupLayer..editbox_0");e&&e.setVisible(!1)},buttons:{blueBtn:function(e){this.dismiss();var t=e.seekWidgetByPath("popupLayer..editbox_0");t&&t.setVisible(!0)}}}},greetingDelegate:new t.GreetingDelegate,onSceneInit:function(e){return this._setBackBtn(e),this._verifyRouterParams005(e),this.greetingDelegate.owner=e,this.greetingDelegate.afterSendMessage=function(){this.btnCallbackBtnReload&&this.btnCallbackBtnReload(e)||t.createInstance("sceneManager").reloadScene()}.bind(this),a.resolve()},onSceneEnter:function(e){return this._setPlayerInfo(e,e.routerParams.prf_005.id).then(function(t){this.player=t,this._fillupChatBtnsList(e,"apiAGreets","getList",[e.routerParams.prf_005.id])}.bind(this)).fail(function(e){console.error(e)}),a.resolve()},btnCallbackBtnChatStamp:function(e){var t=a.defer();return t.reject(this._override),e.popups.popupGreeting.open({friend:this.player,scene:this.greetingDelegate,inputMaxLength:60}),t.promise},_onTouchChatPlayer:function(e,t){var n=e.routerParams.prf_005.id;this._navigateProf005ToProf001(e,t,n)},_onTouchDeleteChat:function(e,t){this._greetDeleteConfirm(e,t.a_greet_id)},_touchEndedBackBtnProcess:function(e){var t=e.routerParams.prf_005.id;this._navigateTo001ByAPlayerId(t)}}),i.assign(t.pc.profile.prf_005_others.SceneDelegate.prototype._popups,t.pc.profile.roles.DeleteGreeting._popups),t.assignRoles(t.pc.profile.prf_005_others.SceneDelegate,[t.pc.roles.UIUtility,t.pc.profile.roles.Routing,t.pc.profile.roles.ProfileCommon,t.pc.list.roles.ChatPageListBtnsController,t.pc.profile.roles.DeleteGreeting.methods])}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.profile=t.pc.profile||{},t.pc.profile.prf_support_summon_config=t.pc.profile.prf_support_summon_config||{},t.pc.profile.prf_support_summon_config.Scene=t.BaseScene.extend({resourceFileName:"prf_support_summon_config/prf_support_summon_config.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"profile",sceneName:"prf_support_summon_config",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_sort","btnCallbackBtnSort",null,function(){alert("{{sort_0_ui.jsonsort_list_0_ui.json}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_detail","btnCallbackBtnDetail",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"detail/de_004")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_cancel","btnCallbackBtnCancel",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"profile/prf_001_myself")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_setting","btnCallbackBtnSetting",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"profile/prf_001_myself")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_release","btnCallbackBtnRelease",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"profile/prf_001_myself")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"filter_btn","btnCallbackFilterBtn",null,function(){alert("{{com_filter_other}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc=t.pc||{},t.pc.profile=t.pc.profile||{},t.pc.profile.prf_support_summon_config=t.pc.profile.prf_support_summon_config||{},t.pc.profile.prf_support_summon_config.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../prf_popup_ui.json"],_popups:{},_controller:null,_createDisplayFilterSettings:function(){return{window_gray:[t.displayFilter.enums.FILTER_NAME.SUPPORT_SUMMON,"com_filter_other"]}},onSceneInit:function(e){return a.defer(),this._setTitle(e),this._createDisplayFilterController(e),this._initializeDisplayFilterController("window_gray"),this._setBackBtn(e),this._getInitSelectedCardData(e).then(this._initListController.bind(this,e))},_setTitle:function(e){var n=t.WordBook.ELEMENT_TYPE_LIST[this._getElementType()];e.seekWidgetByName("header_label").setString(""+n.name+"")},_getInitSelectedCardData:function(e){var n=this._getElementType();return t.createInstance("apiASupportSummonSetting").get("me").then(function(e){return e.body[n]})},_getElementType:function(){return n.director.getRunningScene().routerParams.support_summon.element_type},_initListController:function(e,n){return this._controller=new t.profile.controller.SummonList(e,n),this._controller.setPageList()},onSceneEnter:function(e){return a.defer(),a.resolve()},onSceneExit:function(e){return this._displayFilterClean(),this._controller.clean(),this._controller=null,a.resolve()},onPageInAnimationEnd:function(e){return a.defer(),a.resolve()},btnCallbackBtnSort:function(e){var t=a.defer();return t.reject(this._override),t.promise},btnCallbackBtnDetail:function(e){var t=a.defer();t.reject(this._override);var n=this._getElementType(),o=this._controller.getSelectedRecord(),r=i.isNull(o)?null:o.a_summon_id,s=this._controller.getDefaultRecordId();return this._navigateToDe004(n,s,r),t.promise},btnCallbackBtnCancel:function(e){var t=a.defer();return t.reject(this._override),this._navigateTo001Status(),t.promise},btnCallbackBtnSetting:function(e){var n=a.defer();n.reject(this._override);var i=this._getElementType(),o=this._controller.getSelectedRecord();return t.createInstance("apiASupportSummonSetting").update(i,o.a_summon_id).then(function(e){this._navigateTo001SetSupportSummon(i,o)}.bind(this)).fail(function(e){console.error(e)}),n.promise},btnCallbackBtnRelease:function(e){var n=a.defer();n.reject(this._override);var i=this._getElementType();return t.createInstance("apiASupportSummonSetting").update(i,null).then(function(e){this._navigateTo001ReleaseSupportSummon(i)}.bind(this)).fail(function(e){console.error(e)}),n.promise},btnCallbackFilterBtn:function(e){var t=a.defer();return t.reject(this._override),t.promise},_touchEndedBackBtnProcess:function(e){this._navigateTo001Status()}}),t.assignRoles(t.pc.profile.prf_support_summon_config.SceneDelegate,[t.displayFilter.roles.DisplayFilterSceneController,t.pc.roles.UIUtility,t.pc.profile.roles.Routing])}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.router=n.router||{},n.router.routes=n.router.routes||{},t.merge(n.router.routes,{profile:{profile:"prf_001_myself","profile/prf_001":"prf_001_myself","profile/prf_001a":"prf_001_myself","profile/prf_001b":"prf_001_others","profile/prf_005a":"prf_005_myself","profile/prf_005b":"prf_005_others","profile/prf_005_myself":"prf_005_myself","profile/prf_005_others":"prf_005_others","profile/prf_support_summon_config":"prf_support_summon_config","profile/detail/de_001":"de_001_002","profile/detail/de_003":"de_003","profile/detail/de_004":"de_004"}})}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="AGachaCategories",o={getEventGachaCategories:function(e){return this._http.get({url:"/a_gacha_categories",json:{type:"event",event_id:e}})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiAGachaCategories",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},o)),n.env.useApiMock){n.MockApi=n.MockApi||{};var r={};t.each(o,function(e,t){r[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi."+a+"."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},r))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e.kh;e.cc,e._,e.Q,t.pc=t.pc||{},t.pc.status=t.pc.status||{},t.pc.status.roles=t.pc.status.roles||{},t.pc.status.roles.ShSummonInfoCommon={setData:function(e,t){this._setCorecard(e,t),this._setSummonName(e,t.name),this._setAttackInfo(e,t.attack),this._setSupportInfo(e,t.effect),this._setMaxLimitSupportInfo(e,t.max_overlimit_effect.description),this._setHpAndAttack(e,t)},clearData:function(e){this._setSummonName(e,""),this._setAttackInfo(e,{name:"",description:""}),this._setSupportInfo(e,{name:"",description:""}),this._setMaxLimitSupportInfo(e,""),this._clearCorecard(e),e.seekWidgetByName("status_labelimg").setVisible(!1)},_setCorecard:function(e,n){var i=e.seekWidgetByName("corecard_summon_ui"),a=t.createInstance("CoreCardSummonUI",[null,i]);a.setImg(n.summon_id,n.skin||0),a.setPlusNo(n.bonus?"+"+n.bonus:""),a.setIconElement(n.element_type),a.setIconRarity(n.rare),a.setVisible(!0)},_clearCorecard:function(e){e.seekWidgetByName("corecard_summon_ui").setVisible(!1)},_setSummonName:function(e,t){this._setLabel(e,"summon_name_label",t)},_setAttackInfo:function(e,t){this._setLabel(e,"summon_attack_name_label",t.name),this._setLabel(e,"summon_attack_label",t.description)},_setSupportInfo:function(e,t){this._setLabel(e,"summon_support_name_label",t.name),this._setLabel(e,"summon_support_label",t.description)},_setMaxLimitSupportInfo:function(e,t){this._setLabel(e,"summon_support_max_label",t)},_setHpAndAttack:function(e,n){var i="<div style='padding-bottom:10px;width:100%;height:100%'>                   <table width='100%' height='100%'>                   <tr class='cyan_shadow'>                     <td><span class='cyan_shadow_mini'>MIN </span>"+n.min_hp+"</td>                     <td>-</td>                     <td><span class='cyan_shadow_mini'>MAX </span>"+n.max_hp+"</td>                     <td>&nbsp;</td>                   </tr>                   <tr class='pink_shadow'>                     <td><span class='pink_shadow_mini'>MIN </span>"+n.min_attack+"</td>                     <td>-</td>                     <td><span class='pink_shadow_mini'>MAX </span>"+n.max_attack+"</td>                     <td>&nbsp;</td>                   </tr>                 </table></div>";e.setHtmlStrings({status_labelimg:i},t.GameConfig.POPUP_CSS).then(function(){e.seekWidgetByName("status_labelimg").setVisible(!0)}.bind(this))},_setLabel:function(e,t,n){e.seekWidgetByName(t).string=n}}}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;e.Q,t.pc=t.pc||{},t.pc.status=t.pc.status||{},t.pc.status.roles=t.pc.status.roles||{},t.pc.status.roles.ShWeaponInfoCommon={setData:function(e,t){this._setCorecard(e,t),this._setWeaponName(e,t.name),this._setWeaponIcon(e,t.weapon_type),this._setHpAndAttack(e,t);var n=e.seekWidgetByName("node_before_final")||e;n.setVisible(!0),this._setBurstInfo(n,t.burst),this._setSkillInfo(n,t.skills),this._setArouseStatus(e,t)},_setArouseStatus:function(e,n){var a=khutil.getWidgetFromNode(e,"btn_evo_final_after_before_ui",function(e){console.warn("ShWeaponInfoCommon._setArouseStatus: "+e)});if(null!==a){var o=khutil.getWidgetFromNode(e,"node_before_final",function(e){console.warn("ShWeaponInfoCommon._setArouseStatus: "+e)}),r=khutil.getWidgetFromNode(e,"node_after_final",function(e){console.warn("ShWeaponInfoCommon._setArouseStatus: "+e)});if(!n.can_arouse)return a.setAppearance("btn_off"),r.setVisible(!1),void o.setVisible(!0);var s=n.aroused_status;this._setBurstInfo(r,s.burst),this._setSkillInfo(r,s.skills),t.setTouchEventHandlers(a,{"TOUCH_ENDED btn_evo_final_after":function(e,t){a.setAppearance("btn_before"),this._setCorecard(e,i.extend({},t,{is_aroused:!0})),o.setVisible(!1),r.setVisible(!0);var n=i.extend({},t,t.aroused_status);this._setHpAndAttack(e,n)}.bind(this,e,n),"TOUCH_ENDED btn_evo_final_before":function(e,t){a.setAppearance("btn_after"),this._setCorecard(e,t),r.setVisible(!1),o.setVisible(!0),this._setHpAndAttack(e,t)}.bind(this,e,n)}),a.setAppearance("btn_after")}},clearData:function(e){this._setWeaponName(e,""),i(["status_labelimg","skill_label_0","skill_name_label_0","skill_label_1","skill_name_label_1","burst_label","weapon_icon","node_after_final"]).map(e.seekWidgetByName.bind(e)).invoke("setVisible",!1),this._clearCorecard(e)},_setCorecard:function(e,n){var i=e.seekWidgetByName("corecard_weapon_ui"),a=t.createInstance("CoreCardWeaponUI",["e_r",i]);a.setImg(n.weapon_id,n.skin||0),a.setAroused(n.is_aroused||!1),a.setPlusNo(n.bonus?"+"+n.bonus:""),a.setIconElement(n.element_type),a.setIconRarity(n.rare),a.setVisible(!0)},_clearCorecard:function(e){e.seekWidgetByName("corecard_weapon_ui").setVisible(!1)},_setWeaponName:function(e,t){this._setLabel(e,"weapon_name_label",t)},_setWeaponIcon:function(e,t){var n=e.seekWidgetByName("weapon_icon");n.loadTexture("core/res/icon/weapontypeicon_"+t+".png",ccui.Widget.PLIST_TEXTURE),n.setVisible(!0)},_setBurstInfo:function(e,t){e.seekWidgetByName("burst_label").setTextVerticalAlignment(n.VERTICAL_TEXT_ALIGNMENT_TOP),this._setLabel(e,"burst_label",t.description)},_setSkillInfo:function(e,t){i.each(i.merge([{name:"",description:""},{name:"",description:""}],t),function(t,n){var i="_"+n,a="skill_name_label"+i,o="skill_label"+i;this._setLabel(e,a,t.name),this._setLabel(e,o,t.description)}.bind(this))},_setHpAndAttack:function(e,n){var i="<div style='padding-bottom:10px;width:100%;height:100%'>                   <table width='100%' height='100%' style='white-space:nowrap;'>                   <tr class='cyan_shadow'>                     <td><span class='cyan_shadow_mini'>MIN </span>"+n.min_hp+"</td>                     <td>-</td>                     <td><span class='cyan_shadow_mini'>MAX </span>"+n.max_hp+"</td>                     <td>&nbsp;</td>                   </tr>                   <tr class='pink_shadow'>                     <td><span class='pink_shadow_mini'>MIN </span>"+n.min_attack+"</td>                     <td>-</td>                     <td><span class='pink_shadow_mini'>MAX </span>"+n.max_attack+"</td>                     <td>&nbsp;</td>                   </tr>                 </table></div>";e.setHtmlStrings({status_labelimg:i},t.GameConfig.POPUP_CSS).then(function(){e.seekWidgetByName("status_labelimg").setVisible(!0)}.bind(this))},_setLabel:function(e,t,n){var i=e.seekWidgetByName(t);null!==i&&(i.string=n,i.setVisible(!0))}}}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.createNameSpaceIfNotExists("core.view"),n.core.view.ImplantedEventSubTutorialPopup=n.core.view.ImplantedSubTutorialPopup.extend({_eventId:null,_initContents:function(e,t){this._eventId=e,this._super(null,t)},_createPageList:function(e){return t.map(t.range(e),function(e){return this._createPage(n.Img("popupsub","event",t.padZero(this._eventId,4),e+1).png)},this)}})}((this||0).self||global),function(e){e.kh=e.kh||{};var t=e.kh;e.cc,e.ccs,e._,e.res,t.QuestSceneSpCommonDelegate=t.QuestSceneCommonDelegate.extend({ctor:function(){}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=(e.ccui,e._);e.console,t.createNameSpaceIfNotExists("raidevent.settings"),t.raidevent.settings.EventRewardPageListSetting=n.Class.extend({className:"EventRewardPageListSetting",ctor:function(e,t,n){this._eventId=t,this._baseName=e,this._currencyType=n},SETTINGS:{panelName:t.BtnsPageListParams.RAID_EVENT_REWARDS.panelName,paginatorNode:"viewpage_ui",apiName:"apiAEvents",apiMethod:"getRaidEventRewards",apiParams:null,fillEmptyRecord:!1},getSettings:function(){return i.extend({},this.SETTINGS,{apiParams:[this._eventId,this._currencyType,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE],baseName:this._baseName})}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=(e.ccui,e._);e.console,t.createNameSpaceIfNotExists("raidevent.eventHandling"),t.raidevent.eventHandling.ReceiveConfirmedEventHandler=t.core.reward.ReceiveRewardButtonTouchEventHandler.extend({className:"ReceiveConfirmedEventHandler",ctor:function(e){this._api=t.createInstance("apiAEvents"),this._eventId=e},_receiveConfirmed:function(e){var t=n.director.getRunningScene();this._api.receiveRaidEventReward(this._eventId,e.getRewardId()).then(function(e){var n=e.body;if(!0===n.is_expired)return this._showExpiredPopup(t);var a=n.new_characters_gained;return i.isEmpty(a)?Q.resolve():this._showNewMemberPopups(a)}.bind(this)).then(function(){t.refresh()})}}),i.assign(t.raidevent.eventHandling.ReceiveConfirmedEventHandler.prototype,t.hlbattle.roles.ReceiveResponseCommon)}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.router=n.router||{},n.router.routes=n.router.routes||{},t.merge(n.router.routes,{raidevent:{raidevent:"ra_000","raidevent/ra_000":"ra_000","raidevent/ra_001":"ra_001","raidevent/ra_002":"ra_002","raidevent/ra_003":"ra_003","raidevent/ra_004":"ra_004","raidevent/ra_005":"ra_005","raidevent/ra_006":"ra_006"}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc.raidevent=t.pc.raidevent||{},t.pc.raidevent.roles=t.pc.raidevent.roles||{},t.pc.raidevent.roles.RaidEventCommon={_setHeaderTitleStr:function(e,t){var n=e.seekWidgetByPath("header_node..header_label");null!==n&&n.setString(t.getTitle())},_clearHeaderTitleStr:function(e){var t=e.seekWidgetByPath("header_node..header_label");null!==t&&t.setString("")},_getEventIdFromRouterParams:function(e){var n=t.createInstance("router").getCurrentFragment().replace("raidevent/","");""===n&&(n="ra_000");var i=e.routerParams.event_id||e.temporaryRouterParams.event_id;return null!=i?(e.routerParams[n]=e.routerParams[n]||{},e.routerParams[n].event_id=i):i=e.routerParams[n]&&e.routerParams[n].event_id,i},_setEventPeriodStr:function(e,t){},_setRewardReceptDeadlineStr:function(e,t){e.seekWidgetByName("limit_date_label").setString(t.getRewardReceiptDeadline()+"")},_setBackgroundImage:function(e,o){var r=t.createInstance("router").getCurrentFragment().replace(/raidevent[^0-9]*/,"");r=r||"000",o=o||this._getEventIdFromRouterParams(e);var s=i.union([r],[t.env.isSp?"003":"002"]),c=[];return i.each(s,function(r){var s=t.Img("raid-bg"+r,"event",i.padZero(o,4)).jpg,u=a.defer();c.push(u),n.loader.loadImg(s,function(t,n){return t?(u.reject(t.toString()),void console.warn(t)):void e.initSceneUILoadPromise.then(function(){u.resolve();var t=e.seekWidgetByName("raid-bg"+r);null!==t&&t.loadTexture(s)})})},this),a.all(c)},_showTreasures:function(e,n){t.createInstance("EventItemStockPanel",[{parent_node:e,item_holder_prefix:"material_panel_",corecard_ui_name:"corecard_item_ui_64"}]).setup(n.getRaidEventTreasures())},_showCertificates:function(e,n){var i=e.seekWidgetByName("have_p_no_label");null!=i&&i.setString(n.getAchievementPoint().toString()),t.createInstance("EventItemStockPanel",[{parent_node:e,item_holder_prefix:"item_panel_",corecard_ui_name:"corecard_item_ui_64"}]).setup(n.getRaidEventCertificates())},_showTickets:function(e,n){t.createInstance("EventItemStockPanel",[{parent_node:e,item_holder_prefix:"ticket_panel_",corecard_ui_name:"corecard_item_ui_64"}]).setup(n.getRaidEventTickets())},_setupEventTopButtons:function(e,n){try{t.createInstance("AttentionButton",[e,"btn_event_gacya"]).setAttentionView(n.hasGachaTickets()),t.createInstance("AttentionButton",[e,"btn_interchange"]).setAttentionView(n.hasNewRewards()),new t.pc.raidevent.view.QuestButton(e,"ra_btn_ev-quest_ui").setAttentionView(n.emergedSuddenQuest())}catch(e){console.error(e)}}}}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc.quest=t.pc.quest||{},t.pc.raidevent.roles=t.pc.raidevent.roles||{},t.pc.raidevent.roles.EventQuestPageListController={_popups:{comQuestInfo:{factoryName:"popupFactoryComQuestInfo"}},_fillupEventQuestList:function(e,n,o){var r=t.createInstance("apiAQuests").getListEventQuest(n),s=t.createInstance("aQuestInfo").get(),c=a.all([r,s]);return e.initSceneUILoadPromise.then(function(){return c}).spread(function(n,a){var r=e.contentLayer.seekWidgetByName("page_quest_list");if(null!==r){var s=this._initFuncRaidPanel.bind(this);this._in_progress_id=this._pickInProgressAQuestId(a.getRawData());var c={targetNode:"quest_base",touchEventFuncName:o};return $staticRes(res["raidevent-ra_002-ra_002_questlist_page_ui"]),this._fillupList(r.parent,{viewParent:r.name,subPageRes:t.PageListParams.RAID_EVENT_QUEST_LIST.subPageRes,panelsPerPage:t.PageListParams.RAID_EVENT_QUEST_LIST.perPage},n.body.data,n.body.max_record_count,c,s),0===n.body.max_record_count&&(i.isFunction(this._showNothingLabel)?this._showNothingLabel(r):console.warn("[ERROR] You sould assign UIUtility role.")),n.body}console.warn("[ERROR] Could not find a list parent node.")}.bind(this)).fail(function(e){console.error(e)}),c},_pickInProgressAQuestId:function(e){if(i.isEmpty(e)||i.isEmpty(e.in_progress))return null;var t=e.in_progress.own_quest;if(i.isEmpty(t))return null;var n=t.type;return"event_main"!==n&&"event_raid"!==n?null:t.a_quest_id},_initFuncRaidPanel:function(e,n){var a=n.type;e.animate(a);var o=e.seekWidgetByName("questimg");if(null!==o&&!i.isUndefined(n.quest_id)){var r=t.Img("questimg","event-quest",i.padZero(n.quest_id,4),1).jpg;o.loadTexture(r)}var s=e.seekWidgetByName("icon_raid-battle");if(null!==s){var c=a.match("raid");s.setVisible(c)}var u=e.seekWidgetByName("quest_header_label");null===u||i.isUndefined(n.title)||u.setString(n.title);var l=e.seekWidgetByName("raid_limit_label");null!==l&&(i.isString(n.time_left)&&n.time_left.length>0?(l.setString(n.time_left),l.setVisible(!0)):l.setVisible(!1));var _=e.seekWidgetByName("cons_ap_label");null===_||i.isUndefined(n.quest_ap)||(_.setString("AP"+n.quest_ap),_.setCascadeColorEnabled(!0));var p=e.seekWidgetByName("quest_reward");if(null!==p)if(n.is_cleared||i.isUndefined(n.reward_info)||i.isUndefined(n.reward_info.item_id))p.setVisible(!1);else{var d=t.Img("rewardicon","item",i.padZero(n.reward_info.item_id,4)).png;p.loadTexture(d),p.setVisible(!0)}var h=e.seekWidgetByName("name_use_label"),m=n.required_item;null===h||i.isEmpty(m)||i.isUndefined(m)||i.isUndefined(m.name)||h.setString(m.name+" "+(m.amount||"-"));var g=e.seekWidgetByName("time_rest_label");null===g||i.isUndefined(n.time_left)||g.setString(n.time_left);var f=e.seekWidgetByName("cons_label");if(null!==f&&!i.isUndefined(n.event_info)&&!i.isUndefined(n.event_info.type)){var b=n.event_info.type;switch(f.setVisible(!0),b){case"quest_ap_half":f.setString(t.WordBook.quest_ap_half);break;case"quest_ap_free":f.setString(t.WordBook.quest_ap_free);break;default:f.setVisible(!1)}}var v=e.seekWidgetByName("img_quest_info_icon");if(v&&!i.isUndefined(n.is_new)&&!i.isUndefined(n.is_cleared)){var E=this._in_progress_id==n.a_quest_id&&null!==n.a_quest_id,y=n.is_new||n.is_cleared||E,P="";E?P="core/res/icon/queststatusicon_now.png":n.is_new?P="core/res/icon/queststatusicon_new.png":n.is_cleared&&(P="core/res/icon/queststatusicon_clear.png"),v.loadTexture(P,ccui.Widget.PLIST_TEXTURE),v.setVisible(y);var I=v.getParent();I.setVisible(y),n.is_new?I.animate("new",!0):I.animate("default",!1)}var C=e.seekWidgetByName("btn_icon_balloon");if(C){var N="event_main"===n.type,A=n.limit_info;N||i.isEmpty(A)||(N=i.isNumber(A.elixir)&&A.elixir>=0||i.isNumber(A.rank)&&A.rank>=0||i.isNumber(A.remaining_challenge_count)&&A.remaining_challenge_count>=0),C.setVisible(N),C.setEnabled(N),N&&this.__setBalloonButtonEventHandler(C,n)}this.__setGrayOutPanel(e,m)},__setGrayOutPanel:function(e,t){var n=!!i.isEmpty(t)||t.possession_amount>=t.amount;this._setGrayOutButton(e,n);var a=e.seekWidgetByName("quest_base");a&&a.setCascadeColorEnabled(!0);var o=e.seekWidgetByName("questimg");o&&this._setGrayOutButton(o,n);var r=e.seekWidgetByName("cons_ap_base");r&&r.setCascadeColorEnabled(!0)},__setBalloonButtonEventHandler:function(e,t){var i=function(e,i){if(i===ccui.Widget.TOUCH_ENDED){var a=n.director.getRunningScene();"event_main"===t.type?this._showQInfoPopup(a,t):this._qCaution3Popup(a,t)}}.bind(this);e.addTouchEventListener(i)},_showQInfoPopup:function(e,t){var n=e.popups.comQuestInfo,a=t.title,o=t.limit_info,r="";if(!i.isEmpty(o)){var s=[];i.isNumber(o.elixir)&&o.elixir>=0&&s.push(0!==o.elixir?":"+o.elixir+"":""),i.isNumber(o.rank)&&o.rank>=0&&s.push("Rank "+t.limit_info.rank+""),i.isNumber(o.remaining_challenge_count)&&o.remaining_challenge_count>=0&&s.push("  "+t.limit_info.remaining_challenge_count+""),r="[] "+s.join("\n")}n.open({title:a,description:t.description,start_condition:r}).then(function(){}.bind(this)).fail(function(e){console.error(e.stack)})}},i.assign(t.pc.raidevent.roles.EventQuestPageListController,t.pc.roles.CoreCardCommon,t.pc.list.roles.PageListControllerCommon)}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._),i=e.Q;t.pc.raidevent=t.pc.raidevent||{},t.pc.raidevent.roles=t.pc.raidevent.roles||{},t.pc.raidevent.roles.EventGachaCommon={_setTicketAmountStrWithIndex:function(e,t,i){var a=t.getRaidEventTickets()[i],o=e.seekWidgetByName("have_ticket_no_label");null===o||n.isUndefined(a)||o.setString(a.getAmount().toString())},_initGachaButtons:function(e,n){var a=t.createInstance("eventGachaCategories");return a.prepare(n).then(function(){return this.__initGachaButtons(e,a),i.resolve(a)}.bind(this))},_initGachaButtonsWithIndex:function(e,i,a){var o=t.createInstance("eventGachaCategories"),r=e.seekWidgetByName("btn_gacha_panel_0");n.isUndefined(r)||o.prepare(i).then(function(){this.__setupUpperAndLowerGachaButtonsAndSkipButton(r,o.getAt(a))}.bind(this))},__initGachaButtons:function(e,t){this.__setupUpperAndLowerGachaButtonsAndSkipButton(e,t.getAt(0))},__setupUpperAndLowerGachaButtonsAndSkipButton:function(e,i){var a=i.getGachas(),o=this.__getUpperButtonNode(e),r=this.__getLowerButtonNode(e);n.each([o,r],function(i,o){null===i||n.isEmpty(a[o])||t.createInstance("GachaPlayButton",[e,i.getName(),a[o]])},this),null===e.seekWidgetByName("btn_skip")&&(e=e.parent),this.skipButtonView=t.createInstance("GachaSkipButton",[e,"btn_skip"])},__getUpperButtonNode:function(e){return e.seekWidgetByName("btn_top_gacha")||e.seekWidgetByName("btn_gacha_0")},__getLowerButtonNode:function(e){return e.seekWidgetByName("btn_bottom_gacha")||e.seekWidgetByName("btn_gacha_1")},_animateGachaButtonsAccordingToTicketsAmount:function(e,t,n){var i=["normal_limit","default_view"][t.getRaidEventTickets()[n].getAmount()]||"normal_double";e.animate(i,!1)}}}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;$staticRes(res["raidevent-ra_001_first_animation-ra_001_first_ani"]),t.pc.raidevent=t.pc.raidevent||{},t.pc.raidevent.roles=t.pc.raidevent.roles||{},t.pc.raidevent.roles.OpeningAnimation={_initOpeningAnimation:function(e,n){this._preLoadList={raidEvent_bgImage:t.Img("raidani-bg","event",i.padZero(n,4)).jpg,raidEvent_charaImage:t.Img("raidani-chara","event",i.padZero(n,4)).png};var a=this.__preloadImages(n);return this._openingAnimation=this.__loadOpeningAnimationData(e,n,a),a},_startOpeningAnimation:function(e,t){return t?i.isEmpty(this._openingAnimation)?(console.error("raidevent.OpeningAnimation must be called '_initOpeningAnimation' before '_startOpeningAnimation'."),a.reject()):this.__startOpeningAnimationData(e,this._openingAnimation,t):(console.error("raidevent.OpeningAnimation _startOpeningAnimation eventId is null."),a.reject())},__preloadImages:function(e){var t=[];return i.each(this._preLoadList,function(e,n){t.push(this.__loadImageCore(e))},this),this._preloadPromise=a.all(t),this._preloadPromise},__loadImageCore:function(e){var t=a.defer();return n.loader.loadImg(e,function(n,i){n?(t.reject(n.toString()),console.error(n)):(console.debug("Opening animation: load complete = "+e),t.resolve())}.bind(this)),t.promise},__loadOpeningAnimationData:function(e,t,n){var i=ccs.load(res["raidevent-ra_001_first_animation-ra_001_first_ani"]),o=i.node,r=i.action;o.runAction(r);var s=e.seekWidgetByName("ra_001_first_ani");return null==s?(console.error("raidevent.OpeningAnimation __loadOpeningAnimationData targetNode is null"),a.reject()):(s.setVisible(!0),s.addChild(o),n.then(function(){var e=o.seekWidgetByName("raidani-bg_event");null!==e&&e.setTexture(this._preLoadList.raidEvent_bgImage),console.debug("__loadOpeningAnimationData backGround loading.")}.bind(this)),i)},_initPlayer:function(){t.createInstance("soundPlayer").init(t.createInstance("playerGameConfig"))},__startOpeningAnimationData:function(e,n,i){var o=n.node,r=n.action;this.__setVariableTextures(o),this._initPlayer();var s=t.createInstance("AnimationEventHandlerCcs_2_0").init(r),c=(t.createInstance("Sound2Event",[s]),r.getDuration());r.gotoFrameAndPlay(0,c,!1);var u=a.defer();return s.addAnimationEventCallback("animation_e",function(){console.debug("animation end!"),this.__finalizeAnimation(e,i,u)},this),u.promise},__finalizeAnimation:function(e,n,a){t.Img("raid-bg001","event",i.padZero(n,4)).jpg,this._setBackgroundImage(e,n).done(function(){this.__disposeOpeningAnimationCore(e),a.resolve()}.bind(this))},__disposeOpeningAnimationCore:function(e){var t=e.seekWidgetByName("ra_001_first_ani");t.setVisible(!1),t.removeAllChildren()},_disposeOpeningAnimation:function(e,n){return t.Img("raid-bg001","event",i.padZero(n,4)).jpg,this._setBackgroundImage(e,n).then(function(){this.__disposeOpeningAnimationCore(e)}.bind(this))},__setVariableTextures:function(e){i.each(i.range(4),function(t){var n=e.seekWidgetByPath("raidani-chara_panel_"+t+"..raidani-chara_event");null!==n&&n.setTexture(this._preLoadList.raidEvent_charaImage)},this)}}}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;e.Q,t.pc.raidevent=t.pc.raidevent||{},t.pc.raidevent.roles=t.pc.raidevent.roles||{},t.pc.raidevent.roles.Routing={_verifyRouterParams000:function(e){i.isUndefined(e.routerParams.ra_000)&&(e.routerParams.ra_000={},e.routerParams.ra_000.event_id=2001,this._consoleErrorRouterParams("routerParams.ra_000, .event_id"))},_verifyRouterParams001:function(e){i.isUndefined(e.routerParams.ra_001)&&(e.routerParams.ra_001={},e.routerParams.ra_001.event_id=2002,this._consoleErrorRouterParams("routerParams.ra_001, .event_id"))},_navigate001ToScenario:function(e,n,i,a){a=a||!1,t.createInstance("router").navigate("scenario/episode-play",{"scenario/play":{episode_id:i,returnBackParams:{scene:"raidevent/ra_001",routerParams:{ra_001:{event_id:n}},temporaryRouterParams:{play_animation:a}}}})},_navigate001ToNo012:function(e,n){t.createInstance("router").navigate("note/no_012",{no_012:{event_type:"raidevent",event_id:n}},{navigationFrom:"raidevent/ra_001",returnParams:{ra_001:{event_id:n}}})},_navigate001ToQ006:function(e,n){t.createInstance("router").navigate("quest/q_006",{routing_quest_type:"raidevent",routing_event_id:n})},_navigate001To002:function(e,n){t.createInstance("router").navigate("raidevent/ra_002",{ra_002:{event_id:n}})},_navigate001To003:function(e,n){t.createInstance("router").navigate("raidevent/ra_003",{ra_003:{event_id:n,from:"ra_001"}})},_navigate001To004:function(e,n){t.createInstance("router").navigate("raidevent/ra_004",{ra_004:{event_id:n,from:"ra_001"}})},_verifyRouterParams002:function(e){i.isUndefined(e.routerParams.ra_002)&&i.isUndefined(e.routerParams.event_id)&&(e.routerParams.ra_002={},e.routerParams.ra_002.event_id=2002,this._consoleErrorRouterParams("routerParams.ra_002, .event_id"))},_navigate002ToQ002:function(e,n,a,o){return i.isUndefined(n)||i.isUndefined(n.a_quest_id)||i.isUndefined(n.type)?void this._consoleErrorRoutingAbort("record.a_quest_id"):void t.createInstance("router").navigate("quest/q_002",{q_002:{target:"quest",quest_id:n.quest_id,owner_account_id:n.owner_account_id,quest_type:n.type,episode_num:a,recommended_element_type:o}})},_navigate002ToQ009:function(e,n,a,o){return i.isUndefined(n)||i.isUndefined(n.a_quest_id)||i.isUndefined(n.type)?void this._consoleErrorRoutingAbort("record.a_quest_id"):void t.createInstance("router").navigate("quest/q_009",{q_009:{target:"quest",quest_id:n.quest_id,owner_account_id:n.owner_account_id,event_id:o,quest_type:n.type,recommended_element_type:a,returnQuestRoute:"raidevent/ra_002"}})},_verifyRouterParams003:function(e){i.isUndefined(e.routerParams.ra_003)&&(e.routerParams.ra_003={},e.routerParams.ra_003.event_id=2002,this._consoleErrorRouterParams("routerParams.ra_003, .event_id"))},navigateRa003ToPrs001:function(e){t.createInstance("router").navigate("present/prs_001",{},{prs_001_002_003:{returnRoute:"raidevent/ra_003",eventId:e}})},_verifyRouterParams004:function(e){i.isUndefined(e.routerParams.ra_004)&&(e.routerParams.ra_004={},e.routerParams.ra_004.event_id=2002,this._consoleErrorRouterParams("routerParams.ra_004, .event_id"))},__determineFromParamFromRa004RouterParams:function(){return(n.director.getRunningScene().routerParams.ra_004||{}).from||"ra_001"},_navigate004_005ToGaAni:function(e,n,i){var a=this.__determineFromParamFromRa004RouterParams();t.createInstance("router").navigate("gacha/ga_ani",{ga_ani:{data:e,gacha_id:i,event_id:n,category:"event"}},{result_to:{navigate:"raidevent/ra_005",params:{ra_005:{event_id:n,from:a}}}})},_navigate004_005To005:function(e,n,i){var a=this.__determineFromParamFromRa004RouterParams();t.createInstance("router").navigate("raidevent/ra_005",{ra_005:{event_id:n,from:a}},{results:e.obtained_info})},_verifyRouterParams005:function(e){i.isUndefined(e.routerParams.ra_005)&&this._consoleErrorRouterParams("routerParams.ra_005, .event_id"),i.isUndefined(e.temporaryRouterParams.results)&&this._consoleErrorRouterParams("temporaryRouterParams, .results")},_navigate005To004:function(e){var n=e.routerParams.ra_005;t.createInstance("router").navigate("raidevent/ra_004",{ra_004:{event_id:n.event_id,from:n.from}})},navigateRa005ToPrs002:function(e){t.createInstance("router").navigate("present/prs_002",{},{prs_001_002_003:{returnRoute:"raidevent/ra_004",eventId:e}})},_verifyRouterParams006:function(e){i.isUndefined(e.routerParams.ra_006)&&(e.routerParams.ra_006={},e.routerParams.ra_006.event_id=2003,this._consoleErrorRouterParams("routerParams.ra_006, .event_id"))},_navigate006To003:function(e,n){t.createInstance("router").navigate("raidevent/ra_003",{ra_003:{event_id:n,from:"ra_006"}})},_navigate006To004:function(e,n){t.createInstance("router").navigate("raidevent/ra_004",{ra_004:{event_id:n,from:"ra_006"}})},_navigate002_003_004_005ToEventTop:function(e){var n=t.createInstance("router"),a=n.getCurrentFragment(),o=a.replace(/^raidevent\//,""),r=e.routerParams[o];if(i.isUndefined(r))return console.error("Unknown navigation from:"+a+" to 'Raid event Top'.");var s=r.from,c=t.createInstance("raidEvent");if(!s&&c.isPrepared()&&(s="raid_event_receive_reward"===c.getRaidEventType()?"ra_006":"ra_001"),s){var u={};u[s]={event_id:r.event_id},n.navigate("raidevent/"+s,u)}else c.prepare().then(function(){var e={};e[s="raid_event_receive_reward"===c.getRaidEventType()?"ra_006":"ra_001"]={event_id:r.event_id},n.navigate("raidevent/"+s,e)})},navigateToRa001:function(e){t.createInstance("router").navigate("raidevent/ra_001",{ra_001:{event_id:e}})},navigateToRa004:function(e){t.createInstance("router").navigate("raidevent/ra_004",{ra_004:{event_id:e}})},navigateToRa006:function(e){t.createInstance("router").navigate("raidevent/ra_006",{ra_006:{event_id:e}})}},i.assign(t.pc.raidevent.roles.Routing,t.pc.roles.RoutingCommon)}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.pc.raidevent=n.pc.raidevent||{},n.pc.raidevent.ObjectRecordMapper=cc.Class.extend({convertArray:function(e,i){var a=[];return t.each(e,function(e){a.push(n.createInstance(i,[e]))},this),a}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.pc.raidevent=n.pc.raidevent||{},n.pc.raidevent.model=n.pc.raidevent.model||{},n.pc.raidevent.model.RaidEvent=cc.Class.extend({_apiSettings:{notice:{get:{event:{module:"apiEvents",method:"getRaidEventNotice",args:[]},a_event:{module:"apiAEvents",method:"getRaidEventNotice",args:[]}},put:{first_access:{module:"apiAEvents",method:"notifyRaidEventNoticeFirstAccess",args:[]}}},in_session:{get:{event:{module:"apiEvents",method:"getRaidEvent",args:[]},a_event:{module:"apiAEvents",method:"getRaidEvent",args:[]}},put:{first_access:{module:"apiAEvents",method:"notifyRaidEventFirstAccess",args:[]}}},finale:{get:{event:{module:"apiEvents",method:"getRaidEvent",args:[]},a_event:{module:"apiAEvents",method:"getRaidEvent",args:[]}},put:{first_access:{module:"apiAEvents",method:"notifyRaidEventFirstAccess",args:[]}}}},prepare:function(e,n){return this.event_id!==e||t.isEmpty(this._data)?(this.event_id=e,this.update(n)):this._promise},update:function(e){this._data={},this.phase=e||"in_session";var t=this._apiSettings[this.phase].get,n=Q.defer();return this._promise=n.promise,this._request(t.event,"event").then(function(e){return this._navigateIsFinished(e)?n.reject(!1):this._request(t.a_event,"a_event")}.bind(this)).then(function(){n.resolve()}).fail(function(e){e&&(console.error(e),n.reject())}),this._promise},promise:function(){return this._promise||window.alert("You must call prepare first!"),this._promise},_request:function(e,t){var i=Q.defer(),a=n.createInstance(e.module),o=[this.event_id].concat(e.args);return a[e.method].apply(a,o).then(function(e){var n=e.body;this._data[t]=n,i.resolve(n)}.bind(this)).fail(function(e){i.reject(e)}.bind(this)),i.promise},_navigateIsFinished:function(e){if(t.isUndefined(e.basic_info)||!0!==e.basic_info.is_finished)return!1;var i=e.ref_event_id,a=e.event_type;if(!t.isString(a)||!t.isNumber(i))return!1;var o=null;switch(a){case"raid_event":o="ra_006";break;case"raid_event_notice":o="ra_001";break;default:return!1}delete this._data;var r={};return r[o]={event_id:i},n.createInstance("router").navigate("raidevent/"+o,r),!0},getTitle:function(){return t.isEmpty(this._data)&&window.alert("You must call prepare first!"),this._data.event.basic_info.title},isFirstAccess:function(){return t.isEmpty(this._data)&&window.alert("You must call prepare first!"),!(!t.isUndefined(this._data.first_access)&&this._data.first_access.result)&&(this._data.a_event.first_access||!1)},emergedSuddenQuest:function(){return t.isEmpty(this._data)&&window.alert("You must call prepare first!"),this._data.a_event.sudden_quest_have_emerged||!1},getRaidEventTickets:function(){t.isEmpty(this._data)&&window.alert("You must call prepare first!");var e=this._data.a_event.event_tickets||[];return n.createInstance("orm").convertArray(e,"RaidEventTicket")},getRaidEventCertificates:function(){t.isEmpty(this._data)&&window.alert("You must call prepare first!");var e=this._data.a_event.event_certificates||[];return n.createInstance("orm").convertArray(e,"RaidEventCertificate")},getRaidEventTreasures:function(){t.isEmpty(this._data)&&window.alert("You must call prepare first!");var e=this._data.a_event.event_treasures||[];return n.createInstance("orm").convertArray(e,"RaidEventTreasure")},getAchievementPoint:function(){return t.isEmpty(this._data)&&window.alert("You must call prepare first!"),this._data.a_event.total_contribution_points||0},getEventDate:function(){return t.isEmpty(this._data)&&window.alert("You must call prepare first!"),this._data.a_event.event_date||""},getIntroEpisodeId:function(){return t.isEmpty(this._data)&&window.alert("You must call prepare first!"),this._data.event.introduction_episode_id},getMainEventId:function(){return t.isEmpty(this._data)&&window.alert("You must call prepare first!"),"raid_event"===this._data.event.event_type?this.event_id:this._data.event.ref_event_id},hasNewRewards:function(e){t.isEmpty(this._data)&&window.alert("You must call prepare first!"),e=e||"ANY";var n=this._data.a_event.exchangeable_rewards||[];return"ANY"===e?!t.isEmpty(n):-1!==n.indexOf(e)},hasGachaTickets:function(){return t.reduce(this.getRaidEventTickets(),function(e,t){return e+t.getAmount()},0)>0},getRewardReceiptDeadline:function(){return t.isEmpty(this._data)&&window.alert("You must call prepare first!"),this._data.a_event.reward_receipt_deadline||""},getUnlockedQuest:function(){return t.isEmpty(this._data)&&window.alert("You must call prepare first!"),this._data.a_event.unlocked_quests||[]},markUnlockedQuestConfirmed:function(e){return n.createInstance("apiAEvents").markRaidEventNewQuestConfirmed(this.event_id,e.quest_id).then(function(){var e=this._apiSettings[this.phase].get,t="a_event";return this._request(e[t],t)}.bind(this))},getSubTutorialPages:function(){return t.isEmpty(this._data)&&window.alert("You must call prepare first!"),this._data.event.description_images||[]},notifyFirstAccess:function(){t.isUndefined(this.phase)&&window.alert("You must call prepare first!");var e=this._apiSettings[this.phase].put.first_access;return this._request(e)},getRaidEventType:function(){return t.isUndefined(this._data)&&window.warn("You must call prepare first!"),this._data.event.event_type},isPrepared:function(){return!t.isUndefined(this._data)}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.pc.raidevent=n.pc.raidevent||{},n.pc.raidevent.model=n.pc.raidevent.model||{},n.pc.raidevent.model.RaidEventItem=cc.Class.extend({ctor:function(e){t.assign(this,e)},getId:function(){return this.item_id},getName:function(){return this.name},getAmount:function(){return this.amount}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.pc.raidevent=n.pc.raidevent||{},n.pc.raidevent.model=n.pc.raidevent.model||{},n.pc.raidevent.model.EventGachaCategories=cc.Class.extend({prepare:function(e){return this.event_id!==e||t.isEmpty(this._data)?(this.event_id=e,this.update()):this._promise},update:function(){var e=n.createInstance("apiAGachaCategories");return this._promise=e.getEventGachaCategories(this.event_id).then(function(e){var t=n.createInstance("orm"),i=e.body;this._data=t.convertArray(i.data,"EventGachaCategory")}.bind(this)),this._promise},promise:function(){return this._promise},getAt:function(e){return t.isEmpty(this._data)&&window.alert("You must call prepare first!"),this._data[e]}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.pc.raidevent=t.pc.raidevent||{},t.pc.raidevent.model=t.pc.raidevent.model||{},t.pc.raidevent.model.EventGachaCategory=cc.Class.extend({ctor:function(e){this._record=e;var n=t.createInstance("orm");this._gachas=n.convertArray(this._record.groups,"EventGacha")},getCategoryId:function(){return this._record.category_id},getName:function(){return this._record.title},getContentsAsync:function(){return t.createInstance("apiGachaCategories").getGachaContentsSummary(this.getCategoryId()).then(function(e){var n=t.createInstance("orm"),i=e.body.appearance_data,a=n.convertArray(i.ssr||[],"GachaContentsItem"),o=n.convertArray(i.sr||[],"GachaContentsItem"),r=n.convertArray(i.r||[],"GachaContentsItem"),s=n.convertArray(i.n||[],"GachaContentsItem");return this._contents=a.concat(o).concat(r).concat(s),this._contents}.bind(this))},getGachas:function(){return this._gachas}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.pc.raidevent=t.pc.raidevent||{},t.pc.raidevent.model=t.pc.raidevent.model||{},t.pc.raidevent.model.EventGacha=cc.Class.extend({ctor:function(e){this._record=e},getGachaId:function(){return this._record.gacha_id},getGachaCount:function(){return this._record.gacha_count},play:function(){var e=this.getGachaId();return t.createInstance("apiAGacha").playGacha("event",e)}}),t.assignRoles(t.pc.raidevent.model.EventGacha,[t.pc.raidevent.roles.Routing])}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.pc.raidevent=n.pc.raidevent||{},n.pc.raidevent.model=n.pc.raidevent.model||{},n.pc.raidevent.model.GachaContentsItem=n.SceneObject.extend({ctor:function(e){t.assign(this,e)}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.pc.raidevent=n.pc.raidevent||{},n.pc.raidevent.view=n.pc.raidevent.view||{},n.pc.raidevent.view.EventItemStockPanel=n.SceneObject.extend({ctor:function(e){if(t.isUndefined(e)||!t.isObject(e.parent_node)||!t.isString(e.item_holder_prefix)||!t.isString(e.item_holder_prefix)){var n="Invalid argument in kh.pc.raidevent.view.EventItemStockPanel";alert(n),console.debug(n,e)}this.params=e},_getParentNode:function(){return this.params.parent_node},_getItemHolderPrefix:function(){return this.params.item_holder_prefix},setup:function(e){!t.isEmpty(e)&&this.hasHolders()&&this._setupHolders(e)},hasHolders:function(){var e=this._getItemHolderPrefix();if(!e)return!1;var t=this._getParentNode();if(!t)return!1;var n=e+"0";return null!==t.seekWidgetByName(n)},_setupHolders:function(e){t.each(e,function(e,t){var n=this._getHolderNodeByIndex(t);this._setupHolder(n,e)},this)},_getHolderNodeByIndex:function(e){var t=this._getParentNode(),n=this._getItemHolderPrefix()+e;return t.seekWidgetByName(n)},_setupHolder:function(e,n){null===e||t.isEmpty(n)||(e.setStrings({name_label:n.getName(),have_label:n.getAmount().toString()}),this._setItemCoreCard(e,n,this.params.corecard_ui_name),e.setVisible(!0))},_onDispose:function(){this.params&&(n.cleanupProperties(this.params),delete this.params)}}),n.assignRoles(n.pc.raidevent.view.EventItemStockPanel,[n.pc.roles.CoreCardCommon])}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.pc.raidevent=n.pc.raidevent||{},n.pc.raidevent.view=n.pc.raidevent.view||{},n.pc.raidevent.view.GachaPlayButton=n.SceneObject.extend({ctor:function(e,t,i){this._nodeName=t,this._gacha=i;var a=e.seekWidgetByName(t);if(null!==a){this._btnNode=a,this.__setGachaButtonImage(a,0,i.getGachaCount());var o={};o["TOUCH_ENDED "+t]=this._onButtonTapped,n.setTouchEventHandlers(e,o,this)}},_getGachaModel:function(){return this._gacha},_getButtonNode:function(){return this._btnNode},_onButtonTapped:function(){this._getGachaModel().play().then(function(e){var t=cc.director.getRunningScene(),i=t._delegate,a=this._getGachaModel().getGachaId(),o=i._getEventIdFromRouterParams(t),r=i.skipButtonView.getSkipStatus();(console.debug("",o,a,r),r)?n.createInstance("eventGachaCategories").update().then(function(){i._navigate004_005To005(e.body,o,a)}.bind(this)):i._navigate004_005ToGaAni(e.body,o,a)}.bind(this)).fail(function(e){console.error(e.stack)})},__setGachaButtonImage:function(e,n,i){var a="res/ra_gacha-btn/gacha-btn",o=a+"1_"+n+"_"+t.padZero(i,2)+".png",r=a+"2_"+n+"_"+t.padZero(i,2)+".png";e.loadTextures(o,r,o)}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.pc.raidevent=t.pc.raidevent||{},t.pc.raidevent.view=t.pc.raidevent.view||{},t.pc.raidevent.view.GachaSkipButton=t.SceneObject.extend({ctor:function(e,n){this._nodeName=n;var i=e.seekWidgetByName(n);if(null!==i){this._btnNode=i,this.setSkipStatus(t.createInstance("playerGameConfig").isGachaAnimationSkip());var a={};a["TOUCH_ENDED "+n]=this._onButtonTapped,t.setTouchEventHandlers(e,a,this)}},_getButtonNode:function(){return this._btnNode},_onButtonTapped:function(){var e=this.getSkipStatus(),n=t.createInstance("playerGameConfig");n.setGachaAnimationSkipFlag(!e),n.updateGameConfig().then(this._applyGameConfig.bind(this,n))},_applyGameConfig:function(e){this.setSkipStatus(e.isGachaAnimationSkip())},getSkipStatus:function(){return this._getButtonNode().isBright()},setSkipStatus:function(e){this._getButtonNode().setBright(e)}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.pc.raidevent=t.pc.raidevent||{},t.pc.raidevent.view=t.pc.raidevent.view||{},t.pc.raidevent.view.AttentionButton=t.SceneObject.extend({ctor:function(e,t){this._nodeName=t;var n=e.seekWidgetByName(t);null!==n&&(this._mainNode=n,this._iconNode=n.seekWidgetByName("info_icon"))},_getMainNodeName:function(){return this._nodeName},_getMainNode:function(){return this._mainNode},_getIconNode:function(){return this._iconNode},setAttentionView:function(e){var t=this._getIconNode();null!==t?t.setVisible(e):console.warn("'info_icon' node is not found under '"+this._getMainNodeName()+"'.")}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.pc.raidevent=n.pc.raidevent||{},n.pc.raidevent.view=n.pc.raidevent.view||{},n.pc.raidevent.view.QuestButton=n.pc.raidevent.view.AttentionButton.extend({setAttentionView:function(e){var n=this._getMainNode();if(t.isUndefined(n))console.warn("'"+this._getMainNodeName()+"' node is not found.");else{var i=e?"attention_view":"defalut_view";n.animate(i)}}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.createNameSpaceIfNotExists("pc.view"),t.pc.view.ComOpenEpisodePopup=t.ImplantedPopup.extend({_initContents:function(e,t){this.setButtonEvents({btn_popup_close:!0});var n=this.getNode();this._setCorecard(n,e),this._setJoinedMessage(n,e.name)},_setCorecard:function(e,t){this._setProperCoreCardElementRarity(e,t,"core_img")},_setJoinedMessage:function(e,t){var n=e.seekWidgetByName("harlem_release_label");null!==n&&(n.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_CENTER),n.setString(t+"\r\n"))}}),t.assignRoles(t.pc.view.ComOpenEpisodePopup,[t.pc.roles.CoreCardCommon])}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.pc.raidevent=t.pc.raidevent||{},t.pc.raidevent.view=t.pc.raidevent.view||{},t.pc.raidevent.view.Q001ApOpenPopup=t.ImplantedPopup.extend({_initContents:function(e){this.setButtonEvents({btn_popup_close:!0}),this.getNode().setStrings({fixed_label_0:"",name_label:""+e+"",fixed_label_1:t.w("release")+"!"})}})}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.raidevent=t.pc.raidevent||{},t.pc.raidevent.ra_000=t.pc.raidevent.ra_000||{},t.pc.raidevent.ra_000.Scene=t.BaseScene.extend({resourceFileName:"ra_000/ra_000.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"raidevent",sceneName:"ra_000",_delegate:null,_init:function(){this._initScene("page_in")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._,e.Q);t.pc=t.pc||{},t.pc.raidevent=t.pc.raidevent||{},t.pc.raidevent.ra_000=t.pc.raidevent.ra_000||{},t.pc.raidevent.ra_000.SceneDelegate=t.pc.BaseSceneDelegate.extend({_popups:{},onSceneInit:function(e){n.defer(),this._verifyRouterParams000(e);var i=this._getEventIdFromRouterParams(e);this._setBackgroundImage(e,i);var a=t.createInstance("raidEvent");return a.prepare(i,"notice").then(function(){this._setEventPeriodStr(e,a)}.bind(this)),this._setBackBtn(e),n.resolve()},onSceneEnter:function(e){return n.defer(),n.resolve()},onSceneExit:function(e){return n.defer(),n.resolve()},onPageInAnimationEnd:function(e){var i=(n.defer(),t.createInstance("raidEvent"));return i.promise().then(function(){return i.notifyFirstAccess()}).then(function(e){!0!==e.result&&console.warn("ra_000:")}),n.resolve()},_touchEndedBackBtnProcess:function(e){t.createInstance("router").navigate("mypage/my_001")}}),t.assignRoles(t.pc.raidevent.ra_000.SceneDelegate,[t.pc.roles.UIUtility,t.pc.raidevent.roles.Routing,t.pc.raidevent.roles.RaidEventCommon])}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.raidevent=t.pc.raidevent||{},t.pc.raidevent.ra_001=t.pc.raidevent.ra_001||{},t.pc.raidevent.ra_001.Scene=t.BaseScene.extend({resourceFileName:"ra_001/ra_001.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"raidevent",sceneName:"ra_001",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_interchange","btnCallbackBtnInterchange",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"raidevent/ra_003")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_event_gacya","btnCallbackBtnEventGacya",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"raidevent/ra_004")),this._initButtonEvent.call(this,this.seekWidgetByPath("ra_btn_ev-quest_ui"),"btn_sp_quest","btnCallbackRaBtnEvQuestUiBtnSpQuest",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"raidevent/ra_002")),this._initButtonEvent.call(this,this.seekWidgetByPath("ra_btn_ev-quest_ui"),"btn_ragnarok","btnCallbackRaBtnEvQuestUiBtnRagnarok",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"raidevent/ra_002")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_raid_02","btnCallbackBtnRaid02",null,function(){alert("{{q_006_7_8 tab_0(q_006)}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_raid_01","btnCallbackBtnRaid01",null,function(){alert("{{q_006_7_8 tab_0(q_006)}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_explain","btnCallbackBtnExplain",null,function(){alert("{{}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_story","btnCallbackBtnStory",null,function(){alert("{{no_012}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._,e.Q);t.pc=t.pc||{},t.pc.raidevent=t.pc.raidevent||{},t.pc.raidevent.ra_001=t.pc.raidevent.ra_001||{},t.pc.raidevent.ra_001.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../ra_popup_ui.json"],_popups:{},_isPlayAnimation:function(e){var n=t.createInstance("raidEvent"),i=n.getIntroEpisodeId();return e.temporaryRouterParams.play_animation||n.isFirstAccess()&&null==i},onSceneEnter:function(e){var i=t.createInstance("raidEvent"),a=this._getEventIdFromRouterParams(e);this._setBackgroundImage(e,a);var o=t.createInstance("aQuestInfo").get();return o.isFulfilled()&&(o=t.createInstance("aQuestInfo").getRaid()),n.all([o,i.prepare(a,"in_session")])},onSceneInit:function(e){this._clearHeaderTitleStr(e),this._verifyRouterParams001(e);var i,a=this._getEventIdFromRouterParams(e),o=t.createInstance("raidEvent"),r=o.getIntroEpisodeId();if(this._isPlayAnimation(e))t.createInstance("router").removeCurrentTemporaryParamsFromHistory(),console.log("start opening animation."),i=this._initOpeningAnimation(e,a),null==r&&o.notifyFirstAccess();else if(o.isFirstAccess())return o.notifyFirstAccess().then(function(t){!0!==t.result&&console.warn("ra_001:"),this._navigate001ToScenario(e,a,r,!0)}.bind(this)),new Promise(function(){});var s=e.seekWidgetByName("raid_ui");return null!==s&&s.setVisible(!1),this._setBackBtn(e),this._setHeaderTitleStr(e,o),this._setEventPeriodStr(e,o),this._showTreasures(e,o),this._showTickets(e,o),this._showCertificates(e,o),this._setupEventTopButtons(e,o),t.createInstance("BurstTimeCountDownPanel").show(),i||n.resolve()},doPageInAnimation:function(e){var i=t.createInstance("raidEvent");return n.all([i.promise(),this._isPlayAnimation(e)?this._startOpeningAnimation(e,i.event_id):null]).then(function(){return e.setAppearance("default_view"),i.isFirstAccess()||this._isPlayAnimation(e)?this._showSubTutorial(e,i):n.resolve()}.bind(this)).then(function(){this.__setRaidBattleButtonStatus(e)}.bind(this))},btnCallbackBtnInterchange:function(e){var t=n.defer();return t.reject(this._override),this._navigate001To003(e,this._getEventIdFromRouterParams(e)),t.promise},btnCallbackBtnEventGacya:function(e){var t=n.defer();return t.reject(this._override),this._navigate001To004(e,this._getEventIdFromRouterParams(e)),t.promise},btnCallbackRaBtnEvQuestUiBtnSpQuest:function(e){var t=n.defer();return t.reject(this._override),this._navigate001To002(e,this._getEventIdFromRouterParams(e)),t.promise},btnCallbackRaBtnEvQuestUiBtnRagnarok:function(e){var t=n.defer();return t.reject(this._override),this._navigate001To002(e,this._getEventIdFromRouterParams(e)),t.promise},btnCallbackBtnRaid02:function(e){var t=n.defer();return t.reject(this._override),this._navigate001ToQ006(e,this._getEventIdFromRouterParams(e)),t.promise},btnCallbackBtnRaid01:function(e){var t=n.defer();return t.reject(this._override),this._navigate001ToQ006(e,this._getEventIdFromRouterParams(e)),t.promise},btnCallbackBtnExplain:function(e){var i=n.defer();i.reject(this._override);var a=t.createInstance("raidEvent");return a.promise().then(function(){this._showSubTutorial(e,a)}.bind(this)),i.promise},btnCallbackBtnStory:function(e){var i=n.defer();i.reject(this._override);var a=t.createInstance("raidEvent");return a.promise().then(function(){return this._navigate001ToNo012(e,a.event_id)}.bind(this)),i.promise},__setRaidBattleButtonStatus:function(e){t.createInstance("aQuestInfo").get().then(function(t){if(!e.disposed){var n=e.seekWidgetByName("raid_ui");if(null!==n){n.setVisible(!0),n.animate(t.hasNewRaidRequest()?"raid_effect_start":"default_view",t.hasNewRaidRequest());var i=n.seekWidgetByName("info_icon");null!==i&&i.setVisible(t.hasUnverified())}}}.bind(this))},_showSubTutorial:function(e,n){var i=n.event_id,a=t.createInstance("router").getCurrentFragment().replace(/^[^\/]*\//,"")+"_"+i;t.createInstance("apiASubTutorialPages").get(a).then(function(e){t.createInstance("apiASubTutorialPages").visited(a)}.bind(this)).fail(function(e){console.warn(e.stack)});var o=n.getSubTutorialPages();return t.ImplantedPopup.createOrGet(e,"sub_tutorial","ImplantedEventSubTutorialPopup").open(i,o.length)},_touchEndedBackBtnProcess:function(e){t.createInstance("router").navigate("event/ev_000")}}),t.assignRoles(t.pc.raidevent.ra_001.SceneDelegate,[t.pc.roles.UIUtility,t.pc.raidevent.roles.Routing,t.pc.raidevent.roles.RaidEventCommon,t.pc.raidevent.roles.OpeningAnimation])}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.raidevent=t.pc.raidevent||{},t.pc.raidevent.ra_002=t.pc.raidevent.ra_002||{},t.pc.raidevent.ra_002.Scene=t.BaseScene.extend({resourceFileName:"ra_002/ra_002.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"raidevent",sceneName:"ra_002",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_back_event_top","btnCallbackBtnBackEventTop",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"raidevent/ra_001")),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc=t.pc||{},t.pc.raidevent=t.pc.raidevent||{},t.pc.raidevent.ra_002=t.pc.raidevent.ra_002||{},$staticRes(res["core-popup-ra_need_item"]),$staticRes(res["core-popup-ra_need_item_list_ui"]),$staticRes(res["core-popup-ra_no_item"]),t.pc.raidevent.ra_002.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../ra_popup_ui.json"],_popups:{comBackCheck:{factoryName:"popupFactoryComBackCheck"},comApRestart:{factoryName:"popupFactoryComApRestart"},q_001_ap_next:{factoryName:"popupFactoryPopupCommon",resourceName:"core-popup-q_001_ap_next",title:"",buttonLabels:{blueBtn:"OK",blackBtn:""},buttons:{blueBtn:function(e){this.dismiss(),e._delegate.startCheckQuestState(e,this._selectQuestData)},blackBtn:function(e){this.dismiss()}}},q_001_ap_open:{factoryName:"popupFactoryBlue",title:""+t.w("release")+"!",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){this.dismiss()}}},q_newworld:{factoryName:"popupFactoryBlue",title:""+t.w("release")+"!",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){this.dismiss(),t.createInstance("router").navigate("quest/q_005")}}},q_quest_stop:{factoryName:"popupFactoryBlue",title:"",content:"<br />",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){this.dismiss()}}},ra_no_item:{factoryName:"popupFactoryPopupCommon",resourceName:"core-popup-ra_no_item",title:"",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){this.dismiss()}}},ra_need_item:{factoryName:"popupFactoryPopupCommon",resourceName:"core-popup-ra_need_item",title:"",buttonLabels:{blackBtn:"",redBtn:""},buttons:{blackBtn:function(e){this.dismiss()},redBtn:function(e){this.dismiss(),e._delegate._doDefaultQuestStartingProcess(this._selectedQuestRecord)}}}},onSceneInit:function(e){a.defer(),this.questCommonDelegate=t.createInstance("questSceneCommonDelegate"),this._verifyRouterParams002(e);var n=this._getEventIdFromRouterParams(e);this._setEventIdToApBpPopup(n),this._setHeaderMessage(e,"CLEAR");var i=t.createInstance("raidEvent");return this._showTreasures(e,i),this._setBackBtn(e),this._onDataRetrieved(e)},update:function(e){var i=t.createInstance("aQuestInfo"),o=t.createInstance("myselfInfoRepository"),r=n.director.getRunningScene(),s=r._delegate;return a.all([i.get(!1!==e),o.getQuestPoints(),o.getMe(),s._fillupEventQuestList(r,s._getEventIdFromRouterParams(r),"_questPanelTapped")]).spread(function(e,t,n){this._questInfo=e.getRawData(),this._questPoints=t.getAsObject(),this._player=n.body}.bind(s)).fail(function(e){console.error(e)})},onSceneEnter:function(e){var n=t.createInstance("raidEvent"),i=this._getEventIdFromRouterParams(e);return this._setBackgroundImage(e,i),a.all([this.update(!1),n.prepare(i,"in_session")])},onSceneExit:function(e){return a.defer(),this.questCommonDelegate=null,a.resolve()},onPageInAnimationEnd:function(e){var n=(a.defer(),t.createInstance("raidEvent"));return n.promise().then(function(){var e=n.getUnlockedQuest();return i.isEmpty(e)?a.resolve():void khutil.runSequence(e,function(e){return this.openUnlockedQuestPopupAndMarkConfirmed(n,e)}.bind(this))}.bind(this)),a.resolve()},openUnlockedQuestPopupAndMarkConfirmed:function(e,i){return e.markUnlockedQuestConfirmed(i).then(function(){var e=n.director.getRunningScene();return t.ImplantedPopup.createOrGet(e,"q_001_ap_open").open(i.name)})},btnCallbackBtnBackEventTop:function(e){var t=a.defer();return t.reject(this._override),this._navigate002_003_004_005ToEventTop(e),t.promise},_setHeaderMessage:function(e,t){var n=e.seekWidgetByName("ra_bg_shadow_label");null!==n&&n.setString(t)},_questPanelTapped:function(e,t){return this._selectQuest=t,this._doDefaultQuestStartingProcess(t)},_doDefaultQuestStartingProcess:function(e){var t=n.director.getRunningScene();this.questCommonDelegate.restartCheckInProgressQuest(e,this._questInfo)||this.startCheckQuestState(t,e)},_onDataRetrieved:function(e){e===n.director.getRunningScene()&&(this.questCommonDelegate.owner=e,this.questCommonDelegate.checkComApRestartPopup(this._questInfo))},startQuest:function(e,t,n,i){if("event_raid"===this._selectQuest.type){var a=this._getEventIdFromRouterParams(e);this._navigate002ToQ009(e,t,i,a)}else this._startStoryQuest(e,t.a_quest_id,t.quest_id,n,i)},_startStoryQuest:function(e,t,n,a,o){this._targetParam={a_quest_id:t,quest_id:n,quest_type:"event_main"};this.selectedEpisode={num:a},this._isLatestEpisode=!i.isUndefined(a),this._startQuest(e,0,{summon_info:{a_summon_id:0}})},_setEventIdToApBpPopup:function(e){t.createInstance("popupFactoryComNeedApBp2").setEventId(e)},fillupQuestPanel:function(e,t){var n=t.getRawQuest();this._initFuncRaidPanel(e,n)},_touchEndedBackBtnProcess:function(e){var t=this._getEventIdFromRouterParams(e);this.navigateToRa001(t)}}),i.assign(t.pc.raidevent.ra_002.SceneDelegate.prototype._popups,t.pc.quest.roles.QuestSelectCommon.popups._popups),t.assignRoles(t.pc.raidevent.ra_002.SceneDelegate,[t.pc.quest.roles.QuestMainPageListController,t.pc.roles.UIUtility,t.pc.raidevent.roles.Routing,t.pc.raidevent.roles.RaidEventCommon,t.pc.quest.roles.QuestSelectCommon.methods,t.pc.quest.roles.QuestStart,t.pc.raidevent.roles.EventQuestPageListController])}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.raidevent=t.pc.raidevent||{},t.pc.raidevent.ra_003=t.pc.raidevent.ra_003||{},t.pc.raidevent.ra_003.Scene=t.BaseScene.extend({resourceFileName:"ra_003/ra_003.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[{tab1:{node:"tab_0","content-node":"tab_0_node"},tab2:{node:"tab_1","content-node":"tab_1_node"},tab3:{node:"tab_2","content-node":"tab_2_node"}}],componentName:"raidevent",sceneName:"ra_003",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_back_event_top","btnCallbackBtnBackEventTop",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"raidevent/ra_001")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_present","btnCallbackBtnPresent",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"present/prs_001")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_receive","btnCallbackBtnReceive",null,function(){alert("{{prs_receive_result}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc=t.pc||{},t.pc.raidevent=t.pc.raidevent||{},t.pc.raidevent.ra_003=t.pc.raidevent.ra_003||{},$staticRes(res["core-popup-com_new_member"]),t.pc.raidevent.ra_003.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../ra_popup_ui.json"],_popups:{comNewMember:{factoryName:"popupFactoryPopupCommon",resourceName:"core-popup-com_new_member",title:"",buttonLabels:{blackBtn:""},buttons:{blackBtn:function(e){this.dismiss()}}}},_tabToRequiredItemTable:[{tabIndex:0,baseNodeName:"tab_0_node",itemName:"event_certificate_1"},{tabIndex:1,baseNodeName:"tab_1_node",itemName:"event_certificate_2"},{tabIndex:2,baseNodeName:"tab_2_node",itemName:"total_contribution_point"}],onSceneInit:function(e){return this._raidEventPreparePromise.then(function(){var n=t.createInstance("raidEvent");return this._setRewardReceptDeadlineStr(e,n),this._showCertificates(e,n),this._toggleNotifyIconOfTabs(e,n),this._rewardPageListController=[],e.restoreParams?void e.restore(e.getRestoreParams()):void e.tabDelegateList[0].selectTab(e.seekWidgetByName("tab_0"))}.bind(this)),this._raidEventPreparePromise=null,this._setBackBtn(e),a.resolve()},onSceneEnter:function(e){e.tabDelegateList.forEach(function(e){e.preventInitialization()}),this.event_id=this._getEventIdFromRouterParams(e),this._verifyRouterParams003(e);var n=t.createInstance("raidEvent");return this._raidEventPreparePromise=n.prepare(this.event_id,"in_session"),this._setBackgroundImage(e,this.event_id),a.resolve()},tabCallbackTab0:function(e){this._currentType=i.find(this._tabToRequiredItemTable,{tabIndex:0}).itemName,this._updateReceiveAllButton(e),this._fillupRewardsList(e,this._getEventIdFromRouterParams(e),0)},tabCallbackTab1:function(e){this._currentType=i.find(this._tabToRequiredItemTable,{tabIndex:1}).itemName,this._updateReceiveAllButton(e),this._fillupRewardsList(e,this._getEventIdFromRouterParams(e),1)},tabCallbackTab2:function(e){this._currentType=i.find(this._tabToRequiredItemTable,{tabIndex:2}).itemName,this._updateReceiveAllButton(e),this._fillupRewardsList(e,this._getEventIdFromRouterParams(e),2)},_updateReceiveAllButton:function(e){var a=e.seekWidgetByName("btn_receive");if(null!==a&&!i.isUndefined(this._currentType)){var o=t.createInstance("raidEvent");o.promise().then(function(){var e=o.hasNewRewards(this._currentType);a.setEnabled(e),a.setColor(e?n.color.WHITE:n.color("#808080"))}.bind(this))}},btnCallbackBtnBackEventTop:function(e){var t=a.defer();return t.reject(this._override),this._navigate002_003_004_005ToEventTop(e),t.promise},btnCallbackBtnPresent:function(e){return this.navigateRa003ToPrs001(e.routerParams.ra_003.event_id),a.reject(this._override)},btnCallbackBtnReceive:function(e){return this._receiveAllPresent(),a.reject(this._override)},_toggleNotifyIconOfTabs:function(e,t){i.each(this._tabToRequiredItemTable,function(n){var i=e.seekWidgetByName("icon_"+n.tabIndex);null!==i&&i.setVisible(t.hasNewRewards(n.itemName))},this)},_receiveAllPresent:function(){t.createInstance("apiAEvents").receiveAllRaidEventRewards(this.event_id,this._currentType).then(function(e){var t=e.body;this.refreshPage();this._receiveAllPresentShowResult(t.received_info,t.not_received_info,"\r\n").then(function(){var e=t.new_character_gained_list;i.isEmpty(e)||this._showNewMemberPopup(e)}.bind(this))}.bind(this)).fail(function(e){console.error(e.stack)})},_showNewMemberPopup:function(e){if(i.isArray(e))var a=e.shift();else{a=e;e=[]}var o=n.director.getRunningScene().popups.comNewMember;o.open().then(function(n){this._setCharacterCoreCardElementRarity(o,a,"corecard_chara_ui");var i=o.seekWidgetByName("party_join_label");null!==i&&i.setString(a.name+"\n"),t.setTouchEventHandlers(o,{"TOUCH_ENDED black_btn":function(){o.dismiss(),e.length>0&&this._showNewMemberPopup(e)}.bind(this)},this)}.bind(this)).fail(function(e){e&&console.error(e)})},_fillupRewardsList:function(e,n,a){if(this._rewardPageListController){if(this._rewardPageListController[a])return void this._rewardPageListController[a].refresh();var o=i.find(this._tabToRequiredItemTable,{tabIndex:a}),r=new t.raidevent.settings.EventRewardPageListSetting(o.baseNodeName,n,o.itemName),s=new t.raidevent.eventHandling.ReceiveConfirmedEventHandler(n),c=new t.core.reward.RewardPageListController(r,s);c.displayRewards(),this._rewardPageListController[a]=c}},refreshPage:function(){var e=n.director.getRunningScene();t.createInstance("notificationCenter").dispatchEvent(t.core.pager.controller.PagerController.prototype.REFRESH_EVENT,[]);var i=t.createInstance("raidEvent");i.update().then(function(){this._toggleNotifyIconOfTabs(e,i),this._updateReceiveAllButton(e)}.bind(this))},_touchEndedBackBtnProcess:function(e){var n=t.createInstance("raidEvent").getRaidEventType(),i=this._getEventIdFromRouterParams(e);switch(n){case"raid_event_receive_reward":this.navigateToRa006(i);break;case"raid_event":this.navigateToRa001(i)}}}),t.assignRoles(t.pc.raidevent.ra_003.SceneDelegate,[t.pc.roles.UIUtility,t.pc.raidevent.roles.Routing,t.pc.raidevent.roles.RaidEventCommon,t.pc.roles.CoreCardCommon,t.pc.roles.ShInfoPopupInvoker,t.pc.present.roles.PresentPopups])}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.raidevent=t.pc.raidevent||{},t.pc.raidevent.ra_004=t.pc.raidevent.ra_004||{},t.pc.raidevent.ra_004.Scene=t.BaseScene.extend({resourceFileName:"ra_004/ra_004.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"raidevent",sceneName:"ra_004",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_back_event_top","btnCallbackBtnBackEventTop",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"raidevent/ra_001")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_skip","btnCallbackBtnSkip",null,function(){alert("{{}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._),i=e.Q;t.pc=t.pc||{},t.pc.raidevent=t.pc.raidevent||{},t.pc.raidevent.ra_004=t.pc.raidevent.ra_004||{},t.pc.raidevent.ra_004.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../ra_popup_ui.json"],_popups:{},onSceneInit:function(e){var n=this._getEventIdFromRouterParams(e);this._initGachaButtons(e,n).then(function(t){this._setGachaSliderImage(e,n,t)}.bind(this));var a=t.createInstance("raidEvent");return this._setRewardReceptDeadlineStr(e,a),this._setTicketAmountStrWithIndex(e,a,0),this._setBackBtn(e),i.resolve()},onSceneEnter:function(e){var n=this._getEventIdFromRouterParams(e);return this._setBackgroundImage(e,n),this._verifyRouterParams004(e),t.createInstance("raidEvent").prepare(n,"in_session")},onPageInAnimationEnd:function(e){var n=(i.defer(),t.createInstance("raidEvent"));return n.promise().then(function(){var t=this._getGachaButtonAnimationNode(e);t&&this._animateGachaButtonsAccordingToTicketsAmount(t,n,0)}.bind(this)),i.resolve()},_getGachaButtonAnimationNode:function(e){if(null!=e)return e.seekWidgetByName("ra_004_gacha-slider_ui")},btnCallbackBtnBackEventTop:function(e){var t=i.defer();return t.reject(this._override),this._navigate002_003_004_005ToEventTop(e),t.promise},btnCallbackBtnSkip:function(e){var t=i.defer();return t.reject(this._override),t.promise},_setGachaSliderImage:function(e,i,a){n.each(n.range(2),function(o){var r=a.getAt(o),s="raid-gacha-slider"+o,c=e.seekWidgetByName(s);if(!n.isEmpty(r)&&null!==c){var u=t.Img(s,"event",n.padZero(i,4)).jpg;c.loadTexture(u)}},this)},_touchEndedBackBtnProcess:function(e){var n=t.createInstance("raidEvent").getRaidEventType(),i=this._getEventIdFromRouterParams(e);switch(n){case"raid_event_receive_reward":this.navigateToRa006(i);break;case"raid_event":this.navigateToRa001(i)}}}),t.assignRoles(t.pc.raidevent.ra_004.SceneDelegate,[t.pc.roles.UIUtility,t.pc.raidevent.roles.Routing,t.pc.raidevent.roles.RaidEventCommon,t.pc.raidevent.roles.EventGachaCommon])}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.raidevent=t.pc.raidevent||{},t.pc.raidevent.ra_005=t.pc.raidevent.ra_005||{},t.pc.raidevent.ra_005.Scene=t.BaseScene.extend({resourceFileName:"ra_005/ra_005.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"raidevent",sceneName:"ra_005",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_back_event_top","btnCallbackBtnBackEventTop",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"raidevent/ra_001")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_skip","btnCallbackBtnSkip",null,function(){alert("{{}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_gacha_top","btnCallbackBtnGachaTop",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"raidevent/ra_004")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_present","btnCallbackBtnPresent",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"present/prs_002")),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc=t.pc||{},t.pc.raidevent=t.pc.raidevent||{},t.pc.raidevent.ra_005=t.pc.raidevent.ra_005||{},t.pc.raidevent.ra_005.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../ra_popup_ui.json"],_popups:{},onSceneInit:function(e){a.defer(),this._verifyRouterParams005(e);var n=this._getEventIdFromRouterParams(e);this._fillupResultCards(e),this._initGachaButtonsWithIndex(e,n,0);var i=t.createInstance("raidEvent");return this._setTicketAmountStrWithIndex(e,i,0),this._setItemInfo(e),this._showEpisodePopup(e),this._setBackBtn(e),a.resolve()},onSceneEnter:function(e){var n=this._getEventIdFromRouterParams(e);this._setBackgroundImage(e,n);var i=t.createInstance("raidEvent");return i.event_id==n?i.update():i.prepare(n,"in_session")},onPageInAnimationEnd:function(e){var i=(a.defer(),t.createInstance("raidEvent"));return i.promise().then(function(){this._animateGachaButtonsAccordingToTicketsAmount(e,i,0);var t=this._getTopGachaButtonNode(e);t&&t.setColor(n.color.WHITE)}.bind(this)),a.resolve()},_getTopGachaButtonNode:function(e){if(null!=e)return e.seekWidgetByName("btn_top_gacha")},btnCallbackBtnBackEventTop:function(e){var t=a.defer();return t.reject(this._override),this._navigate002_003_004_005ToEventTop(e),t.promise},btnCallbackBtnSkip:function(e){var t=a.defer();return t.reject(this._override),t.promise},btnCallbackBtnGachaTop:function(e){var t=a.defer();return t.reject(this._override),this._navigate005To004(e),t.promise},btnCallbackBtnPresent:function(e){return this.navigateRa005ToPrs002(e.routerParams.ra_005.event_id),a.reject(this._override)},_getResultsFromRouterParams:function(e){return e.temporaryRouterParams.results},_fillupResultCards:function(e){i.each(this._getResultsFromRouterParams(e),function(t,n){var a,o=e.seekWidgetByName("ra_result_corecard_ui_"+n),r=o.seekWidgetByName("corecard_ui");console.log(t),i.isUndefined(t.summon_info)?i.isUndefined(t.weapon_info)?((a=t.item_info).item_id=a.id,this._setItemCoreCard(o,a),r.seekWidgetByName("item_img").addTouchEventListener(function(e,t){t===ccui.Widget.TOUCH_ENDED&&(console.log("touch item_id="+a.id),this._openShItemInfoPopup(a.id))},this)):((a=t.weapon_info).weapon_id=a.id,this._setWeaponCoreCardElementRarity(o,a),r.seekWidgetByName("weapon_img").addTouchEventListener(function(e,t){t===ccui.Widget.TOUCH_ENDED&&(console.log("touch weapon_id="+a.id),this._openShWeaponInfoPopup(a.id))},this)):((a=t.summon_info).summon_id=a.id,this._setSummonCoreCardElementRarity(o,a),r.seekWidgetByName("summon_img").addTouchEventListener(function(e,t){t===ccui.Widget.TOUCH_ENDED&&(console.log("touch summon_id="+a.id),this._openShSummonInfoPopup(a.id))},this)),a&&o.seekWidgetByName("icon_new").setVisible(a.is_new)},this);for(var t=0;t<10;t++){e.seekWidgetByName("ra_result_corecard_ui_"+t).setVisible(!0)}},_setCoreCard:function(e,n,a,o){$staticRes(res["core-corecard_chara-corecard_chara_ui"]),$staticRes(res["core-corecard_summon-corecard_summon_ui"]),$staticRes(res["core-corecard_weapon-corecard_weapon_ui"]),e.seekWidgetByName("corecard_ui").addChild(ccs.load($dynamicRes(res["core-corecard_"+n+"-corecard_"+n+"_ui"])).node),e.seekWidgetByName(n+"_img").loadTexture(t.Img("corecard",n,i.padZero(a.id,4),0).jpg),e.seekWidgetByName("icon_new").setVisible(a.is_new),e.setVisible(!0),e.seekWidgetByName("icon_rarity").loadTexture("core/res/icon/rarityicon_"+a.rare+".png",ccui.Widget.PLIST_TEXTURE),e.seekWidgetByName("icon_element").loadTexture("core/res/icon/elementicon_"+a.element_type+".png",ccui.Widget.PLIST_TEXTURE),e.seekWidgetByName(n+"_img").addTouchEventListener(function(e,n){if(n===ccui.Widget.TOUCH_ENDED){var i={};i[o]={id:a.id,navigate:this.routerParams.ra_005.navigate,getItemNoArray:[],getItemNameArray:[]},t.createInstance("router").navigate("gacha/"+o,i)}},this)},_setItemInfo:function(e){var t="\r\n",n=!1;i.each(this._getResultsFromRouterParams(e),function(e){if(i.isUndefined(e.item_info)&&(!i.isUndefined(e.summon_info)||!i.isUndefined(e.weapon_info.character_joined_info))){var a=e.summon_info||e.weapon_info;n||!0!==a.is_new||(t+="\r\n",n=!0)}},this),ccui.helper.seekWidgetByName(e,"get_label").setString(t)},_showEpisodePopup:function(e){var n=null;(i.each(this._getResultsFromRouterParams(e),function(e){if(i.isUndefined(e.item_info)){var t=e.summon_info||e.weapon_info.character_joined_info;i.isUndefined(t)||!0!==t.is_episode_release||(n=t)}},this),null!==n)&&(n.name=n.name||n.character_name,t.ImplantedPopup.createOrGet(e,"com_open_episode").open(n))},_touchEndedBackBtnProcess:function(e){this._navigate005To004(e)}}),t.assignRoles(t.pc.raidevent.ra_005.SceneDelegate,[t.pc.roles.UIUtility,t.pc.roles.CoreCardCommon,t.pc.raidevent.roles.Routing,t.pc.raidevent.roles.RaidEventCommon,t.pc.roles.ShInfoPopupInvoker,t.pc.raidevent.roles.EventGachaCommon])}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.raidevent=t.pc.raidevent||{},t.pc.raidevent.ra_006=t.pc.raidevent.ra_006||{},t.pc.raidevent.ra_006.Scene=t.BaseScene.extend({resourceFileName:"ra_006/ra_006.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"raidevent",sceneName:"ra_006",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_interchange","btnCallbackBtnInterchange",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"raidevent/ra_003")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_event_gacya","btnCallbackBtnEventGacya",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"raidevent/ra_004")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_story","btnCallbackBtnStory",null,function(){alert("{{no_012}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._,e.Q);t.pc=t.pc||{},t.pc.raidevent=t.pc.raidevent||{},t.pc.raidevent.ra_006=t.pc.raidevent.ra_006||{},t.pc.raidevent.ra_006.SceneDelegate=t.pc.BaseSceneDelegate.extend({_popups:{},onSceneInit:function(e){n.defer(),this._verifyRouterParams006(e);var i=this._getEventIdFromRouterParams(e),a=t.createInstance("raidEvent");return this._setBackgroundImage(e,i),this._setHeaderTitleStr(e,a),this._setRewardReceptDeadlineStr(e,a),this._showTreasures(e,a),this._showTickets(e,a),this._showCertificates(e,a),this._setupEventTopButtons(e,a),this._setBackBtn(e),n.resolve()},onSceneEnter:function(e){var n=this._getEventIdFromRouterParams(e);return t.createInstance("raidEvent").prepare(n,"finale")},btnCallbackBtnInterchange:function(e){var t=n.defer();return t.reject(this._override),this._navigate006To003(e,this._getEventIdFromRouterParams(e)),t.promise},btnCallbackBtnEventGacya:function(e){var t=n.defer();return t.reject(this._override),this._navigate006To004(e,this._getEventIdFromRouterParams(e)),t.promise},btnCallbackBtnStory:function(e){var i=n.defer();i.reject(this._override);var a=t.createInstance("raidEvent");return a.promise().then(function(){return console.debug("story",a.getMainEventId()),this._navigate001ToNo012(e,a.getMainEventId())}.bind(this)),i.promise},_touchEndedBackBtnProcess:function(e){t.createInstance("router").navigate("event/ev_000")}}),t.assignRoles(t.pc.raidevent.ra_006.SceneDelegate,[t.pc.roles.UIUtility,t.pc.raidevent.roles.Routing,t.pc.raidevent.roles.RaidEventCommon])}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="Scenarios",o={get:function(e){return this._http.get({url:"/scenarios/"+e})},getWithScenarioData:function(e){var t=Q.defer();return Q.all([this.get(e),n.createInstance("apiAPlayers").get("me")]).spread(function(e,i){var a=n.env.scenarioRootBase+"/"+e.body.scenario_path,o=superagent("GET",a),r=n._playerName;o.on("error",function(e){t.reject(e)}),o.end(function(n){return e.ok?(r=r.replace(/[\"\'\\\\[\]]/g," "),e.body.scenario=n.text.replace(/{{}}/g,r),void t.resolve(e)):void t.reject(n)})}).fail(function(e){console.error(e),t.reject(e)}),t.promise}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiScenarios",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},o)),n.env.useApiMock){n.MockApi=n.MockApi||{};var r={};t.each(o,function(e,t){r[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi."+a+"."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},r))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){e.kh.PlayerScene={PlayOne:{}}}((this||0).self||global),function(e){var t=e.kh;t.PlayerScene.PlayOne=t.PlayerScene.PlayOne||{},t.PlayerScene.PlayOneAbstract=t.BaseScene.extend({getQuestId:function(){return this._aQuestId},getQuestType:function(){return this._questType},_gotoNextState:function(e,n){t.createInstance("questStateManager").gotoNextQuestState(e,n)},_isIgnoredImplicitRoute:function(){return t.createInstance("router").isIgnoredImplicitRoute(this.temporaryRouterParams)}})}((this||0).self||global),function(e){var t=e.kh;t.PlayerScene.PlayOne=t.PlayerScene.PlayOne||{},t.PlayerScene.PlayOne.ScenarioPlayerScene=t.PlayerScene.PlayOneAbstract.extend({_init:function(){var e=this.routerParams["scenario/play"]||{};this._aQuestId=this.routerParams.a_quest_id||e.a_quest_id,this._questType=this.routerParams.quest_type||e.quest_type;var t=this.temporaryRouterParams;if(t.done)return this._gotoNextState(this._aQuestId,this._questType);var n=t.id;return this._playOne(n)},_playOne:function(e){t.createInstance("router").navigate("scenario/scenario",Object.assign({"scenario/play":{a_quest_id:this._aQuestId,quest_type:this._questType}},this.routerParams),{type:"scenario",id:e,returnBackParams:{scene:"scenario/scenario-play"},ignoreImplicitRoute:this._isIgnoredImplicitRoute()})}})}((this||0).self||global),function(e){var t=e.kh;t.PlayerScene.PlayOne=t.PlayerScene.PlayOne||{},t.PlayerScene.PlayOne.HaremPlayerScene=t.PlayerScene.PlayOneAbstract.extend({_init:function(){var e=this.routerParams["scenario/play"]||{};this._aQuestId=this.routerParams.a_quest_id||e.a_quest_id,this._questType=this.routerParams.quest_type||e.quest_type;var t=this.temporaryRouterParams;if(t.done)return this._gotoNextState(this._aQuestId,this._questType);var n=t.id;return this._playOne(n)},_playOne:function(e){t.createInstance("router").navigate("scenario/harem",Object.assign({"scenario/play":{a_quest_id:this._aQuestId,quest_type:this._questType}},this.routerParams),{type:"harem",id:e,returnBackParams:{scene:"scenario/harem-play"},ignoreImplicitRoute:this._isIgnoredImplicitRoute(),isAuto:!0===this.temporaryRouterParams.isAuto})}})}((this||0).self||global),function(e){var t=e.kh;t.PlayerScene.EpisodePlayerScene=t.BaseScene.extend({_init:function(){var e=this.temporaryRouterParams,t=this.routerParams["scenario/play"];this._aQuestId=e.a_quest_id||t.a_quest_id,this._questType=e.quest_type||t.quest_type,this.returnBackParams=t.returnBackParams;var n=t.episode_id,i=t.chapter_number||1,a=t.harem_only,o=t.hscene_only;this._playAll(n,i,a,o)},_returnBack:function(e){if(!e.scene)throw new Error("");t.createInstance("router").navigate(e.scene,_.merge({},this.routerParams,e.routerParams,{"scenario/play":null}),e.temporaryRouterParams)},_playAll:function(n,i,a,o){this._fetchPlayList(n,i,a,o).then(function(n){if(!n||n.length<1)return e.console.debug(": epi_001_c, epi_002, epi_003, epi_004"),this._returnBack(this.returnBackParams||{});var i=n.shift();t.createInstance("router").navigate("scenario/"+i.scene,{"scenario/play":{playList:n,returnBackParams:this.returnBackParams}},{id:i.id,done:!1,isAuto:this.temporaryRouterParams.isAuto,returnBackParams:{scene:"scenario/episode-play"},ignoreImplicitRoute:this._isIgnoredImplicitRoute()})}.bind(this)).fail(function(t){e.console.error(t)})},_isIgnoredImplicitRoute:function(){return t.createInstance("router").isIgnoredImplicitRoute(this.temporaryRouterParams)},_getCachedPlayList:function(){return _.clone((this.routerParams["scenario/play"]||{playList:[]}).playList)},_fetchPlayList:function(n,i,a,o){var r=this._getCachedPlayList();if(r)return Q.resolve(r);var s=a?"getHaremOnly":"get";return t.createInstance("apiEpisodes")[s](n).then(function(e){var t=e.body.chapters;if(t)var n=t[i-1];else n=e.body;if(!n)return console.error("[error] EpisodePlayerScene._fetchPlayList(): "),Q.reject();if(o)r=_.map(n.harem_scenes,function(e){return{scene:"harem",id:e.harem_scene_id}});else{var a=_.map(n.scenarios,function(e){return{scene:"scenario",id:e.scenario_id}}),s=_.map(n.harem_scenes,function(e){return{scene:"harem",id:e.harem_scene_id}});r=a.concat(s)}return r}.bind(this)).fail(function(t){e.console.error(t)})}})}((this||0).self||global),function(e){var t=e._,n=e.kh;n.PopupFactoryAQ002Brief=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-a_q_002_brief",title:"",buttonLabels:{blackBtn:"",yellowBtn:"SKIP"},buttons:{blackBtn:function(e){this.dismiss(),t.isFunction(e.showSkipButton)&&e.showSkipButton()},yellowBtn:function(e){this.dismiss().then(function(e){return function(){e.skip()}}(e))}}},WIDGET_NAMES:{},POPUP_METHODS:{},_setup:{},onPopupOpened:function(e,t){setTimeout(function(){e.yellowBtn.setTouchEnabled(!0)},500),e.setStrings({synopsis_label:t.summary})},create:function(e,i){var a=n.PopupFactory.prototype.create.call(this,t.assign(e,this.POPUP_PROPERTIES),i);return a.yellowBtn.setTouchEnabled(!1),a.dismiss=function(e){return function(){return this.yellowBtn.setTouchEnabled(!1),e.call(this).then(function(){var e=cc.director.getRunningScene();t.isFunction(e.hideGameCanvas)&&e.hideGameCanvas()})}}(a.dismiss),a},_addMethodsToPopup:function(e){n.PopupFactoryPopupCommon.prototype._addMethodsToPopup.call(this,e),t.assign(e,this.POPUP_METHODS)}})}((this||0).self||global),function(e){var t=e._,n=e.kh;n.PopupFactoryAQ002Log=n.PopupFactoryPopupCommon.extend({POPUP_PROPERTIES:{resourceName:"core-popup-a_q_002_log",title:"",buttonLabels:{blackBtn:""},buttons:{blackBtn:function(e){this.dismiss().then(function(){this._lvm&&this._lvm.clear()}.bind(this))}}},WIDGET_NAMES:{},POPUP_METHODS:{},_setup:{},onPopupOpened:function(t,i){var a=e.res,o=document.getElementById(cc.game.config.scenarioFrame).contentWindow.TYRANO_LOG.get();if(!t._lvm){var r=t.seekWidgetByName("talk_panel");ccs.load(a["core-popup-a_q_002_log_list_ui"]).node,t._lvm=new n.ListViewManager(r,"core-popup-a_q_002_log_list_ui",function(e,t,n){e.setStrings({name_label:t.name,talk_label:t.text}),e.seekWidgetByName("name_label"),e.seekWidgetByName("talk_label")}),t._lvm.setBtnUp(t.seekWidgetByName("btn_log_up")),t._lvm.setBtnDown(t.seekWidgetByName("btn_log_down")),t.seekWidgetByName("btn_log_up").setBright(!1),t.seekWidgetByName("btn_log_up").setTouchEnabled(!0)}t._lvm.setRecords(o),t._lvm.jumpToBottom()},create:function(e,i){var a=n.PopupFactory.prototype.create.call(this,t.assign(e,this.POPUP_PROPERTIES),i);return a.dismiss=function(e){return function(){return e.call(this).then(function(){var e=cc.director.getRunningScene();t.isFunction(e.hideGameCanvas)&&e.hideGameCanvas()})}}(a.dismiss),a._clearContents=function(){this._lvm.clear()}.bind(a),a},_addMethodsToPopup:function(e){n.PopupFactoryPopupCommon.prototype._addMethodsToPopup.call(this,e),t.assign(e,this.POPUP_METHODS)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=(e.ccui,e.Q);t.scenario=t.scenario||{},t.scenario.Scene=t.BaseScene.extend({scenarioData:{},scenarioTitle:"",scenarioSummary:"",ui:{},_popups:{skip:{factoryName:"popupFactoryAQ002Brief"},log:{factoryName:"popupFactoryAQ002Log"},ageLimit:{factoryName:"popupFactoryComAgeLimit"}},AUTO_TRANSITION_WAIT_TIME:1e3,_onloadFiredFlag:!1,_destroyTyranoFiredFlag:!1,_init:function(){var a=this._getScenarioId();if(_.isUndefined(a))console.error(" id .");else{console.debug("play id: ",a),this.storyIsEncounter="encounter"===this.routerParams.episode_type;var o=document.getElementById(n.game.config.id);o.parentNode.style.position="absolute",o.parentNode.style.top="0",o.parentNode.style.left="0",o.style.backgroundColor="transparent";var r=document.getElementById(n.game.config.scenarioFrame);r.style.marginTop=o.parentNode.style.marginTop,r.style.marginLeft=o.parentNode.style.marginLeft,r.style.width=o.style.width,r.style.height=o.style.height,this.onScenarioPlayerInitialized=function(){setTimeout(function(){this._setupInterface(r.contentWindow.$),this._showTitle(this.scenarioTitle)}.bind(this),100)}.bind(this),this.onScenarioEnded=function(){this.showEndTouchField();var e=this._getKag();e.stopTimer(),e.startTimer(this.AUTO_TRANSITION_WAIT_TIME,function(){this._finishScenario()}.bind(this))}.bind(this),i.all([t.createInstance("apiScenarios").getWithScenarioData(a),t.createInstance("playerGameConfig").init()]).spread(function(e,n){this.scenarioData=e.body.scenario,this.scenarioTitle=e.body.title,this.scenarioSummary=e.body.summary,this.scenarioIsR18=e.body.is_r18,!t.env.isR18&&this.scenarioIsR18&&(this.scenarioData='*start\n [position height=160 top=600]\n [ptext name="chara_name_area" layer=message0 width="200" color=white x=10 y=560 size=26] \n [chara_config ptext="chara_name_area"]\n [call target=*start storage="tyrano.ks"]\n [chara_new name="system" storage="white.png" jname=""]\n [bg storage=white.png  time=0 wait=true]\n #system\n [chara_show name="system" top=-0 time=0]\n [r]R18PROJECT R[r]\n [l]\n',this.scenarioTitle="",this.scenarioSummary=""),this.scenarioData=this.scenarioData.replace(/(storage="?)([^"]+?)(\.(?:png|jpg|mp3))("?)/g,function(e,n,i,a,o){return t.getAddVersionQueryString(n+i+a)+o}),this.scenarioData=this.scenarioData.replace(/^(.+)(storage="?)([^"]+?)(-[0-9a-f]+)?(\.(?:png|jpg))("?)/gm,function(e,i,a,o,r,s,c){return/^\[bg/.test(i)?t.env.isSp?i+a+o+("low"===n.getImageQuality()?"_l":"")+(r||"")+s+c:i+a+o+("low"===n.getImageQuality()?"_pc":"_pc_h")+(r||"")+s+c:t.env.isSp?i+a+o+("low"===n.getImageQuality()?"_l":"")+(r||"")+s+c:i+a+o+("low"===n.getImageQuality()?"":"_h")+(r||"")+s+c}),this.scenarioData=this.scenarioData.replace(/(\[chara_show\s+[^\]]+)top="?-0"?/g,function(e,t){return t}),r.onload=function(){!0!==this._onloadFiredFlag&&(this._onloadFiredFlag=!0,r.contentWindow.$(function(){if(this.hideGameCanvas(),r.contentWindow.kh=t,r.style.transform="",r.style.display="block",r.contentWindow.scenarioData=this._wrapScenario(this.scenarioData),r.contentWindow.resourceDir=t.env.scenarioRoot,r.contentWindow.seDir=t.env.scenarioRoot+"/"+e.body.resource_directory,r.contentWindow.TYRANO.init(),r.contentWindow.bgmVolume=n.getVirtualBgmVolume(),r.contentWindow.voiceVolume=n.getVirtualVoiceVolume(),r.contentWindow.bgmOn=n.isBgmOn(),r.contentWindow.voiceOn=n.isVoiceOn(),this._muted=!1,!n.isSoundOn()&&i&&_.isFunction(i.power)){this._muted=!0;var i=r.contentWindow.boombox;i.power(!1)}return this._addResumeAudioContextClickEvent(),t.env.isR18||!this.scenarioIsR18||this.routerParams.limitedPlay?void delete this.routerParams.limitedPlay:this.skip()}.bind(this)))}.bind(this),r.contentWindow.location.replace("../scenario/tyrano.html")}.bind(this)).fail(function(t){e.console.error(t)})}},_wrapScenario:function(e){var t=e.replace(/(\[bg[^\]]+\])/,"$1\n[l]");return _.flatten([["[iscript]","if (window.parent && window.parent.cc) {","  var scene = window.parent.cc.director.getRunningScene();","  if (scene.onScenarioPlayerInitialized) { scene.onScenarioPlayerInitialized(); }","}","[endscript]"],t,["[iscript]","if (window.parent && window.parent.cc) {","  var scene = window.parent.cc.director.getRunningScene();","  if (scene.onScenarioEnded) { scene.onScenarioEnded(); }","}","[endscript]"]]).join("\n")},_getScenarioId:function(){return(this.temporaryRouterParams||{}).id},_navigate:function(){this.showGameCanvas(),document.getElementById(n.game.config.scenarioFrame).style.display="none",t.createInstance("router").navigate(this.temporaryRouterParams.returnBackParams.scene,this.routerParams,{done:!0,isAuto:this.isAuto})},_setupInterface:function(e){e(".message_outer").css({top:"425px",left:"113px",width:"731px",height:"215px",background:"url(images/scenario/base_talk_window.png)",opacity:1}),e(".message_inner").css({top:"430px",left:"113px",width:"600px",height:"216px",paddingLeft:"60px",paddingTop:"60px",fontFamily:"webfont","font-size":"24px",color:"rgb(54, 33, 0)","line-height":"1.75","text-align":"left","text-shadow":"0px 1px 0px rgba(255, 255, 255, 0.6)"}),e(".chara_name_area").css({top:"446px",left:"144px",width:"275px",fontFamily:"webfont",fontWeight:"bold","font-size":"21px",color:"rgb(255, 255, 255)","line-height":"1.2","text-align":"left","text-shadow":"0.5px 0.866px 0px rgba(0, 0, 0, 0.004)"});var t=e("<div>");t.css({position:"absolute",top:"0px",left:"0px",zIndex:1e6,width:"100%",height:"74px",position:"absolute",border:"0px none",background:"url(images/scenario/header_bar.png) no-repeat",textAlign:"center",paddingTop:"2px"});var n=e("<span>");n.css({"font-size":"16px",color:"rgb(255, 255, 255)",fontFamily:"webfont","line-height":"1.2","text-align":"right","text-shadow":"0px 2px 1px rgba(0, 0, 0, 1), 0px -2px 1px rgba(0, 0, 0, 1), 2px 0px 1px rgba(0, 0, 0, 1), -2px 0px 1px rgba(0, 0, 0, 1)",position:"absolute",top:"8px",right:"80px"});var i=e("<button>");i.css({position:"absolute",top:"0px",left:"7px",zIndex:1e6,width:"56px",height:"55px",position:"absolute",border:"0px none",outline:"none",background:"url(images/scenario/btn_sound_1.png)"}),this._isSoundOn()||i.css("background","url(images/scenario/btn_sound_0.png)");var a=e("<button>");a.css({right:"6px",top:"0px",width:"54px",height:"54px",zIndex:1e6,position:"absolute",border:"0px none",outline:"none",background:"none",position:"absolute",background:"url(images/scenario/btn_log_1.png)"});var o=e("<button>");o.css({left:"689px",top:"449px",width:"145px",height:"56px",zIndex:1e6,border:"0px none",outline:"none",background:"none",position:"absolute",background:"url(images/scenario/btn_skip.png)"}),this._$skipBtn=o;var r=e("<button>");r.css({left:"545px",top:"451px",width:"140px",height:"51px",zIndex:1e6,border:"0px none",outline:"none",background:"none",position:"absolute",background:"url(images/scenario/play_btn_auto_off.png)"}),this._$autoBtn=r,t.append(n),_.each([t,i,a,o,r],function(e){this.append(e)}.bind(e("#tyrano_base"))),i.click(this._toggleSound.bind(this)),a.click(this._showLogDialog.bind(this)),o.click(this._showSkipDialog.bind(this)),r.click(this._changeAutoMode.bind(this)),this.ui.$header=t,this.ui.$title=n,this.ui.$soundBtn=i,this.ui.$logBtn=a,this.ui.$skipBtn=o,this.ui.$autoBtn=r},onExit:function(){this._super(),_.each(this.ui,function(e){e.remove()}),document.getElementById(n.game.config.scenarioFrame).contentWindow.location="about:blank"},showGameCanvas:function(){document.getElementById(n.game.config.id).parentNode.style.display="block"},hideGameCanvas:function(){document.getElementById(n.game.config.id).parentNode.style.display="none"},showEndTouchField:function(){document.getElementById(n.game.config.endTouchField).style.display="block",document.getElementById(n.game.config.endTouchField).onclick=function(){this._getKag().stopTimer(),this._finishScenario()}.bind(this)},showSkipButton:function(){this._$skipBtn.show()},hideSkipButton:function(){this._$skipBtn.hide()},skip:function(){this._destroyTyrano(),this._navigate()},_changeAutoButtonIcon:function(e){var t=e?"url(images/scenario/play_btn_auto_on.png)":"url(images/scenario/play_btn_auto_off.png)";this._$autoBtn.css("background",t)},_changeAutoMode:function(){var e=this._getKag();this._isSoundOn()||(e.stat.is_playing_se=!1),e.stat.is_auto=!e.stat.is_auto,this._changeAutoButtonIcon(e.stat.is_auto),1==e.stat.is_auto&&e.stat.is_auto_wait_completed&&(e.stat.is_auto_wait_completed=!1,e.execTransition())},_showTitle:function(e){return this.ui.$title?void this.ui.$title.text(e):void console.error("title has not initialized yet")},_toggleSound:function(e){var i=document.getElementById(n.game.config.scenarioFrame),a=this._getKag(),o=i.contentWindow.boombox,r=t.createInstance("playerGameConfig");if(this._muted)if(o&&_.isFunction(o.power)){if(a.stat.is_playing_se=!0,e.target.style.backgroundImage="url(images/scenario/btn_sound_1.png)",o.power(!0),i.contentWindow.bgmOn=!0,i.contentWindow.voiceOn=!0,a.tmp&&a.tmp.map_bgm&&a.stat&&a.stat.current_bgm){var s=a.tmp.map_bgm[a.stat.current_bgm];s?s.play():a.ftag.startTag("playbgm",_.extend(a.tag.playbgm,{storage:a.stat.current_bgm}))}r.setAllSoundOn(!0)}else{var c="power is not function";t.createInstance("smartBeat").sendError(new Error(c))}else if(o&&_.isFunction(o.power))a.stat.is_playing_se=!1,e.target.style.backgroundImage="url(images/scenario/btn_sound_0.png)",o.power(!1),i.contentWindow.bgmOn=!1,i.contentWindow.voiceOn=!1,r.setAllSoundOn(!1);else{c="power is not function";t.createInstance("smartBeat").sendError(new Error(c))}r.updateGameConfig(),this._muted=!this._muted},_showLogDialog:function(){(new t.SE).play(t.SoundList.BUTTON_TOUCHED_DECIDE),this.showGameCanvas(),this.popups.log.open({summary:this.scenarioSummary||"[ERROR] 20002"})},_showSkipDialog:function(){this.hideSkipButton(),(new t.SE).play(t.SoundList.BUTTON_TOUCHED_DECIDE),this.showGameCanvas(),this.popups.skip.open({summary:this.scenarioSummary||"[ERROR] 20002"})},_destroyTyrano:function(){if(!0!==this._destroyTyranoFiredFlag){this._destroyTyranoFiredFlag=!0;var e=document.getElementById(n.game.config.scenarioFrame),t=e.contentWindow.TYRANO.kag;this.isAuto=t&&t.stat&&t.stat.is_auto,e.contentWindow.TYRANO=null;var i=e.contentWindow.boombox;i&&_.isFunction(i.power)&&i.power(!1)}},_isSoundOn:function(){return t.createInstance("playerGameConfig").isSoundOn()},_getKag:function(){return document.getElementById(n.game.config.scenarioFrame).contentWindow.TYRANO.kag},_finishScenario:function(){this._destroyTyrano(),this._navigate(),document.getElementById(n.game.config.endTouchField).style.display="none"},_addResumeAudioContextClickEvent:function(){var e=document.getElementById(n.game.config.scenarioFrame).contentWindow;e.$("body").on("click",".layer_event_click",function(){var t=e.boombox;"suspended"===t.WEB_AUDIO_CONTEXT.state&&t.WEB_AUDIO_CONTEXT.resume()})}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e.document;t.harem=t.harem||{},t.harem.Scene=t.BaseScene.extend({_popups:{ani_skip_check:{factoryName:"popupFactoryTextOnly",title:"",content:"<br />?",buttonLabels:{blackBtn:"",blueBtn:"OK"},buttons:{blackBtn:function(e){this.dismiss(),e.hideGameCanvas()},blueBtn:function(e){}}}},sceneData:{},ui:{},resizeCallback:function(){var e;return function(){e&&clearTimeout(e),e=setTimeout(function(){var e=i.getElementById(n.game.config.id);i.getElementById(n.game.config.scenarioFrame).style.transform="scale("+parseInt(e.style.width,10)/960+") translateY(640px) rotate(-90deg)"},300)}}(),_init:function(){var a=this._getHaremSceneId();if(_.isUndefined(a))e.console.error(" id ");else{e.console.debug("play id: ",a);var o=i.getElementById(n.game.config.id),r=i.getElementById(n.game.config.scenarioFrame);$(r).hide();r.onload=function(){r.contentWindow.$(function(e){e.hideGameCanvas(),o.parentNode.style.position="absolute",o.parentNode.style.top="0",o.parentNode.style.left="0",o.style.backgroundColor="transparent";var a=r.contentWindow.$;r.style.width="640px",r.style.height="960px",r.style.margin="0px",r.style.marginTop=o.parentNode.style.marginTop,r.style.marginLeft=o.parentNode.style.marginLeft,r.style.transform="scale("+parseInt(o.style.width,10)/960+") translateY(640px) rotate(-90deg)",r.style.transformOrigin="0 0",i.body.style.height=o.style.height;var s=t.createInstance("playerGameConfig");r.contentWindow.bgmVolume=s.getVirtualBgmVolume(),r.contentWindow.bgmOn=s.isBgmOn(),r.contentWindow.voiceOn=s.isVoiceOn(),e._addResumeAudioContextClickEvent(),r.contentWindow.isModePc=-1<location.pathname.indexOf("components-pc"),r.contentWindow.animScenes=e.sceneData,r.contentWindow.kh=t;var c=r.contentWindow.animScenes,u=new(0,r.contentWindow.AnimPlayer)(c,{moviePlayerFrame:{width:640,height:900},isAuto:e.temporaryRouterParams.isAuto});u.setElement(a(".anim-player")),r.style.display="block",u.listenTo(u,"SoundOn",function(){var e=t.createInstance("playerGameConfig");e.setAllSoundOn(!0),e.updateGameConfig();var a=i.getElementById(n.game.config.scenarioFrame);a.contentWindow.bgmOn=!0,a.contentWindow.voiceOn=!0}),u.listenTo(u,"SoundOff",function(){var e=t.createInstance("playerGameConfig");e.setAllSoundOn(!1),e.updateGameConfig();var a=i.getElementById(n.game.config.scenarioFrame);a.contentWindow.bgmOn=!1,a.contentWindow.voiceOn=!1}),u.listenTo(u,"Skip",function(){e.showGameCanvas();var a=e.popups.ani_skip_check;a.open(),t.setTouchEventHandlers(a,{"TOUCH_ENDED blue_btn":function(){var t=i.getElementById(n.game.config.scenarioFrame);t.style.transform="",t=null,u.remove(),u=null,e._navigate(),e=null}})}),u.start().then(function(){r.style.transform="",r=null,u.remove(),u=null,e._navigate(),e=null}),a(r).show()}(this)),r.onload=null}.bind(this),Q.all([t.env.isR18?t.createInstance("apiHaremScenes").getWithScenarioData(a):"",t.createInstance("playerGameConfig").init()]).spread(function(n,i){if(t.env.isR18){this.sceneData=n.body.scene_data;var a="low"===i.getImageQuality()?"":"_h",o=i.getVirtualBgmVolume(),s=i.getVirtualVoiceVolume();e.console.debug("");var c=t.env.scenarioRoot+"/"+n.body.resource_directory;this.sceneData.forEach(function(e){e.film=e.film.replace(/^([^\.]+)(\.(?:png|jpg))$/,function(e,t,n){return t+a+n}),e.film=c+"/"+e.film,e.film=t.getAddVersionQueryString(e.film),e.bgm&&(e.bgm=c+"/"+e.bgm,e.bgm=t.getAddVersionQueryString(e.bgm)),e.talk.forEach(function(e){e.voice&&(e.voice=c+"/"+e.voice,e.volume=s,e.voice=t.getAddVersionQueryString(e.voice))}),e.bgmVolume=o}),this.sceneData.unshift({talk:[{words:""}]})}else this.sceneData=[{fps:1,auto:!1,film:"white.png",bgm:"",talk:[{chara:"",words:"R18PROJECT R",voice:""}]}];if(r.contentWindow.location="../scenario/anim-player.html",!i.isSoundOn()){var u=function(){r.removeEventListener("load",u),u=null,this.contentWindow.$("#toggle-sound").trigger("click")};r.addEventListener("load",u)}}.bind(this)).fail(function(t){e.console.error(t)})}},_getHaremSceneId:function(){return(this.temporaryRouterParams||{}).id},_navigate:function(){this.showGameCanvas(),i.getElementById(n.game.config.scenarioFrame).style.display="none",i.getElementById(n.game.config.scenarioFrame).contentWindow.location="about:black","ontouchstart"in i||t.postMessage("closeHarem"),t.createInstance("router").navigate(this.temporaryRouterParams.returnBackParams.scene,this.routerParams,{done:!0})},showGameCanvas:function(){i.getElementById(n.game.config.id).parentNode.style.display="block"},hideGameCanvas:function(){i.getElementById(n.game.config.id).parentNode.style.display="none"},_addResumeAudioContextClickEvent:function(){var e=i.getElementById(n.game.config.scenarioFrame).contentWindow,t=function(){var t=e.boombox;"suspended"===t.WEB_AUDIO_CONTEXT.state&&t.WEB_AUDIO_CONTEXT.resume()};e.$(".words").on("click",t),e.$(".movie-player").on("click",t)}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.router=n.router||{},n.router.routes=n.router.routes||{},t.merge(n.router.routes,{scenario:{"scenario/scenario-play":"scenarioPlayer","scenario/harem-play":"haremPlayer","scenario/episode-play":"episodePlayer","scenario/scenario":"scenario","scenario/harem":"harem"}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{},i=e.cc;n.createNameSpaceIfNotExists("scoreattack.model"),n.scoreattack.model.AEventDetail=i.Class.extend({_promise:null,_scoreDetailModel:null,_eventId:null,_eventName:null,_eventDate:null,_isFirstAccess:null,_introductionEpisodeId:null,_descriptionImages:null,_exchangeableRewardsType:null,prepare:function(){var e=i.director.getRunningScene(),t=e._delegate._getRouterParams(e).event_id,a=n.createInstance("apiAEvents").getDetail(n.scoreattack.WordBook.EVENT_TYPE,t).then(function(e){var t=e.body;return this._eventId=t.event_id,this._eventName=t.event_name,this._eventDate=t.event_date,this._eventType=t.event_type,this._rewardReceiptDeadline=t.reward_receipt_deadline,this._isFirstAccess=t.first_access,this._introductionEpisodeId=t.introduction_episode_id,this._descriptionImages=t.description_images,this._exchangeableRewardsType=t.exchangeable_rewards,this}.bind(this));return this._promise=Q.all([a,this._fetchCurrentScore(t)]).thenResolve(this),this._promise},_fetchCurrentScore:function(e){return n.createInstance("myselfInfoRepository").getMe().then(function(t){var i=t.getAPlayerId();return this._scoreDetailModel=new n.scoreattack.model.AScoreDetail(e,i),this._scoreDetailModel.prepare()}.bind(this))},update:function(){return n.createInstance("apiAEvents").updateStatus(n.scoreattack.WordBook.EVENT_TYPE,this.getEventId()).then(function(e){return this._isFirstAccess=!1,this}.bind(this))},getPromise:function(){return this._promise?this._promise:this.prepare()},getEventId:function(){return this._eventId},getEventName:function(){return this._eventName},getEventDate:function(){return this._eventDate},getRewardReceiptDeadline:function(){return this._rewardReceiptDeadline},isReceiveReward:function(){return this._eventType===n.scoreattack.WordBook.RECEIVE_REWARD_EVENT_TYPE},isFirstAccess:function(){return this._isFirstAccess},getEpisodeId:function(){return this._introductionEpisodeId},getDescriptionImages:function(){return this._descriptionImages},getRuleName:function(){return this._scoreDetailModel.getRuleTitle()},getRuleDescription:function(){return this._scoreDetailModel.getRuleDescription()},hasExchangeableReward:function(e){return e?t.contains(this._exchangeableRewardsType,e):!t.isEmpty(this._exchangeableRewardsType)},hasExchangeableRankingReward:function(){return!t.isEmpty(this._exchangeableRewardsType)&&(this.hasExchangeableReward(n.scoreattack.enum.REWARD_TYPE.BEST_RANKING)||this.hasExchangeableReward(n.scoreattack.enum.REWARD_TYPE.TOTAL_RANKING))},getCurrentScoreDetail:function(){return this._scoreDetailModel},dispose:function(){this._promise=null,this._scoreDetailModel=null}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{},i=e.cc;n.createNameSpaceIfNotExists("scoreattack.model"),n.scoreattack.model.AScoreDetail=i.Class.extend({_promise:null,ctor:function(e,n,i){this._eventId=e,this._aPlayerId=n,t.isObject(i)&&(this._promise=Q.resolve(this._parseResponse({body:i})))},prepare:function(){return this._promise=n.createInstance("apiAEvents").getScoreattackRecord(this._eventId,this._aPlayerId).then(this._parseResponse.bind(this)),this._promise},_parseResponse:function(e){var t=e.body;this._playerName=t.player_name,this._isMe=t.is_me,this._totalGroundScore=t.ground_total_score;var n=t.ranking.total;this._totalRank=n.rank,this._totalRankText=n.rank_text,this._totalRankingScore=n.score,this._totalLatestScore=t.total_latest_score;var i=t.ranking.best;this._bestRank=i.rank,this._bestRankText=i.rank_text,this._bestRankingScore=i.score,this._bestRankingElement=i.element;var a=t.element_score;this._bestFlameScore=a.flame_score,this._bestWaterScore=a.water_score,this._bestWindScore=a.wind_score,this._bestThunderScore=a.thunder_score,this._bestDarknessScore=a.darkness_score,this._bestLightScore=a.light_score;var o=t.rule;return this._ruleTitle=o.title,this._ruleDescription=o.description,this},getPromise:function(e){return this._promise?this._promise:this.prepare(e)},getAPlayerId:function(){return this._aPlayerId},getPlayerName:function(){return this._playerName},isMe:function(){return this._isMe},getTotalGroundScore:function(){return this._totalGroundScore},getTotalRank:function(){return this._totalRank},getTotalRankText:function(){return this._totalRankText},getTotalLatestScore:function(){return this._totalLatestScore},getTotalRankingScore:function(){return this._totalRankingScore},getBestRank:function(){return this._bestRank},getBestRankText:function(){return this._bestRankText},getRuleTitle:function(){return this._ruleTitle},getRuleDescription:function(){return this._ruleDescription},getBestRankingElement:function(){return this._bestRankingElement},getBestRankingScore:function(){return this._bestRankingScore},getBestLatestElement:function(){var e=n.WordBook.ELEMENT_TYPE_LIST.nonelemental.num,t=0;return t<this.getBestFlameScore()&&(t=Number(this.getBestFlameScore()),e=n.WordBook.ELEMENT_TYPE_LIST.flame.num),t<this.getBestWaterScore()&&(t=Number(this.getBestWaterScore()),e=n.WordBook.ELEMENT_TYPE_LIST.water.num),t<this.getBestWindScore()&&(t=Number(this.getBestWindScore()),e=n.WordBook.ELEMENT_TYPE_LIST.wind.num),t<this.getBestThunderScore()&&(t=Number(this.getBestThunderScore()),e=n.WordBook.ELEMENT_TYPE_LIST.thunder.num),t<this.getBestLightScore()&&(t=Number(this.getBestLightScore()),e=n.WordBook.ELEMENT_TYPE_LIST.light.num),t<this.getBestDarknessScore()&&(t=Number(this.getBestDarknessScore()),e=n.WordBook.ELEMENT_TYPE_LIST.darkness.num),e},getBestLatestScore:function(){return Math.max(0,this.getBestFlameScore(),this.getBestWaterScore(),this.getBestWindScore(),this.getBestThunderScore(),this.getBestDarknessScore(),this.getBestLightScore()).toString()},getBestFlameScore:function(){return this._bestFlameScore},getBestWaterScore:function(){return this._bestWaterScore},getBestWindScore:function(){return this._bestWindScore},getBestThunderScore:function(){return this._bestThunderScore},getBestDarknessScore:function(){return this._bestDarknessScore},getBestLightScore:function(){return this._bestLightScore},dispose:function(){this._promise=null}})}((this||0).self||global),function(e){var t=e.kh;e.cc,e._,t.createNameSpaceIfNotExists("scoreattack.view"),t.scoreattack.view.ScoreattackScoreDetailPopup=t.ImplantedPopup.extend({_initContents:function(e,n){var i={btn_profile:this._touchBtnProfile.bind(this,e.getEventId(),n.getAPlayerId(),n.isMe()),btn_close:!0};this.setButtonEvents(i),this.getNode().setStrings({user_name_label:n.getPlayerName(),score_num_label:n.getTotalLatestScore(),rank_num_label:n.getTotalRankText(),score_flame_white:n.getBestFlameScore(),score_flame_yellow:n.getBestFlameScore(),score_water_white:n.getBestWaterScore(),score_water_yellow:n.getBestWaterScore(),score_wind_white:n.getBestWindScore(),score_wind_yellow:n.getBestWindScore(),score_thunder_white:n.getBestThunderScore(),score_thunder_yellow:n.getBestThunderScore(),score_darkness_white:n.getBestDarknessScore(),score_darkness_yellow:n.getBestDarknessScore(),score_light_white:n.getBestLightScore(),score_light_yellow:n.getBestLightScore()}),this._setRuleLabel(e);var a=/^score_(.+?)_(white|yellow)/;this.getNode().seekWidgets(function(e){return 0===e.getChildren().length&&a.test(e.getName())}).forEach(function(e){var i=a.exec(e.getName()),o=i[1],r=i[2],s=Number(t.WordBook.ELEMENT_TYPE_LIST[o].num)===n.getBestLatestElement();if("yellow"!==r)e.setVisible(!s);else{e.setVisible(s);var c=e.getParent().getChildByName("rank_"+o);c.setVisible(s);var u=n.getBestRankText();c.setString(u)}})},_setRuleLabel:function(e){this.getNode().bfsWidgetByName("rule_label").setString(e.getRuleName())},_touchBtnProfile:function(e,n,i){var a="profile/prf_001"+(i?"a":"b"),o=t.createInstance("router"),r={};r[o.getCurrentSceneName()]={event_id:e},o.navigate(a,{prf_001:{id:n}},{return_to_profile:{routes:o.getCurrentFragment(),params:r}})}}),t.dictx.registerWithProtoStrategy("ScoreattackScoreDetailPopup",t.scoreattack.view.ScoreattackScoreDetailPopup)}((this||0).self||global),function(e){var t=e.kh;e.khutil,e.cc,e.ccui,e._,e.console,t.createNameSpaceIfNotExists("core.enums"),t.core.enums.PREVIOUS_RANK={IS_HIGHER:0,IS_EQUAL:1,IS_LOWER:2,HAS_NONE:3}}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=(e.ccui,e._),o=e.console;t.createNameSpaceIfNotExists("core.ranking"),t.core.ranking.RankingStatusPanelView=i.Class.extend({className:"RankingStatusPanelView",WIDGET_NAMES:{NAME:"name_label",RANK:"rank_label",SCORE:"score_label",PREVIOUS_RANK_RED:"red_label",PREVIOUS_RANK_BLUE:"blue_label"},APPEARANCE_NAMES_BY_PREVIOUS_RANK:function(e,t){return e[t.HAS_NONE]="rankup_hyphen",e[t.IS_HIGHER]="rankdown",e[t.IS_EQUAL]="rankstay",e[t.IS_LOWER]="rankup",e}({},t.core.enums.PREVIOUS_RANK),RANK_TEXT:"{rank}",SCORE_TEXT:"{score}",ctor:function(e){this._rootWidget=e},display:function(e){this._rootWidget.setVisible(!0),this._displayRank(e),this._displayPreviousRank(e),this._displayScore(e),this._displayName(e),this._updateAppearanceByPreviousRank(e)},clear:function(){this._rootWidget.setVisible(!1),a(this.WIDGET_NAMES).map(this._getWidget,this).invoke("setString","")},_displayRank:function(e){var t=this._getWidget(this.WIDGET_NAMES.RANK),n=e.getRank(),i=n<4?"":this.RANK_TEXT.replace("{rank}",n);t.setString(i)},_displayScore:function(e){var t=this._getWidget(this.WIDGET_NAMES.SCORE),n=e.getScore(),i=this.SCORE_TEXT.replace("{score}",n);t.setString(i)},_displayName:function(e){var t=this._getWidget(this.WIDGET_NAMES.NAME),n=e.getName();t.setString(n)},_displayPreviousRank:function(e){var t=e.getPreviousRank();(t>20||t<=0)&&(t=""),t===e.getRank()&&(t=""),a([this.WIDGET_NAMES.PREVIOUS_RANK_RED,this.WIDGET_NAMES.PREVIOUS_RANK_BLUE]).map(this._getWidget,this).forEach(function(e){e.setTextVerticalAlignment(i.VERTICAL_TEXT_ALIGNMENT_CENTER);var n=e.origFontSize;e.setFontSize(e.origFontSize),e.setSize({width:2*n,height:n}),e.setString(t)})},_updateAppearanceByPreviousRank:function(e){var t,n=e.getPreviousRankStatus(),i=this.APPEARANCE_NAMES_BY_PREVIOUS_RANK[n];if(this.WIDGET_NAMES.PREVIOUS_RANK_ARROW)t=this._getWidget(this.WIDGET_NAMES.PREVIOUS_RANK_ARROW);else if(!(t=this._rootWidget.seekWidgets(function(e){return(e.getName()||"").indexOf("_rank_arrow_ui")>0})[0]))return void o.error("PREVIOUS_RANK_ARROW : not Found");t.setAppearance(i)},_getWidget:function(e){return n.getWidgetFromNode(this._rootWidget,e,function(e){o.warn(this.className+": "+e)}.bind(this))}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc,e.ccui,e._);e.console,e.res,t.createNameSpaceIfNotExists("scoreattack.controller"),t.scoreattack.controller.RankingPageListController=t.core.ranking.RankingPageListController.extend({className:"ScoreAttackRankingPageListController",GENERAL_SETTINGS:{baseName:"window_gray",panelName:t.BtnsPageListParams.SCOREATTACK_RANKING_LIST.panelName,panelsPerPage:t.BtnsPageListParams.SCOREATTACK_RANKING_LIST.perPage,paginatorNode:"viewpage_three_ui",apiName:"apiAEvents",apiMethod:"getEventRanking",apiParams:null},_instantiateStatusPanel:function(e){return new t.scoreattack.controller.RankingStatusController(e)},_initializePageListSettings:function(e){var i;switch(e){case t.scoreattack.enum.RANKING_TYPE.TOTAL:i="tab_0_node";break;case t.scoreattack.enum.RANKING_TYPE.BEST:i="tab_1_node"}return n.assign({},this.GENERAL_SETTINGS,{baseName:i,apiParams:[t.scoreattack.WordBook.EVENT_TYPE,e,null,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE]})}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=(e.ccui,e._),o=e.console;t.createNameSpaceIfNotExists("core.ranking"),t.core.ranking.IndividualRankingStatusPanelView=i.Class.extend({className:"IndividualRankingStatusPanelView",WIDGET_NAMES:{JOB:"corecard_job",SUMMON:"corecard_summon"},CHARACTER_WIDGET_NAMES:a.map(a.range(4),function(e){return"corecard_chara_"+e}),APPEARANCE_NAMES_BY_RANK:{1:"rank_1st",2:"rank_2nd",3:"rank_3rd",DEFAULT:"rank_below"},IMAGE_PATHS:{JOB:"corecard_job_{id}_0",SUMMON:"corecard_summon_{id}_0",CHARACTER:"corecard_chara_{id}_0"},IMAGE_EXTENSIONS:{JOB:"jpg",SUMMON:"jpg",CHARACTER:"jpg"},ctor:function(e){this._rootWidget=e,this._sharedPanelView=this._createSharedPanelView(e)},_createSharedPanelView:function(e){return t.createInstance("RankingStatusPanelView",[e])},display:function(e){this._sharedPanelView.display(e),this._displayJob(e),this._displaySummon(e),this._displayCharacters(e),this._updateAppearanceByRank(e)},clear:function(){this._rootWidget.setVisible(!1),this._getWidget(this.WIDGET_NAMES.JOB).loadTexture(""),this._getWidget(this.WIDGET_NAMES.SUMMON).loadTexture(""),a(this.CHARACTER_WIDGET_NAMES).map(this._getWidget,this).invoke("loadTexture","")},_displayJob:function(e){var t=e.getJobId();this._displayTexture(t,"JOB",this.WIDGET_NAMES.JOB)},_displaySummon:function(e){var t=e.getSummonId();this._displayTexture(t,"SUMMON",this.WIDGET_NAMES.SUMMON)},_displayCharacters:function(e){var t=e.getMainPartyMembersIdList();a.each(this.CHARACTER_WIDGET_NAMES,function(e,n){this._displayTexture(t[n],"CHARACTER",e)},this)},_displayTexture:function(e,n,i){var o=this._getWidget(i);if(e){o.setVisible(!0);var r=this.IMAGE_PATHS[n].replace("{id}",a.padZero(e,4)),s=t.img.apply(t,r.split("_"))[this.IMAGE_EXTENSIONS[n]];o.loadTexture(s)}else o.getVirtualRenderer().setTexture(null)},_updateAppearanceByRank:function(e){var t=e.getRank(),n=this.APPEARANCE_NAMES_BY_RANK[t];null==n&&(n=this.APPEARANCE_NAMES_BY_RANK.DEFAULT),this._rootWidget.setAppearance(n)},_getWidget:function(e){return n.getWidgetFromNode(this._rootWidget,e,function(e){o.warn(this.className+": "+e)}.bind(this))}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("scoreattack.model"),t.scoreattack.model.ScoreAttackRankingStatus=n.Class.extend({className:"ScoreAttackRankingStatus",_scoreDetailModel:null,ctor:function(e){this._rankingStatusData=e},getScore:function(){return this._rankingStatusData.score},getBestRankingElement:function(){return this._rankingStatusData.best_ranking_element},getRank:function(){return this._rankingStatusData.rank},getPreviousRank:function(){return this._rankingStatusData.previous_rank},getPreviousRankStatus:function(){return 0===this.getPreviousRank()?t.core.enums.PREVIOUS_RANK.HAS_NONE:this.getPreviousRank()<this.getRank()?t.core.enums.PREVIOUS_RANK.IS_HIGHER:this.getPreviousRank()===this.getRank()?t.core.enums.PREVIOUS_RANK.IS_EQUAL:this.getPreviousRank()>this.getRank()?t.core.enums.PREVIOUS_RANK.IS_LOWER:void 0},getJobId:function(){return this._rankingStatusData.job_id},getSummonId:function(){return this._rankingStatusData.summon_id},getMainPartyMembersIdList:function(){return this._rankingStatusData.main_party_members_id_list},getName:function(){return this._rankingStatusData.player_name},getPlayerId:function(){return this._rankingStatusData.a_player_id},isMe:function(){return this._rankingStatusData.is_me},getCurrentScoreDetail:function(e){return this._scoreDetailModel?this._scoreDetailModel:(this._scoreDetailModel=new t.scoreattack.model.AScoreDetail(e,this._rankingStatusData.a_player_id),this._scoreDetailModel)}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=e.ccui,o=(e._,e.console);t.createNameSpaceIfNotExists("scoreattack.controller"),t.scoreattack.controller.RankingStatusController=i.Class.extend({className:"RankingStatusController",PANEL_TOUCH_EVENT_WIDGET_NAME:"rank_base",ctor:function(e){this._statusPanelView=new t.scoreattack.view.ScoreAttackRankingStatusPanelView(e),this._initializeOnTouchEvent(e)},initializeModel:function(e){this._rankingStatusModel=new t.scoreattack.model.ScoreAttackRankingStatus(e)},displayStatusPanel:function(){this._statusPanelView.display(this._rankingStatusModel)},hideStatusPanel:function(){this._statusPanelView.clear()},_initializeOnTouchEvent:function(e){n.getWidgetFromNode(e,this.PANEL_TOUCH_EVENT_WIDGET_NAME,function(e){o.warn(this.className+": "+e)}.bind(this)).addTouchEventListener(this._onTouchEventCallback,this)},_onTouchEventCallback:function(e,n){n===a.Widget.TOUCH_ENDED&&t.createInstance("scoreAttackEventDetail").getPromise().then(function(e){return this._rankingStatusModel.getCurrentScoreDetail(e.getEventId()).prepare().then(function(n){var a=i.director.getRunningScene();t.ImplantedPopup.createOrGet(a,"scoreattack_score_detail").open(e,n)})}.bind(this))},clear:function(){this.hideStatusPanel()}})}((this||0).self||global),function(e){var t=e.kh;e.khutil,e.cc,e.ccui,e._,e.console,t.createNameSpaceIfNotExists("scoreattack.view"),t.scoreattack.view.RankingSharedStatusPanelView=t.core.ranking.RankingStatusPanelView.extend({className:"RankingSharedStatusPanelView",SCORE_TEXT:"{Score}",WIDGET_NAMES:{NAME:"name_label",RANK:"rank_label",SCORE:"score_label",PREVIOUS_RANK_RED:"red_label",PREVIOUS_RANK_BLUE:"blue_label",PREVIOUS_RANK_ARROW:"scoreattack_ranking_arrow_ui"},_displayScore:function(e){var t=this._getWidget(this.WIDGET_NAMES.SCORE),n=this.SCORE_TEXT.replace("{Score}",e.getScore());t.setString(n)}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc,e.ccui),i=e._;e.console,t.createNameSpaceIfNotExists("scoreattack.view"),t.scoreattack.view.ScoreAttackRankingStatusPanelView=t.core.ranking.IndividualRankingStatusPanelView.extend({className:"ScoreAttackRankingStatusPanelView",_createSharedPanelView:function(e){return new t.scoreattack.view.RankingSharedStatusPanelView(e)},display:function(e){this._super.apply(this,arguments),this._showElementIcon(e)},_showElementIcon:function(e){var t=e.getBestRankingElement(),a=this._rootWidget.bfsWidgetByName("element_icon");if(i.isNumber(t)){var o="core/res/icon/elementicon_"+t+".png";a.loadTexture(o,n.Widget.PLIST_TEXTURE),a.setVisible(!0)}else a.setVisible(!1)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc.scoreattack=t.pc.scoreattack||{},t.pc.scoreattack.controller=t.pc.scoreattack.controller||{},t.pc.scoreattack.controller.QuestPageListController={_popups:{comQuestInfo:{factoryName:"popupFactoryComQuestInfo"}},__fillupQuestList:function(e,n,i,o,r){var s=e.seekWidgetByName(n);if(null!==s){var c=e.seekWidgetByName("scoreattack_quest_list_page_ui");null!==c&&c.removeFromParent();var u=this._initFuncPanel.bind(this);return a.all([o,r]).spread(function(e,n){this._in_progress_id=this._pickInProgressAQuestId(n.body);var a={targetNode:t.env.isSp?"questlist_base":"quest_base",touchEventFuncName:i};if($staticRes(res["scoreattack-scoreattack_quest-scoreattack_quest_list_page_ui"]),this._fillupList(s,{viewParent:"list_panel",subPageRes:t.PageListParams.SCOREATTACK_QUEST_LIST.subPageRes,panelsPerPage:t.PageListParams.SCOREATTACK_QUEST_LIST.perPage},e.body.data,e.body.max_record_count,a,u),0!==e.body.max_record_count){var o=s.seekWidgetByName("list_panel");return null===o?console.warn("[ERROR] You sould assign UIUtility role."):o.setVisible(!0),e.body}}.bind(this)).fail(function(e){console.error(e.stack)})}console.warn("[ERROR] Could not find a list parent node.")},_pickInProgressAQuestId:function(e){if(i.isEmpty(e)||i.isEmpty(e.in_progress))return null;var n=e.in_progress.own_quest;return i.isEmpty(n)?null:n.type!==t.scoreattack.WordBook.QUEST_TYPE?null:n.a_quest_id},_initFuncPanel:function(e,n){var a=e.seekWidgetByName("questimg");if(null!==a&&!i.isUndefined(n.quest_id)){var o=t.Img("questimg","scoreattack-quest",i.padZero(n.quest_id,4)).jpg;a.loadTexture(o)}var r=e.seekWidgetByName("quest_header_label");null===r||i.isUndefined(n.title)||r.setString(n.title);var s=e.seekWidgetByName("cons_ap_label");null===s||i.isUndefined(n.quest_ap)||s.setString("AP"+n.quest_ap);var c=e.seekWidgetByName("quest_reward");if(null!==c)if(n.is_cleared||i.isUndefined(n.reward_info)||i.isUndefined(n.reward_info.item_id))c.setVisible(!1);else{var u=t.Img("rewardicon","item",i.padZero(n.reward_info.item_id,4)).png;c.loadTexture(u),c.setVisible(!0)}var l=e.seekWidgetByName("quest_time_label");null!==l&&(i.isString(n.time_left)&&n.time_left.length>0?(l.setString(n.time_left),l.setVisible(!0)):l.setVisible(!1));var _=e.seekWidgetByName("img_quest_info_icon");_&&this._initQuestInfoIcon(_,n)},_initQuestInfoIcon:function(e,t){var n=e.getParent();if(!i.isUndefined(t.is_new)&&!i.isUndefined(t.is_cleared)){var a=t.is_new||t.is_cleared,o=t.is_new?"core/res/icon/queststatusicon_new.png":t.is_cleared?"core/res/icon/queststatusicon_clear.png":"";e.loadTexture(o,ccui.Widget.PLIST_TEXTURE),e.setVisible(a),n.setVisible(a),t.is_new?n.animate("new",!0):n.animate("default",!1)}t.in_progress&&(e.setVisible(!0),n.setVisible(!0),e.loadTexture("core/res/icon/queststatusicon_now.png",ccui.Widget.PLIST_TEXTURE),n.animate("default",!1))},__setBalloonButtonEventHandler:function(e,t){var i=function(e,i){if(i===ccui.Widget.TOUCH_ENDED){var a=n.director.getRunningScene();"event_quest_main"===t.type?this._showQInfoPopup(a,t):this._qCaution3Popup(a,t)}}.bind(this);e.addTouchEventListener(i)},_showQInfoPopup:function(e,t){var n=e.popups.comQuestInfo,a=t.title,o=t.limit_info,r="";if(!i.isEmpty(o)){var s=[];i.isNumber(o.elixir)&&o.elixir>=0&&s.push(0!==o.elixir?":"+o.elixir+"":""),i.isNumber(o.rank)&&o.rank>=0&&s.push("Rank "+t.limit_info.rank+""),i.isNumber(o.remaining_challenge_count)&&o.remaining_challenge_count>=0&&s.push("  "+t.limit_info.remaining_challenge_count+""),r="[] "+s.join("\n")}n.open({title:a,description:t.description,start_condition:r}).fail(function(e){console.error(e.stack)})},startQuest:function(e,n,i,a){var o=this._getRouterParams(e).event_id;t.pc.scoreattack.router.navigateStartQuest(n,i,a,o)},_updateOtherInformation:function(){var e=t.createInstance("apiAQuestInfo"),n=t.createInstance("myselfInfoRepository");return a.all([e.get(),n.getQuestPoints(),n.getMe()]).spread(function(e,t,n){this._questInfo=e.body,this._questPoints=t.getAsObject(),this._player=n.body}.bind(this)).fail(function(e){console.error(e)})},clearOwnQuest:function(){delete this._questInfo.in_progress.own_quest}},i.assign(t.pc.scoreattack.controller.QuestPageListController,t.pc.roles.CoreCardCommon,t.pc.list.roles.PageListControllerCommon)}((this||0).self||global),function(e){var t=e.kh;e.khutil,e.cc,e.ccui,e._,e.console,t.createNameSpaceIfNotExists("core.reward"),t.core.reward.RankingRewardModel=t.core.reward.RewardModel.extend({className:"RankingRewardModel",getRequireRank:function(){return this._rewardData.required_rank},getRewardStatus:function(){return!0===this._rewardData.undetermined?t.core.reward.REWARD_STATUS.UNDETERMINED:this._super.apply(this,arguments)}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=(e.ccui,e._),o=e.console;t.createNameSpaceIfNotExists("core.reward"),t.core.reward.RewardPageListController=i.Class.extend({className:"RewardPageListController",LIST_ITEM_CONTROLLER:"RewardController",LIST_PANEL_VIEW:"RewardPanelView",REWARD_MODEL:null,ctor:function(e,t){this._rewardPageListSettings=e.getSettings(),this._receiveRewardButtonTouchEventHandler=t},displayRewards:function(){return this._makePageList(this._rewardPageListSettings)},refresh:function(e){this._paginatorUI.refresh(e)},_makePageList:function(e){var i=n.getWidget(e.baseName,this._onNodeNotFound.bind(this));this._createPageListItems(e,i);var a=i.seekWidgetByName(e.panelName),o=new t.core.pager.view.page.BasePageUiFactory(a,this._onInitializeRewardPanel.bind(this)),r=t.core.pager.model.ApiDataListFactory(e.apiName,e.apiMethod,e.apiParams),s=new t.core.pager.controller.PagerController(i,r,[o],a),c=i.seekWidgetByName(e.paginatorNode)||i.seekWidgets(function(e){return"viewpage_ui"===e.getName()||"viewpage_s_ui"===e.getName()})[0];return new t.core.pager.view.button.ViewPageUi(c,s).initialize(),this._paginatorUI=s,a.setVisible(!0),s.initialize()},_createPageListItems:function(e,i){var o=n.getWidgetFromNode(i,e.panelName,this._onNodeNotFound.bind(this));this._pageListItems=a.map(o.getChildren(),function(e){e.setUserData({rewardController:t.createInstance(this.LIST_ITEM_CONTROLLER,[e,this.LIST_PANEL_VIEW,this.REWARD_MODEL])})}.bind(this))},_onInitializeRewardPanel:function(e,t){var n=e.getUserData().rewardController;return null==t?void n.clear():(n.initializeModel(t.getRawData()),n.displayPanel(),void n.initializeReceiveRewardButton(this._receiveRewardButtonTouchEventHandler))},_onNodeNotFound:function(e){o.warn(this.className+": "+e)}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=(e.ccui,e._);e.console,t.createNameSpaceIfNotExists("scoreattack.eventHandling"),t.scoreattack.eventHandling.ReceiveConfirmedEventHandler=t.core.reward.ReceiveRewardButtonTouchEventHandler.extend({className:"ReceiveConfirmedEventHandler",ctor:function(e,n){this._api=t.createInstance("apiAEvents"),this._eventId=e,this._isScore=!0===n},_receiveConfirmed:function(e){var a=n.director.getRunningScene();(this._isScore?this._api.receiveScoreattackReward(this._eventId,e.getRewardId()):this._api.receiveEventRankingReward(t.scoreattack.WordBook.EVENT_TYPE,this._eventId,e.getRewardId())).then(function(e){var t=e.body;if(!0===t.is_expired)return this._showExpiredPopup(a);var n=t.new_characters_gained;return i.isEmpty(n)?Q.resolve():this._showNewMemberPopups(n)}.bind(this)).then(function(){a._delegate._reload()})}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=(e.ccui,e._);e.console,t.createNameSpaceIfNotExists("scoreattack.settings"),t.scoreattack.settings.EventRewardPageListSetting=n.Class.extend({className:"EventRewardPageListSetting",ctor:function(e,t,n,i){this._eventId=t,this._baseName=e,this._currencyType=n,this._panelViewClass=i},SETTINGS:{panelName:"scoreattack_reward_list_page_ui",paginatorNode:"viewpage_ui",apiName:"apiAEvents",apiMethod:"getScoreattackRewards",apiParams:null,fillEmptyRecord:!1},getSettings:function(){return i.extend({},this.SETTINGS,{apiParams:[this._eventId,this._currencyType,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE],baseName:this._baseName,panelViewClass:this._panelViewClass})}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=(e.ccui,e._);e.console,t.createNameSpaceIfNotExists("scoreattack.settings"),t.scoreattack.settings.RankingRewardPageListSetting=n.Class.extend({className:"RankingRewardPageListSetting",ctor:function(e,t,n,i){this._eventId=t,this._baseName=e,this._rankingType=n,this._panelViewClass=i},SETTINGS:{panelName:"scoreattack_reward_list_page_ui",paginatorNode:"viewpage_ui",apiName:"apiAEvents",apiMethod:"getEventRankingRewards",apiParams:null,fillEmptyRecord:!1},getSettings:function(){return i.extend({},this.SETTINGS,{apiParams:[t.scoreattack.WordBook.EVENT_TYPE,this._rankingType,this._eventId,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE],baseName:this._baseName,panelViewClass:this._panelViewClass})}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc,e.ccui,e._,e.console);t.createNameSpaceIfNotExists("scoreattack.view"),t.scoreattack.view.RewardPanel=t.core.reward.RewardPanelView.extend({className:"RewardPanel",CORECARD_NODE_NAME:"corecard_ui",PRICE_LABEL_NAME:"requirement_label",PRICE_LABEL_TEXT:"{score}",RANK_LABEL_TEXT:"{rank_from}{rank_to}",REWARD_INFORMATION_LABEL_NAME:"reward_name_label",REWARD_INFORMATION_TEXT:"{itemName}x{rewardAmount}",REWARD_TYPE:"MUST Implement",display:function(e){this._setAppearance(),this._super(e)},_setAppearance:function(){switch(this.REWARD_TYPE){case t.scoreattack.enum.REWARD_TYPE.TOTAL_SCORE:this._rootNode.setAppearance("score");break;case t.scoreattack.enum.REWARD_TYPE.TOTAL_RANKING:this._rootNode.setAppearance("total");break;case t.scoreattack.enum.REWARD_TYPE.BEST_RANKING:this._rootNode.setAppearance("best");break;default:n.error("Unexpected REWARD_TYPE:"+this.REWARD_TYPE)}},_displayPrice:function(e){var n=this._getWidget(this.PRICE_LABEL_NAME);if(this.REWARD_TYPE!==t.scoreattack.enum.REWARD_TYPE.TOTAL_SCORE){var i=e.getRequireRank();"object"==typeof i&&(i=this.RANK_LABEL_TEXT.replace("{rank_from}",i.rank_from).replace("{rank_to}",i.rank_to)),n.setString(i)}else n.setString(this.PRICE_LABEL_TEXT.replace("{score}",e.getPrice()))}})}((this||0).self||global),function(e){var t=e.kh;e.khutil,e.cc,e.ccui,e._,e.console,t.createNameSpaceIfNotExists("scoreattack.view"),t.scoreattack.view.BestRankingRewardPanel=t.scoreattack.view.RewardPanel.extend({className:"BestRankingRewardPanel",REWARD_TYPE:t.scoreattack.enum.REWARD_TYPE.BEST_RANKING})}((this||0).self||global),function(e){var t=e.kh;e.khutil,e.cc,e.ccui,e._,e.console,t.createNameSpaceIfNotExists("scoreattack.view"),t.scoreattack.view.TotalRankingRewardPanel=t.scoreattack.view.RewardPanel.extend({className:"TotalRankingRewardPanel",REWARD_TYPE:t.scoreattack.enum.REWARD_TYPE.TOTAL_RANKING})}((this||0).self||global),function(e){var t=e.kh;e.khutil,e.cc,e.ccui,e._,e.console,t.createNameSpaceIfNotExists("scoreattack.view"),t.scoreattack.view.TotalScoreRewardPanel=t.scoreattack.view.RewardPanel.extend({className:"TotalScoreRewardPanel",REWARD_TYPE:t.scoreattack.enum.REWARD_TYPE.TOTAL_SCORE})}((this||0).self||global),function(e){var t=e.kh;e.khutil,e.cc,e.ccui,e._,e.console,t.createNameSpaceIfNotExists("scoreattack.controller"),t.scoreattack.controller.ScoreAttackRewardPageListController=t.core.reward.RewardPageListController.extend({className:"ScoreAttackRewardPageListController",REWARD_MODEL:t.core.reward.RankingRewardModel,ctor:function(e,t){this.LIST_PANEL_VIEW=e.getSettings().panelViewClass,this._super.apply(this,arguments)}})}((this||0).self||global),function(e){var t=e.kh;e.cc,e._,e.Q,t.pc.scoreattack=t.pc.scoreattack||{},t.pc.scoreattack.router={navigateTop:function(e){t.createInstance("router").navigate("scoreattack/scoreattack_top",{scoreattack_top:{event_id:e}})},navigateTopEnd:function(e){t.createInstance("router").navigate("scoreattack/scoreattack_top_end",{scoreattack_top_end:{event_id:e}})},navigateRanking:function(e){t.createInstance("router").navigate("scoreattack/scoreattack_ranking",{scoreattack_ranking:{event_id:e}})},navigateReward:function(e){t.createInstance("router").navigate("scoreattack/scoreattack_reward",{scoreattack_reward:{event_id:e}})},navigateQuest:function(e){t.createInstance("router").navigate("scoreattack/scoreattack_quest",{scoreattack_quest:{event_id:e}})},navigateStartQuest:function(e,n,i,a){t.createInstance("router").navigate("quest/q_002",{q_002:{target:"quest",quest_id:e.quest_id,owner_account_id:e.owner_account_id,event_id:a,quest_type:e.type,episode_num:n,recommended_element_type:i}})},playEpisode:function(e,n){t.createInstance("router").navigate("scenario/episode-play",{"scenario/play":{episode_id:n,returnBackParams:{scene:"scoreattack/scoreattack_top",routerParams:{scoreattack_top:{event_id:e}},temporaryRouterParams:{playedEpisode:!0}}}})}}}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.scoreattack=t.pc.scoreattack||{},t.pc.scoreattack.scoreattack_quest=t.pc.scoreattack.scoreattack_quest||{},t.pc.scoreattack.scoreattack_quest.Scene=t.BaseScene.extend({resourceFileName:"scoreattack_quest/scoreattack_quest.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"scoreattack",sceneName:"scoreattack_quest",_delegate:null,_init:function(){this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc=t.pc||{},t.pc.scoreattack=t.pc.scoreattack||{},t.pc.scoreattack.scoreattack_quest=t.pc.scoreattack.scoreattack_quest||{},t.pc.scoreattack.scoreattack_quest.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../scoreattack_popup_ui.json"],_popups:{comBackCheck:{factoryName:"popupFactoryComBackCheck"}},onSceneInit:function(e){this._setBackBtn(e);var n=t.Img("scoreattack-bg","event",i.padZero(this._eventId,4)).jpg;return e.seekWidgetByName("scoreattack-bg").loadTexture(n),this.questCommonDelegate=t.createInstance("questSceneCommonDelegate"),this.questCommonDelegate.owner=e,a.all([this._aQuestPromise.spread(function(t){this.__fillupQuestList(e,"window_gray","_touchQuestPanel",t,{body:this._questInfo})}.bind(this)),t.createInstance("scoreAttackEventDetail").getPromise().then(function(t){var n=e.seekWidgetByName("Scene");return this._showRuleExplain(n,t)}.bind(this))]).fail(function(e){e&&console.error(e)})},onSceneEnter:function(e){return this._eventId=this._getRouterParams(e).event_id,t.createInstance("router").permanentlyRemoveRouterParam("payment_id"),t.createInstance("popupFactoryComNeedApBp2").setEventId(this._eventId),this._aQuestPromise=a.all([t.createInstance("apiAQuests").getListEventQuest(this._eventId,t.scoreattack.WordBook.QUEST_TYPE),this._updateOtherInformation()]),a.resolve()},onSceneExit:function(e){return this._aQuestPromise=null,a.resolve()},onPageInAnimationEnd:function(e){return a.defer(),a.resolve()},_getRouterParams:function(e){return e.routerParams.scoreattack_quest||{}},btnCallbackBtnBackEventTop:function(e){return this._touchEndedBackBtnProcess(e),a.reject(this._override)},_showRuleExplain:function(e,t){e.bfsWidgetByName("rule_label").setString(t.getRuleDescription()),e.bfsWidgetByName("title_label").setString(t.getRuleName())},_touchQuestPanel:function(e,t){this.questCommonDelegate.restartCheckInProgressQuest(t,this._questInfo)||this.startCheckQuestState(n.director.getRunningScene(),t)},update:function(){t.createInstance("sceneManager").reloadScene()},_touchEndedBackBtnProcess:function(e){t.pc.scoreattack.router.navigateTop(this._getRouterParams(e).event_id)}}),t.assignRoles(t.pc.scoreattack.scoreattack_quest.SceneDelegate,[t.pc.scoreattack.controller.QuestPageListController,t.pc.quest.roles.QuestStart,t.pc.quest.roles.QuestSelectCommon.methods,t.pc.quest.roles.QuestSelectCommon.popups])}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.scoreattack=t.pc.scoreattack||{},t.pc.scoreattack.scoreattack_ranking=t.pc.scoreattack.scoreattack_ranking||{},t.pc.scoreattack.scoreattack_ranking.Scene=t.BaseScene.extend({resourceFileName:"scoreattack_ranking/scoreattack_ranking.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[{tab1:{node:"tab_0","content-node":"tab_0_node"},tab2:{node:"tab_1","content-node":"tab_1_node"}}],componentName:"scoreattack",sceneName:"scoreattack_ranking",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_ranking_reward","btnCallbackBtnRankingReward",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"scoreattack/scoreattack_reward")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_rule","btnCallbackBtnRule",null,function(e){return t.ImplantedPopup.createOrGet(this,"scoreattack_ranking_rule",void 0).open()}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_info","btnCallbackBtnInfo",null,function(){alert("{{scoreattack_score_detail}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._),i=e.Q;t.pc=t.pc||{},t.pc.scoreattack=t.pc.scoreattack||{},t.pc.scoreattack.scoreattack_ranking=t.pc.scoreattack.scoreattack_ranking||{},t.pc.scoreattack.scoreattack_ranking.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../scoreattack_popup_ui.json"],_popups:{},onSceneInit:function(e){this._setBackBtn(e);var i=t.Img("scoreattack-bg","event",n.padZero(this._eventId,4)).jpg;return e.seekWidgetByName("scoreattack-bg").loadTexture(i),this._rankingController={},t.createInstance("scoreAttackEventDetail").getPromise().then(function(t){var n=e.seekWidgetByName("Scene");this._setNewRewardIcon(n,t)}.bind(this))},onSceneEnter:function(e){return this._eventId=this._getRouterParams(e).event_id,t.createInstance("apiAEvents").setEventIdDelegate(this._eventId),t.createInstance("apiAEvents").getLastEventRankingUpdate(t.scoreattack.WordBook.EVENT_TYPE,this._eventId).then(this._setLastUpdateTime.bind(this,e)),t.createInstance("apiAPlayers").get("me").then(this._setUserInformation.bind(this,e)).fail(this._handleError),i.resolve()},onSceneExit:function(e){return i.resolve()},onPageInAnimationEnd:function(e){return i.resolve()},tabCallbackTab0:function(e){t.createInstance("scoreAttackEventDetail").getPromise().then(this._showCurrentScore.bind(this,e,t.scoreattack.enum.RANKING_TYPE.TOTAL)),this._showRanking(t.scoreattack.enum.RANKING_TYPE.TOTAL)},tabCallbackTab1:function(e){t.createInstance("scoreAttackEventDetail").getPromise().then(this._showCurrentScore.bind(this,e,t.scoreattack.enum.RANKING_TYPE.BEST)),this._showRanking(t.scoreattack.enum.RANKING_TYPE.BEST)},_showCurrentScore:function(e,n,i){var a,o,r=e.seekWidgetByName("score_base"),s=i.getCurrentScoreDetail();n===t.scoreattack.enum.RANKING_TYPE.TOTAL?(a=s.getTotalRankingScore(),o=s.getTotalRank()):(a=s.getBestRankingScore(),o=s.getBestRank());var c=o!==t.scoreattack.enum.HAS_NOT_SCORE;r.bfsWidgetByName("ranking_label").setVisible(c),r.bfsWidgetByName("ranking_hyphen").setVisible(!c),r.setStrings({score_label:a,ranking_label:o})},_showRanking:function(e){if(this._rankingController){if(this._rankingController[e])return void this._rankingController[e].refresh();var n=new t.scoreattack.controller.RankingPageListController(e);this._rankingController[e]=n,n.showRanking()}},btnCallbackBtnRankingReward:function(e){return t.pc.scoreattack.router.navigateReward(this._getRouterParams(e).event_id),i.reject(this._override)},btnCallbackBtnRule:function(e){var t=i.defer();return t.resolve(),t.promise},btnCallbackBtnInfo:function(e){return t.createInstance("scoreAttackEventDetail").getPromise().then(function(n){t.ImplantedPopup.createOrGet(e,"scoreattack_score_detail").open(n,n.getCurrentScoreDetail())}),i.reject(this._override)},_setUserInformation:function(e,i){var a=i.body;e.setStrings({name_label:a.name});var o=e.seekWidgetByName("illust-com-kneeshot-job");if(null!==o){var r=t.Img("illust-com-kneeshot","job",n.padZero(a.job_info.job_id,4),0).png;o.loadTexture(r)}},_setLastUpdateTime:function(e,t){var n=t.body;n.last_update_time&&e.seekWidgetByName("header_sub_label").setString(""+n.last_update_time)},_setNewRewardIcon:function(e,t){e.seekWidgetByName("new_icon").setVisible(t.hasExchangeableRankingReward())},_getRouterParams:function(e){return e.routerParams.scoreattack_ranking||{}},btnCallbackBtnBackEventTop:function(e){return this._touchEndedBackBtnProcess(e),i.reject(this._override)},_touchEndedBackBtnProcess:function(e){t.createInstance("scoreAttackEventDetail").getPromise().then(function(n){return n.isReceiveReward()?void t.pc.scoreattack.router.navigateTopEnd(this._getRouterParams(e).event_id):void t.pc.scoreattack.router.navigateTop(this._getRouterParams(e).event_id)}.bind(this)).fail(function(e){e&&console.error(e)})}})}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.scoreattack=t.pc.scoreattack||{},t.pc.scoreattack.scoreattack_reward=t.pc.scoreattack.scoreattack_reward||{},t.pc.scoreattack.scoreattack_reward.Scene=t.BaseScene.extend({resourceFileName:"scoreattack_reward/scoreattack_reward.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[{tab1:{node:"tab_0","content-node":"tab_0_node"},tab2:{node:"tab_1","content-node":"tab_1_node"},tab3:{node:"tab_2","content-node":"tab_2_node"}}],componentName:"scoreattack",sceneName:"scoreattack_reward",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_present","btnCallbackBtnPresent",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"present/prs_001")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_receive","btnCallbackBtnReceive",null,function(){alert("{{prs_receive_check_result}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc=t.pc||{},t.pc.scoreattack=t.pc.scoreattack||{},t.pc.scoreattack.scoreattack_reward=t.pc.scoreattack.scoreattack_reward||{},t.pc.scoreattack.scoreattack_reward.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../scoreattack_popup_ui.json"],_popups:{},_tabToRequiredItemTable:[{tabIndex:0,baseNodeName:"tab_0_node",panelViewClass:t.scoreattack.view.TotalScoreRewardPanel,itemName:t.scoreattack.enum.REWARD_TYPE.TOTAL_SCORE,isTotalScore:!0},{tabIndex:1,baseNodeName:"tab_1_node",panelViewClass:t.scoreattack.view.TotalRankingRewardPanel,itemName:t.scoreattack.enum.REWARD_TYPE.TOTAL_RANKING,rankingType:t.scoreattack.enum.RANKING_TYPE.TOTAL},{tabIndex:2,baseNodeName:"tab_2_node",panelViewClass:t.scoreattack.view.BestRankingRewardPanel,itemName:t.scoreattack.enum.REWARD_TYPE.BEST_RANKING,rankingType:t.scoreattack.enum.RANKING_TYPE.BEST}],onSceneInit:function(e){this._setBackBtn(e),this._rewardPageListController={};var n=t.Img("scoreattack-bg","event",i.padZero(this._eventId,4)).jpg;return e.seekWidgetByName("scoreattack-bg").loadTexture(n),this._fillupRewardsList(e,this._eventId,0),t.createInstance("scoreAttackEventDetail").getPromise().then(function(t){this._toggleNotifyIconOfTabs(e,t),e.seekWidgetByName("limit_label").setString(""+t.getRewardReceiptDeadline()+""),e.seekWidgetByName("attention_label").setVisible(!t.isReceiveReward()),this._showBalloonMessage(e,t)}.bind(this)),a.resolve()},onSceneEnter:function(e){return this._eventId=this._getRouterParams(e).event_id,a.resolve()},onSceneExit:function(e){return a.resolve()},onPageInAnimationEnd:function(e){return a.defer(),a.resolve()},tabCallbackTab0:function(e){this._fillupRewardsList(e,this._getEventId(),0)},tabCallbackTab1:function(e){this._fillupRewardsList(e,this._getEventId(),1)},tabCallbackTab2:function(e){this._fillupRewardsList(e,this._getEventId(),2)},btnCallbackBtnReceive:function(e){return this._receiveAllPresent(),a.reject(this._override)},_getRouterParams:function(e){return e.routerParams.scoreattack_reward||{}},btnCallbackBtnBackEventTop:function(e){return this._touchEndedBackBtnProcess(e),a.reject(this._override)},_touchEndedBackBtnProcess:function(e){t.createInstance("scoreAttackEventDetail").getPromise().then(function(n){return n.isReceiveReward()?void t.pc.scoreattack.router.navigateTopEnd(this._getRouterParams(e).event_id):void t.pc.scoreattack.router.navigateTop(this._getRouterParams(e).event_id)}.bind(this)).fail(function(e){e&&console.error(e)})},_showBalloonMessage:function(e,t){var n;n=t.isReceiveReward()?"\n":"\n",e.seekWidgetByName("balloon_label").setString(n)},_showNewMemberPopup:function(e){var a;i.isArray(e)?a=e.shift():(a=e,e=[]);var o=n.director.getRunningScene().popups.comNewMember;o.open().then(function(n){this._setCharacterCoreCardElementRarity(o,a,"corecard_chara_ui");var i=o.seekWidgetByName("party_join_label");null!==i&&i.setString(a.name+"\n"),t.setTouchEventHandlers(o,{"TOUCH_ENDED black_btn":function(){o.dismiss(),e.length>0&&this._showNewMemberPopup(e)}.bind(this)},this)}.bind(this))},_receiveAllPresent:function(){var e=this._getEventId();(i.find(this._tabToRequiredItemTable,{itemName:this._currentType}).isTotalScore?t.createInstance("apiAEvents").receiveAllScoreattackRewards(e,this._currentType):t.createInstance("apiAEvents").receiveAllEventRankingRewards(t.scoreattack.WordBook.EVENT_TYPE,e,this._currentType)).then(function(e){var t=e.body;this._reload();this._receiveAllPresentShowResult(t.received_info,t.not_received_info,"\r\n").then(function(){var e=t.new_character_gained_list;i.isEmpty(e)||this._showNewMemberPopup(e)}.bind(this))}.bind(this)).fail(function(e){console.error(e.stack)})},_reload:function(){var e=n.director.getRunningScene();t.createInstance("notificationCenter").dispatchEvent(t.core.pager.controller.PagerController.prototype.REFRESH_EVENT,[]);var i=this._getEventId();t.createInstance("scoreAttackEventDetail").prepare(i).then(function(t){this._toggleNotifyIconOfTabs(e,t),this._updateReceiveAllButton(e)}.bind(this))},_updateReceiveAllButton:function(e){var a=e.seekWidgetByName("btn_receive");null===a||i.isUndefined(this._currentType)||t.createInstance("scoreAttackEventDetail").getPromise().then(function(e){var t=e.hasExchangeableReward(this._currentType);a.setEnabled(t),a.setColor(t?n.color.WHITE:n.color("#808080"))}.bind(this))},_showCurrentScore:function(e,n){t.createInstance("scoreAttackEventDetail").getPromise().then(function(i){var a=i.getCurrentScoreDetail(),o=e.seekWidgetByName("info_base"),r=o.seekWidgetByName("title_label"),s=o.seekWidgetByName("num_label"),c=o.seekWidgetByName("hyphen");if(n.itemName===t.scoreattack.enum.REWARD_TYPE.TOTAL_SCORE)return s.setString(a.getTotalGroundScore()),r.setString(""),s.setVisible(!0),void c.setVisible(!1);var u=this._getRank(n.itemName,a);return r.setString(""),u===t.scoreattack.enum.HAS_NOT_SCORE?(s.setVisible(!1),void c.setVisible(!0)):(s.setString(u.toString()),s.setVisible(!0),void c.setVisible(!1))}.bind(this))},_getRank:function(e,n){switch(e){case t.scoreattack.enum.REWARD_TYPE.TOTAL_RANKING:return n.getTotalRank();case t.scoreattack.enum.REWARD_TYPE.BEST_RANKING:return n.getBestRank();default:console.error("Unexpected REWARD_TYPE:"+e)}},_fillupRewardsList:function(e,n,a){if(this._rewardPageListController){var o=i.find(this._tabToRequiredItemTable,{tabIndex:a});if(this._currentType=o.itemName,this._updateReceiveAllButton(e),this._showCurrentScore(e,o),this._rewardPageListController[a])return void this._rewardPageListController[a].refresh();var r,s=!0===o.isTotalScore;r=s?new t.scoreattack.settings.EventRewardPageListSetting(o.baseNodeName,n,o.itemName,o.panelViewClass):new t.scoreattack.settings.RankingRewardPageListSetting(o.baseNodeName,n,o.rankingType,o.panelViewClass);var c=new t.scoreattack.eventHandling.ReceiveConfirmedEventHandler(n,s),u=new t.scoreattack.controller.ScoreAttackRewardPageListController(r,c);u.displayRewards(),this._rewardPageListController[a]=u}},_toggleNotifyIconOfTabs:function(e,t){this._hideAllTabIcon(e),i.each(this._tabToRequiredItemTable,function(n){var i=this._getIconNode(e,n.tabIndex),a=t.hasExchangeableReward(n.itemName);null!==i&&a&&i.setVisible(!0)},this)},_hideAllTabIcon:function(e){i.each(this._tabToRequiredItemTable,function(t){var n=this._getIconNode(e,t.tabIndex);null!==n&&n.setVisible(!1)},this)},_getIconNode:function(e,t){return e.seekWidgetByName("icon_"+t)},_getEventId:function(){return this._eventId},btnCallbackBtnPresent:function(e){return t.createInstance("router").navigate("present/prs_001",{},{prs_001_002_003:{returnRoute:"scoreattack/scoreattack_reward"}}),a.reject(this._override)}}),t.assignRoles(t.pc.scoreattack.scoreattack_reward.SceneDelegate,[t.pc.roles.UIUtility,t.pc.roles.ShInfoPopupInvoker,t.pc.present.roles.PresentPopups])}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.scoreattack=t.pc.scoreattack||{},t.pc.scoreattack.scoreattack_top=t.pc.scoreattack.scoreattack_top||{},t.pc.scoreattack.scoreattack_top.Scene=t.BaseScene.extend({resourceFileName:"scoreattack_top/scoreattack_top.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"scoreattack",sceneName:"scoreattack_top",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_quest","btnCallbackBtnQuest",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"scoreattack/scoreattack_quest")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_ranking","btnCallbackBtnRanking",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"scoreattack/scoreattack_ranking")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_interchange","btnCallbackBtnInterchange",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"scoreattack/scoreattack_reward")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_info","btnCallbackBtnInfo",null,function(){alert("{{scoreattack_score_detail}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_explain","btnCallbackBtnExplain",null,function(){alert("{{}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc=t.pc||{},t.pc.scoreattack=t.pc.scoreattack||{},t.pc.scoreattack.scoreattack_top=t.pc.scoreattack.scoreattack_top||{},t.pc.scoreattack.scoreattack_top.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../scoreattack_popup_ui.json"],_popups:{},onSceneInit:function(e){this._setBackBtn(e);var n=t.Img("scoreattack-top-bg","event",i.padZero(this._eventId,4)).jpg;return e.seekWidgetByName("scoreattack-top-bg").loadTexture(n),t.createInstance("scoreAttackEventDetail").getPromise().then(function(n){return n.isFirstAccess()?e.temporaryRouterParams.playedEpisode?(n.update(),this.btnCallbackBtnExplain(e),n):t.createInstance("apiAEvents").getScoreattackHasAccessed().then(function(i){return i.body.result?(n.update(),this.btnCallbackBtnExplain(e),n):(t.pc.scoreattack.router.playEpisode(n.getEventId(),n.getEpisodeId()),a.defer().promise)}.bind(this)):n}.bind(this)).then(function(t){var n=e.seekWidgetByName("Scene"),i=t.getCurrentScoreDetail();n.setStrings({total_score:i.getTotalLatestScore(),best_score:i.getBestLatestScore()}),n.bfsWidgetByName("interchange_new_icon").setVisible(t.hasExchangeableReward())}.bind(this))},onSceneEnter:function(e){this._eventId=this._getRouterParams(e).event_id;var o=t.Img("scoreattack-top-bg","event",i.padZero(this._eventId,4)).jpg;return n.textureCache.addImage(o),t.createInstance("scoreAttackEventDetail").getPromise(),a.resolve()},onSceneExit:function(e){return a.defer(),a.resolve()},onPageInAnimationEnd:function(e){return a.defer(),a.resolve()},btnCallbackBtnQuest:function(e){return t.pc.scoreattack.router.navigateQuest(this._getRouterParams(e).event_id),a.reject(this._override)},btnCallbackBtnRanking:function(e){return t.pc.scoreattack.router.navigateRanking(this._getRouterParams(e).event_id),a.reject(this._override)},btnCallbackBtnInterchange:function(e){return t.pc.scoreattack.router.navigateReward(this._getRouterParams(e).event_id),a.reject(this._override)},btnCallbackBtnInfo:function(e){return t.createInstance("scoreAttackEventDetail").getPromise().then(function(n){t.ImplantedPopup.createOrGet(e,"scoreattack_score_detail").open(n,n.getCurrentScoreDetail())}),a.reject(this._override)},btnCallbackBtnExplain:function(e){var n=t.ImplantedPopup.createOrGet(e,"sub_tutorial","ImplantedSubTutorialPopup");return t.createInstance("scoreAttackEventDetail").getPromise().then(function(e){n.open("scoreattack",e.getDescriptionImages().length)}),a.reject(this._override)},_getRouterParams:function(e){return e.routerParams.scoreattack_top||{}},_touchEndedBackBtnProcess:function(e){t.createInstance("router").navigate("event/ev_000")}})}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.scoreattack=t.pc.scoreattack||{},t.pc.scoreattack.scoreattack_top_end=t.pc.scoreattack.scoreattack_top_end||{},t.pc.scoreattack.scoreattack_top_end.Scene=t.BaseScene.extend({resourceFileName:"scoreattack_top_end/scoreattack_top_end.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"scoreattack",sceneName:"scoreattack_top_end",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_ranking","btnCallbackBtnRanking",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"scoreattack/scoreattack_ranking")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_interchange","btnCallbackBtnInterchange",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"scoreattack/scoreattack_reward")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_info","btnCallbackBtnInfo",null,function(){alert("{{scoreattack_score_detail}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._),i=e.Q;t.pc=t.pc||{},t.pc.scoreattack=t.pc.scoreattack||{},t.pc.scoreattack.scoreattack_top_end=t.pc.scoreattack.scoreattack_top_end||{},t.pc.scoreattack.scoreattack_top_end.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../scoreattack_popup_ui.json"],_popups:{},onSceneInit:function(e){this._setBackBtn(e);var i=t.Img("scoreattack-top-end-bg","event",n.padZero(this._eventId,4)).jpg;return e.seekWidgetByName("scoreattack-top-end-bg").loadTexture(i),t.createInstance("scoreAttackEventDetail").getPromise().then(function(t){var n=e.seekWidgetByName("Scene"),i=t.getCurrentScoreDetail();n.setStrings({total_score:i.getTotalLatestScore(),best_score:i.getBestLatestScore()}),n.bfsWidgetByName("interchange_new_icon").setVisible(t.hasExchangeableReward()),n.bfsWidgetByName("ranking_new_icon").setVisible(t.hasExchangeableRankingReward())}.bind(this))},onSceneEnter:function(e){return this._eventId=this._getRouterParams(e).event_id,i.resolve()},onSceneExit:function(e){return i.resolve()},onPageInAnimationEnd:function(e){return i.defer(),i.resolve()},btnCallbackBtnRanking:function(e){return t.pc.scoreattack.router.navigateRanking(this._getRouterParams(e).event_id),i.reject(this._override)},btnCallbackBtnInterchange:function(e){return t.pc.scoreattack.router.navigateReward(this._getRouterParams(e).event_id),i.reject(this._override)},btnCallbackBtnInfo:function(e){return t.createInstance("scoreAttackEventDetail").getPromise().then(function(n){t.ImplantedPopup.createOrGet(e,"scoreattack_score_detail").open(n,n.getCurrentScoreDetail())}),i.reject(this._override)},_getRouterParams:function(e){return e.routerParams.scoreattack_top_end||{}},_touchEndedBackBtnProcess:function(e){t.createInstance("router").navigate("event/ev_000")}})}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.scoreattack=t.pc.scoreattack||{},t.pc.scoreattack.scoreattack_top_notice=t.pc.scoreattack.scoreattack_top_notice||{},t.pc.scoreattack.scoreattack_top_notice.Scene=t.BaseScene.extend({resourceFileName:"scoreattack_top_notice/scoreattack_top_notice.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"scoreattack",sceneName:"scoreattack_top_notice",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_explain","btnCallbackBtnExplain",null,function(){alert("{{}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._),i=e.Q;t.pc=t.pc||{},t.pc.scoreattack=t.pc.scoreattack||{},t.pc.scoreattack.scoreattack_top_notice=t.pc.scoreattack.scoreattack_top_notice||{},t.pc.scoreattack.scoreattack_top_notice.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../scoreattack_popup_ui.json"],_popups:{},onSceneInit:function(e){this._setBackBtn(e),this._eventId=this._getRouterParams(e).event_id;var a=t.Img("scoreattack-top-notice-bg","event",n.padZero(this._eventId,4)).jpg;return e.seekWidgetByName("scoreattack-top-notice-bg").loadTexture(a),i.resolve()},onSceneEnter:function(e){return i.resolve()},onSceneExit:function(e){return i.resolve()},onPageInAnimationEnd:function(e){return i.defer(),i.resolve()},btnCallbackBtnExplain:function(e){var n=t.ImplantedPopup.createOrGet(e,"sub_tutorial","ImplantedSubTutorialPopup");return(this._eventPromise||(this._eventPromise=t.createInstance("apiEvents").getScoreAttackNotice(this._eventId))).then(function(e){n.open("scoreattack",e.body.description_images.length)}).fail(function(e){e&&console.error(e)}),i.reject(this._override)},_getRouterParams:function(e){return e.routerParams.scoreattack_top_notice||{}},_touchEndedBackBtnProcess:function(e){t.createInstance("router").navigate("mypage")}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.router=n.router||{},n.router.routes=n.router.routes||{},t.merge(n.router.routes,{scoreattack:{"scoreattack/scoreattack_quest":"scoreattack_quest","scoreattack/scoreattack_ranking":"scoreattack_ranking","scoreattack/scoreattack_reward":"scoreattack_reward","scoreattack/scoreattack_top":"scoreattack_top","scoreattack/scoreattack_top_end":"scoreattack_top_end","scoreattack/scoreattack_top_notice":"scoreattack_top_notice"}})}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="ASerialCodes",o="/a_serial_codes",r={getStatus:function(){return this._http.get({url:o+"/me/status"})},post:function(e){return this._http.post({url:o,json:{input_code:e}})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiASerialCodes",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},r)),n.env.useApiMock){n.MockApi=n.MockApi||{};var s={};t.each(r,function(e,t){s[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi."+a+"."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},s))}if("undefined"!=typeof process&&"undefined"!=typeof require){var c=require("fs"),u=c.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(r,function(e,t){var n="./mock/"+(t+="JSON")+".js";return c.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void c.writeFileSync(n,u.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);e.Q,t.pc.roles=t.pc.roles||{},t.pc.roles.CoreCardCommon={_setProperCoreCardElementRarity:function(e,t,n){var i;switch(khutil.getCoreCardDINameByRecord(t)){case"CoreCardJobUI":i="e";break;case"CoreCardWeaponUI":case"CoreCardSummonUI":case"CoreCardCharacterUI":case"CoreCardAccessoryUI":i="e_r";break;default:i="plain"}return this._setProperCoreCard(e,t,n,i)},_setProperCoreCard:function(e,i,a,o){var r=khutil.getCoreCardDINameByRecord(i),s=e.seekWidgetByName(a||"corecard_ui"),c=s.getUserData()||{};n.invoke(c,"setVisible",!1);var u=c[r];return u instanceof t.CoreCardUI?(u.setData(i),u.setVisible(!0),u):((u=t.createInstance(r,[o])).setData(i),s.addChild(u.getResult()),c[r]=u,s.setUserData(c),u)},_setCharacterCoreCard:function(e,t,n){return this._setupCoreCard(e,t,n,"plain","character")},_setCharacterCoreCardElementRarity:function(e,t,n){return this._setupCoreCard(e,t,n,"e_r","character")},_setCharacterCoreCardFull:function(e,t,n){return this._setupCoreCard(e,t,n,"full","character")},_setWeaponCoreCardElementRarity:function(e,t,n){return this._setupCoreCard(e,t,n,"e_r","weapon")},_setWeaponCoreCardFull:function(e,t,n){return this._setupCoreCard(e,t,n,"full","weapon")},_setJobCoreCard:function(e,t,n){return this._setupCoreCard(e,t,n,"e","job")},_setSummonCoreCardElementRarity:function(e,t,n){return this._setupCoreCard(e,t,n,"e_r","summon")},_setSummonCoreCardFull:function(e,t,n){return this._setupCoreCard(e,t,n,"full","summon")},_setAccessoryCoreCardElementRarity:function(e,t,n){return this._setupCoreCard(e,t,n,"e_r","accessory")},_setAccessoryCoreCardFull:function(e,t,n){var i=this._setupCoreCard(e,t,n,"full","accessory");return i.setTotalLabel(" "+(t.hp+t.attack)),i},_setItemCoreCard:function(e,t,n){return this._setupCoreCard(e,t,n,"plain","item")},_setPackageItemCoreCard:function(e,t,n){return this._setupCoreCard(e,t,n,"plain","package")},_setItemCoreCardAmount:function(e,t,n){return this._setupCoreCard(e,t,n,"amount","item")},_setupCoreCard:function(e,t,n,i,a){var o=e.seekWidgetByName(n||"corecard_ui");if(null==o)throw new Error("_setupCoreCard: targetNode Not Found:"+n);var r=a?khutil.getCoreCardDINameByKind(a):khutil.getCoreCardDINameByRecord(t),s=this._createOrGetCoreCardUI(r,o,i);return s.setData(t,null,"CoreCardCommon"),s.setVisible(!0),o.setVisible(!0),s},_createOrGetCoreCardUI:function(e,i,a){var o=i.getUserData()||{};if(o instanceof t.CoreCardUI)return o;var r=i.getActionManager().getActionByTag(i.tag,i);if(r&&r.animationInfo&&r.animationInfo[a]){if(s=t.createInstance(e,[a,i]),i.setUserData(s),null!=i.seekWidgetByName(s.IMG_NODE_NAME))return s;i.removeAllChildrenWithCleanup(!0)}var s,c=n.find(i.getChildren(),function(e){return e.getActionByTag(e.tag)});return c?(s=t.createInstance(e,[a,c]),i.setUserData(s),s):(s=t.createInstance(e,[a]),i.addChild(s.getResult()),i.setUserData(s),s)}}}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.pc.serial=t.pc.serial||{},t.pc.serial.model=t.pc.serial.model||{},t.pc.serial.model.SerialCode=t.EventSubject.extend({EVENT_PREFIX:"serial_code",EVENT_NAME:{PROPERTY_CHANGED:"property_changed"},_apiSerialCodes:null,_status:{is_locked:!1,unlocked_at:null},_inputCode:"",_serialCodeRegex:null,_isConnecting:!1,ctor:function(){this._super(),this._apiSerialCodes=t.createInstance("apiASerialCodes"),this._serialCodeRegex=new RegExp(".{1,16}")},prepare:function(){return new Promise((e,t)=>e(this))},sendSerialCode:function(){return this._setIsConnecting(!0),this._apiSerialCodes.post(this._inputCode).then(function(e){return this._setIsConnecting(!1),this._setStatus(e.body),e.body}.bind(this)).fail(function(e){console.error(e.stack)})},canSendSerialCode:function(){return!this._isLocked()&&!this._isConnecting&&this._isInputValid()},setInputCode:function(e){this._inputCode=e,this._notifyPropertyChanged()},_setStatus:function(e){this._status=e,this._notifyPropertyChanged()},_setIsConnecting:function(e){this._isConnecting=e,this._notifyPropertyChanged()},_notifyPropertyChanged:function(){this.dispatchEvent("PROPERTY_CHANGED")},_isInputValid:function(){return this._inputCode.match(this._serialCodeRegex)},_isLocked:function(){if(!this._status.lock_info)return!1;if(!this._status.lock_info.is_locked)return!1;var e=this._getUnlockDate();if(null===e)return!0;var t=new Date;return e.getTime()-t.getTime()>0},_getUnlockDate:function(){return this._status&&this._status.lock_info&&this._status.lock_info.unlocked_at?new Date(this._status.lock_info.unlocked_at):null}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.pc.serial=t.pc.serial||{},t.pc.serial.view=t.pc.serial.view||{},t.pc.serial.view.SerialCodeSendButton=t.SceneObject.extend({_buttonNode:null,ctor:function(e,t){this._buttonNode=e.seekWidgetByName(t)},setEnabled:function(e){this._buttonNode.setEnabled(e),e?this._buttonNode.setColor(cc.color("#FFFFFF")):this._buttonNode.setColor(cc.color("#808080"))}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);e.Q,t.pc.serial=t.pc.serial||{},t.pc.serial.roles=t.pc.serial.roles||{},t.pc.serial.roles.Routing={_verifyRouterParams000:function(e){},_navigateToPresentPage:function(){t.createInstance("router").navigate("present")},_navigateToMy001:function(){t.createInstance("router").navigate("epi/epi_001")}},n.assign(t.pc.serial.roles.Routing,t.pc.roles.RoutingCommon)}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.serial=t.pc.serial||{},t.pc.serial.seri_000=t.pc.serial.seri_000||{},t.pc.serial.seri_000.Scene=t.BaseScene.extend({resourceFileName:"seri_000/seri_000.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"serial",sceneName:"seri_000",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_serial_form","btnCallbackBtnSerialForm",null,function(){alert("{{seri_send_result}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc=t.pc||{},t.pc.serial=t.pc.serial||{},t.pc.serial.seri_000=t.pc.serial.seri_000||{},t.pc.serial.seri_000.SceneDelegate=t.pc.BaseSceneDelegate.extend({_popups:{comNewMember:{factoryName:"popupFactoryPopupCommon",resourceName:"core-popup-com_new_member",title:"",buttonLabels:{blackBtn:""},buttons:{blackBtn:function(e){this.dismiss()}}}},_khSerialCode:null,_editBox:null,_sendButton:null,onSceneInit:function(e){return a.defer(),this._khSerialCode=t.createInstance("serialCode"),this._setBackBtn(e),this._initSendButton(e),this._khSerialCode.prepare().fail(function(e){console.error(e)})},onSceneEnter:function(e){return a.defer(),a.resolve()},onSceneExit:function(e){return a.defer(),this._khSerialCode.removeEventListenersByEventName("PROPERTY_CHANGED"),a.resolve()},onPageInAnimationEnd:function(e){return a.defer(),this._initEditBox(e),a.resolve()},btnCallbackBtnSerialForm:function(e){var t=a.defer();return t.reject(this._override),this._khSerialCode.canSendSerialCode()?(this._khSerialCode.sendSerialCode().then(this._onSendSerialCodeComplete.bind(this)).fail(function(e){console.error(e)}),t.promise):t.promise},_onSendSerialCodeComplete:function(e){this._editBox.setVisible(!1),e.is_success?this._onSendSerialCodeSuccess(e):this._onSendSerialCodeError(e)},_onSendSerialCodeSuccess:function(e){var t=i.filter(e.gifts_info,function(e){return"character"===e.type&&e.is_new}),a="",o="\n",r=n.director.getRunningScene();return 0===t.length?void r._openMessagePopup({title:a,content:o,buttons:[["blueBtn","OK",!0]]}).then(this._navigateToPresentPage.bind(this)):void r._openMessagePopup({title:a,content:o,buttons:[["blueBtn","OK",!0]]}).then(function(){this._openComNewMemberPopups(t)}.bind(this))},_openComNewMemberPopups:function(e){var t=e.length,n=a.defer();if(0===t)return n.resolve(),n.promise;for(var i=n.promise,o=0;o<t;o++){var r=e[o];i=i.then(function(){return this._openNewMemberPopup(r)}.bind(this)).fail(function(e){console.error(e)})}return i.then(this._navigateToPresentPage.bind(this)).fail(function(e){console.error(e)}),n.resolve(),i},_openNewMemberPopup:function(e){var i=e,o=n.director.getRunningScene().popups.comNewMember,r=a.defer();return o.open().then(function(e){this._setCharacterCoreCardElementRarity(o,i,"corecard_chara_ui");var n=o.seekWidgetByName("party_join_label");null!==n&&n.setString(i.name+"\n"),t.setTouchEventHandlers(o,{"TOUCH_ENDED black_btn":function(){o.dismiss(),r.resolve()}.bind(this)},this)}.bind(this)).fail(function(e){console.error(e)}),r.promise},_onSendSerialCodeError:function(e){var t=(e.error_info.type,"");n.director.getRunningScene()._openMessagePopup({title:"",content:t,buttons:[["blueBtn","OK",!0]]}).then(function(){this._editBox.setVisible(!0)}.bind(this))},_initSendButton:function(e){var n=e.seekWidgetByName("window_gray");this._sendButton=t.createInstance("serialCodeSendButton",[n,"btn_serial_form"]),this._sendButton.setEnabled(!1),this._khSerialCode.addEventListener("PROPERTY_CHANGED",function(){var e=this._khSerialCode.canSendSerialCode();this._sendButton.setEnabled(e)}.bind(this))},_initEditBox:function(e){var n=e.seekWidgetByName("window_gray");this._editBox=t.EditBox.createEditBox(n,"text_window","editbox_0",16,t._playerName),this._editBox.setOnInputCallback(function(e){this._khSerialCode.setInputCode(this._editBox.getText())}.bind(this))},_touchEndedBackBtnProcess:function(){this._navigateToMy001()}}),t.assignRoles(t.pc.serial.seri_000.SceneDelegate,[t.pc.roles.UIUtility,t.pc.serial.roles.Routing,t.pc.roles.CoreCardCommon])}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.router=n.router||{},n.router.routes=n.router.routes||{},t.merge(n.router.routes,{serial:{serial:"seri_000","serial/seri_000":"seri_000"}})}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.set=t.pc.set||{},t.pc.set.set_001=t.pc.set.set_001||{},t.pc.set.set_001.Scene=t.BaseScene.extend({resourceFileName:"set_001/set_001.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[{tab1:{node:"tab_0","content-node":"set_001_a_node"},tab2:{node:"tab_1","content-node":"set_001_b_node"}}],componentName:"set",sceneName:"set_001",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_red_l","btnCallbackBtnRedL",null,function(){alert("{{my_001}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_scene-skip_0","btnCallbackBtnSceneSkip0",null,function(){alert("{{ON}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_scene-skip_1","btnCallbackBtnSceneSkip1",null,function(){alert("{{OFF}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_speed_0","btnCallbackBtnSpeed0",null,function(){alert("{{}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_speed_1","btnCallbackBtnSpeed1",null,function(){alert("{{}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_summon_0","btnCallbackBtnSummon0",null,function(){alert("{{ON}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_summon_1","btnCallbackBtnSummon1",null,function(){alert("{{OFF}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_sound_0","btnCallbackBtnSound0",null,function(){alert("{{sound off }}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_sound_1","btnCallbackBtnSound1",null,function(){alert("{{sound on }}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_bgm_0","btnCallbackBtnBgm0",null,function(){alert("{{OFFON}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_bgm_1","btnCallbackBtnBgm1",null,function(){alert("{{ONOFF}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_se_0","btnCallbackBtnSe0",null,function(){alert("{{OFFON}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_se_1","btnCallbackBtnSe1",null,function(){alert("{{ONOFF}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc=t.pc||{},t.pc.set=t.pc.set||{},t.pc.set.set_001=t.pc.set.set_001||{},t.pc.set.set_001.SceneDelegate=t.pc.BaseSceneDelegate.extend({_popups:{},_isDirty:!1,onSceneInit:function(e){return a.defer(),this._isDirty=!1,this.gameConfig=t.createInstance("playerGameConfig"),e.tabDelegateList[0].selectTab(n.director.getRunningScene().seekWidgetByName("tab_0")),this._setBackBtn(e),this._updateNode(),a.resolve()},onSceneEnter:function(e){return a.defer(),a.resolve()},onSceneExit:function(e){return this._isDirty&&this.gameConfig.restoreSavedConfig(),this.gameConfig=null,a.defer(),a.resolve()},_updateNode:function(){this._updateVariousNode(),this._updateSoundNode(),this._addSlidersEventListener(!0),this._addSlidersEventListener(!1)},_setBrightColorTogglePairNodes:function(e,t){var a=n.director.getRunningScene();i.each(e,function(e,i){var o=a.seekWidgetByName(i);o.setBright(e!==t),o.setColor(n.color(e===t?"#FFFFFF":"#808080"))})},__updateSceneSkipBtnNode:function(){this._setBrightColorTogglePairNodes({"btn_scene-skip_0":!1,"btn_scene-skip_1":!0},this.gameConfig.getEpisodeEventSkip())},__updateBattleSpeedBtnNode:function(){this._setBrightColorTogglePairNodes({btn_speed_0:!1,btn_speed_1:!0},this.gameConfig.isBattleSpeedFast())},__updateSummonBtnNode:function(){this._setBrightColorTogglePairNodes({btn_summon_0:!1,btn_summon_1:!0},this.gameConfig.isSummonEffectEnabled())},__updateSoundOnOffBtnNode:function(){this._setEnabledBgmSeOnBtn(this.gameConfig.isSoundOn()),this._setBrightColorTogglePairNodes({btn_sound_0:!1,btn_sound_1:!0},this.gameConfig.isSoundOn())},__updateBgmOnOffBtnNode:function(){this._setBrightColorTogglePairNodes({btn_bgm_0:!1,btn_bgm_1:!0},this.gameConfig.isBgmOn())},__updateSeOnOffBtnNode:function(){this._setBrightColorTogglePairNodes({btn_se_0:!1,btn_se_1:!0},this.gameConfig.isSeOn())},__resetBgmSlider:function(){var e=n.director.getRunningScene().seekWidgetByName("bgm_panel"),t=e.seekWidgetByName("bgm_slider"),i=e.seekWidgetByName("bgm_label");t.setPercent(0),i.string=0},__resetSeSlider:function(){var e=n.director.getRunningScene().seekWidgetByName("se_panel"),t=e.seekWidgetByName("se_slider"),i=e.seekWidgetByName("se_label");t.setPercent(0),i.string=0},__updateBgmSlider:function(){var e=n.director.getRunningScene().seekWidgetByName("bgm_panel"),t=this.gameConfig.isBgmOn(),a=this.gameConfig.getBgmVolume(),o=e.seekWidgetByName("bgm_slider"),r=e.seekWidgetByName("bgm_label");o.setEnabled(t),i.invoke([o,r],"setColor",n.color(t?"#FFFFFF":"#808080")),o.setPercent(a),r.string=a},__updateSeSlider:function(){var e=n.director.getRunningScene().seekWidgetByName("se_panel"),t=this.gameConfig.isSeOn(),a=this.gameConfig.getSeVolume(),o=e.seekWidgetByName("se_slider"),r=e.seekWidgetByName("se_label");o.setEnabled(t),i.invoke([o,r],"setColor",n.color(t?"#FFFFFF":"#808080")),o.setPercent(a),r.string=a},_setEnabledBgmSeOnBtn:function(e){var t=n.director.getRunningScene();i.each(["bgm","se"],function(n){t.seekWidgetByName("btn_"+n+"_1").setEnabled(e)},this)},_actionBGM:function(){var e=new t.BGM;this.gameConfig.isBgmOn()?e.play(!0):e.stop()},_actionSE:function(){t.createInstance("soundPlayer").enableSe(this.gameConfig.isSeOn())},_addSlidersEventListener:function(e){var i=n.director.getRunningScene(),a=e?"bgm":"se",o=i.seekWidgetByName(a+"_panel"),r=o.seekWidgetByName(a+"_slider");r.addEventListener(function(t,n){if(n===ccui.Slider.EVENT_PERCENT_CHANGED){this._isDirty=!0;var i=Math.round(t.getPercent());o.seekWidgetByName(a+"_label").string=i,e?this.gameConfig.setBgmVolume(i):(this.gameConfig.setSeVolume(i),this.gameConfig.setVoiceVolume(i))}},this),r.addTouchEventListener(function(n,i){i===ccui.Widget.TOUCH_ENDED&&e&&(new t.BGM).play(!0)})},_updateVariousNode:function(){this.__updateSceneSkipBtnNode(),this.__updateBattleSpeedBtnNode(),this.__updateSummonBtnNode()},_updateSoundNode:function(){this.__updateSoundOnOffBtnNode(),this.__updateBgmOnOffBtnNode(),this.__updateSeOnOffBtnNode(),this.__updateBgmSlider(),this.__updateSeSlider(),this.__prepareZeroVolumeSliders()},__prepareZeroVolumeSliders:function(){return this.gameConfig.sound_info,this.gameConfig.isSoundOn()?(this.gameConfig.isBgmOn()||this.__resetBgmSlider(),void(this.gameConfig.isSeOn()||this.__resetSeSlider())):(this.__resetBgmSlider(),void this.__resetSeSlider())},_onExit:function(){},btnCallbackBtnRedL:function(e){var n=a.defer();return n.reject(this._override),this._isDirty?(this.gameConfig.updateGameConfig().then(function(){this._isDirty=!1,t.createInstance("router").navigate("epi/epi_001")}.bind(this)),n.promise):(t.createInstance("router").navigate("epi/epi_001"),n.promise)},btnCallbackBtnSceneSkip0:function(e){var t=a.defer();return t.reject(this._override),this._isDirty=!0,this.gameConfig.setEpisodeEventSkip(!1),this.__updateSceneSkipBtnNode(),t.promise},btnCallbackBtnSceneSkip1:function(e){var t=a.defer();return t.reject(this._override),this._isDirty=!0,this.gameConfig.setEpisodeEventSkip(!0),this.__updateSceneSkipBtnNode(),t.promise},btnCallbackBtnSpeed0:function(e){var t=a.defer();return t.reject(this._override),this._isDirty=!0,this.gameConfig.setBattleSpeedFast(!1),this.__updateBattleSpeedBtnNode(),t.promise},btnCallbackBtnSpeed1:function(e){var t=a.defer();return t.reject(this._override),this._isDirty=!0,this.gameConfig.setBattleSpeedFast(!0),this.__updateBattleSpeedBtnNode(),t.promise},btnCallbackBtnSummon0:function(e){var t=a.defer();return t.reject(this._override),this._isDirty=!0,this.gameConfig.setSummonEffectEnabled(!1),this.__updateSummonBtnNode(),t.promise},btnCallbackBtnSummon1:function(e){var t=a.defer();return t.reject(this._override),this._isDirty=!0,this.gameConfig.setSummonEffectEnabled(!0),this.__updateSummonBtnNode(),t.promise},btnCallbackBtnSound0:function(e){var t=a.defer();return t.reject(this._override),this._isDirty=!0,this.gameConfig.setAllSoundOn(!1),this.__updateSoundOnOffBtnNode(),this.__updateBgmOnOffBtnNode(),this.__updateSeOnOffBtnNode(),this.__updateBgmSlider(),this.__updateSeSlider(),this.__resetBgmSlider(),this.__resetSeSlider(),this._actionSE(),this._actionBGM(),t.promise},btnCallbackBtnSound1:function(e){var n=a.defer();return n.reject(this._override),this._isDirty=!0,this.gameConfig.setAllSoundOn(!0),(new t.SE).play(t.SoundList.BUTTON_TOUCHED_DECIDE),this.__updateSoundOnOffBtnNode(),this.__updateBgmOnOffBtnNode(),this.__updateSeOnOffBtnNode(),this.__updateBgmSlider(),this.__updateSeSlider(),this._actionSE(),this._actionBGM(),n.promise},btnCallbackBtnBgm0:function(e){var t=a.defer();return t.reject(this._override),this._isDirty=!0,this.gameConfig.setBgmOn(!1),this.__updateBgmOnOffBtnNode(),this.__updateBgmSlider(),this.__resetBgmSlider(),this._actionBGM(),t.promise},btnCallbackBtnBgm1:function(e){var t=a.defer();return t.reject(this._override),this._isDirty=!0,this.gameConfig.setBgmOn(!0),this.__updateBgmOnOffBtnNode(),this.__updateBgmSlider(),this._actionBGM(),t.promise},btnCallbackBtnSe0:function(e){var t=a.defer();return t.reject(this._override),this._isDirty=!0,this.gameConfig.setSeOn(!1),this.gameConfig.setVoiceOn(!1),this.__updateSeOnOffBtnNode(),this.__updateSeSlider(),this.__resetSeSlider(),this._actionSE(),t.promise},btnCallbackBtnSe1:function(e){var n=a.defer();return n.reject(this._override),this._isDirty=!0,this.gameConfig.setSeOn(!0),this.gameConfig.setVoiceOn(!0),(new t.SE).play(t.SoundList.BUTTON_TOUCHED_DECIDE),this.__updateSeOnOffBtnNode(),this.__updateSeSlider(),this._actionSE(),n.promise},_touchEndedBackBtnProcess:function(e){var n=a.defer();return n.reject(this._override),this._isDirty?(this._isDirty=!1,this.gameConfig.restoreSavedConfig().then(function(){t.createInstance("router").navigate("epi/epi_001")}.bind(this)),n.promise):(t.createInstance("router").navigate("epi/epi_001"),n.promise)}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.router=n.router||{},n.router.routes=n.router.routes||{},t.merge(n.router.routes,{set:{set:"set_001","set/set_001":"set_001"}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;e.Q,t.pc.shop=t.pc.shop||{},t.pc.shop.roles=t.pc.shop.roles||{},t.pc.shop.roles.ShopCommon={_popups:{sh_buy_check:{factoryName:"popupFactoryPopupCommon",resourceName:"core-popup-sh_buy_check",title:"",id:"1001",buttonLabels:{blueBtn:"",blackBtn:""},buttons:{blueBtn:function(e){e.pulldown.releaseMenu(),e._delegate._buy(),this.dismiss()},blackBtn:function(e){e.pulldown.releaseMenu(),this.dismiss()}}},sh_stone_check:{factoryName:"popupFactoryPopupCommon",resourceName:"core-popup-sh_stone_check",title:"",id:"1001",buttonLabels:{blueBtn:"",blackBtn:""},buttons:{blueBtn:function(e){e._delegate._buy(),e.pulldown.releaseMenu(),this.dismiss()},blackBtn:function(e){e.pulldown.releaseMenu(),this.dismiss()}}},sh_item_info:{factoryName:"popupFactoryShItemInfo"},sh_package_info:{factoryName:"popupFactoryShPackageInfo"},sh_buy_result:{factoryName:"popupFactoryPopupCommon",resourceName:"core-popup-sh_buy_result",title:"",id:"1002",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){var t=this.widget.seekWidgetByName("corecard_ui");i.isNull(t)||t.removeAllChildren(),this.dismiss()}}},com_need_mate:{factoryName:"popupFactoryPopupCommon",resourceName:"core-popup-com_need_mate",title:"",id:"1000",buttonLabels:{blackBtn:""},buttons:{blackBtn:function(e){this.dismiss()}}},com_need_mate_sp:{factoryName:"popupFactoryPopupCommon",resourceName:"core-popup-com_need_mate",title:"",id:"1001",buttonLabels:{blueBtn:"",blackBtn:""},buttons:{blueBtn:function(e){t.createInstance("router").navigate("quest/q_special_top",{q_special_top:{category:"elemental"}}),this.dismiss()},blackBtn:function(e){this.dismiss()}}},sh_weapon_info:{factoryName:"popupFactoryShWeaponInfo"},sh_summon_info:{factoryName:"popupFactoryShSummonInfo"}},_setShopStrings:function(e,n){if(!i.isUndefined(n.name)&&null!==e.seekWidgetByName("name_label")){var a="";i.isUndefined(n.on_sale)||!0!==n.on_sale||i.isUndefined(n.buy_max_num)||(a=""+n.buy_max_num+""),e.setStrings({name_label:n.name+a})}i.isUndefined(n.description)||null===e.seekWidgetByName("explanation_label")||e.setStrings({explanation_label:n.description}),i.isUndefined(n.price)||null===e.seekWidgetByName("price_label")||null===e.seekWidgetByName("price_no")?i.isUndefined(n.stones)||null===e.seekWidgetByName("price_label")||null===e.seekWidgetByName("price_no")||e.setStrings({price_label:t.w("stone"),price_no:n.stones+""}):e.setStrings({price_label:"",price_no:n.price+""})},_setShopCoreCardPoint:function(e,t){if(!i.isUndefined(t.shop_item_id)){var n=e.seekWidgetByName("corecard_shop");return null===n?void console.warn("[ERROR] Could not find a core card node."):(this._setItemCoreCard(e,t,"corecard_shop"),n)}console.warn("[ERROR] Could not find a shop item id.")},_setShopCoreCardStone:function(e,t){if(!i.isUndefined(t.shop_item_id)){var n=e.seekWidgetByName("corecard_shop");return null===n?void console.warn("[ERROR] Could not find a core card node."):(this._setItemCoreCard(e,t,"corecard_shop"),n)}console.warn("[ERROR] Could not find a shop item id.")},_onTab0PagerButtonInit:function(e){this._tab0PagerButtons=e},_onTab1PagerButtonInit:function(e){this._tab1PagerButtons=e},_onTab2PagerButtonInit:function(e){this._tab2PagerButtons=e},_onTab3PagerButtonInit:function(e){this._tab3PagerButtons=e},_onTab3BannerPagerButtonInit:function(e){this._tab3BannerPagerButtons=e},_onTab3ListPagerButtonInit:function(e){this._tab3ListPagerButtons=e},_toggleTab3PagerButton:function(e){this._tab3PagerButtons=e?this._tab3BannerPagerButtons:this._tab3ListPagerButtons},_refreshCurrentTab:function(){var e=n.director.getRunningScene();if(e.tabDelegateList.length){var t=e.tabDelegateList[0].selected,a=this["_tab"+i.last(t.match(/\d/g))+"PagerButtons"];null!=a&&a.refresh()}}},i.assign(t.pc.roles.CoreCardCommon)}((this||0).self||global),function(e){var t=(e.cc,e._),n=e.kh;n.createNameSpaceIfNotExists("core.item"),n.core.item.ShComNeedMatePopup=n.ImplantedPopup.extend({CORECARD_IMAGE_2ND_KEY:"item",_initContents:function(e){var t=this.getNode();this._setCorecard(t,e.item_id),this._setItemName(t,e.name),this._setItemDescription(t,e),this._setButtons(t,e.obtainment_info)},_setCorecard:function(e,i){var a=e.seekWidgetByName("item_img");if(null!==a){var o=n.Img("corecard",this.CORECARD_IMAGE_2ND_KEY,t.padZero(i,4)).jpg;a.setVisible(!0),a.loadTexture(o)}},_setItemName:function(e,t){var n=e.seekWidgetByName("item_label");null!==n&&n.setString(t)},_setItemDescription:function(e,t){var n=e.seekWidgetByName("item_detail_label"),i=e.seekWidgetByName("item_quest_label");null!==n&&null!==i&&(n.setString(t.description),i.setString(t.obtainment_info.description))},_setButtons:function(e,t){return t.is_today_sp_quest?void this._setButtonMaterialToGainToday(e):void this._setButtonMaterial(e)},_setButtonMaterialToGainToday:function(e){this.setButtonEvents({btn_close_left:!1,btn_to_spquest:this._gotoSpecialQuest});var t=e.seekWidgetByName("btn_close_left"),n=e.seekWidgetByName("btn_to_spquest"),i=e.seekWidgetByName("btn_close_center");t.setVisible(!0),i.setVisible(!1),n.setVisible(!0)},_setButtonMaterial:function(e){this.setButtonEvents({btn_close_center:!0});var t=e.seekWidgetByName("btn_close_left"),n=e.seekWidgetByName("btn_to_spquest"),i=e.seekWidgetByName("btn_close_center");t.setVisible(!1),i.setVisible(!0),n.setVisible(!1)},_gotoSpecialQuest:function(){n.createInstance("router").navigate("quest/q_special_top",{q_special_top:{category:"elemental"}})}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);e.Q,t.pc.shop=t.pc.shop||{},t.pc.shop.roles=t.pc.shop.roles||{},t.pc.shop.roles.Routing={_verifyRouterParams001:function(e){},_navigateToMy001:function(){t.createInstance("router").navigate("mypage/my_001")},_navigate001To001:function(){t.createInstance("router").navigate("shop/sh_001")},_navigate001ToBannerDestination:function(e,i){if(n.isUndefined(i)||n.isUndefined(i.navigate_page))this._consoleErrorRoutingAbort("record | record.navigate_page");else{var a={};a[i.navigate_page.replace(/^shop\//g,"")]={event_id:i.event_id},t.createInstance("router").navigate(i.navigate_page,a,{tab:i.tab_name})}},_navigate001To002003004:function(e,n){return"dmm"===n?(console.log("001 to 002"),void t.createInstance("router").navigate("shop/sh_002",{},{tab:"heal"})):void console.error("invalid routing type")},_navigate001To010:function(e){t.createInstance("router").navigate("shop/sh_010")},_navigate001To101:function(e){console.log("001 to 101"),t.createInstance("router").navigate("shop/sh_101")},_navigate001To102:function(e){console.log("001 to 102"),t.createInstance("router").navigate("shop/sh_102")},_verifyRouterParams002:function(e){},_verifyRouterParams003:function(e){},_verifyRouterParams004:function(e){},_navigateToStatus001:function(e,i,a){return n.isUndefined(e)?void this._consoleErrorRoutingAbort("characterId"):void t.createInstance("router").navigate("status/status_001",{status_001:{id:e,isFromShopExchange:!0,returnRoute:i,returnParams:a}})},_verifyRouterParams005:function(e){if(n.isUndefined(e.routerParams.sh_005)||n.isUndefined(e.routerParams.sh_005.event_id))return!n.isUndefined(e.routerParams.sh_005)&&!n.isUndefined(e.routerParams.sh_005.event_id)||n.isUndefined(e.routerParams.shop_event_id)?void this._consoleErrorRoutingAbort("routerParams.sh_005.event_id"):void(e.routerParams.sh_005={event_id:e.routerParams.shop_event_id})},_navigate005To006:function(e){if(n.isUndefined(e.routerParams.sh_005))this._consoleErrorRoutingAbort("routerParams.sh_005");else if(n.isUndefined(e._type))this._consoleErrorRoutingAbort("scene._type");else{var i="character_pack"===e._type?"arrival_chara":"arrival_summon",a={sh_006:{id:e.routerParams.sh_005.event_id,type:i}};null!=e.routerParams.payment_id&&(a.payment_id=null,a.shop_event_id=null),t.createInstance("router").navigate("shop/sh_006",a)}},_navigate005To001:function(e){var n=null!=e.routerParams.payment_id?{payment_id:null,shop_event_id:null}:{};t.createInstance("router").navigate("shop",n)},_verifyRouterParams006:function(e){n.isUndefined(e.routerParams.sh_006)&&(e.routerParams.sh_006={},e.routerParams.sh_006.id=1,e.routerParams.sh_006.type="arrival_chara",this._consoleErrorRouterParams("sh_006, .id, .type"))},_navigate006To007:function(e,i){return n.isUndefined(e.routerParams.sh_006)?void this._consoleErrorRoutingAbort("routerParams.sh_006"):n.isUndefined(i.id)?void this._consoleErrorRoutingAbort("record.id"):void t.createInstance("router").navigate("shop/sh_007",{sh_007:{id:i.id}})},_navigate006To008:function(e,i){return n.isUndefined(e.routerParams.sh_006)?void this._consoleErrorRoutingAbort("routerParams.sh_006"):n.isUndefined(i.id)?void this._consoleErrorRoutingAbort("record.id"):void t.createInstance("router").navigate("shop/sh_008",{sh_008:{id:i.id}})},_navigate006To009:function(e,i){return n.isUndefined(e.routerParams.sh_006)?void this._consoleErrorRoutingAbort("routerParams.sh_006"):n.isUndefined(i.id)?void this._consoleErrorRoutingAbort("record.id"):n.isUndefined(i.release_weapon_id)?void this._consoleErrorRoutingAbort("record.release_weapon_id"):void t.createInstance("router").navigate("shop/sh_009",{sh_009:{id:i.id,release_weapon_id:i.release_weapon_id}})},_verifyRouterParams007:function(e){n.isUndefined(e.routerParams.sh_007)&&(e.routerParams.sh_007={},e.routerParams.sh_007.id=1,this._consoleErrorRouterParams("routerParams.sh_007, .id"))},_verifyRouterParams008:function(e){n.isUndefined(e.routerParams.sh_008)&&(e.routerParams.sh_008={},e.routerParams.sh_008.id=1,e.routerParams.sh_008.from="sh_006",e.routerParams.sh_008.category="stone",this._consoleErrorRouterParams("routerParams.sh_008, .id .from .category"))},_verifyRouterParams009:function(e){n.isUndefined(e.routerParams.sh_009)&&(e.routerParams.sh_009={},e.routerParams.sh_009.id=1,e.routerParams.sh_009.release_weapon_id=1,this._consoleErrorRouterParams("routerParams.sh_009, .id "))},_navigate009To008:function(e){if(n.isUndefined(e.routerParams.sh_009))this._consoleErrorRoutingAbort("routerParams.sh_009");else if(n.isUndefined(e.routerParams.sh_009.release_weapon_id))this._consoleErrorRoutingAbort("routerParams.sh_009.release_weapon_id");else{var i=e.routerParams.sh_009;t.createInstance("router").navigate("shop/sh_008",{sh_008:{id:i.release_weapon_id}})}},_navigate011Toli008:function(e){t.createInstance("router").navigate("list/li_008",{li_007_008:{direction:"tab_1"}})},_navigate010ToBook001:function(e){t.createInstance("router").navigate("book/book_001",{},{restoreParams:{tabs:["tab_3"],pagerButtons:{}}})},_navigateToSpecialButtonCode:function(e,t){switch(t){case 1:this._navigate010ToBook001(e);break;case 2:this._navigate011Toli008(e);break;default:console.error(":"+t)}},_verifyRouterParams102:function(e){n.isUndefined(e.routerParams.sh_102)&&n.isUndefined(e.temporaryRouterParams.shop_id)&&this._consoleErrorRoutingAbort("routerParams.sh_102.shop_id")}},n.assign(t.pc.shop.roles.Routing,t.pc.roles.RoutingCommon)}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.shop=n.shop||{},n.shop.model=n.shop.model||{},n.shop.model.AbstractShopItem=cc.Class.extend({CURRENCY_PROPERTY_NAME:"override-me",_apiShop:null,_shopItem:null,ctor:function(e){this._apiShop=n.createInstance("apiShop"),this._shopItem=e},getShopItemId:function(){return this._getPropertyOrDefault("shop_item_id")},getShopItemType:function(){return this._getPropertyOrDefault("shop_item_type")},getItemAmount:function(){return this._getPropertyOrDefault("amount",1)},getShortShopItemType:function(){var e=this.getShopItemType();return"accessory"===e?"acce":e},getShopItem:function(){return this._getPropertyOrDefault("shop_item")},getGameItemId:function(){var e=this.getShopItemType()+"_id";return this.getShopItem()[e]},getName:function(){return this._getPropertyOrDefault("name")},getDescription:function(){return this._getPropertyOrDefault("description")},getCurrencyType:function(){return n.w(this.CURRENCY_PROPERTY_NAME)},getPrice:function(){return this._getPropertyOrDefault(this.CURRENCY_PROPERTY_NAME)},getDailyStock:function(){var e=this._getPropertyOrDefault("stock_info");return t.isUndefined(e.day)?null:e.day.remaining_num},getMonthlyStock:function(){var e=this._getPropertyOrDefault("stock_info");return t.isUndefined(e.month)?null:e.month.remaining_num},getNoTimeLimitStock:function(){var e=this._getPropertyOrDefault("stock_info");return t.isUndefined(e.no_time_limit)?null:e.no_time_limit.remaining_num},getStock:function(){var e=this._getPropertyOrDefault("stock_info");return t.isUndefined(e.day)?t.isUndefined(e.month)?t.isUndefined(e.no_time_limit)?null:e.no_time_limit.remaining_num:e.month.remaining_num:e.day.remaining_num},getStockResetTypeLabel:function(){var e=this._getPropertyOrDefault("stock_info");return t.isUndefined(e.day)?t.isUndefined(e.month)?t.isUndefined(e.no_time_limit)?"":"":"()":"()"},getBuyMaxAmount:function(e){if(!t.isNumber(e))return console.error("getBuyMaxAmount: not found currencyAmount"),0;var n,i=this._getPropertyOrDefault("stock_info"),a=this.getPrice()<=0;a||(n=Math.floor(e/this.getPrice()));var o=t.filter(i,function(e){return!t.isUndefined(e.remaining_num)});if(0===o.length)return a?10:n;var r=t.map(o,function(e){return e.remaining_num});return a||r.push(n),t.min(r)},getCoreCardImgPath:function(){var e=this.getShopItemType(),i=this.getShopItem();return"weapon"===e||"summon"===e?n.Img("corecard",this.getShortShopItemType(),t.padZero(this.getGameItemId(),4),i.skin||0).jpg:n.Img("corecard",this.getShortShopItemType(),t.padZero(this.getGameItemId(),4)).jpg},isEmptyBuyMaxAmount:function(e){return 0===this.getBuyMaxAmount(e)},canBeBoughtWith:function(e){return this.getBuyMaxAmount(e)>0},buy:function(e){var t=this.getShopItemId();return this._apiShop.buy(t,e,this.CURRENCY_PROPERTY_NAME).then(function(e){return e.body}).fail(function(e){console.error(e.stack)})},_getPropertyOrDefault:function(e,n){return t.isUndefined(n)&&(n=null),this._shopItem?this._shopItem[e]:n}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.shop=t.shop||{},t.shop.model=t.shop.model||{},t.shop.model.AccessoryPointShopItem=t.shop.model.AbstractShopItem.extend({CURRENCY_PROPERTY_NAME:"accessory_point"})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.shop=t.shop||{},t.shop.model=t.shop.model||{},t.shop.model.SummonOrbShopItem=t.shop.model.AbstractShopItem.extend({CURRENCY_PROPERTY_NAME:"summon_orb"})}((this||0).self||global),function(e){var t=e._,n=e.kh,i=e.cc;n.createNameSpaceIfNotExists("shop.currency.amount_label"),n.shop.currency.amount_label.Controller=i.Class.extend({className:"CurrencyAmountLabelController",CURRENCY_AMOUNT_LABEL_CONTROLLERS:{PSEUDO_CURRENCY:"PseudoCurrencyAmountLabelController",STONE:"StoneAmountLabelController",ACCESSORY:"AccessoryPointAmountLabelController",SUMMON_ORB:"SummonOrbAmountLabelController"},initializeLabelTexts:function(){return this._getPlayerCurrencyModel().then(this._createCurrencyLabelControllers.bind(this)).then(this._setLabelTexts.bind(this))},_getPlayerCurrencyModel:function(){return n.createInstance("myselfInfoRepository").getMyCurrency()},_setLabelTexts:function(e){t.invoke(e,"initializeLabelText")},_createCurrencyLabelControllers:function(e){return t.map(this.CURRENCY_AMOUNT_LABEL_CONTROLLERS,function(t){return n.createInstance(t,[e])})}})}((this||0).self||global),function(e){var t=(e._,e.kh),n=e.cc;t.createNameSpaceIfNotExists("shop.currency.amount_label"),t.shop.currency.amount_label.View=n.Class.extend({className:"CurrencyAmountView",ctor:function(e){this._label=e},setLabelText:function(e){this._label.setString(e.toString())},cleanUp:function(){this._label=null}})}((this||0).self||global),function(e){var t=(e._,e.kh),n=e.khutil,i=e.cc,a=e.console;t.createNameSpaceIfNotExists("shop.currency.amount_label"),t.shop.currency.amount_label.ControllerAbstract=i.Class.extend({className:"CurrencyAmountLabelControllerAbstract",LABEL_NAME:"",ctor:function(e){this._playerCurrencyModel=e},initializeLabelText:function(){var e=this._createLabelText();this._setLabelText(e)},_createLabelText:function(){var e=this._getCurrencyAmount(this._playerCurrencyModel);return null==e?void a.warn("CurrencyAmountLabelControllerAbstract._createLabelText: No currency amount set!"):e.toString()},_getCurrencyAmount:function(e){},_setLabelText:function(e){var n=this._getLabelNode(),i=t.createInstance("CurrencyAmountLabelView",[n]);i.setLabelText(e),i.cleanUp()},_getLabelNode:function(){return n.getWidget(this.LABEL_NAME,function(e){a.warn("CurrencyAmountLabelControllerAbstract._getLabelNode: "+e)})}})}((this||0).self||global),function(e){var t=(e._,e.kh);t.createNameSpaceIfNotExists("shop.currency.amount_label"),t.shop.currency.amount_label.AccessoryPointController=t.shop.currency.amount_label.ControllerAbstract.extend({className:"AccessoryPointAmountLabelController",LABEL_NAME:"have_acce_point_label",_getCurrencyAmount:function(e){return e.getAccessoryPointAmount()}})}((this||0).self||global),function(e){var t=(e._,e.kh);t.createNameSpaceIfNotExists("shop.currency.amount_label"),t.shop.currency.amount_label.PseudoCurrencyController=t.shop.currency.amount_label.ControllerAbstract.extend({className:"PseudoCurrencyAmountLabelController",LABEL_NAME:"coin_label",_getCurrencyAmount:function(e){return e.getPseudoCurrencyAmount()}})}((this||0).self||global),function(e){var t=(e._,e.kh);t.createNameSpaceIfNotExists("shop.currency.amount_label"),t.shop.currency.amount_label.StoneController=t.shop.currency.amount_label.ControllerAbstract.extend({className:"StoneAmountLabelController",LABEL_NAME:"stone_label",_getCurrencyAmount:function(e){return e.getStoneAmount()}})}((this||0).self||global),function(e){var t=(e._,e.kh);t.createNameSpaceIfNotExists("shop.currency.amount_label"),t.shop.currency.amount_label.SummonOrbController=t.shop.currency.amount_label.ControllerAbstract.extend({className:"SummonOrbAmountLabelController",LABEL_NAME:"have_orb_label",_getCurrencyAmount:function(e){return e.getSummonOrbAmount()}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e.khutil,a=e.console;t.createNameSpaceIfNotExists("shop.shop_item.shop_item_panels"),t.shop.shop_item.shop_item_panels.ControllerAbstract=n.Class.extend({className:"ShopItemPanelComponentControllerAbstract",WIDGET_NAME:"",ctor:function(e,t,n){this._shopItemModel=e,this._playerCurrencyModel=t,this._panelWidget=n},initialize:function(){},_createView:function(){},_showView:function(e){var t=this._createView();t.show(e),t.cleanUp()},_getWidget:function(e){return i.getWidgetFromNode(this._panelWidget,e,function(e){a.warn(this.className+e)}.bind(this))}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("shop.shop_item.shop_item_panels"),t.shop.shop_item.shop_item_panels.ViewAbstract=n.Class.extend({className:"ShopItemPanelComponentViewAbstract",ctor:function(e){this._widget=e},show:function(e){},cleanUp:function(){this._widget=null}})}((this||0).self||global),function(e){var t=e._,n=e.kh;e.cc,n.createNameSpaceIfNotExists("shop.shop_item.shop_item_panels.buy_button"),n.shop.shop_item.shop_item_panels.buy_button.Controller=n.shop.shop_item.shop_item_panels.ControllerAbstract.extend({className:"ShopItemPanelBuyButtonController",WIDGET_NAMES:["btn_buy","btn_exchange"],VENDING_PROCESS_CONTROLLERS:{POINT:"PointVendingProcessController",DEFAULT:"VendingProcessController"},_setCurrencyGettersByType:function(){var e=n.shop_item.Model.prototype.CURRENCY_TYPES;this.CURRENCY_AMOUNT_GETTER_BY_TYPE={},this.CURRENCY_AMOUNT_GETTER_BY_TYPE[e.STONE]="getStoneAmount",this.CURRENCY_AMOUNT_GETTER_BY_TYPE[e.PSEUDO_CURRENCY]="getPseudoCurrencyAmount",this.CURRENCY_AMOUNT_GETTER_BY_TYPE[e.ACCESSORY_POINT]="getAccessoryPointAmount"},initialize:function(){this._setCurrencyGettersByType();var e=this._isEnable();e&&this._setOnTouchEvent(),this._setEnabledState(e)},_setEnabledState:function(e){var t=this._getButton();n.pc.roles.UIUtility._setEnableButton(t,e)},_isEnable:function(){if(0==this._shopItemModel.getStock())return!1;if(this._shopItemModel.isCurrencyTypePoint())return!0;var e=this._shopItemModel.getPrice(),t=this._shopItemModel.getCurrencyType();return e<=this._playerCurrencyModel[this.CURRENCY_AMOUNT_GETTER_BY_TYPE[t]]()},_setOnTouchEvent:function(){this._getButton().addTouchEventListener(this._startVendingProcess,this)},_getVendingProcessController:function(){var e;return n.vending_process.DIConfig.apply(),e=this._shopItemModel.isCurrencyTypePoint()?this.VENDING_PROCESS_CONTROLLERS.POINT:this.VENDING_PROCESS_CONTROLLERS.DEFAULT,n.createInstance(e,[this._shopItemModel,this._playerCurrencyModel])},_startVendingProcess:function(e,t){t===ccui.Widget.TOUCH_ENDED&&this._getVendingProcessController().buy()},_getButton:function(){return t.reduce(this.WIDGET_NAMES,function(e,t){return e||this._getWidget(t)}.bind(this),null)}})}((this||0).self||global),function(e){var t=(e._,e.kh);e.cc,t.createNameSpaceIfNotExists("shop.shop_item.shop_item_panels.description"),t.shop.shop_item.shop_item_panels.description.Controller=t.shop.shop_item.shop_item_panels.ControllerAbstract.extend({className:"ShopItemPanelDescriptionController",WIDGET_NAME:"explanation_label",initialize:function(){this._setLabelText()},_createView:function(){return t.createInstance("ShopItemPanelDescriptionView",this._getLabel())},_setLabelText:function(){var e=this._shopItemModel.getDescription();this._showView(e)},_getLabel:function(){return this._getWidget(this.WIDGET_NAME)}})}((this||0).self||global),function(e){var t=(e._,e.kh);e.cc,t.createNameSpaceIfNotExists("shop.shop_item.shop_item_panels.description"),t.shop.shop_item.shop_item_panels.description.View=t.shop.shop_item.shop_item_panels.ViewAbstract.extend({className:"ShopItemPanelDescriptionView",show:function(e){null!=this._widget&&this._widget.setString(e.toString())}})}((this||0).self||global),function(e){var t=e.kh;t.createNameSpaceIfNotExists("shop.shop_item.shop_item_panels.header"),t.shop.shop_item.shop_item_panels.header.Controller=t.shop.shop_item.shop_item_panels.ControllerAbstract.extend({className:"ShopItemPanelHeaderController",WIDGET_NAME:"name_label",initialize:function(){this._setLabelText()},_createView:function(){return t.createInstance("ShopItemPanelHeaderView",this._getLabel())},_setLabelText:function(){var e=this._shopItemModel.getName();this._showView(e)},_getLabel:function(){return this._getWidget(this.WIDGET_NAME)}})}((this||0).self||global),function(e){var t=(e._,e.kh);e.cc,t.createNameSpaceIfNotExists("shop.shop_item.shop_item_panels.header"),t.shop.shop_item.shop_item_panels.header.View=t.shop.shop_item.shop_item_panels.ViewAbstract.extend({className:"ShopItemPanelHeaderView",show:function(e){null!=this._widget&&this._widget.setString(e.toString())}})}((this||0).self||global),function(e){var t=e.kh;e.ccui,t.createNameSpaceIfNotExists("shop.shop_item.shop_item_panels.item_image"),t.shop.shop_item.shop_item_panels.item_image.Controller=t.shop.shop_item.shop_item_panels.ControllerAbstract.extend({className:"ShopItemPanelItemImageController",WIDGET_NAME:"corecard_shop",_setTouchEventHandlersByItemType:function(e){this.HANDLERS_BY_ITEM_TYPE={},this.HANDLERS_BY_ITEM_TYPE[e.ITEM]="ShopItemPanelItemImageItemTouchEventHandler",this.HANDLERS_BY_ITEM_TYPE[e.PACKAGE]="ShopItemPanelItemImagePackageTouchEventHandler",this.HANDLERS_BY_ITEM_TYPE[e.WEAPON]="ShopItemPanelItemImageWeaponTouchEventHandler",this.HANDLERS_BY_ITEM_TYPE[e.SUMMON]="ShopItemPanelItemImageSummonTouchEventHandler",this.HANDLERS_BY_ITEM_TYPE[e.ACCESSORY]="ShopItemPanelItemImageAccessoryTouchEventHandler"},initialize:function(){var e=this._shopItemModel.ITEM_TYPES;this._setTouchEventHandlersByItemType(e),this._setImage(),this._setOnTouchEvent()},_setImage:function(){this._setOnTouchEvent(),t.createInstance("ShopItemImageController").initializeImage(this._getImageView(),this._shopItemModel)},_setOnTouchEvent:function(){var e=this._getImageTouchEventHandler();if(null!=e){var t=this._getImageView();e.setOnTouchEvent(t,this._shopItemModel)}},_getImagePath:function(){var e=this._shopItemModel.getShopItemId();return t.img("corecard","item",_.padZero(e,4)).jpg},_getImageView:function(){return this._getWidget(this.WIDGET_NAME)},_getImageTouchEventHandler:function(){var e=this._shopItemModel.getItemType(),n=this.HANDLERS_BY_ITEM_TYPE[e];return null==n?void console.warn("ShopItemPanelItemImageController._getImageTouchEventHandler: No handler found for item type: {"+e+"}!"):t.createInstance(n)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e.ccui;t.createNameSpaceIfNotExists("shop.shop_item.shop_item_panels.item_image"),t.shop.shop_item.shop_item_panels.item_image.TouchEventHandlerAbstract=n.Class.extend({className:"ShopItemPanelItemImageTouchEventHandlerAbstract",setOnTouchEvent:function(e,t){this._shopItemModel=t,e.addTouchEventListener(this._onTouchItemImage,this)},_onTouchItemImage:function(e,t){if(t===i.Widget.TOUCH_ENDED){var n=this._createItemInformationPopup();this._openItemInformationPopup(n)}},_createItemInformationPopup:function(){},_openItemInformationPopup:function(e){e.open().then(this._getItemInformationPopupData.bind(this)).then(this._setItemInformationPopupData.bind(this,e))},_setItemInformationPopupData:function(e,t){e.setData(t)},_getItemInformationPopupData:function(){}})}((this||0).self||global),function(e){var t=e.kh;t.createNameSpaceIfNotExists("shop.shop_item.shop_item_panels.item_image"),t.shop.shop_item.shop_item_panels.item_image.ItemTouchEventHandler=t.shop.shop_item.shop_item_panels.item_image.TouchEventHandlerAbstract.extend({className:"ShopItemPanelItemImageItemTouchEventHandler",_createItemInformationPopup:function(){return t.createInstance("popupFactoryShItemInfo").create()},_setItemInformationPopupData:function(e,t){var n=this._shopItemModel.getCurrencyType();e.setData(t,n)},_getItemInformationPopupData:function(){return this._shopItemModel.getRawData()}})}((this||0).self||global),function(e){var t=e.kh;t.createNameSpaceIfNotExists("shop.shop_item.shop_item_panels.item_image"),t.shop.shop_item.shop_item_panels.item_image.PackageTouchEventHandler=t.shop.shop_item.shop_item_panels.item_image.TouchEventHandlerAbstract.extend({className:"ShopItemPanelItemImagePackageTouchEventHandler",_createItemInformationPopup:function(){return t.createInstance("popupFactoryShItemInfo").create()},_setItemInformationPopupData:function(e,t){var n=this._shopItemModel.getCurrencyType();e.setData(t,n)},_getItemInformationPopupData:function(){return this._shopItemModel.getRawData()}})}((this||0).self||global),function(e){var t=e.kh;e.console,t.createNameSpaceIfNotExists("shop.shop_item.shop_item_panels.item_image"),t.shop.shop_item.shop_item_panels.item_image.SummonTouchEventHandler=t.shop.shop_item.shop_item_panels.item_image.TouchEventHandlerAbstract.extend({className:"ShopItemPanelItemImageSummonTouchEventHandler",_onTouchItemImage:function(e,t){},_createItemInformationPopup:function(){return t.createInstance("popupFactoryShSummonInfo").create()},_getItemInformationPopupData:function(){}})}((this||0).self||global),function(e){var t=e.kh;e.console,t.createNameSpaceIfNotExists("shop.shop_item.shop_item_panels.item_image"),t.shop.shop_item.shop_item_panels.item_image.WeaponTouchEventHandler=t.shop.shop_item.shop_item_panels.item_image.TouchEventHandlerAbstract.extend({className:"ShopItemPanelItemImageWeaponTouchEventHandler",_onTouchItemImage:function(e,t){},_createItemInformationPopup:function(){return t.createInstance("popupFactoryShWeaponInfo").create()},_getItemInformationPopupData:function(){}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e.console,t.createNameSpaceIfNotExists("shop.shop_item.shop_item_panels.item_image"),t.shop.shop_item.shop_item_panels.item_image.AccessoryTouchEventHandler=t.shop.shop_item.shop_item_panels.item_image.TouchEventHandlerAbstract.extend({className:"ShopItemPanelItemImageAccessoryTouchEventHandler",_onTouchItemImage:function(e,t){},_createItemInformationPopup:function(){var e=n.director.getRunningScene();return t.ImplantedPopup.createOrGet(e,"acce_data","AcceDataPopup")},_getItemInformationData:function(){}})}((this||0).self||global),function(e){var t=e.kh;t.createNameSpaceIfNotExists("shop.shop_item.shop_item_panels.price"),t.shop.shop_item.shop_item_panels.price.Controller=t.shop.shop_item.shop_item_panels.ControllerAbstract.extend({className:"ShopItemPanelPriceController",WIDGET_NAME:"price_no",_setSuffixByCurrencyType:function(e){this.SUFFIX_BY_CURRENCY_TYPE={},this.SUFFIX_BY_CURRENCY_TYPE[e.POINT]="",this.SUFFIX_BY_CURRENCY_TYPE[e.PSEUDO_CURRENCY]="",this.SUFFIX_BY_CURRENCY_TYPE[e.STONE]=""},initialize:function(){var e=this._shopItemModel.CURRENCY_TYPES;this._setSuffixByCurrencyType(e),this._setLabelText()},_createView:function(){return t.createInstance("ShopItemPanelPriceView",this._getLabel())},_setLabelText:function(){var e=this._getLabelText();this._showView(e)},_getLabelText:function(){var e=this._shopItemModel.getPrice(),t=this._shopItemModel.getCurrencyType();return e+this.SUFFIX_BY_CURRENCY_TYPE[t]},_getLabel:function(){return this._getWidget(this.WIDGET_NAME)}})}((this||0).self||global),function(e){var t=(e._,e.kh);e.cc,t.createNameSpaceIfNotExists("shop.shop_item.shop_item_panels.price"),t.shop.shop_item.shop_item_panels.price.View=t.shop.shop_item.shop_item_panels.ViewAbstract.extend({className:"ShopItemPanelPriceView",show:function(e){null!=this._widget&&this._widget.setString(e.toString())}})}((this||0).self||global),function(e){var t=e.kh,n=e.console;t.createNameSpaceIfNotExists("shop.shop_item.shop_item_panels.currency"),t.shop.shop_item.shop_item_panels.currency.Controller=t.shop.shop_item.shop_item_panels.ControllerAbstract.extend({className:"ShopItemPanelCurrencyController",WIDGET_NAME:"price_label",_setTextByCurrencyType:function(e){this.TEXT_BY_CURRENCY_TYPE={},this.TEXT_BY_CURRENCY_TYPE[e.POINT]="",this.TEXT_BY_CURRENCY_TYPE[e.PSEUDO_CURRENCY]="",this.TEXT_BY_CURRENCY_TYPE[e.STONE]=""},initialize:function(){var e=this._shopItemModel.CURRENCY_TYPES;this._setTextByCurrencyType(e),this._setLabelText()},_createView:function(){return t.createInstance("ShopItemPanelCurrencyView",this._getLabel())},_setLabelText:function(){var e=this._getLabelText();this._showView(e)},_getLabelText:function(){var e=this._shopItemModel.getCurrencyType(),t=this.TEXT_BY_CURRENCY_TYPE[e];return null==t?(n.warn("ShopItemPanelCurrencyController._getLabelText: No text found for currency type: {"+e+"}!"),this._getLabel().string):t},_getLabel:function(){return this._getWidget(this.WIDGET_NAME)}})}((this||0).self||global),function(e){var t=(e._,e.kh);e.cc,t.createNameSpaceIfNotExists("shop.shop_item.shop_item_panels.currency"),t.shop.shop_item.shop_item_panels.currency.View=t.shop.shop_item.shop_item_panels.ViewAbstract.extend({className:"ShopItemPanelCurrencyView",show:function(e){null!=this._widget&&this._widget.setString(e.toString())}})}((this||0).self||global),function(e){var t=e.kh;t.createNameSpaceIfNotExists("shop.shop_item.shop_item_panels.sale_image"),t.shop.shop_item.shop_item_panels.sale_image.Controller=t.shop.shop_item.shop_item_panels.ControllerAbstract.extend({className:"ShopItemPanelSaleImageController",WIDGET_NAME:"salelist",initialize:function(){this._setImage()},_createView:function(){return t.createInstance("ShopItemPanelItemImageView",this._getImageView())},_setImage:function(){var e=this._getImagePath();this._showView(e)},_getImagePath:function(){var e=this._shopItemModel.getShopItemId();return t.Img("salelist","shop-point",_.padZero(e,4)).png},_getImageView:function(){return this._getWidget(this.WIDGET_NAME)}})}((this||0).self||global),function(e){var t=(e._,e.kh);e.cc,t.createNameSpaceIfNotExists("shop.shop_item.shop_item_panels.sale_image"),t.shop.shop_item.shop_item_panels.sale_image.View=t.shop.shop_item.shop_item_panels.ViewAbstract.extend({className:"ShopItemPanelSaleImageView",show:function(e){null!=this._widget&&this._widget.setBackGroundImage(e)}})}((this||0).self||global),function(e){var t=e._,n=e.kh,i=e.cc;n.createNameSpaceIfNotExists("shop.shop_item.shop_item_panels"),n.shop.shop_item.shop_item_panels.ControllerAbstract=i.Class.extend({className:"ShopItemPanelControllerAbstract",COMPONENT_CONTROLLER_NAMES:[],ctor:function(e,t,n){this._shopItemModel=e,this._playerCurrencyModel=t,this._panelWidget=n},initializeShopItemPanel:function(){t(this.COMPONENT_CONTROLLER_NAMES).map(this._createComponentController,this).invoke("initialize")},_createComponentController:function(e){return n.createInstance(e,[this._shopItemModel,this._playerCurrencyModel,this._panelWidget])}})}((this||0).self||global),function(e){var t=(e._,e.kh);e.cc,t.createNameSpaceIfNotExists("shop.shop_item.shop_item_panels"),t.shop.shop_item.shop_item_panels.HiddenController=t.shop.shop_item.shop_item_panels.ControllerAbstract.extend({className:"HiddenShopItemPanelController",initializeShopItemPanel:function(){this._panelWidget.setOpacity(0)}})}((this||0).self||global),function(e){var t=(e._,e.kh);e.cc,t.createNameSpaceIfNotExists("shop.shop_item.shop_item_panels"),t.shop.shop_item.shop_item_panels.NormalController=t.shop.shop_item.shop_item_panels.ControllerAbstract.extend({className:"NormalShopItemPanelController",COMPONENT_CONTROLLER_NAMES:["ShopItemPanelBuyButtonController","ShopItemPanelDescriptionController","ShopItemPanelHeaderController","ShopItemPanelItemImageController","ShopItemPanelPriceController","ShopItemPanelCurrencyController"]})}((this||0).self||global),function(e){var t=(e._,e.kh),n=e.cc;t.createNameSpaceIfNotExists("shop.shop_item"),t.shop.shop_item.PanelController=n.Class.extend({className:"ShopItemPanelController",ctor:function(e,t,n){this._shopItemModel=e,this._playerCurrencyModel=t,this._panelWidget=n},initializeShopItemPanel:function(){this._createPanelController().initializeShopItemPanel()},_createPanelController:function(){return t.createInstance(this._getPanelControllerName(),[this._shopItemModel,this._playerCurrencyModel,this._panelWidget])},_getPanelControllerName:function(){return this._shopItemModel.isEmpty()?"HiddenShopItemPanelController":(this._shopItemModel.isOnSale(),"NormalShopItemPanelController")}})}((this||0).self||global),function(e){var t=(e._,e.kh),n=e.cc,i=e.khutil,a=e.console;t.createNameSpaceIfNotExists("shop.shop_item_list"),t.shop.shop_item_list.ControllerAbstract=n.Class.extend({className:"ShopItemListControllerAbstract",ROOT_WIDGET_NAME:"",SHOP_TYPE:"",initializeShopItemList:function(e,t){},initShopItem:function(e,t){var n=this._createShopItemModel(t.getRawData(),this.SHOP_TYPE);this._createShopItemPanelController(n,this._playerCurrencyModel,e).initializeShopItemPanel()},refreshItemList:function(e){this._playerCurrencyModel=e,this._controller.refresh(!1)},_createShopItemModel:function(e,n){return t.createInstance("ShopItemModel",[e,n])},_createShopItemPanelController:function(e,n,i){return t.createInstance("ShopItemPanelController",[e,n,i])},_getRootWidget:function(){return i.getWidget(this.ROOT_WIDGET_NAME,function(e){a.warn(this.className+"._getRootWidget: "+e)}.bind(this))}})}((this||0).self||global),function(e){var t=(e._,e.kh),n=e.cc;t.createNameSpaceIfNotExists("shop.shop_item_list"),t.shop.shop_item_list.PointController=t.shop.shop_item_list.ControllerAbstract.extend({className:"PointShopItemListController",ctor:function(){this.SHOP_TYPE=t.shop_item.Model.prototype.SHOP_TYPES.POINT},initializeShopItemList:function(e){var i=n.director.getRunningScene().seekWidgetByName("window_gray"),a=[t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE],o=new t.core.pager.model.ApiDataListFactory("apiShop","getGoodsPoint",a),r=i.seekWidgetByName("sh_red_list_ui"),s=new t.core.pager.view.page.BasePageUiFactory(r,this.initShopItem.bind(this)),c=new t.core.pager.controller.PagerController(i,o,[s],r);new t.core.pager.view.button.ViewPageUi(i.seekWidgetByName("viewpage_ui"),c).initialize(),c.initialize(),this._controller=c}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e.console;t.createNameSpaceIfNotExists("shop.real_money_transaction_caution"),t.shop.real_money_transaction_caution.CautionPopupViewedStateHandler=n.Class.extend({className:"CautionPopupViewedStateHandler",CACHE_KEY:"sh_currency_caution",initializeViewedState:function(){return null!=this.getViewedState()?Q.resolve():this._fetchViewState().then(this._cacheViewState.bind(this))},getViewedState:function(){return this._getComponentCache().get(this.CACHE_KEY)},setStateToViewed:function(){var e=this._getComponentCache();if(!0!==e.get(this.CACHE_KEY)){var t=this._getViewedStateApi();return e.cache(this.CACHE_KEY,!0),t.visited(this.CACHE_KEY).fail(function(e){i.error(e&&e.stack?e.stack:e)})}},_fetchViewState:function(){return this._getViewedStateApi().get(this.CACHE_KEY).then(function(e){return e.body.visited},function(e){i.error(e&&e.stack?e.stack:e)})},_cacheViewState:function(e){this._getComponentCache().cache(this.CACHE_KEY,e)},_getComponentCache:function(){return t.createInstance("componentCache")},_getViewedStateApi:function(){return t.createInstance("apiASubTutorialPages")}})}((this||0).self||global),function(e){var t=e.kh;t.createNameSpaceIfNotExists("shop.real_money_transaction_caution"),t.shop.real_money_transaction_caution.PopupShCurrencyCaution=t.ImplantedPopup.extend({className:"PopupShCurrencyCaution",ROOT_NODE:"sh_currency_caution",DI_NAME:"PopupShCurrencyCaution",BUTTON_NAMES:{CONFIRM:"btn_ok"},_initContents:function(){this._initButtons()},_initButtons:function(){var e={};e[this.BUTTON_NAMES.CONFIRM]=this.dismiss.bind(this,!0),this.setButtonEvents(e)}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.console;t.createNameSpaceIfNotExists("shop.real_money_transaction_legal_info"),t.shop.real_money_transaction_legal_info.PopupShPaymentServices=t.ImplantedPopup.extend({className:"PopupShPaymentServices",ROOT_NODE:t.env.isR18?"sh_payment_services_r":"sh_payment_services",DI_NAME:"PopupShPaymentServices",BUTTON_NAMES:{CONFIRM:"btn_ok"},CONTENT_WIDGET_NAME:"listview_node",_initContents:function(){this._initScrollbar(),this._initButtons()},_initButtons:function(){var e={};e[this.BUTTON_NAMES.CONFIRM]=this.dismiss.bind(this,!0),this.setButtonEvents(e)},_initScrollbar:function(){var e=n.getWidgetFromNode(this.getNode(),this.CONTENT_WIDGET_NAME,function(e){i.error("PopupShPaymentServices: "+e)}.bind(this));t.createInstance("ScrollBar",[e,this.getNode()])}})}((this||0).self||global),function(e){var t=e.kh;t.createNameSpaceIfNotExists("shop.real_money_transaction_legal_info"),t.shop.real_money_transaction_legal_info.PopupShSpecifiedCommercialTransactions=t.ImplantedPopup.extend({className:"PopupShSpecifiedCommercialTransactions",ROOT_NODE:t.env.isR18?"sh_specified_commercial_transactions_r":"sh_specified_commercial_transactions",DI_NAME:"PopupShSpecifiedCommercialTransactions",BUTTON_NAMES:{CONFIRM:"btn_ok"},CONTENT_WIDGET_NAME:"listview_node",_initContents:function(){this._initScrollbar(),this._initButtons()},_initButtons:function(){var e={};e[this.BUTTON_NAMES.CONFIRM]=this.dismiss.bind(this,!0),this.setButtonEvents(e)},_initScrollbar:function(){var e=khutil.getWidgetFromNode(this.getNode(),this.CONTENT_WIDGET_NAME,function(e){console.error("PopupShPaymentServices: "+e)}.bind(this));t.createInstance("ScrollBar",[e,this.getNode()])}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("shop.vending_process"),t.shop.vending_process.PointController=n.Class.extend({className:"PointVendingProcessController",ctor:function(e){this._shopItemModel=e},buy:function(){this._handleCautionPopup().then(this._requestPlatformTransaction.bind(this)).then(this.showTransactionResult.bind(this)).then(this._refreshPage.bind(this))},showTransactionResult:function(e){return this._createTransactionResultPopup().open(this._shopItemModel,e.num)},_handleCautionPopup:function(){var e=this._createCautionPopupViewedStateHandler();return e.getViewedState()?Q.resolve():this._showCautionPopup(e)},_showCautionPopup:function(e){return this._createCautionPopup().open().then(this._setCautionPopupStateToViewed.bind(null,e))},_requestPlatformTransaction:function(){var e={num:1,name:this._shopItemModel.getName(),description:this._shopItemModel.getDescription(),price:this._shopItemModel.getPrice(),itemId:this._shopItemModel.getShopItemId(),contentId:this._shopItemModel.getContentId(),contentType:this._shopItemModel.getContentType()};return t.createInstance("paymentRequest").requestShopItem(e,{component:"shop"})},_setCautionPopupStateToViewed:function(e){e.setStateToViewed()},_createCautionPopupViewedStateHandler:function(){return t.createInstance("CautionPopupViewedStateHandler")},_createCautionPopup:function(){var e=t.shop.real_money_transaction_caution.PopupShCurrencyCaution.prototype,i=n.director.getRunningScene();return t.ImplantedPopup.createOrGet(i,e.ROOT_NODE,e.DI_NAME)},_createTransactionResultPopup:function(){var e=t.vending_process.PopupShBuyResult.prototype,i=n.director.getRunningScene();return t.ImplantedPopup.createOrGet(i,e.ROOT_NODE,e.DI_NAME)},_refreshPage:function(){n.director.getRunningScene().refresh()}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e.console;t.createNameSpaceIfNotExists("shop.vending_process"),t.shop.vending_process.TransactionResultController=n.Class.extend({className:"TransactionResultController",showTransactionResult:function(){return this._hasTransactionResult()?this._getTransactionResult().then(function(e){var t=this._createShopItemModel(e),n=this._createVendingProcessController(t);return this._clearTransactionResult(),n.showTransactionResult(e)}.bind(this)):Q.resolve()},_hasTransactionResult:function(){return null!=n.director.getRunningScene().routerParams.payment_id},_getTransactionResult:function(){var e=n.director.getRunningScene().routerParams.payment_id;return t.createInstance("apiShopBuyResult").put(e).then(function(e){return e.body},function(e){i.error(e&&e.stack?e.stack:e)})},_createShopItemModel:function(e){var n=t.shop_item.Model.prototype.SHOP_TYPES.POINT,i=t.shop_item.Model.prototype.CURRENCY_TYPES.POINT;return t.createInstance("ShopItemModel",[{shop_item_id:e.shop_item_Id,currency_type:i,id:e.id,kind:e.kind},n])},_createVendingProcessController:function(e){return t.createInstance("PointVendingProcessController",[e])},_showTransactionResult:function(e){return e.showTransactionResult()},_clearTransactionResult:function(){t.createInstance("router").permanentlyRemoveRouterParam("payment_id")}})}((this||0).self||global),function(e){var t=(e._,e.kh),n=e.cc,i=e.khutil,a=e.console;t.createNameSpaceIfNotExists("shop.header"),t.shop.header.Controller=n.Class.extend({className:"ShopHeaderController",WIDGET_NAMES:{HEADER:"header_label",SUB_HEADER:"header_sub_label"},_setControllersByShopType:function(){var e=t.shop_item.Model.prototype.SHOP_TYPES;this.CONTROLLERS_BY_SHOP_TYPE={},this.CONTROLLERS_BY_SHOP_TYPE[e.PSEUDO_CURRENCY]=this._createPseudoCurrencyHeaderController(),this.CONTROLLERS_BY_SHOP_TYPE[e.STONE]=this._createStoneHeaderController()},ctor:function(e,t){this._headerView=this._createHeaderView(),this._subHeaderView=this._createSubHeaderView(),this._setControllersByShopType(),this._currentShopType=e,this._playerCurrencyModel=t,this.updateHeaderPlayerCurrency(t),this.updateHeaderShopType(e)},updateHeaderPlayerCurrency:function(e){this._playerCurrencyModel=e,this._getHeaderControllerByShopType(this._currentShopType).updateShopHeader(e)},updateHeaderShopType:function(e){this._currentShopType=e,this._getHeaderControllerByShopType(e).updateShopHeader(this._playerCurrencyModel)},_getHeaderControllerByShopType:function(e){return this.CONTROLLERS_BY_SHOP_TYPE[e]},_createPseudoCurrencyHeaderController:function(){return t.createInstance("PseudoCurrencyShopHeaderController",[this._headerView,this._subHeaderView])},_createStoneHeaderController:function(){return t.createInstance("StoneShopHeaderController",[this._headerView,this._subHeaderView])},_getWidget:function(e){return i.getWidget(e,function(e){a.warn(this.className+"._getWidget: "+e)}.bind(this))},_createHeaderView:function(){return t.createInstance("ShopHeaderView",[this._getWidget(this.WIDGET_NAMES.HEADER)])},_createSubHeaderView:function(){return t.createInstance("ShopSubHeaderView",[this._getWidget(this.WIDGET_NAMES.SUB_HEADER)])}})}((this||0).self||global),function(e){var t=(e._,e.kh),n=e.cc;t.createNameSpaceIfNotExists("shop.header"),t.shop.header.PseudoCurrencyController=n.Class.extend({className:"PseudoCurrencyShopHeaderController",HEADER_TEXT:"",SUB_HEADER_TEXT:"{currentCurrencyAmount}",ctor:function(e,t){this._headerView=e,this._subHeaderView=t},updateShopHeader:function(e){this._updateHeader(),this._updateSubHeader(e)},_updateHeader:function(){this._headerView.show(this.HEADER_TEXT)},_updateSubHeader:function(e){var t=e.getPseudoCurrencyAmount(),n=this.SUB_HEADER_TEXT.replace("{currentCurrencyAmount}",t);this._subHeaderView.show(n)}})}((this||0).self||global),function(e){var t=(e._,e.kh),n=e.cc;t.createNameSpaceIfNotExists("shop.header"),t.shop.header.StoneController=n.Class.extend({className:"StoneShopHeaderController",HEADER_TEXT:"",SUB_HEADER_TEXT:"{currentCurrencyAmount}",ctor:function(e,t){this._headerView=e,this._subHeaderView=t},updateShopHeader:function(e){this._updateHeader(),this._updateSubHeader(e)},_updateHeader:function(){this._headerView.show(this.HEADER_TEXT)},_updateSubHeader:function(e){var t=e.getStoneAmount(),n=this.SUB_HEADER_TEXT.replace("{currentCurrencyAmount}",t);this._subHeaderView.show(n)}})}((this||0).self||global),function(e){var t=(e._,e.kh),n=e.cc;t.createNameSpaceIfNotExists("shop.header"),t.shop.header.View=n.Class.extend({className:"ShopHeaderView",ctor:function(e){this._widget=e},show:function(e){this._widget.string=e}})}((this||0).self||global),function(e){var t=(e._,e.kh),n=e.cc;t.createNameSpaceIfNotExists("shop.header"),t.shop.header.SubHeaderView=n.Class.extend({className:"ShopSubHeaderView",ctor:function(e){this._widget=e},show:function(e){this._widget.string=e}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=(e.ccui,e._),a=e.console;t.createNameSpaceIfNotExists("shop.controller"),t.shop.controller.ShopCheckChangePopupController=t.ImplantedPopup.extend({className:"ShopCheckChangePopupController",ROOT_NODE:"sh_change_check",DI_NAME:"ShopCheckChangePopupController",BUTTON_NAMES:{CLOSE:"btn_popup_close",EXCHANGE:"btn_blue_l_1"},open:function(e,n){return t.ImplantedPopup.prototype.open.apply(this,arguments)},getSelectedAmount:function(){return this._selectedValue},_openAnimation:function(){var e=this._super().then(this._setPopupAppearance.bind(this,this.getNode(),this._record));return this._record=null,e},_initContents:function(e,t){this._selectedValue=1;var n=this.getNode();this._record=t,this._setProduct(n,t),this._setMaterials(n,t),this._initButtons(e,t)},_initButtons:function(e,t){var n={};n[this.BUTTON_NAMES.CLOSE]=!1,n[this.BUTTON_NAMES.EXCHANGE]=!0,this.setButtonEvents(n)},_setPopupAppearance:function(e,t){e.setAppearance("material_view_0"+t.materials.length),this._setBuyPopupPulldown(e,t)},_setProduct:function(e,t){this._setImage(e,t),this._setProductNameAndAmount(e,t)},_setImage:function(e,t){switch(t.kind){case"item":case"treasure":return void this._setCoreCardItem(e,t.game_item);case"weapon":return void this._setCoreCardWeapon(e,t.game_item);case"summon":return void this._setCoreCardSummon(e,t.game_item);case"package":return void this._setCoreCardPackage(e,t.game_item);case"character":return void this._setCoreCardCharacter(e,t.game_item);case"accessory":return void this._setCoreCardAccessory(e,t.game_item);default:a.error("",t)}},_setCoreCardItem:function(e,n){var i=t.createInstance("CoreCardItemUI");i.setImg(n.item_id);var a=i.getResult();this._changeCheckPopupShowCoreCard(e,a)},_setCoreCardPackage:function(e,n){var i=t.createInstance("CoreCardPackageItemUI");i.setImg(n.package_id);var a=i.getResult();this._changeCheckPopupShowCoreCard(e,a)},_setCoreCardSummon:function(e,n){var i=t.createInstance("CoreCardSummonUI",["e_r"]);i.setImg(n.summon_id,0),i.setIconElement(n.element_type),i.setIconRarity(n.rare);var a=i.getResult();this._changeCheckPopupShowCoreCard(e,a)},_setCoreCardWeapon:function(e,n){var i=t.createInstance("CoreCardWeaponUI",["e_r"]);i.setAroused(!1),i.setImg(n.weapon_id,0),i.setIconElement(n.element_type),i.setIconRarity(n.rare);var a=i.getResult();this._changeCheckPopupShowCoreCard(e,a)},_setCoreCardCharacter:function(e,n){var i=t.createInstance("CoreCardCharacterUI",["e_r"]);i.setAroused(n.is_aroused),i.setImg(n.character_id,n.skin||0),i.setIconElement(n.element_type),i.setIconRarity(n.rare);var a=i.getResult();this._changeCheckPopupShowCoreCard(e,a)},_setCoreCardAccessory:function(e,n){var i=t.createInstance("CoreCardAccessoryUI",["e_r"]);i.setImg(n.accessory_id),i.setIconElement(n.element_type),i.setIconRarity(n.rare);var a=i.getResult();this._changeCheckPopupShowCoreCard(e,a)},_changeCheckPopupShowCoreCard:function(e,t){var n=e.seekWidgetByName("corecard_ui");n.removeAllChildren(),n.addChild(t),n.setVisible(!0)},_setProductNameAndAmount:function(e,n){var a=e.seekWidgetByName("main_labelimg");a.setVisible(!1);var o=(a.getSize(),this._formatDescription(n.description)),r=n.name;i.isFinite(n.amount)&&(r+="x"+n.amount);var s='<div class="text_common_shop" style="white-space:nowrap;vertical-align:top;">'+("<span class='red'>"+r+"</span><br />"+("package"===n.kind?"":"&nbsp;"+n.have_num+"<br />")+o)+"</div>";a.setHtmlStrings({main_labelimg:s},t.GameConfig.POPUP_CSS),a.setVisible(!0)},_formatDescription:function(e){return e.replace(/\r?\n/g,"<br>")},_setMaterials:function(e,n){i.each(n.materials,function(n,a){var o=e.seekWidgetByName("sh_change_material_ui_"+a),r=t.Img("corecard","item",i.padZero(n.item_id,4)).jpg;o.seekWidgetByName("material_img").loadTexture(r),this._createAmountLabelTexture(o,n,this._selectedValue)},this)},_createAmountLabelTexture:function(e,i,a){var o=e.seekWidgetByName("amount_labelimg");o.setVisible(!1);var r=i.current_amount,s=i.required_amount,c=r-a*s,u=n.size(320,65);o.setSize(n.size(u.width,u.height));var l="<div class='text_common_left' style='white-space: nowrap;'><span class='white'>"+i.name+""+s*a+"</span><br /><span class='yellow'></span>         <span class='white'>"+r+"&nbsp;&rarr;&nbsp;</span><span class='red'>"+c+"</span></div>";o.setHtmlStrings({amount_labelimg:l},t.GameConfig.POPUP_CSS),o.setVisible(!0)},_setBuyPopupPulldown:function(e,i){var a=this._getPulldownCondition(i),o=!!a.length;if(e.seekWidgetByName("btn_pulldown").setVisible(o),e.seekWidgetByName("unit_label").setVisible(o),e.seekWidgetByName("btn_blue_l_1").setTouchEnabled(o),e.seekWidgetByName("btn_blue_l_1").color=o?n.color("#FFFFFF"):n.color("#808080"),a.length){var r=e.seekWidgetByName("sort_ui");if(a&&a.length<10){var s=45*(10-a.length);r.setPositionY(134-s)}var c=e.seekWidgetByName("btn_pulldown");c.setTouchEnabled(!0),this.popupPulldown=new t.Pulldown({button:c,label:c.seekWidgetByName("amount_label"),menuBase:e.seekWidgetByName("gud_sh_sort"),choice:ccs.load(res["core-sort-sort_list_ui"]).node},a),this.popupPulldown.onChange(function(t){this._selectedValue=t.value,this._setMaterials(e,i)}.bind(this))}},_getPulldownCondition:function(e){var t=this._getRemainingNum(e),n=!1,a=i.compact(i.map(i.range(t),function(t){return n?null:(t++,!i.some(e.materials,function(e){return e.required_amount*t>e.current_amount})?{value:t,text:t}:(n=!0,null))}));return a.length?(a[0].selected=!0,a):[]},_getRemainingNum:function(e){return e.stock_info.has?e.stock_info.amount:10},dismiss:function(e){this.popupPulldown&&this.popupPulldown.releaseMenu(),this._super(e)}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.createNameSpaceIfNotExists("shop.model"),n.shop.model.ShopFilterConfig=n.displayFilter.model.DisplayFilterConfig.extend({CATEGORY_TYPE:"category_type",ctor:function(e){this._super.apply(this,arguments),this._filterName=e,this._filterEntity=n.createInstance("displayFilterRepository").getAsOffline(e)},update:function(){this._filterEntity.plainBody=t.merge({},{filter_config:this._filterEntity._editable}),this._filterEntity._modified=!1,this._notifyModelUpdated()},existsFilter:function(e){return!t.isEmpty(this._filterEntity.getPropertyOrDefault(e,[]))},containsCategory:function(e){var n=this._filterEntity.getPropertyOrDefault(this.CATEGORY_TYPE,[]);return t.contains(n,e)},toggleCategory:function(e){this._filterEntity.toggleConfigProperty(this.CATEGORY_TYPE,e),this._notifyPropertyChanged()},cancelModifications:function(){this._filterEntity.cancelModifications(),this.update()}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.createNameSpaceIfNotExists("shop.shopFilter"),t.shop.shopFilter.CategorySettingUI=t.displayFilter.view.SettingButtonGroupUI.extend({className:"CategorySettingUI",PARENT_NODE_NAME:"com_filter_weapon_select_base_2",TOGGLE_METHOD_NAME:"toggleCategory",CHECK_METHOD_NAME:"containsCategory",BUTTON_VALUES:{category_btn_weapon:"weapon",category_btn_summon:"summon",category_btn_chara:"chara",category_btn_material:"material",category_btn_ticket:"ticket",category_btn_other:"other"}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.createNameSpaceIfNotExists("shop.shopFilter"),t.shop.shopFilter.ComShopFilterPopup=t.displayFilter.view.ComFilterPopup.extend({_initContents:function(e){this._configModel=e,this._categoryUIView=new t.shop.shopFilter.CategorySettingUI(this.getNode(),this._configModel),this._elementTypeUIView=new t.displayFilter.view.ElementTypeSettingUI(this.getNode(),this._configModel),this._weaponTypeUIView=new t.displayFilter.view.WeaponTypeSettingUI(this.getNode(),this._configModel)},_clean:function(){this._onDispose()},_onDispose:function(){this._categoryUIView.clean(),this._elementTypeUIView.clean(),this._weaponTypeUIView.clean()}})}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.shop=t.pc.shop||{},t.pc.shop.sh_001=t.pc.shop.sh_001||{},t.pc.shop.sh_001.Scene=t.BaseScene.extend({resourceFileName:"sh_001/sh_001.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"shop",sceneName:"sh_001",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_coin","btnCallbackBtnCoin",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"shop/sh_002")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_stone","btnCallbackBtnStone",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"shop/sh_003")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_treasure","btnCallbackBtnTreasure",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"shop/sh_004")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_acce","btnCallbackBtnAcce",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"shop/sh_010")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_orb","btnCallbackBtnOrb",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"shop/sh_011")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_hint","btnCallbackBtnHint",null,function(){alert("{{popupcom_tutorial}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc=t.pc||{},t.pc.shop=t.pc.shop||{},t.pc.shop.sh_001=t.pc.shop.sh_001||{},t.pc.shop.sh_001.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../sh_popup_ui.json"],_popups:{can_not_use_accessory:{factoryName:"popupFactoryTextOnly",resource:"text_button_only.json",title:"Rank",content:"Rank20",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){this.dismiss()}}}},onSceneInit:function(e){return this._verifyRouterParams001(e),t.createInstance("apiABanners").getShopBanners().then(function(n){return this._fillupList(e,{viewParent:t.PageListParams.SHOP_LIST.viewParent,subPageRes:t.PageListParams.SHOP_LIST.subPageRes,panelsPerPage:t.PageListParams.SHOP_LIST.perPage},n.body.data,n.body.max_record_count,{targetNode:"eventimg_banner",touchEventFuncName:"_onTouchEventToBanner"},this._setPanelAppearance),n.body}.bind(this)).fail(function(e){console.error(e.stack)}),this._setBackBtn(e),this._showSubTutorialFirstAccess(e),a.resolve()},_onTouchEventToBanner:function(e,a){if(a.limited_in_accessory){n.director.getRunningScene().popups.can_not_use_accessory.open()}else{var o=a.navigate_page,r={};r[i.last(o.split("/"))]={shop_id:a.shop_id},t.createInstance("router").navigate(o,r,{shop_id:a.shop_id})}},_setPanelAppearance:function(e,n,a){var o=t.Img("eventimg","banner",i.padZero(n.banner_id,4)).png,r=e.seekWidgetByName("eventimg_banner");if(null!==r){if(n.currency.is_used)e.seekWidgetByName("banner_base").setVisible(!0),e.seekWidgetByName("possession_count_label").setText(n.currency.label);r.loadTextures(o,o,o)}else console.debug("[ERROR] Could not find eventimg_banner")},_showSubTutorialFirstAccess:function(e){var n="shop",i=t.createInstance("apiASubTutorialPages");return i.get(n).then(function(t){t.body.need_first_display&&(this._openSubTutorialPopup(e),i.visited(n))}.bind(this)).fail(function(e){console.error(e.stack)})},btnCallbackBtnHint:function(e){return this._openSubTutorialPopup(e),a.reject(this._override)},_openSubTutorialPopup:function(e){return t.ImplantedPopup.createOrGet(e,"sub_tutorial","ImplantedSubTutorialPopup").open("shop",2)},_touchEndedBackBtnProcess:function(e){this._navigateToMy001()}}),i.assign(t.pc.shop.sh_001.SceneDelegate.prototype,t.pc.shop.roles.Routing,t.pc.list.roles.PageListControllerCommon)}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.shop=t.pc.shop||{},t.pc.shop.sh_002=t.pc.shop.sh_002||{},t.pc.shop.sh_002.Scene=t.BaseScene.extend({resourceFileName:"sh_002/sh_002.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"shop",sceneName:"sh_002",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_tokusho","btnCallbackBtnTokusho",null,function(){alert("{{popupsh_specified_commercial_transactions}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_sikinkessai","btnCallbackBtnSikinkessai",null,function(){alert("{{popupsh_payment_services}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=(e._,e.Q);t.pc=t.pc||{},t.pc.shop=t.pc.shop||{},t.pc.shop.sh_002=t.pc.shop.sh_002||{},t.pc.shop.sh_002.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../sh_popup_ui.json"],_popups:{},onSceneInit:function(e){return this._verifyRouterParams002(e),this._setBackBtn(e),khutil.getWidget("btn_tokusho").setVisible(!1),khutil.getWidget("btn_sikinkessai").setVisible(!1),t.createInstance("TransactionResultController").showTransactionResult(),this._pointShopItemListController=t.createInstance("PointShopItemListController"),this._pointShopItemListController.initializeShopItemList(this),t.createInstance("CautionPopupViewedStateHandler").initializeViewedState()},btnCallbackBtnTokusho:function(e){var n=t.shop.real_money_transaction_legal_info.PopupShSpecifiedCommercialTransactions.prototype;return t.ImplantedPopup.createOrGet(e,n.ROOT_NODE,n.DI_NAME).open(),i.reject(this._override)},btnCallbackBtnSikinkessai:function(e){var n=t.shop.real_money_transaction_legal_info.PopupShPaymentServices.prototype;return t.ImplantedPopup.createOrGet(e,n.ROOT_NODE,n.DI_NAME).open(),i.reject(this._override)},refreshPage:function(){var e=n.director.getRunningScene();return null!==e.seekWidgetByName("salelist")?(delete e.routerParams.payment_id,t.createInstance("sceneManager").reloadScene()):void n.director.getRunningScene().headerDelegate.updateCurrency().then(function(e){this._pointShopItemListController.refreshItemList(e)}.bind(this))},_touchEndedBackBtnProcess:function(e){var n=e.temporaryRouterParams.sh_002;if(null!=n)switch(n.returnPageRoute){case"gacha/ga_100":t.createInstance("router").navigate("gacha/ga_100");break;case"gacha/":case"gacha/ga_000":case"gacha/ga_002":case"gacha/ga_004":case"gacha/ga_010":t.createInstance("router").navigate("gacha/ga_000");break;default:this._navigate001To001()}else this._navigate001To001()}}),t.assignRoles(t.pc.shop.sh_002.SceneDelegate,[t.pc.shop.roles.Routing])}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.shop=t.pc.shop||{},t.pc.shop.sh_101=t.pc.shop.sh_101||{},t.pc.shop.sh_101.Scene=t.BaseScene.extend({resourceFileName:"sh_101/sh_101.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"shop",sceneName:"sh_101",_delegate:null,_init:function(){this._initScene("page_in")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._),i=e.Q;t.pc=t.pc||{},t.pc.shop=t.pc.shop||{},t.pc.shop.sh_101=t.pc.shop.sh_101||{},t.pc.shop.sh_101.SceneDelegate=t.pc.BaseSceneDelegate.extend({onSceneInit:function(e){return this._setBackBtn(e),this._fillUpTreasureBtnsListCore(e),i.resolve()},_fillUpTreasureBtnsListCore:function(e){var n,i=e.routerParams.sh_101.shop_id;switch(i){case 1e4:n="getTreasureEventBanners";break;case 10001:n="getTreasureEpicBanners";break;default:console.error("ID: "+i)}var a=new t.core.pager.model.ApiDataListFactory("apiABanners",n,[t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE]),o=e.seekWidgetByName("window_gray"),r=o.seekWidgetByName("sh_101_event_bannerlist_page_ui"),s=new t.core.pager.view.page.EventBannerPageUi(r,this._onTouchEventBanner,this),c=new t.core.pager.controller.PagerController(o,a,[s],r),u=o.seekWidgetByName("viewpage_ui");new t.core.pager.view.button.ViewPageUi(u,c).initialize(),c.initialize()},_onTouchEventBanner:function(e){var i=e.navigate_page,a={};a[n.last(i.split("/"))]={shop_id:e.shop_id},t.createInstance("router").navigate(i,a,{shop_id:e.shop_id})},_touchEndedBackBtnProcess:function(e){this._navigate001To001()}}),n.assign(t.pc.shop.sh_101.SceneDelegate.prototype,t.pc.shop.roles.ShopCommon,t.pc.shop.roles.Routing)}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.shop=t.pc.shop||{},t.pc.shop.sh_102=t.pc.shop.sh_102||{},t.pc.shop.sh_102.Scene=t.BaseScene.extend({resourceFileName:"sh_102/sh_102.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"shop",sceneName:"sh_102",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_special","btnCallbackBtnSpecial",null,function(){alert("{{CSV}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_filter","btnCallbackBtnFilter",null,function(){alert("{{com_filter_shop}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc=t.pc||{},t.pc.shop=t.pc.shop||{},t.pc.shop.sh_102=t.pc.shop.sh_102||{},t.pc.shop.sh_102.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../sh_popup_ui.json"],_tabSettings:{},_tabAnimationsOnSP:{1:{animation:"tab_nothing",tab_names:[],tab_name_prefix:""},2:{animation:"tab_two",tab_names:["tab_two_0","tab_two_1"],tab_name_prefix:"tab_two_"},3:{animation:"tab_three",tab_names:["tab_three_0","tab_three_1","tab_three_2"],tab_name_prefix:"tab_three_"},4:{animation:"tab_four",tab_names:["tab_four_0","tab_four_1","tab_four_2","tab_four_3"],tab_name_prefix:"tab_four_"}},_tabAnimationsOnPC:{1:{animation:"tab_nothing",tab_names:[],tab_name_prefix:""},2:{animation:"tab_two",tab_names:["tab_two_0","tab_two_1"],tab_name_prefix:"tab_two_"},3:{animation:"tab_three",tab_names:["tab_three_four_0","tab_three_four_1","tab_three_four_2"],tab_name_prefix:"tab_three_four_"},4:{animation:"tab_four",tab_names:["tab_three_four_0","tab_three_four_1","tab_three_four_2","tab_three_four_3"],tab_name_prefix:"tab_three_four_"}},selectTab:0,_shop:null,_paginator:{},_filterModels:{},onSceneInit:function(e){return this._verifyRouterParams102(e),this._setBackBtn(e),this._paginator={},this._buttonView={},this._initScene(e)},_initScene:function(e){var n=this._getShopId(e);return t.createInstance("apiShop").getShop(n).then(function(t){var n=t.body;this._shop=n,this._buildTabs(e,n),this._selectTab(e,n,this.selectTab),this._buildShopHeader(e,n),this._buildSpecialButton(e,n)}.bind(this)).fail(function(e){console.error(e.stack)})},_updateScene:function(e){var n=this._getShopId(e);return t.createInstance("apiShop").getShop(n).then(function(e){return this._shop=e.body,this._shop}.bind(this)).then(function(t){var n=this.selectTab,i=t.catalogs[n],a=this._paginator[n];a.getDataList().updateProducts(i.products),a.refresh(),this._updateSubHeader(e,i)}.bind(this)).fail(function(e){console.error(e.stack)})},_buildTabs:function(e,n){var a=e.seekWidgetByName("tab_ui");e._tabSettings=t.env.isSp?this._tabAnimationsOnSP[n.catalogs.length]:this._tabAnimationsOnPC[n.catalogs.length],a.animate(e._tabSettings.animation),i.forEach(e._tabSettings.tab_names,function(i,o){a.seekWidgetByName(i).setTitleText(n.catalogs[o].name);var r={};r["TOUCH_ENDED "+i]=function(){this._touchTab(e,o)}.bind(this),t.setTouchEventHandlers(a,r),this._filterModels[o]=new t.shop.model.ShopFilterConfig(i)}.bind(this)),0===e._tabSettings.tab_names.length&&(this._filterModels[0]=new t.shop.model.ShopFilterConfig("0"))},_selectTab:function(e,t,n){this.selectTab=n;var a=e.seekWidgetByName("tab_ui");i.forEach(e._tabSettings.tab_names,function(t){var n=a.seekWidgetByName(t),i=e._tabSettings.tab_name_prefix+this.selectTab;n.setBright(i!==t),n.setEnabled(i!==t)}.bind(this));var o=t.catalogs[n];this._updateSubHeader(e,o),this._buildPager(e,t,n)},_updateSubHeader:function(e,t){(e.seekWidgetByName("header_sub_base").setVisible(!!t.is_currency),t.is_currency)&&e.seekWidgetByName("header_sub_label").setText(t.currency.name+": "+t.currency.amount)},_buildShopHeader:function(e,t){e.seekWidgetByName("header_label").setText(t.name)},_buildSpecialButton:function(e,n){var a=e.seekWidgetByName("panel_special");if(n.special_button_id){a.setVisible(!0);var o=a.seekWidgetByName("btn_special");if(t.env.isSp)o.setTitleText(n.special_button_message);else{var r=t.Img("shop-btn","shop",i.padZero(n.special_button_id,4)).png;o.loadTextureNormal(r),o.loadTexturePressed(r)}}else a.setVisible(!1)},btnCallbackBtnSpecial:function(e){var t=a.defer();return t.reject(this._override),this._navigateToSpecialButtonCode(e,this._shop.special_button_id),t.promise},_buildPager:function(e,n,i){if(this._paginator[i])return this._buttonView[i].initialize(!0),void this._paginator[i].refresh();var a=n.catalogs[i],o=e.seekWidgetByName("tab_currency_node"),r=e.seekWidgetByName("tab_material_node"),s=null,c=null,u=null;a.is_material&&(o.setVisible(!1),r.setVisible(!0),s=t.PageListParams.SHOP_MATERIAL_PRODUCT_LIST,c=this._buildMaterialProductPanel.bind(this),u=r.seekWidgetByName("viewpage_ui")),a.is_currency&&(o.setVisible(!0),r.setVisible(!1),s=t.PageListParams.SHOP_CURRENCY_PRODUCT_LIST,c=this._buildCurrencyProductPanel.bind(this),u=o.seekWidgetByName("viewpage_ui"));var l=this._filterModels[this.selectTab],_=new t.shop.model.ShopItemDataList(a.products,l),p=e.seekWidgetByName(s.viewParent),d=p.seekWidgetByName(s.panelName),h=new t.core.pager.view.page.BasePageUiFactory(d,c),m=new t.core.pager.controller.PagerController(p,_,[h],d),g=new t.core.pager.view.button.ViewPageUi(u,m);g.initialize(),m.initialize(),this._paginator[i]=m,this._buttonView[i]=g},_buildCurrencyProductPanel:function(e,n){var i=n.getRawData();this._setProductPanelCommonProperty(e,i);var a=e.seekWidgetByName("explanation_label"),o=e.seekWidgetByName("price_label"),r=e.seekWidgetByName("price_no"),s=t.env.isSp?"orange_list_base":"currency_list_base",c=e.seekWidgetByName(s);this._buildCoreCard(c,"corecard_ui",i),a.setText(i.description),o.setText(i.currency),r.setText(i.price)},_buildMaterialProductPanel:function(e,n){var a=n.getRawData();this._setProductPanelCommonProperty(e,a);var o=e.seekWidgetByName("corecard_shop_ui");this._buildCoreCard(o,"corecard_shop_ui",a);var r=a.materials;i.forEach(i.range(4),function(n){var a=e.seekWidgetByName("sh_material_ui_"+n),o=r[n];if(i.isUndefined(o))a.setVisible(!1);else{var s=a.getUserData()||{},c=khutil.getCoreCardDINameByRecord(o);i.invoke(s,"setVisible",!1);var u=s[c];u||(u=t.createInstance(c,["plain"]),s[c]=u,a.seekWidgetByName("corecard_ui").addChild(u.getResult()),a.setUserData(s)),u.setData(o),a.seekWidgetByName("need_amount_label").setText(o.current_amount+"/"+o.required_amount);var l=o.is_treasure?this._touchTreasureCoreCard:this._touchItemCoreCard;u.addTouchEventListener(l.bind(this,o)),u.setVisible(!0),a.setVisible(!0)}}.bind(this))},_setProductPanelCommonProperty:function(e,i){e.setVisible(!0);var a=t.createInstance("TreasureModel",[i]),o=a.getStock(),r=e.seekWidgetByName("stock_base");t.createInstance("TreasureNameView").show(e,a),t.createInstance("StockInfoView").show(r,o);var s=e.seekWidgetByName("btn_exchange");s.setColor(i.can_buy?n.color.WHITE:t.GameConfig.UI_GREYOUT_COLOR),s.setEnabled(i.can_buy);var c=n.director.getRunningScene();t.setTouchEventHandlers(s,{"TOUCH_ENDED btn_exchange":function(){this._touchExchange(c,i)}.bind(this)})},_buildCoreCard:function(e,n,a){var o=a.kind,r={weapon:{touchEvent:this._touchWeaponCoreCard,actionName:"e_r"},summon:{touchEvent:this._touchSummonCoreCard,actionName:"e_r"},accessory:{touchEvent:this._touchAcceCoreCard,actionName:"e_r"},character:{touchEvent:this._touchCharaCoreCard,actionName:"e_r"},item:{touchEvent:this._touchItemCoreCard},treasure:{touchEvent:this._touchTreasureCoreCard},package:{touchEvent:this._touchPackageCoreCard}}[o];i.isUndefined(r)&&console.error(":"+o);var s=e.getUserData()||{};i.invoke(s,"setVisible",!1);var c=s[o];c||(c=t.createInstance(khutil.getCoreCardDINameByKind(o),[r.actionName]),s[o]=c,e.seekWidgetByName(n).addChild(c.getResult()),e.setUserData(s)),c.setData(a.game_item),c.addTouchEventListener(function(e,t){t===ccui.Widget.TOUCH_ENDED&&r.touchEvent.call(this,a.game_item)}.bind(this)),c.setVisible(!0)},_getItemType:function(e){return e},_touchWeaponCoreCard:function(e){var i=n.director.getRunningScene();t.ImplantedPopup.createOrGet(i,"sh_weapon_info","ShWeaponInfoPopup").open(e)},_touchSummonCoreCard:function(e){var i=n.director.getRunningScene();t.ImplantedPopup.createOrGet(i,"sh_summon_info","ShSummonInfoPopup").open(e)},_touchAcceCoreCard:function(e){var i=n.director.getRunningScene();t.ImplantedPopup.createOrGet(i,"acce_data","AcceDataPopup").open(e)},_touchCharaCoreCard:function(e){var i=t.createInstance("router").getCurrentFragment(),a=n.director.getRunningScene(),o=a.temporaryRouterParams;this._navigateToStatus001(e.character_id,i,Object.assign({shop_id:this._getShopId(a)},o))},_touchItemCoreCard:function(e){var i=n.director.getRunningScene();t.ImplantedPopup.createOrGet(i,"sh_item_info","ShItemInfoPopup").open(e)},_touchTreasureCoreCard:function(e){var i=n.director.getRunningScene();t.ImplantedPopup.createOrGet(i,"com_need_mate","ShComNeedMatePopup").open(e)},_touchPackageCoreCard:function(e){var i=n.director.getRunningScene();t.ImplantedPopup.createOrGet(i,"sh_package_item_info","ShPackageItemInfoPopup").open(e)},_touchTab:function(e,t){this._selectTab(e,this._shop,t)},btnCallbackBtnFilter:function(e){var n=this._filterModels[this.selectTab];return n?(t.ImplantedPopup.createOrGet(e,"com_filter_shop").open(n).then(n.update.bind(n)).then(function(){this._paginator[this.selectTab].setCurrentPageNumber(1)}.bind(this)),a.reject(this._override)):(console.error("filterModel not found:",this._filterModels),a.reject(this._override))},_touchExchange:function(e,n){var i=t.ImplantedPopup.createOrGet(e,"sh_change_check","ShopCheckChangePopupController");i.open(e,n).then(function(){this.exchange(n,i.getSelectedAmount())}.bind(this))},_reformatProductObject:function(e){var t=i.cloneDeep(e);return t.item_description=e.game_item.description,t.exchange_items=e.materials,t},exchange:function(e,i){t.createInstance("apiShop").buyProduct(e.product_id,i).then(function(t){t.body.result?(n.director.getRunningScene().headerDelegate.updateCurrency(),this._showResultPopup(n.director.getRunningScene(),e,t.body)):console.error(new Error(""))}.bind(this)).fail(function(e){console.error(e.stack)})},_showResultPopup:function(e,n,i){var a=i.amount,o=this._createShopItemModel(n),r=t.ImplantedPopup.createOrGet(e,"sh_buy_result","PopupShBuyResult");this._updateScene(e).then(function(){r.open(o,a)}.bind(this))},_createShopItemModel:function(e){var n=t.shop_item.Model.prototype.SHOP_TYPES.STONE,i=t.shop_item.Model.prototype.CURRENCY_TYPES.STONE,a="treasure"===e.kind?"item":e.kind,o=a+"_id",r=e;return r.shop_item_id=e.game_item[o],r.currency_type=i,r.id=e.game_item[o],r.shop_item_type=a,r.kind=a,r.rare=e.game_item.rare,r.element_type=e.game_item.element_type,t.createInstance("ShopItemModel",[r,n])},_touchEndedBackBtnProcess:function(e){var n=e.temporaryRouterParams.sh_102;return n&&n.returnPageRoute?void t.createInstance("router").navigate(n.returnPageRoute,{},n.temporaryRouterParams||{}):void this._navigate001To001()},_getShopId:function(e){return"number"==typeof e.temporaryRouterParams.shop_id?e.temporaryRouterParams.shop_id:e.routerParams.sh_102.shop_id}}),t.assignRoles(t.pc.shop.sh_102.SceneDelegate,[t.pc.shop.roles.Routing])}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=(e.ccui,e._),a=e.console;t.createNameSpaceIfNotExists("shop.model"),t.shop.model.ShopItemDataList=t.core.pager.model.PlainDataList.extend({className:"ShopItemDataList",ctor:function(e,t){this._super(e),this._filterModel=t},updateProducts:function(e){this._cachedModels=e.map(function(e){return new t.core.pager.model.PlainData(e)})},_sliceModels:function(e,t){var n=(e-1)*t;return Q.resolve(this._filterProducts(this._cachedModels).slice(n,n+t))},getMaxRecordCount:function(){return this._filterProducts(this._cachedModels).length},_filterProducts:function(e){var t=this._filterModel;if(!t)return a.warn("filterModel not found:",n.director.getRunningScene()._delegate._filterModels),e;var o=t.existsFilter("element_type"),r=t.existsFilter("weapon_type"),s=t.existsFilter("category_type");return o||r||s?e.filter(function(e){var n=e.getRawData(),a=n.filter_category||n.kind,c=n.game_item;return!(!i.isUndefined(c.element_type)&&o&&!t.containsElementType(c.element_type)||c.weapon_type&&r&&!t.containsWeaponType(c.weapon_type)||s&&!t.containsCategory(a))}):e}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);e.Q,t.pc.status=t.pc.status||{},t.pc.status.roles=t.pc.status.roles||{},t.pc.status.roles.Routing={_navigateToStatus002:function(e,n){t.createInstance("router").navigate("status/status_002",{status_002:{id:e,isFromGacha:!0}},n)},_navigateCharacterToCharacter:function(e,i){return n.isUndefined(i)?void this._consoleErrorRoutingAbort("charaId"):void t.createInstance("router").navigate("status/status_001",{status_001:{id:i,isFromNote:!0}})},_navigateWeaponToWeapon:function(e,i){return n.isUndefined(i)?void this._consoleErrorRoutingAbort("weaponId"):void t.createInstance("router").navigate("status/status_002",{status_002:{id:i,isFromNote:!0}})},_navigateSummonToSummon:function(e,i){return n.isUndefined(i)?void this._consoleErrorRoutingAbort("summonId"):void t.createInstance("router").navigate("status/status_003",{status_003:{id:i,isFromNote:!0}})},_navigateToCharacterEpi:function(e,i){return n.isUndefined(i)||n.isUndefined(i.character_id)?void this._consoleErrorRoutingAbort("record.character_id"):void t.createInstance("router").navigate("epi/epi_002",{epi_001:{tab:"chara",kind:"chara",character_id:i.character_id}})},_navigateToSummonEpi:function(e,i){return n.isUndefined(i)||n.isUndefined(i.summon_id)?void this._consoleErrorRoutingAbort("record.summon_id"):void t.createInstance("router").navigate("epi/epi_003",{epi_001:{tab:"chara",kind:"summon",summon_id:i.summon_id}})},_navigateBackCharaToNo004:function(){t.createInstance("router").navigate("note/no_004",{no_004:{tab:"tab_0"}})},_navigateBackWeaponToNo004:function(){t.createInstance("router").navigate("note/no_004",{no_004:{tab:"tab_1"}})},_navigateBackSummonToNo004:function(){t.createInstance("router").navigate("note/no_004",{no_004:{tab:"tab_2"}})},_navigateBackToExchangeItemShop:function(e){t.createInstance("router").navigate("exchangeitem/exchit_001",{exchit_001:{item_id:e}})},navigateFromBackBtn:function(e,n){t.createInstance("router").navigate(e,{},n)}},n.assign(t.pc.status.roles.Routing,t.pc.roles.RoutingCommon)}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("status"),t.status.CharacterArousal=n.Class.extend({ctor:function(e){this._rawData=e},getBaseCharacterId:function(){return this._rawData.base_character_id},getArousedId:function(){return this._rawData.aroused_character_id}})}((this||0).self||global),function(e){var t=e.kh,n=e._;t.pc=t.pc||{};var i=(e.Q,{ga_scene_check:{factoryName:"popupFactoryPopupCommon",resourceName:function(){var e=n.findKey(res,function(e){return 0<e.indexOf("ga_scene_check")});return e||alert(": ga_scene_check"),e||""}(),title:"{{}}",buttonLabels:{blackBtn:""},buttons:{blackBtn:function(){this.dismiss()}}}});t.pc.status=t.pc.status||{},t.pc.status.status_001=t.pc.status.status_001||{},t.pc.status.status_001.Scene=t.BaseScene.extend({resourceFileName:"status_001/status_001.json",isLoopDefaultView:!1,_popups:i,tabDelegateConfig:[{tab1:{node:"tab_0","content-node":"tab_0_node"},tab2:{node:"tab_1","content-node":"tab_1_node"}}],componentName:"status",sceneName:"status_001",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath("status_btn_ui"),"btn_episode","btnCallbackStatusBtnUiBtnEpisode",null,function(e){this.popups.ga_scene_check.open(e)}),this._initButtonEvent.call(this,this.seekWidgetByPath("status_btn_ui"),"btn_release_weapon","btnCallbackStatusBtnUiBtnReleaseWeapon",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"status/status_002")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_all_over","btnCallbackBtnAllOver",null,function(){alert("{{all_over_ui}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_sound","btnCallbackBtnSound",null,function(){alert("{{}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_prev","btnCallbackBtnPrev",null,function(){alert("{{1}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_next","btnCallbackBtnNext",null,function(){alert("{{1}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_arousal_after","btnCallbackBtnArousalAfter",null,function(){alert("{{()}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_arousal_before","btnCallbackBtnArousalBefore",null,function(){alert("{{()}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._),i=e.Q;t.pc=t.pc||{},t.pc.status=t.pc.status||{},t.pc.status.status_001=t.pc.status.status_001||{},t.pc.status.status_001.SceneDelegate=t.pc.BaseSceneDelegate.extend({_popups:{ga_scene_check:{factoryName:"popupFactoryPopupCommon",resourceName:function(){var e=n.findKey(res,function(e){return 0<e.indexOf("ga_scene_check")});return e||alert(": ga_scene_check"),e||""}(),title:"{{}}",buttonLabels:{blackBtn:""},buttons:{blackBtn:function(){this.dismiss()}}}},onSceneInit:function(e){return this._setBackBtn(e),this.routerParams=t.createInstance("routerParams"),this._characterId=e.routerParams.status_001.id,this._isFromNote=e.routerParams.status_001.isFromNote,this._isFromGacha=e.routerParams.status_001.isFromGacha,this._isFromExchange=e.routerParams.status_001.isFromExchange,this._isFromShopExchange=e.routerParams.status_001.isFromShopExchange,this._initializeBackButton(e),this._initializeReleaseWeaponButton(e),this._isFromNote?this._updateCharacterView(e,this._characterId):void this._loadCharacter(this._characterId).then(function(){var t=e.seekWidgetByName("btn_episode");null===t||n.isUndefined(this._character.has_harem)||t.setVisible(this._character.has_harem)}.bind(this)).fail(function(e){console.error(e)})},_updateCharacterView:function(e,i){return t.createInstance("apiALibrary").getCharacter(i).then(function(i){this._character=i.body,this._loadCompleteACharacter=!0,this.updateCharacterVoices(this._character.character_id),this._fillupACharacterStatus("introduce_chara_status_0_ui");var a=e.seekWidgetByName("btn_episode");null===a||n.isUndefined(this._character.has_harem)||a.setVisible(this._character.has_harem),e.seekWidgetByName("bottom_btn_panel").setVisible(!0);var o=e.seekWidgetByName("btn_prev");o&&(n.isUndefined(this._character.prev_character_id)?(this._setGrayOutButton(o,!1),this._setEnableButton(o,!1)):o.setSound(t.SoundList.BUTTON_TOUCHED_SWITCH));var r=e.seekWidgetByName("btn_next");r&&(n.isUndefined(this._character.next_character_id)?(this._setGrayOutButton(r,!1),this._setEnableButton(r,!1)):r.setSound(t.SoundList.BUTTON_TOUCHED_SWITCH)),e.seekWidgetByName("btn_sound").setSoundEnabled(!1),e.seekWidgetByName("arousal_btn_after_before_ui").setVisible(!0),e.tabDelegateList[0].selectTab(e.seekWidgetByName("tab_0")),this._updateButtons(e)}.bind(this)).fail(function(e){console.error(e)})},_initializeReleaseWeaponButton:function(e){var t=e.seekWidgetByName("status_btn_ui");this._isFromGacha?t.setAppearance("from_not_gacha_view"):t.setAppearance("from_gacha_view")},_initializeBackButton:function(e){var t=e.seekWidgetByName("status_btn_back_ui");if(t){var n="btn_nothing";this._isFromNote&&(n="btn_back_chara"),this._isFromGacha&&(n="btn_back_gacha"),this._isFromExchange&&(n="btn_back_exchange"),t.setAppearance(n),t.setVisible(!0),this._initializeBackButtonTouchEvent(e)}},_initializeBackButtonTouchEvent:function(e){this._isFromNote&&this.__setBackToNoteListBtn(e),this._isFromShopExchange&&this.__setBackToExchangeListBtn(e)},__setBackToExchangeListBtn:function(e){var n=e.seekWidgetByName("btn_back_exchange");null!==n&&(n.setVisible(!0),t.setTouchEventHandlers(e,{"TOUCH_ENDED btn_back_exchange":function(){t.createInstance("router").back()}.bind(this)},this))},__setBackToNoteListBtn:function(e){var n=e.seekWidgetByName("btn_back_chara");null!==n&&(n.setVisible(!0),t.setTouchEventHandlers(e,{"TOUCH_ENDED btn_back_chara":function(){this._navigateBackCharaToNo004()}.bind(this)},this))},tabCallbackTab0:function(e){},tabCallbackTab1:function(e){},btnCallbackStatusBtnUiBtnEpisode:function(e){var t=i.defer();return t.reject(this._override),this._isFromNote?n.isUndefined(this._character)?t.promise:(this._navigateToCharacterEpi(e,this._character),t.promise):(this._showPopupEpisode(e),t.promise)},btnCallbackStatusBtnUiBtnReleaseWeapon:function(e){var t=i.defer();t.reject(this._override);var n=this._getNavigateFrom();return this._navigateToStatus002(this._character.release_weapon_id,n),t.promise},btnCallbackBtnAllOver:function(e){var t=i.defer();return t.reject(this._override),this._showImageZoomPopup(),t.promise},btnCallbackBtnSound:function(e){var t=i.defer();return t.reject(this._override),this._touchPlayVoiceButton(),t.promise},btnCallbackBtnPrev:function(e){var t=i.defer();return t.reject(this._override),n.isUndefined(this._character)||n.isUndefined(this._character.prev_character_id)?(console.warn("[ERROR] Could not find prev_character_id."),t.promise):(this._navigateCharacterToCharacter(e,this._character.prev_character_id),t.promise)},btnCallbackBtnNext:function(e){var t=i.defer();return t.reject(this._override),n.isUndefined(this._character)||n.isUndefined(this._character.next_character_id)?(console.warn("[ERROR] Could not find next_character_id."),t.promise):(this._navigateCharacterToCharacter(e,this._character.next_character_id),t.promise)},btnCallbackBtnArousalAfter:function(e){return this._getArousalModel().then(function(t){this.__canChangeHeroineToAroused(t)&&this._changeHeroine(e,t.getArousedId())}.bind(this)),i.reject(this._override)},btnCallbackBtnArousalBefore:function(e){return this._getArousalModel().then(function(t){this.__heroineIsAroused(t)&&this._changeHeroine(e,t.getBaseCharacterId())}.bind(this)),i.reject(this._override)},btnCallbackStatusBtnBackUiBtnBackExchange:function(e){var t=e.routerParams.status_001.exchitItemId;return t?(this._navigateBackToExchangeItemShop(t),i.reject(this._override)):i.resolve()},_updateButtons:function(e){this._getArousalModel().then(function(t){this._hideArousalAfterBtn(e),this._hideArousalBeforeBtn(e),this.__heroineIsAroused(t)?this._showArousalBeforeBtn(e):this.__canChangeHeroineToAroused(t)&&this._showArousalAfterBtn(e)}.bind(this))},__heroineIsAroused:function(e){return this._character.character_id===e.getArousedId()},__canChangeHeroineToAroused:function(e){return n.isNumber(e.getArousedId())&&0<e.getArousedId()},_showArousalBeforeBtn:function(e){this.__showBtn(this._getArousalBeforeBtn(e))},_showArousalAfterBtn:function(e){this.__showBtn(this._getArousalAfterBtn(e))},_hideArousalBeforeBtn:function(e){this.__hideBtn(this._getArousalBeforeBtn(e))},_hideArousalAfterBtn:function(e){this.__hideBtn(this._getArousalAfterBtn(e))},_getArousalBeforeBtn:function(e){return e.seekWidgetByName("btn_arousal_before")},_getArousalAfterBtn:function(e){return e.seekWidgetByName("btn_arousal_after")},__showBtn:function(e){e&&e.setAppearance("show")},__hideBtn:function(e){e&&e.setAppearance("hide")},_changeHeroine:function(e,t){this._updateCharacterView(e,t)},_getArousalModel:function(){return this.__arousalModel?this.__arousalModel:(this.__arousalModel=t.createInstance("apiALibrary").getCharacterArousal(this._characterId).then(function(e){return t.createInstance("characterArousal",[e.body])}),this.__arousalModel)},_touchEndedBackBtnProcess:function(e){var i=e.routerParams.status_001;if(n.isEmpty(i)||n.isEmpty(i.returnRoute)||n.isEmpty(i.returnParams))this._navigateBackCharaToNo004();else if(this._isFromExchange)t.createInstance("router").navigate("exchangeitem/exchit_001",{exchit_001:{item_id:e.routerParams.status_001.exchitItemId}},e.temporaryRouterParams);else if("gacha/ga_100"!==i.returnRoute)switch(i.returnRoute){case"gacha/ga_100":case"gacha/ga_contents_list":case"conquest/con_002":case"shop/sh_102":case"poprank/poprank_002":case"poprank/poprank_003":case"poprank/poprank_005":case"prizehunt/prizehunt_top":case"prizehunt/":this.navigateFromBackBtn(i.returnRoute,i.returnParams);break;default:this._navigateBackCharaToNo004()}else t.createInstance("router").navigate(i.returnRoute,{ga_100:i.returnParams})},_getNavigateFrom:function(){return{routes:t.createInstance("router").getCurrentFragment(),temporaryRouterParams:t.createInstance("routerParams").getRouterParams()}}}),n.assign(t.pc.status.status_001.SceneDelegate.prototype,t.pc.roles.UIUtility,t.pc.status.roles.Routing,t.pc.roles.ImagesCommon,t.pc.roles.IconsCommon,t.pc.roles.StringsCommon,t.pc.roles.GaugesCommon,t.pc.scene.roles.SceneCharacterCommon)}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.status=t.pc.status||{},t.pc.status.status_002=t.pc.status.status_002||{},t.pc.status.status_002.Scene=t.BaseScene.extend({resourceFileName:"status_002/status_002.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"status",sceneName:"status_002",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_all_over","btnCallbackBtnAllOver",null,function(){alert("{{all_over_ui}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_prev","btnCallbackBtnPrev",null,function(){alert("{{1}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_next","btnCallbackBtnNext",null,function(){alert("{{1}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_last_evo_able","btnCallbackBtnLastEvoAble",null,function(){alert("{{sh_weapon_info}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._),i=e.Q;t.pc=t.pc||{},t.pc.status=t.pc.status||{},t.pc.status.status_002=t.pc.status.status_002||{},t.pc.status.status_002.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../status_popup_ui.json"],_popups:{},onSceneInit:function(e){this._setBackBtn(e),this._weaponId=e.routerParams.status_002.id,this._isFromNote=e.routerParams.status_002.isFromNote,this._isFromGacha=e.routerParams.status_002.isFromGacha;var t=e.seekWidgetByName("status_btn_back_ui");return t&&t.setVisible(!0),this._isFromNote?this._updateWeaponView(e,this._weaponId):this._loadWeapon(this._weaponId).then(function(){var t="btn_back_exchange";this._isFromGacha&&(t="btn_back_gacha");var n=e.seekWidgetByName(t);n&&n.setVisible(!0)}.bind(this)).fail(function(e){console.error(e)})},_updateWeaponView:function(e,i){return t.createInstance("apiALibrary").getWeapon(i).then(function(i){this._weapon=i.body,this._loadCompleteWeapons=!0,null===e.seekWidgetByName("introduce_weapon_status_0_ui")?this._fillupAWeaponStatus("introduce_weapon_status_2_ui"):this._fillupAWeaponStatus("introduce_weapon_status_0_ui"),e.seekWidgetByName("btn_last_evo_able")&&e.seekWidgetByName("btn_last_evo_able").setVisible(this._weapon.can_arouse),e.seekWidgetByName("sell_base_btn_panel").setVisible(!0),e.seekWidgetByName("sellprice_label")&&e.seekWidgetByName("sellprice_label").setString(this._weapon.sell_price+"");var a=e.seekWidgetByName("btn_prev");a&&(n.isUndefined(this._weapon.prev_weapon_id)?(this._setGrayOutButton(a,!1),this._setEnableButton(a,!1)):a.setSound(t.SoundList.BUTTON_TOUCHED_SWITCH));var o=e.seekWidgetByName("btn_next");o&&(n.isUndefined(this._weapon.next_weapon_id)?(this._setGrayOutButton(o,!1),this._setEnableButton(o,!1)):o.setSound(t.SoundList.BUTTON_TOUCHED_SWITCH)),this._setBackListBtn(e)}.bind(this)).fail(function(e){console.error(e)})},_setBackListBtn:function(e){var n=e.seekWidgetByName("btn_back_weapon");null!==n&&(n.setVisible(!0),t.setTouchEventHandlers(e,{"TOUCH_ENDED btn_back_weapon":function(){this._navigateBackWeaponToNo004()}.bind(this)},this))},btnCallbackBtnAllOver:function(e){var t=i.defer();return t.reject(this._override),this._showImageZoomPopup(),t.promise},btnCallbackBtnPrev:function(e){var t=i.defer();return t.reject(this._override),n.isUndefined(this._weapon)||n.isUndefined(this._weapon.prev_weapon_id)?(console.warn("[ERROR] Could not find prev_weapon_id."),t.promise):(this._navigateWeaponToWeapon(e,this._weapon.prev_weapon_id),t.promise)},btnCallbackBtnNext:function(e){var t=i.defer();return t.reject(this._override),n.isUndefined(this._weapon)||n.isUndefined(this._weapon.next_weapon_id)?(console.warn("[ERROR] Could not find next_weapon_id."),t.promise):(this._navigateWeaponToWeapon(e,this._weapon.next_weapon_id),t.promise)},btnCallbackBtnLastEvoAble:function(e){var t=i.defer();return t.reject(this._override),this._openShWeaponInfoPopup(this._weapon.weapon_id),t.promise},btnCallbackStatusBtnBackUiBtnBackExchange:function(e){var t=e.routerParams.status_002.exchitItemId;return t?(this._navigateBackToExchangeItemShop(t),i.reject(this._override)):i.resolve()},_touchEndedBackBtnProcess:function(e){var i=e.temporaryRouterParams;return e.routerParams.status_002&&e.routerParams.status_002.isFromExchange?void t.createInstance("router").navigate("exchangeitem/exchit_001",{exchit_001:{item_id:e.routerParams.status_002.exchitItemId}},i):n.isEmpty(i)||n.isEmpty(i.routes)?void this._navigateBackWeaponToNo004():i.routes.indexOf("status_001")>0?void t.createInstance("router").navigate(i.routes,{status_001:i.temporaryRouterParams},i.temporaryRouterParams):void this.navigateFromBackBtn(i.routes,i.temporaryRouterParams)}}),n.assign(t.pc.status.status_002.SceneDelegate.prototype,t.pc.roles.UIUtility,t.pc.status.roles.Routing,t.pc.scene.roles.SceneWeaponCommon,t.pc.roles.ShInfoPopupInvoker)}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.status=t.pc.status||{},t.pc.status.status_003=t.pc.status.status_003||{},t.pc.status.status_003.Scene=t.BaseScene.extend({resourceFileName:"status_003/status_003.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"status",sceneName:"status_003",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_all_over","btnCallbackBtnAllOver",null,function(){alert("{{all_over_ui}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_blue_l","btnCallbackBtnBlueL",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"epi/epi_003")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_prev","btnCallbackBtnPrev",null,function(){alert("{{1}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_next","btnCallbackBtnNext",null,function(){alert("{{1}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._),i=e.Q;t.pc=t.pc||{},t.pc.status=t.pc.status||{},t.pc.status.status_003=t.pc.status.status_003||{},t.pc.status.status_003.SceneDelegate=t.pc.BaseSceneDelegate.extend({_popups:{},onSceneInit:function(e){return this._setBackBtn(e),this._summonId=e.routerParams.status_003.id,this._isFromNote=e.routerParams.status_003.isFromNote,this._isFromGacha=e.routerParams.status_003.isFromGacha,this._isFromNote?this._updateSummonView(e,this._summonId):this._loadSummon(this._summonId).then(function(t){if(!n.isUndefined(t.episodes)&&t.episodes.length){var i=e.seekWidgetByName("btn_blue_l");null!==i&&i.setVisible(!0)}var a="btn_back_exchange";this._isFromGacha&&(a="btn_back_gacha");var o=e.seekWidgetByName(a);o&&o.setVisible(!0)}.bind(this)).fail(function(e){console.error(e)})},_updateSummonView:function(e,i){return t.createInstance("apiALibrary").getSummon(i).then(function(i){if(this._summon=i.body,this._loadCompleteSummon=!0,null===e.seekWidgetByName("introduce_summon_status_0_ui")?this._fillupASummonStatus("introduce_summon_status_2_ui"):this._fillupASummonStatus("introduce_summon_status_0_ui"),!0===this._summon.has_harem){var a=e.seekWidgetByName("btn_blue_l");a&&a.setVisible(!0)}e.seekWidgetByName("sell_base_btn_panel").setVisible(!0);var o=e.seekWidgetByName("sellprice_label");o&&(!1===this._summon.can_sell?o.setString(""):o.setString(this._summon.sell_price+""));var r=e.seekWidgetByName("btn_prev");r&&(n.isUndefined(this._summon.prev_summon_id)?(this._setGrayOutButton(r,!1),this._setEnableButton(r,!1)):r.setSound(t.SoundList.BUTTON_TOUCHED_SWITCH));var s=e.seekWidgetByName("btn_next");s&&(n.isUndefined(this._summon.next_summon_id)?(this._setGrayOutButton(s,!1),this._setEnableButton(s,!1)):s.setSound(t.SoundList.BUTTON_TOUCHED_SWITCH)),this._setBackListBtn(e)}.bind(this)).fail(function(e){console.error(e)})},_setBackListBtn:function(e){var n=e.seekWidgetByName("btn_back_summon");null!==n&&(n.setVisible(!0),t.setTouchEventHandlers(e,{"TOUCH_ENDED btn_back_summon":function(){this._navigateBackSummonToNo004()}.bind(this)},this))},btnCallbackBtnAllOver:function(e){var t=i.defer();return t.reject(this._override),this._showImageZoomPopup(),t.promise},btnCallbackBtnBlueL:function(e){var t=i.defer();if(t.reject(this._override),this._isFromNote){if(n.isUndefined(this._summon))return t.promise;this._navigateToSummonEpi(e,this._summon)}return this._showPopupEpisode(e),t.promise},btnCallbackBtnPrev:function(e){var t=i.defer();return t.reject(this._override),n.isUndefined(this._summon)||n.isUndefined(this._summon.prev_summon_id)?(console.warn("[ERROR] Could not find prev_summon_id."),t.promise):(this._navigateSummonToSummon(e,this._summon.prev_summon_id),t.promise)},btnCallbackBtnNext:function(e){var t=i.defer();return t.reject(this._override),n.isUndefined(this._summon)||n.isUndefined(this._summon.next_summon_id)?(console.warn("[ERROR] Could not find next_summon_id."),t.promise):(this._navigateSummonToSummon(e,this._summon.next_summon_id),t.promise)},btnCallbackStatusBtnBackUiBtnBackExchange:function(e){var t=e.routerParams.status_003.exchitItemId;return t?(this._navigateBackToExchangeItemShop(t),i.reject(this._override)):i.resolve()},_touchEndedBackBtnProcess:function(e){var i=e.temporaryRouterParams;return e.routerParams.status_003&&e.routerParams.status_003.isFromExchange?void t.createInstance("router").navigate("exchangeitem/exchit_001",{exchit_001:{item_id:e.routerParams.status_003.exchitItemId}},i):n.isEmpty(i)||n.isEmpty(i.routes)?void this._navigateBackSummonToNo004():void this.navigateFromBackBtn(i.routes,i.temporaryRouterParams)}}),n.assign(t.pc.status.status_003.SceneDelegate.prototype,t.pc.roles.UIUtility,t.pc.status.roles.Routing,t.pc.roles.ImagesCommon,t.pc.roles.IconsCommon,t.pc.roles.StringsCommon,t.pc.roles.GaugesCommon,t.pc.scene.roles.SceneSummonCommon)}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="Top",o={get:function(){return this._http.get({url:"/top"})},notifyLogin:function(e){return this._http.put({url:"/top/notify_login",json:{viewer:e}})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiTop",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},o)),n.env.useApiMock){n.MockApi=n.MockApi||{};var r={};t.each(o,function(e,t){r[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi.Top."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},r))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e._||require("lodash"),n=e.kh||{},i=e.cc||{Class:{extend:function(){console.error("cc not loaded")}}};n.env=n.env||{useApiMock:!0},n.env.urlRoot,n.Api=n.Api||{};var a="ATutorialInfo",o={get:function(){return this._http.get({url:"/a_tutorial_info"})},update:function(e){return this._http.put({url:"/a_tutorial_info",json:{in_progress:e}})}};if(n.Api[a]=i.Class.extend(t.assign({className:"KHApiATutorialInfo",_http:null,ctor:function(){this._http=n.createInstance("HttpConnection"),this._http.setURLDelegate({process:function(e){return e.url=n.env.urlRoot+e.url.replace(/^https?:\/\/[^\/]+?\//,"/"),e}.bind(this)})}},o)),n.env.useApiMock){n.MockApi=n.MockApi||{};var r={};t.each(o,function(e,t){r[t]=function(){if(!n.MockApi)throw"kh.MockApi is not defined";if(!n.MockApi[a][t+"JSON"])throw"not implemented: kh.MockApi."+a+"."+t;var e=Q.defer();return e.resolve({body:n.MockApi[a][t+"JSON"].apply(this,arguments)}),e.promise}}),n.MockApi[a]=i.Class.extend(t.assign({},r))}if("undefined"!=typeof process&&"undefined"!=typeof require){var s=require("fs"),c=s.readFileSync("../_mockTemplate.js",{encoding:"utf8"});t.each(o,function(e,t){var n="./mock/"+(t+="JSON")+".js";return s.existsSync(n)?void console.log("skip: file exists: "+n):(console.log("generate: "+n),void s.writeFileSync(n,c.replace(/\[%\sapi\s%\]/g,a).replace(/\[%\smethod\s%\]/g,t)))}),process.exit()}}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.createNameSpaceIfNotExists("top.view"),n.top.view.PrivacyPolicyChangePopup=n.ImplantedPopup.extend({userPolicyUrl:"http://kamihime.net/privacy/",_initContents:function(){var e=this.getNode(),t=e.seekWidgetByName("check_icon");this.btnOk=e.seekWidgetByName("btn_ok"),this.btnOk.setColor(cc.color("#808080")),this.btnOk.setEnabled(!1),cc.spriteFrameCache.addSpriteFrames(res["core-btn-btn_atlas.plist"]),this.btnOk.loadTextureDisabled("res/core/btn/btn_black_l.png",ccui.Widget.PLIST_TEXTURE);this.btnOk.setBright(t.isVisible()),this.btnOk.setEnabled(t.isVisible()),this.setButtonEvents({btn_ok:!0,checkbox_panel:function(){t.setVisible(!t.isVisible()),this.btnOk.setBright(t.isVisible()),this.btnOk.setColor(t.isVisible()?cc.color("#FFFFFF"):cc.color("#808080")),this.btnOk.setEnabled(t.isVisible())}.bind(this),btn_privacy_policy:function(){window.open(this.userPolicyUrl)}.bind(this)},e),this._setSECheckbox(e)},setButtonEvents:function(e,i){var a={};t.each(e,function(e,n){var o=e;t.isBoolean(e)&&(o=function(e){return function(){e&&this._isCheckboxSelected(i)?this.dismiss(e):e||this.dismiss(e)}}(e)),a["TOUCH_ENDED "+n]=o},this),n.setTouchEventHandlers(this.getNode(),a,this)},_setSECheckbox:function(e){var t=this._getCheckBox(e);t&&(t.setSoundEnabled(!0),t.setSound(n.SoundList.BUTTON_TOUCHED_SWITCH))},_isCheckboxSelected:function(e){return e.seekWidgetByName("check_icon").isVisible()},_getCheckBox:function(e){return e.seekWidgetByName("checkbox_panel")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);e.Q,t.pc.top=t.pc.top||{},t.pc.top.roles=t.pc.top.roles||{},t.pc.top.roles.Routing={_verifyRouterParams000:function(e){}},n.assign(t.pc.top.roles.Routing,t.pc.roles.RoutingCommon)}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.top=t.pc.top||{},t.pc.top.top_001=t.pc.top.top_001||{},t.pc.top.top_001.Scene=t.BaseScene.extend({resourceFileName:"top_001/top_001.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"top",sceneName:"top_001",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"top_btn_gamestart_mouse_over","btnCallbackTopBtnGamestartMouseOver",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"mypage/my_001")),this._initMouseOver.call(this,this.seekWidgetByPath(""),"top_btn_gamestart_mouse_over","top_btn_gamestart","mouse_over"),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc=t.pc||{},t.pc.top=t.pc.top||{},t.pc.top.top_001=t.pc.top.top_001||{},t.pc.top.top_001.SceneDelegate=t.pc.BaseSceneDelegate.extend({_currentPrivacyPolicyVersion:1,_popups:{},onSceneInit:function(e){return this._showIOSSoundTouchField(e),this._getGameStartButton(e).setVisible(!0),t.env.isSp||(this._getGameStartButton(e).opacity=0),this._updateTopImage(e)},onSceneEnter:function(e){return a.all([t.createInstance("tutorialProgress").prepare(),t.createInstance("apiTop").notifyLogin(t.env.isSp?"SP":"PC")]).spread(function(e){return e.isFinish()?a.all([t.createInstance("apiTop").get(),t.createInstance("beginnerMissionInformationModel").update()]).spread(this._setTopImageData.bind(this)):(this._showIOSSoundTouchFieldWithoutNavigation(),t.createInstance("router").navigate(new t.router.TutorialNavigate(e.getCurrentStep().fragment)),new Promise(function(){}))}.bind(this))},_getGameStartButton:function(e){return e.seekWidgetByName("top_btn_gamestart")||new ccui.Widget},_showIOSSoundTouchField:function(e){if(t.env.needSoundTouchField){var n=t.createInstance("playerGameConfig"),i=n.isSoundOn()&&n.isSeOn()?n.getVirtualSeVolume():0;t.postMessage("showIOSSoundTouchField",[t.SoundList.BUTTON_TOUCHED_DEFAULT,i,"mypage"])}},_showIOSSoundTouchFieldWithoutNavigation:function(){t.env.needSoundTouchField&&t.postMessage("showIOSSoundTouchField")},_topImages:{},_setTopImageData:function(e){this._topImages=e.body.image_ids||{}},_updateTopImage:function(e){var o=this._topImages[Math.floor(Math.random()*this._topImages.length)],r=t.Img("pageimg","topbg",i.padZero(o,4)).jpg,s=a.defer();return n.textureCache.addImage(r,function(t){return e.seekWidgetByName("pageimg_topbg").loadTexture(r),t._textureLoaded?void s.resolve():void t.addEventListener("load",function(){s.resolve()})}),s.promise},_getConsentPrivacyPolicy:function(e){var t="KHPrivacyPolicyVersion",i=n.sys.localStorage.getItem(t)||0;this._currentPrivacyPolicyVersion>i&&this._openPrivacyPolicyChangePopup(e).then(function(){n.sys.localStorage.setItem(t,this._currentPrivacyPolicyVersion)}.bind(this))},_openPrivacyPolicyChangePopup:function(e){return $staticRes(res["core-popup_layer-com_privacy_policy_change"]),t.ImplantedPopup.createOrGet(e,"com_privacy_policy_change","PrivacyPolicyChangePopup").open()},btnCallbackTopBtnGamestartMouseOver:function(e){return t.createInstance("router").navigate(new t.router.MyPageRedirect),a.reject(this._override)}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.router=n.router||{},n.router.routes=n.router.routes||{},t.merge(n.router.routes,{top:{top:"top_001","top/top_001":"top_001"}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.createNameSpaceIfNotExists("tower"),t.tower.WordBook={EVENT_TYPE:"tower_event",QUEST_TYPE:"tower_event",RECEIVE_REWARD_EVENT_TYPE:"tower_event_receive_reward"},t.tower.enum={FLOOR_TYPE:{DEFAULT:0,TOP_VIEW:1,BOTTOM_VIEW:2,BOTTOM2_VIEW:3,UNDEFINED:-1},SPECIAL_ACTION_TYPE:{ENEMY_BURST_NORMAL:1,ENEMY_BURST_RAGING:2,SPECIAL_ATTACK:3},RANKING_TYPE:{TOWER_REACH:1},TOWER_MOVE_PARAM:{SCROLL_TIME:.7,LONG_SPEED:2,NORMAL_SPEED:4}}}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.tower=n.tower||{},n.tower.view=n.tower.view||{},n.tower.view.QuestTower=n.SceneObject.extend({_upReadyAnimationNames:[{name:"normal_up",isLoop:!1},{name:"up",isLoop:!0}],_upDiakoAnimationNames:[{name:"up_normal",isLoop:!1}],_longupDiakoAnimationNames:[{name:"up_longup",isLoop:!1},{name:"longup",isLoop:!0},{name:"longup_normal",isLoop:!1}],_downReadyDiakoAnimationNames:[{name:"normal_down",isLoop:!1},{name:"down",isLoop:!0}],_downDiakoAnimationNames:[{name:"down_normal",isLoop:!1}],NODE_NAMES:{NOW_SELECT:"img_now_select",TOWER_LIST_PAGE_PARENT:"tower_quest_list_page_ui",TOWER_SCROLL_PANEL:"tower_scroll_panel",TOWER_DIAKO_UI:"tower_dia_ani_ui",TOWER_POST_MIDDLE:"tower-post-middle"},_eventListener:null,_towerScrollPanelNode:null,_defaultTowerScrollPanelPosition:null,_diakoUiRootNode:null,_towerVirtualNodeTree:[],_oneFloorHeight:0,_isCleaned:!1,OFFSET_TOP_FROM_SELECTED_FLOOR:2,UP_FLOOR_BTN_NODE_NAME:"btn_up",DOWN_FLOOR_BTN_NODE_NAME:"btn_down",ctor:function(e){this._scene=e;var t=this._scene.seekWidgetByName(this.NODE_NAMES.TOWER_LIST_PAGE_PARENT);this._towerVirtualNodeTree=[].concat(t.getChildren()),this._towerUINodeTopYPosition=t.getChildren()[0].getPositionY(),this._towerScrollPanelNode=e.seekWidgetByName(this.NODE_NAMES.TOWER_SCROLL_PANEL),this._defaultTowerPanelPosition=this._towerScrollPanelNode.getPosition(),this._diakoUiRootNode=e.seekWidgetByName(this.NODE_NAMES.TOWER_DIAKO_UI),this._oneFloorHeight=t.seekWidgetByName(this.NODE_NAMES.TOWER_POST_MIDDLE).height,this._setVisible(!1)},show:function(e){this._floorStateModel=e,this.update(),this._setVisible(!0);var t=this._scene.seekWidgetByName(this.NODE_NAMES.NOW_SELECT);e.addEventListener("FLOOR_MOVE_ANIMATION_START",t.setVisible.bind(t,!1)),e.addEventListener("FLOOR_MOVE_ANIMATION_END",this._updateFloorBtn.bind(this)),e.addEventListener("FLOOR_MOVE_ANIMATION_END",t.setVisible.bind(t,!0))},update:function(){this._isCleaned||(this._towerVirtualNodeTree.forEach(this._updateTreePanel,this),this._towerScrollPanelNode.setPosition(this._defaultTowerPanelPosition))},_setVisible:function(e){var t=this._scene.seekWidgetByName(this.UP_FLOOR_BTN_NODE_NAME),n=this._scene.seekWidgetByName(this.DOWN_FLOOR_BTN_NODE_NAME);t.setVisible(e),n.setVisible(e),e&&this._updateFloorBtn();var i=this._scene.seekWidgetByName(this.NODE_NAMES.NOW_SELECT);this._scene.seekWidgetByName(this.NODE_NAMES.TOWER_LIST_PAGE_PARENT).setVisible(e),i.setVisible(e),this._diakoUiRootNode.setVisible(e)},_updateFloorBtn:function(){this._updateUpFloorBtn(),this._updateDownFloorBtn()},_updateUpFloorBtn:function(){var e=!this._floorStateModel.isMaxFloor();this.setEnableUpFloorBtn(e)},_updateDownFloorBtn:function(){var e=1!==this._floorStateModel.getSelectedFloorNumber();this.setEnableDownFloorBtn(e)},setEnableUpFloorBtn:function(e){var t=this._scene.seekWidgetByName(this.UP_FLOOR_BTN_NODE_NAME);t.setTouchEnabled(e),n.pc.roles.UIUtility._setGrayOutButton(t,e)},setEnableDownFloorBtn:function(e){var t=this._scene.seekWidgetByName(this.DOWN_FLOOR_BTN_NODE_NAME);t.setTouchEnabled(e),n.pc.roles.UIUtility._setGrayOutButton(t,e)},_updateTreePanel:function(e,t){var i=this._towerUINodeTopYPosition-t*this._oneFloorHeight;e.setPositionY(i);var a=this._floorStateModel.getSelectedFloorNumber()+this.OFFSET_TOP_FROM_SELECTED_FLOOR,o=this._floorStateModel.getFloor(a-t);n.tower.view.TowerQuestFloorPanel.update(e,o)},animateWait:function(){this._isCleaned||this._playDiakoWaitAnimation(this._scene)},_playDiakoWaitAnimation:function(){if(!this._isCleaned){var e=this._diakoUiRootNode.getAction(),t=e.animationInfo;return e.gotoFrameAndPlay(t.normal.startIndex,t.normal.endIndex,!0),Q.resolve()}},_playDiakoMoveAnimation:function(e,t){if(!this._isCleaned){var n=this._diakoUiRootNode.getAction(),i=n.animationInfo,a=e[t].name,o=e[t].isLoop;n.gotoFrameAndPlay(i[a].startIndex,i[a].endIndex,o);var r=khutil.getPromiseWhenAnimationEnd(n,n.animationInfo[a].endIndex);if(!o){var s=this;r.then(function(n){var i=t+1;return e.length<=i?s._playDiakoWaitAnimation():s._playDiakoMoveAnimation(e,i)})}return r}},_upInVirtualTree:function(){var e=this._towerVirtualNodeTree.pop();this._towerVirtualNodeTree.unshift(e)},_downInVirtualTree:function(){var e=this._towerVirtualNodeTree.shift();this._towerVirtualNodeTree.push(e)},_moveFloorCount:0,_movingAction:null,_movingAnimationPromise:Q.resolve(),_startMoveAnimationPromise:null,_movingLongup:!1,_movingEnded:!1,touchMove:function(e){if(this._movingAnimationPromise.isFulfilled())this.__playFirstMoveAnimation(e);else if(this._movingEnded)this._movingAnimationPromise=this._movingAnimationPromise.then(this.touchMove.bind(this,e));else if(this._moveFloorCount++,this._movingAction){if(this._startMoveAnimationPromise.isPending())return;this._towerScrollPanelNode.stopAction(this._movingAction),this._movingAnimationPromise=this._scrollTower(this._moveFloorCount,e,!0)}},__playFirstMoveAnimation:function(e){this._moveFloorCount=1,this._startMoveAnimationPromise=this._playDiakoMoveAnimation(e?this._upReadyAnimationNames:this._downReadyDiakoAnimationNames,0),this._movingAnimationPromise=this._startMoveAnimationPromise.then(function(){return this._scrollTower(this._moveFloorCount,e)}.bind(this))},_scrollTower:function(e,t,n){if(this._isCleaned)return Q.reject();if(this._moveFloorCount!==e||0===e)return Q.resolve();var i=Q.defer(),a=this._getDiakoAnimationNames(e,t,n),o=this._getMovement(t);this._playLongupAnimationIfNeed(a,t,o,n);var r=this._createMultiMoveAction(a,t,o,i),s=this._createScrollAction(r,o,n),c=this._towerScrollPanelNode;c.runAction(s),this._movingAction=s;var u=this._floorStateModel;return u.dispatchEvent("FLOOR_MOVE_ANIMATION_START"),i.promise.then(function(){c.stopAction(s),this._movingAction=null,this._movingLongup=!1,this._movingEnded=!1,u.dispatchEvent("FLOOR_MOVE_ANIMATION_END")}.bind(this)),i.promise},_getMovement:function(e){var t=this._moveFloorCount,n=this._floorStateModel;return e?Math.min(n.getMaxFloorNumber()-n.getSelectedFloorNumber(),t):Math.min(n.getSelectedFloorNumber()-1,t)},_createMultiMoveAction:function(e,n,i,a){var o=this,r=t.range(i).map(this._createSequence.bind(this,this,n)),s=cc.CallFunc.create(function(e){o._movingEnded=!0,o.update(),o._playDiakoMoveAnimation(e,e.length-1).then(a.resolve.bind(a))}.bind(o,e));return r.push(s),cc.Sequence.create.apply(null,r)},_playLongupAnimationIfNeed:function(e,t,n,i){!this._movingLongup&&t&&(n>1||i)&&(this._movingLongup=!0,this._playDiakoMoveAnimation(e,0))},_createScrollAction:function(e,t,i){return i?cc.EaseElasticOut.create(e,n.tower.enum.TOWER_MOVE_PARAM.LONG_SPEED):t>1?cc.EaseElasticInOut.create(e,n.tower.enum.TOWER_MOVE_PARAM.LONG_SPEED):cc.EaseInOut.create(e,n.tower.enum.TOWER_MOVE_PARAM.NORMAL_SPEED)},_getDiakoAnimationNames:function(e,t,n){return t?n||e>1?this._longupDiakoAnimationNames:this._upDiakoAnimationNames:this._downDiakoAnimationNames},_createSequence:function(e,t){return t?this.__createUpSequence(e):this.__createDownSequence(e)},__createUpSequence:function(e){var t=e._oneFloorHeight,i=cc.MoveTo.create(n.tower.enum.TOWER_MOVE_PARAM.SCROLL_TIME,cc.p(e._defaultTowerPanelPosition.x,e._defaultTowerPanelPosition.y-t)),a=cc.CallFunc.create(function(){e._moveFloorCount--,e._floorStateModel.up()&&(e._upInVirtualTree(),e.update())});return cc.Sequence.create(i,a)},__createDownSequence:function(e){var t=e._oneFloorHeight,i=cc.MoveTo.create(n.tower.enum.TOWER_MOVE_PARAM.SCROLL_TIME,cc.p(e._defaultTowerPanelPosition.x,e._defaultTowerPanelPosition.y+t)),a=cc.CallFunc.create(function(){e._moveFloorCount--,e._floorStateModel.down()&&(e._downInVirtualTree(),e.update())});return cc.Sequence.create(i,a)},clean:function(){this._scene=null,this._elementId=null,this._eventListener=null,this._floorStateModel&&this._floorStateModel.removeEventListener(this._eventListener),this._towerScrollPanelNode=null,this._defaultTowerScrollPanelPosition=null,this._diakoUiRootNode=null,this._towerVirtualNodeTree=null,this._floorStateModel=null,this._isCleaned=!0}})}((this||0).self||global),function(e){var t=e.kh;e.khutil,e.cc,e.ccui,e._,e.console,t.createNameSpaceIfNotExists("tower.view"),t.tower.view.TowerQuestFloorPanel={PANEL_ANIMATION_NAME:{DEFAULT:"middle",TOP_FLOOR:"top",BOTTOM_FLOOR:"bottom",BOTTOM2_FLOOR:"bottom2"},DOOR_UI_NODE_NAME:"tower_quest_door_ui",DOOR_ANIMATION_NAME:{CLOSED:"door_closed",OPENED:"door_opened",COMPLETE:"door_gold"},STAR_BASE_NODE_NAME:"star_base",update:function(e,n){this._setPanelType(e,n),n.getFloorType()===t.tower.enum.FLOOR_TYPE.DEFAULT&&(this._setPanelDoor(e,n),this._setMissionStars(e,n.getMissions()))},_setPanelType:function(e,n){var i=n.getFloorType(),a=t.tower.enum.FLOOR_TYPE;if(i!==a.UNDEFINED)if(e.setVisible(!0),i!==a.TOP_VIEW)if(i!==a.BOTTOM_VIEW)if(i!==a.BOTTOM2_VIEW)e.setAppearance(this.PANEL_ANIMATION_NAME.DEFAULT);else{var o=this.PANEL_ANIMATION_NAME.BOTTOM2_FLOOR;e.getAction().animationInfo[o]?e.setAppearance(o):e.setVisible(!1)}else e.setAppearance(this.PANEL_ANIMATION_NAME.BOTTOM_FLOOR);else e.setAppearance(this.PANEL_ANIMATION_NAME.TOP_FLOOR);else e.setVisible(!1)},_setPanelDoor:function(e,t){var n=e.seekWidgetByName(this.DOOR_UI_NODE_NAME);if(!t.isAllCleared())return t.getQuest().isOpened()?void n.setAppearance(this.DOOR_ANIMATION_NAME.OPENED):void n.setAppearance(this.DOOR_ANIMATION_NAME.CLOSED);n.setAppearance(this.DOOR_ANIMATION_NAME.COMPLETE)},_setMissionStars:function(e,t){e.seekWidgetByName(this.STAR_BASE_NODE_NAME).getChildren().forEach(function(e,n){var i=t[n],a=i&&i.isCleared();e.setVisible(a)})}}}((this||0).self||global),function(e){var t=(e._,e.kh||{}),n=e.cc;t.createNameSpaceIfNotExists("tower.view"),t.tower.view.AEventBasic=n.Class.extend({CHALLENGE_COUNT_LABEL:"item_num_label",MAX_REACH_FLOOR_LABEL:"max_reach_floor_label",MAX_REACH_LABEL:"max_reach_label",HAVE_TOWER_MEDAL_LABEL:"have_tower_medal",GET_TOWER_MEDAL_LABEL:"get_tower_medal",_rootNode:null,_eventDetailModel:null,ctor:function(e,t){this._rootNode=e,this._eventDetailModel=t},show:function(){this._eventDetailModel.getPromise().done(function(e){var t=this._rootNode||n.director.getRunningScene();return this._setLabel(t,this.MAX_REACH_LABEL,e.getMaxReachFloorName()),this._setLabel(t,this.MAX_REACH_FLOOR_LABEL,e.getMaxReachFloorName()),this._setLabel(t,this.HAVE_TOWER_MEDAL_LABEL,e.getHaveTowerMedal()),this._setLabel(t,this.GET_TOWER_MEDAL_LABEL,e.getCurrentGotTowerMedal()),e.isReceiveReward()?void this._setLabel(t,this.CHALLENGE_COUNT_LABEL,""):void this._setLabel(t,this.CHALLENGE_COUNT_LABEL,e.getCanChallengeCount())}.bind(this))},update:function(e){var t=this._rootNode||n.director.getRunningScene(),i=e.getCanChallengeCount()+e.getGainedChallengeCount();this._setLabel(t,this.CHALLENGE_COUNT_LABEL,i)},_setLabel:function(e,t,n){var i=e.seekWidgetByName(t);null!==i&&(i.setString(""+n),i.setVisible(!0))},clean:function(){this._eventDetailModel=null,this._rootNode=null}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{},i=e.cc;n.createNameSpaceIfNotExists("tower.view"),n.tower.view.Background=i.Class.extend({ctor:function(e,t,n){this._backgroundImgName=e,this._backgroundNodeName=n||e,this._eventId=t},show:function(){var e=this._getBackgroundNode(this._backgroundNodeName),i=n.Img(this._backgroundImgName,"event",t.padZero(this._eventId,4)).jpg;e.loadTexture(i)},_getBackgroundNode:function(e){return khutil.getWidget(e,function(e){console.warn(this.className+": "+e)}.bind(this))}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("tower.view"),t.tower.view.QuestInformation=n.Class.extend({className:"QuestInformation",NODE_NAMES:{PARENT_NODE:"img_information",NOW_FLOOR_LABEL:"now_floor_label",AP_LABEL:"cons_ap_label",TIME_LIMIT_LABEL:"time_limit_label",QUEST_BUTTON:"tower_quest_btn_challenge"},QUEST_STATE_ANIMATION_NAME:{NO_ATTAINMENT:"nonattainment",CAN_CHALLENGE:"challenge",COMPLETE:"complete"},_node:null,_floorStateModel:null,_eventListener:null,ctor:function(e,t){this._node=e.seekWidgetByName(this.NODE_NAMES.PARENT_NODE),this._floorStateModel=t,t.addEventListener("CHANGE_FLOOR",function(){this.update(t.getSelectedFloor())},this)},update:function(e){var t=e.getQuest();this._setLabel(this.NODE_NAMES.NOW_FLOOR_LABEL,t.getTitle()),this._setLabel(this.NODE_NAMES.AP_LABEL,"AP"+t.getAp()),this._setLabel(this.NODE_NAMES.TIME_LIMIT_LABEL,t.getTimeLeft()),this._setQuestButton(e)},_setQuestButton:function(e){var t=this._node.seekWidgetByName(this.NODE_NAMES.QUEST_BUTTON);return e.isAllCleared()?void t.setAppearance(this.QUEST_STATE_ANIMATION_NAME.COMPLETE):e.canChallenge()?void t.setAppearance(this.QUEST_STATE_ANIMATION_NAME.CAN_CHALLENGE):void t.setAppearance(this.QUEST_STATE_ANIMATION_NAME.NO_ATTAINMENT)},_setLabel:function(e,t){var n=this._node.seekWidgetByName(e);n.setString(""+t),n.setVisible(!0)},clean:function(){this._floorStateModel.removeEventListener(this._eventListener),this._floorStateModel=null}})}((this||0).self||global),function(e){var t=(e._,e.kh||{}),n=e.cc;t.createNameSpaceIfNotExists("tower.model"),t.tower.model.AEventDetail=n.Class.extend({_aEventsApi:null,_promise:null,_eventId:null,_eventName:null,_eventDate:null,_elementId:null,_isFirstAccess:null,_introductionEpisodeId:null,_maxFloor:null,_maxReachFloor:null,_maxReachFloorName:null,_haveTowerMedalAmount:null,_canChallengeAmount:null,_canGetChallengeAmount:null,_descriptionImages:null,_shopId:null,_gainedChallengeCount:null,_challengeItemName:null,ctor:function(e){this._aEventsApi=t.createInstance("apiAEvents"),this._aEventsApi.setEventIdDelegate(e)},prepare:function(){return this._promise=this._aEventsApi.getDetail(t.tower.WordBook.EVENT_TYPE).then(function(e){var t=e.body;return this._eventId=t.event_id,this._eventName=t.event_name,this._eventDate=t.event_date,this._eventType=t.event_type,this._elementId=t.element_type,this._isFirstAccess=t.first_access,this._introductionEpisodeId=t.introduction_episode_id,this._maxFloor=t.max_floor,this._maxReachFloor=t.max_reach_floor,this._maxReachFloorName=t.max_reach_floor_name,this._haveTowerMedalAmount=t.have_tower_medal,this._currentGotTowerMedal=t.get_tower_medal,this._canChallengeAmount=t.can_challenge_amount,this._canGetChallengeAmount=t.can_get_challenge_amount,this._descriptionImages=t.description_images,this._shopId=t.shop_id,this}.bind(this)),this._promise},update:function(){return this._aEventsApi.updateStatus(t.tower.WordBook.EVENT_TYPE).then(function(e){var t=e.body;return this._gainedChallengeCount=t.gained_challenge_count,this._challengeItemName=t.name,this}.bind(this))},getPromise:function(){return this._promise?this._promise:this.prepare()},getEventId:function(){return this._eventId},getEventName:function(){return this._eventName},getEventDate:function(){return this._eventDate},isReceiveReward:function(){return this._eventType===t.tower.WordBook.RECEIVE_REWARD_EVENT_TYPE},getElementId:function(){return this._elementId},isFirstAccess:function(){return this._isFirstAccess},getEpisodeId:function(){return this._introductionEpisodeId},getMaxFloor:function(){return this._maxFloor},getMaxReachFloor:function(){return this._maxReachFloor},getMaxReachFloorName:function(){return this._maxReachFloorName},getCanChallengeCount:function(){return this._canChallengeAmount},getHaveTowerMedal:function(){return this._haveTowerMedalAmount},getCurrentGotTowerMedal:function(){return this._currentGotTowerMedal},canGetChallengeCount:function(){return this._canGetChallengeAmount},getGainedChallengeCount:function(){return this._gainedChallengeCount},getChallengeItemName:function(){return this._challengeItemName},getDescriptionImages:function(){return this._descriptionImages},getShopId:function(){return this._shopId},clean:function(){this._aEventsApi=null}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("tower.model"),t.tower.model.ATowerQuest=n.Class.extend({className:"ATowerQuest",_rawAQuest:null,_requiredItemModel:null,ctor:function(e,t){this._rawAQuest=e,this._requiredItemModel=t},getAQuestId:function(){return this._rawAQuest.a_quest_id},getQuestId:function(){return this._rawAQuest.quest_id},getTitle:function(){return this._rawAQuest.title},getTimeLeft:function(){return this._rawAQuest.time_left},getAp:function(){return this._rawAQuest.quest_ap},getRequiredItem:function(){return this._requiredItemModel},isOpened:function(){return this._rawAQuest.is_opened},isCleared:function(){return this._rawAQuest.is_cleared},getFloorNumber:function(){return this._rawAQuest.quest_num},getRawAQuest:function(){return this._rawAQuest}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("tower.model"),t.tower.model.ATowerFloor=n.Class.extend({className:"ATowerFloor",_quest:null,_missions:null,ctor:function(e,t){this._quest=e,this._missions=t},getQuest:function(){return this._quest},getMissions:function(){return this._missions},canChallenge:function(){return this.getQuest().isOpened()&&!this.isAllCleared()},isAllCleared:function(){var e=this.getMissions();for(var t in e){if(!e[t].isCleared())return!1}return!0},getFloorType:function(){return t.tower.enum.FLOOR_TYPE.DEFAULT},isEmpty:function(){return!1},clean:function(){this._missions=null,this._quest=null}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc,e.ccui,e._,e.console);t.createNameSpaceIfNotExists("tower.model"),t.tower.model.ATowerEmptyFloor=t.tower.model.ATowerFloor.extend({className:"ATowerEmptyFloor",_floorType:null,ctor:function(e){this._floorType=e,void 0!==e&&null!==e||n.error(" floorType:"+this._floorType)},getQuest:function(){n.error(" floorType:"+this._floorType)},getMissions:function(){n.error(" floorType:"+this._floorType)},getFloorType:function(){return this._floorType},isEmpty:function(){return!0}})}((this||0).self||global),function(e){var t=e.kh;e.khutil,e.cc,e.ccui,e._,e.console,e.Q,t.createNameSpaceIfNotExists("tower.model"),t.tower.model.ATowerFloorStateFactory={create:function(e,n,i){var a=n.map(function(e,t){var n=i[t];return this._createATowerFloor(e,n)},t.tower.model.ATowerFloorStateFactory);return new t.tower.model.ATowerFloorState(a,e)},_createATowerFloor:function(e,n){var i=e.required_item,a=new t.quest_required_item.Model(i),o=new t.tower.model.ATowerQuest(e,a),r=n.map(function(e){return new t.tower.model.AMission(e)});return new t.tower.model.ATowerFloor(o,r)}}}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=(e.ccui,e._,e.console),a=e.Q;t.createNameSpaceIfNotExists("tower.model"),t.tower.model.ATowerFloorStateRepository=n.Class.extend({className:"ATowerFloorStateRepository",_apiAMissions:null,_apiAQuests:null,_apiPromise:null,ctor:function(){this._apiAQuests=t.createInstance("apiAQuests"),this._apiAMissions=t.createInstance("apiAMissions")},prepare:function(e){this._apiPromise=a.all([this._apiAQuests.getListEventQuest(e),this._apiAMissions.getTowerMissions(t.tower.WordBook.EVENT_TYPE,e)])},create:function(e){return this._apiPromise||i.error("please prepare"),this._apiPromise.spread(function(t,n){return[e,t.body.data,n.body.data]}).spread(t.tower.model.ATowerFloorStateFactory.create)},clean:function(){this._apiAMissions=null,this._apiAQuests=null,this._apiPromise=null}})}((this||0).self||global),function(e){var t=e.kh;e.khutil,e.cc,e.ccui,e._,e.console,t.createNameSpaceIfNotExists("tower.model"),t.tower.model.ATowerFloorState=t.EventSubject.extend({className:"ATowerFloorState",EVENT_PREFIX:"a_tower_floor_state",EVENT_NAME:{CHANGE_FLOOR:0,FLOOR_MOVE_ANIMATION_START:1,FLOOR_MOVE_ANIMATION_END:2},_selectedFloorNumber:1,_maxFloorNumber:0,_floorModels:null,ctor:function(e,t){this._super.apply(this,arguments),this._floorModels=e,this._maxFloorNumber=e.length,this._selectedFloorNumber=t||1,this.dispatchEvent("CHANGE_FLOOR")},getSelectedFloor:function(){return this.getFloor(this._selectedFloorNumber)},getSelectedFloorNumber:function(){return this._selectedFloorNumber},getMaxFloorNumber:function(){return this._maxFloorNumber},isMaxFloor:function(){return this.getSelectedFloorNumber()===this._maxFloorNumber},getFloor:function(e){return e===this._maxFloorNumber+1?new t.tower.model.ATowerEmptyFloor(t.tower.enum.FLOOR_TYPE.TOP_VIEW):0===e?new t.tower.model.ATowerEmptyFloor(t.tower.enum.FLOOR_TYPE.BOTTOM_VIEW):e<=-1?new t.tower.model.ATowerEmptyFloor(t.tower.enum.FLOOR_TYPE.BOTTOM2_VIEW):e>this._maxFloorNumber+1?new t.tower.model.ATowerEmptyFloor(t.tower.enum.FLOOR_TYPE.UNDEFINED):this._floorModels[e-1]},up:function(){return!(this._selectedFloorNumber+1>this._maxFloorNumber||(this._selectedFloorNumber++,this.dispatchEvent("CHANGE_FLOOR"),0))},down:function(){return!(this._selectedFloorNumber-1<1||(this._selectedFloorNumber--,this.dispatchEvent("CHANGE_FLOOR"),0))}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=(e.ccui,e._);e.console,t.createNameSpaceIfNotExists("tower.model"),t.tower.model.BattleSpecialAction=n.Class.extend({className:"BattleSpecialAction",_type:null,_name:"",_description:"",ctor:function(e,t){this._type=e,i.isString(t.name)&&(this._name=t.name),i.isString(t.description)&&(this._description=t.description)},isType:function(e){return this._type===e},getName:function(){return this._name},getDescription:function(){return this._description}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=(e.ccui,e._);e.console,t.createNameSpaceIfNotExists("tower.model"),t.tower.model.BattleEnemyData=n.Class.extend({className:"BattleEnemyData",_id:null,_name:null,_hp_percentage:100,_rank:null,_specialActions:null,_has_mode_gauge:!1,ctor:function(e,t){this._id=e.id,this._name=e.name,this._hp_percentage=e.hp_percentage,this._rank={hp:null,attack:null,resistance:null},this._rank.hp=e.hp_rank,this._rank.attack=e.attack_rank,this._rank.resistance=e.resistance_rank,this._specialActions=t;var n=e.has_mode_gauge;null!==n&&"boolean"!=typeof n||(n=n?"":""),this._has_mode_gauge=n},getId:function(){return this._id},getName:function(){return this._name},getHpPercentage:function(){return this._hp_percentage},getHpRank:function(){return this._rank.hp},getAttackRank:function(){return this._rank.attack},getResistanceRank:function(){return this._rank.resistance},getBurstNormalData:function(){return this._getSpecialActions(t.tower.enum.SPECIAL_ACTION_TYPE.ENEMY_BURST_NORMAL)},getBurstRagingData:function(){return this._getSpecialActions(t.tower.enum.SPECIAL_ACTION_TYPE.ENEMY_BURST_RAGING)},getSpecialAttackData:function(){return this._getSpecialActions(t.tower.enum.SPECIAL_ACTION_TYPE.SPECIAL_ATTACK)},_getSpecialActions:function(e){return i.filter(this._specialActions,function(t){return t.isType(e)})},getHasModeGauge:function(){return this._has_mode_gauge}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=(e.ccui,e._,e.console);t.createNameSpaceIfNotExists("tower.model"),t.tower.model.BattleStageData=n.Class.extend({className:"BattleStageData",_battleEnemyDataModels:null,_selectedEnemyNumber:0,ctor:function(e){this._battleEnemyDataModels=e},getSelectedEnemy:function(){return this._battleEnemyDataModels[this._selectedEnemyNumber]},getSelectedEnemyNumber:function(){return this._selectedEnemyNumber},_selectEnemy:function(e){(e<0||e>this._battleEnemyDataModels.length)&&i.error(":"+e),this._selectedEnemyNumber=e},getAllEnemies:function(){return this._battleEnemyDataModels}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc,e.ccui,e._,e.console);t.createNameSpaceIfNotExists("tower.model"),t.tower.model.QuestBattleInfoData=t.EventSubject.extend({className:"QuestBattleInfoData",EVENT_PREFIX:"tower_battle_info",EVENT_NAME:{SELECT_STAGE:0,SELECT_ENEMY:1},_battleStageModels:null,_selectBattleStageNumber:1,ctor:function(e){this._super.apply(this,arguments),this._battleStageModels=e},getSelectBattleStage:function(){return this._battleStageModels[this._selectBattleStageNumber-1]},selectBattleStage:function(e){(e<1||e>this._battleStageModels.length)&&n.error(":"+e),this._selectBattleStageNumber=e,this.dispatchEvent("SELECT_STAGE"),this.selectEnemy(0)},selectEnemy:function(e){this.getSelectBattleStage()._selectEnemy(e),this.dispatchEvent("SELECT_ENEMY")},getMaxBattleStage:function(){return this._battleStageModels.length}})}((this||0).self||global),function(e){var t=e.kh;e.khutil,e.cc,e.ccui,e._,e.console,t.createNameSpaceIfNotExists("tower.model"),t.tower.model.QuestBattleInfoDataFactory={create:function(e){var n=e.map(this._createBattleStageModel,this);return new t.tower.model.QuestBattleInfoData(n)},_createBattleStageModel:function(e){var n=e.map(this._createBattleEnemyDataModel,this);return new t.tower.model.BattleStageData(n)},_createBattleEnemyDataModel:function(e){var n=t.tower.enum.SPECIAL_ACTION_TYPE,i=e.enemy_burst_normal.map(this._createBattleSpecialActionModel.bind(this,n.ENEMY_BURST_NORMAL));this._fillEmptySpecialActionModel(i,n.ENEMY_BURST_NORMAL,2);var a=e.enemy_burst_raging.map(this._createBattleSpecialActionModel.bind(this,n.ENEMY_BURST_RAGING));this._fillEmptySpecialActionModel(a,n.ENEMY_BURST_RAGING,2);var o=e.special_attack_info.map(this._createBattleSpecialActionModel.bind(this,n.SPECIAL_ATTACK));this._fillEmptySpecialActionModel(o,n.SPECIAL_ATTACK,3);var r=[].concat(i).concat(a).concat(o);return new t.tower.model.BattleEnemyData(e,r)},_fillEmptySpecialActionModel:function(e,t,n){for(var i=n-e.length;i>0;i--)e.push(this._createBattleSpecialActionModel(t,{}))},_createBattleSpecialActionModel:function(e,n){return new t.tower.model.BattleSpecialAction(e,n)}}}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=(e.ccui,e._),a=e.console;e.Q,t.createNameSpaceIfNotExists("tower.model"),t.tower.model.QuestBattleInfoDataRepository=n.Class.extend({className:"QuestBattleInfoDataRepository",_apiAQuests:null,_apiQuests:null,ctor:function(){this._apiAQuests=t.createInstance("apiAQuests"),this._apiQuests=t.createInstance("apiQuests")},get:function(e){var n=e.getAQuestId();return i.isNull(n)?this._get(this._apiQuests.getBattleInfo(t.tower.WordBook.QUEST_TYPE,e.getQuestId())):this._get(this._apiAQuests.getBattleInfo(t.tower.WordBook.QUEST_TYPE,e.getAQuestId()))},_get:function(e){return e.then(function(e){return t.tower.model.QuestBattleInfoDataFactory.create(e.body.data)},function(e){e instanceof Error&&a.error(e)})},clean:function(){this._apiAQuests=null,this._apiQuests=null}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});e.cc,t.createNameSpaceIfNotExists("tower.controller"),t.tower.controller.Routing={navigateTowerTop:function(e){t.createInstance("router").navigate("tower/tower_top",{tower_top:{event_id:e}})},navigateTowerTopEnd:function(e){t.createInstance("router").navigate("tower/tower_top_end",{tower_top_end:{event_id:e}})},navigateTowerQuest:function(e,n){t.createInstance("router").navigate("tower/tower_quest",{tower_quest:{event_id:e,element_id:n}})},navigateTowerRanking:function(e){t.createInstance("router").navigate("tower/tower_ranking",{tower_ranking:{event_id:e}})},navigateTowerRankingReward:function(e){t.createInstance("router").navigate("tower/tower_ranking_reward",{tower_ranking_reward:{event_id:e}})},navigateQuest:function(e,n,i,a){t.createInstance("router").navigate("quest/q_002",{q_002:{target:"quest",quest_id:e.quest_id,owner_account_id:e.owner_account_id,event_id:a,quest_type:e.type,episode_num:n,recommended_element_type:i,from_tower:!0}})},navigateMyPage:function(){t.createInstance("router").navigate("mypage/my_001")},navigateEventPage:function(){t.createInstance("router").navigate("event/ev_000")},navigateShop:function(e){t.createInstance("router").navigate("shop/sh_102",{sh_102:{shop_id:e}})},navigateParty:function(e,n){t.router.PartyNavigate.makeTo001Member(!0,e,0,0,n.routerParams).navigate()},playScenario:function(e,n){t.createInstance("router").navigate("scenario/episode-play",{"scenario/play":{episode_id:e,returnBackParams:{scene:"tower/tower_top",routerParams:{tower_top:{event_id:n}},temporaryRouterParams:{}}}})},navigateTowerRankingRewardToPrs001:function(){t.createInstance("router").navigate("present/prs_001",{},{prs_001_002_003:{returnRoute:"tower/tower_ranking_reward"}})}}}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=e.ccui,a=(e._,e.console);t.createNameSpaceIfNotExists("tower.controller"),t.tower.controller.QuestTower=n.Class.extend({className:"QuestTower",CHALLENGE_BTN_NODE_NAME:"btn_challenge",_questTowerView:null,_eventDetailModel:null,_aTowerFloorStateModel:null,_towerEventCommentModel:null,_initializePromise:null,ctor:function(e){this._scene=e},initialize:function(e){var t=e.event_id;return this._initializeAllPromise=Q.all([this._initilizeForTowerFloor(e,t),this._initilizeForTowerComment(t)]),this._initializeAllPromise},_initilizeForTowerFloor:function(e,n){var i=t.createInstance("ATowerFloorStateRepository").prepare(n);return this._eventDetailModel=new t.tower.model.AEventDetail(n),this._eventDetailModel.prepare().done(this._initializeEventDetailView.bind(this)),new t.tower.controller.TowerImagePreloader(this._scene,e,this._eventDetailModel).preload(),this._initializePromise=Q.all([i,this._eventDetailModel.getPromise()]).then(this._initializeFloorStateModel.bind(this)).then(null,a.error),this._questTowerView=t.createInstance("QuestTowerView",[this._scene]),this._scene.seekWidgetByName("btn_up").setLockTimeout(10),this._scene.seekWidgetByName("btn_down").setLockTimeout(10),this._initializePromise},_initilizeForTowerComment:function(e){return this._towerEventCommentModel=new t.tower.model.TowerEventComment(e),this._towerEventCommentModel.prepare(),this._towerEventCommentModel.getPromise().then(this.showTowerComment.bind(this))},_initializeFloorStateModel:function(){var e=this._eventDetailModel,n=Math.min(e.getMaxFloor(),e.getMaxReachFloor()+1);return t.createInstance("ATowerFloorStateRepository").create(n).then(function(e){this._aTowerFloorStateModel=e}.bind(this),a.error)},_initializeEventDetailView:function(e){var n=this._scene.seekWidgetByPath("Scene.other_object");new t.tower.view.AEventBasic(n,e).show()},show:function(){return this._initializePromise.then(this._showQuestInformationView.bind(this)).then(this._showQuestTowerView.bind(this)).then(this._setChallengeBtnEnableEvent.bind(this)).fail(a.error)},_showQuestTowerView:function(){var e=this._aTowerFloorStateModel;this._questTowerView.animateWait(),this._questTowerView.show(e)},_showQuestInformationView:function(){var e=this._aTowerFloorStateModel;this._questInformationView=new t.tower.view.QuestInformation(this._scene,e),this._questInformationView.update(e.getSelectedFloor())},_setChallengeBtnEnableEvent:function(){var e=this._aTowerFloorStateModel;e.addEventListener("FLOOR_MOVE_ANIMATION_START",this.__setChallengeBtnEnabled.bind(this,!1)),e.addEventListener("FLOOR_MOVE_ANIMATION_END",this.__setChallengeBtnEnabled.bind(this,!0))},__setChallengeBtnEnabled:function(e){this._scene.seekWidgetByName(this.CHALLENGE_BTN_NODE_NAME).setTouchEnabled(e)},up:function(){this._questTowerView.setEnableDownFloorBtn(!1),this._questTowerView.touchMove(!0)},down:function(){this._questTowerView.setEnableUpFloorBtn(!1),this._questTowerView.touchMove(!1)},confirmQuestStart:function(){var e=this.getSelectedFloor().getQuest(),n=e.getRequiredItem();return n.hasRequiredItem()&&!n.hasEnoughRequiredItems()?t.ImplantedPopup.createOrGet(this._scene,"tower_quest_item_shortage").open(e):t.ImplantedPopup.createOrGet(this._scene,"tower_quest_confirm_start").open(e)},openBattleData:function(){var e=this.getSelectedFloor().getQuest();t.createInstance("QuestBattleInfoDataRepository").get(e).then(function(e){t.ImplantedPopup.createOrGet(this._scene,"tower_quest_battle_data").open(e)}.bind(this)).fail(this._handleError)},showTowerComment:function(){var e=this._towerEventCommentModel.getComment(),t=this._scene.seekWidgetByName("tower_quest_balloon_ui"),n=t.seekWidgetByName("balloon_text");t.animate("balloon_img_in",!1),n.setText(e)},setTowerCommentEvent:function(e){var t=this;this._scene.seekWidgetByName("tower_quest_balloon_ui").seekWidgetByName("balloon_base_btn").addTouchEventListener(function(e,n){n===i.Widget.TOUCH_ENDED&&t.showTowerComment()})},getSelectedFloor:function(){return this._aTowerFloorStateModel.getSelectedFloor()},clean:function(){this._questTowerView.clean(),this._questTowerView=null,this._eventDetailModel=null,this._aTowerFloorStateModel=null,this._towerEventCommentModel=null}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.tower=n.tower||{},n.tower.view=n.tower.view||{},n.tower.controller.TowerImagePreloader=cc.Class.extend({imgNames:{top:"tower-post-top_element_",middle:"tower-post-middle_element_",bottom:"tower-post-bottom_element_",bottom2:"tower-post-bottom2_element_",closed:"tower-door-closed_element_",opened:"tower-door-opened_element_"},NODE_NAMES:{NOW_SELECT:"img_now_select",TOWER_LIST_PAGE_PARENT:"tower_quest_list_page_ui",TOWER_POST_TOP:"tower-post-top",TOWER_POST_MIDDLE:"tower-post-middle",TOWER_POST_BOTTOM:"tower-post-bottom",TOWER_POST_BOTTOM2:"tower-post-bottom2",TOWER_DOOR_CLOSED:"tower-door-closed",TOWER_DOOR_OPENED:"tower-door-opened"},_imagePathList:null,_elementId:null,ctor:function(e,t,n){this._aEventDetailModel=n,this._towerFloorUIList=e.seekWidgetByName(this.NODE_NAMES.TOWER_LIST_PAGE_PARENT).getChildren(),this._elementId=t.element_id},preload:function(){var e=Q.resolve(this._elementId);return t.isNumber(this._elementId)||(e=this._aEventDetailModel.getPromise().then(function(e){return e.getElementId()})),e.then(this._initializeImagePathList.bind(this)).then(this._preloadTextures.bind(this)).fail(console.error)},_initializeImagePathList:function(e){return this._imagePathList={TOWER_POST_TOP:n.Img(this.imgNames.top+t.padZero(e,4)).png,TOWER_POST_MIDDLE:n.Img(this.imgNames.middle+t.padZero(e,4)).png,TOWER_POST_BOTTOM:n.Img(this.imgNames.bottom+t.padZero(e,4)).png,TOWER_POST_BOTTOM2:n.Img(this.imgNames.bottom2+t.padZero(e,4)).png,TOWER_DOOR_CLOSED:n.Img(this.imgNames.closed+t.padZero(e,4)).png,TOWER_DOOR_OPENED:n.Img(this.imgNames.opened+t.padZero(e,4)).png},n.env.isSp||delete this._imagePathList.TOWER_POST_BOTTOM2,Q.resolve()},_preloadTextures:function(){var e=this._imagePathList,t=this.NODE_NAMES,n=this._towerFloorUIList;for(var i in e){var a=e[i];cc.textureCache.addImage(a,this.__loadTexture,{rootNodeList:n,nodeName:t[i]})}},__loadTexture:function(e){var t=this.rootNodeList,n=this.nodeName;t.forEach(function(t){t.seekWidgetByName(n).loadTexture(e.url)})}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=(e.ccui,e._);e.console,t.createNameSpaceIfNotExists("tower.eventHandling"),t.tower.eventHandling.ReceiveConfirmedEventHandler=t.core.reward.ReceiveRewardButtonTouchEventHandler.extend({className:"ReceiveConfirmedEventHandler",ctor:function(){this._api=t.createInstance("apiAEvents")},_receiveConfirmed:function(e){var a=n.director.getRunningScene();this._api.receiveEventRankingReward(t.tower.WordBook.EVENT_TYPE,null,e.getRewardId()).then(function(e){var t=e.body;if(!0===t.is_expired)return this._showExpiredPopup(a);var n=t.new_characters_gained;return i.isEmpty(n)?Q.resolve():this._showNewMemberPopups(n)}.bind(this)).then(function(){a._delegate.refreshList()})}}),i.assign(t.tower.eventHandling.ReceiveConfirmedEventHandler.prototype,t.hlbattle.roles.ReceiveResponseCommon)}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("tower.settings"),t.tower.settings.RewardPageListSettings=n.Class.extend({className:"RewardPageListSettings",SETTINGS:{panelName:t.BtnsPageListParams.TOWER_RANKING_REWARD.panelName,panelsPerPage:t.BtnsPageListParams.TOWER_RANKING_REWARD.perPage,paginatorNode:"viewpage_ui",apiName:"apiAEvents",apiMethod:"getEventRankingRewards",apiParams:[t.tower.WordBook.EVENT_TYPE,t.tower.enum.RANKING_TYPE.TOWER_REACH,null,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE],baseName:"page_item_list",fillEmptyRecord:!0},getSettings:function(){return this.SETTINGS}})}((this||0).self||global),function(e){var t=e.kh;e.khutil,e.cc,e.ccui,e._,e.console,t.createNameSpaceIfNotExists("tower.controller"),t.tower.controller.TowerRewardPageListController=t.core.reward.RewardPageListController.extend({className:"TowerRewardPageListController",LIST_PANEL_VIEW:"TowerRewardPanelView",REWARD_MODEL:"RankingRewardModel"})}((this||0).self||global),function(e){var t=e.kh;e.khutil,e.cc,e.ccui,e._,e.console,t.createNameSpaceIfNotExists("tower.view"),t.tower.view.TowerRewardPanel=t.core.reward.RewardPanelView.extend({className:"TowerRewardPanel",CORECARD_NODE_NAME:"corecard_ui_65",PRICE_LABEL_NAME:"rank_label",PRICE_LABEL_TEXT:"{rank_from}{rank_to}",REWARD_INFORMATION_LABEL_NAME:"reward_have_label",REWARD_INFORMATION_TEXT:"{itemName}x{rewardAmount}",_displayPrice:function(e){var t=this._getWidget(this.PRICE_LABEL_NAME),n=e.getRequireRank();"object"==typeof n&&(n=this.PRICE_LABEL_TEXT.replace("{rank_from}",n.rank_from).replace("{rank_to}",n.rank_to)),t.setString(n)}})}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.tower=t.pc.tower||{},t.pc.tower.tower_quest=t.pc.tower.tower_quest||{},t.pc.tower.tower_quest.Scene=t.BaseScene.extend({resourceFileName:"tower_quest/tower_quest.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"tower",sceneName:"tower_quest",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_up","btnCallbackBtnUp",null,function(){alert("{{1}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_down","btnCallbackBtnDown",null,function(){alert("{{1}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_party","btnCallbackBtnParty",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"party/par_001")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_mission_info","btnCallbackBtnMissionInfo",null,function(){alert("{{tower_quest_mission_data}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_battle_info","btnCallbackBtnBattleInfo",null,function(){alert("{{tower_quest_battle_data}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("tower_quest_btn_challenge"),"btn_challenge","btnCallbackTowerQuestBtnChallengeBtnChallenge",null,function(){alert("{{tower_quest_confirm_start}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("tower_quest_balloon_ui"),"balloon_base_btn","btnCallbackTowerQuestBalloonUiBalloonBaseBtn",null,function(){alert("{{balloon_img_in}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.tower=t.pc.tower||{},t.pc.tower.tower_ranking_reward=t.pc.tower.tower_ranking_reward||{},t.pc.tower.tower_ranking_reward.Scene=t.BaseScene.extend({resourceFileName:"tower_ranking_reward/tower_ranking_reward.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"tower",sceneName:"tower_ranking_reward",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_present","btnCallbackBtnPresent",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"present/prs_001")),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.tower=t.pc.tower||{},t.pc.tower.tower_ranking=t.pc.tower.tower_ranking||{},t.pc.tower.tower_ranking.Scene=t.BaseScene.extend({resourceFileName:"tower_ranking/tower_ranking.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"tower",sceneName:"tower_ranking",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_ranking_reward","btnCallbackBtnRankingReward",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"tower/tower_ranking_reward")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_rule","btnCallbackBtnRule",null,function(){alert("{{tower_ranking_rule}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.tower=t.pc.tower||{},t.pc.tower.tower_top_end=t.pc.tower.tower_top_end||{},t.pc.tower.tower_top_end.Scene=t.BaseScene.extend({resourceFileName:"tower_top_end/tower_top_end.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"tower",sceneName:"tower_top_end",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_ranking","btnCallbackBtnRanking",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"tower/tower_ranking")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_shop","btnCallbackBtnShop",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"shop/shop_102")),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.tower=t.pc.tower||{},t.pc.tower.tower_top_notice=t.pc.tower.tower_top_notice||{},t.pc.tower.tower_top_notice.Scene=t.BaseScene.extend({resourceFileName:"tower_top_notice/tower_top_notice.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"tower",sceneName:"tower_top_notice",_delegate:null,_init:function(){this._initScene("page_in")}})}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.tower=t.pc.tower||{},t.pc.tower.tower_top=t.pc.tower.tower_top||{},t.pc.tower.tower_top.Scene=t.BaseScene.extend({resourceFileName:"tower_top/tower_top.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"tower",sceneName:"tower_top",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_quest","btnCallbackBtnQuest",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"tower/tower_quest")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_ranking","btnCallbackBtnRanking",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"tower/tower_ranking")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_shop","btnCallbackBtnShop",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"shop/shop_102")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_explain","btnCallbackBtnExplain",null,function(){alert("{{}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc=t.pc||{},t.pc.tower=t.pc.tower||{},t.pc.tower.tower_quest=t.pc.tower.tower_quest||{},t.pc.tower.tower_quest.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../tower_popup_ui.json"],_popups:{comBackCheck:{factoryName:"popupFactoryComBackCheck"}},_questTowerController:null,questCommonDelegate:null,onSceneInit:function(e){this.questCommonDelegate=t.createInstance("questSceneCommonDelegate"),this.questCommonDelegate.owner=e;var n=this._getRouterParams(e);return this._questTowerController=new t.tower.controller.QuestTower(e),this._questTowerController.initialize(n),this._questTowerController.setTowerCommentEvent(n.event_id),this._backBtn(e),this._questTowerController.show().fail(this._handleError)},onSceneEnter:function(e){t.createInstance("router").permanentlyRemoveRouterParam("payment_id");var n=this._getRouterParams(e),i=n.event_id;return i||(i=e.routerParams.event_id,n.event_id=i),this._setEventIdToApBpPopup(i),this._updateOtherInformation(),a.resolve()},onSceneExit:function(e){return a.defer(),this._questTowerController&&(this._questTowerController.clean(),this._questTowerController=null),a.resolve()},onPageInAnimationEnd:function(e){return a.defer(),a.resolve()},btnCallbackBtnUp:function(e){var t=a.defer();return t.reject(this._override),this._questTowerController.up(),t.promise},btnCallbackBtnDown:function(e){var t=a.defer();return t.reject(this._override),this._questTowerController.down(),t.promise},btnCallbackBtnParty:function(e){var n=a.defer();return n.reject(this._override),t.tower.controller.Routing.navigateParty("tower/tower_quest",e),n.promise},btnCallbackBtnMissionInfo:function(e){var n=a.defer();n.reject(this._override);var i=this._questTowerController.getSelectedFloor();return t.ImplantedPopup.create(e,"tower_quest_mission_data").open(i),n.promise},btnCallbackBtnBattleInfo:function(e){var t=a.defer();return this._questTowerController.openBattleData(),t.reject(this._override),t.promise},btnCallbackTowerQuestBtnChallengeBtnChallenge:function(e){var t=a.defer();t.reject(this._override);var n=this._questTowerController.getSelectedFloor(),i=n.getQuest();return n.canChallenge()?this.questCommonDelegate.restartCheckInProgressQuest(i.getRawAQuest(),this._questInfo)?t.promise:(this._questTowerController.confirmQuestStart().then(this._towerQuestStartCheck.bind(this,i)).fail(this._handleError),t.promise):t.promise},btnCallbackTowerQuestBalloonUiBalloonBaseBtn:function(e){var t=a.defer();return t.reject(this._override),t.promise},btnCallbackBtnBack:function(e){var n=a.defer();return n.reject(this._override),t.tower.controller.Routing.navigateTowerTop(this._getRouterParams(e).event_id),n.promise},_backBtn:function(e){t.setTouchEventHandlers(e,{"TOUCH_ENDED mainmenu_ui.mainmenu_base.btn_back":function(){t.tower.controller.Routing.navigateTowerTop(this._getRouterParams(e).event_id)}},this)},_updateOtherInformation:function(){var e=t.createInstance("apiAQuestInfo"),n=t.createInstance("myselfInfoRepository");return a.all([e.get(),n.getQuestPoints(),n.getMe()]).spread(function(e,t,n){this._questInfo=e.body,this._questPoints=t.getAsObject(),this._player=n.body}.bind(this)).fail(this._handleError)},_towerQuestStartCheck:function(e){this._doDefaultQuestStartingProcess(e.getRawAQuest())},_doDefaultQuestStartingProcess:function(e){var t=n.director.getRunningScene();this.questCommonDelegate.restartCheckInProgressQuest(e,this._questInfo)||this.startCheckQuestState(t,e)},_setEventIdToApBpPopup:function(e){t.createInstance("popupFactoryComNeedApBp2").setEventId(e)},updateQuestPoints:function(){return n.director.getRunningScene().headerDelegate.updateQuestPoints().then(function(e){return this._questPoints=e,e}.bind(this))},clearOwnQuest:function(){delete this._questInfo.in_progress.own_quest},startQuest:function(e,n,i,a){var o=this._getRouterParams(e).event_id;t.tower.controller.Routing.navigateQuest(n,i,a,o)},_getRouterParams:function(e){var n=t.createInstance("router").getCurrentSceneName();return e.routerParams[n]||{}},_handleError:function(e){e instanceof Error&&console.error(e)}}),t.assignRoles(t.pc.tower.tower_quest.SceneDelegate,[t.pc.roles.UIUtility,t.pc.quest.roles.QuestStart,t.pc.quest.roles.QuestSelectCommon.methods]),t.pc.tower.tower_quest.SceneDelegate.prototype._requiredItemPopup=function(e){return!1},i.assign(t.pc.tower.tower_quest.SceneDelegate.prototype._popups,t.pc.quest.roles.QuestSelectCommon.popups._popups)}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._,e.Q);t.pc=t.pc||{},t.pc.tower=t.pc.tower||{},t.pc.tower.tower_ranking_reward=t.pc.tower.tower_ranking_reward||{},t.pc.tower.tower_ranking_reward.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../tower_popup_ui.json"],_popups:{},onSceneInit:function(e){var i=this._getRouterParams(e).event_id;t.createInstance("apiAEvents").setEventIdDelegate(i),new t.tower.view.Background("tower-ranking-bg",i,"bg_main").show();var a=new t.tower.settings.RewardPageListSettings,o=new t.tower.eventHandling.ReceiveConfirmedEventHandler;return this._rewardPageListController=new t.tower.controller.TowerRewardPageListController(a,o),n.all([this._rewardPageListController.displayRewards(),t.createInstance("apiAEvents").getEventRankingState(t.tower.WordBook.EVENT_TYPE,i).then(this._setRankingState.bind(this,e))])},onSceneEnter:function(e){var n=this._getRouterParams(e).event_id;return this._eventDetailModel=new t.tower.model.AEventDetail(n),this._eventDetailModel.prepare()},onSceneExit:function(e){return n.defer(),this._rewardPageListController&&(this._rewardPageListController=null),this._eventDetailModel&&(this._eventDetailModel.clean(),this._eventDetailModel=null),n.resolve()},onPageInAnimationEnd:function(e){return n.defer(),n.resolve()},_backBtn:function(e){t.setTouchEventHandlers(e,{"TOUCH_ENDED mainmenu_ui.mainmenu_base.btn_back":function(){t.tower.controller.Routing.navigateTowerRanking(this._getRouterParams(e).event_id)}},this)},btnCallbackBtnPresent:function(e){var i=n.defer();return i.reject(this._override),t.tower.controller.Routing.navigateTowerRankingRewardToPrs001(),i.promise},btnCallbackBtnBack:function(e){var i=n.defer();return i.reject(this._override),t.tower.controller.Routing.navigateTowerRanking(this._getRouterParams(e).event_id),i.promise},_setRankingState:function(e,t){var n=t.body;e.seekWidgetByName("my_rank_num_label").setString(n.current_rank||""),e.seekWidgetByName("limit_date_label").setString(n.reward_recept_deadline+""),n.receivable?e.seekWidgetByName("panel_present").setVisible(!0):e.seekWidgetByName("info_label").setVisible(!0)},refreshList:function(){this._rewardPageListController&&this._rewardPageListController.refresh(!1)},_getRouterParams:function(e){var n=t.createInstance("router").getCurrentSceneName();return e.routerParams[n]||{}}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._),i=e.Q;t.pc=t.pc||{},t.pc.tower=t.pc.tower||{},t.pc.tower.tower_ranking=t.pc.tower.tower_ranking||{},t.pc.tower.tower_ranking.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../tower_popup_ui.json"],_popups:{},_rankingController:null,onSceneInit:function(e){var n=(i.defer(),this._getRouterParams(e));new t.tower.view.Background("tower-ranking-bg",n.event_id,"bg_main").show(),this._eventDetailModel=new t.tower.model.AEventDetail(n.event_id);var a=this;return this._eventDetailModel.prepare().done(function(t){a._backBtn(e,t.isReceiveReward())}),t.createInstance("apiAEvents").setEventIdDelegate(n.event_id),t.createInstance("apiAEvents").getEventRankingState(t.tower.WordBook.EVENT_TYPE,n.event_id).then(this._setRankingInformation.bind(this,e)),t.createInstance("apiAEvents").getLastEventRankingUpdate(t.tower.WordBook.EVENT_TYPE,n.event_id).then(this._setLastUpdateTime.bind(this,e)),t.createInstance("apiAEvents").getRankingHasRewards(t.tower.WordBook.EVENT_TYPE,n.event_id).then(this._setNewRewardIcon.bind(this,e)),i.all([t.createInstance("apiAPlayers").get("me"),this._eventDetailModel.getPromise()]).spread(this._setUserInformation.bind(this,e)).fail(this._handleError),this._rankingController=new t.tower.controller.RankingPageListController(0),i.resolve()},onSceneEnter:function(e){var n=(i.defer(),this._getRouterParams(e)).event_id;return this._eventDetailModel=new t.tower.model.AEventDetail(n),this._eventDetailModel.prepare(),i.resolve()},onSceneExit:function(e){return i.defer(),this._eventDetailModel&&(this._eventDetailModel.clean(),this._eventDetailModel=null),this._rankingController&&(this._rankingController.clean(),this._rankingController=null),i.resolve()},onPageInAnimationEnd:function(e){return i.defer(),this._rankingController.showRanking(),i.resolve()},_backBtn:function(e,n){t.setTouchEventHandlers(e,{"TOUCH_ENDED mainmenu_ui.mainmenu_base.btn_back":function(){n?t.tower.controller.Routing.navigateTowerTopEnd(this._getRouterParams(e).event_id):t.tower.controller.Routing.navigateTowerTop(this._getRouterParams(e).event_id)}},this)},btnCallbackBtnRankingReward:function(e){var n=i.defer();return n.reject(this._override),t.tower.controller.Routing.navigateTowerRankingReward(this._getRouterParams(e).event_id),n.promise},btnCallbackBtnRule:function(e){var n=i.defer();return n.reject(this._override),t.ImplantedPopup.createOrGet(e,"tower_ranking_rule").open(),n.promise},btnCallbackBtnBack:function(e){var n=i.defer();return n.reject(this._override),this._eventDetailModel&&this._eventDetailModel.getPromise().then(function(n){n.isReceiveReward()?t.tower.controller.Routing.navigateTowerTopEnd(this._getRouterParams(e).event_id):t.tower.controller.Routing.navigateTowerTop(this._getRouterParams(e).event_id)}.bind(this)).fail(this._handleError),n.promise},_setUserInformation:function(e,i,a){var o=i.body;e.setStrings({name_label:o.name,medal_label:a.getCurrentGotTowerMedal(),max_reach_label:a.getMaxReachFloorName()});var r=e.seekWidgetByName("illust-com-kneeshot-job");if(null!==r){var s=t.Img("illust-com-kneeshot","job",n.padZero(o.job_info.job_id,4),0).png;r.loadTexture(s)}},_setLastUpdateTime:function(e,t){var n=t.body;n.last_update_time&&e.seekWidgetByName("header_sub_label").setString(""+n.last_update_time)},_setRankingInformation:function(e,t){var n=t.body;e.seekWidgetByName("ranking_label").setString(n.current_rank||"")},_setNewRewardIcon:function(e,t){e.seekWidgetByName("new_icon").setVisible(t.body.receivable)},_getRouterParams:function(e){var n=t.createInstance("router").getCurrentSceneName();return e.routerParams[n]||{}},_handleError:function(e){e instanceof Error&&console.error(e)}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._,e.Q);t.pc=t.pc||{},t.pc.tower=t.pc.tower||{},t.pc.tower.tower_top_end=t.pc.tower.tower_top_end||{},t.pc.tower.tower_top_end.SceneDelegate=t.pc.BaseSceneDelegate.extend({_popups:{},onSceneInit:function(e){var i=(n.defer(),this._getRouterParams(e));return new t.tower.view.Background("tower-top-end-bg",i.event_id).show(),new t.tower.view.AEventBasic(e,this._eventDetailModel).show(),this._eventDetailModel.getPromise().done(function(t){e.seekWidgetByName("header_label").setString(t.getEventName())}),t.createInstance("apiAEvents").getRankingHasRewards(t.tower.WordBook.EVENT_TYPE,i.event_id).then(this._setNewRewardIcon.bind(this,e)),this._backBtn(e),n.resolve()},onSceneEnter:function(e){var i=(n.defer(),this._getRouterParams(e));return this._eventDetailModel=new t.tower.model.AEventDetail(i.event_id),n.resolve()},onSceneExit:function(e){return n.defer(),this._eventDetailModel&&(this._eventDetailModel.clean(),this._eventDetailModel=null),n.resolve()},onPageInAnimationEnd:function(e){return n.defer(),n.resolve()},_backBtn:function(e){t.setTouchEventHandlers(e,{"TOUCH_ENDED mainmenu_ui.mainmenu_base.btn_back":function(){t.tower.controller.Routing.navigateEventPage()}},this)},btnCallbackBtnRanking:function(e){var i=n.defer();return i.reject(this._override),t.tower.controller.Routing.navigateTowerRanking(this._getRouterParams(e).event_id),i.promise},btnCallbackBtnShop:function(e){var i=n.defer();return this._eventDetailModel.getPromise().done(function(e){var n=e.getShopId();return null===n?void console.error("TowerShopId Not Found"):void t.tower.controller.Routing.navigateShop(n)}),i.reject(this._override),i.promise},_setNewRewardIcon:function(e,t){e.seekWidgetByName("new_icon").setVisible(t.body.receivable)},_getRouterParams:function(e){var n=t.createInstance("router").getCurrentSceneName();return e.routerParams[n]||{}}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._,e.Q);t.pc=t.pc||{},t.pc.tower=t.pc.tower||{},t.pc.tower.tower_top_notice=t.pc.tower.tower_top_notice||{},t.pc.tower.tower_top_notice.SceneDelegate=t.pc.BaseSceneDelegate.extend({_popups:{},onSceneInit:function(e){this._setHeaderLabel(e);var i=this._getRouterParams(e);return new t.tower.view.Background("tower-top-notice-bg",i.event_id).show(),this._backBtn(e),n.resolve()},onSceneEnter:function(e){return n.resolve()},onSceneExit:function(e){return n.defer(),n.resolve()},_backBtn:function(e){t.setTouchEventHandlers(e,{"TOUCH_ENDED mainmenu_ui.mainmenu_base.btn_back":function(){t.tower.controller.Routing.navigateMyPage()}},this)},onPageInAnimationEnd:function(e){return n.defer(),n.resolve()},_setHeaderLabel:function(e){var n=e.seekWidgetByName("header_label");if(n){var i=this._getRouterParams(e);t.createInstance("apiEvents").getTowerNotice(i.event_id).then(function(e){n.setString(e.body.basic_info.title)}).fail(this._handleError)}},_getRouterParams:function(e){var n=t.createInstance("router").getCurrentSceneName();return e.routerParams[n]||{}},_handleError:function(e){e instanceof Error&&console.error(e)}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._,e.Q);t.pc=t.pc||{},t.pc.tower=t.pc.tower||{},t.pc.tower.tower_top=t.pc.tower.tower_top||{},t.pc.tower.tower_top.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../tower_popup_ui.json"],_popups:{},onSceneInit:function(e){var i=(n.defer(),this._getRouterParams(e)),a=new t.tower.view.AEventBasic(e,this._eventDetailModel);return a.show(),new t.tower.view.Background("tower-top-bg",i.event_id).show(),this._eventDetailModel.getPromise().done(function(n){if(n.isFirstAccess())return t.createInstance("apiAEvents").updateFirstAccessDatetime(t.tower.WordBook.EVENT_TYPE),void t.tower.controller.Routing.playScenario(n.getEpisodeId(),n.getEventId());var i=t.createInstance("apiASubTutorialPages");i.get.call(i,"tower").then(function(i){if(!0!==i.body.visited)return n.getPromise().then(function(n){t.createInstance("apiASubTutorialPages").visited("tower");var i=n.getEventId(),a=n.getDescriptionImages().length;return this._openSubTutorialPopup(e,i,a)}.bind(this))}.bind(this)).then(function(){n.canGetChallengeCount()&&n.update().done(function(n){t.ImplantedPopup.create(e,"tower_give_item").open(n),a.update(n)})}),e.seekWidgetByName("header_label").setString(n.getEventName())}.bind(this)),this._backBtn(e),n.resolve()},onSceneEnter:function(e){var i=(n.defer(),this._getRouterParams(e));return this._eventDetailModel=new t.tower.model.AEventDetail(i.event_id),n.resolve()},onSceneExit:function(e){return n.defer(),this._eventDetailModel&&(this._eventDetailModel.clean(),this._eventDetailModel=null),n.resolve()},onPageInAnimationEnd:function(e){return n.defer(),n.resolve()},_backBtn:function(e){t.setTouchEventHandlers(e,{"TOUCH_ENDED mainmenu_ui.mainmenu_base.btn_back":function(){t.tower.controller.Routing.navigateEventPage()}},this)},btnCallbackBtnQuest:function(e){var i=n.defer();return i.reject(this._override),t.tower.controller.Routing.navigateTowerQuest(this._getRouterParams(e).event_id,this._eventDetailModel.getElementId()),i.promise},btnCallbackBtnRanking:function(e){var i=n.defer();return i.reject(this._override),t.tower.controller.Routing.navigateTowerRanking(this._getRouterParams(e).event_id),i.promise},btnCallbackBtnShop:function(e){var i=n.defer();return this._eventDetailModel.getPromise().done(function(e){var n=e.getShopId();return null===n?void console.error("TowerShopId Not Found"):void t.tower.controller.Routing.navigateShop(n)}),i.reject(this._override),i.promise},btnCallbackBtnExplain:function(e){var t=n.defer(),i=this._getRouterParams(e).event_id;return this._eventDetailModel&&this._eventDetailModel.getPromise().then(function(t){var n=t.getDescriptionImages().length;this._openSubTutorialPopup(e,i,n)}.bind(this)),t.reject(this._override),t.promise},_getRouterParams:function(e){var n=t.createInstance("router").getCurrentSceneName();return e.routerParams[n]||{}},_openSubTutorialPopup:function(e,n,i){return t.ImplantedPopup.createOrGet(e,"sub_tutorial","ImplantedEventSubTutorialPopup").open(n,i)}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.createNameSpaceIfNotExists("tower.view"),t.tower.view.TowerRankingRulePopup=t.ImplantedPopup.extend({_initContents:function(){this.setButtonEvents({btn_close:!0})}})}((this||0).self||global),function(e){var t=e.kh;e.khutil,e.cc,e.ccui,e._,e.console,t.createNameSpaceIfNotExists("tower.view"),t.tower.view.MissionDataPopup=t.ImplantedPopup.extend({className:"MissionDataPopup",MISSION_DATA_UI_NODE_NAME_PREFIX:"tower_quest_mission_data_ui_",_initContents:function(e){this.setButtonEvents({btn_close:!0}),e.getMissions().forEach(function(e,n){var i=this.getNode().seekWidgetByName(this.MISSION_DATA_UI_NODE_NAME_PREFIX+n);i&&new t.tower.view.TowerQuestMissionDataPanel(i).update(e)}.bind(this))}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc,e.ccui,e._);e.console,t.createNameSpaceIfNotExists("tower.view"),t.tower.view.QuestConfirmStartPopup=t.ImplantedPopup.extend({className:"QuestConfirmStartPopup",LABEL_HTML_TEMPLATE:'<div><div class="text_common white" style="margin: 2px auto 4px;padding: 4px 0;"><%= questName %></div><div class="text_common white" style="margin: 2px auto 4px;padding: 4px 0;"><%= requireItemName %>:<%= beforeCanChallengeCount%><span class="yellow"><%= afterCanChallengeCount%></span></div></div>',_initContents:function(e){this.setButtonEvents({btn_cancel:!1,btn_challenge:!0}),this.getNode().setHtmlStrings({label_img:this._createLabelHtmlString(e)},t.GameConfig.POPUP_CSS)},_createLabelHtmlString:function(e){var t=e.getRequiredItem();return n.template(this.LABEL_HTML_TEMPLATE)({questName:e.getTitle(),requireItemName:t.getItemName(),beforeCanChallengeCount:t.getPossessedAmount(),afterCanChallengeCount:t.getPossessedAmount()-t.getRequiredAmount()})}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc,e.ccui,e._);e.console,t.createNameSpaceIfNotExists("tower.view"),t.tower.view.QuestItemShortagePopup=t.ImplantedPopup.extend({className:"QuestItemShortagePopup",NODE_NAMES:{REQUIRE_LABEL:"require_label",POSSESSION_LABEL:"possession_label"},REQUIRE_LABEL_TEMPLATE:"<%= questName %>\n<%= requireItemName%><%=requireItemAmount%>",POSSESSION_LABEL_TEMPLATE:":<%=possessedAmount%>",_initContents:function(e){this.setButtonEvents({btn_ok:!1});var t=e.getRequiredItem(),i=n.template(this.REQUIRE_LABEL_TEMPLATE)({questName:e.getTitle(),requireItemName:t.getItemName(),requireItemAmount:t.getRequiredAmount()});this._setLabel(this.NODE_NAMES.REQUIRE_LABEL,i);var a=n.template(this.POSSESSION_LABEL_TEMPLATE)({possessedAmount:t.getPossessedAmount()});this._setLabel(this.NODE_NAMES.POSSESSION_LABEL,a)},_setLabel:function(e,t){var n=this.getNode().seekWidgetByName(e);n.setString(""+t),n.setVisible(!0)}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc,e.ccui,e._);e.console,t.createNameSpaceIfNotExists("tower.view"),t.tower.view.TowerQuestBattleDataPopup=t.ImplantedPopup.extend({className:"TowerQuestBattleDataPopup",NODE_NAMES:{ENEMY_SELECT_UI:"tower_quest_battle_data_enemy_ui",STATUS_BASE:"tower_quest_battle_data_status_base",ENEMY_BURST_BASE:"tower_quest_battle_data_enemyburst_base",SPECIAL_ACT_BASE:"tower_quest_battle_data_special_act_base",BATTLE_STAGE_PULLDOWN:"battle_stage_pulldown_btn",STAGE_PULLDOWN_LABEL:"battle_stage_label",STAGE_PULLDOWN_MENU_BASE:"battle_stage_list",STATUS_BUTTON:"status_btn",ENEMYBURST_BUTTON:"enemyburst_btn",SPECIAL_ACT_BUTTON:"special_act_btn"},TAB_CHANGE_BUTTON_NAMES:["STATUS_BUTTON","ENEMYBURST_BUTTON","SPECIAL_ACT_BUTTON"],TAB_NAMES:["STATUS_BASE","ENEMY_BURST_BASE","SPECIAL_ACT_BASE"],_nodes:{},_battleInfoModel:null,_pulldown:null,_pulldownLabelDefaultString:null,_initContents:function(e){this._battleInfoModel=e,Object.keys(this.NODE_NAMES).forEach(function(e){this._nodes[e]=this.getNode().seekWidgetByName(this.NODE_NAMES[e])},this),e.addEventListener("SELECT_STAGE",this._selectStageEvent.bind(this)),e.addEventListener("SELECT_ENEMY",this._selectEnemyEvent.bind(this)),this.setButtonEvents({btn_close:!0,enemy_data_base_0:this._enemyIconTouchEvent.bind(this,0),enemy_data_base_1:this._enemyIconTouchEvent.bind(this,1),enemy_data_base_2:this._enemyIconTouchEvent.bind(this,2),status_btn:this._tabChange.bind(this,0),enemyburst_btn:this._tabChange.bind(this,1),special_act_btn:this._tabChange.bind(this,2)}),e.selectBattleStage(1),this._tabChange(0),this._initPulldown()},_initPulldown:function(){for(var e=[],n=this._battleInfoModel.getMaxBattleStage(),i=1;i<=n;i++)e.push({text:""+i,value:i});var a=this._nodes.STAGE_PULLDOWN_LABEL;this._pulldown=new t.Pulldown({button:this._nodes.BATTLE_STAGE_PULLDOWN,label:a,menuBase:this._nodes.STAGE_PULLDOWN_MENU_BASE,choice:ccs.load(res["core-sort-sort_list_ui"]).node,bottomMargin:0},e),this._pulldown.onChange(function(e){this._battleInfoModel.selectBattleStage(e.value)}.bind(this)),this._pulldownLabelDefaultString=a.getString(),this._pulldown.setTouchEnabled(!0)},_tabChange:function(e,t){var n=this._nodes,i=this.TAB_NAMES[e],a=this.TAB_CHANGE_BUTTON_NAMES[e];this.TAB_NAMES.forEach(function(e){n[e].setVisible(!1)},this),this.TAB_CHANGE_BUTTON_NAMES.forEach(function(e){n[e].setBright(!0),n[e].setTouchEnabled(!0)},this),n[i].setVisible(!0),n[a].setBright(!1),n[a].setTouchEnabled(!1)},_enemyIconTouchEvent:function(e){this._battleInfoModel.selectEnemy(e)},_selectStageEvent:function(){var e=this._battleInfoModel,n=this._nodes.ENEMY_SELECT_UI;t.tower.view.BattleDataEnemySelectPanel.update(n,e.getSelectBattleStage())},_selectEnemyEvent:function(){var e=this._battleInfoModel.getSelectBattleStage(),n=this._nodes.ENEMY_SELECT_UI;t.tower.view.BattleDataEnemySelectPanel.updateSelect(n,e);var i=e.getSelectedEnemy(),a=this._nodes.STATUS_BASE;t.tower.view.EnemyStatusPanel.update(a,i);var o=this._nodes.ENEMY_BURST_BASE;t.tower.view.EnemyBurstPanel.update(o,i);var r=this._nodes.SPECIAL_ACT_BASE;t.tower.view.EnemySpecialActionPanel.update(r,i)},dismiss:function(){this._super.apply(this,arguments);var e=this._getScene();n.isFunction(e.unregisterPulldownMenu)&&e.unregisterPulldownMenu(this),this._nodes.STAGE_PULLDOWN_LABEL.setString(this._pulldownLabelDefaultString),this._pulldown.releaseMenu(),this._pulldown=null,this._battleInfoModel.removeAllEventListeners(),this._battleInfoModel=null,this._nodes={}}})}((this||0).self||global),function(e){var t=e.kh;e.khutil,e.cc,e.ccui,e._,e.console,t.createNameSpaceIfNotExists("tower.view"),t.tower.view.TowerGiveItemPopup=t.ImplantedPopup.extend({className:"TowerGiveItemPopup",CHALLENGE_UI_NODE_NAME:"tower_give_item",NODE_NAMES:{NOTICE_LABEL:"notice_label"},_initContents:function(e){this.setButtonEvents({btn_ok:!1});var t=e.getGainedChallengeCount(),n=""+e.getChallengeItemName()+""+t+"";this._setLabel(this.NODE_NAMES.NOTICE_LABEL,n)},_setLabel:function(e,t){var n=this.getNode().seekWidgetByName(e);n.setString(""+t),n.setVisible(!0)}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc,e.ccui,e._);e.console,t.createNameSpaceIfNotExists("tower.view"),t.tower.view.BattleDataEnemySelectPanel={PREFIX_NODE_NAMES:{BASE:"enemy_data_base_",ICON:"enemy_icon_",HP_GAUGE:"enemy_hp-gauge_"},BACKGROUND_NODE_NAMES:{0:"tower_quest_battle_data_base_left",1:"tower_quest_battle_data_base_center",2:"tower_quest_battle_data_base_right"},update:function(e,t){var n=t.getAllEnemies();this._forEachEnemyDataBaseNode(e,this._updateEnemyPanel.bind(this,n)),this.updateSelect(e,t)},_forEachEnemyDataBaseNode:function(e,t){var n=this.PREFIX_NODE_NAMES.BASE;return e.getChildren().filter(function(e){return 0===e.getName().indexOf(n)}).forEach(t)},_updateEnemyPanel:function(e,i,a){if(a>=e.length)i.setVisible(!1);else{var o=e[a];i.seekWidgetByName(this.PREFIX_NODE_NAMES.ICON+a).initWithFile(t.Img("iconene","enemy-looks",n.padZero(o.getId(),4)).png),i.seekWidgetByName(this.PREFIX_NODE_NAMES.HP_GAUGE+a).percent=o.getHpPercentage(),i.setVisible(!0)}},updateSelect:function(e,t){var n=t.getSelectedEnemyNumber();this._forEachEnemyDataBaseNode(e,this._updateSelect.bind(this,n))},_updateSelect:function(e,t,n){var i=e===n;t.setBright(!i),t.setTouchEnabled(!i);var a=this.BACKGROUND_NODE_NAMES[n];t.getParent().seekWidgetByName(a).setVisible(i)}}}((this||0).self||global),function(e){var t=e.kh;e.khutil,e.cc,e.ccui,e._,e.console,t.createNameSpaceIfNotExists("tower.view"),t.tower.view.EnemyBurstPanel={PREFIX_NODE_NAME:{NAME:"attack_name_label_",DESCRIPTION:"detail_label_"},update:function(e,t){for(var n=t.getBurstNormalData().concat(t.getBurstRagingData()),i={},a=0;a<4;a++)i[this.PREFIX_NODE_NAME.NAME+a]=n[a].getName(),i[this.PREFIX_NODE_NAME.DESCRIPTION+a]=n[a].getDescription();e.setStrings(i)}}}((this||0).self||global),function(e){var t=e.kh;e.khutil,e.cc,e.ccui,e._,e.console,t.createNameSpaceIfNotExists("tower.view"),t.tower.view.EnemySpecialActionPanel={PREFIX_NODE_NAME:{NAME:"attack_name_label_",DESCRIPTION:"detail_label_"},update:function(e,t){for(var n=t.getSpecialAttackData(),i={},a=0;a<3;a++)i[this.PREFIX_NODE_NAME.NAME+a]=n[a].getName(),i[this.PREFIX_NODE_NAME.DESCRIPTION+a]=n[a].getDescription();e.setStrings(i)}}}((this||0).self||global),function(e){var t=e.kh;e.khutil,e.cc,e.ccui,e._,e.console,t.createNameSpaceIfNotExists("tower.view"),t.tower.view.EnemyStatusPanel={NODE_NAMES:{NAME:"detail_label_0",HP_RANK:"detail_label_1",ATTACK_RANK:"detail_label_2",RESISTANCE_RANK:"detail_label_3",HAS_MODE_GAUGE:"detail_label_4"},update:function(e,t){this._setLabel(e,"NAME",t.getName()),this._setLabel(e,"HP_RANK",t.getHpRank()),this._setLabel(e,"ATTACK_RANK",t.getAttackRank()),this._setLabel(e,"RESISTANCE_RANK",t.getResistanceRank()),this._setLabel(e,"HAS_MODE_GAUGE",t.getHasModeGauge())},_setLabel:function(e,t,n){e.seekWidgetByName(this.NODE_NAMES[t]).setString(""+n)}}}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc,e.ccui,e._);e.console,e.res,t.createNameSpaceIfNotExists("tower.controller"),t.tower.controller.RankingPageListController=t.core.ranking.RankingPageListController.extend({className:"TowerRankingPageListController",GENERAL_SETTINGS:{baseName:"window_gray",panelName:t.BtnsPageListParams.TOWER_RANKING_LIST.panelName,panelsPerPage:t.BtnsPageListParams.TOWER_RANKING_LIST.perPage,paginatorNode:"viewpage_three_ui",apiName:"apiAEvents",apiMethod:"getEventRanking",apiParams:[t.tower.WordBook.EVENT_TYPE,0,null,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE]},_instantiateStatusPanel:function(e){return new t.tower.controller.RankingStatusController(e)},_initializePageListSettings:function(e){return n.assign({},this.GENERAL_SETTINGS)}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("tower.model"),t.tower.model.TowerRankingStatus=n.Class.extend({className:"TowerRankingStatus",ctor:function(e){this._rankingStatusData=e},getRank:function(){return this._rankingStatusData.rank},getPreviousRank:function(){return this._rankingStatusData.previous_rank},getPreviousRankStatus:function(){return 0===this.getPreviousRank()?t.core.enums.PREVIOUS_RANK.HAS_NONE:this.getPreviousRank()<this.getRank()?t.core.enums.PREVIOUS_RANK.IS_HIGHER:this.getPreviousRank()===this.getRank()?t.core.enums.PREVIOUS_RANK.IS_EQUAL:this.getPreviousRank()>this.getRank()?t.core.enums.PREVIOUS_RANK.IS_LOWER:void 0},getMaxReachFloor:function(){return this._rankingStatusData.max_reach_floor},getTokenScore:function(){return this._rankingStatusData.got_token},getJobId:function(){return this._rankingStatusData.job_id},getSummonId:function(){return this._rankingStatusData.summon_id},getMainPartyMembersIdList:function(){return this._rankingStatusData.main_party_members_id_list},getName:function(){return this._rankingStatusData.player_name},getPlayerId:function(){return this._rankingStatusData.a_player_id},isMe:function(){return this._rankingStatusData.is_me}})}((this||0).self||global),function(e){var t=e.kh,n=e._;t.createNameSpaceIfNotExists("tower.model"),t.tower.model.TowerEventComment=cc.Class.extend({className:"TowerEventComment",_aEventsApi:null,_promise:null,_towerEventCommentList:null,_index:null,ctor:function(e){this._aEventsApi=t.createInstance("apiAEvents"),this._aEventsApi.setEventIdDelegate(e)},prepare:function(){return this._promise=this._aEventsApi.getTowerComment(t.tower.WordBook.EVENT_TYPE).then(function(e){this._towerEventCommentList=e.body}.bind(this)),this._promise},getPromise:function(){return this._promise?this._promise:this.prepare()},getComment:function(){return null===this._index?this._getRandomComment():this._getNextComment()},_getRandomComment:function(){return this._index=n.random(0,this._towerEventCommentList.length-1),this._towerEventCommentList[this._index].content},_getNextComment:function(){return this._index=this._index+1,this._index>=this._towerEventCommentList.length?(this._index=0,this._towerEventCommentList[this._index].content):this._towerEventCommentList[this._index].content}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=e.ccui,o=(e._,e.console);t.createNameSpaceIfNotExists("tower.controller"),t.tower.controller.RankingStatusController=i.Class.extend({className:"RankingStatusController",PANEL_TOUCH_EVENT_WIDGET_NAME:"rank_base",ctor:function(e){this._statusPanelView=new t.tower.view.TowerRankingStatusPanelView(e),this._initializeOnTouchEvent(e)},initializeModel:function(e){this._towerRankingStatusModel=new t.tower.model.TowerRankingStatus(e)},displayStatusPanel:function(){this._statusPanelView.display(this._towerRankingStatusModel)},hideStatusPanel:function(){this._statusPanelView.clear()},_initializeOnTouchEvent:function(e){n.getWidgetFromNode(e,this.PANEL_TOUCH_EVENT_WIDGET_NAME,function(e){o.warn(this.className+": "+e)}.bind(this)).addTouchEventListener(this._onTouchEventCallback,this)},_onTouchEventCallback:function(e,t){t===a.Widget.TOUCH_ENDED&&this._navigateToProfilePage()},_navigateToProfilePage:function(){var e=this._towerRankingStatusModel.getPlayerId(),n=this._towerRankingStatusModel.isMe()?"a":"b",a=i.director.getRunningScene(),o=t.createInstance("router").getCurrentSceneName(),r=a.routerParams[o].event_id;t.createInstance("router").navigate("profile/prf_001"+n,{prf_001:{id:e}},{return_to_profile:{routes:"tower/tower_ranking",params:{tower_ranking:{event_id:r}}}})},clear:function(){this.hideStatusPanel()}})}((this||0).self||global),function(e){var t=e.kh;e.khutil,e.cc,e.ccui,e._,e.console,t.createNameSpaceIfNotExists("tower.view"),t.tower.view.RankingStatusPanelView=t.core.ranking.RankingStatusPanelView.extend({className:"RankingStatusPanelView",SCORE_TEXT:"{token} {maxReachFloor}",WIDGET_NAMES:{NAME:"name_label",RANK:"rank_label",SCORE:"score_label",PREVIOUS_RANK_RED:"red_label",PREVIOUS_RANK_BLUE:"blue_label",PREVIOUS_RANK_ARROW:"tower_ranking_arrow_ui"},_displayScore:function(e){var t=this._getWidget(this.WIDGET_NAMES.SCORE),n=this.SCORE_TEXT.replace("{token}",e.getTokenScore()).replace("{maxReachFloor}",e.getMaxReachFloor());t.setString(n)}})}((this||0).self||global),function(e){var t=e.kh;e.khutil,e.cc,e.ccui,e._,e.console,t.createNameSpaceIfNotExists("tower.view"),t.tower.view.TowerRankingStatusPanelView=t.core.ranking.IndividualRankingStatusPanelView.extend({className:"TowerRankingStatusPanelView",_createSharedPanelView:function(e){return new t.tower.view.RankingStatusPanelView(e)}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.router=n.router||{},n.router.routes=n.router.routes||{},t.merge(n.router.routes,{tower:{tower:"tower_top","tower/tower_quest":"tower_quest","tower/tower_ranking":"tower_ranking","tower/tower_ranking_reward":"tower_ranking_reward","tower/tower_top":"tower_top","tower/tower_top_end":"tower_top_end","tower/tower_top_notice":"tower_top_notice"}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e._,t.SubTutorialPageModel=n.Class.extend({prepare:function(e){return this._subTutorialPagesData&&this._subTutorialPagesData.page===e?Q.resolve(this):t.createInstance("apiASubTutorialPages").get(e).then(function(e){return this._subTutorialPagesData=e.body,this}.bind(this)).fail(function(e){console.warn(e.stack)})},hasVisited:function(){return void 0===this._subTutorialPagesData&&window.alert("You must call prepare first!"),this._subTutorialPagesData.visited},visit:function(){return void 0===this._subTutorialPagesData&&window.alert("You must call prepare first!"),t.createInstance("apiASubTutorialPages").visited(this._subTutorialPagesData.page).then(function(e){this._subTutorialPagesData.visited=e.body.visited}.bind(this)).fail(function(e){console.warn(e.stack)})}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e._,t.model=t.model||{},t.model.BattleUnverified=n.Class.extend({prepare:function(){return this._getUnverifiedListPromise().then(function(e){return this._data=e.body.data,this._maxRecordCount=e.body.max_record_count,this}.bind(this))},_getUnverifiedListPromise:function(){return t.createInstance("apiABattles").getUnverifiedList().fail(function(e){console.warn(e.stack)})},getUnverifyCount:function(){return null==this._data&&window.alert("[BattleUnverified::getUnverifyCount]\nYou must call prepare first!"),this._maxRecordCount}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e._,t.model=t.model||{},t.model.PlayerMeNumeric=n.Class.extend({prepare:function(){return this._getMeNumericPromise().then(function(e){return this._data=e.body,this}.bind(this))},_getMeNumericPromise:function(){return t.createInstance("apiAPlayers").getMeNumeric().fail(function(e){console.warn(e.stack)})},getAPlayerId:function(){return null==this._data&&window.alert("[BattleUnverified::getUnverifyCount]\nYou must call prepare first!"),this._data.a_player_id}})}((this||0).self||global),function(e){var t=e.kh;e.cc,e._,t.ISceneInterrupt={playable:function(){throw new Error("override me!")},play:function(){throw new Error("override me!")}}}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e._,t.SceneInterruptManager=n.Class.extend({_interrupts:[],ctor:function(e){this._interrupts=e},playIfNeed:function(){return this._playInterruptRecurrence()},_playInterruptRecurrence:function(){var e=this._getNextInterrupt();return null==e?Q.resolve():this._playInterrupt(e).then(this._playInterruptRecurrence.bind(this))},_getNextInterrupt:function(){return this._interrupts.shift()},_playInterrupt:function(e){return e.playable().then(function(t){return t?e.play():Q.resolve()})}})}((this||0).self||global),function(e){var t=e.kh;e.khutil,e.cc,e.ccui,e._,e.console,t.createNameSpaceIfNotExists("unionraid.enums"),t.unionraid.enums.RANKING_TYPE={EXPERT:0,ULTIMATE:1,INDIVIDUAL:2}}((this||0).self||global),function(e){var t=e.kh;e.khutil,e.cc,e.ccui,e._,e.console,t.createNameSpaceIfNotExists("unionraid.enums"),t.unionraid.enums.PREVIOUS_RANK={IS_HIGHER:0,IS_EQUAL:1,IS_LOWER:2,HAS_NONE:3}}((this||0).self||global),function(e){var t=e.kh;t.createNameSpaceIfNotExists("unionraid.enums"),t.unionraid.enums.UNION_RAID_TYPE={DEMON:"demon",SERAPH:"seraph"}}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;t.unionraid=t.unionraid||{},t.unionraid.model=t.unionraid.model||{},t.unionraid.model.UnionRaid=n.Class.extend({prepare:function(e){return this._eventId=e,this.update()},update:function(){return this._getUnionRaidPromise(this._eventId).then(function(e){return this._eventData=e.body,this._attentionInfoModel=t.createInstance("UnionRaidAttentionInfoModel",[this._eventData.attention_info]),this}.bind(this))},_getUnionRaidPromise:function(e){return t.createInstance("apiAEvents").getUnionRaid(e).fail(function(e){console.warn(e.stack)})},getAEventId:function(){return null==this._eventData&&window.alert("[UnionRaidModel::getAEventId]\nYou must call prepare first!"),this._eventData.a_event_id},getEventId:function(){return null==this._eventData&&window.alert("[UnionRaidModel::getEventId]\nYou must call prepare first!"),this._eventData.event_id},getExchangeableRewards:function(){return null==this._eventData&&window.alert("[UnionRaidModel::getExchangeableRewards]\nYou must call prepare first!"),this._eventData.exchangeable_rewards},hasNewRewards:function(e){i.isEmpty(this._eventData)&&window.alert("You must call prepare first!"),e=e||"ANY";var t=this._eventData.exchangeable_rewards||[];return"ANY"===e?!i.isEmpty(t):-1!==t.indexOf(e)},isFirstAccess:function(){return null==this._eventData&&window.alert("[UnionRaidModel::isFirstAccess]\nYou must call prepare first!"),this._eventData.first_access},getMyUnionId:function(){return null==this._eventData&&window.alert("[UnionRaidModel::getMyUnionId]\nYou must call prepare first!"),this._eventData.my_union_id},getMyUnionName:function(){return null==this._eventData&&window.alert("[UnionRaidModel::getMyUnionName]\nYou must call prepare first!"),this._eventData.my_union_name},getRewardReceiptDeadline:function(){return null==this._eventData&&window.alert("[UnionRaidModel::getRewardReceiptDeadline]\nYou must call prepare first!"),this._eventData.reward_receipt_deadline},getAttentionInfo:function(){return null==this._attentionInfoModel&&window.alert("[UnionRaidModel::getAttentionInfo]\nYou must call prepare first!"),this._attentionInfoModel},getLoginBonusId:function(){return null==this._eventData&&window.alert("[UnionRaidModel::getLoginBonus]\nYou must call prepare first!"),this._eventData.login_bonus&&this._eventData.login_bonus.login_bonus_id},getLoginBonusItemId:function(){return null==this._eventData&&window.alert("[UnionRaidModel::getLoginBonusItemId]\nYou must call prepare first!"),this._eventData.login_bonus&&this._eventData.login_bonus.item_id},getLoginBonusItemName:function(){return null==this._eventData&&window.alert("[UnionRaidModel::getLoginBonusItemName]\nYou must call prepare first!"),this._eventData.login_bonus&&this._eventData.login_bonus.item_name},isReceivableLoginBonus:function(){return null==this._eventData&&window.alert("[UnionRaidModel::isReceivableLoginBonus]\nYou must call prepare first!"),!!this._eventData.login_bonus&&!this._eventData.login_bonus.confirmed},receiveLoginBonus:function(){return null==this._eventData&&window.alert("[UnionRaidModel::receiveLoginBonus]\nYou must call prepare first!"),t.createInstance("apiAEvents").receiveUnionRaidLoginBonus(this.getEventId(),this.getLoginBonusId()).fail(function(e){console.warn(e.stack)})},isReceiveRewardEvent:function(){return null!=this._eventData&&this._eventData.is_receive_reward_event},firstAccess:function(){return null==this._eventData&&window.alert("[UnionRaidModel::access]\nYou must call prepare first!"),this._eventData.first_access?Q.resolve({body:{}}):t.createInstance("apiAEvents").firstAccessUnionRaid(this.getEventId()).fail(function(e){console.warn(e.stack)})}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;t.unionraid=t.unionraid||{},t.unionraid.model=t.unionraid.model||{},t.unionraid.model.UnionRaidMaster=n.Class.extend({_promise:null,prepare:function(e){return null==e&&(e=t.pc.unionraid.roles.TemporaryRouterParams._getEventId()),this._getUnionRaidMasterPromise(e).then(function(e){return this._eventData=e.body,this}.bind(this))},_getUnionRaidMasterPromise:function(e){return this._promise=this._promise||t.createInstance("apiEvents").getUnionRaid(e).fail(function(e){console.warn(e)}),this._promise},getEventId:function(){return null==this._eventData&&window.alert("[UnionRaidMasterModel::getEventId]\nYou must call prepare first!"),this._eventData.event_id},getDescriptionImages:function(){return null==this._eventData&&window.alert("[UnionRaidMasterModel::getDescriptionImages]\nYou must call prepare first!"),this._eventData.description_images||[]},getBuffEffectItem:function(){var e=i.assign({amount:0},this._eventData.basic_info.buff_effect_item);return t.createInstance("UnionRaidBuffEffectItemModel",[e])},getUnionRaidType:function(){return null==this._eventData&&window.alert("[UnionRaidMasterModel::getDescriptionImages]\nYou must call prepare first!"),this._eventData.basic_info.union_raid_type},isReceiveReward:function(){return this._eventData.event_type.indexOf("_receive_reward")>0}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e._,t.unionraid=t.unionraid||{},t.unionraid.model=t.unionraid.model||{},t.unionraid.model.UnionRaidNotice=n.Class.extend({prepare:function(e){return this._prepareUnionRaidNotice(e).then(function(e){return this._eventData=e.body,this._attentionInfo=t.createInstance("UnionRaidAttentionInfoModel",[this._eventData.attention_info]),this}.bind(this))},_prepareUnionRaidNotice:function(e){return t.createInstance("apiAEvents").getUnionRaidNotice(e).fail(function(e){console.warn(e.stack)})},getAEventId:function(){return null==this._eventData&&window.alert("[UnionRaidNoticeModel::getAEventId]\nYou must call prepare first!"),this._eventData.a_event_id},getEventId:function(){return null==this._eventData&&window.alert("[UnionRaidNoticeModel::getEventId]\nYou must call prepare first!"),this._eventData.event_id},getAttentionInfo:function(){return null==this._attentionInfo&&window.alert("[UnionRaidNoticeModel::getAttentionInfo]\nYou must call prepare first!"),this._attentionInfo},isFirstAccess:function(){return null==this._eventData&&window.alert("[UnionRaidNoticeModel::isFirstAccess]\nYou must call prepare first!"),this._eventData.first_access},firstAccess:function(){return null==this._eventData&&window.alert("[UnionRaidNoticeModel::firstAccess]\nYou must call prepare first!"),t.createInstance("apiAEvents").firstAccessUnionRaidNotice(this.getEventId()).fail(function(e){console.warn(e.stack)})}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;t.unionraid=t.unionraid||{},t.unionraid.model=t.unionraid.model||{},t.unionraid.model.UnionRaidNoticeMaster=n.Class.extend({_promise:null,prepare:function(e){return this._prepareUnionRaidNoticeMaster(e).then(function(e){return this._eventData=e.body,this}.bind(this))},_prepareUnionRaidNoticeMaster:function(e){return this._promise=this._promise||t.createInstance("apiEvents").getUnionRaidNotice(e).fail(function(e){console.warn(e.stack)}),this._promise},getEventId:function(){return null==this._eventData&&window.alert("[UnionRaidNoticeMasterModel::getEventId]\nYou must call prepare first!"),this._eventData.event_id},getDescriptionImages:function(){return null==this._eventData&&window.alert("[UnionRaidNoticeMasterModel::getDescriptionImages]\nYou must call prepare first!"),this._eventData.description_images||[]},getBuffEffectItem:function(){var e=i.assign({amount:0},this._eventData.basic_info.buff_effect_item);return t.createInstance("UnionRaidBuffEffectItemModel",[e])},getUnionRaidType:function(){return null==this._eventData&&window.alert("[UnionRaidMasterModel::getDescriptionImages]\nYou must call prepare first!"),this._eventData.basic_info.union_raid_type}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e._,t.unionraid=t.unionraid||{},t.unionraid.model=t.unionraid.model||{},t.unionraid.model.BattleSituation=n.Class.extend({prepare:function(e){return this._getUnionRaidBattleSituationPromise(e).then(function(e){return this._data=e.body,this._personalContribution=t.createInstance("UnionRaidContributionPointModel",[this._data.personal_contribution]),this._unionContribution=t.createInstance("UnionRaidContributionPointModel",[this._data.union_contribution]),this._expertSubjugation=t.createInstance("UnionRaidSubjugationCountModel",[this._data.subjugation.expert]),this._ultimateSubjugation=t.createInstance("UnionRaidSubjugationCountModel",[this._data.subjugation.ultimate]),this}.bind(this))},_getUnionRaidBattleSituationPromise:function(e){return t.createInstance("apiAEvents").getUnionRaidBattleSituation(e).fail(function(e){console.warn(e.stack)})},getDayNum:function(){return null==this._data&&window.alert("[BattleSituation::getDayNum]\nYou must call prepare first!"),this._data.day_num},isPrepareDay:function(){return null==this._data&&window.alert("[BattleSituation::isPrepareDay]\nYou must call prepare first!"),this._data.is_prepare_day},hasJoinedUnion:function(){return null==this._data&&window.alert("[BattleSituation::hasJoinedUnion]\nYou must call prepare first!"),this._data.has_joined_union},canBuff:function(){return null==this._data&&window.alert("[BattleSituation::canBuff]\nYou must call prepare first!"),this._data.can_buff},getPersonalContribution:function(){return null==this._personalContribution&&window.alert("[BattleSituation::getPersonalContribution]\nYou must call prepare first!"),this._personalContribution},getUnionContribution:function(){return null==this._unionContribution&&window.alert("[BattleSituation::getUnionContribution]\nYou must call prepare first!"),this._unionContribution},getExpertSubjugation:function(){return null==this._expertSubjugation&&window.alert("[BattleSituation::getExpertSubjugation]\nYou must call prepare first!"),this._expertSubjugation},getUltimateSubjugation:function(){return null==this._ultimateSubjugation&&window.alert("[BattleSituation::getUltimateSubjugation]\nYou must call prepare first!"),this._ultimateSubjugation}})}((this||0).self||global),function(e){var t=e.kh;e.cc,e._,t.unionraid=t.unionraid||{},t.unionraid.model=t.unionraid.model||{},t.unionraid.model.SubjugationCount=t.SceneObject.extend({ctor:function(e){this._data=e},getGaugePercent:function(){if(null==this._data)throw new Error("[SubjugationCount::getGaugePercent] _data is null");return this._data.gauge_percent},getNowCount:function(){if(null==this._data)throw new Error("[SubjugationCount::getNowCount] _data is null");return this._data.now_count},getNextRewardRemainingCount:function(){if(null==this._data)throw new Error("[SubjugationCount::getNextRewardRemainingCount] _data is null");return this._data.next_reward_remaining_count}})}((this||0).self||global),function(e){var t=e.kh;e.cc,e._,t.unionraid=t.unionraid||{},t.unionraid.model=t.unionraid.model||{},t.unionraid.model.ContributionPoint=t.SceneObject.extend({ctor:function(e){this._data=e},getGaugePercent:function(){if(null==this._data)throw new Error("[ContributionPoint::getDayNum] _data is null");return this._data.gauge_percent},getNowPoint:function(){if(null==this._data)throw new Error("[ContributionPoint::getNowPoint] _data is null");return this._data.now_point},getNextRewardRemainingPoint:function(){if(null==this._data)throw new Error("[ContributionPoint::getNextRewardRemainingPoint] _data is null");return this._data.next_reward_remaining_point}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e._,t.unionraid=t.unionraid||{},t.unionraid.model=t.unionraid.model||{},t.unionraid.model.Point=n.Class.extend({prepare:function(e){return this._getUnionRaidPointPromise(e).then(function(e){return this._data=e.body,this._totalPersonalContributionPoint=this._data.total_personal_contribution_point,this._totalUnionContributionPoint=this._data.total_union_contribution_point,this._expertSubjugationCount=this._data.subjugation_count.expert,this._ultimateSubjugationCount=this._data.subjugation_count.ultimate,this}.bind(this))},_getUnionRaidPointPromise:function(e){return t.createInstance("apiAEvents").getUnionRaidPoint(e).fail(function(e){console.warn(e.stack)})},getTotalPersonalContributionPoint:function(){return null==this._totalPersonalContributionPoint&&window.alert("[Point::getTotalPersonalContributionPoint]\nYou must call prepare first!"),this._totalPersonalContributionPoint},getTotalUnionContributionPoint:function(){return null==this._totalUnionContributionPoint&&window.alert("[Point::getTotalUnionContributionPoint]\nYou must call prepare first!"),this._totalUnionContributionPoint},getExpertSubjugationCount:function(){return null==this._expertSubjugationCount&&window.alert("[Point::getExpertSubjugationCount]\nYou must call prepare first!"),this._expertSubjugationCount},getUltimateSubjugationCount:function(){return null==this._ultimateSubjugationCount&&window.alert("[Point::getUltimateSubjugationCount]\nYou must call prepare first!"),this._ultimateSubjugationCount}})}((this||0).self||global),function(e){var t=e.kh;e.cc,e._,t.unionraid=t.unionraid||{},t.unionraid.model=t.unionraid.model||{},t.unionraid.model.AttentionInfo=t.SceneObject.extend({ctor:function(e){this._data=e},getFireDismissLockStartDay:function(){if(null==this._data)throw new Error("[AttentionInfo::getFireDismissLockStartDay] _data is null");return this._data.fire_dismiss_lock_start_day}})}((this||0).self||global),function(e){var t=e.kh;e.cc,e._,t.unionraid=t.unionraid||{},t.unionraid.model=t.unionraid.model||{},t.unionraid.model.BuffEffect=t.SceneObject.extend({ctor:function(e){if(null==e)throw new Error("[kh.unionraid.model.BuffEffect] buff is null");this._buff=e},getId:function(){return this._buff&&this._buff.buff_effect_id},getName:function(){return this._buff&&this._buff.name},getLevel:function(){return this._buff&&this._buff.level},setLevel:function(e){this._buff&&(this._buff.level=e)},getMaxLevel:function(){return this._buff&&this._buff.max_level}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);t.unionraid=t.unionraid||{},t.unionraid.model=t.unionraid.model||{},t.unionraid.model.DemonBuff=t.EventSubject.extend({_buffEffects:null,EVENT_NAME:{PROPERTY_CHANGED:"property_changed"},prepare:function(e){return this._getAEventsDemonBuffPromise(e).then(function(i){return this._eventId=e,this._data=i.body,this._buffEffects=n.map(i.body.buff_effects,function(e){return t.createInstance("UnionRaidBuffEffectModel",[e])}),this}.bind(this))},_getAEventsDemonBuffPromise:function(e){return t.createInstance("apiAEvents").getUnionRaidDemonBuff(e).fail(function(e){console.warn(e.stack)})},getBuffEffects:function(){return null==this._buffEffects&&window.alert("[UnionRaidDemonBuffModel::getBuffEffects]\nYou must call prepare first!"),this._buffEffects},getTotalMaxLevel:function(){return null==this._data&&window.alert("[UnionRaidDemonBuffModel::getBuffEffects]\nYou must call prepare first!"),this._data.total_max_level},getNowTotalLevel:function(){return null==this._buffEffects&&window.alert("[UnionRaidDemonBuffModel::getNowTotalLevel]\nYou must call prepare first!"),n.reduce(this._buffEffects,function(e,t){return e+t.getLevel()},0)},findByBuffEffectId:function(e){return null==this._buffEffects&&window.alert("[UnionRaidDemonBuffModel::findByMatchId]\nYou must call prepare first!"),n.find(this._buffEffects,function(t){return t.getId()===e})},update:function(e){return null==this._buffEffects&&window.alert("[UnionRaidDemonBuffModel::update]\nYou must call prepare first!"),this._updateAEventsDemonBuff(this._eventId,e).then(function(e){return this.dispatchEvent("PROPERTY_CHANGED"),e}.bind(this))},_updateAEventsDemonBuff:function(e,n){return t.createInstance("apiAEvents").updateUnionRaidDemonBuff(e,n).fail(function(e){console.warn(e.stack)})}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);e.Q,t.unionraid=t.unionraid||{},t.unionraid.model=t.unionraid.model||{},t.unionraid.model.BuffCheckPopupParam=t.SceneObject.extend({ctor:function(){this._params=[]},setEventId:function(e){this._eventId=e},setBeforeTotalMaxLevel:function(e){this._beforeTotalMaxLevel=e},setAfterTotalMaxLevel:function(e){this._afterTotalMaxLevel=e},getBeforeTotalMaxLevel:function(){return this._beforeTotalMaxLevel},getAfterTotalMaxLevel:function(){return this._afterTotalMaxLevel},setMatchId:function(e){this._matchId=e},getEventId:function(){return this._eventId},getMatchId:function(){return this._matchId},addUseCountParam:function(e,t){this._params.push({buffEffectId:e,useCount:t})},getUseCountParams:function(){return this._params},getTotalUseCount:function(){return n.reduce(this._params,function(e,t){return e+t.useCount},0)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e._,t.unionraid=t.unionraid||{},t.unionraid.model=t.unionraid.model||{},t.unionraid.model.Item=n.Class.extend({prepare:function(e){return this._getUnionRaidItemPromise(e).then(function(e){return this._data=e.body,this._buffEffectItem=t.createInstance("UnionRaidBuffEffectItemModel",[this._data.buff_effect_item_info]),this}.bind(this))},_getUnionRaidItemPromise:function(e){return t.createInstance("apiAEvents").getUnionRaidItem(e).fail(function(e){console.warn(e.stack)})},getBuffEffectItem:function(){return null==this._data&&window.alert("[Item::getBuffEffectItem]\nYou must call prepare first!"),this._buffEffectItem}})}((this||0).self||global),function(e){var t=e.kh;e.cc,e._,t.unionraid=t.unionraid||{},t.unionraid.model=t.unionraid.model||{},t.unionraid.model.BuffEffectItem=t.SceneObject.extend({ctor:function(e){this._data=e},getId:function(){if(null==this._data)throw new Error("[BuffEffectItem::getItem] _data is null");return this._data.item_id},getName:function(){if(null==this._data)throw new Error("[BuffEffectItem::getName] _data is null");return this._data.name},getAmount:function(){if(null==this._data)throw new Error("[BuffEffectItem::getAmount] _data is null");return this._data.amount}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;t.unionraid=t.unionraid||{},t.unionraid.model=t.unionraid.model||{},t.unionraid.model.UnionRankingEvent=n.Class.extend({prepare:function(e){return this._getUnionRankingEventPromise(e).then(function(e){return this._data=e.body,this._currentRank=this._data.current_rank,this._rewardReceptDeadline=this._data.reward_recept_deadline,this._receivable=this._data.receivable,this}.bind(this))},isPrepared:function(){return!i.isUndefined(this._data)},_getUnionRankingEventPromise:function(e){return t.createInstance("apiAEvents").getUnionRaidRankingEvent(e).fail(function(e){console.warn(e.stack)})},getCurrentRank:function(e){return null==this._currentRank&&window.alert("[UnionRankingEvent::getCurrentRank]\nYou must call prepare first!"),this._currentRank[e]},getRewardReceptDeadline:function(){return null==this._rewardReceptDeadline&&window.alert("[UnionRankingEvent::getRewardReceptDeadline]\nYou must call prepare first!"),this._rewardReceptDeadline},getReceivable:function(){return null==this._receivable&&window.alert("[UnionRankingEvent::getReceivable]\nYou must call prepare first!"),this._receivable}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.unionraid=t.unionraid||{},t.unionraid.view=t.unionraid.view||{},t.unionraid.view.BattleInfo=t.SceneObject.extend({show:function(e,t,n){this._unionRaidModel=e,this._pointModel=t,this._battleSituationModel=n,this._battleSituationModel.hasJoinedUnion()?this._animateDefault():this._animateInvalid(),this._setUnionName(),this._setPersonalContributionPoint(),this._setUnionContributionPoint(),this._setExpertSubjugationCount(),this._setUltimateSubjugationCount()},_getInfoUiNode:function(){return cc.director.getRunningScene().seekWidgetByName("uniraid_info_ui")},_getMyUnionNameUi:function(){return this._getInfoUiNode().seekWidgetByName("uniraid_info_own_union_name_ui")},_getMyUnionNameLabel:function(){return this._getInfoUiNode().seekWidgetByName("own_union_name_label")},_getPersonalContributionLabel:function(){return this._getInfoUiNode().seekWidgetByName("myself_total_p_no_label")},_getUnionContributionLabel:function(){return this._getInfoUiNode().seekWidgetByName("union_total_p_no_label")},_getExpertSubjugationLabel:function(){return this._getInfoUiNode().seekWidgetByName("expert_expedition_p_no_label")},_getUltimateSubjugationLabel:function(){return this._getInfoUiNode().seekWidgetByName("ultimate_expedition_p_no_label")},_animateDefault:function(){this._getInfoUiNode().animate("default_view")},_animateInvalid:function(){this._getInfoUiNode().animate("nothing_view")},_showUnionName:function(){this._getMyUnionNameUi().setAppearance("own_union_name")},_hideUnionName:function(){this._getMyUnionNameUi().setAppearance("no_own_union_name")},_setUnionName:function(){var e=this._getMyUnionNameLabel(),t=this._unionRaidModel.getMyUnionName();null==t?this._hideUnionName():(this._showUnionName(),e.setString(t))},_setPersonalContributionPoint:function(){var e=this._getPersonalContributionLabel(),t=this._pointModel.getTotalPersonalContributionPoint();e.setString(""+t)},_setUnionContributionPoint:function(){var e=this._getUnionContributionLabel(),t=this._pointModel.getTotalUnionContributionPoint();e.setString(""+t)},_setExpertSubjugationCount:function(){var e=this._getExpertSubjugationLabel(),t=this._pointModel.getExpertSubjugationCount();e.setString(""+t)},_setUltimateSubjugationCount:function(){var e=this._getUltimateSubjugationLabel(),t=this._pointModel.getUltimateSubjugationCount();e.setString(""+t)}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.unionraid=t.unionraid||{},t.unionraid.view=t.unionraid.view||{},t.unionraid.view.Point=t.SceneObject.extend({show:function(e,t){t.hasJoinedUnion()?this._setAppearanceLabelJoinedUnion():this._setAppearanceLabelNotJoinedUnion();var n=e.getTotalPersonalContributionPoint();this._setPersonalContributionPoint(n);var i=e.getTotalUnionContributionPoint();this._setUnionContributionPoint(i);var a=e.getExpertSubjugationCount();this._setExpertSubjugationCount(a);var o=e.getUltimateSubjugationCount();this._setUltimateSubjugationCount(o)},_getTotalPersonalContributionPointLabel:function(){return cc.director.getRunningScene().seekWidgetByName("myself_total_p_no_label")},_getTotalUnionContributionPointBaseNode:function(){return cc.director.getRunningScene().seekWidgetByName("uniraid_union_total_p_no_label")},_getExpertSubjugationCountBaseNode:function(){return cc.director.getRunningScene().seekWidgetByName("uniraid_expert_expedition_p_no_label")},_getUltimateSubjugationCountBaseNode:function(){return cc.director.getRunningScene().seekWidgetByName("uniraid_ultimate_expedition_p_no_label")},_getTotalUnionContributionPointLabel:function(){return this._getTotalUnionContributionPointBaseNode().seekWidgetByName("union_total_p_no_label")},_getExpertSubjugationCountLabel:function(){return this._getExpertSubjugationCountBaseNode().seekWidgetByName("expert_expedition_p_no_label")},_getUltimateSubjugationCountLabel:function(){return this._getUltimateSubjugationCountBaseNode().seekWidgetByName("ultimate_expedition_p_no_label")},_setAppearanceLabelNotJoinedUnion:function(){this._setAppearanceLabel("nothing_view")},_setAppearanceLabelJoinedUnion:function(){this._setAppearanceLabel("default_view")},_setAppearanceLabel:function(e){var t=this._getTotalUnionContributionPointBaseNode(),n=this._getExpertSubjugationCountBaseNode(),i=this._getUltimateSubjugationCountBaseNode();null!=t&&t.setAppearance(e),null!=n&&n.setAppearance(e),null!=i&&i.setAppearance(e)},_setPersonalContributionPoint:function(e){this._getTotalPersonalContributionPointLabel().setString(""+e)},_setUnionContributionPoint:function(e){this._getTotalUnionContributionPointLabel().setString(""+e)},_setExpertSubjugationCount:function(e){this._getExpertSubjugationCountLabel().setString(""+e)},_setUltimateSubjugationCount:function(e){this._getUltimateSubjugationCountLabel().setString(""+e)}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.unionraid=t.unionraid||{},t.unionraid.view=t.unionraid.view||{},t.unionraid.view.AttentionInfoPopup=t.ImplantedPopup.extend({RAID_BOSS_NAMES:function(e,t){return e[t.DEMON]="",e[t.SERAPH]="",e}({},t.unionraid.enums.UNION_RAID_TYPE),_initContents:function(e,t){var n=t.getBuffEffectItem();this.setButtonEvents({btn_popup_close:!0});var i=(this.getNode(),e.getFireDismissLockStartDay()),a=this.RAID_BOSS_NAMES[t.getUnionRaidType()],o=n.getName(),r=this._createMessage(i,a,o);this._setMessage(r)},_getAttentionNode:function(){return cc.director.getRunningScene().seekWidgetByName("uniraid_attention")},_getLabelNode:function(){return this._getAttentionNode().seekWidgetByName("attention_yellow_label")},_setMessage:function(e){this._getLabelNode().setString(e)},_createMessage:function(e,t,n){return["{lock_start_date}000","","","","P","{major_raid_boss}","","{item_name}","{major_raid_boss}","500Lv","","","P",""].join("\n").replace("{lock_start_date}",e).replace(/{major_raid_boss}/g,t).replace(/{item_name}/g,n)}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.unionraid=n.unionraid||{},n.unionraid.view=n.unionraid.view||{},n.unionraid.view.Background=n.SceneObject.extend({ctor:function(e,n){this._backgroundName="uniraid-bg"+t.padZero(e,3),this._eventId=n},show:function(){var e=this._getBackgroundNode(this._backgroundName),i=n.Img(this._backgroundName,"event",t.padZero(this._eventId,4)).jpg;e.loadTexture(i)},_getBackgroundNode:function(e){return cc.director.getRunningScene().seekWidgetByName(e)}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.unionraid=n.unionraid||{},n.unionraid.view=n.unionraid.view||{},n.unionraid.view.RewardReceiveBtn=n.SceneObject.extend({show:function(e){var n=e.getExchangeableRewards();t.isEmpty(n)?this._animateDefault():this._animateReceivable()},_getBtnNode:function(){return cc.director.getRunningScene().seekWidgetByName("uniraid_btn_interchange_ui")},_animateDefault:function(){this._getBtnNode().animate("default_view")},_animateReceivable:function(){this._getBtnNode().animate("attention_view")}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.unionraid=n.unionraid||{},n.unionraid.view=n.unionraid.view||{},n.unionraid.view.RankingRewardBtn=n.SceneObject.extend({nodeName:"btn_ranking",show:function(e,n){t.isUndefined(n)||(this.nodeName=n),this._changeInfoIcon(e.hasRewardInfo())},_getBtnNode:function(){return cc.director.getRunningScene().seekWidgetByName(this.nodeName)},_changeInfoIcon:function(e){this._getBtnNode().seekWidgetByName("info_icon").setVisible(e)}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.unionraid=n.unionraid||{},n.unionraid.view=n.unionraid.view||{},n.unionraid.view.BuffUsePopup=n.ImplantedPopup.extend({_useBuffItemCount:0,_initContents:function(e){this._allModelPromise(e).spread(function(e,t){this._useBuffItemCount=0,this._updateBuffEffectItemLabel(),this._updateTotalBuffLevel(),this._updatePopupParams(),this._updateUseBtn(),n.createInstance("BuffUsePopupItemView").show(this.getNode(),t.getBuffEffectItem())}.bind(this)),this.setButtonEvents({btn_use:this._use.bind(this,e),btn_cancel:!0})},_allModelPromise:function(e){var t=this._prepareUnionEventMatchesBuffEffects(e),n=this._prepareUnionEventInventory(e);return Q.all([t,n])},_updatePopupParams:function(){this._useBuffItemCount=0;var e=this._getUnionRaidDemonBuffModel(),n=e.getBuffEffects();t.each(n,function(t,n){this._setNowLv(n,t);var i=this._getPulldownConditionSelectableCount(0,t,e),a=this._createPulldownCondition(0,i);this._setPulldown(n,t,a)},this)},_getUnionRaidDemonBuffModel:function(){return n.createInstance("unionRaidDemonBuffModel")},_prepareUnionEventMatchesBuffEffects:function(e){return this._getUnionRaidDemonBuffModel().prepare(e)},_getUnionRaidItemModel:function(){return n.createInstance("unionRaidItemModel")},_prepareUnionEventInventory:function(e){if(!this._itemModelPreparePromise){var t=this._getUnionRaidItemModel();this._itemModelPreparePromise=t.prepare(e)}return this._itemModelPreparePromise},_getBuffEffectItemName:function(){return this._getUnionRaidItemModel().getBuffEffectItem().getName()},_getBuffEffectItemAmount:function(){return this._getUnionRaidItemModel().getBuffEffectItem().getAmount()},_getBuffEffectTotalMaxLevel:function(){return this._getUnionRaidDemonBuffModel().getTotalMaxLevel()},_getBuffEffectNowTotalLevel:function(){return this._getUnionRaidDemonBuffModel().getNowTotalLevel()},_updateUseBtn:function(){var e=this._getUseBtnNode();0===this._useBuffItemCount?(e.setColor(cc.color("#808080")),e.setEnabled(!1)):(e.setColor(cc.color("#FFFFFF")),e.setEnabled(!0))},_updateTotalBuffLevel:function(){var e=this._getBuffEffectNowTotalLevel(),t=this._getBuffEffectTotalMaxLevel(),n=this._getTotalLevelLabel(),i=this._useBuffItemCount+e;n.setString(""+i),i<t?this._setAppearanceBuffUseDefault():this._setAppearanceBuffUseMax()},_updateBuffEffectItemLabel:function(){var e,t=this._getBuffEffectItemAmount(),i=this._getBuffUseNode();e=0===this._useBuffItemCount?this._createBuffItemAmountLabelMessage(t):this._createBuffItemUseAmountLabelMessage(t,this._useBuffItemCount),i.setHtmlStrings({have_item_labelimg:e},n.GameConfig.POPUP_CSS)},_createBuffItemAmountLabelMessage:function(e){return"<span class='white'>"+e+"</span>"},_createBuffItemUseAmountLabelMessage:function(e,t){return"<span class='white'>"+e+"&nbsp;&nbsp;</span><span class='red'>"+(e-t)+"</span>"},_setNowLv:function(e,t){var n=this._getLevelLabelNode(e),i=t.getLevel();n.setString("Lv"+i),this._animationMaxLv(e,t)},_animationMaxLv:function(e,t){var n=this._getLevelUiNode(e),i=t.getLevel()===t.getMaxLevel();n.animate(i?"level_max":"level_now")},_setPulldown:function(e,t,i){this._releasePulldownListMenu(e),this._pulldownList=this._pulldownList||[],this._pulldownList[e]=new n.Pulldown({button:this._getBtnPulldown(e),label:this._getPulldownLabel(e),menuBase:!0,choice:!0,bottomMargin:0},i);var a=this._pulldownList[e];a.setTouchEnabled(!0),a.onChange(function(){Q.delay(10).then(function(){this._updateUseBuffItemCount(),this._updatePulldownCondition(),this._updateBuffEffectItemLabel(),this._updateTotalBuffLevel(),this._updateUseBtn()}.bind(this))},this),this._setEnablePulldown(e,t)},_createPulldownCondition:function(e,n){var i=this.__createPulldownCondition(n),a=t.find(i,function(t){return t.value===e});return a?a.selected=!0:i[0].selected=!0,i},__createPulldownCondition:function(e){return t.map(t.range(e+1),function(e){return{value:e,text:""+e}})},_getPulldownConditionSelectableCount:function(e,t,n){var i=this._getBuffEffectItemAmount()-(this._useBuffItemCount-e),a=t.getLevel(),o=t.getMaxLevel(),r=(i=o-a<i?o-a:i,n.getNowTotalLevel()),s=n.getTotalMaxLevel(),c=this._useBuffItemCount-e;s<=c+i+r&&(i=s-(c+r));return i},_setEnablePulldown:function(e,t){var n=t.getLevel()===t.getMaxLevel(),i=this._getPulldownUiNode(e),a=this._isSelectableNumberNone(e);n||a?(i.setColor(cc.color("#808080")),i.setEnabled(!1)):(i.setColor(cc.color("#FFFFFF")),i.setEnabled(!0))},_isSelectableNumberNone:function(e){var n=this._pulldownList[e];return 1===t.keys(n.cachedChoice).length&&0===n.cachedChoice[0].value},_use:function(e){var i=n.createInstance("UnionRaidBuffCheckPopupParam"),a=this._getUnionRaidDemonBuffModel().getBuffEffects();t.each(a,function(e,t){var n=this._pulldownList[t].selected;i.addUseCountParam(e.getId(),n.value)},this);var o=this._getBuffEffectNowTotalLevel(),r=this._useBuffItemCount+o;i.setBeforeTotalMaxLevel(o),i.setAfterTotalMaxLevel(r),i.setEventId(e),this._updateDemonBuffEffects(i).then(function(e){var t=e.body.result;"success"===t||"success_overlap"===t?n.createInstance("UniRaid002PopupInvoker").openBuffResultPopup(i):this._showErrorResultPopup(t)}.bind(this))},_updateDemonBuffEffects:function(e){var t=this._getUnionRaidDemonBuffModel(),n=this._getUpdateBuffEffects(e);return t.update(n)},_getUpdateBuffEffects:function(e){var n=e.getUseCountParams();return t.map(n,function(e){var t=this._getBuffEffectModelByBuffEffectId(e.buffEffectId),n=e.useCount+t.getLevel();return{buff_effect_id:e.buffEffectId,level:n}}.bind(this))},_getBuffEffectModelByBuffEffectId:function(e){return this._getUnionRaidDemonBuffModel().findByBuffEffectId(e)},_showErrorResultPopup:function(e){var i={item_shortage:"openBuffErrorShortagePopup",battle_finished:"openBuffErrorBattleFinishedPopup",level_max:"openBuffErrorLimitedPopup",total_level_max:"openBuffErrorLimitedPopup",permission_denied:"openBuffErrorLimitedPopup"},a=n.createInstance("UniRaid002PopupInvoker");return"item_shortage"==e?void this._prepareUnionEventInventory().then(function(e){a.openBuffErrorShortagePopup(e.getBuffEffectItem())}):void(t.isUndefined(i[e])||a[i[e]]())},_releasePulldownListMenu:function(){if(null!=this._pulldownList){var e=arguments[0];if(void 0===e)t.each(this._pulldownList,function(e){e.releaseMenu()}.bind(this));else{var n=this._pulldownList[e];if(null==n)return;n.releaseMenu()}}},_updateUseBuffItemCount:function(){this._useBuffItemCount=t.reduce(this._pulldownList,function(e,t,n){return t.selected.value+e},0)},_updatePulldownCondition:function(){var e=this._getUnionRaidDemonBuffModel(),n=e.getBuffEffects();t.isArray(this._pulldownList)&&t.isArray(n)&&this._pulldownList.length===n.length&&t.each(n,function(t,n){var i=this._pulldownList[n],a=this._getPulldownConditionSelectableCount(i.selected.value,t,e),o=this._createPulldownCondition(i.selected.value,a);this._setPulldown(n,t,o)},this)},_getBuffUseNode:function(){return cc.director.getRunningScene().seekWidgetByName("unievent_buff_use")},_getUseBtnNode:function(){return this._getBuffUseNode().seekWidgetByName("btn_use")},_getLevelUiNode:function(e){return this._getBuffUseNode().seekWidgetByName("unievent_buff_use_level_ui_"+e)},_getLevelLabelNode:function(e){return this._getLevelUiNode(e).seekWidgetByName("level_label")},_getBtnPulldown:function(e){return this._getLevelUiNode(e).seekWidgetByName("btn_sort")},_getPulldownLabel:function(e){return this._getLevelUiNode(e).seekWidgetByName("sort_label")},_getPulldownUiNode:function(e){return this._getLevelUiNode(e).seekWidgetByName("unievent_sort_ui")},_getTotalLevelLabel:function(){return this._getBuffUseNode().seekWidgetByName("total_level_label")},_getCrossItemCorecard:function(){return this._getBuffUseNode().seekWidgetByName("corecard_item")},_setAppearanceBuffUseDefault:function(){var e=this._getBuffUseNode();e&&e.setAppearance("total_level_not_max")},_setAppearanceBuffUseMax:function(){var e=this._getBuffUseNode();e&&e.setAppearance("total_level_max")}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.unionraid=n.unionraid||{},n.unionraid.view=n.unionraid.view||{},n.unionraid.view.BuffCheckPopup=n.ImplantedPopup.extend({_initContents:function(e){this._popupParam=e,this._eventId=this._popupParam.getEventId(),this._useCount=this._popupParam.getTotalUseCount(),this._allModelPromise().spread(function(e,t){this._setBuffEffectItemLabelImage(),this._setPopupParams(),this._setTotalMaxLevel(),n.createInstance("BuffCheckPopupItemView").show(this.getNode(),t.getBuffEffectItem())}.bind(this)),this.setButtonEvents({btn_ok:this._okBtnCallback.bind(this)})},_okBtnCallback:function(){this.dismiss()},_allModelPromise:function(){var e=this._prepareUnionRaidDemonBuff(this._eventId),t=this._prepareUnionRaidInventory(this._eventId);return Q.all([e,t])},_setBuffEffectItemLabelImage:function(){var e=this._getBuffEffectItemAmount();this._getBuffResultNode().setHtmlStrings({have_item_labelimg:this._createBuffItemMessage(e,this._useCount)},n.GameConfig.POPUP_CSS)},_createBuffItemMessage:function(e,t){return"<span class='white'>"+(e+t)+"&nbsp;&nbsp;</span><span class='red'>"+e+"</span>"},_setPopupParams:function(){t.each(this._popupParam.getUseCountParams(),function(e,t){this._setLevel(t,e)},this)},_setLevel:function(e,t){var i=this._getBuffEffectModelByBuffEffectId(t.buffEffectId),a=i.getLevel()-t.useCount,o=i.getLevel(),r=this._getLevelUiNodeByIndex(e);i.getLevel()===i.getMaxLevel()?(this._setMaxLevel(e,o),r.animate("level_max")):r.setHtmlStrings({level_labelimg:this._createLevelMessage(a,o)},n.GameConfig.POPUP_CSS)},_createLevelMessage:function(e,t){return"<span class='white'>Lv"+e+"&nbsp;&nbsp;</span><span class="+(e!==t?"yellow":"white")+">Lv"+t+"</span>"},_setMaxLevel:function(e,t){this._getLevelLabelByIndex(e).setString("Lv"+t)},_setTotalMaxLevel:function(){var e=this._popupParam.getBeforeTotalMaxLevel(),t=this._popupParam.getAfterTotalMaxLevel();this._getBuffResultNode().setHtmlStrings({total_level_labelimg:this._createTotalMaxLevelMessage(e,t)},n.GameConfig.POPUP_CSS)},_createTotalMaxLevelMessage:function(e,t){return"<span class='white'>Lv"+e+"&nbsp;&nbsp;</span><span class='yellow'>Lv"+t+"</span>"},_getUnionRaidDemonBuffModel:function(){return n.createInstance("unionRaidDemonBuffModel")},_prepareUnionRaidDemonBuff:function(e){return this._getUnionRaidDemonBuffModel().prepare(e)},_getUnionRaidItemModel:function(){return n.createInstance("unionRaidItemModel")},_prepareUnionRaidInventory:function(e){return this._getUnionRaidItemModel().prepare(e)},_getBuffEffectItemName:function(){return this._getUnionRaidItemModel().getBuffEffectItem().getName()},_getBuffEffectItemAmount:function(){return this._getUnionRaidItemModel().getBuffEffectItem().getAmount()},_getBuffEffects:function(){return this._getUnionRaidDemonBuffModel().getBuffEffects()},_getBuffEffectModelByBuffEffectId:function(e){return this._getUnionRaidDemonBuffModel().findByBuffEffectId(e)},_getPopupUiNode:function(){return cc.director.getRunningScene().seekWidgetByName("popup_ui")},_getBuffResultNode:function(){return this._getPopupUiNode().seekWidgetByName("unievent_buff_result")},_getLevelUiNodeByIndex:function(e){return this._getBuffResultNode().seekWidgetByName("unievent_buff_result_level_ui_"+e)},_getLevelLabelImgByIndex:function(e){return this._getLevelUiNodeByIndex(e).seekWidgetByName("level_labelimg")},_getLevelLabelByIndex:function(e){return this._getLevelUiNodeByIndex(e).seekWidgetByName("level_label")},_getBuffItemLabelImg:function(){return this._getBuffResultNode().seekWidgetByName("have_item_labelimg")}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.unionraid=t.unionraid||{},t.unionraid.view=t.unionraid.view||{},t.unionraid.view.BuffSuccessPopup=t.ImplantedPopup.extend({_initContents:function(){this.setButtonEvents({btn_popup_close:!0})}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.unionraid=t.unionraid||{},t.unionraid.view=t.unionraid.view||{},t.unionraid.view.BuffErrorShortagePopup=t.ImplantedPopup.extend({LABEL_NAME:"main_label",TEXT_TEMPLATE:"{item_name}",_initContents:function(e){var t=this.getNode().seekWidgetByName(this.LABEL_NAME),n=this.TEXT_TEMPLATE.replace("{item_name}",e.getName());t.setText(n),this.setButtonEvents({btn_popup_close:!0})}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.unionraid=t.unionraid||{},t.unionraid.view=t.unionraid.view||{},t.unionraid.view.BuffErrorBattleFinishedPopup=t.ImplantedPopup.extend({_initContents:function(){this.setButtonEvents({btn_popup_close:!0})}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.unionraid=t.unionraid||{},t.unionraid.view=t.unionraid.view||{},t.unionraid.view.BuffErrorLimitedPopup=t.ImplantedPopup.extend({_initContents:function(){this.setButtonEvents({btn_popup_close:!0})}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.unionraid=t.unionraid||{},t.unionraid.view=t.unionraid.view||{},t.unionraid.view.LoginBonusPopup=t.ImplantedPopup.extend({_initContents:function(){this.setButtonEvents({btn_popup_close:!0})}})}((this||0).self||global),function(e){var t=e.kh,n=e.console;t.unionraid=t.unionraid||{},t.unionraid.view=t.unionraid.view||{},t.unionraid.view.UnionChatButton=t.SceneObject.extend({WIDGET_NAME:"uniraid_btn_unionchat_ui",APPEARANCE_NAMES:{HIDE_BUTTON:"btn_off",HIDE_ICON_ONLY:"new_off",SHOW_ALL:"new_on"},ctor:function(){this._buttonNode=this._getButtonNode()},show:function(e){return null==e?(this._hideButton(),Q.resolve()):this._handleNewIconVisibility()},_getButtonNode:function(){return cc.director.getRunningScene().seekWidgetByName(this.WIDGET_NAME)},_hideButton:function(){this._setButtonAppearance(this.APPEARANCE_NAMES.HIDE_BUTTON)},_handleNewIconVisibility:function(){return this._getApiAUnionsNewInfoPromise().then(this._changeIconVisibilityByNewInfo.bind(this))},_getApiAUnionsNewInfoPromise:function(){return t.createInstance("apiAUnions").getNewInfo().fail(function(e){n.error(e&&e.stack?e.stack:e)})},_changeIconVisibilityByNewInfo:function(e){this._setNewIconVisible(e.body.is_new_chat)},_setNewIconVisible:function(e){var t=[this.APPEARANCE_NAMES.HIDE_ICON_ONLY,this.APPEARANCE_NAMES.SHOW_ALL][e?1:0];this._setButtonAppearance(t)},_setButtonAppearance:function(e){return null==this._buttonNode?void n.warn("KHUnionChatButton._setButtonAppearance: button node with the name '"+this.WIDGET_NAME+"' not found."):void this._buttonNode.setAppearance(e)}})}((this||0).self||global),function(e){var t=e.kh,n=e._;e.cc,e.ccui,t.createNameSpaceIfNotExists("pc.unionraid.view"),t.pc.unionraid.view.AQ003RankingPopup=t.ImplantedPopup.extend({_initContents:function(e){try{this.setButtonEvents({btn_close:!0}),this._fillRankingList(e),this._fillEmptyRankingList(e)}catch(e){console.error(e)}},_fillRankingList:function(e){var i=t.createInstance("AQ003RankingPopupPlayer");n.each(e,function(e,t){var n=this._getRankingWidgetByIndex(t),a=t+1;i.fill(n,e,a)}.bind(this))},_fillEmptyRankingList:function(e){for(var t=e.length;;t++)try{this._getRankingWidgetByIndex(t).setAppearance("hide")}catch(e){break}},_getRankingWidgetByIndex:function(e){var t=Math.floor(e/3),n=e%3,i=this._getWidget("ranking_list_"+t),a=this._getWidget("player_"+n,i);this._showWidget(i),this._showWidget(a);var o="ranking_list_"+t+"..player_"+n,r=this._getWidget(o);if(!r)throw new Error("widget by idx: not found: "+o);return r},_showWidget:function(e){e&&e.setAppearance("show")},_getWidget:function(e,t){if(t||(t=this.getNode()),!t)throw new Error("ImplantedPopup#getNode is null");var n=t.seekWidgetByPath(e);if(!n)throw new Error("widget not found: "+e);return n}})}((this||0).self||global),function(e){var t=e.kh,n=e._,i=e.cc;t.createNameSpaceIfNotExists("pc.unionraid.view"),t.pc.unionraid.view.AQ003RankingPopup.Player=i.Class.extend({fill:function(e,t,n){this._showJobIcon(e,t),this._showElementIcon(e,t),this._showTopPlayerIconIfTop3(e,n),this._showMeIconIfMe(e,t),this._showDownIconIfDown(e,t),this._showPlayerName(e,t)},_showJobIcon:function(e,i){var a=t.img("iconcircle_job",n.padZero(i.job_id,4),i.job_skin).png,o=this._getWidget("player_job_img",e);this._loadLocalTextureAndShow(o,a)},_showElementIcon:function(e,t){var n="core/res/icon/elementicon_"+t.element_type+".png",i=this._getWidget("element_icon",e);this._loadPlistTextureAndShow(i,n)},_showTopPlayerIconIfTop3:function(e,t){if(!(3<t)){var n={1:"../core/res/popup/popup_layer/ranking_first.png",2:"../core/res/popup/popup_layer/ranking_second.png",3:"../core/res/popup/popup_layer/ranking_third.png"}[t],i=this._getWidget("ranking_icon",e);this._loadLocalTextureAndShow(i,n)}},_showMeIconIfMe:function(e,t){if(t.is_mine){var n=this._getWidget("my_player_label",e);this._showWidget(n)}},_showDownIconIfDown:function(e,t){var n=this._getWidget("down_icon",e);return t.is_down?void this._showWidget(n):void n.setAppearance("hide")},_showPlayerName:function(e,t){t.player_name&&this._getWidget("player_name_label",e).setString(t.player_name)},_loadPlistTextureAndShow:function(e,t){this._loadPlistTexture(e,t),this._showWidget(e)},_loadLocalTextureAndShow:function(e,t){this._loadLocalTexture(e,t),this._showWidget(e)},_showWidget:function(e){e&&e.setAppearance("show")},_loadPlistTexture:function(e,t){e&&e.loadTexture(t,ccui.Widget.PLIST_TEXTURE)},_loadLocalTexture:function(e,t){e&&e.loadTexture(t,ccui.Widget.LOCAL_TEXTURE)},_getWidget:function(e,t){if(t||(t=i.director.getRunningScene()),!t)throw new Error("ImplantedPopup#getNode is null");var n=t.seekWidgetByPath(e);if(!n)throw new Error("widget not found: "+e);return n}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.unionraid=t.unionraid||{},t.unionraid.view=t.unionraid.view||{},t.unionraid.view.UniraidRankiginfoPopup=t.ImplantedPopup.extend({RANKING_TYPE_TO_GAME_DESCRIPTIONS_CATEGORY:function(e,t){return e[t.DEMON]={0:"uniraid_demon_rankinginfo_expert",1:"uniraid_demon_rankinginfo_ultimate",2:"uniraid_demon_rankinginfo_individual"},e[t.SERAPH]={0:"uniraid_seraph_rankinginfo_expert",1:"uniraid_seraph_rankinginfo_ultimate",2:"uniraid_seraph_rankinginfo_individual"},e}({},t.unionraid.enums.UNION_RAID_TYPE),_initContents:function(e,n){this._clear(),this.setButtonEvents({btn_close:!0});var i=this.RANKING_TYPE_TO_GAME_DESCRIPTIONS_CATEGORY[n][e];t.createInstance("gameDescriptionsRepository").import(i).then(this._display.bind(this))},_clear:function(){this._getTitleNode().setString(""),this._getRuleNode().setString("")},_display:function(e){var t=e.contents;this._getTitleNode().setString(t.header),this._getRuleNode().setString(t.content)},_getTitleNode:function(){return this.getNode().seekWidgetByName("rank_title_label")},_getRuleNode:function(){return this.getNode().seekWidgetByName("rank_rule_label")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("unionraid.eventHandling"),t.unionraid.eventHandling.RuleButtonTouchEventHandler=n.Class.extend({className:"RuleButtonTouchEventHandler",ctor:function(){},handle:function(e,i){var a=n.director.getRunningScene();t.ImplantedPopup.createOrGet(a,"uniraid_rankinginfo","UniraidRankiginfoPopup").open(e,i)}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.unionraid=t.unionraid||{},t.unionraid.factory=t.unionraid.factory||{},t.unionraid.factory.UniRaid000Interrupts=t.SceneObject.extend({create:function(e,n){return[t.createInstance("UnionRaidSubTutorialInterrupt",["uniraid_000",n,e]),t.createInstance("UnionRaid000AttentionInfoInterrupt",[e])]}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.unionraid=t.unionraid||{},t.unionraid.factory=t.unionraid.factory||{},t.unionraid.factory.UniRaid001Interrupts=t.SceneObject.extend({create:function(e,n){var i=t.createInstance("UnionRaidLoginBonusInterrupt",[e]);return[t.createInstance("UnionRaidSubTutorialInterrupt",["uniraid_001",n,e]),i,t.createInstance("UnionRaid001AttentionInfoInterrupt",[e])]}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;t.unionraid=t.unionraid||{},t.unionraid.interrupt=t.unionraid.interrupt||{},t.unionraid.interrupt.SubTutorial=n.Class.extend(i.assign(t.ISceneInterrupt,{ctor:function(e,t,n){this._pageName=e,this._pageNum=t,this._eventId=n},playable:function(){var e=this._pageName+"_"+this._eventId;return this._prepareSubTutorialModel(e).then(function(e){return!e.hasVisited()}.bind(this))},_prepareSubTutorialModel:function(e){return t.createInstance("subTutorialPageModel").prepare(e)},play:function(){return this._openSubTutorial(this._eventId,this._pageNum).then(function(){return t.createInstance("subTutorialPageModel").visit()})},_openSubTutorial:function(e,i){var a=n.director.getRunningScene();return t.ImplantedPopup.createOrGet(a,"sub_tutorial","ImplantedEventSubTutorialPopup").open(e,i)}}))}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;t.unionraid=t.unionraid||{},t.unionraid.interrupt=t.unionraid.interrupt||{},t.unionraid.interrupt.UniEvent000AttentionInfo=n.Class.extend(i.assign(t.ISceneInterrupt,{ctor:function(e){this._eventId=e},playable:function(){return this._prepareUnionRaidNoticeModel().then(function(){return t.createInstance("unionRaidNoticeModel").isFirstAccess()})},_prepareUnionRaidNoticeModel:function(){return t.createInstance("unionRaidNoticeModel").prepare(this._eventId)},_prepareUnionRaidNoticeMasterModel:function(){return t.createInstance("unionRaidNoticeMasterModel").prepare(this._eventId)},play:function(){return this._showAttentionPopup().then(function(){return t.createInstance("unionRaidNoticeModel").firstAccess()})},_showAttentionPopup:function(){return this._prepareUnionRaidNoticeMasterModel().then(function(e){var i=t.createInstance("unionRaidNoticeModel"),a=n.director.getRunningScene();return t.ImplantedPopup.createOrGet(a,"uniraid_attention","UnionRaidAttentionInfoPopup").open(i.getAttentionInfo(),e)})}}))}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;t.unionraid=t.unionraid||{},t.unionraid.interrupt=t.unionraid.interrupt||{},t.unionraid.interrupt.UniEvent001AttentionInfo=n.Class.extend(i.assign(t.ISceneInterrupt,{ctor:function(e){this._eventId=e},playable:function(){return this._prepareUnionRaidModel().then(function(){return t.createInstance("unionRaidModel").isFirstAccess()})},_prepareUnionRaidModel:function(){return t.createInstance("unionRaidModel").prepare(this._eventId)},_prepareUnionRaidMasterModel:function(){return t.createInstance("unionRaidMasterModel").prepare(this._eventId)},play:function(){return this._showAttentionPopup().then(function(){return t.createInstance("unionRaidModel").firstAccess()})},_showAttentionPopup:function(){return this._prepareUnionRaidMasterModel().then(function(e){var i=t.createInstance("unionRaidModel"),a=n.director.getRunningScene();return t.ImplantedPopup.createOrGet(a,"uniraid_attention","UnionRaidAttentionInfoPopup").open(i.getAttentionInfo(),e)})}}))}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;t.unionraid=t.unionraid||{},t.unionraid.interrupt=t.unionraid.interrupt||{},t.unionraid.interrupt.LoginBonus=n.Class.extend(i.assign(t.ISceneInterrupt,{ctor:function(e){this._eventId=e},playable:function(){return this._prepareUnionRaidModel(this._eventId).then(function(e){return e.isReceivableLoginBonus()})},play:function(){return this._prepareUnionRaidModel(this._eventId).then(function(e){return e.receiveLoginBonus().then(function(){return this._showLoginBonusPopup()}.bind(this))}.bind(this))},_showLoginBonusPopup:function(){return t.createInstance("UniRaid001PopupInvoker").openLoginBonusPopup()},_prepareUnionRaidModel:function(e){var n=t.createInstance("unionRaidModel");return n.prepare(e).thenResolve(n)}}))}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e._,e.Q,t.pc.unionraid=t.pc.unionraid||{},t.pc.unionraid.roles=t.pc.unionraid.roles||{},t.pc.unionraid.roles.TemporaryRouterParams={_getEventId:function(){var e=n.director.getRunningScene(),i=e.temporaryRouterParams.event_id;return null==i&&(i=e.routerParams.event_id,t.createInstance("router").permanentlyRemoveRouterParam("event_id"),e.temporaryRouterParams.event_id=i),i},_getSelectedTab:function(){return n.director.getRunningScene().temporaryRouterParams.selectedTab}}}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);e.Q,t.pc.unionraid=t.pc.unionraid||{},t.pc.unionraid.roles=t.pc.unionraid.roles||{},t.pc.unionraid.roles.UnionRaidLilimListController=t.pc.unionraid.roles.UnionRaidLilimListController||{},n.assign(t.pc.unionraid.roles.UnionRaidLilimListController,t.pc.quest.roles.QuestMainPageListController),t.pc.unionraid.roles.UnionRaidLilimListController._hideList=function(e){n.each(n.range(3),function(t){var n=e.seekWidgetByName("uniraid_004_questlist_ui_"+t);null!=n&&n.setVisible(!1)})},t.pc.unionraid.roles.UnionRaidLilimListController._fillupQuestMainList=function(e,i,a){return this._tmpWidgetRecords=[],t.createInstance("apiAQuests").getListEventQuest(a).then(function(t){return n.each(t.body.data,function(t,n){var a=e.seekWidgetByName("uniraid_004_questlist_ui_"+n);null!=a&&(a.setVisible(!0),a.seekWidgetByName("questlist_base").addTouchEventListener(function(e,n){n===ccui.Widget.TOUCH_ENDED&&i.call(this,a,t)}.bind(this)),this._initFuncEventQuestPanel(a,t))}.bind(this)),t.body}.bind(this)).fail(function(e){console.error(e.stack)})},t.pc.unionraid.roles.UnionRaidLilimListController._initFuncEventQuestPanel=function(e,i){this._tmpWidgetRecords.push({widget:e,record:i});var a=n.clone(i);a.type="event";var o=t.createInstance("questInfoModel"),r=e.seekWidgetByName("queststatusicon_ui"),s=e.seekWidgetByName("img_quest_info_icon");o.isInProgressOwnQuest(i.a_quest_id,i.type)?(r.setVisible(!0),s.loadTexture("core/res/icon/queststatusicon_now.png",ccui.Widget.PLIST_TEXTURE),e.setAppearance("quest_now")):e.setAppearance("default_view"),this._initFuncQuestpanelCommon(e,a,!1)}}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;e.Q,t.pc.unionraid=t.pc.unionraid||{},t.pc.unionraid.roles=t.pc.unionraid.roles||{},t.pc.unionraid.roles.UnionRaidDemonListController=t.pc.unionraid.roles.UnionRaidDemonListController||{},i.assign(t.pc.unionraid.roles.UnionRaidDemonListController,t.pc.quest.roles.QuestRaidPageListController),t.pc.unionraid.roles.UnionRaidDemonListController._setRaidBattleListDisabled=function(e,t){!t.isPrepareDay()&&t.hasJoinedUnion()||i.each(i.range(3),function(t){var i=e.seekWidgetByName("uniraid_002_raidlist_ui_"+t);null!=i&&(i.setEnabled(!1),i.setColor(n.color("#808080")))})},t.pc.unionraid.roles.UnionRaidDemonListController._fillupRaidBattleList=function(e,a,o,r){return t.createInstance("apiABattles").getUnionRaidRequestList(o,r).then(function(t){return i.each(t.body.data,function(t,i){var o=e.seekWidgetByName("uniraid_002_raidlist_ui_"+i);if(null!==o){if(t.is_joined&&(o.setEnabled(!0),o.setColor(n.color.WHITE)),o.isEnabled())o.seekWidgetByName("quest_base").addTouchEventListener(function(e,n){n===ccui.Widget.TOUCH_ENDED&&a.call(this,o,t)}.bind(this)),this._setBalloonIconTouchEventHandler(o,t);this._initFuncRaidBattlePanelCommon(o,t)}}.bind(this)),t.body}.bind(this)).fail(function(e){console.error(e.stack)})},t.pc.unionraid.roles.UnionRaidDemonListController._setBalloonIconTouchEventHandler=function(e,n){var i=function(e){t.createInstance("UniRaid002PopupInvoker").openAQ003RankingPopup(e)};t.setTouchEventHandlers(e,{"TOUCH_ENDED btn_icon_balloon":function(){return function(e,n){return t.createInstance("apiABattles").getRanking(e,n).then(function(e){return e.body}).fail(function(e){console.error(e)})}(n.a_battle_id,n.quest_type).then(i)}})}}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);e.Q,t.pc.unionraid=t.pc.unionraid||{},t.pc.unionraid.roles=t.pc.unionraid.roles||{},t.pc.unionraid.roles.Routing={};var i={_verifyTemporaryRouterParams000:function(e){this._verifyTmporaryRouterParamsEventId(e)},_verifyTemporaryRouterParams001:function(e){this._verifyTmporaryRouterParamsEventId(e)},_navigate001To002:function(e){t.createInstance("router").navigate("unionraid/uniraid_002",{},{event_id:this._getEventId()})},_navigate001To004:function(e){t.createInstance("router").navigate("unionraid/uniraid_004",{},{event_id:this._getEventId()})},_navigate001To005:function(e){t.createInstance("router").navigate("unionraid/uniraid_005",{},{event_id:this._getEventId(),backTo:"unionraid/uniraid_001"})},_verifyTemporaryRouterParams002:function(e){this._verifyTmporaryRouterParamsEventId(e)},_navigate002To004:function(e){t.createInstance("router").navigate("unionraid/uniraid_004",{},{event_id:this._getEventId()})},_navigate002To001:function(e){t.createInstance("router").navigate("unionraid/uniraid_001",{},{event_id:this._getEventId()})},_verifyTemporaryRouterParams004:function(e){this._verifyTmporaryRouterParamsEventId(e)},_navigate004To002:function(e){t.createInstance("router").navigate("unionraid/uniraid_002",{},{event_id:this._getEventId()})},_navigate004To001:function(e){t.createInstance("router").navigate("unionraid/uniraid_001",{},{event_id:this._getEventId()})},_navigate004ToQ006:function(e){t.createInstance("router").navigate("quest/q_006")},_verifyTemporaryRouterParams005:function(e){this._verifyTmporaryRouterParamsEventId(e)},_navigate005ToEventTop:function(e,n){var i="unionraid/uniraid_001";n&&(i="unionraid/uniraid_007"),t.createInstance("router").navigate(i,{},{event_id:this._getEventId()})},_verifyTemporaryRouterParams007:function(e){this._verifyTmporaryRouterParamsEventId(e)},_navigate007To005:function(e){t.createInstance("router").navigate("unionraid/uniraid_005",{},{event_id:this._getEventId(),backTo:"unionraid/uniraid_007"})},_verifyTemporaryRouterParams009:function(e){this._verifyTmporaryRouterParamsEventId(e)},_navigate009To008:function(e){t.createInstance("router").navigate("unionraid/uniraid_008",{},{event_id:this._getEventId()})},_navigate004ToQ009:function(e,i,a){return n.isUndefined(i)||n.isUndefined(i.a_quest_id)||n.isUndefined(i.type)?void this._consoleErrorRoutingAbort("record.a_quest_id"):void t.createInstance("router").navigate("quest/q_009",{q_009:{target:"quest",quest_id:i.quest_id,owner_account_id:i.owner_account_id,event_id:this._getEventId(),quest_type:i.type,recommended_element_type:a}})},_navigateRaidBtnToQ009:function(e,i){return n.isUndefined(e)||n.isUndefined(e.a_quest_id)||n.isUndefined(e.quest_type)||n.isUndefined(e.battle_bp)?void this._consoleErrorRoutingAbort("record.a_quest_id"):void t.createInstance("router").navigate("quest/q_009",{q_009:{target:"raid",quest_id:e.quest_id,a_quest_id:e.a_quest_id,a_battle_id:e.a_battle_id,a_player_id:i,is_own_raid:e.is_own_raid,quest_type:e.quest_type,raid_boss:e.enemy_name,enemy_level:e.enemy_level,battle_bp:e.battle_bp,event_id:this._getEventId(),recommended_element_type:e.recommended_element_type,owner_account_id:e.owner_account_id}})},_navigate001ToGud001Myself:function(){t.createInstance("unionRouter").navigateToTopScene("me")},_navigate001ToGud001Other:function(e){t.createInstance("unionRouter").navigateToTopScene(e)},_verifyTmporaryRouterParamsEventId:function(e){null==e.temporaryRouterParams.event_id&&null==e.routerParams.event_id&&(t.createInstance("smartBeat").log("scene.temporaryRouterParams: "+JSON.stringify(e.temporaryRouterParams)),t.createInstance("smartBeat").log("scene.routerParams : "+JSON.stringify(e.routerParams)),console.error("event_id is null"),e.temporaryRouterParams.event_id=2001,this._consoleErrorRouterParams("temporaryRouterParams.event_id"))},_navigateToUniraid008:function(e,n){t.createInstance("router").navigate("unionraid/uniraid_008",{},{event_id:e,backTo:n})},_navigateToUniraidTop:function(e,n){t.createInstance("router").navigate(n,{},{event_id:e})},navigateUniraid005ToPrs001:function(){t.createInstance("router").navigate("present/prs_001",{},{prs_001_002_003:{eventId:this._getEventId(),returnRoute:"unionraid/uniraid_005"}})},navigateUniraid009ToPrs001:function(){t.createInstance("router").navigate("present/prs_001",{},{prs_001_002_003:{eventId:this._getEventId(),returnRoute:"unionraid/uniraid_009"}})},_navigateToMypage:function(){t.createInstance("router").navigate("mypage/my_001")},_navigateEventPage:function(){t.createInstance("router").navigate("event/ev_000")},_navigateToUnionChat:function(e){t.createInstance("router").navigate("guild/gud_008",{},e)},_navigateFromBack:function(e){t.createInstance("router").navigate(e.routes,{},e.temporaryRouterParams)}};n.assign(t.pc.unionraid.roles.Routing,t.pc.quest.roles.Routing,i)}((this||0).self||global),function(e){var t=e.kh;e.khutil,e.cc,e.ccui,e._,e.console,t.createNameSpaceIfNotExists("core.reward"),t.core.reward.RankingRewardPanel=t.core.reward.RewardPanelView.extend({className:"RankingRewardPanel",CORECARD_NODE_NAME:"corecard_ui_65",RANKING_LABEL_NAME:"item_label",PRICE_LABEL_NAME:"rank_label",PRICE_LABEL_TEXT:"{rank_from}{rank_to}",REWARD_INFORMATION_LABEL_NAME:"received_have_label",REWARD_INFORMATION_TEXT:"{itemName}x{rewardAmount}",_displayPrice:function(e){var t=this._getWidget(this.PRICE_LABEL_NAME),n=e.getRequireRank();"object"==typeof n&&(n=this.PRICE_LABEL_TEXT.replace("{rank_from}",n.rank_from).replace("{rank_to}",n.rank_to)),t.setString(n)},_displayRewardInformation:function(e){this._getWidget(this.RANKING_LABEL_NAME).setString(e.getCurrencyName()),this._super(e)}})}((this||0).self||global),function(e){var t=e.kh;e.khutil,e.cc,e.ccui,e._,e.console,t.createNameSpaceIfNotExists("unionraid.controller"),t.unionraid.controller.EventRewardPageListController=t.core.reward.RewardPageListController.extend({className:"EventRewardPageListController"})}((this||0).self||global),function(e){var t=e.kh;e.khutil,e.cc,e.ccui,e._,e.console,t.createNameSpaceIfNotExists("unionraid.controller"),t.unionraid.controller.RankingRewardPageListController=t.core.reward.RewardPageListController.extend({className:"RankingRewardPageListController",REWARD_MODEL:"RankingRewardModel",LIST_PANEL_VIEW:"RankingRewardPanel"})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=(e.ccui,e._);e.console,t.createNameSpaceIfNotExists("unionraid.eventHandling"),t.unionraid.eventHandling.ReceiveConfirmedEventHandler=t.core.reward.ReceiveRewardButtonTouchEventHandler.extend({className:"ReceiveConfirmedEventHandler",ctor:function(e){this._api=t.createInstance("apiAEvents"),this._eventId=e},_receiveConfirmed:function(e){var t=n.director.getRunningScene();this._api.receiveUnionRaidReward(this._eventId,e.getRewardId()).then(function(e){var n=e.body;if(!0===n.is_expired)return this._showExpiredPopup(t);var a=n.new_characters_gained;return i.isEmpty(a)?Q.resolve():this._showNewMemberPopups(a)}.bind(this)).then(function(){t.refresh()})}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=(e.ccui,e._);e.console,t.createNameSpaceIfNotExists("unionraid.eventHandling"),t.unionraid.eventHandling.RankingReceiveConfirmedEventHandler=t.core.reward.ReceiveRewardButtonTouchEventHandler.extend({className:"RankingReceiveConfirmedEventHandler",ctor:function(e){this._api=t.createInstance("apiAEvents"),this._eventId=e},_receiveConfirmed:function(e){var t=n.director.getRunningScene();this._api.receiveUnionRaidRankingReward(this._eventId,e.getRewardId()).then(function(e){var n=e.body;if(!0===n.is_expired)return this._showExpiredPopup(t);var a=n.new_characters_gained;return i.isEmpty(a)?Q.resolve():this._showNewMemberPopups(a)}.bind(this)).then(function(){t.refresh()})}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=(e.ccui,e._);e.console,t.createNameSpaceIfNotExists("unionraid.settings"),t.unionraid.settings.EventRewardPageListSetting=n.Class.extend({className:"EventRewardPageListSetting",ctor:function(e,t,n){this._eventId=t,this._baseName=e,this._currencyType=n},SETTINGS:{panelName:t.BtnsPageListParams.UNION_RAID_REWARDS.panelName,paginatorNode:"viewpage_ui",apiName:"apiAEvents",apiMethod:"getRaidEventRewards",apiParams:null,fillEmptyRecord:!1},getSettings:function(){return i.extend({},this.SETTINGS,{apiParams:[this._eventId,this._currencyType,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE],baseName:this._baseName})}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=(e.ccui,e._);e.console,t.createNameSpaceIfNotExists("unionraid.settings"),t.unionraid.settings.RankingRewardPageListSetting=n.Class.extend({className:"RankingRewardPageListSetting",ctor:function(e,t,n){this._eventId=t,this._baseName=e,this._currencyType=n},SETTINGS:{panelName:t.BtnsPageListParams.UNION_RAID_RANKING_REWARDS.panelName,paginatorNode:"viewpage_ui",apiName:"apiAEvents",apiMethod:"getUnionRaidRankingRewards",apiParams:null,fillEmptyRecord:!1},getSettings:function(){return i.extend({},this.SETTINGS,{apiParams:[this._eventId,this._currencyType,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE],baseName:this._baseName})}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("unionraid.eventHandling"),t.unionraid.eventHandling.RankingPageInitializeEventHandler=n.Class.extend({className:"RankingPageInitializeEventHandler",handle:function(){this._setupApiEventId(),this._showBackground(),this._showRankingUpdateTime()},_setupApiEventId:function(){var e=t.pc.unionraid.roles.TemporaryRouterParams._getEventId();t.createInstance("apiAEventsBridge").setupEventId(e)},_showBackground:function(){t.createInstance("BackgroundFactory").create().show()},_showRankingUpdateTime:function(){t.createInstance("RankingUpdateTimeController").displayLastUpdateTime()}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("unionraid.factory"),t.unionraid.factory.BackgroundFactory=n.Class.extend({className:"BackgroundFactory",BACKGROUND_NUMBER_BY_PAGE:{"008":2},create:function(){var e=this._getEventId(),n=this._getBackgroundNumber();return t.createInstance("UnionRaidBackgroundView",[n,e])},_getBackgroundNumber:function(){var e=this._getPageNumber();return this.BACKGROUND_NUMBER_BY_PAGE[e]},_getPageNumber:function(){return t.createInstance("router").getCurrentFragment().replace(/[^\d]/g,"")},_getEventId:function(){return t.pc.unionraid.roles.TemporaryRouterParams._getEventId()}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("unionraid.eventHandling"),t.unionraid.eventHandling.RankingPageOnTabChangeEventHandler=n.Class.extend({className:"RankingPageOnTabChangeEventHandler",ctor:function(){this._rankingPageListCollectionController=t.createInstance("RankingPageListCollectionController"),this._scoreController=t.createInstance("ScoreController"),this._headerView=t.createInstance("RankingHeaderView")},handle:function(e,t){this._headerView.displayHeader(e,t),this._rankingPageListCollectionController.showRanking(e),this._scoreController.displayScore(e)}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=(e.ccui,e._,e.console);t.createNameSpaceIfNotExists("unionraid.view"),t.unionraid.view.HeaderView=i.Class.extend({className:"HeaderView",HEADER_WIDGET_NAME:"header_label",HEADER_TEXT:function(e,t){return e[t.DEMON]={uniraid_001:"",uniraid_002:"",uniraid_004:"",uniraid_007:""},e[t.SERAPH]={uniraid_001:"",uniraid_002:"",uniraid_004:"",uniraid_007:""},e}({},t.unionraid.enums.UNION_RAID_TYPE),displayHeader:function(e){var n=this._getHeaderWidget(),i=t.createInstance("sceneManager").getCurrentSceneName(),a=this._getHeaderText(e.getUnionRaidType(),i);n.setString(a)},_getHeaderText:function(e,t){return this.HEADER_TEXT[e][t]},_getHeaderWidget:function(){return n.getWidget(this.HEADER_WIDGET_NAME,function(e){a.warn(this.className+": "+e)}.bind(this))}})}((this||0).self||global),function(e){var t=e.kh;t.createNameSpaceIfNotExists("unionraid.view"),t.unionraid.view.RankingHeaderView=t.unionraid.view.HeaderView.extend({className:"RankingHeaderView",HEADER_TEXT_BY_RANKING_TYPE:function(e,t,n){return e[n.EXPERT]={},e[n.EXPERT][t.DEMON]="",e[n.EXPERT][t.SERAPH]="",e[n.ULTIMATE]={},e[n.ULTIMATE][t.DEMON]="",e[n.ULTIMATE][t.SERAPH]="",e[n.INDIVIDUAL]={},e[n.INDIVIDUAL][t.DEMON]="",e[n.INDIVIDUAL][t.SERAPH]="",e}({},t.unionraid.enums.UNION_RAID_TYPE,t.unionraid.enums.RANKING_TYPE),displayHeader:function(e,t){var n=this._getHeaderWidget(),i=this._getHeaderText(e,t.getUnionRaidType());n.setString(i)},_getHeaderText:function(e,t){return this.HEADER_TEXT_BY_RANKING_TYPE[e][t]}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("unionraid.view"),t.unionraid.view.MinorRaidButtonView=n.Class.extend({className:"MinorRaidButtonView",WIDGET_NAME:"btn_lilim",TEXTURE_NAMES:function(e,t){return e[t.DEMON]={},e[t.DEMON].normal="unionraid/res/uniraid_btn_lilim_1.png",e[t.DEMON].pressed="unionraid/res/uniraid_btn_lilim_2.png",e[t.SERAPH]={},e[t.SERAPH].normal="unionraid/res/uniraid_btn_throne_1.png",e[t.SERAPH].pressed="unionraid/res/uniraid_btn_throne_2.png",e}({},t.unionraid.enums.UNION_RAID_TYPE),show:function(e,t){var n=e.seekWidgetByName(this.WIDGET_NAME),i=t.getUnionRaidType(),a=this.TEXTURE_NAMES[i].normal,o=this.TEXTURE_NAMES[i].pressed;n.loadTextureNormal(a,ccui.Widget.PLIST_TEXTURE),n.loadTexturePressed(o,ccui.Widget.PLIST_TEXTURE)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("unionraid.view"),t.unionraid.view.QuestPageMinorRaidButtonView=n.Class.extend({className:"QuestPageMinorRaidButtonView",WIDGET_NAME:"btn_lilim",BUTTON_TEXTS:function(e,t){return e[t.DEMON]="",e[t.SERAPH]="",e}({},t.unionraid.enums.UNION_RAID_TYPE),show:function(e,t){var n=e.seekWidgetByName(this.WIDGET_NAME),i=t.getUnionRaidType(),a=this.BUTTON_TEXTS[i];n.setTitleText(a)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("unionraid.view"),t.unionraid.view.MajorRaidButtonView=n.Class.extend({className:"MajorRaidButtonView",WIDGET_NAME:"btn_daemon",TEXTURE_NAMES:function(e,t){return e[t.DEMON]={},e[t.DEMON].normal="unionraid/res/uniraid_btn_daemon_1.png",e[t.DEMON].pressed="unionraid/res/uniraid_btn_daemon_2.png",e[t.SERAPH]={},e[t.SERAPH].normal="unionraid/res/uniraid_btn_seraphy_1.png",e[t.SERAPH].pressed="unionraid/res/uniraid_btn_seraphy_2.png",e}({},t.unionraid.enums.UNION_RAID_TYPE),show:function(e,t){var n=e.seekWidgetByName(this.WIDGET_NAME),i=t.getUnionRaidType(),a=this.TEXTURE_NAMES[i].normal,o=this.TEXTURE_NAMES[i].pressed;n.loadTextureNormal(a,ccui.Widget.PLIST_TEXTURE),n.loadTexturePressed(o,ccui.Widget.PLIST_TEXTURE)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("unionraid.view"),t.unionraid.view.ItemAbstract=n.Class.extend({NAME_LABEL_NAME:"name label name not set",IMAGE_WIDGET_NAME:"image widget name not set",AMOUNT_LABEL_NAME:"amount label name not set",ITEM_IMAGE_PATH:"corecard_item_{item_id}",ITEM_IMAGE_EXTENSION:"jpg",NAME_TEMPLATE:"{item_name}",showName:function(e,t){var n=t.getName(),i=this.NAME_TEMPLATE.replace("{item_name}",n);this._getWidget(e,this.NAME_LABEL_NAME).setText(i)},showImage:function(e,n){var i=n.getId(),a=this._getWidget(e,this.IMAGE_WIDGET_NAME),o=this.ITEM_IMAGE_PATH.replace("{item_id}",_.padZero(i,4)),r=t.img(o)[this.ITEM_IMAGE_EXTENSION];a.loadTexture(r)},showAmount:function(e,t){var n=t.getAmount();this._getWidget(e,this.AMOUNT_LABEL_NAME).setText(n.toString())},_getWidget:function(e,t){var n=e.seekWidgetByName(t);return null==n&&console.error("kh.unionraid.view.ItemAbstract: widget not found {"+t+"}!"),n}})}((this||0).self||global),function(e){var t=e.kh;t.createNameSpaceIfNotExists("unionraid.view"),t.unionraid.view.BuffCheckPopupItem=t.unionraid.view.ItemAbstract.extend({NAME_LABEL_NAME:"item_name_label",NAME_TEMPLATE:"{item_name}",show:function(e,t){this.showName(e,t)}})}((this||0).self||global),function(e){var t=e.kh;t.createNameSpaceIfNotExists("unionraid.view"),t.unionraid.view.BuffUsePopupItem=t.unionraid.view.ItemAbstract.extend({NAME_LABEL_LEFT_NAME:"item_name_label_left",NAME_LABEL_RIGHT_NAME:"item_name_label_right",IMAGE_WIDGET_NAME:"corecard_item",NAME_TEMPLATE:"{item_name}",show:function(e,t){this.NAME_LABEL_NAME=this.NAME_LABEL_LEFT_NAME,this.showName(e,t),this.NAME_LABEL_NAME=this.NAME_LABEL_RIGHT_NAME,this.showName(e,t),this.showImage(e,t)}})}((this||0).self||global),function(e){var t=e.kh;t.createNameSpaceIfNotExists("unionraid.view"),t.unionraid.view.BuffEffectItem=t.unionraid.view.ItemAbstract.extend({NAME_LABEL_NAME:"name_label",AMOUNT_LABEL_NAME:"have_label",show:function(e,t){this.showName(e,t),this.showAmount(e,t)}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("unionraid.controller"),t.unionraid.controller.RankingUpdateTimeController=n.Class.extend({className:"RankingUpdateTimeController",CACHE_KEY:"unionraid_ranking_update_time",displayLastUpdateTime:function(){return this._getRankingUpdateTimeModel().then(function(e){t.createInstance("RankingUpdateTimeView").display(e)})},_getRankingUpdateTimeModel:function(){var e=this._getRankingUpdateTimeModelFromCache();return null!=e?Q.resolve(e):t.createInstance("RankingUpdateTimeRepository").import().then(this._cacheRankingUpdateTimeModel.bind(this))},_cacheRankingUpdateTimeModel:function(e){var n=t.createInstance("componentCache"),i=e.getTimeUntilNextUpdate();return n.cache(this.CACHE_KEY,e,i),e},_getRankingUpdateTimeModelFromCache:function(){t.createInstance("componentCache").get(this.CACHE_KEY)}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=(e.ccui,e._,e.console);t.createNameSpaceIfNotExists("unionraid.repository"),t.unionraid.repository.RankingUpdateTimeRepository=n.Class.extend({className:"RankingUpdateTimeRepository",import:function(){return t.createInstance("apiAEventsBridge").getLastRankingUpdate().then(this._createModel.bind(this)).fail(function(e){i.error(e&&e.stack?e.stack:e)})},_createModel:function(e){return t.createInstance("RankingUpdateTimeModel",[e.body])}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("unionraid.model"),t.unionraid.model.RankingUpdateTimeModel=n.Class.extend({className:"RankingUpdateTimeModel",ctor:function(e){this._rankingUpdateTimeData=e},getLastUpdateTime:function(){return this._rankingUpdateTimeData.last_update_time},getTimeUntilNextUpdate:function(){return this._rankingUpdateTimeData.time_until_next_update}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=(e.ccui,e._),o=e.console;t.createNameSpaceIfNotExists("unionraid.view"),t.unionraid.view.RankingUpdateTimeView=i.Class.extend({className:"RankingUpdateTimeView",SUB_HEADER_LABEL:"header_sub_label",SUB_HEADER_TEXT_PREFIX:"",display:function(e){var t=n.getWidget(this.SUB_HEADER_LABEL,function(e){o.warn(this.className+": "+e)}.bind(this)),i=this._getSubHeaderText(e);t.setString(i)},_getSubHeaderText:function(e){var t=e.getLastUpdateTime();return a.isEmpty(t)?"":this.SUB_HEADER_TEXT_PREFIX+t}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("unionraid.controller"),t.unionraid.controller.RankingPageListCollectionController=n.Class.extend({className:"RankingPageListCollectionController",FIRST_TAB_TO_PRELOAD:t.unionraid.enums.RANKING_TYPE.EXPERT,ctor:function(){this._rankingPageLists=this._initializeRankingPageLists()},showRanking:function(e){this._preloadPages(e),this._rankingPageLists[e].showRanking()},_preloadPages:function(e){this._rankingPageLists[e].preloadPage()},_initializeRankingPageLists:function(){var e=t.unionraid.enums.RANKING_TYPE,n={};return n[e.EXPERT]=t.createInstance("RankingPageListController",[e.EXPERT]),n[e.ULTIMATE]=t.createInstance("RankingPageListController",[e.ULTIMATE]),n[e.INDIVIDUAL]=t.createInstance("RankingPageListController",[e.INDIVIDUAL]),n}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil;e.cc,e.ccui,e._,e.console,e.res,t.createNameSpaceIfNotExists("unionraid.controller"),t.unionraid.controller.RankingPageListController=t.core.ranking.RankingPageListController.extend({className:"UnionEventRankingPageListController",_instantiateStatusPanel:function(e){return this._rankingType===t.unionraid.enums.RANKING_TYPE.INDIVIDUAL?t.createInstance("IndividualRankingStatusController",[e]):t.createInstance("UnionRankingStatusController",[e])},_initializePageListSettings:function(e){return(new t.unionraid.settings.RankingPageListSettings).getSettings(e)},preloadPage:function(){var e=ccs.load(this._pageListSettings.panelResourcePath),t=n.getWidget(this._pageListSettings.baseName),i=n.getWidgetFromNode(t,this._pageListSettings.listNodeName,this._onNodeNotFound.bind(this)),a=e.node;a.name=this._pageListSettings.panelName,i.addChild(a)}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=(e.ccui,e._);e.console,t.createNameSpaceIfNotExists("unionraid.settings"),t.unionraid.settings.RankingPageListSettings=n.Class.extend({className:"RankingPageListSettings",GENERAL_SETTINGS:{panelResourcePath:$staticRes("res/uniraid_008/uniraid_008_ranklist_page_ui.json"),listNodeName:"list_node",panelName:t.BtnsPageListParams.UNION_RANKING_LIST.panelName,panelsPerPage:t.BtnsPageListParams.UNION_RANKING_LIST.perPage,paginatorNode:"viewpage_three_ui",apiName:"apiAEventsBridge",apiMethod:"getRanking"},SETTINGS_BY_RANKING_TYPE:function(e,n){return e[n.EXPERT]={baseName:"tab_0_node",apiParams:["expert",t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE]},e[n.ULTIMATE]={baseName:"tab_1_node",apiParams:["ultimate",t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE]},e[n.INDIVIDUAL]={baseName:"tab_2_node",apiParams:["individual",t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE]},e}({},t.unionraid.enums.RANKING_TYPE),getSettings:function(e){return i.assign({},this.GENERAL_SETTINGS,this.SETTINGS_BY_RANKING_TYPE[e])}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("unionraid.repository"),t.unionraid.repository.apiAEventsBridge=n.Class.extend({className:"apiAEventsBridge",ctor:function(){this._api=t.createInstance("apiAEvents")},setupEventId:function(e){this._eventId=e},getLastRankingUpdate:function(){return this._api.getUnionRaidLastRankingUpdate(this._eventId)},getRanking:function(e,t,n){return this._api.getUnionRaidRanking(this._eventId,e,t,n)},getScore:function(e){return this._api.getUnionRaidScore(this._eventId,e)},getHasRewards:function(){return this._api.getUnionRaidRankingHasRewards(this._eventId)}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=e.ccui,o=(e._,e.console);t.createNameSpaceIfNotExists("unionraid.controller"),t.unionraid.controller.UnionRankingStatusController=i.Class.extend({className:"UnionRankingStatusController",PANEL_TOUCH_EVENT_WIDGET_NAME:"rank_base",ctor:function(e){this._unionRankingStatusPanelView=t.createInstance("UnionRankingStatusPanelView",[e]),this._initializeOnTouchEvent(e)},initializeModel:function(e){this._unionRankingStatusModel=t.createInstance("UnionRankingStatusModel",[e])},displayStatusPanel:function(){this._unionRankingStatusPanelView.display(this._unionRankingStatusModel)},hideStatusPanel:function(){this._unionRankingStatusPanelView.clear()},_initializeOnTouchEvent:function(e){n.getWidgetFromNode(e,this.PANEL_TOUCH_EVENT_WIDGET_NAME,function(e){o.warn(this.className+": "+e)}.bind(this)).addTouchEventListener(this._onTouchEventCallback,this)},_onTouchEventCallback:function(e,t){t===a.Widget.TOUCH_ENDED&&this._navigateToUnionPage()},_navigateToUnionPage:function(){if(this._unionRankingStatusModel.isMyUnion())t.createInstance("unionRouter").navigateToTopScene("me");else{var e=this._unionRankingStatusModel.getUnionId();t.createInstance("unionRouter").navigateToTopScene(e)}}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=(e.ccui,e._),o=e.console;t.createNameSpaceIfNotExists("unionraid.view"),t.unionraid.view.UnionRankingStatusPanelView=i.Class.extend({className:"UnionRankingStatusPanelView",WIDGET_NAMES:{UNION_MEMBER_COUNT:"belong_num_label",UNION_RANK:"union_rank_label",GUARDIAN:"corecard_guardian"},APPEARANCE_NAMES_BY_RANK:{1:"all_rank_1st",2:"all_rank_2nd",3:"all_rank_3rd",DEFAULT:"all_rank_below"},GUARDIAN_IMAGE_PATH:"corecard_guardian_{guardianId}_0",GUARDIAN_IMAGE_EXTENSION:"jpg",UNION_MEMBER_COUNT_TEXT:"{unionMemberCount}",ctor:function(e){this._rootWidget=e,this._sharedPanelView=t.createInstance("RankingStatusPanelView",[e])},display:function(e){this._sharedPanelView.display(e),this._displayUnionRank(e),this._displayUnionMemberCount(e),this._displayUnionGuardian(e),this._updateAppearanceByRank(e)},clear:function(){this._rootWidget.setVisible(!1),a(this.WIDGET_NAMES).reject(a.isEqual.bind(a,this.WIDGET_NAMES.GUARDIAN)).map(this._getWidget,this).invoke("setString",""),this._getWidget(this.WIDGET_NAMES.GUARDIAN).loadTexture("")},_displayUnionName:function(e){var t=this._getWidget(this.WIDGET_NAMES.UNION_NAME),n=e.getUnionName();t.setString(n)},_displayUnionRank:function(e){var t=this._getWidget(this.WIDGET_NAMES.UNION_RANK),n=e.getUnionRank();t.setString(n.toString())},_displayUnionMemberCount:function(e){var t=this._getWidget(this.WIDGET_NAMES.UNION_MEMBER_COUNT),n=e.getUnionMemberCount(),i=this.UNION_MEMBER_COUNT_TEXT.replace("{unionMemberCount}",n);t.setString(i)},_displayUnionGuardian:function(e){var n=e.getGuardianId(),i=this.GUARDIAN_IMAGE_PATH.replace("{guardianId}",a.padZero(n,4)),o=t.img.apply(t,i.split("_"))[this.GUARDIAN_IMAGE_EXTENSION];this._getWidget(this.WIDGET_NAMES.GUARDIAN).loadTexture(o)},_updateAppearanceByRank:function(e){var t=e.getRank(),n=this.APPEARANCE_NAMES_BY_RANK[t];null==n&&(n=this.APPEARANCE_NAMES_BY_RANK.DEFAULT),this._rootWidget.setAppearance(n)},_getWidget:function(e){return n.getWidgetFromNode(this._rootWidget,e,function(e){o.warn(this.className+": "+e)}.bind(this))}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("unionraid.model"),t.unionraid.model.UnionRankingStatusModel=n.Class.extend({className:"UnionRankingStatusModel",ctor:function(e){this._rankingStatusData=e},getRank:function(){return this._rankingStatusData.rank},getPreviousRank:function(){return this._rankingStatusData.previous_rank},getPreviousRankStatus:function(){return 0===this.getPreviousRank()?t.unionraid.enums.PREVIOUS_RANK.HAS_NONE:this.getPreviousRank()<this.getRank()?t.unionraid.enums.PREVIOUS_RANK.IS_HIGHER:this.getPreviousRank()===this.getRank()?t.unionraid.enums.PREVIOUS_RANK.IS_EQUAL:t.unionraid.enums.PREVIOUS_RANK.IS_LOWER},getGuardianId:function(){return this._rankingStatusData.guardian_id},getUnionId:function(){return this._rankingStatusData.a_union_id},getName:function(){return this._rankingStatusData.union_name},getScore:function(){return this._rankingStatusData.score},getUnionMemberCount:function(){return this._rankingStatusData.union_member_count},getUnionRank:function(){return this._rankingStatusData.union_rank},isMyUnion:function(){return this._rankingStatusData.is_my_union}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=e.ccui,o=(e._,e.console);t.createNameSpaceIfNotExists("unionraid.controller"),t.unionraid.controller.IndividualRankingStatusController=i.Class.extend({className:"IndividualRankingStatusController",PANEL_TOUCH_EVENT_WIDGET_NAME:"rank_base",ctor:function(e){this._individualRankingStatusPanelView=t.createInstance("IndividualRankingStatusPanelView",[e]),this._initializeOnTouchEvent(e)},initializeModel:function(e){this._individualRankingStatusModel=t.createInstance("IndividualRankingStatusModel",[e])},displayStatusPanel:function(){this._individualRankingStatusPanelView.display(this._individualRankingStatusModel)},hideStatusPanel:function(){this._individualRankingStatusPanelView.clear()},_initializeOnTouchEvent:function(e){n.getWidgetFromNode(e,this.PANEL_TOUCH_EVENT_WIDGET_NAME,function(e){o.warn(this.className+": "+e)}.bind(this)).addTouchEventListener(this._onTouchEventCallback,this)},_onTouchEventCallback:function(e,t){t===a.Widget.TOUCH_ENDED&&this._navigateToProfilePage()},_navigateToProfilePage:function(){var e=this._individualRankingStatusModel.getPlayerId(),n=this._individualRankingStatusModel.isMe()?"a":"b",a=i.director.getRunningScene(),o=a.tabDelegateList[0],r=t.pc.unionraid.roles.TemporaryRouterParams._getEventId();t.createInstance("router").navigate("profile/prf_001"+n,{prf_001:{id:e}},{return_to_profile:{routes:"unionraid/uniraid_008",params:{},temporaryRouterParams:{restoreParams:{tabs:[o.selected]},event_id:r,selectedTab:a.tabDelegateList[0].selected}}})}})}((this||0).self||global),function(e){var t=e.kh;e.khutil,e.cc,e.ccui,e._,e.console,t.createNameSpaceIfNotExists("unionraid.view"),t.unionraid.view.IndividualRankingStatusPanelView=t.core.ranking.IndividualRankingStatusPanelView.extend({className:"IndividualRankingStatusPanelView",APPEARANCE_NAMES_BY_RANK:{1:"personal_rank_1st",2:"personal_rank_2nd",3:"personal_rank_3rd",DEFAULT:"personal_rank_below"},_createSharedPanelView:function(e){return t.createInstance("RankingStatusPanelView",[e])}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc);e.ccui,e._,e.console,t.createNameSpaceIfNotExists("unionraid.model"),t.unionraid.model.IndividualRankingStatusModel=n.Class.extend({className:"IndividualRankingStatusModel",ctor:function(e){this._rankingStatusData=e},getRank:function(){return this._rankingStatusData.rank},getPreviousRank:function(){return this._rankingStatusData.previous_rank},getPreviousRankStatus:function(){return 0===this.getPreviousRank()?t.unionraid.enums.PREVIOUS_RANK.HAS_NONE:this.getPreviousRank()<this.getRank()?t.unionraid.enums.PREVIOUS_RANK.IS_HIGHER:this.getPreviousRank()===this.getRank()?t.unionraid.enums.PREVIOUS_RANK.IS_EQUAL:this.getPreviousRank()>this.getRank()?t.unionraid.enums.PREVIOUS_RANK.IS_LOWER:void 0},getScore:function(){return this._rankingStatusData.score},getJobId:function(){return this._rankingStatusData.job_id},getSummonId:function(){return this._rankingStatusData.summon_id},getMainPartyMembersIdList:function(){return this._rankingStatusData.main_party_members_id_list},getName:function(){return this._rankingStatusData.player_name},getPlayerId:function(){return this._rankingStatusData.a_player_id},isMe:function(){return this._rankingStatusData.is_me}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=(e.ccui,e._);e.console,t.createNameSpaceIfNotExists("unionraid.controller"),t.unionraid.controller.ScoreController=n.Class.extend({className:"ScoreController",VIEW_CLASS_BY_RANKING_TYPE:function(e,t){return e[t.EXPERT]="UnionScoreView",e[t.ULTIMATE]="UnionScoreView",e[t.INDIVIDUAL]="IndividualScoreView",e}({},t.unionraid.enums.RANKING_TYPE),ctor:function(){this._scoreRepository=t.createInstance("ScoreRepository"),this._scoreViewsByRankingType=i.transform(this.VIEW_CLASS_BY_RANKING_TYPE,function(e,n,i){e[i]=t.createInstance(n)},{}),this._sharedScoreView=t.createInstance("ScoreView")},displayScore:function(e){this._clearAllViews(),this._getScoreModel(e).then(function(t){var n=this._getScoreViewsByRankingType(e);i.invoke(n,"display",t)}.bind(this))},_clearAllViews:function(){var e=this._getAllScoreViews();i.invoke(e,"clear")},_getScoreModel:function(e){return this._scoreRepository.import(e)},_getAllScoreViews:function(){return i.values(this._scoreViewsByRankingType).concat([this._sharedScoreView])},_getScoreViewsByRankingType:function(e){return[this._sharedScoreView,this._scoreViewsByRankingType[e]]}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=(e.ccui,e._,e.console);t.createNameSpaceIfNotExists("unionraid.repository"),t.unionraid.repository.ScoreRepository=n.Class.extend({className:"ScoreRepository",MODEL_NAME_BY_RANKING_TYPE:function(e,t){return e[t.EXPERT]="UnionScoreModel",e[t.ULTIMATE]="UnionScoreModel",e[t.INDIVIDUAL]="IndividualScoreModel",e}({},t.unionraid.enums.RANKING_TYPE),API_PARAMETER_BY_RANKING_TYPE:function(e,t){return e[t.EXPERT]="expert",e[t.ULTIMATE]="ultimate",e[t.INDIVIDUAL]="individual",e}({},t.unionraid.enums.RANKING_TYPE),ctor:function(){this._modelCache={}},import:function(e){return null!=this._modelCache[e]?Q.resolve(this._modelCache[e]):t.createInstance("apiAEventsBridge").getScore(this.API_PARAMETER_BY_RANKING_TYPE[e]).then(this._createModel.bind(this,e)).then(this._cacheModel.bind(this,e)).fail(function(e){i.error(e&&e.stack?e.stack:e)})},_createModel:function(e,n){return t.createInstance(this.MODEL_NAME_BY_RANKING_TYPE[e],[n.body])},_cacheModel:function(e,t){return this._modelCache[e]=t,t}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=(e.ccui,e._);e.console,t.createNameSpaceIfNotExists("unionraid.model"),t.unionraid.model.IndividualScoreModel=n.Class.extend({className:"IndividualScoreModel",ctor:function(e){this._scoreData=e},hasScoreData:function(){return!i.isEmpty(this._scoreData)},getRank:function(){return this._scoreData.rank},getScore:function(){return this._scoreData.score},getHighScore:function(){return this._scoreData.highscore},getScoreIterationDates:function(){return this._scoreData.score_iteration_dates},getRepresentativeCharacterId:function(){return this._scoreData.job_id},getName:function(){return this._scoreData.player_name}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=(e.ccui,e._);e.console,t.createNameSpaceIfNotExists("unionraid.model"),t.unionraid.model.UnionScoreModel=n.Class.extend({className:"UnionScoreModel",ctor:function(e){this._scoreData=e},hasScoreData:function(){return!i.isEmpty(this._scoreData)},getRank:function(){return this._scoreData.rank},getScore:function(){return this._scoreData.score},getHighScore:function(){return this._scoreData.highscore},getScoreIterationDates:function(){return this._scoreData.score_iteration_dates},getRepresentativeCharacterId:function(){return this._scoreData.guardian_id},getName:function(){return this._scoreData.union_name}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=(e.ccui,e._),o=e.console;t.createNameSpaceIfNotExists("unionraid.view"),t.unionraid.view.ScoreView=i.Class.extend({className:"ScoreView",WIDGET_NAMES:{NAME:"name_label",RANK:"ranking_label",SCORE:"daily_score_label",HIGHSCORE:"high_score_label",ITERATION_DATES:"duration_label"},display:function(e){e.hasScoreData()&&(this._displayName(e),this._displayRank(e),this._displayScore(e),this._displayHighScore(e),this._displayIterationDates(e))},clear:function(){a(this.WIDGET_NAMES).reject(a.isEqual(this.WIDGET_NAMES.RANK)).map(this._getWidget,this).invoke("setString",""),this._getWidget(this.WIDGET_NAMES.RANK).setString("-")},_displayName:function(e){var t=this._getWidget(this.WIDGET_NAMES.NAME),n=e.getName();t.setString(n)},_displayRank:function(e){var t=this._getWidget(this.WIDGET_NAMES.RANK),n=e.getRank();t.setString(n.toString())},_displayScore:function(e){var t=this._getWidget(this.WIDGET_NAMES.SCORE),n=e.getScore();t.setString(n.toString())},_displayHighScore:function(e){var t=this._getWidget(this.WIDGET_NAMES.HIGHSCORE),n=e.getHighScore();t.setString(n.toString())},_displayIterationDates:function(e){var t=this._getWidget(this.WIDGET_NAMES.ITERATION_DATES),n=e.getScoreIterationDates();t.setString(n)},_getWidget:function(e){return n.getWidget(e,function(e){o.warn(this.className+": "+e)}.bind(this))}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=(e.ccui,e._),o=e.console;t.createNameSpaceIfNotExists("unionraid.view"),t.unionraid.view.IndividualScoreView=i.Class.extend({className:"IndividualScoreView",WIDGET_NAMES:{JOB:"illust_my_job"},JOB_IMAGE_PATH:"illust-com-kneeshot_job_{jobId}_0",JOB_IMAGE_EXTENSION:"png",display:function(e){this._displayJobImage(e)},clear:function(){var e=this._getWidget(this.WIDGET_NAMES.JOB);e.loadTexture(""),e.setVisible(!1)},_displayJobImage:function(e){var n=this._getWidget(this.WIDGET_NAMES.JOB);n.setVisible(!0);var i=e.getRepresentativeCharacterId(),o=this.JOB_IMAGE_PATH.replace("{jobId}",a.padZero(i,4)),r=t.img.apply(t,o.split("_"))[this.JOB_IMAGE_EXTENSION];n.loadTexture(r)},_getWidget:function(e){return n.getWidget(e,function(e){o.warn(this.className+": "+e)}.bind(this))}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=(e.ccui,e._),o=e.console;t.createNameSpaceIfNotExists("unionraid.view"),t.unionraid.view.UnionScoreView=i.Class.extend({className:"UnionScoreView",WIDGET_NAMES:{GUARDIAN:"illust_my_guardian"},GUARDIAN_IMAGE_PATH:"illustzoom_guardian_{guardianId}_0",GUARDIAN_IMAGE_EXTENSION:"png",display:function(e){e.hasScoreData()&&this._displayGuardianImage(e)},clear:function(){var e=this._getWidget(this.WIDGET_NAMES.GUARDIAN);e.loadTexture(""),e.setVisible(!1)},_displayGuardianImage:function(e){var n=this._getWidget(this.WIDGET_NAMES.GUARDIAN);n.setVisible(!0);var i=e.getRepresentativeCharacterId(),o=this.GUARDIAN_IMAGE_PATH.replace("{guardianId}",a.padZero(i,4)),r=t.img.apply(t,o.split("_"))[this.GUARDIAN_IMAGE_EXTENSION];n.loadTexture(r)},_getWidget:function(e){return n.getWidget(e,function(e){o.warn(this.className+": "+e)}.bind(this))}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=(e.ccui,e._);e.console,t.createNameSpaceIfNotExists("unionraid.model"),t.unionraid.model.RewardObtainmentInfoModel=n.Class.extend({className:"RewardObtainmentInfoModel",KEY_BY_RANKING_TYPE:function(e,t){return e[t.EXPERT]="expert",e[t.ULTIMATE]="ultimate",e[t.INDIVIDUAL]="individual",e}({},t.unionraid.enums.RANKING_TYPE),ctor:function(e){this._rewardObtainmentInfo=e},canObtainRewards:function(e){return this._rewardObtainmentInfo[this.KEY_BY_RANKING_TYPE[e]]},hasRewardInfo:function(){return i.filter(this._rewardObtainmentInfo,function(e){return!0===e}).length>0},canObtainRewardsByName:function(e){return this._rewardObtainmentInfo[e]}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=(e.ccui,e._),o=e.console;t.createNameSpaceIfNotExists("unionraid.view"),t.unionraid.view.RewardTabExclamationView=i.Class.extend({className:"RewardTabExclamationView",WIDGET_NAME_BY_RANKING_TYPE:function(e,t){return e[t.EXPERT]="icon_0",e[t.ULTIMATE]="icon_1",e[t.INDIVIDUAL]="icon_2",e}({},t.unionraid.enums.RANKING_TYPE),display:function(e){a.each(t.unionraid.enums.RANKING_TYPE,function(t){var i=n.getWidget(this.WIDGET_NAME_BY_RANKING_TYPE[t],function(e){o.warn(this.className+": "+e)}.bind(this)),a=e.canObtainRewards(t);i.setVisible(a)},this)}})}((this||0).self||global),function(e){var t=e.kh,n=(e.khutil,e.cc),i=(e.ccui,e._,e.console);t.createNameSpaceIfNotExists("unionraid.repository"),t.unionraid.repository.RewardObtainmentInfoRepository=n.Class.extend({className:"RewardObtainmentInfoRepository",import:function(){return t.createInstance("apiAEventsBridge").getHasRewards().then(this._createModel.bind(this)).fail(function(e){i.error(e&&e.stack?e.stack:e)})},_createModel:function(e){return i.log(e.body),t.createInstance("RewardObtainmentInfoModel",[e.body])}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("unionraid.view"),t.unionraid.view.GotoPresentButtonView=n.Class.extend({className:"GotoPresentButtonView",ctor:function(e){this._buttonWidget=e},setVisible:function(e){this._buttonWidget.setVisible(e)},setGrayedOut:function(e){t.pc.roles.UIUtility._setGrayOutButton(this._buttonWidget,!e)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("unionraid.controller"),t.unionraid.controller.GotoPresentButtonController=n.Class.extend({className:"GotoPresentButtonController",BUTTON_NAME:"btn_present",ctor:function(){this._buttonWidget=this._getButtonWidget(),this._view=this._createView()},clear:function(){this._view.setVisible(!1)},display:function(e){var t=e.getReceivable();this._view.setVisible(t)},enable:function(){this._buttonWidget.setEnabled(!0),this._view.setGrayedOut(!0)},disable:function(){this._buttonWidget.setEnabled(!1),this._view.setGrayedOut(!1)},_getButtonWidget:function(){return khutil.getWidget(this.BUTTON_NAME,function(e){console.warn(this.className+": "+e)}.bind(this))},_createView:function(){return t.createInstance("GotoPresentButtonView",[this._buttonWidget])}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("unionraid.view"),t.unionraid.view.ReceiveAllButtonView=n.Class.extend({className:"ReceiveAllButtonView",ctor:function(e){this._buttonWidget=e},setVisible:function(e){this._buttonWidget.setVisible(e)},setGrayedOut:function(e){t.pc.roles.UIUtility._setGrayOutButton(this._buttonWidget,!e)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("unionraid.controller"),t.unionraid.controller.ReceiveAllButtonController=n.Class.extend({className:"ReceiveAllButtonController",BUTTON_NAME:"btn_receive",ctor:function(){this._buttonWidget=this._getButtonWidget(),this._view=this._createView()},clear:function(){this._view.setVisible(!1)},display:function(e){var t=e.getReceivable();this._view.setVisible(t)},enable:function(){this._buttonWidget.setEnabled(!0),this._view.setGrayedOut(!1)},disable:function(){this._buttonWidget.setEnabled(!1),this._view.setGrayedOut(!0)},_getButtonWidget:function(){return khutil.getWidget(this.BUTTON_NAME,function(e){console.warn(this.className+": "+e)}.bind(this))},_createView:function(){return t.createInstance("ReceiveAllButtonView",[this._buttonWidget])}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("unionraid.controller"),t.unionraid.controller.RankingRewardInfoLabelController=n.Class.extend({className:"RankingRewardInfoLabelController",INFO_LABEL_NAME:"info_label",clear:function(){khutil.getWidget(this.INFO_LABEL_NAME,function(e){console.warn(this.className+": "+e)}.bind(this)).setVisible(!1)},display:function(e){var t=e.getReceivable();khutil.getWidget(this.INFO_LABEL_NAME,function(e){console.warn(this.className+": "+e)}.bind(this)).setVisible(!t)}})}((this||0).self||global),function(e){var t=e.kh,n=e.khutil,i=e.cc,a=(e.ccui,e._,e.console);t.createNameSpaceIfNotExists("unionraid.controller"),t.unionraid.controller.RankingRewardsReceiveDeadlineController=i.Class.extend({className:"RankingRewardsReceiveDeadlineController",CAPTION_LABEL_NAME:"limit_label",DATE_LABEL_NAME:"limit_date_label",clear:function(){n.getWidget(this.CAPTION_LABEL_NAME,function(e){a.warn(this.className+": "+e)}.bind(this)).setVisible(!1),n.getWidget(this.DATE_LABEL_NAME,function(e){a.warn(this.className+": "+e)}.bind(this)).setVisible(!1)},display:function(e){var t=e.getReceivable();n.getWidget(this.CAPTION_LABEL_NAME,function(e){a.warn(this.className+": "+e)}.bind(this)).setVisible(t);var i=n.getWidget(this.DATE_LABEL_NAME,function(e){a.warn(this.className+": "+e)}.bind(this));i.setVisible(t);var o=e.getRewardReceptDeadline();i.setString(o+"")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;t.createNameSpaceIfNotExists("unionraid.controller"),t.unionraid.controller.RankLabelController=n.Class.extend({className:"RankLabelController",RANK_NUM_LABEL_NAME:"my_rank_num_label",clear:function(){khutil.getWidget(this.RANK_NUM_LABEL_NAME,function(e){console.warn(this.className+": "+e)}.bind(this)).setString("")},display:function(e,t){var n=e.getCurrentRank(t),i=khutil.getWidget(this.RANK_NUM_LABEL_NAME,function(e){console.warn(this.className+": "+e)}.bind(this));n>0?i.setString(n+""):i.setString("-")}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.router=n.router||{},n.router.routes=n.router.routes||{},t.merge(n.router.routes,{unionraid:{unionraid:"uniraid_000","unionraid/uniraid_000":"uniraid_000","unionraid/uniraid_001":"uniraid_001","unionraid/uniraid_002":"uniraid_002","unionraid/uniraid_004":"uniraid_004","unionraid/uniraid_005":"uniraid_005","unionraid/uniraid_007":"uniraid_007","unionraid/uniraid_008":"uniraid_008","unionraid/uniraid_009":"uniraid_009"}})}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.unionraid=t.pc.unionraid||{},t.pc.unionraid.uniraid_000=t.pc.unionraid.uniraid_000||{},t.pc.unionraid.uniraid_000.Scene=t.BaseScene.extend({resourceFileName:"uniraid_000/uniraid_000.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"unionraid",sceneName:"uniraid_000",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_explain","btnCallbackBtnExplain",null,function(){alert("{{}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_unionchat","btnCallbackBtnUnionchat",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"guild/gud_008")),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._),i=e.Q,a=e.console;t.pc=t.pc||{},t.pc.unionraid=t.pc.unionraid||{},t.pc.unionraid.uniraid_000=t.pc.unionraid.uniraid_000||{},t.pc.unionraid.uniraid_000.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../uniraid_popup_ui.json"],_popups:{},onSceneInit:function(e){this._setBackBtn(e);var n=this._getEventId();return t.createInstance("UnionRaidBackgroundView",["000",n]).show(),this._initializePromise},onSceneEnter:function(e){this._verifyTemporaryRouterParams000(e);var t=this._getEventId();return this._initializePromise=i.all([this._initUnionChatButton(),this._prepareAllModel(t)]),i.resolve()},onSceneExit:function(e){return i.defer(),i.resolve()},onPageInAnimationEnd:function(e){var n=t.createInstance("unionRaidNoticeMasterModel"),i=this._getEventId();return n.prepare(i).then(function(){var e=this._getSubTutorialPageNum(),n=t.createInstance("UniRaid000InterruptsFactory").create(i,e);return t.createInstance("SceneInterruptManager",[n]).playIfNeed(n)}.bind(this))},btnCallbackBtnExplain:function(e){var n=this._getEventId(),a=this._getSubTutorialPageNum();return t.ImplantedPopup.createOrGet(e,"sub_tutorial","ImplantedEventSubTutorialPopup").open(n,a),i.reject(this._override)},btnCallbackBtnUnionchat:function(e){var t=i.defer();t.reject(this._override);var n=this._getNavigationFrom(e);return this._navigateToUnionChat(n),t.promise},_getNavigationFrom:function(e){return{routes:t.createInstance("router").getCurrentFragment(),routerParams:e.routerParams,temporaryRouterParams:e.temporaryRouterParams}},_getSubTutorialPageNum:function(){return t.createInstance("unionRaidNoticeMasterModel").getDescriptionImages().length},_prepareAllModel:function(e){var o=[t.createInstance("unionRaidNoticeMasterModel")];return i.all(n.invoke(o,"prepare",e)).fail(function(e){a.warn(e)})},_initUnionChatButton:function(){this._getApiAUnionsMePromise().then(this._handleChatButtonVisibility.bind(this))},_getApiAUnionsMePromise:function(){return t.createInstance("apiAUnions").getMe().fail(function(e){e&&a.error(e)})},_handleChatButtonVisibility:function(e){t.createInstance("UnionChatButtonView").show(e.body.a_union_id)},_touchEndedBackBtnProcess:function(e){this._navigateToMypage()}}),t.assignRoles(t.pc.unionraid.uniraid_000.SceneDelegate,[t.pc.roles.UIUtility,t.pc.unionraid.roles.Routing,t.pc.unionraid.roles.TemporaryRouterParams])}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.unionraid=t.pc.unionraid||{},t.pc.unionraid.uniraid_001=t.pc.unionraid.uniraid_001||{},t.pc.unionraid.uniraid_001.Scene=t.BaseScene.extend({resourceFileName:"uniraid_001/uniraid_001.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"unionraid",sceneName:"uniraid_001",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_daemon","btnCallbackBtnDaemon",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"unionraid/uniraid_002")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_lilim","btnCallbackBtnLilim",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"unionraid/uniraid_004")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_ranking","btnCallbackBtnRanking",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"unionraid/uniraid_008")),this._initButtonEvent.call(this,this.seekWidgetByPath("uniraid_btn_interchange_ui"),"btn_interchange","btnCallbackUniraidBtnInterchangeUiBtnInterchange",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"unionraid/uniraid_005")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_notice","btnCallbackBtnNotice",null,function(){alert("{{uniraid_attention}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_explain","btnCallbackBtnExplain",null,function(){alert("{{}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_unionchat","btnCallbackBtnUnionchat",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"guild/gud_008")),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._),i=e.Q;t.pc=t.pc||{},t.pc.unionraid=t.pc.unionraid||{},t.pc.unionraid.uniraid_001=t.pc.unionraid.uniraid_001||{},t.pc.unionraid.uniraid_001.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../uniraid_popup_ui.json"],_popups:{},onSceneInit:function(e){this._setBackBtn(e);var n=this._getEventId();return t.createInstance("UnionRaidBackgroundView",["001",n]).show(),this._initializePromise.spread(function(n,i,a,o){var r=a.getMyUnionId();t.createInstance("UnionChatButtonView").show(r),t.createInstance("UnionRaid001BattleSituationView").show(n),t.createInstance("UnionRaidBattleInfoView").show(a,i,n),t.createInstance("BurstTimeCountDownPanel").show(),t.createInstance("UnionRaidRewardReceiveBtnView").show(a),t.createInstance("HeaderView").displayHeader(o),t.createInstance("MinorRaidButtonView").show(e,o),t.createInstance("MajorRaidButtonView").show(e,o)})},onSceneEnter:function(e){this._verifyTemporaryRouterParams001(e);var t=this._getEventId();return this._initializePromise=this._prepareAllModel(t),i.resolve()},onSceneExit:function(e){return i.defer(),i.resolve()},onPageInAnimationEnd:function(e){var n=this._getEventId(),i=t.createInstance("unionRaidMasterModel");return i.prepare(n).then(function(){var e=i.getDescriptionImages().length,a=t.createInstance("UniRaid001InterruptsFactory").create(n,e);return t.createInstance("SceneInterruptManager",[a]).playIfNeed()})},_prepareAllModel:function(e){var a=t.createInstance("unionRaidBattleSituationModel"),o=t.createInstance("unionRaidPointModel"),r=t.createInstance("unionRaidModel"),s=t.createInstance("unionRaidMasterModel"),c=[a,o,r,s];return i.all(n.invoke(c,"prepare",e)).fail(function(e){console.warn(e.stack)}).thenResolve([a,o,r,s])},btnCallbackBtnDaemon:function(e){var t=i.defer();return t.reject(this._override),this._navigate001To002(e),t.promise},btnCallbackBtnLilim:function(e){var t=i.defer();return t.reject(this._override),this._navigate001To004(e),t.promise},btnCallbackUniraidBtnInterchangeUiBtnInterchange:function(e){var t=i.defer();return t.reject(this._override),this._navigate001To005(e),t.promise},btnCallbackBtnNotice:function(e){var n=i.defer(),a=t.createInstance("unionRaidModel"),o=t.createInstance("unionRaidMasterModel");return t.ImplantedPopup.createOrGet(e,"uniraid_attention","UnionRaidAttentionInfoPopup").open(a.getAttentionInfo(),o),n.reject(this._override),n.promise},btnCallbackBtnExplain:function(e){var n=this._getEventId(),a=t.createInstance("unionRaidMasterModel").getDescriptionImages().length;return t.ImplantedPopup.createOrGet(e,"sub_tutorial","ImplantedEventSubTutorialPopup").open(n,a),i.reject(this._override)},btnCallbackBtnUnionchat:function(e){var t=i.defer();t.reject(this._override);var n=this._getNavigationFrom(e);return this._navigateToUnionChat(n),t.promise},_getNavigationFrom:function(e){return{routes:t.createInstance("router").getCurrentFragment(),routerParams:e.routerParams,temporaryRouterParams:e.temporaryRouterParams}},btnCallbackBtnRanking:function(e){var t=this._getEventId();return this._navigateToUniraid008(t,"unionraid/uniraid_001"),i.reject(this._override)},_touchEndedBackBtnProcess:function(e){this._navigateEventPage()}}),t.assignRoles(t.pc.unionraid.uniraid_001.SceneDelegate,[t.pc.roles.UIUtility,t.pc.unionraid.roles.Routing,t.pc.unionraid.roles.TemporaryRouterParams])}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.pc=t.pc||{},t.pc.unionraid=t.pc.unionraid||{},t.pc.unionraid.uniraid_001=t.pc.unionraid.uniraid_001||{},t.pc.unionraid.uniraid_001.view=t.pc.unionraid.uniraid_001.view||{},t.pc.unionraid.uniraid_001.view.BattleSituation=t.SceneObject.extend({show:function(e){return e.isPrepareDay()?void this._animatePrepare():void this._animateHide()},_getStatusUiNode:function(){return cc.director.getRunningScene().seekWidgetByName("uniraid_battle_status_ui")},_animatePrepare:function(){this._getStatusUiNode().animate("status_preparing")},_animateHide:function(){this._getStatusUiNode().animate("nothing_view")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e._,e.Q,t.unionraid=t.unionraid||{},t.unionraid.unievent_001=t.unionraid.unievent_001||{},t.unionraid.unievent_001.PopupInvoker=t.SceneObject.extend({openLoginBonusPopup:function(){var e=n.director.getRunningScene();return t.ImplantedPopup.createOrGet(e,"unievent_login_bp","UnionRaidLoginBonusPopup").open()}})}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.unionraid=t.pc.unionraid||{},t.pc.unionraid.uniraid_002=t.pc.unionraid.uniraid_002||{},t.pc.unionraid.uniraid_002.Scene=t.BaseScene.extend({resourceFileName:"uniraid_002/uniraid_002.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[{tab1:{node:"tab_0","content-node":"tab_0_node"},tab2:{node:"tab_1","content-node":"tab_1_node"}}],componentName:"unionraid",sceneName:"uniraid_002",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_back_event_top","btnCallbackBtnBackEventTop",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"unionraid/uniraid_001")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_buff","btnCallbackBtnBuff",null,function(){alert("{{unievent_buff_check}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_lilim","btnCallbackBtnLilim",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"unionraid/uniraid_004")),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._),i=e.Q;t.pc=t.pc||{},t.pc.unionraid=t.pc.unionraid||{},t.pc.unionraid.uniraid_002=t.pc.unionraid.uniraid_002||{},t.pc.unionraid.uniraid_002.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../uniraid_popup_ui.json"],_popups:{},onSceneInit:function(e){this._setBackBtn(e);var a=this._getEventId();return t.createInstance("UnionRaidBackgroundView",["002",a]).show(),this._initializePromise.spread(function(o,r,s,c,u,l,_,p){n.each(["Expert","Ultimate"],function(n,i){var o="tab_"+i+"_node",r=e.seekWidgetByName(o),s=t.createInstance("UnionRaidBattleSituation"+n+"View"),u=t.createInstance("unionRaidBattleSituationModel"),p=t.createInstance("burstTime");s.show(r,u,p),this.questPoint=c.getQuestPoints(),this.joinCount=0,this.unverifyCount=l.getUnverifyCount(),this.playerId=_.getAPlayerId(),this._setRaidBattleListDisabled(r,u),this._fillupRaidBattleList(r,this._touchRaidPanel,a,n)},this);var d=t.createInstance("UniRaid002BuffPanelView");d.show(r,o,s),t.createInstance("HeaderView").displayHeader(p),t.createInstance("QuestPageMinorRaidButtonView").show(e,p),o.addEventListener("PROPERTY_CHANGED",function(){i.all([r.prepare(a),o.prepare(a)]).then(function(){d.show(r,o,s)})}.bind(this))}.bind(this))},_prepareAllModel:function(e){var n=t.createInstance("unionRaidDemonBuffModel"),a=t.createInstance("unionRaidBattleSituationModel"),o=t.createInstance("burstTime"),r=t.createInstance("playerQuestPointsModel"),s=t.createInstance("questInfoModel"),c=t.createInstance("battleUnverifiedModel"),u=t.createInstance("playerMeNumericModel"),l=t.createInstance("unionRaidMasterModel");return i.all([n.prepare(e).thenResolve(n),a.prepare(e).thenResolve(a),o.prepare().thenResolve(o),r.prepare(),s.prepare(),c.prepare(),u.prepare(),l.prepare(e)])},onSceneEnter:function(e){this._verifyTemporaryRouterParams002(e);var t=this._getEventId();return this._initializePromise=this._prepareAllModel(t),i.resolve()},onSceneExit:function(e){return(i.defer(),t.createInstance("unionRaidDemonBuffModel")).removeEventListenersByEventName("PROPERTY_CHANGED"),i.resolve()},onPageInAnimationEnd:function(e){return i.defer(),i.resolve()},tabCallbackTab0:function(e){},tabCallbackTab1:function(e){},btnCallbackBtnBackEventTop:function(e){var t=i.defer();return t.reject(this._override),this._navigate002To001(e),t.promise},btnCallbackBtnBuff:function(e){var n=i.defer();n.reject(this._override);var a=this._getEventId();return t.createInstance("UniRaid002PopupInvoker").openBuffUsePopup(a),n.promise},btnCallbackBtnLilim:function(e){var t=i.defer();return t.reject(this._override),this._navigate002To004(e),t.promise},_touchEndedBackBtnProcess:function(e){this._navigateToUniraidTop(this._getEventId(),"unionraid/uniraid_001")}}),n.assign(t.pc.unionraid.uniraid_002.SceneDelegate.prototype._popups,t.pc.quest.q_006_007_008.SceneDelegate.prototype._popups),t.assignRoles(t.pc.unionraid.uniraid_002.SceneDelegate,[t.pc.roles.UIUtility,t.pc.unionraid.roles.Routing,t.pc.unionraid.roles.TemporaryRouterParams,t.pc.quest.roles.RaidQuestPanel,t.pc.unionraid.roles.UnionRaidDemonListController])}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e._,e.Q,t.unionraid=t.unionraid||{},t.unionraid.unievent_002=t.unionraid.unievent_002||{},t.unionraid.unievent_002.PopupInvoker=t.SceneObject.extend({openBuffUsePopup:function(e){var i=n.director.getRunningScene();return t.ImplantedPopup.createOrGet(i,"unievent_buff_use","UnionRaidBuffUsePopup").open(e)},openBuffResultPopup:function(e){var i=n.director.getRunningScene();return t.ImplantedPopup.createOrGet(i,"unievent_buff_result","UnionRaidBuffResultPopup").open(e)},openBuffSuccessPopup:function(){var e=n.director.getRunningScene();return t.ImplantedPopup.createOrGet(e,"unievent_buff_result","UnionRaidBuffSuccessPopup").open()},openBuffErrorShortagePopup:function(e){var i=n.director.getRunningScene();return t.ImplantedPopup.createOrGet(i,"unievent_buff_error_a","UnionRaidBuffErrorShortagePopup").open(e)},openBuffErrorBattleFinishedPopup:function(){var e=n.director.getRunningScene();return t.ImplantedPopup.createOrGet(e,"unievent_buff_error_b","UnionRaidBuffErrorBattleFinishedPopup").open()},openBuffErrorLimitedPopup:function(){var e=n.director.getRunningScene();return t.ImplantedPopup.createOrGet(e,"unievent_buff_error_c","UnionRaidBuffErrorLimitedPopup").open()},openAQ003RankingPopup:function(e){var i=n.director.getRunningScene();return t.ImplantedPopup.createOrGet(i,"a_q_003_ui_ranking","AQ003RankingPopup").open(e)}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.pc=t.pc||{},t.pc.unionraid=t.pc.unionraid||{},t.pc.unionraid.uniraid_002=t.pc.unionraid.uniraid_002||{},t.pc.unionraid.uniraid_002.view=t.pc.unionraid.uniraid_002.view||{},t.pc.unionraid.uniraid_002.view.BattleSituation=t.SceneObject.extend({show:function(e,t,n){return this._parentNode=e,this._battleSituationModel=t,this._burstTimeModel=n,t.isPrepareDay()?void this._animatePrepare():(this._setUnionContributionPoint(),this._setSubjugationCount(),this._setNextUnionContributionPoint(),this._setNextSubjugationCount(),this._setUnionContributionPercent(),this._setSubjugationPercent(),void this._animateInBattle())},_getStatusUiNode:function(){return this._parentNode.seekWidgetByName("uniraid_battle_status_ui")},_getBaseNode:function(){var e=this._getBaseNodeName();return this._getStatusUiNode().seekWidgetByName(e)},_getUnionContributionLabel:function(){return this._getBaseNode().seekWidgetByName("union_total_p_no_label")},_getUnionContributionGauge:function(){return this._getBaseNode().seekWidgetByName("union_total_p_gauge")},_getSubjugationLabel:function(){return this._getBaseNode().seekWidgetByName("expedition_p_no_label")},_getSubjugationGauge:function(){return this._getBaseNode().seekWidgetByName("expedition_p_gauge")},_getNextUnionContributionLabel:function(){return this._getBaseNode().seekWidgetByName("union_total_p_next_label")},_getNextSubjugationLabel:function(){return this._getBaseNode().seekWidgetByName("expedition_p_next_label")},_animatePrepare:function(){this._getStatusUiNode().animate("status_preparing")},_animateNotBurstTime:function(){this._getStatusUiNode().animate("status_not_bursttime")},_animateInBattle:function(){var e=this._getStatusUiNode(),t=this._getInBattleAnimationName();e.animate(t)},_setUnionContributionPoint:function(){var e=this._getUnionContributionLabel(),t=this._battleSituationModel.getUnionContribution().getNowPoint();e.setString(""+t)},_setUnionContributionPercent:function(){var e=this._getUnionContributionGauge(),t=this._battleSituationModel.getUnionContribution().getGaugePercent();e.setPercent(t)},_setSubjugationCount:function(){var e=this._getSubjugationLabel(),t=this._getSubjugationCount();e.setString(""+t)},_setSubjugationPercent:function(){var e=this._getSubjugationGauge(),t=this._getSubjugationPercent();e.setPercent(t)},_setNextUnionContributionPoint:function(){var e=this._getNextUnionContributionLabel(),t=this._battleSituationModel.getUnionContribution().getNextRewardRemainingPoint();this._setNextNumLabel(e,t)},_setNextSubjugationCount:function(){var e=this._getNextSubjugationLabel(),t=this._getNextSubjugationCount();this._setNextNumLabel(e,t)},_setNextNumLabel:function(e,t){var n=""+(0===t?"-":t);e.setString(n)},_getSubjugationPercent:function(){return this._getSubjugationModel().getGaugePercent()},_getSubjugationCount:function(){return this._getSubjugationModel().getNowCount()},_getNextSubjugationCount:function(){return this._getSubjugationModel().getNextRewardRemainingCount()},_getBaseNodeName:function(){throw new Error("override me!")},_getInBattleAnimationName:function(){throw new Error("override me!")},_getSubjugationModel:function(){throw new Error("override me!")}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.pc=t.pc||{},t.pc.unionraid=t.pc.unionraid||{},t.pc.unionraid.uniraid_002=t.pc.unionraid.uniraid_002||{},t.pc.unionraid.uniraid_002.view=t.pc.unionraid.uniraid_002.view||{},t.pc.unionraid.uniraid_002.view.BattleSituationExpert=t.pc.unionraid.uniraid_002.view.BattleSituation.extend({_getBaseNodeName:function(){return"expert_base"},_getInBattleAnimationName:function(){return"status_expert"},_getSubjugationModel:function(){return this._battleSituationModel.getExpertSubjugation()}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.pc=t.pc||{},t.pc.unionraid=t.pc.unionraid||{},t.pc.unionraid.uniraid_002=t.pc.unionraid.uniraid_002||{},t.pc.unionraid.uniraid_002.view=t.pc.unionraid.uniraid_002.view||{},t.pc.unionraid.uniraid_002.view.BattleSituationUltimate=t.pc.unionraid.uniraid_002.view.BattleSituation.extend({_getBaseNodeName:function(){return"ultimate_base"},_getInBattleAnimationName:function(){return"status_ultimate"},_getSubjugationModel:function(){return this._battleSituationModel.getUltimateSubjugation()}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.pc=n.pc||{},n.pc.unionraid=n.pc.unionraid||{},n.pc.unionraid.uniraid_002=n.pc.unionraid.uniraid_002||{},n.pc.unionraid.uniraid_002.view=n.pc.unionraid.uniraid_002.view||{},n.pc.unionraid.uniraid_002.view.BuffPanel=n.SceneObject.extend({show:function(e,t,n){var i=e.getDayNum();this._setDayNum(i),e.canBuff()?this._enableBuffBtn():this._disableBuffBtn(),n.isInBurstTime()&&!e.isPrepareDay()?(this._startTimer(n),this._animateInBattle()):this._animateDefault(),this._setBuffLevel(t)},_setBuffLevel:function(e){var n=e.getBuffEffects();t.each(n,function(e,t){this._getBuffLabel(t).setString(""+e.getLevel())},this)},_startTimer:function(e){n.createInstance("UniRaid002BuffPanelTimerView").show(e)},_enableBuffBtn:function(){var e=this._getBuffBtn();e.setColor(cc.color("#FFFFFF")),e.setEnabled(!0)},_disableBuffBtn:function(){var e=this._getBuffBtn();e.setColor(cc.color("#808080")),e.setEnabled(!1)},_setDayNum:function(e){this._getDayNumNode().setString(""+e)},_getDayNumNode:function(){return cc.director.getRunningScene().seekWidgetByName("uniraid_info_buff_round_no_label")},_getBuffTimerNode:function(){return cc.director.getRunningScene().seekWidgetByName("uniraid_info_buff_battle_time")},_getBuffLabel:function(e){return cc.director.getRunningScene().seekWidgetByName("buff_p_no_label_"+e)},_getBuffBtn:function(){return cc.director.getRunningScene().seekWidgetByName("btn_buff")},_animateDefault:function(){this._getBuffTimerNode().animate("default_view")},_animateInBattle:function(){this._getBuffTimerNode().animate("in_battle")}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.pc=t.pc||{},t.pc.unionraid=t.pc.unionraid||{},t.pc.unionraid.uniraid_002=t.pc.unionraid.uniraid_002||{},t.pc.unionraid.uniraid_002.view=t.pc.unionraid.uniraid_002.view||{},t.pc.unionraid.uniraid_002.view.BuffPanelTimer=cc.Node.extend({UPDATE_INTERVAL:.5,show:function(e){cc.director.getRunningScene().addChild(this),this._burstTimeModel=e,this._updateCount(),this._startCountDown()},_updateCount:function(){var e=this._burstTimeModel.getRemainingTimeSimple();this._getRemainingTimeLabel().setString(e)},_startCountDown:function(){this.schedule(this._updateCount,this.UPDATE_INTERVAL)},_stopCountDown:function(){this.unschedule(this._updateCount)},_getRemainingTimeLabel:function(){return cc.director.getRunningScene().seekWidgetByName("uniraid_battle_time_font")}})}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.unionraid=t.pc.unionraid||{},t.pc.unionraid.uniraid_004=t.pc.unionraid.uniraid_004||{},t.pc.unionraid.uniraid_004.Scene=t.BaseScene.extend({resourceFileName:"uniraid_004/uniraid_004.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"unionraid",sceneName:"uniraid_004",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_back_event_top","btnCallbackBtnBackEventTop",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"unionraid/uniraid_001")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_daemon","btnCallbackBtnDaemon",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"unionraid/uniraid_002")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_raid_01","btnCallbackBtnRaid01",null,function(){alert("{{q_006_7_8 tab_0(q_006)}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_raid_02","btnCallbackBtnRaid02",null,function(){alert("{{q_006_7_8 tab_0(q_006)}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._),i=e.Q;t.pc=t.pc||{},t.pc.unionraid=t.pc.unionraid||{},t.pc.unionraid.uniraid_004=t.pc.unionraid.uniraid_004||{},t.pc.unionraid.uniraid_004.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../uniraid_popup_ui.json"],_popups:{},questCommonDelegate:new t.QuestScenePcCommonDelegate,onSceneInit:function(e){this._setBackBtn(e);var n=this._getEventId();return t.createInstance("UnionRaidBackgroundView",["004",n]).show(),this._hideList(e),this._initializePromise.spread(function(i,a,o,r,s){var c=i.hasNewRaidRequest(),u=i.hasUnverified();t.createInstance("RaidButtonView").show(c,u),t.createInstance("BurstTimeCountDownPanel").show(),t.createInstance("HeaderView").displayHeader(s),t.createInstance("MajorRaidButtonView").show(e,s);var l=a.getBuffEffectItem();t.createInstance("BuffEffectItemView").show(e,l),this._questInfo=i.getRawData(),this._questPoints=o.getQuestPoints(),this._player=r.getRawData(),this.questCommonDelegate.owner=e,this._fillupQuestMainList(e,this._touchQuestPanel,n)}.bind(this))},_allModelPrepare:function(e){var n=t.createInstance("questInfoModel"),a=t.createInstance("unionRaidItemModel"),o=t.createInstance("playerQuestPointsModel"),r=t.createInstance("playerMeModel"),s=t.createInstance("unionRaidMasterModel");return i.all([n.prepare(),a.prepare(e),o.prepare(),r.prepare(),s.prepare(e)])},onSceneEnter:function(e){this._verifyTemporaryRouterParams004(e);var t=this._getEventId();return this._setEventIdToApBpPopup(t),this._initializePromise=this._allModelPrepare(t),i.resolve()},onSceneExit:function(e){return i.defer(),i.resolve()},onPageInAnimationEnd:function(e){return i.defer(),i.resolve()},clearOwnQuest:function(){delete this._questInfo.in_progress.own_quest},btnCallbackBtnBackEventTop:function(e){var t=i.defer();return t.reject(this._override),this._navigate004To001(e),t.promise},btnCallbackBtnDaemon:function(e){var t=i.defer();return t.reject(this._override),this._navigate004To002(e),t.promise},btnCallbackBtnRaid01:function(e){var t=i.defer();return t.reject(this._override),this._navigate004ToQ006(e),t.promise},btnCallbackBtnRaid02:function(e){var t=i.defer();return t.reject(this._override),this._navigate004ToQ006(e),t.promise},startQuest:function(e,t,n,i){this._navigate004ToQ009(e,t,i)},update:function(){t.createInstance("sceneManager").reloadScene()},_setEventIdToApBpPopup:function(e){t.createInstance("popupFactoryComNeedApBp2").setEventId(e)},_touchEndedBackBtnProcess:function(e){this._navigateToUniraidTop(this._getEventId(),"unionraid/uniraid_001")}}),n.assign(t.pc.unionraid.uniraid_004.SceneDelegate.prototype._popups,t.pc.quest.q_001.SceneDelegate.prototype._popups,t.pc.quest.roles.QuestSelectCommon.popups._popups,t.pc.quest.roles.QuestMainPageListPopups._popups),t.assignRoles(t.pc.unionraid.uniraid_004.SceneDelegate,[t.pc.roles.UIUtility,t.pc.unionraid.roles.Routing,t.pc.unionraid.roles.TemporaryRouterParams,t.pc.quest.roles.MainQuestPanel,t.pc.unionraid.roles.UnionRaidLilimListController,t.pc.quest.roles.QuestSelectCommon.methods])}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.unionraid=t.pc.unionraid||{},t.pc.unionraid.uniraid_005=t.pc.unionraid.uniraid_005||{},t.pc.unionraid.uniraid_005.Scene=t.BaseScene.extend({resourceFileName:"uniraid_005/uniraid_005.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[{tab1:{node:"tab_0","content-node":"tab_0_node"},tab2:{node:"tab_1","content-node":"tab_1_node"},tab3:{node:"tab_2","content-node":"tab_2_node"}}],componentName:"unionraid",sceneName:"uniraid_005",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_back_event_top","btnCallbackBtnBackEventTop",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"unionraid/uniraid_001")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_present","btnCallbackBtnPresent",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"present/prs_001")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_receive","btnCallbackBtnReceive",null,function(){alert("{{prs_receive_result}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_expert","btnCallbackBtnExpert",null,function(){alert("{{EXPERT}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_ultimate","btnCallbackBtnUltimate",null,function(){alert("{{ULTIMATE}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc=t.pc||{},t.pc.unionraid=t.pc.unionraid||{},t.pc.unionraid.uniraid_005=t.pc.unionraid.uniraid_005||{},$staticRes(res["core-popup-com_new_member"]),t.pc.unionraid.uniraid_005.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../uniraid_popup_ui.json"],_popups:{comNewMember:{factoryName:"popupFactoryPopupCommon",resourceName:"core-popup-com_new_member",title:"",buttonLabels:{blackBtn:""},buttons:{blackBtn:function(e){this.dismiss()}}}},_tabToRequiredItemTable:[{tabIndex:0,baseNodeName:"tab_0_node",itemName:"total_personal_contribution_point"},{tabIndex:1,baseNodeName:"tab_1_node",itemName:"total_union_contribution_point"},{tabIndex:2,baseNodeName:"expert_node",itemName:"expert_subjugation_count"},{tabIndex:2,baseNodeName:"ultimate_node",itemName:"ultimate_subjugation_count"}],onSceneInit:function(e){this._setBackBtn(e),this._pushedExpertBtn();var n=this._getEventId();return t.createInstance("UnionRaidBackgroundView",["002",n]).show(),this._initializePromise.spread(function(i,a,o){t.createInstance("UnionRaidPointView").show(o,a);var r=t.createInstance("UniRaid005RewardReceiptDeadlineView"),s=i.getRewardReceiptDeadline();r.show(s),this._rewardPageListController=[],this._fillupRewardsList(e,n,0),this._toggleNotifyIconOfTabs(e,i)}.bind(this))},_allModelPrepare:function(e){var n=(t.createInstance("unionRaidModel"),t.createInstance("unionRaidBattleSituationModel")),i=t.createInstance("unionRaidPointModel");return a.all([this._prepareUnionRaidModel(e),n.prepare(e),i.prepare(e)])},_prepareUnionRaidModel:function(e){return t.createInstance("unionRaidModel").prepare(e)},onSceneEnter:function(e){this._verifyTemporaryRouterParams005(e);var t=this._getEventId();return this._initializePromise=this._allModelPrepare(t),a.resolve()},onSceneExit:function(e){return a.defer(),a.resolve()},onPageInAnimationEnd:function(e){return a.defer(),a.resolve()},tabCallbackTab0:function(e){this._hideExpertList(),this._hideUltimateList(),this._currentType=i.find(this._tabToRequiredItemTable,{tabIndex:0}).itemName,this._updateReceiveAllButton(e),this._fillupRewardsList(e,this._getEventId(),0)},tabCallbackTab1:function(e){this._hideExpertList(),this._hideUltimateList(),this._currentType=i.find(this._tabToRequiredItemTable,{tabIndex:1}).itemName,this._updateReceiveAllButton(e),this._fillupRewardsList(e,this._getEventId(),1)},tabCallbackTab2:function(e){this._isSelectedExpert()?(this._showExpertList(),this._pushedExpertBtn(),this._fillupRewardsList(e,this._getEventId(),2)):(this._showUltimateList(),this._pushedUltimateBtn(),this._fillupRewardsList(e,this._getEventId(),3)),this._updateReceiveAllButton(e)},btnCallbackBtnBackEventTop:function(e){var n=a.defer();n.reject(this._override);var i=t.createInstance("unionRaidModel").isReceiveRewardEvent();return this._navigate005ToEventTop(e,i),n.promise},btnCallbackBtnPresent:function(){var e=a.defer();return e.reject(this._override),this.navigateUniraid005ToPrs001(),e.promise},btnCallbackBtnReceive:function(e){var t=a.defer();return t.reject(this._override),this._receiveAllPresent(),t.promise},btnCallbackBtnExpert:function(e){var t=a.defer();return t.reject(this._override),this._isSelectedExpert()?t.promise:(this._pushedExpertBtn(),this._fillupRewardsList(e,this._getEventId(),2),this._updateReceiveAllButton(e),t.promise)},btnCallbackBtnUltimate:function(e){var t=a.defer();return t.reject(this._override),this._isSelectedExpert()?(this._pushedUltimateBtn(),this._fillupRewardsList(e,this._getEventId(),3),this._updateReceiveAllButton(e),t.promise):t.promise},_isSelectedExpert:function(){var e=this._getExpertBtnNode();return null!=e&&!e.bright},_showExpertList:function(){var e=this._getExpertBaseNode();e&&(e.setVisible(!0),this._currentType=i.find(this._tabToRequiredItemTable,{tabIndex:2,baseNodeName:"expert_node"}).itemName)},_showUltimateList:function(){var e=this._getUltimateBaseNode();e&&(e.setVisible(!0),this._currentType=i.find(this._tabToRequiredItemTable,{tabIndex:2,baseNodeName:"ultimate_node"}).itemName)},_hideExpertList:function(){var e=this._getExpertBaseNode();e&&e.setVisible(!1)},_hideUltimateList:function(){var e=this._getUltimateBaseNode();e&&e.setVisible(!1)},_pushedExpertBtn:function(){var e=this._getExpertBtnNode();if(null!=e){var t=this._getUltimateBtnNode();null!=t&&(e.setSoundEnabled(!1),e.setBright(!1),t.setBright(!0),t.setSoundEnabled(!0),this._showExpertList(),this._hideUltimateList())}},_pushedUltimateBtn:function(){var e=this._getExpertBtnNode();if(null!=e){var t=this._getUltimateBtnNode();null!=t&&(e.setSoundEnabled(!0),e.setBright(!0),t.setBright(!1),t.setSoundEnabled(!1),this._hideExpertList(),this._showUltimateList())}},_getExpertBaseNode:function(){return n.director.getRunningScene().seekWidgetByName("expert_node")},_getUltimateBaseNode:function(){return n.director.getRunningScene().seekWidgetByName("ultimate_node")},_getExpertBtnNode:function(){return n.director.getRunningScene().seekWidgetByName("btn_expert")},_getUltimateBtnNode:function(){return n.director.getRunningScene().seekWidgetByName("btn_ultimate")},_receiveAllPresent:function(){var e=this._getEventId();t.createInstance("apiAEvents").receiveAllUnionRaidRewards(e,this._currentType).then(function(e){var t=e.body;this.refreshPage();this._receiveAllPresentShowResult(t.received_info,t.not_received_info,"\r\n").then(function(){var e=t.new_character_gained_list;i.isEmpty(e)||this._showNewMemberPopup(e)}.bind(this))}.bind(this)).fail(function(e){console.error(e)})},_receivePresent:function(e){var n=this._getEventId();t.createInstance("apiAEvents").receiveUnionRaidReward(n,e).then(function(e){this.refreshPage();var t=e.body;if(!i.isUndefined(t)){var n=t.new_characters_gained;i.isEmpty(n)||this._showNewMemberPopup(n)}}.bind(this)).fail(function(e){console.error(e)})},refreshPage:function(){var e=n.director.getRunningScene();t.createInstance("notificationCenter").dispatchEvent(t.core.pager.controller.PagerController.prototype.REFRESH_EVENT,[]);var i=t.createInstance("unionRaidModel");i.update().then(function(){this._toggleNotifyIconOfTabs(e,i),this._updateReceiveAllButton(e)}.bind(this))},_updateReceiveAllButton:function(e){var t=e.seekWidgetByName("btn_receive");if(null!==t&&!i.isUndefined(this._currentType)){var a=this._getEventId();this._prepareUnionRaidModel(a).then(function(e){var i=e.hasNewRewards(this._currentType);t.setEnabled(i),t.setColor(i?n.color.WHITE:n.color("#808080"))}.bind(this))}},_fillupRewardsList:function(e,n,i){if(this._rewardPageListController){if(this._rewardPageListController[i])return void this._rewardPageListController[i].refresh();var a=this._tabToRequiredItemTable[i],o=new t.unionraid.settings.EventRewardPageListSetting(a.baseNodeName,n,a.itemName),r=new t.unionraid.eventHandling.ReceiveConfirmedEventHandler(n),s=new t.unionraid.controller.EventRewardPageListController(o,r);s.displayRewards(),this._rewardPageListController[i]=s}},_toggleNotifyIconOfTabs:function(e,t){this._hideAllTabIcon(e),i.each(this._tabToRequiredItemTable,function(n){var i=this._getIconNode(e,n.tabIndex),a=t.hasNewRewards(n.itemName);null!==i&&a&&i.setVisible(!0)},this)},_hideAllTabIcon:function(e){i.each(this._tabToRequiredItemTable,function(t){var n=this._getIconNode(e,t.tabIndex);null!==n&&n.setVisible(!1)},this)},_getIconNode:function(e,t){return e.seekWidgetByName("icon_"+t)},_touchEndedBackBtnProcess:function(e){var n=t.createInstance("unionRaidModel").isReceiveRewardEvent();this._navigate005ToEventTop(e,n)}}),t.assignRoles(t.pc.unionraid.uniraid_005.SceneDelegate,[t.pc.roles.UIUtility,t.pc.unionraid.roles.Routing,t.pc.unionraid.roles.TemporaryRouterParams,t.pc.roles.ShInfoPopupInvoker,t.pc.present.roles.PresentPopups])}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.unionraid=t.unionraid||{},t.unionraid.view=t.unionraid.view||{},t.pc.unionraid=t.pc.unionraid||{},t.pc.unionraid.uniraid_005=t.pc.unionraid.uniraid_005||{},t.pc.unionraid.uniraid_005.view=t.pc.unionraid.uniraid_005.view||{},t.pc.unionraid.uniraid_005.view.RewardReceiptDeadline=t.SceneObject.extend({show:function(e){this._setRewardReceiptDeadlineLable(e)},_getRewardReceiptDeadlineLable:function(){return cc.director.getRunningScene().seekWidgetByName("limit_date_label")},_setRewardReceiptDeadlineLable:function(e){var t=this._getRewardReceiptDeadlineLable();t&&t.setString(e+" ")}})}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.unionraid=t.pc.unionraid||{},t.pc.unionraid.uniraid_007=t.pc.unionraid.uniraid_007||{},t.pc.unionraid.uniraid_007.Scene=t.BaseScene.extend({resourceFileName:"uniraid_007/uniraid_007.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"unionraid",sceneName:"uniraid_007",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath("uniraid_btn_interchange_ui"),"btn_interchange","btnCallbackUniraidBtnInterchangeUiBtnInterchange",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"unionraid/uniraid_005")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_unionchat","btnCallbackBtnUnionchat",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"guild/gud_008")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_ranking","btnCallbackBtnRanking",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"unionraid/uniraid_008")),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._,e.Q);e.console,t.pc=t.pc||{},t.pc.unionraid=t.pc.unionraid||{},t.pc.unionraid.uniraid_007=t.pc.unionraid.uniraid_007||{},t.pc.unionraid.uniraid_007.SceneDelegate=t.pc.BaseSceneDelegate.extend({_popups:{},onSceneInit:function(e){this._setBackBtn(e);var n=this._getEventId();return t.createInstance("UnionRaidBackgroundView",["007",n]).show(),this._initializePromise.spread(function(e,n,i,a,o,r){var s=e.getMyUnionId();t.createInstance("UnionChatButtonView").show(s),t.createInstance("UnionRaidBattleInfoView").show(e,a,n);var c=t.createInstance("UniRaid005RewardReceiptDeadlineView"),u=e.getRewardReceiptDeadline();c.show(u),t.createInstance("UnionRaidRewardReceiveBtnView").show(e),e.firstAccess(),t.createInstance("UnionRaidRankingRewardBtnView").show(o),t.createInstance("HeaderView").displayHeader(r)}.bind(this))},_allModelPrepare:function(e){var i=t.createInstance("unionRaidModel"),a=t.createInstance("unionRaidBattleSituationModel"),o=t.createInstance("unionRaidPointModel"),r=t.createInstance("unionRaidPointModel"),s=t.createInstance("unionRaidMasterModel");return n.all([i.prepare(e),a.prepare(e),o.prepare(e),r.prepare(e),t.createInstance("RewardObtainmentInfoRepository").import(),s.prepare(e)])},onSceneEnter:function(e){this._verifyTemporaryRouterParams007(e);var i=this._getEventId();return t.createInstance("apiAEventsBridge").setupEventId(i),this._initializePromise=this._allModelPrepare(i),n.resolve()},onSceneExit:function(e){return n.defer(),n.resolve()},onPageInAnimationEnd:function(e){return n.defer(),n.resolve()},btnCallbackUniraidBtnInterchangeUiBtnInterchange:function(e){var t=n.defer();return t.reject(this._override),this._navigate007To005(e),t.promise},btnCallbackBtnRanking:function(e){var t=this._getEventId();return this._navigateToUniraid008(t,"unionraid/uniraid_007"),n.reject(this._override)},btnCallbackBtnUnionchat:function(e){var t=n.defer();t.reject(this._override);var i=this._getNavigationFrom(e);return this._navigateToUnionChat(i),t.promise},_getNavigationFrom:function(e){return{routes:t.createInstance("router").getCurrentFragment(),routerParams:e.routerParams,temporaryRouterParams:e.temporaryRouterParams}},_touchEndedBackBtnProcess:function(e){this._navigateEventPage()}}),t.assignRoles(t.pc.unionraid.uniraid_007.SceneDelegate,[t.pc.roles.UIUtility,t.pc.unionraid.roles.Routing,t.pc.unionraid.roles.TemporaryRouterParams])}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.unionraid=t.pc.unionraid||{},t.pc.unionraid.uniraid_008=t.pc.unionraid.uniraid_008||{},t.pc.unionraid.uniraid_008.Scene=t.BaseScene.extend({resourceFileName:"uniraid_008/uniraid_008.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[{tab1:{node:"tab_0","content-node":"tab_0_node"},tab2:{node:"tab_1","content-node":"tab_1_node"},tab3:{node:"tab_2","content-node":"tab_2_node"}}],componentName:"unionraid",sceneName:"uniraid_008",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_back_event_top","btnCallbackBtnBackEventTop",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"unionraid/uniraid_001")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_ranking_reward","btnCallbackBtnRankingReward",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"unionraid/uniraid_009")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_rule","btnCallbackBtnRule",null,function(){alert("{{uniraid_rankinginfo}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=(e._,e.Q);t.pc=t.pc||{},t.pc.unionraid=t.pc.unionraid||{},t.pc.unionraid.uniraid_008=t.pc.unionraid.uniraid_008||{},t.pc.unionraid.uniraid_008.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../uniraid_popup_ui.json"],RANKING_TYPE_BY_TABINDEX:{0:"EXPERT",1:"ULTIMATE",2:"INDIVIDUAL"},_popups:{},onSceneInit:function(e){return this._setBackBtn(e),t.createInstance("RankingPageInitializeEventHandler").handle(),this._onTabChangeEventHandler=t.createInstance("RankingPageOnTabChangeEventHandler"),i.resolve()},_showRankingBtn:function(e){var n=t.pc.unionraid.roles.TemporaryRouterParams._getEventId();t.createInstance("apiAEventsBridge").setupEventId(n),i.all([t.createInstance("RewardObtainmentInfoRepository").import(),e.initSceneUILoadPromise]).spread(function(e){t.createInstance("UnionRaidRankingRewardBtnView").show(e,"btn_ranking_reward")}.bind(this))},onSceneEnter:function(e){this._showRankingBtn(e);var n=t.pc.unionraid.roles.TemporaryRouterParams._getEventId();return t.createInstance("unionRaidMasterModel").prepare(n).then(function(e){this._unionRaidMasterModel=e}.bind(this))},tabCallbackTab0:function(e){this._fireOnTabChangeEvent(0)},tabCallbackTab1:function(e){this._fireOnTabChangeEvent(1)},tabCallbackTab2:function(e){this._fireOnTabChangeEvent(2)},_fireOnTabChangeEvent:function(e){var t=this._getRankingTypeByTabIndex(e);this._onTabChangeEventHandler.handle(t,this._unionRaidMasterModel)},_getRankingTypeByTabIndex:function(e){return t.unionraid.enums.RANKING_TYPE[this.RANKING_TYPE_BY_TABINDEX[e]]},btnCallbackBtnBackEventTop:function(e){return this._touchEndedBackBtnProcess(e),i.reject(this._override)},btnCallbackBtnRankingReward:function(e){var n=t.pc.unionraid.roles.TemporaryRouterParams._getEventId();return t.createInstance("router").navigate("unionraid/uniraid_009",{},{event_id:n,backTo:t.createInstance("router").getCurrentFragment()}),i.reject(this._override)},btnCallbackBtnRule:function(e){var n=i.defer();n.reject(this._override);var a=this._getRankingTypeFromCurrentTab(),o=this._unionRaidMasterModel.getUnionRaidType();return t.createInstance("RuleButtonTouchEventHandler").handle(a,o),n.promise},_getRankingTypeFromCurrentTab:function(){var e=n.director.getRunningScene().tabDelegateList[0].selected.replace("tab_","");return this._getRankingTypeByTabIndex(e)},_touchEndedBackBtnProcess:function(e){var t=this._getNavigateFrom(e);this._navigateFromBack(t)},_getNavigateFrom:function(e){var n=e.temporaryRouterParams.backTo;return n||(n=t.createInstance("unionRaidMasterModel").isReceiveReward()?"unionraid/uniraid_007":"unionraid/unionraid_001"),{routes:n,temporaryRouterParams:e.temporaryRouterParams}}}),t.assignRoles(t.pc.unionraid.uniraid_008.SceneDelegate,[t.pc.roles.UIUtility,t.pc.unionraid.roles.Routing,t.pc.unionraid.roles.TemporaryRouterParams])}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.unionraid=t.pc.unionraid||{},t.pc.unionraid.uniraid_009=t.pc.unionraid.uniraid_009||{},t.pc.unionraid.uniraid_009.Scene=t.BaseScene.extend({resourceFileName:"uniraid_009/uniraid_009.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[{tab1:{node:"tab_0","content-node":"tab_0_node"},tab2:{node:"tab_1","content-node":"tab_1_node"},tab3:{node:"tab_2","content-node":"tab_2_node"}}],componentName:"unionraid",sceneName:"uniraid_009",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_back_ranking","btnCallbackBtnBackRanking",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"unionraid/uniraid_008")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_present","btnCallbackBtnPresent",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"present/prs_001")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_receive","btnCallbackBtnReceive",null,function(){alert("{{prs_receive_result}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc=t.pc||{},t.pc.unionraid=t.pc.unionraid||{},t.pc.unionraid.uniraid_009=t.pc.unionraid.uniraid_009||{},$staticRes(res["core-popup-com_new_member"]),t.pc.unionraid.uniraid_009.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../uniraid_popup_ui.json"],_tabToRequiredItemTable:[{tabIndex:0,baseNodeName:"tab_0_node",itemName:"expert"},{tabIndex:1,baseNodeName:"tab_1_node",itemName:"ultimate"},{tabIndex:2,baseNodeName:"tab_2_node",itemName:"individual"}],BTNS_PAGE_LIST_PARAMS_NAME:"UNION_RAID_RANKING_REWARDS",_popups:{comNewMember:{factoryName:"popupFactoryPopupCommon",resourceName:"core-popup-com_new_member",title:"",buttonLabels:{blackBtn:""},buttons:{blackBtn:function(e){this.dismiss()}}}},onSceneInit:function(e){this._setBackBtn(e);var n=this._getEventId();return t.createInstance("UnionRaidBackgroundView",["002",n]).show(),this._rankingRewardInfoLabel=t.createInstance("RankingRewardInfoLabelController"),this._receiveDeadlineLabels=t.createInstance("RankingRewardsReceiveDeadlineController"),this._rankLabel=t.createInstance("RankLabelController"),this._rankingRewardInfoLabel=t.createInstance("RankingRewardInfoLabelController"),this._gotoPresentButton=t.createInstance("GotoPresentButtonController"),this._receiveAllButton=t.createInstance("ReceiveAllButtonController"),this._rankingRewardInfoLabel.clear(),this._receiveDeadlineLabels.clear(),this._rankLabel.clear(),this._rankingRewardInfoLabel.clear(),this._gotoPresentButton.clear(),this._receiveAllButton.clear(),this._initializePromise.spread(function(i,a){this._rankingRewardInfoLabel.display(i),this._receiveDeadlineLabels.display(i),this._rankLabel.display(i,this._currentType),this._rankingRewardInfoLabel.display(i),this._gotoPresentButton.display(i),this._receiveAllButton.display(i),this._rewardPageListController=[],this._fillupRewardsList(e,n,0),this._rewardTabExclamationView=t.createInstance("RewardTabExclamationView"),this._rewardTabExclamationView.display(a),this._obtainInfoModel=a,this._updateUiForTabChange(e)}.bind(this))},_allModelPrepare:function(e){return t.createInstance("unionRankingEventModel"),a.all([this._prepareUnionRankingModel(e),this._prepareRewardObtainmentInfoModel()])},_prepareUnionRankingModel:function(e){return t.createInstance("unionRankingEventModel").prepare(e)},_prepareRewardObtainmentInfoModel:function(){return t.createInstance("RewardObtainmentInfoRepository").import()},onSceneEnter:function(e){this._verifyTemporaryRouterParams009(e);var n=this._getEventId();return t.createInstance("apiAEventsBridge").setupEventId(n),this._initializePromise=this._allModelPrepare(n),a.resolve()},onSceneExit:function(e){return a.defer(),a.resolve()},onPageInAnimationEnd:function(e){return a.defer(),a.resolve()},tabCallbackTab0:function(e){this._currentType=i.find(this._tabToRequiredItemTable,{tabIndex:0}).itemName,this._updateUiForTabChange(e),this._fillupRewardsList(e,this._getEventId(),0)},tabCallbackTab1:function(e){this._currentType=i.find(this._tabToRequiredItemTable,{tabIndex:1}).itemName,this._updateUiForTabChange(e),this._fillupRewardsList(e,this._getEventId(),1)},tabCallbackTab2:function(e){this._currentType=i.find(this._tabToRequiredItemTable,{tabIndex:2}).itemName,this._updateUiForTabChange(e),this._fillupRewardsList(e,this._getEventId(),2)},btnCallbackBtnBackRanking:function(e){var t=a.defer();return t.reject(this._override),this._navigate009To008(e),t.promise},btnCallbackBtnPresent:function(e){var t=a.defer();return t.reject(this._override),this.navigateUniraid009ToPrs001(),t.promise},btnCallbackBtnReceive:function(e){var t=a.defer();return t.reject(this._override),this._receiveAllPresent(),t.promise},_receiveAllPresent:function(){var e=this._getEventId();t.createInstance("apiAEvents").receiveAllUnionRaidRankingRewards(e,this._currentType).then(function(e){var t=e.body;this.refreshPage();this._receiveAllPresentShowResult(t.received_info,t.not_received_info,"\r\n").then(function(){var e=t.new_character_gained_list;i.isEmpty(e)||this._showNewMemberPopup(e)}.bind(this))}.bind(this)).fail(function(e){console.error(e.stack)})},_receivePresent:function(e){var n=this._getEventId();t.createInstance("apiAEvents").receiveUnionRaidRankingReward(n,e).then(function(e){this.refreshPage();var t=e.body;if(!i.isUndefined(t)){var n=t.new_characters_gained;i.isEmpty(n)||this._showNewMemberPopup(n)}}.bind(this)).fail(function(e){console.error(e.stack)})},_showNewMemberPopup:function(e){if(i.isArray(e))var a=e.shift();else{a=e;e=[]}var o=n.director.getRunningScene().popups.comNewMember;o.open().then(function(n){this._setCharacterCoreCardElementRarity(o,a,"corecard_chara_ui");var i=o.seekWidgetByName("party_join_label");null!==i&&i.setString(a.name+"\n"),t.setTouchEventHandlers(o,{"TOUCH_ENDED black_btn":function(){o.dismiss(),e.length>0&&this._showNewMemberPopup(e)}.bind(this)},this)}.bind(this))},refreshPage:function(){var e=n.director.getRunningScene();t.createInstance("notificationCenter").dispatchEvent(t.core.pager.controller.PagerController.prototype.REFRESH_EVENT,[]),t.createInstance("RewardObtainmentInfoRepository").import().then(function(t){this._rewardTabExclamationView.display(t),this._obtainInfoModel=t,this._updateUiForTabChange(e)}.bind(this))},_updateUiForTabChange:function(e){var n=t.createInstance("unionRankingEventModel");(n.isPrepared()&&this._rankLabel.display(n,this._currentType),i.isUndefined(this._obtainInfoModel)||i.isUndefined(this._receiveAllButton))||(this._obtainInfoModel.canObtainRewardsByName(this._currentType)?this._receiveAllButton.enable():this._receiveAllButton.disable())},_fillupRewardsList:function(e,n,a){if(this._rewardPageListController){if(this._rewardPageListController[a])return void this._rewardPageListController[a].refresh();var o=i.find(this._tabToRequiredItemTable,{tabIndex:a}),r=new t.unionraid.settings.RankingRewardPageListSetting(o.baseNodeName,n,o.itemName),s=new t.unionraid.eventHandling.RankingReceiveConfirmedEventHandler(n),c=new t.unionraid.controller.RankingRewardPageListController(r,s);c.displayRewards(),this._rewardPageListController[a]=c}},_touchEndedBackBtnProcess:function(e){this._navigate009To008()}}),t.assignRoles(t.pc.unionraid.uniraid_009.SceneDelegate,[t.pc.roles.UIUtility,t.pc.unionraid.roles.Routing,t.pc.unionraid.roles.TemporaryRouterParams,t.pc.roles.ShInfoPopupInvoker,t.pc.present.roles.PresentPopups])}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.acce=n.acce||{},n.acce.view=n.acce.view||{},n.acce.view.AcceRemoveCheckPopup=n.ImplantedPopup.extend({UI_NODE_NAMES:{CHARACTER_NAME_LABEL:"chara_name_label",CORECARD_NODE:"corecard_chara_ui"},_uiNodes:{},_initContents:function(e){this._uiNodes=this._getUINodes(),this._setTextNodes(e),this._setCoreCard(e),this.setButtonEvents({btn_cancel:!1,btn_equip:!0})},_setTextNodes:function(e){var n={CHARACTER_NAME_LABEL:e.equipped_by.name};t.each(n,function(e,t){this._uiNodes[t].setText(e)}.bind(this))},_setCoreCard:function(e){var t=this._uiNodes.CORECARD_NODE,i=n.createInstance("CoreCardCharacterUI",["e_r",t]),a=e.equipped_by;i.setImg(a.character_id,a.skin||0),i.setIconElement(a.element_type),i.setIconRarity(a.rare),t.setVisible(!0)},_getUINodes:function(){return t.mapValues(this.UI_NODE_NAMES,function(e){return this._getNodeByName(e)}.bind(this))},_getNodeByName:function(e,n){(t.isUndefined(n)||null===n)&&(n=this._node);var i=n.seekWidgetByName(e);return i||console.warn("AcceRemoveCheckPopup._getByNode(): node '"+e+"' not found"),i}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;e.Q,t.pc.list=t.pc.list||{},t.pc.list.roles=t.pc.list.roles||{},t.pc.list.roles.ListAccessoriesCommon={_setAccessoryHeaderLabel:function(){var e=n.director.getRunningScene();return null===e.seekWidgetByName("header_sub_label")?void console.debug("[NOTICE] Could not find count label name."):void t.createInstance("apiAPlayers").get("me").then(function(t){var n=t.body;return i.isUndefined(n.accessory_num)||i.isUndefined(n.max_accessory_num)?void console.debug("[NOTICE] Could not find accessory_num | max_accessory_num."):void e.setStrings({header_sub_label:":"+n.accessory_num+"/"+n.max_accessory_num})}.bind(this)).fail(function(e){console.error(e.stack)})}}}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;e.Q,t.pc.acce=t.pc.acce||{},t.pc.acce.roles=t.pc.acce.roles||{},t.pc.acce.roles.AccessoryComponentCommon={_setAccessoryPointLabel:function(e){var n=this._getNodeByName("total_p_no_label"),i=t.createInstance("accessoryPointInfoModel");i.prepare().then(function(){n.setVisible(!0),n.setText(i.getAccessoryPoint().toString())})},_setAccessoryAmountLabel:function(e){var n=t.createInstance("accessoryInfoModel");n.prepare().then(function(){e.setVisible(!0);var t=":"+n.getAccessoryAmount()+"/"+n.getMaxAccessoryAmount();e.setText(t)})},_getNodeByName:function(e,t){i.isUndefined(t)&&(t=n.director.getRunningScene());var a=t.seekWidgetByName(e);return a||console.warn("AccessoryComponentCommon._getNodeByName(): node '"+e+"' not found"),a}}}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._),i=e.Q;t.pc.acce=t.pc.acce||{},t.pc.acce.controller=t.pc.acce.controller||{},t.pc.acce.controller.PageListSceneController={setting:{header_sub_label_node:"header_sub_label_xxxx_chara",header_sub_label:"",header_animation:null,select_animation:null,nothing_animation:null,btn_animation:null},_controller:null,init:function(e){return this.setHeaderLabels(),this.setPageList(e)},setPageList:function(e){var t=i.deferred();return console.warn("PageListSceneController.setPageList(): please implement"),t.promise},setHeaderLabels:function(){this.setting.header_animation&&this._setAppearanceHeaderLabel(),this._setHeaderSubLabel(),this.setting.select_animation&&this._setAppearanceSelectLabel(),this._setAccessoryPointLabel()},_setAppearanceHeaderLabel:function(){this._getNodeByName("acce_header_label_ui").setAppearance(this.setting.header_animation)},_setAppearanceSelectLabel:function(){this._getNodeByName("acce_select_label_ui").setAppearance(this.setting.select_animation)},_setHeaderSubLabel:function(){var e=this._getNodeByName(this.setting.header_sub_label_node);this._setAccessoryAmountLabel(e)},_hideAllHeaderLabels:function(){var e=this._getNodeByName("acce_header_label_ui");n.each(e.getChildren(),function(e){e.setVisible(!1)});var t=this._getNodeByName("acce_select_label_ui");n.each(t.getChildren(),function(e){e.setVisible(!1)})},_setPageResult:function(e){if(this._isNothingData())return this.setting.nothing_animation&&this._setAppearanceNothingNode(),void this._getNodeByName("nothing_node",e).setVisible(!0);this._getNodeByName("list_node",e).setVisible(!0),this.setting.btn_animation&&this._setAppearanceBtnNode()},_isNothingData:function(){return 0===this._controller.getDataList().getExistsRecordCount()},_setAppearanceNothingNode:function(){this._getNodeByName("acce_nothing_label_ui").setAppearance(this.setting.nothing_animation)},_setAppearanceBtnNode:function(){this._getNodeByName("acce_btn_ui").setAppearance(this.setting.btn_animation)},_touchListCoreCard:function(e,t){console.log("_touchListCoreCard")}},n.assign(t.pc.acce.controller.PageListSceneController,t.displayFilter.roles.DisplayFilterSceneController,t.pc.acce.roles.Routing,t.pc.acce.roles.AccessoryComponentCommon)}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);e.Q,t.pc.acce=t.pc.acce||{},t.pc.acce.controller=t.pc.acce.controller||{},t.pc.acce.controller.Scene002Controller={setting:{header_sub_label_node:"header_sub_label_equip_chara",header_sub_label:"",header_animation:"equip_chara_view",select_animation:"equip_chara_view",nothing_animation:null,btn_animation:"equip_view"},_createDisplayFilterSettings:function(){return{list_node:[t.displayFilter.enums.FILTER_NAME.SELECT_CHARA_FROM_ACCESSORY,"com_filter_chara"]}},setPageList:function(e){var n=t.core.pager.helper.coreCardListUI(e,{panelName:t.BtnsPageListParams.ACCESSORY_EQUIP_CHARACTER_LIST.panelName,baseName:e,apiName:"apiACharacters",apiMethod:"getList",apiParams:[t.displayFilter.enums.FILTER_NAME.SELECT_CHARA_FROM_ACCESSORY,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE],apiModel:t.core.model.ACharacter,cardType:"chara",cardFrame:"full",sortKey:"list_characters"},new t.core.eventHandling.BaseEventHandler(this._touchListCoreCard.bind(this,e),this));return this._controller=n,n.initialize().then(this._setPageResult.bind(this,e))},_setHeaderSubLabel:function(){var e=this._getNodeByName(this.setting.header_sub_label_node);this._getAPlayerMePromise().then(function(t){var n=t.body;e.setVisible(!0);var i=":"+n.character_num;e.setText(i)})},_getAPlayerMePromise:function(){return t.createInstance("myselfInfoRepository").getMe()},_touchListCoreCard:function(e,t){this._navigate002To006(e,t.getRawData())}},t.pc.acce.controller.Scene002Controller=n.merge({},t.pc.acce.controller.PageListSceneController,t.pc.acce.controller.Scene002Controller),n.assign(t.pc.acce.controller.Scene002Controller,t.pc.list.roles.Routing)}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);e.Q,t.pc.acce=t.pc.acce||{},t.pc.acce.controller=t.pc.acce.controller||{},t.pc.acce.controller.Scene003Controller={setting:{header_sub_label_node:"header_sub_label_equip_chara",header_sub_label:"",header_animation:"enh_view",select_animation:"enh_view",nothing_animation:"enh_view",btn_animation:"enh_view"},_createDisplayFilterSettings:function(){return{list_node:[t.displayFilter.enums.FILTER_NAME.ENH_BASE_ACCESSORY,"com_filter_other"]}},setPageList:function(e){var n=t.core.pager.helper.coreCardListUI(e,{panelName:t.BtnsPageListParams.ACCESSORY_ENH_BASE_LIST.panelName,baseName:e,apiName:"apiAAccessories",apiMethod:"getListEnhanceBase",apiParams:[t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE],apiModel:t.acce.model.Accessory,cardType:"acce",cardFrame:"full",sortKey:"enhance_base_accessories"},new t.core.eventHandling.BaseEventHandler(this._touchListCoreCard.bind(this,e),this));return this._controller=n,n.initialize().then(this._setPageResult.bind(this,e))},_touchListCoreCard:function(e,t){this._navigate003To008(t.getRawData().a_accessory_id)}},t.pc.acce.controller.Scene003Controller=n.merge({},t.pc.acce.controller.PageListSceneController,t.pc.acce.controller.Scene003Controller),n.assign(t.pc.acce.controller.Scene003Controller,t.pc.list.roles.Routing)}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._),i=e.Q;t.pc.acce=t.pc.acce||{},t.pc.acce.controller=t.pc.acce.controller||{},t.pc.acce.controller.Scene005Controller={_popups:{sell_auto_choose:{factoryName:"popupFactoryTextOnly",resource:"text_button_only.json",title:"",content:"N<br>",buttonLabels:{blackBtn:"",blueBtn:"OK"},buttons:{blackBtn:function(e){this.dismiss(),t.createInstance("notificationCenter").dispatchEvent("menu_close")},blueBtn:function(e){e._delegate._sceneController._confirmRecommendSell.apply(e._delegate._sceneController,[e,this.accessories]),this.dismiss(),t.createInstance("notificationCenter").dispatchEvent("menu_open")}},onPopupOpened:function(e,t){e.accessories=t}},enh_no_recommend_accessories:{factoryName:"popupFactoryTextOnly",resource:"text_button_only.json",title:"",content:"N<br>",buttonLabels:{blueBtn:"OK"},buttons:{blueBtn:function(e){this.dismiss()}}}},setting:{header_sub_label_node:"header_sub_label_sell",header_sub_label:"",header_animation:"sell_view",select_animation:"sell_view",nothing_animation:"sell_view",btn_animation:"sell_view"},_createDisplayFilterSettings:function(){return{list_node:[t.displayFilter.enums.FILTER_NAME.SELL_ACCESSORY,"com_filter_other"]}},_apiAAccessories:null,init:function(e){return this._apiAAccessories=t.createInstance("apiAAccessories"),this.setHeaderLabels(e),this.setPageList(e)},setPageList:function(e){var n=t.core.pager.helper.coreCardListUI(e,{panelName:t.BtnsPageListParams.SELLABLE_ACCESSORY_LIST.panelName,baseName:e,apiName:"apiAAccessories",apiMethod:"getSellableList",apiParams:[t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE],apiModel:t.acce.model.Accessory,cardType:"acce",cardFrame:"full",sortKey:"list_sell_accessories",maxSelectCount:20});return this._controller=n,n.addUpdateEventListener(function(e,n,i,a){t.pc.roles.UIUtility._setEnableButton(this,a.getSelectedData().length>0)},e.seekWidgetByName("btn_decision")),n.initialize().then(this._setBtns.bind(this,e)).then(this._setPageResult.bind(this,e))},_setBtns:function(e){if(!this._isNothingData()){var t=this._getNodeByName("btn_recommended");t.setVisible(!0),t.addTouchEventListener(function(t,n){n===ccui.Widget.TOUCH_ENDED&&this._btnCallBackSellAutoChoose(e)}.bind(this));var n=this._getNodeByName("btn_decision");n.setVisible(!0),n.addTouchEventListener(function(t,n){n===ccui.Widget.TOUCH_ENDED&&this._confirmSell(e)}.bind(this))}},_btnCallBackSellAutoChoose:function(e){this._getRecommendSellableList().then(function(n){var i=n.body.data;0!==i.length?(e.popups.sell_auto_choose.open(i),t.createInstance("notificationCenter").dispatchEvent("menu_open")):this._openAcceNonOfferPopup(e)}.bind(this)).fail(function(e){console.error(e.stack)})},_getRecommendSellableList:function(){return this._apiAAccessories.getRecommendSellableList().fail(function(e){console.error(e.stack)})},_confirmSell:function(e){var t=this._controller.getSelectedData().map(function(e){return e.getRawData()});this._openAcceListSellCheckPopup(e,t)},_confirmRecommendSell:function(e,t){return 0===t.length?void this._openNoRecommendAccessoriesPopup(e):void this._openAcceListSellCheckPopup(e,t)},_openAcceNonOfferPopup:function(e){return t.ImplantedPopup.createOrGet(e,"acce_non_offer","AcceNonOfferPopup").open()},_openAcceListSellCheckPopup:function(e,a){var o=n.map(a,function(e){return e.a_accessory_id}),r=t.createInstance("myselfInfoRepository").getMyCurrency(),s=this._apiAAccessories.confirmSellPrice(o);return i.all([r,s]).then(function(n){var i=n[0],o=n[1].body,r=a.length<=10?"acce_allsell_enhance_check_result_a":"acce_allsell_enhance_check_result_b";return t.ImplantedPopup.create(e,r,"AcceListSellCheckPopup").open(a,o,i).then(this._processSell.bind(this,e,a,i))}.bind(this)).then(function(){this._controller.refresh(!1,!0),this.setHeaderLabels(e)}.bind(this)).fail(function(e){e&&console.error(e)})},_openNoRecommendAccessoriesPopup:function(e){e.popups.enh_no_recommend_accessories.open()},_processSell:function(e,i,a){var o=n.map(i,function(e){return e.a_accessory_id});return t.createInstance("apiAAccessories").sell(o).then(function(n){t.createInstance("myselfInfoRepository").allCacheClear();var o=n.body;return this._openAcceListSellResultPopup(e,i,a,o)}.bind(this))},_openAcceListSellResultPopup:function(e,n,i,a){var o=n.length<=10?"acce_allsell_enhance_check_result_a":"acce_allsell_enhance_check_result_b";return t.ImplantedPopup.create(e,o,"AcceListSellResultPopup").open(n,a,i)}},t.pc.acce.controller.Scene005Controller=n.merge({},t.pc.acce.controller.PageListSceneController,t.pc.acce.controller.Scene005Controller)}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._);t.createNameSpaceIfNotExists("acce.view"),t.acce.view.BaseAccessoryView=t.party.view.StatusWindowInPartyList.extend({className:"BaseAccessoryView",DETAIL_BTN_LABEL_TEXT:"",BASE_LABEL_TEXT:"",UI_NODE_NAMES:{NAME_LABEL:"name_label",LEVEL_LABEL:"level_label",FILTER_IN_CORECARD:"filter",STATUS_PANEL_BASE:"status_base",HP_NODE:"hp_no",ATTACK_NODE:"attack_no",EXP_BASE:"exp_base",EXP_GAUGE_NODE:"exp-gauge",EXP_NEXT_LABEL:"exp_next_label",BTN_DETAIL:"btn_base_change",SKILL_BASE_PREFIX:"skill_base_",BASE_LABEL:"base_label",ACCE_EFFECT_PAGE_UI:"acce_effect_page_ui",ACCE_EFFECT_LIST_PREFIX:"acce_effect_list_ui_",ACCE_EFFECT_LABEL:"acce_effect_label",ACCE_UNIQUE_BASE:"unique_effect_base",ACCE_UNIQUE_LABEL:"unique_effect_label",ACCE_HAS_NOT_UNIQUE_LABEL:"hyphen"},_uiNodes:{subEffectPage:null,subEffectNodes:null},ctor:function(e,t,n,i,a){this._super.apply(this,arguments);var o=this._statusWindowNode.seekWidgetByName(this.UI_NODE_NAMES.BTN_DETAIL);o&&o.setTitleText(this.DETAIL_BTN_LABEL_TEXT),this._statusWindowNode.seekWidgetByName(this.UI_NODE_NAMES.BASE_LABEL).setString(this.BASE_LABEL_TEXT);var r=this._getNodeByName(this.UI_NODE_NAMES.ACCE_EFFECT_PAGE_UI);this._uiNodes.subEffectPage=r,this._uiNodes.subEffectNodes=r.seekWidgets(function(e){return 0===(""+e.getName()).indexOf("acce_effect_list_ui_")}).map(function(e){return{base:e,label:this._getNodeByName("acce_effect_label",e)}}.bind(this))},clear:function(){this._super.apply(this,arguments);var e=this._getNodeByName(this.UI_NODE_NAMES.ACCE_UNIQUE_BASE),t=this._getNodeByName(this.UI_NODE_NAMES.ACCE_UNIQUE_LABEL),n=this._getNodeByName(this.UI_NODE_NAMES.ACCE_HAS_NOT_UNIQUE_LABEL),i=this._getNodeByName(this.UI_NODE_NAMES.EXP_BASE);e.setVisible(!1),t.setVisible(!1),n.setVisible(!1),i.setVisible(!1)},_setCoreCard:function(e,t){this._super.apply(this,arguments),this._coreCardUI.setImg(e.accessory_id)},_setStatusPanel:function(e){this._super.apply(this,arguments),this._setSubEffects(e),this._setBrand(e)},_setSubEffects:function(e){this._uiNodes.subEffectPage.setVisible(!0);var t=e.sub_effects,i=[];n.each(this._uiNodes.subEffectNodes,function(e,a){if(!n.isUndefined(t[a])){var o=(null===t[a].slot_number?"":"["+t[a].slot_number+"] ")+t[a].description.slice(0,9)+"+"+t[a].effect_rate+"%";e.label.setText(o),i.push("effect_"+a.toString())}}.bind(this)),0===t.length&&i.push("effect_off"),n.each(i,function(e){this._uiNodes.subEffectPage.setAppearance(e)}.bind(this))},_setBrand:function(e){var t=e.brand,n=this._getNodeByName(this.UI_NODE_NAMES.ACCE_UNIQUE_BASE),i=this._getNodeByName(this.UI_NODE_NAMES.ACCE_UNIQUE_LABEL),a=this._getNodeByName(this.UI_NODE_NAMES.ACCE_HAS_NOT_UNIQUE_LABEL);n&&i&&a&&(t&&i.setString(t),n.setVisible(!0),i.setVisible(t),a.setVisible(!t))},_getNodeByName:function(e,t){(n.isUndefined(t)||null===t)&&(t=this._statusWindowNode);var i=t.seekWidgetByName(e);return i||console.warn("Acce.view.StatusWindow._getByNode(): node '"+e+"' not found"),i},clean:function(){this._super.apply(this),this._uiNodes=null}})}((this||0).self||global),function(e){var t=e.kh;e.cc,e._,t.createNameSpaceIfNotExists("acce.view"),t.acce.view.EquipSelectedAccessory=t.acce.view.BaseAccessoryView.extend({className:"EquipSelectedAccessory",DETAIL_BTN_LABEL_TEXT:"",BASE_LABEL_TEXT:"",ctor:function(e,t,n,i,a,o){this._super.apply(this,arguments),this._statusWindowNode.seekWidgetByName(this.UI_NODE_NAMES.BTN_DETAIL).addTouchEventListener(o.openAcceDetailEquipPopup,o)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._;t.createNameSpaceIfNotExists("acce.view"),t.acce.view.EquipActionButton=n.Class.extend({className:"EquipActionButton",_uiNodes:{acceBtnUI:null,btnRemove:null,btnEquip:null},ctor:function(e,t){var n=this._uiNodes.acceBtnUI=e.seekWidgetByName("acce_btn_ui");this._uiNodes.btnRemove=n.seekWidgetByName("btn_remove"),this._uiNodes.btnEquip=n.seekWidgetByName("btn_equip"),this._setButtonTouchEvent(e,t)},update:function(e,n,a){var o=!i.isEmpty(e),r=this._uiNodes.btnRemove,s=this._uiNodes.btnEquip;t.pc.roles.UIUtility._setEnableButton(s,o),t.pc.roles.UIUtility._setEnableButton(r,!a);var c=this._uiNodes.acceBtnUI;n?c.setAppearance("remove_acce_view"):c.setAppearance("equip_acce_view")},clear:function(){this.update(null)},clean:function(){n.eventManager.removeListeners(this._uiNodes.acceBtnUI,!0),this._uiNodes=null},_setButtonTouchEvent:function(e,t){this._uiNodes.btnEquip.addTouchEventListener(t.changeAccessory,t),this._uiNodes.btnRemove.addTouchEventListener(t.removeAccessory,t),this._uiNodes.acceBtnUI.seekWidgetByName("btn_cancel").addTouchEventListener(t.cancel,t)}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._),i=e.Q;t.createNameSpaceIfNotExists("acce.controller"),t.acce.controller.Scene007AccessoryList=t.party.controller.PartyListAbstract.extend({className:"Scene007AccessoryListController",_slotNum:null,_khCharacterAccessoriesModel:null,_modelPreparePromise:null,_setListSetting:function(e){var n=e.seekWidgetByName("header_sub_label_equip_acce");this.setting={setHeaderLabelFunction:this._setAccessoryAmountLabel.bind(this,n),panelName:t.BtnsPageListParams.EQUIP_ACCESSORY_LIST.panelName,baseName:"window_gray",apiName:"apiAAccessories",apiMethod:"getListCharacterSelectable",apiParams:this._getApiParams(e),apiModel:t.acce.model.Accessory,cardType:"acce",cardFrame:"full",sortArgs:{sortKey:"selectable_accessories",sortValue:"attack_desc",sortButton:"btn_sort",sortLabel:"sort_label",sortMenuBase:"sortlist",sortChoice:"core-pages-sort_list_0_ui",changeEventName:"pulldown_sort_config"},maxSelectCount:1,canDeselect:!1,header_label_node:"acce_header_label_ui",header_sub_label_node:"header_sub_label_enh",header_sub_label:"",header_animation:"enh_view",nothing_animation:"enh_target_view"}},_createDisplayFilterSettings:function(){return{list_node:[t.displayFilter.enums.FILTER_NAME.EQUIP_ACCESSORY,"com_filter_other"]}},ctor:function(e,n){var i=e.temporaryRouterParams.acce_007||{};this._slotNum=i.num;var a=i.a_character_id;this._khCharacterAccessoriesModel=t.createInstance("characterAccessoriesModel"),this._modelPreparePromise=this._khCharacterAccessoriesModel.prepare(a),this._statusWindowView=new t.acce.view.EquipSelectedAccessory(e,"corecard_acce_ui","CoreCardAccessoryUI",this._setCoreCardInStatusWindow,null,this),this._actionButtonView=new t.acce.view.EquipActionButton(e,this),this._setListSetting(e),this._super.apply(this,arguments)},_getApiParams:function(e){return[e.temporaryRouterParams.acce_007.a_character_id,this._slotNum,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE]},setPageList:function(){var e=this._scene.temporaryRouterParams.acce_007.a_accessory_id;this._setInitSelectedAccessory(e).then(this._super.bind(this))},_setInitSelectedAccessory:function(e){return null===e?i.resolve():t.createInstance("apiAAccessories").get(e).then(function(e){return this._khAccessoryModel=new t.acce.model.Accessory(e.body),this._initSelectedRecord(this._khAccessoryModel.getRawAccessory()),this._khAccessoryModel}.bind(this)).fail(function(e){console.error(e.stack)})},_getRecordId:function(e){return e.a_accessory_id},changeAccessory:function(e,t){if(t===ccui.Widget.TOUCH_ENDED){var i=this.getSelectedRecord();n.isObject(i)||console.error("not found selectedAccessory");var a=this._khCharacterAccessoriesModel;return this._confirmAcceRemove(i,a).then(a.changeAccessoryByIndex.bind(a,this._slotNum,i.a_accessory_id)).then(function(e){if(!e.error_info){var t=this._khCharacterAccessoriesModel.getACharacterId(),n=this._scene.temporaryRouterParams.navigateFrom;this._navigate007To006(t,this._slotNum,n,i.a_accessory_id)}}.bind(this)).fail(function(e){console.error(e.stack)})}},_confirmAcceRemove:function(e,t){return e.is_equipped?t.confirmChangeAccessoryByIndex(this._slotNum,e.a_accessory_id).then(this._openAcceRemoveCheck.bind(this)):i.resolve()},_openAcceRemoveCheck:function(e){return e.error_info?i.reject(e):n.isObject(e.equipped_by)?t.ImplantedPopup.createOrGet(this._scene,"acce_remove_check","AcceRemoveCheckPopup").open(e):i.resolve()},removeAccessory:function(e,t){if(t===ccui.Widget.TOUCH_ENDED)return this._khCharacterAccessoriesModel.releaseAccessoryByIndex(this._slotNum).then(function(e){if(!e.error_info){var t=this._khCharacterAccessoriesModel.getACharacterId(),n=this._scene.temporaryRouterParams.navigateFrom;this._navigate007To006(t,this._slotNum,n)}}.bind(this)).fail(function(e){console.error(e.stack)})},openAcceDetailEquipPopup:function(e,n){if(n===ccui.Widget.TOUCH_ENDED){var i=this.getSelectedRecord();return t.ImplantedPopup.createOrGet(this._scene,"acce_detail_protection_on_off","AcceDetailEnhBasePopup").open(i,this._khCharacterAccessoriesModel,this._slotNum)}},cancel:function(e,t){if(t===ccui.Widget.TOUCH_ENDED){var n=this._khCharacterAccessoriesModel.getACharacterId(),i=this._scene.temporaryRouterParams.navigateFrom;this._navigate007To006(n,this._slotNum,i,null)}},clean:function(){this._super.apply(this),this._khCharacterAccessoriesModel=null,this._modelPreparePromise=null}}),n.assign(t.acce.controller.Scene007AccessoryList.prototype,t.displayFilter.roles.DisplayFilterSceneController,t.pc.acce.roles.AccessoryComponentCommon,t.pc.acce.roles.Routing)}((this||0).self||global),function(e){var t=e.kh,n=e.cc;e._,t.createNameSpaceIfNotExists("acce.view"),t.acce.view.EnhActionButton=n.Class.extend({className:"EquipActionButton",_uiNodes:{acceBtnUI:null},ctor:function(e,t){(this._uiNodes.acceBtnUI=e.seekWidgetByName("acce_btn_ui")).setAppearance("enh_nothing_view"),e.seekWidgetByName("acce_nothing_label_ui").setAppearance("enh_target_view"),this._setButtonTouchEvent(e,t)},update:function(e,t,n){},clear:function(){this.update(null)},updateTargetView:function(e,t,n,i){0!=e.length&&this._uiNodes.acceBtnUI.setAppearance("enh_target_view")},clean:function(){n.eventManager.removeListeners(this._uiNodes.acceBtnUI,!0),this._uiNodes=null},_setButtonTouchEvent:function(e,t){var n=this._uiNodes.acceBtnUI;n.seekWidgetByName("btn_decision_enh").addTouchEventListener(t.decision,t),n.seekWidgetByName("btn_recommended_enh").addTouchEventListener(t.enhanceByRecommend,t),n.seekWidgetByName("btn_expitem").addTouchEventListener(t.enhanceByExpitem,t)}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.acce=t.acce||{},t.acce.view=t.acce.view||{},t.acce.view.EnhConfirmBaseAcce=t.acce.view.BaseAccessoryView.extend({className:"KHEnhConfirmBaseAcce",DETAIL_BTN_LABEL_TEXT:"",BASE_LABEL_TEXT:"",ctor:function(e,t,n,i,a,o){this._super.apply(this,arguments),this._statusWindowNode.seekWidgetByName(this.UI_NODE_NAMES.BTN_DETAIL).addTouchEventListener(o.changeBaseAcce,o),this._coreCardUI.addTouchEventListener(o._openAcceDetailEnhBasePopup,o)}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.createNameSpaceIfNotExists("acce.controller"),t.acce.controller.Scene008AccessoryList=t.party.controller.PartyListAbstract.extend({className:"Scene008AccessoryListController",_setListSetting:function(e){var n=e.temporaryRouterParams.acce_008.a_accessory_id;this.setting={setHeaderLabelFunction:this.setHeaderLabels,panelName:t.BtnsPageListParams.ACCESSORY_ENH_MATERIAL_LIST.panelName,baseName:"window_gray",apiName:"apiAAccessories",apiMethod:"getEnhanceMaterials",apiParams:[n,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PAGE,t.core.pager.enum.API_OPTION.REPLACE_OPTION_PER_PAGE],apiModel:t.acce.model.Accessory,cardType:"acce",cardFrame:"full",sortArgs:{sortKey:"enhance_accessory_materials",sortValue:"attack_desc",sortButton:"btn_sort",sortLabel:"sort_label",sortMenuBase:"sortlist",sortChoice:"core-pages-sort_list_0_ui",changeEventName:"pulldown_sort_config"},maxSelectCount:20,canDeselect:!0,header_label_node:"acce_header_label_ui",header_sub_label_node:"header_sub_label_enh",header_sub_label:"",header_animation:"enh_view",nothing_animation:"enh_target_view"}},_createDisplayFilterSettings:function(){return{list_node:[t.displayFilter.enums.FILTER_NAME.ENH_MATERIAL_ACCESSORY,"com_filter_other"]}},ctor:function(e,n){this._statusWindowView=new t.acce.view.EnhConfirmBaseAcce(e,"corecard_acce_ui","CoreCardAccessoryUI",this._setCoreCardInStatusWindow,null,this),this._actionButtonView=new t.acce.view.EnhActionButton(e,this),this._setListSetting(e),this._super.apply(this,arguments)},setPageList:function(){var e=this._scene,n=e.temporaryRouterParams.acce_008.a_accessory_id;this._setInitSelectedAccessory(n).then(this._super.bind(this)).then(function(n){n.addUpdateEventListener(this._actionButtonView.updateTargetView,this._actionButtonView),n.addUpdateEventListener(function(e,n,i,a){t.pc.roles.UIUtility._setEnableButton(this,a.getSelectedData().length>0)},e.seekWidgetByName("btn_decision_enh"))}.bind(this))},_setInitSelectedAccessory:function(e){return null===e?a.resolve():t.createInstance("apiAAccessories").get(e).then(function(e){return this._khAccessoryModel=new t.acce.model.Accessory(e.body),this._initSelectedRecord(this._khAccessoryModel.getRawAccessory()),this._khAccessoryModel}.bind(this)).fail(function(e){console.error(e.stack)})},setHeaderLabels:function(){this.setting.header_animation&&this._setAppearanceHeaderLabel(),this._setHeaderSubLabel(),this.setting.select_animation&&this._setAppearanceSelectLabel()},_setAppearanceHeaderLabel:function(){this._getNodeByName("acce_header_label_ui").setAppearance(this.setting.header_animation)},_setAppearanceSelectLabel:function(){this._getNodeByName("acce_select_label_ui").setAppearance(this.setting.select_animation)},_setHeaderSubLabel:function(){var e=this._getNodeByName(this.setting.header_sub_label_node);this._setAccessoryAmountLabel(e)},changeBaseAcce:function(e,t){t===ccui.Widget.TOUCH_ENDED&&this._navigate008To003()},_openAcceDetailEnhBasePopup:function(){return t.ImplantedPopup.createOrGet(this._scene,"acce_detail_protection_on_off","AcceDetailEnhBasePopup").open(this._khAccessoryModel.getRawAccessory())},enhanceByRecommend:function(e,t){t===ccui.Widget.TOUCH_ENDED&&this._khAccessoryModel.getRecommendMaterialIds().then(function(e){var t=e.data;i.isEmpty(t)?this._openAcceNonOfferPopup(this._scene):this._scene.popups.li_auto_choose.open(t)}.bind(this)).fail(function(e){console.error(e.stack)})},enhanceByExpitem:function(e,n){return n!==ccui.Widget.TOUCH_ENDED?a.reject(this._override):(a.resolve(this._khAccessoryModel).then(this._expitemPromise).then(this._startEnhanceByExpSphereProcess.bind(this)).then(function(e){return a.all([e,t.createInstance("apiAAccessories").enhanceByExpitem(e.baseModel.getAAccessoryId(),e.useAmount)])}.bind(this)).spread(function(e,t){this._navigate008To010(this._scene,t.body.accessory,t.body.result,[{item_id:e.aEnhanceExpitemModel.getItemId()}])}.bind(this)),a.reject(this._override))},_startEnhanceByExpSphereProcess:function(e){if(i.isUndefined(e))return a.reject();var o=n.director.getRunningScene(),r=t.ImplantedPopup.createOrGet(o,"enh_use_expitem"),s=t.ImplantedPopup.createOrGet(o,"enh_use_expitem_confirm");return r.open(e).then(s.open.bind(s)).fail(this._startEnhanceByExpSphereProcess.bind(this))},_expitemPromise:function(e){return a.all([t.createInstance("apiAAccessories").getExpitem(e.getAAccessoryId()),t.createInstance("apiAccessories").getExperiencePointList()]).spread(function(n,i){var a=n.body,o=new t.enh_evo.model.EnhanceExpitem(a),r=new t.enh_evo.model.ExperiencePoint(i.body);return{baseModel:e,aEnhanceExpitemModel:o,experiencePointModel:r,useAmount:o.getUsableAmount()}})},_openAcceNonOfferPopup:function(e){return t.ImplantedPopup.createOrGet(e,"acce_non_offer","AcceNonOfferPopup").open()},_confirmRecommendEnhance:function(e,t){return this._khAccessoryModel.confirmRecommendEnhance(t).then(function(t){var n=t.materials;return 0===n.length?void this._openNoRecommendMaterialsPopup(e):void this._openAcceListEnhCheckPopup(e,n,t)}.bind(this)).fail(function(e){console.error(e.stack)})},decision:function(e,t){t===ccui.Widget.TOUCH_ENDED&&this._confirmEnhance(this._scene)},getSelectedRecord:function(){return this._controller?this._controller.getSelectedData():[]},_confirmEnhance:function(e){var t=this.getSelectedRecord().map(function(e){return e.getAAccessoryId()});return this._khAccessoryModel.confirmEnhance(t).then(function(t){var n=t.materials;this._openAcceListEnhCheckPopup(e,n,t)}.bind(this)).fail(function(e){console.error(e.stack)})},_openAcceListEnhCheckPopup:function(e,n,i){return t.createInstance("myselfInfoRepository").getMyCurrency().then(function(a){var o=a,r=n.length<=10?"acce_allsell_enhance_check_result_a":"acce_allsell_enhance_check_result_b";return t.ImplantedPopup.createOrGet(e,r,"AcceListEnhCheckPopup").open(n,i,o,this._khAccessoryModel)}.bind(this)).catch(function(e){console.error(e)})}}),i.assign(t.acce.controller.Scene008AccessoryList.prototype,t.displayFilter.roles.DisplayFilterSceneController,t.pc.acce.roles.AccessoryComponentCommon,t.pc.acce.roles.Routing)}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.acce=t.acce||{},t.acce.view=t.acce.view||{},t.acce.view.EnhBaseAcceView=t.acce.view.BaseAccessoryView.extend({BASE_LABEL_TEXT:""})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.acce=t.acce||{},t.acce.view=t.acce.view||{},t.acce.view.AcceDetailEnhBasePopup=t.acce.view.AcceDetailCommonPopup.extend({_initContents:function(e){this._super(e),this._setSalePriceVisible(e),this._setBtnEnh(e)},_setActionLabels:function(e){this._uiNodes.labelCanNotSell.setVisible(!0),this._node.animate("acce_can_not_sell")},_setActionBtns:function(e){this._super(e);var t=this._uiNodes.btnSell;t.setVisible(!0),t.setEnabled(!1),t.setColor(cc.color("#808080"))}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.acce=n.acce||{},n.acce.view=n.acce.view||{},n.acce.view.AcceListCommonPopup=n.ImplantedPopup.extend({RARITY_NORMAL:"N",_popups:{},UI_NODE_NAMES:{titleSellCheck:"allsell_check_title_label",titleSellPointOver:"allsell_point_over_title_label",titleSellRareSell:"allsell_raresell_title_label",titleSellResult:"allsell_result_title_label",titleEnhCheck:"enhance_check_title_label",titleEnhPointOver:"enhance_point_over_title_label",titleEnhRareEnh:"enhance_rareenhance_title_label",titleEnhResult:"enhance_rareenhance_fixed_label",descSellCheck:"allsell_check_fixed_label",descSellPointOver:"allsell_point_over_fixed_label",descSellRareSell:"allsell_raresell_fixed_label",descSellResult:"allsell_result_fixed_label",descEnhCheck:"enhance_check_fixed_label",descEnhPointOver:"enhance_point_over_fixed_label",descEnhRareEnh:"enhance_rareenhance_fixed_label",labelPlayerJem:"have_jem_label",labelGetAccePoint:"get_acce_point_label",labelPlayerAccePoint:"have_acce_point_fixed_label",labelExpenses:"required_expenses_fixed_label",salePrice:"get_jem_labelimg",playerJem:"have_jem_labelimg",getAccePoint:"get_acce_point_labelimg",playerAccePoint:"have_acce_point_labelimg",expenses:"required_expenses_label",playerExpitem:"get_exp_labelimg",gainedExp:"get_exp_value_labelimg",greatSuccessPercent:"success_rate_labelimg",coreCardListUI:"corecard_blank_5_2_ui_107",btnCancel:"btn_cancel",btnSell:"btn_sell",btnEnh:"btn_enhance",btnOk:"btn_ok"},TITLE_NODE_KEYS:["titleSellCheck","titleSellPointOver","titleSellRareSell","titleSellResult","titleEnhCheck","titleEnhPointOver","titleEnhRareEnh"],DESC_NODE_KEYS:["descSellCheck","descSellPointOver","descSellRareSell","descSellResult","descEnhCheck","descEnhPointOver","descEnhRareEnh"],ACTION_BTN_NODE_KEYS:["btnCancel","btnSell","btnEnh","btnOk"],CORE_CARD_COUNTS:{acce_allsell_enhance_check_result_a:10,acce_allsell_enhance_check_result_b:20},CORE_CARD_NODES:{acce_allsell_enhance_check_result_a:"corecard_blank_5_2_ui_107",acce_allsell_enhance_check_result_b:"corecard_blank_5_4_ui_107"},_uiNodes:{},_accessories:[],_result:{},_playerCurrency:null,_khAccessoryPointInfoModel:null,_initContents:function(e,t,i){this.UI_NODE_NAMES.coreCardListUI=this._getCoreCardListUINodeName(),this._uiNodes=this._getUINodes(),this._accessories=e,this._result=t,this._playerCurrency=i,this._khAccessoryPointInfoModel=new n.acce.model.AccessoryPointInfo(i),this._clearContents(),this._setAppearance(),this._setAccessoryCoreCardList(),this._setCostInfo(),this._setActionBtns()},_setAppearance:function(){console.log("please implement")},_openAnimation:function(){return this._super().then(this._setAppearance.bind(this))},_setAccessoryCoreCardList:function(){t.each(this._accessories,function(e,t){var n=this._uiNodes.coreCards[t];n.setVisible(!0),this._setAccessoryCoreCardFull(n,e)}.bind(this))},_setCostInfo:function(){console.log("please implement")},_setPlayerGem:function(e,t){var i='<div class="comSellNumbox"><span class="white">'+e+'  </span><span class="yellow">'+t+"</span></div>",a={};a[this.UI_NODE_NAMES.playerJem]=i,this._node.setHtmlStrings(a,n.GameConfig.POPUP_CSS)},_setPlayerAccePoint:function(e,t){var i='<div class="comSellNumbox"><span class="white">'+e+'  </span><span class="yellow">'+t+"</span></div>",a={};a[this.UI_NODE_NAMES.playerAccePoint]=i,this._node.setHtmlStrings(a,n.GameConfig.POPUP_CSS)},_setActionBtns:function(){this._uiNodes.btnCancel.setVisible(!0),this.setButtonEvents({btn_cancel:function(){this._clearContents(),this.dismiss()}.bind(this)})},_clearContents:function(){this._clearAccessoryCoreCardList(),this._clearCostInfo(),this._clearActionBtns()},_clearAccessoryCoreCardList:function(){t.each(this._uiNodes.coreCards,function(e){e.setVisible(!1)}.bind(this))},_clearCostInfo:function(){this._uiNodes.getAccePoint.loadTexture(),this._uiNodes.playerJem.loadTexture(),this._uiNodes.playerAccePoint.loadTexture(),this._uiNodes.playerExpitem.loadTexture()},_clearActionBtns:function(){t.each(this.ACTION_BTN_NODE_KEYS,function(e){this._uiNodes[e].setVisible(!1)}.bind(this))},_hasRareAccessories:function(){return t.filter(this._accessories,function(e){return e.rare!==this.RARITY_NORMAL}.bind(this)).length>0},_getCoreCardListUINodeName:function(){return this.CORE_CARD_NODES[this._node._name]},_getMaxCoreCardCount:function(){return this.CORE_CARD_COUNTS[this._node._name]},_getUINodes:function(){var e=t.mapValues(this.UI_NODE_NAMES,function(e){return this._getNodeByName(e)}.bind(this));return e.coreCards=t.map(t.range(0,this._getMaxCoreCardCount()),function(t){var n="list_blank_"+t;return this._getNodeByName(n,e.coreCardListUi)}.bind(this)),e},_getNodeByName:function(e,n){t.isUndefined(n)&&(n=this._node);var i=n.seekWidgetByName(e);return i||console.warn("AcceListCommonPopup._getNodeByName(): node '"+e+"' not found"),i}}),t.assign(n.acce.view.AcceListCommonPopup.prototype,n.pc.acce.roles.Routing,n.pc.roles.CoreCardCommon)}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.acce=n.acce||{},n.acce.view=n.acce.view||{},n.acce.view.AcceListEnhCheckPopup=n.acce.view.AcceListCommonPopup.extend({_khAccessoryModel:null,_initContents:function(e,t,n,i){this._khAccessoryModel=i,this._super(e,t,n),this._setEnhanceInfo()},_openAnimation:function(){return this._super().then(this._setAppearance.bind(this))},_setAppearance:function(){return this._hasRareAccessories()?void this._setAppearanceEnhanceRareEnhance():void this._setAppearanceEnhanceCheck()},_setAppearanceEnhanceRareEnhance:function(){this._node.setAppearance("enhance_rareenhance")},_setAppearanceEnhanceCheck:function(){this._node.setAppearance("enhance_check")},_setCostInfo:function(){},_setEnhanceInfo:function(){var e='<p class="text_common_left"><span class="white">'+this._result.gained_exp.toString()+"</span></p>",t='<p class="text_common_left"><span class="white">'+this._result.great_success_percent.toString()+" %</span></p>",i={};i[this.UI_NODE_NAMES.gainedExp]=e,i[this.UI_NODE_NAMES.greatSuccessPercent]=t,this._node.setHtmlStrings(i,n.GameConfig.POPUP_CSS)},_setActionBtns:function(){this._super();var e=this._uiNodes.btnEnh;return this._canEnhance()?(e.setEnabled(!0),e.setColor(cc.color("#FFFFFF")),e.setVisible(!0),void e.addTouchEventListener(function(e,t){t===ccui.Widget.TOUCH_ENDED&&this._processEnhance()}.bind(this))):(e.setEnabled(!1),e.setColor(cc.color("#808080")),void e.setVisible(!0))},_processEnhance:function(){var e=t.map(this._accessories,function(e){return e.a_accessory_id});return this._khAccessoryModel.enhance(e).then(function(e){var t=cc.director.getRunningScene();this._navigate008To010(t,e.accessory,e.result,this._accessories)}.bind(this))},_canEnhance:function(){return!0},_clearContents:function(){this._super(),this._clearEnhanceInfo()},_clearEnhanceInfo:function(){this._uiNodes.gainedExp.loadTexture(),this._uiNodes.greatSuccessPercent.loadTexture()}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.acce=t.acce||{},t.acce.view=t.acce.view||{},t.acce.view.AcceListSellCheckPopup=t.acce.view.AcceListCommonPopup.extend({UI_NODE_NAMES:{salePrice:"get_need_jem_labelimg",playerJem:"have_jem_labelimg",getAccePoint:"get_acce_point_labelimg",playerAccePoint:"have_acce_point_labelimg",playerExpitem:"get_exp_labelimg",btnSell:"btn_sell",btnCancel:"btn_cancel"},ACTION_BTN_NODE_KEYS:["btnCancel","btnSell"],_result:null,_setAppearance:function(){var e=this._result.total_sell_sphere>0;return this._hasRareAccessories()?void this._setAppearanceAllSellRareSell(e):void this._setAppearanceAllSellCheck(e)},_setAppearanceAllSellPointOver:function(e){this._node.setAppearance(e?"allsell_point_over_exp":"allsell_point_over")},_setAppearanceAllSellRareSell:function(e){this._node.setAppearance(e?"allsell_raresell_exp":"allsell_raresell")},_setAppearanceAllSellCheck:function(e){this._node.setAppearance("allsell_check")},_setCostInfo:function(){var e=this._playerCurrency.getGemAmount(),n=this._khAccessoryPointInfoModel.getAccessoryPoint(),i='<div class="comSellNumbox"><span class="white">'+e+'&emsp;&ensp;</span><span class="yellow">'+(e+this._result.total_sell_price)+"</span></div>",a='<div class="comSellNumbox"><span class="white">'+n+'&emsp;&ensp;</span><span class="yellow">'+this._khAccessoryPointInfoModel.getAfterAccessoryPoint(this._result.total_accessory_point)+"</span></div>",o='<div class="comSellNumbox"><span class="white">'+this._result.total_sell_price+"&ensp;</span></div>",r='<div class="comSellNumbox"><span class="white">'+this._result.total_sell_sphere+"</span></div>",s='<div class="comSellNumbox"><span class="white">'+this._result.total_accessory_point+"P</span></div>",c={};c[this.UI_NODE_NAMES.playerJem]=i,c[this.UI_NODE_NAMES.playerAccePoint]=a,c[this.UI_NODE_NAMES.salePrice]=o,c[this.UI_NODE_NAMES.getAccePoint]=s,this._result.total_sell_sphere>0&&(c[this.UI_NODE_NAMES.playerExpitem]=r),this._node.setHtmlStrings(c,t.GameConfig.POPUP_CSS)},_setActionBtns:function(){this._super();var e=this._uiNodes.btnSell;e.setEnabled(!0),e.setVisible(!0),e.addTouchEventListener(function(e,t){t===ccui.Widget.TOUCH_ENDED&&this.dismiss(!0)},this)}})}((this||0).self||global),function(e){var t=(e._,e.kh||{});t.acce=t.acce||{},t.acce.view=t.acce.view||{},t.acce.view.AcceListSellResultPopup=t.acce.view.AcceListCommonPopup.extend({UI_NODE_NAMES:{salePrice:"get_need_jem_labelimg",playerJem:"have_jem_labelimg",getAccePoint:"get_acce_point_labelimg",playerAccePoint:"have_acce_point_labelimg",playerExpitem:"get_exp_labelimg",btnOk:"btn_ok",btnSell:"btn_sell",btnCancel:"btn_cancel",btnEnh:"btn_enhance"},_result:null,_setAppearance:function(){return this._result.total_sell_sphere>0?void this._node.setAppearance("allsell_result_exp"):void this._node.setAppearance("allsell_result")},_setCostInfo:function(){var e=this._playerCurrency.getGemAmount(),n=this._khAccessoryPointInfoModel.getAccessoryPoint(),i='<div class="comSellNumbox"><span class="white">'+e+'&emsp;&ensp;</span><span class="yellow">'+(e+this._result.total_sell_price)+"</span></div>",a='<div class="comSellNumbox"><span class="white">'+n+'&emsp;&ensp;</span><span class="yellow">'+this._khAccessoryPointInfoModel.getAfterAccessoryPoint(this._result.total_accessory_point)+"</span></div>",o='<div class="comSellNumbox"><span class="white">'+this._result.total_sell_price+"&ensp;</span></div>",r='<div class="comSellNumbox"><span class="white">'+this._result.total_sell_sphere+"</span></div>",s='<div class="comSellNumbox"><span class="white">'+this._result.total_accessory_point+"P</span></div>",c={};c[this.UI_NODE_NAMES.playerJem]=i,c[this.UI_NODE_NAMES.playerAccePoint]=a,c[this.UI_NODE_NAMES.salePrice]=o,c[this.UI_NODE_NAMES.getAccePoint]=s,this._result.total_sell_sphere>0&&(c[this.UI_NODE_NAMES.playerExpitem]=r),this._node.setHtmlStrings(c,t.GameConfig.POPUP_CSS)},_setActionBtns:function(){var e=this._uiNodes.btnOk;e.setEnabled(!0),e.setTouchEnabled(!0),e.setVisible(!0),this._uiNodes.btnSell.setVisible(!1),e.addTouchEventListener(function(e,t){t===ccui.Widget.TOUCH_ENDED&&this.dismiss(!0)},this)}})}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.acce=n.acce||{},n.acce.view=n.acce.view||{},n.acce.view.AcceNonOfferPopup=n.ImplantedPopup.extend({UI_NODE_NAMES:{title:"title_label",btnQuest:"btn_quest",btnCancel:"btn_cancel"},_uiNodes:{},_initContents:function(){this._uiNodes=this._getUINodes(),this._clearContents(),this._setTextNodes(),this._setBtns()},_setTextNodes:function(){t.each({title:""},function(e,t){this._uiNodes[t].setText(e)}.bind(this))},_setBtns:function(){this._uiNodes.btnCancel.addTouchEventListener(function(e,t){t===ccui.Widget.TOUCH_ENDED&&this.dismiss()}.bind(this)),this._uiNodes.btnQuest.addTouchEventListener(function(e,t){if(t===ccui.Widget.TOUCH_ENDED){n.createInstance("router").navigate("quest/q_special_top",{q_special_top:{category:"accessory"}})}})},_clearContents:function(){t.each({title:""},function(e,t){this._uiNodes[t].setText(e)}.bind(this))},_getUINodes:function(){return t.mapValues(this.UI_NODE_NAMES,function(e){return this._getNodeByName(e)}.bind(this))},_getNodeByName:function(e,n){(t.isUndefined(n)||null===n)&&(n=this._node);var i=n.seekWidgetByName(e);return i||console.warn("AcceNonOfferPopup._getByNode(): node '"+e+"' not found"),i}})}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.acce=t.pc.acce||{},t.pc.acce.acce_002_003_005=t.pc.acce.acce_002_003_005||{},t.pc.acce.acce_002_003_005.Scene=t.BaseScene.extend({resourceFileName:"acce_002_003_005/acce_002_003_005.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"acce",sceneName:"acce_002_003_005",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_acce-quest","btnCallbackBtnAcceQuest",null,function(){alert("{{q_special_top}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("nothing_node"),"btn_interchange","btnCallbackNothingNodeBtnInterchange",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"shop/sh_010")),this._initButtonEvent.call(this,this.seekWidgetByPath("acce_btn_ui"),"btn_interchange","btnCallbackAcceBtnUiBtnInterchange",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"shop/sh_010")),this._initButtonEvent.call(this,this.seekWidgetByPath("acce_btn_ui"),"btn_recommended","btnCallbackAcceBtnUiBtnRecommended",null,function(){alert("{{acce_auto_choose}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_decision","btnCallbackBtnDecision",null,function(){alert("{{}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"filter_btn","btnCallbackFilterBtn",null,function(){alert("{{com_filter_chara}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e._,i=e.Q;t.pc=t.pc||{},t.pc.acce=t.pc.acce||{},t.pc.acce.acce_002_003_005=t.pc.acce.acce_002_003_005||{},t.pc.acce.acce_002_003_005.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../acce_popup_ui.json"],_popups:{},_sceneController:null,onSceneInit:function(e){return this._sceneController=this._getSceneController(e),this._sceneController._createDisplayFilterController(e),this._sceneController._initializeDisplayFilterController("list_node"),this._setBackBtn(e),this._sceneController.init(e).fail(function(e){console.error(e.stack)})},_getSceneController:function(){var e=t.createInstance("router").getCurrentFragment();switch(e){case"acce/":case"acce/acce_002":var n="Scene002Controller";break;case"acce/acce_003":n="Scene003Controller";break;case"acce/acce_005":n="Scene005Controller";break;default:return console.warn("current fragment is invalid:"+e),null}return t.pc.acce.controller[n]},onSceneEnter:function(e){return i.resolve()},onSceneExit:function(e){return this._sceneController._displayFilterClean(),i.resolve()},onPageInAnimationEnd:function(e){return i.resolve()},btnCallbackBtnAcceQuest:function(e){var n=i.defer();return n.reject(this._override),t.createInstance("router").navigate("quest/q_special_top",{q_special_top:{category:"accessory"}}),n.promise},btnCallbackNothingNodeBtnInterchange:function(e){var t=i.defer();return t.reject(this._override),this._navigateToAccessoryShop(),t.promise},btnCallbackAcceBtnUiBtnInterchange:function(e){var t=i.defer();return t.reject(this._override),this._navigateToAccessoryShop(),t.promise},btnCallbackAcceBtnUiBtnRecommended:function(e){var t=i.defer();return t.reject(this._override),t.promise},btnCallbackBtnDecision:function(e){var t=i.defer();return t.reject(this._override),t.promise},btnCallbackBtnBookBack:function(e){return this._touchEndedBackBtnProcess(e),i.reject(this._override)},_touchEndedBackBtnProcess:function(e){this._navigateToBook001()}}),n.assign(t.pc.acce.acce_002_003_005.SceneDelegate.prototype._popups,t.acce.view.AcceDetailCommonPopup.prototype._popups,t.pc.acce.controller.Scene005Controller._popups),n.assign(t.pc.acce.acce_002_003_005.SceneDelegate.prototype,t.pc.roles.UIUtility,t.pc.acce.roles.Routing)}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.acce=t.pc.acce||{},t.pc.acce.acce_007_008=t.pc.acce.acce_007_008||{},t.pc.acce.acce_007_008.Scene=t.BaseScene.extend({resourceFileName:"acce_007_008/acce_007_008.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"acce",sceneName:"acce_007_008",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_acce-quest","btnCallbackBtnAcceQuest",null,function(){alert("{{q_special_top}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath("nothing_node"),"btn_interchange","btnCallbackNothingNodeBtnInterchange",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"shop/sh_010")),this._initButtonEvent.call(this,this.seekWidgetByPath("acce_btn_ui"),"btn_interchange","btnCallbackAcceBtnUiBtnInterchange",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"shop/sh_010")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_decision","btnCallbackBtnDecision",null,function(){alert("{{11acce_enhance_check_110acce_enhance_check2}}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_decision_enh","btnCallbackBtnDecisionEnh",null,function(){alert("{{11acce_enhance_check_110acce_enhance_check2}}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_recommended_enh","btnCallbackBtnRecommendedEnh",null,function(){alert("{{11acce_enhance_check_110acce_enhance_check2}}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_expitem","btnCallbackBtnExpitem",null,function(){alert("{{enh_use_expitem}}}")}),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_base_change","btnCallbackBtnBaseChange",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"acce/acce_002_003_005_007")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"filter_btn","btnCallbackFilterBtn",null,function(){alert("{{com_filter_other}}")}),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=(e.cc,e._),i=e.Q;t.pc=t.pc||{},t.pc.acce=t.pc.acce||{},t.pc.acce.acce_007_008=t.pc.acce.acce_007_008||{},t.pc.acce.acce_007_008.SceneDelegate=t.pc.BaseSceneDelegate.extend({_delayNodes:["../acce_popup_ui.json"],_popups:{li_auto_choose:{factoryName:"popupFactoryTextOnly",resource:"text_button_only.json",title:"",content:"N<br>",buttonLabels:{blackBtn:"",blueBtn:"OK"},buttons:{blackBtn:function(e){this.dismiss()},blueBtn:function(e){e._delegate._sceneController._confirmRecommendEnhance(e,this.accessoryIds),this.dismiss()}},onPopupOpened:function(e,t){e.accessoryIds=t}}},_sceneController:null,onSceneInit:function(e){return this._sceneController=this._getSceneController(e),this._sceneController._createDisplayFilterController(e),this._sceneController._initializeDisplayFilterController("list_node"),this._setBackBtn(e),this._sceneController.setPageList()},onSceneEnter:function(e){return i.resolve()},_getSceneController:function(e){var n=t.createInstance("router").getCurrentFragment();switch(n){case"acce/acce_007":return new t.acce.controller.Scene007AccessoryList(e,{});case"acce/acce_008":return new t.acce.controller.Scene008AccessoryList(e,{});default:return console.warn("current fragment is invalid:"+n),null}},onSceneExit:function(e){return this._sceneController._displayFilterClean(),this._sceneController.clean(),this._sceneController=null,i.resolve()},onPageInAnimationEnd:function(e){return i.resolve()},btnCallbackBtnAcceQuest:function(e){var n=i.defer();return n.reject(this._override),t.createInstance("router").navigate("quest/q_special_top",{q_special_top:{category:"accessory"}}),n.promise},btnCallbackNothingNodeBtnInterchange:function(e){var t=i.defer();return t.reject(this._override),this._sceneController._navigateToAccessoryShop(),t.promise},btnCallbackAcceBtnUiBtnInterchange:function(e){var t=i.defer();return t.reject(this._override),this._sceneController._navigateToAccessoryShop(),t.promise},btnCallbackBtnDecisionEnh:function(e){var t=i.defer();return t.reject(this._override),t.promise},btnCallbackBtnRecommendedEnh:function(e){var t=i.defer();return t.reject(this._override),t.promise},btnCallbackBtnBaseChange:function(e){var t=i.defer();return t.reject(this._override),t.promise},_touchEndedBackBtnProcess:function(e){switch(t.createInstance("router").getCurrentFragment()){case"acce/acce_007":var n=e.temporaryRouterParams.acce_007.a_character_id,i=e.temporaryRouterParams.navigateFrom;this._navigateToDetail_001_2(n,i);break;case"acce/acce_008":default:this._navigateToAcce003()}}}),n.assign(t.pc.acce.acce_007_008.SceneDelegate.prototype._popups,t.acce.view.AcceDetailCommonPopup.prototype._popups),n.assign(t.pc.acce.acce_007_008.SceneDelegate.prototype,t.displayFilter.roles.DisplayFilterSceneController,t.pc.roles.UIUtility,t.pc.acce.roles.Routing)}((this||0).self||global),function(e){var t=e.kh;e._,t.pc=t.pc||{};var n=(e.Q,{});t.pc.acce=t.pc.acce||{},t.pc.acce.acce_010=t.pc.acce.acce_010||{},t.pc.acce.acce_010.Scene=t.BaseScene.extend({resourceFileName:"acce_010/acce_010.json",isLoopDefaultView:!1,_popups:n,tabDelegateConfig:[],componentName:"acce",sceneName:"acce_010",_delegate:null,_init:function(){this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_base_change","btnCallbackBtnBaseChange",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"acce/acce_002_003_005")),this._initButtonEvent.call(this,this.seekWidgetByPath(""),"btn_continue_enh","btnCallbackBtnContinueEnh",null,t.createInstance("router").navigate.bind(t.createInstance("router"),"acce/acce_008")),this._initScene("")}})}((this||0).self||global),function(e){var t=e.kh,n=e.cc,i=e._,a=e.Q;t.pc=t.pc||{},t.pc.acce=t.pc.acce||{},t.pc.acce.acce_010=t.pc.acce.acce_010||{},t.pc.acce.acce_010.SceneDelegate=t.pc.BaseSceneDelegate.extend({_popups:{},_khAccessoryModel:null,_enhBaseAcceView:null,onSceneInit:function(e){this._verifyTemporaryRouterParams010(e);var i=e.temporaryRouterParams.acce_010,o=i.accessory,r=i.result,s=i.materials;this._khAccessoryModel=new t.acce.model.Accessory(o);var c=this._getNodeByName("header_sub_label");if(this._setAccessoryAmountLabel(c),this._showEnhBaseAcceView(e),r.after.max){var u=this._getNodeByName("btn_continue_enh");u.setEnabled(!1),u.setColor(n.color("#808080"))}this._showAnimationMaterials(e,s[0].item_id?"item":"acce",s);var l={accessory:o,result:r};this._setResultMessage(e,this._enhanceExpHtmlString(l,"accessory")),this._setResultStatus(e,this._enhanceGrowthHtmlString(l));var _="great_success"===r.success_type;return this._initPlayer(),this._playEnhAnimations2(e,r,_,2e3),this._setBackBtn(e),a.resolve()},onSceneEnter:function(e){return a.defer(),a.resolve()},onSceneExit:function(e){return a.defer(),this._abortAnimation(),a.resolve()},onPageInAnimationEnd:function(e){return a.defer(),a.resolve()},btnCallbackBtnBaseChange:function(e){var t=a.defer();return t.reject(this._override),this._navigateToAcce003(e),t.promise},btnCallbackBtnContinueEnh:function(e){var t=a.defer();t.reject(this._override);var n=this._khAccessoryModel.getAAccessoryId();return this._navigate010To008(n),t.promise},_showEnhBaseAcceView:function(e){var n="status_window";return e.seekWidgetByName(n)?(this._enhBaseAcceView=new t.acce.view.EnhBaseAcceView(e,"corecard_acce_ui","CoreCardAccessoryUI"),void this._enhBaseAcceView.update(this._khAccessoryModel.getRawAccessory(),"total_desc")):void console.warn("SceneDelegate._showEnhBaseAcceView(): node '"+n+"' not found")},_touchEndedBackBtnProcess:function(e){this._navigateToAcce003()}}),i.assign(t.pc.acce.acce_010.SceneDelegate.prototype,t.pc.roles.UIUtility,t.pc.acce.roles.Routing,t.pc.enh_evo.roles.EnhEvoCommon,t.env.isIE?t.pc.enh_evo.roles.EnhEvoAnimationIE:t.pc.enh_evo.roles.EnhEvoAnimation,t.pc.enh_evo.roles.EnhStatusCommon,t.pc.acce.roles.AccessoryComponentCommon)}((this||0).self||global),function(e){var t=e._||{},n=e.kh||{};n.router=n.router||{},n.router.routes=n.router.routes||{},t.merge(n.router.routes,{acce:{acce:"acce_002_003_005","acce/acce_002":"acce_002_003_005","acce/acce_003":"acce_002_003_005","acce/acce_005":"acce_002_003_005","acce/acce_007":"acce_007_008","acce/acce_008":"acce_007_008","acce/acce_010":"acce_010","acce/detail/de_001":"de_001_002","acce/detail/de_003":"de_003","acce/detail/de_004":"de_004"}})}((this||0).self||global),function(e){var t=e.kh,n=e._;t.pc=t.pc||{},t.pc.quest||t.pc.quest;var i=t.pc.quest,a={sceneManager:t.SceneManager,popupRaidMvp:t.PopupFactoryMvp,popupRankUp:t.PopupFactoryRankUp,popupJobMaxBonus:t.PopupFactoryJobMaxBonus,popupJobAbilityAcquired:t.PopupFactoryJobAbilityAcquired,popupCharacterAbilityImproved:t.PopupFactoryCharacterAbilityImproved,popupCharacterAbilityAcquired:t.PopupFactoryCharacterAbilityAcquired,popupCharacterAcquired:t.PopupFactoryCharacterAcquired,popupFriendRequest:t.PopupFactoryFriendRequest,popupNewItemAcquired:t.PopupFactoryNewItemAcquired,popupQuestClearBonusItemsAcquired:t.PopupFactoryQuestClearBonusItemsAcquired,popupFactoryComBackCheck:t.PopupFactoryComBackCheck,popupFactoryComBackResult:t.PopupFactoryComBackResult,popupFactoryComNeedApBp:t.PopupFactoryComNeedApBp,popupFactoryComNeedApBp1:t.PopupFactoryComNeedApBp1,popupFactoryComNeedApBp2:t.PopupFactoryComNeedApBp2,popupFactoryComApRestart:t.PopupFactoryComApRestart,popupFactoryComUseResult:t.PopupFactoryComUseResult,popupFactoryComRaidCheck:t.PopupFactoryComRaidCheck,popupFactoryComQuestInfo:t.PopupFactoryComQuestInfo,popupFactoryComAgeLimit:t.PopupFactoryComAgeLimitB,popupFactoryRaQuestAppearance:t.q_003_1.PopupFactoryRaQuestAppearance,burstTime:t.BurstTime,gameDescriptionsRepository:t.GameDescriptionsRepository,questPortalRepository:t.quest.repository.QuestPortal,questListCollectionRepository:t.quest.repository.QuestListCollectionRepository};n.each(["AAreas","AUnions","ABanners","AQuests","Events","ASummons","AParties","AFriendOffers","AQuestInfo","AItems","AWorlds","Shop","ShopBuyResult","ABattles","Summons","Weapons","Items","Characters","Accessories","GameDescriptions","AQuestPortal"],function(e){a["api"+e]=t.env.useApiMock?t.MockApi[e]:t.Api[e]});var o={PageController:t.PageControllerEx,BurstTimeCountDownPanel:t.BurstTimeCountDownPanel,SupporterListsModel:t.quest.model.SupporterLists,SupporterListModel:t.quest.model.SupporterList,SelectedSupporterModel:t.quest.model.SelectedSupporter,SupporterListController:t.quest.controller.SupporterList,SupporterSelectionController:t.quest.controller.SupporterSelection,AcceRewardPopup:t.quest.view.AcceRewardPopup,AcceDataPopup:t.pc.view.AcceDataPopup,RaidQuestListsController:t.quest.raid_quest_lists.Controller,RaidQuestListsModel:t.quest.raid_quest_lists.Model,RaidQuestListsView:t.quest.raid_quest_lists.View,RaidQuestListsRepository:t.quest.raid_quest_lists.Repository,PlayerQuestPointsModel:t.model.PlayerQuestPoints,PlayerMeModel:t.model.PlayerMe,TowerQuestResultPopup:t.tower.view.TowerQuestResultPopup,SelectPartyPopup:t.quest.view.SelectPartyPopup,GameDescriptionsModel:t.GameDescriptionsModel,PopupRaQuestAppearance:t.q_003_1.PopupRaQuestAppearance};n.each(["q_portal_top","q_special_top","q_001","q_002","q_003_001","q_003_002","q_004","q_005","q_006_007_008","q_009","q_010","q_011"],function(e){n.has(i,e)&&(o[e]=i[e].Scene,o[n.camelize(e)+"Delegate"]=i[e].SceneDelegate)}),t.dictx.navigateInject.quest=function(){t.dictx.injectDependent(a,o)}}((this||0).self||global),function(e){var t=e.kh,n=e.di;t.dictx=t.dictx||n.createContext(),t.createNameSpaceIfNotExists("quest_list"),t.quest_list.DIConfig={apply:function(){var e={QuestListController:t.quest_list.Controller,QuestListModel:t.quest_list.Model,QuestListRepository:t.quest_list.Repository,QuestListView:t.quest_list.View};t.dictx.injectDependent({},e)}},t.quest_list.DIConfig.apply()}((this||0).self||global),function(e){var t=e.kh,n=e.di;t.dictx=t.dictx||n.createContext(),t.createNameSpaceIfNotExists("quest_panel"),t.quest_panel.DIConfig={apply:function(){var e={questInfoModel:t.model.QuestInfo},n={QuestPanelController:t.quest_panel.Controller,QuestModel:t.quest_panel.Model,QuestPanelView:t.quest_panel.View};t.dictx.injectDependent(e,n)}},t.quest_panel.DIConfig.apply()}((this||0).self||global),function(e){var t=e.kh,n=e.di;t.dictx=t.dictx||n.createContext(),t.createNameSpaceIfNotExists("quest_required_item"),t.quest_required_item.DIConfig={apply:function(){var e={QuestRequiredItemController:t.quest_required_item.Controller,QuestRequiredItemVerificationController:t.quest_required_item.VerificationController,QuestRequiredItemModel:t.quest_required_item.Model,QuestRequiredItemView:t.quest_required_item.View,QuestRequiredItemPopupNeedItem:t.quest_required_item.popup.NeedItem,QuestRequiredItemPopupNoItem:t.quest_required_item.popup.NoItem,QuestRequiredItemPopupFactoryRaNoItem:t.quest_required_item.popup.FactoryRaNoItem,QuestRequiredItemPopupComRaidStartCheck:t.quest_required_item.popup.ComRaidStartCheck,QuestRequiredItemPopupPanel:t.quest_required_item.popup.Panel,QuestRequiredItemPopupText:t.quest_required_item.popup.Text};t.dictx.injectDependent({},e)}},t.quest_required_item.DIConfig.apply()}((this||0).self||global),function(e){var t=e.kh,n=e.di;t.dictx=t.dictx||n.createContext(),t.createNameSpaceIfNotExists("raid_button"),t.raid_button.DIConfig={apply:function(){var e={questInfoModel:t.model.QuestInfo},n={RaidButtonView:t.view.RaidButton,RaidButtonController:t.raid_button.Controller};t.dictx.injectDependent(e,n)}},t.raid_button.DIConfig.apply()}((this||0).self||global),function(e){var t=e.kh,n=e.di;t.dictx=t.dictx||n.createContext(),t.createNameSpaceIfNotExists("sp_quest_button"),t.sp_quest_button.DIConfig={apply:function(){var e={questInfoModel:t.model.QuestInfo},n={SpQuestButtonController:t.sp_quest_button.Controller,SpQuestButtonView:t.sp_quest_button.View};t.dictx.injectDependent(e,n)}},t.sp_quest_button.DIConfig.apply()}((this||0).self||global),function(e){var t=e.kh,n=e.di;t.dictx=t.dictx||n.createContext(),t.createNameSpaceIfNotExists("player_currency"),t.player_currency.DIConfig={apply:function(){var e={apiAPlayers:t.env.useApiMock?t.MockApi.APlayers:t.Api.APlayers},n={PlayerCurrencyModel:t.player_currency.Model,PlayerCurrencyRepository:t.player_currency.Repository,PlayerCurrencyPreloader:t.player_currency.Preloader};t.dictx.injectDependent(e,n)}},t.player_currency.DIConfig.apply()}((this||0).self||global),function(e){var t=e.kh,n=e.di;t.dictx=t.dictx||n.createContext(),t.createNameSpaceIfNotExists("restore_item_vending_process"),t.restore_item_vending_process.DIConfig={apply:function(){var e={PseudoCurrencyRestoreBpItemPreloader:t.restore_item_vending_process.BpItemPseudoCurrencyPreloader,PseudoCurrencyRestoreApItemPreloader:t.restore_item_vending_process.ApItemPseudoCurrencyPreloader,StoneRestoreApItemPreloader:t.restore_item_vending_process.ApItemStonePreloader,StoneRestoreBpItemPreloader:t.restore_item_vending_process.BpItemStonePreloader,RestoreItemBuyButtonController:t.restore_item_vending_process.BuyButtonController,RestoreItemVendingProcessController:t.restore_item_vending_process.Controller,RestoreItemCurrencyAmountLabelController:t.restore_item_vending_process.CurrencyAmountLabelController};t.dictx.injectDependent({},e)}},t.restore_item_vending_process.DIConfig.apply()}((this||0).self||global),function(e){var t=e.kh,n=e.di;t.dictx=t.dictx||n.createContext(),t.createNameSpaceIfNotExists("standard_pseudo_currency_item_vending_process"),t.standard_pseudo_currency_item_vending_process.DIConfig={apply:function(){var e={StandardPseudoCurrencyItemPreloader:t.standard_pseudo_currency_item_vending_process.Preloader,StandardPseudoCurrencyItemVendingProcessController:t.standard_pseudo_currency_item_vending_process.Controller,VendingLocationInformation:t.standard_pseudo_currency_item_vending_process.LocationInformation};t.dictx.injectDependent({},e)}},t.standard_pseudo_currency_item_vending_process.DIConfig.apply()}((this||0).self||global),function(e){var t=e.kh,n=e.di;t.dictx=t.dictx||n.createContext(),t.createNameSpaceIfNotExists("vending_process"),t.vending_process.DIConfig={apply:function(){var e={PopupShBuyResult:t.vending_process.PopupShBuyResult,PopupShBuyCheck:t.vending_process.PopupShBuyCheck,PopupFactoryShBuyCheck:t.vending_process.PopupFactoryShBuyCheck,VendingProcessController:t.vending_process.Controller};t.dictx.injectDependent({},e)}},t.vending_process.DIConfig.apply()}((this||0).self||global),function(e){var t=e.kh,n=e.di;t.dictx=t.dictx||n.createContext(),t.createNameSpaceIfNotExists("vending_process"),t.vending_process.WithoutResultPopupDIConfig={apply:function(){var e={PopupShBuyResult:t.vending_process.PopupShBuyResult,PopupShBuyCheck:t.vending_process.PopupShBuyCheck,PopupFactoryShBuyCheck:t.vending_process.PopupFactoryShBuyCheck,VendingProcessController:t.vending_process.WithoutResultController};t.dictx.injectDependent({},e)}},t.vending_process.WithoutResultPopupDIConfig.apply()}((this||0).self||global),function(e){var t=e.kh,n=e.di;t.dictx=t.dictx||n.createContext(),t.createNameSpaceIfNotExists("shop_item"),t.shop_item.DIConfig={apply:function(){var e={ShopItemModel:t.shop_item.Model,ShopItemImageController:t.shop_item.ImageController,ShopItemImageView:t.shop_item.ImageView};t.dictx.injectDependent({},e)}},t.shop_item.DIConfig.apply()}((this||0).self||global),function(e){var t=e.kh,n=e._;t.pc=t.pc||{},t.pc.autospend=t.pc.autospend||{};var i=t.pc.autospend,a={};n.each(["APlayers"],function(e){a["api"+e]=t.env.useApiMock?t.MockApi[e]:t.Api[e]});var o={AutoSpendHintPopup:t.autospend.view.AutoSpendHintPopup,AutoSpendErrorPopup:t.autospend.view.AutoSpendErrorPopup,AutoSpendResultPopup:t.autospend.view.AutoSpendResultPopup};n.each(["autospend_001"],function(e){n.has(i,e)&&(o[e]=i[e].Scene,o[n.camelize(e)+"Delegate"]=i[e].SceneDelegate)}),t.dictx.navigateInject.autospend=function(){t.dictx.injectDependent(a,o)}}((this||0).self||global),function(e){var t=e.kh;t.di.battleSingletonDependencyList={scenarioPlayer:t.ScenarioPlayer,initializerRegistry:t.Initializer.InitializerRegistry,layerRegistry:t.LayerRegistry,battleCommandFactoryRegistry:t.BattleCommandFactoryRegistry,battleWorld:t.BattleWorld,battleUI:t.BattleUI,apiBattle:t.env.useApiMock?t.MockApi.InABattles:t.Api.InABattles,apiAQuests:t.env.useApiMock?t.MockApi.AQuests:t.Api.AQuests,apiAPlayers:t.env.useApiMock?t.MockApi.APlayers:t.Api.APlayers,apiShop:t.env.useApiMock?t.MockApi.Shop:t.Api.Shop,apiAStamps:t.env.useApiMock?t.MockApi.AStamps:t.Api.AStamps,apiShopBuyResult:t.env.useApiMock?t.MockApi.ShopBuyResult:t.Api.ShopBuyResult,apiEvents:t.env.useApiMock?t.MockApi.Events:t.Api.Events,pubsubBattle:t.env.usePubsubMock?t.PubsubMock:t.Api.PubsubBattle,curePopup:t.CurePopup,battleUIPopupFactory:t.BattleUIPopupFactory,summonPopup:t.SummonPopup,summonBrokenPopup:t.SummonBrokenPopup,abilityPopupNormal:t.AbilityPopupNormal,abilityPopupExtended:t.AbilityPopupExtended,abilityPopupFactory:t.AbilityPopupFactory,continuePopup:t.ContinuePopup,continuePopupFactory:t.ContinuePopupFactory,continuePopupElixir:t.ContinuePopupElixir,continuePopupNoElixir:t.ContinuePopupNoElixir,continuePopupLimitedElixir:t.ContinuePopupLimitedElixir,popupFactoryStoneCheck:t.PopupFactoryStoneCheck,myPagePopupFactory:t.MyPagePopupFactory,reliefMypagePopupFactory:t.ReliefMyPagePopupFactory,processPopupFactory:t.ProcessPopupFactory,stampPopupFactory:t.StampPopupFactory,elixirLimitPopupFactory:t.ElixirLimitPopupFactory,elixirLimitEndBattlePopupFactory:t.ElixirLimitEndBattlePopupFactory,battleStatus:t.BattleStatus,battleUrlParser:t.BattleUrlParser,treasureStatus:t.TreasureStatus,stage:t.Stage,questInfo:t.QuestInfo,cureItemInfo:t.CureItemInfo,characterStatusPanelHandler:t.CharacterStatusPanelHandler,backCheckPopupFactory:t.PopupFactoryComBackCheck,raidDIConfig:t.RaidDIConfig,playerGameConfigDISettings:t.PlayerGameConfigDISettings,autoScenarioHandler:t.AutoScenario.Handler,namePlateAnimation:t.NamePlateAnimation,burstVoiceScenario:t.BurstVoiceScenario,characterUpdater:t.CharacterUpdater},t.di.battleProtoStrategyDependencyList={BattleScene:t.BattleScene,Ability:t.Ability,ReduceHPAnimation:t.ReduceHPAnimation,GainHPAnimation:t.GainHPAnimation,NameBar:t.NameBar,ActionData:t.ActionData,BattleCommandAbility:t.BattleCommand.Ability,BattleCommandAttack:t.BattleCommand.Attack,BattleCommandCutIn:t.BattleCommand.CutIn,BattleCommandDamage:t.BattleCommand.Damage,BattleCommandHeal:t.BattleCommand.Heal,BattleCommandNormal:t.BattleCommand.Normal,BattleCommandBurst:t.BattleCommand.Burst,BattleCommandBurstResult:t.BattleCommand.BurstResult,BattleCommandSummonDamage:t.BattleCommand.SummonDamage,BattleCommandSummonMovie:t.BattleCommand.SummonMovie,BattleCommandTurn:t.BattleCommand.Turn,BattleCommandSetBurstGauge:t.BattleCommand.SetBurstGauge,BattleCommandSetEnemyModeGauge:t.BattleCommand.SetEnemyModeGauge,BattleCommandSetEnemyChargeTurn:t.BattleCommand.SetEnemyChargeTurn,BattleCommandWin:t.BattleCommand.Win,BattleCommandLose:t.BattleCommand.Lose,BattleCommandNextStage:t.BattleCommand.NextStage,BattleCommandChangeEnemyMode:t.BattleCommand.ChangeEnemyMode,BattleCommandDie:t.BattleCommand.Die,BattleCommandJoin:t.BattleCommand.Join,BattleCommandEventLogic:t.BattleCommand.EventLogic,BattleCommandRemoveStatus:t.BattleCommand.RemoveStatus,BattleCommandApplyStatus:t.BattleCommand.ApplyStatus,BattleCommandEnemiesDown:t.BattleCommand.EnemiesDown,BattleCommandBurstStreak:t.BattleCommand.BurstStreak,BattleCommandPlayVisualEffect:t.BattleCommand.PlayVisualEffect,BattleCommandBanAbility:t.BattleCommand.BanAbility,BattleCommandUnbanAbility:t.BattleCommand.UnbanAbility,BattleCommandBanBurst:t.BattleCommand.BanBurst,BattleCommandUnbanBurst:t.BattleCommand.UnbanBurst,BattleCommandMoveAvatar:t.BattleCommand.MoveAvatar,BattleCommandRevive:t.BattleCommand.Revive,BattleCommandMessage:t.BattleCommand.Message,BattleCommandCooldown:t.BattleCommand.Cooldown,CenterPanel:t.CenterPanel,AttackButton:t.AttackButton,AttributeDiagram:t.AttributeDiagram,SoundButton:t.SoundButton,BurstButton:t.BurstButton,BackButton:t.BackButton,NextButton:t.NextButton,MenuButton:t.MenuButton,ReloadButton:t.ReloadButton,CharacterPanel:t.CharacterPanel,CharacterCard:t.CharacterCard,CharacterStatusPanel:t.CharacterStatusPanel,EnemyStatusBar:t.EnemyStatusBar,HealButton:t.HealButton,StatusEffectIcon:t.StatusEffectIcon,StatusEffectIconHandler:t.StatusEffectIconHandler,StatusEffect:t.StatusEffect,SummonButton:t.SummonButton,SummonPanelGroup:t.SummonPanelGroup,SummonPanel:t.SummonPanel,SummonCard:t.SummonCard,BattleUIHeader:t.BattleUIHeader,ResultWindow:t.ResultWindow,ColorFilter:t.ColorFilter,Character:t.Character,Enemy:t.Enemy,NumberNode:t.NumberNode,PositionGenerator:t.PositionGenerator,NodeQuake:t.NodeQuake,TreasureDropper:t.TreasureDropper,TreasureDropNormal:t.TreasureDropNormal,TreasureDropSilver:t.TreasureDropSilver,TreasureDropGold:t.TreasureDropGold,TreasureDropRainbow:t.TreasureDropRainbow,TreasureDropItem:t.TreasureDropItem,TreasureDropCoin:t.TreasureDropCoin,BattleUIInitializer:t.Initializer.BattleUIInitializer,ArmatureVisualEffect:t.BattleArmatureVisualEffect,WindowVisualEffect:t.BattleWindowVisualEffect,StageProgress:t.StageProgress,StartAnimation:t.StartAnimation,TargetAnimation:t.TargetAnimation,BossAnimation:t.BossAnimation,AvatarOrderHandler:t.AvatarOrderHandler,FallenAvatarOrderHandler:t.FallenAvatarOrderHandler,ElixirLimitPopup:t.ElixirLimitPopup,CutinHandlerPlayerBurst:t.CutInHandler.PlayerBurst,CutinHandlerPlayerBeatdown:t.CutInHandler.PlayerBeatdown,CutinHandlerBurstStreak:t.CutInHandler.BurstStreak,ElixirInfo:t.ElixirInfo,AutoButton:t.AutoButton,AutoScenarioAttack:t.AutoScenario.Attack,AutoScenarioNext:t.AutoScenario.Next,AutoScenarioAbility:t.AutoScenario.Ability,AutoScenarioStateHandler:t.AutoScenario.State.Handler,AutoScenarioStateIterator:t.AutoScenario.State.Iterator,AutoScenarioStateAttack:t.AutoScenario.State.Attack,AutoScenarioStateAbility:t.AutoScenario.State.Ability,AutoScenarioStateDisabled:t.AutoScenario.State.Disabled,AutoScenarioStateInterrupted:t.AutoScenario.State.Interrupted,AutoScenarioTriggerHandler:t.AutoScenario.Trigger.Handler,AutoScenarioTriggerEndStage:t.AutoScenario.Trigger.EndStage,RestoreItemBuyButtonController:t.restore_item_vending_process.BattleBuyButtonController}}((this||0).self||global),function(e){var t=e.kh;t.di.battleSingletonDependencyList=_.assign(t.di.battleSingletonDependencyList,{abilityPopupNormal:t.AbilityInfoSlide,autoButton:t.AutoButton}),t.di.battleProtoStrategyDependencyList=_.assign(t.di.battleProtoStrategyDependencyList,{AQ001MenuPopup:t.battle.view.AQ001MenuPopup,AQ001StatusPopup:t.battle.view.AQ001StatusPopup,AQ001SkillGo1Popup:t.battle.view.AQ001SkillGo1Popup}),t.dictx.navigateInject.battle=function(){t.dictx.injectDependent(t.di.battleSingletonDependencyList,t.di.battleProtoStrategyDependencyList)},t.dictx.injectDependent({},{BattleScene:t.BattleScene})}((this||0).self||global),function(e){var t=e.kh,n=e._;t.pc=t.pc||{},t.pc.beginner_mission||t.pc.beginner_mission;var i=t.pc.beginner_mission,a={sceneManager:t.SceneManager,unionRouter:t.UnionRouter,soundPlayer:t.SoundPlayer,BeginnerMissionPageController:t.beginner_mission.controller.MissionPageController};n.each(["AUnions","APanelMissions","ASubTutorialPages","Weapons","Summons","Items","PackageItems","Accessories"],function(e){a["api"+e]=t.env.useApiMock?t.MockApi[e]:t.Api[e]});var o={ImplantedSubTutorialPopup:t.core.view.ImplantedSubTutorialPopup,ShPackageItemInfoPopup:t.core.item.ShPackageItemInfoPopup,AcceDataPopup:t.pc.view.AcceDataPopup};n.each(["beginner_mission_main"],function(e){n.has(i,e)&&(o[e]=i[e].Scene,o[n.camelize(e)+"Delegate"]=i[e].SceneDelegate)}),t.dictx.navigateInject.beginner_mission=function(){t.dictx.injectDependent(a,o)}}((this||0).self||global),function(){var e={};_.each([],function(t){e["api"+t]=kh.env.useApiMock?kh.MockApi[t]:kh.Api[t]});var t={ComFilterOtherPopup:kh.displayFilter.view.ComFilterPopup,ComFilterCharaPopup:kh.displayFilter.view.ComCharacterFilterPopup,ComFilterWeaponPopup:kh.displayFilter.view.ComWeaponFilterPopup};kh.dictx.injectDependent(e,t)}(),function(e){var t=e.kh,n=e._;t.pc=t.pc||{},t.pc.book||t.pc.book;var i=t.pc.book,a={sceneManager:t.SceneManager,characterPageSettings:t.book.settings.CharacterPageSettings,weaponPageSettings:t.book.settings.WeaponPageSettings,summonPageSettings:t.book.settings.SummonPageSettings,accessoryPageSettings:t.book.settings.AccessoryPageSettings,accessoryInfoModel:t.acce.model.AccessoryInfo};n.each(["AUnions","ABanners","Items","AQuestInfo","ACharacters","ASummons","Summons","AWeapons","Weapons","AAccessories","ASubTutorialPages"],function(e){a["api"+e]=t.env.useApiMock?t.MockApi[e]:t.Api[e]});var o={SceneData:t.book.book_001.SceneData,PulldownSortConfig:t.PulldownSortConfig,TabPageController:t.book.controller.TabPageController,CharacterTouchEventHandler:t.book.eventHandling.CharacterTouchEventHandler,WeaponTouchEventHandler:t.book.eventHandling.WeaponTouchEventHandler,SummonTouchEventHandler:t.book.eventHandling.SummonTouchEventHandler,AccessoryTouchEventHandler:t.book.eventHandling.AccessoryTouchEventHandler,InventoryPageListController:t.book.controller.InventoryPageListController,CanNotUseAccessoryPopup:t.book.view.CanNotUseAccessoryPopup,AcceDetailSellPopup:t.acce.view.AcceDetailSellPopup,AcceSellCheckPopup:t.acce.view.AcceSellCheckPopup,AcceSellResultPopup:t.acce.view.AcceSellResultPopup,AccessoryModel:t.acce.model.Accessory,SummonOrbAmountLabelController:t.core.controller.SummonOrbAmountLabelController};n.each(["book_001"],function(e){n.has(i,e)&&(o[e]=i[e].Scene,o[n.camelize(e)+"Delegate"]=i[e].SceneDelegate)}),t.dictx.navigateInject.book=function(){t.dictx.injectDependent(a,o)}}((this||0).self||global),function(e){var t=e.kh,n=e._;t.pc=t.pc||{},t.pc.conquest=t.pc.conquest||{};var i=t.pc.conquest,a={sceneManager:t.SceneManager,questEventModel:t.conquest.model.QuestEvent,questSceneCommonDelegate:t.QuestScenePcCommonDelegate,popupFactoryComBackCheck:t.PopupFactoryComBackCheck,popupFactoryComBackResult:t.PopupFactoryComBackResult,popupFactoryComNeedApBp:t.PopupFactoryComNeedApBp,popupFactoryComNeedApBp1:t.PopupFactoryComNeedApBp1,popupFactoryComNeedApBp2:t.PopupFactoryComNeedApBp2,popupFactoryComApRestart:t.PopupFactoryComApRestart,popupFactoryComUseResult:t.PopupFactoryComUseResult,popupFactoryComRaidCheck:t.PopupFactoryComRaidCheck,popupFactoryComQuestInfo:t.PopupFactoryComQuestInfo,popupFactoryComAgeLimit:t.PopupFactoryComAgeLimitB,episodeImage:t.EpisodeImage};n.each(["AUnions","ABanners","AWorlds","AQuests","AQuestInfo","AItems","ASubTutorialPages","Events","AEvents","Shop","Weapons","Summons","Items","Accessories","Characters","Gacha","Episodes","ShopBuyResult"],function(e){a["api"+e]=t.env.useApiMock?t.MockApi[e]:t.Api[e]});var o={ComOpenEpisodePopup:t.pc.view.ComOpenEpisodePopup,ImplantedEventSubTutorialPopup:t.core.view.ImplantedEventSubTutorialPopup,TreasureModel:t.core.treasure_panel.TreasureModel,TreasureNameView:t.core.treasure_panel.TreasureNameView,StockInfoModel:t.core.treasure_panel.StockInfoModel,StockInfoView:t.core.treasure_panel.StockInfoView};n.each(["con_000","con_001","con_002","con_005"],function(e){n.has(i,e)&&(o[e]=i[e].Scene,o[n.camelize(e)+"Delegate"]=i[e].SceneDelegate)}),t.dictx.navigateInject.conquest=function(){t.dictx.injectDependent(a,o)}}((this||0).self||global),function(e){var t=e.kh,n=e._;t.pc=t.pc||{},t.pc.detail||t.pc.detail;var i=t.pc.detail,a={accessoryInfoModel:t.acce.model.AccessoryInfo,accessoryPointInfoModel:t.acce.model.AccessoryPointInfo,weaponSellButtonTouchEventHandler:t.detail.eventHandling.WeaponSellButtonTouchEventHandler,summonSellButtonTouchEventHandler:t.detail.eventHandling.SummonSellButtonTouchEventHandler};n.each(["AUnions","AParties","Items","Weapons","AWeapons","ASummons","Summons","ACharacters","Characters","ABanners","AAccessories","AFavoriteMember","ASupportSummonSetting"],function(e){a["api"+e]=t.env.useApiMock?t.MockApi[e]:t.Api[e]});var o={AccessoryModel:t.acce.model.Accessory,AcceDetailSwapPopup:t.acce.view.AcceDetailSwapPopup,AcceOthersDetailPopup:t.acce.view.AcceOthersDetailPopup,AcceReleaseCheckPopup:t.acce.view.AcceReleaseCheckPopup,AcceInfoPopup:t.acce.view.AcceInfoPopup,AcceSeriesHintPopup:t.acce.view.AcceSeriesHintPopup,AcceSetPopup:t.acce.view.AcceSetPopup,ComSellWeaponsPopup:t.list.popup.comSellWeapons,ComSellSummonsPopup:t.list.popup.comSellSummons,LiWeasellCheckPopup:t.detail.view.LiWeasellCheckPopup,LiWeasellResultPopup:t.detail.view.LiWeasellResultPopup,AcceUnlockPopup:t.detail.view.AcceUnlockPopup,DetailSellCheckPopupController:t.detail.controller.DetailSellCheckPopupController,DetailSellResultPopupController:t.detail.controller.DetailSellResultPopupController,DetailBackButtonsController:t.detail.controller.DetailBackButtonsController,CanNotUseAccessoryPopup:t.book.view.CanNotUseAccessoryPopup,FavoriteInfoPopup:t.party.view.FavoriteInfoPopup,ChangeAppearancePopup:t.detail.view.ChangeAppearancePopup,AFavoriteMemberModel:t.party.model.AFavoriteMember,ShItemInfoOnAcceUnlockPopup:t.core.item.ShItemInfoOnAcceUnlockPopup,characterAccessoriesModel:t.acce.model.CharacterAccessories};n.each(["de_001_002","de_003","de_004"],function(e){n.has(i,e)&&(o[e]=i[e].Scene,o[n.camelize(e)+"Delegate"]=i[e].SceneDelegate)}),t.dictx.navigateInject.detail=function(){t.dictx.injectDependent(a,o)}}((this||0).self||global),function(e){var t=e.kh,n=e._;t.pc=t.pc||{},t.pc.enh_evo||t.pc.enh_evo;var i=t.pc.enh_evo,a={sceneManager:t.SceneManager,popupFactoryAbilityAcquired:t.PopupFactoryAbilityAcquired,popupCharacterAbilityImproved:t.PopupFactoryCharacterAbilityImproved,popupFactoryEvoItemChoose:t.PopupFactoryEvoItemChoose};n.each(["AUnions","AWorlds","AWeapons","ACharacters","Characters","ASummons","Summons","Items","ASubTutorialPages","ABanners","AQuestInfo"],function(e){a["api"+e]=t.env.useApiMock?t.MockApi[e]:t.Api[e]});var o={PulldownSortConfig:t.PulldownSortConfig,EvoMateCheckPopup:t.enh_evo.view.popup.EvoMateCheckPopup,ArouseMateCheckPopup:t.enh_evo.view.popup.ArouseMateCheckPopup,EnhRecommendSettingPopup:t.enh_evo.view.popup.EnhRecommendSettingPopup,EnhRareCheckPopup:t.enh_evo.view.popup.EnhRareCheckPopup,EvolutionItemModel:t.enh_evo.model.EvolutionItem,EvolutionItemsModel:t.enh_evo.model.EvolutionItems,SubTutorialOnEnhUseExpitemPopup:t.evo.view.SubTutorialOnEnhUseExpitemPopup};n.each(["enh_001_002_006_evo_001_002_003","enh_007","enh_008","enh_009","enh_013","enh_014","enh_015","evo_007","evo_008","evo_009","evo_010","evo_012","evo_013","evo_014","arousal_002","arousal_003"],function(e){n.has(i,e)&&(o[e]=i[e].Scene,o[n.camelize(e)+"Delegate"]=i[e].SceneDelegate)}),t.dictx.navigateInject.enh_evo=function(){t.dictx.injectDependent(a,o)}}((this||0).self||global),function(e){var t=e.kh,n=e._,i=t.pc.epi,a={questStateManager:t.QuestStateManager,popupFactoryEpiSceneCheck:t.PopupFactoryEpiSceneCheck,popupFactoryEpiStoryCheck:t.PopupFactoryEpiStoryCheck,popupFactoryEpiReplayCheck:t.PopupFactoryEpiReplayCheck,popupFactoryEpiApCheck:t.PopupFactoryEpiApCheck,popupFactoryComBackCheck:t.PopupFactoryComBackCheck,popupFactoryComBackResult:t.PopupFactoryComBackResult,popupFactoryComApRestart:t.PopupFactoryComApRestart,popupFactoryComRaidCheck:t.PopupFactoryComRaidCheck,popupFactoryComNeedApBp1:t.PopupFactoryComNeedApBp1,popupFactoryComNeedApBp2:t.PopupFactoryComNeedApBp2,popupFactoryComUseResult:t.PopupFactoryComUseResult,popupFactoryComAgeLimitB:t.PopupFactoryComAgeLimitB,popupFactoryComAgeLimit:t.PopupFactoryComAgeLimitB,episodeImage:t.EpisodeImage};n.each(["AUnions","ACharacters","ASummons","AJobs","AQuests","ALibrary","ABanners","AWorlds","Episodes","HaremScenes","AItems","ASubTutorialPages"],function(e){a["api"+e]=t.env.useApiMock?t.MockApi[e]:t.Api[e]});var o={CoreCardMainQuestUI:t.CoreCardMainQuestUI,ApGauge:t.ApGauge,EpiQuestButton:t.epi.QuestButton,EpisodeButton:t.epi.EpisodeButton,EpiChapterSelectPopup:t.epi.view.EpiChapterSelectPopup,ComAgeLimitAPopup:t.pc.view.ComAgeLimitAPopup,PulldownSortConfig:t.PulldownSortConfig,PageSettingsFactory:t.epi.settings.PageSettingsFactory,CharacterPageSettings:t.epi.settings.CharacterPageSettings,SummonPageSettings:t.epi.settings.SummonPageSettings,JobPageSettings:t.epi.settings.JobPageSettings,MainQuestPageSettings:t.epi.settings.MainQuestPageSettings};n.each(["epi_001","epi_002_003_004"],function(e){n.has(i,e)&&(o[e]=i[e].Scene,o[n.camelize(e)+"Delegate"]=i[e].SceneDelegate)}),n.each(["epi_002","epi_003","epi_004"],function(e){n.has(i.epi_002_003_004,e)&&(o[e]=i.epi_002_003_004.Scene,o[n.camelize(e)+"Delegate"]=i.epi_002_003_004[e].SceneDelegate)}),t.dictx.navigateInject.epi=function(){t.dictx.injectDependent(a,o)}}((this||0).self||global),function(e){var t=e.kh,n=e._;t.pc=t.pc||{},t.pc.epic=t.pc.epic||{};var i=t.pc.epic,a={questSceneCommonDelegate:t.QuestScenePcCommonDelegate,popupFactoryComBackCheck:t.PopupFactoryComBackCheck,popupFactoryComBackResult:t.PopupFactoryComBackResult,popupFactoryComNeedApBp:t.PopupFactoryComNeedApBp,popupFactoryComNeedApBp1:t.PopupFactoryComNeedApBp1,popupFactoryComNeedApBp2:t.PopupFactoryComNeedApBp2,popupFactoryComApRestart:t.PopupFactoryComApRestart,popupFactoryComUseResult:t.PopupFactoryComUseResult,popupFactoryComRaidCheck:t.PopupFactoryComRaidCheck};n.each(["APlayers","AEvents","Events","AQuests","Quests","AMissions","ASubTutorialPages","AItems","Accessories","Shop","ShopBuyResult","AEpicSubject"],function(e){a["api"+e]=t.env.useApiMock?t.MockApi[e]:t.Api[e]});var o={ImplantedSubTutorialPopup:t.core.view.ImplantedSubTutorialPopup,QuestRequiredItemModel:t.quest_required_item.Model};n.each(["epic_quest_list","epic_select","epic_quest_top"],function(e){n.has(i,e)&&(o[e]=i[e].Scene,o[n.camelize(e)+"Delegate"]=i[e].SceneDelegate)}),t.dictx.navigateInject.epic=function(){t.dictx.injectDependent(a,o)}}((this||0).self||global),function(e){var t=e.kh,n=e._;t.pc=t.pc||{},t.pc.event=t.pc.event||{};var i=t.pc.event,a={};n.each(["AQuestInfo","AEvents","Events","ABanners"],function(e){a["api"+e]=t.env.useApiMock?t.MockApi[e]:t.Api[e]});var o={};n.each(["ev_000"],function(e){n.has(i,e)&&(o[e]=i[e].Scene,o[n.camelize(e)+"Delegate"]=i[e].SceneDelegate)}),t.dictx.injectDependent(a,o)}((this||0).self||global),function(e){var t=e.kh,n=e._;t.pc=t.pc||{},t.pc.exchangeitem||t.pc.exchangeitem;var i=t.pc.exchangeitem,a={};n.each(["ABanners","AItems","AExchangeItemShop"],function(e){a["api"+e]=t.env.useApiMock?t.MockApi[e]:t.Api[e]});var o={ExchangeController:t.exchangeitem.exchange.Controller,ExchangePopupController:t.exchangeitem.exchange.confirm.PopupController,ExchangeContentItemModel:t.exchangeitem.exchange.ContentItemModel,ExchangeReleaseCharacterModel:t.exchangeitem.exchange.ReleaseCharacterModel,ExchangeItemCoreCardView:t.exchangeitem.exchange.CoreCardView,ExchangeContentSummonView:t.exchangeitem.exchange.confirm.ContentSummonView,ExchangeContentWeaponView:t.exchangeitem.exchange.confirm.ContentWeaponView,ExchangeContentCharacterView:t.exchangeitem.exchange.confirm.ContentCharacterView,ExchangeResultController:t.exchangeitem.exchange.result.Controller};n.each(["exchit_001"],function(e){n.has(i,e)&&(o[e]=i[e].Scene,o[n.camelize(e)+"Delegate"]=i[e].SceneDelegate)}),t.dictx.injectDependent(a,o)}((this||0).self||global),function(e){var t=e.kh,n=e._;t.pc=t.pc||{},t.pc.friend||t.pc.friend;var i=t.pc.friend,a={popupFactoryComGreeting:t.PopupFactoryComGreeting};n.each(["AUnions","AFriendOffers","AQuestInfo","AFriends","ABanners","AGreets","AWorlds","AStamps"],function(e){a["api"+e]=t.env.useApiMock?t.MockApi[e]:t.Api[e]});var o={};n.each(["fr_001","fr_002_003"],function(e){n.has(i,e)&&(o[e]=i[e].Scene,o[n.camelize(e)+"Delegate"]=i[e].SceneDelegate)}),t.dictx.injectDependent(a,o)}((this||0).self||global),function(e){var t=e.kh,n=e._;t.pc=t.pc||{},t.pc.gacha||t.pc.gacha;var i=t.pc.gacha,a={sceneManager:t.SceneManager,popupFactoryGaCheckUseStoneTicket:t.PopupFactoryGaCheckUseStoneTicket,popupFactoryGaTips:t.PopupFactoryGaTips,episodeImage:t.EpisodeImage,gachaContentsCharacterWeaponPageView:t.gacha.view.GachaContentsCharacterWeaponPageView,gachaContentsWeaponPageView:t.gacha.view.GachaContentsWeaponPageView,gachaContentsSummonPageView:t.gacha.view.GachaContentsSummonPageView,gachaContentsViewController:t.gacha.controller.GachaContentsViewController,gachaContentsTypeTabController:t.gacha.controller.GachaContentsTypeTabController,gachaContentsRarityTabController:t.gacha.controller.GachaContentsRarityTabController,gachaContentsPulldownController:t.gacha.controller.GachaContentsPulldownController};n.each(["AUnions","AWorlds","AParties","ABanners","AGacha","GachaCategory","GachaCategories","AGachaResult","ACharacters","Characters","Summons","ASummons","Weapons","AWeapons","Items","Gacha","AQuestInfo","Episodes","GachaCategories","ASubTutorialPages"],function(e){a["api"+e]=t.env.useApiMock?t.MockApi[e]:t.Api[e]});var o={GachaCategoryModel:t.gacha.gacha_category.GachaCategoryModel,GachaModel:t.gacha.gacha_category.GachaModel,PriceModel:t.gacha.vending_machine.PriceModel,PriceRepository:t.gacha.vending_machine.PriceRepository,GachaCurrencyAmountLabelController:t.gacha.vending_machine.currency_amount_label.Controller,GachaCurrencyAmountLabelView:t.gacha.vending_machine.currency_amount_label.View,GachaCurrencyAmountSeparateLabelController:t.gacha.vending_machine.currency_amount_label.SeparateController,GachaCurrencyAmountSeparateLabelView:t.gacha.vending_machine.currency_amount_label.SeparateView,PopupGaCheckUseStone:t.gacha.vending_machine.vending_process.PopupGaCheckUseStone,PopupGaNeedUseStone:t.gacha.vending_machine.vending_process.PopupGaNeedUseStone,VendingController:t.gacha.vending_machine.vending_process.VendingController,BuyButtonController:t.gacha.vending_machine.buy_buttons.BuyButtonController,BuyButtonView:t.gacha.vending_machine.buy_buttons.BuyButtonView,RateButtonController:t.gacha.rate_button.Controller,RateButtonView:t.gacha.rate_button.View,ExchangeItemController:t.gacha.exchangeItem.ExchangeItemController,ExchangeItemButtonController:t.gacha.exchangeItem.ExchangeItemButtonController,GaTipsPopup:t.gacha.view.GaTipsPopup,GachaContents:t.gacha.model.GachaContents,GachaTypeContentsList:t.gacha.model.GachaTypeContentsList,GachaContentsInfo:t.gacha.model.GachaContentsInfo,GachaContentsInfoList:t.gacha.model.GachaContentsInfoList};n.each(["ga_000","ga_100","ga_010","ga_ani","ga_contents_list"],function(e){n.has(i,e)&&(o[e]=i[e].Scene,o[n.camelize(e)+"Delegate"]=i[e].SceneDelegate)}),t.dictx.navigateInject.gacha=function(){t.dictx.injectDependent(a,o)}}((this||0).self||global),function(e){var t=e.kh,n=e._;t.pc=t.pc||{},t.pc.guild||t.pc.guild;var i=t.pc.guild,a={popupFactoryComRoleChange:t.PopupFactoryComRoleChange,popupFactoryComChat:t.PopupFactoryComGreeting,popupFactoryGudGuardianDetail:t.PopupFactoryGudGuardianDetail,popupFactoryGudGuardianDetailB:t.PopupFactoryGudGuardianDetailB,popupFactoryGudGuardianNomoney:t.PopupFactoryGudGuardianNomoney,popupFactoryGudGuardianBuy:t.PopupFactoryGudGuardianBuy,popupFactoryGudGuardianResult:t.PopupFactoryGudGuardianResult,popupFactoryGudGuardianChange:t.PopupFactoryGudGuardianChange,popupFactoryGudChangeResult:t.PopupFactoryGudChangeResult,popupFactoryGud000Attention:t.PopupFactoryGud000Attention,popupFactoryGud000Forbidden:t.PopupFactoryGud000Forbidden,popupFactoryGud001Control:t.PopupFactoryGud001Control,popupFactoryGud001UncontrolBurstTime:t.PopupFactoryGud001UncontrolBurstTime,popupFactoryGud001Uncontrol:t.PopupFactoryGud001Uncontrol,popupFactoryGud001Edit:t.PopupFactoryGud001Edit,popupFactoryGud001Leave:t.PopupFactoryGud001Leave,popupFactoryGud001Break:t.PopupFactoryGud001Break,popupFactoryGud001BurstTimeChange:t.PopupFactoryGud001BurstTimeChange,popupFactoryGud001BurstTimeResult:t.PopupFactoryGud001BurstTimeResult,popupFactoryGudNameCha:t.PopupFactoryGudNameCha,popupFactoryGudNameEnd:t.PopupFactoryGudNameEnd,popupFactoryComEditNocom:t.PopupFactoryComEditNocom,popupFactoryGudGemAmount:t.PopupFactoryGudGemAmount,popupFactoryGudGemCheck:t.PopupFactoryGudGemCheck,popupFactoryGudGemRankup:t.PopupFactoryGudGemRankup,popupFactoryGudGemResult:t.PopupFactoryGudGemResult,popupFactoryGud002Detail:t.PopupFactoryGud002Detail,popupFactoryGudMyStatus:t.PopupFactoryGudMyStatus,popupFactoryGudRequestEnd:t.PopupFactoryGudRequestEnd,popupFactoryGudRequestDelete:t.PopupFactoryGudRequestDelete,popupFactoryComMemberFire:t.PopupFactoryComMemberFire,popupFactoryComLeaderChange:t.PopupFactoryComLeaderChange,popupFactoryComLeaderChangeDone:t.PopupFactoryComLeaderChangeDone,burstTime:t.BurstTime};n.each(["AQuestInfo","ABanners","AUnions","AUnionAuthority","AUnionCheck","AUnionJoinConditions","AUnionJoinRequests","AUnionScoutsSearch","AUnionScouts","AUnionSearch","AFriends","AWorlds","AWeapons","ACharacters","AStamps","UnionUnavailableOperation","ASubTutorialPages"],function(e){a["api"+e]=t.env.useApiMock?t.MockApi[e]:t.Api[e]});var o={PulldownSortConfig:t.PulldownSortConfig,BurstTimeSubTutorialPanel:t.BurstTimeSubTutorialPanel,Gud001ControlAnimation:t.Gud001ControlAnimation,GuildControlPermissionModel:t.pc.guild.model.GuildControlPermissions,GuildSearchInfoDataModel:t.pc.guild.model.GuildSearchInfoData,ComEnhGuardianCheckPopup:t.guild.popup.comEnhGuardian,GudSearchSettingPopup:t.guild.popup.GudSearchSetting,GuildRequestSetConditionPopup:t.guild.view.popup.GuildRequestSetConditionPopup};n.each(["gud_000_a","gud_000_b","gud_000_c","gud_001","gud_002","gud_003","gud_005","gud_006","gud_007_leader","gud_007_not_leader","gud_008","gud_009","gud_010_011_012","gud_013_a","gud_013_b"],function(e){n.has(i,e)&&(o[e]=i[e].Scene,o[n.camelize(e)+"Delegate"]=i[e].SceneDelegate)}),t.dictx.navigateInject.guild=function(){t.dictx.injectDependent(a,o)}}((this||0).self||global),function(e){var t=e.kh,n=e._;t.pc=t.pc||{},t.pc.epic=t.pc.highjob||{};var i=t.pc.highjob,a={popupFactoryComOpenJobEpisode:t.PopupFactoryComOpenJobEpisode};n.each(["APlayers","AWeapons","AJobs","ASubTutorialPages"],function(e){a["api"+e]=t.env.useApiMock?t.MockApi[e]:t.Api[e]});var o={PulldownSortConfig:t.PulldownSortConfig,ImplantedSubTutorialPopup:t.core.view.ImplantedSubTutorialPopup,ShItemInfoPopup:t.core.item.ShItemInfoPopup,ShWeaponInfoPopup:t.core.item.ShWeaponInfoPopup,WeaponInfoOnWeaponCheckPopup:t.highjob.view.WeaponInfoOnWeaponCheckPopup,WeaponInfoOnStepCheckDoPopup:t.highjob.view.WeaponInfoOnStepCheckDo,ItemInfoOnStepCheckDoPopup:t.highjob.view.ItemInfoOnStepCheckDo};n.each(["highjob_main","highjob_weapon_select"],function(e){n.has(i,e)&&(o[e]=i[e].Scene,o[n.camelize(e)+"Delegate"]=i[e].SceneDelegate)}),t.dictx.navigateInject.highjob=function(){t.dictx.injectDependent(a,o)}}((this||0).self||global),function(e){var t=e.kh,n=e._;t.pc=t.pc||{},t.pc.hlbattle=t.pc.hlbattle||{};var i=t.pc.hlbattle,a={aGuildOrderRepository:t.hlbattle.repository.AGuildOrderRepository,popupFactoryComBackCheck:t.PopupFactoryComBackCheck,popupFactoryComBackResult:t.PopupFactoryComBackResult,popupFactoryComNeedApBp:t.PopupFactoryComNeedApBp,popupFactoryComNeedApBp1:t.PopupFactoryComNeedApBp1,popupFactoryComNeedApBp2:t.PopupFactoryComNeedApBp2,popupFactoryComApRestart:t.PopupFactoryComApRestart,popupFactoryComUseResult:t.PopupFactoryComUseResult,popupFactoryComRaidCheck:t.PopupFactoryComRaidCheck,popupFactoryComQuestInfo:t.PopupFactoryComQuestInfo,popupFactoryComAgeLimit:t.PopupFactoryComAgeLimitB,popupFactoryRaQuestAppearance:t.PopupFactoryRaQuestAppearance};n.each(["AQuests","AQuestInfo","AEvents","Items","AItems","Shop","PackageItems","Weapons","Summons","Accessories","Events","ABanners","AUnions","AGuildOrder"],function(e){a["api"+e]=t.env.useApiMock?t.MockApi[e]:t.Api[e]});var o={RewardButtonController:t.core.reward.RewardButtonController,RewardModel:t.core.reward.RewardModel,RewardPageListController:t.core.reward.RewardPageListController,RewardController:t.core.reward.RewardController,RewardPanelView:t.core.reward.RewardPanelView,RewardButtonView:t.core.reward.RewardButtonView,ReceiveRewardButtonTouchEventHandler:t.core.reward.ReceiveRewardButtonTouchEventHandler,ReceiveMissionRewardButtonTouchEventHandler:t.hlbattle.eventHandling.ReceiveMissionRewardButtonTouchEventHandler,ReceiveConfirmedEventHandler:t.hlbattle.eventHandling.ReceiveConfirmedEventHandler,ReceiveAllButtonTouchEventHandler:t.hlbattle.eventHandling.ReceiveAllButtonTouchEventHandler,AGuildOrderRepository:t.hlbattle.repository.AGuildOrderRepository,AGuildOrderModel:t.hlbattle.model.AGuildOrderModel,BountyQuestModel:t.hlbattle.model.BountyQuestModel,MissionModel:t.hlbattle.model.MissionModel,MissionController:t.hlbattle.controller.MissionController,MissionPanelView:t.hlbattle.view.MissionPanelView,MissionPageListSettings:t.hlbattle.settings.MissionPageListSettings,MissionPageListController:t.hlbattle.controller.MissionPageListController,PointRewardPanelView:t.hlbattle.view.PointRewardPanelView,PointPageListController:t.hlbattle.controller.PointPageListController,PointPageListSettings:t.hlbattle.settings.PointPageListSettings,BackgroundView:t.hlbattle.view.BackgroundView,EnemyImageView:t.hlbattle.view.EnemyImageView,AGuildOrderLabelsController:t.hlbattle.controller.AGuildOrderLabelsController,MissionPageDelegate:t.pc.hlbattle.hlbattle_001.MissionPageDelegate,PointPageDelegate:t.pc.hlbattle.hlbattle_001.PointPageDelegate,RecommendedElementView:t.hlbattle.view.RecommendedElementView,BountiesBtnView:t.hlbattle.view.BountiesBtnView,HLBattleWantedPopupController:t.hlbattle.controller.HLBattleWantedPopupController,HLBattleGetErrorPopupController:t.hlbattle.controller.HLBattleGetErrorPopupController,ExclamationIconView:t.hlbattle.view.ExclamationIconView,ReceivableStatusUIController:t.hlbattle.controller.ReceivableStatusUIController,AcceDataPopup:t.pc.view.AcceDataPopup,PrsReceivePopup:t.pc.view.PrsReceivePopup,ShPackageItemInfoPopup:t.core.item.ShPackageItemInfoPopup,OpeningEpisode:t.hlbattle.interrupt.OpeningEpisode};n.each(["hlbattle_001"],function(e){n.has(i,e)&&(o[e]=i[e].Scene,o[n.camelize(e)+"Delegate"]=i[e].SceneDelegate)}),t.dictx.navigateInject.hlbattle=function(){t.dictx.injectDependent(a,o)}}((this||0).self||global),function(e){var t=e.kh,n=e._;t.pc=t.pc||{},t.pc.item||t.pc.item;var i=t.pc.item,a={sceneManager:t.SceneManager,soundPlayer:t.SoundPlayer,popupFactoryItInfo:t.PopupFactoryItInfo,popupFactoryItUseCheck:t.PopupFactoryItUseCheck,popupFactoryItUseResult:t.PopupFactoryItUseResult,popupFactoryItTicketCheck:t.PopupFactoryItTicketCheck};n.each(["AUnions","AItems","ABanners","AWorlds","AQuestInfo"],function(e){a["api"+e]=t.env.useApiMock?t.MockApi[e]:t.Api[e]});var o={ItTimeLimitTicketCheckPopup:t.item.view.ItTimeLimitTicketCheckPopup,ItemExpireDateTimeList:t.item.view.ItemExpireDateTimeList};n.each(["it_001"],function(e){n.has(i,e)&&(o[e]=i[e].Scene,o[n.camelize(e)+"Delegate"]=i[e].SceneDelegate)}),t.dictx.navigateInject.item=function(){t.dictx.injectDependent(a,o)}}((this||0).self||global),function(e){var t=e.kh,n=e._;t.pc=t.pc||{},t.pc.list||t.pc.list;var i=t.pc.list,a={};n.each(["AUnions","AQuestInfo","ACharacters","ASummons","Summons","ABanners","AWorlds","AWeapons","Items"],function(e){a["api"+e]=t.env.useApiMock?t.MockApi[e]:t.Api[e]});var o={PulldownSortConfig:t.PulldownSortConfig,ComSellWeaponsPopup:t.list.popup.comSellWeapons,ComSellSummonsPopup:t.list.popup.comSellSummons,SummonOrbAmountLabelController:t.core.controller.SummonOrbAmountLabelController};n.each(["li_007_008"],function(e){n.has(i,e)&&(o[e]=i[e].Scene,o[n.camelize(e)+"Delegate"]=i[e].SceneDelegate)}),t.dictx.navigateInject.list=function(){t.dictx.injectDependent(a,o)}}((this||0).self||global),function(e){var t=e.kh,n=e._;t.pc=t.pc||{},t.pc.mission||t.pc.mission;var i=t.pc.mission,a={sceneManager:t.SceneManager,unionRouter:t.UnionRouter,dailyMissionListModel:t.mission.model.DailyMissionList,weeklyMissionListModel:t.mission.model.WeeklyMissionList,eventMissionListModel:t.mission.model.EventMissionList};n.each(["ABanners","AWorlds","AQuestInfo","AUnions","Weapons","Summons","Items","AMissions"],function(e){a["api"+e]=t.env.useApiMock?t.MockApi[e]:t.Api[e]});var o={MissionModel:t.mission.model.Mission,MissionRewardModel:t.mission.model.Reward,DailyCompleteRewardView:t.mission.view.DailyCompleteReward,WeeklyCompleteRewardView:t.mission.view.WeeklyCompleteReward,EventCharacterView:t.mission.view.EventCharacter,EventAttentionView:t.mission.view.EventAttention,NormalAttentionView:t.mission.view.NormalAttention,PrsReceivePopup:t.pc.view.PrsReceivePopup};n.each(["mission_001"],function(e){n.has(i,e)&&(o[e]=i[e].Scene,o[n.camelize(e)+"Delegate"]=i[e].SceneDelegate)}),t.dictx.navigateInject.mission=function(){t.dictx.injectDependent(a,o)}}((this||0).self||global),function(e){var t=e.kh,n=e._;t.pc=t.pc||{},t.pc.mypage||t.pc.mypage;var i=t.pc.mypage,a={sceneManager:t.SceneManager,unionRouter:t.UnionRouter,burstTime:t.BurstTime,popupFactoryComNeedApBp:t.PopupFactoryComNeedApBp,popupFactoryComNeedApBp1:t.PopupFactoryComNeedApBp1,popupFactoryComNeedApBp2:t.PopupFactoryComNeedApBp2,popupFactoryComUseResult:t.PopupFactoryComUseResult};n.each(["AQuestInfo","News","AMail","AMypage","APresents","AParties","AUnions","AWorlds","AMissions","ABanners","ANoticePopups","ShopBuyResult","AFavoriteMember","AItems","Shop"],function(e){a["api"+e]=t.env.useApiMock?t.MockApi[e]:t.Api[e]});var o={LoginBonus:t.LoginBonus,AddGachaContents:t.AddGachaContents,BurstTimeCountDownPanel:t.BurstTimeCountDownPanel,TimeLimitItemController:t.mypage.controller.TimeLimitItem,ItemExpireInfoModel:t.mypage.model.ItemExpireInfo,TimeLimitItemModel:t.mypage.model.TimeLimitItem,MyTimeLimitTicketCautionPopup:t.mypage.view.MyTimeLimitTicketCautionPopup,NoticePopupView:t.mypage.view.NoticePopupView,NoticePopupController:t.pc.mypage.controller.NoticePopupController,NoticePopupModel:t.pc.mypage.model.NoticePopup,AFavoriteMemberModel:t.party.model.AFavoriteMember};n.each(["my_001"],function(e){n.has(i,e)&&(o[e]=i[e].Scene,o[n.camelize(e)+"Delegate"]=i[e].SceneDelegate)}),t.dictx.navigateInject.mypage=function(){t.dictx.injectDependent(a,o)}}((this||0).self||global),function(e){var t=e.kh,n=e._;t.pc=t.pc||{},t.pc.note||t.pc.note;var i=t.pc.note,a={sceneManager:t.SceneManager,popupFactoryComAgeLimit:t.PopupFactoryComAgeLimitB};n.each(["AQuestInfo","ALibrary","ABanners","AWorlds","AUnions"],function(e){a["api"+e]=t.env.useApiMock?t.MockApi[e]:t.Api[e]});var o={};n.each(["no_001","no_002","no_003","no_004","no_007","no_012"],function(e){n.has(i,e)&&(o[e]=i[e].Scene,o[n.camelize(e)+"Delegate"]=i[e].SceneDelegate)}),t.dictx.navigateInject.note=function(){t.dictx.injectDependent(a,o)}}((this||0).self||global),function(e){var t=e.kh,n={};_.each(["AAccessories"],function(e){n["api"+e]=t.env.useApiMock?t.MockApi[e]:t.Api[e]});var i={AcceInfoPopup:t.acce.view.AcceInfoPopup,AcceSeriesHintPopup:t.acce.view.AcceSeriesHintPopup,AcceOthersDetailPopup:t.acce.view.AcceOthersDetailPopup,characterAccessoriesModel:t.acce.model.CharacterAccessories,accessoryInfoModel:t.acce.model.AccessoryInfo,accessoryPointInfoModel:t.acce.model.AccessoryPointInfo};t.dictx.injectDependent(n,i)}((this||0).self||global),function(e){var t=e.kh,n=e._;t.pc=t.pc||{},t.pc.party||t.pc.party;var i=t.pc.party,a={sceneManager:t.SceneManager,unionRouter:t.UnionRouter,PopupFactoryBlackRed:t.PopupFactoryBlackRed,popupFactoryComConfirmBonus:t.PopupFactoryComConfirmBonus,popupFactoryComCharChange:t.PopupFactoryComCharChange,popupFactoryComOpenJobEpisode:t.PopupFactoryComOpenJobEpisode,popupFactoryComPartyAutoOrg:t.PopupFactoryComPartyAutoOrg,popupFactoryComWeaponSummonAutoOrg:t.PopupFactoryComWeaponSummonAutoOrg,PulldownSortConfig:t.PulldownSortConfig};n.each(["AUnions","AAccessories","AParties","AJobs","AWorlds","AWeapons","ASummons","Summons","ACharacters","Characters","ABanners","ASubTutorialPages","AQuestInfo","AFavoriteMember","AJobEnergyRelease","AJobParameter"],function(e){a["api"+e]=t.env.useApiMock?t.MockApi[e]:t.Api[e]});var o={FavoriteInfoPopup:t.party.view.FavoriteInfoPopup,AFavoriteMemberModel:t.party.model.AFavoriteMember,JobParameterChangePopup:t.party.view.JobParameterChangePopup,JobParameterChangeHintPopup:t.party.view.JobParameterChangeHintPopup,ComPartyAutoOrgPopup:t.party.view.ComPartyAutoOrgPopup,AJobParameterModel:t.party.model.AJobParameter,SupportSummonInfoPopup:t.party.view.SupportSummonInfoPopup,ChangePartyPopup:t.party.view.ChangePartyPopup,CanNotUseAccessoryPopup:t.book.view.CanNotUseAccessoryPopup,AcceDetailSwapPopup:t.acce.view.AcceDetailSwapPopup,ParHelpMpPopup:t.core.view.HintCommonPopup,ParHelpStatusEnhancePopup:t.core.view.HintCommonPopup,ParHelpAbilityGetPopup:t.core.view.HintCommonPopup,ParExchangeMpPopup:t.party.view.ParExchangeMpPopup,ParExchangeMpConfirmPopup:t.party.view.ParExchangeMpConfirmPopup,ParEnergyBonusPopup:t.party.view.ParEnergyBonusPopup,JobEnergyReleaseSummaryController:t.party.controller.JobEnergyReleaseSummaryController,EnhanceStatusListController:t.party.controller.EnhanceStatusListController,AcquireAbilityListController:t.party.controller.AcquireAbilityListController,EnhanceStatusPopup:t.party.view.EnhanceStatusPopup,CanNotEnhanceStatusPopup:t.party.view.CanNotEnhanceStatusPopup,RemoveStatusPopup:t.party.view.RemoveStatusPopup,AllRemoveStatusPopup:t.party.view.AllRemoveStatusPopup,ActiveStatusListPopup:t.party.view.ActiveStatusListPopup,AcquireAbilityPopup:t.party.view.AcquireAbilityPopup};n.each(["par_001_002_003","par_004","par_005","par_006_007","par_008","par_009","par_013","par_015","par_energy_release","par_pick_member_acce"],function(e){n.has(i,e)&&(o[e]=i[e].Scene,o[n.camelize(e)+"Delegate"]=i[e].SceneDelegate)}),t.dictx.navigateInject.party=function(){t.dictx.injectDependent(a,o)}}((this||0).self||global),function(e){var t=e.kh;t.createNameSpaceIfNotExists("poprank.config"),t.poprank.config.VoteVotingTicketsDIConfig={apply:function(){var e={VotingTicketRView:t.poprank.view.VoteVotingTicketView,VotingTicketSRView:t.poprank.view.VoteVotingTicketView,VotingTicketSSRView:t.poprank.view.VoteVotingTicketView};t.dictx.injectDependent({},e)}}}((this||0).self||global),function(e){var t=e.kh;e.khutil,e.cc,e.ccui,e._,e.console,t.createNameSpaceIfNotExists("poprank.config"),t.poprank.config.ExchangeVotingTicketsDIConfig={className:"ExchangeVotingTicketsDIConfig",apply:function(){var e={VotingTicketRView:t.poprank.view.ExchangeVotingTicketView,VotingTicketSRView:t.poprank.view.ExchangeVotingTicketView,VotingTicketSSRView:t.poprank.view.ExchangeVotingTicketView};t.dictx.injectDependent({},e)}}}((this||0).self||global),function(e){var t=e.kh,n=e._;t.pc=t.pc||{},t.pc.poprank=t.pc.poprank||{};var i=t.pc.poprank,a={selectionController:t.poprank.controller.selectionController};n.each(["AEvents","Items","Weapons","Summons","Accessories","PackageItems","Events","ABanners"],function(e){a["api"+e]=t.env.useApiMock?t.MockApi[e]:t.Api[e]});var o={ElectableCharacterPageListCollectionController:t.poprank.controller.ElectableCharacterPageListCollectionController,ElectableCharacterPageListController:t.poprank.controller.ElectableCharacterPageListController,ElectableCharacterTouchEventHandler:t.poprank.eventHandling.ElectableCharacterTouchEventHandler,ElectableCharacterPageListSettings:t.poprank.settings.ElectableCharacterPageListSettings,ElectableCharacterFactory:t.poprank.factory.ElectableCharacterFactory,ElectableCharacterSelectionView:t.poprank.view.ElectableCharacterSelectionView,ElectableCharacterController:t.poprank.controller.ElectableCharacterController,ElectableCharacterModel:t.poprank.model.ElectableCharacterModel,ElectableCharacterAvatarView:t.poprank.view.ElectableCharacterAvatarView,PopularRankingAvatarView:t.poprank.view.PopularRankingAvatarView,VoteVotingTicketCollectionController:t.poprank.controller.VoteVotingTicketCollectionController,VotingTicketCollectionController:t.poprank.controller.VotingTicketCollectionController,VotingTicketRepository:t.poprank.repository.VotingTicketRepository,VotingTicketController:t.poprank.controller.VotingTicketController,VotingTicketFactory:t.poprank.factory.VotingTicketFactory,VotingTicketModel:t.poprank.model.VotingTicketModel,VoteButtonController:t.poprank.controller.VoteButtonController,VoteButtonView:t.poprank.view.VoteButtonView,VoteButtonTouchEventHandler:t.poprank.eventHandling.VoteButtonTouchEventHandler,VoteProcessController:t.poprank.controller.VoteProcessController,VoteTicketAmountSelectionPopupController:t.poprank.controller.VoteTicketAmountSelectionPopupController,VoteTicketAmountSelectionUIController:t.poprank.controller.VoteTicketAmountSelectionUIController,VoteTicketAmountSelectElectableCharacterView:t.poprank.view.VoteTicketAmountSelectElectableCharacterView,VoteTicketAmountSelectVoteTicketAmountView:t.poprank.view.VoteTicketAmountSelectVoteTicketAmountView,VoteConfirmationPopupController:t.poprank.controller.VoteConfirmationPopupController,VoteConfirmationElectableCharacterView:t.poprank.view.VoteConfirmationElectableCharacterView,VoteConfirmationVoteTicketAmountView:t.poprank.view.VoteConfirmationVoteTicketAmountView,VoteResultRepository:t.poprank.repository.VoteResultRepository,VoteResultModel:t.poprank.model.VoteResultModel,VoteResultPopupController:t.poprank.controller.VoteResultPopupController,VoteResultView:t.poprank.view.VoteResultView,VoteResultElectableCharacterView:t.poprank.view.VoteResultElectableCharacterView,VotePageInitializeEventHandler:t.poprank.eventHandling.VotePageInitializeEventHandler,VotePageOnTabChangeEventHandler:t.poprank.eventHandling.VotePageOnTabChangeEventHandler,VoteController:t.poprank.controller.VoteController,CharacterDetailButtonController:t.poprank.controller.CharacterDetailButtonController,CharacterDetailButtonTouchEventHandler:t.poprank.eventHandling.CharacterDetailButtonTouchEventHandler,RankedCharacterController:t.poprank.controller.RankedCharacterController,PoprankRankingPageListController:t.poprank.controller.RankingPageListController,RankingUpdateTimeController:t.poprank.controller.RankingUpdateTimeController,RankedCharacterPanelView:t.poprank.view.RankedCharacterPanelView,RankedCharacterAvatarView:t.poprank.view.RankedCharacterAvatarView,RankedCharacterPanelInitializeEventHandler:t.poprank.eventHandling.RankedCharacterPanelInitializeEventHandler,RankedCharacterOnTouchEventHandler:t.poprank.eventHandling.RankedCharacterOnTouchEventHandler,TentativeRankingPageInitializeEventHandler:t.poprank.eventHandling.TentativeRankingPageInitializeEventHandler,TentativeRankingPageOnTabChangeEventHandler:t.poprank.eventHandling.TentativeRankingPageOnTabChangeEventHandler,RankedCharacterModel:t.poprank.model.RankedCharacterModel,RankingUpdateTimeModel:t.poprank.model.RankingUpdateTimeModel,RankingPageListSettings:t.poprank.settings.RankingPageListSettings,RankingUpdateTimeRepository:t.poprank.repository.RankingUpdateTimeRepository,RankingUpdateTimeView:t.poprank.view.RankingUpdateTimeView,TopRankedCharacterRepository:t.poprank.repository.TopRankedCharacterRepository,RankedCharacterAvatarCollectionController:t.poprank.controller.RankedCharacterAvatarCollectionController,RankedCharacterAvatarController:t.poprank.controller.RankedCharacterAvatarController,BackgroundController:t.poprank.controller.BackgroundController,BackgroundView:t.poprank.view.BackgroundView,EventModel:t.poprank.model.EventModel,EventRepository:t.poprank.repository.EventRepository,CheeringPointsController:t.poprank.controller.CheeringPointsController,PoprankExchangeResultController:t.poprank.controller.ExchangeResultController,CheeringPointsView:t.poprank.view.CheeringPointsView,ExchangeResultPopupView:t.poprank.view.ExchangeResultPopupView,CheeringPointsModel:t.poprank.model.CheeringPointsModel,ExchangeResultModel:t.poprank.model.ExchangeResultModel,ExchangeResultRepository:t.poprank.repository.ExchangeResultRepository,CheeringPointsRepository:t.poprank.repository.CheeringPointsRepository,ExchangeVotingTicketCollectionController:t.poprank.controller.ExchangeVotingTicketCollectionController,ExchangeVotingTicketView:t.poprank.view.ExchangeVotingTicketView,ExchangeButtonController:t.poprank.controller.ExchangeButtonController,ExchangeButtonView:t.poprank.view.ExchangeButtonView,ExchangeButtonTouchEventHandler:t.poprank.eventHandling.ExchangeButtonTouchEventHandler,SubtutorialController:t.poprank.controller.SubtutorialController,SubtutorialModel:t.poprank.model.SubtutorialModel,SubtutorialRepository:t.poprank.repository.SubtutorialRepository,ExchangePageInitializeEventHandler:t.poprank.eventHandling.ExchangePageInitializeEventHandler,RewardPageInitializeEventHandler:t.poprank.eventHandling.RewardPageInitializeEventHandler,RewardPageRefreshEventHandler:t.poprank.eventHandling.RewardPageRefreshEventHandler,ReceiveRewardButtonTouchEventHandler:t.poprank.eventHandling.ReceiveRewardButtonTouchEventHandler,VoteAmountController:t.poprank.controller.VoteAmountController,RewardExchangeInformationModel:t.poprank.model.RewardExchangeInformationModel,VoteAmountView:t.poprank.view.VoteAmountView,RewardPageListSettings:t.poprank.settings.RewardPageListSettings,RewardExchangeInformationRepository:t.poprank.repository.RewardExchangeInformationRepository,RewardButtonController:t.core.reward.RewardButtonController,RewardModel:t.core.reward.RewardModel,RewardPageListController:t.core.reward.RewardPageListController,RewardController:t.core.reward.RewardController,RewardPanelView:t.core.reward.RewardPanelView,RewardExchangeDeadlineController:t.core.reward.RewardExchangeDeadlineController,RewardExchangeDeadlineView:t.core.reward.RewardExchangeDeadlineView,RewardButtonView:t.core.reward.RewardButtonView,ResultPageRewardExchangeDeadlineView:t.poprank.view.ResultPageRewardExchangeDeadlineView,GotoRewardButtonController:t.core.reward.GotoRewardButtonController,GotoRewardButtonView:t.core.reward.GotoRewardButtonView,RewardAllButtonController:t.core.reward.RewardAllButtonController,RewardAllButtonView:t.core.reward.RewardAllButtonView,FinalRankingPageInitializeEventHandler:t.poprank.eventHandling.FinalRankingPageInitializeEventHandler,FinalRankingPageOnTabChangeEventHandler:t.poprank.eventHandling.FinalRankingPageOnTabChangeEventHandler,TopRankedCharacterCollectionController:t.poprank.controller.TopRankedCharacterCollectionController,TopRankedCharacterView:t.poprank.view.TopRankedCharacterView,TopFinalRankedCharacterRepository:t.poprank.repository.TopFinalRankedCharacterRepository,InternalRouteController:t.poprank.controller.InternalRouteController,PrsReceivePopup:t.pc.view.PrsReceivePopup,AcceDataPopup:t.pc.view.AcceDataPopup,ShItemInfoPopup:t.core.item.ShItemInfoPopup,ShWeaponInfoPopup:t.core.item.ShWeaponInfoPopup,ShSummonInfoPopup:t.core.item.ShSummonInfoPopup,ShPackageItemInfoPopup:t.core.item.ShPackageItemInfoPopup};n.each(["poprank_000","poprank_001","poprank_002","poprank_003","poprank_004","poprank_005"],function(e){n.has(i,e)&&(o[e]=i[e].Scene,o[n.camelize(e)+"Delegate"]=i[e].SceneDelegate)}),t.dictx.navigateInject.poprank=function(){t.dictx.injectDependent(a,o)}}((this||0).self||global),function(e){var t=e.kh,n=e._;t.pc=t.pc||{},t.pc.present||t.pc.present;var i=t.pc.present,a={sceneManager:t.SceneManager,soundPlayer:t.SoundPlayer};n.each(["AUnions","APresents","ABanners","AWorlds","AQuestInfo"],function(e){a["api"+e]=t.env.useApiMock?t.MockApi[e]:t.Api[e]});var o={PrsReceivePopup:t.pc.view.PrsReceivePopup};n.each(["prs_001_002_003"],function(e){n.has(i,e)&&(o[e]=i[e].Scene,o[n.camelize(e)+"Delegate"]=i[e].SceneDelegate)}),t.dictx.navigateInject.present=function(){t.dictx.injectDependent(a,o)}}((this||0).self||global),function(e){var t=e.kh,n=e._;t.pc=t.pc||{},t.pc.epic=t.pc.prizehunt||{};var i=t.pc.prizehunt,a={questSceneCommonDelegate:t.QuestScenePcCommonDelegate,popupFactoryComBackCheck:t.PopupFactoryComBackCheck,popupFactoryComBackResult:t.PopupFactoryComBackResult,popupFactoryComNeedApBp:t.PopupFactoryComNeedApBp,popupFactoryComNeedApBp1:t.PopupFactoryComNeedApBp1,popupFactoryComNeedApBp2:t.PopupFactoryComNeedApBp2,popupFactoryComApRestart:t.PopupFactoryComApRestart,popupFactoryComUseResult:t.PopupFactoryComUseResult,popupFactoryComRaidCheck:t.PopupFactoryComRaidCheck,prizeNoteBookModel:t.prizehunt.model.PrizeNoteBook,huntingProgressModel:t.prizehunt.model.HuntingProgress,huntPrizeProgressModel:t.prizehunt.model.HuntPrizeProgress};n.each(["APlayers","AEvents","Events","AQuests","Quests","ASubTutorialPages","APrizeHunt","AItems","Accessories","Shop","ShopBuyResult"],function(e){a["api"+e]=t.env.useApiMock?t.MockApi[e]:t.Api[e]});var o={ImplantedSubTutorialPopup:t.core.view.ImplantedSubTutorialPopup,AcceDataPopup:t.pc.view.AcceDataPopup,ShItemInfoPopup:t.core.item.ShItemInfoPopup,ShWeaponInfoPopup:t.core.item.ShWeaponInfoPopup,ShSummonInfoPopup:t.core.item.ShSummonInfoPopup,ShPackageItemInfoPopup:t.core.item.ShPackageItemInfoPopup,PrizeHuntSelectStartingLapPopup:t.prizehunt.view.PrizeHuntSelectStartingLapPopup,PrizeHuntHighestLapUpdatedPopup:t.prizehunt.view.PrizeHuntHighestLapUpdatedPopup,ResumableLaps:t.prizehunt.model.ResumableLaps};n.each(["prizehunt_quest","prizehunt_top","prizehunt_top_notice"],function(e){n.has(i,e)&&(o[e]=i[e].Scene,o[n.camelize(e)+"Delegate"]=i[e].SceneDelegate)}),t.dictx.navigateInject.prizehunt=function(){t.dictx.injectDependent(a,o)}}((this||0).self||global),function(e){var t=e.kh,n=e._;t.pc=t.pc||{},t.pc.profile||t.pc.profile;var i=t.pc.profile,a={sceneManager:t.SceneManager,soundPlayer:t.SoundPlayer,burstTime:t.BurstTime,PulldownSortConfig:t.PulldownSortConfig};n.each(["AQuestInfo","AUnions","AUnionScouts","AGreets","AFriendOffers","AFriends","AFriendCheck","ABanners","AWorlds","AStamps","ASupportSummonSetting","ASummons","Items"],function(e){a["api"+e]=t.env.useApiMock?t.MockApi[e]:t.Api[e]});var o={popupFactoryComEditComment:t.PopupFactoryComEditComment,popupFactoryComGreeting:t.PopupFactoryComGreeting,BurstTimeSubTutorialPanel:t.BurstTimeSubTutorialPanel,DetailBackButtonsController:t.detail.controller.DetailBackButtonsController,SupportSummonSetResultPopup:t.profile.view.SupportSummonSetResultPopup,SupportSummonReleaseResultPopup:t.profile.view.SupportSummonReleaseResultPopup};n.each(["prf_001_myself","prf_001_others","prf_005_myself","prf_005_others","prf_support_summon_config"],function(e){n.has(i,e)&&(o[e]=i[e].Scene,o[n.camelize(e)+"Delegate"]=i[e].SceneDelegate)}),t.dictx.navigateInject.profile=function(){t.dictx.injectDependent(a,o)}}((this||0).self||global),function(e){var t=e.kh;e._,t.core=t.core||{},t.core.reward=t.core.reward||{};var n={PrsReceivePopup:t.pc.view.PrsReceivePopup,RewardButtonController:t.core.reward.RewardButtonController,RewardModel:t.core.reward.RewardModel,RewardPageListController:t.core.reward.RewardPageListController,RewardController:t.core.reward.RewardController,RewardPanelView:t.core.reward.RewardPanelView,RewardExchangeDeadlineController:t.core.reward.RewardExchangeDeadlineController,RewardExchangeDeadlineView:t.core.reward.RewardExchangeDeadlineView,RewardButtonView:t.core.reward.RewardButtonView,GotoRewardButtonController:t.core.reward.GotoRewardButtonController,GotoRewardButtonView:t.core.reward.GotoRewardButtonView,RewardAllButtonController:t.core.reward.RewardAllButtonController,RewardAllButtonView:t.core.reward.RewardAllButtonView,AcceDataPopup:t.pc.view.AcceDataPopup,ShItemInfoPopup:t.core.item.ShItemInfoPopup,ShWeaponInfoPopup:t.core.item.ShWeaponInfoPopup,ShSummonInfoPopup:t.core.item.ShSummonInfoPopup,ShPackageItemInfoPopup:t.core.item.ShPackageItemInfoPopup};t.dictx.injectDependent({},n)}((this||0).self||global),function(e){var t=e.kh,n=e._;t.pc=t.pc||{},t.pc.raidevent||t.pc.raidevent;var i=t.pc.raidevent,a={sceneManager:t.SceneManager,soundPlayer:t.SoundPlayer,orm:t.pc.raidevent.ObjectRecordMapper,raidEvent:t.pc.raidevent.model.RaidEvent,eventGachaCategories:t.pc.raidevent.model.EventGachaCategories,questSceneCommonDelegate:t.QuestScenePcCommonDelegate,popupFactoryComBackCheck:t.PopupFactoryComBackCheck,popupFactoryComBackResult:t.PopupFactoryComBackResult,popupFactoryComNeedApBp:t.PopupFactoryComNeedApBp,popupFactoryComNeedApBp1:t.PopupFactoryComNeedApBp1,popupFactoryComNeedApBp2:t.PopupFactoryComNeedApBp2,popupFactoryComApRestart:t.PopupFactoryComApRestart,popupFactoryComUseResult:t.PopupFactoryComUseResult,popupFactoryComRaidCheck:t.PopupFactoryComRaidCheck,popupFactoryComQuestInfo:t.PopupFactoryComQuestInfo,popupFactoryComAgeLimit:t.PopupFactoryComAgeLimitB,burstTime:t.BurstTime};n.each(["AUnions","AQuests","AWorlds","AItems","ABanners","AQuestInfo","ASubTutorialPages","AEvents","Events","AGacha","AParties","AGachaCategories","GachaCategories","Shop","ShopBuyResult","Weapons","Summons","Items","Accessories","PackageItems"],function(e){a["api"+e]=t.env.useApiMock?t.MockApi[e]:t.Api[e]});var o={RaidEventTicket:t.pc.raidevent.model.RaidEventItem,RaidEventCertificate:t.pc.raidevent.model.RaidEventItem,RaidEventTreasure:t.pc.raidevent.model.RaidEventItem,EventGachaCategory:t.pc.raidevent.model.EventGachaCategory,EventGacha:t.pc.raidevent.model.EventGacha,GachaContentsItem:t.pc.raidevent.model.GachaContentsItem,GachaPlayButton:t.pc.raidevent.view.GachaPlayButton,GachaSkipButton:t.pc.raidevent.view.GachaSkipButton,AttentionButton:t.pc.raidevent.view.AttentionButton,EventItemStockPanel:t.pc.raidevent.view.EventItemStockPanel,ShWeaponInfoPopup:t.core.item.ShWeaponInfoPopup,ShSummonInfoPopup:t.core.item.ShSummonInfoPopup,ShItemInfoPopup:t.core.item.ShItemInfoPopup,AcceDataPopup:t.pc.view.AcceDataPopup,ShPackageItemInfoPopup:t.core.item.ShPackageItemInfoPopup,ComOpenEpisodePopup:t.pc.view.ComOpenEpisodePopup,Q001ApOpenPopup:t.pc.raidevent.view.Q001ApOpenPopup,PrsReceivePopup:t.pc.view.PrsReceivePopup,BurstTimeCountDownPanel:t.BurstTimeCountDownPanel,ImplantedEventSubTutorialPopup:t.core.view.ImplantedEventSubTutorialPopup};n.each(["ra_000","ra_001","ra_002","ra_003","ra_004","ra_005","ra_006"],function(e){n.has(i,e)&&(o[e]=i[e].Scene,o[n.camelize(e)+"Delegate"]=i[e].SceneDelegate)}),t.dictx.navigateInject.raidevent=function(){t.dictx.injectDependent(a,o)}}((this||0).self||global),function(e){var t=e.kh,n={playerGameConfig:t.PlayerGameConfig,popupFactoryAQ002Brief:t.PopupFactoryAQ002Brief,popupFactoryAQ002Log:t.PopupFactoryAQ002Log};_.each(["AUnions","AWorlds","AQuests","ABattles","Episodes","Scenarios","HaremScenes"],function(e){n["api"+e]=t.env.useApiMock?t.MockApi[e]:t.Api[e]});var i={scenarioPlayer:t.PlayerScene.PlayOne.ScenarioPlayerScene,haremPlayer:t.PlayerScene.PlayOne.HaremPlayerScene,episodePlayer:t.PlayerScene.EpisodePlayerScene};_.each(["scenario","harem"],function(e){_.has(t,e)&&(i[e]=t[e].Scene)}),t.dictx.navigateInject.scenario=function(){t.dictx.injectDependent(n,i)}}((this||0).self||global),function(e){var t=e.kh,n=e._;t.pc=t.pc||{},t.pc.scoreattack=t.pc.scoreattack||{};var i=t.pc.scoreattack,a={questSceneCommonDelegate:t.QuestScenePcCommonDelegate,popupFactoryComBackCheck:t.PopupFactoryComBackCheck,popupFactoryComBackResult:t.PopupFactoryComBackResult,popupFactoryComNeedApBp:t.PopupFactoryComNeedApBp,popupFactoryComNeedApBp1:t.PopupFactoryComNeedApBp1,popupFactoryComNeedApBp2:t.PopupFactoryComNeedApBp2,popupFactoryComApRestart:t.PopupFactoryComApRestart,popupFactoryComUseResult:t.PopupFactoryComUseResult,popupFactoryComRaidCheck:t.PopupFactoryComRaidCheck,scoreAttackEventDetail:t.scoreattack.model.AEventDetail,gameDescriptionsRepository:t.GameDescriptionsRepository};n.each(["AEvents","Events","AQuests","Quests","AItems","Accessories","ShopBuyResult","Shop","Items","Weapons","Summons","Accessories","PackageItems","GameDescriptions"],function(e){a["api"+e]=t.env.useApiMock?t.MockApi[e]:t.Api[e]});var o={ImplantedSubTutorialPopup:t.core.view.ImplantedSubTutorialPopup,ScoreattackRankingRulePopup:t.core.view.HintCommonPopup,GameDescriptionsModel:t.GameDescriptionsModel};n.each(["scoreattack_quest","scoreattack_ranking","scoreattack_reward","scoreattack_top","scoreattack_top_end","scoreattack_top_notice"],function(e){n.has(i,e)&&(o[e]=i[e].Scene,o[n.camelize(e)+"Delegate"]=i[e].SceneDelegate)}),t.dictx.navigateInject.scoreattack=function(){t.dictx.injectDependent(a,o)}}((this||0).self||global),function(e){var t=e.kh,n=e._;t.pc=t.pc||{},t.pc.serial=t.pc.serial||{};var i=t.pc.serial,a={sceneManager:t.SceneManager,serialCode:t.pc.serial.model.SerialCode};n.each(["AUnions","AQuestInfo","ABanners","AWorlds","ASerialCodes"],function(e){a["api"+e]=t.env.useApiMock?t.MockApi[e]:t.Api[e]});var o={serialCodeSendButton:t.pc.serial.view.SerialCodeSendButton};n.each(["seri_000"],function(e){n.has(i,e)&&(o[e]=i[e].Scene,o[n.camelize(e)+"Delegate"]=i[e].SceneDelegate)}),t.dictx.navigateInject.serial=function(){t.dictx.injectDependent(a,o)}}((this||0).self||global),function(e){var t=e.kh,n=e._;t.pc=t.pc||{},t.pc.set||t.pc.set;var i=t.pc.set,a={sceneManager:t.SceneManager,unionRouter:t.UnionRouter,soundPlayer:t.SoundPlayer};n.each(["AUnions","AQuestInfo","AWorlds","ABanners"],function(e){a["api"+e]=t.env.useApiMock?t.MockApi[e]:t.Api[e]});var o={};n.each(["set_001"],function(e){n.has(i,e)&&(o[e]=i[e].Scene,o[n.camelize(e)+"Delegate"]=i[e].SceneDelegate)}),t.dictx.navigateInject.set=function(){t.dictx.injectDependent(a,o)}}((this||0).self||global),function(e){var t=e.kh,n=e._;t.pc=t.pc||{},t.pc.shop=t.pc.shop||{};var i=t.pc.shop,a={sceneManager:t.SceneManager,soundPlayer:t.SoundPlayer,accessoryInfoModel:t.acce.model.AccessoryInfo};n.each(["AUnions","AQuestInfo","ABanners","Characters","Weapons","Summons","AWorlds","Gacha","Shop","ShopBuyResult","ASubTutorialPages"],function(e){a["api"+e]=t.env.useApiMock?t.MockApi[e]:t.Api[e]});var o={AccessoryPointShopItemModel:t.shop.model.AccessoryPointShopItem,SummonOrbShopItemModel:t.shop.model.SummonOrbShopItem,AcceDataPopup:t.pc.view.AcceDataPopup,ShopCheckChangePopupController:t.shop.controller.ShopCheckChangePopupController,CurrencyAmountLabelController:t.shop.currency.amount_label.Controller,CurrencyAmountLabelView:t.shop.currency.amount_label.View,PseudoCurrencyAmountLabelController:t.shop.currency.amount_label.PseudoCurrencyController,AccessoryPointAmountLabelController:t.shop.currency.amount_label.AccessoryPointController,SummonOrbAmountLabelController:t.shop.currency.amount_label.SummonOrbController,StoneAmountLabelController:t.shop.currency.amount_label.StoneController,ShopItemPanelBuyButtonController:t.shop.shop_item.shop_item_panels.buy_button.Controller,ShopItemPanelDescriptionController:t.shop.shop_item.shop_item_panels.description.Controller,ShopItemPanelDescriptionView:t.shop.shop_item.shop_item_panels.description.View,ShopItemPanelHeaderController:t.shop.shop_item.shop_item_panels.header.Controller,ShopItemPanelHeaderView:t.shop.shop_item.shop_item_panels.header.View,ShopItemPanelItemImageController:t.shop.shop_item.shop_item_panels.item_image.Controller,ShopItemPanelItemImageItemTouchEventHandler:t.shop.shop_item.shop_item_panels.item_image.ItemTouchEventHandler,ShopItemPanelItemImagePackageTouchEventHandler:t.shop.shop_item.shop_item_panels.item_image.PackageTouchEventHandler,ShopItemPanelItemImageWeaponTouchEventHandler:t.shop.shop_item.shop_item_panels.item_image.WeaponTouchEventHandler,ShopItemPanelItemImageSummonTouchEventHandler:t.shop.shop_item.shop_item_panels.item_image.SummonTouchEventHandler,ShopItemPanelItemImageAccessoryTouchEventHandler:t.shop.shop_item.shop_item_panels.item_image.AccessoryTouchEventHandler,ShopItemPanelPriceController:t.shop.shop_item.shop_item_panels.price.Controller,ShopItemPanelPriceView:t.shop.shop_item.shop_item_panels.price.View,ShopItemPanelCurrencyController:t.shop.shop_item.shop_item_panels.currency.Controller,ShopItemPanelCurrencyView:t.shop.shop_item.shop_item_panels.currency.View,ShopItemPanelSaleImageController:t.shop.shop_item.shop_item_panels.sale_image.Controller,ShopItemPanelSaleImageView:t.shop.shop_item.shop_item_panels.sale_image.View,TreasureModel:t.core.treasure_panel.TreasureModel,TreasureNameView:t.core.treasure_panel.TreasureNameView,StockInfoModel:t.core.treasure_panel.StockInfoModel,StockInfoView:t.core.treasure_panel.StockInfoView,HiddenShopItemPanelController:t.shop.shop_item.shop_item_panels.HiddenController,NormalShopItemPanelController:t.shop.shop_item.shop_item_panels.NormalController,ShopItemPanelController:t.shop.shop_item.PanelController,PointShopItemListController:t.shop.shop_item_list.PointController,CautionPopupViewedStateHandler:t.shop.real_money_transaction_caution.CautionPopupViewedStateHandler,PopupShCurrencyCaution:t.shop.real_money_transaction_caution.PopupShCurrencyCaution,PopupShPaymentServices:t.shop.real_money_transaction_legal_info.PopupShPaymentServices,PopupShSpecifiedCommercialTransactions:t.shop.real_money_transaction_legal_info.PopupShSpecifiedCommercialTransactions,PointVendingProcessController:t.shop.vending_process.PointController,TransactionResultController:t.shop.vending_process.TransactionResultController,ShopHeaderController:t.shop.header.Controller,PseudoCurrencyShopHeaderController:t.shop.header.PseudoCurrencyController,StoneShopHeaderController:t.shop.header.StoneController,ShopHeaderView:t.shop.header.View,ShopSubHeaderView:t.shop.header.SubHeaderView,ShWeaponInfoPopup:t.core.item.ShWeaponInfoPopup,ShSummonInfoPopup:t.core.item.ShSummonInfoPopup,ShItemInfoPopup:t.core.item.ShItemInfoPopup,ShPackageItemInfoPopup:t.core.item.ShPackageItemInfoPopup,PopupShBuyResult:t.vending_process.PopupShBuyResult,ShComNeedMatePopup:t.core.item.ShComNeedMatePopup,ComFilterShopPopup:t.shop.shopFilter.ComShopFilterPopup};n.each(["sh_001","sh_002","sh_101","sh_102"],function(e){return n.has(i,e)?(o[e]=i[e].Scene,void(o[n.camelize(e)+"Delegate"]=i[e].SceneDelegate)):void console.log(e+" was not in ",i)}),t.dictx.navigateInject.shop=function(){t.dictx.injectDependent(a,o)}}((this||0).self||global),function(e){var t=e.kh,n=e._;t.pc=t.pc||{},t.pc.status=t.pc.status||{};var i=t.pc.status,a={episodeImage:t.EpisodeImage};n.each(["AQuestInfo","AEvents","Events","Gacha","ABanners","ACharacters","Characters","Summons","ASummons","Weapons","AWeapons","ALibrary","Episodes"],function(e){a["api"+e]=t.env.useApiMock?t.MockApi[e]:t.Api[e]});var o={characterArousal:t.status.CharacterArousal};n.each(["status_001","status_002","status_003"],function(e){n.has(i,e)&&(o[e]=i[e].Scene,o[n.camelize(e)+"Delegate"]=i[e].SceneDelegate)}),t.dictx.navigateInject.status=function(){t.dictx.injectDependent(a,o)}}((this||0).self||global),function(e){var t=e.kh,n=e._;t.pc=t.pc||{},t.pc.top||t.pc.top;var i=t.pc.top,a={sceneManager:t.SceneManager,soundPlayer:t.SoundPlayer};n.each(["AUnions","ABanners","Top","AWorlds","AQuestInfo","ATutorialInfo"],function(e){a["api"+e]=t.env.useApiMock?t.MockApi[e]:t.Api[e]});var o={PrivacyPolicyChangePopup:t.top.view.PrivacyPolicyChangePopup};n.each(["top_001"],function(e){n.has(i,e)&&(o[e]=i[e].Scene,o[n.camelize(e)+"Delegate"]=i[e].SceneDelegate)}),t.dictx.injectDependent(a,o)}((this||0).self||global),function(e){var t=e.kh,n=e._;t.pc=t.pc||{},t.pc.tower=t.pc.tower||{};var i=t.pc.tower,a={ATowerFloorStateRepository:t.tower.model.ATowerFloorStateRepository,QuestBattleInfoDataRepository:t.tower.model.QuestBattleInfoDataRepository,questSceneCommonDelegate:t.QuestScenePcCommonDelegate,popupFactoryComBackCheck:t.PopupFactoryComBackCheck,popupFactoryComBackResult:t.PopupFactoryComBackResult,popupFactoryComNeedApBp:t.PopupFactoryComNeedApBp,popupFactoryComNeedApBp1:t.PopupFactoryComNeedApBp1,popupFactoryComNeedApBp2:t.PopupFactoryComNeedApBp2,popupFactoryComApRestart:t.PopupFactoryComApRestart,popupFactoryComUseResult:t.PopupFactoryComUseResult,popupFactoryComRaidCheck:t.PopupFactoryComRaidCheck};n.each(["AEvents","Events","AQuests","Quests","AMissions","ASubTutorialPages","AItems","Accessories","ShopBuyResult","Items","Weapons","Summons","Accessories","PackageItems"],function(e){a["api"+e]=t.env.useApiMock?t.MockApi[e]:t.Api[e]});var o={QuestTowerView:t.tower.view.QuestTower,TowerRankingRulePopup:t.tower.view.TowerRankingRulePopup,TowerQuestMissionDataPopup:t.tower.view.MissionDataPopup,TowerQuestConfirmStartPopup:t.tower.view.QuestConfirmStartPopup,TowerQuestItemShortagePopup:t.tower.view.QuestItemShortagePopup,TowerQuestBattleDataPopup:t.tower.view.TowerQuestBattleDataPopup,TowerGiveItemPopup:t.tower.view.TowerGiveItemPopup,ReceiveRewardButtonTouchEventHandler:t.core.reward.ReceiveRewardButtonTouchEventHandler,RewardController:t.core.reward.RewardController,TowerRewardPanelView:t.tower.view.TowerRewardPanel,RewardButtonView:t.core.reward.RewardButtonView,RankingRewardModel:t.core.reward.RankingRewardModel,RewardButtonController:t.core.reward.RewardButtonController,PrsReceivePopup:t.pc.view.PrsReceivePopup,ShWeaponInfoPopup:t.core.item.ShWeaponInfoPopup,ShSummonInfoPopup:t.core.item.ShSummonInfoPopup,ShItemInfoPopup:t.core.item.ShItemInfoPopup,AcceDataPopup:t.pc.view.AcceDataPopup,ShPackageItemInfoPopup:t.core.item.ShPackageItemInfoPopup,ImplantedEventSubTutorialPopup:t.core.view.ImplantedEventSubTutorialPopup};n.each(["tower_quest","tower_ranking","tower_ranking_reward","tower_top","tower_top_end","tower_top_notice"],function(e){n.has(i,e)&&(o[e]=i[e].Scene,o[n.camelize(e)+"Delegate"]=i[e].SceneDelegate)}),t.dictx.navigateInject.tower=function(){t.dictx.injectDependent(a,o)}}((this||0).self||global),function(e){var t=e.kh,n=e._;t.pc=t.pc||{},t.pc.unionraid||t.pc.unionraid;var i=t.pc.unionraid,a={sceneManager:t.SceneManager,unionRaidBattleSituationModel:t.unionraid.model.BattleSituation,unionRaidModel:t.unionraid.model.UnionRaid,unionRaidMasterModel:t.unionraid.model.UnionRaidMaster,unionRaidNoticeModel:t.unionraid.model.UnionRaidNotice,unionRaidNoticeMasterModel:t.unionraid.model.UnionRaidNoticeMaster,unionRaidPointModel:t.unionraid.model.Point,unionRaidDemonBuffModel:t.unionraid.model.DemonBuff,unionRaidItemModel:t.unionraid.model.Item,unionRankingEventModel:t.unionraid.model.UnionRankingEvent,playerQuestPointsModel:t.model.PlayerQuestPoints,questInfoModel:t.model.QuestInfo,battleUnverifiedModel:t.model.BattleUnverified,playerMeNumericModel:t.model.PlayerMeNumeric,playerMeModel:t.model.PlayerMe,soundPlayer:t.SoundPlayer,subTutorialPageModel:t.SubTutorialPageModel,burstTime:t.BurstTime,gameDescriptionsRepository:t.GameDescriptionsRepository,popupFactoryComBackCheck:t.PopupFactoryComBackCheck,popupFactoryComBackResult:t.PopupFactoryComBackResult,popupFactoryComNeedApBp:t.PopupFactoryComNeedApBp,popupFactoryComNeedApBp1:t.PopupFactoryComNeedApBp1,popupFactoryComNeedApBp2:t.PopupFactoryComNeedApBp2,popupFactoryComApRestart:t.PopupFactoryComApRestart,popupFactoryComUseResult:t.PopupFactoryComUseResult,popupFactoryComRaidCheck:t.PopupFactoryComRaidCheck,popupFactoryComQuestInfo:t.PopupFactoryComQuestInfo,popupFactoryComAgeLimit:t.PopupFactoryComAgeLimitB,popupFactoryRaQuestAppearance:t.PopupFactoryRaQuestAppearance,apiAEventsBridge:t.unionraid.repository.apiAEventsBridge};n.each(["ABanners","AQuests","AQuestInfo","AItems","AWorlds","Events","AEvents","ASubTutorialPages","AUnions","ABattles","Shop","ShopBuyResult","Weapons","Summons","Items","GameDescriptions","Accessories","PackageItems"],function(e){a["api"+e]=t.env.useApiMock?t.MockApi[e]:t.Api[e]});var o={PageController:t.PageControllerEx,BurstTimeCountDownPanel:t.BurstTimeCountDownPanel,RaidButtonView:t.view.RaidButton,UnionChatButtonView:t.unionraid.view.UnionChatButton,SceneInterruptManager:t.SceneInterruptManager,UnionRaidContributionPointModel:t.unionraid.model.ContributionPoint,UnionRaidSubjugationCountModel:t.unionraid.model.SubjugationCount,UnionRaidAttentionInfoModel:t.unionraid.model.AttentionInfo,UnionRaidBuffEffectModel:t.unionraid.model.BuffEffect,UnionRaidBuffEffectItemModel:t.unionraid.model.BuffEffectItem,UnionRaidBuffCheckPopupParam:t.unionraid.model.BuffCheckPopupParam,UnionRaid001BattleSituationView:t.pc.unionraid.uniraid_001.view.BattleSituation,UnionRaidBattleSituationExpertView:t.pc.unionraid.uniraid_002.view.BattleSituationExpert,UnionRaidBattleSituationUltimateView:t.pc.unionraid.uniraid_002.view.BattleSituationUltimate,UnionRaidBattleInfoView:t.unionraid.view.BattleInfo,UnionRaidPointView:t.unionraid.view.Point,UnionRaidRewardReceiveBtnView:t.unionraid.view.RewardReceiveBtn,UnionRaidRankingRewardBtnView:t.unionraid.view.RankingRewardBtn,UnionRaidBackgroundView:t.unionraid.view.Background,UnionRaidAttentionInfoPopup:t.unionraid.view.AttentionInfoPopup,UniRaid000InterruptsFactory:t.unionraid.factory.UniRaid000Interrupts,UnionRaidSubTutorialInterrupt:t.unionraid.interrupt.SubTutorial,UnionRaidLoginBonusInterrupt:t.unionraid.interrupt.LoginBonus,UnionRaid000AttentionInfoInterrupt:t.unionraid.interrupt.UniEvent000AttentionInfo,UnionRaid001AttentionInfoInterrupt:t.unionraid.interrupt.UniEvent001AttentionInfo,UniRaid001InterruptsFactory:t.unionraid.factory.UniRaid001Interrupts,UniRaid001PopupInvoker:t.unionraid.unievent_001.PopupInvoker,UniRaid002PopupInvoker:t.unionraid.unievent_002.PopupInvoker,UniRaid002BuffPanelView:t.pc.unionraid.uniraid_002.view.BuffPanel,UniRaid002BuffPanelTimerView:t.pc.unionraid.uniraid_002.view.BuffPanelTimer,UniRaid005RewardReceiptDeadlineView:t.pc.unionraid.uniraid_005.view.RewardReceiptDeadline,UnionRaidBuffUsePopup:t.unionraid.view.BuffUsePopup,UnionRaidBuffResultPopup:t.unionraid.view.BuffCheckPopup,UnionRaidBuffSuccessPopup:t.unionraid.view.BuffSuccessPopup,UnionRaidBuffErrorShortagePopup:t.unionraid.view.BuffErrorShortagePopup,UnionRaidBuffErrorBattleFinishedPopup:t.unionraid.view.BuffErrorBattleFinishedPopup,UnionRaidBuffErrorLimitedPopup:t.unionraid.view.BuffErrorLimitedPopup,UnionRaidLoginBonusPopup:t.unionraid.view.LoginBonusPopup,UniraidRankiginfoPopup:t.unionraid.view.UniraidRankiginfoPopup,ShWeaponInfoPopup:t.core.item.ShWeaponInfoPopup,ShSummonInfoPopup:t.core.item.ShSummonInfoPopup,ShItemInfoPopup:t.core.item.ShItemInfoPopup,AcceDataPopup:t.pc.view.AcceDataPopup,ShPackageItemInfoPopup:t.core.item.ShPackageItemInfoPopup,PrsReceivePopup:t.pc.view.PrsReceivePopup,ImplantedEventSubTutorialPopup:t.core.view.ImplantedEventSubTutorialPopup,AQ003RankingPopup:t.pc.unionraid.view.AQ003RankingPopup,AQ003RankingPopupPlayer:t.pc.unionraid.view.AQ003RankingPopup.Player,RankingPageInitializeEventHandler:t.unionraid.eventHandling.RankingPageInitializeEventHandler,BackgroundFactory:t.unionraid.factory.BackgroundFactory,RankingPageOnTabChangeEventHandler:t.unionraid.eventHandling.RankingPageOnTabChangeEventHandler,RankingType:t.unionraid.enums.RANKING_TYPE,HeaderView:t.unionraid.view.HeaderView,RankingHeaderView:t.unionraid.view.RankingHeaderView,RankingUpdateTimeController:t.unionraid.controller.RankingUpdateTimeController,RankingUpdateTimeRepository:t.unionraid.repository.RankingUpdateTimeRepository,RankingUpdateTimeModel:t.unionraid.model.RankingUpdateTimeModel,RankingUpdateTimeView:t.unionraid.view.RankingUpdateTimeView,RankingPageListCollectionController:t.unionraid.controller.RankingPageListCollectionController,RankingPageListController:t.unionraid.controller.RankingPageListController,GotoPresentButtonView:t.unionraid.view.GotoPresentButtonView,ReceiveAllButtonView:t.unionraid.view.ReceiveAllButtonView,BuffCheckPopupItemView:t.unionraid.view.BuffCheckPopupItem,BuffEffectItemView:t.unionraid.view.BuffEffectItem,BuffUsePopupItemView:t.unionraid.view.BuffUsePopupItem,QuestPageMinorRaidButtonView:t.env.isSp?t.unionraid.view.QuestPageMinorRaidButtonView:t.unionraid.view.MinorRaidButtonView,MinorRaidButtonView:t.unionraid.view.MinorRaidButtonView,MajorRaidButtonView:t.unionraid.view.MajorRaidButtonView,GotoPresentButtonController:t.unionraid.controller.GotoPresentButtonController,ReceiveAllButtonController:t.unionraid.controller.ReceiveAllButtonController,RankingRewardsReceiveDeadlineController:t.unionraid.controller.RankingRewardsReceiveDeadlineController,RankingRewardInfoLabelController:t.unionraid.controller.RankingRewardInfoLabelController,RankLabelController:t.unionraid.controller.RankLabelController,UnionRankingStatusController:t.unionraid.controller.UnionRankingStatusController,UnionRankingStatusPanelView:t.unionraid.view.UnionRankingStatusPanelView,UnionRankingStatusModel:t.unionraid.model.UnionRankingStatusModel,IndividualRankingStatusController:t.unionraid.controller.IndividualRankingStatusController,IndividualRankingStatusPanelView:t.unionraid.view.IndividualRankingStatusPanelView,IndividualRankingStatusModel:t.unionraid.model.IndividualRankingStatusModel,ScoreController:t.unionraid.controller.ScoreController,ScoreRepository:t.unionraid.repository.ScoreRepository,IndividualScoreModel:t.unionraid.model.IndividualScoreModel,UnionScoreModel:t.unionraid.model.UnionScoreModel,ScoreView:t.unionraid.view.ScoreView,IndividualScoreView:t.unionraid.view.IndividualScoreView,UnionScoreView:t.unionraid.view.UnionScoreView,RankingStatusPanelView:t.core.ranking.RankingStatusPanelView,GameDescriptionsModel:t.GameDescriptionsModel,RuleButtonTouchEventHandler:t.unionraid.eventHandling.RuleButtonTouchEventHandler,RewardObtainmentInfoModel:t.unionraid.model.RewardObtainmentInfoModel,RewardTabExclamationView:t.unionraid.view.RewardTabExclamationView,RewardObtainmentInfoRepository:t.unionraid.repository.RewardObtainmentInfoRepository,RankingRewardModel:t.core.reward.RankingRewardModel,RankingRewardPanel:t.core.reward.RankingRewardPanel};n.each(["uniraid_000","uniraid_001","uniraid_002","uniraid_004","uniraid_005","uniraid_007","uniraid_008","uniraid_009"],function(e){n.has(i,e)&&(o[e]=i[e].Scene,o[n.camelize(e)+"Delegate"]=i[e].SceneDelegate)}),t.dictx.navigateInject.unionraid=function(){t.dictx.injectDependent(a,o)}}((this||0).self||global),function(e){var t=e.kh,n=e._;t.pc=t.pc||{},t.pc.acce=t.pc.acce||{};var i=t.pc.acce,a={sceneManager:t.SceneManager,accessoryInfoModel:t.acce.model.AccessoryInfo,accessoryPointInfoModel:t.acce.model.AccessoryPointInfo};n.each(["AUnions","AQuests","AWorlds","Items","ABanners","AAccessories","Accessories","ASubTutorialPages","ACharacters"],function(e){a["api"+e]=t.env.useApiMock?t.MockApi[e]:t.Api[e]});var o={PulldownSortConfig:t.PulldownSortConfig,AcceDetailSellPopup:t.acce.view.AcceDetailSellPopup,AcceDetailSwapPopup:t.acce.view.AcceDetailSwapPopup,AcceOthersDetailPopup:t.acce.view.AcceOthersDetailPopup,AcceDetailEnhBasePopup:t.acce.view.AcceDetailEnhBasePopup,AcceListEnhCheckPopup:t.acce.view.AcceListEnhCheckPopup,AcceListSellCheckPopup:t.acce.view.AcceListSellCheckPopup,AcceListSellResultPopup:t.acce.view.AcceListSellResultPopup,AcceReleaseCheckPopup:t.acce.view.AcceReleaseCheckPopup,AcceSellCheckPopup:t.acce.view.AcceSellCheckPopup,AcceSellResultPopup:t.acce.view.AcceSellResultPopup,AcceSetPopup:t.acce.view.AcceSetPopup,AcceInfoPopup:t.acce.view.AcceInfoPopup,AcceSeriesHintPopup:t.acce.view.AcceSeriesHintPopup,AcceRemoveCheckPopup:t.acce.view.AcceRemoveCheckPopup,AcceNonOfferPopup:t.acce.view.AcceNonOfferPopup,EnhBaseAcceView:t.acce.view.EnhBaseAcceView,AccessoryModel:t.acce.model.Accessory,characterAccessoriesModel:t.acce.model.CharacterAccessories};n.each(["acce_002_003_005","acce_007_008","acce_010"],function(e){n.has(i,e)&&(o[e]=i[e].Scene,o[n.camelize(e)+"Delegate"]=i[e].SceneDelegate)}),t.dictx.navigateInject.acce=function(){t.dictx.injectDependent(a,o)}}((this||0).self||global);